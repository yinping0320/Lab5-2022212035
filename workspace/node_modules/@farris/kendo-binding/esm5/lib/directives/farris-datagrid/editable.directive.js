import * as tslib_1 from "tslib";
import { Directive, Input, Injector, NgZone, } from '@angular/core';
import { of } from 'rxjs';
import { BindingData, ViewModel, ENABLE_EDIT_STATE_FILTER_SORTING } from '@farris/devkit';
import { DatagridComponent } from '@farris/ui-datagrid';
import { isNumber } from 'lodash-es';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { RuntimeStateService } from '@farris/ui-common';
import { DialogService } from '@farris/ui-dialog';
var EditableDirective = /** @class */ (function () {
    function EditableDirective(bindingData, viewModel, grid, dateService, injector, rts, dialogSer, ngZone) {
        this.bindingData = bindingData;
        this.viewModel = viewModel;
        this.grid = grid;
        this.dateService = dateService;
        this.injector = injector;
        this.rts = rts;
        this.dialogSer = dialogSer;
        this.ngZone = ngZone;
        /**
         * 编辑时取消分组
         */
        this.disableGroupOnEditing = true;
        /**
         * 多选帮助默认分隔符
         */
        this.defaultSpliter = ',';
        /**
         * 临时记录grid分组字段
         */
        this.groupFields = [];
    }
    Object.defineProperty(EditableDirective.prototype, "bindingList", {
        get: function () {
            // 根实体
            if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
                return this.bindingData.list;
            }
            // 子实体
            var bindingPath = this.viewModel.bindingPath.substr(1);
            bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
            var paths = bindingPath.split('/');
            var filteredPaths = paths.filter(function (part) {
                return part !== '';
            });
            return this.bindingData.getValue(filteredPaths);
        },
        enumerable: true,
        configurable: true
    });
    EditableDirective.prototype.ngOnInit = function () {
        this.apply();
    };
    EditableDirective.prototype.ngOnChanges = function (changes) {
        this.apply();
    };
    EditableDirective.prototype.ngOnDestroy = function () {
        this.detach();
    };
    /**
     * 应用属性
     */
    EditableDirective.prototype.apply = function () {
        if (!this.grid) {
            return;
        }
        this.handleGroupStatus();
        // 是否启用了编辑态过滤排序
        if (this.gridEditable) {
            var enableFilterSorting = this.injector && this.injector.get(ENABLE_EDIT_STATE_FILTER_SORTING, false) || false;
            if (!this.grid.remoteFilter && !enableFilterSorting) {
                this.grid.clearCondition();
                // 发送清空过滤条件事件
                this.viewModel.frameContext.appContext.messagePipe.next('CLEAR_GRID_CONDITION');
            }
            this.grid.editable = true;
            if (!this.viewModel.frameContext.appContext.enableGridHeaderWhenEditing && !enableFilterSorting) {
                this.grid.disableHeader(true);
            }
            this.handleBeginEditEvent();
            this.handleAfterEditEvent();
            this.handleEndEditEvent();
        }
        else {
            this.grid.editable = false;
            this.grid.disableHeader(false);
            // TODO:应由表格兼容，但目前补丁不能继续依赖表格组件，临时使用该方案处理
            // 2023-12-25 表格内部已解决列设置后表头无法拖动问题，且兼容代码存在覆盖开发者设置的自定义列名称的问题
            // this.grid.columns = this.grid.columns.map((cols) => {
            //   return cols.map((col) => Object.assign({}, col));
            // });
            // this.grid.columnsChanged(false);
            if (this.grid && typeof this.grid.sort === 'function' && this.grid.sortName) {
                this.grid.sort();
            }
            this.detach();
        }
    };
    /**
     * 编辑时取消分组
     */
    EditableDirective.prototype.handleGroupStatus = function () {
        if (this.disableGroupOnEditing === false) {
            return;
        }
        var groupField = this.grid && this.grid.groupField || null;
        if (groupField) {
            if (this.gridEditable) {
                this.groupFields = [groupField];
                this.grid.setGroupFields('');
            }
        }
        else {
            if (this.groupFields && this.groupFields.length > 0) {
                var groupField_1 = this.groupFields.pop();
                if (this.groupFields.length > 0) {
                    this.groupFields = [];
                }
                this.grid.setGroupFields(groupField_1);
            }
        }
    };
    /**
     * 处理开始编辑事件
     */
    EditableDirective.prototype.handleBeginEditEvent = function () {
        var _this = this;
        this.beginEditSubscription = this.grid.beginEdit.subscribe(function (e) {
            if (!e) {
                return;
            }
            var column = e.column;
            if (column && column.editor) {
                var editorInstance_1 = e.editor.componentRef.instance;
                if (!editorInstance_1 || !editorInstance_1.instance) {
                    return;
                }
                var mapFields_1 = editorInstance_1.instance.mapFields;
                if (column.editor.type === 'lookup' || column.editor.type === 'PersonnelSelector' || column.editor.type === 'OrganizationSelector' || column.editor.type === 'external-integration' || 'EmployeeSelector' === column.editor.type || 'EmployeeOrgSelector' === column.editor.type) {
                    var lookupGrid_1 = editorInstance_1.instance;
                    var subject = editorInstance_1.instance.selectedData;
                    if (subject) {
                        subject.subscribe(function (data) {
                            mapFields_1 = editorInstance_1.instance.mapFields;
                            var spliter = lookupGrid_1.multipleChoiceSeparator || _this.defaultSpliter;
                            _this.lookupMapping(data, mapFields_1, false, spliter);
                        });
                    }
                    var clearMappings = editorInstance_1.instance.clearMappings;
                    if (clearMappings) {
                        clearMappings.subscribe(function (result) {
                            var mapFields = Object.assign({}, editorInstance_1.instance.mapFields);
                            var value = result && result.value || null;
                            var binding = editorInstance_1.column && editorInstance_1.column.field;
                            var lookupTextField = editorInstance_1.instance.textField;
                            var data = {};
                            if (binding) {
                                var textFieldMapping = mapFields[lookupTextField];
                                if (textFieldMapping) {
                                    var otherField = textFieldMapping.split(',').filter(function (item) { return item !== binding; }).join(',');
                                    if (otherField) {
                                        mapFields[lookupTextField] = otherField;
                                    }
                                    else {
                                        delete mapFields[lookupTextField];
                                    }
                                }
                                var parentPaths = _this.getBindingPathArray();
                                _this.bindingData.setValue(parentPaths.concat(binding.split('.')), value, true, true);
                            }
                            // this.setValue(data, lookupTextField.split('.'), value);
                            if (mapFields && Object.keys(mapFields).length > 0) {
                                Object.keys(mapFields).forEach(function (field) {
                                    _this.setValue(data, field.split('.'), '');
                                });
                                _this.lookupMapping(data, mapFields, true);
                            }
                        });
                    }
                }
                if (column.editor.type === 'combo-lookup') {
                    editorInstance_1.instance.valueChange.subscribe(function (e) {
                        var asClear = e && e.selections && e.selections.length === 0;
                        var comboLookup = editorInstance_1.instance;
                        mapFields_1 = editorInstance_1.instance.mapFields;
                        var spliter = comboLookup.separator || _this.defaultSpliter;
                        _this.lookupMapping(e.selections || [], mapFields_1, asClear, spliter);
                    });
                }
                if (['combo-lookup', 'combolist', 'lookup', 'PersonnelSelector', 'OrganizationSelector', 'external-integration', 'EmployeeSelector', 'EmployeeOrgSelector'].includes(column.editor.type)) {
                    if (editorInstance_1.instance.clear && editorInstance_1.instance.clear.subscribe) {
                        editorInstance_1.instance.clear.subscribe(function () {
                            _this.lookupMapping(null, mapFields_1);
                        });
                    }
                }
                if (column.editor.type === 'combolist') {
                    if (mapFields_1) {
                        editorInstance_1.instance.valueChange.subscribe(function (e) {
                            var pathArr = _this.getBindingPathArray();
                            _this.viewModel.bindingData.setValue(pathArr.concat(mapFields_1.split('.')), editorInstance_1.instance.selectedValues, true, true);
                        });
                    }
                }
            }
        });
    };
    /**
     * 处理编辑事件
     */
    EditableDirective.prototype.handleAfterEditEvent = function () {
        var _this = this;
        this.grid.afterEdit = function (rowIndex, rowData, column, editor) {
            if (_this.dialogSer.hasDialogOpened()) {
                return of(false);
            }
            if (_this.rts) {
                // 帮助组件文本变化后去查询
                if (_this.rts.getFormState('lookup.pending')) {
                    return of(false);
                }
            }
            // 更新数据源
            if (!editor || !editor.formControl) {
                return of(false);
            }
            return of(true);
        };
    };
    /**
     * 处理结束编辑事件
     */
    EditableDirective.prototype.handleEndEditEvent = function () {
        var _this = this;
        this.endEditSubscription = this.grid && this.grid.endEdit && this.grid.endEdit.subscribe(function (event) {
            var _a = event || {}, _b = _a.value, value = _b === void 0 ? undefined : _b, _c = _a.column, column = _c === void 0 ? undefined : _c, _d = _a.rowData, rowData = _d === void 0 ? {} : _d;
            var primaryValue = rowData && rowData[_this.grid.idField] || null;
            _this.updateBindingData(value, column, primaryValue);
        });
    };
    /*
     * 给列表赋值 或给formcontrol赋值
     */
    EditableDirective.prototype.updateBindingData = function (value, column, primaryValue) {
        if (!column) {
            return;
        }
        var currentColumnType = column.dataType;
        // 同时判断gridOption的列对象
        var fieldPaths = column.field.split('.');
        // 是否为大数
        var isBigNumber = column && column.editor && column.editor.options && column.editor.options.bigNumber;
        // 存在行编辑器
        if (currentColumnType === 'date') {
            var result = void 0;
            if (value) {
                result = this.dateService.formatTo(value, 'yyyy-MM-dd');
            }
            else {
                result = value;
            }
            this.updateBindingList(primaryValue, fieldPaths.join('.'), result);
        }
        else if (currentColumnType === 'datetime') {
            // if (!value) {
            //   value = '0001-01-01T00:00:00';
            // }
            this.updateBindingList(primaryValue, fieldPaths.join('.'), value);
        }
        else if (currentColumnType === 'number' && !isBigNumber) {
            if (value === null || value === undefined) {
                this.updateBindingList(primaryValue, fieldPaths.join('.'), null);
            }
            else {
                this.updateBindingList(primaryValue, fieldPaths.join('.'), Number(value));
            }
        }
        else {
            this.updateBindingList(primaryValue, fieldPaths.join('.'), value);
        }
    };
    EditableDirective.prototype.updateBindingList = function (primaryValue, propertyName, value) {
        var viewModel = this.viewModel || null;
        if (!viewModel || !propertyName) {
            return;
        }
        // 更新主表部分行的字段
        var propertyNames = propertyName.split('.').filter(function (item) { return item; });
        var bindingPath = this.getBindingPathArray();
        // 取出来的一定是bindingList
        var list = this.bindingData.getValue(bindingPath);
        // 修改的是当前行
        if (list && primaryValue === list.currentItem.primaryKeyValue) {
            var paths = bindingPath.concat(propertyNames);
            this.bindingData.setValue(paths, value, true, true);
            return;
        }
        var bindingObject = this.bindingList.findById(primaryValue);
        if (!bindingObject) {
            return;
        }
        if (propertyNames.length < 2) {
            bindingObject.setValue(propertyName, value, true, true);
        }
        else {
            var targetBindingObject_1 = null;
            var fpaths = propertyNames.slice(0, propertyNames.length - 1);
            var targetPropertyName = propertyNames[propertyNames.length - 1];
            fpaths.forEach(function (prop) {
                targetBindingObject_1 = targetBindingObject_1 && targetBindingObject_1[prop] || bindingObject[prop];
            });
            // todo:需要添加值变化事件
            targetBindingObject_1.setValue(targetPropertyName, value, true, true);
        }
    };
    EditableDirective.prototype.detach = function () {
        if (this.beginEditSubscription && typeof this.beginEditSubscription.unsubscribe === 'function') {
            this.beginEditSubscription.unsubscribe();
        }
        if (this.endEditSubscription && typeof this.endEditSubscription.unsubscribe === 'function') {
            this.endEditSubscription.unsubscribe();
        }
    };
    //#region 帮助字段映射
    EditableDirective.prototype.lookupMapping = function (helpData, mapFields, asClear, spliter) {
        var _this = this;
        if (asClear === void 0) { asClear = false; }
        if (spliter === void 0) { spliter = ','; }
        if (!mapFields) {
            return;
        }
        // 关闭变更检测
        var appContext = this.viewModel.frameContext.appContext;
        appContext.changeDetectionController.detach();
        var pathArr = this.getBindingPathArray();
        var helpFields = Object.keys(mapFields);
        var primaryInfo = this.getMapFieldsPrimaryKey(mapFields, pathArr);
        var primaryKeys = primaryInfo && primaryInfo.map(function (item) { return item.primaryKey; }) || [];
        var primaryFields = primaryInfo && primaryInfo.map(function (item) { return item.primaryField; }) || [];
        // 去重
        if (primaryKeys && primaryKeys.length > 0) {
            primaryKeys = tslib_1.__spread(new Set(primaryKeys));
            helpFields = this.sortMapFieldKeys(helpFields, primaryKeys);
        }
        if (!helpData || asClear) {
            helpFields.reverse();
        }
        helpFields.forEach(function (f) {
            var val = '';
            if (helpData) {
                if (helpData instanceof Array) {
                    val = helpData.map(function (h) {
                        return _this.getValue(f, h);
                    }).join(spliter);
                }
                else {
                    val = _this.getValue(f, helpData);
                }
            }
            var mappings = mapFields[f].split(',');
            var headMappings = mappings.filter(function (p) { return primaryFields.includes(p); });
            var leftMappings = mappings.filter(function (p) { return !primaryFields.includes(p); });
            if (!helpData) {
                mappings = [].concat(leftMappings).concat(headMappings);
            }
            else {
                mappings = [].concat(headMappings).concat(leftMappings);
            }
            mappings.forEach(function (ff) {
                if (!helpData) {
                    _this.viewModel.bindingData.clearValue(pathArr.concat(ff.split('.')), true, true);
                }
                else {
                    _this.viewModel.bindingData.setValue(pathArr.concat(ff.split('.')), val, true, true);
                }
            });
        });
        // 重新打开变更检测
        appContext.changeDetectionController.reattach();
    };
    EditableDirective.prototype.getValue = function (f, data) {
        var val = '';
        if (f.indexOf('.') === -1) {
            val = data[f];
        }
        else {
            val = f.split('.').reduce(function (a, b) {
                return a[b];
            }, data);
        }
        return val;
    };
    EditableDirective.prototype.getBindingPathArray = function () {
        var path = this.viewModel.bindingPath;
        if (path) {
            return path.split('/').filter(function (n) { return n !== ''; });
        }
        return [];
    };
    EditableDirective.prototype.isNumberValue = function (field, data) {
        var currentVal = this.getValue(field, data);
        return isNumber(currentVal);
    };
    //#endregion
    /**
     *
     * @param mapFields  格式形如：{id: "assoField.assoField", code: "assoField.assoField_Code", name: "assoField.assoField_Name"} 或者 {id:'vid',code:'code',name:'name'}
     */
    EditableDirective.prototype.getMapFieldsPrimaryKey = function (mapFields, bindingPaths) {
        if (!mapFields || Object.keys(mapFields).length < 1) {
            return null;
        }
        var results = [];
        // let primaryField = null;
        try {
            var entityTypeInfo_1 = this.viewModel.frameContext.repository.entityTypeInfo;
            Object.keys(mapFields).forEach(function (key) {
                var mapField = mapFields[key];
                if (mapField && typeof mapField === 'string') {
                    var mappings = mapField.split(',').filter(function (p) { return p; });
                    mappings.forEach(function (item) {
                        var paths = item.split('.');
                        if (bindingPaths && bindingPaths.length > 0) {
                            paths = bindingPaths.concat(paths);
                        }
                        var propInfo = entityTypeInfo_1.getPropInfoByPath(paths);
                        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.primary === true) {
                            results.push({
                                primaryKey: key,
                                primaryField: item
                            });
                        }
                    });
                }
            });
        }
        catch (e) {
            console.error(e);
        }
        return results;
    };
    EditableDirective.prototype.setValue = function (target, paths, value) {
        if (target) {
            if (paths.length <= 1) {
                target[paths[0]] = value;
            }
            else {
                paths.slice(0, -1).reduce(function (prev, path) {
                    if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {
                        prev[path] = {};
                    }
                    return prev[path];
                }, target)[paths[paths.length - 1]] = value;
            }
        }
    };
    EditableDirective.prototype.sortMapFieldKeys = function (keys, primaryKeys) {
        if (!primaryKeys || primaryKeys.length < 1 || !keys || keys.length < 1) {
            return keys;
        }
        // 过滤出非主键映射字段
        keys = keys.filter(function (p) { return !primaryKeys.includes(p); });
        return [].concat(primaryKeys).concat(keys);
    };
    EditableDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farris-datagrid-editable]'
                },] }
    ];
    /** @nocollapse */
    EditableDirective.ctorParameters = function () { return [
        { type: BindingData },
        { type: ViewModel },
        { type: DatagridComponent },
        { type: DateTimeHelperService },
        { type: Injector },
        { type: RuntimeStateService },
        { type: DialogService },
        { type: NgZone }
    ]; };
    EditableDirective.propDecorators = {
        gridEditable: [{ type: Input, args: ['farris-datagrid-editable',] }],
        disableGroupOnEditing: [{ type: Input, args: ['disableGroupOnEditing',] }]
    };
    return EditableDirective;
}());
export { EditableDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdGFibGUuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9rZW5kby1iaW5kaW5nLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvZmFycmlzLWRhdGFncmlkL2VkaXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBK0MsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEdBQ2hGLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxFQUFFLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ3hDLE9BQU8sRUFDTCxXQUFXLEVBQWUsU0FBUyxFQUE4QixnQ0FBZ0MsRUFDbEcsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3JDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUlsRDtJQXFDRSwyQkFDUyxXQUF3QixFQUN4QixTQUFvQixFQUNwQixJQUF1QixFQUN0QixXQUFrQyxFQUNuQyxRQUFrQixFQUNqQixHQUF3QixFQUN6QixTQUF3QixFQUN4QixNQUFjO1FBUGQsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixTQUFJLEdBQUosSUFBSSxDQUFtQjtRQUN0QixnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7UUFDbkMsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNqQixRQUFHLEdBQUgsR0FBRyxDQUFxQjtRQUN6QixjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQ3hCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFyQ3ZCOztXQUVHO1FBQzZCLDBCQUFxQixHQUFZLElBQUksQ0FBQztRQUN0RTs7V0FFRztRQUNLLG1CQUFjLEdBQVcsR0FBRyxDQUFDO1FBR3JDOztXQUVHO1FBQ0ssZ0JBQVcsR0FBVSxFQUFFLENBQUM7SUF5QjVCLENBQUM7SUF4Qkwsc0JBQWMsMENBQVc7YUFBekI7WUFDRSxNQUFNO1lBQ04sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRTtnQkFDckUsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQzthQUM5QjtZQUNELE1BQU07WUFDTixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsV0FBVyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUYsSUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVyQyxJQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFBWTtnQkFDOUMsT0FBTyxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNsRCxDQUFDOzs7T0FBQTtJQVlELG9DQUFRLEdBQVI7UUFDRSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixDQUFDO0lBQ0QsdUNBQVcsR0FBWCxVQUFZLE9BQXNCO1FBQ2hDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNmLENBQUM7SUFDRCx1Q0FBVyxHQUFYO1FBQ0UsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2hCLENBQUM7SUFDRDs7T0FFRztJQUNLLGlDQUFLLEdBQWI7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNkLE9BQU87U0FDUjtRQUNELElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pCLGVBQWU7UUFDZixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsSUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFVLGdDQUFnQyxFQUFFLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQztZQUMxSCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtnQkFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDM0IsYUFBYTtnQkFDYixJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2FBQ2pGO1lBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsMkJBQTJCLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtnQkFDL0YsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDL0I7WUFDRCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUM1QixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUM1QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztTQUMzQjthQUFNO1lBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQy9CLHdDQUF3QztZQUN4QywwREFBMEQ7WUFDMUQsd0RBQXdEO1lBQ3hELHNEQUFzRDtZQUN0RCxNQUFNO1lBQ04sbUNBQW1DO1lBQ25DLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLFVBQVUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDM0UsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUNsQjtZQUNELElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNmO0lBQ0gsQ0FBQztJQUNEOztPQUVHO0lBQ0ssNkNBQWlCLEdBQXpCO1FBQ0UsSUFBSSxJQUFJLENBQUMscUJBQXFCLEtBQUssS0FBSyxFQUFFO1lBQ3hDLE9BQU87U0FDUjtRQUNELElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDO1FBQzdELElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNyQixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQzlCO1NBQ0Y7YUFBTTtZQUNMLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ25ELElBQU0sWUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUMvQixJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztpQkFDdkI7Z0JBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBVSxDQUFDLENBQUM7YUFDdEM7U0FDRjtJQUNILENBQUM7SUFDRDs7T0FFRztJQUNLLGdEQUFvQixHQUE1QjtRQUFBLGlCQWlGQztRQWhGQyxJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLFVBQUMsQ0FBTTtZQUNoRSxJQUFJLENBQUMsQ0FBQyxFQUFFO2dCQUNOLE9BQU87YUFDUjtZQUNELElBQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDeEIsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBRTtnQkFDM0IsSUFBTSxnQkFBYyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztnQkFDdEQsSUFBSSxDQUFDLGdCQUFjLElBQUksQ0FBQyxnQkFBYyxDQUFDLFFBQVEsRUFBRTtvQkFDL0MsT0FBTztpQkFDUjtnQkFDRCxJQUFJLFdBQVMsR0FBRyxnQkFBYyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7Z0JBQ2xELElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLG1CQUFtQixJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLHNCQUFzQixJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLHNCQUFzQixJQUFJLGtCQUFrQixLQUFLLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLHFCQUFxQixLQUFLLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO29CQUNoUixJQUFNLFlBQVUsR0FBd0IsZ0JBQWMsQ0FBQyxRQUFRLENBQUM7b0JBQ2hFLElBQU0sT0FBTyxHQUFHLGdCQUFjLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQztvQkFDckQsSUFBSSxPQUFPLEVBQUU7d0JBQ1gsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFDLElBQVM7NEJBQzFCLFdBQVMsR0FBRyxnQkFBYyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7NEJBQzlDLElBQU0sT0FBTyxHQUFHLFlBQVUsQ0FBQyx1QkFBdUIsSUFBSSxLQUFJLENBQUMsY0FBYyxDQUFDOzRCQUMxRSxLQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxXQUFTLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO3dCQUN0RCxDQUFDLENBQUMsQ0FBQztxQkFDSjtvQkFDRCxJQUFNLGFBQWEsR0FBRyxnQkFBYyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUM7b0JBQzVELElBQUksYUFBYSxFQUFFO3dCQUNqQixhQUFhLENBQUMsU0FBUyxDQUFDLFVBQUMsTUFBVzs0QkFDbEMsSUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsZ0JBQWMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7NEJBQ3ZFLElBQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQzs0QkFDN0MsSUFBTSxPQUFPLEdBQUcsZ0JBQWMsQ0FBQyxNQUFNLElBQUksZ0JBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzRCQUNyRSxJQUFNLGVBQWUsR0FBRyxnQkFBYyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7NEJBQzFELElBQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQzs0QkFDaEIsSUFBSSxPQUFPLEVBQUU7Z0NBQ1gsSUFBTSxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7Z0NBQ3BELElBQUksZ0JBQWdCLEVBQUU7b0NBQ3BCLElBQU0sVUFBVSxHQUFXLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLElBQUssT0FBQSxJQUFJLEtBQUssT0FBTyxFQUFoQixDQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29DQUNwRyxJQUFJLFVBQVUsRUFBRTt3Q0FDZCxTQUFTLENBQUMsZUFBZSxDQUFDLEdBQUcsVUFBVSxDQUFDO3FDQUN6Qzt5Q0FBTTt3Q0FDTCxPQUFPLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQztxQ0FDbkM7aUNBQ0Y7Z0NBQ0QsSUFBTSxXQUFXLEdBQUcsS0FBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7Z0NBQy9DLEtBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7NkJBQ3RGOzRCQUNELDBEQUEwRDs0QkFDMUQsSUFBSSxTQUFTLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dDQUNsRCxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEtBQUs7b0NBQ25DLEtBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0NBQzVDLENBQUMsQ0FBQyxDQUFDO2dDQUNILEtBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQzs2QkFDM0M7d0JBQ0gsQ0FBQyxDQUFDLENBQUM7cUJBQ0o7aUJBQ0Y7Z0JBRUQsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxjQUFjLEVBQUU7b0JBQ3pDLGdCQUFjLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBQyxDQUFNO3dCQUNuRCxJQUFNLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7d0JBQy9ELElBQU0sV0FBVyxHQUF5QixnQkFBYyxDQUFDLFFBQVEsQ0FBQzt3QkFDbEUsV0FBUyxHQUFHLGdCQUFjLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQzt3QkFDOUMsSUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLFNBQVMsSUFBSSxLQUFJLENBQUMsY0FBYyxDQUFDO3dCQUM3RCxLQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxVQUFVLElBQUksRUFBRSxFQUFFLFdBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQ3RFLENBQUMsQ0FBQyxDQUFDO2lCQUNKO2dCQUNELElBQUksQ0FBQyxjQUFjLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxtQkFBbUIsRUFBRSxzQkFBc0IsRUFBRSxzQkFBc0IsRUFBRSxrQkFBa0IsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN4TCxJQUFJLGdCQUFjLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxnQkFBYyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFO3dCQUM1RSxnQkFBYyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDOzRCQUN0QyxLQUFJLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxXQUFTLENBQUMsQ0FBQzt3QkFDdEMsQ0FBQyxDQUFDLENBQUM7cUJBQ0o7aUJBQ0Y7Z0JBRUQsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxXQUFXLEVBQUU7b0JBQ3RDLElBQUksV0FBUyxFQUFFO3dCQUNiLGdCQUFjLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBQyxDQUFDOzRCQUM5QyxJQUFNLE9BQU8sR0FBRyxLQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQzs0QkFDM0MsS0FBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsV0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLGdCQUFjLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7d0JBQ2hJLENBQUMsQ0FBQyxDQUFDO3FCQUNKO2lCQUNGO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRDs7T0FFRztJQUNLLGdEQUFvQixHQUE1QjtRQUFBLGlCQWlCQztRQWhCQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxVQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU07WUFDdEQsSUFBSSxLQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsRUFBRSxFQUFFO2dCQUNwQyxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNsQjtZQUNELElBQUksS0FBSSxDQUFDLEdBQUcsRUFBRTtnQkFDWixlQUFlO2dCQUNmLElBQUksS0FBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtvQkFDM0MsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2xCO2FBQ0Y7WUFDRCxRQUFRO1lBQ1IsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUU7Z0JBQ2xDLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2xCO1lBQ0QsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEIsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUNEOztPQUVHO0lBQ0ssOENBQWtCLEdBQTFCO1FBQUEsaUJBTUM7UUFMQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsVUFBQyxLQUFVO1lBQzVGLElBQUEsZ0JBQXFFLEVBQW5FLGFBQWlCLEVBQWpCLHNDQUFpQixFQUFFLGNBQWtCLEVBQWxCLHVDQUFrQixFQUFFLGVBQVksRUFBWixpQ0FBNEIsQ0FBQztZQUM1RSxJQUFNLFlBQVksR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLEtBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDO1lBQ25FLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNEOztPQUVHO0lBQ0ssNkNBQWlCLEdBQXpCLFVBQTBCLEtBQVUsRUFBRSxNQUFXLEVBQUUsWUFBa0I7UUFDbkUsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE9BQU87U0FDUjtRQUNELElBQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQztRQUMxQyxxQkFBcUI7UUFFckIsSUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDM0MsUUFBUTtRQUNSLElBQU0sV0FBVyxHQUFHLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQztRQUN4RyxTQUFTO1FBQ1QsSUFBSSxpQkFBaUIsS0FBSyxNQUFNLEVBQUU7WUFDaEMsSUFBSSxNQUFNLFNBQUEsQ0FBQztZQUNYLElBQUksS0FBSyxFQUFFO2dCQUNULE1BQU0sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLENBQUM7YUFDekQ7aUJBQU07Z0JBQ0wsTUFBTSxHQUFHLEtBQUssQ0FBQzthQUNoQjtZQUNELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUNwRTthQUFNLElBQUksaUJBQWlCLEtBQUssVUFBVSxFQUFFO1lBQzNDLGdCQUFnQjtZQUNoQixtQ0FBbUM7WUFDbkMsSUFBSTtZQUNKLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNuRTthQUFNLElBQUksaUJBQWlCLEtBQUssUUFBUSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3pELElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO2dCQUN6QyxJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDbEU7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2FBQzNFO1NBQ0Y7YUFBTTtZQUNMLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNuRTtJQUNILENBQUM7SUFDTyw2Q0FBaUIsR0FBekIsVUFBMEIsWUFBaUIsRUFBRSxZQUFvQixFQUFFLEtBQVU7UUFDM0UsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUM7UUFDekMsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUMvQixPQUFPO1NBQ1I7UUFDRCxhQUFhO1FBQ2IsSUFBTSxhQUFhLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLElBQUssT0FBQSxJQUFJLEVBQUosQ0FBSSxDQUFDLENBQUM7UUFDckUsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDL0MscUJBQXFCO1FBQ3JCLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBZ0IsQ0FBQztRQUNuRSxVQUFVO1FBQ1YsSUFBSSxJQUFJLElBQUksWUFBWSxLQUFLLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxFQUFFO1lBQzdELElBQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDaEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDcEQsT0FBTztTQUNSO1FBQ0QsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNsQixPQUFPO1NBQ1I7UUFDRCxJQUFJLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzVCLGFBQWEsQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDekQ7YUFBTTtZQUNMLElBQUkscUJBQW1CLEdBQUcsSUFBSSxDQUFDO1lBQy9CLElBQU0sTUFBTSxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDaEUsSUFBTSxrQkFBa0IsR0FBRyxhQUFhLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNuRSxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTtnQkFDbEIscUJBQW1CLEdBQUcscUJBQW1CLElBQUkscUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hHLENBQUMsQ0FBQyxDQUFDO1lBQ0gsaUJBQWlCO1lBQ2pCLHFCQUFtQixDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ3JFO0lBQ0gsQ0FBQztJQUNPLGtDQUFNLEdBQWQ7UUFDRSxJQUFJLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxPQUFPLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLEtBQUssVUFBVSxFQUFFO1lBQzlGLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUMxQztRQUNELElBQUksSUFBSSxDQUFDLG1CQUFtQixJQUFJLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsS0FBSyxVQUFVLEVBQUU7WUFDMUYsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3hDO0lBQ0gsQ0FBQztJQUVELGdCQUFnQjtJQUVSLHlDQUFhLEdBQXJCLFVBQXNCLFFBQWEsRUFBRSxTQUFjLEVBQUUsT0FBd0IsRUFBRSxPQUFxQjtRQUFwRyxpQkFzREM7UUF0RG9ELHdCQUFBLEVBQUEsZUFBd0I7UUFBRSx3QkFBQSxFQUFBLGFBQXFCO1FBQ2xHLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDZCxPQUFPO1NBQ1I7UUFDRCxTQUFTO1FBQ1QsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO1FBQzFELFVBQVUsQ0FBQyx5QkFBeUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUU5QyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUMzQyxJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hDLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFcEUsSUFBSSxXQUFXLEdBQUcsV0FBVyxJQUFJLFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBQyxJQUFJLElBQUssT0FBQSxJQUFJLENBQUMsVUFBVSxFQUFmLENBQWUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNsRixJQUFNLGFBQWEsR0FBRyxXQUFXLElBQUksV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLElBQUksQ0FBQyxZQUFZLEVBQWpCLENBQWlCLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDeEYsS0FBSztRQUNMLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3pDLFdBQVcsb0JBQU8sSUFBSSxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUN4QyxVQUFVLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQztTQUM3RDtRQUVELElBQUksQ0FBQyxRQUFRLElBQUksT0FBTyxFQUFFO1lBQ3hCLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUN0QjtRQUNELFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFNO1lBQ3hCLElBQUksR0FBRyxHQUFRLEVBQUUsQ0FBQztZQUNsQixJQUFJLFFBQVEsRUFBRTtnQkFDWixJQUFJLFFBQVEsWUFBWSxLQUFLLEVBQUU7b0JBQzdCLEdBQUcsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQUMsQ0FBTTt3QkFDeEIsT0FBTyxLQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDN0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUNsQjtxQkFBTTtvQkFDTCxHQUFHLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7aUJBQ2xDO2FBQ0Y7WUFFRCxJQUFJLFFBQVEsR0FBVSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlDLElBQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUF6QixDQUF5QixDQUFDLENBQUM7WUFDdkUsSUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBMUIsQ0FBMEIsQ0FBQyxDQUFDO1lBQ3hFLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2IsUUFBUSxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3pEO2lCQUFNO2dCQUNMLFFBQVEsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUN6RDtZQUNELFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFPO2dCQUN2QixJQUFJLENBQUMsUUFBUSxFQUFFO29CQUNiLEtBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7aUJBQ2xGO3FCQUFNO29CQUNMLEtBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO2lCQUNyRjtZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxXQUFXO1FBQ1gsVUFBVSxDQUFDLHlCQUF5QixDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFTyxvQ0FBUSxHQUFoQixVQUFpQixDQUFTLEVBQUUsSUFBUztRQUNuQyxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDekIsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNmO2FBQU07WUFDTCxHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQztnQkFDN0IsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDZCxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDVjtRQUVELE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVPLCtDQUFtQixHQUEzQjtRQUNFLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1FBQ3hDLElBQUksSUFBSSxFQUFFO1lBQ1IsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsS0FBSyxFQUFFLEVBQVIsQ0FBUSxDQUFDLENBQUM7U0FDaEQ7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFTyx5Q0FBYSxHQUFyQixVQUFzQixLQUFLLEVBQUUsSUFBSTtRQUMvQixJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5QyxPQUFPLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsWUFBWTtJQUNaOzs7T0FHRztJQUNLLGtEQUFzQixHQUE5QixVQUErQixTQUFjLEVBQUUsWUFBc0I7UUFDbkUsSUFBSSxDQUFDLFNBQVMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkQsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELElBQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNuQiwyQkFBMkI7UUFDM0IsSUFBSTtZQUNGLElBQU0sZ0JBQWMsR0FBaUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQztZQUMzRixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEdBQVc7Z0JBQ3pDLElBQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEMsSUFBSSxRQUFRLElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxFQUFFO29CQUM1QyxJQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsRUFBRCxDQUFDLENBQUMsQ0FBQztvQkFDdEQsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQVk7d0JBQzVCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQzVCLElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOzRCQUMzQyxLQUFLLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzt5QkFDcEM7d0JBQ0QsSUFBTSxRQUFRLEdBQWlCLGdCQUFjLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQ3ZFLElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxZQUFZLElBQUksUUFBUSxDQUFDLFlBQVksQ0FBQyxPQUFPLEtBQUssSUFBSSxFQUFFOzRCQUMvRSxPQUFPLENBQUMsSUFBSSxDQUFDO2dDQUNYLFVBQVUsRUFBRSxHQUFHO2dDQUNmLFlBQVksRUFBRSxJQUFJOzZCQUNuQixDQUFDLENBQUM7eUJBQ0o7b0JBQ0gsQ0FBQyxDQUFDLENBQUM7aUJBQ0o7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ2xCO1FBQ0QsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUNPLG9DQUFRLEdBQWhCLFVBQWlCLE1BQWMsRUFBRSxLQUFlLEVBQUUsS0FBVTtRQUMxRCxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLEVBQUU7Z0JBQ3JCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7YUFDMUI7aUJBQU07Z0JBQ0wsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLEVBQUUsSUFBSTtvQkFDbkMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUU7d0JBQzFFLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7cUJBQ2pCO29CQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNwQixDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7YUFDN0M7U0FDRjtJQUNILENBQUM7SUFDTyw0Q0FBZ0IsR0FBeEIsVUFBeUIsSUFBYyxFQUFFLFdBQXFCO1FBQzVELElBQUksQ0FBQyxXQUFXLElBQUksV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdEUsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELGFBQWE7UUFDYixJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBeEIsQ0FBd0IsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQzs7Z0JBeGNGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsNEJBQTRCO2lCQUN2Qzs7OztnQkFaQyxXQUFXO2dCQUFlLFNBQVM7Z0JBRTVCLGlCQUFpQjtnQkFFakIscUJBQXFCO2dCQVJtQyxRQUFRO2dCQVNoRSxtQkFBbUI7Z0JBQ25CLGFBQWE7Z0JBVnFELE1BQU07OzsrQkFxQjlFLEtBQUssU0FBQywwQkFBMEI7d0NBSWhDLEtBQUssU0FBQyx1QkFBdUI7O0lBOGJoQyx3QkFBQztDQUFBLEFBemNELElBeWNDO1NBdGNZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLCBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSW5qZWN0b3IsIE5nWm9uZSxcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgb2YsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1xyXG4gIEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgVmlld01vZGVsLCBEYXRhVHlwZUluZm8sIERhdGFQcm9wSW5mbywgRU5BQkxFX0VESVRfU1RBVEVfRklMVEVSX1NPUlRJTkdcclxufSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IGlzTnVtYmVyIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vZGF0ZSc7XHJcbmltcG9ydCB7IFJ1bnRpbWVTdGF0ZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IENvbWJvTG9va3VwQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1jb21iby1sb29rdXAnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzLWRhdGFncmlkLWVkaXRhYmxlXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEVkaXRhYmxlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgLyoqXHJcbiAgICogZ3JpZOaYr+WQpuWPr+S7pee8lui+kVxyXG4gICAqL1xyXG4gIEBJbnB1dCgnZmFycmlzLWRhdGFncmlkLWVkaXRhYmxlJykgZ3JpZEVkaXRhYmxlOiBib29sZWFuO1xyXG4gIC8qKlxyXG4gICAqIOe8lui+keaXtuWPlua2iOWIhue7hFxyXG4gICAqL1xyXG4gIEBJbnB1dCgnZGlzYWJsZUdyb3VwT25FZGl0aW5nJykgZGlzYWJsZUdyb3VwT25FZGl0aW5nOiBib29sZWFuID0gdHJ1ZTtcclxuICAvKipcclxuICAgKiDlpJrpgInluK7liqnpu5jorqTliIbpmpTnrKZcclxuICAgKi9cclxuICBwcml2YXRlIGRlZmF1bHRTcGxpdGVyOiBzdHJpbmcgPSAnLCc7XHJcbiAgcHJpdmF0ZSBiZWdpbkVkaXRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIGVuZEVkaXRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAvKipcclxuICAgKiDkuLTml7borrDlvZVncmlk5YiG57uE5a2X5q61XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBncm91cEZpZWxkczogYW55W10gPSBbXTtcclxuICBwcm90ZWN0ZWQgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIC8vIOagueWunuS9k1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycgfHwgIXRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgICB9XHJcbiAgICAvLyDlrZDlrp7kvZNcclxuICAgIGxldCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLnN1YnN0cigxKTtcclxuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhbMF0udG9Mb3dlckNhc2UoKSArIGJpbmRpbmdQYXRoLnN1YnN0cmluZygxLCBiaW5kaW5nUGF0aC5sZW5ndGgpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG5cclxuICAgIGNvbnN0IGZpbHRlcmVkUGF0aHMgPSBwYXRocy5maWx0ZXIoKHBhcnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICByZXR1cm4gcGFydCAhPT0gJyc7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGZpbHRlcmVkUGF0aHMpO1xyXG4gIH1cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsXHJcbiAgICBwdWJsaWMgdmlld01vZGVsOiBWaWV3TW9kZWwsXHJcbiAgICBwdWJsaWMgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQsXHJcbiAgICBwcml2YXRlIGRhdGVTZXJ2aWNlOiBEYXRlVGltZUhlbHBlclNlcnZpY2UsXHJcbiAgICBwdWJsaWMgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBydHM6IFJ1bnRpbWVTdGF0ZVNlcnZpY2UsXHJcbiAgICBwdWJsaWMgZGlhbG9nU2VyOiBEaWFsb2dTZXJ2aWNlLFxyXG4gICAgcHVibGljIG5nWm9uZTogTmdab25lXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmFwcGx5KCk7XHJcbiAgfVxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIHRoaXMuYXBwbHkoKTtcclxuICB9XHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLmRldGFjaCgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlupTnlKjlsZ7mgKdcclxuICAgKi9cclxuICBwcml2YXRlIGFwcGx5KCkge1xyXG4gICAgaWYgKCF0aGlzLmdyaWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5oYW5kbGVHcm91cFN0YXR1cygpO1xyXG4gICAgLy8g5piv5ZCm5ZCv55So5LqG57yW6L6R5oCB6L+H5ruk5o6S5bqPXHJcbiAgICBpZiAodGhpcy5ncmlkRWRpdGFibGUpIHtcclxuICAgICAgY29uc3QgZW5hYmxlRmlsdGVyU29ydGluZyA9IHRoaXMuaW5qZWN0b3IgJiYgdGhpcy5pbmplY3Rvci5nZXQ8Ym9vbGVhbj4oRU5BQkxFX0VESVRfU1RBVEVfRklMVEVSX1NPUlRJTkcsIGZhbHNlKSB8fCBmYWxzZTtcclxuICAgICAgaWYgKCF0aGlzLmdyaWQucmVtb3RlRmlsdGVyICYmICFlbmFibGVGaWx0ZXJTb3J0aW5nKSB7XHJcbiAgICAgICAgdGhpcy5ncmlkLmNsZWFyQ29uZGl0aW9uKCk7XHJcbiAgICAgICAgLy8g5Y+R6YCB5riF56m66L+H5ruk5p2h5Lu25LqL5Lu2XHJcbiAgICAgICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQubWVzc2FnZVBpcGUubmV4dCgnQ0xFQVJfR1JJRF9DT05ESVRJT04nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5ncmlkLmVkaXRhYmxlID0gdHJ1ZTtcclxuICAgICAgaWYgKCF0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5lbmFibGVHcmlkSGVhZGVyV2hlbkVkaXRpbmcgJiYgIWVuYWJsZUZpbHRlclNvcnRpbmcpIHtcclxuICAgICAgICB0aGlzLmdyaWQuZGlzYWJsZUhlYWRlcih0cnVlKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmhhbmRsZUJlZ2luRWRpdEV2ZW50KCk7XHJcbiAgICAgIHRoaXMuaGFuZGxlQWZ0ZXJFZGl0RXZlbnQoKTtcclxuICAgICAgdGhpcy5oYW5kbGVFbmRFZGl0RXZlbnQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5lZGl0YWJsZSA9IGZhbHNlO1xyXG4gICAgICB0aGlzLmdyaWQuZGlzYWJsZUhlYWRlcihmYWxzZSk7XHJcbiAgICAgIC8vIFRPRE865bqU55Sx6KGo5qC85YW85a6577yM5L2G55uu5YmN6KGl5LiB5LiN6IO957un57ut5L6d6LWW6KGo5qC857uE5Lu277yM5Li05pe25L2/55So6K+l5pa55qGI5aSE55CGXHJcbiAgICAgIC8vIDIwMjMtMTItMjUg6KGo5qC85YaF6YOo5bey6Kej5Yaz5YiX6K6+572u5ZCO6KGo5aS05peg5rOV5ouW5Yqo6Zeu6aKY77yM5LiU5YW85a655Luj56CB5a2Y5Zyo6KaG55uW5byA5Y+R6ICF6K6+572u55qE6Ieq5a6a5LmJ5YiX5ZCN56ew55qE6Zeu6aKYXHJcbiAgICAgIC8vIHRoaXMuZ3JpZC5jb2x1bW5zID0gdGhpcy5ncmlkLmNvbHVtbnMubWFwKChjb2xzKSA9PiB7XHJcbiAgICAgIC8vICAgcmV0dXJuIGNvbHMubWFwKChjb2wpID0+IE9iamVjdC5hc3NpZ24oe30sIGNvbCkpO1xyXG4gICAgICAvLyB9KTtcclxuICAgICAgLy8gdGhpcy5ncmlkLmNvbHVtbnNDaGFuZ2VkKGZhbHNlKTtcclxuICAgICAgaWYgKHRoaXMuZ3JpZCAmJiB0eXBlb2YgdGhpcy5ncmlkLnNvcnQgPT09ICdmdW5jdGlvbicgJiYgdGhpcy5ncmlkLnNvcnROYW1lKSB7XHJcbiAgICAgICAgdGhpcy5ncmlkLnNvcnQoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRldGFjaCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDnvJbovpHml7blj5bmtojliIbnu4RcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZUdyb3VwU3RhdHVzKCkge1xyXG4gICAgaWYgKHRoaXMuZGlzYWJsZUdyb3VwT25FZGl0aW5nID09PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBncm91cEZpZWxkID0gdGhpcy5ncmlkICYmIHRoaXMuZ3JpZC5ncm91cEZpZWxkIHx8IG51bGw7XHJcbiAgICBpZiAoZ3JvdXBGaWVsZCkge1xyXG4gICAgICBpZiAodGhpcy5ncmlkRWRpdGFibGUpIHtcclxuICAgICAgICB0aGlzLmdyb3VwRmllbGRzID0gW2dyb3VwRmllbGRdO1xyXG4gICAgICAgIHRoaXMuZ3JpZC5zZXRHcm91cEZpZWxkcygnJyk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0aGlzLmdyb3VwRmllbGRzICYmIHRoaXMuZ3JvdXBGaWVsZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGdyb3VwRmllbGQgPSB0aGlzLmdyb3VwRmllbGRzLnBvcCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmdyb3VwRmllbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMuZ3JvdXBGaWVsZHMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ncmlkLnNldEdyb3VwRmllbGRzKGdyb3VwRmllbGQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuW8gOWni+e8lui+keS6i+S7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFuZGxlQmVnaW5FZGl0RXZlbnQoKSB7XHJcbiAgICB0aGlzLmJlZ2luRWRpdFN1YnNjcmlwdGlvbiA9IHRoaXMuZ3JpZC5iZWdpbkVkaXQuc3Vic2NyaWJlKChlOiBhbnkpID0+IHtcclxuICAgICAgaWYgKCFlKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGNvbHVtbiA9IGUuY29sdW1uO1xyXG4gICAgICBpZiAoY29sdW1uICYmIGNvbHVtbi5lZGl0b3IpIHtcclxuICAgICAgICBjb25zdCBlZGl0b3JJbnN0YW5jZSA9IGUuZWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgICBpZiAoIWVkaXRvckluc3RhbmNlIHx8ICFlZGl0b3JJbnN0YW5jZS5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbWFwRmllbGRzID0gZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2UubWFwRmllbGRzO1xyXG4gICAgICAgIGlmIChjb2x1bW4uZWRpdG9yLnR5cGUgPT09ICdsb29rdXAnIHx8IGNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ1BlcnNvbm5lbFNlbGVjdG9yJyB8fCBjb2x1bW4uZWRpdG9yLnR5cGUgPT09ICdPcmdhbml6YXRpb25TZWxlY3RvcicgfHwgY29sdW1uLmVkaXRvci50eXBlID09PSAnZXh0ZXJuYWwtaW50ZWdyYXRpb24nIHx8ICdFbXBsb3llZVNlbGVjdG9yJyA9PT0gY29sdW1uLmVkaXRvci50eXBlIHx8ICdFbXBsb3llZU9yZ1NlbGVjdG9yJyA9PT0gY29sdW1uLmVkaXRvci50eXBlKSB7XHJcbiAgICAgICAgICBjb25zdCBsb29rdXBHcmlkOiBMb29rdXBHcmlkQ29tcG9uZW50ID0gZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2U7XHJcbiAgICAgICAgICBjb25zdCBzdWJqZWN0ID0gZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2Uuc2VsZWN0ZWREYXRhO1xyXG4gICAgICAgICAgaWYgKHN1YmplY3QpIHtcclxuICAgICAgICAgICAgc3ViamVjdC5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIG1hcEZpZWxkcyA9IGVkaXRvckluc3RhbmNlLmluc3RhbmNlLm1hcEZpZWxkcztcclxuICAgICAgICAgICAgICBjb25zdCBzcGxpdGVyID0gbG9va3VwR3JpZC5tdWx0aXBsZUNob2ljZVNlcGFyYXRvciB8fCB0aGlzLmRlZmF1bHRTcGxpdGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMubG9va3VwTWFwcGluZyhkYXRhLCBtYXBGaWVsZHMsIGZhbHNlLCBzcGxpdGVyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBjbGVhck1hcHBpbmdzID0gZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2UuY2xlYXJNYXBwaW5ncztcclxuICAgICAgICAgIGlmIChjbGVhck1hcHBpbmdzKSB7XHJcbiAgICAgICAgICAgIGNsZWFyTWFwcGluZ3Muc3Vic2NyaWJlKChyZXN1bHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IG1hcEZpZWxkcyA9IE9iamVjdC5hc3NpZ24oe30sIGVkaXRvckluc3RhbmNlLmluc3RhbmNlLm1hcEZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSByZXN1bHQgJiYgcmVzdWx0LnZhbHVlIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgY29uc3QgYmluZGluZyA9IGVkaXRvckluc3RhbmNlLmNvbHVtbiAmJiBlZGl0b3JJbnN0YW5jZS5jb2x1bW4uZmllbGQ7XHJcbiAgICAgICAgICAgICAgY29uc3QgbG9va3VwVGV4dEZpZWxkID0gZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2UudGV4dEZpZWxkO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7fTtcclxuICAgICAgICAgICAgICBpZiAoYmluZGluZykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dEZpZWxkTWFwcGluZyA9IG1hcEZpZWxkc1tsb29rdXBUZXh0RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRleHRGaWVsZE1hcHBpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJGaWVsZDogc3RyaW5nID0gdGV4dEZpZWxkTWFwcGluZy5zcGxpdCgnLCcpLmZpbHRlcigoaXRlbSkgPT4gaXRlbSAhPT0gYmluZGluZykuam9pbignLCcpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAob3RoZXJGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcEZpZWxkc1tsb29rdXBUZXh0RmllbGRdID0gb3RoZXJGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgbWFwRmllbGRzW2xvb2t1cFRleHRGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGhzID0gdGhpcy5nZXRCaW5kaW5nUGF0aEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFZhbHVlKHBhcmVudFBhdGhzLmNvbmNhdChiaW5kaW5nLnNwbGl0KCcuJykpLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIC8vIHRoaXMuc2V0VmFsdWUoZGF0YSwgbG9va3VwVGV4dEZpZWxkLnNwbGl0KCcuJyksIHZhbHVlKTtcclxuICAgICAgICAgICAgICBpZiAobWFwRmllbGRzICYmIE9iamVjdC5rZXlzKG1hcEZpZWxkcykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobWFwRmllbGRzKS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKGRhdGEsIGZpZWxkLnNwbGl0KCcuJyksICcnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb29rdXBNYXBwaW5nKGRhdGEsIG1hcEZpZWxkcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb2x1bW4uZWRpdG9yLnR5cGUgPT09ICdjb21iby1sb29rdXAnKSB7XHJcbiAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5pbnN0YW5jZS52YWx1ZUNoYW5nZS5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBhc0NsZWFyID0gZSAmJiBlLnNlbGVjdGlvbnMgJiYgZS5zZWxlY3Rpb25zLmxlbmd0aCA9PT0gMDtcclxuICAgICAgICAgICAgY29uc3QgY29tYm9Mb29rdXA6IENvbWJvTG9va3VwQ29tcG9uZW50ID0gZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2U7XHJcbiAgICAgICAgICAgIG1hcEZpZWxkcyA9IGVkaXRvckluc3RhbmNlLmluc3RhbmNlLm1hcEZpZWxkcztcclxuICAgICAgICAgICAgY29uc3Qgc3BsaXRlciA9IGNvbWJvTG9va3VwLnNlcGFyYXRvciB8fCB0aGlzLmRlZmF1bHRTcGxpdGVyO1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cE1hcHBpbmcoZS5zZWxlY3Rpb25zIHx8IFtdLCBtYXBGaWVsZHMsIGFzQ2xlYXIsIHNwbGl0ZXIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChbJ2NvbWJvLWxvb2t1cCcsICdjb21ib2xpc3QnLCAnbG9va3VwJywgJ1BlcnNvbm5lbFNlbGVjdG9yJywgJ09yZ2FuaXphdGlvblNlbGVjdG9yJywgJ2V4dGVybmFsLWludGVncmF0aW9uJywgJ0VtcGxveWVlU2VsZWN0b3InLCAnRW1wbG95ZWVPcmdTZWxlY3RvciddLmluY2x1ZGVzKGNvbHVtbi5lZGl0b3IudHlwZSkpIHtcclxuICAgICAgICAgIGlmIChlZGl0b3JJbnN0YW5jZS5pbnN0YW5jZS5jbGVhciAmJiBlZGl0b3JJbnN0YW5jZS5pbnN0YW5jZS5jbGVhci5zdWJzY3JpYmUpIHtcclxuICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2UuaW5zdGFuY2UuY2xlYXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmxvb2t1cE1hcHBpbmcobnVsbCwgbWFwRmllbGRzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY29sdW1uLmVkaXRvci50eXBlID09PSAnY29tYm9saXN0Jykge1xyXG4gICAgICAgICAgaWYgKG1hcEZpZWxkcykge1xyXG4gICAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5pbnN0YW5jZS52YWx1ZUNoYW5nZS5zdWJzY3JpYmUoKGUpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBwYXRoQXJyID0gdGhpcy5nZXRCaW5kaW5nUGF0aEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEuc2V0VmFsdWUocGF0aEFyci5jb25jYXQobWFwRmllbGRzLnNwbGl0KCcuJykpLCBlZGl0b3JJbnN0YW5jZS5pbnN0YW5jZS5zZWxlY3RlZFZhbHVlcywgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhue8lui+keS6i+S7tlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFuZGxlQWZ0ZXJFZGl0RXZlbnQoKSB7XHJcbiAgICB0aGlzLmdyaWQuYWZ0ZXJFZGl0ID0gKHJvd0luZGV4LCByb3dEYXRhLCBjb2x1bW4sIGVkaXRvcikgPT4ge1xyXG4gICAgICBpZiAodGhpcy5kaWFsb2dTZXIuaGFzRGlhbG9nT3BlbmVkKCkpIHtcclxuICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLnJ0cykge1xyXG4gICAgICAgIC8vIOW4ruWKqee7hOS7tuaWh+acrOWPmOWMluWQjuWOu+afpeivolxyXG4gICAgICAgIGlmICh0aGlzLnJ0cy5nZXRGb3JtU3RhdGUoJ2xvb2t1cC5wZW5kaW5nJykpIHtcclxuICAgICAgICAgIHJldHVybiBvZihmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIOabtOaWsOaVsOaNrua6kFxyXG4gICAgICBpZiAoIWVkaXRvciB8fCAhZWRpdG9yLmZvcm1Db250cm9sKSB7XHJcbiAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlpITnkIbnu5PmnZ/nvJbovpHkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZUVuZEVkaXRFdmVudCgpIHtcclxuICAgIHRoaXMuZW5kRWRpdFN1YnNjcmlwdGlvbiA9IHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWQuZW5kRWRpdCAmJiB0aGlzLmdyaWQuZW5kRWRpdC5zdWJzY3JpYmUoKGV2ZW50OiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgeyB2YWx1ZSA9IHVuZGVmaW5lZCwgY29sdW1uID0gdW5kZWZpbmVkLCByb3dEYXRhID0ge30gfSA9IGV2ZW50IHx8IHt9O1xyXG4gICAgICBjb25zdCBwcmltYXJ5VmFsdWUgPSByb3dEYXRhICYmIHJvd0RhdGFbdGhpcy5ncmlkLmlkRmllbGRdIHx8IG51bGw7XHJcbiAgICAgIHRoaXMudXBkYXRlQmluZGluZ0RhdGEodmFsdWUsIGNvbHVtbiwgcHJpbWFyeVZhbHVlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKlxyXG4gICAqIOe7meWIl+ihqOi1i+WAvCDmiJbnu5lmb3JtY29udHJvbOi1i+WAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlQmluZGluZ0RhdGEodmFsdWU6IGFueSwgY29sdW1uOiBhbnksIHByaW1hcnlWYWx1ZT86IGFueSkge1xyXG4gICAgaWYgKCFjb2x1bW4pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY3VycmVudENvbHVtblR5cGUgPSBjb2x1bW4uZGF0YVR5cGU7XHJcbiAgICAvLyDlkIzml7bliKTmlq1ncmlkT3B0aW9u55qE5YiX5a+56LGhXHJcblxyXG4gICAgY29uc3QgZmllbGRQYXRocyA9IGNvbHVtbi5maWVsZC5zcGxpdCgnLicpO1xyXG4gICAgLy8g5piv5ZCm5Li65aSn5pWwXHJcbiAgICBjb25zdCBpc0JpZ051bWJlciA9IGNvbHVtbiAmJiBjb2x1bW4uZWRpdG9yICYmIGNvbHVtbi5lZGl0b3Iub3B0aW9ucyAmJiBjb2x1bW4uZWRpdG9yLm9wdGlvbnMuYmlnTnVtYmVyO1xyXG4gICAgLy8g5a2Y5Zyo6KGM57yW6L6R5ZmoXHJcbiAgICBpZiAoY3VycmVudENvbHVtblR5cGUgPT09ICdkYXRlJykge1xyXG4gICAgICBsZXQgcmVzdWx0O1xyXG4gICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICByZXN1bHQgPSB0aGlzLmRhdGVTZXJ2aWNlLmZvcm1hdFRvKHZhbHVlLCAneXl5eS1NTS1kZCcpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdCA9IHZhbHVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudXBkYXRlQmluZGluZ0xpc3QocHJpbWFyeVZhbHVlLCBmaWVsZFBhdGhzLmpvaW4oJy4nKSwgcmVzdWx0KTtcclxuICAgIH0gZWxzZSBpZiAoY3VycmVudENvbHVtblR5cGUgPT09ICdkYXRldGltZScpIHtcclxuICAgICAgLy8gaWYgKCF2YWx1ZSkge1xyXG4gICAgICAvLyAgIHZhbHVlID0gJzAwMDEtMDEtMDFUMDA6MDA6MDAnO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIHRoaXMudXBkYXRlQmluZGluZ0xpc3QocHJpbWFyeVZhbHVlLCBmaWVsZFBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmIChjdXJyZW50Q29sdW1uVHlwZSA9PT0gJ251bWJlcicgJiYgIWlzQmlnTnVtYmVyKSB7XHJcbiAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVCaW5kaW5nTGlzdChwcmltYXJ5VmFsdWUsIGZpZWxkUGF0aHMuam9pbignLicpLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJpbmRpbmdMaXN0KHByaW1hcnlWYWx1ZSwgZmllbGRQYXRocy5qb2luKCcuJyksIE51bWJlcih2YWx1ZSkpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnVwZGF0ZUJpbmRpbmdMaXN0KHByaW1hcnlWYWx1ZSwgZmllbGRQYXRocy5qb2luKCcuJyksIHZhbHVlKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVCaW5kaW5nTGlzdChwcmltYXJ5VmFsdWU6IGFueSwgcHJvcGVydHlOYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgIGNvbnN0IHZpZXdNb2RlbCA9IHRoaXMudmlld01vZGVsIHx8IG51bGw7XHJcbiAgICBpZiAoIXZpZXdNb2RlbCB8fCAhcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOabtOaWsOS4u+ihqOmDqOWIhuihjOeahOWtl+autVxyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lcyA9IHByb3BlcnR5TmFtZS5zcGxpdCgnLicpLmZpbHRlcigoaXRlbSkgPT4gaXRlbSk7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMuZ2V0QmluZGluZ1BhdGhBcnJheSgpO1xyXG4gICAgLy8g5Y+W5Ye65p2l55qE5LiA5a6a5pivYmluZGluZ0xpc3RcclxuICAgIGNvbnN0IGxpc3QgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRoKSBhcyBCaW5kaW5nTGlzdDtcclxuICAgIC8vIOS/ruaUueeahOaYr+W9k+WJjeihjFxyXG4gICAgaWYgKGxpc3QgJiYgcHJpbWFyeVZhbHVlID09PSBsaXN0LmN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZSkge1xyXG4gICAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLmNvbmNhdChwcm9wZXJ0eU5hbWVzKTtcclxuICAgICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRocywgdmFsdWUsIHRydWUsIHRydWUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nTGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xyXG4gICAgaWYgKCFiaW5kaW5nT2JqZWN0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChwcm9wZXJ0eU5hbWVzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCB0YXJnZXRCaW5kaW5nT2JqZWN0ID0gbnVsbDtcclxuICAgICAgY29uc3QgZnBhdGhzID0gcHJvcGVydHlOYW1lcy5zbGljZSgwLCBwcm9wZXJ0eU5hbWVzLmxlbmd0aCAtIDEpO1xyXG4gICAgICBjb25zdCB0YXJnZXRQcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWVzW3Byb3BlcnR5TmFtZXMubGVuZ3RoIC0gMV07XHJcbiAgICAgIGZwYXRocy5mb3JFYWNoKChwcm9wKSA9PiB7XHJcbiAgICAgICAgdGFyZ2V0QmluZGluZ09iamVjdCA9IHRhcmdldEJpbmRpbmdPYmplY3QgJiYgdGFyZ2V0QmluZGluZ09iamVjdFtwcm9wXSB8fCBiaW5kaW5nT2JqZWN0W3Byb3BdO1xyXG4gICAgICB9KTtcclxuICAgICAgLy8gdG9kbzrpnIDopoHmt7vliqDlgLzlj5jljJbkuovku7ZcclxuICAgICAgdGFyZ2V0QmluZGluZ09iamVjdC5zZXRWYWx1ZSh0YXJnZXRQcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBkZXRhY2goKSB7XHJcbiAgICBpZiAodGhpcy5iZWdpbkVkaXRTdWJzY3JpcHRpb24gJiYgdHlwZW9mIHRoaXMuYmVnaW5FZGl0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuYmVnaW5FZGl0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5lbmRFZGl0U3Vic2NyaXB0aW9uICYmIHR5cGVvZiB0aGlzLmVuZEVkaXRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5lbmRFZGl0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyNyZWdpb24g5biu5Yqp5a2X5q615pig5bCEXHJcblxyXG4gIHByaXZhdGUgbG9va3VwTWFwcGluZyhoZWxwRGF0YTogYW55LCBtYXBGaWVsZHM6IGFueSwgYXNDbGVhcjogYm9vbGVhbiA9IGZhbHNlLCBzcGxpdGVyOiBzdHJpbmcgPSAnLCcpIHtcclxuICAgIGlmICghbWFwRmllbGRzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOWFs+mXreWPmOabtOajgOa1i1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0O1xyXG4gICAgYXBwQ29udGV4dC5jaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyLmRldGFjaCgpO1xyXG5cclxuICAgIGNvbnN0IHBhdGhBcnIgPSB0aGlzLmdldEJpbmRpbmdQYXRoQXJyYXkoKTtcclxuICAgIGxldCBoZWxwRmllbGRzID0gT2JqZWN0LmtleXMobWFwRmllbGRzKTtcclxuICAgIGNvbnN0IHByaW1hcnlJbmZvID0gdGhpcy5nZXRNYXBGaWVsZHNQcmltYXJ5S2V5KG1hcEZpZWxkcywgcGF0aEFycik7XHJcblxyXG4gICAgbGV0IHByaW1hcnlLZXlzID0gcHJpbWFyeUluZm8gJiYgcHJpbWFyeUluZm8ubWFwKChpdGVtKSA9PiBpdGVtLnByaW1hcnlLZXkpIHx8IFtdO1xyXG4gICAgY29uc3QgcHJpbWFyeUZpZWxkcyA9IHByaW1hcnlJbmZvICYmIHByaW1hcnlJbmZvLm1hcCgoaXRlbSkgPT4gaXRlbS5wcmltYXJ5RmllbGQpIHx8IFtdO1xyXG4gICAgLy8g5Y676YeNXHJcbiAgICBpZiAocHJpbWFyeUtleXMgJiYgcHJpbWFyeUtleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBwcmltYXJ5S2V5cyA9IFsuLi5uZXcgU2V0KHByaW1hcnlLZXlzKV07XHJcbiAgICAgIGhlbHBGaWVsZHMgPSB0aGlzLnNvcnRNYXBGaWVsZEtleXMoaGVscEZpZWxkcywgcHJpbWFyeUtleXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghaGVscERhdGEgfHwgYXNDbGVhcikge1xyXG4gICAgICBoZWxwRmllbGRzLnJldmVyc2UoKTtcclxuICAgIH1cclxuICAgIGhlbHBGaWVsZHMuZm9yRWFjaCgoZjogYW55KSA9PiB7XHJcbiAgICAgIGxldCB2YWw6IGFueSA9ICcnO1xyXG4gICAgICBpZiAoaGVscERhdGEpIHtcclxuICAgICAgICBpZiAoaGVscERhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgdmFsID0gaGVscERhdGEubWFwKChoOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoZiwgaCk7XHJcbiAgICAgICAgICB9KS5qb2luKHNwbGl0ZXIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB2YWwgPSB0aGlzLmdldFZhbHVlKGYsIGhlbHBEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBtYXBwaW5nczogYW55W10gPSBtYXBGaWVsZHNbZl0uc3BsaXQoJywnKTtcclxuICAgICAgY29uc3QgaGVhZE1hcHBpbmdzID0gbWFwcGluZ3MuZmlsdGVyKChwKSA9PiBwcmltYXJ5RmllbGRzLmluY2x1ZGVzKHApKTtcclxuICAgICAgY29uc3QgbGVmdE1hcHBpbmdzID0gbWFwcGluZ3MuZmlsdGVyKChwKSA9PiAhcHJpbWFyeUZpZWxkcy5pbmNsdWRlcyhwKSk7XHJcbiAgICAgIGlmICghaGVscERhdGEpIHtcclxuICAgICAgICBtYXBwaW5ncyA9IFtdLmNvbmNhdChsZWZ0TWFwcGluZ3MpLmNvbmNhdChoZWFkTWFwcGluZ3MpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1hcHBpbmdzID0gW10uY29uY2F0KGhlYWRNYXBwaW5ncykuY29uY2F0KGxlZnRNYXBwaW5ncyk7XHJcbiAgICAgIH1cclxuICAgICAgbWFwcGluZ3MuZm9yRWFjaCgoZmY6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICghaGVscERhdGEpIHtcclxuICAgICAgICAgIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmNsZWFyVmFsdWUocGF0aEFyci5jb25jYXQoZmYuc3BsaXQoJy4nKSksIHRydWUsIHRydWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRoQXJyLmNvbmNhdChmZi5zcGxpdCgnLicpKSwgdmFsLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6YeN5paw5omT5byA5Y+Y5pu05qOA5rWLXHJcbiAgICBhcHBDb250ZXh0LmNoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIucmVhdHRhY2goKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0VmFsdWUoZjogc3RyaW5nLCBkYXRhOiBhbnkpIHtcclxuICAgIGxldCB2YWwgPSAnJztcclxuICAgIGlmIChmLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgdmFsID0gZGF0YVtmXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhbCA9IGYuc3BsaXQoJy4nKS5yZWR1Y2UoKGEsIGIpID0+IHtcclxuICAgICAgICByZXR1cm4gYVtiXTtcclxuICAgICAgfSwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHZhbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QmluZGluZ1BhdGhBcnJheSgpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBwYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBpZiAocGF0aCkge1xyXG4gICAgICByZXR1cm4gcGF0aC5zcGxpdCgnLycpLmZpbHRlcigobikgPT4gbiAhPT0gJycpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc051bWJlclZhbHVlKGZpZWxkLCBkYXRhKSB7XHJcbiAgICBjb25zdCBjdXJyZW50VmFsID0gdGhpcy5nZXRWYWx1ZShmaWVsZCwgZGF0YSk7XHJcbiAgICByZXR1cm4gaXNOdW1iZXIoY3VycmVudFZhbCk7XHJcbiAgfVxyXG5cclxuICAvLyNlbmRyZWdpb25cclxuICAvKipcclxuICAgKlxyXG4gICAqIEBwYXJhbSBtYXBGaWVsZHMgIOagvOW8j+W9ouWmgu+8mntpZDogXCJhc3NvRmllbGQuYXNzb0ZpZWxkXCIsIGNvZGU6IFwiYXNzb0ZpZWxkLmFzc29GaWVsZF9Db2RlXCIsIG5hbWU6IFwiYXNzb0ZpZWxkLmFzc29GaWVsZF9OYW1lXCJ9IOaIluiAhSB7aWQ6J3ZpZCcsY29kZTonY29kZScsbmFtZTonbmFtZSd9XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRNYXBGaWVsZHNQcmltYXJ5S2V5KG1hcEZpZWxkczogYW55LCBiaW5kaW5nUGF0aHM6IHN0cmluZ1tdKTogQXJyYXk8eyBwcmltYXJ5S2V5OiBzdHJpbmcsIHByaW1hcnlGaWVsZDogc3RyaW5nIH0+IHtcclxuICAgIGlmICghbWFwRmllbGRzIHx8IE9iamVjdC5rZXlzKG1hcEZpZWxkcykubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcclxuICAgIC8vIGxldCBwcmltYXJ5RmllbGQgPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZW50aXR5VHlwZUluZm86IERhdGFUeXBlSW5mbyA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvO1xyXG4gICAgICBPYmplY3Qua2V5cyhtYXBGaWVsZHMpLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWFwRmllbGQgPSBtYXBGaWVsZHNba2V5XTtcclxuICAgICAgICBpZiAobWFwRmllbGQgJiYgdHlwZW9mIG1hcEZpZWxkID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgY29uc3QgbWFwcGluZ3MgPSBtYXBGaWVsZC5zcGxpdCgnLCcpLmZpbHRlcigocCkgPT4gcCk7XHJcbiAgICAgICAgICBtYXBwaW5ncy5mb3JFYWNoKChpdGVtOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgbGV0IHBhdGhzID0gaXRlbS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBpZiAoYmluZGluZ1BhdGhzICYmIGJpbmRpbmdQYXRocy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgcGF0aHMgPSBiaW5kaW5nUGF0aHMuY29uY2F0KHBhdGhzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwcm9wSW5mbzogRGF0YVByb3BJbmZvID0gZW50aXR5VHlwZUluZm8uZ2V0UHJvcEluZm9CeVBhdGgocGF0aHMpO1xyXG4gICAgICAgICAgICBpZiAocHJvcEluZm8gJiYgcHJvcEluZm8ubWV0YWRhdGFJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mby5wcmltYXJ5ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHByaW1hcnlLZXk6IGtleSxcclxuICAgICAgICAgICAgICAgIHByaW1hcnlGaWVsZDogaXRlbVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgfVxyXG4gIHByaXZhdGUgc2V0VmFsdWUodGFyZ2V0OiBvYmplY3QsIHBhdGhzOiBzdHJpbmdbXSwgdmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHRhcmdldCkge1xyXG4gICAgICBpZiAocGF0aHMubGVuZ3RoIDw9IDEpIHtcclxuICAgICAgICB0YXJnZXRbcGF0aHNbMF1dID0gdmFsdWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGF0aHMuc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgcGF0aCkgPT4ge1xyXG4gICAgICAgICAgaWYgKCEocHJldi5oYXNPd25Qcm9wZXJ0eShwYXRoKSB8fCBwcmV2WydfX3Byb3RvX18nXS5oYXNPd25Qcm9wZXJ0eShwYXRoKSkpIHtcclxuICAgICAgICAgICAgcHJldltwYXRoXSA9IHt9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHByZXZbcGF0aF07XHJcbiAgICAgICAgfSwgdGFyZ2V0KVtwYXRoc1twYXRocy5sZW5ndGggLSAxXV0gPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHNvcnRNYXBGaWVsZEtleXMoa2V5czogc3RyaW5nW10sIHByaW1hcnlLZXlzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcclxuICAgIGlmICghcHJpbWFyeUtleXMgfHwgcHJpbWFyeUtleXMubGVuZ3RoIDwgMSB8fCAha2V5cyB8fCBrZXlzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuIGtleXM7XHJcbiAgICB9XHJcbiAgICAvLyDov4fmu6Tlh7rpnZ7kuLvplK7mmKDlsITlrZfmrrVcclxuICAgIGtleXMgPSBrZXlzLmZpbHRlcigocCkgPT4gIXByaW1hcnlLZXlzLmluY2x1ZGVzKHApKTtcclxuICAgIHJldHVybiBbXS5jb25jYXQocHJpbWFyeUtleXMpLmNvbmNhdChrZXlzKTtcclxuICB9XHJcbn1cclxuIl19
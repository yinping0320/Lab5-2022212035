import { of, EMPTY } from 'rxjs';
import { Directive, Input, Injector, HostListener } from '@angular/core';
import { DiscussionListComponent, DiscussionListDirective } from '@farris/discussion-group';
import { ViewModel, ChangeType } from '@farris/devkit';
import { catchError } from 'rxjs/operators';
var KEY_UISTATE_REPLY_MESSAGE = 'DISCUSSION_REPLY_MESSAGE_INFO';
var KEY_MESSAGE_ON_COMMENT_ADD = 'onCommentAdd';
var FarrisDiscussionListBindingDirective = /** @class */ (function () {
    function FarrisDiscussionListBindingDirective(injector, discussionListComponent, viewModel, discussionListDirective) {
        this.injector = injector;
        this.discussionListComponent = discussionListComponent;
        this.viewModel = viewModel;
        this.discussionListDirective = discussionListDirective;
    }
    FarrisDiscussionListBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        this.viewModel.frameContext.appContext.messagePipe.subscribe(function (message) {
            if (message === KEY_MESSAGE_ON_COMMENT_ADD) {
                _this.queryComments();
            }
        });
        this.viewModel.bindingData.changes.subscribe(function (change) {
            if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged) {
                _this.queryComments();
            }
        });
    };
    /**
     * 查询评论
     */
    FarrisDiscussionListBindingDirective.prototype.queryComments = function (pageIndex, pageSize) {
        var _this = this;
        if (typeof pageIndex === 'undefined') {
            pageIndex = (this.discussionListComponent.pageIndex - 1) || 0;
        }
        if (typeof pageSize === 'undefined') {
            if (this.discussionListComponent.supportPaging) {
                pageSize = this.discussionListComponent.pageSize;
            }
            else {
                // 不分页，pageSize和后端约定传最大数
                pageSize = 10000;
            }
        }
        this.execute(this.commentsQueryCommand, { pageIndex: pageIndex, pageSize: pageSize }).pipe(catchError(function (e) { return EMPTY; })).subscribe(function (result) {
            if (!result) {
                return;
            }
            var _a = result.comments, comments = _a === void 0 ? [] : _a, _b = result.pageIndex, pageIndex = _b === void 0 ? 0 : _b, _c = result.pageSize, pageSize = _c === void 0 ? 10 : _c, _d = result.totalCount, totalCount = _d === void 0 ? 0 : _d;
            _this.discussionListComponent.pageIndex = parseInt(pageIndex) + 1;
            if (_this.discussionListComponent.supportPaging) {
                _this.discussionListComponent.pageSize = pageSize;
            }
            _this.discussionListComponent.total = totalCount;
            _this.discussionListDirective.discussionListData = result;
        });
    };
    /**
     * 回复消息
     * @param event event
     */
    FarrisDiscussionListBindingDirective.prototype.replyMessagedHandler = function (event) {
        this.viewModel.frameContext.root.viewModel.uiState.setPropertyValue(KEY_UISTATE_REPLY_MESSAGE, event);
    };
    /**
     * 切换页码
     * @param event event
     */
    FarrisDiscussionListBindingDirective.prototype.pageChangedHandler = function (event) {
        var _a = event.pageInfo || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 10 : _c;
        this.queryComments(pageIndex - 1, pageSize);
    };
    /**
     * 执行命令
     * @param commandName 命令名称
     */
    FarrisDiscussionListBindingDirective.prototype.execute = function (commandName, params) {
        var _this = this;
        if (!commandName || commandName === '' || commandName === 'undefined') {
            return of(null);
        }
        var paths = commandName.split('.');
        var func = null;
        paths.forEach(function (path) {
            func = func && func[path] || _this[path];
        });
        if (typeof func === 'function') {
            return func(params);
        }
        return of(null);
    };
    FarrisDiscussionListBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farris-discussion-list-binding]'
                },] }
    ];
    /** @nocollapse */
    FarrisDiscussionListBindingDirective.ctorParameters = function () { return [
        { type: Injector },
        { type: DiscussionListComponent },
        { type: ViewModel },
        { type: DiscussionListDirective }
    ]; };
    FarrisDiscussionListBindingDirective.propDecorators = {
        commentsQueryCommand: [{ type: Input, args: ["commentsQueryCommand",] }],
        replyMessagedHandler: [{ type: HostListener, args: ['replyMessage', ['$event'],] }],
        pageChangedHandler: [{ type: HostListener, args: ['pageChanged', ['$event'],] }]
    };
    return FarrisDiscussionListBindingDirective;
}());
export { FarrisDiscussionListBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX2Rpc2N1c3Npb25fbGlzdF9iaW5kaW5nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2Rpc2N1c3Npb24tZ3JvdXAvZmFycmlzX2Rpc2N1c3Npb25fbGlzdF9iaW5kaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQVUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pGLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzVGLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDL0QsT0FBTyxFQUFPLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pELElBQU0seUJBQXlCLEdBQUcsK0JBQStCLENBQUM7QUFDbEUsSUFBTSwwQkFBMEIsR0FBRyxjQUFjLENBQUM7QUFDbEQ7SUFRRSw4Q0FBbUIsUUFBa0IsRUFBUyx1QkFBZ0QsRUFBUyxTQUFvQixFQUFTLHVCQUFnRDtRQUFqSyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVMsNEJBQXVCLEdBQXZCLHVCQUF1QixDQUF5QjtRQUFTLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFBUyw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO0lBRXBMLENBQUM7SUFDRCx1REFBUSxHQUFSO1FBQUEsaUJBV0M7UUFWQyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxVQUFDLE9BQVk7WUFDeEUsSUFBSSxPQUFPLEtBQUssMEJBQTBCLEVBQUU7Z0JBQzFDLEtBQUksQ0FBQyxh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LEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUk7WUFDaEIsSUFBSSxHQUFHLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxPQUFPLElBQUksS0FBSyxVQUFVLEVBQUU7WUFDOUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDckI7UUFDRCxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQixDQUFDOztnQkF2RkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxrQ0FBa0M7aUJBQzdDOzs7O2dCQVIwQixRQUFRO2dCQUMxQix1QkFBdUI7Z0JBQ3ZCLFNBQVM7Z0JBRGdCLHVCQUF1Qjs7O3VDQVl0RCxLQUFLLFNBQUMsc0JBQXNCO3VDQWtENUIsWUFBWSxTQUFDLGNBQWMsRUFBRSxDQUFDLFFBQVEsQ0FBQztxQ0FRdkMsWUFBWSxTQUFDLGFBQWEsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7SUF1QnpDLDJDQUFDO0NBQUEsQUF4RkQsSUF3RkM7U0FyRlksb0NBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIEVNUFRZIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIEluamVjdG9yLCBPbkluaXQsIEhvc3RMaXN0ZW5lciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEaXNjdXNzaW9uTGlzdENvbXBvbmVudCwgRGlzY3Vzc2lvbkxpc3REaXJlY3RpdmUgfSBmcm9tICdAZmFycmlzL2Rpc2N1c3Npb24tZ3JvdXAnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZWwsIENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgdGFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5jb25zdCBLRVlfVUlTVEFURV9SRVBMWV9NRVNTQUdFID0gJ0RJU0NVU1NJT05fUkVQTFlfTUVTU0FHRV9JTkZPJztcclxuY29uc3QgS0VZX01FU1NBR0VfT05fQ09NTUVOVF9BREQgPSAnb25Db21tZW50QWRkJztcclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzLWRpc2N1c3Npb24tbGlzdC1iaW5kaW5nXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc0Rpc2N1c3Npb25MaXN0QmluZGluZ0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgLyoqXHJcbiAgICog6I635Y+W55So5oi35ZG95LukXHJcbiAgKi9cclxuICBASW5wdXQoXCJjb21tZW50c1F1ZXJ5Q29tbWFuZFwiKSBjb21tZW50c1F1ZXJ5Q29tbWFuZDogc3RyaW5nO1xyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpbmplY3RvcjogSW5qZWN0b3IsIHB1YmxpYyBkaXNjdXNzaW9uTGlzdENvbXBvbmVudDogRGlzY3Vzc2lvbkxpc3RDb21wb25lbnQsIHB1YmxpYyB2aWV3TW9kZWw6IFZpZXdNb2RlbCwgcHVibGljIGRpc2N1c3Npb25MaXN0RGlyZWN0aXZlOiBEaXNjdXNzaW9uTGlzdERpcmVjdGl2ZSkge1xyXG5cclxuICB9XHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5zdWJzY3JpYmUoKG1lc3NhZ2U6IGFueSkgPT4ge1xyXG4gICAgICBpZiAobWVzc2FnZSA9PT0gS0VZX01FU1NBR0VfT05fQ09NTUVOVF9BREQpIHtcclxuICAgICAgICB0aGlzLnF1ZXJ5Q29tbWVudHMoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCkge1xyXG4gICAgICAgIHRoaXMucXVlcnlDb21tZW50cygpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p+l6K+i6K+E6K66XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBxdWVyeUNvbW1lbnRzKHBhZ2VJbmRleD86IG51bWJlciwgcGFnZVNpemU/OiBudW1iZXIpIHtcclxuICAgIGlmICh0eXBlb2YgcGFnZUluZGV4ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBwYWdlSW5kZXggPSAodGhpcy5kaXNjdXNzaW9uTGlzdENvbXBvbmVudC5wYWdlSW5kZXggLSAxKSB8fCAwO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBwYWdlU2l6ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgaWYgKHRoaXMuZGlzY3Vzc2lvbkxpc3RDb21wb25lbnQuc3VwcG9ydFBhZ2luZykge1xyXG4gICAgICAgIHBhZ2VTaXplID0gdGhpcy5kaXNjdXNzaW9uTGlzdENvbXBvbmVudC5wYWdlU2l6ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDkuI3liIbpobXvvIxwYWdlU2l6ZeWSjOWQjuerr+e6puWumuS8oOacgOWkp+aVsFxyXG4gICAgICAgIHBhZ2VTaXplID0gMTAwMDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuZXhlY3V0ZSh0aGlzLmNvbW1lbnRzUXVlcnlDb21tYW5kLCB7IHBhZ2VJbmRleCwgcGFnZVNpemUgfSkucGlwZShcclxuICAgICAgY2F0Y2hFcnJvcihlID0+IEVNUFRZKVxyXG4gICAgKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgeyBjb21tZW50cyA9IFtdLCBwYWdlSW5kZXggPSAwLCBwYWdlU2l6ZSA9IDEwLCB0b3RhbENvdW50ID0gMCB9ID0gcmVzdWx0O1xyXG4gICAgICB0aGlzLmRpc2N1c3Npb25MaXN0Q29tcG9uZW50LnBhZ2VJbmRleCA9IHBhcnNlSW50KHBhZ2VJbmRleCkgKyAxO1xyXG4gICAgICBpZiAodGhpcy5kaXNjdXNzaW9uTGlzdENvbXBvbmVudC5zdXBwb3J0UGFnaW5nKSB7XHJcbiAgICAgICAgdGhpcy5kaXNjdXNzaW9uTGlzdENvbXBvbmVudC5wYWdlU2l6ZSA9IHBhZ2VTaXplO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZGlzY3Vzc2lvbkxpc3RDb21wb25lbnQudG90YWwgPSB0b3RhbENvdW50O1xyXG4gICAgICB0aGlzLmRpc2N1c3Npb25MaXN0RGlyZWN0aXZlLmRpc2N1c3Npb25MaXN0RGF0YSA9IHJlc3VsdDtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlm57lpI3mtojmga9cclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdyZXBseU1lc3NhZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyByZXBseU1lc3NhZ2VkSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucm9vdC52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKEtFWV9VSVNUQVRFX1JFUExZX01FU1NBR0UsIGV2ZW50KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5YiH5o2i6aG156CBXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZUNoYW5nZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBwYWdlQ2hhbmdlZEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXggPSAxLCBwYWdlU2l6ZSA9IDEwIH0gPSBldmVudC5wYWdlSW5mbyB8fCB7fTtcclxuICAgIHRoaXMucXVlcnlDb21tZW50cyhwYWdlSW5kZXggLSAxLCBwYWdlU2l6ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJp+ihjOWRveS7pFxyXG4gICAqIEBwYXJhbSBjb21tYW5kTmFtZSDlkb3ku6TlkI3np7BcclxuICAgKi9cclxuICBwcml2YXRlIGV4ZWN1dGUoY29tbWFuZE5hbWU6IHN0cmluZywgcGFyYW1zPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghY29tbWFuZE5hbWUgfHwgY29tbWFuZE5hbWUgPT09ICcnIHx8IGNvbW1hbmROYW1lID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXRocyA9IGNvbW1hbmROYW1lLnNwbGl0KCcuJyk7XHJcbiAgICBsZXQgZnVuYyA9IG51bGw7XHJcbiAgICBwYXRocy5mb3JFYWNoKHBhdGggPT4ge1xyXG4gICAgICBmdW5jID0gZnVuYyAmJiBmdW5jW3BhdGhdIHx8IHRoaXNbcGF0aF07XHJcbiAgICB9KTtcclxuICAgIGlmICh0eXBlb2YgZnVuYyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICByZXR1cm4gZnVuYyhwYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gIH1cclxufVxyXG4iXX0=
import * as tslib_1 from "tslib";
import { Directive, Input, Injector, Optional, HostListener } from '@angular/core';
import { BindingData, BindingList, FrameContext, ChangeType } from '@farris/devkit';
import { FFilePreviewComponent, UploadAndPreviewComponent } from '@farris/extend-file-upload';
/**
 * 树表格绑定指令
 */
var FarrisFilePreviewBindingDirective = /** @class */ (function () {
    /**
     * 构造函数
     * @param previewComponent - 附件组件
     * @param frameContext - 控制器上下文
     * @param uploadAndPreviewComponent - 附件上传预览组件
     * @param injector - injector
     * @TODO: 该指令被用于不同的组件中，因此uploadAndPreviewComponent可能为null
     */
    function FarrisFilePreviewBindingDirective(previewComponent, frameContext, uploadAndPreviewComponent, injector) {
        this.previewComponent = previewComponent;
        this.frameContext = frameContext;
        this.uploadAndPreviewComponent = uploadAndPreviewComponent;
        this.injector = injector;
        /**
         * 未启用排序时默认按上传时间字段排序
         */
        this.DEFAULT_SORT_FIELD = 'createTime';
        /**
         * 启用排序时使用fileSortOrder做排序字段，与零代码的拖拽排序统一
         */
        this.SORT_FIELD_ON_SORTING = 'fileSortOrder';
    }
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "bindingData", {
        /**
         * 绑定数据
         */
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "bindingList", {
        /**
         * 绑定数据列表
         */
        get: function () {
            return this.bindingData.getList();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "orderField", {
        /**
         * 排序字段
         * @description
         * 组件排序字段只有一个，不支持多个。
         * 如果启用了拖拽排序，则为fileSortOrder，否则使用默认的createTime
         */
        get: function () {
            return this.uploadAndPreviewComponent && this.uploadAndPreviewComponent.enableOrder && this.uploadAndPreviewComponent.orderField || this.fileSortOrderKey && this.SORT_FIELD_ON_SORTING || this.DEFAULT_SORT_FIELD;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "orderType", {
        /**
         * 默认降序
         */
        get: function () {
            return this.farrisOrderType ? this.farrisOrderType : this.orderField === this.DEFAULT_SORT_FIELD ? 'desc' : 'asc';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 指令初始化
     */
    FarrisFilePreviewBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        this.bindData();
        if (this.uploadAndPreviewComponent) {
            if (this.uploadAndPreviewComponent.enableOrder) {
                this.uploadAndPreviewComponent.orderField = this.SORT_FIELD_ON_SORTING;
            }
            // 禁用组件内置排序，控制器负责排序并将排序后的数据绑定到附件上传预览组件
            this.uploadAndPreviewComponent.enableSorting = false;
            this.uploadAndPreviewComponent.fSelectedEvent.subscribe(function (event) {
                var primaryKey = _this.bindingList.primaryKey;
                var id = event && event.originalData && event.originalData[primaryKey];
                if (id && id !== _this.bindingList.currentId) {
                    _this.bindingList.setCurrentId(id, true);
                }
            });
        }
        this.bindingData.changes.subscribe(function (change) {
            // 因排序需要，值变化时也应进行数据绑定
            if (change.type === ChangeType.Load || change.type === ChangeType.Append || change.type === ChangeType.Remove || change.type === ChangeType.ValueChanged || change.type === ChangeType.SelectionChanged) {
                _this.bindData(change);
                _this.updateCurrentRow(change);
                _this.updateChecks(change);
            }
        });
        this.setChecks([]);
    };
    /**
     * 指令输入变更
     * @param changes -变更
     */
    FarrisFilePreviewBindingDirective.prototype.ngOnChanges = function (changes) {
    };
    FarrisFilePreviewBindingDirective.prototype.shouldComponentUpdate = function (data) {
        return !(JSON.stringify(this.__DATA__) === JSON.stringify(data));
        // return !(this.__DATA__ && isEqual(this.__DATA__, data));
    };
    /**
     * 绑定数据
     * @param change -变更
     */
    FarrisFilePreviewBindingDirective.prototype.bindData = function (change) {
        var bindingPath = this.frameContext.viewModel.bindingPath.split('/').filter(function (p) { return p; }).join('/');
        var eventPath = change && change.path && change.path.filter(function (p) { return p; }).join('/');
        // 行切换、删除、加载、新增数据、页码切换 场景
        if (change && [ChangeType.SelectionChanged, ChangeType.Remove, ChangeType.Load, ChangeType.Append].includes(change.type)) {
            // 非上级实体不重新绑定数据
            if (!bindingPath.startsWith(eventPath)) {
                return;
            }
            // 当前附件组件切换当前行不需要重新渲染
            if (change.type === ChangeType.SelectionChanged && bindingPath === eventPath) {
                return;
            }
        }
        // 非当前实体发生了值变化
        if (change && change.type === ChangeType.ValueChanged && !eventPath.startsWith(bindingPath)) {
            return;
        }
        var fileInfos = this.getFileInfos();
        if (!this.shouldComponentUpdate(fileInfos)) {
            return;
        }
        if (this.componentRef) {
            this.__DATA__ = fileInfos;
            this.componentRef.fileInfos = fileInfos;
            if (this.uploadAndPreviewComponent && fileInfos && fileInfos.length > 0) {
                var extendInfos = fileInfos.map(function (item) { return item.originalData; });
                this.uploadAndPreviewComponent.extendInfos = extendInfos;
            }
            this.changeCurrentRow(fileInfos, change);
        }
    };
    FarrisFilePreviewBindingDirective.prototype.updateChecks = function (change) {
        if (!this.uploadAndPreviewComponent) {
            return;
        }
        var bindingPath = this.frameContext.viewModel.bindingPath.split('/').filter(function (p) { return p; }).join('/');
        var eventPath = change && change.path && change.path.filter(function (p) { return p; }).join('/');
        // 删除自身表时更新勾选记录
        if (change && change.type === ChangeType.Remove && eventPath === bindingPath) {
            var values = change.value || [];
            var ids_1 = this.frameContext.uiState['ids'] || [];
            if (values.length > 0 && ids_1.length > 0) {
                values.forEach(function (id) {
                    var index = ids_1.indexOf(id);
                    if (index !== -1) {
                        ids_1.splice(index, 1);
                    }
                });
            }
        }
        else if ((change.type === ChangeType.Remove || change.type === ChangeType.SelectionChanged) && bindingPath.startsWith(eventPath) && bindingPath !== eventPath) {
            //上级（上上级）表删除、上级（上上级）表切换当前行时更新勾选记录
            this.setChecks([]);
            // 清空组件勾选
            this.clearComponentChecks();
        }
        else if (change && change.type === ChangeType.Load && (bindingPath === eventPath || bindingPath.startsWith(eventPath) && bindingPath !== eventPath)) {
            // 当前附件组件数据重新加载 or 上级或上上级重新加载
            this.setChecks([]);
            // 清空组件勾选
            this.clearComponentChecks();
        }
    };
    /**
     * 主动更新当前行
     * @param data - 数据
     * @param change - 变更
     */
    FarrisFilePreviewBindingDirective.prototype.changeCurrentRow = function (data, change) {
        var _this = this;
        if (!this.uploadAndPreviewComponent) {
            return;
        }
        var changePath = change && change.path.join('/');
        var paths = this.frameContext.viewModel.bindingPath.split('/').filter(function (p) { return p; });
        var path = paths.join('/');
        var isParentSelectChange = path.startsWith(changePath) && change.type === ChangeType.SelectionChanged && path !== changePath;
        var isSelfRowDelete = change && change.type === ChangeType.Remove && path === changePath;
        if (data && data.length > 0 && change && (change.type === ChangeType.Load || isParentSelectChange || isSelfRowDelete)) {
            var primaryKey = this.bindingList.primaryKey;
            var id_1 = data[0]['originalData'] && data[0]['originalData'][primaryKey];
            if (this.bindingList.currentId !== id_1) {
                setTimeout(function () {
                    _this.bindingList.setCurrentId(id_1, true, true);
                }, 100);
            }
        }
    };
    /**
     * 为控件设置当前行
     * @param change - 控制器变更
     * @returns
     */
    FarrisFilePreviewBindingDirective.prototype.updateCurrentRow = function (change) {
        if (!this.bindingList || !this.bindingList.currentId || !this.uploadAndPreviewComponent) {
            return;
        }
        if (change && change.type !== ChangeType.SelectionChanged && change.type !== ChangeType.Load && change.type !== ChangeType.Remove) {
            return;
        }
        var currentId = this.uploadAndPreviewComponent.previewCurrent;
        // 组件id和数据id进行转换
        var id = this.getValueByPath(this.bindingList.currentItem, this.fileIdKey);
        if (id === currentId) {
            return;
        }
        this.selectComponentRow(id);
    };
    /**
     * 获取附件信息列表
     */
    FarrisFilePreviewBindingDirective.prototype.getFileInfos = function () {
        var _this = this;
        var listData = this.bindingList.toJSON();
        var fileInfos = [];
        listData.forEach(function (itemData) {
            var fileInfo = _this.convertToFileInfo(itemData);
            fileInfos.push(fileInfo);
        });
        // 排序
        if (this.orderField) {
            this.sort(fileInfos, this.orderField, this.orderType);
        }
        return fileInfos;
    };
    /**
     * 行数据转换为文件信息
     * @param itemData - 行数据
     * @returns
     */
    FarrisFilePreviewBindingDirective.prototype.convertToFileInfo = function (itemData) {
        var _this = this;
        // const idKey = this.bindingList.primaryKey;
        // const id = this.getValueByPath(itemData, idKey);
        var fileId = this.getValueByPath(itemData, this.fileIdKey);
        var fileName = this.getValueByPath(itemData, this.fileNameKey);
        var fileSize = this.getValueByPath(itemData, this.fileSizeKey);
        var fileCreateTime = this.getValueByPath(itemData, this.fileCreateTimeKey);
        var fileInfo = {
            id: fileId,
            name: fileName,
            size: fileSize,
            createTime: fileCreateTime,
            originalData: itemData,
            extend: {
                metadataId: fileId
            }
        };
        if (this.extendFileInfo && Array.isArray(this.extendFileInfo) && this.extendFileInfo.length > 0) {
            this.extendFileInfo.forEach(function (item) {
                fileInfo[item.key] = _this.getValueByPath(itemData, item.path);
            });
        }
        if (this.fileSortOrderKey) {
            var fileSortOrder = this.getValueByPath(itemData, this.fileSortOrderKey);
            fileInfo[this.SORT_FIELD_ON_SORTING] = fileSortOrder;
        }
        return fileInfo;
    };
    /**
     * 设置控件的当前行
     * @param id 主键
     */
    FarrisFilePreviewBindingDirective.prototype.selectComponentRow = function (id) {
        if (this.uploadAndPreviewComponent) {
            this.uploadAndPreviewComponent.previewCurrent = id;
        }
    };
    /**
     * 根据字段路径获取值
     * @param data - 数据源
     * @param path - 字段路径
     */
    FarrisFilePreviewBindingDirective.prototype.getValueByPath = function (data, path) {
        var keys = path.split('.');
        var currentValue = data;
        keys.forEach(function (key) {
            currentValue = currentValue && currentValue[key];
        });
        return currentValue;
    };
    FarrisFilePreviewBindingDirective.prototype.getUdtPaths = function () {
        var paths = this.fileIdKey.split('.');
        paths.pop();
        return paths;
    };
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "fileSizeKey", {
        get: function () {
            var basePaths = this.getUdtPaths();
            return basePaths.concat(['fileSize']).join('.');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "fileCreateTimeKey", {
        get: function () {
            var basePaths = this.getUdtPaths();
            return basePaths.concat(['fileCreateTime']).join('.');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisFilePreviewBindingDirective.prototype, "componentRef", {
        get: function () {
            return this.previewComponent || this.uploadAndPreviewComponent || null;
        },
        enumerable: true,
        configurable: true
    });
    FarrisFilePreviewBindingDirective.prototype.setChecks = function (ids) {
        this.frameContext.uiState.setPropertyValue('ids', ids);
    };
    /**
     * 清空组件勾选
     */
    FarrisFilePreviewBindingDirective.prototype.clearComponentChecks = function () {
        if (this.uploadAndPreviewComponent) {
            this.uploadAndPreviewComponent.previewUpdateRefresh();
        }
    };
    FarrisFilePreviewBindingDirective.prototype.sort = function (data, fields, directions) {
        var _this = this;
        if (!fields || fields.length < 1 || !directions || directions.length < 1) {
            throw new Error('sortBy:argument error');
        }
        // 默认升序
        var arrFields = typeof fields === 'string' ? fields.split(',') : fields || [];
        var arrDirections = typeof directions === 'string' ? directions.split(',') : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length || arrFields.length < 1) {
            throw new Error('sortBy:fields and directions not match');
        }
        // nage,age,total
        var comparator = function (props, orders) { return function (item1, item2) {
            return props.reduce(function (result, prop) {
                if (result === 0) {
                    var order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                    var item1Value = _this.getValue(item1, prop);
                    var item2Value = _this.getValue(item2, prop);
                    if (item1Value === null || item1Value === undefined) {
                        return 1;
                    }
                    if (item2Value === null || item2Value === undefined) {
                        return -1;
                    }
                    if (typeof item1Value !== typeof item2Value) {
                        var localeCompareResult = String(item1Value).localeCompare(String(item2Value));
                        result = localeCompareResult * order;
                    }
                    else if (typeof item1Value === 'string' && typeof item2Value === 'string') {
                        var localeCompareResult = item1Value.localeCompare(item2Value);
                        result = localeCompareResult * order;
                    }
                    else {
                        if (item1Value > item2Value) {
                            result = order * 1;
                        }
                        if (item1Value < item2Value) {
                            result = order * -1;
                        }
                    }
                }
                return result;
            }, 0);
        }; };
        data.sort(comparator(arrFields, arrDirections));
    };
    FarrisFilePreviewBindingDirective.prototype.getValue = function (target, propName) {
        var e_1, _a;
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        var result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            var props = propName.split('.');
            try {
                for (var props_1 = tslib_1.__values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {
                    var prop = props_1_1.value;
                    target = result = this.getValue(target, prop);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return result;
    };
    /**
     * 勾选变化事件
     * @param event
     */
    FarrisFilePreviewBindingDirective.prototype.checkedChanged = function (event) {
        var primaryKey = this.bindingList.primaryKey;
        var ids = event && event.map(function (item) { return item && item.originalData && item.originalData[primaryKey] || ''; }).filter(function (p) { return p; }) || [];
        this.setChecks(ids);
    };
    /**
     * 行切换事件
     * @param event
     */
    FarrisFilePreviewBindingDirective.prototype.selectChanged = function (event) {
    };
    FarrisFilePreviewBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisFilePreviewBinding]'
                },] }
    ];
    /** @nocollapse */
    FarrisFilePreviewBindingDirective.ctorParameters = function () { return [
        { type: FFilePreviewComponent, decorators: [{ type: Optional }] },
        { type: FrameContext },
        { type: UploadAndPreviewComponent, decorators: [{ type: Optional }] },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    FarrisFilePreviewBindingDirective.propDecorators = {
        extendFileInfo: [{ type: Input, args: ['extendFileInfo',] }],
        farrisOrderType: [{ type: Input, args: ['farrisOrderType',] }],
        fileIdKey: [{ type: Input, args: ['farrisFileIdKey',] }],
        fileSortOrderKey: [{ type: Input, args: ['farrisFileSortOrderKey',] }],
        fileNameKey: [{ type: Input, args: ['farrisFileNameKey',] }],
        checkedChanged: [{ type: HostListener, args: ['fPreviewMultiSelectedEvent', ['$event'],] }],
        selectChanged: [{ type: HostListener, args: ['fSelectedEvent', ['$event'],] }]
    };
    return FarrisFilePreviewBindingDirective;
}());
export { FarrisFilePreviewBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzLWZpbGUtcHJldmlldy1iaW5kaW5nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2ZpbGUtcHJldmlldy9mYXJyaXMtZmlsZS1wcmV2aWV3LWJpbmRpbmcuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFvQyxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckgsT0FBTyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFVLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVGLE9BQU8sRUFBYyxxQkFBcUIsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRTFHOztHQUVHO0FBQ0g7SUFnRUU7Ozs7Ozs7T0FPRztJQUNILDJDQUNzQixnQkFBdUMsRUFDbkQsWUFBMEIsRUFDZCx5QkFBb0QsRUFDcEQsUUFBa0I7UUFIbEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF1QjtRQUNuRCxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUNkLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFDcEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZFeEM7O1dBRUc7UUFDYyx1QkFBa0IsR0FBRyxZQUFZLENBQUM7UUFDbkQ7O1dBRUc7UUFDYywwQkFBcUIsR0FBRyxlQUFlLENBQUM7SUFrRXpELENBQUM7SUF2Q0Qsc0JBQVksMERBQVc7UUFIdkI7O1dBRUc7YUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7UUFDdkMsQ0FBQzs7O09BQUE7SUFLRCxzQkFBWSwwREFBVztRQUh2Qjs7V0FFRzthQUNIO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3BDLENB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LENBQUMsSUFBSSxFQUFFLENBQUM7UUFDaEksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBQ0Q7OztPQUdHO0lBRUsseURBQWEsR0FEckIsVUFDc0IsS0FBVTtJQUVoQyxDQUFDOztnQkF4WkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSw0QkFBNEI7aUJBQ3ZDOzs7O2dCQVBvQixxQkFBcUIsdUJBOEVyQyxRQUFRO2dCQS9Fc0IsWUFBWTtnQkFDSCx5QkFBeUIsdUJBZ0ZoRSxRQUFRO2dCQWxGZ0QsUUFBUSx1QkFtRmhFLFFBQVE7OztpQ0EvRFYsS0FBSyxTQUFDLGdCQUFnQjtrQ0FLdEIsS0FBSyxTQUFDLGlCQUFpQjs0QkFLdkIsS0FBSyxTQUFDLGlCQUFpQjttQ0FLdkIsS0FBSyxTQUFDLHdCQUF3Qjs4QkFLOUIsS0FBSyxTQUFDLG1CQUFtQjtpQ0EwV3pCLFlBQVksU0FBQyw0QkFBNEIsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQ0FVckQsWUFBWSxTQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDOztJQUk1Qyx3Q0FBQztDQUFBLEFBelpELElBeVpDO0FBRUQsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIE9uSW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSW5qZWN0b3IsIE9wdGlvbmFsLCBIb3N0TGlzdGVuZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0LCBGcmFtZUNvbnRleHQsIENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgVXBsb2FkRmlsZSwgRkZpbGVQcmV2aWV3Q29tcG9uZW50LCBVcGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy9leHRlbmQtZmlsZS11cGxvYWQnO1xyXG5cclxuLyoqXHJcbiAqIOagkeihqOagvOe7keWumuaMh+S7pFxyXG4gKi9cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzRmlsZVByZXZpZXdCaW5kaW5nXSdcclxufSlcclxuY2xhc3MgRmFycmlzRmlsZVByZXZpZXdCaW5kaW5nRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIHByaXZhdGUgX19EQVRBX186IGFueTtcclxuICAvKipcclxuICAgKiDmnKrlkK/nlKjmjpLluo/ml7bpu5jorqTmjInkuIrkvKDml7bpl7TlrZfmrrXmjpLluo9cclxuICAgKi9cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfU09SVF9GSUVMRCA9ICdjcmVhdGVUaW1lJztcclxuICAvKipcclxuICAgKiDlkK/nlKjmjpLluo/ml7bkvb/nlKhmaWxlU29ydE9yZGVy5YGa5o6S5bqP5a2X5q6177yM5LiO6Zu25Luj56CB55qE5ouW5ou95o6S5bqP57uf5LiAXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBTT1JUX0ZJRUxEX09OX1NPUlRJTkcgPSAnZmlsZVNvcnRPcmRlcic7XHJcbiAgQElucHV0KCdleHRlbmRGaWxlSW5mbycpXHJcbiAgcHVibGljIGV4dGVuZEZpbGVJbmZvOiB7IGtleTogc3RyaW5nLCBwYXRoOiBhbnkgfVtdO1xyXG4gIC8qKlxyXG4gICAqIOaOkuW6j+aWueW8j1xyXG4gICAqL1xyXG4gIEBJbnB1dCgnZmFycmlzT3JkZXJUeXBlJylcclxuICBwdWJsaWMgZmFycmlzT3JkZXJUeXBlOiBzdHJpbmc7XHJcbiAgLyoqXHJcbiAgICog5paH5Lu2aWTlrZfmrrXot6/lvoRcclxuICAgKi9cclxuICBASW5wdXQoJ2ZhcnJpc0ZpbGVJZEtleScpXHJcbiAgcHVibGljIGZpbGVJZEtleTogc3RyaW5nO1xyXG4gIC8qKlxyXG4gICAqIOaOkuW6j+Wtl+aute+8jOaLluaLveaOkuW6j+ebuOWFs1xyXG4gICAqL1xyXG4gIEBJbnB1dCgnZmFycmlzRmlsZVNvcnRPcmRlcktleScpXHJcbiAgcHVibGljIGZpbGVTb3J0T3JkZXJLZXk6IHN0cmluZztcclxuICAvKipcclxuICAgKiDmlofku7ZuYW1l5a2X5q616Lev5b6EXHJcbiAgICovXHJcbiAgQElucHV0KCdmYXJyaXNGaWxlTmFtZUtleScpXHJcbiAgcHVibGljIGZpbGVOYW1lS2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdEYXRhKCk6IEJpbmRpbmdEYXRhIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNruWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmdldExpc3QoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5o6S5bqP5a2X5q61XHJcbiAgICogQGRlc2NyaXB0aW9uXHJcbiAgICog57uE5Lu25o6S5bqP5a2X5q615Y+q5pyJ5LiA5Liq77yM5LiN5pSv5oyB5aSa5Liq44CCXHJcbiAgICog5aaC5p6c5ZCv55So5LqG5ouW5ou95o6S5bqP77yM5YiZ5Li6ZmlsZVNvcnRPcmRlcu+8jOWQpuWImeS9v+eUqOm7mOiupOeahGNyZWF0ZVRpbWVcclxuICAgKi9cclxuICBwcml2YXRlIGdldCBvcmRlckZpZWxkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudCAmJiB0aGlzLnVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQuZW5hYmxlT3JkZXIgJiYgdGhpcy51cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50Lm9yZGVyRmllbGQgfHwgdGhpcy5maWxlU29ydE9yZGVyS2V5ICYmIHRoaXMuU09SVF9GSUVMRF9PTl9TT1JUSU5HIHx8IHRoaXMuREVGQVVMVF9TT1JUX0ZJRUxEO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpu5jorqTpmY3luo9cclxuICAgKi9cclxuICBwcml2YXRlIGdldCBvcmRlclR5cGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mYXJyaXNPcmRlclR5cGUgPyB0aGlzLmZhcnJpc09yZGVyVHlwZSA6IHRoaXMub3JkZXJGaWVsZCA9PT0gdGhpcy5ERUZBVUxUX1NPUlRfRklFTEQgPyAnZGVzYycgOiAnYXNjJztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICogQHBhcmFtIHByZXZpZXdDb21wb25lbnQgLSDpmYTku7bnu4Tku7ZcclxuICAgKiBAcGFyYW0gZnJhbWVDb250ZXh0IC0g5o6n5Yi25Zmo5LiK5LiL5paHXHJcbiAgICogQHBhcmFtIHVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQgLSDpmYTku7bkuIrkvKDpooTop4jnu4Tku7ZcclxuICAgKiBAcGFyYW0gaW5qZWN0b3IgLSBpbmplY3RvclxyXG4gICAqIEBUT0RPOiDor6XmjIfku6TooqvnlKjkuo7kuI3lkIznmoTnu4Tku7bkuK3vvIzlm6DmraR1cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW505Y+v6IO95Li6bnVsbFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBwcmV2aWV3Q29tcG9uZW50OiBGRmlsZVByZXZpZXdDb21wb25lbnQsXHJcbiAgICBwcml2YXRlIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSB1cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50OiBVcGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcclxuICApIHtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaMh+S7pOWIneWni+WMllxyXG4gICAqL1xyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgaWYgKHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudCkge1xyXG4gICAgICBpZiAodGhpcy51cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50LmVuYWJsZU9yZGVyKSB7XHJcbiAgICAgICAgdGhpcy51cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50Lm9yZGVyRmllbGQgPSB0aGlzLlNPUlRfRklFTERfT05fU09SVElORztcclxuICAgICAgfVxyXG4gICAgICAvLyDnpoHnlKjnu4Tku7blhoXnva7mjpLluo/vvIzmjqfliLblmajotJ/otKPmjpLluo/lubblsIbmjpLluo/lkI7nmoTmlbDmja7nu5HlrprliLDpmYTku7bkuIrkvKDpooTop4jnu4Tku7ZcclxuICAgICAgdGhpcy51cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50LmVuYWJsZVNvcnRpbmcgPSBmYWxzZTtcclxuICAgICAgdGhpcy51cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50LmZTZWxlY3RlZEV2ZW50LnN1YnNjcmliZSgoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgICAgICAgY29uc3QgaWQgPSBldmVudCAmJiBldmVudC5vcmlnaW5hbERhdGEgJiYgZXZlbnQub3JpZ2luYWxEYXRhW3ByaW1hcnlLZXldO1xyXG4gICAgICAgIGlmIChpZCAmJiBpZCAhPT0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQpIHtcclxuICAgICAgICAgIHRoaXMuYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKGlkLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgLy8g5Zug5o6S5bqP6ZyA6KaB77yM5YC85Y+Y5YyW5pe25Lmf5bqU6L+b6KGM5pWw5o2u57uR5a6aXHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkFwcGVuZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuVmFsdWVDaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQpIHtcclxuICAgICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDdXJyZW50Um93KGNoYW5nZSk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDaGVja3MoY2hhbmdlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TovpPlhaXlj5jmm7RcclxuICAgKiBAcGFyYW0gY2hhbmdlcyAt5Y+Y5pu0XHJcbiAgICovXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gIH1cclxuICBwcml2YXRlIHNob3VsZENvbXBvbmVudFVwZGF0ZShkYXRhOiBhbnkpIHtcclxuICAgIHJldHVybiAhKEpTT04uc3RyaW5naWZ5KHRoaXMuX19EQVRBX18pID09PSBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAvLyByZXR1cm4gISh0aGlzLl9fREFUQV9fICYmIGlzRXF1YWwodGhpcy5fX0RBVEFfXywgZGF0YSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnu5HlrprmlbDmja5cclxuICAgKiBAcGFyYW0gY2hhbmdlIC3lj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGJpbmREYXRhKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS5qb2luKCcvJyk7XHJcbiAgICBjb25zdCBldmVudFBhdGggPSBjaGFuZ2UgJiYgY2hhbmdlLnBhdGggJiYgY2hhbmdlLnBhdGguZmlsdGVyKHAgPT4gcCkuam9pbignLycpO1xyXG4gICAgLy8g6KGM5YiH5o2i44CB5Yig6Zmk44CB5Yqg6L2944CB5paw5aKe5pWw5o2u44CB6aG156CB5YiH5o2iIOWcuuaZr1xyXG4gICAgaWYgKGNoYW5nZSAmJiBbQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkLCBDaGFuZ2VUeXBlLlJlbW92ZSwgQ2hhbmdlVHlwZS5Mb2FkLCBDaGFuZ2VUeXBlLkFwcGVuZF0uaW5jbHVkZXMoY2hhbmdlLnR5cGUpKSB7XHJcbiAgICAgIC8vIOmdnuS4iue6p+WunuS9k+S4jemHjeaWsOe7keWumuaVsOaNrlxyXG4gICAgICBpZiAoIWJpbmRpbmdQYXRoLnN0YXJ0c1dpdGgoZXZlbnRQYXRoKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyDlvZPliY3pmYTku7bnu4Tku7bliIfmjaLlvZPliY3ooYzkuI3pnIDopoHph43mlrDmuLLmn5NcclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQgJiYgYmluZGluZ1BhdGggPT09IGV2ZW50UGF0aCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g6Z2e5b2T5YmN5a6e5L2T5Y+R55Sf5LqG5YC85Y+Y5YyWXHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCAmJiAhZXZlbnRQYXRoLnN0YXJ0c1dpdGgoYmluZGluZ1BhdGgpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGZpbGVJbmZvcyA9IHRoaXMuZ2V0RmlsZUluZm9zKCk7XHJcbiAgICBpZiAoIXRoaXMuc2hvdWxkQ29tcG9uZW50VXBkYXRlKGZpbGVJbmZvcykpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgIHRoaXMuX19EQVRBX18gPSBmaWxlSW5mb3M7XHJcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmZpbGVJbmZvcyA9IGZpbGVJbmZvcztcclxuICAgICAgaWYgKHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudCAmJiBmaWxlSW5mb3MgJiYgZmlsZUluZm9zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBleHRlbmRJbmZvcyA9IGZpbGVJbmZvcy5tYXAoKGl0ZW06IGFueSkgPT4gaXRlbS5vcmlnaW5hbERhdGEpO1xyXG4gICAgICAgIHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudC5leHRlbmRJbmZvcyA9IGV4dGVuZEluZm9zO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFJvdyhmaWxlSW5mb3MsIGNoYW5nZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgdXBkYXRlQ2hlY2tzKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgaWYgKCF0aGlzLnVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS5qb2luKCcvJyk7XHJcbiAgICBjb25zdCBldmVudFBhdGggPSBjaGFuZ2UgJiYgY2hhbmdlLnBhdGggJiYgY2hhbmdlLnBhdGguZmlsdGVyKHAgPT4gcCkuam9pbignLycpO1xyXG4gICAgLy8g5Yig6Zmk6Ieq6Lqr6KGo5pe25pu05paw5Yu+6YCJ6K6w5b2VXHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSAmJiBldmVudFBhdGggPT09IGJpbmRpbmdQYXRoKSB7XHJcbiAgICAgIGNvbnN0IHZhbHVlcyA9IGNoYW5nZS52YWx1ZSB8fCBbXTtcclxuICAgICAgY29uc3QgaWRzOiBhbnlbXSA9IHRoaXMuZnJhbWVDb250ZXh0LnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gICAgICBpZiAodmFsdWVzLmxlbmd0aCA+IDAgJiYgaWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2YWx1ZXMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgaW5kZXggPSBpZHMuaW5kZXhPZihpZCk7XHJcbiAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIGlkcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZCkgJiYgYmluZGluZ1BhdGguc3RhcnRzV2l0aChldmVudFBhdGgpICYmIGJpbmRpbmdQYXRoICE9PSBldmVudFBhdGgpIHtcclxuICAgICAgLy/kuIrnuqfvvIjkuIrkuIrnuqfvvInooajliKDpmaTjgIHkuIrnuqfvvIjkuIrkuIrnuqfvvInooajliIfmjaLlvZPliY3ooYzml7bmm7TmlrDli77pgInorrDlvZVcclxuICAgICAgdGhpcy5zZXRDaGVja3MoW10pO1xyXG4gICAgICAvLyDmuIXnqbrnu4Tku7bli77pgIlcclxuICAgICAgdGhpcy5jbGVhckNvbXBvbmVudENoZWNrcygpO1xyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2UgJiYgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCAmJiAoYmluZGluZ1BhdGggPT09IGV2ZW50UGF0aCB8fCBiaW5kaW5nUGF0aC5zdGFydHNXaXRoKGV2ZW50UGF0aCkgJiYgYmluZGluZ1BhdGggIT09IGV2ZW50UGF0aCkpIHtcclxuICAgICAgLy8g5b2T5YmN6ZmE5Lu257uE5Lu25pWw5o2u6YeN5paw5Yqg6L29IG9yIOS4iue6p+aIluS4iuS4iue6p+mHjeaWsOWKoOi9vVxyXG4gICAgICB0aGlzLnNldENoZWNrcyhbXSk7XHJcbiAgICAgIC8vIOa4heepuue7hOS7tuWLvumAiVxyXG4gICAgICB0aGlzLmNsZWFyQ29tcG9uZW50Q2hlY2tzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS4u+WKqOabtOaWsOW9k+WJjeihjFxyXG4gICAqIEBwYXJhbSBkYXRhIC0g5pWw5o2uXHJcbiAgICogQHBhcmFtIGNoYW5nZSAtIOWPmOabtFxyXG4gICAqL1xyXG4gIHByaXZhdGUgY2hhbmdlQ3VycmVudFJvdyhkYXRhOiBhbnksIGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgaWYgKCF0aGlzLnVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY2hhbmdlUGF0aCA9IGNoYW5nZSAmJiBjaGFuZ2UucGF0aC5qb2luKCcvJyk7XHJcbiAgICBjb25zdCBwYXRocyA9IHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgY29uc3QgcGF0aCA9IHBhdGhzLmpvaW4oJy8nKTtcclxuICAgIGNvbnN0IGlzUGFyZW50U2VsZWN0Q2hhbmdlID0gcGF0aC5zdGFydHNXaXRoKGNoYW5nZVBhdGgpICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQgJiYgcGF0aCAhPT0gY2hhbmdlUGF0aDtcclxuICAgIGNvbnN0IGlzU2VsZlJvd0RlbGV0ZSA9IGNoYW5nZSAmJiBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUgJiYgcGF0aCA9PT0gY2hhbmdlUGF0aDtcclxuICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCAmJiBjaGFuZ2UgJiYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgfHwgaXNQYXJlbnRTZWxlY3RDaGFuZ2UgfHwgaXNTZWxmUm93RGVsZXRlKSkge1xyXG4gICAgICBjb25zdCBwcmltYXJ5S2V5ID0gdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gICAgICBjb25zdCBpZCA9IGRhdGFbMF1bJ29yaWdpbmFsRGF0YSddICYmIGRhdGFbMF1bJ29yaWdpbmFsRGF0YSddW3ByaW1hcnlLZXldO1xyXG4gICAgICBpZiAodGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQgIT09IGlkKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChpZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDkuLrmjqfku7borr7nva7lvZPliY3ooYxcclxuICAgKiBAcGFyYW0gY2hhbmdlIC0g5o6n5Yi25Zmo5Y+Y5pu0XHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZUN1cnJlbnRSb3coY2hhbmdlPzogQ2hhbmdlKSB7XHJcbiAgICBpZiAoIXRoaXMuYmluZGluZ0xpc3QgfHwgIXRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkIHx8ICF0aGlzLnVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGNoYW5nZSAmJiBjaGFuZ2UudHlwZSAhPT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkICYmIGNoYW5nZS50eXBlICE9PSBDaGFuZ2VUeXBlLkxvYWQgJiYgY2hhbmdlLnR5cGUgIT09IENoYW5nZVR5cGUuUmVtb3ZlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudC5wcmV2aWV3Q3VycmVudDtcclxuICAgIC8vIOe7hOS7tmlk5ZKM5pWw5o2uaWTov5vooYzovazmjaJcclxuICAgIGNvbnN0IGlkID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aCh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtLCB0aGlzLmZpbGVJZEtleSk7XHJcbiAgICBpZiAoaWQgPT09IGN1cnJlbnRJZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnNlbGVjdENvbXBvbmVudFJvdyhpZCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlumZhOS7tuS/oeaBr+WIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RmlsZUluZm9zKCk6IFVwbG9hZEZpbGVbXSB7XHJcbiAgICBjb25zdCBsaXN0RGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCk7XHJcbiAgICBjb25zdCBmaWxlSW5mb3M6IFVwbG9hZEZpbGVbXSA9IFtdO1xyXG4gICAgbGlzdERhdGEuZm9yRWFjaCgoaXRlbURhdGE6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlSW5mbyA9IHRoaXMuY29udmVydFRvRmlsZUluZm8oaXRlbURhdGEpO1xyXG4gICAgICBmaWxlSW5mb3MucHVzaChmaWxlSW5mbyk7XHJcbiAgICB9KTtcclxuICAgIC8vIOaOkuW6j1xyXG4gICAgaWYgKHRoaXMub3JkZXJGaWVsZCkge1xyXG4gICAgICB0aGlzLnNvcnQoZmlsZUluZm9zLCB0aGlzLm9yZGVyRmllbGQsIHRoaXMub3JkZXJUeXBlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmaWxlSW5mb3M7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOihjOaVsOaNrui9rOaNouS4uuaWh+S7tuS/oeaBr1xyXG4gICAqIEBwYXJhbSBpdGVtRGF0YSAtIOihjOaVsOaNrlxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb252ZXJ0VG9GaWxlSW5mbyhpdGVtRGF0YTogYW55KSB7XHJcbiAgICAvLyBjb25zdCBpZEtleSA9IHRoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleTtcclxuICAgIC8vIGNvbnN0IGlkID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtRGF0YSwgaWRLZXkpO1xyXG4gICAgY29uc3QgZmlsZUlkID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtRGF0YSwgdGhpcy5maWxlSWRLZXkpO1xyXG4gICAgY29uc3QgZmlsZU5hbWUgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGl0ZW1EYXRhLCB0aGlzLmZpbGVOYW1lS2V5KTtcclxuICAgIGNvbnN0IGZpbGVTaXplID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtRGF0YSwgdGhpcy5maWxlU2l6ZUtleSk7XHJcbiAgICBjb25zdCBmaWxlQ3JlYXRlVGltZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoaXRlbURhdGEsIHRoaXMuZmlsZUNyZWF0ZVRpbWVLZXkpO1xyXG5cclxuICAgIGNvbnN0IGZpbGVJbmZvOiBhbnkgPSB7XHJcbiAgICAgIGlkOiBmaWxlSWQsXHJcbiAgICAgIG5hbWU6IGZpbGVOYW1lLFxyXG4gICAgICBzaXplOiBmaWxlU2l6ZSxcclxuICAgICAgY3JlYXRlVGltZTogZmlsZUNyZWF0ZVRpbWUsXHJcbiAgICAgIG9yaWdpbmFsRGF0YTogaXRlbURhdGEsXHJcbiAgICAgIGV4dGVuZDoge1xyXG4gICAgICAgIG1ldGFkYXRhSWQ6IGZpbGVJZFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgaWYgKHRoaXMuZXh0ZW5kRmlsZUluZm8gJiYgQXJyYXkuaXNBcnJheSh0aGlzLmV4dGVuZEZpbGVJbmZvKSAmJiB0aGlzLmV4dGVuZEZpbGVJbmZvLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5leHRlbmRGaWxlSW5mby5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgZmlsZUluZm9baXRlbS5rZXldID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtRGF0YSwgaXRlbS5wYXRoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5maWxlU29ydE9yZGVyS2V5KSB7XHJcbiAgICAgIGNvbnN0IGZpbGVTb3J0T3JkZXIgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGl0ZW1EYXRhLCB0aGlzLmZpbGVTb3J0T3JkZXJLZXkpO1xyXG4gICAgICBmaWxlSW5mb1t0aGlzLlNPUlRfRklFTERfT05fU09SVElOR10gPSBmaWxlU29ydE9yZGVyO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZpbGVJbmZvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7mjqfku7bnmoTlvZPliY3ooYxcclxuICAgKiBAcGFyYW0gaWQg5Li76ZSuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZWxlY3RDb21wb25lbnRSb3coaWQpIHtcclxuICAgIGlmICh0aGlzLnVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQpIHtcclxuICAgICAgdGhpcy51cGxvYWRBbmRQcmV2aWV3Q29tcG9uZW50LnByZXZpZXdDdXJyZW50ID0gaWQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNruWtl+autei3r+W+hOiOt+WPluWAvFxyXG4gICAqIEBwYXJhbSBkYXRhIC0g5pWw5o2u5rqQXHJcbiAgICogQHBhcmFtIHBhdGggLSDlrZfmrrXot6/lvoRcclxuICAgKi9cclxuICBwcml2YXRlIGdldFZhbHVlQnlQYXRoKGRhdGE6IGFueSwgcGF0aDogc3RyaW5nKTogYW55IHtcclxuICAgIGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KCcuJyk7XHJcbiAgICBsZXQgY3VycmVudFZhbHVlID0gZGF0YTtcclxuICAgIGtleXMuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgY3VycmVudFZhbHVlID0gY3VycmVudFZhbHVlICYmIGN1cnJlbnRWYWx1ZVtrZXldO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gY3VycmVudFZhbHVlO1xyXG4gIH1cclxuICBwcml2YXRlIGdldFVkdFBhdGhzKCk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IHBhdGhzID0gdGhpcy5maWxlSWRLZXkuc3BsaXQoJy4nKTtcclxuICAgIHBhdGhzLnBvcCgpO1xyXG4gICAgcmV0dXJuIHBhdGhzO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBmaWxlU2l6ZUtleSgpIHtcclxuICAgIGNvbnN0IGJhc2VQYXRocyA9IHRoaXMuZ2V0VWR0UGF0aHMoKTtcclxuICAgIHJldHVybiBiYXNlUGF0aHMuY29uY2F0KFsnZmlsZVNpemUnXSkuam9pbignLicpO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBmaWxlQ3JlYXRlVGltZUtleSgpIHtcclxuICAgIGNvbnN0IGJhc2VQYXRocyA9IHRoaXMuZ2V0VWR0UGF0aHMoKTtcclxuICAgIHJldHVybiBiYXNlUGF0aHMuY29uY2F0KFsnZmlsZUNyZWF0ZVRpbWUnXSkuam9pbignLicpO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBjb21wb25lbnRSZWYoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wcmV2aWV3Q29tcG9uZW50IHx8IHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudCB8fCBudWxsO1xyXG4gIH1cclxuICBwcml2YXRlIHNldENoZWNrcyhpZHM6IGFueSkge1xyXG4gICAgdGhpcy5mcmFtZUNvbnRleHQudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCBpZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmuIXnqbrnu4Tku7bli77pgIlcclxuICAgKi9cclxuICBwcml2YXRlIGNsZWFyQ29tcG9uZW50Q2hlY2tzKCkge1xyXG4gICAgaWYgKHRoaXMudXBsb2FkQW5kUHJldmlld0NvbXBvbmVudCkge1xyXG4gICAgICB0aGlzLnVwbG9hZEFuZFByZXZpZXdDb21wb25lbnQucHJldmlld1VwZGF0ZVJlZnJlc2goKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHVibGljIHNvcnQoZGF0YTogYW55W10sIGZpZWxkczogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiwgZGlyZWN0aW9uczogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPikge1xyXG4gICAgaWYgKCFmaWVsZHMgfHwgZmllbGRzLmxlbmd0aCA8IDEgfHwgIWRpcmVjdGlvbnMgfHwgZGlyZWN0aW9ucy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignc29ydEJ5OmFyZ3VtZW50IGVycm9yJyk7XHJcbiAgICB9XHJcbiAgICAvLyDpu5jorqTljYfluo9cclxuICAgIGNvbnN0IGFyckZpZWxkczogQXJyYXk8c3RyaW5nPiA9IHR5cGVvZiBmaWVsZHMgPT09ICdzdHJpbmcnID8gZmllbGRzLnNwbGl0KCcsJykgOiBmaWVsZHMgfHwgW107XHJcbiAgICBjb25zdCBhcnJEaXJlY3Rpb25zOiBBcnJheTxzdHJpbmc+ID0gdHlwZW9mIGRpcmVjdGlvbnMgPT09ICdzdHJpbmcnID8gZGlyZWN0aW9ucy5zcGxpdCgnLCcpIDogZGlyZWN0aW9ucyB8fCBbXTtcclxuICAgIC8vIOaOkuW6j+Wtl+auteWSjOaOkuW6j+aWueW8j+W6lOS4gOiHtFxyXG4gICAgaWYgKGFyckZpZWxkcy5sZW5ndGggIT09IGFyckRpcmVjdGlvbnMubGVuZ3RoIHx8IGFyckZpZWxkcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignc29ydEJ5OmZpZWxkcyBhbmQgZGlyZWN0aW9ucyBub3QgbWF0Y2gnKTtcclxuICAgIH1cclxuICAgIC8vIG5hZ2UsYWdlLHRvdGFsXHJcbiAgICBjb25zdCBjb21wYXJhdG9yID0gKHByb3BzOiBBcnJheTxzdHJpbmc+LCBvcmRlcnM6IEFycmF5PHN0cmluZz4pID0+IChpdGVtMTogYW55LCBpdGVtMjogYW55KSA9PiB7XHJcbiAgICAgIHJldHVybiBwcm9wcy5yZWR1Y2UoKHJlc3VsdCwgcHJvcCkgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQgPT09IDApIHtcclxuICAgICAgICAgIGNvbnN0IG9yZGVyID0gWydhc2MnXS5pbmNsdWRlcyhvcmRlcnNbcHJvcHMuaW5kZXhPZihwcm9wKV0pID8gMSA6IC0xO1xyXG4gICAgICAgICAgY29uc3QgaXRlbTFWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbTEsIHByb3ApO1xyXG4gICAgICAgICAgY29uc3QgaXRlbTJWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbTIsIHByb3ApO1xyXG4gICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPT09IG51bGwgfHwgaXRlbTFWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGl0ZW0yVmFsdWUgPT09IG51bGwgfHwgaXRlbTJWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0xVmFsdWUgIT09IHR5cGVvZiBpdGVtMlZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvY2FsZUNvbXBhcmVSZXN1bHQgPSBTdHJpbmcoaXRlbTFWYWx1ZSkubG9jYWxlQ29tcGFyZShTdHJpbmcoaXRlbTJWYWx1ZSkpO1xyXG4gICAgICAgICAgICByZXN1bHQgPSBsb2NhbGVDb21wYXJlUmVzdWx0ICogb3JkZXI7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpdGVtMVZhbHVlID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgaXRlbTJWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYWxlQ29tcGFyZVJlc3VsdCA9IGl0ZW0xVmFsdWUubG9jYWxlQ29tcGFyZShpdGVtMlZhbHVlKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbG9jYWxlQ29tcGFyZVJlc3VsdCAqIG9yZGVyO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPiBpdGVtMlZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0ID0gb3JkZXIgKiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtMVZhbHVlIDwgaXRlbTJWYWx1ZSkge1xyXG4gICAgICAgICAgICAgIHJlc3VsdCA9IG9yZGVyICogLTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfSwgMCk7XHJcbiAgICB9O1xyXG4gICAgZGF0YS5zb3J0KGNvbXBhcmF0b3IoYXJyRmllbGRzLCBhcnJEaXJlY3Rpb25zKSk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0VmFsdWUodGFyZ2V0OiBhbnksIHByb3BOYW1lOiBzdHJpbmcpIHtcclxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBCaW5kaW5nTGlzdCkge1xyXG4gICAgICB0YXJnZXQgPSB0YXJnZXQuY3VycmVudEl0ZW07XHJcbiAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEJpbmRpbmdEYXRhKSB7XHJcbiAgICAgIHRhcmdldCA9IHRhcmdldC5saXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgfVxyXG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICBpZiAocHJvcE5hbWUuaW5kZXhPZignLicpID09PSAtMSkge1xyXG4gICAgICByZXN1bHQgPSB0YXJnZXRbcHJvcE5hbWVdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcHJvcHMgPSBwcm9wTmFtZS5zcGxpdCgnLicpO1xyXG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgcHJvcHMpIHtcclxuICAgICAgICB0YXJnZXQgPSByZXN1bHQgPSB0aGlzLmdldFZhbHVlKHRhcmdldCwgcHJvcCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWLvumAieWPmOWMluS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2ZQcmV2aWV3TXVsdGlTZWxlY3RlZEV2ZW50JywgWyckZXZlbnQnXSlcclxuICBwcml2YXRlIGNoZWNrZWRDaGFuZ2VkKGV2ZW50OiBhbnlbXSkge1xyXG4gICAgY29uc3QgcHJpbWFyeUtleSA9IHRoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleTtcclxuICAgIGNvbnN0IGlkcyA9IGV2ZW50ICYmIGV2ZW50Lm1hcCgoaXRlbSkgPT4gaXRlbSAmJiBpdGVtLm9yaWdpbmFsRGF0YSAmJiBpdGVtLm9yaWdpbmFsRGF0YVtwcmltYXJ5S2V5XSB8fCAnJykuZmlsdGVyKHAgPT4gcCkgfHwgW107XHJcbiAgICB0aGlzLnNldENoZWNrcyhpZHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDooYzliIfmjaLkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnRcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdmU2VsZWN0ZWRFdmVudCcsIFsnJGV2ZW50J10pXHJcbiAgcHJpdmF0ZSBzZWxlY3RDaGFuZ2VkKGV2ZW50OiBhbnkpIHtcclxuXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBGYXJyaXNGaWxlUHJldmlld0JpbmRpbmdEaXJlY3RpdmUgfTtcclxuIl19
/*******************************************************************************************************************
 *                                     FarrisPrimengTreeTableBindingDirective指令说明                               *
 * *****************************************************************************************************************
 *
 * 1. 依赖primeng版本: primeng:^9.0.0,primeicons:^4.0.0
 *
 * 2. 由于可编辑树表无法触发编辑单元格的关闭事件onEditComplete，因此对priemeng的node_modules\primeng\fesm5\primeng-treetable.js脚本作出修改：
 *    源码修改如下，+表示新增加的脚本语句:
 *
 *  TreeTable.prototype.updateEditingCell = function (cell, data, field) { //+ 参数增加data和field
 *      this.editingCell = cell;
 *      this.editingCellData = data; //+
 *      this.editingCellField = field; //+
 *      this.bindDocumentEditListener();
 *  };
 *
 *  TreeTable.prototype.bindDocumentEditListener = function () {
 *       var _this = this;
 *       if (!this.documentEditListener) {
 *           this.documentEditListener = function (event) {
 *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {
 *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');
 *                   _this.editingCell = null;
 *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+
 *                   _this.unbindDocumentEditListener();
 *               }
 *               _this.editingCellClick = false;
 *           };
 *           document.addEventListener('click', this.documentEditListener);
 *       }
 *   };
 *
 *  TreeTable.prototype.bindDocumentEditListener = function () {
 *       var _this = this;
 *       if (!this.documentEditListener) {
 *           this.documentEditListener = function (event) {
 *               if (_this.editingCell && !_this.editingCellClick && _this.isEditingCellValid()) {
 *                   domhandler_1.DomHandler.removeClass(_this.editingCell, 'ui-editing-cell');
 *                   _this.editingCell = null;
 *                   _this.onEditComplete.emit({ field: _this.editingCellField, data: _this.editingCellData });//+
 *                   _this.unbindDocumentEditListener();
 *               }
 *               _this.editingCellClick = false;
 *           };
 *           document.addEventListener('click', this.documentEditListener);
 *       }
 *   };
 *
 *  TTEditableColumn.prototype.openCell = function () {
 *       var _this = this;
 *        this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);//+
 *        domhandler_1.DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');
 *        this.tt.onEditInit.emit({ field: this.field, data: this.data });
 *        this.zone.runOutsideAngular(function () {
 *            setTimeout(function () {
 *                var focusable = domhandler_1.DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');
 *                if (focusable) {
 *                     focusable.focus();
 *                 }
 *             }, 50);
 *        });
 *   };
 *
 *  TTEditableColumn.prototype.onClick = function (event) {
 *        if (this.isEnabled()) {
 *            this.tt.editingCellClick = true;
 *            if (this.tt.editingCell) {
 *                if (this.tt.editingCell !== this.el.nativeElement) {
 *                    if (!this.tt.isEditingCellValid()) {
 *                        return;
 *                    }
 *                    this.tt.onEditComplete.emit({ field: this.tt.oldField, data: this.tt.oldDdata });//+
 *                    DomHandler.removeClass(this.tt.editingCell, 'ui-editing-cell');
 *                    this.openCell();
 *                }
 *            }
 *            else {
 *                this.openCell();
 *            }
 *        }
 *  };
 *
 *  TTEditableColumn.prototype.openCell = function () {
 *         var _this = this;
 *         this.tt.updateEditingCell(this.el.nativeElement,this.data, this.field);
 *         DomHandler.addClass(this.el.nativeElement, 'ui-editing-cell');
 *         this.tt.onEditInit.emit({ field: this.field, data: this.data });
 *         this.tt.oldField= this.field; //+
 *         this.tt.oldDdata=this.data;  //+
 *         this.zone.runOutsideAngular(function () {
 *             setTimeout(function () {
 *                 var focusable = DomHandler.findSingle(_this.el.nativeElement, 'input, textarea');
 *                if (focusable) {
 *                     focusable.focus();
 *                 }
 *           }, 50);
 *       });
 *   };
 *
 * 3. HTML模板
 * (1) 不启用多表头
 *      <p-treeTable [columns]="treeGridColumns" farrisPrimengTreeTableBinding farrisHierarchyInfoKey="layerField" [resizableColumns]="true" farrisPrimengTreeTableIdField="id">
 *             <ng-template pTemplate="header" let-columns>
 *                 <tr>
 *                     <th *ngFor="let col of columns" ttResizableColumn>
 *                         {{col.header}}
 *                     </th>
 *                 </tr>
 *             </ng-template>
 *             <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
 *                 <tr>
 *                     <td *ngFor="let col of columns; let i = index" ttEditableColumn [ttEditableColumn]="rowData"
 *                         [ttEditableColumnField]="col.field">
 *                         <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0"></p-treeTableToggler>
 *                         <p-treeTableCellEditor>
 *                             <ng-template pTemplate="input">
 *                                  <!-- 控件动态生成区域，此处可放置控件动态生成组件，生成规则如下：
 *                                            1. 字符串类型：文本控件
 *                                            2. 数字类型：数字控件
 *                                            3. 布尔类型：复选框控件
 *                                            4. 日期时间类型：日期时间控件
 *                                            5. 枚举类型：下拉框控件
 *                                            6. 帮助类型：帮助控件-->
 *                             </ng-template>
 *                             <ng-template pTemplate="output">{{ col | formatCellData : rowData }}</ng-template>
 *                         </p-treeTableCellEditor>
 *                     </td>
 *                 </tr>
 *             </ng-template>
 *     </p-treeTable>
 *
 * (2) 启用多表头
 *
 *  <p-treeTable [columns]="treeGridColumns" farrisPrimengTreeTableBinding farrisHierarchyInfoKey="layerField" [resizableColumns]="true" farrisPrimengTreeTableIdField="id">
 *             <ng-template pTemplate="header" let-columns>
 *                  <tr *ngFor="let columnHeader of treeGridColumnHeaders">
 *                      <th *ngFor="let col of columnHeader" ttResizableColumn [attr.rowspan]="col.rowspan" [attr.colspan]="col.colspan">
 *                          {{col.header}}
 *                      </th>
 *                  </tr>
 *             </ng-template>
 *             <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
 *                 <tr>
 *                     <td *ngFor="let col of columns; let i = index" ttEditableColumn [ttEditableColumn]="rowData"
 *                         [ttEditableColumnField]="col.field">
 *                         <p-treeTableToggler [rowNode]="rowNode" *ngIf="i === 0"></p-treeTableToggler>
 *                         <p-treeTableCellEditor>
 *                             <ng-template pTemplate="input">
 *                                  <!-- 控件动态生成区域，此处可放置控件动态生成组件，生成规则如下：
 *                                            1. 字符串类型：文本控件
 *                                            2. 数字类型：数字控件
 *                                            3. 布尔类型：复选框控件
 *                                            4. 日期时间类型：日期时间控件
 *                                            5. 枚举类型：下拉框控件
 *                                            6. 帮助类型：帮助控件-->
 *                             </ng-template>
 *                             <ng-template pTemplate="output">{{ col | formatCellData : rowData }}</ng-template>
 *                         </p-treeTableCellEditor>
 *                     </td>
 *                 </tr>
 *             </ng-template>
 *  </p-treeTable>
 *
 * 多表头数据格式：
 *  this.treeGridColumnHeaders=[
 *     [{ header: 'Brand',rowspan:3, colspan:1},{ header: 'Sale Rate',rowspan:1, colspan:4}],
 *     [{ header: 'Sales',rowspan:1, colspan:2},{ header: 'Profits',rowspan:1, colspan:2}],
 *     [{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1},{ header: 'Last Year',rowspan:1, colspan:1},{ header: 'This Year',rowspan:1, colspan:1}],
 *  ]

 **********************************************************************************************************************/
import * as tslib_1 from "tslib";
import { Directive, Input, HostListener, Output, EventEmitter } from '@angular/core';
import { FrameContext, ChangeType, ComponentType } from '@farris/devkit';
import { TreeTable } from 'primeng/treetable';
import { TreeNodeBuilderFactory } from '../tree_table_node_builder/tree_node_builder_factory';
import { DateTimeHelperService } from '@farris/ui-common/date';
var PARENT_ELEMENT = "parentElement";
var PATH = "path";
var IS_DETAIL = 'isDetail';
var FarrisPrimengTreeTableBindingDirective = /** @class */ (function () {
    function FarrisPrimengTreeTableBindingDirective(treeTable, frameContext, dateService) {
        this.treeTable = treeTable;
        this.frameContext = frameContext;
        this.dateService = dateService;
        this.selectedRowId = null;
        this.treeTableSelectedEvent = null;
        /**
         * 节点选择变更事件
         */
        this.nodeSelectChange = new EventEmitter();
        this.oldTreeNodeMap = {};
    }
    Object.defineProperty(FarrisPrimengTreeTableBindingDirective.prototype, "bindingData", {
        /**
         * 绑定数据
         */
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisPrimengTreeTableBindingDirective.prototype, "bindingList", {
        /**
         * 绑定数据列表
         */
        get: function () {
            return this.bindingData.getList();
        },
        enumerable: true,
        configurable: true
    });
    FarrisPrimengTreeTableBindingDirective.prototype.getHierarchyInfoField = function () {
        var infos = this.hierarchyInfoKey.split('/');
        return infos[infos.length - 1];
    };
    FarrisPrimengTreeTableBindingDirective.prototype.ngOnChanges = function (changes) {
    };
    FarrisPrimengTreeTableBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        //解析获取分级码字段编号
        this.hierarchyInfoField = this.getHierarchyInfoField();
        // 将分级码信息保存到root-component
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);
        this.bindingData.changes.subscribe(function (change) {
            _this.bindData(change);
            _this.updateSelectedRow(change);
        });
        this.frameContext.viewModel.uiState.setPropertyValue('ids', []);
        if (this.frameContext && this.frameContext.frameComponent) {
            this.frameContext.frameComponent.componentType = ComponentType.primengTreeComponent;
        }
    };
    /**
     * 获取树列表绑定数据对应的实体数组
     * @returns 实体数组
     */
    FarrisPrimengTreeTableBindingDirective.prototype.getEntityArr = function () {
        var entityCollection = this.frameContext.repository.entityCollection;
        var bindingPath = this.frameContext.bindingData.bindingPath;
        if (!bindingPath || bindingPath === '/') {
            return entityCollection.toArray();
        }
        var bindingList = this.frameContext.bindingData.list;
        var bindingPathArr = bindingPath.split('/').filter(function (str) { return str; });
        var pathArray = [];
        bindingPathArr.forEach(function (path) {
            pathArray.push(bindingList.primaryKey + ":" + bindingList.currentId);
            pathArray.push(path);
            bindingList = bindingList.currentItem[path];
        });
        return entityCollection.getEntitiesByPath(pathArray).toArray();
    };
    /**
     * 将真实顺序标记到对应的实体上
     * @param entityArr 实体数组
     * @param treeNodes 树节点
     */
    FarrisPrimengTreeTableBindingDirective.prototype.setActualIndex = function (entityArr, treeNodes) {
        var _this = this;
        if (entityArr.length < 1)
            return;
        // 初始化序号器并依次遍历每一棵树
        var counter = { index: 0 };
        var primaryKey = entityArr[0].primaryKey;
        treeNodes.forEach(function (rootNode) {
            _this.traverseTree(rootNode, counter, entityArr, primaryKey);
        });
    };
    /**
     * 前序递归遍历树节点并在对应实体上标记序号
     * @param treeNode 树节点
     * @param counter 序号器
     * @param entityArr 实体数组
     * @description
     * 在进行前端校验时，按照Entity在数组中的下标生成（错误提示的）行号的方式不适用于树列表，
     * 因为树列表可以在已经添加的节点上加入子节点，而Entity总是在最后追加新对象，导致二者的顺序不一定相同，
     * 所以在绑定数据的时候将树节点在列表中的真实顺序通过一个附加的属性（__ACTUAL_INDEX__）赋给Entity示例，
     * 当Entity调用validate方法时，检查是否存在该属性，如果存在则应用该属性的值作为行号。
     */
    FarrisPrimengTreeTableBindingDirective.prototype.traverseTree = function (treeNode, counter, entityArr, primaryKey) {
        var _this = this;
        var INDEX_LABEL = "__ACTUAL_INDEX__";
        // 处理当前节点
        var entity = entityArr.find(function (e) { return e[primaryKey] === treeNode.data[primaryKey]; });
        if (entity) {
            Object.defineProperty(entity, INDEX_LABEL, {
                value: counter.index
            });
            counter.index++;
        }
        // 递归遍历分支
        treeNode.children.forEach(function (rootNode) {
            _this.traverseTree(rootNode, counter, entityArr, primaryKey);
        });
    };
    /**
     * 处理数据变更
     * @param change 变更
     * @returns 是否跳过绑定数据的整体刷新
     * @description
     * 目的是尽量少的重新构造整个树列表，比如在发生值变化事件时尽量只更改变化的值就结束，
     * 如果任何变化都重新构造树，会导致Tab键切换功能难以实现等问题。
     */
    FarrisPrimengTreeTableBindingDirective.prototype.handleChange = function (change) {
        // 没有变更时，继续绑定数据刷新
        if (!change)
            return false;
        // 分类处理具体的变更
        switch (change.type) {
            case ChangeType.SelectionChanged:
                return this.handleSelectionChanged(change);
            case ChangeType.GlobalSelectionChanged:
                return this.handleSelectionChanged(change);
            case ChangeType.ValueChanged:
                return this.handleValueChanged(change);
            default:
                return false;
        }
    };
    /**
     * 处理行切换变更
     * @param change 变更
     * @returns 是否跳过绑定数据的整体刷新
     */
    FarrisPrimengTreeTableBindingDirective.prototype.handleSelectionChanged = function (change) {
        // 当前绑定路径下发生行切换事件，不进行数据刷新（为了支持Tab键切换单元格）
        if (change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) {
            var path = change.path;
            var frmPath = this.bindingData.bindingPath.split("/").filter(function (str) { return str; });
            if (path.length === frmPath.length) {
                var same = true;
                for (var i = 0; i < path.length; i++) {
                    if (path[i] !== frmPath[i])
                        same = false;
                }
                if (same)
                    return true;
            }
        }
        return false;
    };
    /**
     * 处理行切换变更
     * @param change 变更
     * @returns 是否跳过绑定数据的整体刷新
     */
    FarrisPrimengTreeTableBindingDirective.prototype.handleValueChanged = function (change) {
        var e_1, _a, e_2, _b;
        if (change.type !== ChangeType.ValueChanged) {
            return false;
        }
        // 接收到值变化事件，尝试仅进行局部数据的更新（为了支持Tab键切换单元格）
        var path = change.path;
        var bindingPathArr = this.bindingData.bindingPath.split("/").filter(function (str) { return str; });
        try {
            // 判断绑定路径是否相同，如果不相同则整体刷新
            for (var bindingPathArr_1 = tslib_1.__values(bindingPathArr), bindingPathArr_1_1 = bindingPathArr_1.next(); !bindingPathArr_1_1.done; bindingPathArr_1_1 = bindingPathArr_1.next()) {
                var item = bindingPathArr_1_1.value;
                if (path.length > 0) {
                    if (item === path[0]) {
                        path.shift();
                    }
                    else {
                        return false;
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (bindingPathArr_1_1 && !bindingPathArr_1_1.done && (_a = bindingPathArr_1.return)) _a.call(bindingPathArr_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // 通过id找到待更新的树节点
        var id = change.id;
        if (id) {
            var primaryKey = this.bindingList.primaryKey;
            var nodes = this.treeTable.value;
            var targetNode = null;
            try {
                for (var nodes_1 = tslib_1.__values(nodes), nodes_1_1 = nodes_1.next(); !nodes_1_1.done; nodes_1_1 = nodes_1.next()) {
                    var node = nodes_1_1.value;
                    var result = this.findTreeNodeById(node, primaryKey, id);
                    if (result) {
                        targetNode = result;
                        break;
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (nodes_1_1 && !nodes_1_1.done && (_b = nodes_1.return)) _b.call(nodes_1);
                }
                finally { if (e_2) throw e_2.error; }
            }
            if (targetNode && path.length === 1) {
                var propertyName = path.shift();
                if (targetNode.data.hasOwnProperty(propertyName) && change.hasOwnProperty("value")) {
                    targetNode.data[propertyName] = change.value;
                    return true;
                }
            }
        }
        return false;
    };
    /**
     * 通过主键值查找树节点
     * @param treeNode 树根节点
     * @param primaryKey 主键名
     * @param keyValue 主键值
     * @returns 树节点
     * @todo 递归遍历实现比较低效，考虑通过oldTreeNodeMap查找树节点
     */
    FarrisPrimengTreeTableBindingDirective.prototype.findTreeNodeById = function (treeNode, primaryKey, keyValue) {
        var e_3, _a;
        if (!treeNode)
            return null;
        if (treeNode.data.hasOwnProperty(primaryKey) && treeNode.data[primaryKey] === keyValue)
            return treeNode;
        if (treeNode.children) {
            try {
                for (var _b = tslib_1.__values(treeNode.children), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var node = _c.value;
                    var result = this.findTreeNodeById(node, primaryKey, keyValue);
                    if (result)
                        return result;
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        return null;
    };
    /**
    * 绑定数据
    */
    FarrisPrimengTreeTableBindingDirective.prototype.bindData = function (change) {
        var skipRefresh = this.handleChange(change);
        if (skipRefresh) {
            return;
        }
        // this.sourceData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        var oldTreeNodes = this.treeTable.value;
        var treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        var treeNodes = [];
        if (treeNodesData && treeNodesData.length > 0) {
            var hierarchyInfo = treeNodesData[0][this.hierarchyInfoField];
            var builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);
            // 服务器返回的分级节点信息匹配不到现有工厂里面的任何一种情况。确认新加的builder已经在工厂中注册
            if (builder == null) {
                throw new Error('TreeTable builder is null!');
            }
            var expandLevel = -1;
            var treeExpandLevel = this.treeTable['expandLevel'];
            if (typeof treeExpandLevel !== 'undefined') {
                expandLevel = treeExpandLevel;
            }
            var context = {
                expandLevel: expandLevel,
                component: this.treeTable,
            };
            var treeNodesBuilder = new builder(treeNodesData, oldTreeNodes, this.bindingList.primaryKey, this.hierarchyInfoField, context);
            treeNodes = treeNodesBuilder.build();
            // 获取绑定数据对应的实体列表
            var entityArr = this.getEntityArr();
            // 根据treeNodes的顺序在对应的实体上添加序号字段__ACTUAL_INDEX__
            this.setActualIndex(entityArr, treeNodes);
        }
        if (!this.treeTable.lazy) {
            this.treeTable.totalRecords = (this.treeTable._value ? this.treeTable._value.length : 0);
            if (this.treeTable.sortMode == 'single' && this.treeTable.sortField)
                this.treeTable.sortSingle();
            else if (this.treeTable.sortMode == 'multiple' && this.treeTable.multiSortMeta)
                this.treeTable.sortMultiple();
            else if (this.treeTable.hasFilter()) //sort already filters
                this.treeTable._filter();
        }
        this.treeTable.tableService.onUIUpdate(treeNodes);
        this.treeTable.value = treeNodes;
        this.treeTable.updateSerializedValue();
        // this.treeNodeMap = {};
        // this.sourceDataClone = this.sourceData;
        // this.treeTable.value = [...this.treeNodesBuilder()];
        // this.treeTableValueHandler();
    };
    FarrisPrimengTreeTableBindingDirective.prototype.updateSelectedRow = function (change) {
        var currentId = this.bindingList.currentId;
        if (this.treeTableSelectedEvent) {
            this.treeTableSelectedEvent = false;
            this.selectedRowId = currentId;
            return;
        }
        var serializedValue = this.treeTable.serializedValue;
        var treeNode = serializedValue && serializedValue.find(function (item) { return item && item.node && item.node.data && item.node.data.id === currentId; }) || null;
        if (treeNode) {
            if (this.treeTable.isSelected(treeNode.node) || currentId === this.selectedRowId) {
                return;
            }
            this.selectedRowId = currentId;
            this.treeTable.handleRowClick({ rowNode: treeNode, originalEvent: { target: { nodeName: '' } } });
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onEditInitHandler = function (event) {
        this.nodeSelectChange.emit(event['data']);
        var id = event.data[this.idField];
        this.setCurrentIdToBindingList(id);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onEditCompleteHandler = function (event) {
        var fieldName = event.field;
        var column = this.columns.find(function (item) { return item.field === fieldName; });
        if (fieldName && column && column.editor && column.editor.options && column.editor.options.type === 'EditorTypes.LOOKUP') {
            return;
        }
        if (event && event.hasOwnProperty('data')) {
            var primaryKeyValue = event.data[this.frameContext.repository.primaryKey];
            var value = this.getValue(fieldName, event.data);
            var bindingPath = this.frameContext.viewModel.bindingPath || '/';
            var bindingPaths = bindingPath.split('/').filter(function (p) { return p; });
            var bindingList = this.bindingData.getValue(bindingPaths);
            var bindingObject = bindingList.findById(primaryKeyValue);
            var oldValue = this.getValue(fieldName, bindingObject);
            var column_1 = this.treeTable.columns.find(function (item) { return item.field === fieldName; });
            var dataType = column_1 && column_1.dataType || null;
            if (dataType === 'date' || dataType === 'datetime') {
                if (this.dateService) {
                    var format = column_1 && column_1.formatter && column_1.formatter.options && column_1.formatter.options.format || 'yyyy-MM-dd';
                    value = this.dateService.formatTo(value, format);
                    if (!value) {
                        value = null;
                    }
                }
            }
            else if (dataType === 'number') {
                value = Number(value);
            }
            if (value !== oldValue) {
                this.updateBindingList(primaryKeyValue, fieldName, value);
            }
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeExpandHandler = function (event) {
        // this.setNodeExpandedValue(event);
        var selectedId = event && event.node && event.node.id || null;
        if (!selectedId) {
            return;
        }
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        var expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(selectedId);
        virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeCollapseHandler = function (event) {
        // this.setNodeExpandedValue(event);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeSelectHandler = function (event) {
        var id = event && event.node && event.node.data && event.node.data[this.frameContext.repository.primaryKey] || null;
        if (id === this.bindingList.currentId) {
            return;
        }
        this.treeTableSelectedEvent = true;
        this.setCurrentIdToBindingList(id);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.onNodeUnselectHandler = function (event) {
        this.setCurrentIdToBindingList(null);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.setNodeExpandedValue = function (event) {
        if (!event || !this.oldTreeNodeMap || Object.keys(this.oldTreeNodeMap).length <= 0) {
            return;
        }
        try {
            var currentId = event.node.data.id;
            this.oldTreeNodeMap[currentId].expanded = event.expanded;
        }
        catch (e) {
            console.warn("setNodeExpandedValue error:" + e.message);
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.setCurrentIdToBindingList = function (selectedId) {
        var oldCurrentId = this.bindingList.currentId;
        if (oldCurrentId === selectedId) {
            return;
        }
        this.bindingList.setCurrentId(selectedId, true);
    };
    FarrisPrimengTreeTableBindingDirective.prototype.getPaths = function () {
        var paths = [];
        if (!this.frameContext.viewModel || !this.frameContext.viewModel.bindingPath || this.frameContext.viewModel.bindingPath === '/') {
            return paths;
        }
        else {
            var bindingPath = this.frameContext.viewModel.bindingPath;
            paths = bindingPath.substring(1, bindingPath.length).split('/');
            return paths;
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.updateBindingList = function (primaryValue, propertyName, value) {
        if (!propertyName) {
            return;
        }
        // 更新主表部分行的字段
        var propertyNames = propertyName.split('.').filter(function (item) { return item; });
        var bindingPath = this.getBindingPathArray();
        // 取出来的一定是bindingList
        var list = this.bindingData.getValue(bindingPath);
        // 修改的是当前行
        var paths = bindingPath.concat(propertyNames);
        if (list && primaryValue === list.currentItem.primaryKeyValue) {
            this.bindingData.setValue(paths, value, true, true);
            return;
        }
        var bindingObject = this.bindingList.findById(primaryValue);
        if (!bindingObject) {
            return;
        }
        if (propertyNames.length < 2) {
            bindingObject.setValue(propertyName, value, true, true, undefined, this.bindingData.getValudChangeInvokerFactory()(paths));
        }
        else {
            var targetBindingObject_1 = null;
            var fpaths = propertyNames.slice(0, propertyNames.length - 1);
            var targetPropertyName = propertyNames[propertyNames.length - 1];
            fpaths.forEach(function (prop) {
                targetBindingObject_1 = targetBindingObject_1 && targetBindingObject_1[prop] || bindingObject[prop];
            });
            // todo:需要添加值变化事件
            targetBindingObject_1.setValue(targetPropertyName, value, true, true, undefined, this.bindingData.getValudChangeInvokerFactory()(paths));
        }
    };
    FarrisPrimengTreeTableBindingDirective.prototype.getBindingPathArray = function () {
        var path = this.frameContext.viewModel.bindingPath;
        if (path) {
            return path.split('/').filter(function (n) { return n !== ''; });
        }
        return [];
    };
    FarrisPrimengTreeTableBindingDirective.prototype.getValue = function (path, data) {
        var value = '';
        if (path.indexOf('.') === -1) {
            value = data[path];
        }
        else {
            value = path.split('.').reduce(function (result, prop) {
                return result[prop];
            }, data);
        }
        return value;
    };
    FarrisPrimengTreeTableBindingDirective.prototype.setChecks = function (ids) {
        this.frameContext.viewModel.uiState.setPropertyValue('ids', ids);
    };
    FarrisPrimengTreeTableBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisPrimengTreeTableBinding]'
                },] }
    ];
    /** @nocollapse */
    FarrisPrimengTreeTableBindingDirective.ctorParameters = function () { return [
        { type: TreeTable },
        { type: FrameContext },
        { type: DateTimeHelperService }
    ]; };
    FarrisPrimengTreeTableBindingDirective.propDecorators = {
        hierarchyInfoKey: [{ type: Input, args: ['farrisHierarchyInfoKey',] }],
        columns: [{ type: Input, args: ['columns',] }],
        idField: [{ type: Input, args: ['farrisPrimengTreeTableIdField',] }],
        nodeSelectChange: [{ type: Output }],
        onEditInitHandler: [{ type: HostListener, args: ['onEditInit', ['$event'],] }],
        onEditCompleteHandler: [{ type: HostListener, args: ['onEditComplete', ['$event'],] }],
        onNodeExpandHandler: [{ type: HostListener, args: ['onNodeExpand', ['$event'],] }],
        onNodeCollapseHandler: [{ type: HostListener, args: ['onNodeCollapse', ['$event'],] }],
        onNodeSelectHandler: [{ type: HostListener, args: ['onNodeSelect', ['$event'],] }],
        onNodeUnselectHandler: [{ type: HostListener, args: ['onNodeUnselect', ['$event'],] }]
    };
    return FarrisPrimengTreeTableBindingDirective;
}());
export { FarrisPrimengTreeTableBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmFycmlzUHJpbWVuZ1RyZWVUYWJsZUJpbmRpbmdEaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9wcmltZW5nLXRyZWUtZ3JpZC9GYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7d0hBMEt3SDs7QUFFeEgsT0FBTyxFQUFFLFNBQVMsRUFBb0MsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFRLE1BQU0sZUFBZSxDQUFDO0FBQzdILE9BQU8sRUFBNEIsWUFBWSxFQUFVLFVBQVUsRUFBd0MsYUFBYSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakosT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRTlDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBQzlGLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELElBQU0sY0FBYyxHQUFXLGVBQWUsQ0FBQztBQUMvQyxJQUFNLElBQUksR0FBVyxNQUFNLENBQUM7QUFDNUIsSUFBTSxTQUFTLEdBQVcsVUFBVSxDQUFDO0FBTXJDO0lBbURFLGdEQUNVLFNBQW9CLEVBQ3BCLFlBQTBCLEVBQzFCLFdBQWtDO1FBRmxDLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsZ0JBQVcsR0FBWCxXQUFXLENB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QUFDLCtCQUErQjttQ0FNckMsTUFBTTtvQ0FrVE4sWUFBWSxTQUFDLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQzt3Q0FRckMsWUFBWSxTQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDO3NDQW1DekMsWUFBWSxTQUFDLGNBQWMsRUFBRSxDQUFDLFFBQVEsQ0FBQzt3Q0FhdkMsWUFBWSxTQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDO3NDQUl6QyxZQUFZLFNBQUMsY0FBYyxFQUFFLENBQUMsUUFBUSxDQUFDO3dDQVN2QyxZQUFZLFNBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBdUY1Qyw2Q0FBQztDQUFBLEFBcGVELElBb2VDO1NBamVZLHNDQUFzQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhcnJpc1ByaW1lbmdUcmVlVGFibGVCaW5kaW5nRGlyZWN0aXZl5oyH5Luk6K+05piOICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcclxuICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICogXHJcbiAqIDEuIOS+nei1lnByaW1lbmfniYjmnKw6IHByaW1lbmc6XjkuMC4wLHByaW1laWNvbnM6XjQuMC4wXHJcbiAqIFxyXG4gKiAyLiDnlLHkuo7lj6/nvJbovpHmoJHooajml6Dms5Xop6blj5HnvJbovpHljZXlhYPmoLznmoTlhbPpl63kuovku7ZvbkVkaXRDb21wbGV0Ze+8jOWboOatpOWvuXByaWVtZW5n55qEbm9kZV9tb2R1bGVzXFxwcmltZW5nXFxmZXNtNVxccHJpbWVuZy10cmVldGFibGUuanPohJrmnKzkvZzlh7rkv67mlLnvvJogXHJcbiAqICAgIOa6kOeggeS/ruaUueWmguS4i++8jCvooajnpLrmlrDlop7liqDnmoTohJrmnKzor63lj6U6XHJcbiAqIFxyXG4gKiAgVHJlZVRhYmxlLnByb3RvdHlwZS51cGRhdGVFZGl0aW5nQ2VsbCA9IGZ1bmN0aW9uIChjZWxsLCBkYXRhLCBmaWVsZCkgeyAvLysg5Y+C5pWw5aKe5YqgZGF0YeWSjGZpZWxkXHJcbiAqICAgICAgdGhpcy5lZGl0aW5nQ2VsbCA9IGNlbGw7XHJcbiAqICAgICAgdGhpcy5lZGl0aW5nQ2VsbERhdGEgPSBkYXRhOyAvLytcclxuICogICAgICB0aGlzLmVkaXRpbmdDZWxsRmllbGQgPSBmaWVsZDsgLy8rXHJcbiAqICAgICAgdGhpcy5iaW5kRG9jdW1lbnRFZGl0TGlzdGVuZXIoKTtcclxuICogIH07XHJcbiAqIFxyXG4gKiAgVHJlZVRhYmxlLnByb3RvdHlwZS5iaW5kRG9jdW1lbnRFZGl0TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAqICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAqICAgICAgIGlmICghdGhpcy5kb2N1bWVudEVkaXRMaXN0ZW5lcikge1xyXG4gKiAgICAgICAgICAgdGhpcy5kb2N1bWVudEVkaXRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gKiAgICAgICAgICAgICAgIGlmIChfdGhpcy5lZGl0aW5nQ2VsbCAmJiAhX3RoaXMuZWRpdGluZ0NlbGxDbGljayAmJiBfdGhpcy5pc0VkaXRpbmdDZWxsVmFsaWQoKSkge1xyXG4gKiAgICAgICAgICAgICAgICAgICBkb21oYW5kbGVyXzEuRG9tSGFuZGxlci5yZW1vdmVDbGFzcyhfdGhpcy5lZGl0aW5nQ2VsbCwgJ3VpLWVkaXRpbmctY2VsbCcpO1xyXG4gKiAgICAgICAgICAgICAgICAgICBfdGhpcy5lZGl0aW5nQ2VsbCA9IG51bGw7XHJcbiAqICAgICAgICAgICAgICAgICAgIF90aGlzLm9uRWRpdENvbXBsZXRlLmVtaXQoeyBmaWVsZDogX3RoaXMuZWRpdGluZ0NlbGxGaWVsZCwgZGF0YTogX3RoaXMuZWRpdGluZ0NlbGxEYXRhIH0pOy8vK1xyXG4gKiAgICAgICAgICAgICAgICAgICBfdGhpcy51bmJpbmREb2N1bWVudEVkaXRMaXN0ZW5lcigpO1xyXG4gKiAgICAgICAgICAgICAgIH1cclxuICogICAgICAgICAgICAgICBfdGhpcy5lZGl0aW5nQ2VsbENsaWNrID0gZmFsc2U7XHJcbiAqICAgICAgICAgICB9O1xyXG4gKiAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmRvY3VtZW50RWRpdExpc3RlbmVyKTtcclxuICogICAgICAgfVxyXG4gKiAgIH07XHJcbiAqIFxyXG4gKiAgVHJlZVRhYmxlLnByb3RvdHlwZS5iaW5kRG9jdW1lbnRFZGl0TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAqICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAqICAgICAgIGlmICghdGhpcy5kb2N1bWVudEVkaXRMaXN0ZW5lcikge1xyXG4gKiAgICAgICAgICAgdGhpcy5kb2N1bWVudEVkaXRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gKiAgICAgICAgICAgICAgIGlmIChfdGhpcy5lZGl0aW5nQ2VsbCAmJiAhX3RoaXMuZWRpdGluZ0NlbGxDbGljayAmJiBfdGhpcy5pc0VkaXRpbmdDZWxsVmFsaWQoKSkge1xyXG4gKiAgICAgICAgICAgICAgICAgICBkb21oYW5kbGVyXzEuRG9tSGFuZGxlci5yZW1vdmVDbGFzcyhfdGhpcy5lZGl0aW5nQ2VsbCwgJ3VpLWVkaXRpbmctY2VsbCcpO1xyXG4gKiAgICAgICAgICAgICAgICAgICBfdGhpcy5lZGl0aW5nQ2VsbCA9IG51bGw7XHJcbiAqICAgICAgICAgICAgICAgICAgIF90aGlzLm9uRWRpdENvbXBsZXRlLmVtaXQoeyBmaWVsZDogX3RoaXMuZWRpdGluZ0NlbGxGaWVsZCwgZGF0YTogX3RoaXMuZWRpdGluZ0NlbGxEYXRhIH0pOy8vK1xyXG4gKiAgICAgICAgICAgICAgICAgICBfdGhpcy51bmJpbmREb2N1bWVudEVkaXRMaXN0ZW5lcigpO1xyXG4gKiAgICAgICAgICAgICAgIH1cclxuICogICAgICAgICAgICAgICBfdGhpcy5lZGl0aW5nQ2VsbENsaWNrID0gZmFsc2U7XHJcbiAqICAgICAgICAgICB9O1xyXG4gKiAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmRvY3VtZW50RWRpdExpc3RlbmVyKTtcclxuICogICAgICAgfVxyXG4gKiAgIH07XHJcbiAqIFxyXG4gKiAgVFRFZGl0YWJsZUNvbHVtbi5wcm90b3R5cGUub3BlbkNlbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAqICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAqICAgICAgICB0aGlzLnR0LnVwZGF0ZUVkaXRpbmdDZWxsKHRoaXMuZWwubmF0aXZlRWxlbWVudCx0aGlzLmRhdGEsIHRoaXMuZmllbGQpOy8vK1xyXG4gKiAgICAgICAgZG9taGFuZGxlcl8xLkRvbUhhbmRsZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAndWktZWRpdGluZy1jZWxsJyk7XHJcbiAqICAgICAgICB0aGlzLnR0Lm9uRWRpdEluaXQuZW1pdCh7IGZpZWxkOiB0aGlzLmZpZWxkLCBkYXRhOiB0aGlzLmRhdGEgfSk7XHJcbiAqICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gKiAgICAgICAgICAgICAgICB2YXIgZm9jdXNhYmxlID0gZG9taGFuZGxlcl8xLkRvbUhhbmRsZXIuZmluZFNpbmdsZShfdGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnaW5wdXQsIHRleHRhcmVhJyk7XHJcbiAqICAgICAgICAgICAgICAgIGlmIChmb2N1c2FibGUpIHtcclxuICogICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGUuZm9jdXMoKTtcclxuICogICAgICAgICAgICAgICAgIH1cclxuICogICAgICAgICAgICAgfSwgNTApO1xyXG4gKiAgICAgICAgfSk7XHJcbiAqICAgfTtcclxuICogXHJcbiAqICBUVEVkaXRhYmxlQ29sdW1uLnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAqICAgICAgICBpZiAodGhpcy5pc0VuYWJsZWQoKSkge1xyXG4gKiAgICAgICAgICAgIHRoaXMudHQuZWRpdGluZ0NlbGxDbGljayA9IHRydWU7XHJcbiAqICAgICAgICAgICAgaWYgKHRoaXMudHQuZWRpdGluZ0NlbGwpIHtcclxuICogICAgICAgICAgICAgICAgaWYgKHRoaXMudHQuZWRpdGluZ0NlbGwgIT09IHRoaXMuZWwubmF0aXZlRWxlbWVudCkge1xyXG4gKiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnR0LmlzRWRpdGluZ0NlbGxWYWxpZCgpKSB7XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gKiAgICAgICAgICAgICAgICAgICAgfVxyXG4gKiAgICAgICAgICAgICAgICAgICAgdGhpcy50dC5vbkVkaXRDb21wbGV0ZS5lbWl0KHsgZmllbGQ6IHRoaXMudHQub2xkRmllbGQsIGRhdGE6IHRoaXMudHQub2xkRGRhdGEgfSk7Ly8rXHJcbiAqICAgICAgICAgICAgICAgICAgICBEb21IYW5kbGVyLnJlbW92ZUNsYXNzKHRoaXMudHQuZWRpdGluZ0NlbGwsICd1aS1lZGl0aW5nLWNlbGwnKTtcclxuICogICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGwoKTtcclxuICogICAgICAgICAgICAgICAgfVxyXG4gKiAgICAgICAgICAgIH1cclxuICogICAgICAgICAgICBlbHNlIHtcclxuICogICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbCgpO1xyXG4gKiAgICAgICAgICAgIH1cclxuICogICAgICAgIH1cclxuICogIH07XHJcbiAqIFxyXG4gKiAgVFRFZGl0YWJsZUNvbHVtbi5wcm90b3R5cGUub3BlbkNlbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAqICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICogICAgICAgICB0aGlzLnR0LnVwZGF0ZUVkaXRpbmdDZWxsKHRoaXMuZWwubmF0aXZlRWxlbWVudCx0aGlzLmRhdGEsIHRoaXMuZmllbGQpO1xyXG4gKiAgICAgICAgIERvbUhhbmRsZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAndWktZWRpdGluZy1jZWxsJyk7XHJcbiAqICAgICAgICAgdGhpcy50dC5vbkVkaXRJbml0LmVtaXQoeyBmaWVsZDogdGhpcy5maWVsZCwgZGF0YTogdGhpcy5kYXRhIH0pO1xyXG4gKiAgICAgICAgIHRoaXMudHQub2xkRmllbGQ9IHRoaXMuZmllbGQ7IC8vK1xyXG4gKiAgICAgICAgIHRoaXMudHQub2xkRGRhdGE9dGhpcy5kYXRhOyAgLy8rXHJcbiAqICAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKGZ1bmN0aW9uICgpIHtcclxuICogICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAqICAgICAgICAgICAgICAgICB2YXIgZm9jdXNhYmxlID0gRG9tSGFuZGxlci5maW5kU2luZ2xlKF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdpbnB1dCwgdGV4dGFyZWEnKTtcclxuICogICAgICAgICAgICAgICAgaWYgKGZvY3VzYWJsZSkge1xyXG4gKiAgICAgICAgICAgICAgICAgICAgIGZvY3VzYWJsZS5mb2N1cygpO1xyXG4gKiAgICAgICAgICAgICAgICAgfVxyXG4gKiAgICAgICAgICAgfSwgNTApO1xyXG4gKiAgICAgICB9KTtcclxuICogICB9O1xyXG4gKiBcclxuICogMy4gSFRNTOaooeadv1xyXG4gKiAoMSkg5LiN5ZCv55So5aSa6KGo5aS0XHJcbiAqICAgICAgPHAtdHJlZVRhYmxlIFtjb2x1bW5zXT1cInRyZWVHcmlkQ29sdW1uc1wiIGZhcnJpc1ByaW1lbmdUcmVlVGFibGVCaW5kaW5nIGZhcnJpc0hpZXJhcmNoeUluZm9LZXk9XCJsYXllckZpZWxkXCIgW3Jlc2l6YWJsZUNvbHVtbnNdPVwidHJ1ZVwiIGZhcnJpc1ByaW1lbmdUcmVlVGFibGVJZEZpZWxkPVwiaWRcIj5cclxuICogICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImhlYWRlclwiIGxldC1jb2x1bW5zPlxyXG4gKiAgICAgICAgICAgICAgICAgPHRyPlxyXG4gKiAgICAgICAgICAgICAgICAgICAgIDx0aCAqbmdGb3I9XCJsZXQgY29sIG9mIGNvbHVtbnNcIiB0dFJlc2l6YWJsZUNvbHVtbj5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAge3tjb2wuaGVhZGVyfX1cclxuICogICAgICAgICAgICAgICAgICAgICA8L3RoPlxyXG4gKiAgICAgICAgICAgICAgICAgPC90cj5cclxuICogICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cclxuICogICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImJvZHlcIiBsZXQtcm93Tm9kZSBsZXQtcm93RGF0YT1cInJvd0RhdGFcIiBsZXQtY29sdW1ucz1cImNvbHVtbnNcIj5cclxuICogICAgICAgICAgICAgICAgIDx0cj5cclxuICogICAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zOyBsZXQgaSA9IGluZGV4XCIgdHRFZGl0YWJsZUNvbHVtbiBbdHRFZGl0YWJsZUNvbHVtbl09XCJyb3dEYXRhXCJcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgW3R0RWRpdGFibGVDb2x1bW5GaWVsZF09XCJjb2wuZmllbGRcIj5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgPHAtdHJlZVRhYmxlVG9nZ2xlciBbcm93Tm9kZV09XCJyb3dOb2RlXCIgKm5nSWY9XCJpID09PSAwXCI+PC9wLXRyZWVUYWJsZVRvZ2dsZXI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIDxwLXRyZWVUYWJsZUNlbGxFZGl0b3I+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiaW5wdXRcIj5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSDmjqfku7bliqjmgIHnlJ/miJDljLrln5/vvIzmraTlpITlj6/mlL7nva7mjqfku7bliqjmgIHnlJ/miJDnu4Tku7bvvIznlJ/miJDop4TliJnlpoLkuIvvvJpcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEuIOWtl+espuS4suexu+Wei++8muaWh+acrOaOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMi4g5pWw5a2X57G75Z6L77ya5pWw5a2X5o6n5Lu2XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLiDluIPlsJTnsbvlnovvvJrlpI3pgInmoYbmjqfku7ZcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQuIOaXpeacn+aXtumXtOexu+Wei++8muaXpeacn+aXtumXtOaOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNS4g5p6a5Li+57G75Z6L77ya5LiL5ouJ5qGG5o6n5Lu2XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA2LiDluK7liqnnsbvlnovvvJrluK7liqnmjqfku7YtLT5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwib3V0cHV0XCI+e3sgY29sIHwgZm9ybWF0Q2VsbERhdGEgOiByb3dEYXRhIH19PC9uZy10ZW1wbGF0ZT5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgPC9wLXRyZWVUYWJsZUNlbGxFZGl0b3I+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgPC90ZD5cclxuICogICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAqICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAqICAgICA8L3AtdHJlZVRhYmxlPlxyXG4gKiBcclxuICogKDIpIOWQr+eUqOWkmuihqOWktFxyXG4gKiBcclxuICogIDxwLXRyZWVUYWJsZSBbY29sdW1uc109XCJ0cmVlR3JpZENvbHVtbnNcIiBmYXJyaXNQcmltZW5nVHJlZVRhYmxlQmluZGluZyBmYXJyaXNIaWVyYXJjaHlJbmZvS2V5PVwibGF5ZXJGaWVsZFwiIFtyZXNpemFibGVDb2x1bW5zXT1cInRydWVcIiBmYXJyaXNQcmltZW5nVHJlZVRhYmxlSWRGaWVsZD1cImlkXCI+XHJcbiAqICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBwVGVtcGxhdGU9XCJoZWFkZXJcIiBsZXQtY29sdW1ucz5cclxuICogICAgICAgICAgICAgICAgICA8dHIgKm5nRm9yPVwibGV0IGNvbHVtbkhlYWRlciBvZiB0cmVlR3JpZENvbHVtbkhlYWRlcnNcIj5cclxuICogICAgICAgICAgICAgICAgICAgICAgPHRoICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sdW1uSGVhZGVyXCIgdHRSZXNpemFibGVDb2x1bW4gW2F0dHIucm93c3Bhbl09XCJjb2wucm93c3BhblwiIFthdHRyLmNvbHNwYW5dPVwiY29sLmNvbHNwYW5cIj5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgIHt7Y29sLmhlYWRlcn19XHJcbiAqICAgICAgICAgICAgICAgICAgICAgIDwvdGg+XHJcbiAqICAgICAgICAgICAgICAgICAgPC90cj5cclxuICogICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cclxuICogICAgICAgICAgICAgPG5nLXRlbXBsYXRlIHBUZW1wbGF0ZT1cImJvZHlcIiBsZXQtcm93Tm9kZSBsZXQtcm93RGF0YT1cInJvd0RhdGFcIiBsZXQtY29sdW1ucz1cImNvbHVtbnNcIj5cclxuICogICAgICAgICAgICAgICAgIDx0cj5cclxuICogICAgICAgICAgICAgICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zOyBsZXQgaSA9IGluZGV4XCIgdHRFZGl0YWJsZUNvbHVtbiBbdHRFZGl0YWJsZUNvbHVtbl09XCJyb3dEYXRhXCJcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgW3R0RWRpdGFibGVDb2x1bW5GaWVsZF09XCJjb2wuZmllbGRcIj5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgPHAtdHJlZVRhYmxlVG9nZ2xlciBbcm93Tm9kZV09XCJyb3dOb2RlXCIgKm5nSWY9XCJpID09PSAwXCI+PC9wLXRyZWVUYWJsZVRvZ2dsZXI+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIDxwLXRyZWVUYWJsZUNlbGxFZGl0b3I+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwiaW5wdXRcIj5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSDmjqfku7bliqjmgIHnlJ/miJDljLrln5/vvIzmraTlpITlj6/mlL7nva7mjqfku7bliqjmgIHnlJ/miJDnu4Tku7bvvIznlJ/miJDop4TliJnlpoLkuIvvvJpcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEuIOWtl+espuS4suexu+Wei++8muaWh+acrOaOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMi4g5pWw5a2X57G75Z6L77ya5pWw5a2X5o6n5Lu2XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLiDluIPlsJTnsbvlnovvvJrlpI3pgInmoYbmjqfku7ZcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQuIOaXpeacn+aXtumXtOexu+Wei++8muaXpeacn+aXtumXtOaOp+S7tlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNS4g5p6a5Li+57G75Z6L77ya5LiL5ouJ5qGG5o6n5Lu2XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA2LiDluK7liqnnsbvlnovvvJrluK7liqnmjqfku7YtLT5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgcFRlbXBsYXRlPVwib3V0cHV0XCI+e3sgY29sIHwgZm9ybWF0Q2VsbERhdGEgOiByb3dEYXRhIH19PC9uZy10ZW1wbGF0ZT5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgPC9wLXRyZWVUYWJsZUNlbGxFZGl0b3I+XHJcbiAqICAgICAgICAgICAgICAgICAgICAgPC90ZD5cclxuICogICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAqICAgICAgICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAqICA8L3AtdHJlZVRhYmxlPlxyXG4gKiBcclxuICog5aSa6KGo5aS05pWw5o2u5qC85byP77yaXHJcbiAqICB0aGlzLnRyZWVHcmlkQ29sdW1uSGVhZGVycz1bXHJcbiAqICAgICBbeyBoZWFkZXI6ICdCcmFuZCcscm93c3BhbjozLCBjb2xzcGFuOjF9LHsgaGVhZGVyOiAnU2FsZSBSYXRlJyxyb3dzcGFuOjEsIGNvbHNwYW46NH1dLFxyXG4gKiAgICAgW3sgaGVhZGVyOiAnU2FsZXMnLHJvd3NwYW46MSwgY29sc3BhbjoyfSx7IGhlYWRlcjogJ1Byb2ZpdHMnLHJvd3NwYW46MSwgY29sc3BhbjoyfV0sXHJcbiAqICAgICBbeyBoZWFkZXI6ICdMYXN0IFllYXInLHJvd3NwYW46MSwgY29sc3BhbjoxfSx7IGhlYWRlcjogJ1RoaXMgWWVhcicscm93c3BhbjoxLCBjb2xzcGFuOjF9LHsgaGVhZGVyOiAnTGFzdCBZZWFyJyxyb3dzcGFuOjEsIGNvbHNwYW46MX0seyBoZWFkZXI6ICdUaGlzIFllYXInLHJvd3NwYW46MSwgY29sc3BhbjoxfV0sXHJcbiAqICBdXHJcblxyXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbmltcG9ydCB7IERpcmVjdGl2ZSwgT25Jbml0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIElucHV0LCBIb3N0TGlzdGVuZXIsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhLCBCaW5kaW5nTGlzdCwgRnJhbWVDb250ZXh0LCBDaGFuZ2UsIENoYW5nZVR5cGUsIEVudGl0eUNvbGxlY3Rpb24sIEVudGl0eUxpc3QsIEVudGl0eSwgQ29tcG9uZW50VHlwZSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgVHJlZVRhYmxlIH0gZnJvbSAncHJpbWVuZy90cmVldGFibGUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSB9IGZyb20gJ3ByaW1lbmcvYXBpJztcclxuaW1wb3J0IHsgVHJlZU5vZGVCdWlsZGVyRmFjdG9yeSB9IGZyb20gJy4uL3RyZWVfdGFibGVfbm9kZV9idWlsZGVyL3RyZWVfbm9kZV9idWlsZGVyX2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBEYXRlVGltZUhlbHBlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9kYXRlJztcclxuY29uc3QgUEFSRU5UX0VMRU1FTlQ6IHN0cmluZyA9IFwicGFyZW50RWxlbWVudFwiO1xyXG5jb25zdCBQQVRIOiBzdHJpbmcgPSBcInBhdGhcIjtcclxuY29uc3QgSVNfREVUQUlMOiBzdHJpbmcgPSAnaXNEZXRhaWwnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBGYXJyaXNQcmltZW5nVHJlZU5vZGUgZXh0ZW5kcyBUcmVlTm9kZSB7XHJcbiAgaWQ/OiBzdHJpbmc7XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW2ZhcnJpc1ByaW1lbmdUcmVlVGFibGVCaW5kaW5nXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZhcnJpc1ByaW1lbmdUcmVlVGFibGVCaW5kaW5nRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIHByaXZhdGUgc2VsZWN0ZWRSb3dJZCA9IG51bGw7XHJcbiAgcHJpdmF0ZSB0cmVlVGFibGVTZWxlY3RlZEV2ZW50ID0gbnVsbDtcclxuICAvKipcclxuICAgKiDliIbnuqfnoIHkv6Hmga/lrZfmrrXvvIzlsZ7mgKflj6/og73mnInkuKTnp43moLzlvI/nmoTlgLzvvJrliIbnuqfnoIHlrZfmrrXvvIjkuLvooajvvInmiJbku47ooajliY3nq69jb2Rlcy/liIbnuqfnoIHlrZfmrrXvvIjlrZDooajvvIlcclxuICAgKi9cclxuICBASW5wdXQoJ2ZhcnJpc0hpZXJhcmNoeUluZm9LZXknKVxyXG4gIHB1YmxpYyBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmc7XHJcbiAgQElucHV0KCdjb2x1bW5zJylcclxuICBwdWJsaWMgY29sdW1uczogYW55O1xyXG4gIC8qKlxyXG4gICAqIOWGheegge+8jOaVsOaNrueahOWUr+S4gOagh+ivhlxyXG4gICAqL1xyXG4gIEBJbnB1dCgnZmFycmlzUHJpbWVuZ1RyZWVUYWJsZUlkRmllbGQnKVxyXG4gIHB1YmxpYyBpZEZpZWxkOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOiKgueCuemAieaLqeWPmOabtOS6i+S7tlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKSBub2RlU2VsZWN0Q2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBwcml2YXRlIG9sZFRyZWVOb2RlTWFwOiB7IFtrZXk6IHN0cmluZ106IEZhcnJpc1ByaW1lbmdUcmVlTm9kZSB9ID0ge307XHJcblxyXG5cclxuICAvKipcclxuICAgKiDliIbnuqfnoIHnmoTlrZfmrrXnvJblj7fvvIzku45oaWVyYXJjaHlJbmZvS2V55bGe5oCn5Lit6Kej5p6Q6I635Y+WXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoaWVyYXJjaHlJbmZvRmllbGQ6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0RhdGEoKTogQmluZGluZ0RhdGEge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2u5YiX6KGoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0xpc3QoKTogQmluZGluZ0xpc3Qge1xyXG4gICAgcmV0dXJuIHRoaXMuYmluZGluZ0RhdGEuZ2V0TGlzdCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRIaWVyYXJjaHlJbmZvRmllbGQoKTogc3RyaW5nIHtcclxuICAgIGxldCBpbmZvcyA9IHRoaXMuaGllcmFyY2h5SW5mb0tleS5zcGxpdCgnLycpO1xyXG4gICAgcmV0dXJuIGluZm9zW2luZm9zLmxlbmd0aCAtIDFdO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHRyZWVUYWJsZTogVHJlZVRhYmxlLFxyXG4gICAgcHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCxcclxuICAgIHByaXZhdGUgZGF0ZVNlcnZpY2U6IERhdGVUaW1lSGVscGVyU2VydmljZVxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgLy/op6PmnpDojrflj5bliIbnuqfnoIHlrZfmrrXnvJblj7dcclxuICAgIHRoaXMuaGllcmFyY2h5SW5mb0ZpZWxkID0gdGhpcy5nZXRIaWVyYXJjaHlJbmZvRmllbGQoKTtcclxuICAgIC8vIOWwhuWIhue6p+eggeS/oeaBr+S/neWtmOWIsHJvb3QtY29tcG9uZW50XHJcbiAgICBjb25zdCB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnaGllcmFyY2h5SW5mb0tleScsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLmJpbmREYXRhKGNoYW5nZSk7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRSb3coY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgW10pO1xyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0ICYmIHRoaXMuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50LmNvbXBvbmVudFR5cGUgPSBDb21wb25lbnRUeXBlLnByaW1lbmdUcmVlQ29tcG9uZW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5qCR5YiX6KGo57uR5a6a5pWw5o2u5a+55bqU55qE5a6e5L2T5pWw57uEXHJcbiAgICogQHJldHVybnMg5a6e5L2T5pWw57uEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRFbnRpdHlBcnIoKTogRW50aXR5W10ge1xyXG4gICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbiA9IHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbjtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoOiBzdHJpbmcgPSB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aDtcclxuICAgIGlmICghYmluZGluZ1BhdGggfHwgYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCk7XHJcbiAgICB9XHJcbiAgICBsZXQgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0ID0gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEubGlzdDtcclxuICAgIGxldCBiaW5kaW5nUGF0aEFycjogc3RyaW5nW10gPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihzdHIgPT4gc3RyKTtcclxuICAgIGxldCBwYXRoQXJyYXkgPSBbXTtcclxuICAgIGJpbmRpbmdQYXRoQXJyLmZvckVhY2goKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICBwYXRoQXJyYXkucHVzaChgJHtiaW5kaW5nTGlzdC5wcmltYXJ5S2V5fToke2JpbmRpbmdMaXN0LmN1cnJlbnRJZH1gKTtcclxuICAgICAgcGF0aEFycmF5LnB1c2gocGF0aCk7XHJcbiAgICAgIGJpbmRpbmdMaXN0ID0gYmluZGluZ0xpc3QuY3VycmVudEl0ZW1bcGF0aF07XHJcbiAgICB9KTtcclxuICAgIHJldHVybiAoZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdGllc0J5UGF0aChwYXRoQXJyYXkpIGFzIEVudGl0eUxpc3Q8YW55PikudG9BcnJheSgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlsIbnnJ/lrp7pobrluo/moIforrDliLDlr7nlupTnmoTlrp7kvZPkuIpcclxuICAgKiBAcGFyYW0gZW50aXR5QXJyIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSB0cmVlTm9kZXMg5qCR6IqC54K5XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRBY3R1YWxJbmRleChlbnRpdHlBcnI6IEVudGl0eVtdLCB0cmVlTm9kZXM6IFRyZWVOb2RlW10pIHtcclxuICAgIGlmIChlbnRpdHlBcnIubGVuZ3RoIDwgMSlcclxuICAgICAgcmV0dXJuO1xyXG4gICAgLy8g5Yid5aeL5YyW5bqP5Y+35Zmo5bm25L6d5qyh6YGN5Y6G5q+P5LiA5qO15qCRXHJcbiAgICBsZXQgY291bnRlciA9IHsgaW5kZXg6IDAgfTtcclxuICAgIGNvbnN0IHByaW1hcnlLZXk6IHN0cmluZyA9IGVudGl0eUFyclswXS5wcmltYXJ5S2V5O1xyXG4gICAgdHJlZU5vZGVzLmZvckVhY2goKHJvb3ROb2RlKSA9PiB7XHJcbiAgICAgIHRoaXMudHJhdmVyc2VUcmVlKHJvb3ROb2RlLCBjb3VudGVyLCBlbnRpdHlBcnIsIHByaW1hcnlLZXkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWJjeW6j+mAkuW9kumBjeWOhuagkeiKgueCueW5tuWcqOWvueW6lOWunuS9k+S4iuagh+iusOW6j+WPt1xyXG4gICAqIEBwYXJhbSB0cmVlTm9kZSDmoJHoioLngrlcclxuICAgKiBAcGFyYW0gY291bnRlciDluo/lj7flmahcclxuICAgKiBAcGFyYW0gZW50aXR5QXJyIOWunuS9k+aVsOe7hFxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIOWcqOi/m+ihjOWJjeerr+agoemqjOaXtu+8jOaMieeFp0VudGl0eeWcqOaVsOe7hOS4reeahOS4i+agh+eUn+aIkO+8iOmUmeivr+aPkOekuueahO+8ieihjOWPt+eahOaWueW8j+S4jemAgueUqOS6juagkeWIl+ihqO+8jFxyXG4gICAqIOWboOS4uuagkeWIl+ihqOWPr+S7peWcqOW3sue7j+a3u+WKoOeahOiKgueCueS4iuWKoOWFpeWtkOiKgueCue+8jOiAjEVudGl0eeaAu+aYr+WcqOacgOWQjui/veWKoOaWsOWvueixoe+8jOWvvOiHtOS6jOiAheeahOmhuuW6j+S4jeS4gOWumuebuOWQjO+8jFxyXG4gICAqIOaJgOS7peWcqOe7keWumuaVsOaNrueahOaXtuWAmeWwhuagkeiKgueCueWcqOWIl+ihqOS4reeahOecn+WunumhuuW6j+mAmui/h+S4gOS4qumZhOWKoOeahOWxnuaAp++8iF9fQUNUVUFMX0lOREVYX1/vvInotYvnu5lFbnRpdHnnpLrkvovvvIxcclxuICAgKiDlvZNFbnRpdHnosIPnlKh2YWxpZGF0ZeaWueazleaXtu+8jOajgOafpeaYr+WQpuWtmOWcqOivpeWxnuaAp++8jOWmguaenOWtmOWcqOWImeW6lOeUqOivpeWxnuaAp+eahOWAvOS9nOS4uuihjOWPt+OAglxyXG4gICAqL1xyXG4gIHByaXZhdGUgdHJhdmVyc2VUcmVlKHRyZWVOb2RlOiBUcmVlTm9kZSwgY291bnRlcjogeyBpbmRleDogbnVtYmVyIH0sIGVudGl0eUFycjogRW50aXR5W10sIHByaW1hcnlLZXk6IHN0cmluZykge1xyXG4gICAgY29uc3QgSU5ERVhfTEFCRUwgPSBcIl9fQUNUVUFMX0lOREVYX19cIjtcclxuICAgIC8vIOWkhOeQhuW9k+WJjeiKgueCuVxyXG4gICAgY29uc3QgZW50aXR5ID0gZW50aXR5QXJyLmZpbmQoZSA9PiBlW3ByaW1hcnlLZXldID09PSB0cmVlTm9kZS5kYXRhW3ByaW1hcnlLZXldKTtcclxuICAgIGlmIChlbnRpdHkpIHtcclxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGVudGl0eSwgSU5ERVhfTEFCRUwsIHtcclxuICAgICAgICB2YWx1ZTogY291bnRlci5pbmRleFxyXG4gICAgICB9KTtcclxuICAgICAgY291bnRlci5pbmRleCsrO1xyXG4gICAgfVxyXG4gICAgLy8g6YCS5b2S6YGN5Y6G5YiG5pSvXHJcbiAgICB0cmVlTm9kZS5jaGlsZHJlbi5mb3JFYWNoKChyb290Tm9kZSkgPT4ge1xyXG4gICAgICB0aGlzLnRyYXZlcnNlVHJlZShyb290Tm9kZSwgY291bnRlciwgZW50aXR5QXJyLCBwcmltYXJ5S2V5KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG5pWw5o2u5Y+Y5pu0XHJcbiAgICogQHBhcmFtIGNoYW5nZSDlj5jmm7RcclxuICAgKiBAcmV0dXJucyDmmK/lkKbot7Pov4fnu5HlrprmlbDmja7nmoTmlbTkvZPliLfmlrBcclxuICAgKiBAZGVzY3JpcHRpb25cclxuICAgKiDnm67nmoTmmK/lsL3ph4/lsJHnmoTph43mlrDmnoTpgKDmlbTkuKrmoJHliJfooajvvIzmr5TlpoLlnKjlj5HnlJ/lgLzlj5jljJbkuovku7bml7blsL3ph4/lj6rmm7TmlLnlj5jljJbnmoTlgLzlsLHnu5PmnZ/vvIxcclxuICAgKiDlpoLmnpzku7vkvZXlj5jljJbpg73ph43mlrDmnoTpgKDmoJHvvIzkvJrlr7zoh7RUYWLplK7liIfmjaLlip/og73pmr7ku6Xlrp7njrDnrYnpl67popjjgIJcclxuICAgKi9cclxuICBwcml2YXRlIGhhbmRsZUNoYW5nZShjaGFuZ2U/OiBDaGFuZ2UpOiBib29sZWFuIHtcclxuICAgIC8vIOayoeacieWPmOabtOaXtu+8jOe7p+e7ree7keWumuaVsOaNruWIt+aWsFxyXG4gICAgaWYgKCFjaGFuZ2UpXHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIC8vIOWIhuexu+WkhOeQhuWFt+S9k+eahOWPmOabtFxyXG4gICAgc3dpdGNoIChjaGFuZ2UudHlwZSkge1xyXG4gICAgICBjYXNlIENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZDpcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVTZWxlY3Rpb25DaGFuZ2VkKGNoYW5nZSk7XHJcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkOlxyXG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVNlbGVjdGlvbkNoYW5nZWQoY2hhbmdlKTtcclxuICAgICAgY2FzZSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZDpcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVWYWx1ZUNoYW5nZWQoY2hhbmdlKTtcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuihjOWIh+aNouWPmOabtFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICogQHJldHVybnMg5piv5ZCm6Lez6L+H57uR5a6a5pWw5o2u55qE5pW05L2T5Yi35pawXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVTZWxlY3Rpb25DaGFuZ2VkKGNoYW5nZTogQ2hhbmdlKTogYm9vbGVhbiB7XHJcbiAgICAvLyDlvZPliY3nu5Hlrprot6/lvoTkuIvlj5HnlJ/ooYzliIfmjaLkuovku7bvvIzkuI3ov5vooYzmlbDmja7liLfmlrDvvIjkuLrkuobmlK/mjIFUYWLplK7liIfmjaLljZXlhYPmoLzvvIlcclxuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQpIHtcclxuICAgICAgbGV0IHBhdGggPSBjaGFuZ2UucGF0aDtcclxuICAgICAgbGV0IGZybVBhdGggPSB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoLnNwbGl0KFwiL1wiKS5maWx0ZXIoc3RyID0+IHN0cik7XHJcbiAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gZnJtUGF0aC5sZW5ndGgpIHtcclxuICAgICAgICBsZXQgc2FtZSA9IHRydWU7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICBpZiAocGF0aFtpXSAhPT0gZnJtUGF0aFtpXSlcclxuICAgICAgICAgICAgc2FtZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2FtZSlcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuihjOWIh+aNouWPmOabtFxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICogQHJldHVybnMg5piv5ZCm6Lez6L+H57uR5a6a5pWw5o2u55qE5pW05L2T5Yi35pawXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVWYWx1ZUNoYW5nZWQoY2hhbmdlOiBDaGFuZ2UpOiBib29sZWFuIHtcclxuICAgIGlmIChjaGFuZ2UudHlwZSAhPT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLy8g5o6l5pS25Yiw5YC85Y+Y5YyW5LqL5Lu277yM5bCd6K+V5LuF6L+b6KGM5bGA6YOo5pWw5o2u55qE5pu05paw77yI5Li65LqG5pSv5oyBVGFi6ZSu5YiH5o2i5Y2V5YWD5qC877yJXHJcbiAgICBsZXQgcGF0aCA9IGNoYW5nZS5wYXRoO1xyXG4gICAgbGV0IGJpbmRpbmdQYXRoQXJyID0gdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aC5zcGxpdChcIi9cIikuZmlsdGVyKHN0ciA9PiBzdHIpO1xyXG4gICAgLy8g5Yik5pat57uR5a6a6Lev5b6E5piv5ZCm55u45ZCM77yM5aaC5p6c5LiN55u45ZCM5YiZ5pW05L2T5Yi35pawXHJcbiAgICBmb3IgKGxldCBpdGVtIG9mIGJpbmRpbmdQYXRoQXJyKSB7XHJcbiAgICAgIGlmIChwYXRoLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBpZiAoaXRlbSA9PT0gcGF0aFswXSkge1xyXG4gICAgICAgICAgcGF0aC5zaGlmdCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDpgJrov4dpZOaJvuWIsOW+heabtOaWsOeahOagkeiKgueCuVxyXG4gICAgbGV0IGlkID0gY2hhbmdlLmlkO1xyXG4gICAgaWYgKGlkKSB7XHJcbiAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSB0aGlzLmJpbmRpbmdMaXN0LnByaW1hcnlLZXk7XHJcbiAgICAgIGxldCBub2RlcyA9IHRoaXMudHJlZVRhYmxlLnZhbHVlO1xyXG4gICAgICBsZXQgdGFyZ2V0Tm9kZSA9IG51bGw7XHJcbiAgICAgIGZvciAobGV0IG5vZGUgb2Ygbm9kZXMpIHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5maW5kVHJlZU5vZGVCeUlkKG5vZGUsIHByaW1hcnlLZXksIGlkKTtcclxuICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICB0YXJnZXROb2RlID0gcmVzdWx0O1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmICh0YXJnZXROb2RlICYmIHBhdGgubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gcGF0aC5zaGlmdCgpO1xyXG4gICAgICAgIGlmICh0YXJnZXROb2RlLmRhdGEuaGFzT3duUHJvcGVydHkocHJvcGVydHlOYW1lKSAmJiBjaGFuZ2UuaGFzT3duUHJvcGVydHkoXCJ2YWx1ZVwiKSkge1xyXG4gICAgICAgICAgdGFyZ2V0Tm9kZS5kYXRhW3Byb3BlcnR5TmFtZV0gPSBjaGFuZ2UudmFsdWU7XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCa6L+H5Li76ZSu5YC85p+l5om+5qCR6IqC54K5XHJcbiAgICogQHBhcmFtIHRyZWVOb2RlIOagkeagueiKgueCuVxyXG4gICAqIEBwYXJhbSBwcmltYXJ5S2V5IOS4u+mUruWQjVxyXG4gICAqIEBwYXJhbSBrZXlWYWx1ZSDkuLvplK7lgLxcclxuICAgKiBAcmV0dXJucyDmoJHoioLngrlcclxuICAgKiBAdG9kbyDpgJLlvZLpgY3ljoblrp7njrDmr5TovoPkvY7mlYjvvIzogIPomZHpgJrov4dvbGRUcmVlTm9kZU1hcOafpeaJvuagkeiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZmluZFRyZWVOb2RlQnlJZCh0cmVlTm9kZTogVHJlZU5vZGUsIHByaW1hcnlLZXk6IHN0cmluZywga2V5VmFsdWU6IGFueSk6IFRyZWVOb2RlIHwgbnVsbCB7XHJcbiAgICBpZiAoIXRyZWVOb2RlKVxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIGlmICh0cmVlTm9kZS5kYXRhLmhhc093blByb3BlcnR5KHByaW1hcnlLZXkpICYmIHRyZWVOb2RlLmRhdGFbcHJpbWFyeUtleV0gPT09IGtleVZhbHVlKVxyXG4gICAgICByZXR1cm4gdHJlZU5vZGU7XHJcbiAgICBpZiAodHJlZU5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgZm9yIChsZXQgbm9kZSBvZiB0cmVlTm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmZpbmRUcmVlTm9kZUJ5SWQobm9kZSwgcHJpbWFyeUtleSwga2V5VmFsdWUpO1xyXG4gICAgICAgIGlmIChyZXN1bHQpXHJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICog57uR5a6a5pWw5o2uXHJcbiAgKi9cclxuICBwcml2YXRlIGJpbmREYXRhKGNoYW5nZT86IENoYW5nZSkge1xyXG4gICAgbGV0IHNraXBSZWZyZXNoOiBib29sZWFuID0gdGhpcy5oYW5kbGVDaGFuZ2UoY2hhbmdlKTtcclxuICAgIGlmIChza2lwUmVmcmVzaCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyB0aGlzLnNvdXJjZURhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTih7IGlnbm9yZU11bHRpTGFuZ0lucHV0OiB0cnVlIH0pO1xyXG4gICAgY29uc3Qgb2xkVHJlZU5vZGVzID0gdGhpcy50cmVlVGFibGUudmFsdWU7XHJcbiAgICBjb25zdCB0cmVlTm9kZXNEYXRhID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oeyBpZ25vcmVNdWx0aUxhbmdJbnB1dDogdHJ1ZSB9KTtcclxuICAgIGxldCB0cmVlTm9kZXM6IFRyZWVOb2RlW10gPSBbXTtcclxuXHJcbiAgICBpZiAodHJlZU5vZGVzRGF0YSAmJiB0cmVlTm9kZXNEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgbGV0IGhpZXJhcmNoeUluZm8gPSB0cmVlTm9kZXNEYXRhWzBdW3RoaXMuaGllcmFyY2h5SW5mb0ZpZWxkXTtcclxuICAgICAgY29uc3QgYnVpbGRlcjogVHlwZTxhbnk+ID0gVHJlZU5vZGVCdWlsZGVyRmFjdG9yeS5nZXRCdWlsZGVyKGhpZXJhcmNoeUluZm8pO1xyXG4gICAgICAvLyDmnI3liqHlmajov5Tlm57nmoTliIbnuqfoioLngrnkv6Hmga/ljLnphY3kuI3liLDnjrDmnInlt6XljoLph4zpnaLnmoTku7vkvZXkuIDnp43mg4XlhrXjgILnoa7orqTmlrDliqDnmoRidWlsZGVy5bey57uP5Zyo5bel5Y6C5Lit5rOo5YaMXHJcbiAgICAgIGlmIChidWlsZGVyID09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyZWVUYWJsZSBidWlsZGVyIGlzIG51bGwhJyk7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGV4cGFuZExldmVsID0gLTE7XHJcbiAgICAgIGNvbnN0IHRyZWVFeHBhbmRMZXZlbCA9IHRoaXMudHJlZVRhYmxlWydleHBhbmRMZXZlbCddO1xyXG4gICAgICBpZiAodHlwZW9mIHRyZWVFeHBhbmRMZXZlbCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICBleHBhbmRMZXZlbCA9IHRyZWVFeHBhbmRMZXZlbDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBjb250ZXh0ID0ge1xyXG4gICAgICAgIGV4cGFuZExldmVsLFxyXG4gICAgICAgIGNvbXBvbmVudDogdGhpcy50cmVlVGFibGUsXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHRyZWVOb2Rlc0J1aWxkZXIgPSBuZXcgYnVpbGRlcihcclxuICAgICAgICB0cmVlTm9kZXNEYXRhLCBvbGRUcmVlTm9kZXMsXHJcbiAgICAgICAgdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5LCB0aGlzLmhpZXJhcmNoeUluZm9GaWVsZCwgY29udGV4dFxyXG4gICAgICApO1xyXG4gICAgICB0cmVlTm9kZXMgPSB0cmVlTm9kZXNCdWlsZGVyLmJ1aWxkKCk7XHJcbiAgICAgIC8vIOiOt+WPlue7keWumuaVsOaNruWvueW6lOeahOWunuS9k+WIl+ihqFxyXG4gICAgICBsZXQgZW50aXR5QXJyOiBFbnRpdHlbXSA9IHRoaXMuZ2V0RW50aXR5QXJyKCk7XHJcbiAgICAgIC8vIOagueaNrnRyZWVOb2Rlc+eahOmhuuW6j+WcqOWvueW6lOeahOWunuS9k+S4iua3u+WKoOW6j+WPt+Wtl+autV9fQUNUVUFMX0lOREVYX19cclxuICAgICAgdGhpcy5zZXRBY3R1YWxJbmRleChlbnRpdHlBcnIsIHRyZWVOb2Rlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCF0aGlzLnRyZWVUYWJsZS5sYXp5KSB7XHJcbiAgICAgIHRoaXMudHJlZVRhYmxlLnRvdGFsUmVjb3JkcyA9ICh0aGlzLnRyZWVUYWJsZS5fdmFsdWUgPyB0aGlzLnRyZWVUYWJsZS5fdmFsdWUubGVuZ3RoIDogMCk7XHJcbiAgICAgIGlmICh0aGlzLnRyZWVUYWJsZS5zb3J0TW9kZSA9PSAnc2luZ2xlJyAmJiB0aGlzLnRyZWVUYWJsZS5zb3J0RmllbGQpXHJcbiAgICAgICAgdGhpcy50cmVlVGFibGUuc29ydFNpbmdsZSgpO1xyXG4gICAgICBlbHNlIGlmICh0aGlzLnRyZWVUYWJsZS5zb3J0TW9kZSA9PSAnbXVsdGlwbGUnICYmIHRoaXMudHJlZVRhYmxlLm11bHRpU29ydE1ldGEpXHJcbiAgICAgICAgdGhpcy50cmVlVGFibGUuc29ydE11bHRpcGxlKCk7XHJcbiAgICAgIGVsc2UgaWYgKHRoaXMudHJlZVRhYmxlLmhhc0ZpbHRlcigpKSAvL3NvcnQgYWxyZWFkeSBmaWx0ZXJzXHJcbiAgICAgICAgdGhpcy50cmVlVGFibGUuX2ZpbHRlcigpO1xyXG4gICAgfVxyXG4gICAgdGhpcy50cmVlVGFibGUudGFibGVTZXJ2aWNlLm9uVUlVcGRhdGUodHJlZU5vZGVzKTtcclxuICAgIHRoaXMudHJlZVRhYmxlLnZhbHVlID0gdHJlZU5vZGVzO1xyXG4gICAgdGhpcy50cmVlVGFibGUudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcblxyXG4gICAgLy8gdGhpcy50cmVlTm9kZU1hcCA9IHt9O1xyXG4gICAgLy8gdGhpcy5zb3VyY2VEYXRhQ2xvbmUgPSB0aGlzLnNvdXJjZURhdGE7XHJcbiAgICAvLyB0aGlzLnRyZWVUYWJsZS52YWx1ZSA9IFsuLi50aGlzLnRyZWVOb2Rlc0J1aWxkZXIoKV07XHJcbiAgICAvLyB0aGlzLnRyZWVUYWJsZVZhbHVlSGFuZGxlcigpO1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkUm93KGNoYW5nZTogQ2hhbmdlKSB7XHJcbiAgICBjb25zdCBjdXJyZW50SWQgPSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgIGlmICh0aGlzLnRyZWVUYWJsZVNlbGVjdGVkRXZlbnQpIHtcclxuICAgICAgdGhpcy50cmVlVGFibGVTZWxlY3RlZEV2ZW50ID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuc2VsZWN0ZWRSb3dJZCA9IGN1cnJlbnRJZDtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2VyaWFsaXplZFZhbHVlID0gdGhpcy50cmVlVGFibGUuc2VyaWFsaXplZFZhbHVlO1xyXG5cclxuICAgIGNvbnN0IHRyZWVOb2RlID0gc2VyaWFsaXplZFZhbHVlICYmIHNlcmlhbGl6ZWRWYWx1ZS5maW5kKGl0ZW0gPT4gaXRlbSAmJiBpdGVtLm5vZGUgJiYgaXRlbS5ub2RlLmRhdGEgJiYgaXRlbS5ub2RlLmRhdGEuaWQgPT09IGN1cnJlbnRJZCkgfHwgbnVsbDtcclxuICAgIGlmICh0cmVlTm9kZSkge1xyXG4gICAgICBpZiAodGhpcy50cmVlVGFibGUuaXNTZWxlY3RlZCh0cmVlTm9kZS5ub2RlKSB8fCBjdXJyZW50SWQgPT09IHRoaXMuc2VsZWN0ZWRSb3dJZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNlbGVjdGVkUm93SWQgPSBjdXJyZW50SWQ7XHJcbiAgICAgIHRoaXMudHJlZVRhYmxlLmhhbmRsZVJvd0NsaWNrKHsgcm93Tm9kZTogdHJlZU5vZGUsIG9yaWdpbmFsRXZlbnQ6IHsgdGFyZ2V0OiB7IG5vZGVOYW1lOiAnJyB9IH0gfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIEBIb3N0TGlzdGVuZXIoJ29uRWRpdEluaXQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBvbkVkaXRJbml0SGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICB0aGlzLm5vZGVTZWxlY3RDaGFuZ2UuZW1pdChldmVudFsnZGF0YSddKTtcclxuICAgIGNvbnN0IGlkID0gZXZlbnQuZGF0YVt0aGlzLmlkRmllbGRdO1xyXG4gICAgdGhpcy5zZXRDdXJyZW50SWRUb0JpbmRpbmdMaXN0KGlkKTtcclxuICB9XHJcblxyXG5cclxuICBASG9zdExpc3RlbmVyKCdvbkVkaXRDb21wbGV0ZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uRWRpdENvbXBsZXRlSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBsZXQgZmllbGROYW1lID0gZXZlbnQuZmllbGQ7XHJcbiAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmNvbHVtbnMuZmluZChpdGVtID0+IGl0ZW0uZmllbGQgPT09IGZpZWxkTmFtZSk7XHJcbiAgICBpZiAoZmllbGROYW1lICYmIGNvbHVtbiAmJiBjb2x1bW4uZWRpdG9yICYmIGNvbHVtbi5lZGl0b3Iub3B0aW9ucyAmJiBjb2x1bW4uZWRpdG9yLm9wdGlvbnMudHlwZSA9PT0gJ0VkaXRvclR5cGVzLkxPT0tVUCcpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGV2ZW50ICYmIGV2ZW50Lmhhc093blByb3BlcnR5KCdkYXRhJykpIHtcclxuICAgICAgY29uc3QgcHJpbWFyeUtleVZhbHVlID0gZXZlbnQuZGF0YVt0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnByaW1hcnlLZXldO1xyXG5cclxuICAgICAgbGV0IHZhbHVlOiBhbnkgPSB0aGlzLmdldFZhbHVlKGZpZWxkTmFtZSwgZXZlbnQuZGF0YSk7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoIHx8ICcvJztcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgY29uc3QgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0ID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShiaW5kaW5nUGF0aHMpO1xyXG4gICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gYmluZGluZ0xpc3QuZmluZEJ5SWQocHJpbWFyeUtleVZhbHVlKTtcclxuICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmdldFZhbHVlKGZpZWxkTmFtZSwgYmluZGluZ09iamVjdCk7XHJcbiAgICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMudHJlZVRhYmxlLmNvbHVtbnMuZmluZChpdGVtID0+IGl0ZW0uZmllbGQgPT09IGZpZWxkTmFtZSk7XHJcbiAgICAgIGNvbnN0IGRhdGFUeXBlID0gY29sdW1uICYmIGNvbHVtbi5kYXRhVHlwZSB8fCBudWxsO1xyXG4gICAgICBpZiAoZGF0YVR5cGUgPT09ICdkYXRlJyB8fCBkYXRhVHlwZSA9PT0gJ2RhdGV0aW1lJykge1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgICBjb25zdCBmb3JtYXQgPSBjb2x1bW4gJiYgY29sdW1uLmZvcm1hdHRlciAmJiBjb2x1bW4uZm9ybWF0dGVyLm9wdGlvbnMgJiYgY29sdW1uLmZvcm1hdHRlci5vcHRpb25zLmZvcm1hdCB8fCAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICB2YWx1ZSA9IHRoaXMuZGF0ZVNlcnZpY2UuZm9ybWF0VG8odmFsdWUsIGZvcm1hdCk7XHJcbiAgICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gbnVsbDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgdmFsdWUgPSBOdW1iZXIodmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh2YWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJpbmRpbmdMaXN0KHByaW1hcnlLZXlWYWx1ZSwgZmllbGROYW1lLCB2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ29uTm9kZUV4cGFuZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZUV4cGFuZEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgLy8gdGhpcy5zZXROb2RlRXhwYW5kZWRWYWx1ZShldmVudCk7XHJcbiAgICBjb25zdCBzZWxlY3RlZElkID0gZXZlbnQgJiYgZXZlbnQubm9kZSAmJiBldmVudC5ub2RlLmlkIHx8IG51bGw7XHJcbiAgICBpZiAoIXNlbGVjdGVkSWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnKSB8fCBbXTtcclxuICAgIGV4cGFuZE5vZGVzLnB1c2goc2VsZWN0ZWRJZCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdvbk5vZGVDb2xsYXBzZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZUNvbGxhcHNlSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICAvLyB0aGlzLnNldE5vZGVFeHBhbmRlZFZhbHVlKGV2ZW50KTtcclxuICB9XHJcbiAgQEhvc3RMaXN0ZW5lcignb25Ob2RlU2VsZWN0JywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25Ob2RlU2VsZWN0SGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBpZCA9IGV2ZW50ICYmIGV2ZW50Lm5vZGUgJiYgZXZlbnQubm9kZS5kYXRhICYmIGV2ZW50Lm5vZGUuZGF0YVt0aGlzLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LnByaW1hcnlLZXldIHx8IG51bGw7XHJcbiAgICBpZiAoaWQgPT09IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMudHJlZVRhYmxlU2VsZWN0ZWRFdmVudCA9IHRydWU7XHJcbiAgICB0aGlzLnNldEN1cnJlbnRJZFRvQmluZGluZ0xpc3QoaWQpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdvbk5vZGVVbnNlbGVjdCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uTm9kZVVuc2VsZWN0SGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICB0aGlzLnNldEN1cnJlbnRJZFRvQmluZGluZ0xpc3QobnVsbCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgc2V0Tm9kZUV4cGFuZGVkVmFsdWUoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKCFldmVudCB8fCAhdGhpcy5vbGRUcmVlTm9kZU1hcCB8fCBPYmplY3Qua2V5cyh0aGlzLm9sZFRyZWVOb2RlTWFwKS5sZW5ndGggPD0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgY3VycmVudElkID0gZXZlbnQubm9kZS5kYXRhLmlkO1xyXG4gICAgICB0aGlzLm9sZFRyZWVOb2RlTWFwW2N1cnJlbnRJZF0uZXhwYW5kZWQgPSBldmVudC5leHBhbmRlZDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBzZXROb2RlRXhwYW5kZWRWYWx1ZSBlcnJvcjoke2UubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBzZXRDdXJyZW50SWRUb0JpbmRpbmdMaXN0KHNlbGVjdGVkSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3Qgb2xkQ3VycmVudElkID0gdGhpcy5iaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICBpZiAob2xkQ3VycmVudElkID09PSBzZWxlY3RlZElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYmluZGluZ0xpc3Quc2V0Q3VycmVudElkKHNlbGVjdGVkSWQsIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRQYXRocygpOiBzdHJpbmdbXSB7XHJcbiAgICBsZXQgcGF0aHMgPSBbXTtcclxuICAgIGlmICghdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsIHx8ICF0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHBhdGhzO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGxldCBiaW5kaW5nUGF0aCA9IHRoaXMuZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgICAgcGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHJpbmcoMSwgYmluZGluZ1BhdGgubGVuZ3RoKS5zcGxpdCgnLycpO1xyXG4gICAgICByZXR1cm4gcGF0aHM7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgdXBkYXRlQmluZGluZ0xpc3QocHJpbWFyeVZhbHVlOiBhbnksIHByb3BlcnR5TmFtZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAoIXByb3BlcnR5TmFtZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDmm7TmlrDkuLvooajpg6jliIbooYznmoTlrZfmrrVcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZXMgPSBwcm9wZXJ0eU5hbWUuc3BsaXQoJy4nKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy5nZXRCaW5kaW5nUGF0aEFycmF5KCk7XHJcbiAgICAvLyDlj5blh7rmnaXnmoTkuIDlrprmmK9iaW5kaW5nTGlzdFxyXG4gICAgY29uc3QgbGlzdCA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGgpIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgLy8g5L+u5pS555qE5piv5b2T5YmN6KGMXHJcbiAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLmNvbmNhdChwcm9wZXJ0eU5hbWVzKTtcclxuICAgIGlmIChsaXN0ICYmIHByaW1hcnlWYWx1ZSA9PT0gbGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWUpIHtcclxuICAgICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRocywgdmFsdWUsIHRydWUsIHRydWUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nTGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xyXG4gICAgaWYgKCFiaW5kaW5nT2JqZWN0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChwcm9wZXJ0eU5hbWVzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlLCB1bmRlZmluZWQsIHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWRDaGFuZ2VJbnZva2VyRmFjdG9yeSgpKHBhdGhzKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsZXQgdGFyZ2V0QmluZGluZ09iamVjdCA9IG51bGw7XHJcbiAgICAgIGNvbnN0IGZwYXRocyA9IHByb3BlcnR5TmFtZXMuc2xpY2UoMCwgcHJvcGVydHlOYW1lcy5sZW5ndGggLSAxKTtcclxuICAgICAgY29uc3QgdGFyZ2V0UHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lc1twcm9wZXJ0eU5hbWVzLmxlbmd0aCAtIDFdO1xyXG4gICAgICBmcGF0aHMuZm9yRWFjaChwcm9wID0+IHtcclxuICAgICAgICB0YXJnZXRCaW5kaW5nT2JqZWN0ID0gdGFyZ2V0QmluZGluZ09iamVjdCAmJiB0YXJnZXRCaW5kaW5nT2JqZWN0W3Byb3BdIHx8IGJpbmRpbmdPYmplY3RbcHJvcF07XHJcbiAgICAgIH0pO1xyXG4gICAgICAvLyB0b2RvOumcgOimgea3u+WKoOWAvOWPmOWMluS6i+S7tlxyXG4gICAgICB0YXJnZXRCaW5kaW5nT2JqZWN0LnNldFZhbHVlKHRhcmdldFByb3BlcnR5TmFtZSwgdmFsdWUsIHRydWUsIHRydWUsIHVuZGVmaW5lZCwgdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZENoYW5nZUludm9rZXJGYWN0b3J5KCkocGF0aHMpKTtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRCaW5kaW5nUGF0aEFycmF5KCk6IGFueVtdIHtcclxuICAgIGNvbnN0IHBhdGggPSB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBpZiAocGF0aCkge1xyXG4gICAgICByZXR1cm4gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihuID0+IG4gIT09ICcnKTtcclxuICAgIH1cclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRWYWx1ZShwYXRoOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgbGV0IHZhbHVlID0gJyc7XHJcbiAgICBpZiAocGF0aC5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgIHZhbHVlID0gZGF0YVtwYXRoXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhbHVlID0gcGF0aC5zcGxpdCgnLicpLnJlZHVjZSgocmVzdWx0LCBwcm9wKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFtwcm9wXTtcclxuICAgICAgfSwgZGF0YSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbiAgfVxyXG4gIHByb3RlY3RlZCBzZXRDaGVja3MoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgaWRzKTtcclxuICB9XHJcbn0iXX0=
import * as tslib_1 from "tslib";
// tslint:disable: no-string-literal
/**
 * 树节点构造器
 * @summary
 * 将BindingData中的数据集合转换成TreeTable节点集合
 */
var PathTreeNodeBuilder = /** @class */ (function () {
    /**
     * 构造函数
     */
    function PathTreeNodeBuilder(allNodesData, oldTreeNodes, primaryKey, hierarchyInfoKey, context) {
        this.levelGroup = {};
        /**
         * 等待展开的节点
         * @description 节点结构
         * ```
         * {id:'xxx',expanded:false}
         * ```
         */
        this.nodesWaitExpand = [];
        this.primaryKey = primaryKey;
        this.hierarchyInfoKey = hierarchyInfoKey;
        this.allNodes = [];
        this.allNodesData = allNodesData;
        this.context = context || {};
        this.nodesWaitExpand = [];
        this.nodesShouldExpand = context && context.nodesShouldExpand || [];
        this.frameContext = context && context.frameContext || null;
        this.addTreeLoadCompleteListener(this.onTreeLoadComplete.bind(this));
        this.initLevelGroup();
        this.allNodesMap = new Map();
        this.allOldNodesMap = new Map();
        this.buildNodesDataMap(oldTreeNodes);
    }
    Object.defineProperty(PathTreeNodeBuilder.prototype, "expandLevel", {
        /**
         * 展开至层级
         * @description -1为不展开
         */
        get: function () {
            return this.context && this.context.hasOwnProperty('expandLevel') ? this.context['expandLevel'] : -1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PathTreeNodeBuilder.prototype, "component", {
        get: function () {
            return this.context && this.context['component'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PathTreeNodeBuilder.prototype, "addTreeLoadCompleteListener", {
        get: function () {
            return this.context && this.context['addTreeLoadCompleteListener'] || function (args) { };
        },
        enumerable: true,
        configurable: true
    });
    PathTreeNodeBuilder.prototype.updateTreeNode = function (allNodesData, data) {
        this.allNodesData = allNodesData;
        this.initLevelGroup();
        this.buildNodesDataMap(data);
    };
    PathTreeNodeBuilder.prototype.build = function () {
        var _this = this;
        var tree = [];
        var childrenOf = {};
        var nodes = {};
        this.allNodesData.forEach(function (item) {
            var id = item.id;
            var parentId = _this.getParentId(item);
            // item.parentId = parentId;
            // 展开新增节点的父节点
            var isNewNode = _this.isNewNode(item);
            if (isNewNode === true) {
                _this.expandParentNode(item);
            }
            // 构造树节点
            var node = _this.buildNode(item);
            nodes[id] = node;
            childrenOf[id] = childrenOf[id] || [];
            node.children = childrenOf[id];
            _this.allNodesMap.set(item[_this.primaryKey], node);
            if (parentId) {
                if (nodes[parentId] && nodes[parentId].unstableState === true) {
                    nodes[parentId].expanded = true;
                    nodes[parentId].unstableState = false;
                }
                childrenOf[parentId] = childrenOf[parentId] || [];
                childrenOf[parentId].push(node);
            }
            else {
                if ((!node.children || node.children.length < 1) && node.expanded === true) {
                    node.unstableState = true;
                    node.expanded = false;
                }
                tree.push(node);
            }
        });
        return tree;
    };
    /**
     * 构造树节点
     */
    PathTreeNodeBuilder.prototype.build1 = function () {
        var _this = this;
        var minLayer;
        // 获取最顶级节点的layer
        this.allNodesData.forEach(function (node) {
            var hierarchyInfo = _this.getHierarchyInfo(node);
            if (hierarchyInfo) {
                var layer = hierarchyInfo['layer'];
                if (!isNaN(layer)) {
                    if (minLayer === undefined) {
                        minLayer = layer;
                    }
                    else if (layer < minLayer) {
                        minLayer = layer;
                    }
                }
            }
        });
        var topLayer = minLayer - 1;
        this.buildNodes('', topLayer, this.allNodesData, this.allNodes);
        return this.allNodes;
    };
    /**
     * 构造树节点集合
     */
    PathTreeNodeBuilder.prototype.buildNodes = function (fPath, fLayer, allNodesData, treeNodes) {
        var _this = this;
        var childNodesData = this.getChildNodesData(fPath, fLayer);
        childNodesData.forEach(function (nodeData) {
            // 展开新增节点的父节点
            var isNewNode = _this.isNewNode(nodeData);
            if (isNewNode === true) {
                _this.expandParentNode(nodeData);
            }
            // 构造树节点
            var node = _this.buildNode(nodeData);
            treeNodes.push(node);
            _this.allNodesMap.set(nodeData[_this.primaryKey], node);
            // 递归遍历下级节点
            var hierarchyInfo = _this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];
            var currentLayer = hierarchyInfo['layer'];
            var currentPath = hierarchyInfo['path'];
            _this.buildNodes(currentPath, currentLayer, allNodesData, node.children);
        });
    };
    /**
     * 创建树节点
     */
    PathTreeNodeBuilder.prototype.buildNode = function (nodeData) {
        var isLeaf = this.isLeaf(nodeData);
        // 获取节点的展开状态
        var shouldExpand = this.shouldExpand(nodeData);
        // 节点虽然应该展开，但可能是因为之前就是展开状态，所以应该检查节点之前的状态
        var originExpandStatus = this.isExpanded(nodeData);
        // 如果应该展开该节点，但是该节点之前有状态，那么该节点不应该再由程序展开。
        if (!originExpandStatus && shouldExpand) {
            this.expandNode(nodeData);
        }
        var paginationInfo = this.buildPaginationInfo(nodeData);
        var treeNode = {
            data: Object.assign({}, nodeData),
            children: [],
            expanded: shouldExpand,
            leaf: isLeaf
        };
        if (paginationInfo) {
            treeNode.pagination = paginationInfo;
        }
        return treeNode;
    };
    /**
     * 构造分页信息
     * @param nodeData nodeData
     * @returns
     */
    PathTreeNodeBuilder.prototype.buildPaginationInfo = function (nodeData) {
        var result = null;
        if (this.frameContext) {
            var id = this.getPrimary(nodeData);
            // 获取分页信息
            var key = "_NODE_" + id + "_PAGINATION_INFO_";
            var pagination = this.frameContext.params.get(key) || null;
            if (pagination && pagination.pageCount > 1) {
                result = {
                    pageIndex: pagination.pageIndex,
                    pageSize: pagination.pageSize,
                    total: pagination.totalCount
                };
            }
        }
        return result;
    };
    /**
     * 计算节点是否需要展开
     * @param nodeData nodeData
     */
    PathTreeNodeBuilder.prototype.shouldExpand = function (nodeData) {
        var _a = tslib_1.__read([this.getNodeLayer(nodeData), this.isLeaf(nodeData)], 2), layer = _a[0], isLeaf = _a[1];
        // 永远不展开叶子节点
        if (isLeaf) {
            return false;
        }
        var expanded = this.isExpanded(nodeData);
        if (!expanded) {
            var id_1 = this.getPrimary(nodeData);
            if (this.nodesWaitExpand.findIndex(function (node) { return node && node.id === id_1; }) > -1) {
                return false;
            }
            if (this.nodesShouldExpand.findIndex(function (nodeId) { return nodeId === id_1; }) > -1) {
                return true;
            }
            if (this.expandLevel === -1) {
                // -1 为不展开
                expanded = false;
            }
            else if (this.expandLevel === 0) {
                // 0 为全部展开
                expanded = true;
            }
            else {
                // 没有启用分层加载，通过展开层级确定是否展开该节点
                expanded = layer <= this.expandLevel;
                // 如果节点原本存在且节点没有展开则不展开
                var oldTreeNode = this.getOldNode(nodeData);
                if (oldTreeNode && !oldTreeNode.expanded) {
                    expanded = false;
                }
            }
        }
        return expanded;
    };
    /**
     * 展开树节点
     * @description 完全加载树使用展开属性在buildNode时已经展开，此函数的主要用于展开分级加载树
     * @param nodeData nodeData
     */
    PathTreeNodeBuilder.prototype.expandNode = function (nodeData) {
        var _a = tslib_1.__read([this.getNodePath(nodeData), this.getNodeLayer(nodeData)], 2), path = _a[0], layer = _a[1];
        var childs = this.getChildNodesData(path, layer);
        // 当前节点不是叶子节点，但在节点数据中又找不到该节点的子节点，则认为树启用了分层加载
        if (!childs || childs.length < 1) {
            // 分层加载树需要通过触发节点展开事件才加载下层，目前树上还不存在该节点，无法直接展开，需要等树加载完之后再展开
            var id_2 = this.getPrimary(nodeData);
            if (this.nodesWaitExpand.findIndex(function (node) { return node && node.id === id_2; }) < 0) {
                this.nodesWaitExpand.push({ id: id_2, expanded: false });
            }
        }
    };
    /**
     * 树加载完成事件
     */
    PathTreeNodeBuilder.prototype.onTreeLoadComplete = function () {
        var index = this.nodesWaitExpand.findIndex(function (node) { return !node.expanded; });
        var nodeData = this.nodesWaitExpand[index] || {};
        var id = nodeData.id;
        if (id) {
            var rowNode = this.component.findRowNode(id);
            if (rowNode) {
                nodeData.expanded = true;
                // if (nodeData && nodeData.node && !nodeData.node.expanded) {
                //   return;
                // }
                this.component.expandNode(id);
            }
        }
    };
    /**
     * 获取主键
     * @param nodeData nodeData
     */
    PathTreeNodeBuilder.prototype.getPrimary = function (nodeData) {
        return nodeData[this.primaryKey];
    };
    // #region 工具方法，待单独封装
    /**
     * 获取子级节点的数据集合
     */
    PathTreeNodeBuilder.prototype.getChildNodesData = function (fPath, fLayer) {
        var _this = this;
        var childNodesData = [];
        this.allNodesData.forEach(function (nodeData) {
            // @todo：待删除，兼容没有hierarchyInfo的数据
            var hierarchyInfo = _this.getHierarchyInfo(nodeData); //this.getValue(nodeData, this.hierarchyInfoKey); /// nodeData[this.hierarchyInfoKey];
            if (!hierarchyInfo) {
                return;
            }
            // 匹配节点
            var currentLayer = hierarchyInfo['layer'];
            var currentPath = hierarchyInfo['path'];
            if ((currentLayer === fLayer + 1) && currentPath && currentPath.startsWith(fPath)) {
                childNodesData.push(nodeData);
            }
        });
        return childNodesData;
    };
    PathTreeNodeBuilder.prototype.getHierarchyInfo = function (nodeData) {
        return this.getValue(nodeData, this.hierarchyInfoKey); //nodeData[this.hierarchyInfoKey];
    };
    PathTreeNodeBuilder.prototype.initLevelGroup = function () {
        var _this = this;
        this.levelGroup = {};
        this.allNodesData.forEach(function (nodeData) {
            var hierarchyInfo = _this.getHierarchyInfo(nodeData);
            var key = "level" + hierarchyInfo.layer;
            if (_this.levelGroup[key]) {
                _this.levelGroup[key].push(nodeData);
            }
            else {
                _this.levelGroup[key] = [nodeData];
            }
        });
    };
    PathTreeNodeBuilder.prototype.getParentId = function (node) {
        var _this = this;
        var hierarchyInfo = this.getHierarchyInfo(node);
        var parentLevelGroup = this.levelGroup[this.getLevelGroupKey(hierarchyInfo.layer - 1)] || [];
        var parent = parentLevelGroup.find(function (nodeData) {
            var currentHierarchyInfo = _this.getHierarchyInfo(nodeData);
            if (currentHierarchyInfo.isDetail === true) {
                return false;
            }
            return hierarchyInfo.path.startsWith(currentHierarchyInfo.path);
        });
        if (parent) {
            return parent.id;
        }
        else {
            return null;
        }
    };
    PathTreeNodeBuilder.prototype.getLevelGroupKey = function (level) {
        return "level" + level;
    };
    /**
     * 根据路径获取数据
     * @param target target
     * @param path 路径
     */
    PathTreeNodeBuilder.prototype.getValue = function (target, path) {
        if (path.indexOf('/') === -1) {
            return target[path];
        }
        var paths = path.split('/').filter(function (p) { return p; });
        if (paths.length < 1) {
            return target;
        }
        return paths.reduce(function (result, path) {
            return result && result[path];
        }, target);
    };
    /**
     * 获取分级信息中的层级
     * @param nodeData nodeData
     */
    PathTreeNodeBuilder.prototype.getNodeLayer = function (nodeData) {
        var hierarchyInfo = this.getHierarchyInfo(nodeData);
        return hierarchyInfo['layer'];
    };
    /**
     * 获取分级信息中的路径
     * @param nodeData nodeData
     */
    PathTreeNodeBuilder.prototype.getNodePath = function (nodeData) {
        var hierarchyInfo = this.getHierarchyInfo(nodeData);
        return hierarchyInfo['path'];
    };
    /**
     * 获取展开状态
     */
    PathTreeNodeBuilder.prototype.isExpanded = function (newData) {
        var oldTreeNode = this.getOldNode(newData);
        return oldTreeNode ? oldTreeNode.expanded : undefined;
    };
    /**
     * 是否是叶子节点
     * @todo：服务器端对isDetail的目前没有与前端同步，isDetail不准确。
     */
    PathTreeNodeBuilder.prototype.isLeaf = function (nodeData) {
        var hierarchyInfo = this.getHierarchyInfo(nodeData); // nodeData[this.hierarchyInfoKey];
        var isDetail = hierarchyInfo['isDetail'];
        return isDetail;
    };
    /**
     * 判断节点是否是新增
     * @todo：不应该这样判断，待优化。
     * @summary
     * 1、非空树（空树视为初次加载数据）；
     * 2、找不到oldNode。
     */
    PathTreeNodeBuilder.prototype.isNewNode = function (nodeData) {
        if (this.allOldNodesMap.size === 0) {
            return false;
        }
        var oldTreeNode = this.getOldNode(nodeData);
        return oldTreeNode ? false : true;
    };
    /**
     * 展开父节点
     */
    PathTreeNodeBuilder.prototype.expandParentNode = function (nodeData) {
        var parentTreeNode = this.getParentNode(nodeData);
        if (!parentTreeNode) {
            return;
        }
        parentTreeNode.leaf = false;
        parentTreeNode.expanded = true;
    };
    /**
     * 查找父节点
     */
    PathTreeNodeBuilder.prototype.getParentNode = function (nodeData) {
        var _this = this;
        var hierarchyInfo = this.getHierarchyInfo(nodeData); //nodeData[this.hierarchyInfoKey];
        var layer = hierarchyInfo['layer'];
        var path = hierarchyInfo['path'];
        var allNodes = Array.from(this.allNodesMap.values());
        var parentNode = allNodes.find(function (currentNode) {
            var currentLayer = _this.getValue(currentNode.data, _this.hierarchyInfoKey)['layer']; //currentNode.data[this.hierarchyInfoKey]['layer'];
            var currentPath = _this.getValue(currentNode.data, _this.hierarchyInfoKey)['path']; //  currentNode.data[this.hierarchyInfoKey]['path'];
            if ((layer === currentLayer + 1) && path.startsWith(currentPath) === true) {
                return true;
            }
            return false;
        });
        return parentNode;
    };
    /**
     * 获取老的树节点
     */
    PathTreeNodeBuilder.prototype.getOldNode = function (nodeData) {
        var id = nodeData[this.primaryKey];
        return this.allOldNodesMap.get(id);
    };
    /**
     * 打平TreeNodes，并放入一个Map中
     */
    PathTreeNodeBuilder.prototype.buildNodesDataMap = function (treeNodes) {
        var _this = this;
        treeNodes.forEach(function (treeNode) {
            _this.allOldNodesMap.set(treeNode.data[_this.primaryKey], treeNode);
            if (treeNode.children) {
                _this.buildNodesDataMap(treeNode.children);
            }
        });
    };
    return PathTreeNodeBuilder;
}());
export { PathTreeNodeBuilder };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aF90cmVlX25vZGVfYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL3RyZWVfdGFibGVfbm9kZV9idWlsZGVyL3BhdGhfdHJlZV9ub2RlX2J1aWxkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQVVBLG9DQUFvQztBQUNwQzs7OztHQUlHO0FBQ0g7SUFHRTs7T0FFRztJQUNILDZCQUFZLFlBQW1CLEVBQUUsWUFBd0IsRUFBRSxVQUFrQixFQUFFLGdCQUF3QixFQUFFLE9BQWE7UUFMOUcsZUFBVSxHQUErQixFQUFFLENBQUM7UUFzQ3BEOzs7Ozs7V0FNRztRQUNLLG9CQUFlLEdBQVUsRUFBRSxDQUFDO1FBdkNsQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDekMsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQztRQUNwRSxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sSUFBSSxPQUFPLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQztRQUM1RCxJQUFJLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBRXJFLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxFQUFvQixDQUFDO1FBQy9DLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQW9CLENBQUM7UUFDbEQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFLRCxzQkFBWSw0Q0FBVztRQUp2Qjs7O1dBR0c7YUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkcsQ0FBQzs7O09BQUE7SUFDRCxzQkFBWSwwQ0FBUzthQUFyQjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ25ELENBQUM7OztPQUFBO0lBQ0Qsc0JBQVksNERBQTJCO2FBQXZDO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsNkJBQTZCLENBQUMsSUFBSSxVQUFVLElBQVMsSUFBSSxDQUFDLENBQUM7UUFDakcsQ0FBQzs7O09BQUE7SUErQ00sNENBQWMsR0FBckIsVUFBc0IsWUFBaUIsRUFBRSxJQUFTO1FBQ2hELElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNNLG1DQUFLLEdBQVo7UUFBQSxpQkFxQ0M7UUFwQ0MsSUFBTSxJQUFJLEdBQWUsRUFBRSxDQUFDO1FBQzVCLElBQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUN0QixJQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQSxJQUFJO1lBQzVCLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDbkIsSUFBTSxRQUFRLEdBQUcsS0FBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV4Qyw0QkFBNEI7WUFDNUIsYUFBYTtZQUNiLElBQU0sU0FBUyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkMsSUFBSSxTQUFTLEtBQUssSUFBSSxFQUFFO2dCQUN0QixLQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDN0I7WUFDRCxRQUFRO1lBQ1IsSUFBTSxJQUFJLEdBQUcsS0FBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLFVBQVUsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRS9CLEtBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbEQsSUFBSSxRQUFRLEVBQUU7Z0JBQ1osSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLGFBQWEsS0FBSyxJQUFJLEVBQUU7b0JBQzdELEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO29CQUNoQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztpQkFDdkM7Z0JBQ0QsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2xELFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDakM7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksRUFBRTtvQkFDMUUsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7b0JBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO2lCQUN2QjtnQkFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ2pCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRDs7T0FFRztJQUNJLG9DQUFNLEdBQWI7UUFBQSxpQkFtQkM7UUFsQkMsSUFBSSxRQUFRLENBQUM7UUFDYixnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQSxJQUFJO1lBQzVCLElBQU0sYUFBYSxHQUFHLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsRCxJQUFJLGFBQWEsRUFBRTtnQkFDakIsSUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUNqQixJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUU7d0JBQzFCLFFBQVEsR0FBRyxLQUFLLENBQUM7cUJBQ2xCO3lCQUFNLElBQUksS0FBSyxHQUFHLFFBQVEsRUFBRTt3QkFDM0IsUUFBUSxHQUFHLEtBQUssQ0FBQztxQkFDbEI7aUJBQ0Y7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBTSxRQUFRLEdBQUcsUUFBUSxHQUFHLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEUsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7T0FFRztJQUNLLHdDQUFVLEdBQWxCLFVBQW1CLEtBQWEsRUFBRSxNQUFjLEVBQUUsWUFBbUIsRUFBRSxTQUFxQjtRQUE1RixpQkFvQkM7UUFuQkMsSUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM3RCxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQUMsUUFBYTtZQUNuQyxhQUFhO1lBQ2IsSUFBTSxTQUFTLEdBQUcsS0FBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMzQyxJQUFJLFNBQVMsS0FBSyxJQUFJLEVBQUU7Z0JBQ3RCLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNqQztZQUVELFFBQVE7WUFDUixJQUFNLElBQUksR0FBRyxLQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3RDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckIsS0FBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUV0RCxXQUFXO1lBQ1gsSUFBTSxhQUFhLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsa0NBQWtDO1lBQ3hGLElBQU0sWUFBWSxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM1QyxJQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsUUFBc0IsQ0FBQyxDQUFDO1FBQ3hGLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ssdUNBQVMsR0FBakIsVUFBa0IsUUFBYTtRQUM3QixJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JDLFlBQVk7UUFDWixJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pELHdDQUF3QztRQUN4QyxJQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckQsdUNBQXVDO1FBQ3ZDLElBQUksQ0FBQyxrQkFBa0IsSUFBSSxZQUFZLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUMzQjtRQUNELElBQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMxRCxJQUFNLFFBQVEsR0FBYTtZQUN6QixJQUFJLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDO1lBQ2pDLFFBQVEsRUFBRSxFQUFFO1lBQ1osUUFBUSxFQUFFLFlBQVk7WUFDdEIsSUFBSSxFQUFFLE1BQU07U0FDYixDQUFDO1FBQ0YsSUFBSSxjQUFjLEVBQUU7WUFDbEIsUUFBUSxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUM7U0FDdEM7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNLLGlEQUFtQixHQUEzQixVQUE0QixRQUFhO1FBQ3ZDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyQyxTQUFTO1lBQ1QsSUFBTSxHQUFHLEdBQUcsV0FBUyxFQUFFLHNCQUFtQixDQUFDO1lBQzNDLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUM7WUFDN0QsSUFBSSxVQUFVLElBQUksVUFBVSxDQUFDLFNBQVMsR0FBRyxDQUFDLEVBQUU7Z0JBQzFDLE1BQU0sR0FBRztvQkFDUCxTQUFTLEVBQUUsVUFBVSxDQUFDLFNBQVM7b0JBQy9CLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUTtvQkFDN0IsS0FBSyxFQUFFLFVBQVUsQ0FBQyxVQUFVO2lCQUM3QixDQUFDO2FBQ0g7U0FDRjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFDRDs7O09BR0c7SUFDSywwQ0FBWSxHQUFwQixVQUFxQixRQUFhO1FBQzFCLElBQUEsNEVBQXNFLEVBQXJFLGFBQUssRUFBRSxjQUE4RCxDQUFDO1FBQzdFLFlBQVk7UUFDWixJQUFJLE1BQU0sRUFBRTtZQUNWLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFDRCxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDYixJQUFNLElBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JDLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLElBQUksSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFFLEVBQXRCLENBQXNCLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDdkUsT0FBTyxLQUFLLENBQUM7YUFDZDtZQUNELElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLE1BQU0sS0FBSyxJQUFFLEVBQWIsQ0FBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7Z0JBQ2xFLE9BQU8sSUFBSSxDQUFDO2FBQ2I7WUFDRCxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssQ0FBQyxDQUFDLEVBQUU7Z0JBQzNCLFVBQVU7Z0JBQ1YsUUFBUSxHQUFHLEtBQUssQ0FBQzthQUNsQjtpQkFBTSxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssQ0FBQyxFQUFFO2dCQUNqQyxVQUFVO2dCQUNWLFFBQVEsR0FBRyxJQUFJLENBQUM7YUFDakI7aUJBQU07Z0JBQ0wsMkJBQTJCO2dCQUMzQixRQUFRLEdBQUcsS0FBSyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQ3JDLHNCQUFzQjtnQkFDdEIsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDOUMsSUFBSSxXQUFXLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFO29CQUN4QyxRQUFRLEdBQUcsS0FBSyxDQUFDO2lCQUNsQjthQUNGO1NBQ0Y7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNLLHdDQUFVLEdBQWxCLFVBQW1CLFFBQWE7UUFDeEIsSUFBQSxpRkFBeUUsRUFBeEUsWUFBSSxFQUFFLGFBQWtFLENBQUM7UUFDaEYsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUVuRCw0Q0FBNEM7UUFDNUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNoQyx5REFBeUQ7WUFDekQsSUFBTSxJQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyQyxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxJQUFJLElBQUksQ0FBQyxFQUFFLEtBQUssSUFBRSxFQUF0QixDQUFzQixDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUN0RSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsTUFBQSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO2FBQ3BEO1NBQ0Y7SUFDSCxDQUFDO0lBQ0Q7O09BRUc7SUFDSyxnREFBa0IsR0FBMUI7UUFDRSxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBZCxDQUFjLENBQUMsQ0FBQztRQUNyRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMzQyxJQUFBLGdCQUFFLENBQWM7UUFDeEIsSUFBSSxFQUFFLEVBQUU7WUFDTixJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMvQyxJQUFJLE9BQU8sRUFBRTtnQkFDWCxRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztnQkFDekIsOERBQThEO2dCQUM5RCxZQUFZO2dCQUNaLElBQUk7Z0JBQ0osSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDL0I7U0FDRjtJQUNILENBQUM7SUFDRDs7O09BR0c7SUFDSyx3Q0FBVSxHQUFsQixVQUFtQixRQUFhO1FBQzlCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QscUJBQXFCO0lBRXJCOztPQUVHO0lBQ0ssK0NBQWlCLEdBQXpCLFVBQTBCLEtBQWEsRUFBRSxNQUFjO1FBQXZELGlCQWtCQztRQWpCQyxJQUFNLGNBQWMsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFhO1lBRXRDLGlDQUFpQztZQUNqQyxJQUFNLGFBQWEsR0FBRyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQSxzRkFBc0Y7WUFDNUksSUFBSSxDQUFDLGFBQWEsRUFBRTtnQkFDbEIsT0FBTzthQUNSO1lBRUQsT0FBTztZQUNQLElBQU0sWUFBWSxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM1QyxJQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUMsSUFBSSxDQUFDLFlBQVksS0FBSyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pGLGNBQWMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDL0I7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sY0FBYyxDQUFDO0lBQ3hCLENBQUM7SUFFTyw4Q0FBZ0IsR0FBeEIsVUFBeUIsUUFBYTtRQUNwQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUEsa0NBQWtDO0lBQzFGLENBQUM7SUFFTyw0Q0FBYyxHQUF0QjtRQUFBLGlCQVdDO1FBVkMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFRO1lBQ2pDLElBQU0sYUFBYSxHQUFHLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN0RCxJQUFNLEdBQUcsR0FBRyxVQUFRLGFBQWEsQ0FBQyxLQUFPLENBQUM7WUFDMUMsSUFBSSxLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUN4QixLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNyQztpQkFBTTtnQkFDTCxLQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDbkM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDTyx5Q0FBVyxHQUFuQixVQUFvQixJQUFTO1FBQTdCLGlCQWVDO1FBZEMsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xELElBQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMvRixJQUFNLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBQSxRQUFRO1lBQzNDLElBQU0sb0JBQW9CLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdELElBQUksb0JBQW9CLENBQUMsUUFBUSxLQUFLLElBQUksRUFBRTtnQkFDMUMsT0FBTyxLQUFLLENBQUM7YUFDZDtZQUNELE9BQU8sYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLE1BQU0sRUFBRTtZQUNWLE9BQU8sTUFBTSxDQUFDLEVBQUUsQ0FBQztTQUNsQjthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7SUFDTyw4Q0FBZ0IsR0FBeEIsVUFBeUIsS0FBVTtRQUNqQyxPQUFPLFVBQVEsS0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFDRDs7OztPQUlHO0lBQ0ssc0NBQVEsR0FBaEIsVUFBaUIsTUFBVyxFQUFFLElBQVk7UUFDeEMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQzVCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3JCO1FBQ0QsSUFBTSxLQUFLLEdBQVEsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEVBQUQsQ0FBQyxDQUFDLENBQUM7UUFDbEQsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNwQixPQUFPLE1BQU0sQ0FBQztTQUNmO1FBQ0QsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsTUFBTSxFQUFFLElBQUk7WUFDL0IsT0FBTyxNQUFNLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNiLENBQUM7SUFDRDs7O09BR0c7SUFDSywwQ0FBWSxHQUFwQixVQUFxQixRQUFhO1FBQ2hDLElBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RCxPQUFPLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0sseUNBQVcsR0FBbkIsVUFBb0IsUUFBYTtRQUMvQixJQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEQsT0FBTyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNEOztPQUVHO0lBQ0ssd0NBQVUsR0FBbEIsVUFBbUIsT0FBWTtRQUM3QixJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdDLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDeEQsQ0FBQztJQUVEOzs7T0FHRztJQUNLLG9DQUFNLEdBQWQsVUFBZSxRQUFhO1FBQzFCLElBQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBLG1DQUFtQztRQUN6RixJQUFNLFFBQVEsR0FBRyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDM0MsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNLLHVDQUFTLEdBQWpCLFVBQWtCLFFBQWE7UUFDN0IsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksS0FBSyxDQUFDLEVBQUU7WUFDbEMsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUMsT0FBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ3BDLENBQUM7SUFFRDs7T0FFRztJQUNLLDhDQUFnQixHQUF4QixVQUF5QixRQUFhO1FBQ3BDLElBQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFDRCxjQUFjLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztRQUM1QixjQUFjLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUNqQyxDQUFDO0lBRUQ7O09BRUc7SUFDSywyQ0FBYSxHQUFyQixVQUFzQixRQUFhO1FBQW5DLGlCQWVDO1FBZEMsSUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsa0NBQWtDO1FBQ3hGLElBQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFNLElBQUksR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFbkMsSUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDdkQsSUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFDLFdBQXFCO1lBQ3JELElBQU0sWUFBWSxHQUFHLEtBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBLG1EQUFtRDtZQUN4SSxJQUFNLFdBQVcsR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsS0FBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQSxvREFBb0Q7WUFDdkksSUFBSSxDQUFDLEtBQUssS0FBSyxZQUFZLEdBQUcsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ3pFLE9BQU8sSUFBSSxDQUFDO2FBQ2I7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ssd0NBQVUsR0FBbEIsVUFBbUIsUUFBYTtRQUM5QixJQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVEOztPQUVHO0lBQ0ssK0NBQWlCLEdBQXpCLFVBQTBCLFNBQXFCO1FBQS9DLGlCQU9DO1FBTkMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFFBQWtCO1lBQ25DLEtBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ2xFLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRTtnQkFDckIsS0FBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMzQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUdILDBCQUFDO0FBQUQsQ0FBQyxBQS9kRCxJQStkQztBQUVELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTktMDQtMDEgMTc6MjY6NTBcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOS0xMi0xMiAxNjoxNzowNlxyXG4gKi9cclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBQYXRoSGllcmFyY2h5SW5mbyB9IGZyb20gJy4vdHlwZXMnO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuLyoqXHJcbiAqIOagkeiKgueCueaehOmAoOWZqFxyXG4gKiBAc3VtbWFyeVxyXG4gKiDlsIZCaW5kaW5nRGF0YeS4reeahOaVsOaNrumbhuWQiOi9rOaNouaIkFRyZWVUYWJsZeiKgueCuembhuWQiFxyXG4gKi9cclxuY2xhc3MgUGF0aFRyZWVOb2RlQnVpbGRlciB7XHJcbiAgcHJpdmF0ZSBsZXZlbEdyb3VwOiB7IFtsZXZlbDogc3RyaW5nXTogYW55W10gfSA9IHt9O1xyXG4gIHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQ7XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoYWxsTm9kZXNEYXRhOiBhbnlbXSwgb2xkVHJlZU5vZGVzOiBUcmVlTm9kZVtdLCBwcmltYXJ5S2V5OiBzdHJpbmcsIGhpZXJhcmNoeUluZm9LZXk6IHN0cmluZywgY29udGV4dD86IGFueSkge1xyXG4gICAgdGhpcy5wcmltYXJ5S2V5ID0gcHJpbWFyeUtleTtcclxuICAgIHRoaXMuaGllcmFyY2h5SW5mb0tleSA9IGhpZXJhcmNoeUluZm9LZXk7XHJcbiAgICB0aGlzLmFsbE5vZGVzID0gW107XHJcbiAgICB0aGlzLmFsbE5vZGVzRGF0YSA9IGFsbE5vZGVzRGF0YTtcclxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQgfHwge307XHJcbiAgICB0aGlzLm5vZGVzV2FpdEV4cGFuZCA9IFtdO1xyXG4gICAgdGhpcy5ub2Rlc1Nob3VsZEV4cGFuZCA9IGNvbnRleHQgJiYgY29udGV4dC5ub2Rlc1Nob3VsZEV4cGFuZCB8fCBbXTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0ID0gY29udGV4dCAmJiBjb250ZXh0LmZyYW1lQ29udGV4dCB8fCBudWxsO1xyXG4gICAgdGhpcy5hZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXIodGhpcy5vblRyZWVMb2FkQ29tcGxldGUuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgdGhpcy5pbml0TGV2ZWxHcm91cCgpO1xyXG4gICAgdGhpcy5hbGxOb2Rlc01hcCA9IG5ldyBNYXA8c3RyaW5nLCBUcmVlTm9kZT4oKTtcclxuICAgIHRoaXMuYWxsT2xkTm9kZXNNYXAgPSBuZXcgTWFwPHN0cmluZywgVHJlZU5vZGU+KCk7XHJcbiAgICB0aGlzLmJ1aWxkTm9kZXNEYXRhTWFwKG9sZFRyZWVOb2Rlcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWxleW8gOiHs+Wxgue6p1xyXG4gICAqIEBkZXNjcmlwdGlvbiAtMeS4uuS4jeWxleW8gFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGV4cGFuZExldmVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udGV4dCAmJiB0aGlzLmNvbnRleHQuaGFzT3duUHJvcGVydHkoJ2V4cGFuZExldmVsJykgPyB0aGlzLmNvbnRleHRbJ2V4cGFuZExldmVsJ10gOiAtMTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXQgY29tcG9uZW50KCk6IFRyZWVUYWJsZUNvbXBvbmVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0ICYmIHRoaXMuY29udGV4dFsnY29tcG9uZW50J107XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0IGFkZFRyZWVMb2FkQ29tcGxldGVMaXN0ZW5lcigpIHtcclxuICAgIHJldHVybiB0aGlzLmNvbnRleHQgJiYgdGhpcy5jb250ZXh0WydhZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXInXSB8fCBmdW5jdGlvbiAoYXJnczogYW55KSB7IH07XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmcgOimgeWxleW8gOeahOiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgbm9kZXNTaG91bGRFeHBhbmQ6IHN0cmluZ1tdO1xyXG4gIC8qKlxyXG4gICAqIOetieW+heWxleW8gOeahOiKgueCuVxyXG4gICAqIEBkZXNjcmlwdGlvbiDoioLngrnnu5PmnoRcclxuICAgKiBgYGBcclxuICAgKiB7aWQ6J3h4eCcsZXhwYW5kZWQ6ZmFsc2V9XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBub2Rlc1dhaXRFeHBhbmQ6IGFueVtdID0gW107XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUruWtl+auteWQjVxyXG4gICAqL1xyXG4gIHByaXZhdGUgcHJpbWFyeUtleTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDliIbnuqfnoIHlrZfmrrXlkI1cclxuICAgKi9cclxuICBwcml2YXRlIGhpZXJhcmNoeUluZm9LZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog6IqC54K555qE5pWw5o2u6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhbGxOb2Rlc0RhdGE6IGFueVtdO1xyXG5cclxuICAvKipcclxuICAgKiDoioLngrnpm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGFsbE5vZGVzOiBUcmVlTm9kZVtdO1xyXG5cclxuICAvKipcclxuICAgKiDkuIrkuIDmrKHnu5HlrprnmoTmoJHoioLngrnpm4blkIhNYXBcclxuICAgKi9cclxuICBwcml2YXRlIGFsbE5vZGVzTWFwOiBNYXA8c3RyaW5nLCBUcmVlTm9kZT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4iuS4gOasoee7keWumueahOagkeiKgueCuembhuWQiE1hcFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYWxsT2xkTm9kZXNNYXA6IE1hcDxzdHJpbmcsIFRyZWVOb2RlPjtcclxuICAvKipcclxuICAgKiDkuIrkuIvmlodcclxuICAgKi9cclxuICBwcml2YXRlIGNvbnRleHQ6IGFueTtcclxuICBwdWJsaWMgdXBkYXRlVHJlZU5vZGUoYWxsTm9kZXNEYXRhOiBhbnksIGRhdGE6IGFueSkge1xyXG4gICAgdGhpcy5hbGxOb2Rlc0RhdGEgPSBhbGxOb2Rlc0RhdGE7XHJcbiAgICB0aGlzLmluaXRMZXZlbEdyb3VwKCk7XHJcbiAgICB0aGlzLmJ1aWxkTm9kZXNEYXRhTWFwKGRhdGEpO1xyXG4gIH1cclxuICBwdWJsaWMgYnVpbGQoKTogVHJlZU5vZGVbXSB7XHJcbiAgICBjb25zdCB0cmVlOiBUcmVlTm9kZVtdID0gW107XHJcbiAgICBjb25zdCBjaGlsZHJlbk9mID0ge307XHJcbiAgICBjb25zdCBub2RlcyA9IHt9O1xyXG4gICAgdGhpcy5hbGxOb2Rlc0RhdGEuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgY29uc3QgaWQgPSBpdGVtLmlkO1xyXG4gICAgICBjb25zdCBwYXJlbnRJZCA9IHRoaXMuZ2V0UGFyZW50SWQoaXRlbSk7XHJcblxyXG4gICAgICAvLyBpdGVtLnBhcmVudElkID0gcGFyZW50SWQ7XHJcbiAgICAgIC8vIOWxleW8gOaWsOWinuiKgueCueeahOeItuiKgueCuVxyXG4gICAgICBjb25zdCBpc05ld05vZGUgPSB0aGlzLmlzTmV3Tm9kZShpdGVtKTtcclxuICAgICAgaWYgKGlzTmV3Tm9kZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHRoaXMuZXhwYW5kUGFyZW50Tm9kZShpdGVtKTtcclxuICAgICAgfVxyXG4gICAgICAvLyDmnoTpgKDmoJHoioLngrlcclxuICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuYnVpbGROb2RlKGl0ZW0pO1xyXG4gICAgICBub2Rlc1tpZF0gPSBub2RlO1xyXG4gICAgICBjaGlsZHJlbk9mW2lkXSA9IGNoaWxkcmVuT2ZbaWRdIHx8IFtdO1xyXG4gICAgICBub2RlLmNoaWxkcmVuID0gY2hpbGRyZW5PZltpZF07XHJcblxyXG4gICAgICB0aGlzLmFsbE5vZGVzTWFwLnNldChpdGVtW3RoaXMucHJpbWFyeUtleV0sIG5vZGUpO1xyXG4gICAgICBpZiAocGFyZW50SWQpIHtcclxuICAgICAgICBpZiAobm9kZXNbcGFyZW50SWRdICYmIG5vZGVzW3BhcmVudElkXS51bnN0YWJsZVN0YXRlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBub2Rlc1twYXJlbnRJZF0uZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgbm9kZXNbcGFyZW50SWRdLnVuc3RhYmxlU3RhdGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hpbGRyZW5PZltwYXJlbnRJZF0gPSBjaGlsZHJlbk9mW3BhcmVudElkXSB8fCBbXTtcclxuICAgICAgICBjaGlsZHJlbk9mW3BhcmVudElkXS5wdXNoKG5vZGUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmICgoIW5vZGUuY2hpbGRyZW4gfHwgbm9kZS5jaGlsZHJlbi5sZW5ndGggPCAxKSAmJiBub2RlLmV4cGFuZGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBub2RlLnVuc3RhYmxlU3RhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgbm9kZS5leHBhbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cmVlLnB1c2gobm9kZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRyZWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOagkeiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBidWlsZDEoKTogVHJlZU5vZGVbXSB7XHJcbiAgICBsZXQgbWluTGF5ZXI7XHJcbiAgICAvLyDojrflj5bmnIDpobbnuqfoioLngrnnmoRsYXllclxyXG4gICAgdGhpcy5hbGxOb2Rlc0RhdGEuZm9yRWFjaChub2RlID0+IHtcclxuICAgICAgY29uc3QgaGllcmFyY2h5SW5mbyA9IHRoaXMuZ2V0SGllcmFyY2h5SW5mbyhub2RlKTtcclxuICAgICAgaWYgKGhpZXJhcmNoeUluZm8pIHtcclxuICAgICAgICBjb25zdCBsYXllciA9IGhpZXJhcmNoeUluZm9bJ2xheWVyJ107XHJcbiAgICAgICAgaWYgKCFpc05hTihsYXllcikpIHtcclxuICAgICAgICAgIGlmIChtaW5MYXllciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG1pbkxheWVyID0gbGF5ZXI7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGxheWVyIDwgbWluTGF5ZXIpIHtcclxuICAgICAgICAgICAgbWluTGF5ZXIgPSBsYXllcjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgdG9wTGF5ZXIgPSBtaW5MYXllciAtIDE7XHJcbiAgICB0aGlzLmJ1aWxkTm9kZXMoJycsIHRvcExheWVyLCB0aGlzLmFsbE5vZGVzRGF0YSwgdGhpcy5hbGxOb2Rlcyk7XHJcbiAgICByZXR1cm4gdGhpcy5hbGxOb2RlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOagkeiKgueCuembhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGROb2RlcyhmUGF0aDogc3RyaW5nLCBmTGF5ZXI6IG51bWJlciwgYWxsTm9kZXNEYXRhOiBhbnlbXSwgdHJlZU5vZGVzOiBUcmVlTm9kZVtdKTogdm9pZCB7XHJcbiAgICBjb25zdCBjaGlsZE5vZGVzRGF0YSA9IHRoaXMuZ2V0Q2hpbGROb2Rlc0RhdGEoZlBhdGgsIGZMYXllcik7XHJcbiAgICBjaGlsZE5vZGVzRGF0YS5mb3JFYWNoKChub2RlRGF0YTogYW55KSA9PiB7XHJcbiAgICAgIC8vIOWxleW8gOaWsOWinuiKgueCueeahOeItuiKgueCuVxyXG4gICAgICBjb25zdCBpc05ld05vZGUgPSB0aGlzLmlzTmV3Tm9kZShub2RlRGF0YSk7XHJcbiAgICAgIGlmIChpc05ld05vZGUgPT09IHRydWUpIHtcclxuICAgICAgICB0aGlzLmV4cGFuZFBhcmVudE5vZGUobm9kZURhdGEpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDmnoTpgKDmoJHoioLngrlcclxuICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuYnVpbGROb2RlKG5vZGVEYXRhKTtcclxuICAgICAgdHJlZU5vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgIHRoaXMuYWxsTm9kZXNNYXAuc2V0KG5vZGVEYXRhW3RoaXMucHJpbWFyeUtleV0sIG5vZGUpO1xyXG5cclxuICAgICAgLy8g6YCS5b2S6YGN5Y6G5LiL57qn6IqC54K5XHJcbiAgICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpOy8vbm9kZURhdGFbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcclxuICAgICAgY29uc3QgY3VycmVudExheWVyID0gaGllcmFyY2h5SW5mb1snbGF5ZXInXTtcclxuICAgICAgY29uc3QgY3VycmVudFBhdGggPSBoaWVyYXJjaHlJbmZvWydwYXRoJ107XHJcbiAgICAgIHRoaXMuYnVpbGROb2RlcyhjdXJyZW50UGF0aCwgY3VycmVudExheWVyLCBhbGxOb2Rlc0RhdGEsIG5vZGUuY2hpbGRyZW4gYXMgVHJlZU5vZGVbXSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuagkeiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGROb2RlKG5vZGVEYXRhOiBhbnkpOiBUcmVlTm9kZSAmIHsgdW5zdGFibGVTdGF0ZT86IGJvb2xlYW4gfSB7XHJcbiAgICBjb25zdCBpc0xlYWYgPSB0aGlzLmlzTGVhZihub2RlRGF0YSk7XHJcbiAgICAvLyDojrflj5boioLngrnnmoTlsZXlvIDnirbmgIFcclxuICAgIGNvbnN0IHNob3VsZEV4cGFuZCA9IHRoaXMuc2hvdWxkRXhwYW5kKG5vZGVEYXRhKTtcclxuICAgIC8vIOiKgueCueiZveeEtuW6lOivpeWxleW8gO+8jOS9huWPr+iDveaYr+WboOS4uuS5i+WJjeWwseaYr+WxleW8gOeKtuaAge+8jOaJgOS7peW6lOivpeajgOafpeiKgueCueS5i+WJjeeahOeKtuaAgVxyXG4gICAgY29uc3Qgb3JpZ2luRXhwYW5kU3RhdHVzID0gdGhpcy5pc0V4cGFuZGVkKG5vZGVEYXRhKTtcclxuICAgIC8vIOWmguaenOW6lOivpeWxleW8gOivpeiKgueCue+8jOS9huaYr+ivpeiKgueCueS5i+WJjeacieeKtuaAge+8jOmCo+S5iOivpeiKgueCueS4jeW6lOivpeWGjeeUseeoi+W6j+WxleW8gOOAglxyXG4gICAgaWYgKCFvcmlnaW5FeHBhbmRTdGF0dXMgJiYgc2hvdWxkRXhwYW5kKSB7XHJcbiAgICAgIHRoaXMuZXhwYW5kTm9kZShub2RlRGF0YSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYWdpbmF0aW9uSW5mbyA9IHRoaXMuYnVpbGRQYWdpbmF0aW9uSW5mbyhub2RlRGF0YSk7XHJcbiAgICBjb25zdCB0cmVlTm9kZTogVHJlZU5vZGUgPSB7XHJcbiAgICAgIGRhdGE6IE9iamVjdC5hc3NpZ24oe30sIG5vZGVEYXRhKSxcclxuICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICBleHBhbmRlZDogc2hvdWxkRXhwYW5kLFxyXG4gICAgICBsZWFmOiBpc0xlYWZcclxuICAgIH07XHJcbiAgICBpZiAocGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgdHJlZU5vZGUucGFnaW5hdGlvbiA9IHBhZ2luYXRpb25JbmZvO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRyZWVOb2RlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKDliIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gbm9kZURhdGEgbm9kZURhdGFcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkUGFnaW5hdGlvbkluZm8obm9kZURhdGE6IGFueSk6IHsgcGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIHRvdGFsOiBudW1iZXIgfSB8IG51bGwge1xyXG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQpIHtcclxuICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFByaW1hcnkobm9kZURhdGEpO1xyXG4gICAgICAvLyDojrflj5bliIbpobXkv6Hmga9cclxuICAgICAgY29uc3Qga2V5ID0gYF9OT0RFXyR7aWR9X1BBR0lOQVRJT05fSU5GT19gO1xyXG4gICAgICBjb25zdCBwYWdpbmF0aW9uID0gdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmdldChrZXkpIHx8IG51bGw7XHJcbiAgICAgIGlmIChwYWdpbmF0aW9uICYmIHBhZ2luYXRpb24ucGFnZUNvdW50ID4gMSkge1xyXG4gICAgICAgIHJlc3VsdCA9IHtcclxuICAgICAgICAgIHBhZ2VJbmRleDogcGFnaW5hdGlvbi5wYWdlSW5kZXgsXHJcbiAgICAgICAgICBwYWdlU2l6ZTogcGFnaW5hdGlvbi5wYWdlU2l6ZSxcclxuICAgICAgICAgIHRvdGFsOiBwYWdpbmF0aW9uLnRvdGFsQ291bnRcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorqHnrpfoioLngrnmmK/lkKbpnIDopoHlsZXlvIBcclxuICAgKiBAcGFyYW0gbm9kZURhdGEgbm9kZURhdGFcclxuICAgKi9cclxuICBwcml2YXRlIHNob3VsZEV4cGFuZChub2RlRGF0YTogYW55KTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBbbGF5ZXIsIGlzTGVhZl0gPSBbdGhpcy5nZXROb2RlTGF5ZXIobm9kZURhdGEpLCB0aGlzLmlzTGVhZihub2RlRGF0YSldO1xyXG4gICAgLy8g5rC46L+c5LiN5bGV5byA5Y+25a2Q6IqC54K5XHJcbiAgICBpZiAoaXNMZWFmKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGxldCBleHBhbmRlZCA9IHRoaXMuaXNFeHBhbmRlZChub2RlRGF0YSk7XHJcbiAgICBpZiAoIWV4cGFuZGVkKSB7XHJcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRQcmltYXJ5KG5vZGVEYXRhKTtcclxuICAgICAgaWYgKHRoaXMubm9kZXNXYWl0RXhwYW5kLmZpbmRJbmRleChub2RlID0+IG5vZGUgJiYgbm9kZS5pZCA9PT0gaWQpID4gLTEpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMubm9kZXNTaG91bGRFeHBhbmQuZmluZEluZGV4KG5vZGVJZCA9PiBub2RlSWQgPT09IGlkKSA+IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuZXhwYW5kTGV2ZWwgPT09IC0xKSB7XHJcbiAgICAgICAgLy8gLTEg5Li65LiN5bGV5byAXHJcbiAgICAgICAgZXhwYW5kZWQgPSBmYWxzZTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmV4cGFuZExldmVsID09PSAwKSB7XHJcbiAgICAgICAgLy8gMCDkuLrlhajpg6jlsZXlvIBcclxuICAgICAgICBleHBhbmRlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5rKh5pyJ5ZCv55So5YiG5bGC5Yqg6L2977yM6YCa6L+H5bGV5byA5bGC57qn56Gu5a6a5piv5ZCm5bGV5byA6K+l6IqC54K5XHJcbiAgICAgICAgZXhwYW5kZWQgPSBsYXllciA8PSB0aGlzLmV4cGFuZExldmVsO1xyXG4gICAgICAgIC8vIOWmguaenOiKgueCueWOn+acrOWtmOWcqOS4lOiKgueCueayoeacieWxleW8gOWImeS4jeWxleW8gFxyXG4gICAgICAgIGNvbnN0IG9sZFRyZWVOb2RlID0gdGhpcy5nZXRPbGROb2RlKG5vZGVEYXRhKTtcclxuICAgICAgICBpZiAob2xkVHJlZU5vZGUgJiYgIW9sZFRyZWVOb2RlLmV4cGFuZGVkKSB7XHJcbiAgICAgICAgICBleHBhbmRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGV4cGFuZGVkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlsZXlvIDmoJHoioLngrlcclxuICAgKiBAZGVzY3JpcHRpb24g5a6M5YWo5Yqg6L295qCR5L2/55So5bGV5byA5bGe5oCn5ZyoYnVpbGROb2Rl5pe25bey57uP5bGV5byA77yM5q2k5Ye95pWw55qE5Li76KaB55So5LqO5bGV5byA5YiG57qn5Yqg6L295qCRXHJcbiAgICogQHBhcmFtIG5vZGVEYXRhIG5vZGVEYXRhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBleHBhbmROb2RlKG5vZGVEYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IFtwYXRoLCBsYXllcl0gPSBbdGhpcy5nZXROb2RlUGF0aChub2RlRGF0YSksIHRoaXMuZ2V0Tm9kZUxheWVyKG5vZGVEYXRhKV07XHJcbiAgICBjb25zdCBjaGlsZHMgPSB0aGlzLmdldENoaWxkTm9kZXNEYXRhKHBhdGgsIGxheWVyKTtcclxuXHJcbiAgICAvLyDlvZPliY3oioLngrnkuI3mmK/lj7blrZDoioLngrnvvIzkvYblnKjoioLngrnmlbDmja7kuK3lj4jmib7kuI3liLDor6XoioLngrnnmoTlrZDoioLngrnvvIzliJnorqTkuLrmoJHlkK/nlKjkuobliIblsYLliqDovb1cclxuICAgIGlmICghY2hpbGRzIHx8IGNoaWxkcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIC8vIOWIhuWxguWKoOi9veagkemcgOimgemAmui/h+inpuWPkeiKgueCueWxleW8gOS6i+S7tuaJjeWKoOi9veS4i+Wxgu+8jOebruWJjeagkeS4iui/mOS4jeWtmOWcqOivpeiKgueCue+8jOaXoOazleebtOaOpeWxleW8gO+8jOmcgOimgeetieagkeWKoOi9veWujOS5i+WQjuWGjeWxleW8gFxyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0UHJpbWFyeShub2RlRGF0YSk7XHJcbiAgICAgIGlmICh0aGlzLm5vZGVzV2FpdEV4cGFuZC5maW5kSW5kZXgobm9kZSA9PiBub2RlICYmIG5vZGUuaWQgPT09IGlkKSA8IDApIHtcclxuICAgICAgICB0aGlzLm5vZGVzV2FpdEV4cGFuZC5wdXNoKHsgaWQsIGV4cGFuZGVkOiBmYWxzZSB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmoJHliqDovb3lrozmiJDkuovku7ZcclxuICAgKi9cclxuICBwcml2YXRlIG9uVHJlZUxvYWRDb21wbGV0ZSgpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5ub2Rlc1dhaXRFeHBhbmQuZmluZEluZGV4KG5vZGUgPT4gIW5vZGUuZXhwYW5kZWQpO1xyXG4gICAgY29uc3Qgbm9kZURhdGEgPSB0aGlzLm5vZGVzV2FpdEV4cGFuZFtpbmRleF0gfHwge307XHJcbiAgICBjb25zdCB7IGlkIH0gPSBub2RlRGF0YTtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICBjb25zdCByb3dOb2RlID0gdGhpcy5jb21wb25lbnQuZmluZFJvd05vZGUoaWQpO1xyXG4gICAgICBpZiAocm93Tm9kZSkge1xyXG4gICAgICAgIG5vZGVEYXRhLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICAvLyBpZiAobm9kZURhdGEgJiYgbm9kZURhdGEubm9kZSAmJiAhbm9kZURhdGEubm9kZS5leHBhbmRlZCkge1xyXG4gICAgICAgIC8vICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICB0aGlzLmNvbXBvbmVudC5leHBhbmROb2RlKGlkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bkuLvplK5cclxuICAgKiBAcGFyYW0gbm9kZURhdGEgbm9kZURhdGFcclxuICAgKi9cclxuICBwcml2YXRlIGdldFByaW1hcnkobm9kZURhdGE6IGFueSkge1xyXG4gICAgcmV0dXJuIG5vZGVEYXRhW3RoaXMucHJpbWFyeUtleV07XHJcbiAgfVxyXG4gIC8vICNyZWdpb24g5bel5YW35pa55rOV77yM5b6F5Y2V54us5bCB6KOFXHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWtkOe6p+iKgueCueeahOaVsOaNrumbhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Q2hpbGROb2Rlc0RhdGEoZlBhdGg6IHN0cmluZywgZkxheWVyOiBudW1iZXIpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBjaGlsZE5vZGVzRGF0YSA9IFtdO1xyXG4gICAgdGhpcy5hbGxOb2Rlc0RhdGEuZm9yRWFjaCgobm9kZURhdGE6IGFueSkgPT4ge1xyXG5cclxuICAgICAgLy8gQHRvZG/vvJrlvoXliKDpmaTvvIzlhbzlrrnmsqHmnIloaWVyYXJjaHlJbmZv55qE5pWw5o2uXHJcbiAgICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpOy8vdGhpcy5nZXRWYWx1ZShub2RlRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTsgLy8vIG5vZGVEYXRhW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgICAgIGlmICghaGllcmFyY2h5SW5mbykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5Yy56YWN6IqC54K5XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRMYXllciA9IGhpZXJhcmNoeUluZm9bJ2xheWVyJ107XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gaGllcmFyY2h5SW5mb1sncGF0aCddO1xyXG4gICAgICBpZiAoKGN1cnJlbnRMYXllciA9PT0gZkxheWVyICsgMSkgJiYgY3VycmVudFBhdGggJiYgY3VycmVudFBhdGguc3RhcnRzV2l0aChmUGF0aCkpIHtcclxuICAgICAgICBjaGlsZE5vZGVzRGF0YS5wdXNoKG5vZGVEYXRhKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gY2hpbGROb2Rlc0RhdGE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEhpZXJhcmNoeUluZm8obm9kZURhdGE6IGFueSk6IFBhdGhIaWVyYXJjaHlJbmZvIHtcclxuICAgIHJldHVybiB0aGlzLmdldFZhbHVlKG5vZGVEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpOy8vbm9kZURhdGFbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdExldmVsR3JvdXAoKSB7XHJcbiAgICB0aGlzLmxldmVsR3JvdXAgPSB7fTtcclxuICAgIHRoaXMuYWxsTm9kZXNEYXRhLmZvckVhY2goKG5vZGVEYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpO1xyXG4gICAgICBjb25zdCBrZXkgPSBgbGV2ZWwke2hpZXJhcmNoeUluZm8ubGF5ZXJ9YDtcclxuICAgICAgaWYgKHRoaXMubGV2ZWxHcm91cFtrZXldKSB7XHJcbiAgICAgICAgdGhpcy5sZXZlbEdyb3VwW2tleV0ucHVzaChub2RlRGF0YSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5sZXZlbEdyb3VwW2tleV0gPSBbbm9kZURhdGFdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRQYXJlbnRJZChub2RlOiBhbnkpIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZSk7XHJcbiAgICBjb25zdCBwYXJlbnRMZXZlbEdyb3VwID0gdGhpcy5sZXZlbEdyb3VwW3RoaXMuZ2V0TGV2ZWxHcm91cEtleShoaWVyYXJjaHlJbmZvLmxheWVyIC0gMSldIHx8IFtdO1xyXG4gICAgY29uc3QgcGFyZW50ID0gcGFyZW50TGV2ZWxHcm91cC5maW5kKG5vZGVEYXRhID0+IHtcclxuICAgICAgY29uc3QgY3VycmVudEhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpO1xyXG4gICAgICBpZiAoY3VycmVudEhpZXJhcmNoeUluZm8uaXNEZXRhaWwgPT09IHRydWUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGhpZXJhcmNoeUluZm8ucGF0aC5zdGFydHNXaXRoKGN1cnJlbnRIaWVyYXJjaHlJbmZvLnBhdGgpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgIHJldHVybiBwYXJlbnQuaWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRMZXZlbEdyb3VwS2V5KGxldmVsOiBhbnkpIHtcclxuICAgIHJldHVybiBgbGV2ZWwke2xldmVsfWA7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrui3r+W+hOiOt+WPluaVsOaNrlxyXG4gICAqIEBwYXJhbSB0YXJnZXQgdGFyZ2V0XHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRWYWx1ZSh0YXJnZXQ6IGFueSwgcGF0aDogc3RyaW5nKSB7XHJcbiAgICBpZiAocGF0aC5pbmRleE9mKCcvJykgPT09IC0xKSB7XHJcbiAgICAgIHJldHVybiB0YXJnZXRbcGF0aF07XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXRoczogYW55ID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgaWYgKHBhdGhzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuIHRhcmdldDtcclxuICAgIH1cclxuICAgIHJldHVybiBwYXRocy5yZWR1Y2UoKHJlc3VsdCwgcGF0aCkgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzdWx0ICYmIHJlc3VsdFtwYXRoXTtcclxuICAgIH0sIHRhcmdldCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhue6p+S/oeaBr+S4reeahOWxgue6p1xyXG4gICAqIEBwYXJhbSBub2RlRGF0YSBub2RlRGF0YVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Tm9kZUxheWVyKG5vZGVEYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0aGlzLmdldEhpZXJhcmNoeUluZm8obm9kZURhdGEpO1xyXG4gICAgcmV0dXJuIGhpZXJhcmNoeUluZm9bJ2xheWVyJ107XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhue6p+S/oeaBr+S4reeahOi3r+W+hFxyXG4gICAqIEBwYXJhbSBub2RlRGF0YSBub2RlRGF0YVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Tm9kZVBhdGgobm9kZURhdGE6IGFueSkge1xyXG4gICAgY29uc3QgaGllcmFyY2h5SW5mbyA9IHRoaXMuZ2V0SGllcmFyY2h5SW5mbyhub2RlRGF0YSk7XHJcbiAgICByZXR1cm4gaGllcmFyY2h5SW5mb1sncGF0aCddO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blsZXlvIDnirbmgIFcclxuICAgKi9cclxuICBwcml2YXRlIGlzRXhwYW5kZWQobmV3RGF0YTogYW55KTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBvbGRUcmVlTm9kZSA9IHRoaXMuZ2V0T2xkTm9kZShuZXdEYXRhKTtcclxuICAgIHJldHVybiBvbGRUcmVlTm9kZSA/IG9sZFRyZWVOb2RlLmV4cGFuZGVkIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5piv5Y+25a2Q6IqC54K5XHJcbiAgICogQHRvZG/vvJrmnI3liqHlmajnq6/lr7lpc0RldGFpbOeahOebruWJjeayoeacieS4juWJjeerr+WQjOatpe+8jGlzRGV0YWls5LiN5YeG56Gu44CCXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0xlYWYobm9kZURhdGE6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgaGllcmFyY2h5SW5mbyA9IHRoaXMuZ2V0SGllcmFyY2h5SW5mbyhub2RlRGF0YSk7Ly8gbm9kZURhdGFbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XTtcclxuICAgIGNvbnN0IGlzRGV0YWlsID0gaGllcmFyY2h5SW5mb1snaXNEZXRhaWwnXTtcclxuICAgIHJldHVybiBpc0RldGFpbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIpOaWreiKgueCueaYr+WQpuaYr+aWsOWinlxyXG4gICAqIEB0b2Rv77ya5LiN5bqU6K+l6L+Z5qC35Yik5pat77yM5b6F5LyY5YyW44CCXHJcbiAgICogQHN1bW1hcnlcclxuICAgKiAx44CB6Z2e56m65qCR77yI56m65qCR6KeG5Li65Yid5qyh5Yqg6L295pWw5o2u77yJ77ybXHJcbiAgICogMuOAgeaJvuS4jeWIsG9sZE5vZGXjgIJcclxuICAgKi9cclxuICBwcml2YXRlIGlzTmV3Tm9kZShub2RlRGF0YTogYW55KTogYm9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5hbGxPbGROb2Rlc01hcC5zaXplID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IG9sZFRyZWVOb2RlID0gdGhpcy5nZXRPbGROb2RlKG5vZGVEYXRhKTtcclxuICAgIHJldHVybiBvbGRUcmVlTm9kZSA/IGZhbHNlIDogdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxleW8gOeItuiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZXhwYW5kUGFyZW50Tm9kZShub2RlRGF0YTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBwYXJlbnRUcmVlTm9kZSA9IHRoaXMuZ2V0UGFyZW50Tm9kZShub2RlRGF0YSk7XHJcbiAgICBpZiAoIXBhcmVudFRyZWVOb2RlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHBhcmVudFRyZWVOb2RlLmxlYWYgPSBmYWxzZTtcclxuICAgIHBhcmVudFRyZWVOb2RlLmV4cGFuZGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeaJvueItuiKgueCuVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UGFyZW50Tm9kZShub2RlRGF0YTogYW55KTogVHJlZU5vZGUge1xyXG4gICAgY29uc3QgaGllcmFyY2h5SW5mbyA9IHRoaXMuZ2V0SGllcmFyY2h5SW5mbyhub2RlRGF0YSk7Ly9ub2RlRGF0YVt0aGlzLmhpZXJhcmNoeUluZm9LZXldO1xyXG4gICAgY29uc3QgbGF5ZXIgPSBoaWVyYXJjaHlJbmZvWydsYXllciddO1xyXG4gICAgY29uc3QgcGF0aCA9IGhpZXJhcmNoeUluZm9bJ3BhdGgnXTtcclxuXHJcbiAgICBjb25zdCBhbGxOb2RlcyA9IEFycmF5LmZyb20odGhpcy5hbGxOb2Rlc01hcC52YWx1ZXMoKSk7XHJcbiAgICBjb25zdCBwYXJlbnROb2RlID0gYWxsTm9kZXMuZmluZCgoY3VycmVudE5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRMYXllciA9IHRoaXMuZ2V0VmFsdWUoY3VycmVudE5vZGUuZGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KVsnbGF5ZXInXTsvL2N1cnJlbnROb2RlLmRhdGFbdGhpcy5oaWVyYXJjaHlJbmZvS2V5XVsnbGF5ZXInXTtcclxuICAgICAgY29uc3QgY3VycmVudFBhdGggPSB0aGlzLmdldFZhbHVlKGN1cnJlbnROb2RlLmRhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSlbJ3BhdGgnXTsvLyAgY3VycmVudE5vZGUuZGF0YVt0aGlzLmhpZXJhcmNoeUluZm9LZXldWydwYXRoJ107XHJcbiAgICAgIGlmICgobGF5ZXIgPT09IGN1cnJlbnRMYXllciArIDEpICYmIHBhdGguc3RhcnRzV2l0aChjdXJyZW50UGF0aCkgPT09IHRydWUpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBwYXJlbnROb2RlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W6ICB55qE5qCR6IqC54K5XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRPbGROb2RlKG5vZGVEYXRhOiBhbnkpOiBUcmVlTm9kZSB7XHJcbiAgICBjb25zdCBpZCA9IG5vZGVEYXRhW3RoaXMucHJpbWFyeUtleV07XHJcbiAgICByZXR1cm4gdGhpcy5hbGxPbGROb2Rlc01hcC5nZXQoaWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5bmzVHJlZU5vZGVz77yM5bm25pS+5YWl5LiA5LiqTWFw5LitXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZE5vZGVzRGF0YU1hcCh0cmVlTm9kZXM6IFRyZWVOb2RlW10pOiB2b2lkIHtcclxuICAgIHRyZWVOb2Rlcy5mb3JFYWNoKCh0cmVlTm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgdGhpcy5hbGxPbGROb2Rlc01hcC5zZXQodHJlZU5vZGUuZGF0YVt0aGlzLnByaW1hcnlLZXldLCB0cmVlTm9kZSk7XHJcbiAgICAgIGlmICh0cmVlTm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgIHRoaXMuYnVpbGROb2Rlc0RhdGFNYXAodHJlZU5vZGUuY2hpbGRyZW4pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxufVxyXG5cclxuZXhwb3J0IHsgUGF0aFRyZWVOb2RlQnVpbGRlciB9O1xyXG4iXX0=
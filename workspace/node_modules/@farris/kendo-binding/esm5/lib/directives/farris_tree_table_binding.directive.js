/*
 * @Author: aalizzwell
 * @Date: 2020-02-27 11:33:41
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2020-02-27 11:34:16
 */
// tslint:disable: no-string-literal
import { Directive, Input, HostListener, Output, EventEmitter } from '@angular/core';
import { FrameContext, ChangeType, ComponentType } from '@farris/devkit';
import { TreeTableComponent } from '@farris/ui-treetable';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { FarrisTreetableFormatService } from '../format/index';
import { TreeNodeBuilderFactory } from './tree_table_node_builder/tree_node_builder_factory';
/**
 * 树表格绑定指令
 */
var FarrisTreeTableBindingDirective = /** @class */ (function () {
    /**
     * 构造函数
     */
    function FarrisTreeTableBindingDirective(treeTable, treetableFormatSer, frameContext) {
        var _this = this;
        this.treeTable = treeTable;
        this.treetableFormatSer = treetableFormatSer;
        this.frameContext = frameContext;
        this.renderSubject = new Subject();
        /**
         * 启用节点分页
         */
        // @Input('enableNodePagination')
        // public enableNodePagination: boolean;
        /**
         * 节点分页大小
         */
        this.nodePageSize = 100;
        /* 设置行样式 */
        this.rowClass = new EventEmitter();
        /* 设置列样式 */
        this.cellClass = new EventEmitter();
        this._PROP = null;
        this.listeners = [];
        this.storage = [];
        this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.renderSubject.pipe(debounceTime(500)).subscribe(function () {
            _this.bindData();
        });
    }
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "bindingData", {
        /**
         * 绑定数据
         */
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "bindingList", {
        /**
         * 绑定数据列表
         */
        get: function () {
            // @todo：只支持主表，没有处理bindingPath
            return this.bindingData.list;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "prop", {
        get: function () {
            return this._PROP;
        },
        set: function (value) {
            this._PROP = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTreeTableBindingDirective.prototype, "viewModel", {
        /**
         * 获取当前vm
         */
        get: function () {
            return this.frameContext.viewModel;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 指令初始化
     */
    FarrisTreeTableBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        // 将分级码信息保存到root-component，而非整个表单的app-context
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        virtualRootFrameContext.setParam('hierarchyInfoKey', this.hierarchyInfoKey);
        this.bindData();
        this.bindingData.changes.subscribe(function (change) {
            if (change && (change.type === ChangeType.ValueChanged || change.type === ChangeType.PaginationInfoChange)) {
                _this.renderSubject.next(change);
            }
            else {
                _this.bindData();
            }
            // 设置当前行
            var currentId = _this.bindingList.currentId;
            if (!_this.frameContext.bindingData.rowSelectedEventSuspend && currentId) {
                _this.setSelectedIdToTree(_this.bindingList.currentId);
            }
            _this.updateCheckedRows(change);
        });
        // 设置 树表 格式化
        this.treetableFormatSer.setFormat(this.treeTable);
        /* 行样式 */
        this.rowClass.emit(this.treeTable);
        /* 列样式  单元格样式 */
        this.cellClass.emit(this.treeTable);
        this.setComponentRef();
        this.setNodePaginationInfo();
        this.registerEvent();
        if (this.frameContext && this.frameContext.frameComponent) {
            this.frameContext.frameComponent.componentType = ComponentType.farrisTreeTalbeComponent;
        }
    };
    /**
     * 指令输入变更
     */
    FarrisTreeTableBindingDirective.prototype.ngOnChanges = function (changes) {
    };
    FarrisTreeTableBindingDirective.prototype.registerEvent = function () {
        var _this = this;
        this.treeTable.columnSorted.subscribe(function (event) {
            var _a = event.sortName, sortName = _a === void 0 ? null : _a, _b = event.sortOrder, sortOrder = _b === void 0 ? null : _b;
            var remoteSort = _this.treeTable.remoteSort;
            if (remoteSort === false) {
                if (sortName && sortOrder) {
                    _this.bindingList.sortBy(sortName, sortOrder);
                }
            }
            _this.bindData();
        });
    };
    /**
     * 收集树组件实例
     */
    FarrisTreeTableBindingDirective.prototype.setComponentRef = function () {
        var appContext = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.getFormAppContext();
        var frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId;
        var id = this.treeTable && this.treeTable.el.nativeElement.id || null;
        // 如果frameId不存在或treetable没有id属性，说明不符合使用场景
        if (!frameId || !id) {
            return;
        }
        var map = appContext && appContext.componentRefs && appContext.componentRefs.get(frameId) || new Map();
        appContext && appContext.componentRefs && appContext.componentRefs.set(frameId, map.set(id, this.treeTable));
    };
    FarrisTreeTableBindingDirective.prototype.setNodePaginationInfo = function () {
        if (this.frameContext) {
            var enableNodePagination = this.treeTable.paginationForChildren || false; //this.enableNodePagination || false;
            this.frameContext.params.set('enableNodePagination', enableNodePagination);
            var nodePageSize = this.nodePageSize || 0;
            this.frameContext.params.set('nodePageSize', nodePageSize);
        }
    };
    /**
     * 绑定数据
     */
    FarrisTreeTableBindingDirective.prototype.bindData = function () {
        var oldTreeNodes = this.treeTable.data;
        var treeNodesData = this.bindingList.toJSON({ ignoreMultiLangInput: true });
        // if (!this.shouldComponentUpdate(treeNodesData)) {
        //   return;
        // }
        this.prop = treeNodesData;
        var treeNodes = [];
        if (!!treeNodesData && treeNodesData.length > 0) {
            var hierarchyInfo = treeNodesData[0][this.hierarchyInfoKey];
            var builder = this.builder;
            if (!builder) {
                this.builder = TreeNodeBuilderFactory.getBuilder(hierarchyInfo);
                builder = this.builder;
            }
            // 服务器返回的分级节点信息匹配不到现有工厂里面的任何一种情况。确认新加的builder已经在工厂中注册
            if (builder == null) {
                throw new Error('TreeTable builder is null!');
            }
            var expandLevel = -1;
            var treeExpandLevel = this.treeTable['expandLevel'];
            if (typeof treeExpandLevel !== 'undefined') {
                expandLevel = treeExpandLevel;
            }
            var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            var nodesShouldExpand = (virtualRootFrameContext.params.get('_DEVKIT_expandRowIds') || '').split(',') || [];
            var context = {
                expandLevel: expandLevel,
                addTreeLoadCompleteListener: this.addTreeLoadCompleteListener.bind(this),
                component: this.treeTable,
                storage: this.storage,
                nodesShouldExpand: nodesShouldExpand,
                frameContext: this.frameContext,
            };
            //if (!this.treeNodesBuilder) {
            this.treeNodesBuilder = new builder(treeNodesData, oldTreeNodes, this.bindingList.primaryKey, this.hierarchyInfoKey, context);
            //}
            // this.treeNodesBuilder.updateTreeNode(treeNodesData, oldTreeNodes);
            treeNodes = this.treeNodesBuilder.build();
        }
        this.treeTable.data = treeNodes;
        // 设置分页信息
        this.updatePageInfo(this.treeTable);
        this.onTreeLoadComplete();
    };
    FarrisTreeTableBindingDirective.prototype.onTreeLoadComplete = function () {
        if (this.listeners && this.listeners.length > 0) {
            this.listeners.forEach(function (listener) {
                listener();
            });
        }
    };
    FarrisTreeTableBindingDirective.prototype.addTreeLoadCompleteListener = function (listener) {
        this.listeners.push(listener);
    };
    FarrisTreeTableBindingDirective.prototype.shouldComponentUpdate = function (newProp) {
        if (JSON.stringify(this.prop) === JSON.stringify(newProp)) {
            return false;
        }
        return true;
    };
    /**
     * 从树组件上获取选中行的id
     */
    FarrisTreeTableBindingDirective.prototype.getSelectedIdFromTree = function () {
        var selectedRow = this.treeTable.selectedRow;
        return selectedRow ? selectedRow.data['id'] : null;
    };
    /**
     * 设置TreeTable的当前行
     */
    FarrisTreeTableBindingDirective.prototype.setSelectedIdToTree = function (selectedId) {
        if (!selectedId) {
            return;
        }
        // 如果新的currentId和树上的selectedId不一致，重置树的当前行
        var oldSelectedId = this.getSelectedIdFromTree();
        var nodePageChanged = this.frameContext.params.get('_NODE_PAGE_CHANGED_') || false;
        if (!oldSelectedId && nodePageChanged) {
            this.frameContext.params.delete('_NODE_PAGE_CHANGED_');
            return;
        }
        if (oldSelectedId !== selectedId) {
            this.treeTable.clearSelections();
            this.treeTable.selectNode(selectedId);
        }
    };
    /**
     * 设置BindingList的CurrentId
     */
    FarrisTreeTableBindingDirective.prototype.setCurrentIdToBindingList = function (selectedId) {
        var oldCurrentId = this.bindingData.list.currentId;
        // 单选模式下将当前行设置到ids
        if (!this.treeTable.multiSelect) {
            this.setChecks(selectedId);
            this.setCheckedRows([selectedId]);
        }
        if (oldCurrentId === selectedId) {
            return;
        }
        this.bindingData.list.setCurrentId(selectedId, true);
    };
    FarrisTreeTableBindingDirective.prototype.updateCheckedRows = function (changes) {
        if (changes.type === ChangeType.Load) {
            this.setCheckedRows();
        }
        else if (changes.type === ChangeType.ValueChanged || changes.type === ChangeType.Remove) {
            var ids = this.getChecks();
            if (changes.id && ids.includes(changes.id)) {
                this.setCheckedRows();
            }
        }
    };
    /**
     * 更新勾选行数据
     */
    FarrisTreeTableBindingDirective.prototype.setCheckedRows = function (ids) {
        var _this = this;
        if (typeof ids === 'undefined') {
            ids = this.viewModel.uiState['ids'] || [];
        }
        if (!Array.isArray(ids)) {
            return;
        }
        var list = this.bindingList.toJSON();
        var rows = this.viewModel.uiState['rows'] || new Map();
        var result = new Map();
        ids.forEach(function (id) {
            var item = list.find(function (item) { return item[_this.bindingList.primaryKey] === id; });
            var otherPageItem = rows.get(id);
            if (item) {
                result.set(id, item);
            }
            else if (otherPageItem) {
                result.set(id, otherPageItem);
            }
        });
        this.viewModel.uiState.setPropertyValue('rows', result);
    };
    /**
     * 设置ids变量
     * @param idOrIds id or ids
     */
    FarrisTreeTableBindingDirective.prototype.setChecks = function (idOrIds) {
        if (typeof idOrIds === 'string') {
            idOrIds = idOrIds.split(',').filter(function (p) { return p; });
        }
        this.viewModel.uiState.setPropertyValue('ids', idOrIds);
    };
    /**
     * 获取勾选行id数组
     * @returns
     */
    FarrisTreeTableBindingDirective.prototype.getChecks = function () {
        return this.viewModel.uiState['ids'] || [];
    };
    /**
     * 获取分页信息
     */
    FarrisTreeTableBindingDirective.prototype.getPagingInfo = function () {
        var bindingPath = this.viewModel.bindingPath;
        var bindingData = this.viewModel.bindingData;
        var pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; }).map(function (item) {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(function (path) {
                pagingInfo = pagingInfo && pagingInfo[path];
            });
            return pagingInfo;
        }
    };
    FarrisTreeTableBindingDirective.prototype.updatePageInfo = function (treeTable) {
        var _a = this.getPagingInfo(), pageIndex = _a.pageIndex, pageSize = _a.pageSize, total = _a.total;
        if (pageSize === 0) {
            treeTable.pagination = false;
            return;
        }
        treeTable.pagination = true;
        treeTable.updatePageInfo({ pageIndex: pageIndex, pageSize: pageSize, total: total });
    };
    //#region 组件事件
    /**
     * 行切换
     */
    FarrisTreeTableBindingDirective.prototype.selectionChangeHandler = function (event) {
        if (event && event.node && event.node.hasOwnProperty('data')) {
            var idField = this.treeTable.idField;
            var id = event.node.data[idField];
            this.setCurrentIdToBindingList(id);
        }
    };
    /**
     * 勾选节点发生变化
     * @param event event
     */
    FarrisTreeTableBindingDirective.prototype.checkValuesChange = function (event) {
        // this.viewModel.uiState.setPropertyValue('ids', this.treeTable.checkValues);
        this.setChecks(this.treeTable.checkValues);
        this.setCheckedRows();
    };
    /**
     * 将被展开的节点设置为当前行
     */
    FarrisTreeTableBindingDirective.prototype.expandHandler = function (event) {
        var selectedId = event.data['id'];
        var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
        // 展开时不再选中
        // this.setSelectedIdToTree(selectedId);
        var expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(selectedId);
        virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    FarrisTreeTableBindingDirective.prototype.onPageChanged = function (event) {
        var _a = event || {}, _b = _a.pageSize, pageSize = _b === void 0 ? 20 : _b, _c = _a.pageIndex, pageIndex = _c === void 0 ? 1 : _c;
        if (pageIndex < 1) {
            pageIndex = 1;
        }
        var skip = (pageIndex - 1) * pageSize;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    FarrisTreeTableBindingDirective.prototype.onPageSizeChanged = function (event) {
        var pageSize = event ? event : 20;
        var skip = 0;
        this.bindingData.setPagingInfo(skip, pageSize, this.bindingData.bindingPath);
    };
    /**
     * 节点页码切换事件
     * @param event event
     */
    FarrisTreeTableBindingDirective.prototype.onNodePageChanged = function (event) {
        var _a = event.pageIndex, pageIndex = _a === void 0 ? 1 : _a, _b = event.pageSize, pageSize = _b === void 0 ? this.nodePageSize : _b, _c = event.node, node = _c === void 0 ? {} : _c;
        var id = node && node.id || null;
        if (id) {
            var virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();
            var expandNodes = virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
            expandNodes.push(id);
            virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
            this.frameContext.params.set("_NODE_" + id + "_PAGE_INDEX_", pageIndex);
            this.frameContext.params.set("_RELOAD_CHILDREN_", true);
            this.frameContext.params.set('_NODE_PAGE_CHANGED_', true);
        }
    };
    FarrisTreeTableBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisTreeTableBinding]'
                },] }
    ];
    /** @nocollapse */
    FarrisTreeTableBindingDirective.ctorParameters = function () { return [
        { type: TreeTableComponent },
        { type: FarrisTreetableFormatService },
        { type: FrameContext }
    ]; };
    FarrisTreeTableBindingDirective.propDecorators = {
        hierarchyInfoKey: [{ type: Input, args: ['farrisHierarchyInfoKey',] }],
        rowClassName: [{ type: Input }],
        cellClassName: [{ type: Input }],
        nodePageSize: [{ type: Input, args: ['nodePageSize',] }],
        rowClass: [{ type: Output }],
        cellClass: [{ type: Output }],
        selectionChangeHandler: [{ type: HostListener, args: ['nodeSelected', ['$event'],] }],
        checkValuesChange: [{ type: HostListener, args: ['checkValuesChange', ['$event'],] }],
        expandHandler: [{ type: HostListener, args: ['expand', ['$event'],] }],
        onPageChanged: [{ type: HostListener, args: ['pageChanged', ['$event'],] }],
        onPageSizeChanged: [{ type: HostListener, args: ['pageSizeChanged', ['$event'],] }],
        onNodePageChanged: [{ type: HostListener, args: ['childsPageChanged', ['$event'],] }]
    };
    return FarrisTreeTableBindingDirective;
}());
export { FarrisTreeTableBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFycmlzX3RyZWVfdGFibGVfYmluZGluZy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy9mYXJyaXNfdHJlZV90YWJsZV9iaW5kaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUNILG9DQUFvQztBQUVwQyxPQUFPLEVBQUUsU0FBUyxFQUFvQyxLQUFLLEVBQUUsWUFBWSxFQUFRLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0gsT0FBTyxFQUE0QixZQUFZLEVBQVUsVUFBVSxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNHLE9BQU8sRUFBRSxrQkFBa0IsRUFBWSxNQUFNLHNCQUFzQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRTdGOztHQUVHO0FBQ0g7SUEwRUU7O09BRUc7SUFDSCx5Q0FDVSxTQUE2QixFQUM3QixrQkFBZ0QsRUFDaEQsWUFBMEI7UUFIcEMsaUJBY0M7UUFiUyxjQUFTLEdBQVQsU0FBUyxDQUFvQjtRQUM3Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQThCO1FBQ2hELGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBeEU1QixrQkFBYSxHQUFpQixJQUFJLE9BQU8sRUFBTyxDQUFDO1FBaUJ6RDs7V0FFRztRQUNILGlDQUFpQztRQUNqQyx3Q0FBd0M7UUFDeEM7O1dBRUc7UUFFSSxpQkFBWSxHQUFXLEdBQUcsQ0FBQztRQWtCbEMsV0FBVztRQUVYLGFBQVEsR0FBc0IsSUFB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LG1CQUFtQixFQUFFLENBQUMsUUFBUSxDQUFDOztJQWUvQyxzQ0FBQztDQUFBLEFBaGJELElBZ2JDO0FBRUQsT0FBTyxFQUFFLCtCQUErQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBAQXV0aG9yOiBhYWxpenp3ZWxsIFxyXG4gKiBARGF0ZTogMjAyMC0wMi0yNyAxMTozMzo0MSBcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAyMC0wMi0yNyAxMTozNDoxNlxyXG4gKi9cclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcblxyXG5pbXBvcnQgeyBEaXJlY3RpdmUsIE9uSW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSG9zdExpc3RlbmVyLCBUeXBlLCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QsIEZyYW1lQ29udGV4dCwgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBDb21wb25lbnRUeXBlIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQsIFRyZWVOb2RlIH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRmFycmlzVHJlZXRhYmxlRm9ybWF0U2VydmljZSB9IGZyb20gJy4uL2Zvcm1hdC9pbmRleCc7XHJcbmltcG9ydCB7IFRyZWVOb2RlQnVpbGRlckZhY3RvcnkgfSBmcm9tICcuL3RyZWVfdGFibGVfbm9kZV9idWlsZGVyL3RyZWVfbm9kZV9idWlsZGVyX2ZhY3RvcnknO1xyXG5cclxuLyoqXHJcbiAqIOagkeihqOagvOe7keWumuaMh+S7pFxyXG4gKi9cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZmFycmlzVHJlZVRhYmxlQmluZGluZ10nXHJcbn0pXHJcbmNsYXNzIEZhcnJpc1RyZWVUYWJsZUJpbmRpbmdEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgLyoqXHJcbiAgICog5qCR5a2Y5YKo56m66Ze0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdG9yYWdlOiBhbnk7XHJcbiAgcHJpdmF0ZSByZW5kZXJTdWJqZWN0OiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgcHJpdmF0ZSBidWlsZGVyOiBUeXBlPGFueT47XHJcbiAgcHJpdmF0ZSB0cmVlTm9kZXNCdWlsZGVyOiBhbnk7XHJcbiAgLyoqXHJcbiAgICog5YiG57qn56CB5L+h5oGv55qEa2V5XHJcbiAgICovXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1pbnB1dC1yZW5hbWVcclxuICBASW5wdXQoJ2ZhcnJpc0hpZXJhcmNoeUluZm9LZXknKVxyXG4gIHB1YmxpYyBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qIOihjOagt+W8jyAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgcm93Q2xhc3NOYW1lOiAoY29udGV4dDogYW55KSA9PiBhbnk7XHJcblxyXG4gIC8qIOWIl+WSjOWNleWFg+agvOagt+W8jyAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgY2VsbENsYXNzTmFtZTogKGRhdGE6IGFueSwgZmllbGQ6IGFueSkgPT4gYW55O1xyXG4gIC8qKlxyXG4gICAqIOWQr+eUqOiKgueCueWIhumhtVxyXG4gICAqL1xyXG4gIC8vIEBJbnB1dCgnZW5hYmxlTm9kZVBhZ2luYXRpb24nKVxyXG4gIC8vIHB1YmxpYyBlbmFibGVOb2RlUGFnaW5hdGlvbjogYm9vbGVhbjtcclxuICAvKipcclxuICAgKiDoioLngrnliIbpobXlpKflsI9cclxuICAgKi9cclxuICBASW5wdXQoJ25vZGVQYWdlU2l6ZScpXHJcbiAgcHVibGljIG5vZGVQYWdlU2l6ZTogbnVtYmVyID0gMTAwO1xyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdEYXRhKCk6IEJpbmRpbmdEYXRhIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuaVsOaNruWIl+ihqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuXHJcbiAgICAvLyBAdG9kb++8muWPquaUr+aMgeS4u+ihqO+8jOayoeacieWkhOeQhmJpbmRpbmdQYXRoXHJcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nRGF0YS5saXN0O1xyXG4gIH1cclxuXHJcblxyXG4gIC8qIOiuvue9ruihjOagt+W8jyAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIHJvd0NsYXNzOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAvKiDorr7nva7liJfmoLflvI8gKi9cclxuICBAT3V0cHV0KClcclxuICBjZWxsQ2xhc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIHByaXZhdGUgX1BST1A6IGFueSA9IG51bGw7XHJcbiAgcHJpdmF0ZSBsaXN0ZW5lcnM6IGFueVtdO1xyXG4gIHByaXZhdGUgZ2V0IHByb3AoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fUFJPUDtcclxuICB9XHJcbiAgcHJpdmF0ZSBzZXQgcHJvcCh2YWx1ZSkge1xyXG4gICAgdGhpcy5fUFJPUCA9IHZhbHVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blvZPliY12bVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IHZpZXdNb2RlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWw7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSB0cmVlVGFibGU6IFRyZWVUYWJsZUNvbXBvbmVudCxcclxuICAgIHByaXZhdGUgdHJlZXRhYmxlRm9ybWF0U2VyOiBGYXJyaXNUcmVldGFibGVGb3JtYXRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dFxyXG4gICkge1xyXG4gICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcclxuICAgIHRoaXMuc3RvcmFnZSA9IFtdO1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnRyZWVUYWJsZS5jaGVja1ZhbHVlcyk7XHJcbiAgICB0aGlzLnJlbmRlclN1YmplY3QucGlwZShcclxuICAgICAgZGVib3VuY2VUaW1lKDUwMClcclxuICAgICkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5iaW5kRGF0YSgpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyH5Luk5Yid5aeL5YyWXHJcbiAgICovXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICAvLyDlsIbliIbnuqfnoIHkv6Hmga/kv53lrZjliLByb290LWNvbXBvbmVudO+8jOiAjOmdnuaVtOS4quihqOWNleeahGFwcC1jb250ZXh0XHJcbiAgICBjb25zdCB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnaGllcmFyY2h5SW5mb0tleScsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAoY2hhbmdlICYmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UpKSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJTdWJqZWN0Lm5leHQoY2hhbmdlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g6K6+572u5b2T5YmN6KGMXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJZCA9IHRoaXMuYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgICBpZiAoIXRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnJvd1NlbGVjdGVkRXZlbnRTdXNwZW5kICYmIGN1cnJlbnRJZCkge1xyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJZFRvVHJlZSh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy51cGRhdGVDaGVja2VkUm93cyhjaGFuZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6K6+572uIOagkeihqCDmoLzlvI/ljJZcclxuICAgIHRoaXMudHJlZXRhYmxlRm9ybWF0U2VyLnNldEZvcm1hdCh0aGlzLnRyZWVUYWJsZSk7XHJcblxyXG4gICAgLyog6KGM5qC35byPICovXHJcbiAgICB0aGlzLnJvd0NsYXNzLmVtaXQodGhpcy50cmVlVGFibGUpO1xyXG5cclxuICAgIC8qIOWIl+agt+W8jyAg5Y2V5YWD5qC85qC35byPICovXHJcbiAgICB0aGlzLmNlbGxDbGFzcy5lbWl0KHRoaXMudHJlZVRhYmxlKTtcclxuICAgIHRoaXMuc2V0Q29tcG9uZW50UmVmKCk7XHJcbiAgICB0aGlzLnNldE5vZGVQYWdpbmF0aW9uSW5mbygpO1xyXG4gICAgdGhpcy5yZWdpc3RlckV2ZW50KCk7XHJcbiAgICBpZiAodGhpcy5mcmFtZUNvbnRleHQgJiYgdGhpcy5mcmFtZUNvbnRleHQuZnJhbWVDb21wb25lbnQpIHtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQuZnJhbWVDb21wb25lbnQuY29tcG9uZW50VHlwZSA9IENvbXBvbmVudFR5cGUuZmFycmlzVHJlZVRhbGJlQ29tcG9uZW50O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyH5Luk6L6T5YWl5Y+Y5pu0XHJcbiAgICovXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gIH1cclxuICBwcml2YXRlIHJlZ2lzdGVyRXZlbnQoKSB7XHJcbiAgICB0aGlzLnRyZWVUYWJsZS5jb2x1bW5Tb3J0ZWQuc3Vic2NyaWJlKChldmVudDogeyBzb3J0TmFtZTogc3RyaW5nLCBzb3J0T3JkZXI6IHN0cmluZyB9KSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgc29ydE5hbWUgPSBudWxsLCBzb3J0T3JkZXIgPSBudWxsIH0gPSBldmVudDtcclxuICAgICAgY29uc3QgcmVtb3RlU29ydCA9IHRoaXMudHJlZVRhYmxlLnJlbW90ZVNvcnQ7XHJcbiAgICAgIGlmIChyZW1vdGVTb3J0ID09PSBmYWxzZSkge1xyXG4gICAgICAgIGlmIChzb3J0TmFtZSAmJiBzb3J0T3JkZXIpIHtcclxuICAgICAgICAgIHRoaXMuYmluZGluZ0xpc3Quc29ydEJ5KHNvcnROYW1lLCBzb3J0T3JkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLmJpbmREYXRhKCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pS26ZuG5qCR57uE5Lu25a6e5L6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRDb21wb25lbnRSZWYoKSB7XHJcbiAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0ICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5nZXRGb3JtQXBwQ29udGV4dCgpO1xyXG4gICAgY29uc3QgZnJhbWVJZCA9IHRoaXMudmlld01vZGVsICYmIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZnJhbWVJZDtcclxuICAgIGNvbnN0IGlkID0gdGhpcy50cmVlVGFibGUgJiYgdGhpcy50cmVlVGFibGUuZWwubmF0aXZlRWxlbWVudC5pZCB8fCBudWxsO1xyXG4gICAgLy8g5aaC5p6cZnJhbWVJZOS4jeWtmOWcqOaIlnRyZWV0YWJsZeayoeaciWlk5bGe5oCn77yM6K+05piO5LiN56ym5ZCI5L2/55So5Zy65pmvXHJcbiAgICBpZiAoIWZyYW1lSWQgfHwgIWlkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IG1hcCA9IGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcy5nZXQoZnJhbWVJZCkgfHwgbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGFwcENvbnRleHQgJiYgYXBwQ29udGV4dC5jb21wb25lbnRSZWZzICYmIGFwcENvbnRleHQuY29tcG9uZW50UmVmcy5zZXQoZnJhbWVJZCwgbWFwLnNldChpZCwgdGhpcy50cmVlVGFibGUpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0Tm9kZVBhZ2luYXRpb25JbmZvKCkge1xyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgIGNvbnN0IGVuYWJsZU5vZGVQYWdpbmF0aW9uID0gdGhpcy50cmVlVGFibGUucGFnaW5hdGlvbkZvckNoaWxkcmVuIHx8IGZhbHNlOy8vdGhpcy5lbmFibGVOb2RlUGFnaW5hdGlvbiB8fCBmYWxzZTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldCgnZW5hYmxlTm9kZVBhZ2luYXRpb24nLCBlbmFibGVOb2RlUGFnaW5hdGlvbik7XHJcbiAgICAgIGNvbnN0IG5vZGVQYWdlU2l6ZSA9IHRoaXMubm9kZVBhZ2VTaXplIHx8IDA7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoJ25vZGVQYWdlU2l6ZScsIG5vZGVQYWdlU2l6ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnu5HlrprmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGJpbmREYXRhKCkge1xyXG4gICAgY29uc3Qgb2xkVHJlZU5vZGVzID0gdGhpcy50cmVlVGFibGUuZGF0YTtcclxuICAgIGNvbnN0IHRyZWVOb2Rlc0RhdGEgPSB0aGlzLmJpbmRpbmdMaXN0LnRvSlNPTih7IGlnbm9yZU11bHRpTGFuZ0lucHV0OiB0cnVlIH0pO1xyXG4gICAgLy8gaWYgKCF0aGlzLnNob3VsZENvbXBvbmVudFVwZGF0ZSh0cmVlTm9kZXNEYXRhKSkge1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICB0aGlzLnByb3AgPSB0cmVlTm9kZXNEYXRhO1xyXG5cclxuICAgIGxldCB0cmVlTm9kZXM6IFRyZWVOb2RlW10gPSBbXTtcclxuICAgIGlmICghIXRyZWVOb2Rlc0RhdGEgJiYgdHJlZU5vZGVzRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGhpZXJhcmNoeUluZm8gPSB0cmVlTm9kZXNEYXRhWzBdW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgICAgIGxldCBidWlsZGVyOiBUeXBlPGFueT4gPSB0aGlzLmJ1aWxkZXI7XHJcbiAgICAgIGlmICghYnVpbGRlcikge1xyXG4gICAgICAgIHRoaXMuYnVpbGRlciA9IFRyZWVOb2RlQnVpbGRlckZhY3RvcnkuZ2V0QnVpbGRlcihoaWVyYXJjaHlJbmZvKTtcclxuICAgICAgICBidWlsZGVyID0gdGhpcy5idWlsZGVyO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOacjeWKoeWZqOi/lOWbnueahOWIhue6p+iKgueCueS/oeaBr+WMuemFjeS4jeWIsOeOsOacieW3peWOgumHjOmdoueahOS7u+S9leS4gOenjeaDheWGteOAguehruiupOaWsOWKoOeahGJ1aWxkZXLlt7Lnu4/lnKjlt6XljoLkuK3ms6jlhoxcclxuICAgICAgaWYgKGJ1aWxkZXIgPT0gbnVsbCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVHJlZVRhYmxlIGJ1aWxkZXIgaXMgbnVsbCEnKTtcclxuICAgICAgfVxyXG4gICAgICBsZXQgZXhwYW5kTGV2ZWwgPSAtMTtcclxuICAgICAgY29uc3QgdHJlZUV4cGFuZExldmVsID0gdGhpcy50cmVlVGFibGVbJ2V4cGFuZExldmVsJ107XHJcbiAgICAgIGlmICh0eXBlb2YgdHJlZUV4cGFuZExldmVsICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIGV4cGFuZExldmVsID0gdHJlZUV4cGFuZExldmVsO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuZ2V0VmlydHVhbFJvb3RGcmFtZUNvbnRleHQoKTtcclxuICAgICAgY29uc3Qgbm9kZXNTaG91bGRFeHBhbmQgPSAodmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmdldCgnX0RFVktJVF9leHBhbmRSb3dJZHMnKSB8fCAnJykuc3BsaXQoJywnKSB8fCBbXTtcclxuICAgICAgY29uc3QgY29udGV4dCA9IHtcclxuICAgICAgICBleHBhbmRMZXZlbCxcclxuICAgICAgICBhZGRUcmVlTG9hZENvbXBsZXRlTGlzdGVuZXI6IHRoaXMuYWRkVHJlZUxvYWRDb21wbGV0ZUxpc3RlbmVyLmJpbmQodGhpcyksXHJcbiAgICAgICAgY29tcG9uZW50OiB0aGlzLnRyZWVUYWJsZSxcclxuICAgICAgICBzdG9yYWdlOiB0aGlzLnN0b3JhZ2UsXHJcbiAgICAgICAgbm9kZXNTaG91bGRFeHBhbmQ6IG5vZGVzU2hvdWxkRXhwYW5kLFxyXG4gICAgICAgIGZyYW1lQ29udGV4dDogdGhpcy5mcmFtZUNvbnRleHQsXHJcbiAgICAgIH07XHJcbiAgICAgIC8vaWYgKCF0aGlzLnRyZWVOb2Rlc0J1aWxkZXIpIHtcclxuICAgICAgdGhpcy50cmVlTm9kZXNCdWlsZGVyID0gbmV3IGJ1aWxkZXIoXHJcbiAgICAgICAgdHJlZU5vZGVzRGF0YSwgb2xkVHJlZU5vZGVzLFxyXG4gICAgICAgIHRoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBjb250ZXh0XHJcbiAgICAgICk7XHJcbiAgICAgIC8vfVxyXG4gICAgICAvLyB0aGlzLnRyZWVOb2Rlc0J1aWxkZXIudXBkYXRlVHJlZU5vZGUodHJlZU5vZGVzRGF0YSwgb2xkVHJlZU5vZGVzKTtcclxuICAgICAgdHJlZU5vZGVzID0gdGhpcy50cmVlTm9kZXNCdWlsZGVyLmJ1aWxkKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRyZWVUYWJsZS5kYXRhID0gdHJlZU5vZGVzO1xyXG4gICAgLy8g6K6+572u5YiG6aG15L+h5oGvXHJcbiAgICB0aGlzLnVwZGF0ZVBhZ2VJbmZvKHRoaXMudHJlZVRhYmxlKTtcclxuICAgIHRoaXMub25UcmVlTG9hZENvbXBsZXRlKCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgb25UcmVlTG9hZENvbXBsZXRlKCkge1xyXG4gICAgaWYgKHRoaXMubGlzdGVuZXJzICYmIHRoaXMubGlzdGVuZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5saXN0ZW5lcnMuZm9yRWFjaChsaXN0ZW5lciA9PiB7XHJcbiAgICAgICAgbGlzdGVuZXIoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgYWRkVHJlZUxvYWRDb21wbGV0ZUxpc3RlbmVyKGxpc3RlbmVyOiBhbnkpIHtcclxuICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpO1xyXG4gIH1cclxuICBwcml2YXRlIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXdQcm9wOiBhbnkpIHtcclxuICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLnByb3ApID09PSBKU09OLnN0cmluZ2lmeShuZXdQcm9wKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuO5qCR57uE5Lu25LiK6I635Y+W6YCJ5Lit6KGM55qEaWRcclxuICAgKi9cclxuICBwcml2YXRlIGdldFNlbGVjdGVkSWRGcm9tVHJlZSgpOiBzdHJpbmcge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRSb3cgPSB0aGlzLnRyZWVUYWJsZS5zZWxlY3RlZFJvdztcclxuICAgIHJldHVybiBzZWxlY3RlZFJvdyA/IHNlbGVjdGVkUm93LmRhdGFbJ2lkJ10gOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572uVHJlZVRhYmxl55qE5b2T5YmN6KGMXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRTZWxlY3RlZElkVG9UcmVlKHNlbGVjdGVkSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgaWYgKCFzZWxlY3RlZElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOWmguaenOaWsOeahGN1cnJlbnRJZOWSjOagkeS4iueahHNlbGVjdGVkSWTkuI3kuIDoh7TvvIzph43nva7moJHnmoTlvZPliY3ooYxcclxuICAgIGNvbnN0IG9sZFNlbGVjdGVkSWQgPSB0aGlzLmdldFNlbGVjdGVkSWRGcm9tVHJlZSgpO1xyXG4gICAgY29uc3Qgbm9kZVBhZ2VDaGFuZ2VkID0gdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLmdldCgnX05PREVfUEFHRV9DSEFOR0VEXycpIHx8IGZhbHNlO1xyXG4gICAgaWYgKCFvbGRTZWxlY3RlZElkICYmIG5vZGVQYWdlQ2hhbmdlZCkge1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZGVsZXRlKCdfTk9ERV9QQUdFX0NIQU5HRURfJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChvbGRTZWxlY3RlZElkICE9PSBzZWxlY3RlZElkKSB7XHJcbiAgICAgIHRoaXMudHJlZVRhYmxlLmNsZWFyU2VsZWN0aW9ucygpO1xyXG4gICAgICB0aGlzLnRyZWVUYWJsZS5zZWxlY3ROb2RlKHNlbGVjdGVkSWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572uQmluZGluZ0xpc3TnmoRDdXJyZW50SWRcclxuICAgKi9cclxuICBwcml2YXRlIHNldEN1cnJlbnRJZFRvQmluZGluZ0xpc3Qoc2VsZWN0ZWRJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCBvbGRDdXJyZW50SWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG4gICAgLy8g5Y2V6YCJ5qih5byP5LiL5bCG5b2T5YmN6KGM6K6+572u5YiwaWRzXHJcbiAgICBpZiAoIXRoaXMudHJlZVRhYmxlLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgIHRoaXMuc2V0Q2hlY2tzKHNlbGVjdGVkSWQpO1xyXG4gICAgICB0aGlzLnNldENoZWNrZWRSb3dzKFtzZWxlY3RlZElkXSk7XHJcbiAgICB9XHJcbiAgICBpZiAob2xkQ3VycmVudElkID09PSBzZWxlY3RlZElkKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuYmluZGluZ0RhdGEubGlzdC5zZXRDdXJyZW50SWQoc2VsZWN0ZWRJZCwgdHJ1ZSk7XHJcbiAgfVxyXG4gIHByaXZhdGUgdXBkYXRlQ2hlY2tlZFJvd3MoY2hhbmdlczogQ2hhbmdlKSB7XHJcbiAgICBpZiAoY2hhbmdlcy50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQpIHtcclxuICAgICAgdGhpcy5zZXRDaGVja2VkUm93cygpO1xyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2VzLnR5cGUgPT09IENoYW5nZVR5cGUuVmFsdWVDaGFuZ2VkIHx8IGNoYW5nZXMudHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUpIHtcclxuICAgICAgY29uc3QgaWRzID0gdGhpcy5nZXRDaGVja3MoKTtcclxuICAgICAgaWYgKGNoYW5nZXMuaWQgJiYgaWRzLmluY2x1ZGVzKGNoYW5nZXMuaWQpKSB7XHJcbiAgICAgICAgdGhpcy5zZXRDaGVja2VkUm93cygpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWLvumAieihjOaVsOaNrlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzZXRDaGVja2VkUm93cyhpZHM/OiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKHR5cGVvZiBpZHMgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGlkcyA9IHRoaXMudmlld01vZGVsLnVpU3RhdGVbJ2lkcyddIHx8IFtdO1xyXG4gICAgfVxyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGlkcykpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbGlzdCA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCk7XHJcbiAgICBjb25zdCByb3dzOiBNYXA8c3RyaW5nLCBhbnk+ID0gdGhpcy52aWV3TW9kZWwudWlTdGF0ZVsncm93cyddIHx8IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGlkcy5mb3JFYWNoKChpZDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW0gPSBsaXN0LmZpbmQoaXRlbSA9PiBpdGVtW3RoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleV0gPT09IGlkKTtcclxuICAgICAgY29uc3Qgb3RoZXJQYWdlSXRlbSA9IHJvd3MuZ2V0KGlkKTtcclxuICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICByZXN1bHQuc2V0KGlkLCBpdGVtKTtcclxuICAgICAgfSBlbHNlIGlmIChvdGhlclBhZ2VJdGVtKSB7XHJcbiAgICAgICAgcmVzdWx0LnNldChpZCwgb3RoZXJQYWdlSXRlbSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdyb3dzJywgcmVzdWx0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572uaWRz5Y+Y6YePXHJcbiAgICogQHBhcmFtIGlkT3JJZHMgaWQgb3IgaWRzXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNldENoZWNrcyhpZE9ySWRzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xyXG4gICAgaWYgKHR5cGVvZiBpZE9ySWRzID09PSAnc3RyaW5nJykge1xyXG4gICAgICBpZE9ySWRzID0gaWRPcklkcy5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApO1xyXG4gICAgfVxyXG4gICAgdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCBpZE9ySWRzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Yu+6YCJ6KGMaWTmlbDnu4RcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0Q2hlY2tzKCk6IHN0cmluZ1tdIHtcclxuICAgIHJldHVybiB0aGlzLnZpZXdNb2RlbC51aVN0YXRlWydpZHMnXSB8fCBbXTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQYWdpbmdJbmZvKCkge1xyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aDtcclxuICAgIGNvbnN0IGJpbmRpbmdEYXRhID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGE7XHJcbiAgICBsZXQgcGFnaW5nSW5mbyA9IGJpbmRpbmdEYXRhLnBhZ2luZ0luZm87XHJcbiAgICBpZiAoYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gcGFnaW5nSW5mbztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnN1YnN0cigxKS5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+ICEhaXRlbSAmJiBpdGVtLmxlbmd0aCA+IDApLm1hcChpdGVtID0+IHtcclxuICAgICAgICByZXR1cm4gaXRlbS5zdWJzdHJpbmcoMCwgaXRlbS5sZW5ndGggLSAxKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGJpbmRpbmdQYXRocy5mb3JFYWNoKHBhdGggPT4ge1xyXG4gICAgICAgIHBhZ2luZ0luZm8gPSBwYWdpbmdJbmZvICYmIHBhZ2luZ0luZm9bcGF0aF07XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gcGFnaW5nSW5mbztcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSB1cGRhdGVQYWdlSW5mbyh0cmVlVGFibGU6IFRyZWVUYWJsZUNvbXBvbmVudCkge1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCk7XHJcbiAgICBpZiAocGFnZVNpemUgPT09IDApIHtcclxuICAgICAgdHJlZVRhYmxlLnBhZ2luYXRpb24gPSBmYWxzZTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdHJlZVRhYmxlLnBhZ2luYXRpb24gPSB0cnVlO1xyXG4gICAgdHJlZVRhYmxlLnVwZGF0ZVBhZ2VJbmZvKHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWwgfSk7XHJcbiAgfVxyXG4gIC8vI3JlZ2lvbiDnu4Tku7bkuovku7ZcclxuICAvKipcclxuICAgKiDooYzliIfmjaJcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdub2RlU2VsZWN0ZWQnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzZWxlY3Rpb25DaGFuZ2VIYW5kbGVyKGV2ZW50OiBhbnkpIHtcclxuICAgIGlmIChldmVudCAmJiBldmVudC5ub2RlICYmIGV2ZW50Lm5vZGUuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSkge1xyXG4gICAgICBjb25zdCBpZEZpZWxkID0gdGhpcy50cmVlVGFibGUuaWRGaWVsZDtcclxuICAgICAgY29uc3QgaWQgPSBldmVudC5ub2RlLmRhdGFbaWRGaWVsZF07XHJcbiAgICAgIHRoaXMuc2V0Q3VycmVudElkVG9CaW5kaW5nTGlzdChpZCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWLvumAieiKgueCueWPkeeUn+WPmOWMllxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2NoZWNrVmFsdWVzQ2hhbmdlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgY2hlY2tWYWx1ZXNDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgLy8gdGhpcy52aWV3TW9kZWwudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdpZHMnLCB0aGlzLnRyZWVUYWJsZS5jaGVja1ZhbHVlcyk7XHJcbiAgICB0aGlzLnNldENoZWNrcyh0aGlzLnRyZWVUYWJsZS5jaGVja1ZhbHVlcyk7XHJcbiAgICB0aGlzLnNldENoZWNrZWRSb3dzKCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWwhuiiq+WxleW8gOeahOiKgueCueiuvue9ruS4uuW9k+WJjeihjFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2V4cGFuZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIGV4cGFuZEhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRJZCA9IGV2ZW50LmRhdGFbJ2lkJ107XHJcbiAgICBjb25zdCB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICAvLyDlsZXlvIDml7bkuI3lho3pgInkuK1cclxuICAgIC8vIHRoaXMuc2V0U2VsZWN0ZWRJZFRvVHJlZShzZWxlY3RlZElkKTtcclxuICAgIGNvbnN0IGV4cGFuZE5vZGVzID0gdmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJykgfHwgW107XHJcbiAgICBleHBhbmROb2Rlcy5wdXNoKHNlbGVjdGVkSWQpO1xyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJywgZXhwYW5kTm9kZXMpO1xyXG4gIH1cclxuICBASG9zdExpc3RlbmVyKCdwYWdlQ2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uUGFnZUNoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IHsgcGFnZVNpemUgPSAyMCwgcGFnZUluZGV4ID0gMSB9ID0gZXZlbnQgfHwge307XHJcbiAgICBpZiAocGFnZUluZGV4IDwgMSkge1xyXG4gICAgICBwYWdlSW5kZXggPSAxO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc2tpcCA9IChwYWdlSW5kZXggLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHBhZ2VTaXplLCB0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZVNpemVDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25QYWdlU2l6ZUNoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgcGFnZVNpemUgPSBldmVudCA/IGV2ZW50IDogMjA7XHJcbiAgICBjb25zdCBza2lwID0gMDtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0UGFnaW5nSW5mbyhza2lwLCBwYWdlU2l6ZSwgdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiKgueCuemhteeggeWIh+aNouS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2NoaWxkc1BhZ2VDaGFuZ2VkJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgb25Ob2RlUGFnZUNoYW5nZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXggPSAxLCBwYWdlU2l6ZSA9IHRoaXMubm9kZVBhZ2VTaXplLCBub2RlID0ge30gfSA9IGV2ZW50O1xyXG4gICAgY29uc3QgaWQgPSBub2RlICYmIG5vZGUuaWQgfHwgbnVsbDtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICBjb25zdCB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgICAgIGNvbnN0IGV4cGFuZE5vZGVzID0gdmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJykgfHwgW107XHJcbiAgICAgIGV4cGFuZE5vZGVzLnB1c2goaWQpO1xyXG4gICAgICB2aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5zZXQoYF9OT0RFXyR7aWR9X1BBR0VfSU5ERVhfYCwgcGFnZUluZGV4KTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldChgX1JFTE9BRF9DSElMRFJFTl9gLCB0cnVlKTtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldCgnX05PREVfUEFHRV9DSEFOR0VEXycsIHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxufVxyXG5cclxuZXhwb3J0IHsgRmFycmlzVHJlZVRhYmxlQmluZGluZ0RpcmVjdGl2ZSB9O1xyXG4iXX0=
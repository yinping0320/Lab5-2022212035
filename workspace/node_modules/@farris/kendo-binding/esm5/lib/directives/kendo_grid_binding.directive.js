import * as tslib_1 from "tslib";
import { Directive, Input, HostListener, Optional, EventEmitter, Output, ContentChildren, QueryList, NgZone } from '@angular/core';
import { of } from 'rxjs';
import { GridComponent, DataBindingDirective, SelectionDirective, } from '@progress/kendo-angular-grid';
import { BindingData, ChangeType, FrameEventBus, UIState, Form, ViewModel, ComponentType } from '@farris/devkit';
import { DialogService } from '@farris/ui-dialog';
import { RuntimeStateService } from '@farris/ui-common';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { FarrisKendoGridFormatService } from '../format/index';
import { GridColumnAggregateDirective } from './grid-summary.directive';
import { MultiSelectGridUtility } from '../util/multi_select_grid_utility';
import { SelectedRowContext } from '../entity/index';
/*
 * Kendo Grid 数据绑定指令
 *
 * TODO:
 * 1、整体刷存在性能问题；
 * 2、选中和当前行没有区分开；
 */
var KendoGridBindingDirective = /** @class */ (function (_super) {
    tslib_1.__extends(KendoGridBindingDirective, _super);
    /**
     * 构造函数
     * @param  grid 宿主Grid
     */
    function KendoGridBindingDirective(bindingData, uiState, eventBus, viewModel, grid, selectionDir, dialogSer, dateService, kendogridFormatSer, rts, ngZone) {
        var _this = _super.call(this, grid) || this;
        _this.bindingData = bindingData;
        _this.uiState = uiState;
        _this.eventBus = eventBus;
        _this.viewModel = viewModel;
        _this.grid = grid;
        _this.selectionDir = selectionDir;
        _this.dialogSer = dialogSer;
        _this.dateService = dateService;
        _this.kendogridFormatSer = kendogridFormatSer;
        _this.rts = rts;
        _this.ngZone = ngZone;
        /* 行样式事件 */
        // @Input()
        // rowClassName: (context: any) => any;
        // tslint:disable-next-line:no-output-rename
        _this.appendRow = new EventEmitter();
        /* 绑定排序事件 */
        _this.sortChangeEvent = new EventEmitter();
        /* 行样式事件 */
        _this.rowClass = new EventEmitter();
        _this.hiddenColLen = 0;
        /**
         * TODO: 从实体获取其默认值
         * 当前行索引值，默认第一个
         */
        _this.rowIndex = 0;
        _this.columnIndex = 0;
        _this.currentSkip = 0;
        /**
         * 是否启用多选，默认未启用
         */
        _this.isMultipleSelectionMode = false;
        /**
         * 上一个选中行，默认不存在
         */
        _this.lastRowIndex = -1;
        /**
         * 选中行切换事件
         */
        _this.selectedRowChange = new EventEmitter();
        /**
         * checkbox选择事件
         */
        _this.selectedCheckboxChange = new EventEmitter();
        _this.selectionDir.selectedKeys = [];
        _this.viewModel.uiState.setPropertyValue('ids', _this.selectionDir.selectedKeys);
        var appContext = _this.viewModel.frameContext.getFormAppContext();
        if (appContext && appContext.hasOwnProperty('messagePipe')) {
            appContext.messagePipe.subscribe(function (message) {
                _this.grid.closeCell();
            });
        }
        return _this;
    }
    Object.defineProperty(KendoGridBindingDirective.prototype, "gridOption", {
        get: function () {
            return this.grid['gridOption'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(KendoGridBindingDirective.prototype, "len", {
        get: function () {
            return this.grid.columns.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(KendoGridBindingDirective.prototype, "IsMultipleSelectionMode", {
        get: function () {
            if (!this.grid) {
                return this.isMultipleSelectionMode;
            }
            if (this.grid.selectable) { // 优先尝试从this.grid.selectable获取
                // tslint:disable-next-line: no-string-literal
                if (this.grid.selectable['mode'] === 'multiple') {
                    this.isMultipleSelectionMode = true;
                }
                else {
                    this.isMultipleSelectionMode = false;
                }
            }
            else {
                if (this.grid.selectableSettings && this.grid.selectableSettings.mode === 'multiple') {
                    this.isMultipleSelectionMode = true;
                }
            }
            return this.isMultipleSelectionMode;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(KendoGridBindingDirective.prototype, "bindingList", {
        /**
         * 绑定列表(Grid对应数据源)
         */
        get: function () {
            // 根实体
            if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
                return this.bindingData.list;
            }
            // 子实体
            var bindingPath = this.viewModel.bindingPath.substr(1);
            bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
            var paths = bindingPath.split('/');
            var filteredPaths = paths.filter(function (part) {
                return part !== '';
            });
            return this.bindingData.getValue(filteredPaths);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取分页信息
     */
    KendoGridBindingDirective.prototype.getPagingInfo = function () {
        var bindingPath = this.viewModel.bindingPath;
        var bindingData = this.viewModel.bindingData;
        var pagingInfo = bindingData.pagingInfo;
        if (bindingPath === '/') {
            return pagingInfo;
        }
        else {
            var bindingPaths = bindingPath.substr(1).split('/').filter(function (item) { return !!item && item.length > 0; }).map(function (item) {
                return item.substring(0, item.length - 1);
            });
            bindingPaths.forEach(function (path) {
                pagingInfo = pagingInfo && pagingInfo[path] || {};
            });
            return pagingInfo;
        }
    };
    /**
     * 指令初始化后
     */
    KendoGridBindingDirective.prototype.ngOnInit = function () {
        var _this = this;
        _super.prototype.ngOnInit.call(this);
        // 初始化state，分组使用。
        this.initDataState();
        this.refreshView();
        if (this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameComponent) {
            this.viewModel.frameContext.frameComponent.componentType = ComponentType.kendoGridComponent;
        }
        // 数据变化
        this.bindingChangeSubscription = this.bindingData.changes.subscribe(function (change) {
            _this.refreshView(change);
            if (change.type === ChangeType.Load) {
                // load时，在多选模式下，需清空选中集合
                if (_this.isMultipleSelectionMode) {
                    var isMatch_1 = _this.checkIfChangeMatchBindingPath(change);
                    if (isMatch_1) {
                        // 清空多选集合
                        _this.selectionDir.selectedKeys = [];
                        _this.viewModel.uiState.setPropertyValue('ids', _this.selectionDir.selectedKeys);
                        _this.ngZone.runOutsideAngular(function () {
                            // 渲染初始选中行
                            setTimeout(function () {
                                var rowSelectedContext = new SelectedRowContext();
                                var isPageable = MultiSelectGridUtility.checkIfEnablePaging(_this.grid);
                                if (isPageable) {
                                    _this.rowIndex = _this.grid.skip;
                                }
                                else {
                                    _this.rowIndex = 0;
                                }
                                rowSelectedContext.currentRowIndex = _this.rowIndex;
                                rowSelectedContext.lastRowIndex = _this.lastRowIndex;
                                _this.handleSelectedRowChange(rowSelectedContext);
                            }, 300);
                        });
                    }
                }
            }
            // TODO: 使用策略模式重构
            // bindingData 同步 SelectedKeys
            if (change.type === ChangeType.Remove) {
                _this.syncDeletedKeys(change.value);
            }
            var isMatch = _this.checkIfChangeMatchBindingPath(change);
            if (isMatch) {
                _this.handleSelectedKeyChange(_this.bindingList.currentId);
            }
            // 渲染当前行
            if (isMatch && _this.checkCurrentRowIdExists() && change.type === ChangeType.SelectionChanged && !_this.dataId) {
                _this.renderCurrentRow(_this.bindingList.currentId);
            }
            // tslint:disable-next-line: max-line-length
            // FIXME:需要有重置页码的时机
            /*if ((change.type === ChangeType.SelectionChanged || change.type === ChangeType.GlobalSelectionChanged) && this.currentRowId !== this.bindingList.currentId) {
                this.resetPageInfo();
            }*/
            // 触发变更检测
            if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged
                || change.type === ChangeType.Append || change.type === ChangeType.Remove) {
                // 触发变更检测
                if (_this.grid && _this.grid['changeDetectorRef'] && _this.grid['changeDetectorRef']['detectChanges']) {
                    _this.grid['changeDetectorRef']['detectChanges']();
                }
            }
        });
        if (this.editable === true && this.form === null) {
            throw Error('启用编辑时，必须指定form');
        }
        if (!this.grid || !this.farrisBindingGridOption || !this.farrisBindingGridOption['fields']) {
            return;
        }
        var gridColumns = this.farrisBindingGridOption['fields'];
        var gridOption = this.farrisBindingGridOption;
        // 判断列中是否存在固定列
        gridOption.lockable = function (columns) {
            return columns.some(function (ele) {
                return ele.frozen;
            });
        };
        this.rowClass.emit(this.grid);
        // 添加列属性或者方法
        gridColumns.forEach(function (element) {
            // 自定义超链
            if (element.linkedLabelEnabled && !element.linkEvent) {
                element.linkEvent = function () {
                    return;
                };
            }
            // 若没有自定义格式化方法  每个列对象绑定格式化方法
            if (!element.getColumnFormat) {
                element.getColumnFormat = function (dataItem, column) {
                    return _this.kendogridFormatSer.getColumnFormat(dataItem, column);
                };
            }
            // 如果没有自定义类样式 每个列绑定 格式化方法
            if (!element.getClassName) {
                element.getClassName = function (dataItem, column) { return ''; };
            }
            // 自定义帮助前后事件
            if (element.editor && element.editor.type === 'LookupEdit') {
                // 帮助前事件
                if (!element.dictPicking) {
                    element.dictPicking = function (param) {
                        return of(true);
                    };
                }
                // 帮助后事件
                if (!element.dictPicked) {
                    element.dictPicked = function (param) {
                        // 重新进入编辑
                        _this.cellClickHandler(_this.cellClickParam);
                        return of(true);
                    };
                }
            }
        });
        // 绑定gridOption
        this.bindingGridOption();
        // 多选模式下，设置初始选中行
        if (this.IsMultipleSelectionMode) {
            // TODO: 移除 setTimeout
            var self_1 = this;
            this.ngZone.runOutsideAngular(function () {
                setTimeout(function () {
                    var rowSelectedContext = new SelectedRowContext();
                    rowSelectedContext.currentRowIndex = self_1.rowIndex;
                    rowSelectedContext.lastRowIndex = self_1.lastRowIndex;
                    self_1.handleSelectedRowChange(rowSelectedContext);
                }, 300);
            });
        }
    };
    KendoGridBindingDirective.prototype.ngAfterViewInit = function () {
        // this.gridElement = document.querySelector('.k-grid');
        // // 绑定grid keydown对象的方法
        // this.ngZone.runOutsideAngular(() => {
        //   this.gridKeydownEvent = this.enterCell.bind(this);
        //   this.gridCellClickEvent = this.cellClickHandler.bind(this);
        //   this.gridCellCloseEvent = this.cellCloseHandler.bind(this);
        //   this.gridElement.addEventListener('keydown', this.gridKeydownEvent);
        //   this.gridElement.addEventListener('cellClick', this.gridCellClickEvent);
        //   this.gridElement.addEventListener('cellClose', this.gridCellCloseEvent);
        // });
    };
    /**
     * 检测change的路径和BindingPath是否匹配
     */
    KendoGridBindingDirective.prototype.checkIfChangeMatchBindingPath = function (change) {
        var isMatch = false;
        if (!change || !change.path) {
            return isMatch;
        }
        var changePathArray = change.path;
        if (!changePathArray) {
            return isMatch;
        }
        if (!(this.bindingData) && !(this.bindingData.bindingPath)) {
            return isMatch;
        }
        var bingdingPathArray = this.bindingData.bindingPath.split('/');
        if (bingdingPathArray.length <= 0) {
            return isMatch;
        }
        if (changePathArray.length === 0) { // 主表
            if (this.bindingData.bindingPath === '/') {
                isMatch = true;
            }
        }
        else if (change.path.length === 1) { // 主从表
            if (bingdingPathArray.length === 2 && bingdingPathArray[1] === change.path[0]) {
                isMatch = true;
            }
        }
        else if (change.path.length === 2) { // 主从从表
            if (bingdingPathArray.length === 3 && bingdingPathArray[1] === change.path[0] && bingdingPathArray[2] === change.path[1]) {
                isMatch = true;
            }
        }
        return isMatch;
    };
    /**
     * 处理选中主键变更
     */
    KendoGridBindingDirective.prototype.handleSelectedKeyChange = function (currentId) {
        var selectedKeys = this.selectionDir.selectedKeys;
        if (!currentId) {
            // 如果当前行时null，但selectedKeys里有值，清空并发送一次行切换
            if (selectedKeys.length > 0) {
                var removedSelectedKeys = selectedKeys.splice(0, selectedKeys.length);
                if (removedSelectedKeys.indexOf(null) === -1) {
                    this.emitSelectedRowChange({ currentRowId: null });
                }
            }
            return;
        }
        var oldCurrentRowId = null;
        if (this.IsMultipleSelectionMode) {
            oldCurrentRowId = this.currentRowId;
        }
        else {
            oldCurrentRowId = this.selectionDir.selectedKeys.length === 0
                ? null : this.selectionDir.selectedKeys[0];
        }
        // TODO:if (this.currentRowId !== currentId) {
        if (oldCurrentRowId !== currentId) {
            var selectedRowContext = {};
            selectedRowContext.currentRowId = currentId;
            this.currentRowId = currentId;
            this.emitSelectedRowChange(selectedRowContext);
        }
    };
    /**
     * 发射选中行切换事件
     * @description 统一单选模式和多选模式下的行切换事件
     */
    KendoGridBindingDirective.prototype.emitSelectedRowChange = function (selectedRowContext) {
        if (!this.IsMultipleSelectionMode) { // 向后兼容
            var currentId = selectedRowContext.currentRowId;
            this.selectionDir.selectedKeys = [currentId];
            this.selectionDir.selectedKeysChange.emit(this.selectionDir.selectedKeys);
        }
        this.selectedRowChange.emit(selectedRowContext);
    };
    KendoGridBindingDirective.prototype.checkCurrentRowIdExists = function () {
        var isExist = false;
        if (this.bindingList && this.bindingList.currentId && this.bindingList.currentId.length > 0) {
            isExist = true;
        }
        return isExist;
    };
    /**
     * 同步已删除键到选中集合
     */
    KendoGridBindingDirective.prototype.syncDeletedKeys = function (deletedValueCollection) {
        var _this = this;
        if (!deletedValueCollection) {
            return;
        }
        deletedValueCollection.forEach(function (id) {
            var index = _this.selectionDir.selectedKeys.indexOf(id);
            if (index > -1) {
                _this.selectionDir.selectedKeys.splice(index, 1);
                // selectedKeys被清空的时候，触发一次行变更
                if (_this.selectionDir.selectedKeys.length === 0) {
                    _this.emitSelectedRowChange({ currentRowId: null });
                }
            }
        });
    };
    KendoGridBindingDirective.prototype.renderCurrentRow = function (currentId) {
        if (!currentId || currentId === '') { // 不存在当前行
            return;
        }
        // TODO:使用策略模式重构
        if (this.IsMultipleSelectionMode) {
            return;
        }
        this.renderSelectionRow(this.bindingList.currentId, this.selectionDir.selectedKeys);
    };
    /**
     * 指令输入变更处理
     */
    KendoGridBindingDirective.prototype.ngOnChanges = function (changes) {
        _super.prototype.ngOnChanges.call(this, changes);
        this.refreshView();
    };
    /**
     * 指令销毁，注销订阅
     */
    KendoGridBindingDirective.prototype.ngOnDestroy = function () {
        if (this.bindingChangeSubscription) {
            this.bindingChangeSubscription.unsubscribe();
        }
    };
    KendoGridBindingDirective.prototype.refreshView = function (change) {
        // this.bindData();
        this.refreshData(change);
        // 刷新页脚合计信息。客户端合计，暂时放这里，服务端合计时最好从这里移走。by justin
        this.refreshSummary();
    };
    /**
     * 绑定data到宿主grid上
     * @deprecated
     */
    KendoGridBindingDirective.prototype.bindData = function () {
        /*const data = this.bindingList.toJSON();
        let skip = 0;
        if (this.bindingList.pageIndex > 0) {
          skip = (this.bindingList.pageIndex - 1) * this.bindingList.pageSize;
        }
        this.updatePager(this.bindingList.pageSize, skip);
        const processed = process(data, Object.assign({}, this.state, { skip: 0 }));
        processed.total = this.bindingList.total;
        this.grid.data = processed;*/
    };
    KendoGridBindingDirective.prototype.refreshData = function (change) {
        var skip = 0;
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        if (pageIndex > 0) {
            skip = (pageIndex - 1) * pageSize;
        }
        this.updatePager(pageSize, skip);
        this.endCellEdit(change);
        this.data = this.bindingList.toJSON({ ignoreMultiLangInput: true });
    };
    /**
     * 退出编辑状态
     * @param change 变更
     */
    KendoGridBindingDirective.prototype.endCellEdit = function (change) {
        var isEditing = this.grid.isEditing;
        if (change && change.type === ChangeType.Load && isEditing) {
            this.grid.cancelCell();
        }
    };
    KendoGridBindingDirective.prototype.refreshSummary = function () {
        var _this = this;
        if (this.aggrColumns) {
            this.aggrColumns.forEach(function (aggrCol) {
                if (aggrCol.aggregate) {
                    aggrCol.recalculateSummary(_this.bindingList);
                }
            });
        }
    };
    KendoGridBindingDirective.prototype.onPageChange = function (event) {
        var _a = event || {}, _b = _a.skip, skip = _b === void 0 ? 0 : _b, _c = _a.take, take = _c === void 0 ? 0 : _c;
        // this.bindingList.setPaginationInfo(skip, take);
        this.bindingData.setPagingInfo(skip, take, this.viewModel.bindingPath);
        // 移除选中行样式
        MultiSelectGridUtility.removeRowSelectedStyle(this.grid, this.rowIndex);
    };
    /**
     * 重置grid分页信息
     */
    KendoGridBindingDirective.prototype.resetPageInfo = function () {
        var _a = (this.getPagingInfo() || {}).pageSize, pageSize = _a === void 0 ? 0 : _a;
        this.bindingData.setPagingInfo(0, pageSize, this.viewModel.bindingPath);
    };
    KendoGridBindingDirective.prototype.initDataState = function () {
        // const groups: GroupDescriptor[] = [];
        // if (this.groupField) {
        //   groups.push({field: this.groupField, aggregates: this.aggregates||[]});
        //   this.grid.group = groups;
        // }
        // this.state = Object.assign(this.state, {group: groups});
        var e_1, _a;
        var aggregatesDes = [];
        if (this.groupAggrFields) {
            try {
                for (var _b = tslib_1.__values(this.groupAggrFields), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var groupAggrField = _c.value;
                    aggregatesDes.push({ field: groupAggrField, aggregate: 'sum' });
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        var group = [];
        if (this.groupField) {
            group.push({ field: this.groupField, aggregates: aggregatesDes });
        }
        this.group = group;
    };
    /*
     * @override
     * @param state State
     */
    KendoGridBindingDirective.prototype.onStateChange = function (state) {
        // 说明：pager根据skip计算当前页码。kendo grid内部会在filter state变化时把skip变为0（重置到第一页）。
        // 因此需要重写onStateChange方法，修正skip
        if (state.skip !== this.currentSkip) {
            state.skip = this.currentSkip;
        }
        // 使用kendo默认的处理state的逻辑
        this.applyState(state);
        this.rebind();
    };
    // protected applyState({skip, take, sort, group, filter}: State): void {
    //   this.skip = skip;
    //   this.pageSize = take;
    //   this.sort = sort;
    //   this.group = group;
    //   this.filter = filter;
    // }
    /*
     * @override 服务器端分页取数。process使用的state中skip应为0，否则不显示数据
     * @param state State
     */
    KendoGridBindingDirective.prototype.process = function (state) {
        // if (this.editing) {
        //   state.sort = null;
        // } else {
        //   state.sort = this.originalSort;
        // }
        state.skip = 0;
        var _a = this.getPagingInfo() || {}, _b = _a.pageSize, pageSize = _b === void 0 ? 0 : _b, _c = _a.total, totalCount = _c === void 0 ? 0 : _c;
        // fix：不启用分页时，take=0导致process不返回数据
        if (state.take === 0) {
            state.take = this.bindingList.length;
        }
        else {
            state.take = pageSize;
        }
        // 编辑模式的判断依据为pageSize小于绑定数据的数量且启用分页
        var isEditMode = state.take < this.bindingList.length;
        if (isEditMode) {
            state.take = this.bindingList.length;
        }
        var processed = _super.prototype.process.call(this, state);
        // fix:数据从无到有时分页不启用
        processed.total = Math.max(totalCount, this.bindingList.length);
        // 分页编辑模式下数据总记录数不能等于真实的数据数据，否则分页工具条就会自动增加分页页签
        if (isEditMode) {
            processed.total = totalCount || 1;
        }
        return processed;
    };
    /*
     * 选中行主键变化处理
     * @param event { SelectionEvent} 选中行变化处理
     */
    KendoGridBindingDirective.prototype.selectedKeysChangeHandler = function (selectedKeys) {
        if (!(this.IsMultipleSelectionMode)) { // 单选模式下
            // 设置BindingData中的当前行
            this.setSelectionIdToBindingData(selectedKeys[selectedKeys.length - 1]);
        }
        this.viewModel.uiState.setPropertyValue('ids', this.selectionDir.selectedKeys); // 更新集合
    };
    /*
     * 处理Grid行切换事件
     * @param event { SelectionEvent} 行切换事件对象
     */
    KendoGridBindingDirective.prototype.selectionChangeHandler = function (event) {
        if (this.IsMultipleSelectionMode) {
            this.handleSelectedCheckboxChange(this.grid.wrapper, event);
        }
    };
    /**
     * 处理checkbox选中事件
     */
    KendoGridBindingDirective.prototype.handleSelectedCheckboxChange = function (elementRef, event) {
        MultiSelectGridUtility.renderSelectedChangeCheckbox(elementRef, event);
        this.selectedCheckboxChange.emit(event);
    };
    /*
     * 单元格点击处理
     * @param event { CellClickEvent } 单元格单击事件对象
     */
    KendoGridBindingDirective.prototype.cellClickHandler = function (event) {
        this.cellClickParam = event;
        this.cellClickEvent = event;
        this.rowIndex = event.rowIndex;
        this.columnIndex = event.columnIndex;
        this.sender = event.sender;
        // 多选模式下，且不分组的情况下，检测行切换
        if (this.IsMultipleSelectionMode && !this.gridOption.groupable) {
            var currentRowIndex = event.rowIndex;
            if (currentRowIndex !== this.lastRowIndex) {
                var rowSelectedContext = new SelectedRowContext();
                rowSelectedContext.currentRowIndex = currentRowIndex;
                rowSelectedContext.lastRowIndex = this.lastRowIndex;
                this.handleSelectedRowChange(rowSelectedContext);
            }
        }
        // 设置实体的当前行
        this.dataId = this.getSelectedIdFromGrid(event.dataItem);
        this.setSelectionIdToBindingData(this.dataId);
        // 若状态机不是可编辑状态 不可编辑
        if (!this.isEditable()) {
            return;
        }
        // 列模板不存在  不可编辑
        if (!event.column.editTemplate) {
            return;
        }
        if (event.type === 'click' && !event.isEdited) {
            // 如果存在显隐状况  确定正确的columnIndex
            var originColums = this.getColumns(this.gridOption.fields);
            var columns = this.getColumns(originColums);
            var currentColumnIndex = columns.findIndex(function (col) { return col.dataField === event.column.field; });
            var hiddenColLen = columns.slice(0, currentColumnIndex + 1).filter(function (col) { return !col.visible; }).length;
            // 赋值全局行索引  列索引
            this.rowIndex = event.rowIndex;
            this.columnIndex = event.columnIndex + hiddenColLen;
            this.hiddenColLen = hiddenColLen;
            this.sender = event.sender;
            this.setEditable(this.rowIndex, this.columnIndex);
        }
    };
    /**
     * 处理选中行切换事件
     */
    KendoGridBindingDirective.prototype.handleSelectedRowChange = function (rowSelectedContext) {
        MultiSelectGridUtility.renderClickChangedRow(this.grid, rowSelectedContext);
        this.rowIndex = rowSelectedContext.currentRowIndex;
        this.lastRowIndex = rowSelectedContext.currentRowIndex;
        // 更新当前行
        var id = this.getPrimary(this.rowIndex);
        this.setSelectionIdToBindingData(id);
    };
    /**
     * 获取指定行的主键
     * @param row 行号
     */
    KendoGridBindingDirective.prototype.getPrimary = function (row) {
        var data = this.grid.data;
        if (data && !Array.isArray(data) && data.hasOwnProperty('data')) {
            data = data.data;
        }
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var skip = this.bindingList.skip;
        // 不分页或者第一页时取不需要修改行号
        var rowNumber = pageSize === 0 || pageIndex === 1 ? row : row - skip;
        if (data.length > rowNumber) {
            return data[rowNumber][this.bindingList.primaryKey];
        }
        return null;
    };
    /*
     * 单元格结束编辑处理
     * @param event 单元格结束编辑事件对象
     */
    KendoGridBindingDirective.prototype.cellCloseHandler = function (event) {
        if (this.dialogSer.hasDialogOpened()) {
            event.preventDefault();
            return;
        }
        if (this.rts) {
            // 帮助组件文本变化后去查询
            if (this.rts.getFormState('lookup.pending')) {
                event.preventDefault();
                return;
            }
            // 点击帮助确定可取消按钮后不结束当前单元格编辑
            if (event.originalEvent) {
                if (this.rts.eventPath(event.originalEvent).find(function (n) { return n.tagName === 'FARRIS-DIALOG'; })) {
                    event.preventDefault();
                    return;
                }
            }
        }
        var formGroup = event.formGroup, column = event.column, dataItem = event.dataItem, rowIndex = event.rowIndex;
        var columns = this.getColumns(this.gridOption.fields);
        var currentCol = columns.find(function (element) {
            return element.dataField === column.field;
        });
        var formControlValue = formGroup[currentCol.editor.binding.path].value;
        if (currentCol.getDynamicData) {
            // 若此列是动态单元格列
            currentCol = currentCol.getDynamicData(dataItem, currentCol);
        }
        this.setValue(formControlValue, currentCol);
    };
    /*
       * 回车  切换单元格
       * @param event 键盘按下事件
       */
    KendoGridBindingDirective.prototype.enterCell = function (e) {
        var _this = this;
        // 回车键
        if (!e.shiftKey && e.keyCode === 13) {
            // textarea enter 屏蔽换行操作
            e.preventDefault();
            if (!this.sender) {
                return;
            }
            // 由于keydown 事件会先执行，所以这里先要执行blur 事件；
            e.target.blur();
            this.ngZone.runOutsideAngular(function () {
                setTimeout(function () {
                    if (_this.rts && _this.rts.getFormState('lookup.pending')) {
                        e.preventDefault();
                        return;
                    }
                    _this.enterNextCell();
                }, 201);
            });
        }
    };
    /*
       * 绑定grid option
       * @param dataItem 行数据
       */
    KendoGridBindingDirective.prototype.bindingGridOption = function () {
        if (!this.farrisBindingGridOption) {
            return;
        }
        Object.defineProperty(this.grid, 'gridOption', { value: this.farrisBindingGridOption });
    };
    /*
     * 更新Grid分页状态
     * @param take
     * @param skip
     */
    KendoGridBindingDirective.prototype.updatePager = function (take, skip) {
        if (take === 0) {
            this.currentSkip = 0;
            this.pageSize = 0;
            this.skip = 0;
            this.grid.pageable = false;
        }
        else {
            this.currentSkip = skip;
            this.skip = skip;
            this.pageSize = take;
            this.grid.pageable = {
                buttonCount: 10,
                info: true,
                type: 'numeric',
                pageSizes: false,
                previousNext: true
            };
        }
    };
    /*
     * 设置单元格可编辑性
     * @param dataItem 行数据
     * @param column 列对象
     * @param rowIndex 行索引
     * @param columnIndex 列索引
     * @param sender grid实例
     */
    KendoGridBindingDirective.prototype.setEditable = function (rowNumber, columnNumber) {
        var data = this.grid.data['data'];
        var _a = this.getPagingInfo() || {}, _b = _a.pageIndex, pageIndex = _b === void 0 ? 1 : _b, _c = _a.pageSize, pageSize = _c === void 0 ? 0 : _c;
        var skip = this.bindingList.skip;
        // 不分页或者第一页时取不需要修改行号
        var dataRowNumber = pageSize === 0 || pageIndex === 1 ? rowNumber : rowNumber - skip;
        var item = data[dataRowNumber];
        if (this.gridOption.groupable) {
            item = this.getGroupItem(data, dataRowNumber);
        }
        var originColums = this.getColumns(this.gridOption.fields);
        var columns = this.getColumns(originColums);
        /* 假如列的顺序改变 比如存在固定列  那么应该获取真正的列对象 */
        // let col = columns[columnNumber];
        var tempIndex = columnNumber;
        // 当前列索引不为0
        if (this.grid['gridOption'].showLineNumber) {
            tempIndex = tempIndex - 1;
        }
        if (this.grid.selectable && this.grid.selectable['mode'] === 'multiple') {
            tempIndex = tempIndex - 1;
        }
        var col = columns[tempIndex];
        var params = {
            dataItem: item,
            column: col,
            rowIndex: rowNumber,
            columnIndex: tempIndex,
        };
        // 控制单元格的可编辑性
        if (col && !col.editable) {
            col.editable = function (param) { return true; };
        }
        if (col && this.notReadOnly(col, params)) {
            // 设置当前行
            this.dataId = this.getSelectedIdFromGrid(item);
            this.setSelectionIdToBindingData(this.dataId);
            // const value = this.getValue(item, col.dataField);
            // this.setValue(value, col);
            this.sender.editCell(rowNumber, columnNumber - this.hiddenColLen, this.viewModel.form);
        }
    };
    /*
    获取更新 rowIndex columnIndex
     */
    KendoGridBindingDirective.prototype.updateIndex = function (rowNumber, columnIndex) {
        var newColumnIndex = (columnIndex + 1) % this.len;
        if (!newColumnIndex) {
            var dataLen = this.bindingList.toJSON().length;
            var newRowIndex = (rowNumber + 1) % dataLen;
            return { rowIndex: newRowIndex, columnIndex: newColumnIndex };
        }
        return {
            rowIndex: rowNumber,
            columnIndex: newColumnIndex
        };
    };
    /* 是否只读 */
    KendoGridBindingDirective.prototype.notReadOnly = function (column, param) {
        if (!column) {
            return false;
        }
        return column.editable(param) && !column.editor.readonly;
    };
    /*
       * 给列表赋值 或给formcontrol赋值
        */
    KendoGridBindingDirective.prototype.setValue = function (value, column) {
        var currentColumnType = column.dataType;
        // 同时判断gridOption的列对象
        var bindingData = this.viewModel.bindingData;
        var fieldPaths = this.getFieldPaths(bindingData.bindingPath, column.dataField);
        // 存在行编辑器
        if (currentColumnType === 'date') {
            var dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd HH:mm:ss');
            if (!dateStr) {
                dateStr = '';
            }
            this.viewModel.bindingData.setValue(fieldPaths, dateStr, true, true);
        }
        else {
            this.viewModel.bindingData.setValue(fieldPaths, value, true, true);
        }
    };
    /* 分组时 获取点击行数据 */
    KendoGridBindingDirective.prototype.getGroupItem = function (data, rowNumber) {
        var index = rowNumber;
        for (var i in data) {
            if (index < data[i].items.length) {
                return data[i].items[index];
            }
            else {
                index = index - data[i].items.length;
            }
        }
    };
    /*
     * 获取 单元格值  主从表支持
     * @param dataItem 行数据
     * @param field 字段
     */
    KendoGridBindingDirective.prototype.getValue = function (dataItem, field) {
        var index = field.indexOf('.');
        if (index < 0) {
            return dataItem[field];
        }
        var fields = field.split('.');
        // field字符串组合
        return fields.reduce(function (result, next) {
            return result[next];
        }, dataItem);
    };
    /*
    * 获取 bindingData 路径
    * @param bindingPath 当前绑定的字段路径
    * @param fieldName 字段
    */
    KendoGridBindingDirective.prototype.getFieldPaths = function (bindingPath, field) {
        var fieldPath = '';
        if (bindingPath.length > 1) {
            fieldPath = bindingPath.substr(1).replace(/\//g, '.') + '.' + field;
        }
        else {
            fieldPath = field;
        }
        return fieldPath.split('.');
    };
    /**
     * 回车进入下一个单元格
     */
    KendoGridBindingDirective.prototype.enterNextCell = function () {
        var _this = this;
        var index = this.updateIndex(this.rowIndex, this.columnIndex);
        if (!index.columnIndex && !index.rowIndex) {
            var len_1 = this.bindingList.toJSON().length;
            // 如果存在添加数据的API
            this.appendRow.emit();
            if (this.appendRow.observers && this.appendRow.observers.length) {
                this.interVal = setInterval(function () {
                    if (_this.bindingList.toJSON().length - 1 === len_1) {
                        _this.setEditable(_this.bindingList.toJSON().length - 1, 0);
                        _this.rowIndex = _this.bindingList.toJSON().length - 1;
                        _this.columnIndex = 0;
                        clearInterval(_this.interVal);
                    }
                }, 0);
                return;
            }
        }
        this.setEditable(index.rowIndex, index.columnIndex);
        this.rowIndex = index.rowIndex;
        this.columnIndex = index.columnIndex;
    };
    /* 获取真正的列对象 */
    KendoGridBindingDirective.prototype.getColumns = function (columns) {
        // 判断是否存在固定列
        var hasLocked = columns.some(function (ele) {
            return ele.frozen;
        });
        if (hasLocked) {
            var lockedColumns = columns.filter(function (ele) {
                return ele.frozen;
            });
            var notLockedColumns = columns.filter(function (ele) {
                return !ele.frozen;
            });
            return tslib_1.__spread(lockedColumns, notLockedColumns);
        }
        return columns;
    };
    /*
     * 渲染指定行为选中行：将指定行的key添加到选中行集合中
     */
    KendoGridBindingDirective.prototype.renderSelectionRow = function (key, selectedKeys) {
        if (!key || key === '') {
            return;
        }
        // TODO:使用策略模式重构
        if (this.IsMultipleSelectionMode) {
            var index = selectedKeys.indexOf(key);
            if (index >= 0) {
                return;
            }
            selectedKeys.push(key);
        }
        else {
            if (selectedKeys.length === 1 && selectedKeys[0] === key) {
                return;
            }
            selectedKeys.splice(0, selectedKeys.length);
            selectedKeys.push(key);
        }
        this.selectionDir.selectedKeysChange.emit(selectedKeys); // 手动触发selectedKeysChange事件
    };
    /*
     * 获取Grid上的当前行内码
     * @param dataItem 行数据
     */
    KendoGridBindingDirective.prototype.getSelectedIdFromGrid = function (dataItem) {
        var primaryKey = this.bindingList.primaryKey;
        return dataItem[primaryKey];
    };
    /*
     * 设置BindingList的当前行
     * @param id 当前行内码
     */
    KendoGridBindingDirective.prototype.setSelectionIdToBindingData = function (id) {
        this.bindingList.setCurrentId(id, true);
    };
    /*
    *列表整体是否可编辑
     */
    KendoGridBindingDirective.prototype.isEditable = function () {
        if (this.editable === undefined) {
            if (!this.viewModel.stateMachine) {
                // 状态机不存在的时候
                return false;
            }
            // 状态机存在的时候
            return this.viewModel.stateMachine['editable'];
        }
        // 自定义赋值
        return this.editable;
    };
    /*  */
    KendoGridBindingDirective.prototype.isDataChanged = function () {
        var e_2, _a;
        var hasUnsavedData = false;
        var entityArray = this.viewModel.frameContext.repository.entityCollection.toArray();
        try {
            for (var entityArray_1 = tslib_1.__values(entityArray), entityArray_1_1 = entityArray_1.next(); !entityArray_1_1.done; entityArray_1_1 = entityArray_1.next()) {
                var entity = entityArray_1_1.value;
                if (entity.changes.length > 0) {
                    hasUnsavedData = true;
                    break;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (entityArray_1_1 && !entityArray_1_1.done && (_a = entityArray_1.return)) _a.call(entityArray_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return hasUnsavedData;
    };
    KendoGridBindingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[farrisBindingPath]'
                },] }
    ];
    /** @nocollapse */
    KendoGridBindingDirective.ctorParameters = function () { return [
        { type: BindingData },
        { type: UIState, decorators: [{ type: Optional }] },
        { type: FrameEventBus, decorators: [{ type: Optional }] },
        { type: ViewModel, decorators: [{ type: Optional }] },
        { type: GridComponent },
        { type: SelectionDirective },
        { type: DialogService },
        { type: DateTimeHelperService },
        { type: FarrisKendoGridFormatService },
        { type: RuntimeStateService },
        { type: NgZone }
    ]; };
    KendoGridBindingDirective.propDecorators = {
        editable: [{ type: Input, args: ['farrisEditable',] }],
        form: [{ type: Input, args: ['farrisForm',] }],
        groupField: [{ type: Input, args: ['groupField',] }],
        groupAggrFields: [{ type: Input, args: ['groupAggrFields',] }],
        farrisBindingGridOption: [{ type: Input }],
        rowClassName: [{ type: Input }],
        appendRow: [{ type: Output, args: ['append-row',] }],
        sortChangeEvent: [{ type: Output }],
        rowClass: [{ type: Output }],
        selectedRowChange: [{ type: Output }],
        selectedCheckboxChange: [{ type: Output }],
        aggrColumns: [{ type: ContentChildren, args: [GridColumnAggregateDirective,] }],
        onPageChange: [{ type: HostListener, args: ['pageChange', ['$event'],] }],
        selectedKeysChangeHandler: [{ type: HostListener, args: ['selectedKeysChange', ['$event'],] }],
        selectionChangeHandler: [{ type: HostListener, args: ['selectionChange', ['$event'],] }],
        cellClickHandler: [{ type: HostListener, args: ['cellClick', ['$event'],] }],
        cellCloseHandler: [{ type: HostListener, args: ['cellClose', ['$event'],] }],
        enterCell: [{ type: HostListener, args: ['keydown', ['$event'],] }]
    };
    return KendoGridBindingDirective;
}(DataBindingDirective));
export { KendoGridBindingDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VuZG9fZ3JpZF9iaW5kaW5nLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMva2VuZG8tYmluZGluZy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmVzL2tlbmRvX2dyaWRfYmluZGluZy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQStDLEtBQUssRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUNyRixZQUFZLEVBQUUsTUFBTSxFQUFjLGVBQWUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUNyRSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsRUFBRSxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQ0wsYUFBYSxFQUFFLG9CQUFvQixFQUNuQyxrQkFBa0IsR0FHbkIsTUFBTSw4QkFBOEIsQ0FBQztBQUV0QyxPQUFPLEVBQ0wsV0FBVyxFQUF1QixVQUFVLEVBQzVDLGFBQWEsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQ3ZELE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9ELE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXJEOzs7Ozs7R0FNRztBQUVIO0lBRytDLHFEQUFvQjtJQW1LakU7OztPQUdHO0lBQ0gsbUNBQ1MsV0FBd0Is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QUE0QjtnQkFGNUIsbUJBQW1CO2dCQWZvQyxNQUFNOzs7MkJBdUNuRSxLQUFLLFNBQUMsZ0JBQWdCO3VCQU10QixLQUFLLFNBQUMsWUFBWTs2QkFNbEIsS0FBSyxTQUFDLFlBQVk7a0NBR2xCLEtBQUssU0FBQyxpQkFBaUI7MENBSXZCLEtBQUs7K0JBSUwsS0FBSzs0QkFPTCxNQUFNLFNBQUMsWUFBWTtrQ0FHbkIsTUFBTTsyQkFHTixNQUFNO29DQXlFTixNQUFNO3lDQUtOLE1BQU07OEJBd0NOLGVBQWUsU0FBQyw0QkFBNEI7K0JBNFk1QyxZQUFZLFNBQUMsWUFBWSxFQUFFLENBQUMsUUFBUSxDQUFDOzRDQW9HckMsWUFBWSxTQUFDLG9CQUFvQixFQUFFLENBQUMsUUFBUSxDQUFDO3lDQWM3QyxZQUFZLFNBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUM7bUNBbUIxQyxZQUFZLFNBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDO21DQXlGcEMsWUFBWSxTQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkEwQ3BDLFlBQVksU0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBOFRyQyxnQ0FBQztDQUFBLEFBcm5DRCxDQUcrQyxvQkFBb0IsR0FrbkNsRTtTQWxuQ1kseUJBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIFNpbXBsZUNoYW5nZXMsIElucHV0LCBIb3N0TGlzdGVuZXIsIE9wdGlvbmFsLFxyXG4gIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBFbGVtZW50UmVmLCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgTmdab25lLCBBZnRlclZpZXdJbml0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IG9mLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtcclxuICBHcmlkQ29tcG9uZW50LCBEYXRhQmluZGluZ0RpcmVjdGl2ZSxcclxuICBTZWxlY3Rpb25EaXJlY3RpdmUsXHJcbiAgQ2VsbENsaWNrRXZlbnQsXHJcbiAgRGF0YVN0YXRlQ2hhbmdlRXZlbnQsIEdyaWREYXRhUmVzdWx0LCBQYWdlQ2hhbmdlRXZlbnQsIFNvcnRTZXR0aW5ncyxcclxufSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1ncmlkJztcclxuaW1wb3J0IHsgcHJvY2VzcywgR3JvdXBEZXNjcmlwdG9yLCBBZ2dyZWdhdGVEZXNjcmlwdG9yLCBTdGF0ZSwgRmlsdGVyRGVzY3JpcHRvciwgU29ydERlc2NyaXB0b3IgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tZGF0YS1xdWVyeSc7XHJcbmltcG9ydCB7XHJcbiAgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0LCBDaGFuZ2UsIENoYW5nZVR5cGUsXHJcbiAgRnJhbWVFdmVudEJ1cywgVUlTdGF0ZSwgRm9ybSwgVmlld01vZGVsLCBDb21wb25lbnRUeXBlXHJcbn0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBSdW50aW1lU3RhdGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5pbXBvcnQgeyBEYXRlVGltZUhlbHBlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbi9kYXRlJztcclxuaW1wb3J0IHsgRmFycmlzS2VuZG9HcmlkRm9ybWF0U2VydmljZSB9IGZyb20gJy4uL2Zvcm1hdC9pbmRleCc7XHJcbmltcG9ydCB7IEdyaWRDb2x1bW5BZ2dyZWdhdGVEaXJlY3RpdmUgfSBmcm9tICcuL2dyaWQtc3VtbWFyeS5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBNdWx0aVNlbGVjdEdyaWRVdGlsaXR5IH0gZnJvbSAnLi4vdXRpbC9tdWx0aV9zZWxlY3RfZ3JpZF91dGlsaXR5JztcclxuaW1wb3J0IHsgU2VsZWN0ZWRSb3dDb250ZXh0IH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuXHJcbi8qXHJcbiAqIEtlbmRvIEdyaWQg5pWw5o2u57uR5a6a5oyH5LukXHJcbiAqXHJcbiAqIFRPRE86XHJcbiAqIDHjgIHmlbTkvZPliLflrZjlnKjmgKfog73pl67popjvvJtcclxuICogMuOAgemAieS4reWSjOW9k+WJjeihjOayoeacieWMuuWIhuW8gO+8m1xyXG4gKi9cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW2ZhcnJpc0JpbmRpbmdQYXRoXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEtlbmRvR3JpZEJpbmRpbmdEaXJlY3RpdmUgZXh0ZW5kcyBEYXRhQmluZGluZ0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG5cclxuICAvKipcclxuICAgKiDmmK/lkKblhYHorrjnvJbovpFcclxuICAgKiDpu5jorqTlj6/nvJbovpEgIOWboOS4uuacieaJuemHj+e8lui+keWIl+ihqFxyXG4gICAqL1xyXG4gIEBJbnB1dCgnZmFycmlzRWRpdGFibGUnKVxyXG4gIHB1YmxpYyBlZGl0YWJsZTogYm9vbGVhbjtcclxuXHJcbiAgLyoqXHJcbiAgICog57yW6L6R5pe257uR5a6a55qE6KGo5Y2VXHJcbiAgICovXHJcbiAgQElucHV0KCdmYXJyaXNGb3JtJylcclxuICBwdWJsaWMgZm9ybTogRm9ybTtcclxuXHJcbiAgLyoqXHJcbiAgICog5YiG57uE5YiXXHJcbiAgICovXHJcbiAgQElucHV0KCdncm91cEZpZWxkJylcclxuICBwdWJsaWMgZ3JvdXBGaWVsZDogc3RyaW5nO1xyXG5cclxuICBASW5wdXQoJ2dyb3VwQWdnckZpZWxkcycpXHJcbiAgcHVibGljIGdyb3VwQWdnckZpZWxkczogc3RyaW5nW107XHJcblxyXG4gIC8qIOe7keWummdyaWQgb3B0aW9uICovXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgZmFycmlzQmluZGluZ0dyaWRPcHRpb246IGFueTtcclxuXHJcbiAgLyog5YW85a65cm93Q2xhc3Mg6L+Y5rKh5Yig6ZmkICovXHJcbiAgQElucHV0KClcclxuICByb3dDbGFzc05hbWU6IGFueTtcclxuICAvKiDooYzmoLflvI/kuovku7YgKi9cclxuICAvLyBASW5wdXQoKVxyXG4gIC8vIHJvd0NsYXNzTmFtZTogKGNvbnRleHQ6IGFueSkgPT4gYW55O1xyXG5cclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tb3V0cHV0LXJlbmFtZVxyXG4gIEBPdXRwdXQoJ2FwcGVuZC1yb3cnKSBhcHBlbmRSb3cgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLyog57uR5a6a5o6S5bqP5LqL5Lu2ICovXHJcbiAgQE91dHB1dCgpIHNvcnRDaGFuZ2VFdmVudDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLyog6KGM5qC35byP5LqL5Lu2ICovXHJcbiAgQE91dHB1dCgpXHJcbiAgcm93Q2xhc3M6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG5cclxuICBnZXQgZ3JpZE9wdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmdyaWRbJ2dyaWRPcHRpb24nXTtcclxuICB9XHJcbiAgZ2V0IGxlbigpIHtcclxuICAgIHJldHVybiB0aGlzLmdyaWQuY29sdW1ucy5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICBkYXRhSXRlbTogYW55O1xyXG5cclxuICAvKiBrZXlkb3du57uR5a6a5LqL5Lu25a+56LGhICovXHJcbiAgZ3JpZEVsZW1lbnQ6IGFueTtcclxuICBncmlkS2V5ZG93bkV2ZW50OiBhbnk7XHJcblxyXG4gIC8qIGNlbGxjbGlja+S6i+S7tuWvueixoSAqL1xyXG4gIGdyaWRDZWxsQ2xpY2tFdmVudDogYW55O1xyXG5cclxuICAvKiBjZWxsQ2xvc2Xkuovku7blr7nosaEgKi9cclxuICBncmlkQ2VsbENsb3NlRXZlbnQ6IGFueTtcclxuXHJcblxyXG4gIGNlbGxDbGlja0V2ZW50OiBDZWxsQ2xpY2tFdmVudDtcclxuXHJcbiAgaGlkZGVuQ29sTGVuID0gMDtcclxuICAvKipcclxuICAgKiBUT0RPOiDku47lrp7kvZPojrflj5blhbbpu5jorqTlgLxcclxuICAgKiDlvZPliY3ooYzntKLlvJXlgLzvvIzpu5jorqTnrKzkuIDkuKpcclxuICAgKi9cclxuICByb3dJbmRleCA9IDA7XHJcbiAgY29sdW1uSW5kZXggPSAwO1xyXG4gIHNlbmRlcjogYW55O1xyXG4gIGludGVyVmFsOiBhbnk7XHJcbiAgZGF0YUlkOiBhbnk7XHJcbiAgY3VycmVudFNraXAgPSAwO1xyXG4gIHByaXZhdGUgY3VycmVudFJvd0lkOiBzdHJpbmc7XHJcblxyXG4gIGNlbGxDbGlja1BhcmFtOiBDZWxsQ2xpY2tFdmVudDtcclxuICAvKipcclxuICAgKiDmmK/lkKblkK/nlKjlpJrpgInvvIzpu5jorqTmnKrlkK/nlKhcclxuICAgKi9cclxuICBwcml2YXRlIGlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlID0gZmFsc2U7XHJcbiAgcHVibGljIGdldCBJc011bHRpcGxlU2VsZWN0aW9uTW9kZSgpIHtcclxuICAgIGlmICghdGhpcy5ncmlkKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0YWJsZSkgeyAvLyDkvJjlhYjlsJ3or5Xku450aGlzLmdyaWQuc2VsZWN0YWJsZeiOt+WPllxyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXN0cmluZy1saXRlcmFsXHJcbiAgICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0YWJsZVsnbW9kZSddID09PSAnbXVsdGlwbGUnKSB7XHJcbiAgICAgICAgdGhpcy5pc011bHRpcGxlU2VsZWN0aW9uTW9kZSA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5pc011bHRpcGxlU2VsZWN0aW9uTW9kZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAodGhpcy5ncmlkLnNlbGVjdGFibGVTZXR0aW5ncyAmJiB0aGlzLmdyaWQuc2VsZWN0YWJsZVNldHRpbmdzLm1vZGUgPT09ICdtdWx0aXBsZScpIHtcclxuICAgICAgICB0aGlzLmlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5LiK5LiA5Liq6YCJ5Lit6KGM77yM6buY6K6k5LiN5a2Y5ZyoXHJcbiAgICovXHJcbiAgcHVibGljIGxhc3RSb3dJbmRleCA9IC0xO1xyXG5cclxuICAvKipcclxuICAgKiDpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKi9cclxuICBAT3V0cHV0KCkgc2VsZWN0ZWRSb3dDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIGNoZWNrYm946YCJ5oup5LqL5Lu2XHJcbiAgICovXHJcbiAgQE91dHB1dCgpIHNlbGVjdGVkQ2hlY2tib3hDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuWIl+ihqChHcmlk5a+55bqU5pWw5o2u5rqQKVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIC8vIOagueWunuS9k1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycgfHwgIXRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmxpc3Q7XHJcbiAgICB9XHJcbiAgICAvLyDlrZDlrp7kvZNcclxuICAgIGxldCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoLnN1YnN0cigxKTtcclxuICAgIGJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGhbMF0udG9Mb3dlckNhc2UoKSArIGJpbmRpbmdQYXRoLnN1YnN0cmluZygxLCBiaW5kaW5nUGF0aC5sZW5ndGgpO1xyXG4gICAgY29uc3QgcGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG5cclxuICAgIGNvbnN0IGZpbHRlcmVkUGF0aHMgPSBwYXRocy5maWx0ZXIoKHBhcnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICByZXR1cm4gcGFydCAhPT0gJyc7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGZpbHRlcmVkUGF0aHMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIGdldFBhZ2luZ0luZm8oKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YTtcclxuICAgIGxldCBwYWdpbmdJbmZvID0gYmluZGluZ0RhdGEucGFnaW5nSW5mbztcclxuICAgIGlmIChiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCkubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgIHJldHVybiBpdGVtLnN1YnN0cmluZygwLCBpdGVtLmxlbmd0aCAtIDEpO1xyXG4gICAgICB9KTtcclxuICAgICAgYmluZGluZ1BhdGhzLmZvckVhY2gocGF0aCA9PiB7XHJcbiAgICAgICAgcGFnaW5nSW5mbyA9IHBhZ2luZ0luZm8gJiYgcGFnaW5nSW5mb1twYXRoXSB8fCB7fTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBwYWdpbmdJbmZvO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihHcmlkQ29sdW1uQWdncmVnYXRlRGlyZWN0aXZlKSBwcml2YXRlIGFnZ3JDb2x1bW5zOiBRdWVyeUxpc3Q8R3JpZENvbHVtbkFnZ3JlZ2F0ZURpcmVjdGl2ZT47XHJcbiAgcHJpdmF0ZSBiaW5kaW5nQ2hhbmdlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqIEBwYXJhbSAgZ3JpZCDlrr/kuLtHcmlkXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIHVpU3RhdGU6IFVJU3RhdGUsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgZXZlbnRCdXM6IEZyYW1lRXZlbnRCdXMsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgdmlld01vZGVsOiBWaWV3TW9kZWwsXHJcbiAgICBwdWJsaWMgZ3JpZDogR3JpZENvbXBvbmVudCxcclxuICAgIHB1YmxpYyBzZWxlY3Rpb25EaXI6IFNlbGVjdGlvbkRpcmVjdGl2ZSxcclxuICAgIHB1YmxpYyBkaWFsb2dTZXI6IERpYWxvZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGRhdGVTZXJ2aWNlOiBEYXRlVGltZUhlbHBlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGtlbmRvZ3JpZEZvcm1hdFNlcjogRmFycmlzS2VuZG9HcmlkRm9ybWF0U2VydmljZSxcclxuICAgIHByaXZhdGUgcnRzOiBSdW50aW1lU3RhdGVTZXJ2aWNlLFxyXG4gICAgcHVibGljIG5nWm9uZTogTmdab25lXHJcbiAgKSB7XHJcbiAgICBzdXBlcihncmlkKTtcclxuXHJcbiAgICB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXMgPSBbXTtcclxuICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzKTtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZ2V0Rm9ybUFwcENvbnRleHQoKTtcclxuICAgIGlmIChhcHBDb250ZXh0ICYmIGFwcENvbnRleHQuaGFzT3duUHJvcGVydHkoJ21lc3NhZ2VQaXBlJykpIHtcclxuICAgICAgYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5zdWJzY3JpYmUoKG1lc3NhZ2U6IGFueSkgPT4ge1xyXG4gICAgICAgIHRoaXMuZ3JpZC5jbG9zZUNlbGwoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjIfku6TliJ3lp4vljJblkI5cclxuICAgKi9cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcblxyXG4gICAgLy8g5Yid5aeL5YyWc3RhdGXvvIzliIbnu4Tkvb/nlKjjgIJcclxuICAgIHRoaXMuaW5pdERhdGFTdGF0ZSgpO1xyXG5cclxuICAgIHRoaXMucmVmcmVzaFZpZXcoKTtcclxuICAgIGlmICh0aGlzLnZpZXdNb2RlbCAmJiB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQgJiYgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50KSB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5mcmFtZUNvbXBvbmVudC5jb21wb25lbnRUeXBlID0gQ29tcG9uZW50VHlwZS5rZW5kb0dyaWRDb21wb25lbnQ7XHJcbiAgICB9XHJcbiAgICAvLyDmlbDmja7lj5jljJZcclxuICAgIHRoaXMuYmluZGluZ0NoYW5nZVN1YnNjcmlwdGlvbiA9IHRoaXMuYmluZGluZ0RhdGEuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIHRoaXMucmVmcmVzaFZpZXcoY2hhbmdlKTtcclxuXHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5Mb2FkKSB7XHJcbiAgICAgICAgLy8gbG9hZOaXtu+8jOWcqOWkmumAieaooeW8j+S4i++8jOmcgOa4heepuumAieS4rembhuWQiFxyXG4gICAgICAgIGlmICh0aGlzLmlzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgICAgICBjb25zdCBpc01hdGNoID0gdGhpcy5jaGVja0lmQ2hhbmdlTWF0Y2hCaW5kaW5nUGF0aChjaGFuZ2UpO1xyXG4gICAgICAgICAgaWYgKGlzTWF0Y2gpIHtcclxuICAgICAgICAgICAgLy8g5riF56m65aSa6YCJ6ZuG5ZCIXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC51aVN0YXRlLnNldFByb3BlcnR5VmFsdWUoJ2lkcycsIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyk7XHJcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAvLyDmuLLmn5PliJ3lp4vpgInkuK3ooYxcclxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvd1NlbGVjdGVkQ29udGV4dDogU2VsZWN0ZWRSb3dDb250ZXh0ID0gbmV3IFNlbGVjdGVkUm93Q29udGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXNQYWdlYWJsZSA9IE11bHRpU2VsZWN0R3JpZFV0aWxpdHkuY2hlY2tJZkVuYWJsZVBhZ2luZyh0aGlzLmdyaWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzUGFnZWFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5yb3dJbmRleCA9IHRoaXMuZ3JpZC5za2lwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5yb3dJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByb3dTZWxlY3RlZENvbnRleHQuY3VycmVudFJvd0luZGV4ID0gdGhpcy5yb3dJbmRleDtcclxuICAgICAgICAgICAgICAgIHJvd1NlbGVjdGVkQ29udGV4dC5sYXN0Um93SW5kZXggPSB0aGlzLmxhc3RSb3dJbmRleDtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2VsZWN0ZWRSb3dDaGFuZ2Uocm93U2VsZWN0ZWRDb250ZXh0KTtcclxuICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRPRE86IOS9v+eUqOetlueVpeaooeW8j+mHjeaehFxyXG4gICAgICAvLyBiaW5kaW5nRGF0YSDlkIzmraUgU2VsZWN0ZWRLZXlzXHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUpIHtcclxuICAgICAgICB0aGlzLnN5bmNEZWxldGVkS2V5cyhjaGFuZ2UudmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGlzTWF0Y2ggPSB0aGlzLmNoZWNrSWZDaGFuZ2VNYXRjaEJpbmRpbmdQYXRoKGNoYW5nZSk7XHJcbiAgICAgIGlmIChpc01hdGNoKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVTZWxlY3RlZEtleUNoYW5nZSh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5riy5p+T5b2T5YmN6KGMXHJcbiAgICAgIGlmIChpc01hdGNoICYmIHRoaXMuY2hlY2tDdXJyZW50Um93SWRFeGlzdHMoKSAmJiBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkICYmICF0aGlzLmRhdGFJZCkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyQ3VycmVudFJvdyh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcclxuICAgICAgLy8gRklYTUU66ZyA6KaB5pyJ6YeN572u6aG156CB55qE5pe25py6XHJcbiAgICAgIC8qaWYgKChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQpICYmIHRoaXMuY3VycmVudFJvd0lkICE9PSB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCkge1xyXG4gICAgICAgICAgdGhpcy5yZXNldFBhZ2VJbmZvKCk7XHJcbiAgICAgIH0qL1xyXG4gICAgICAvLyDop6blj5Hlj5jmm7Tmo4DmtYtcclxuICAgICAgaWYgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgfHwgY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuU2VsZWN0aW9uQ2hhbmdlZFxyXG4gICAgICAgIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkFwcGVuZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5SZW1vdmUpIHtcclxuXHJcbiAgICAgICAgLy8g6Kem5Y+R5Y+Y5pu05qOA5rWLXHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZCAmJiB0aGlzLmdyaWRbJ2NoYW5nZURldGVjdG9yUmVmJ10gJiYgdGhpcy5ncmlkWydjaGFuZ2VEZXRlY3RvclJlZiddWydkZXRlY3RDaGFuZ2VzJ10pIHtcclxuICAgICAgICAgIHRoaXMuZ3JpZFsnY2hhbmdlRGV0ZWN0b3JSZWYnXVsnZGV0ZWN0Q2hhbmdlcyddKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHRoaXMuZWRpdGFibGUgPT09IHRydWUgJiYgdGhpcy5mb3JtID09PSBudWxsKSB7XHJcbiAgICAgIHRocm93IEVycm9yKCflkK/nlKjnvJbovpHml7bvvIzlv4XpobvmjIflrppmb3JtJyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMuZ3JpZCB8fCAhdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvbiB8fCAhdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvblsnZmllbGRzJ10pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyaWRDb2x1bW5zID0gdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvblsnZmllbGRzJ107XHJcbiAgICBjb25zdCBncmlkT3B0aW9uID0gdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvbjtcclxuXHJcbiAgICAvLyDliKTmlq3liJfkuK3mmK/lkKblrZjlnKjlm7rlrprliJdcclxuICAgIGdyaWRPcHRpb24ubG9ja2FibGUgPSAoY29sdW1uczogYW55W10pID0+IHtcclxuICAgICAgcmV0dXJuIGNvbHVtbnMuc29tZShlbGUgPT4ge1xyXG4gICAgICAgIHJldHVybiBlbGUuZnJvemVuO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5yb3dDbGFzcy5lbWl0KHRoaXMuZ3JpZCk7XHJcbiAgICAvLyDmt7vliqDliJflsZ7mgKfmiJbogIXmlrnms5VcclxuICAgIGdyaWRDb2x1bW5zLmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICAvLyDoh6rlrprkuYnotoXpk75cclxuICAgICAgaWYgKGVsZW1lbnQubGlua2VkTGFiZWxFbmFibGVkICYmICFlbGVtZW50LmxpbmtFdmVudCkge1xyXG4gICAgICAgIGVsZW1lbnQubGlua0V2ZW50ID0gKCkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOiLpeayoeacieiHquWumuS5ieagvOW8j+WMluaWueazlSAg5q+P5Liq5YiX5a+56LGh57uR5a6a5qC85byP5YyW5pa55rOVXHJcbiAgICAgIGlmICghZWxlbWVudC5nZXRDb2x1bW5Gb3JtYXQpIHtcclxuICAgICAgICBlbGVtZW50LmdldENvbHVtbkZvcm1hdCA9IChkYXRhSXRlbTogYW55LCBjb2x1bW46IGFueSkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMua2VuZG9ncmlkRm9ybWF0U2VyLmdldENvbHVtbkZvcm1hdChkYXRhSXRlbSwgY29sdW1uKTtcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDlpoLmnpzmsqHmnInoh6rlrprkuYnnsbvmoLflvI8g5q+P5Liq5YiX57uR5a6aIOagvOW8j+WMluaWueazlVxyXG4gICAgICBpZiAoIWVsZW1lbnQuZ2V0Q2xhc3NOYW1lKSB7XHJcbiAgICAgICAgZWxlbWVudC5nZXRDbGFzc05hbWUgPSAoZGF0YUl0ZW06IGFueSwgY29sdW1uOiBhbnkpID0+ICcnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDoh6rlrprkuYnluK7liqnliY3lkI7kuovku7ZcclxuICAgICAgaWYgKGVsZW1lbnQuZWRpdG9yICYmIGVsZW1lbnQuZWRpdG9yLnR5cGUgPT09ICdMb29rdXBFZGl0Jykge1xyXG5cclxuICAgICAgICAvLyDluK7liqnliY3kuovku7ZcclxuICAgICAgICBpZiAoIWVsZW1lbnQuZGljdFBpY2tpbmcpIHtcclxuICAgICAgICAgIGVsZW1lbnQuZGljdFBpY2tpbmcgPSAocGFyYW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDluK7liqnlkI7kuovku7ZcclxuICAgICAgICBpZiAoIWVsZW1lbnQuZGljdFBpY2tlZCkge1xyXG4gICAgICAgICAgZWxlbWVudC5kaWN0UGlja2VkID0gKHBhcmFtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgLy8g6YeN5paw6L+b5YWl57yW6L6RXHJcbiAgICAgICAgICAgIHRoaXMuY2VsbENsaWNrSGFuZGxlcih0aGlzLmNlbGxDbGlja1BhcmFtKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8g57uR5a6aZ3JpZE9wdGlvblxyXG4gICAgdGhpcy5iaW5kaW5nR3JpZE9wdGlvbigpO1xyXG5cclxuICAgIC8vIOWkmumAieaooeW8j+S4i++8jOiuvue9ruWIneWni+mAieS4reihjFxyXG4gICAgaWYgKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgLy8gVE9ETzog56e76ZmkIHNldFRpbWVvdXRcclxuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IHJvd1NlbGVjdGVkQ29udGV4dDogU2VsZWN0ZWRSb3dDb250ZXh0ID0gbmV3IFNlbGVjdGVkUm93Q29udGV4dCgpO1xyXG4gICAgICAgICAgcm93U2VsZWN0ZWRDb250ZXh0LmN1cnJlbnRSb3dJbmRleCA9IHNlbGYucm93SW5kZXg7XHJcbiAgICAgICAgICByb3dTZWxlY3RlZENvbnRleHQubGFzdFJvd0luZGV4ID0gc2VsZi5sYXN0Um93SW5kZXg7XHJcbiAgICAgICAgICBzZWxmLmhhbmRsZVNlbGVjdGVkUm93Q2hhbmdlKHJvd1NlbGVjdGVkQ29udGV4dCk7XHJcbiAgICAgICAgfSwgMzAwKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgLy8gdGhpcy5ncmlkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5rLWdyaWQnKTtcclxuICAgIC8vIC8vIOe7keWummdyaWQga2V5ZG93buWvueixoeeahOaWueazlVxyXG4gICAgLy8gdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgLy8gICB0aGlzLmdyaWRLZXlkb3duRXZlbnQgPSB0aGlzLmVudGVyQ2VsbC5iaW5kKHRoaXMpO1xyXG4gICAgLy8gICB0aGlzLmdyaWRDZWxsQ2xpY2tFdmVudCA9IHRoaXMuY2VsbENsaWNrSGFuZGxlci5iaW5kKHRoaXMpO1xyXG4gICAgLy8gICB0aGlzLmdyaWRDZWxsQ2xvc2VFdmVudCA9IHRoaXMuY2VsbENsb3NlSGFuZGxlci5iaW5kKHRoaXMpO1xyXG4gICAgLy8gICB0aGlzLmdyaWRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmdyaWRLZXlkb3duRXZlbnQpO1xyXG4gICAgLy8gICB0aGlzLmdyaWRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NlbGxDbGljaycsIHRoaXMuZ3JpZENlbGxDbGlja0V2ZW50KTtcclxuICAgIC8vICAgdGhpcy5ncmlkRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjZWxsQ2xvc2UnLCB0aGlzLmdyaWRDZWxsQ2xvc2VFdmVudCk7XHJcbiAgICAvLyB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qOA5rWLY2hhbmdl55qE6Lev5b6E5ZKMQmluZGluZ1BhdGjmmK/lkKbljLnphY1cclxuICAgKi9cclxuICBwcml2YXRlIGNoZWNrSWZDaGFuZ2VNYXRjaEJpbmRpbmdQYXRoKGNoYW5nZTogQ2hhbmdlKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNNYXRjaCA9IGZhbHNlO1xyXG4gICAgaWYgKCFjaGFuZ2UgfHwgIWNoYW5nZS5wYXRoKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYW5nZVBhdGhBcnJheSA9IGNoYW5nZS5wYXRoO1xyXG4gICAgaWYgKCFjaGFuZ2VQYXRoQXJyYXkpIHtcclxuICAgICAgcmV0dXJuIGlzTWF0Y2g7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCEodGhpcy5iaW5kaW5nRGF0YSkgJiYgISh0aGlzLmJpbmRpbmdEYXRhLmJpbmRpbmdQYXRoKSkge1xyXG4gICAgICByZXR1cm4gaXNNYXRjaDtcclxuICAgIH1cclxuICAgIGNvbnN0IGJpbmdkaW5nUGF0aEFycmF5ID0gdGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG4gICAgaWYgKGJpbmdkaW5nUGF0aEFycmF5Lmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgIHJldHVybiBpc01hdGNoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChjaGFuZ2VQYXRoQXJyYXkubGVuZ3RoID09PSAwKSB7IC8vIOS4u+ihqFxyXG4gICAgICBpZiAodGhpcy5iaW5kaW5nRGF0YS5iaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlLnBhdGgubGVuZ3RoID09PSAxKSB7Ly8g5Li75LuO6KGoXHJcbiAgICAgIGlmIChiaW5nZGluZ1BhdGhBcnJheS5sZW5ndGggPT09IDIgJiYgYmluZ2RpbmdQYXRoQXJyYXlbMV0gPT09IGNoYW5nZS5wYXRoWzBdKSB7XHJcbiAgICAgICAgaXNNYXRjaCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlLnBhdGgubGVuZ3RoID09PSAyKSB7IC8vIOS4u+S7juS7juihqFxyXG4gICAgICBpZiAoYmluZ2RpbmdQYXRoQXJyYXkubGVuZ3RoID09PSAzICYmIGJpbmdkaW5nUGF0aEFycmF5WzFdID09PSBjaGFuZ2UucGF0aFswXSAmJiBiaW5nZGluZ1BhdGhBcnJheVsyXSA9PT0gY2hhbmdlLnBhdGhbMV0pIHtcclxuICAgICAgICBpc01hdGNoID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpc01hdGNoO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG6YCJ5Lit5Li76ZSu5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVTZWxlY3RlZEtleUNoYW5nZShjdXJyZW50SWQ6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRLZXlzID0gdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzO1xyXG4gICAgaWYgKCFjdXJyZW50SWQpIHtcclxuXHJcbiAgICAgIC8vIOWmguaenOW9k+WJjeihjOaXtm51bGzvvIzkvYZzZWxlY3RlZEtleXPph4zmnInlgLzvvIzmuIXnqbrlubblj5HpgIHkuIDmrKHooYzliIfmjaJcclxuICAgICAgaWYgKHNlbGVjdGVkS2V5cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgcmVtb3ZlZFNlbGVjdGVkS2V5cyA9IHNlbGVjdGVkS2V5cy5zcGxpY2UoMCwgc2VsZWN0ZWRLZXlzLmxlbmd0aCk7XHJcbiAgICAgICAgaWYgKHJlbW92ZWRTZWxlY3RlZEtleXMuaW5kZXhPZihudWxsKSA9PT0gLTEpIHtcclxuICAgICAgICAgIHRoaXMuZW1pdFNlbGVjdGVkUm93Q2hhbmdlKHsgY3VycmVudFJvd0lkOiBudWxsIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgb2xkQ3VycmVudFJvd0lkID0gbnVsbDtcclxuICAgIGlmICh0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgIG9sZEN1cnJlbnRSb3dJZCA9IHRoaXMuY3VycmVudFJvd0lkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgb2xkQ3VycmVudFJvd0lkID0gdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzLmxlbmd0aCA9PT0gMFxyXG4gICAgICAgID8gbnVsbCA6IHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5c1swXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOmlmICh0aGlzLmN1cnJlbnRSb3dJZCAhPT0gY3VycmVudElkKSB7XHJcbiAgICBpZiAob2xkQ3VycmVudFJvd0lkICE9PSBjdXJyZW50SWQpIHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRSb3dDb250ZXh0OiBhbnkgPSB7fTtcclxuICAgICAgc2VsZWN0ZWRSb3dDb250ZXh0LmN1cnJlbnRSb3dJZCA9IGN1cnJlbnRJZDtcclxuICAgICAgdGhpcy5jdXJyZW50Um93SWQgPSBjdXJyZW50SWQ7XHJcbiAgICAgIHRoaXMuZW1pdFNlbGVjdGVkUm93Q2hhbmdlKHNlbGVjdGVkUm93Q29udGV4dCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5HlsITpgInkuK3ooYzliIfmjaLkuovku7ZcclxuICAgKiBAZGVzY3JpcHRpb24g57uf5LiA5Y2V6YCJ5qih5byP5ZKM5aSa6YCJ5qih5byP5LiL55qE6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbWl0U2VsZWN0ZWRSb3dDaGFuZ2Uoc2VsZWN0ZWRSb3dDb250ZXh0OiBhbnkpIHtcclxuICAgIGlmICghdGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkgeyAvLyDlkJHlkI7lhbzlrrlcclxuICAgICAgY29uc3QgY3VycmVudElkID0gc2VsZWN0ZWRSb3dDb250ZXh0LmN1cnJlbnRSb3dJZDtcclxuICAgICAgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzID0gW2N1cnJlbnRJZF07XHJcbiAgICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5c0NoYW5nZS5lbWl0KHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZWxlY3RlZFJvd0NoYW5nZS5lbWl0KHNlbGVjdGVkUm93Q29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoZWNrQ3VycmVudFJvd0lkRXhpc3RzKCk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IGlzRXhpc3QgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAodGhpcy5iaW5kaW5nTGlzdCAmJiB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCAmJiB0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGlzRXhpc3QgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpc0V4aXN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZCM5q2l5bey5Yig6Zmk6ZSu5Yiw6YCJ5Lit6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzeW5jRGVsZXRlZEtleXMoZGVsZXRlZFZhbHVlQ29sbGVjdGlvbjogYW55W10pIHtcclxuICAgIGlmICghZGVsZXRlZFZhbHVlQ29sbGVjdGlvbikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlZFZhbHVlQ29sbGVjdGlvbi5mb3JFYWNoKChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzLmluZGV4T2YoaWQpO1xyXG4gICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRGlyLnNlbGVjdGVkS2V5cy5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgICAgICAvLyBzZWxlY3RlZEtleXPooqvmuIXnqbrnmoTml7blgJnvvIzop6blj5HkuIDmrKHooYzlj5jmm7RcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgdGhpcy5lbWl0U2VsZWN0ZWRSb3dDaGFuZ2UoeyBjdXJyZW50Um93SWQ6IG51bGwgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyQ3VycmVudFJvdyhjdXJyZW50SWQ6IHN0cmluZykge1xyXG4gICAgaWYgKCFjdXJyZW50SWQgfHwgY3VycmVudElkID09PSAnJykgey8vIOS4jeWtmOWcqOW9k+WJjeihjFxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzrkvb/nlKjnrZbnlaXmqKHlvI/ph43mnoRcclxuICAgIGlmICh0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnJlbmRlclNlbGVjdGlvblJvdyh0aGlzLmJpbmRpbmdMaXN0LmN1cnJlbnRJZCwgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaMh+S7pOi+k+WFpeWPmOabtOWkhOeQhlxyXG4gICAqL1xyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIHN1cGVyLm5nT25DaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgdGhpcy5yZWZyZXNoVmlldygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyH5Luk6ZSA5q+B77yM5rOo6ZSA6K6i6ZiFXHJcbiAgICovXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICBpZiAodGhpcy5iaW5kaW5nQ2hhbmdlU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMuYmluZGluZ0NoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWZyZXNoVmlldyhjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIC8vIHRoaXMuYmluZERhdGEoKTtcclxuICAgIHRoaXMucmVmcmVzaERhdGEoY2hhbmdlKTtcclxuXHJcbiAgICAvLyDliLfmlrDpobXohJrlkIjorqHkv6Hmga/jgILlrqLmiLfnq6/lkIjorqHvvIzmmoLml7bmlL7ov5nph4zvvIzmnI3liqHnq6/lkIjorqHml7bmnIDlpb3ku47ov5nph4znp7votbDjgIJieSBqdXN0aW5cclxuICAgIHRoaXMucmVmcmVzaFN1bW1hcnkoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWummRhdGHliLDlrr/kuLtncmlk5LiKXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwcml2YXRlIGJpbmREYXRhKCkge1xyXG4gICAgLypjb25zdCBkYXRhID0gdGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKTtcclxuICAgIGxldCBza2lwID0gMDtcclxuICAgIGlmICh0aGlzLmJpbmRpbmdMaXN0LnBhZ2VJbmRleCA+IDApIHtcclxuICAgICAgc2tpcCA9ICh0aGlzLmJpbmRpbmdMaXN0LnBhZ2VJbmRleCAtIDEpICogdGhpcy5iaW5kaW5nTGlzdC5wYWdlU2l6ZTtcclxuICAgIH1cclxuICAgIHRoaXMudXBkYXRlUGFnZXIodGhpcy5iaW5kaW5nTGlzdC5wYWdlU2l6ZSwgc2tpcCk7XHJcbiAgICBjb25zdCBwcm9jZXNzZWQgPSBwcm9jZXNzKGRhdGEsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RhdGUsIHsgc2tpcDogMCB9KSk7XHJcbiAgICBwcm9jZXNzZWQudG90YWwgPSB0aGlzLmJpbmRpbmdMaXN0LnRvdGFsO1xyXG4gICAgdGhpcy5ncmlkLmRhdGEgPSBwcm9jZXNzZWQ7Ki9cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVmcmVzaERhdGEoY2hhbmdlPzogQ2hhbmdlKSB7XHJcbiAgICBsZXQgc2tpcCA9IDA7XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICBpZiAocGFnZUluZGV4ID4gMCkge1xyXG4gICAgICBza2lwID0gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZVBhZ2VyKHBhZ2VTaXplLCBza2lwKTtcclxuICAgIHRoaXMuZW5kQ2VsbEVkaXQoY2hhbmdlKTtcclxuICAgIHRoaXMuZGF0YSA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKHsgaWdub3JlTXVsdGlMYW5nSW5wdXQ6IHRydWUgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmAgOWHuue8lui+keeKtuaAgVxyXG4gICAqIEBwYXJhbSBjaGFuZ2Ug5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbmRDZWxsRWRpdChjaGFuZ2U/OiBDaGFuZ2UpIHtcclxuICAgIGNvbnN0IGlzRWRpdGluZyA9IHRoaXMuZ3JpZC5pc0VkaXRpbmc7XHJcbiAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQgJiYgaXNFZGl0aW5nKSB7XHJcbiAgICAgIHRoaXMuZ3JpZC5jYW5jZWxDZWxsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgcmVmcmVzaFN1bW1hcnkoKSB7XHJcbiAgICBpZiAodGhpcy5hZ2dyQ29sdW1ucykge1xyXG4gICAgICB0aGlzLmFnZ3JDb2x1bW5zLmZvckVhY2goYWdnckNvbCA9PiB7XHJcbiAgICAgICAgaWYgKGFnZ3JDb2wuYWdncmVnYXRlKSB7XHJcbiAgICAgICAgICBhZ2dyQ29sLnJlY2FsY3VsYXRlU3VtbWFyeSh0aGlzLmJpbmRpbmdMaXN0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcigncGFnZUNoYW5nZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uUGFnZUNoYW5nZShldmVudDogUGFnZUNoYW5nZUV2ZW50KSB7XHJcbiAgICBjb25zdCB7IHNraXAgPSAwLCB0YWtlID0gMCB9ID0gZXZlbnQgfHwge307XHJcbiAgICAvLyB0aGlzLmJpbmRpbmdMaXN0LnNldFBhZ2luYXRpb25JbmZvKHNraXAsIHRha2UpO1xyXG4gICAgdGhpcy5iaW5kaW5nRGF0YS5zZXRQYWdpbmdJbmZvKHNraXAsIHRha2UsIHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKTtcclxuICAgIC8vIOenu+mZpOmAieS4reihjOagt+W8j1xyXG4gICAgTXVsdGlTZWxlY3RHcmlkVXRpbGl0eS5yZW1vdmVSb3dTZWxlY3RlZFN0eWxlKHRoaXMuZ3JpZCwgdGhpcy5yb3dJbmRleCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmHjee9rmdyaWTliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIHJlc2V0UGFnZUluZm8oKSB7XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLnNldFBhZ2luZ0luZm8oMCwgcGFnZVNpemUsIHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBpbml0RGF0YVN0YXRlKCkge1xyXG4gICAgLy8gY29uc3QgZ3JvdXBzOiBHcm91cERlc2NyaXB0b3JbXSA9IFtdO1xyXG4gICAgLy8gaWYgKHRoaXMuZ3JvdXBGaWVsZCkge1xyXG4gICAgLy8gICBncm91cHMucHVzaCh7ZmllbGQ6IHRoaXMuZ3JvdXBGaWVsZCwgYWdncmVnYXRlczogdGhpcy5hZ2dyZWdhdGVzfHxbXX0pO1xyXG4gICAgLy8gICB0aGlzLmdyaWQuZ3JvdXAgPSBncm91cHM7XHJcbiAgICAvLyB9XHJcbiAgICAvLyB0aGlzLnN0YXRlID0gT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLCB7Z3JvdXA6IGdyb3Vwc30pO1xyXG5cclxuICAgIGNvbnN0IGFnZ3JlZ2F0ZXNEZXM6IEFnZ3JlZ2F0ZURlc2NyaXB0b3JbXSA9IFtdO1xyXG4gICAgaWYgKHRoaXMuZ3JvdXBBZ2dyRmllbGRzKSB7XHJcbiAgICAgIGZvciAoY29uc3QgZ3JvdXBBZ2dyRmllbGQgb2YgdGhpcy5ncm91cEFnZ3JGaWVsZHMpIHtcclxuICAgICAgICBhZ2dyZWdhdGVzRGVzLnB1c2goeyBmaWVsZDogZ3JvdXBBZ2dyRmllbGQsIGFnZ3JlZ2F0ZTogJ3N1bScgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncm91cDogR3JvdXBEZXNjcmlwdG9yW10gPSBbXTtcclxuICAgIGlmICh0aGlzLmdyb3VwRmllbGQpIHtcclxuICAgICAgZ3JvdXAucHVzaCh7IGZpZWxkOiB0aGlzLmdyb3VwRmllbGQsIGFnZ3JlZ2F0ZXM6IGFnZ3JlZ2F0ZXNEZXMgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmdyb3VwID0gZ3JvdXA7XHJcblxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcGFyYW0gc3RhdGUgU3RhdGVcclxuICAgKi9cclxuICBvblN0YXRlQ2hhbmdlKHN0YXRlOiBEYXRhU3RhdGVDaGFuZ2VFdmVudCkge1xyXG4gICAgLy8g6K+05piO77yacGFnZXLmoLnmja5za2lw6K6h566X5b2T5YmN6aG156CB44CCa2VuZG8gZ3JpZOWGhemDqOS8muWcqGZpbHRlciBzdGF0ZeWPmOWMluaXtuaKinNraXDlj5jkuLow77yI6YeN572u5Yiw56ys5LiA6aG177yJ44CCXHJcbiAgICAvLyDlm6DmraTpnIDopoHph43lhplvblN0YXRlQ2hhbmdl5pa55rOV77yM5L+u5q2jc2tpcFxyXG4gICAgaWYgKHN0YXRlLnNraXAgIT09IHRoaXMuY3VycmVudFNraXApIHtcclxuICAgICAgc3RhdGUuc2tpcCA9IHRoaXMuY3VycmVudFNraXA7XHJcbiAgICB9XHJcbiAgICAvLyDkvb/nlKhrZW5kb+m7mOiupOeahOWkhOeQhnN0YXRl55qE6YC76L6RXHJcbiAgICB0aGlzLmFwcGx5U3RhdGUoc3RhdGUpO1xyXG5cclxuICAgIHRoaXMucmViaW5kKCk7XHJcbiAgfVxyXG5cclxuICAvLyBwcm90ZWN0ZWQgYXBwbHlTdGF0ZSh7c2tpcCwgdGFrZSwgc29ydCwgZ3JvdXAsIGZpbHRlcn06IFN0YXRlKTogdm9pZCB7XHJcbiAgLy8gICB0aGlzLnNraXAgPSBza2lwO1xyXG4gIC8vICAgdGhpcy5wYWdlU2l6ZSA9IHRha2U7XHJcbiAgLy8gICB0aGlzLnNvcnQgPSBzb3J0O1xyXG4gIC8vICAgdGhpcy5ncm91cCA9IGdyb3VwO1xyXG4gIC8vICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7XHJcbiAgLy8gfVxyXG5cclxuICAvKlxyXG4gICAqIEBvdmVycmlkZSDmnI3liqHlmajnq6/liIbpobXlj5bmlbDjgIJwcm9jZXNz5L2/55So55qEc3RhdGXkuK1za2lw5bqU5Li6MO+8jOWQpuWImeS4jeaYvuekuuaVsOaNrlxyXG4gICAqIEBwYXJhbSBzdGF0ZSBTdGF0ZVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBwcm9jZXNzKHN0YXRlOiBTdGF0ZSk6IEdyaWREYXRhUmVzdWx0IHtcclxuICAgIC8vIGlmICh0aGlzLmVkaXRpbmcpIHtcclxuICAgIC8vICAgc3RhdGUuc29ydCA9IG51bGw7XHJcbiAgICAvLyB9IGVsc2Uge1xyXG4gICAgLy8gICBzdGF0ZS5zb3J0ID0gdGhpcy5vcmlnaW5hbFNvcnQ7XHJcbiAgICAvLyB9XHJcbiAgICBzdGF0ZS5za2lwID0gMDtcclxuICAgIGNvbnN0IHsgcGFnZVNpemUgPSAwLCB0b3RhbDogdG90YWxDb3VudCA9IDAgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpIHx8IHt9O1xyXG4gICAgLy8gZml477ya5LiN5ZCv55So5YiG6aG15pe277yMdGFrZT0w5a+86Ie0cHJvY2Vzc+S4jei/lOWbnuaVsOaNrlxyXG4gICAgaWYgKHN0YXRlLnRha2UgPT09IDApIHtcclxuICAgICAgc3RhdGUudGFrZSA9IHRoaXMuYmluZGluZ0xpc3QubGVuZ3RoO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3RhdGUudGFrZSA9IHBhZ2VTaXplO1xyXG4gICAgfVxyXG4gICAgLy8g57yW6L6R5qih5byP55qE5Yik5pat5L6d5o2u5Li6cGFnZVNpemXlsI/kuo7nu5HlrprmlbDmja7nmoTmlbDph4/kuJTlkK/nlKjliIbpobVcclxuICAgIGNvbnN0IGlzRWRpdE1vZGUgPSBzdGF0ZS50YWtlIDwgdGhpcy5iaW5kaW5nTGlzdC5sZW5ndGg7XHJcbiAgICBpZiAoaXNFZGl0TW9kZSkge1xyXG4gICAgICBzdGF0ZS50YWtlID0gdGhpcy5iaW5kaW5nTGlzdC5sZW5ndGg7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwcm9jZXNzZWQgPSBzdXBlci5wcm9jZXNzKHN0YXRlKTtcclxuICAgIC8vIGZpeDrmlbDmja7ku47ml6DliLDmnInml7bliIbpobXkuI3lkK/nlKhcclxuICAgIHByb2Nlc3NlZC50b3RhbCA9IE1hdGgubWF4KHRvdGFsQ291bnQsIHRoaXMuYmluZGluZ0xpc3QubGVuZ3RoKTtcclxuICAgIC8vIOWIhumhtee8lui+keaooeW8j+S4i+aVsOaNruaAu+iusOW9leaVsOS4jeiDveetieS6juecn+WunueahOaVsOaNruaVsOaNru+8jOWQpuWImeWIhumhteW3peWFt+adoeWwseS8muiHquWKqOWinuWKoOWIhumhtemhteetvlxyXG4gICAgaWYgKGlzRWRpdE1vZGUpIHtcclxuICAgICAgcHJvY2Vzc2VkLnRvdGFsID0gdG90YWxDb3VudCB8fCAxO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwcm9jZXNzZWQ7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOmAieS4reihjOS4u+mUruWPmOWMluWkhOeQhlxyXG4gICAqIEBwYXJhbSBldmVudCB7IFNlbGVjdGlvbkV2ZW50fSDpgInkuK3ooYzlj5jljJblpITnkIZcclxuICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdzZWxlY3RlZEtleXNDaGFuZ2UnLCBbJyRldmVudCddKVxyXG4gIHB1YmxpYyBzZWxlY3RlZEtleXNDaGFuZ2VIYW5kbGVyKHNlbGVjdGVkS2V5czogc3RyaW5nW10pIHtcclxuICAgIGlmICghKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUpKSB7Ly8g5Y2V6YCJ5qih5byP5LiLXHJcbiAgICAgIC8vIOiuvue9rkJpbmRpbmdEYXRh5Lit55qE5b2T5YmN6KGMXHJcbiAgICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKHNlbGVjdGVkS2V5c1tzZWxlY3RlZEtleXMubGVuZ3RoIC0gMV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudmlld01vZGVsLnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnaWRzJywgdGhpcy5zZWxlY3Rpb25EaXIuc2VsZWN0ZWRLZXlzKTsgLy8g5pu05paw6ZuG5ZCIXHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOWkhOeQhkdyaWTooYzliIfmjaLkuovku7ZcclxuICAgKiBAcGFyYW0gZXZlbnQgeyBTZWxlY3Rpb25FdmVudH0g6KGM5YiH5o2i5LqL5Lu25a+56LGhXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignc2VsZWN0aW9uQ2hhbmdlJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgc2VsZWN0aW9uQ2hhbmdlSGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5Jc011bHRpcGxlU2VsZWN0aW9uTW9kZSkge1xyXG4gICAgICB0aGlzLmhhbmRsZVNlbGVjdGVkQ2hlY2tib3hDaGFuZ2UodGhpcy5ncmlkLndyYXBwZXIsIGV2ZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhmNoZWNrYm946YCJ5Lit5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVTZWxlY3RlZENoZWNrYm94Q2hhbmdlKGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIGV2ZW50OiBhbnkpIHtcclxuICAgIE11bHRpU2VsZWN0R3JpZFV0aWxpdHkucmVuZGVyU2VsZWN0ZWRDaGFuZ2VDaGVja2JveChlbGVtZW50UmVmLCBldmVudCk7XHJcbiAgICB0aGlzLnNlbGVjdGVkQ2hlY2tib3hDaGFuZ2UuZW1pdChldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOWNleWFg+agvOeCueWHu+WkhOeQhlxyXG4gICAqIEBwYXJhbSBldmVudCB7IENlbGxDbGlja0V2ZW50IH0g5Y2V5YWD5qC85Y2V5Ye75LqL5Lu25a+56LGhXHJcbiAgICovXHJcbiAgQEhvc3RMaXN0ZW5lcignY2VsbENsaWNrJywgWyckZXZlbnQnXSlcclxuICBwdWJsaWMgY2VsbENsaWNrSGFuZGxlcihldmVudDogQ2VsbENsaWNrRXZlbnQpIHtcclxuICAgIHRoaXMuY2VsbENsaWNrUGFyYW0gPSBldmVudDtcclxuICAgIHRoaXMuY2VsbENsaWNrRXZlbnQgPSBldmVudDtcclxuICAgIHRoaXMucm93SW5kZXggPSBldmVudC5yb3dJbmRleDtcclxuICAgIHRoaXMuY29sdW1uSW5kZXggPSBldmVudC5jb2x1bW5JbmRleDtcclxuICAgIHRoaXMuc2VuZGVyID0gZXZlbnQuc2VuZGVyO1xyXG5cclxuICAgIC8vIOWkmumAieaooeW8j+S4i++8jOS4lOS4jeWIhue7hOeahOaDheWGteS4i++8jOajgOa1i+ihjOWIh+aNolxyXG4gICAgaWYgKHRoaXMuSXNNdWx0aXBsZVNlbGVjdGlvbk1vZGUgJiYgIXRoaXMuZ3JpZE9wdGlvbi5ncm91cGFibGUpIHtcclxuICAgICAgY29uc3QgY3VycmVudFJvd0luZGV4ID0gZXZlbnQucm93SW5kZXg7XHJcbiAgICAgIGlmIChjdXJyZW50Um93SW5kZXggIT09IHRoaXMubGFzdFJvd0luZGV4KSB7XHJcbiAgICAgICAgY29uc3Qgcm93U2VsZWN0ZWRDb250ZXh0OiBTZWxlY3RlZFJvd0NvbnRleHQgPSBuZXcgU2VsZWN0ZWRSb3dDb250ZXh0KCk7XHJcbiAgICAgICAgcm93U2VsZWN0ZWRDb250ZXh0LmN1cnJlbnRSb3dJbmRleCA9IGN1cnJlbnRSb3dJbmRleDtcclxuICAgICAgICByb3dTZWxlY3RlZENvbnRleHQubGFzdFJvd0luZGV4ID0gdGhpcy5sYXN0Um93SW5kZXg7XHJcblxyXG4gICAgICAgIHRoaXMuaGFuZGxlU2VsZWN0ZWRSb3dDaGFuZ2Uocm93U2VsZWN0ZWRDb250ZXh0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOiuvue9ruWunuS9k+eahOW9k+WJjeihjFxyXG4gICAgdGhpcy5kYXRhSWQgPSB0aGlzLmdldFNlbGVjdGVkSWRGcm9tR3JpZChldmVudC5kYXRhSXRlbSk7XHJcbiAgICB0aGlzLnNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YSh0aGlzLmRhdGFJZCk7XHJcblxyXG4gICAgLy8g6Iul54q25oCB5py65LiN5piv5Y+v57yW6L6R54q25oCBIOS4jeWPr+e8lui+kVxyXG4gICAgaWYgKCF0aGlzLmlzRWRpdGFibGUoKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICAvLyDliJfmqKHmnb/kuI3lrZjlnKggIOS4jeWPr+e8lui+kVxyXG4gICAgaWYgKCFldmVudC5jb2x1bW4uZWRpdFRlbXBsYXRlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChldmVudC50eXBlID09PSAnY2xpY2snICYmICFldmVudC5pc0VkaXRlZCkge1xyXG5cclxuXHJcbiAgICAgIC8vIOWmguaenOWtmOWcqOaYvumakOeKtuWGtSAg56Gu5a6a5q2j56Gu55qEY29sdW1uSW5kZXhcclxuICAgICAgY29uc3Qgb3JpZ2luQ29sdW1zID0gdGhpcy5nZXRDb2x1bW5zKHRoaXMuZ3JpZE9wdGlvbi5maWVsZHMpO1xyXG4gICAgICBjb25zdCBjb2x1bW5zOiBhbnlbXSA9IHRoaXMuZ2V0Q29sdW1ucyhvcmlnaW5Db2x1bXMpO1xyXG4gICAgICBjb25zdCBjdXJyZW50Q29sdW1uSW5kZXggPSBjb2x1bW5zLmZpbmRJbmRleCgoY29sOiBhbnkpID0+IGNvbC5kYXRhRmllbGQgPT09IGV2ZW50LmNvbHVtbi5maWVsZCk7XHJcbiAgICAgIGNvbnN0IGhpZGRlbkNvbExlbiA9IGNvbHVtbnMuc2xpY2UoMCwgY3VycmVudENvbHVtbkluZGV4ICsgMSkuZmlsdGVyKGNvbCA9PiAhY29sLnZpc2libGUpLmxlbmd0aDtcclxuXHJcbiAgICAgIC8vIOi1i+WAvOWFqOWxgOihjOe0ouW8lSAg5YiX57Si5byVXHJcbiAgICAgIHRoaXMucm93SW5kZXggPSBldmVudC5yb3dJbmRleDtcclxuICAgICAgdGhpcy5jb2x1bW5JbmRleCA9IGV2ZW50LmNvbHVtbkluZGV4ICsgaGlkZGVuQ29sTGVuO1xyXG4gICAgICB0aGlzLmhpZGRlbkNvbExlbiA9IGhpZGRlbkNvbExlbjtcclxuICAgICAgdGhpcy5zZW5kZXIgPSBldmVudC5zZW5kZXI7XHJcblxyXG4gICAgICB0aGlzLnNldEVkaXRhYmxlKHRoaXMucm93SW5kZXgsIHRoaXMuY29sdW1uSW5kZXgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG6YCJ5Lit6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBoYW5kbGVTZWxlY3RlZFJvd0NoYW5nZShyb3dTZWxlY3RlZENvbnRleHQ6IFNlbGVjdGVkUm93Q29udGV4dCkge1xyXG4gICAgTXVsdGlTZWxlY3RHcmlkVXRpbGl0eS5yZW5kZXJDbGlja0NoYW5nZWRSb3codGhpcy5ncmlkLCByb3dTZWxlY3RlZENvbnRleHQpO1xyXG5cclxuICAgIHRoaXMucm93SW5kZXggPSByb3dTZWxlY3RlZENvbnRleHQuY3VycmVudFJvd0luZGV4O1xyXG4gICAgdGhpcy5sYXN0Um93SW5kZXggPSByb3dTZWxlY3RlZENvbnRleHQuY3VycmVudFJvd0luZGV4O1xyXG4gICAgLy8g5pu05paw5b2T5YmN6KGMXHJcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2V0UHJpbWFyeSh0aGlzLnJvd0luZGV4KTtcclxuICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKGlkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5oyH5a6a6KGM55qE5Li76ZSuXHJcbiAgICogQHBhcmFtIHJvdyDooYzlj7dcclxuICAgKi9cclxuICBwcml2YXRlIGdldFByaW1hcnkocm93OiBudW1iZXIpIHtcclxuICAgIGxldCBkYXRhOiBhbnkgPSB0aGlzLmdyaWQuZGF0YTtcclxuICAgIGlmIChkYXRhICYmICFBcnJheS5pc0FycmF5KGRhdGEpICYmIGRhdGEuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSkge1xyXG4gICAgICBkYXRhID0gZGF0YS5kYXRhO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBwYWdlSW5kZXggPSAxLCBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMuZ2V0UGFnaW5nSW5mbygpIHx8IHt9O1xyXG4gICAgY29uc3Qgc2tpcCA9IHRoaXMuYmluZGluZ0xpc3Quc2tpcDtcclxuICAgIC8vIOS4jeWIhumhteaIluiAheesrOS4gOmhteaXtuWPluS4jemcgOimgeS/ruaUueihjOWPt1xyXG4gICAgY29uc3Qgcm93TnVtYmVyID0gcGFnZVNpemUgPT09IDAgfHwgcGFnZUluZGV4ID09PSAxID8gcm93IDogcm93IC0gc2tpcDtcclxuICAgIGlmIChkYXRhLmxlbmd0aCA+IHJvd051bWJlcikge1xyXG4gICAgICByZXR1cm4gZGF0YVtyb3dOdW1iZXJdW3RoaXMuYmluZGluZ0xpc3QucHJpbWFyeUtleV07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog5Y2V5YWD5qC857uT5p2f57yW6L6R5aSE55CGXHJcbiAgICogQHBhcmFtIGV2ZW50IOWNleWFg+agvOe7k+adn+e8lui+keS6i+S7tuWvueixoVxyXG4gICAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2NlbGxDbG9zZScsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIGNlbGxDbG9zZUhhbmRsZXIoZXZlbnQ6IGFueSk6IGFueSB7XHJcblxyXG4gICAgaWYgKHRoaXMuZGlhbG9nU2VyLmhhc0RpYWxvZ09wZW5lZCgpKSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5ydHMpIHtcclxuICAgICAgLy8g5biu5Yqp57uE5Lu25paH5pys5Y+Y5YyW5ZCO5Y675p+l6K+iXHJcbiAgICAgIGlmICh0aGlzLnJ0cy5nZXRGb3JtU3RhdGUoJ2xvb2t1cC5wZW5kaW5nJykpIHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g54K55Ye75biu5Yqp56Gu5a6a5Y+v5Y+W5raI5oyJ6ZKu5ZCO5LiN57uT5p2f5b2T5YmN5Y2V5YWD5qC857yW6L6RXHJcbiAgICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMucnRzLmV2ZW50UGF0aChldmVudC5vcmlnaW5hbEV2ZW50KS5maW5kKG4gPT4gbi50YWdOYW1lID09PSAnRkFSUklTLURJQUxPRycpKSB7XHJcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjb25zdCB7IGZvcm1Hcm91cCwgY29sdW1uLCBkYXRhSXRlbSwgcm93SW5kZXggfSA9IGV2ZW50O1xyXG4gICAgY29uc3QgY29sdW1ucyA9IHRoaXMuZ2V0Q29sdW1ucyh0aGlzLmdyaWRPcHRpb24uZmllbGRzKTtcclxuICAgIGxldCBjdXJyZW50Q29sID0gY29sdW1ucy5maW5kKChlbGVtZW50OiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIGVsZW1lbnQuZGF0YUZpZWxkID09PSBjb2x1bW4uZmllbGQ7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGZvcm1Db250cm9sVmFsdWUgPSBmb3JtR3JvdXBbY3VycmVudENvbC5lZGl0b3IuYmluZGluZy5wYXRoXS52YWx1ZTtcclxuICAgIGlmIChjdXJyZW50Q29sLmdldER5bmFtaWNEYXRhKSB7XHJcbiAgICAgIC8vIOiLpeatpOWIl+aYr+WKqOaAgeWNleWFg+agvOWIl1xyXG4gICAgICBjdXJyZW50Q29sID0gY3VycmVudENvbC5nZXREeW5hbWljRGF0YShkYXRhSXRlbSwgY3VycmVudENvbCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldFZhbHVlKGZvcm1Db250cm9sVmFsdWUsIGN1cnJlbnRDb2wpO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgICAqIOWbnui9piAg5YiH5o2i5Y2V5YWD5qC8XHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg6ZSu55uY5oyJ5LiL5LqL5Lu2XHJcbiAgICAgKi9cclxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcclxuICBlbnRlckNlbGwoZTogYW55KSB7XHJcbiAgICAvLyDlm57ovabplK5cclxuICAgIGlmICghZS5zaGlmdEtleSAmJiBlLmtleUNvZGUgPT09IDEzKSB7XHJcbiAgICAgIC8vIHRleHRhcmVhIGVudGVyIOWxj+iUveaNouihjOaTjeS9nFxyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGlmICghdGhpcy5zZW5kZXIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgLy8g55Sx5LqOa2V5ZG93biDkuovku7bkvJrlhYjmiafooYzvvIzmiYDku6Xov5nph4zlhYjopoHmiafooYxibHVyIOS6i+S7tu+8m1xyXG4gICAgICBlLnRhcmdldC5ibHVyKCk7XHJcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLnJ0cyAmJiB0aGlzLnJ0cy5nZXRGb3JtU3RhdGUoJ2xvb2t1cC5wZW5kaW5nJykpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmVudGVyTmV4dENlbGwoKTtcclxuICAgICAgICB9LCAyMDEpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICAgKiDnu5HlrppncmlkIG9wdGlvblxyXG4gICAgICogQHBhcmFtIGRhdGFJdGVtIOihjOaVsOaNrlxyXG4gICAgICovXHJcbiAgcHJpdmF0ZSBiaW5kaW5nR3JpZE9wdGlvbigpIHtcclxuICAgIGlmICghdGhpcy5mYXJyaXNCaW5kaW5nR3JpZE9wdGlvbikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5ncmlkLCAnZ3JpZE9wdGlvbicsIHsgdmFsdWU6IHRoaXMuZmFycmlzQmluZGluZ0dyaWRPcHRpb24gfSk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIOabtOaWsEdyaWTliIbpobXnirbmgIFcclxuICAgKiBAcGFyYW0gdGFrZVxyXG4gICAqIEBwYXJhbSBza2lwXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVQYWdlcih0YWtlOiBudW1iZXIsIHNraXA6IG51bWJlcikge1xyXG4gICAgaWYgKHRha2UgPT09IDApIHtcclxuICAgICAgdGhpcy5jdXJyZW50U2tpcCA9IDA7XHJcbiAgICAgIHRoaXMucGFnZVNpemUgPSAwO1xyXG4gICAgICB0aGlzLnNraXAgPSAwO1xyXG4gICAgICB0aGlzLmdyaWQucGFnZWFibGUgPSBmYWxzZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3VycmVudFNraXAgPSBza2lwO1xyXG4gICAgICB0aGlzLnNraXAgPSBza2lwO1xyXG4gICAgICB0aGlzLnBhZ2VTaXplID0gdGFrZTtcclxuICAgICAgdGhpcy5ncmlkLnBhZ2VhYmxlID0ge1xyXG4gICAgICAgIGJ1dHRvbkNvdW50OiAxMCxcclxuICAgICAgICBpbmZvOiB0cnVlLFxyXG4gICAgICAgIHR5cGU6ICdudW1lcmljJyxcclxuICAgICAgICBwYWdlU2l6ZXM6IGZhbHNlLFxyXG4gICAgICAgIHByZXZpb3VzTmV4dDogdHJ1ZVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDorr7nva7ljZXlhYPmoLzlj6/nvJbovpHmgKdcclxuICAgKiBAcGFyYW0gZGF0YUl0ZW0g6KGM5pWw5o2uXHJcbiAgICogQHBhcmFtIGNvbHVtbiDliJflr7nosaFcclxuICAgKiBAcGFyYW0gcm93SW5kZXgg6KGM57Si5byVXHJcbiAgICogQHBhcmFtIGNvbHVtbkluZGV4IOWIl+e0ouW8lVxyXG4gICAqIEBwYXJhbSBzZW5kZXIgZ3JpZOWunuS+i1xyXG4gICAqL1xyXG4gIHNldEVkaXRhYmxlKHJvd051bWJlcjogbnVtYmVyLCBjb2x1bW5OdW1iZXI6IG51bWJlcikge1xyXG4gICAgY29uc3QgZGF0YSA9IHRoaXMuZ3JpZC5kYXRhWydkYXRhJ107XHJcbiAgICBjb25zdCB7IHBhZ2VJbmRleCA9IDEsIHBhZ2VTaXplID0gMCB9ID0gdGhpcy5nZXRQYWdpbmdJbmZvKCkgfHwge307XHJcbiAgICBjb25zdCBza2lwID0gdGhpcy5iaW5kaW5nTGlzdC5za2lwO1xyXG4gICAgLy8g5LiN5YiG6aG15oiW6ICF56ys5LiA6aG15pe25Y+W5LiN6ZyA6KaB5L+u5pS56KGM5Y+3XHJcbiAgICBjb25zdCBkYXRhUm93TnVtYmVyID0gcGFnZVNpemUgPT09IDAgfHwgcGFnZUluZGV4ID09PSAxID8gcm93TnVtYmVyIDogcm93TnVtYmVyIC0gc2tpcDtcclxuICAgIGxldCBpdGVtID0gZGF0YVtkYXRhUm93TnVtYmVyXTtcclxuICAgIGlmICh0aGlzLmdyaWRPcHRpb24uZ3JvdXBhYmxlKSB7XHJcbiAgICAgIGl0ZW0gPSB0aGlzLmdldEdyb3VwSXRlbShkYXRhLCBkYXRhUm93TnVtYmVyKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG9yaWdpbkNvbHVtcyA9IHRoaXMuZ2V0Q29sdW1ucyh0aGlzLmdyaWRPcHRpb24uZmllbGRzKTtcclxuICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmdldENvbHVtbnMob3JpZ2luQ29sdW1zKTtcclxuICAgIC8qIOWBh+WmguWIl+eahOmhuuW6j+aUueWPmCDmr5TlpoLlrZjlnKjlm7rlrprliJcgIOmCo+S5iOW6lOivpeiOt+WPluecn+ato+eahOWIl+WvueixoSAqL1xyXG4gICAgLy8gbGV0IGNvbCA9IGNvbHVtbnNbY29sdW1uTnVtYmVyXTtcclxuXHJcbiAgICBsZXQgdGVtcEluZGV4ID0gY29sdW1uTnVtYmVyO1xyXG4gICAgLy8g5b2T5YmN5YiX57Si5byV5LiN5Li6MFxyXG4gICAgaWYgKHRoaXMuZ3JpZFsnZ3JpZE9wdGlvbiddLnNob3dMaW5lTnVtYmVyKSB7XHJcbiAgICAgIHRlbXBJbmRleCA9IHRlbXBJbmRleCAtIDE7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5ncmlkLnNlbGVjdGFibGUgJiYgdGhpcy5ncmlkLnNlbGVjdGFibGVbJ21vZGUnXSA9PT0gJ211bHRpcGxlJykge1xyXG4gICAgICB0ZW1wSW5kZXggPSB0ZW1wSW5kZXggLSAxO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY29sID0gY29sdW1uc1t0ZW1wSW5kZXhdO1xyXG5cclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgZGF0YUl0ZW06IGl0ZW0sXHJcbiAgICAgIGNvbHVtbjogY29sLFxyXG4gICAgICByb3dJbmRleDogcm93TnVtYmVyLFxyXG4gICAgICBjb2x1bW5JbmRleDogdGVtcEluZGV4LFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDmjqfliLbljZXlhYPmoLznmoTlj6/nvJbovpHmgKdcclxuICAgIGlmIChjb2wgJiYgIWNvbC5lZGl0YWJsZSkge1xyXG4gICAgICBjb2wuZWRpdGFibGUgPSAocGFyYW06IG9iamVjdCkgPT4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmIChjb2wgJiYgdGhpcy5ub3RSZWFkT25seShjb2wsIHBhcmFtcykpIHtcclxuICAgICAgLy8g6K6+572u5b2T5YmN6KGMXHJcbiAgICAgIHRoaXMuZGF0YUlkID0gdGhpcy5nZXRTZWxlY3RlZElkRnJvbUdyaWQoaXRlbSk7XHJcbiAgICAgIHRoaXMuc2V0U2VsZWN0aW9uSWRUb0JpbmRpbmdEYXRhKHRoaXMuZGF0YUlkKTtcclxuICAgICAgLy8gY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlKGl0ZW0sIGNvbC5kYXRhRmllbGQpO1xyXG4gICAgICAvLyB0aGlzLnNldFZhbHVlKHZhbHVlLCBjb2wpO1xyXG4gICAgICB0aGlzLnNlbmRlci5lZGl0Q2VsbChyb3dOdW1iZXIsIGNvbHVtbk51bWJlciAtIHRoaXMuaGlkZGVuQ29sTGVuLCB0aGlzLnZpZXdNb2RlbC5mb3JtKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIC8qXHJcbiAg6I635Y+W5pu05pawIHJvd0luZGV4IGNvbHVtbkluZGV4XHJcbiAgICovXHJcbiAgdXBkYXRlSW5kZXgocm93TnVtYmVyOiBudW1iZXIsIGNvbHVtbkluZGV4OiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG5ld0NvbHVtbkluZGV4ID0gKGNvbHVtbkluZGV4ICsgMSkgJSB0aGlzLmxlbjtcclxuICAgIGlmICghbmV3Q29sdW1uSW5kZXgpIHtcclxuICAgICAgY29uc3QgZGF0YUxlbiA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCkubGVuZ3RoO1xyXG4gICAgICBjb25zdCBuZXdSb3dJbmRleCA9IChyb3dOdW1iZXIgKyAxKSAlIGRhdGFMZW47XHJcbiAgICAgIHJldHVybiB7IHJvd0luZGV4OiBuZXdSb3dJbmRleCwgY29sdW1uSW5kZXg6IG5ld0NvbHVtbkluZGV4IH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByb3dJbmRleDogcm93TnVtYmVyLFxyXG4gICAgICBjb2x1bW5JbmRleDogbmV3Q29sdW1uSW5kZXhcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKiDmmK/lkKblj6ror7sgKi9cclxuICBub3RSZWFkT25seShjb2x1bW46IGFueSwgcGFyYW06IGFueSkge1xyXG4gICAgaWYgKCFjb2x1bW4pIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbHVtbi5lZGl0YWJsZShwYXJhbSkgJiYgIWNvbHVtbi5lZGl0b3IucmVhZG9ubHk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgICog57uZ5YiX6KGo6LWL5YC8IOaIlue7mWZvcm1jb250cm9s6LWL5YC8XHJcbiAgICAgICovXHJcbiAgc2V0VmFsdWUodmFsdWU6IGFueSwgY29sdW1uOiBhbnkpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRDb2x1bW5UeXBlID0gY29sdW1uLmRhdGFUeXBlO1xyXG4gICAgLy8g5ZCM5pe25Yik5patZ3JpZE9wdGlvbueahOWIl+WvueixoVxyXG4gICAgY29uc3QgYmluZGluZ0RhdGEgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YTtcclxuICAgIGNvbnN0IGZpZWxkUGF0aHMgPSB0aGlzLmdldEZpZWxkUGF0aHMoYmluZGluZ0RhdGEuYmluZGluZ1BhdGgsIGNvbHVtbi5kYXRhRmllbGQpO1xyXG4gICAgLy8g5a2Y5Zyo6KGM57yW6L6R5ZmoXHJcbiAgICBpZiAoY3VycmVudENvbHVtblR5cGUgPT09ICdkYXRlJykge1xyXG4gICAgICBsZXQgZGF0ZVN0ciA9IHRoaXMuZGF0ZVNlcnZpY2UuZm9ybWF0VG8odmFsdWUsICd5eXl5LU1NLWRkIEhIOm1tOnNzJyk7XHJcbiAgICAgIGlmICghZGF0ZVN0cikge1xyXG4gICAgICAgIGRhdGVTdHIgPSAnJztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5zZXRWYWx1ZShmaWVsZFBhdGhzLCBkYXRlU3RyLCB0cnVlLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLnNldFZhbHVlKGZpZWxkUGF0aHMsIHZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qIOWIhue7hOaXtiDojrflj5bngrnlh7vooYzmlbDmja4gKi9cclxuICBnZXRHcm91cEl0ZW0oZGF0YTogYW55W10sIHJvd051bWJlcjogbnVtYmVyKSB7XHJcbiAgICBsZXQgaW5kZXggPSByb3dOdW1iZXI7XHJcbiAgICBmb3IgKGNvbnN0IGkgaW4gZGF0YSkge1xyXG4gICAgICBpZiAoaW5kZXggPCBkYXRhW2ldLml0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiBkYXRhW2ldLml0ZW1zW2luZGV4XTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpbmRleCA9IGluZGV4IC0gZGF0YVtpXS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog6I635Y+WIOWNleWFg+agvOWAvCAg5Li75LuO6KGo5pSv5oyBXHJcbiAgICogQHBhcmFtIGRhdGFJdGVtIOihjOaVsOaNrlxyXG4gICAqIEBwYXJhbSBmaWVsZCDlrZfmrrVcclxuICAgKi9cclxuICBnZXRWYWx1ZShkYXRhSXRlbTogYW55LCBmaWVsZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IGZpZWxkLmluZGV4T2YoJy4nKTtcclxuICAgIGlmIChpbmRleCA8IDApIHtcclxuICAgICAgcmV0dXJuIGRhdGFJdGVtW2ZpZWxkXTtcclxuICAgIH1cclxuICAgIGNvbnN0IGZpZWxkcyA9IGZpZWxkLnNwbGl0KCcuJyk7XHJcbiAgICAvLyBmaWVsZOWtl+espuS4sue7hOWQiFxyXG4gICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKHJlc3VsdDogYW55LCBuZXh0OiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIHJlc3VsdFtuZXh0XTtcclxuICAgIH0sIGRhdGFJdGVtKTtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgKiDojrflj5YgYmluZGluZ0RhdGEg6Lev5b6EXHJcbiAgKiBAcGFyYW0gYmluZGluZ1BhdGgg5b2T5YmN57uR5a6a55qE5a2X5q616Lev5b6EXHJcbiAgKiBAcGFyYW0gZmllbGROYW1lIOWtl+autVxyXG4gICovXHJcbiAgcHJpdmF0ZSBnZXRGaWVsZFBhdGhzKGJpbmRpbmdQYXRoOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBsZXQgZmllbGRQYXRoID0gJyc7XHJcbiAgICBpZiAoYmluZGluZ1BhdGgubGVuZ3RoID4gMSkge1xyXG4gICAgICBmaWVsZFBhdGggPSBiaW5kaW5nUGF0aC5zdWJzdHIoMSkucmVwbGFjZSgvXFwvL2csICcuJykgKyAnLicgKyBmaWVsZDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZpZWxkUGF0aCA9IGZpZWxkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZpZWxkUGF0aC5zcGxpdCgnLicpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Zue6L2m6L+b5YWl5LiL5LiA5Liq5Y2V5YWD5qC8XHJcbiAgICovXHJcbiAgZW50ZXJOZXh0Q2VsbCgpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy51cGRhdGVJbmRleCh0aGlzLnJvd0luZGV4LCB0aGlzLmNvbHVtbkluZGV4KTtcclxuICAgIGlmICghaW5kZXguY29sdW1uSW5kZXggJiYgIWluZGV4LnJvd0luZGV4KSB7XHJcbiAgICAgIGNvbnN0IGxlbiA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCkubGVuZ3RoO1xyXG4gICAgICAvLyDlpoLmnpzlrZjlnKjmt7vliqDmlbDmja7nmoRBUElcclxuICAgICAgdGhpcy5hcHBlbmRSb3cuZW1pdCgpO1xyXG4gICAgICBpZiAodGhpcy5hcHBlbmRSb3cub2JzZXJ2ZXJzICYmIHRoaXMuYXBwZW5kUm93Lm9ic2VydmVycy5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLmludGVyVmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCkubGVuZ3RoIC0gMSA9PT0gbGVuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RWRpdGFibGUodGhpcy5iaW5kaW5nTGlzdC50b0pTT04oKS5sZW5ndGggLSAxLCAwKTtcclxuICAgICAgICAgICAgdGhpcy5yb3dJbmRleCA9IHRoaXMuYmluZGluZ0xpc3QudG9KU09OKCkubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgdGhpcy5jb2x1bW5JbmRleCA9IDA7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlclZhbCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZXRFZGl0YWJsZShpbmRleC5yb3dJbmRleCwgaW5kZXguY29sdW1uSW5kZXgpO1xyXG4gICAgdGhpcy5yb3dJbmRleCA9IGluZGV4LnJvd0luZGV4O1xyXG4gICAgdGhpcy5jb2x1bW5JbmRleCA9IGluZGV4LmNvbHVtbkluZGV4O1xyXG4gIH1cclxuXHJcbiAgLyog6I635Y+W55yf5q2j55qE5YiX5a+56LGhICovXHJcbiAgZ2V0Q29sdW1ucyhjb2x1bW5zOiBhbnkpIHtcclxuICAgIC8vIOWIpOaWreaYr+WQpuWtmOWcqOWbuuWumuWIl1xyXG4gICAgY29uc3QgaGFzTG9ja2VkID0gY29sdW1ucy5zb21lKChlbGU6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gZWxlLmZyb3plbjtcclxuICAgIH0pO1xyXG4gICAgaWYgKGhhc0xvY2tlZCkge1xyXG4gICAgICBjb25zdCBsb2NrZWRDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoKGVsZTogYW55KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGVsZS5mcm96ZW47XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBub3RMb2NrZWRDb2x1bW5zID0gY29sdW1ucy5maWx0ZXIoKGVsZTogYW55KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICFlbGUuZnJvemVuO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIFsuLi5sb2NrZWRDb2x1bW5zLCAuLi5ub3RMb2NrZWRDb2x1bW5zXTtcclxuICAgIH1cclxuICAgIHJldHVybiBjb2x1bW5zO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDmuLLmn5PmjIflrprooYzkuLrpgInkuK3ooYzvvJrlsIbmjIflrprooYznmoRrZXnmt7vliqDliLDpgInkuK3ooYzpm4blkIjkuK1cclxuICAgKi9cclxuICBwcml2YXRlIHJlbmRlclNlbGVjdGlvblJvdyhrZXk6IHN0cmluZywgc2VsZWN0ZWRLZXlzOiBhbnlbXSkge1xyXG4gICAgaWYgKCFrZXkgfHwga2V5ID09PSAnJykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETzrkvb/nlKjnrZbnlaXmqKHlvI/ph43mnoRcclxuICAgIGlmICh0aGlzLklzTXVsdGlwbGVTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gc2VsZWN0ZWRLZXlzLmluZGV4T2Yoa2V5KTtcclxuICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHNlbGVjdGVkS2V5cy5wdXNoKGtleSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoc2VsZWN0ZWRLZXlzLmxlbmd0aCA9PT0gMSAmJiBzZWxlY3RlZEtleXNbMF0gPT09IGtleSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgc2VsZWN0ZWRLZXlzLnNwbGljZSgwLCBzZWxlY3RlZEtleXMubGVuZ3RoKTtcclxuICAgICAgc2VsZWN0ZWRLZXlzLnB1c2goa2V5KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNlbGVjdGlvbkRpci5zZWxlY3RlZEtleXNDaGFuZ2UuZW1pdChzZWxlY3RlZEtleXMpOyAvLyDmiYvliqjop6blj5FzZWxlY3RlZEtleXNDaGFuZ2Xkuovku7ZcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICog6I635Y+WR3JpZOS4iueahOW9k+WJjeihjOWGheeggVxyXG4gICAqIEBwYXJhbSBkYXRhSXRlbSDooYzmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGdldFNlbGVjdGVkSWRGcm9tR3JpZChkYXRhSXRlbTogYW55KSB7XHJcbiAgICBjb25zdCBwcmltYXJ5S2V5ID0gdGhpcy5iaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gICAgcmV0dXJuIGRhdGFJdGVtW3ByaW1hcnlLZXldO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiDorr7nva5CaW5kaW5nTGlzdOeahOW9k+WJjeihjFxyXG4gICAqIEBwYXJhbSBpZCDlvZPliY3ooYzlhoXnoIFcclxuICAgKi9cclxuICBwcml2YXRlIHNldFNlbGVjdGlvbklkVG9CaW5kaW5nRGF0YShpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLmJpbmRpbmdMaXN0LnNldEN1cnJlbnRJZChpZCwgdHJ1ZSk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICrliJfooajmlbTkvZPmmK/lkKblj6/nvJbovpFcclxuICAgKi9cclxuICBpc0VkaXRhYmxlKCkge1xyXG4gICAgaWYgKHRoaXMuZWRpdGFibGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBpZiAoIXRoaXMudmlld01vZGVsLnN0YXRlTWFjaGluZSkge1xyXG4gICAgICAgIC8vIOeKtuaAgeacuuS4jeWtmOWcqOeahOaXtuWAmVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICAvLyDnirbmgIHmnLrlrZjlnKjnmoTml7blgJlcclxuICAgICAgcmV0dXJuIHRoaXMudmlld01vZGVsLnN0YXRlTWFjaGluZVsnZWRpdGFibGUnXTtcclxuICAgIH1cclxuICAgIC8vIOiHquWumuS5iei1i+WAvFxyXG4gICAgcmV0dXJuIHRoaXMuZWRpdGFibGU7XHJcbiAgfVxyXG4gIC8qICAqL1xyXG4gIGlzRGF0YUNoYW5nZWQoKSB7XHJcbiAgICBsZXQgaGFzVW5zYXZlZERhdGEgPSBmYWxzZTtcclxuICAgIGNvbnN0IGVudGl0eUFycmF5ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCk7XHJcbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBlbnRpdHlBcnJheSkge1xyXG4gICAgICBpZiAoZW50aXR5LmNoYW5nZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGhhc1Vuc2F2ZWREYXRhID0gdHJ1ZTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhhc1Vuc2F2ZWREYXRhO1xyXG4gIH1cclxufVxyXG4iXX0=
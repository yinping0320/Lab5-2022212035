import { Injector, Optional, Pipe } from '@angular/core';
import { DownloadService } from '@gsp-svc/formdoc-upload';
import { BasePathService } from '@farris/rtf';
var ImageIdToUrlPipe = /** @class */ (function () {
    function ImageIdToUrlPipe(injector) {
        this.injector = injector;
        this.defaultPic = BasePathService.convertPath('/platform/common/web/assets/imgs/no-pic.png');
        this.downloadService = this.injector && this.injector.get(DownloadService, null) || null;
    }
    ImageIdToUrlPipe.prototype.transform = function (value, rootId) {
        if (rootId === void 0) { rootId = 'default-root'; }
        if (!value) {
            return this.defaultPic;
        }
        //const rootId = 'default-root';
        if (this.downloadService) {
            return this.downloadService.getDownloadUrl(value, rootId);
        }
        else {
            console.warn('因安全问题，附件下载提供安全校验机制，附件下载功能需重新编译。');
            return BasePathService.convertPath("/api/runtime/dfs/v1.0/formdoc/download/" + value);
        }
    };
    ImageIdToUrlPipe.decorators = [
        { type: Pipe, args: [{ name: 'imageIdToUrl' },] }
    ];
    /** @nocollapse */
    ImageIdToUrlPipe.ctorParameters = function () { return [
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    return ImageIdToUrlPipe;
}());
export { ImageIdToUrlPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtaWQtdG8tdXJsLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvcGlwZXMvaW1hZ2UtaWQtdG8tdXJsLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM5QztJQUlFLDBCQUFnQyxRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBRjFDLGVBQVUsR0FBRyxlQUFlLENBQUMsV0FBVyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFHOUYsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFrQixlQUFlLEVBQUUsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDO0lBQzVHLENBQUM7SUFFRCxvQ0FBUyxHQUFULFVBQVUsS0FBYSxFQUFFLE1BQStCO1FBQS9CLHVCQUFBLEVBQUEsdUJBQStCO1FBQ3RELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7U0FDeEI7UUFDRCxnQ0FBZ0M7UUFDaEMsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3hCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzNEO2FBQU07WUFDTCxPQUFPLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7WUFDaEQsT0FBTyxlQUFlLENBQUMsV0FBVyxDQUFDLDRDQUEwQyxLQUFPLENBQUMsQ0FBQztTQUN2RjtJQUNILENBQUM7O2dCQW5CRixJQUFJLFNBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFOzs7O2dCQUhyQixRQUFRLHVCQU9GLFFBQVE7O0lBZ0J2Qix1QkFBQztDQUFBLEFBcEJELElBb0JDO0FBRUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RvciwgT3B0aW9uYWwsIFBpcGUsIFBpcGVUcmFuc2Zvcm0gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG93bmxvYWRTZXJ2aWNlIH0gZnJvbSAnQGdzcC1zdmMvZm9ybWRvYy11cGxvYWQnO1xyXG5pbXBvcnQgeyBCYXNlUGF0aFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3J0Zic7XHJcbkBQaXBlKHsgbmFtZTogJ2ltYWdlSWRUb1VybCcgfSlcclxuY2xhc3MgSW1hZ2VJZFRvVXJsUGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xyXG4gIHByaXZhdGUgZGVmYXVsdFBpYyA9IEJhc2VQYXRoU2VydmljZS5jb252ZXJ0UGF0aCgnL3BsYXRmb3JtL2NvbW1vbi93ZWIvYXNzZXRzL2ltZ3Mvbm8tcGljLnBuZycpO1xyXG4gIHByaXZhdGUgZG93bmxvYWRTZXJ2aWNlOiBEb3dubG9hZFNlcnZpY2U7XHJcbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgIHRoaXMuZG93bmxvYWRTZXJ2aWNlID0gdGhpcy5pbmplY3RvciAmJiB0aGlzLmluamVjdG9yLmdldDxEb3dubG9hZFNlcnZpY2U+KERvd25sb2FkU2VydmljZSwgbnVsbCkgfHwgbnVsbDtcclxuICB9XHJcblxyXG4gIHRyYW5zZm9ybSh2YWx1ZTogc3RyaW5nLCByb290SWQ6IHN0cmluZyA9ICdkZWZhdWx0LXJvb3QnKTogc3RyaW5nIHtcclxuICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFBpYztcclxuICAgIH1cclxuICAgIC8vY29uc3Qgcm9vdElkID0gJ2RlZmF1bHQtcm9vdCc7XHJcbiAgICBpZiAodGhpcy5kb3dubG9hZFNlcnZpY2UpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZG93bmxvYWRTZXJ2aWNlLmdldERvd25sb2FkVXJsKHZhbHVlLCByb290SWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS53YXJuKCflm6Dlronlhajpl67popjvvIzpmYTku7bkuIvovb3mj5DkvpvlronlhajmoKHpqozmnLrliLbvvIzpmYTku7bkuIvovb3lip/og73pnIDph43mlrDnvJbor5HjgIInKTtcclxuICAgICAgcmV0dXJuIEJhc2VQYXRoU2VydmljZS5jb252ZXJ0UGF0aChgL2FwaS9ydW50aW1lL2Rmcy92MS4wL2Zvcm1kb2MvZG93bmxvYWQvJHt2YWx1ZX1gKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEltYWdlSWRUb1VybFBpcGUgfTtcclxuIl19
import { Inject, Injector, Optional, Pipe } from "@angular/core";
import { UserSettingsToken } from "@farris/devkit";
import { BigNumber } from 'bignumber.js';
import moment from 'moment';
var Localization = /** @class */ (function () {
    function Localization(injector, userSettings) {
        this.injector = injector;
        this.userSettings = userSettings;
    }
    Localization.prototype.transform = function (value, dataType) {
        if (dataType) {
            dataType = dataType.toLowerCase();
            if (dataType === 'date') {
                return this.transformDate(value);
            }
            else if (dataType === 'datetime') {
                return this.transformDateTime(value);
            }
            else if (dataType === 'number') {
                return this.transformNumber(value);
            }
            else {
                return value;
            }
        }
    };
    /**
     * 转换日期
     * @param value value
     */
    Localization.prototype.transformDate = function (value) {
        var dateFormat = this.userSettings && this.userSettings.dateFormat || null;
        if (!dateFormat || !value) {
            return value;
        }
        var date = moment(value);
        var isValid = date.isValid();
        if (!isValid) {
            return value;
        }
        dateFormat = this.parseDateFormat(dateFormat);
        return date.format(dateFormat);
    };
    /**
     * 转换日期时间
     * @param value value
     * todo: 目前无法定义日期时间格式
     */
    Localization.prototype.transformDateTime = function (value) {
        var dateFormat = this.userSettings && this.userSettings.dateFormat || '';
        var timeFormat = this.userSettings && this.userSettings.timeFormat || '';
        var dateTime = moment(value);
        var isValid = dateTime.isValid();
        if (!isValid) {
            return value;
        }
        if (dateFormat) {
            dateFormat = this.parseDateFormat(dateFormat);
        }
        if (timeFormat) {
            timeFormat = this.parseTimeFormat(timeFormat);
        }
        var dateTimeFormat = dateFormat + ' ' + timeFormat;
        return dateTime.format(dateTimeFormat);
    };
    /**
     * 转换数字
     * @param value value
     */
    Localization.prototype.transformNumber = function (value) {
        if (value === null || value === undefined || value === '') {
            return '';
        }
        var bigNumber = new BigNumber(value);
        // 如果不是数字，不做任何处理
        if (!BigNumber.isBigNumber(bigNumber)) {
            return value;
        }
        var isNegative = bigNumber.isNegative();
        var format = this.buildNumberFormat();
        var _a = this.numberFormat, _b = _a.negativeSign, negativeSign = _b === void 0 ? null : _b, _c = _a.numberDecimalDigits, numberDecimalDigits = _c === void 0 ? null : _c;
        if (isNegative) {
            if (negativeSign !== null) {
                format.prefix = negativeSign;
                return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);
            }
        }
        return bigNumber.toFormat(numberDecimalDigits, null, format);
    };
    /**
     * 转换日期格式规则为moment的format规则
     * @param format format
     */
    Localization.prototype.parseDateFormat = function (format) {
        return format.replace(/y/g, 'Y').replace(/d/g, 'D');
    };
    /**
     * 转换时间格式规则为moment的format规则
     * @param format format
     */
    Localization.prototype.parseTimeFormat = function (format) {
        return format.replace(/M/g, 'm');
    };
    /**
     * 构造bignumber数字格式化选项
     */
    Localization.prototype.buildNumberFormat = function () {
        if (this.numberFormat) {
            var _a = this.numberFormat, _b = _a.numberDecimalSeparator, numberDecimalSeparator = _b === void 0 ? null : _b, _c = _a.numberGroupSeparator, numberGroupSeparator = _c === void 0 ? null : _c;
            var format = {
                groupSize: 3,
            };
            if (numberDecimalSeparator !== null) {
                format.decimalSeparator = numberDecimalSeparator;
            }
            if (numberGroupSeparator !== null) {
                format.groupSeparator = numberGroupSeparator;
            }
            return format;
        }
    };
    Object.defineProperty(Localization.prototype, "numberFormat", {
        get: function () {
            return this.userSettings && this.userSettings.numberFormat || null;
        },
        enumerable: true,
        configurable: true
    });
    Localization.decorators = [
        { type: Pipe, args: [{ name: 'localization' },] }
    ];
    /** @nocollapse */
    Localization.ctorParameters = function () { return [
        { type: Injector, decorators: [{ type: Optional }] },
        { type: undefined, decorators: [{ type: Inject, args: [UserSettingsToken,] }] }
    ]; };
    return Localization;
}());
export { Localization };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYWxpemF0aW9uLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2tlbmRvLWJpbmRpbmcvIiwic291cmNlcyI6WyJsaWIvcGlwZXMvbG9jYWxpemF0aW9uLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUE4QixpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9FLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBRTVCO0lBRUUsc0JBQWdDLFFBQWtCLEVBQXFDLFlBQTBCO1FBQWpGLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBcUMsaUJBQVksR0FBWixZQUFZLENBQWM7SUFDakgsQ0FBQztJQUNNLGdDQUFTLEdBQWhCLFVBQWlCLEtBQVUsRUFBRSxRQUFnQjtRQUMzQyxJQUFJLFFBQVEsRUFBRTtZQUNaLFFBQVEsR0FBRyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbEMsSUFBSSxRQUFRLEtBQUssTUFBTSxFQUFFO2dCQUN2QixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDbEM7aUJBQU0sSUFBSSxRQUFRLEtBQUssVUFBVSxFQUFFO2dCQUNsQyxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN0QztpQkFBTSxJQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7Z0JBQ2hDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNwQztpQkFBTTtnQkFDTCxPQUFPLEtBQUssQ0FBQzthQUNkO1NBQ0Y7SUFDSCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssb0NBQWEsR0FBckIsVUFBc0IsS0FBVTtRQUM5QixJQUFJLFVBQVUs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QUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssc0NBQWUsR0FBdkIsVUFBd0IsTUFBYztRQUNwQyxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFDRDs7T0FFRztJQUNLLHdDQUFpQixHQUF6QjtRQUNFLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNmLElBQUEsc0JBQWtGLEVBQWhGLDhCQUE2QixFQUE3QixrREFBNkIsRUFBRSw0QkFBMkIsRUFBM0IsZ0RBQWlELENBQUM7WUFDekYsSUFBTSxNQUFNLEdBQVE7Z0JBQ2xCLFNBQVMsRUFBRSxDQUFDO2FBQ2IsQ0FBQztZQUNGLElBQUksc0JBQXNCLEtBQUssSUFBSSxFQUFFO2dCQUNuQyxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsc0JBQXNCLENBQUM7YUFDbEQ7WUFDRCxJQUFJLG9CQUFvQixLQUFLLElBQUksRUFBRTtnQkFDakMsTUFBTSxDQUFDLGNBQWMsR0FBRyxvQkFBb0IsQ0FBQzthQUM5QztZQUNELE9BQU8sTUFBTSxDQUFDO1NBQ2Y7SUFDSCxDQUFDO0lBQ0Qsc0JBQVksc0NBQVk7YUFBeEI7WUFDRSxPQUFPLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDO1FBQ3JFLENBQUM7OztPQUFBOztnQkFuSEYsSUFBSSxTQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRTs7OztnQkFMYixRQUFRLHVCQU9WLFFBQVE7Z0RBQWdDLE1BQU0sU0FBQyxpQkFBaUI7O0lBa0gvRSxtQkFBQztDQUFBLEFBcEhELElBb0hDO1NBbkhZLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdG9yLCBPcHRpb25hbCwgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IE51bWJlckZvcm1hdCwgVXNlclNldHRpbmdzLCBVc2VyU2V0dGluZ3NUb2tlbiB9IGZyb20gXCJAZmFycmlzL2RldmtpdFwiO1xyXG5pbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnO1xyXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XHJcblxyXG5AUGlwZSh7IG5hbWU6ICdsb2NhbGl6YXRpb24nIH0pXHJcbmV4cG9ydCBjbGFzcyBMb2NhbGl6YXRpb24gaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcclxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgQEluamVjdChVc2VyU2V0dGluZ3NUb2tlbikgcHJpdmF0ZSB1c2VyU2V0dGluZ3M6IFVzZXJTZXR0aW5ncykge1xyXG4gIH1cclxuICBwdWJsaWMgdHJhbnNmb3JtKHZhbHVlOiBhbnksIGRhdGFUeXBlOiBzdHJpbmcpIHtcclxuICAgIGlmIChkYXRhVHlwZSkge1xyXG4gICAgICBkYXRhVHlwZSA9IGRhdGFUeXBlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGlmIChkYXRhVHlwZSA9PT0gJ2RhdGUnKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtRGF0ZSh2YWx1ZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICdkYXRldGltZScpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1EYXRlVGltZSh2YWx1ZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtTnVtYmVyKHZhbHVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5pel5pyfXHJcbiAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB0cmFuc2Zvcm1EYXRlKHZhbHVlOiBhbnkpIHtcclxuICAgIGxldCBkYXRlRm9ybWF0ID0gdGhpcy51c2VyU2V0dGluZ3MgJiYgdGhpcy51c2VyU2V0dGluZ3MuZGF0ZUZvcm1hdCB8fCBudWxsO1xyXG4gICAgaWYgKCFkYXRlRm9ybWF0IHx8ICF2YWx1ZSkge1xyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBkYXRlID0gbW9tZW50KHZhbHVlKTtcclxuICAgIGNvbnN0IGlzVmFsaWQgPSBkYXRlLmlzVmFsaWQoKTtcclxuICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBkYXRlRm9ybWF0ID0gdGhpcy5wYXJzZURhdGVGb3JtYXQoZGF0ZUZvcm1hdCk7XHJcbiAgICByZXR1cm4gZGF0ZS5mb3JtYXQoZGF0ZUZvcm1hdCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouaXpeacn+aXtumXtFxyXG4gICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZVxyXG4gICAqIHRvZG86IOebruWJjeaXoOazleWumuS5ieaXpeacn+aXtumXtOagvOW8j1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdHJhbnNmb3JtRGF0ZVRpbWUodmFsdWU6IGFueSkge1xyXG4gICAgbGV0IGRhdGVGb3JtYXQgPSB0aGlzLnVzZXJTZXR0aW5ncyAmJiB0aGlzLnVzZXJTZXR0aW5ncy5kYXRlRm9ybWF0IHx8ICcnO1xyXG4gICAgbGV0IHRpbWVGb3JtYXQgPSB0aGlzLnVzZXJTZXR0aW5ncyAmJiB0aGlzLnVzZXJTZXR0aW5ncy50aW1lRm9ybWF0IHx8ICcnO1xyXG4gICAgY29uc3QgZGF0ZVRpbWUgPSBtb21lbnQodmFsdWUpO1xyXG4gICAgY29uc3QgaXNWYWxpZCA9IGRhdGVUaW1lLmlzVmFsaWQoKTtcclxuICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBpZiAoZGF0ZUZvcm1hdCkge1xyXG4gICAgICBkYXRlRm9ybWF0ID0gdGhpcy5wYXJzZURhdGVGb3JtYXQoZGF0ZUZvcm1hdCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGltZUZvcm1hdCkge1xyXG4gICAgICB0aW1lRm9ybWF0ID0gdGhpcy5wYXJzZVRpbWVGb3JtYXQodGltZUZvcm1hdCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBkYXRlVGltZUZvcm1hdCA9IGRhdGVGb3JtYXQgKyAnICcgKyB0aW1lRm9ybWF0O1xyXG4gICAgcmV0dXJuIGRhdGVUaW1lLmZvcm1hdChkYXRlVGltZUZvcm1hdCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouaVsOWtl1xyXG4gICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgdHJhbnNmb3JtTnVtYmVyKHZhbHVlKTogc3RyaW5nIHtcclxuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAnJykge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgICBjb25zdCBiaWdOdW1iZXIgPSBuZXcgQmlnTnVtYmVyKHZhbHVlKTtcclxuICAgIC8vIOWmguaenOS4jeaYr+aVsOWtl++8jOS4jeWBmuS7u+S9leWkhOeQhlxyXG4gICAgaWYgKCFCaWdOdW1iZXIuaXNCaWdOdW1iZXIoYmlnTnVtYmVyKSkge1xyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpc05lZ2F0aXZlID0gYmlnTnVtYmVyLmlzTmVnYXRpdmUoKTtcclxuICAgIGNvbnN0IGZvcm1hdCA9IHRoaXMuYnVpbGROdW1iZXJGb3JtYXQoKTtcclxuICAgIGNvbnN0IHsgbmVnYXRpdmVTaWduID0gbnVsbCwgbnVtYmVyRGVjaW1hbERpZ2l0cyA9IG51bGwgfSA9IHRoaXMubnVtYmVyRm9ybWF0O1xyXG4gICAgaWYgKGlzTmVnYXRpdmUpIHtcclxuICAgICAgaWYgKG5lZ2F0aXZlU2lnbiAhPT0gbnVsbCkge1xyXG4gICAgICAgIGZvcm1hdC5wcmVmaXggPSBuZWdhdGl2ZVNpZ247XHJcbiAgICAgICAgcmV0dXJuIGJpZ051bWJlci5hYnNvbHV0ZVZhbHVlKCkudG9Gb3JtYXQobnVtYmVyRGVjaW1hbERpZ2l0cywgbnVsbCwgZm9ybWF0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGJpZ051bWJlci50b0Zvcm1hdChudW1iZXJEZWNpbWFsRGlnaXRzLCBudWxsLCBmb3JtYXQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDovazmjaLml6XmnJ/moLzlvI/op4TliJnkuLptb21lbnTnmoRmb3JtYXTop4TliJlcclxuICAgKiBAcGFyYW0gZm9ybWF0IGZvcm1hdFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcGFyc2VEYXRlRm9ybWF0KGZvcm1hdDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gZm9ybWF0LnJlcGxhY2UoL3kvZywgJ1knKS5yZXBsYWNlKC9kL2csICdEJyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouaXtumXtOagvOW8j+inhOWImeS4um1vbWVudOeahGZvcm1hdOinhOWImVxyXG4gICAqIEBwYXJhbSBmb3JtYXQgZm9ybWF0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwYXJzZVRpbWVGb3JtYXQoZm9ybWF0OiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBmb3JtYXQucmVwbGFjZSgvTS9nLCAnbScpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKBiaWdudW1iZXLmlbDlrZfmoLzlvI/ljJbpgInpoblcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkTnVtYmVyRm9ybWF0KCkge1xyXG4gICAgaWYgKHRoaXMubnVtYmVyRm9ybWF0KSB7XHJcbiAgICAgIGNvbnN0IHsgbnVtYmVyRGVjaW1hbFNlcGFyYXRvciA9IG51bGwsIG51bWJlckdyb3VwU2VwYXJhdG9yID0gbnVsbCB9ID0gdGhpcy5udW1iZXJGb3JtYXQ7XHJcbiAgICAgIGNvbnN0IGZvcm1hdDogYW55ID0ge1xyXG4gICAgICAgIGdyb3VwU2l6ZTogMyxcclxuICAgICAgfTtcclxuICAgICAgaWYgKG51bWJlckRlY2ltYWxTZXBhcmF0b3IgIT09IG51bGwpIHtcclxuICAgICAgICBmb3JtYXQuZGVjaW1hbFNlcGFyYXRvciA9IG51bWJlckRlY2ltYWxTZXBhcmF0b3I7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG51bWJlckdyb3VwU2VwYXJhdG9yICE9PSBudWxsKSB7XHJcbiAgICAgICAgZm9ybWF0Lmdyb3VwU2VwYXJhdG9yID0gbnVtYmVyR3JvdXBTZXBhcmF0b3I7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGZvcm1hdDtcclxuICAgIH1cclxuICB9XHJcbiAgcHJpdmF0ZSBnZXQgbnVtYmVyRm9ybWF0KCk6IE51bWJlckZvcm1hdCB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyU2V0dGluZ3MgJiYgdGhpcy51c2VyU2V0dGluZ3MubnVtYmVyRm9ybWF0IHx8IG51bGw7XHJcbiAgfVxyXG59Il19
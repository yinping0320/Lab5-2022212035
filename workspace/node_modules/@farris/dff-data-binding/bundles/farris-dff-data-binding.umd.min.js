!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@farris/ui-employee-selector"),require("@angular/core"),require("@farris/devkit"),require("@farris/ui-adminorganization-selector")):"function"==typeof define&&define.amd?define("@farris/dff-data-binding",["exports","@farris/ui-employee-selector","@angular/core","@farris/devkit","@farris/ui-adminorganization-selector"],e):e((t.farris=t.farris||{},t.farris["dff-data-binding"]={}),t.uiEmployeeSelector,t.ng.core,t.devkit,t.uiAdminorganizationSelector)}(this,function(t,e,n,r,i){"use strict";var o=(a.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],a.ctorParameters=function(){return[]},a.ngInjectableDef=n.defineInjectable({factory:function(){return new a},token:a,providedIn:"root"}),a);function a(){}var c=(p.prototype.ngOnInit=function(){},p.decorators=[{type:n.Component,args:[{selector:"farris-dff-data-binding",template:"\n    <p>\n      dff-data-binding works!\n    </p>\n  "}]}],p.ctorParameters=function(){return[]},p);function p(){}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(l(arguments[e]));return t}var f=(g.prototype.ngOnInit=function(){var n=this;this.targetComponent.selectionsChange.subscribe(function(t){var e=n.mapFields;t.data&&t.data.length?n.mappingData(t.data,e):n.mappingData(null,e)}),this.targetComponent.inputClear.subscribe(function(){var t=n.mapFields;n.mappingData(null,t)}),this.targetComponent.tagRemoved.subscribe(function(t){var e=n.mapFields;n.tagRemovedMappingData(t.deleteIndex,e)}),this.targetComponent.mapFields||(this.targetComponent.mapFields=this.mapFields)},g.prototype.ngAfterViewInit=function(){},g.prototype.ngOnDestroy=function(){},g.prototype.getFieldBinding=function(){var t=this.targetComponent&&this.targetComponent.ngControl&&this.targetComponent.ngControl,e=t&&t.formDirective&&t.formDirective.form&&t.formDirective.form&&t.formDirective.form.ngFormControls,n=t&&t.name;return e&&e[n]&&e[n].binding},g.prototype.tagRemovedMappingData=function(o,t){var a=this;if(t&&this.targetComponent.ngControl&&this.targetComponent.ngControl.formDirective&&this.targetComponent.ngControl.formDirective.form&&this.targetComponent.ngControl.formDirective.form.bindingData){var c=this.targetComponent.ngControl.formDirective.form.bindingData;if(c.setValue){var e=this.vm.frameContext.appContext;e.changeDetectionController.detach();var n=Object.keys(t),r=n.findIndex(function(t){return"id"===t});n.includes("id")&&0!==r&&(n.splice(r,1),n=s(["id"],n));var p=this.getBindingPathArray(),i=this.mapFields[n[0]].split(","),l=c.getValue(p.concat(i[0]));(!l||l.split(",").length<2)&&n.reverse(),n.forEach(function(t){a.mapFields[t].split(",").forEach(function(t){var e=p.concat(t.split("."));if(a.getFieldBinding()!==t){var n=c.getValue(e);if(n){var r=n.split(",");r.splice(o,1);var i=r.join();i?c.setValue(e,i,!0,!0):c.clearValue(e,!0,!0)}else c.clearValue(e,!0,!0)}})}),e.changeDetectionController.reattach()}}},g.prototype.mappingData=function(i,t){var o=this;if(t){var e=this.vm.frameContext.appContext;e.changeDetectionController.detach();var n=Object.keys(t),r=n.findIndex(function(t){return"id"===t});n.includes("id")&&0!==r&&(n.splice(r,1),n=s(["id"],n)),i||n.reverse(),n.forEach(function(e){var n="";i&&(n=i instanceof Array?i.map(function(t){return o.getValue(e,t)}).join(","):o.getValue(e,i));var r=o.getBindingPathArray();t[e].split(",").forEach(function(t){o.getFieldBinding()!==t&&(i?o.vm.bindingData.setValue(r.concat(t.split(".")),n,!0,!0):o.vm.bindingData.clearValue(r.concat(t.split(".")),!0,!0))})}),e.changeDetectionController.reattach()}},g.prototype.getValue=function(t,e){return-1===t.indexOf(".")?e[t]:t.split(".").reduce(function(t,e){return t[e]},e)},g.prototype.getBindingPathArray=function(){var t=this.vm.bindingPath;return t?t.split("/").filter(function(t){return""!==t}):[]},g.decorators=[{type:n.Directive,args:[{selector:"[employee-selector-data-mapping]"}]}],g.ctorParameters=function(){return[{type:r.ViewModel,decorators:[{type:n.Optional}]},{type:e.EmployeeSelectorComponent,decorators:[{type:n.Optional},{type:n.Self}]},{type:n.Injector}]},g.propDecorators={mapFields:[{type:n.Input}]},g);function g(t,e,n){this.vm=t,this.targetComponent=e,this.injector=n}var d=(u.prototype.ngOnInit=function(){var n=this;this.targetComponent.selectionsChange.subscribe(function(t){var e=n.mapFields;t.selections&&t.selections.length?n.mappingData(t.selections,e):n.mappingData(null,e)}),this.targetComponent.inputClear.subscribe(function(){var t=n.mapFields;n.mappingData(null,t)}),this.targetComponent.tagRemoved.subscribe(function(t){var e=n.mapFields;n.tagRemovedMappingData(t.deleteIndex,e)}),this.targetComponent.mapFields||(this.targetComponent.mapFields=this.mapFields)},u.prototype.ngAfterViewInit=function(){},u.prototype.ngOnDestroy=function(){},u.prototype.getFieldBinding=function(){var t=this.targetComponent&&this.targetComponent.ngControl&&this.targetComponent.ngControl,e=t&&t.formDirective&&t.formDirective.form&&t.formDirective.form&&t.formDirective.form.ngFormControls,n=t&&t.name;return e&&e[n]&&e[n].binding},u.prototype.tagRemovedMappingData=function(o,t){var a=this;if(t&&this.targetComponent.ngControl&&this.targetComponent.ngControl.formDirective&&this.targetComponent.ngControl.formDirective.form&&this.targetComponent.ngControl.formDirective.form.bindingData){var c=this.targetComponent.ngControl.formDirective.form.bindingData;if(c.setValue){var e=this.vm.frameContext.appContext;e.changeDetectionController.detach();var n=Object.keys(t),r=n.findIndex(function(t){return"id"===t});n.includes("id")&&0!==r&&(n.splice(r,1),n=s(["id"],n));var p=this.getBindingPathArray(),i=this.mapFields[n[0]].split(","),l=c.getValue(p.concat(i[0]));(!l||l.split(",").length<2)&&n.reverse(),n.forEach(function(t){a.mapFields[t].split(",").forEach(function(t){var e=p.concat(t.split("."));if(a.getFieldBinding()!==t){var n=c.getValue(e);if(n){var r=n.split(",");r.splice(o,1);var i=r.join();i?c.setValue(e,i,!0,!0):c.clearValue(e,!0,!0)}else c.clearValue(e,!0,!0)}})}),e.changeDetectionController.reattach()}}},u.prototype.mappingData=function(i,t){var o=this;if(t){var e=this.vm.frameContext.appContext;e.changeDetectionController.detach();var n=Object.keys(t),r=n.findIndex(function(t){return"id"===t});n.includes("id")&&0!==r&&(n.splice(r,1),n=s(["id"],n)),i||n.reverse(),n.forEach(function(e){var n="";i&&(n=i instanceof Array?i.map(function(t){return o.getValue(e,t)}).join(","):o.getValue(e,i));var r=o.getBindingPathArray();t[e].split(",").forEach(function(t){o.getFieldBinding()!==t&&(i?o.vm.bindingData.setValue(r.concat(t.split(".")),n,!0,!0):o.vm.bindingData.clearValue(r.concat(t.split(".")),!0,!0))})}),e.changeDetectionController.reattach()}},u.prototype.getValue=function(t,e){return-1===t.indexOf(".")?e[t]:t.split(".").reduce(function(t,e){return t[e]},e)},u.prototype.getBindingPathArray=function(){var t=this.vm.bindingPath;return t?t.split("/").filter(function(t){return""!==t}):[]},u.decorators=[{type:n.Directive,args:[{selector:"[adminorganization-selector-data-mapping]"}]}],u.ctorParameters=function(){return[{type:r.ViewModel,decorators:[{type:n.Optional}]},{type:i.AdminOrganizationSelectorComponent,decorators:[{type:n.Optional},{type:n.Self}]},{type:n.Injector}]},u.propDecorators={mapFields:[{type:n.Input}]},u);function u(t,e,n){this.vm=t,this.targetComponent=e,this.injector=n}var m=(v.decorators=[{type:n.NgModule,args:[{declarations:[c,f,d],imports:[e.EmployeeSelectorModule,i.AdminOrganizationSelectorModule],providers:[],exports:[c,f,d]}]}],v);function v(){}t.DffDataBindingService=o,t.DffDataBindingComponent=c,t.DffDataBindingModule=m,t.EmployeeSelectorDataMappingDirective=f,t.AdminOrganizationSelectorDataMappingDirective=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-dff-data-binding.umd.min.js.map
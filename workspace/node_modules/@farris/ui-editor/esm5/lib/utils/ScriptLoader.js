/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { uuid } from './Utils';
/**
 * @record
 */
export function IStateObj() { }
if (false) {
    /** @type {?} */
    IStateObj.prototype.listeners;
    /** @type {?} */
    IStateObj.prototype.scriptId;
    /** @type {?} */
    IStateObj.prototype.scriptLoaded;
}
/** @type {?} */
var createState = (/**
 * @return {?}
 */
function () {
    return {
        listeners: [],
        scriptId: uuid('tiny-script'),
        scriptLoaded: false
    };
});
var ɵ0 = createState;
// WARNING: interface has both a type and a value, skipping emit
/** @type {?} */
var CreateScriptLoader = (/**
 * @return {?}
 */
function () {
    /** @type {?} */
    var state = createState();
    /** @type {?} */
    var injectScriptTag = (/**
     * @param {?} scriptId
     * @param {?} doc
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    function (scriptId, doc, url, callback) {
        /** @type {?} */
        var scriptTag = doc.createElement('script');
        scriptTag.referrerPolicy = 'origin';
        scriptTag.type = 'application/javascript';
        scriptTag.id = scriptId;
        scriptTag.src = url;
        /** @type {?} */
        var handler = (/**
         * @return {?}
         */
        function () {
            scriptTag.removeEventListener('load', handler);
            callback();
        });
        scriptTag.addEventListener('load', handler);
        if (doc.head) {
            doc.head.appendChild(scriptTag);
        }
    });
    /** @type {?} */
    var load = (/**
     * @param {?} doc
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    function (doc, url, callback) {
        if (state.scriptLoaded) {
            callback();
        }
        else {
            state.listeners.push(callback);
            if (!doc.getElementById(state.scriptId)) {
                injectScriptTag(state.scriptId, doc, url, (/**
                 * @return {?}
                 */
                function () {
                    state.listeners.forEach((/**
                     * @param {?} fn
                     * @return {?}
                     */
                    function (fn) { return fn(); }));
                    state.scriptLoaded = true;
                }));
            }
        }
    });
    // Only to be used by tests.
    /** @type {?} */
    var reinitialize = (/**
     * @return {?}
     */
    function () {
        state = createState();
    });
    return {
        load: load,
        reinitialize: reinitialize
    };
});
var ɵ1 = CreateScriptLoader;
/** @type {?} */
var ScriptLoader = CreateScriptLoader();
export { ScriptLoader };
export { ɵ0, ɵ1 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2NyaXB0TG9hZGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdXRpbHMvU2NyaXB0TG9hZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDOzs7O0FBRy9CLCtCQUlDOzs7SUFIQyw4QkFBd0I7O0lBQ3hCLDZCQUFpQjs7SUFDakIsaUNBQXNCOzs7SUFHbEIsV0FBVzs7O0FBQUc7SUFDbEIsT0FBTztRQUNMLFNBQVMsRUFBRSxFQUFFO1FBQ2IsUUFBUSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDN0IsWUFBWSxFQUFFLEtBQUs7S0FDcEIsQ0FBQztBQUNKLENBQUMsQ0FBQTs7OztJQU9LLGtCQUFrQjs7O0FBQUc7O1FBQ3JCLEtBQUssR0FBYyxXQUFXLEVBQUU7O1FBRTlCLGVBQWU7Ozs7Ozs7SUFBRyxVQUFDLFFBQWdCLEVBQUUsR0FBYSxFQUFFLEdBQVcsRUFBRSxRQUFvQjs7WUFDbkYsU0FBUyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO1FBQzdDLFNBQVMsQ0FBQyxjQUFjLEdBQUcsUUFBUSxDQUFDO1FBQ3BDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsd0JBQXdCLENBQUM7UUFDMUMsU0FBUyxDQUFDLEVBQUUsR0FBRyxRQUFRLENBQUM7UUFDeEIsU0FBUyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7O1lBRWQsT0FBTzs7O1FBQUc7WUFDZCxTQUFTLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQy9DLFFBQVEsRUFBRSxDQUFDO1FBQ2IsQ0FBQyxDQUFBO1FBQ0QsU0FBUyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM1QyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUU7WUFDWixHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNqQztJQUNILENBQUMsQ0FBQTs7UUFFSyxJQUFJOzs7Ozs7SUFBRyxVQUFDLEdBQWEsRUFBRSxHQUFXLEVBQUUsUUFBb0I7UUFDNUQsSUFBSSxLQUFLLENBQUMsWUFBWSxFQUFFO1lBQ3RCLFFBQVEsRUFBRSxDQUFDO1NBQ1o7YUFBTTtZQUNMLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDdkMsZUFBZSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUc7OztnQkFBRTtvQkFDeEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPOzs7O29CQUFDLFVBQUMsRUFBRSxJQUFLLE9BQUEsRUFBRSxFQUFFLEVBQUosQ0FBSSxFQUFDLENBQUM7b0JBQ3RDLEtBQUssQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2dCQUM1QixDQUFDLEVBQUMsQ0FBQzthQUNKO1NBQ0Y7SUFDSCxDQUFDLENBQUE7OztRQUdLLFlBQVk7OztJQUFHO1FBQ25CLEtBQUssR0FBRyxXQUFXLEVBQUUsQ0FBQztJQUN4QixDQUFDLENBQUE7SUFFRCxPQUFPO1FBQ0wsSUFBSSxNQUFBO1FBQ0osWUFBWSxjQUFBO0tBQ2IsQ0FBQztBQUNKLENBQUMsQ0FBQTs7O0lBRUssWUFBWSxHQUFHLGtCQUFrQixFQUFFO0FBRXpDLE9BQU8sRUFDTCxZQUFZLEVBQ2IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHV1aWQgfSBmcm9tICcuL1V0aWxzJztcclxuXHJcbmV4cG9ydCB0eXBlIGNhbGxiYWNrRm4gPSAoKSA9PiB2b2lkO1xyXG5leHBvcnQgaW50ZXJmYWNlIElTdGF0ZU9iaiB7XHJcbiAgbGlzdGVuZXJzOiBjYWxsYmFja0ZuW107XHJcbiAgc2NyaXB0SWQ6IHN0cmluZztcclxuICBzY3JpcHRMb2FkZWQ6IGJvb2xlYW47XHJcbn1cclxuXHJcbmNvbnN0IGNyZWF0ZVN0YXRlID0gKCk6IElTdGF0ZU9iaiA9PiB7XHJcbiAgcmV0dXJuIHtcclxuICAgIGxpc3RlbmVyczogW10sXHJcbiAgICBzY3JpcHRJZDogdXVpZCgndGlueS1zY3JpcHQnKSxcclxuICAgIHNjcmlwdExvYWRlZDogZmFsc2VcclxuICB9O1xyXG59O1xyXG5cclxuaW50ZXJmYWNlIFNjcmlwdExvYWRlciB7XHJcbiAgbG9hZDogKGRvYzogRG9jdW1lbnQsIHVybDogc3RyaW5nLCBjYWxsYmFjazogY2FsbGJhY2tGbikgPT4gdm9pZDtcclxuICByZWluaXRpYWxpemU6ICgpID0+IHZvaWQ7XHJcbn1cclxuXHJcbmNvbnN0IENyZWF0ZVNjcmlwdExvYWRlciA9ICgpOiBTY3JpcHRMb2FkZXIgPT4ge1xyXG4gIGxldCBzdGF0ZTogSVN0YXRlT2JqID0gY3JlYXRlU3RhdGUoKTtcclxuXHJcbiAgY29uc3QgaW5qZWN0U2NyaXB0VGFnID0gKHNjcmlwdElkOiBzdHJpbmcsIGRvYzogRG9jdW1lbnQsIHVybDogc3RyaW5nLCBjYWxsYmFjazogY2FsbGJhY2tGbikgPT4ge1xyXG4gICAgY29uc3Qgc2NyaXB0VGFnID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xyXG4gICAgc2NyaXB0VGFnLnJlZmVycmVyUG9saWN5ID0gJ29yaWdpbic7XHJcbiAgICBzY3JpcHRUYWcudHlwZSA9ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JztcclxuICAgIHNjcmlwdFRhZy5pZCA9IHNjcmlwdElkO1xyXG4gICAgc2NyaXB0VGFnLnNyYyA9IHVybDtcclxuXHJcbiAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICBzY3JpcHRUYWcucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZCcsIGhhbmRsZXIpO1xyXG4gICAgICBjYWxsYmFjaygpO1xyXG4gICAgfTtcclxuICAgIHNjcmlwdFRhZy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgaGFuZGxlcik7XHJcbiAgICBpZiAoZG9jLmhlYWQpIHtcclxuICAgICAgZG9jLmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBsb2FkID0gKGRvYzogRG9jdW1lbnQsIHVybDogc3RyaW5nLCBjYWxsYmFjazogY2FsbGJhY2tGbikgPT4ge1xyXG4gICAgaWYgKHN0YXRlLnNjcmlwdExvYWRlZCkge1xyXG4gICAgICBjYWxsYmFjaygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3RhdGUubGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xyXG4gICAgICBpZiAoIWRvYy5nZXRFbGVtZW50QnlJZChzdGF0ZS5zY3JpcHRJZCkpIHtcclxuICAgICAgICBpbmplY3RTY3JpcHRUYWcoc3RhdGUuc2NyaXB0SWQsIGRvYywgdXJsLCAoKSA9PiB7XHJcbiAgICAgICAgICBzdGF0ZS5saXN0ZW5lcnMuZm9yRWFjaCgoZm4pID0+IGZuKCkpO1xyXG4gICAgICAgICAgc3RhdGUuc2NyaXB0TG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8vIE9ubHkgdG8gYmUgdXNlZCBieSB0ZXN0cy5cclxuICBjb25zdCByZWluaXRpYWxpemUgPSAoKSA9PiB7XHJcbiAgICBzdGF0ZSA9IGNyZWF0ZVN0YXRlKCk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGxvYWQsXHJcbiAgICByZWluaXRpYWxpemVcclxuICB9O1xyXG59O1xyXG5cclxuY29uc3QgU2NyaXB0TG9hZGVyID0gQ3JlYXRlU2NyaXB0TG9hZGVyKCk7XHJcblxyXG5leHBvcnQge1xyXG4gIFNjcmlwdExvYWRlclxyXG59OyJdfQ==
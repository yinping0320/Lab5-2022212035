!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@farris/ui-common"),require("@angular/forms"),require("@angular/core"),require("@angular/common"),require("@farris/ui-locale"),require("@farris/ui-input-group")):"function"==typeof define&&define.amd?define("@farris/ui-language-textbox",["exports","rxjs","@farris/ui-common","@angular/forms","@angular/core","@angular/common","@farris/ui-locale","@farris/ui-input-group"],t):t((e.farris=e.farris||{},e.farris["ui-language-textbox"]={}),e.rxjs,e.uiCommon,e.ng.forms,e.ng.core,e.ng.common,e.uiLocale,e.uiInputGroup)}(this,function(e,t,u,n,o,i,c,a){"use strict";var r=function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},h=(s.prototype.setActivePane=function(e){this.activePane&&this.activePane!=e&&(this.activePane.hideDropDownPanel(),this.activePane=null),this.activePane=e},s.prototype.hide=function(){this.hide$.next()},s.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[]},s.ngInjectableDef=o.defineInjectable({factory:function(){return new s},token:s,providedIn:"root"}),s);function s(){this.activePane=null,this.hide$=new t.Subject}var l=(p.prototype.onEnterHandler=function(e){this.onItemClick(e)},p.prototype.onEscHandler=function(e){this.hide(e)},p.prototype.ngOnInit=function(){var t=this;this.ngzone.runOutsideAngular(function(){t.panelClickHandler=t.render.listen(t.el.nativeElement,"click",function(e){return e&&e.stopPropagation(),t.inputRef&&t.inputRef.lts.hide(),!1})})},p.prototype.ngOnDestroy=function(){this.opened=!1,this.panelClickHandler&&this.panelClickHandler()},p.prototype.getPositionStyles=function(){return{left:this.left+"px",top:this.top+"px",width:this.width+"px"}},p.prototype.getPanelDivElement=function(){return this.el.nativeElement.querySelector(".language-textbox-panel")},p.prototype.resetPanelPosition=function(){var e=this.getPanelDivElement();if(e){var t=e.offsetHeight,n=this.inputRef.input.el.nativeElement.getBoundingClientRect(),i=window.innerHeight,o=n.top;i-o-n.height<t?o-=t:o+=n.height,o+=document.body.scrollTop||document.documentElement.scrollTop,e.style.top=o+"px"}return e},p.prototype.setInputFocus=function(){var t=this,e=this.getPanelDivElement();if(e){var n=e.querySelector("input");if(this.currentItem&&(!this.languageInputRef||this.languageInputRef.autoFocus)){var i=this.items.findIndex(function(e){return e.code===t.currentItem.code});-1<i&&(n=e.querySelectorAll("input")[i])}n&&n.focus()}},p.prototype.show=function(e){var n=this;return this.inputRef=e,this.render.setStyle(document.body,"overflow","hidden"),this.opened=!0,this.cd&&this.cd.detectChanges(),setTimeout(function(){var e=n.resetPanelPosition();if(e){var t=!0;e.addEventListener("transitionend",function(e){e.target===e.currentTarget&&t&&(t=!1,n.showPanel.emit(n))},!1),n.render.addClass(e,"f-area-show")}}),t.of({element:this.el})},p.prototype.hide=function(e){if(this.opened=!1,this.getPanelDivElement(),this.render.removeStyle(document.body,"overflow"),this.hidePanel.emit(),e)return e.stopPropagation(),!1},p.prototype.onItemClick=function(e){return this.itemClick.emit(this.data),e.stopPropagation(),!1},p.prototype.inputClick=function(e){return e.stopPropagation(),!1},p.decorators=[{type:o.Component,args:[{selector:"language-textbox-panel",template:'\n        <div *ngIf="opened" class="language-textbox-panel f-area-hide" [ngStyle]="getPositionStyles()" (click)="inputClick($event)">\n            <ul class="list-group">\n                <li class="list-group-item border-0 p-2 px-2"  *ngFor="let item of items">\n                    <div class="farris-group-wrap form-inline farris-form-inline">\n                        <div class="form-group farris-form-group">\n                            <label for="hpinput01" class="col-form-label">\n                                <span class="farris-label-text" [attr.title]="\'languageLabel.\'+item.code | locale: item.name">\n                                    {{ \'languageLabel.\'+item.code | locale: item.name }}</span>\n                            </label>\n                            <div class="farris-input-wrap">\n                                <input type="input" (click)="inputClick($event)" maxlength="{{maxWords? maxWords[item.code] : \'\'}}" [(ngModel)]="data[item.code]" class="form-control">\n                            </div>\n                        </div>\n                    </div>\n                </li>\n                <li class="list-group-item border-0 p-2 px-3 text-right">\n                    <button class="btn btn-secondary mr-2" (click)="hide($event)">{{ \'languageLabel.cancel\'| locale: \'取消\' }}</button>\n                    <button class="btn btn-primary" (click)="onItemClick($event)">{{ \'languageLabel.ok\'| locale: \'确定\' }}</button>\n                </li>\n            </ul>\n        </div>\n    ',encapsulation:o.ViewEncapsulation.None,styles:[".language-textbox-panel {\n            overflow: hidden;\n            overflow-y: auto;\n            padding: 5px;\n            position: absolute;\n            z-index: 99999;\n            background: white;\n            box-shadow: 2px 2px 5px #c6c6c6;\n        }\n\n        .language-textbox-panel .dropdown-menu {\n            left: -5px;\n            box-shadow: 0px 3px 6px 0px rgba(0, 0, 0, 0.37);\n            position: relative;\n        }\n\n        .language-selected {\n            background-color: #1890ff!important;\n            color: #fff;\n        }\n        "]}]}],p.ctorParameters=function(){return[{type:o.ElementRef},{type:o.NgZone},{type:o.Injector},{type:o.Renderer2}]},p.propDecorators={opened:[{type:o.Input}],left:[{type:o.Input}],top:[{type:o.Input}],width:[{type:o.Input}],height:[{type:o.Input}],items:[{type:o.Input}],data:[{type:o.Input}],maxWords:[{type:o.Input}],itemClick:[{type:o.Output}],hidePanel:[{type:o.Output}],showPanel:[{type:o.Output}],onEnterHandler:[{type:o.HostListener,args:["document:keydown.enter",["$event"]]}],onEscHandler:[{type:o.HostListener,args:["document:keydown.esc",["$event"]]}]},p);function p(e,t,n,i){this.el=e,this.ngzone=t,this.injector=n,this.render=i,this.opened=!1,this.width=365,this.height=200,this.items=[],this.data={},this.maxWords=null,this.itemClick=new o.EventEmitter,this.hidePanel=new o.EventEmitter,this.showPanel=new o.EventEmitter,this.currentItem=undefined,this.languageInputRef=null,this.panelClickHandler=undefined,this.cd=this.injector.get(o.ChangeDetectorRef)}var g={provide:n.NG_VALUE_ACCESSOR,useExisting:o.forwardRef(function(){return d}),multi:!0},d=(f.prototype.ngOnInit=function(){var t=this;this.editable||(this.editable=this.languages&&this.languages.length&&1===this.languages.length),this.bindLanguageInfo(this.languages),this.onTextBoxclickHandler=this.renderer.listen(this.input.textbox.nativeElement,"click",function(e){e.stopPropagation(),t.editable?t.hideDropDownPanel():t.comboPanelRef||t.showDropDownPanel()}),this.ngCtrl=this.injector.get(n.NgControl,null),this.registerKeyDown()},f.prototype.ngOnChanges=function(e){e.languages&&!e.languages.isFirstChange()&&(this.bindLanguageInfo(e.languages.currentValue),this.setValue())},f.prototype.bindLanguageInfo=function(e){if(e&&e.length)if(this.currentLanguage)this.currentLanguageItem=this.getLanguageItem(this.currentLanguage);else{var t=this.localeService.localeId;if(t){var n=e.find(function(e){return e.code===t});n?(this.currentLanguage=n.code,this.currentLanguageItem=n):e.length&&(this.currentLanguage=e[0].code,this.currentLanguageItem=e[0])}else this.debugSer&&this.debugSer.warn("当前上下文环境未取到语言代码。")}else this.debugSer&&this.debugSer.warn("Please set  the '[languages]' data.")},f.prototype.ngOnDestroy=function(){this.onKeyDownHandler&&this.onKeyDownHandler(),this.hideDropDownPanel(),this.onTextBoxclickHandler&&this.onTextBoxclickHandler()},f.prototype.registerKeyDown=function(){var e=this.input.textbox.nativeElement;this.onKeyDownHandler=this.renderer.listen(e,"keydown",this.onKeyDown.bind(this))},f.prototype.onKeyDown=function(e){var t=this;if(e){e.stopPropagation();var n=e.keyCode;if(113===n&&this.showDropDownPanel(),38!==n&&40!==n)return;var i=this.languages.findIndex(function(e){return e.code===t.currentLanguageItem.code});switch(n){case 38:this.currentLanguageItem=0===i?this.languages[this.languages.length-1]:this.languages[i-1],this.currentLanguage=this.currentLanguageItem.code;break;case 40:i===this.languages.length-1?this.currentLanguageItem=this.languages[0]:this.currentLanguageItem=this.languages[i+1],this.currentLanguage=this.currentLanguageItem.code}this.setValue(),this.cd.markForCheck(),this.cd.detectChanges(),setTimeout(function(){t.input.setFocusToEnd()})}},f.prototype.onFocus=function(e){e.stopPropagation(),this.openOnFocus&&this.showDropDownPanel()},f.prototype.onBlur=function(e){e.stopPropagation()},f.prototype.onIconClick=function(e){return e.originalEvent&&(e.originalEvent.stopPropagation(),e.originalEvent.preventDefault()),this.comboPanelRef||this.showDropDownPanel(),!1},f.prototype.getCliecntRect=function(){var e=this.input.el.nativeElement.getBoundingClientRect(),t=window.innerWidth,n=window.innerHeight,i=e.left;t-i<this.panelWidth&&(i=i+e.width-this.panelWidth);var o=e.top;return n-o<this.panelHeight?o-=e.height:o+=e.height,{left:i,top:o,height:this.panelHeight,width:this.panelWidth}},f.prototype.updateLangOrder=function(){var i=this,o=-1,e=this.languages.find(function(e,t){var n=e.code===i.localeService.localeId;return n&&(o=t),n});if(e){var t=Object.assign({},e);this.languages.splice(o,1),this.languages.unshift(t)}},f.prototype.showDropDownPanel=function(){var t=this;if(this.languages&&1!==this.languages.length&&!this.readonly&&!this.disabled)if(this.comboPanelRef)this.hideDropDownPanel();else{var e=this.cfr.resolveComponentFactory(l);this.comboPanelRef=e.create(this.injector),this.applicationRef.attachView(this.comboPanelRef.hostView),Object.assign(this.comboPanelRef.instance,this.getCliecntRect());var n=this.comboPanelRef.location.nativeElement;document.body.appendChild(n),this.renderer.addClass(n,"overlay-pane"),this.renderer.setStyle(n,"z-index","99999999"),this.renderer.setStyle(n,"left","0"),this.renderer.setStyle(n,"top","0"),this.updateLangOrder(),this.comboPanelRef.instance.items=this.languages,(this.comboPanelRef.instance.languageInputRef=this).comboPanelRef.instance.data=r({},this.data),this.comboPanelRef.instance.currentItem=this.currentLanguageItem,this.comboPanelRef.instance.maxWords=this.maxWords,this.comboPanelRef.instance.itemClick.subscribe(function(e){t.data=r({},e),t.hideDropDownPanel(),t.setValue()}),this.comboPanelRef.instance.hidePanel.subscribe(function(){t.hideDropDownPanel()}),this.comboPanelRef.instance.showPanel.subscribe(function(e){e.setInputFocus()}),this.comboPanelRef.instance.show(this),this.lts.setActivePane(this),this.overLayService.registerMouseEvent(n,function(e){n.contains(e.target)||t.hideDropDownPanel()})}},f.prototype.getLanguageItem=function(t){return this.languages.find(function(e){return e.code===t})},f.prototype.onClear=function(){},f.prototype.onChanges=function(e){this.data[this.currentLanguage]=this.value,this.onModelChange(r({},this.data)),this.onModelTouched(r({},this.data))},f.prototype.setValue=function(){this.data?this.value=this.data[this.currentLanguage]||"":this.value="",this.onChanges(),this.cd.detectChanges()},f.prototype.hideDropDownPanel=function(){var e=this;if(this.renderer.removeStyle(document.body,"overflow"),this.comboPanelRef&&this.comboPanelRef.instance){this.comboPanelRef.instance.opened=!1;var t=this.comboPanelRef.location.nativeElement;t.parentNode&&(this.overLayService&&this.overLayService.destory(t),t.parentNode.removeChild(t)),this.ngZone.runOutsideAngular(function(){e.input.focus(),setTimeout(function(){e.comboPanelRef&&(e.comboPanelRef.destroy(),e.comboPanelRef=null)},100)})}},f.prototype.writeValue=function(e){e&&Object.keys(e).length?(this.data=e,this.value=e[this.currentLanguage]):(this.data={},this.value=""),this.cd.detectChanges()},f.prototype.registerOnChange=function(e){this.onModelChange=e},f.prototype.registerOnTouched=function(e){this.onModelTouched=e},f.prototype.setDisabledState=function(e){this.disabled=e},f.decorators=[{type:o.Component,args:[{selector:"language-textbox",template:'\n        <input-group #input\n            [customCls] = "\'farris-language-textbox\'"\n            [groupText]="groupIcon"\n            [disabled]="disabled"\n            [readonly]="readonly"\n            [editable]="editable"\n            [(ngModel)]="value"\n            [enableClear]="false"\n            [value]="value"\n            (valueChange)="onChanges($event)"\n            (clear)="onClear()"\n            (clickHandle)="onIconClick($event)"\n            (focusHandle)="onFocus($event)"\n        >\n        </input-group>\n    ',providers:[g],encapsulation:o.ViewEncapsulation.None,styles:["\n        .farris-language-textbox .input-group-text {\n            padding-right: 3px;\n        }\n        .farris-language-textbox .input-group-text .language-text {\n            padding-right: 3px;\n        }\n        "]}]}],f.ctorParameters=function(){return[{type:o.ElementRef},{type:o.ComponentFactoryResolver},{type:o.Injector},{type:o.NgZone},{type:o.ApplicationRef},{type:o.Renderer2},{type:n.RequiredValidator,decorators:[{type:o.Optional},{type:o.Self}]},{type:o.ChangeDetectorRef}]},f.propDecorators={disabled:[{type:o.Input}],readonly:[{type:o.Input}],editable:[{type:o.Input}],enableClear:[{type:o.Input}],languages:[{type:o.Input}],currentLanguage:[{type:o.Input}],panelHeight:[{type:o.Input}],panelWidth:[{type:o.Input}],maxWords:[{type:o.Input}],autoFocus:[{type:o.Input}],input:[{type:o.ViewChild,args:["input"]}],openOnFocus:[{type:o.Input}]},f);function f(e,t,n,i,o,a,r,s){var l=this;this.el=e,this.cfr=t,this.injector=n,this.ngZone=i,this.applicationRef=o,this.renderer=a,this.requiredValidator=r,this.cd=s,this.disabled=!1,this.readonly=!1,this.editable=!1,this.enableClear=!1,this.languages=[],this.panelHeight=260,this.panelWidth=365,this.maxWords=null,this.autoFocus=!0,this.openOnFocus=!0,this.groupIcon='<span class="f-icon f-icon-yxs_earth"></span>',this.currentLanguageItem=undefined,this.data={},this.value="",this.onTextBoxclickHandler=null,this.lts=null,this.overLayService=null,this.onModelChange=function(e){},this.onModelTouched=function(e){},this.debugSer=null,this.localeService=this.injector.get(c.LocaleService),this.lts=this.injector.get(h,null),this.debugSer=this.injector.get(u.DebugService,null),this.lts||(this.lts=new h),this.lts.hide$.subscribe(function(e){l.hideDropDownPanel()}),this.overLayService=this.injector.get(u.OverLayHiddenService,null),this.overLayService||(this.overLayService=new u.OverLayHiddenService)}var m=(y.decorators=[{type:o.NgModule,args:[{declarations:[d,l],imports:[i.CommonModule,n.FormsModule,a.InputGroupModule,c.LocaleModule.forRoot()],exports:[d],providers:[],entryComponents:[l]}]}],y);function y(){}e.LanguageTextPanelComponent=l,e.LANGUAGE_TEXTBOX_VALUE_ACCESSOR=g,e.LanguageTextboxComponent=d,e.LanguageTextboxModule=m,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-language-textbox.umd.min.js.map
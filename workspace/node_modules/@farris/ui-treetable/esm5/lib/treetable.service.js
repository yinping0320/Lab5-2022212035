/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
var TreetableService = /** @class */ (function () {
    function TreetableService() {
        this.selectionSource = new Subject();
        this.dblClickSource = new Subject();
        this.changeCheckboxStatus = new Subject();
        this.removeNode = new Subject();
        this.insertNode = new Subject();
        this.updateNode = new Subject();
        this.selectionSource$ = this.selectionSource.asObservable();
        this.dblClickSource$ = this.dblClickSource.asObservable();
        this.changeCheckboxStatus$ = this.changeCheckboxStatus.asObservable();
        this.insertNode$ = this.insertNode.asObservable();
        this.removeNode$ = this.removeNode.asObservable();
        this.updateNode$ = this.updateNode.asObservable();
    }
    /**
     * @param {?=} selected
     * @return {?}
     */
    TreetableService.prototype.onSelectionChange = /**
     * @param {?=} selected
     * @return {?}
     */
    function (selected) {
        this.selectionSource.next(selected);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onDblClick = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.dblClickSource.next(rowNode);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onChangeCheckboxStatus = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.changeCheckboxStatus.next(rowNode);
    };
    /**
     * @param {?} treeNode
     * @param {?=} parent
     * @return {?}
     */
    TreetableService.prototype.onInsert = /**
     * @param {?} treeNode
     * @param {?=} parent
     * @return {?}
     */
    function (treeNode, parent) {
        this.insertNode.next(treeNode);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onRemove = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.removeNode.next(rowNode);
    };
    /**
     * @param {?} rowNode
     * @return {?}
     */
    TreetableService.prototype.onUpdate = /**
     * @param {?} rowNode
     * @return {?}
     */
    function (rowNode) {
        this.updateNode.next(rowNode);
    };
    /**
     * @param {?} col
     * @param {?} tt
     * @return {?}
     */
    TreetableService.prototype.columnIsVisible = /**
     * @param {?} col
     * @param {?} tt
     * @return {?}
     */
    function (col, tt) {
        if (col.visible === undefined) {
            return true;
        }
        if (typeof col.visible === 'function') {
            return col.visible(tt);
        }
        return col.visible;
    };
    /**
     * @param {?} columns
     * @param {?} tt
     * @return {?}
     */
    TreetableService.prototype.checkColumnsForGroupHeader = /**
     * @param {?} columns
     * @param {?} tt
     * @return {?}
     */
    function (columns, tt) {
        /** @type {?} */
        var _columns = [];
        if (columns && columns.length) {
            _columns = this.getDataColumns(columns);
        }
        return {
            columns: _columns
        };
    };
    /**
     * @private
     * @param {?} cols
     * @param {?} length
     * @return {?}
     */
    TreetableService.prototype.getDataFields = /**
     * @private
     * @param {?} cols
     * @param {?} length
     * @return {?}
     */
    function (cols, length) {
        /** @type {?} */
        var i = 0;
        /** @type {?} */
        var j = 0;
        cols.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var colspan = n.colspan || 1;
            if (i + colspan <= length) {
                i += colspan;
                j++;
            }
        }));
        return cols.splice(0, j);
    };
    /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    TreetableService.prototype.getDataColumns = /**
     * @private
     * @param {?} cols
     * @return {?}
     */
    function (cols) {
        var _this = this;
        if (!cols || !cols.length) {
            return [];
        }
        /** @type {?} */
        var fields = [];
        var _loop_1 = function (i) {
            /** @type {?} */
            var _cols = cols[i];
            if (cols[i] && !cols[i].length) {
                _cols = tslib_1.__spread(fields);
                fields = [];
            }
            _cols.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                if (!n.field && n.colspan && n.colspan > 1) {
                    if (n['halign']) {
                        n.hAlign = n['halign'];
                    }
                    _this.getDataFields(cols[i + 1], n.colspan).forEach((/**
                     * @param {?} d
                     * @return {?}
                     */
                    function (d) {
                        if (!fields.includes((/**
                         * @param {?} f
                         * @return {?}
                         */
                        function (f) { return f.field === d.field; }))) {
                            fields.push(d);
                        }
                    }));
                }
                else {
                    if (!fields.includes((/**
                     * @param {?} f
                     * @return {?}
                     */
                    function (f) { return f.field === n.field; }))) {
                        fields.push(n);
                    }
                }
            }));
        };
        for (var i = 0; i < cols.length; i++) {
            _loop_1(i);
        }
        return fields.filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return !n.colspan || n.colspan === 1; }));
    };
    TreetableService.decorators = [
        { type: Injectable }
    ];
    return TreetableService;
}());
export { TreetableService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.selectionSource;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.dblClickSource;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.changeCheckboxStatus;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.removeNode;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.insertNode;
    /**
     * @type {?}
     * @private
     */
    TreetableService.prototype.updateNode;
    /** @type {?} */
    TreetableService.prototype.selectionSource$;
    /** @type {?} */
    TreetableService.prototype.dblClickSource$;
    /** @type {?} */
    TreetableService.prototype.changeCheckboxStatus$;
    /** @type {?} */
    TreetableService.prototype.insertNode$;
    /** @type {?} */
    TreetableService.prototype.removeNode$;
    /** @type {?} */
    TreetableService.prototype.updateNode$;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZXRhYmxlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRyZWV0YWJsZS8iLCJzb3VyY2VzIjpbImxpYi90cmVldGFibGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUszQztJQUFBO1FBR1ksb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ2hDLG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUMvQix5QkFBb0IsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBQzlDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBQ3BDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBWSxDQUFDO1FBQ3JDLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO1FBRzVDLHFCQUFnQixHQUFvQixJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3hFLG9CQUFlLEdBQW9CLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdEUsMEJBQXFCLEdBQXdCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN0RixnQkFBVyxHQUF5QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ25FLGdCQUFXLEdBQXdCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDbEUsZ0JBQVcsR0FBd0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQStGdEUsQ0FBQzs7Ozs7SUE3RkcsNENBQWlCOzs7O0lBQWpCLFVBQWtCLFFBQXFCO1FBQ25DLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7Ozs7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O0lBQ3ZDLGdEQUFzRDs7Ozs7SUFDdEQsc0NBQTRDOzs7OztJQUM1QyxzQ0FBNkM7Ozs7O0lBQzdDLHNDQUE0Qzs7SUFHNUMsNENBQXdFOztJQUN4RSwyQ0FBc0U7O0lBQ3RFLGlEQUFzRjs7SUFDdEYsdUNBQW1FOztJQUNuRSx1Q0FBa0U7O0lBQ2xFLHVDQUFrRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBmbGF0dGVuIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuaW1wb3J0IHsgUm93Tm9kZSwgVHJlZU5vZGUgfSBmcm9tICcuL3R5cGVzL3RyZWVub2RlJztcclxuaW1wb3J0IHsgVHJlZVRhYmxlQ29sdW1uIH0gZnJvbSAnLi90eXBlcy90cmVldGFibGUtY29sdW1uJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRyZWV0YWJsZVNlcnZpY2Uge1xyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0aW9uU291cmNlID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgZGJsQ2xpY2tTb3VyY2UgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgcHJpdmF0ZSBjaGFuZ2VDaGVja2JveFN0YXR1cyA9IG5ldyBTdWJqZWN0PFJvd05vZGU+KCk7XHJcbiAgICBwcml2YXRlIHJlbW92ZU5vZGUgPSBuZXcgU3ViamVjdDxSb3dOb2RlPigpO1xyXG4gICAgcHJpdmF0ZSBpbnNlcnROb2RlID0gbmV3IFN1YmplY3Q8VHJlZU5vZGU+KCk7XHJcbiAgICBwcml2YXRlIHVwZGF0ZU5vZGUgPSBuZXcgU3ViamVjdDxSb3dOb2RlPigpO1xyXG5cclxuXHJcbiAgICBzZWxlY3Rpb25Tb3VyY2UkOiBPYnNlcnZhYmxlPGFueT4gPSB0aGlzLnNlbGVjdGlvblNvdXJjZS5hc09ic2VydmFibGUoKTtcclxuICAgIGRibENsaWNrU291cmNlJDogT2JzZXJ2YWJsZTxhbnk+ID0gdGhpcy5kYmxDbGlja1NvdXJjZS5hc09ic2VydmFibGUoKTtcclxuICAgIGNoYW5nZUNoZWNrYm94U3RhdHVzJDogT2JzZXJ2YWJsZTxSb3dOb2RlPiA9IHRoaXMuY2hhbmdlQ2hlY2tib3hTdGF0dXMuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBpbnNlcnROb2RlJDogT2JzZXJ2YWJsZTxUcmVlTm9kZT4gPSB0aGlzLmluc2VydE5vZGUuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICByZW1vdmVOb2RlJDogT2JzZXJ2YWJsZTxSb3dOb2RlPiA9IHRoaXMucmVtb3ZlTm9kZS5hc09ic2VydmFibGUoKTtcclxuICAgIHVwZGF0ZU5vZGUkOiBPYnNlcnZhYmxlPFJvd05vZGU+ID0gdGhpcy51cGRhdGVOb2RlLmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuICAgIG9uU2VsZWN0aW9uQ2hhbmdlKHNlbGVjdGVkPzogVHJlZU5vZGVbXSkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9uU291cmNlLm5leHQoc2VsZWN0ZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uRGJsQ2xpY2socm93Tm9kZTogUm93Tm9kZSkge1xyXG4gICAgICAgIHRoaXMuZGJsQ2xpY2tTb3VyY2UubmV4dChyb3dOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNoYW5nZUNoZWNrYm94U3RhdHVzKHJvd05vZGU6IFJvd05vZGUpIHtcclxuICAgICAgICB0aGlzLmNoYW5nZUNoZWNrYm94U3RhdHVzLm5leHQocm93Tm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25JbnNlcnQodHJlZU5vZGU6IFRyZWVOb2RlLCBwYXJlbnQ/OiBUcmVlTm9kZSkge1xyXG4gICAgICAgIHRoaXMuaW5zZXJ0Tm9kZS5uZXh0KHRyZWVOb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBvblJlbW92ZShyb3dOb2RlOiBSb3dOb2RlKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVOb2RlLm5leHQocm93Tm9kZSk7XHJcbiAgICB9XHJcblxyXG4gICAgb25VcGRhdGUocm93Tm9kZTogUm93Tm9kZSkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlTm9kZS5uZXh0KHJvd05vZGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbHVtbklzVmlzaWJsZShjb2wsIHR0KSB7XHJcbiAgICAgICAgaWYgKGNvbC52aXNpYmxlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgY29sLnZpc2libGUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbC52aXNpYmxlKHR0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb2wudmlzaWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja0NvbHVtbnNGb3JHcm91cEhlYWRlcihjb2x1bW5zOiBhbnksIHR0OiBhbnkpIHtcclxuICAgICAgICBsZXQgX2NvbHVtbnMgPSBbXTtcclxuICAgICAgICBpZiAoY29sdW1ucyAmJiBjb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBfY29sdW1ucyA9IHRoaXMuZ2V0RGF0YUNvbHVtbnMoY29sdW1ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNvbHVtbnM6IF9jb2x1bW5zXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXREYXRhRmllbGRzKGNvbHMsIGxlbmd0aCkge1xyXG4gICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICBsZXQgaiA9IDA7XHJcbiAgICAgICAgY29scy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb2xzcGFuID0gbi5jb2xzcGFuIHx8IDE7XHJcbiAgICAgICAgICAgIGlmIChpICsgY29sc3BhbiA8PSBsZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGkgKz0gY29sc3BhbjtcclxuICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBjb2xzLnNwbGljZSgwLCBqKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXREYXRhQ29sdW1ucyhjb2xzKSB7XHJcbiAgICAgICAgaWYgKCFjb2xzIHx8ICFjb2xzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZmllbGRzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBfY29scyA9IGNvbHNbaV07XHJcbiAgICAgICAgICAgIGlmIChjb2xzW2ldICYmICFjb2xzW2ldLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgX2NvbHMgPSBbLi4uZmllbGRzXTtcclxuICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9jb2xzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW4uZmllbGQgJiYgbi5jb2xzcGFuICYmIG4uY29sc3BhbiA+IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5bJ2hhbGlnbiddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG4uaEFsaWduID0gblsnaGFsaWduJ107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldERhdGFGaWVsZHMoY29sc1tpICsgMV0sIG4uY29sc3BhbikuZm9yRWFjaChkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZHMuaW5jbHVkZXMoZiA9PiBmLmZpZWxkID09PSBkLmZpZWxkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZHMuaW5jbHVkZXMoZiA9PiBmLmZpZWxkID09PSBuLmZpZWxkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChuKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmllbGRzLmZpbHRlcihuID0+ICFuLmNvbHNwYW4gfHwgbi5jb2xzcGFuID09PSAxKTtcclxuICAgIH1cclxufVxyXG4iXX0=
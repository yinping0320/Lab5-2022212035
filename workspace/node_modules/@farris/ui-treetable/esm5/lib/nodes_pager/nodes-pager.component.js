/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { TreeTableComponent } from './../treetable.component';
import { Component, Input, Injector, ChangeDetectorRef, EventEmitter, Output, ViewChild, ElementRef } from '@angular/core';
import { filter } from 'rxjs/operators';
import { BehaviorSubject } from 'rxjs';
var TreetableNodesPagerComponent = /** @class */ (function () {
    function TreetableNodesPagerComponent(tt, cd, injector) {
        var _this = this;
        this.tt = tt;
        this.cd = cd;
        this.injector = injector;
        this.disabled = false;
        this.pageChange = new EventEmitter();
        this.showTotal = false;
        this.showPager = new BehaviorSubject(false);
        this.pagerInfo = null;
        if (this.tt) {
            this.tt.expand.pipe(filter((/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                return node.id === _this.context.node.id && node.pagination && node.children.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return !n.__childs_loading__; })).length;
            }))).subscribe((/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                _this.pagerInfo = tslib_1.__assign({}, node.pagination);
                _this.showPager.next(true);
            }));
            this.tt.appendNew.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                /** @type {?} */
                var node = e.parent;
                if (node.id === _this.context.node.id && node.pagination) {
                    _this.pagerInfo = tslib_1.__assign({}, node.pagination);
                    _this.showPager.next(true);
                }
            }));
            this.tt.collapse.subscribe((/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                if (node.id === _this.context.node.id) {
                    _this.showPager.next(false);
                }
            }));
        }
    }
    Object.defineProperty(TreetableNodesPagerComponent.prototype, "pagers", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var c = this.getPagerCount();
            if (c) {
                return new Array(c);
            }
            return [];
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.setPagerInfo();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.context && !changes.context.isFirstChange()) {
            this.setPagerInfo();
        }
    };
    /**
     * @private
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.setPagerInfo = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.context) {
            var node = this.context.node;
            if (node && node.pagination) {
                this.pagerInfo = tslib_1.__assign({}, node.pagination);
                this.showPager.next(node.expanded && node.pagination);
            }
        }
    };
    /**
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.getPagerCount = /**
     * @return {?}
     */
    function () {
        var _a = this.pagerInfo, pageSize = _a.pageSize, total = _a.total;
        if (!total) {
            return 0;
        }
        else {
            return Math.ceil(total / pageSize);
        }
    };
    /**
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.isFirstPager = /**
     * @return {?}
     */
    function () {
        return this.pagerInfo.pageIndex === 1;
    };
    /**
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.isLastPager = /**
     * @return {?}
     */
    function () {
        return this.pagerInfo.pageIndex === this.getPagerCount();
    };
    /**
     * Go to the previous page
     */
    /**
     * Go to the previous page
     * @param {?} $event
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.previous = /**
     * Go to the previous page
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        $event.stopPropagation();
        this.setCurrent(this.pagerInfo.pageIndex - 1, this.pagerInfo.pageSize);
    };
    /**
     * Go to the next page
     */
    /**
     * Go to the next page
     * @param {?} $event
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.next = /**
     * Go to the next page
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        $event.stopPropagation();
        this.setCurrent(this.pagerInfo.pageIndex + 1, this.pagerInfo.pageSize);
    };
    /**
     * @param {?} page
     * @param {?=} pageSize
     * @param {?=} $event
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.setCurrent = /**
     * @param {?} page
     * @param {?=} pageSize
     * @param {?=} $event
     * @return {?}
     */
    function (page, pageSize, $event) {
        if ($event) {
            $event.stopPropagation();
        }
        this.pageChange.emit({ pageIndex: page, pageSize: pageSize, node: this.context.node, context: this.context });
    };
    /**
     * @param {?} newPageIndex
     * @return {?}
     */
    TreetableNodesPagerComponent.prototype.pagerChanged = /**
     * @param {?} newPageIndex
     * @return {?}
     */
    function (newPageIndex) {
        this.setCurrent(newPageIndex, this.pagerInfo.pageSize);
    };
    TreetableNodesPagerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'nodes-pager',
                    template: "\r\n<div style=\"justify-content: center;align-items: center;height: 100%;left: -6px;position: relative;\" class=\"d-flex f-utils-fill\" *ngIf=\"showPager | async\"  [ngStyle]=\" { 'opacity': (disabled ? 0.6 : 1), 'pointer-events': (disabled? 'none': '')  }\">\r\n    <ul class=\"treetable-nodes-pagerbar d-flex\"  (click)=\"$event.stopPropagation()\" >\r\n        <li class=\"pageinfo d-flex flex-row\" >\r\n            <div class=\"page-number-list\">\r\n                <div style=\"display: inline-block;\">\r\n                    {{pagerInfo.pageIndex}}\r\n                </div>\r\n                <select #pagerList class=\"page-index\" hidefocus=\"true\" [ngModel]=\"pagerInfo.pageIndex\" (ngModelChange)=\"pagerChanged($event)\">\r\n                    <option *ngFor=\"let t of pagers;let i=index\" [ngValue]=\"i + 1\">{{i + 1}}</option>\r\n                </select>\r\n            </div>\r\n           / {{ getPagerCount() }}</li>\r\n        <li class=\"pager-btn prev\" [class.disabled]=\"isFirstPager()\" (click)=\"previous($event)\" title=\"{{ 'pagination.previous'|locale: '\u4E0A\u4E00\u9875' }}\">\r\n            <span class=\"f-icon f-icon-arrow-chevron-left\"></span>\r\n        </li>\r\n        <li class=\"pager-btn next\"  [class.disabled]=\"isLastPager()\" (click)=\"next($event)\" title=\"{{ 'pagination.next'|locale: '\u4E0B\u4E00\u9875' }}\">\r\n            <span class=\"f-icon f-icon-arrow-chevron-right\"></span>\r\n        </li>\r\n        <li class=\"ml-2\" *ngIf=\"showTotal\">\r\n            {{pagerInfo?.total}}\r\n        </li>\r\n    </ul>\r\n\r\n</div>",
                    styles: ["\n        .treetable-nodes-pagerbar { height: 22px; line-height: 22px; list-style: none}\n        .treetable-nodes-pagerbar li { float: left; box-sizing: border-box; }\n        .treetable-nodes-pagerbar .pager-btn {\n            width: 22px;\n            height: 22px;\n            text-align: center;\n            border: 1px solid #ccc;\n            background: rgb(248 249 250);\n            cursor: pointer;\n        }\n        .treetable-nodes-pagerbar .pager-btn:hover {\n            background: white;\n        }\n        .treetable-nodes-pagerbar .prev {}\n        .treetable-nodes-pagerbar .next {\n            border-left: 0;\n        }\n\n        .pager-btn.disabled{\n            color: rgb(204 204 204);\n            pointer-events: none;\n        }\n        .treetable-nodes-pagerbar .pageinfo {\n            margin-right: 5px;\n            padding-left: 0;\n            font-weight: 400;\n            padding-right: 5px;\n        }\n\n        .treetable-nodes-pagerbar .page-index {\n            border: 0;\n            background: transparent;\n            outline: none;\n            appearance: none;\n            padding-left: 5px;\n            min-width: 50px;\n            position: absolute;\n            height: 20px;\n            text-align: left;\n            opacity: 0;\n            left: 0;\n        }\n\n        .treetable-nodes-pagerbar .page-number-list {\n            height: 20px;\n            min-width: 30px;\n            max-width: 50px;\n            overflow: hidden;\n            text-align: center;\n            position: relative;\n            border-bottom: 1px solid #ced4da;\n        }\n        "]
                }] }
    ];
    /** @nocollapse */
    TreetableNodesPagerComponent.ctorParameters = function () { return [
        { type: TreeTableComponent },
        { type: ChangeDetectorRef },
        { type: Injector }
    ]; };
    TreetableNodesPagerComponent.propDecorators = {
        disabled: [{ type: Input }],
        context: [{ type: Input }],
        pagerListEl: [{ type: ViewChild, args: ['pagerList',] }],
        pageChange: [{ type: Output }],
        showTotal: [{ type: Input }]
    };
    return TreetableNodesPagerComponent;
}());
export { TreetableNodesPagerComponent };
if (false) {
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.disabled;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.context;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pagerListEl;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pageChange;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.showTotal;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.showPager;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pagerInfo;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.tt;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZXMtcGFnZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS10cmVldGFibGUvIiwic291cmNlcyI6WyJsaWIvbm9kZXNfcGFnZXIvbm9kZXMtcGFnZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLEVBQXFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdEssT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFdkM7SUE4RUksc0NBQW9CLEVBQXNCLEVBQVcsRUFBcUIsRUFBVSxRQUFrQjtRQUF0RyxpQkErQkM7UUEvQm1CLE9BQUUsR0FBRixFQUFFLENBQW9CO1FBQVcsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBakI3RixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBR2hCLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2pDLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFFM0IsY0FBUyxHQUFHLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFXYixJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDVCxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ2YsTUFBTTs7OztZQUFDLFVBQUMsSUFBUztnQkFDYixPQUFPLElBQUksQ0FBQyxFQUFFLEtBQUssS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLEVBQXJCLENBQXFCLEVBQUMsQ0FBQyxNQUFNLENBQUM7WUFDMUgsQ0FBQyxFQUFDLENBQ0wsQ0FBQyxTQUFTOzs7O1lBQ1AsVUFBQyxJQUFjO2dCQUNYLEtBQUksQ0FBQyxTQUFTLHdCQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDdEMsS0FBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUIsQ0FBQyxFQUNKLENBQUM7WUFFRixJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxTQUFTOzs7O1lBQ3ZCLFVBQUMsQ0FBTTs7b0JBQ0csSUFBSSxHQUFHLENBQUMsQ0FBQyxNQUFNO2dCQUNyQixJQUFJLElBQUksQ0FBQyxFQUFFLEtBQUssS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7b0JBQ3JELEtBQUksQ0FBQyxTQUFTLHdCQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztvQkFDdEMsS0FBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQzdCO1lBQ0wsQ0FBQyxFQUNKLENBQUM7WUFFRixJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxTQUFTOzs7O1lBQ3RCLFVBQUMsSUFBYztnQkFDWCxJQUFJLElBQUksQ0FBQyxFQUFFLEtBQUssS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFO29CQUNsQyxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDOUI7WUFDTCxDQUFDLEVBQ0osQ0FBQztTQUNMO0lBQ0wsQ0FBQztJQXZDRCxzQkFBSSxnREFBTTs7OztRQUFWOztnQkFDVSxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUM5QixJQUFJLENBQUMsRUFBRTtnQkFDSCxPQUFPLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3ZCO1lBQ0QsT0FBTyxFQUFFLENBQUM7UUFDZCxDQUFDOzs7T0FBQTs7OztJQW1DRCwrQ0FBUTs7O0lBQVI7UUFDSSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDeEIsQ0FBQzs7Ozs7SUFFRCxrREFBVzs7OztJQUFYLFVBQVksT0FBc0I7UUFDOUIsSUFBSSxPQUFPLENBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBRTtZQUNyRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDdkI7SUFDTCxDQUFDOzs7OztJQUVPLG1EQUFZOzs7O0lBQXBCO1FBQ0ksSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ04sSUFBQSx3QkFBSTtZQUNaLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxTQUFTLHdCQUFRLElBQUksQ0FBQyxVQUFVLENBQUUsQ0FBQztnQkFDeEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQ2YsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUNuQyxDQUFDO2FBQ0w7U0FDSjtJQUNMLENBQUM7Ozs7SUFFRCxvREFBYTs7O0lBQWI7UUFDVSxJQUFBLG1CQUFvQyxFQUFsQyxzQkFBUSxFQUFFLGdCQUF3QjtRQUMxQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1IsT0FBTyxDQUFDLENBQUM7U0FDWjthQUFNO1lBQ0gsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsQ0FBQztTQUN0QztJQUNMLENBQUM7Ozs7SUFFRCxtREFBWTs7O0lBQVo7UUFDSSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxLQUFLLENBQUMsQ0FBQztJQUMxQyxDQUFDOzs7O0lBRUQsa0RBQVc7OztJQUFYO1FBQ0ksT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsS0FBSyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDN0QsQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSCwrQ0FBUTs7Ozs7SUFBUixVQUFTLE1BQVc7UUFDaEIsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0UsQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSCwyQ0FBSTs7Ozs7SUFBSixVQUFLLE1BQVc7UUFDWixNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMzRSxDQUFDOzs7Ozs7O0lBRUQsaURBQVU7Ozs7OztJQUFWLFVBQVcsSUFBWSxFQUFFLFFBQWlCLEVBQUUsTUFBWTtRQUNwRCxJQUFJLE1BQU0sRUFBRTtZQUNSLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUM1QjtRQUVELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLFVBQUEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQ3hHLENBQUM7Ozs7O0lBRUQsbURBQVk7Ozs7SUFBWixVQUFhLFlBQW9CO1FBQzdCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0QsQ0FBQzs7Z0JBaExKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsYUFBYTtvQkFDdkIsaWtEQUEyQzs2QkFFdkMsd21EQXFEQztpQkFFUjs7OztnQkFqRVEsa0JBQWtCO2dCQUNrQixpQkFBaUI7Z0JBQTNCLFFBQVE7OzsyQkFrRXRDLEtBQUs7MEJBQ0wsS0FBSzs4QkFDTCxTQUFTLFNBQUMsV0FBVzs2QkFDckIsTUFBTTs0QkFDTixLQUFLOztJQWlIVixtQ0FBQztDQUFBLEFBbExELElBa0xDO1NBdEhZLDRCQUE0Qjs7O0lBQ3JDLGdEQUEwQjs7SUFDMUIsK0NBQXNCOztJQUN0QixtREFBcUQ7O0lBQ3JELGtEQUEwQzs7SUFDMUMsaURBQTJCOztJQUUzQixpREFBdUM7O0lBQ3ZDLGlEQUFpQjs7Ozs7SUFVTCwwQ0FBOEI7Ozs7O0lBQUcsMENBQTZCOzs7OztJQUFFLGdEQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyZWVUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4vLi4vdHJlZXRhYmxlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgSW5qZWN0b3IsIENoYW5nZURldGVjdG9yUmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBEb0NoZWNrLCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUgfSBmcm9tICcuLi90eXBlcy90cmVlbm9kZSc7XHJcbmltcG9ydCB7IGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnbm9kZXMtcGFnZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL25vZGVzLXBhZ2VyLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIHsgaGVpZ2h0OiAyMnB4OyBsaW5lLWhlaWdodDogMjJweDsgbGlzdC1zdHlsZTogbm9uZX1cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIGxpIHsgZmxvYXQ6IGxlZnQ7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH1cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5wYWdlci1idG4ge1xyXG4gICAgICAgICAgICB3aWR0aDogMjJweDtcclxuICAgICAgICAgICAgaGVpZ2h0OiAyMnB4O1xyXG4gICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYigyNDggMjQ5IDI1MCk7XHJcbiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciAucGFnZXItYnRuOmhvdmVyIHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgLnByZXYge31cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5uZXh0IHtcclxuICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAucGFnZXItYnRuLmRpc2FibGVke1xyXG4gICAgICAgICAgICBjb2xvcjogcmdiKDIwNCAyMDQgMjA0KTtcclxuICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgLnBhZ2VpbmZvIHtcclxuICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA1cHg7XHJcbiAgICAgICAgICAgIHBhZGRpbmctbGVmdDogMDtcclxuICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDtcclxuICAgICAgICAgICAgcGFkZGluZy1yaWdodDogNXB4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciAucGFnZS1pbmRleCB7XHJcbiAgICAgICAgICAgIGJvcmRlcjogMDtcclxuICAgICAgICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XHJcbiAgICAgICAgICAgIG91dGxpbmU6IG5vbmU7XHJcbiAgICAgICAgICAgIGFwcGVhcmFuY2U6IG5vbmU7XHJcbiAgICAgICAgICAgIHBhZGRpbmctbGVmdDogNXB4O1xyXG4gICAgICAgICAgICBtaW4td2lkdGg6IDUwcHg7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgICAgICAgaGVpZ2h0OiAyMHB4O1xyXG4gICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0O1xyXG4gICAgICAgICAgICBvcGFjaXR5OiAwO1xyXG4gICAgICAgICAgICBsZWZ0OiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciAucGFnZS1udW1iZXItbGlzdCB7XHJcbiAgICAgICAgICAgIGhlaWdodDogMjBweDtcclxuICAgICAgICAgICAgbWluLXdpZHRoOiAzMHB4O1xyXG4gICAgICAgICAgICBtYXgtd2lkdGg6IDUwcHg7XHJcbiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XHJcbiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcclxuICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xyXG4gICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2NlZDRkYTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVHJlZXRhYmxlTm9kZXNQYWdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAgIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBjb250ZXh0OiBhbnk7XHJcbiAgICBAVmlld0NoaWxkKCdwYWdlckxpc3QnKSBwYWdlckxpc3RFbDogRWxlbWVudFJlZjxhbnk+O1xyXG4gICAgQE91dHB1dCgpIHBhZ2VDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBASW5wdXQoKSBzaG93VG90YWwgPSBmYWxzZTtcclxuXHJcbiAgICBzaG93UGFnZXIgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGZhbHNlKTtcclxuICAgIHBhZ2VySW5mbyA9IG51bGw7XHJcblxyXG4gICAgZ2V0IHBhZ2VycygpIHtcclxuICAgICAgICBjb25zdCBjID0gdGhpcy5nZXRQYWdlckNvdW50KCk7XHJcbiAgICAgICAgaWYgKGMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheShjKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHQ6IFRyZWVUYWJsZUNvbXBvbmVudCwgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIGlmICh0aGlzLnR0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudHQuZXhwYW5kLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBmaWx0ZXIoKG5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmlkID09PSB0aGlzLmNvbnRleHQubm9kZS5pZCAmJiBub2RlLnBhZ2luYXRpb24gJiYgbm9kZS5jaGlsZHJlbi5maWx0ZXIobiA9PiAhbi5fX2NoaWxkc19sb2FkaW5nX18pLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgKG5vZGU6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlckluZm8gPSB7Li4ubm9kZS5wYWdpbmF0aW9ufTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dQYWdlci5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50dC5hcHBlbmROZXcuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBlLnBhcmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gdGhpcy5jb250ZXh0Lm5vZGUuaWQgJiYgbm9kZS5wYWdpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZXJJbmZvID0gey4uLm5vZGUucGFnaW5hdGlvbn07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1BhZ2VyLm5leHQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50dC5jb2xsYXBzZS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAobm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gdGhpcy5jb250ZXh0Lm5vZGUuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UGFnZXIubmV4dChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldFBhZ2VySW5mbygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5jb250ZXh0ICYmICFjaGFuZ2VzLmNvbnRleHQuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UGFnZXJJbmZvKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UGFnZXJJbmZvKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRleHQpIHtcclxuICAgICAgICAgICAgY29uc3QgeyBub2RlIH0gPSB0aGlzLmNvbnRleHQ7XHJcbiAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlckluZm8gPSB7IC4uLm5vZGUucGFnaW5hdGlvbiB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93UGFnZXIubmV4dChcclxuICAgICAgICAgICAgICAgICAgICBub2RlLmV4cGFuZGVkICYmIG5vZGUucGFnaW5hdGlvblxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRQYWdlckNvdW50KCkge1xyXG4gICAgICAgIGNvbnN0IHsgcGFnZVNpemUsIHRvdGFsIH0gPSB0aGlzLnBhZ2VySW5mbztcclxuICAgICAgICBpZiAoIXRvdGFsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwodG90YWwgLyBwYWdlU2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlzRmlyc3RQYWdlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYWdlckluZm8ucGFnZUluZGV4ID09PSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGlzTGFzdFBhZ2VyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2VySW5mby5wYWdlSW5kZXggPT09IHRoaXMuZ2V0UGFnZXJDb3VudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR28gdG8gdGhlIHByZXZpb3VzIHBhZ2VcclxuICAgICAqL1xyXG4gICAgcHJldmlvdXMoJGV2ZW50OiBhbnkpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5zZXRDdXJyZW50KHRoaXMucGFnZXJJbmZvLnBhZ2VJbmRleCAtIDEsIHRoaXMucGFnZXJJbmZvLnBhZ2VTaXplKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdvIHRvIHRoZSBuZXh0IHBhZ2VcclxuICAgICAqL1xyXG4gICAgbmV4dCgkZXZlbnQ6IGFueSkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLnNldEN1cnJlbnQodGhpcy5wYWdlckluZm8ucGFnZUluZGV4ICsgMSwgdGhpcy5wYWdlckluZm8ucGFnZVNpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEN1cnJlbnQocGFnZTogbnVtYmVyLCBwYWdlU2l6ZT86IG51bWJlciwgJGV2ZW50PzogYW55KSB7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnBhZ2VDaGFuZ2UuZW1pdCh7IHBhZ2VJbmRleDogcGFnZSwgcGFnZVNpemUsIG5vZGU6IHRoaXMuY29udGV4dC5ub2RlLCBjb250ZXh0OiB0aGlzLmNvbnRleHQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcGFnZXJDaGFuZ2VkKG5ld1BhZ2VJbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5zZXRDdXJyZW50KG5ld1BhZ2VJbmRleCwgdGhpcy5wYWdlckluZm8ucGFnZVNpemUpO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
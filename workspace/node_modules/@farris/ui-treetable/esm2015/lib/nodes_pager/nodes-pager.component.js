/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { TreeTableComponent } from './../treetable.component';
import { Component, Input, Injector, ChangeDetectorRef, EventEmitter, Output, ViewChild, ElementRef } from '@angular/core';
import { filter } from 'rxjs/operators';
import { BehaviorSubject } from 'rxjs';
export class TreetableNodesPagerComponent {
    /**
     * @param {?} tt
     * @param {?} cd
     * @param {?} injector
     */
    constructor(tt, cd, injector) {
        this.tt = tt;
        this.cd = cd;
        this.injector = injector;
        this.disabled = false;
        this.pageChange = new EventEmitter();
        this.showTotal = false;
        this.showPager = new BehaviorSubject(false);
        this.pagerInfo = null;
        if (this.tt) {
            this.tt.expand.pipe(filter((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                return node.id === this.context.node.id && node.pagination && node.children.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => !n.__childs_loading__)).length;
            }))).subscribe((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                this.pagerInfo = Object.assign({}, node.pagination);
                this.showPager.next(true);
            }));
            this.tt.appendNew.subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                /** @type {?} */
                const node = e.parent;
                if (node.id === this.context.node.id && node.pagination) {
                    this.pagerInfo = Object.assign({}, node.pagination);
                    this.showPager.next(true);
                }
            }));
            this.tt.collapse.subscribe((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                if (node.id === this.context.node.id) {
                    this.showPager.next(false);
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    get pagers() {
        /** @type {?} */
        const c = this.getPagerCount();
        if (c) {
            return new Array(c);
        }
        return [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.setPagerInfo();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.context && !changes.context.isFirstChange()) {
            this.setPagerInfo();
        }
    }
    /**
     * @private
     * @return {?}
     */
    setPagerInfo() {
        if (this.context) {
            const { node } = this.context;
            if (node && node.pagination) {
                this.pagerInfo = Object.assign({}, node.pagination);
                this.showPager.next(node.expanded && node.pagination);
            }
        }
    }
    /**
     * @return {?}
     */
    getPagerCount() {
        const { pageSize, total } = this.pagerInfo;
        if (!total) {
            return 0;
        }
        else {
            return Math.ceil(total / pageSize);
        }
    }
    /**
     * @return {?}
     */
    isFirstPager() {
        return this.pagerInfo.pageIndex === 1;
    }
    /**
     * @return {?}
     */
    isLastPager() {
        return this.pagerInfo.pageIndex === this.getPagerCount();
    }
    /**
     * Go to the previous page
     * @param {?} $event
     * @return {?}
     */
    previous($event) {
        $event.stopPropagation();
        this.setCurrent(this.pagerInfo.pageIndex - 1, this.pagerInfo.pageSize);
    }
    /**
     * Go to the next page
     * @param {?} $event
     * @return {?}
     */
    next($event) {
        $event.stopPropagation();
        this.setCurrent(this.pagerInfo.pageIndex + 1, this.pagerInfo.pageSize);
    }
    /**
     * @param {?} page
     * @param {?=} pageSize
     * @param {?=} $event
     * @return {?}
     */
    setCurrent(page, pageSize, $event) {
        if ($event) {
            $event.stopPropagation();
        }
        this.pageChange.emit({ pageIndex: page, pageSize, node: this.context.node, context: this.context });
    }
    /**
     * @param {?} newPageIndex
     * @return {?}
     */
    pagerChanged(newPageIndex) {
        this.setCurrent(newPageIndex, this.pagerInfo.pageSize);
    }
}
TreetableNodesPagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'nodes-pager',
                template: "\r\n<div style=\"justify-content: center;align-items: center;height: 100%;left: -6px;position: relative;\" class=\"d-flex f-utils-fill\" *ngIf=\"showPager | async\"  [ngStyle]=\" { 'opacity': (disabled ? 0.6 : 1), 'pointer-events': (disabled? 'none': '')  }\">\r\n    <ul class=\"treetable-nodes-pagerbar d-flex\"  (click)=\"$event.stopPropagation()\" >\r\n        <li class=\"pageinfo d-flex flex-row\" >\r\n            <div class=\"page-number-list\">\r\n                <div style=\"display: inline-block;\">\r\n                    {{pagerInfo.pageIndex}}\r\n                </div>\r\n                <select #pagerList class=\"page-index\" hidefocus=\"true\" [ngModel]=\"pagerInfo.pageIndex\" (ngModelChange)=\"pagerChanged($event)\">\r\n                    <option *ngFor=\"let t of pagers;let i=index\" [ngValue]=\"i + 1\">{{i + 1}}</option>\r\n                </select>\r\n            </div>\r\n           / {{ getPagerCount() }}</li>\r\n        <li class=\"pager-btn prev\" [class.disabled]=\"isFirstPager()\" (click)=\"previous($event)\" title=\"{{ 'pagination.previous'|locale: '\u4E0A\u4E00\u9875' }}\">\r\n            <span class=\"f-icon f-icon-arrow-chevron-left\"></span>\r\n        </li>\r\n        <li class=\"pager-btn next\"  [class.disabled]=\"isLastPager()\" (click)=\"next($event)\" title=\"{{ 'pagination.next'|locale: '\u4E0B\u4E00\u9875' }}\">\r\n            <span class=\"f-icon f-icon-arrow-chevron-right\"></span>\r\n        </li>\r\n        <li class=\"ml-2\" *ngIf=\"showTotal\">\r\n            {{pagerInfo?.total}}\r\n        </li>\r\n    </ul>\r\n\r\n</div>",
                styles: [`
        .treetable-nodes-pagerbar { height: 22px; line-height: 22px; list-style: none}
        .treetable-nodes-pagerbar li { float: left; box-sizing: border-box; }
        .treetable-nodes-pagerbar .pager-btn {
            width: 22px;
            height: 22px;
            text-align: center;
            border: 1px solid #ccc;
            background: rgb(248 249 250);
            cursor: pointer;
        }
        .treetable-nodes-pagerbar .pager-btn:hover {
            background: white;
        }
        .treetable-nodes-pagerbar .prev {}
        .treetable-nodes-pagerbar .next {
            border-left: 0;
        }

        .pager-btn.disabled{
            color: rgb(204 204 204);
            pointer-events: none;
        }
        .treetable-nodes-pagerbar .pageinfo {
            margin-right: 5px;
            padding-left: 0;
            font-weight: 400;
            padding-right: 5px;
        }

        .treetable-nodes-pagerbar .page-index {
            border: 0;
            background: transparent;
            outline: none;
            appearance: none;
            padding-left: 5px;
            min-width: 50px;
            position: absolute;
            height: 20px;
            text-align: left;
            opacity: 0;
            left: 0;
        }

        .treetable-nodes-pagerbar .page-number-list {
            height: 20px;
            min-width: 30px;
            max-width: 50px;
            overflow: hidden;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #ced4da;
        }
        `]
            }] }
];
/** @nocollapse */
TreetableNodesPagerComponent.ctorParameters = () => [
    { type: TreeTableComponent },
    { type: ChangeDetectorRef },
    { type: Injector }
];
TreetableNodesPagerComponent.propDecorators = {
    disabled: [{ type: Input }],
    context: [{ type: Input }],
    pagerListEl: [{ type: ViewChild, args: ['pagerList',] }],
    pageChange: [{ type: Output }],
    showTotal: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.disabled;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.context;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pagerListEl;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pageChange;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.showTotal;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.showPager;
    /** @type {?} */
    TreetableNodesPagerComponent.prototype.pagerInfo;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.tt;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    TreetableNodesPagerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZXMtcGFnZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS10cmVldGFibGUvIiwic291cmNlcyI6WyJsaWIvbm9kZXNfcGFnZXIvbm9kZXMtcGFnZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBcUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV0SyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQThEdkMsTUFBTSxPQUFPLDRCQUE0Qjs7Ozs7O0lBa0JyQyxZQUFvQixFQUFzQixFQUFXLEVBQXFCLEVBQVUsUUFBa0I7UUFBbEYsT0FBRSxHQUFGLEVBQUUsQ0FBb0I7UUFBVyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFqQjdGLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFHaEIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUUzQixjQUFTLEdBQUcsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkMsY0FBUyxHQUFHLElBQUksQ0FBQztRQVdiLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNULElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZixNQUFNOzs7O1lBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRTtnQkFDakIsT0FBTyxJQUFJLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFB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aUJBQWlCO1lBQTNCLFFBQVE7Ozt1QkFrRXRDLEtBQUs7c0JBQ0wsS0FBSzswQkFDTCxTQUFTLFNBQUMsV0FBVzt5QkFDckIsTUFBTTt3QkFDTixLQUFLOzs7O0lBSk4sZ0RBQTBCOztJQUMxQiwrQ0FBc0I7O0lBQ3RCLG1EQUFxRDs7SUFDckQsa0RBQTBDOztJQUMxQyxpREFBMkI7O0lBRTNCLGlEQUF1Qzs7SUFDdkMsaURBQWlCOzs7OztJQVVMLDBDQUE4Qjs7Ozs7SUFBRywwQ0FBNkI7Ozs7O0lBQUUsZ0RBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi8uLi90cmVldGFibGUuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIERvQ2hlY2ssIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSB9IGZyb20gJy4uL3R5cGVzL3RyZWVub2RlJztcclxuaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdub2Rlcy1wYWdlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vbm9kZXMtcGFnZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYFxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgeyBoZWlnaHQ6IDIycHg7IGxpbmUtaGVpZ2h0OiAyMnB4OyBsaXN0LXN0eWxlOiBub25lfVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgbGkgeyBmbG9hdDogbGVmdDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgLnBhZ2VyLWJ0biB7XHJcbiAgICAgICAgICAgIHdpZHRoOiAyMnB4O1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDIycHg7XHJcbiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcclxuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2NjYztcclxuICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiKDI0OCAyNDkgMjUwKTtcclxuICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5wYWdlci1idG46aG92ZXIge1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciAucHJldiB7fVxyXG4gICAgICAgIC50cmVldGFibGUtbm9kZXMtcGFnZXJiYXIgLm5leHQge1xyXG4gICAgICAgICAgICBib3JkZXItbGVmdDogMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC5wYWdlci1idG4uZGlzYWJsZWR7XHJcbiAgICAgICAgICAgIGNvbG9yOiByZ2IoMjA0IDIwNCAyMDQpO1xyXG4gICAgICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnRyZWV0YWJsZS1ub2Rlcy1wYWdlcmJhciAucGFnZWluZm8ge1xyXG4gICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDVweDtcclxuICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiAwO1xyXG4gICAgICAgICAgICBmb250LXdlaWdodDogNDAwO1xyXG4gICAgICAgICAgICBwYWRkaW5nLXJpZ2h0OiA1cHg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5wYWdlLWluZGV4IHtcclxuICAgICAgICAgICAgYm9yZGVyOiAwO1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcclxuICAgICAgICAgICAgb3V0bGluZTogbm9uZTtcclxuICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTtcclxuICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiA1cHg7XHJcbiAgICAgICAgICAgIG1pbi13aWR0aDogNTBweDtcclxuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDIwcHg7XHJcbiAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7XHJcbiAgICAgICAgICAgIG9wYWNpdHk6IDA7XHJcbiAgICAgICAgICAgIGxlZnQ6IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAudHJlZXRhYmxlLW5vZGVzLXBhZ2VyYmFyIC5wYWdlLW51bWJlci1saXN0IHtcclxuICAgICAgICAgICAgaGVpZ2h0OiAyMHB4O1xyXG4gICAgICAgICAgICBtaW4td2lkdGg6IDMwcHg7XHJcbiAgICAgICAgICAgIG1heC13aWR0aDogNTBweDtcclxuICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcclxuICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xyXG4gICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XHJcbiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2VkNGRhO1xyXG4gICAgICAgIH1cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUcmVldGFibGVOb2Rlc1BhZ2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGNvbnRleHQ6IGFueTtcclxuICAgIEBWaWV3Q2hpbGQoJ3BhZ2VyTGlzdCcpIHBhZ2VyTGlzdEVsOiBFbGVtZW50UmVmPGFueT47XHJcbiAgICBAT3V0cHV0KCkgcGFnZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBJbnB1dCgpIHNob3dUb3RhbCA9IGZhbHNlO1xyXG5cclxuICAgIHNob3dQYWdlciA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xyXG4gICAgcGFnZXJJbmZvID0gbnVsbDtcclxuXHJcbiAgICBnZXQgcGFnZXJzKCkge1xyXG4gICAgICAgIGNvbnN0IGMgPSB0aGlzLmdldFBhZ2VyQ291bnQoKTtcclxuICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5KGMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB0dDogVHJlZVRhYmxlQ29tcG9uZW50LCAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudHQpIHtcclxuICAgICAgICAgICAgdGhpcy50dC5leHBhbmQucGlwZShcclxuICAgICAgICAgICAgICAgIGZpbHRlcigobm9kZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUuaWQgPT09IHRoaXMuY29udGV4dC5ub2RlLmlkICYmIG5vZGUucGFnaW5hdGlvbiAmJiBub2RlLmNoaWxkcmVuLmZpbHRlcihuID0+ICFuLl9fY2hpbGRzX2xvYWRpbmdfXykubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAobm9kZTogVHJlZU5vZGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2VySW5mbyA9IHsuLi5ub2RlLnBhZ2luYXRpb259O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1BhZ2VyLm5leHQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnR0LmFwcGVuZE5ldy5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGUucGFyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlkID09PSB0aGlzLmNvbnRleHQubm9kZS5pZCAmJiBub2RlLnBhZ2luYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYWdlckluZm8gPSB7Li4ubm9kZS5wYWdpbmF0aW9ufTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93UGFnZXIubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnR0LmNvbGxhcHNlLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgIChub2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlkID09PSB0aGlzLmNvbnRleHQubm9kZS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dQYWdlci5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuc2V0UGFnZXJJbmZvKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmNvbnRleHQgJiYgIWNoYW5nZXMuY29udGV4dC5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRQYWdlckluZm8oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQYWdlckluZm8oKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGV4dCkge1xyXG4gICAgICAgICAgICBjb25zdCB7IG5vZGUgfSA9IHRoaXMuY29udGV4dDtcclxuICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5wYWdpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhZ2VySW5mbyA9IHsgLi4ubm9kZS5wYWdpbmF0aW9uIH07XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dQYWdlci5uZXh0KFxyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuZXhwYW5kZWQgJiYgbm9kZS5wYWdpbmF0aW9uXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFBhZ2VyQ291bnQoKSB7XHJcbiAgICAgICAgY29uc3QgeyBwYWdlU2l6ZSwgdG90YWwgfSA9IHRoaXMucGFnZXJJbmZvO1xyXG4gICAgICAgIGlmICghdG90YWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbCh0b3RhbCAvIHBhZ2VTaXplKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaXNGaXJzdFBhZ2VyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2VySW5mby5wYWdlSW5kZXggPT09IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaXNMYXN0UGFnZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFnZXJJbmZvLnBhZ2VJbmRleCA9PT0gdGhpcy5nZXRQYWdlckNvdW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHbyB0byB0aGUgcHJldmlvdXMgcGFnZVxyXG4gICAgICovXHJcbiAgICBwcmV2aW91cygkZXZlbnQ6IGFueSkge1xyXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLnNldEN1cnJlbnQodGhpcy5wYWdlckluZm8ucGFnZUluZGV4IC0gMSwgdGhpcy5wYWdlckluZm8ucGFnZVNpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR28gdG8gdGhlIG5leHQgcGFnZVxyXG4gICAgICovXHJcbiAgICBuZXh0KCRldmVudDogYW55KSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudCh0aGlzLnBhZ2VySW5mby5wYWdlSW5kZXggKyAxLCB0aGlzLnBhZ2VySW5mby5wYWdlU2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q3VycmVudChwYWdlOiBudW1iZXIsIHBhZ2VTaXplPzogbnVtYmVyLCAkZXZlbnQ/OiBhbnkpIHtcclxuICAgICAgICBpZiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucGFnZUNoYW5nZS5lbWl0KHsgcGFnZUluZGV4OiBwYWdlLCBwYWdlU2l6ZSwgbm9kZTogdGhpcy5jb250ZXh0Lm5vZGUsIGNvbnRleHQ6IHRoaXMuY29udGV4dCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwYWdlckNoYW5nZWQobmV3UGFnZUluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnNldEN1cnJlbnQobmV3UGFnZUluZGV4LCB0aGlzLnBhZ2VySW5mby5wYWdlU2l6ZSk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
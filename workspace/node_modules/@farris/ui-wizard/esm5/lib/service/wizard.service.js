/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { WizardEvent, WizardEventType } from '../model/wizard.model';
import * as i0 from "@angular/core";
var WizardService = /** @class */ (function () {
    function WizardService() {
        var _this = this;
        this.wizardData = new Subject();
        // 保存数据
        this.wizardPagesData = {};
        //是否平铺
        this.pageFill = true;
        /**
         * 对象结构
         *  {
         *      "activeIndex":-1,
         * "stepMessages":[
         * {
         * "id":"deliverytime",
         * "title":"设置发货时间",
         * "icon":""
         * },....]
         * }
         */
        this.onlyProgressData = null;
        // 步骤条数据保持
        this.progressData = new Subject();
        // 当前向导状态
        this.wizardState = new Subject();
        // 修改向导步骤
        this.changeActiveIndex = new Subject();
        this.progressData.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.onlyProgressData = data;
        }));
    }
    //存储页面是否平铺
    //存储页面是否平铺
    /**
     * @param {?} fill
     * @return {?}
     */
    WizardService.prototype.updatePageFill = 
    //存储页面是否平铺
    /**
     * @param {?} fill
     * @return {?}
     */
    function (fill) {
        this.pageFill = fill;
    };
    /**
     * @return {?}
     */
    WizardService.prototype.getPageFill = /**
     * @return {?}
     */
    function () {
        return this.pageFill;
    };
    /**
     * 更新向导状态
     * state: Finish,Cancel,Prev,Next
     */
    /**
     * 更新向导状态
     * state: Finish,Cancel,Prev,Next
     * @param {?} state
     * @param {?} curPageId
     * @param {?=} stepToPageId
     * @return {?}
     */
    WizardService.prototype.updateWizardState = /**
     * 更新向导状态
     * state: Finish,Cancel,Prev,Next
     * @param {?} state
     * @param {?} curPageId
     * @param {?=} stepToPageId
     * @return {?}
     */
    function (state, curPageId, stepToPageId) {
        /** @type {?} */
        var toPageId = '';
        switch (state) {
            case WizardEventType.Prev:
                toPageId = this.getPrePageId(curPageId);
                break;
            case WizardEventType.Next:
                toPageId = this.getNextPageId(curPageId);
                break;
            case WizardEventType.StepChange:
                toPageId = stepToPageId ? stepToPageId : curPageId;
                break;
            case WizardEventType.ChangeIndex:
                toPageId = stepToPageId !== '' ? stepToPageId : curPageId;
                break;
            default:
                toPageId = curPageId;
        }
        // 只有页面变化时候，才改变
        if (!toPageId) {
            return;
        }
        this.currentPageId = toPageId;
        this.wizardState.next(new WizardEvent(state, curPageId, toPageId));
    };
    /**
     * 获取向导状态变化
     */
    /**
     * 获取向导状态变化
     * @return {?}
     */
    WizardService.prototype.getWizardState = /**
     * 获取向导状态变化
     * @return {?}
     */
    function () {
        return this.wizardState;
    };
    /**
     * 获取整个向导用的数据
     * 场景：向导整体数据，在不同页之间通用
     */
    /**
     * 获取整个向导用的数据
     * 场景：向导整体数据，在不同页之间通用
     * @return {?}
     */
    WizardService.prototype.getWizardData = /**
     * 获取整个向导用的数据
     * 场景：向导整体数据，在不同页之间通用
     * @return {?}
     */
    function () {
        return this.wizardData;
    };
    /**
     * 设置向导用的数据
     * 场景：向导整体数据，在不同页之间通用
     */
    /**
     * 设置向导用的数据
     * 场景：向导整体数据，在不同页之间通用
     * @param {?} data
     * @return {?}
     */
    WizardService.prototype.setWizardData = /**
     * 设置向导用的数据
     * 场景：向导整体数据，在不同页之间通用
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.wizardData.next(data);
    };
    /**
     * 设置某页面数据
     * @param pageid
     * @param data
     */
    /**
     * 设置某页面数据
     * @param {?} data
     * @param {?=} pageid
     * @return {?}
     */
    WizardService.prototype.setPageData = /**
     * 设置某页面数据
     * @param {?} data
     * @param {?=} pageid
     * @return {?}
     */
    function (data, pageid) {
        /** @type {?} */
        var id = pageid ? pageid : this.currentPageId;
        this.wizardPagesData[id] = data;
    };
    /**
     * 获取某页面数据
     * @param pageid
     */
    /**
     * 获取某页面数据
     * @param {?} pageid
     * @return {?}
     */
    WizardService.prototype.getPageData = /**
     * 获取某页面数据
     * @param {?} pageid
     * @return {?}
     */
    function (pageid) {
        if (this.wizardPagesData.hasOwnProperty(pageid)) {
            return this.wizardPagesData[pageid];
        }
        return {};
    };
    // /**
    //  * 场景：Wizard组件初始化步骤条数据
    //  * @param data
    //  */
    // initProgressData(data) {
    //     this.progressData.next(data);
    // }
    /**
     * 目的：更新步骤条数据
     * 场景：PageDetail组件，需要更新步骤数据,刷新步骤条界面
     */
    // /**
    //  * 场景：Wizard组件初始化步骤条数据
    //  * @param data
    //  */
    // initProgressData(data) {
    //     this.progressData.next(data);
    // }
    /**
     * 目的：更新步骤条数据
     * 场景：PageDetail组件，需要更新步骤数据,刷新步骤条界面
     * @param {?} data
     * @return {?}
     */
    WizardService.prototype.updateProgressData = 
    // /**
    //  * 场景：Wizard组件初始化步骤条数据
    //  * @param data
    //  */
    // initProgressData(data) {
    //     this.progressData.next(data);
    // }
    /**
     * 目的：更新步骤条数据
     * 场景：PageDetail组件，需要更新步骤数据,刷新步骤条界面
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.progressData.next(data);
    };
    /**
     * 目的：获取步骤条数据
     * 场景：PageDetail组件,查看步骤条数据
     */
    /**
     * 目的：获取步骤条数据
     * 场景：PageDetail组件,查看步骤条数据
     * @return {?}
     */
    WizardService.prototype.getProgressData = /**
     * 目的：获取步骤条数据
     * 场景：PageDetail组件,查看步骤条数据
     * @return {?}
     */
    function () {
        return this.progressData;
    };
    /**存储currentpageid */
    /**
     * 存储currentpageid
     * @param {?} id
     * @return {?}
     */
    WizardService.prototype.updateCurrentPageId = /**
     * 存储currentpageid
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.currentPageId = id;
    };
    /**
     * @return {?}
     */
    WizardService.prototype.getCurrentPageId = /**
     * @return {?}
     */
    function () {
        return this.currentPageId;
    };
    /**
     * 获取上一页pageid
     * @param pageid
     */
    /**
     * 获取上一页pageid
     * @param {?=} pageid
     * @return {?}
     */
    WizardService.prototype.getPrePageId = /**
     * 获取上一页pageid
     * @param {?=} pageid
     * @return {?}
     */
    function (pageid) {
        /** @type {?} */
        var id;
        id = pageid ? pageid : this.currentPageId;
        /** @type {?} */
        var pageIdIndex = this.getIndexByPageId(id);
        if (pageIdIndex <= 0) {
            return '';
        }
        /** @type {?} */
        var prePage = this.onlyProgressData.stepMessages[pageIdIndex - 1];
        return prePage['id'];
    };
    /**
     * 获取下一页
     * @param pageid
     */
    /**
     * 获取下一页
     * @param {?} pageid
     * @return {?}
     */
    WizardService.prototype.getNextPageId = /**
     * 获取下一页
     * @param {?} pageid
     * @return {?}
     */
    function (pageid) {
        /** @type {?} */
        var pagelen = this.onlyProgressData.stepMessages.length;
        /** @type {?} */
        var pageIdIndex = this.getIndexByPageId(pageid);
        if (pageIdIndex == pagelen - 1) {
            return '';
        }
        /** @type {?} */
        var nextPage = this.onlyProgressData.stepMessages[pageIdIndex + 1];
        return nextPage['id'];
    };
    /**
     * 是否是最后一页
     * @param pageid
     */
    /**
     * 是否是最后一页
     * @param {?} pageid
     * @return {?}
     */
    WizardService.prototype.isLastPage = /**
     * 是否是最后一页
     * @param {?} pageid
     * @return {?}
     */
    function (pageid) {
        /** @type {?} */
        var pagelen = this.onlyProgressData.length;
        /** @type {?} */
        var lastPage = this.onlyProgressData.stepMessages[pagelen - 1];
        return lastPage['id'] == pageid;
    };
    /**
     * 是否是当前页
     * @param pageid
     */
    /**
     * 是否是当前页
     * @param {?} pageid
     * @return {?}
     */
    WizardService.prototype.isCurrentPage = /**
     * 是否是当前页
     * @param {?} pageid
     * @return {?}
     */
    function (pageid) {
        /** @type {?} */
        var activeIndex = this.onlyProgressData.activeIndex;
        if (activeIndex < 0) {
            return false;
        }
        /** @type {?} */
        var curPage = this.onlyProgressData.stepMessages[activeIndex];
        return curPage['id'] == pageid;
    };
    /**
     * 是否是初始页
     * @param pageid
     */
    /**
     * 是否是初始页
     * @param {?} pageid
     * @return {?}
     */
    WizardService.prototype.isFirstPage = /**
     * 是否是初始页
     * @param {?} pageid
     * @return {?}
     */
    function (pageid) {
        if (this.onlyProgressData.activeIndex < 0) {
            return false;
        }
        return this.onlyProgressData.stepMessages[0]['id'] == pageid;
    };
    /**
     * 根据ID获取index
     * @param pageid
     */
    /**
     * 根据ID获取index
     * @param {?} pageid
     * @return {?}
     */
    WizardService.prototype.getIndexByPageId = /**
     * 根据ID获取index
     * @param {?} pageid
     * @return {?}
     */
    function (pageid) {
        if (this.onlyProgressData && this.onlyProgressData.hasOwnProperty('stepMessages')) {
            /** @type {?} */
            var pageIdIndex = this.onlyProgressData.stepMessages.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item['id'] == pageid) {
                    return true;
                }
                return false;
            }));
            return pageIdIndex;
        }
    };
    //20190211 服务内新增事件
    /**
     * 下一步
     */
    //20190211 服务内新增事件
    /**
     * 下一步
     * @return {?}
     */
    WizardService.prototype.nextStep = 
    //20190211 服务内新增事件
    /**
     * 下一步
     * @return {?}
     */
    function () {
        this.updateWizardState(WizardEventType.Next, this.currentPageId);
    };
    /**
     * 上一步
     */
    /**
     * 上一步
     * @return {?}
     */
    WizardService.prototype.prevStep = /**
     * 上一步
     * @return {?}
     */
    function () {
        this.updateWizardState(WizardEventType.Prev, this.currentPageId);
    };
    /**
     * 结束向导
     */
    /**
     * 结束向导
     * @return {?}
     */
    WizardService.prototype.finishWizard = /**
     * 结束向导
     * @return {?}
     */
    function () {
        this.updateWizardState(WizardEventType.Finish, this.currentPageId);
    };
    /**
     * 取消向导
     */
    /**
     * 取消向导
     * @return {?}
     */
    WizardService.prototype.cancelWizard = /**
     * 取消向导
     * @return {?}
     */
    function () {
        this.updateWizardState(WizardEventType.Cancel, this.currentPageId);
    };
    /**
     * 修改向导显示步骤
     * @param num 索引 0开始
     */
    /**
     * 修改向导显示步骤
     * @param {?} num 索引 0开始
     * @return {?}
     */
    WizardService.prototype.setActiveIndex = /**
     * 修改向导显示步骤
     * @param {?} num 索引 0开始
     * @return {?}
     */
    function (num) {
        /** @type {?} */
        var toPageId;
        if (this.onlyProgressData && this.onlyProgressData.hasOwnProperty('stepMessages')) {
            /** @type {?} */
            var activeNum = (num >= 0 && num < this.onlyProgressData.stepMessages.length) ? num : 0;
            toPageId = this.onlyProgressData.stepMessages[activeNum]['id'];
        }
        this.updateWizardState(WizardEventType.ChangeIndex, this.currentPageId, toPageId);
        this.changeActiveIndex.next(num);
    };
    WizardService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    WizardService.ctorParameters = function () { return []; };
    /** @nocollapse */ WizardService.ngInjectableDef = i0.defineInjectable({ factory: function WizardService_Factory() { return new WizardService(); }, token: WizardService, providedIn: "root" });
    return WizardService;
}());
export { WizardService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WizardService.prototype.wizardData;
    /** @type {?} */
    WizardService.prototype.currentPageId;
    /**
     * @type {?}
     * @private
     */
    WizardService.prototype.wizardPagesData;
    /**
     * @type {?}
     * @private
     */
    WizardService.prototype.pageFill;
    /**
     * 对象结构
     *  {
     *      "activeIndex":-1,
     * "stepMessages":[
     * {
     * "id":"deliverytime",
     * "title":"设置发货时间",
     * "icon":""
     * },....]
     * }
     * @type {?}
     * @private
     */
    WizardService.prototype.onlyProgressData;
    /**
     * @type {?}
     * @private
     */
    WizardService.prototype.progressData;
    /**
     * @type {?}
     * @private
     */
    WizardService.prototype.wizardState;
    /** @type {?} */
    WizardService.prototype.changeActiveIndex;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXdpemFyZC8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL3dpemFyZC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7QUFFckU7SUErQkk7UUFBQSxpQkFJQztRQS9CTyxlQUFVLEdBQWdCLElBQUksT0FBTyxFQUFFLENBQUM7O1FBSXhDLG9CQUFlLEdBQUcsRUFBRSxDQUFDOztRQUVyQixhQUFRLEdBQUcsSUFBSSxDQUFDOzs7Ozs7Ozs7Ozs7O1FBYWhCLHFCQUFnQixHQUFHLElBQUksQ0FBQzs7UUFFeEIsaUJBQVksR0FBaUIsSUFBSSxPQUFPLEVBQUUsQ0FBQzs7UUFFM0MsZ0JBQVcsR0FBaUIsSUFBSSxPQUFPLEVBQUUsQ0FBQzs7UUFFbEQsc0JBQWlCLEdBQW9CLElBQUksT0FBTyxFQUFFLENBQUM7UUFHL0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTOzs7O1FBQUMsVUFBQSxJQUFJO1lBQzVCLEtBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDakMsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsVUFBVTs7Ozs7O0lBQ1Ysc0NBQWM7Ozs7OztJQUFkLFVBQWUsSUFBWTtRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUN6QixDQUFDOzs7O0lBQ0QsbUNBQVc7OztJQUFYO1FBQ0ksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3pCLENBQUM7SUFDRDs7O09BR0c7Ozs7Ozs7OztJQUNILHlDQUFpQjs7Ozs7Ozs7SUFBakIsVUFBa0IsS0FBc0IsRUFBRSxTQUFpQixF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U0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7Ozs7O3dCQVBEO0NBdVFDLEFBbFFELElBa1FDO1NBL1BZLGFBQWE7Ozs7OztJQUN0QixtQ0FBZ0Q7O0lBRWhELHNDQUFxQjs7Ozs7SUFFckIsd0NBQTZCOzs7OztJQUU3QixpQ0FBd0I7Ozs7Ozs7Ozs7Ozs7OztJQWF4Qix5Q0FBZ0M7Ozs7O0lBRWhDLHFDQUFtRDs7Ozs7SUFFbkQsb0NBQWtEOztJQUVsRCwwQ0FBbUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgaXNUaGlzTW9udGggfSBmcm9tICdkYXRlLWZucyc7XHJcbmltcG9ydCB7IFdpemFyZEV2ZW50LCBXaXphcmRFdmVudFR5cGUgfSBmcm9tICcuLi9tb2RlbC93aXphcmQubW9kZWwnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBXaXphcmRTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgd2l6YXJkRGF0YTpTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLy/nlKjkuo7lrZjlgqjlvZPliY3mmL7npLpwYWdlaWRcclxuICAgIGN1cnJlbnRQYWdlSWQ6c3RyaW5nO1xyXG4gICAgLy8g5L+d5a2Y5pWw5o2uXHJcbiAgICBwcml2YXRlIHdpemFyZFBhZ2VzRGF0YSA9IHt9O1xyXG4gICAgLy/mmK/lkKblubPpk7pcclxuICAgIHByaXZhdGUgcGFnZUZpbGwgPSB0cnVlO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlr7nosaHnu5PmnoRcclxuICAgICAqICB7XHJcbiAgICAgKiAgICAgIFwiYWN0aXZlSW5kZXhcIjotMSxcclxuICAgICAgICAgICAgIFwic3RlcE1lc3NhZ2VzXCI6W1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjpcImRlbGl2ZXJ5dGltZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjpcIuiuvue9ruWPkei0p+aXtumXtFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiaWNvblwiOlwiXCJcclxuICAgICAgICAgICAgICAgIH0sLi4uLl1cclxuICAgICAgICB9XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgb25seVByb2dyZXNzRGF0YSA9IG51bGw7XHJcbiAgICAvLyDmraXpqqTmnaHmlbDmja7kv53mjIFcclxuICAgIHByaXZhdGUgcHJvZ3Jlc3NEYXRhOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLy8g5b2T5YmN5ZCR5a+854q25oCBXHJcbiAgICBwcml2YXRlIHdpemFyZFN0YXRlOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLy8g5L+u5pS55ZCR5a+85q2l6aqkXHJcbiAgICBjaGFuZ2VBY3RpdmVJbmRleDogU3ViamVjdDxudW1iZXI+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnByb2dyZXNzRGF0YS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMub25seVByb2dyZXNzRGF0YSA9IGRhdGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvL+WtmOWCqOmhtemdouaYr+WQpuW5s+mTulxyXG4gICAgdXBkYXRlUGFnZUZpbGwoZmlsbDpib29sZWFuKXtcclxuICAgICAgICB0aGlzLnBhZ2VGaWxsID0gZmlsbDtcclxuICAgIH1cclxuICAgIGdldFBhZ2VGaWxsKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFnZUZpbGw7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsOWQkeWvvOeKtuaAgVxyXG4gICAgICogc3RhdGU6IEZpbmlzaCxDYW5jZWwsUHJldixOZXh0XHJcbiAgICAgKi9cclxuICAgIHVwZGF0ZVdpemFyZFN0YXRlKHN0YXRlOiBXaXphcmRFdmVudFR5cGUsIGN1clBhZ2VJZDogc3RyaW5nLCBzdGVwVG9QYWdlSWQ/OnN0cmluZykge1xyXG4gICAgICAgIGxldCB0b1BhZ2VJZCA9ICcnO1xyXG4gICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcclxuICAgICAgICAgICAgY2FzZSBXaXphcmRFdmVudFR5cGUuUHJldjpcclxuICAgICAgICAgICAgICAgIHRvUGFnZUlkID0gdGhpcy5nZXRQcmVQYWdlSWQoY3VyUGFnZUlkKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFdpemFyZEV2ZW50VHlwZS5OZXh0OlxyXG4gICAgICAgICAgICAgICAgdG9QYWdlSWQgPSB0aGlzLmdldE5leHRQYWdlSWQoY3VyUGFnZUlkKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFdpemFyZEV2ZW50VHlwZS5TdGVwQ2hhbmdlOlxyXG4gICAgICAgICAgICAgICAgdG9QYWdlSWQgPSBzdGVwVG9QYWdlSWQgPyBzdGVwVG9QYWdlSWQ6IGN1clBhZ2VJZFxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgV2l6YXJkRXZlbnRUeXBlLkNoYW5nZUluZGV4OlxyXG4gICAgICAgICAgICAgICAgdG9QYWdlSWQgPSBzdGVwVG9QYWdlSWQgIT09ICcnID8gc3RlcFRvUGFnZUlkOiBjdXJQYWdlSWRcclxuICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0b1BhZ2VJZCA9IGN1clBhZ2VJZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5Y+q5pyJ6aG16Z2i5Y+Y5YyW5pe25YCZ77yM5omN5pS55Y+YXHJcbiAgICAgICAgaWYgKCF0b1BhZ2VJZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY3VycmVudFBhZ2VJZCA9IHRvUGFnZUlkO1xyXG4gICAgICAgIHRoaXMud2l6YXJkU3RhdGUubmV4dChuZXcgV2l6YXJkRXZlbnQoc3RhdGUsIGN1clBhZ2VJZCwgdG9QYWdlSWQpKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5ZCR5a+854q25oCB5Y+Y5YyWXHJcbiAgICAgKi9cclxuICAgIGdldFdpemFyZFN0YXRlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLndpemFyZFN0YXRlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmlbTkuKrlkJHlr7znlKjnmoTmlbDmja5cclxuICAgICAqIOWcuuaZr++8muWQkeWvvOaVtOS9k+aVsOaNru+8jOWcqOS4jeWQjOmhteS5i+mXtOmAmueUqFxyXG4gICAgICovXHJcbiAgICBnZXRXaXphcmREYXRhKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMud2l6YXJkRGF0YTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5ZCR5a+855So55qE5pWw5o2uXHJcbiAgICAgKiDlnLrmma/vvJrlkJHlr7zmlbTkvZPmlbDmja7vvIzlnKjkuI3lkIzpobXkuYvpl7TpgJrnlKhcclxuICAgICAqL1xyXG4gICAgc2V0V2l6YXJkRGF0YShkYXRhKXtcclxuICAgICAgICB0aGlzLndpemFyZERhdGEubmV4dChkYXRhKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5p+Q6aG16Z2i5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gcGFnZWlkXHJcbiAgICAgKiBAcGFyYW0gZGF0YVxyXG4gICAgICovXHJcbiAgICBzZXRQYWdlRGF0YShkYXRhLHBhZ2VpZD86IHN0cmluZykge1xyXG4gICAgICAgIGxldCBpZCA9IHBhZ2VpZD8gcGFnZWlkIDogdGhpcy5jdXJyZW50UGFnZUlkO1xyXG4gICAgICAgIHRoaXMud2l6YXJkUGFnZXNEYXRhW2lkXSA9IGRhdGE7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluafkOmhtemdouaVsOaNrlxyXG4gICAgICogQHBhcmFtIHBhZ2VpZFxyXG4gICAgICovXHJcbiAgICBnZXRQYWdlRGF0YShwYWdlaWQpIHtcclxuICAgICAgICBpZiAodGhpcy53aXphcmRQYWdlc0RhdGEuaGFzT3duUHJvcGVydHkocGFnZWlkKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy53aXphcmRQYWdlc0RhdGFbcGFnZWlkXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgfVxyXG4gICAgLy8gLyoqXHJcbiAgICAvLyAgKiDlnLrmma/vvJpXaXphcmTnu4Tku7bliJ3lp4vljJbmraXpqqTmnaHmlbDmja5cclxuICAgIC8vICAqIEBwYXJhbSBkYXRhXHJcbiAgICAvLyAgKi9cclxuICAgIC8vIGluaXRQcm9ncmVzc0RhdGEoZGF0YSkge1xyXG4gICAgLy8gICAgIHRoaXMucHJvZ3Jlc3NEYXRhLm5leHQoZGF0YSk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnm67nmoTvvJrmm7TmlrDmraXpqqTmnaHmlbDmja5cclxuICAgICAqIOWcuuaZr++8mlBhZ2VEZXRhaWznu4Tku7bvvIzpnIDopoHmm7TmlrDmraXpqqTmlbDmja4s5Yi35paw5q2l6aqk5p2h55WM6Z2iXHJcbiAgICAgKi9cclxuICAgIHVwZGF0ZVByb2dyZXNzRGF0YShkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5wcm9ncmVzc0RhdGEubmV4dChkYXRhKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog55uu55qE77ya6I635Y+W5q2l6aqk5p2h5pWw5o2uXHJcbiAgICAgKiDlnLrmma/vvJpQYWdlRGV0YWls57uE5Lu2LOafpeeci+atpemqpOadoeaVsOaNrlxyXG4gICAgICovXHJcbiAgICBnZXRQcm9ncmVzc0RhdGEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvZ3Jlc3NEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKuWtmOWCqGN1cnJlbnRwYWdlaWQgKi9cclxuICAgIHVwZGF0ZUN1cnJlbnRQYWdlSWQoaWQ6c3RyaW5nKXtcclxuICAgICAgICB0aGlzLmN1cnJlbnRQYWdlSWQgPSBpZCA7XHJcbiAgICB9XHJcbiAgICBnZXRDdXJyZW50UGFnZUlkKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBhZ2VJZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluS4iuS4gOmhtXBhZ2VpZFxyXG4gICAgICogQHBhcmFtIHBhZ2VpZFxyXG4gICAgICovXHJcbiAgICBnZXRQcmVQYWdlSWQocGFnZWlkPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgaWQ6c3RyaW5nO1xyXG4gICAgICAgIGlkID0gcGFnZWlkP3BhZ2VpZDp0aGlzLmN1cnJlbnRQYWdlSWQ7XHJcbiAgICAgICAgY29uc3QgcGFnZUlkSW5kZXggPSB0aGlzLmdldEluZGV4QnlQYWdlSWQoaWQpO1xyXG4gICAgICAgIGlmIChwYWdlSWRJbmRleCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHByZVBhZ2UgPSB0aGlzLm9ubHlQcm9ncmVzc0RhdGEuc3RlcE1lc3NhZ2VzW3BhZ2VJZEluZGV4IC0gMV07XHJcbiAgICAgICAgcmV0dXJuIHByZVBhZ2VbJ2lkJ107XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bkuIvkuIDpobVcclxuICAgICAqIEBwYXJhbSBwYWdlaWRcclxuICAgICAqL1xyXG4gICAgZ2V0TmV4dFBhZ2VJZChwYWdlaWQpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHBhZ2VsZW4gPSB0aGlzLm9ubHlQcm9ncmVzc0RhdGEuc3RlcE1lc3NhZ2VzLmxlbmd0aDtcclxuICAgICAgICBjb25zdCBwYWdlSWRJbmRleCA9IHRoaXMuZ2V0SW5kZXhCeVBhZ2VJZChwYWdlaWQpO1xyXG4gICAgICAgIGlmIChwYWdlSWRJbmRleCA9PSBwYWdlbGVuIC0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBuZXh0UGFnZSA9IHRoaXMub25seVByb2dyZXNzRGF0YS5zdGVwTWVzc2FnZXNbcGFnZUlkSW5kZXggKyAxXTtcclxuICAgICAgICByZXR1cm4gbmV4dFBhZ2VbJ2lkJ107XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYr+acgOWQjuS4gOmhtVxyXG4gICAgICogQHBhcmFtIHBhZ2VpZFxyXG4gICAgICovXHJcbiAgICBpc0xhc3RQYWdlKHBhZ2VpZCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IHBhZ2VsZW4gPSB0aGlzLm9ubHlQcm9ncmVzc0RhdGEubGVuZ3RoO1xyXG4gICAgICAgIGxldCBsYXN0UGFnZSA9IHRoaXMub25seVByb2dyZXNzRGF0YS5zdGVwTWVzc2FnZXNbcGFnZWxlbiAtIDFdO1xyXG4gICAgICAgIHJldHVybiBsYXN0UGFnZVsnaWQnXSA9PSBwYWdlaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKbmmK/lvZPliY3pobVcclxuICAgICAqIEBwYXJhbSBwYWdlaWRcclxuICAgICAqL1xyXG4gICAgaXNDdXJyZW50UGFnZShwYWdlaWQpOiBib29sZWFuIHtcclxuICAgICAgICBjb25zdCBhY3RpdmVJbmRleCA9IHRoaXMub25seVByb2dyZXNzRGF0YS5hY3RpdmVJbmRleDtcclxuICAgICAgICBpZiAoYWN0aXZlSW5kZXggPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGN1clBhZ2UgPSB0aGlzLm9ubHlQcm9ncmVzc0RhdGEuc3RlcE1lc3NhZ2VzW2FjdGl2ZUluZGV4XTtcclxuICAgICAgICByZXR1cm4gY3VyUGFnZVsnaWQnXSA9PSBwYWdlaWQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuaYr+WIneWni+mhtVxyXG4gICAgICogQHBhcmFtIHBhZ2VpZFxyXG4gICAgICovXHJcbiAgICBpc0ZpcnN0UGFnZShwYWdlaWQpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5vbmx5UHJvZ3Jlc3NEYXRhLmFjdGl2ZUluZGV4IDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLm9ubHlQcm9ncmVzc0RhdGEuc3RlcE1lc3NhZ2VzWzBdWydpZCddID09IHBhZ2VpZDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2uSUTojrflj5ZpbmRleFxyXG4gICAgICogQHBhcmFtIHBhZ2VpZCBcclxuICAgICAqL1xyXG4gICAgZ2V0SW5kZXhCeVBhZ2VJZChwYWdlaWQpOiBudW1iZXIge1xyXG4gICAgICAgIGlmKHRoaXMub25seVByb2dyZXNzRGF0YSYmdGhpcy5vbmx5UHJvZ3Jlc3NEYXRhLmhhc093blByb3BlcnR5KCdzdGVwTWVzc2FnZXMnKSl7XHJcbiAgICAgICAgICAgIGxldCBwYWdlSWRJbmRleCA9IHRoaXMub25seVByb2dyZXNzRGF0YS5zdGVwTWVzc2FnZXMuZmluZEluZGV4KGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1bJ2lkJ10gPT0gcGFnZWlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcGFnZUlkSW5kZXg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLzIwMTkwMjExIOacjeWKoeWGheaWsOWinuS6i+S7tlxyXG4gICAgLyoqXHJcbiAgICAgKiDkuIvkuIDmraVcclxuICAgICAqL1xyXG4gICAgbmV4dFN0ZXAoKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVXaXphcmRTdGF0ZShXaXphcmRFdmVudFR5cGUuTmV4dCwgdGhpcy5jdXJyZW50UGFnZUlkKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5LiK5LiA5q2lXHJcbiAgICAgKi9cclxuICAgIHByZXZTdGVwKCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlV2l6YXJkU3RhdGUoV2l6YXJkRXZlbnRUeXBlLlByZXYsIHRoaXMuY3VycmVudFBhZ2VJZCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOe7k+adn+WQkeWvvFxyXG4gICAgICovXHJcbiAgICBmaW5pc2hXaXphcmQoKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVXaXphcmRTdGF0ZShXaXphcmRFdmVudFR5cGUuRmluaXNoLCB0aGlzLmN1cnJlbnRQYWdlSWQpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlj5bmtojlkJHlr7xcclxuICAgICAqL1xyXG4gICAgY2FuY2VsV2l6YXJkKCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlV2l6YXJkU3RhdGUoV2l6YXJkRXZlbnRUeXBlLkNhbmNlbCwgdGhpcy5jdXJyZW50UGFnZUlkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS/ruaUueWQkeWvvOaYvuekuuatpemqpFxyXG4gICAgICogQHBhcmFtIG51bSDntKLlvJUgMOW8gOWni1xyXG4gICAgICovXHJcbiAgICBzZXRBY3RpdmVJbmRleChudW06bnVtYmVyKXtcclxuICAgICAgICBsZXQgdG9QYWdlSWQ7XHJcbiAgICAgICAgaWYodGhpcy5vbmx5UHJvZ3Jlc3NEYXRhJiZ0aGlzLm9ubHlQcm9ncmVzc0RhdGEuaGFzT3duUHJvcGVydHkoJ3N0ZXBNZXNzYWdlcycpKXtcclxuICAgICAgICAgICAgbGV0IGFjdGl2ZU51bTpudW1iZXIgID0gKG51bT49IDAgJiYgbnVtIDwgdGhpcy5vbmx5UHJvZ3Jlc3NEYXRhLnN0ZXBNZXNzYWdlcy5sZW5ndGgpPyBudW06IDBcclxuICAgICAgICAgICAgdG9QYWdlSWQgPSB0aGlzLm9ubHlQcm9ncmVzc0RhdGEuc3RlcE1lc3NhZ2VzW2FjdGl2ZU51bV1bJ2lkJ107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudXBkYXRlV2l6YXJkU3RhdGUoV2l6YXJkRXZlbnRUeXBlLkNoYW5nZUluZGV4LCB0aGlzLmN1cnJlbnRQYWdlSWQsIHRvUGFnZUlkKTtcclxuICAgICAgICB0aGlzLmNoYW5nZUFjdGl2ZUluZGV4Lm5leHQobnVtKTtcclxuICAgIH1cclxufVxyXG4iXX0=
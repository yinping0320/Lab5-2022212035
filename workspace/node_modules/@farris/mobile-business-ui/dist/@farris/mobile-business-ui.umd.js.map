{"version":3,"file":"mobile-business-ui.umd.js","sources":["../../src/components/attachment/src/service/uuid.ts","../../src/components/attachment/src/attachment.vue","../../src/components/attachment/src/attachment.vue?vue&type=template&id=443ecfba&lang.js","../../node_modules/style-inject/dist/style-inject.es.js","../../src/components/attachment/index.ts","../../src/components/attachment-file/src/service/uuid.ts","../../src/components/attachment-file/src/service/upload-options.ts","../../src/components/attachment-file/src/attachment-file.vue","../../src/components/attachment-file/src/attachment-file.vue?vue&type=template&id=9380a99c&lang.js","../../src/components/attachment-file/index.ts","../../src/components/attachment-entry/src/attachment-entry.vue","../../src/components/attachment-entry/src/attachment-entry.vue?vue&type=template&id=0d94d79a&lang.js","../../src/components/attachment-entry/index.ts","../../src/business/verify-code/src/index.vue","../../src/business/verify-code/src/index.vue?vue&type=template&id=607c2323&lang.js","../../src/business/verify-code/index.ts","../../src/business/attachment/attachment.service.ts","../../src/business/map/service/remote.ts","../../src/business/map/service/load-map-api.ts","../../src/business/map/service/inject-api.ts","../../src/business/map/service/map-plugin.ts","../../src/business/map/service/utils.ts","../../src/business/map/service/amap-manager.ts","../../src/business/attachment/attachment.vue","../../src/business/attachment/attachment.vue?vue&type=template&id=75253ace&lang.js","../../src/business/attachment/index.ts","../../src/business/submit-approve/src/approve.jsx","../../src/business/submit-approve/src/index.jsx","../../src/components/attachment-preview/src/attachment-preview.jsx","../../src/components/attachment-preview/src/index.jsx","../../src/business/map/src/busi-map.vue","../../src/business/map/src/busi-map.vue?vue&type=template&id=958f0908&lang.js","../../src/business/map/src/index.ts","../../src/business/map/src/map.vue","../../src/business/map/src/map.vue?vue&type=template&id=b762bdf0&lang.js","../../src/business/map/index.ts","../../src/plugin/filter.ts","../../src/business/approval-logs/approval-logs.vue","../../src/business/approval-logs/approval-logs.vue?vue&type=template&id=7b17e026&lang.js","../../src/business/approval-logs/index.ts","../../src/index.ts"],"sourcesContent":[null,"<template>\r\n  <div class=\"farris-attachment attachment\" ref=\"attach\">\r\n    <van-uploader\r\n      :multiple=\"multiple\"\r\n      ref=\"fileUploadRef\"\r\n      :max-count=\"maxNum\"\r\n      v-model=\"rawFiles\"\r\n      :disabled=\"disabled\"\r\n      :preview-full-image=\"previewEnable\"\r\n      :accept=\"accept\"\r\n      :before-read=\"beforeRead\"\r\n      :after-read=\"afterRead\"\r\n      v-show=\"false\"\r\n    />\r\n    <div class=\"farris-attachment-img\">\r\n      <van-empty\r\n        description=\"附件为空\"\r\n        v-if=\"!selectedFile || (!selectedFile.url && !selectedFile.file)\"\r\n      />\r\n      <div\r\n        class=\"img-container\"\r\n        v-if=\"selectedFile && selectedFile.url\"\r\n        ref=\"imgContainer\"\r\n      >\r\n        <van-image\r\n          :height=\"imgHeight\"\r\n          fit=\"scale-down\"\r\n          :src=\"getAttachmentPathByType(selectedFile)\"\r\n          @click=\"genPreview\"\r\n          v-if=\"\r\n            selectedFile.name\r\n              .toLowerCase()\r\n              .search(\r\n                /\\.(png|jpe?g|gif|svg|ppt|pptx|xls|xlsx|doc|docx|txt|pdf)(\\?.*)?$/\r\n              ) >= 0\r\n          \"\r\n        />\r\n        <video\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mov')\r\n          \"\r\n        >\r\n          <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n        </video>\r\n        <video\r\n          :src=\"selectedFile.url\"\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            (selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mp4')) ||\r\n              selectedFile.name.toLowerCase().includes('webm') ||\r\n              selectedFile.name.toLowerCase().includes('ogg')\r\n          \"\r\n        >\r\n          您的浏览器不支持 video 标签。\r\n        </video>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          closeable\r\n          @closed=\"closed\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n          <div v-if=\"showDoc\" class=\"panzoom\" :style=\"docStyle\">\r\n            <div\r\n              v-for=\"(page, index) in previewPages\"\r\n              class=\"page\"\r\n              :style=\"{ width: 'unset', height: 'unset' }\"\r\n              :key=\"index\"\r\n            >\r\n              <div v-html=\"page.data\" v-if=\"page.data\"></div>\r\n            </div>\r\n          </div>\r\n        </van-popup>\r\n      </div>\r\n      <div v-if=\"selectedFile && selectedFile.file\"></div>\r\n      <!-- </van-col> -->\r\n    </div>\r\n    <div class=\"attachment-navigation\" ref=\"navigation\">\r\n      <van-grid clickable :column-num=\"gridNumber\">\r\n        <!-- 拍照  只有云+ 云上协同支持-->\r\n        <van-grid-item\r\n          text=\"拍摄\"\r\n          icon=\"photograph\"\r\n          @click=\"takePhoto\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.photo && ccWork.photo.isPhoto) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.photo &&\r\n                cloudPlus.photo.isPhoto) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 相册 均支持 -->\r\n        <van-grid-item\r\n          text=\"相册\"\r\n          icon=\"photo\"\r\n          @click=\"selectFromAlbum\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.album && ccWork.album.isAlbum) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.album &&\r\n                cloudPlus.album.isAlbum) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 目前只有云上协同支持 -->\r\n        <van-grid-item\r\n          text=\"短视频\"\r\n          icon=\"video\"\r\n          @click=\"takeShortVideo\"\r\n          v-if=\"pattern === 'ccWork' && ccWork.video && ccWork.video.isVideo\"\r\n        />\r\n        <!-- 选择文件 目前只有原生模式和云+支持 -->\r\n        <van-grid-item\r\n          text=\"文件\"\r\n          icon=\"card\"\r\n          @click=\"appendFile\"\r\n          v-if=\"\r\n            (pattern === 'cloudPlus' && cloudPlus.selectFile.isFile) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n      </van-grid>\r\n      <van-row type=\"flex\" justify=\"center\">\r\n        <van-col class=\"attachment-navigation-1 last-navigation\" span=\"24\">\r\n          <div\r\n            v-for=\"(item, index) in uploadFiles\"\r\n            :class=\"{\r\n              'attachment-navigation-item': true,\r\n              'selected-file': selectedFile\r\n                ? item.id === selectedFile.id &&\r\n                  selectedAttachmentId === selectedFile.attachmentId\r\n                : false,\r\n            }\"\r\n            :key=\"index\"\r\n            @touchstart=\"goTouchStart(item)\"\r\n            @click.stop=\"selectFile(item)\"\r\n          >\r\n            <van-image\r\n              :src=\"getAttachmentPathByType(item)\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item && item.name && !item.name.includes('mp4')) || !item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              src=\"/platform/runtime/dfs/images/file.png\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item &&\r\n                  item.name &&\r\n                  item.name.toLowerCase().includes('mp4')) ||\r\n                  item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n            <div\r\n              class=\"item-icon-delete\"\r\n              @click=\"deleteAttachment(item)\"\r\n              v-if=\"\r\n                selectedFile\r\n                  ? item.id === selectedFile.id &&\r\n                    selectedAttachmentId === selectedFile.attachmentId\r\n                  : false\r\n              \"\r\n            >\r\n              <span class=\"fm-icon fm-icon-close\"></span>\r\n            </div>\r\n          </div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n<style scoped lang=\"scss\">\r\n.attachment {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  & .farris-attachment-img {\r\n    display: flex;\r\n    flex: 1;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  & .img-container {\r\n    text-align: center;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  & video {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.preview-mask {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.farris-attachment {\r\n  clear: both;\r\n\r\n  // 附件组件背景和尺寸\r\n  & .attachment-detail {\r\n    background: #fff;\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n\r\n  // 选中附件样式\r\n  & .selected-file {\r\n    box-shadow: inset 0px 0px 3px 3px #59a1ff;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  & .attachment-navigation-1 {\r\n    overflow: auto;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & img {\r\n      border-radius: 5px;\r\n    }\r\n\r\n    & .item-pdf {\r\n      width: 100%;\r\n      height: 100%;\r\n      background-image: url(\"data:image/png;base64,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\");\r\n      background-size: contain;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: -6px;\r\n      top: -6px;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n      border-radius: 50%;\r\n\r\n      .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .first-navigation {\r\n    max-width: 80%;\r\n  }\r\n\r\n  // 内置前置导航\r\n  & .first-navigation .attachment-navigation-item {\r\n    width: 55px;\r\n    height: 55px;\r\n  }\r\n\r\n  // 后置导航\r\n  & .last-navigation .attachment-navigation-item {\r\n    margin: 6px;\r\n    width: 80px;\r\n    height: 80px;\r\n  }\r\n\r\n  & .attachment-navigation-icon {\r\n    text-align: center;\r\n\r\n    & .add-icon {\r\n      margin: 8px 0;\r\n      width: 55px;\r\n      height: 55px;\r\n    }\r\n  }\r\n\r\n  & .van-grid-item .van-image img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .fixed-bottom {\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n  }\r\n\r\n  & .small-imgs-child {\r\n    width: 80px;\r\n    height: 80px;\r\n    background-size: contain;\r\n  }\r\n\r\n  & .small-imgs-item {\r\n    position: relative;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .small-imgs-item img {\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .action-grid {\r\n    position: absolute;\r\n    width: 100%;\r\n    bottom: 100px;\r\n  }\r\n\r\n  & .preview-img img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .upload-icon {\r\n    position: absolute;\r\n    top: 0.5rem;\r\n    left: 0.5rem;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 5%;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport {\r\n  Uploader,\r\n  Empty,\r\n  Image,\r\n  Popup,\r\n  Grid,\r\n  GridItem,\r\n  Row,\r\n  Col,\r\n  ImagePreview,\r\n} from \"vant\";\r\nimport { uuid } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment\",\r\n  components: {\r\n    \"van-uploader\": Uploader,\r\n    \"van-empty\": Empty,\r\n    \"van-image\": Image,\r\n    \"van-popup\": Popup,\r\n    \"van-grid\": Grid,\r\n    \"van-grid-item\": GridItem,\r\n    \"van-row\": Row,\r\n    \"van-col\": Col,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: null },\r\n  },\r\n  props: {\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      default:\r\n        \"application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain\",\r\n      // default: 'application/pdf,image/*,application/msword,text/html'\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 自定义进入附件组件的入口\r\n    allowDefaultEntrance: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    // 上传附件信息\r\n    uploadInfo: {\r\n      type: Object,\r\n      default: null,\r\n    },\r\n    // parentDirName\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 上传模式  html ccWork cloudPlus\r\n    pattern: {\r\n      type: String,\r\n      default: \"ccWork\",\r\n    },\r\n    // 云上协同配置\r\n    ccWork: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: \"high\",\r\n            mode: \"camera\",\r\n            mark: \"\",\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            mType: \"0\",\r\n            maxNum: 6,\r\n          },\r\n          video: {\r\n            id: \"af700826-7552-4858-a5e0-e64f5e20288b\",\r\n            quality: 0.8,\r\n            time: 15,\r\n            isVideo: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            mType: \"0\",\r\n            maxNum: 9,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 云+配置\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            maximum: 3,\r\n            fileType: \".jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|.txt\",\r\n            isFile: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 原生模式\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t弹出层显示\r\n\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      videoUrl: \"\",\r\n      selectedAttachmentId: \"\",\r\n      subscription: \"\",\r\n      // 图片尺寸\r\n      imgHeight: 0,\r\n      imhWidth: 0,\r\n      // 尺寸开关\r\n      hasFiles: false,\r\n      // 预览文件尺寸\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      const self = this;\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n          this.$nextTick(() => {\r\n            self.goTouchStart(this.selectedFile);\r\n          });\r\n        }\r\n        if (this.selectedAttachmentId) {\r\n          this.selectedFile = this.rawFiles.find(\r\n            (rawFile) => rawFile.attachmentId === this.selectedAttachmentId\r\n          );\r\n          if (this.selectedFile) {\r\n            // 上传成功后  选中新上传的附件且附件信息同步变更\r\n            this.$nextTick(() => {\r\n              self.goTouchStart(this.selectedFile);\r\n              this.$loading.hide();\r\n            });\r\n          }\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        // 没有url属性的 没有上传\r\n        if (!this.hasFiles) {\r\n          this.$nextTick(() => {\r\n            this.calculateImgSize(80);\r\n            this.hasFiles = true;\r\n          });\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      // 没有url属性的 没有上传\r\n      if (this.hasFiles) {\r\n        this.$nextTick(() => {\r\n          this.calculateImgSize();\r\n          this.hasFiles = false;\r\n        });\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n    // 拍照  选择文件  拍摄短视频等\r\n    gridNumber() {\r\n      if (this.pattern === \"ccWork\") {\r\n        return (\r\n          Number(this.ccWork.photo.isPhoto) +\r\n          Number(this.ccWork.video.isVideo) +\r\n          Number(this.ccWork.album.isAlbum)\r\n        );\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        return (\r\n          Number(this.cloudPlus.photo.isPhoto) +\r\n          Number(this.cloudPlus.selectFile.isFile) +\r\n          Number(this.cloudPlus.album.isAlbum)\r\n        );\r\n      } else {\r\n        // 原生模式\r\n        return 3;\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n  },\r\n  mounted() {\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          console.log(res);\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n    this.$loading.hide();\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"html\") {\r\n        this.$refs.fileUploadRef.chooseFile();\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        // 选择文件服务\r\n        this.attachmentService.getSysInfo().subscribe((res) => {\r\n          if (res && res.platform === \"Android\") {\r\n            this.attachmentService.selectFile(this.cloudPlus.selectFile);\r\n          } else if (res && res.platform === \"iOS\") {\r\n            this.$refs.fileUploadRef.chooseFile();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 使用h5文件API 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      console.log(file);\r\n      this.$loading.show(\"附件上传中\");\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      if (this.notUploadedFileList.length > this.maxNum) {\r\n        this.$notify.warning(\"最多上传\" + this.maxNum + \"个附件\");\r\n        return;\r\n      }\r\n      // 赋值最新的上传文件附件id\r\n      this.selectedAttachmentId = this.notUploadedFileList[0].id;\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n\r\n    goTouchStart(item) {\r\n      this.selectedFile = item;\r\n      if (\r\n        (this.selectedFile.name &&\r\n          this.selectedFile.name.toLowerCase().includes(\"mp4\")) ||\r\n        this.selectedFile.name.toLowerCase().includes(\"webm\") ||\r\n        this.selectedFile.name.toLowerCase().includes(\"ogg\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          this.selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${this.selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(this.selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n      }\r\n      this.selectedAttachmentId = item.attachmentId;\r\n      this.$emit(\"beforeSelect\", item);\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.selectedFile = item;\r\n\r\n      this.$emit(\"selectChange\", item);\r\n    },\r\n\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 生成预览\r\n     */\r\n    genPreview() {\r\n      if (!this.selectedFile || !this.selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (this.uploadAttachmentService) {\r\n        if (\r\n          this.selectedFile.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0\r\n        ) {\r\n          // 图片预览\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        } else if (this.selectedFile.name.includes(\"pdf\")) {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          // pdf预览\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n          // window.open(`/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`);\r\n        } else if (this.selectedFile.name.includes(\"mp4\")) {\r\n          // this.attachmentService.playShortVideo(\r\n          //   this.videoUrl + \"/\" + this.selectedFile.name\r\n          // );\r\n        } else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n      this.$emit(\"preview\", this.selectedFile);\r\n    },\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    /**\r\n\t\t删除附件\r\n\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.selectedFile = null;\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    /**\r\n     * 拍照\r\n     */\r\n    takePhoto() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.ccWork.photo);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.cloudPlus.photo);\r\n      }\r\n    },\r\n    selectFromAlbum() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 选择文件服务\r\n        this.attachmentService.selectAttachment(this.cloudPlus.album);\r\n      }\r\n    },\r\n    /**\r\n\t\t拍摄短视频\r\n\t\t\t*/\r\n    takeShortVideo() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takeShortVideo(this.ccWork.video);\r\n      }\r\n    },\r\n\r\n    getVideoFile(file) {\r\n      const fileName = file.name;\r\n      const metadataId = file.url;\r\n      return { fileName, metadataId };\r\n    },\r\n\r\n    calculateImgSize(externalSize = 0) {\r\n      // 计算图片尺寸\r\n      const size = this.$refs.attach.getBoundingClientRect();\r\n      const naviSize = this.$refs.navigation.getBoundingClientRect();\r\n      const imgHeight = size.height - naviSize.height - externalSize;\r\n      if (this.$refs.imgContainer) {\r\n        const imgContainerHeight = this.$refs.imgContainer.getBoundingClientRect()\r\n          .height;\r\n        if (imgContainerHeight > imgHeight) {\r\n          this.imgHeight = imgContainerHeight;\r\n        }\r\n      } else {\r\n        this.imgHeight = imgHeight;\r\n      }\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n","<template>\r\n  <div class=\"farris-attachment attachment\" ref=\"attach\">\r\n    <van-uploader\r\n      :multiple=\"multiple\"\r\n      ref=\"fileUploadRef\"\r\n      :max-count=\"maxNum\"\r\n      v-model=\"rawFiles\"\r\n      :disabled=\"disabled\"\r\n      :preview-full-image=\"previewEnable\"\r\n      :accept=\"accept\"\r\n      :before-read=\"beforeRead\"\r\n      :after-read=\"afterRead\"\r\n      v-show=\"false\"\r\n    />\r\n    <div class=\"farris-attachment-img\">\r\n      <van-empty\r\n        description=\"附件为空\"\r\n        v-if=\"!selectedFile || (!selectedFile.url && !selectedFile.file)\"\r\n      />\r\n      <div\r\n        class=\"img-container\"\r\n        v-if=\"selectedFile && selectedFile.url\"\r\n        ref=\"imgContainer\"\r\n      >\r\n        <van-image\r\n          :height=\"imgHeight\"\r\n          fit=\"scale-down\"\r\n          :src=\"getAttachmentPathByType(selectedFile)\"\r\n          @click=\"genPreview\"\r\n          v-if=\"\r\n            selectedFile.name\r\n              .toLowerCase()\r\n              .search(\r\n                /\\.(png|jpe?g|gif|svg|ppt|pptx|xls|xlsx|doc|docx|txt|pdf)(\\?.*)?$/\r\n              ) >= 0\r\n          \"\r\n        />\r\n        <video\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mov')\r\n          \"\r\n        >\r\n          <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n        </video>\r\n        <video\r\n          :src=\"selectedFile.url\"\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            (selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mp4')) ||\r\n              selectedFile.name.toLowerCase().includes('webm') ||\r\n              selectedFile.name.toLowerCase().includes('ogg')\r\n          \"\r\n        >\r\n          您的浏览器不支持 video 标签。\r\n        </video>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          closeable\r\n          @closed=\"closed\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n          <div v-if=\"showDoc\" class=\"panzoom\" :style=\"docStyle\">\r\n            <div\r\n              v-for=\"(page, index) in previewPages\"\r\n              class=\"page\"\r\n              :style=\"{ width: 'unset', height: 'unset' }\"\r\n              :key=\"index\"\r\n            >\r\n              <div v-html=\"page.data\" v-if=\"page.data\"></div>\r\n            </div>\r\n          </div>\r\n        </van-popup>\r\n      </div>\r\n      <div v-if=\"selectedFile && selectedFile.file\"></div>\r\n      <!-- </van-col> -->\r\n    </div>\r\n    <div class=\"attachment-navigation\" ref=\"navigation\">\r\n      <van-grid clickable :column-num=\"gridNumber\">\r\n        <!-- 拍照  只有云+ 云上协同支持-->\r\n        <van-grid-item\r\n          text=\"拍摄\"\r\n          icon=\"photograph\"\r\n          @click=\"takePhoto\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.photo && ccWork.photo.isPhoto) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.photo &&\r\n                cloudPlus.photo.isPhoto) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 相册 均支持 -->\r\n        <van-grid-item\r\n          text=\"相册\"\r\n          icon=\"photo\"\r\n          @click=\"selectFromAlbum\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.album && ccWork.album.isAlbum) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.album &&\r\n                cloudPlus.album.isAlbum) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 目前只有云上协同支持 -->\r\n        <van-grid-item\r\n          text=\"短视频\"\r\n          icon=\"video\"\r\n          @click=\"takeShortVideo\"\r\n          v-if=\"pattern === 'ccWork' && ccWork.video && ccWork.video.isVideo\"\r\n        />\r\n        <!-- 选择文件 目前只有原生模式和云+支持 -->\r\n        <van-grid-item\r\n          text=\"文件\"\r\n          icon=\"card\"\r\n          @click=\"appendFile\"\r\n          v-if=\"\r\n            (pattern === 'cloudPlus' && cloudPlus.selectFile.isFile) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n      </van-grid>\r\n      <van-row type=\"flex\" justify=\"center\">\r\n        <van-col class=\"attachment-navigation-1 last-navigation\" span=\"24\">\r\n          <div\r\n            v-for=\"(item, index) in uploadFiles\"\r\n            :class=\"{\r\n              'attachment-navigation-item': true,\r\n              'selected-file': selectedFile\r\n                ? item.id === selectedFile.id &&\r\n                  selectedAttachmentId === selectedFile.attachmentId\r\n                : false,\r\n            }\"\r\n            :key=\"index\"\r\n            @touchstart=\"goTouchStart(item)\"\r\n            @click.stop=\"selectFile(item)\"\r\n          >\r\n            <van-image\r\n              :src=\"getAttachmentPathByType(item)\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item && item.name && !item.name.includes('mp4')) || !item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              src=\"/platform/runtime/dfs/images/file.png\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item &&\r\n                  item.name &&\r\n                  item.name.toLowerCase().includes('mp4')) ||\r\n                  item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n            <div\r\n              class=\"item-icon-delete\"\r\n              @click=\"deleteAttachment(item)\"\r\n              v-if=\"\r\n                selectedFile\r\n                  ? item.id === selectedFile.id &&\r\n                    selectedAttachmentId === selectedFile.attachmentId\r\n                  : false\r\n              \"\r\n            >\r\n              <span class=\"fm-icon fm-icon-close\"></span>\r\n            </div>\r\n          </div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n<style scoped lang=\"scss\">\r\n.attachment {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  & .farris-attachment-img {\r\n    display: flex;\r\n    flex: 1;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  & .img-container {\r\n    text-align: center;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  & video {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.preview-mask {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.farris-attachment {\r\n  clear: both;\r\n\r\n  // 附件组件背景和尺寸\r\n  & .attachment-detail {\r\n    background: #fff;\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n\r\n  // 选中附件样式\r\n  & .selected-file {\r\n    box-shadow: inset 0px 0px 3px 3px #59a1ff;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  & .attachment-navigation-1 {\r\n    overflow: auto;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & img {\r\n      border-radius: 5px;\r\n    }\r\n\r\n    & .item-pdf {\r\n      width: 100%;\r\n      height: 100%;\r\n      background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH5AIKAjsgUCRbrgAAEkxJREFUeNrtnHuUHFWdxz9V1a/peXT3PBJCXpMAMQGJuyuvREPgAMsqGCIEIQSFg7CHgCirrotP4Hh4iq4HQViQ4AsIj2RZ8YhodMEsENmgPJIhQ0LCMJNkMt2Z6Z7p6WfVvftHP6aquqq7OtHj/sHvnJqux+/+fr/7vb/7u79769bA+/Q+vU9/RVKaLbC+E4YUaBUwzQ/dGhSBgAItaulXA1SlVrh0UCxt1/VImvkkxFtjHPndnzDj5KUYuo6u6xQKBTKZDPl8Hp/PRzweZ9/evUxKydz2dk674IKm6uvzyvhAJ0wKCPtgVRh+kiA0zU+3gJ68YE4euguSQFABnwKaGQG32kvbtWJ7ptjKm+4pErKqj7yiMpGepJjPUSwWyefz5HK5gpQy0RoOvychvn94OPG5L3059+pLL/Lz+++nrb2dlWvWeKp3w4Z7MAondsDuHJw/grJxGsdENVZGNJb7FBYGFSISOgC/WhGoHIJrmgySHvkGdZXcWRfy0ZtuJxTrRBgGUkqEEABFRVEmcvl8Ui8Wd4wlk5sPJhIbl5x55tsvbdrEwsWLeeEXv+CTV1556AA91AkHivDRdthbZM5sP2s7NFYHFeb6DhWBvxApwEABXs/CwpUXseymO2jp7kaWwJniUxSklOi6TjabfTeZSj26Z8+e++f29g5u+vWzzJw5i3MuvthVj+b2YF25S31pDrw+wbLeIA90alwcVImqinMP8EJe+RvFJgVIGTCsw8G3tpOJH+DIE5bgb2sDWeuDqqoSCoWira2tyzra208Z3r+//9yLV7/3pz9u4YpL1vDIU095B+iBKMT1Eji/jHPO7ADrIhrHKSZrvXSDvzYlDTigl9CK920jM3KAmSd/BH9rqyNIFaBaWlpmh8Phs/q3bXv7zPPO2/nCc7/milUX8vgzzzg2RA29OhvSBiR1ls0J8Ei7xmwnvkPxokYxW/FY1tzFzLTo/NWcevOdhGKxmu5mp1QqNbh79+41XT3dmztnHEkkFqvhqfGgH8agKGDMYHZvgAc6fBznNLiYEXYCye26HgCNwLYPZqmKB5mUJPq3kxnez5En1fckgGAoFPEHAot29vf/dnRkJHXOGWfw+NNPW3hUe6GMgFVxmB3g6naNUyoGVQ7LtXS57+Ha7QAQHnicqi0VkELy1sbH+MNN/0Y2HkdRVdxIAWLR6Cnz5s9fu/Sss5T0xEQNj8WDHonA9CCsCrNgRoDvhFSirh5RtlCxNbdTcPXaFaUsy7PJrt63Va4SpC33ywNI4q1tZOMjHHnS0rqepGkaiqLMXnH22b+aPmPGwU/OmsUjmzc7A7S0A5aHISf4bMzHKnfs/zZkqaLi0MVsz+N928gm4qXAHQ7XAymaLxSGFp944otb581jw913V59ZMAgV4WcHCUU0lntJsb2MZLIJ3kbUbOolgb6nHuWFb32F7OhB1+7m8/nojMVOu+fb3w75nnvO+sx80eOHHj/dmsLCZgE4LJCaTaYoTTXMMcmRRwEpJX3/uR4pBMtvvtM1mfQHAgv/YenSHhRl0BWgLg0E9JSnD3+VJNAcj5CgaBpquA2EwJicqMaQqvEu8mX1T31dFWVvPf0EaBqnfvNWwj09FpCklIRCoUhnJNKt+f3uABWBnGCugI5D7RpePUpKUFta6f7Ct/AdMQcjcYDMK8+T/s3TFlRkHflmD6rbMGWQ+jY8BlKy/KY7aOnqsoAkhGjPZDJzW9rb/2wuaumUwdIkswvwN4lLw0rUACcgvOR0Yld9kfyubYz/6gmia9aiTZ9ZL3XxrNtuQwXBvo3reeHmG8iNjVlikqIofhRlRltXl0WeNUirEFQJVLpAM4c5dwFnUCxlJPhnzUHx+zDGEmS2vkR+Zx+BeUcjhXe9lRNZPpAgTNfS9LxCfRvX8/yNXyF7cCpwq6qK3++PzZzba7HZZ78IKFOVOdTWs5PTEkapVUuOKosFpA7pTc9gjI/XeoBDHuTWCI1sqQjcvuExpJAsv/E2wj09KIqCpmlhVbOOdBaANGUqMbK7eWlEcEgMzcmdYiqn1IJjlymlUWZSQYXsjjdALyLNNkp3e9xAsa9W2hur8mz7xvWgKpx2420EojHQtJrQUpPuOGXGislAp/ggzf3KXjGcqeT+ZYD8/pI35HOIQramvFtW7uZB9bzHnmxuf+oxUFVO/cYtqP5ATaLkcxPiUFfPq31eSAJGKgWA2hoBDVpOXEZm6x8QmcmqPqcKexniPZNSSiaFbtC94kIFzWgMUD3QvC5H1FTIahMoUNizE5GeILRoMWpHlOAxxzL5yvOWMk4yK89iGvxdS/P21Nol4TdPMLh1M/NH97oD5DRrblTZZp9XeRQoJoYxxpP458wjMH8hWnsUUSjU2OMmI6xCqzoF+uE4lUCQP7CXaT3Avqn7tZMTaT11G67rPbdXznG5QwF97CD5d3YS6D2ayMdWIYwiUjdclzacfoXLUS8NES5lpQPKFoDqeZBZsBMAbms29RI3I5Mht3M7vu4eYpdeRXH/EELUD7xuGb5T3HRbZ3Iqb7bLFSA34XYlTooageR4X0Jm68tIXUcNBinsG2hoQ6MEtZH9rrJckLN6kImpnje4tRBNPKfcWpk3XkEfGUbqRYzJiVIu5VCmkXfaAWvU4G722qmmi1VbxJT3CHNcMqfxpmvhAqpZuTBNAyr8enIMfTSB2tpGy3EfnpJZtkWYeJuyp0HjmG2y2N0oBll+HQzBqYCTsWWN5nlRjR4BwWOOJTBrLgCdn7oMrbOzWtbusl7skTZ++yEcbLKvrXvzoL/ggdt9n0rnhZeh+APoiTgtHzqByFkrm5qsNhVnGtnTCCAnahSLnHhqPMXJKAGhoxfRcca5pH7/LAfuuwtF0+i56noCs2YjhbO+ZuxxqosXu10BMvd/L8Ok12DqyK9A9BMX4eueRvJXG0g8/iPSr7xIy6Lj6fnMteDTqrZwiPbIJu6bdbkD5NYnZX0FXt25Wl5AsPcYui68jFz/Nia2PE8xMcq+u25EHxul54rPEf2nCxCiVp+TNxxOd7TLahikHQublzHMiLsEzqoc6cBbfh79xEUEZs0hsf5hCgeGwQcTL/+e4btvQw21MPOrt9J2whKEUavDoR6u9iAdGstl4HBaqaiJQdKm0Ow99iHVblwN0g5KhYDQUR+g59KryO/ZRfI3T5dSfEAKyYGf3cvIz/6DYO9R9H5vHR1LT0caUyOPueLCgz3SZI+0tz7O5esCZPckt7jkyOfhAOg87xICM+dwcOOj5AbfnUoOFRDZLEN3fJ34Iw8SOnoh8/79YTpXrkbxBxAGpUMvHbL8KwzTuU51unJI9tmQqpnNO51D7cYBM4/iwm/mLXkIhI5aQNeqT5N7521GHl9XalXbbgh9bIz3bvoXCgeGOeLKzzPvew/RfvIy4o+vQw2ECMyagy8SQVF9KL4gis+HLBQQooAxnmTyta3k3t2JNIyalc16+yadvKhmPUiaBLkBUG9YtYNnKadC90VXEJw7j8HbvkZ+aKDkw5LSkAQofg1/dzf+aTPIDw2Q3dFH20lLmHb5Wro+uRo0H6o/gJ4aQxTypUX3au0V1JYwMp/jwI9/yP7770QWC6722BvciequB9mBqkeNeKWA8MIP0r3q00xue434+nVUVlx9sRihuUcTPfUfCR/7IcLHLkaLxEBKjPQ4yU3PInJZOj6yHF8kiiwUmNjyP4ys/xG5Pf1loBRQfQSmzaT95GVEz/g4Y5t+SWb7aw2zPXMYaQyQQ9Q/HGCmNGlMv+xa/NOOYOi7NyMMg9jHVhBZdibtJyzB3zUdPTVGfu97xDf8nNzAO2R3vImeGkUfG0UKQevxH6Zn1WeInXUunSsuoO3EUxh/8b9JPv8ck2++Wirz7gCpV14i+cJv0ccOVgeARlR9heg1BtkrX9c7XK6ri+sGRE5cStd5F1Pct5fwwsX0XPBptI4IuYHdJJ55ksk3/kSm7zWMdAojVyyVr+y4KldyYuvLpP+8heEf30Pn2SuJnv4xYmevoGvlxRipJOk3/kR+3wCKolCMx9l7zy2Wethts9veOAZJkxfZ3o855R2V7b6VVz9uuYmvvY0jr70BXzRKeuAdpK4z9INbyex4k2JiGJEv72HRynj4rC5ffdOigZCSyR3bmdyxnX3r7qZl/gLCHziejqWnEeqdT/gDH8SYTJN45kn0zOTUHiO7xzjY7K2LYe1qVQ91cKGaXMP8TIDW2oqq+Yme8XGip5/N+JbN9F97CcX9Q0hReh2GQvVlnDlzd9OjQCmmKGBMTjDx+qtMvPYqIxt+ihIIlLb9CoHI56vv8tzIXEc3trpdTHF46CTIoqDcMh2nnEr4qIVk+rcz89qvIHI5hu6+lcLeoRIgWq1ee3e2D832nR1VsAApBTKfszYo7jrsLBXHsG/79PRezLUF7NcGBKZNY8bl1xGa3cvg3bdwxKX/TOtxH2L4pw+QfPF3td7iIE+Uja/8eol9ssHzemXMSaK9jGsXc1Ng5rUYL6D1uMXM++ZdoCrs/NJnaV24mOlrriS7q5+h+7+DKBRL3cqj/EY8de1pgup9VuIIkP3cKQu1dAMBbcf/PQu+/xOMTJr+ay4BKZl7wy2owRCDP7id7O5dKFrziZobr5M9Xso7gWI6kYV6w7xlOdJhE5NjBi0gfNQCFnz/x2gtYfqvu5TiaJxj7nyQ1uMWs++hexl5+lHrhgRbDZtp9Ubdyolcd5eYzsuxRyStb56tABmALpswWIIaDDL781+nZf4C+q/7DJldbzHvhtvoOX81yT/8jsF7bkUUCigqtfMuB0WVnSLlmYPr1hdXk6RJjkmN286UCm/5tBC37Zq1bsGTkJclNFXp7P6Wvi6gZd4COs88h/h/PUHylc303nAbM6/+Iuntr7PrxuvJ7d9XBccpHQCruzut/ZhHUDd7as4d7K9Z0zLdFxJ0SWakHkAZAXlBUZS7mJfRQxTzFPbvRU8lWXTvo0SWLCf54vPs+tb1pN/aVgKnjgzzVpZGGx8OZTTz2hsEoEvGDtoAskSGYklaQpb2czYmFTJ7dtK3djX6xDjG5CS7vvEF+q6+iHTfG1VwnEZH8zceTutLFaq3GcorIHYAnfQARQWG6wZpDQiqDAATEjrrrfdMaZSk3+4jfdc3Uf0+REEvTUFcPKdRbuNWqUNZfmkQ7iz2KDARVBmwjyUWgMYMkJCIaqT8Cp2KTWGFalq1LFXo+lRmi3O8cKuwHQy3Mp7scQGmHmAFSTJlELeXtwCWKMKuHHFdsqMy9Dml3/UybdnE4VZG2H4xXVcOL/a4eZY9bRFAUbJjV45E3Rg0CnwqRi4t2GzIxl2hXqWdWtvLx8+Kh/Nm7HFrjIpMCRgSJgSbV3WSS9Xb/rLAB2/mYNxgQ04yIBso92Jso2vZ4Bq879jw0phO13nJwITBxm1ZONomxALQtUnYW4Rrxtg5KXjMkFZhzRhwqJXxMhVxk+E0O29kjyFhUvDoNWO8PVSEtbZv6mpWa0MK3BtD7i9yX1qwRdQR7iWeuCWH1JHjNXZBfS+s3KtOnxz404It+4vcd28MWhz6sWPX3jAdcgakBcuO8PFIq8tHvQ1nmg7PzdMNc9Zb83WhyXs9/6MC0xTFC00aDA7rrGlT2RxS4YKRWh7H9f53MrAtCyuibB7RWTspGLRsUDK3mMSy4uc0StS8MZBWcLDLkVPAVCJpzb4B+68JTKe9SHZdkwaDIzprV0TYvC0Lu21fT1fI8bv53xbgvDBsmYTLutj5xwxbfQqL/AqznKYGXqYDh0tuo2HNCKi4l0MpxZy0YEsZnE0PJqBDg38dd9Zb1xnviJSSxw+GIKEze7qPq8MqlwRVeivLyWajndaAG/XCZgCq96GwY8A2PTCAgmQgbfDYiM59PT7e68tCzAdfTrnr1ahDm/KwMghdAcgJxq8Y5fenBni2KBlCoWhINKX0OtwvQPOSHB7ODjbA9bOraiIpS2AYpallKicYzkm2JA0eTuh87YpRnvxEC6moH7K6u+dYgPZCt3dAVsAMPxwVhOfGCfUG6Y6o9GQlc4AZGkQ1hRYJQWmaxrh5kb2bHo6nKaArkNclWQOSCgy3qAykDBLv5Yl/PEquPwf7CxBU4avjnuU2Rw93wv9mYKYfIj6IalCQpe/Mohq0adDjg5hq7XaVf4hSOa+AUhl5JKURo5JWaPbllnI5c9pR6UFCwqgBCQMmjNLn4kUJfqX0/z1SBrwr4SMqXJ7ifXqf3qf/P/R/ShQShKVd6yQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjhUMDk6MzE6NTYrMDA6MDC4axO5AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTAxLTA4VDE5OjQzOjU5KzAwOjAwnbLSDAAAACB0RVh0c29mdHdhcmUAaHR0cHM6Ly9pbWFnZW1hZ2ljay5vcme8zx2dAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAGHRFWHRUaHVtYjo6SW1hZ2U6OkhlaWdodAA1MTKPjVOBAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADUxMhx8A9wAAAAZdEVYdFRodW1iOjpNaW1ldHlwZQBpbWFnZS9wbmc/slZOAAAAF3RFWHRUaHVtYjo6TVRpbWUAMTU0Njk3NjYzOTogPbcAAAATdEVYdFRodW1iOjpTaXplADE4Mzc0NkJvZ7DBAAAAWnRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vZGF0YS93d3dyb290L3d3dy5lYXN5aWNvbi5uZXQvY2RuLWltZy5lYXN5aWNvbi5jbi9maWxlcy8xMTgvMTE4NDI1NS5wbmcVP1e2AAAAAElFTkSuQmCC\");\r\n      background-size: contain;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: -6px;\r\n      top: -6px;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n      border-radius: 50%;\r\n\r\n      .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .first-navigation {\r\n    max-width: 80%;\r\n  }\r\n\r\n  // 内置前置导航\r\n  & .first-navigation .attachment-navigation-item {\r\n    width: 55px;\r\n    height: 55px;\r\n  }\r\n\r\n  // 后置导航\r\n  & .last-navigation .attachment-navigation-item {\r\n    margin: 6px;\r\n    width: 80px;\r\n    height: 80px;\r\n  }\r\n\r\n  & .attachment-navigation-icon {\r\n    text-align: center;\r\n\r\n    & .add-icon {\r\n      margin: 8px 0;\r\n      width: 55px;\r\n      height: 55px;\r\n    }\r\n  }\r\n\r\n  & .van-grid-item .van-image img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .fixed-bottom {\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n  }\r\n\r\n  & .small-imgs-child {\r\n    width: 80px;\r\n    height: 80px;\r\n    background-size: contain;\r\n  }\r\n\r\n  & .small-imgs-item {\r\n    position: relative;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .small-imgs-item img {\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .action-grid {\r\n    position: absolute;\r\n    width: 100%;\r\n    bottom: 100px;\r\n  }\r\n\r\n  & .preview-img img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .upload-icon {\r\n    position: absolute;\r\n    top: 0.5rem;\r\n    left: 0.5rem;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 5%;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport {\r\n  Uploader,\r\n  Empty,\r\n  Image,\r\n  Popup,\r\n  Grid,\r\n  GridItem,\r\n  Row,\r\n  Col,\r\n  ImagePreview,\r\n} from \"vant\";\r\nimport { uuid } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment\",\r\n  components: {\r\n    \"van-uploader\": Uploader,\r\n    \"van-empty\": Empty,\r\n    \"van-image\": Image,\r\n    \"van-popup\": Popup,\r\n    \"van-grid\": Grid,\r\n    \"van-grid-item\": GridItem,\r\n    \"van-row\": Row,\r\n    \"van-col\": Col,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: null },\r\n  },\r\n  props: {\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      default:\r\n        \"application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain\",\r\n      // default: 'application/pdf,image/*,application/msword,text/html'\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 自定义进入附件组件的入口\r\n    allowDefaultEntrance: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    // 上传附件信息\r\n    uploadInfo: {\r\n      type: Object,\r\n      default: null,\r\n    },\r\n    // parentDirName\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 上传模式  html ccWork cloudPlus\r\n    pattern: {\r\n      type: String,\r\n      default: \"ccWork\",\r\n    },\r\n    // 云上协同配置\r\n    ccWork: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: \"high\",\r\n            mode: \"camera\",\r\n            mark: \"\",\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            mType: \"0\",\r\n            maxNum: 6,\r\n          },\r\n          video: {\r\n            id: \"af700826-7552-4858-a5e0-e64f5e20288b\",\r\n            quality: 0.8,\r\n            time: 15,\r\n            isVideo: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            mType: \"0\",\r\n            maxNum: 9,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 云+配置\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            maximum: 3,\r\n            fileType: \".jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|.txt\",\r\n            isFile: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 原生模式\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t弹出层显示\r\n\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      videoUrl: \"\",\r\n      selectedAttachmentId: \"\",\r\n      subscription: \"\",\r\n      // 图片尺寸\r\n      imgHeight: 0,\r\n      imhWidth: 0,\r\n      // 尺寸开关\r\n      hasFiles: false,\r\n      // 预览文件尺寸\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      const self = this;\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n          this.$nextTick(() => {\r\n            self.goTouchStart(this.selectedFile);\r\n          });\r\n        }\r\n        if (this.selectedAttachmentId) {\r\n          this.selectedFile = this.rawFiles.find(\r\n            (rawFile) => rawFile.attachmentId === this.selectedAttachmentId\r\n          );\r\n          if (this.selectedFile) {\r\n            // 上传成功后  选中新上传的附件且附件信息同步变更\r\n            this.$nextTick(() => {\r\n              self.goTouchStart(this.selectedFile);\r\n              this.$loading.hide();\r\n            });\r\n          }\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        // 没有url属性的 没有上传\r\n        if (!this.hasFiles) {\r\n          this.$nextTick(() => {\r\n            this.calculateImgSize(80);\r\n            this.hasFiles = true;\r\n          });\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      // 没有url属性的 没有上传\r\n      if (this.hasFiles) {\r\n        this.$nextTick(() => {\r\n          this.calculateImgSize();\r\n          this.hasFiles = false;\r\n        });\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n    // 拍照  选择文件  拍摄短视频等\r\n    gridNumber() {\r\n      if (this.pattern === \"ccWork\") {\r\n        return (\r\n          Number(this.ccWork.photo.isPhoto) +\r\n          Number(this.ccWork.video.isVideo) +\r\n          Number(this.ccWork.album.isAlbum)\r\n        );\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        return (\r\n          Number(this.cloudPlus.photo.isPhoto) +\r\n          Number(this.cloudPlus.selectFile.isFile) +\r\n          Number(this.cloudPlus.album.isAlbum)\r\n        );\r\n      } else {\r\n        // 原生模式\r\n        return 3;\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n  },\r\n  mounted() {\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          console.log(res);\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n    this.$loading.hide();\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"html\") {\r\n        this.$refs.fileUploadRef.chooseFile();\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        // 选择文件服务\r\n        this.attachmentService.getSysInfo().subscribe((res) => {\r\n          if (res && res.platform === \"Android\") {\r\n            this.attachmentService.selectFile(this.cloudPlus.selectFile);\r\n          } else if (res && res.platform === \"iOS\") {\r\n            this.$refs.fileUploadRef.chooseFile();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 使用h5文件API 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      console.log(file);\r\n      this.$loading.show(\"附件上传中\");\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      if (this.notUploadedFileList.length > this.maxNum) {\r\n        this.$notify.warning(\"最多上传\" + this.maxNum + \"个附件\");\r\n        return;\r\n      }\r\n      // 赋值最新的上传文件附件id\r\n      this.selectedAttachmentId = this.notUploadedFileList[0].id;\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n\r\n    goTouchStart(item) {\r\n      this.selectedFile = item;\r\n      if (\r\n        (this.selectedFile.name &&\r\n          this.selectedFile.name.toLowerCase().includes(\"mp4\")) ||\r\n        this.selectedFile.name.toLowerCase().includes(\"webm\") ||\r\n        this.selectedFile.name.toLowerCase().includes(\"ogg\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          this.selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${this.selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(this.selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n      }\r\n      this.selectedAttachmentId = item.attachmentId;\r\n      this.$emit(\"beforeSelect\", item);\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.selectedFile = item;\r\n\r\n      this.$emit(\"selectChange\", item);\r\n    },\r\n\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 生成预览\r\n     */\r\n    genPreview() {\r\n      if (!this.selectedFile || !this.selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (this.uploadAttachmentService) {\r\n        if (\r\n          this.selectedFile.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0\r\n        ) {\r\n          // 图片预览\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        } else if (this.selectedFile.name.includes(\"pdf\")) {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          // pdf预览\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n          // window.open(`/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`);\r\n        } else if (this.selectedFile.name.includes(\"mp4\")) {\r\n          // this.attachmentService.playShortVideo(\r\n          //   this.videoUrl + \"/\" + this.selectedFile.name\r\n          // );\r\n        } else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n      this.$emit(\"preview\", this.selectedFile);\r\n    },\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    /**\r\n\t\t删除附件\r\n\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.selectedFile = null;\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    /**\r\n     * 拍照\r\n     */\r\n    takePhoto() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.ccWork.photo);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.cloudPlus.photo);\r\n      }\r\n    },\r\n    selectFromAlbum() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 选择文件服务\r\n        this.attachmentService.selectAttachment(this.cloudPlus.album);\r\n      }\r\n    },\r\n    /**\r\n\t\t拍摄短视频\r\n\t\t\t*/\r\n    takeShortVideo() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takeShortVideo(this.ccWork.video);\r\n      }\r\n    },\r\n\r\n    getVideoFile(file) {\r\n      const fileName = file.name;\r\n      const metadataId = file.url;\r\n      return { fileName, metadataId };\r\n    },\r\n\r\n    calculateImgSize(externalSize = 0) {\r\n      // 计算图片尺寸\r\n      const size = this.$refs.attach.getBoundingClientRect();\r\n      const naviSize = this.$refs.navigation.getBoundingClientRect();\r\n      const imgHeight = size.height - naviSize.height - externalSize;\r\n      if (this.$refs.imgContainer) {\r\n        const imgContainerHeight = this.$refs.imgContainer.getBoundingClientRect()\r\n          .height;\r\n        if (imgContainerHeight > imgHeight) {\r\n          this.imgHeight = imgContainerHeight;\r\n        }\r\n      } else {\r\n        this.imgHeight = imgHeight;\r\n      }\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n",null,null,null,"<template>\r\n  <div>\r\n    <div class=\"p-md attachment-bg\">\r\n      <div\r\n        class=\"farris-attachment-entry\"\r\n        :class=\"{\r\n          'farris-attachment-entry-vertical': direction === 'vertical',\r\n        }\"\r\n      >\r\n        <van-uploader\r\n          :multiple=\"multiple\"\r\n          ref=\"fileUploadRef\"\r\n          :max-count=\"maxNum\"\r\n          v-model=\"rawFiles\"\r\n          :disabled=\"disabled\"\r\n          :preview-full-image=\"true\"\r\n          :accept=\"accept\"\r\n          :before-read=\"beforeRead\"\r\n          :after-read=\"afterRead\"\r\n          v-show=\"false\"\r\n        />\r\n        <div\r\n          class=\"fm-attachment-container attachment-navigation\"\r\n          v-if=\"direction === 'horizontal'\"\r\n        >\r\n          <div class=\"fm-attachment-files-list\">\r\n            <div\r\n              class=\"fm-attachment-files-item attachment-navigation-item\"\r\n              v-for=\"(item, index) in uploadFiles\"\r\n              :key=\"index\"\r\n              @click.stop=\"downloadAttachment(item)\"\r\n            >\r\n              <van-image\r\n                :src=\"item.content || item.url\"\r\n                class=\"item-img\"\r\n                width=\"100%\"\r\n                height=\"100%\"\r\n                v-if=\"\r\n                  (item && item.name && !item.name.includes('mp4')) ||\r\n                    !item.name\r\n                \"\r\n              />\r\n              <van-image\r\n                :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                class=\"item-img\"\r\n                width=\"48\"\r\n                height=\"48\"\r\n                v-if=\"\r\n                  (item &&\r\n                    item.name &&\r\n                    item.name.toLowerCase().includes('mp4')) ||\r\n                    item.name.toLowerCase().includes('mov')\r\n                \"\r\n              />\r\n              <div\r\n                class=\"item-icon-delete\"\r\n                :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n                @click.stop=\"deleteAttachment(item)\"\r\n                v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n              >\r\n                <span class=\"fm-icon fm-icon-close\"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"fm-attachment-upload-btn-container\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            v-if=\"!removable\"\r\n            @click=\"toUpload\"\r\n          >\r\n            <div class=\"fm-attachment-upload-btn\">\r\n              <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <fm-action-sheet\r\n          v-model:show=\"isSelectAction\"\r\n          :actions=\"actions\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n        >\r\n          <div class=\"attachment-actionsheet-content\">\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableAlbum,\r\n              }\"\r\n              @click=\"selectFileFromAlbum\"\r\n              v-if=\"uploadOptions && uploadOptions.showAlbum\"\r\n            >\r\n              <span class=\"demo-actionsheet-item-text\">从相册选择</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takePhoto\"\r\n              v-if=\"uploadOptions && uploadOptions.showPhoto\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">相机</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takeShortVideo\"\r\n              v-if=\"uploadOptions && uploadOptions.showVideo\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">短视频</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableFile,\r\n              }\"\r\n              @click=\"selectFileFromMobile\"\r\n              v-if=\"uploadOptions && uploadOptions.showFile\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">手机文件</span>\r\n            </div>\r\n          </div>\r\n        </fm-action-sheet>\r\n        <fm-action-sheet\r\n          v-model:show=\"isPreviewAction\"\r\n          :actions=\"previewAction\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n          @select=\"selectAction\"\r\n        >\r\n        </fm-action-sheet>\r\n        <fm-listview\r\n          :listData=\"uploadFiles\"\r\n          :finished=\"true\"\r\n          :showFinishedText=\"false\"\r\n          className=\"listview-content\"\r\n          v-if=\"direction === 'vertical'\"\r\n        >\r\n          <template v-slot:listViewHeader\r\n            ><div style=\"padding:.5rem 0\">\r\n              附件({{ uploadFiles.length\r\n              }}<span v-if=\"allowMaxCount\"\r\n                >/{{ Math.max(uploadFiles.length, maxCount) }}</span\r\n              >)\r\n            </div></template\r\n          >\r\n          <template v-slot=\"props\">\r\n            <div\r\n              class=\"fm-tmpl-listview-attachment\"\r\n              @click.stop=\"openDownloadList(props.item)\"\r\n            >\r\n              <div class=\"fm-tmpl-attachment-img\">\r\n                <van-image\r\n                  :src=\"props.item.content || props.item.url\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      !props.item.name.includes('mp4')) ||\r\n                      !props.item.name\r\n                  \"\r\n                />\r\n                <van-image\r\n                  :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      props.item.name.toLowerCase().includes('mp4')) ||\r\n                      props.item.name.toLowerCase().includes('mov')\r\n                  \"\r\n                />\r\n              </div>\r\n              <div class=\"attachment-text\">\r\n                <div>\r\n                  <div class=\"fm-tmpl-attachment-name\">\r\n                    <span>{{ props.item.name }}</span>\r\n                  </div>\r\n                  <div class=\"attachment-button\">\r\n                    <fm-button\r\n                      className=\"attachment-button-custom\"\r\n                      color=\"#3A90FF\"\r\n                      plain\r\n                      @click.stop=\"genPreview(props.item)\"\r\n                      >预览</fm-button\r\n                    >\r\n                  </div>\r\n                </div>\r\n                <div class=\"fm-tmpl-attachment-footer\">\r\n                  <span class=\"fm-tmpl-attachment-footer-text\">{{\r\n                    transformSize(props.item.size)\r\n                  }}</span>\r\n                  <span>{{ props.item.createTime }}</span>\r\n                </div>\r\n              </div>\r\n              <div\r\n                class=\"attachment-icon\"\r\n                @click.stop=\"deleteAttachment(props.item)\"\r\n                v-if=\"!removable\"\r\n              >\r\n                <fm-icon name=\"s-clear\" color=\"#888\" size=\"16\" />\r\n              </div>\r\n            </div>\r\n          </template>\r\n          <template v-slot:listviewEmpty><span></span></template>\r\n        </fm-listview>\r\n        <div\r\n          class=\"fm-attachment-upload-listview-btn-container\"\r\n          :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n          v-if=\"\r\n            !removable &&\r\n              direction === 'vertical' &&\r\n              ((allowMaxCount && uploadFiles.length < maxCount) ||\r\n                !allowMaxCount)\r\n          \"\r\n          @click=\"toUpload\"\r\n        >\r\n          <div class=\"fm-attachment-upload-btn\">\r\n            <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n          </div>\r\n        </div>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n        </van-popup>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nimport { uuid, UploadOptions } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-file\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      //default:'application/vnd.ms-powerpoint MS PowerPoint Presentation,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword MS Word Document,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel MS Excel Spreadsheet,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf Portable Document Format'\r\n      default:\r\n        \"application/msexcel,\" +\r\n        \"application/msword,\" +\r\n        \"application/vnd.ms-powerpoint,\" +\r\n        // pdf\r\n        \"application/pdf,\" +\r\n        // txt\r\n        \"text/plain,\" +\r\n        // ppt  pptx\r\n        \"application/vnd.openxmlformats-officedocument.presentationml.presentation,\" +\r\n        // xls xlsx\r\n        \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,\" +\r\n        // doc docx\r\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document,\" +\r\n        \"image/jpg,image/gif,image/jpeg,image/png,image/bmp\",\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    maxNum: {\r\n      type: Number,\r\n      default: 9,\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"vertical\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            // isPhoto: true\r\n          },\r\n          album: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n          selectFile: {\r\n            maximum: 5,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          },\r\n        };\r\n      },\r\n    },\r\n    uploadOptions: {\r\n      type: UploadOptions,\r\n      default: () => {\r\n        return {\r\n          showPhoto: true,\r\n          showAlbum: true,\r\n          showVideo: false,\r\n          showFile: true,\r\n          // 照片质量\r\n          photoQuality: 100,\r\n          // 相册图片质量\r\n          albumQuality: 100,\r\n          // 文件上传数量\r\n          fileMaxCount: 6,\r\n          // 短视频id\r\n          videoId: uuid(),\r\n          // 短视频质量\r\n          videoQuality: 0.8,\r\n          // 短视频时间\r\n          videoTime: 30,\r\n        };\r\n      },\r\n    },\r\n    disablePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 禁用\r\n    disableAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableVideo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 隐藏\r\n    hidePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 上传图片的最大数量\r\n    maxCount: {\r\n      type: Number,\r\n      default: 30,\r\n    },\r\n    // 上传图片最大尺寸  默认10M\r\n    maxSize: {\r\n      type: Number,\r\n      default: 20,\r\n    },\r\n    displayMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxSize: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      subscription: \"\",\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      showVideo: false,\r\n      isSelectAction: false,\r\n      isPreviewAction: false,\r\n      docStyle: {},\r\n      actions: [\r\n        { name: \"从相册选择\", disabled: this.albumDisabled },\r\n        { name: \"相机\", disabled: this.photoDisabled },\r\n        { name: \"手机文件\", disabled: this.fileDisabled },\r\n      ],\r\n      previewAction: [{ name: \"在线预览\" }, { name: \"下载\" }],\r\n      navibarDisplay: \"\",\r\n      footerDisplay: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n        }\r\n        if (this.selectedFile) {\r\n          this.$loading.hide();\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    // 处理原生返回\r\n    setTimeout(() => {\r\n      window.top[\"detailBackBtnClickHandler\"] = (backFn) => {\r\n        const pageElem = window.top.document.querySelector(\r\n          \".fm-page-record-deatial\"\r\n        );\r\n        const attachPreviewContainer = pageElem.querySelector(\r\n          \"#fm-attach-preview-container\"\r\n        );\r\n        if (!pageElem || !attachPreviewContainer) {\r\n          return true;\r\n        } else {\r\n          try {\r\n            this.closeScale(window.top.document);\r\n            pageElem.removeChild(attachPreviewContainer);\r\n            return false;\r\n          } catch (e) {\r\n            return true;\r\n          }\r\n        }\r\n      };\r\n    }, 0);\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  },\r\n  methods: {\r\n    openScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    closeScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    transformSize(size) {\r\n      if (size < Math.pow(1024, 2)) {\r\n        return (size / 1024).toFixed(2) + \"KB\";\r\n      } else if (size >= Math.pow(1024, 2) && size < Math.pow(1024, 3)) {\r\n        return (size / Math.pow(1024, 2)).toFixed(2) + \"MB\";\r\n      } else if (size >= Math.pow(1024, 3) && size < Math.pow(1024, 4)) {\r\n        return (size / Math.pow(1024, 3)).toFixed(2) + \"GB\";\r\n      }\r\n    },\r\n    selectAction(res) {\r\n      const actionName = res.name;\r\n      if (actionName === \"在线预览\") {\r\n        this.genPreview(this.selectedFile);\r\n      } else if (actionName === \"下载\") {\r\n        this.downloadAttachment(this.selectedFile);\r\n      }\r\n    },\r\n\r\n    selectFileFromMobile() {\r\n      if (this.disableFile) {\r\n        return;\r\n      }\r\n      this.attachmentService.getSysInfo().subscribe((res) => {\r\n        if (res && res.platform === \"Android\") {\r\n          this.attachmentService.selectFile({\r\n            maximum:\r\n              (this.uploadOptions && this.uploadOptions.fileMaxCount) || 6,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          });\r\n        } else if (res && res.platform === \"iOS\") {\r\n          this.$refs.fileUploadRef.chooseFile();\r\n        }\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    selectFileFromAlbum() {\r\n      if (this.disableAlbum) {\r\n        return;\r\n      }\r\n      this.attachmentService.selectAttachment({\r\n        quality: (this.uploadOptions && this.uploadOptions.albumQuality) || 100,\r\n        encodingType: 1,\r\n        mType: 0,\r\n        // 云+默认最多8张不支持配置  故此属性不作为输入属性\r\n        maxNum: 8,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takePhoto() {\r\n      if (this.disablePhoto) {\r\n        return;\r\n      }\r\n      this.attachmentService.takePhoto({\r\n        quality: (this.uploadOptions && this.uploadOptions.photoQuality) || 100,\r\n        encodingType: 1,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takeShortVideo() {\r\n      this.attachmentService.takeShortVideo({\r\n        id: (this.uploadOptions && this.uploadOptions.videoId) || uuid(),\r\n        quality: 0.8,\r\n        time: (this.uploadOptions && this.uploadOptions.videoTime) || 20,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n    },\r\n\r\n    toUpload() {\r\n      this.isSelectAction = true;\r\n    },\r\n    onCancel() {\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    afterRead(file) {\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // 允许设置最大尺寸\r\n      if (this.allowMaxSize) {\r\n        const beyondLimit = this.notUploadedFileList.some((f) => {\r\n          const realStr = f.content.substring(f.content.indexOf(\",\") + 1);\r\n          const realStrLen = realStr.length;\r\n          // base64转换成字节\r\n          const fSize = parseInt(realStrLen - (realStrLen / 8) * 2);\r\n          return fSize > this.maxSize * Math.pow(1024, 2);\r\n        });\r\n        if (beyondLimit) {\r\n          this.$dialog.alert({\r\n            title: \"上传失败\",\r\n            message: \"上传文件太大，请重新选择！\",\r\n          });\r\n          return;\r\n        }\r\n      }\r\n      //   计算附件上传数量\r\n      if (this.allowMaxCount) {\r\n        if (\r\n          this.notUploadedFileList.length + this.uploadFiles.length >\r\n          this.maxCount\r\n        ) {\r\n          const removedCount =\r\n            this.notUploadedFileList.length +\r\n            this.uploadFiles.length -\r\n            this.maxCount;\r\n          const count = this.notUploadedFileList.length - removedCount;\r\n          this.notUploadedFileList = this.notUploadedFileList.slice(0, count);\r\n        }\r\n      }\r\n      this.$loading.show(\"附件上传中\");\r\n      // 赋值最新的上传文件附件id\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      this.selectedFile = selectedFile;\r\n      // 隐藏工作流工具栏\r\n      //this.hideWorkFlowNavibar();\r\n      if (this.findWorkFlow()) {\r\n        this.previewFileInWorkFlow(\r\n          selectedFile.attachmentId,\r\n          this.rootId,\r\n          selectedFile.name\r\n        );\r\n      } else {\r\n        if (window.top && window.top !== window.self) {\r\n          this.openScale(window.top.document);\r\n        }\r\n        this.openScale(window.document);\r\n        if (\r\n          selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n          selectedFile.name.toLowerCase().includes(\"mov\")\r\n        ) {\r\n          this.show = true;\r\n          this.showPdf = false;\r\n          this.showDoc = false;\r\n          this.showVideo = true;\r\n          const videoUrl = selectedFile.content || selectedFile.url;\r\n          this.attachmentService.playShortVideo(\r\n            videoUrl + \"/\" + selectedFile.name\r\n          );\r\n        }\r\n        else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback(this.closed);\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n\r\n    getAttachmentUrl(attachmentId) {\r\n      var ishttps = \"https:\" == document.location.protocol ? true : false;\r\n      var url = window.location.host;\r\n      if (ishttps) {\r\n        url = \"https://\" + url;\r\n      } else {\r\n        url = \"http://\" + url;\r\n      }\r\n      url += this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n      return url;\r\n    },\r\n    downloadAttachment(attachment) {\r\n      const attachmentName = attachment.name;\r\n      const attachmentUrl = this.getAttachmentUrl(attachment.attachmentId);\r\n      const options = {\r\n        url: attachmentUrl,\r\n        saveName: attachmentName,\r\n        // autoOpen,\r\n      };\r\n      this.attachmentService.downloadAttachment(options).subscribe((res) => {});\r\n    },\r\n    closed() {\r\n      if (window.top && window.top !== window.self) {\r\n        this.closeScale(window.top.document);\r\n      }\r\n      this.closeScale(window.document);\r\n      // 隐藏工作流头部工具栏\r\n      //this.displayWorkFlowNavibar();\r\n      this.show = false;\r\n      this.showPdf = false;\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback();\r\n      }\r\n    },\r\n    hideWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        this.navibarDisplay = window.top.getComputedStyle(\r\n          workFlowNavibar\r\n        ).display;\r\n        workFlowNavibar.style.display = \"none\";\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        this.footerDisplay = window.top.getComputedStyle(\r\n          workFlowFooter\r\n        ).display;\r\n        workFlowFooter.style.display = \"none\";\r\n      }\r\n    },\r\n    displayWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        workFlowNavibar.style.display = this.navibarDisplay;\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        workFlowFooter.style.display = this.footerDisplay;\r\n      }\r\n    },\r\n\r\n    findWorkFlow() {\r\n      if (window.top === window.self) {\r\n        return false;\r\n      }\r\n      const isWorkFlow = window.top.location.href.includes(\r\n        \"/platform/runtime/wf/webapp/\"\r\n      );\r\n      return isWorkFlow;\r\n    },\r\n\r\n    /**\r\n     * 预览附件\r\n     */\r\n    previewFileInWorkFlow(attachId, rootId, fileName) {\r\n      // 打开缩放\r\n      this.openScale(window.top.document);\r\n\r\n      fileName = fileName || \"附件预览\";\r\n      const previewUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${attachId}&rootId=${rootId}&fileType=2`;\r\n      const previewHtml = `\r\n              <div class=\"fm-file-preview\">\r\n\r\n              <div class=\"fm-file-preview-header\">\r\n                <nav class=\"fm-navbar\">\r\n                    <div id=\"fm-attach-preview-back-btn\" class=\"fm-navbar-left fm-navbar-left-padding\">\r\n                        <span class=\"fm-navbar-left-arrow fm-icon fm-icon-arrow-chevron-left\"></span>\r\n                    </div>\r\n                    <div class=\"fm-navbar-title\">${fileName}</div>\r\n                </nav>\r\n              </div>\r\n                <div class=\"fm-file-preview-content\">\r\n                  <div class=\"preview-content\">\r\n                    <iframe src=\"${previewUrl}\"></iframe>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            `;\r\n\r\n      const pageElem = window.top.document.querySelector(\r\n        \".fm-page-record-deatial\"\r\n      );\r\n\r\n      // 预览容器\r\n      const previewContainerElem = document.createElement(\"div\");\r\n      previewContainerElem.id = \"fm-attach-preview-container\";\r\n      previewContainerElem.classList.add(\"fm-attach-preview-container\");\r\n      previewContainerElem.innerHTML = previewHtml;\r\n\r\n      // 返回按钮处理\r\n      const backBtn = previewContainerElem.querySelector(\"div.fm-navbar-left\");\r\n      backBtn.addEventListener(\"click\", () => {\r\n        this.closeScale(window.top.document);\r\n        pageElem.removeChild(previewContainerElem);\r\n      });\r\n\r\n      pageElem.appendChild(previewContainerElem);\r\n    },\r\n    openDownloadList(item) {\r\n      this.isPreviewAction = true;\r\n      this.selectedFile = item;\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.attachment-actionsheet-item-disabled {\r\n  color: #ccc;\r\n}\r\n.attachment-actionsheet-content {\r\n  flex: 1 auto;\r\n  overflow-y: auto;\r\n  .attachment-actionsheet-item {\r\n    display: block;\r\n    width: 100%;\r\n    padding: 14px 16px;\r\n    font-size: 16px;\r\n    text-align: center;\r\n    background-color: #fff;\r\n    border: none;\r\n    cursor: pointer;\r\n    text-align: center;\r\n  }\r\n}\r\n.attachment-bg {\r\n  background: #fff;\r\n}\r\n.listview-content {\r\n  .fm-listview-item {\r\n    margin: 12px 0;\r\n  }\r\n  .fm-tmpl-attachment-img {\r\n    width: 48px;\r\n    height: 48px;\r\n    margin: auto 0;\r\n    .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    img {\r\n      border-radius: 3px;\r\n      width: 48px;\r\n      height: 48px;\r\n    }\r\n  }\r\n  .attachment-text {\r\n    flex: 1;\r\n    margin: auto 12px;\r\n    & > div {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 5px;\r\n    }\r\n  }\r\n  .fm-tmpl-attachment-name {\r\n    line-height: 22px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 16px;\r\n    color: #333333;\r\n    letter-spacing: 0.21px;\r\n    margin-bottom: 2px;\r\n    word-break: break-all;\r\n  }\r\n  .fm-tmpl-attachment-footer {\r\n    line-height: 18px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 12px;\r\n    color: #888888;\r\n    letter-spacing: 0;\r\n  }\r\n  .fm-tmpl-listview-attachment {\r\n    padding: 0;\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n  .attachment-button {\r\n    .attachment-button-custom {\r\n      padding: 0;\r\n      width: 50px;\r\n      height: 20px;\r\n      font-family: PingFangSC-Regular;\r\n      font-size: 12px;\r\n      letter-spacing: 0;\r\n      border-radius: 10px;\r\n    }\r\n  }\r\n  .attachment-icon {\r\n    margin: auto 0;\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <div class=\"p-md attachment-bg\">\r\n      <div\r\n        class=\"farris-attachment-entry\"\r\n        :class=\"{\r\n          'farris-attachment-entry-vertical': direction === 'vertical',\r\n        }\"\r\n      >\r\n        <van-uploader\r\n          :multiple=\"multiple\"\r\n          ref=\"fileUploadRef\"\r\n          :max-count=\"maxNum\"\r\n          v-model=\"rawFiles\"\r\n          :disabled=\"disabled\"\r\n          :preview-full-image=\"true\"\r\n          :accept=\"accept\"\r\n          :before-read=\"beforeRead\"\r\n          :after-read=\"afterRead\"\r\n          v-show=\"false\"\r\n        />\r\n        <div\r\n          class=\"fm-attachment-container attachment-navigation\"\r\n          v-if=\"direction === 'horizontal'\"\r\n        >\r\n          <div class=\"fm-attachment-files-list\">\r\n            <div\r\n              class=\"fm-attachment-files-item attachment-navigation-item\"\r\n              v-for=\"(item, index) in uploadFiles\"\r\n              :key=\"index\"\r\n              @click.stop=\"downloadAttachment(item)\"\r\n            >\r\n              <van-image\r\n                :src=\"item.content || item.url\"\r\n                class=\"item-img\"\r\n                width=\"100%\"\r\n                height=\"100%\"\r\n                v-if=\"\r\n                  (item && item.name && !item.name.includes('mp4')) ||\r\n                    !item.name\r\n                \"\r\n              />\r\n              <van-image\r\n                :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                class=\"item-img\"\r\n                width=\"48\"\r\n                height=\"48\"\r\n                v-if=\"\r\n                  (item &&\r\n                    item.name &&\r\n                    item.name.toLowerCase().includes('mp4')) ||\r\n                    item.name.toLowerCase().includes('mov')\r\n                \"\r\n              />\r\n              <div\r\n                class=\"item-icon-delete\"\r\n                :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n                @click.stop=\"deleteAttachment(item)\"\r\n                v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n              >\r\n                <span class=\"fm-icon fm-icon-close\"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"fm-attachment-upload-btn-container\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            v-if=\"!removable\"\r\n            @click=\"toUpload\"\r\n          >\r\n            <div class=\"fm-attachment-upload-btn\">\r\n              <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <fm-action-sheet\r\n          v-model:show=\"isSelectAction\"\r\n          :actions=\"actions\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n        >\r\n          <div class=\"attachment-actionsheet-content\">\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableAlbum,\r\n              }\"\r\n              @click=\"selectFileFromAlbum\"\r\n              v-if=\"uploadOptions && uploadOptions.showAlbum\"\r\n            >\r\n              <span class=\"demo-actionsheet-item-text\">从相册选择</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takePhoto\"\r\n              v-if=\"uploadOptions && uploadOptions.showPhoto\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">相机</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takeShortVideo\"\r\n              v-if=\"uploadOptions && uploadOptions.showVideo\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">短视频</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableFile,\r\n              }\"\r\n              @click=\"selectFileFromMobile\"\r\n              v-if=\"uploadOptions && uploadOptions.showFile\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">手机文件</span>\r\n            </div>\r\n          </div>\r\n        </fm-action-sheet>\r\n        <fm-action-sheet\r\n          v-model:show=\"isPreviewAction\"\r\n          :actions=\"previewAction\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n          @select=\"selectAction\"\r\n        >\r\n        </fm-action-sheet>\r\n        <fm-listview\r\n          :listData=\"uploadFiles\"\r\n          :finished=\"true\"\r\n          :showFinishedText=\"false\"\r\n          className=\"listview-content\"\r\n          v-if=\"direction === 'vertical'\"\r\n        >\r\n          <template v-slot:listViewHeader\r\n            ><div style=\"padding:.5rem 0\">\r\n              附件({{ uploadFiles.length\r\n              }}<span v-if=\"allowMaxCount\"\r\n                >/{{ Math.max(uploadFiles.length, maxCount) }}</span\r\n              >)\r\n            </div></template\r\n          >\r\n          <template v-slot=\"props\">\r\n            <div\r\n              class=\"fm-tmpl-listview-attachment\"\r\n              @click.stop=\"openDownloadList(props.item)\"\r\n            >\r\n              <div class=\"fm-tmpl-attachment-img\">\r\n                <van-image\r\n                  :src=\"props.item.content || props.item.url\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      !props.item.name.includes('mp4')) ||\r\n                      !props.item.name\r\n                  \"\r\n                />\r\n                <van-image\r\n                  :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      props.item.name.toLowerCase().includes('mp4')) ||\r\n                      props.item.name.toLowerCase().includes('mov')\r\n                  \"\r\n                />\r\n              </div>\r\n              <div class=\"attachment-text\">\r\n                <div>\r\n                  <div class=\"fm-tmpl-attachment-name\">\r\n                    <span>{{ props.item.name }}</span>\r\n                  </div>\r\n                  <div class=\"attachment-button\">\r\n                    <fm-button\r\n                      className=\"attachment-button-custom\"\r\n                      color=\"#3A90FF\"\r\n                      plain\r\n                      @click.stop=\"genPreview(props.item)\"\r\n                      >预览</fm-button\r\n                    >\r\n                  </div>\r\n                </div>\r\n                <div class=\"fm-tmpl-attachment-footer\">\r\n                  <span class=\"fm-tmpl-attachment-footer-text\">{{\r\n                    transformSize(props.item.size)\r\n                  }}</span>\r\n                  <span>{{ props.item.createTime }}</span>\r\n                </div>\r\n              </div>\r\n              <div\r\n                class=\"attachment-icon\"\r\n                @click.stop=\"deleteAttachment(props.item)\"\r\n                v-if=\"!removable\"\r\n              >\r\n                <fm-icon name=\"s-clear\" color=\"#888\" size=\"16\" />\r\n              </div>\r\n            </div>\r\n          </template>\r\n          <template v-slot:listviewEmpty><span></span></template>\r\n        </fm-listview>\r\n        <div\r\n          class=\"fm-attachment-upload-listview-btn-container\"\r\n          :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n          v-if=\"\r\n            !removable &&\r\n              direction === 'vertical' &&\r\n              ((allowMaxCount && uploadFiles.length < maxCount) ||\r\n                !allowMaxCount)\r\n          \"\r\n          @click=\"toUpload\"\r\n        >\r\n          <div class=\"fm-attachment-upload-btn\">\r\n            <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n          </div>\r\n        </div>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n        </van-popup>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nimport { uuid, UploadOptions } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-file\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      //default:'application/vnd.ms-powerpoint MS PowerPoint Presentation,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword MS Word Document,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel MS Excel Spreadsheet,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf Portable Document Format'\r\n      default:\r\n        \"application/msexcel,\" +\r\n        \"application/msword,\" +\r\n        \"application/vnd.ms-powerpoint,\" +\r\n        // pdf\r\n        \"application/pdf,\" +\r\n        // txt\r\n        \"text/plain,\" +\r\n        // ppt  pptx\r\n        \"application/vnd.openxmlformats-officedocument.presentationml.presentation,\" +\r\n        // xls xlsx\r\n        \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,\" +\r\n        // doc docx\r\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document,\" +\r\n        \"image/jpg,image/gif,image/jpeg,image/png,image/bmp\",\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    maxNum: {\r\n      type: Number,\r\n      default: 9,\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"vertical\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            // isPhoto: true\r\n          },\r\n          album: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n          selectFile: {\r\n            maximum: 5,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          },\r\n        };\r\n      },\r\n    },\r\n    uploadOptions: {\r\n      type: UploadOptions,\r\n      default: () => {\r\n        return {\r\n          showPhoto: true,\r\n          showAlbum: true,\r\n          showVideo: false,\r\n          showFile: true,\r\n          // 照片质量\r\n          photoQuality: 100,\r\n          // 相册图片质量\r\n          albumQuality: 100,\r\n          // 文件上传数量\r\n          fileMaxCount: 6,\r\n          // 短视频id\r\n          videoId: uuid(),\r\n          // 短视频质量\r\n          videoQuality: 0.8,\r\n          // 短视频时间\r\n          videoTime: 30,\r\n        };\r\n      },\r\n    },\r\n    disablePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 禁用\r\n    disableAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableVideo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 隐藏\r\n    hidePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 上传图片的最大数量\r\n    maxCount: {\r\n      type: Number,\r\n      default: 30,\r\n    },\r\n    // 上传图片最大尺寸  默认10M\r\n    maxSize: {\r\n      type: Number,\r\n      default: 20,\r\n    },\r\n    displayMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxSize: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      subscription: \"\",\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      showVideo: false,\r\n      isSelectAction: false,\r\n      isPreviewAction: false,\r\n      docStyle: {},\r\n      actions: [\r\n        { name: \"从相册选择\", disabled: this.albumDisabled },\r\n        { name: \"相机\", disabled: this.photoDisabled },\r\n        { name: \"手机文件\", disabled: this.fileDisabled },\r\n      ],\r\n      previewAction: [{ name: \"在线预览\" }, { name: \"下载\" }],\r\n      navibarDisplay: \"\",\r\n      footerDisplay: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n        }\r\n        if (this.selectedFile) {\r\n          this.$loading.hide();\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    // 处理原生返回\r\n    setTimeout(() => {\r\n      window.top[\"detailBackBtnClickHandler\"] = (backFn) => {\r\n        const pageElem = window.top.document.querySelector(\r\n          \".fm-page-record-deatial\"\r\n        );\r\n        const attachPreviewContainer = pageElem.querySelector(\r\n          \"#fm-attach-preview-container\"\r\n        );\r\n        if (!pageElem || !attachPreviewContainer) {\r\n          return true;\r\n        } else {\r\n          try {\r\n            this.closeScale(window.top.document);\r\n            pageElem.removeChild(attachPreviewContainer);\r\n            return false;\r\n          } catch (e) {\r\n            return true;\r\n          }\r\n        }\r\n      };\r\n    }, 0);\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  },\r\n  methods: {\r\n    openScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    closeScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    transformSize(size) {\r\n      if (size < Math.pow(1024, 2)) {\r\n        return (size / 1024).toFixed(2) + \"KB\";\r\n      } else if (size >= Math.pow(1024, 2) && size < Math.pow(1024, 3)) {\r\n        return (size / Math.pow(1024, 2)).toFixed(2) + \"MB\";\r\n      } else if (size >= Math.pow(1024, 3) && size < Math.pow(1024, 4)) {\r\n        return (size / Math.pow(1024, 3)).toFixed(2) + \"GB\";\r\n      }\r\n    },\r\n    selectAction(res) {\r\n      const actionName = res.name;\r\n      if (actionName === \"在线预览\") {\r\n        this.genPreview(this.selectedFile);\r\n      } else if (actionName === \"下载\") {\r\n        this.downloadAttachment(this.selectedFile);\r\n      }\r\n    },\r\n\r\n    selectFileFromMobile() {\r\n      if (this.disableFile) {\r\n        return;\r\n      }\r\n      this.attachmentService.getSysInfo().subscribe((res) => {\r\n        if (res && res.platform === \"Android\") {\r\n          this.attachmentService.selectFile({\r\n            maximum:\r\n              (this.uploadOptions && this.uploadOptions.fileMaxCount) || 6,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          });\r\n        } else if (res && res.platform === \"iOS\") {\r\n          this.$refs.fileUploadRef.chooseFile();\r\n        }\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    selectFileFromAlbum() {\r\n      if (this.disableAlbum) {\r\n        return;\r\n      }\r\n      this.attachmentService.selectAttachment({\r\n        quality: (this.uploadOptions && this.uploadOptions.albumQuality) || 100,\r\n        encodingType: 1,\r\n        mType: 0,\r\n        // 云+默认最多8张不支持配置  故此属性不作为输入属性\r\n        maxNum: 8,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takePhoto() {\r\n      if (this.disablePhoto) {\r\n        return;\r\n      }\r\n      this.attachmentService.takePhoto({\r\n        quality: (this.uploadOptions && this.uploadOptions.photoQuality) || 100,\r\n        encodingType: 1,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takeShortVideo() {\r\n      this.attachmentService.takeShortVideo({\r\n        id: (this.uploadOptions && this.uploadOptions.videoId) || uuid(),\r\n        quality: 0.8,\r\n        time: (this.uploadOptions && this.uploadOptions.videoTime) || 20,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n    },\r\n\r\n    toUpload() {\r\n      this.isSelectAction = true;\r\n    },\r\n    onCancel() {\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    afterRead(file) {\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // 允许设置最大尺寸\r\n      if (this.allowMaxSize) {\r\n        const beyondLimit = this.notUploadedFileList.some((f) => {\r\n          const realStr = f.content.substring(f.content.indexOf(\",\") + 1);\r\n          const realStrLen = realStr.length;\r\n          // base64转换成字节\r\n          const fSize = parseInt(realStrLen - (realStrLen / 8) * 2);\r\n          return fSize > this.maxSize * Math.pow(1024, 2);\r\n        });\r\n        if (beyondLimit) {\r\n          this.$dialog.alert({\r\n            title: \"上传失败\",\r\n            message: \"上传文件太大，请重新选择！\",\r\n          });\r\n          return;\r\n        }\r\n      }\r\n      //   计算附件上传数量\r\n      if (this.allowMaxCount) {\r\n        if (\r\n          this.notUploadedFileList.length + this.uploadFiles.length >\r\n          this.maxCount\r\n        ) {\r\n          const removedCount =\r\n            this.notUploadedFileList.length +\r\n            this.uploadFiles.length -\r\n            this.maxCount;\r\n          const count = this.notUploadedFileList.length - removedCount;\r\n          this.notUploadedFileList = this.notUploadedFileList.slice(0, count);\r\n        }\r\n      }\r\n      this.$loading.show(\"附件上传中\");\r\n      // 赋值最新的上传文件附件id\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      this.selectedFile = selectedFile;\r\n      // 隐藏工作流工具栏\r\n      //this.hideWorkFlowNavibar();\r\n      if (this.findWorkFlow()) {\r\n        this.previewFileInWorkFlow(\r\n          selectedFile.attachmentId,\r\n          this.rootId,\r\n          selectedFile.name\r\n        );\r\n      } else {\r\n        if (window.top && window.top !== window.self) {\r\n          this.openScale(window.top.document);\r\n        }\r\n        this.openScale(window.document);\r\n        if (\r\n          selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n          selectedFile.name.toLowerCase().includes(\"mov\")\r\n        ) {\r\n          this.show = true;\r\n          this.showPdf = false;\r\n          this.showDoc = false;\r\n          this.showVideo = true;\r\n          const videoUrl = selectedFile.content || selectedFile.url;\r\n          this.attachmentService.playShortVideo(\r\n            videoUrl + \"/\" + selectedFile.name\r\n          );\r\n        }\r\n        else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback(this.closed);\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n\r\n    getAttachmentUrl(attachmentId) {\r\n      var ishttps = \"https:\" == document.location.protocol ? true : false;\r\n      var url = window.location.host;\r\n      if (ishttps) {\r\n        url = \"https://\" + url;\r\n      } else {\r\n        url = \"http://\" + url;\r\n      }\r\n      url += this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n      return url;\r\n    },\r\n    downloadAttachment(attachment) {\r\n      const attachmentName = attachment.name;\r\n      const attachmentUrl = this.getAttachmentUrl(attachment.attachmentId);\r\n      const options = {\r\n        url: attachmentUrl,\r\n        saveName: attachmentName,\r\n        // autoOpen,\r\n      };\r\n      this.attachmentService.downloadAttachment(options).subscribe((res) => {});\r\n    },\r\n    closed() {\r\n      if (window.top && window.top !== window.self) {\r\n        this.closeScale(window.top.document);\r\n      }\r\n      this.closeScale(window.document);\r\n      // 隐藏工作流头部工具栏\r\n      //this.displayWorkFlowNavibar();\r\n      this.show = false;\r\n      this.showPdf = false;\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback();\r\n      }\r\n    },\r\n    hideWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        this.navibarDisplay = window.top.getComputedStyle(\r\n          workFlowNavibar\r\n        ).display;\r\n        workFlowNavibar.style.display = \"none\";\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        this.footerDisplay = window.top.getComputedStyle(\r\n          workFlowFooter\r\n        ).display;\r\n        workFlowFooter.style.display = \"none\";\r\n      }\r\n    },\r\n    displayWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        workFlowNavibar.style.display = this.navibarDisplay;\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        workFlowFooter.style.display = this.footerDisplay;\r\n      }\r\n    },\r\n\r\n    findWorkFlow() {\r\n      if (window.top === window.self) {\r\n        return false;\r\n      }\r\n      const isWorkFlow = window.top.location.href.includes(\r\n        \"/platform/runtime/wf/webapp/\"\r\n      );\r\n      return isWorkFlow;\r\n    },\r\n\r\n    /**\r\n     * 预览附件\r\n     */\r\n    previewFileInWorkFlow(attachId, rootId, fileName) {\r\n      // 打开缩放\r\n      this.openScale(window.top.document);\r\n\r\n      fileName = fileName || \"附件预览\";\r\n      const previewUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${attachId}&rootId=${rootId}&fileType=2`;\r\n      const previewHtml = `\r\n              <div class=\"fm-file-preview\">\r\n\r\n              <div class=\"fm-file-preview-header\">\r\n                <nav class=\"fm-navbar\">\r\n                    <div id=\"fm-attach-preview-back-btn\" class=\"fm-navbar-left fm-navbar-left-padding\">\r\n                        <span class=\"fm-navbar-left-arrow fm-icon fm-icon-arrow-chevron-left\"></span>\r\n                    </div>\r\n                    <div class=\"fm-navbar-title\">${fileName}</div>\r\n                </nav>\r\n              </div>\r\n                <div class=\"fm-file-preview-content\">\r\n                  <div class=\"preview-content\">\r\n                    <iframe src=\"${previewUrl}\"></iframe>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            `;\r\n\r\n      const pageElem = window.top.document.querySelector(\r\n        \".fm-page-record-deatial\"\r\n      );\r\n\r\n      // 预览容器\r\n      const previewContainerElem = document.createElement(\"div\");\r\n      previewContainerElem.id = \"fm-attach-preview-container\";\r\n      previewContainerElem.classList.add(\"fm-attach-preview-container\");\r\n      previewContainerElem.innerHTML = previewHtml;\r\n\r\n      // 返回按钮处理\r\n      const backBtn = previewContainerElem.querySelector(\"div.fm-navbar-left\");\r\n      backBtn.addEventListener(\"click\", () => {\r\n        this.closeScale(window.top.document);\r\n        pageElem.removeChild(previewContainerElem);\r\n      });\r\n\r\n      pageElem.appendChild(previewContainerElem);\r\n    },\r\n    openDownloadList(item) {\r\n      this.isPreviewAction = true;\r\n      this.selectedFile = item;\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.attachment-actionsheet-item-disabled {\r\n  color: #ccc;\r\n}\r\n.attachment-actionsheet-content {\r\n  flex: 1 auto;\r\n  overflow-y: auto;\r\n  .attachment-actionsheet-item {\r\n    display: block;\r\n    width: 100%;\r\n    padding: 14px 16px;\r\n    font-size: 16px;\r\n    text-align: center;\r\n    background-color: #fff;\r\n    border: none;\r\n    cursor: pointer;\r\n    text-align: center;\r\n  }\r\n}\r\n.attachment-bg {\r\n  background: #fff;\r\n}\r\n.listview-content {\r\n  .fm-listview-item {\r\n    margin: 12px 0;\r\n  }\r\n  .fm-tmpl-attachment-img {\r\n    width: 48px;\r\n    height: 48px;\r\n    margin: auto 0;\r\n    .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    img {\r\n      border-radius: 3px;\r\n      width: 48px;\r\n      height: 48px;\r\n    }\r\n  }\r\n  .attachment-text {\r\n    flex: 1;\r\n    margin: auto 12px;\r\n    & > div {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 5px;\r\n    }\r\n  }\r\n  .fm-tmpl-attachment-name {\r\n    line-height: 22px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 16px;\r\n    color: #333333;\r\n    letter-spacing: 0.21px;\r\n    margin-bottom: 2px;\r\n    word-break: break-all;\r\n  }\r\n  .fm-tmpl-attachment-footer {\r\n    line-height: 18px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 12px;\r\n    color: #888888;\r\n    letter-spacing: 0;\r\n  }\r\n  .fm-tmpl-listview-attachment {\r\n    padding: 0;\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n  .attachment-button {\r\n    .attachment-button-custom {\r\n      padding: 0;\r\n      width: 50px;\r\n      height: 20px;\r\n      font-family: PingFangSC-Regular;\r\n      font-size: 12px;\r\n      letter-spacing: 0;\r\n      border-radius: 10px;\r\n    }\r\n  }\r\n  .attachment-icon {\r\n    margin: auto 0;\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n",null,"<template>\r\n  <div\r\n    class=\"farris-attachment-entry\"\r\n    :class=\"{ 'farris-attachment-entry-vertical': direction === 'vertical' }\"\r\n  >\r\n    <div\r\n      class=\"fm-attachment-container attachment-navigation\"\r\n      v-if=\"direction === 'horizontal'\"\r\n    >\r\n      <div class=\"fm-attachment-files-list\">\r\n        <div\r\n          class=\"fm-attachment-files-item attachment-navigation-item\"\r\n          v-for=\"(item, index) in uploadFiles\"\r\n          :key=\"index\"\r\n          @click=\"selectFile(item)\"\r\n        >\r\n          <van-image\r\n            :src=\"getAttachmentPathByType(item)\"\r\n            class=\"item-img\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"\r\n              (item && item.name && !item.name.includes('mp4')) || !item.name\r\n            \"\r\n          />\r\n          <van-image\r\n            :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n            class=\"item-img\"\r\n            width=\"48\"\r\n            height=\"48\"\r\n            v-if=\"\r\n              (item && item.name && item.name.toLowerCase().includes('mp4')) ||\r\n                item.name.toLowerCase().includes('mov')\r\n            \"\r\n          />\r\n          <div\r\n            class=\"item-icon-delete\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            @click.stop=\"deleteAttachment(item)\"\r\n            v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n          >\r\n            <span class=\"fm-icon fm-icon-close\"></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div\r\n        class=\"fm-attachment-upload-btn-container\"\r\n        :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n        v-if=\"!removable\"\r\n        @click=\"toUpload\"\r\n      >\r\n        <div class=\"fm-attachment-upload-btn\">\r\n          <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <fm-listview\r\n      :listData=\"uploadFiles\"\r\n      :finished=\"true\"\r\n      :showFinishedText=\"false\"\r\n      v-if=\"direction === 'vertical'\"\r\n    >\r\n      <template v-slot:listViewHeader> </template>\r\n      <template v-slot=\"props\">\r\n        <div class=\"fm-tmpl-listview-goods\">\r\n          <div class=\"fm-tmpl-goods-img\" @click=\"selectFile(props.item)\">\r\n            <van-image\r\n              :src=\"props.item.content || props.item.url\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  !props.item.name.includes('mp4')) ||\r\n                  !props.item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  props.item.name.toLowerCase().includes('mp4')) ||\r\n                  props.item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n          </div>\r\n          <div>\r\n            <div class=\"fm-tmpl-goods-name\">\r\n              <span>{{ props.item.name }}</span>\r\n              <!-- <div class=\"fm-tmpl-goods-add\">\r\n\t\t\t\t\t\t\t\t可以添加下载\r\n\t\t\t\t\t\t\t\t<span class=\"fm-icon fm-icon-print\"></span>\r\n\t\t\t\t\t\t\t</div> -->\r\n            </div>\r\n            <!-- <div class=\"fm-tmpl-goods-price\">\r\n\t\t\t\t\t\t\t<span class=\"fm-tmpl-goods-price-text\">已上传</span>\r\n\t\t\t\t\t\t</div> -->\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </fm-listview>\r\n    <div\r\n      class=\"fm-attachment-upload-listview-btn-container\"\r\n      :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n      v-if=\"!removable && direction === 'vertical'\"\r\n      @click=\"toUpload\"\r\n    >\r\n      <div class=\"fm-attachment-upload-btn\">\r\n        <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-model:show=\"show\"\r\n      closeable\r\n      @closed=\"closed\"\r\n      :style=\"{ height: '100%', width: '100%' }\"\r\n    >\r\n      <fm-navbar\r\n        :title=\"selectedFile && selectedFile.name\"\r\n        @click-left=\"closed\"\r\n      >\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <iframe\r\n        class=\"pdf-iframe\"\r\n        scrolling=\"yes\"\r\n        :src=\"pdfUrl\"\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        v-if=\"showPdf\"\r\n      >\r\n      </iframe>\r\n      <video\r\n        autoplay\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mov')\r\n        \"\r\n      >\r\n        <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n      </video>\r\n      <video\r\n        autoplay\r\n        :src=\"selectedFile.url\"\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          (showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mp4')) ||\r\n            selectedFile.name.toLowerCase().includes('webm') ||\r\n            selectedFile.name.toLowerCase().includes('ogg')\r\n        \"\r\n      >\r\n        您的浏览器不支持 video 标签。\r\n      </video>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.fm-tmpl-listview-goods {\r\n  margin-bottom: 0.5rem;\r\n  padding: 0;\r\n  & img {\r\n    height: 48px;\r\n    width: 48px;\r\n    border-radius: 5px;\r\n  }\r\n  & .fm-tmpl-goods-price .fm-tmpl-goods-price-text {\r\n    font-size: 12px;\r\n    color: #666;\r\n  }\r\n  & .fm-tmpl-goods-name {\r\n    line-height: 1;\r\n    margin: 0;\r\n    min-height: 0;\r\n    font-size: 14px;\r\n    color: #000;\r\n    padding: 0;\r\n    overflow-wrap: break-word;\r\n  }\r\n  & .fm-tmpl-goods-img {\r\n    width: 48px;\r\n    height: 48px;\r\n  }\r\n  & .fm-tmpl-goods-content {\r\n    padding: 0;\r\n  }\r\n\r\n  & .fm-tmpl-goods-content::after {\r\n    content: \"\";\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-entry\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      // default: 'application/pdf,image/*,application/msword,text/html',\r\n      default: \"image/gif,image/jpg,image/jpeg,image/bmp,image/png\",\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"horizontal\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showVideo: false,\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        this.selectedFile = this.rawFiles[0];\r\n        // 没有url属性的 没有上传\r\n        // this.notUploadedFileList = this.rawFiles.filter((file) => !file.url);\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    if (!this.allowDefaultEntrance) {\r\n      this.showAction = true;\r\n    }\r\n  },\r\n  methods: {\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n      // this.$emit('chooseFile');\r\n    },\r\n\r\n    toUpload() {\r\n      this.$emit(\"upload\");\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      this.showAction = true;\r\n      if (file && file.length) {\r\n        this.selectedFile = file[file.length - 1];\r\n        this.notUploadedFileList = file;\r\n      } else {\r\n        this.selectedFile = file;\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // emit 添加文件后事件\r\n      this.$emit(\"afterAppendFile\", file);\r\n      // 添加文件后直接上传\r\n      this.requestUpload();\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (\r\n        selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n        selectedFile.name.toLowerCase().includes(\"mov\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n        this.show = true;\r\n        this.showPdf = false;\r\n        this.showVideo = true;\r\n        // const videoUrl = selectedFile.content || selectedFile.url;\r\n        // this.attachmentService.playShortVideo(\r\n        //   videoUrl + \"/\" + selectedFile.name\r\n        // );\r\n      } else {\r\n        // 图片文件直接预览\r\n        this.show = true;\r\n        this.showPdf = true;\r\n        this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n","<template>\r\n  <div\r\n    class=\"farris-attachment-entry\"\r\n    :class=\"{ 'farris-attachment-entry-vertical': direction === 'vertical' }\"\r\n  >\r\n    <div\r\n      class=\"fm-attachment-container attachment-navigation\"\r\n      v-if=\"direction === 'horizontal'\"\r\n    >\r\n      <div class=\"fm-attachment-files-list\">\r\n        <div\r\n          class=\"fm-attachment-files-item attachment-navigation-item\"\r\n          v-for=\"(item, index) in uploadFiles\"\r\n          :key=\"index\"\r\n          @click=\"selectFile(item)\"\r\n        >\r\n          <van-image\r\n            :src=\"getAttachmentPathByType(item)\"\r\n            class=\"item-img\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"\r\n              (item && item.name && !item.name.includes('mp4')) || !item.name\r\n            \"\r\n          />\r\n          <van-image\r\n            :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n            class=\"item-img\"\r\n            width=\"48\"\r\n            height=\"48\"\r\n            v-if=\"\r\n              (item && item.name && item.name.toLowerCase().includes('mp4')) ||\r\n                item.name.toLowerCase().includes('mov')\r\n            \"\r\n          />\r\n          <div\r\n            class=\"item-icon-delete\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            @click.stop=\"deleteAttachment(item)\"\r\n            v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n          >\r\n            <span class=\"fm-icon fm-icon-close\"></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div\r\n        class=\"fm-attachment-upload-btn-container\"\r\n        :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n        v-if=\"!removable\"\r\n        @click=\"toUpload\"\r\n      >\r\n        <div class=\"fm-attachment-upload-btn\">\r\n          <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <fm-listview\r\n      :listData=\"uploadFiles\"\r\n      :finished=\"true\"\r\n      :showFinishedText=\"false\"\r\n      v-if=\"direction === 'vertical'\"\r\n    >\r\n      <template v-slot:listViewHeader> </template>\r\n      <template v-slot=\"props\">\r\n        <div class=\"fm-tmpl-listview-goods\">\r\n          <div class=\"fm-tmpl-goods-img\" @click=\"selectFile(props.item)\">\r\n            <van-image\r\n              :src=\"props.item.content || props.item.url\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  !props.item.name.includes('mp4')) ||\r\n                  !props.item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  props.item.name.toLowerCase().includes('mp4')) ||\r\n                  props.item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n          </div>\r\n          <div>\r\n            <div class=\"fm-tmpl-goods-name\">\r\n              <span>{{ props.item.name }}</span>\r\n              <!-- <div class=\"fm-tmpl-goods-add\">\r\n\t\t\t\t\t\t\t\t可以添加下载\r\n\t\t\t\t\t\t\t\t<span class=\"fm-icon fm-icon-print\"></span>\r\n\t\t\t\t\t\t\t</div> -->\r\n            </div>\r\n            <!-- <div class=\"fm-tmpl-goods-price\">\r\n\t\t\t\t\t\t\t<span class=\"fm-tmpl-goods-price-text\">已上传</span>\r\n\t\t\t\t\t\t</div> -->\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </fm-listview>\r\n    <div\r\n      class=\"fm-attachment-upload-listview-btn-container\"\r\n      :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n      v-if=\"!removable && direction === 'vertical'\"\r\n      @click=\"toUpload\"\r\n    >\r\n      <div class=\"fm-attachment-upload-btn\">\r\n        <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-model:show=\"show\"\r\n      closeable\r\n      @closed=\"closed\"\r\n      :style=\"{ height: '100%', width: '100%' }\"\r\n    >\r\n      <fm-navbar\r\n        :title=\"selectedFile && selectedFile.name\"\r\n        @click-left=\"closed\"\r\n      >\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <iframe\r\n        class=\"pdf-iframe\"\r\n        scrolling=\"yes\"\r\n        :src=\"pdfUrl\"\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        v-if=\"showPdf\"\r\n      >\r\n      </iframe>\r\n      <video\r\n        autoplay\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mov')\r\n        \"\r\n      >\r\n        <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n      </video>\r\n      <video\r\n        autoplay\r\n        :src=\"selectedFile.url\"\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          (showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mp4')) ||\r\n            selectedFile.name.toLowerCase().includes('webm') ||\r\n            selectedFile.name.toLowerCase().includes('ogg')\r\n        \"\r\n      >\r\n        您的浏览器不支持 video 标签。\r\n      </video>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.fm-tmpl-listview-goods {\r\n  margin-bottom: 0.5rem;\r\n  padding: 0;\r\n  & img {\r\n    height: 48px;\r\n    width: 48px;\r\n    border-radius: 5px;\r\n  }\r\n  & .fm-tmpl-goods-price .fm-tmpl-goods-price-text {\r\n    font-size: 12px;\r\n    color: #666;\r\n  }\r\n  & .fm-tmpl-goods-name {\r\n    line-height: 1;\r\n    margin: 0;\r\n    min-height: 0;\r\n    font-size: 14px;\r\n    color: #000;\r\n    padding: 0;\r\n    overflow-wrap: break-word;\r\n  }\r\n  & .fm-tmpl-goods-img {\r\n    width: 48px;\r\n    height: 48px;\r\n  }\r\n  & .fm-tmpl-goods-content {\r\n    padding: 0;\r\n  }\r\n\r\n  & .fm-tmpl-goods-content::after {\r\n    content: \"\";\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-entry\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      // default: 'application/pdf,image/*,application/msword,text/html',\r\n      default: \"image/gif,image/jpg,image/jpeg,image/bmp,image/png\",\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"horizontal\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showVideo: false,\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        this.selectedFile = this.rawFiles[0];\r\n        // 没有url属性的 没有上传\r\n        // this.notUploadedFileList = this.rawFiles.filter((file) => !file.url);\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    if (!this.allowDefaultEntrance) {\r\n      this.showAction = true;\r\n    }\r\n  },\r\n  methods: {\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n      // this.$emit('chooseFile');\r\n    },\r\n\r\n    toUpload() {\r\n      this.$emit(\"upload\");\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      this.showAction = true;\r\n      if (file && file.length) {\r\n        this.selectedFile = file[file.length - 1];\r\n        this.notUploadedFileList = file;\r\n      } else {\r\n        this.selectedFile = file;\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // emit 添加文件后事件\r\n      this.$emit(\"afterAppendFile\", file);\r\n      // 添加文件后直接上传\r\n      this.requestUpload();\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (\r\n        selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n        selectedFile.name.toLowerCase().includes(\"mov\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n        this.show = true;\r\n        this.showPdf = false;\r\n        this.showVideo = true;\r\n        // const videoUrl = selectedFile.content || selectedFile.url;\r\n        // this.attachmentService.playShortVideo(\r\n        //   videoUrl + \"/\" + selectedFile.name\r\n        // );\r\n      } else {\r\n        // 图片文件直接预览\r\n        this.show = true;\r\n        this.showPdf = true;\r\n        this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n",null,"<template>\r\n\t<div\r\n\t\tclass=\"fm-verify-code\"\r\n\t\t:class=\"{ 'fm-verify-code-disabled': disabled || time > 0 }\"\r\n\t\t@click=\"run()\"\r\n\t>\r\n\t\t<span class=\"text\">{{ text }}</span>\r\n\t</div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\n\r\nexport default defineComponent({\r\n\tname: 'fm-verify-code',\r\n\tprops: {\r\n\t\tsecond: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 60\r\n\t\t}\r\n\t},\r\n\tdata: function () {\r\n\t\treturn {\r\n\t\t\ttime: 0,\r\n\t\t\tdisabled: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trun: function () {\r\n\t\t\tif (this.disabled || this.time > 0) return;\r\n\t\t\tthis.$emit('run');\r\n\t\t\tthis.start();\r\n\t\t},\r\n\t\tstart: function () {\r\n\t\t\tthis.time = this.second;\r\n\t\t\tthis.timer();\r\n\t\t},\r\n\t\tstop: function () {\r\n\t\t\tthis.time = 0;\r\n\t\t\tthis.disabled = false;\r\n\t\t},\r\n\t\tsetDisabled: function (val) {\r\n\t\t\tthis.disabled = val;\r\n\t\t},\r\n\t\ttimer: function () {\r\n\t\t\tif (this.time > 0) {\r\n\t\t\t\tthis.time--;\r\n\t\t\t\tsetTimeout(this.timer, 1000);\r\n\t\t\t} else {\r\n\t\t\t\tthis.disabled = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\tcomputed: {\r\n\t\ttext: function () {\r\n\t\t\treturn this.time > 0 ? this.time + 's' : '获取验证码';\r\n\t\t}\r\n\t}\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '../../../assets/style/mixins/_hairline';\r\n.fm-verify-code{\r\n    .text{\r\n        font-size: 15px;\r\n        color: #31A4FB;\r\n    }\r\n    &-disabled{\r\n        .text{\r\n            color: #999;\r\n        }\r\n    }\r\n}\r\n\r\n</style>\r\n","<template>\r\n\t<div\r\n\t\tclass=\"fm-verify-code\"\r\n\t\t:class=\"{ 'fm-verify-code-disabled': disabled || time > 0 }\"\r\n\t\t@click=\"run()\"\r\n\t>\r\n\t\t<span class=\"text\">{{ text }}</span>\r\n\t</div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\n\r\nexport default defineComponent({\r\n\tname: 'fm-verify-code',\r\n\tprops: {\r\n\t\tsecond: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 60\r\n\t\t}\r\n\t},\r\n\tdata: function () {\r\n\t\treturn {\r\n\t\t\ttime: 0,\r\n\t\t\tdisabled: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trun: function () {\r\n\t\t\tif (this.disabled || this.time > 0) return;\r\n\t\t\tthis.$emit('run');\r\n\t\t\tthis.start();\r\n\t\t},\r\n\t\tstart: function () {\r\n\t\t\tthis.time = this.second;\r\n\t\t\tthis.timer();\r\n\t\t},\r\n\t\tstop: function () {\r\n\t\t\tthis.time = 0;\r\n\t\t\tthis.disabled = false;\r\n\t\t},\r\n\t\tsetDisabled: function (val) {\r\n\t\t\tthis.disabled = val;\r\n\t\t},\r\n\t\ttimer: function () {\r\n\t\t\tif (this.time > 0) {\r\n\t\t\t\tthis.time--;\r\n\t\t\t\tsetTimeout(this.timer, 1000);\r\n\t\t\t} else {\r\n\t\t\t\tthis.disabled = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\tcomputed: {\r\n\t\ttext: function () {\r\n\t\t\treturn this.time > 0 ? this.time + 's' : '获取验证码';\r\n\t\t}\r\n\t}\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '../../../assets/style/mixins/_hairline';\r\n.fm-verify-code{\r\n    .text{\r\n        font-size: 15px;\r\n        color: #31A4FB;\r\n    }\r\n    &-disabled{\r\n        .text{\r\n            color: #999;\r\n        }\r\n    }\r\n}\r\n\r\n</style>\r\n",null,null,null,null,null,null,null,null,"<template>\r\n  <div>\r\n    <div class=\"fm-input-item fm-input-item-inline\" id=\"attachment-container\">\r\n      <div class=\"fm-input-item pr-md pl-md\" id=\"attachment-container\">\r\n        <fm-attachment-entry\r\n          :fileList=\"state.filterData\"\r\n          :externalVideoUrl=\"externalVideoUrl\"\r\n          :removable=\"removable\"\r\n          :parentDirName=\"parentDirName\"\r\n          :rootId=\"rootId\"\r\n          @remove=\"removeAttachment\"\r\n          @upload=\"toAttachmentDetailPage\"\r\n        ></fm-attachment-entry>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-if=\"state.show\"\r\n      v-model:show=\"state.show\"\r\n      position=\"right\"\r\n      :style=\"{\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        'flex-direction': 'column',\r\n        background: '#fff',\r\n      }\"\r\n    >\r\n      <fm-navbar :title=\"title\" @click-left=\"goBack\" v-if=\"showNavBar\">\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <div class=\"fm-edit-input-list\" id=\"detail-form-layout\">\r\n        <div\r\n          class=\"fm-input-wrapper\"\r\n          v-for=\"field in state.attachmentExtendFields\"\r\n        >\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox' && field.visible\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox' && field.visible\"\r\n          />\r\n        </div>\r\n        <div class=\"fm-input-wrapper\" v-for=\"field in extendFields\">\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox'\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox'\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <fm-attachment\r\n        :fileList=\"state.filterData\"\r\n        :parentDirName=\"parentDirName\"\r\n        :externalVideoUrl=\"externalVideoUrl\"\r\n        :rootId=\"rootId\"\r\n        @selectChange=\"selectChange\"\r\n        @remove=\"removeAttachment\"\r\n        @afterAppendFile=\"uploadAttachment\"\r\n        v-if=\"state.show\"\r\n      >\r\n      </fm-attachment>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { computed, reactive, onMounted, defineComponent, nextTick } from \"vue\";\r\nimport { Popup, Field, NavBar, Icon } from \"vant\";\r\nimport { filterData } from \"@farris/mobile-vue-adapter\";\r\nimport { AttachmentUtil } from \"./attachment.service\";\r\nimport { guid } from \"../map/service\";\r\nimport AttachmentEntry from \"../../components/attachment-entry\";\r\nimport Attachment from \"../../components/attachment\";\r\nexport default defineComponent({\r\n  // 组件名称\r\n  name: \"fm-business-attachment\",\r\n  props: {\r\n    // 输入属性\r\n    extendFields: {\r\n      type: Array,\r\n      default: () => [{}],\r\n    },\r\n    // 是否显示头部导航\r\n    showNavBar: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 附件目录信息\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // rootId\r\n    rootId: {\r\n      type: String,\r\n      default: \"default-root\",\r\n    },\r\n    // 主表或子表路径\r\n    path: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 获取服务端数据\r\n    // getRawData: {\r\n    // \ttype: Function\r\n    // },\r\n    title: {\r\n      type: String,\r\n      default: \"导航栏\",\r\n    },\r\n    // 是否展示附件信息\r\n    displayAttachmentInfo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    displayAttachmentId: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    displayAttachmentName: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  setup(props, { emit }) {\r\n    const state = reactive({\r\n      show: false,\r\n      fieldsValue: {\r\n        // name: ''\r\n      },\r\n      attachmentExtendFields: [],\r\n      selectedAttachmentId: \"\",\r\n      context: {\r\n        // 原值\r\n        data: [],\r\n        // 旧值  用于扩展字段变更\r\n        oldData: [],\r\n        // 获取数据\r\n        getData: null,\r\n        // 更新旧值\r\n        updateData: null,\r\n        // 删除数据\r\n        removeDataById: null,\r\n        // 设置数据\r\n        setData: null,\r\n        // 追加数据\r\n        appendData: null,\r\n        removed: false,\r\n      },\r\n      currentData: null,\r\n      fields: computed(() => {\r\n        return props.extendFields || [{}];\r\n      }),\r\n      rawData: computed(() => {\r\n        if (!state.currentData && state.context.data.length) {\r\n          state.currentData = state.context.data[0];\r\n          // 选择该数据\r\n          nextTick(() => {\r\n            Object.keys(state.fieldsValue).forEach((key) => {\r\n              state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n            });\r\n          });\r\n        }\r\n        if (state.selectedAttachmentId) {\r\n          const selectedData = state.context.data.find(\r\n            (dataItem) =>\r\n              dataItem[props.path.substring(1)].attachmentId ===\r\n              state.selectedAttachmentId\r\n          );\r\n          if (selectedData) {\r\n            state.currentData = selectedData;\r\n            // 选择该数据\r\n            nextTick(() => {\r\n              Object.keys(state.fieldsValue).forEach((key) => {\r\n                state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n              });\r\n            });\r\n          } else {\r\n            if (state.context.data.length) {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            } else {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            }\r\n          }\r\n        }\r\n        // 删除标记\r\n        return state.context.data;\r\n      }),\r\n      filterData: computed(() =>\r\n        filterData(state.rawData, props.path, props.rootId)\r\n      ),\r\n    });\r\n    onMounted(() => {\r\n      // 初始化上下文\r\n      initContext();\r\n      // 初始化获取附件信息\r\n      // if (props.getRawData) {\r\n      // props.getRawData(state.context);\r\n      // 获取服务端数据\r\n      emit(\"getRawData\", state.context);\r\n      if (\r\n        !state.currentData &&\r\n        state.context.data &&\r\n        state.context.data.length\r\n      ) {\r\n        state.currentData = state.context.data[0];\r\n      }\r\n      // }\r\n    });\r\n    /**\r\n     * 上传附件\r\n     */\r\n    const uploadAttachment = (e) => {\r\n      state.selectedAttachmentId = e[0].metadataId;\r\n      emit(\"upload\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 删除附件\r\n     */\r\n    const removeAttachment = (e) => {\r\n      state.removed = true;\r\n      emit(\"remove\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n    /**\r\n     * 选择附件\r\n     */\r\n    const selectChange = (e) => {\r\n      const attachmentId = e.attachmentId;\r\n      state.selectedAttachmentId = attachmentId;\r\n      // 获取当前数据\r\n      const bindingField = props.path.split(\"/\")[1];\r\n      state.currentData = AttachmentUtil.getCurrentData(\r\n        attachmentId,\r\n        state.context.data,\r\n        bindingField\r\n      );\r\n      Object.keys(state.fieldsValue).forEach((key) => {\r\n        state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n      });\r\n      emit(\"selectChange\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n        currentData: state.currentData,\r\n      });\r\n    };\r\n    /**\r\n     * 回退事件\r\n     */\r\n    const goBack = () => {\r\n      state.show = false;\r\n      state.selectedAttachmentId = \"\";\r\n      // 赋值当前数据\r\n      if (state.currentData) {\r\n        const bindingFields = props.extendFields\r\n          .map((extendField) => {\r\n            return extendField.bindingField;\r\n          })\r\n          .filter((ele) => ele);\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          bindingFields,\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 回退抛出事件\r\n      emit(\"goBack\", {\r\n        listData: state.context.data,\r\n        oldListData: state.context.oldData,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 失去焦点事件\r\n     */\r\n    const blur = (field) => {\r\n      const bindingField = field.bindingField;\r\n      // 赋值\r\n      if (state.currentData) {\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          [bindingField],\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 抛出失去焦点事件\r\n      emit(\"blur\", {\r\n        field,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    const toAttachmentDetailPage = () => {\r\n      state.show = true;\r\n      // 由于附件组件重新加载都会定位第一个附件  所以要重新赋值为第一个附件的数据\r\n      state.currentData = state.context.data[0];\r\n      // 组建扩展字段数组\r\n      const attachmentInfoFields = [\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_AttachmentId`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件id\",\r\n          visible: props.displayAttachmentId,\r\n        },\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_FileName`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件名称\",\r\n          visible: props.displayAttachmentName,\r\n        },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileSize`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件大小'\r\n        // },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileCreateTime`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件上传时间'\r\n        // }\r\n      ];\r\n      if (props.displayAttachmentInfo) {\r\n        state.attachmentExtendFields = [...attachmentInfoFields];\r\n      }\r\n      const extendFields = [\r\n        ...state.attachmentExtendFields,\r\n        ...props.extendFields,\r\n      ];\r\n      // 创建字段绑定值变量\r\n      // if (props.extendFields.length && state.currentData) {\r\n      extendFields.forEach((ele) => {\r\n        // if (!state.fieldsValue[ele.bindingField]) {\r\n        state.fieldsValue[ele.bindingField] =\r\n          state.currentData &&\r\n          getDataValue(state.currentData, ele.bindingField);\r\n        // }\r\n      });\r\n\r\n      // }\r\n    };\r\n\r\n    /**\r\n     * 初始化上下文\r\n     */\r\n    const initContext = () => {\r\n      // 获取数据\r\n      state.context.getData = AttachmentUtil.getContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 更新旧值\r\n      state.context.updateData = AttachmentUtil.updateContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 删除数据\r\n      state.context.removeDataById = AttachmentUtil.removeContextDataById.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 设置数据\r\n      state.context.setData = AttachmentUtil.setContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 追加数据\r\n      state.context.appendData = AttachmentUtil.appendToContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n    };\r\n\r\n    const getDataValue = (data, field) => {\r\n      if (data) {\r\n        const fieldArr = field.split(\"_\");\r\n        if (fieldArr.length > 1) {\r\n          const newField =\r\n            fieldArr[1].substring(0, 1).toLowerCase() +\r\n            fieldArr[1].substring(1);\r\n          return data[fieldArr[0]][newField];\r\n        }\r\n        return data[field];\r\n      }\r\n      return \"\";\r\n    };\r\n\r\n    return {\r\n      state,\r\n      uploadAttachment,\r\n      removeAttachment,\r\n      selectChange,\r\n      goBack,\r\n      blur,\r\n      toAttachmentDetailPage,\r\n      initContext,\r\n      getDataValue,\r\n    };\r\n  },\r\n  components: {\r\n    \"fm-attachment-entry\": AttachmentEntry,\r\n    \"fm-attachment\": Attachment,\r\n    \"van-nav-bar\": NavBar,\r\n    \"van-popup\": Popup,\r\n    \"van-icon\": Icon,\r\n    \"van-field\": Field,\r\n  },\r\n});\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.van-nav-bar .van-nav-bar__content {\r\n  flex: 1;\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <div class=\"fm-input-item fm-input-item-inline\" id=\"attachment-container\">\r\n      <div class=\"fm-input-item pr-md pl-md\" id=\"attachment-container\">\r\n        <fm-attachment-entry\r\n          :fileList=\"state.filterData\"\r\n          :externalVideoUrl=\"externalVideoUrl\"\r\n          :removable=\"removable\"\r\n          :parentDirName=\"parentDirName\"\r\n          :rootId=\"rootId\"\r\n          @remove=\"removeAttachment\"\r\n          @upload=\"toAttachmentDetailPage\"\r\n        ></fm-attachment-entry>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-if=\"state.show\"\r\n      v-model:show=\"state.show\"\r\n      position=\"right\"\r\n      :style=\"{\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        'flex-direction': 'column',\r\n        background: '#fff',\r\n      }\"\r\n    >\r\n      <fm-navbar :title=\"title\" @click-left=\"goBack\" v-if=\"showNavBar\">\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <div class=\"fm-edit-input-list\" id=\"detail-form-layout\">\r\n        <div\r\n          class=\"fm-input-wrapper\"\r\n          v-for=\"field in state.attachmentExtendFields\"\r\n        >\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox' && field.visible\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox' && field.visible\"\r\n          />\r\n        </div>\r\n        <div class=\"fm-input-wrapper\" v-for=\"field in extendFields\">\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox'\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox'\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <fm-attachment\r\n        :fileList=\"state.filterData\"\r\n        :parentDirName=\"parentDirName\"\r\n        :externalVideoUrl=\"externalVideoUrl\"\r\n        :rootId=\"rootId\"\r\n        @selectChange=\"selectChange\"\r\n        @remove=\"removeAttachment\"\r\n        @afterAppendFile=\"uploadAttachment\"\r\n        v-if=\"state.show\"\r\n      >\r\n      </fm-attachment>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { computed, reactive, onMounted, defineComponent, nextTick } from \"vue\";\r\nimport { Popup, Field, NavBar, Icon } from \"vant\";\r\nimport { filterData } from \"@farris/mobile-vue-adapter\";\r\nimport { AttachmentUtil } from \"./attachment.service\";\r\nimport { guid } from \"../map/service\";\r\nimport AttachmentEntry from \"../../components/attachment-entry\";\r\nimport Attachment from \"../../components/attachment\";\r\nexport default defineComponent({\r\n  // 组件名称\r\n  name: \"fm-business-attachment\",\r\n  props: {\r\n    // 输入属性\r\n    extendFields: {\r\n      type: Array,\r\n      default: () => [{}],\r\n    },\r\n    // 是否显示头部导航\r\n    showNavBar: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 附件目录信息\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // rootId\r\n    rootId: {\r\n      type: String,\r\n      default: \"default-root\",\r\n    },\r\n    // 主表或子表路径\r\n    path: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 获取服务端数据\r\n    // getRawData: {\r\n    // \ttype: Function\r\n    // },\r\n    title: {\r\n      type: String,\r\n      default: \"导航栏\",\r\n    },\r\n    // 是否展示附件信息\r\n    displayAttachmentInfo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    displayAttachmentId: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    displayAttachmentName: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  setup(props, { emit }) {\r\n    const state = reactive({\r\n      show: false,\r\n      fieldsValue: {\r\n        // name: ''\r\n      },\r\n      attachmentExtendFields: [],\r\n      selectedAttachmentId: \"\",\r\n      context: {\r\n        // 原值\r\n        data: [],\r\n        // 旧值  用于扩展字段变更\r\n        oldData: [],\r\n        // 获取数据\r\n        getData: null,\r\n        // 更新旧值\r\n        updateData: null,\r\n        // 删除数据\r\n        removeDataById: null,\r\n        // 设置数据\r\n        setData: null,\r\n        // 追加数据\r\n        appendData: null,\r\n        removed: false,\r\n      },\r\n      currentData: null,\r\n      fields: computed(() => {\r\n        return props.extendFields || [{}];\r\n      }),\r\n      rawData: computed(() => {\r\n        if (!state.currentData && state.context.data.length) {\r\n          state.currentData = state.context.data[0];\r\n          // 选择该数据\r\n          nextTick(() => {\r\n            Object.keys(state.fieldsValue).forEach((key) => {\r\n              state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n            });\r\n          });\r\n        }\r\n        if (state.selectedAttachmentId) {\r\n          const selectedData = state.context.data.find(\r\n            (dataItem) =>\r\n              dataItem[props.path.substring(1)].attachmentId ===\r\n              state.selectedAttachmentId\r\n          );\r\n          if (selectedData) {\r\n            state.currentData = selectedData;\r\n            // 选择该数据\r\n            nextTick(() => {\r\n              Object.keys(state.fieldsValue).forEach((key) => {\r\n                state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n              });\r\n            });\r\n          } else {\r\n            if (state.context.data.length) {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            } else {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            }\r\n          }\r\n        }\r\n        // 删除标记\r\n        return state.context.data;\r\n      }),\r\n      filterData: computed(() =>\r\n        filterData(state.rawData, props.path, props.rootId)\r\n      ),\r\n    });\r\n    onMounted(() => {\r\n      // 初始化上下文\r\n      initContext();\r\n      // 初始化获取附件信息\r\n      // if (props.getRawData) {\r\n      // props.getRawData(state.context);\r\n      // 获取服务端数据\r\n      emit(\"getRawData\", state.context);\r\n      if (\r\n        !state.currentData &&\r\n        state.context.data &&\r\n        state.context.data.length\r\n      ) {\r\n        state.currentData = state.context.data[0];\r\n      }\r\n      // }\r\n    });\r\n    /**\r\n     * 上传附件\r\n     */\r\n    const uploadAttachment = (e) => {\r\n      state.selectedAttachmentId = e[0].metadataId;\r\n      emit(\"upload\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 删除附件\r\n     */\r\n    const removeAttachment = (e) => {\r\n      state.removed = true;\r\n      emit(\"remove\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n    /**\r\n     * 选择附件\r\n     */\r\n    const selectChange = (e) => {\r\n      const attachmentId = e.attachmentId;\r\n      state.selectedAttachmentId = attachmentId;\r\n      // 获取当前数据\r\n      const bindingField = props.path.split(\"/\")[1];\r\n      state.currentData = AttachmentUtil.getCurrentData(\r\n        attachmentId,\r\n        state.context.data,\r\n        bindingField\r\n      );\r\n      Object.keys(state.fieldsValue).forEach((key) => {\r\n        state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n      });\r\n      emit(\"selectChange\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n        currentData: state.currentData,\r\n      });\r\n    };\r\n    /**\r\n     * 回退事件\r\n     */\r\n    const goBack = () => {\r\n      state.show = false;\r\n      state.selectedAttachmentId = \"\";\r\n      // 赋值当前数据\r\n      if (state.currentData) {\r\n        const bindingFields = props.extendFields\r\n          .map((extendField) => {\r\n            return extendField.bindingField;\r\n          })\r\n          .filter((ele) => ele);\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          bindingFields,\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 回退抛出事件\r\n      emit(\"goBack\", {\r\n        listData: state.context.data,\r\n        oldListData: state.context.oldData,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 失去焦点事件\r\n     */\r\n    const blur = (field) => {\r\n      const bindingField = field.bindingField;\r\n      // 赋值\r\n      if (state.currentData) {\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          [bindingField],\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 抛出失去焦点事件\r\n      emit(\"blur\", {\r\n        field,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    const toAttachmentDetailPage = () => {\r\n      state.show = true;\r\n      // 由于附件组件重新加载都会定位第一个附件  所以要重新赋值为第一个附件的数据\r\n      state.currentData = state.context.data[0];\r\n      // 组建扩展字段数组\r\n      const attachmentInfoFields = [\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_AttachmentId`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件id\",\r\n          visible: props.displayAttachmentId,\r\n        },\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_FileName`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件名称\",\r\n          visible: props.displayAttachmentName,\r\n        },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileSize`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件大小'\r\n        // },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileCreateTime`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件上传时间'\r\n        // }\r\n      ];\r\n      if (props.displayAttachmentInfo) {\r\n        state.attachmentExtendFields = [...attachmentInfoFields];\r\n      }\r\n      const extendFields = [\r\n        ...state.attachmentExtendFields,\r\n        ...props.extendFields,\r\n      ];\r\n      // 创建字段绑定值变量\r\n      // if (props.extendFields.length && state.currentData) {\r\n      extendFields.forEach((ele) => {\r\n        // if (!state.fieldsValue[ele.bindingField]) {\r\n        state.fieldsValue[ele.bindingField] =\r\n          state.currentData &&\r\n          getDataValue(state.currentData, ele.bindingField);\r\n        // }\r\n      });\r\n\r\n      // }\r\n    };\r\n\r\n    /**\r\n     * 初始化上下文\r\n     */\r\n    const initContext = () => {\r\n      // 获取数据\r\n      state.context.getData = AttachmentUtil.getContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 更新旧值\r\n      state.context.updateData = AttachmentUtil.updateContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 删除数据\r\n      state.context.removeDataById = AttachmentUtil.removeContextDataById.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 设置数据\r\n      state.context.setData = AttachmentUtil.setContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 追加数据\r\n      state.context.appendData = AttachmentUtil.appendToContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n    };\r\n\r\n    const getDataValue = (data, field) => {\r\n      if (data) {\r\n        const fieldArr = field.split(\"_\");\r\n        if (fieldArr.length > 1) {\r\n          const newField =\r\n            fieldArr[1].substring(0, 1).toLowerCase() +\r\n            fieldArr[1].substring(1);\r\n          return data[fieldArr[0]][newField];\r\n        }\r\n        return data[field];\r\n      }\r\n      return \"\";\r\n    };\r\n\r\n    return {\r\n      state,\r\n      uploadAttachment,\r\n      removeAttachment,\r\n      selectChange,\r\n      goBack,\r\n      blur,\r\n      toAttachmentDetailPage,\r\n      initContext,\r\n      getDataValue,\r\n    };\r\n  },\r\n  components: {\r\n    \"fm-attachment-entry\": AttachmentEntry,\r\n    \"fm-attachment\": Attachment,\r\n    \"van-nav-bar\": NavBar,\r\n    \"van-popup\": Popup,\r\n    \"van-icon\": Icon,\r\n    \"van-field\": Field,\r\n  },\r\n});\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.van-nav-bar .van-nav-bar__content {\r\n  flex: 1;\r\n}\r\n</style>\r\n",null,"import { defineComponent, ref, watch } from 'vue'\r\nimport {\r\n  Popup,\r\n  Navbar,\r\n  LookupInput,\r\n  LookupPanel,\r\n  Picker,\r\n  Button,\r\n} from \"@farris/mobile-ui\";\r\n\r\nexport default defineComponent({\r\n  name: 'fm-approve',\r\n  components: {\r\n    \"fm-popup\": Popup,\r\n    \"fm-navbar\": Navbar,\r\n    \"fm-lookup-input\": LookupInput,\r\n    \"fm-picker\": Picker,\r\n    \"fm-button\": Button,\r\n  },\r\n  props: {\r\n    show: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    processReadFlag: Boolean,\r\n    nextNodeReadFlag: Boolean,\r\n    assigneeReadFlag: Boolean,\r\n    cancelDisabled: Boolean,\r\n    confirmDisabled: Boolean,\r\n    process: [String, Number],\r\n    processOc: Function,\r\n    processData: Array,\r\n    nextNode: [String, Number],\r\n    nextNodeOc: Function,\r\n    nextNodeData: Array,\r\n    assignee: [String, Number],\r\n    assigneeOc: Function,\r\n    assigneeData: Object,\r\n    submit: Function,\r\n    cancel: Function,\r\n    assignInfos: [Object],\r\n    selectedValues: [String],\r\n    multiSelect: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    assigneeHolder: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    nextNodeHolder: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    processHolder: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  emits: [\r\n    \"update:show\",\r\n    \"open\",\r\n    \"close\"\r\n  ],\r\n  setup(props, { attrs, slots, emit }) {\r\n\r\n\r\n    const _processOc = (value) => {\r\n      if (typeof props.processOc === \"function\") {\r\n        props.processOc(value);\r\n      }\r\n    }\r\n    const _nextNodeOc = (value) => {\r\n      if (typeof props.nextNodeOc === \"function\") {\r\n        props.nextNodeOc(value);\r\n      }\r\n    }\r\n    const _assigneeOc = (value, index) => {\r\n      if (typeof props.assigneeOc === \"function\") {\r\n        props.assigneeOc(value, index);\r\n      }\r\n    }\r\n\r\n    const close = () => {\r\n      emit('update:show', false)\r\n    }\r\n\r\n    const $_confirm = () => {\r\n      if (typeof props.submit === \"function\") {\r\n        props.submit();\r\n      }\r\n    }\r\n    const _cancel = () => {\r\n      close()\r\n      if (typeof props.cancel === \"function\") {\r\n        props.cancel();\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      const {\r\n        process = '',\r\n        processOc,\r\n        processData = [],\r\n        nextNode = '',\r\n        nextNodeOc,\r\n        nextNodeData = [],\r\n        assignee,\r\n        assigneeOc,\r\n        assigneeData,\r\n        submit,\r\n        cancel,\r\n        selectedValues = [],\r\n        processReadFlag,\r\n        nextNodeReadFlag,\r\n        assigneeReadFlag,\r\n        cancelDisabled,\r\n        confirmDisabled,\r\n        multiSelect,\r\n        assigneeHolder,\r\n        nextNodeHolder,\r\n        processHolder,\r\n        assignInfos = []\r\n      } = props\r\n\r\n      // watch(props, (newValue, oldValue) => {\r\n      //   console.log('The new counter value is:newValue ', newValue)\r\n\r\n      //   console.log('The new counter value is: oldValue', oldValue)\r\n\r\n      //   console.log('The new counter value is: ', props)\r\n      // })\r\n\r\n      return (\r\n        <div >\r\n          <fm-popup\r\n            show={props.show}\r\n            position=\"right\"\r\n            style=\"width:100%\"\r\n          >\r\n            <div class=\"fm-submit-approve\">\r\n              <div class=\"fm-submit-approve-header\">\r\n                <fm-navbar title=\"流程选择\" leftArrow={true} onClickLeft={_cancel} />\r\n              </div>\r\n              <div class=\"fm-submit-approve-main\">\r\n                <div class=\"fm-submit-approve-form\">\r\n                  <fm-picker\r\n                    name=\"picker\"\r\n                    v-model={process}\r\n                    label=\"选择流程\"\r\n                    placeholder={processHolder}\r\n                    onChange={_processOc}\r\n                    show-toolbar\r\n                    data={processData}\r\n                    readonly={processReadFlag}\r\n                    textField=\"name\"\r\n                    valueField=\"id\"\r\n                    mapFields={{ id: 'id' }}\r\n                  ></fm-picker>\r\n                  <fm-picker\r\n                    name=\"picker\"\r\n                    v-model={nextNode}\r\n                    label=\"下一环节\"\r\n                    placeholder={nextNodeHolder}\r\n                    onChange={_nextNodeOc}\r\n                    show-toolbar\r\n                    data={nextNodeData}\r\n                    readonly={nextNodeReadFlag}\r\n                    textField=\"name\"\r\n                    valueField=\"id\"\r\n                    mapFields={{ id: 'id' }}\r\n                  ></fm-picker>\r\n                  {\r\n\r\n                    assignInfos.map(\r\n                      (item, index) => {\r\n                        return <fm-lookup-input\r\n                          name=\"lookup-input\"\r\n                          v-model={item.assignee}\r\n                          placeholder={item.assigneeHolder}\r\n                          label={item.label}\r\n                          idField=\"id\"\r\n                          textField=\"name\"\r\n                          data={item.assigneeInfo.assigneeUsers}\r\n                          readonly={item.assigneeReadFlag}\r\n                          multiSelect={item.assigneeInfo && item.assigneeInfo.multiSelect}\r\n                          selectedValues={selectedValues[index] === 'clear' ? '' : selectedValues[index]}\r\n                          onValueChange={(e) => { _assigneeOc(e, index) }}\r\n                        ></fm-lookup-input>\r\n                      }\r\n                    )\r\n                  }\r\n                </div>\r\n                <div class=\"fm-submit-approve-btn\">\r\n                  <fm-button\r\n                    type=\"info\"\r\n                    round\r\n                    block\r\n                    key=\"confirm\"\r\n                    disabled={confirmDisabled}\r\n                    onClick={$_confirm}\r\n                  >确定</fm-button\r\n                  >\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </fm-popup>\r\n        </div>\r\n      )\r\n    }\r\n  },\r\n})\r\n","import { createApp, nextTick, reactive, getCurrentInstance } from \"vue\";\r\nimport FarrisMobileUi from '@farris/mobile-ui'\r\nimport Vant from 'vant';\r\nimport FMApprove from './approve'\r\n\r\nlet instance\r\nlet backAfterClose\r\nlet isFirst = false;\r\nfunction useExpose(apis) {\r\n  const instance = getCurrentInstance();\r\n  if (instance) {\r\n    Object.assign(instance.proxy, apis);\r\n  }\r\n}\r\n\r\nfunction usePopupState() {\r\n  const state = reactive({\r\n    show: false,\r\n  });\r\n\r\n  const toggle = (show) => {\r\n    state.show = show;\r\n  };\r\n\r\n  const open = (props) => {\r\n    Object.assign(state, props);\r\n    pushOriginGoback()\r\n    nextTick(() => {\r\n      toggle(true);\r\n    });\r\n  };\r\n\r\n  const close = () => {\r\n    toggle(false);\r\n    popOriginGoback()\r\n    backAfterClose && backAfterClose();\r\n    instance = undefined\r\n  };\r\n\r\n  useExpose({ open, close, toggle });\r\n\r\n  return {\r\n    open,\r\n    close,\r\n    state,\r\n    toggle,\r\n  };\r\n}\r\n\r\nfunction mountComponent(RootComponent) {\r\n  const app = createApp(RootComponent);\r\n  app.use(Vant).use(FarrisMobileUi);\r\n  const root = document.createElement('div');\r\n  document.body.appendChild(root);\r\n\r\n  return {\r\n    instance: app.mount(root),\r\n    unmount() {\r\n      app.unmount(root);\r\n      document.body.removeChild(root);\r\n    },\r\n  };\r\n}\r\n\r\nconst initInstance = () => {\r\n  const a = mountComponent({\r\n    setup() {\r\n      const { state, toggle } = usePopupState()\r\n      return () => <FMApprove {...{ ...state, 'onUpdate:show': toggle }} />\r\n    },\r\n  })\r\n  instance = a.instance\r\n  backAfterClose = a.unmount\r\n}\r\n\r\nfunction pushOriginGoback() {\r\n  if (!isFirst) {\r\n    window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].pushOriginGoback(closeTheInstance)\r\n    isFirst = true\r\n  }\r\n}\r\n\r\nfunction closeTheInstance() {\r\n  isFirst = false\r\n  instance.close()\r\n}\r\n\r\nfunction popOriginGoback() {\r\n  window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].popOriginGoback()\r\n}\r\n\r\nfunction SubmitApprove(options) {\r\n  if (typeof window === 'undefined') {\r\n    return\r\n  }\r\n\r\n  if (!instance) {\r\n    initInstance()\r\n  }\r\n\r\n  console.log('instance', instance)\r\n  instance.open(options)\r\n  return instance\r\n}\r\n\r\nSubmitApprove.clear = () => {\r\n  if (instance) {\r\n    instance.toggle(false)\r\n  }\r\n}\r\n\r\nSubmitApprove.confirm = options => {\r\n  return SubmitApprove(options)\r\n}\r\n\r\n\r\nSubmitApprove.install = app => {\r\n  app.component(FMApprove.name, FMApprove)\r\n}\r\n\r\nSubmitApprove.Component = FMApprove\r\n\r\nexport default SubmitApprove\r\n","import { defineComponent, ref, watch, reactive, computed } from \"vue\";\r\nimport { Popup, Navbar } from \"@farris/mobile-ui\";\r\n\r\nexport default defineComponent({\r\n  name: \"fm-attachment-preview\",\r\n  components: {\r\n    \"fm-popup\": Popup,\r\n    \"fm-navbar\": Navbar,\r\n  },\r\n  props: {\r\n    title: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    attachmentId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    show: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    path: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  emits: [\"update:show\", \"open\", \"close\"],\r\n  setup(props, { emit }) {\r\n    const close = () => {\r\n      emit(\"update:show\", false);\r\n    };\r\n    const state = reactive({\r\n      attachmentUrl: computed(() => {\r\n        return `/platform/runtime/dfs/viewpage/index.html?metadataId=${props.attachmentId}&rootId=${props.rootId}&fileType=2`;\r\n      }),\r\n      show: false,\r\n    });\r\n    return () => {\r\n      return (\r\n        <div>\r\n          <fm-popup show={props.show} style=\"width:100%;height:100%\">\r\n            <fm-navbar title={props.title} onClickLeft={close}>\r\n              {/* <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template> */}\r\n            </fm-navbar>\r\n            <iframe\r\n              class=\"pdf-iframe\"\r\n              scrolling=\"yes\"\r\n              src={props.path || state.attachmentUrl}\r\n              width=\"100%\"\r\n              height=\"100%\"\r\n            ></iframe>\r\n          </fm-popup>\r\n        </div>\r\n      );\r\n    };\r\n  },\r\n});\r\n","import { createApp, nextTick, reactive, getCurrentInstance } from \"vue\";\r\nimport FarrisMobileUi from \"@farris/mobile-ui\";\r\nimport Vant from \"vant\";\r\nimport FMAttachmentPreview from \"./attachment-preview\";\r\n\r\nlet instance;\r\nlet backAfterClose;\r\nlet isFirst = false;\r\nfunction useExpose(apis) {\r\n  const instance = getCurrentInstance();\r\n  if (instance) {\r\n    Object.assign(instance.proxy, apis);\r\n  }\r\n}\r\n\r\nfunction usePopupState() {\r\n  const state = reactive({\r\n    show: false,\r\n  });\r\n\r\n  const toggle = (show) => {\r\n    state.show = show;\r\n  };\r\n\r\n  const open = (props) => {\r\n    Object.assign(state, props);\r\n    pushOriginGoback();\r\n    if (window.top && window.top !== window.self) {\r\n      openScale(window.top.document);\r\n    }\r\n    openScale(window.document);\r\n    nextTick(() => {\r\n      toggle(true);\r\n    });\r\n  };\r\n\r\n  const close = () => {\r\n    toggle(false);\r\n    popOriginGoback();\r\n    if (window.top && window.top !== window.self) {\r\n      closeScale(window.top.document);\r\n    }\r\n    closeScale(window.document);\r\n    backAfterClose && backAfterClose();\r\n    instance = undefined;\r\n  };\r\n\r\n  useExpose({ open, close, toggle });\r\n\r\n  return {\r\n    open,\r\n    close,\r\n    state,\r\n    toggle,\r\n  };\r\n}\r\n\r\nfunction mountComponent(RootComponent) {\r\n  const app = createApp(RootComponent);\r\n  app.use(Vant).use(FarrisMobileUi);\r\n  const root = document.createElement(\"div\");\r\n  document.body.appendChild(root);\r\n\r\n  return {\r\n    instance: app.mount(root),\r\n    unmount() {\r\n      app.unmount(root);\r\n      document.body.removeChild(root);\r\n    },\r\n  };\r\n}\r\n\r\nconst initInstance = () => {\r\n  const cmp = mountComponent({\r\n    setup() {\r\n      const { state, toggle } = usePopupState();\r\n      return () => (\r\n        <FMAttachmentPreview {...{ ...state, \"onUpdate:show\": toggle }} />\r\n      );\r\n    },\r\n  });\r\n  instance = cmp.instance;\r\n  backAfterClose = cmp.unmount;\r\n};\r\n\r\nfunction pushOriginGoback() {\r\n  if (!isFirst) {\r\n    window[\"MOBILE_ORIGIN_BACK\"] &&\r\n      window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback(closeTheInstance);\r\n    isFirst = true;\r\n  }\r\n}\r\n\r\nfunction closeTheInstance() {\r\n  isFirst = false;\r\n  instance.close();\r\n}\r\n\r\nfunction popOriginGoback() {\r\n  window[\"MOBILE_ORIGIN_BACK\"] &&\r\n    window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback();\r\n}\r\n\r\nfunction AttachmentPreview(options) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  if (!instance) {\r\n    initInstance();\r\n  }\r\n  instance.open(options);\r\n  return instance;\r\n}\r\n\r\nfunction openScale(currentDoc) {\r\n  const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n  const meta = currentDoc.createElement(\"meta\");\r\n  meta.name = \"viewport\";\r\n  meta.content = \"width=device-width, initial-scale=1.0\";\r\n  const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n  if (originMeta) {\r\n    head.removeChild(originMeta);\r\n  }\r\n  head.appendChild(meta);\r\n}\r\n\r\nfunction closeScale(currentDoc) {\r\n  const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n  const meta = currentDoc.createElement(\"meta\");\r\n  meta.name = \"viewport\";\r\n  meta.content =\r\n    \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n\";\r\n  const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n  if (originMeta) {\r\n    head.removeChild(originMeta);\r\n  }\r\n  head.appendChild(meta);\r\n}\r\n\r\nAttachmentPreview.close = () => {\r\n  if (instance) {\r\n    instance.toggle(false);\r\n  }\r\n};\r\n\r\nAttachmentPreview.show = (options) => {\r\n  return AttachmentPreview(options);\r\n};\r\n\r\nAttachmentPreview.install = (app) => {\r\n  app.component(FMAttachmentPreview.name, FMAttachmentPreview);\r\n};\r\n\r\nAttachmentPreview.Component = FMAttachmentPreview;\r\nexport default AttachmentPreview;\r\n","<template>\r\n  <div ref=\"el\" class=\"el-vue-amap-container\">\r\n    <div class=\"el-vue-amap\"></div>\r\n    <slot></slot>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  computed,\r\n  onBeforeMount,\r\n  onMounted,\r\n  onUnmounted,\r\n  reactive,\r\n  ref,\r\n  watch,\r\n} from \"vue\";\r\nimport { lazyAMapApiLoaderInstance, MapPlugin, guid } from \"../service\";\r\n\r\nexport default {\r\n  name: \"el-amap\",\r\n  props: [\r\n    //  add v1.4.0 new feature\r\n    \"viewMode\",\r\n    \"skyColor\",\r\n    \"rotateEnable\",\r\n    \"pitch\",\r\n    \"buildingAnimation\",\r\n    \"pitchEnable\",\r\n    \"vid\",\r\n    \"events\",\r\n    \"center\",\r\n    \"zoom\",\r\n    \"draggEnable\",\r\n    \"level\",\r\n    \"zooms\",\r\n    \"lang\",\r\n    \"defaultCursor\",\r\n    \"crs\",\r\n    \"animateEnable\",\r\n    \"isHotspot\",\r\n    \"defaultLayer\",\r\n    \"resizeEnable\",\r\n    \"showIndoorMap\",\r\n    \"indoorMap\",\r\n    \"expandZoomRange\",\r\n    \"dragEnable\",\r\n    \"zoomEnable\",\r\n    \"doubleClickZoom\",\r\n    \"keyboardEnable\",\r\n    \"jogEnable\",\r\n    \"scrollWheel\",\r\n    \"touchZoom\",\r\n    \"mapStyle\",\r\n    \"plugin\",\r\n    \"features\",\r\n    \"amapManager\", // 地图管理 manager\r\n    \"markers\",\r\n  ],\r\n  setup(props, { emit, attrs, slots }) {\r\n    const el = ref(null);\r\n    const state = reactive({\r\n      converters: {\r\n        center(arr) {\r\n          if (\r\n            Object.prototype.toString.call(arr) === \"[object Array]\" &&\r\n            arr[0] &&\r\n            arr[1]\r\n          ) {\r\n            return new AMap.LngLat(arr[0], arr[1]);\r\n          }\r\n        },\r\n      },\r\n      $amap: \"\",\r\n      $amapComponent: \"\",\r\n      loadPromise: null,\r\n      circleMarker: \"\",\r\n      plugins: computed(() => {\r\n        let plus = [];\r\n        //地图前缀\r\n        const amap_prefix_reg = /^AMap./;\r\n\r\n        //  获取带前缀的名称\r\n        const parseFullName = (pluginName) => {\r\n          return amap_prefix_reg.test(pluginName)\r\n            ? pluginName\r\n            : \"AMap.\" + pluginName;\r\n        };\r\n\r\n        // 获取不带前缀的名称\r\n        const parseShortName = (pluginName) => {\r\n          return pluginName.replace(amap_prefix_reg, \"\");\r\n        };\r\n\r\n        if (typeof props.plugin === \"string\") {\r\n          plus.push({\r\n            pName: parseFullName(props.plugin),\r\n            sName: parseShortName(props.plugin),\r\n          });\r\n        } else if (props.plugin instanceof Array) {\r\n          plus = props.plugin.map((oPlugin) => {\r\n            let nPlugin = {};\r\n\r\n            if (typeof oPlugin === \"string\") {\r\n              nPlugin = {\r\n                pName: parseFullName(oPlugin),\r\n                sName: parseShortName(oPlugin),\r\n              };\r\n            } else {\r\n              oPlugin.pName = parseFullName(oPlugin.pName);\r\n              oPlugin.sName = parseShortName(oPlugin.pName);\r\n              nPlugin = oPlugin;\r\n            }\r\n            return nPlugin;\r\n          });\r\n        }\r\n        return plus;\r\n      }),\r\n    });\r\n    // 挂载前  加载地图脚本\r\n    onBeforeMount(() => {\r\n      state.loadPromise = lazyAMapApiLoaderInstance.load();\r\n    });\r\n    watch(\r\n      () => props.center,\r\n      (newValue, oldValue) => {\r\n        if (state.$amapComponent) {\r\n          const map = state.$amapComponent;\r\n          map.setCenter(newValue);\r\n          emit(\"setCircleMarker\", newValue, map);\r\n        }\r\n      }\r\n    );\r\n    // 加载地图\r\n    onMounted(() => {\r\n      createMap();\r\n    });\r\n    onUnmounted(() => {\r\n      state.$amap.destroy();\r\n    });\r\n    const createMap = () => {\r\n      state.loadPromise.then(() => {\r\n        // 构造地图\r\n        const mapElement = el.value.querySelector(\".el-vue-amap\");\r\n        const elementID = props.vid || guid();\r\n        mapElement.id = elementID;\r\n        state.$amap = state.$amapComponent = new AMap.Map(\r\n          elementID,\r\n          convertProps()\r\n        );\r\n        if (props.amapManager) props.amapManager.setMap(state.$amap);\r\n        // emit(CONST.AMAP_READY_EVENT, this.$amap);\r\n        // 添加插件\r\n        if (state.plugins && state.plugins.length) {\r\n          const mapPlugin = new MapPlugin();\r\n          mapPlugin.addPlugins(state.$amapComponent, state.plugins);\r\n        }\r\n        // 注册事件\r\n        if (props.events) {\r\n          Object.keys(props.events).forEach((eventName) => {\r\n            AMap.event.addListener(\r\n              state.$amapComponent,\r\n              eventName,\r\n              props.events[eventName]\r\n            );\r\n          });\r\n        }\r\n        emit(\"afterInit\", props.center, state.$amapComponent);\r\n      });\r\n    };\r\n    const convertProps = () => {\r\n      const propsObj = {};\r\n      if (state.$amap) propsObj.map = state.$amap;\r\n      return Object.keys(props).reduce((res, _key) => {\r\n        const key = _key;\r\n        const propsValue = convertSignalProp(key, props[key]);\r\n        if (propsValue === undefined) return res;\r\n        propsObj[key] = propsValue;\r\n        return res;\r\n      }, propsObj);\r\n    };\r\n    const convertSignalProp = (key, sourceData) => {\r\n      const converter = \"\";\r\n      const type = \"\";\r\n      if (type && converter) {\r\n        return converter(sourceData);\r\n      } else if (state.converters && state.converters[key]) {\r\n        return state.converters[key].call(this, sourceData);\r\n      }\r\n      return sourceData;\r\n    };\r\n\r\n    return {\r\n      el,\r\n      state,\r\n      createMap,\r\n      convertProps,\r\n      convertSignalProp,\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.el-vue-amap-container {\r\n  height: 100%;\r\n  & .el-vue-amap {\r\n    height: 100%;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div ref=\"el\" class=\"el-vue-amap-container\">\r\n    <div class=\"el-vue-amap\"></div>\r\n    <slot></slot>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  computed,\r\n  onBeforeMount,\r\n  onMounted,\r\n  onUnmounted,\r\n  reactive,\r\n  ref,\r\n  watch,\r\n} from \"vue\";\r\nimport { lazyAMapApiLoaderInstance, MapPlugin, guid } from \"../service\";\r\n\r\nexport default {\r\n  name: \"el-amap\",\r\n  props: [\r\n    //  add v1.4.0 new feature\r\n    \"viewMode\",\r\n    \"skyColor\",\r\n    \"rotateEnable\",\r\n    \"pitch\",\r\n    \"buildingAnimation\",\r\n    \"pitchEnable\",\r\n    \"vid\",\r\n    \"events\",\r\n    \"center\",\r\n    \"zoom\",\r\n    \"draggEnable\",\r\n    \"level\",\r\n    \"zooms\",\r\n    \"lang\",\r\n    \"defaultCursor\",\r\n    \"crs\",\r\n    \"animateEnable\",\r\n    \"isHotspot\",\r\n    \"defaultLayer\",\r\n    \"resizeEnable\",\r\n    \"showIndoorMap\",\r\n    \"indoorMap\",\r\n    \"expandZoomRange\",\r\n    \"dragEnable\",\r\n    \"zoomEnable\",\r\n    \"doubleClickZoom\",\r\n    \"keyboardEnable\",\r\n    \"jogEnable\",\r\n    \"scrollWheel\",\r\n    \"touchZoom\",\r\n    \"mapStyle\",\r\n    \"plugin\",\r\n    \"features\",\r\n    \"amapManager\", // 地图管理 manager\r\n    \"markers\",\r\n  ],\r\n  setup(props, { emit, attrs, slots }) {\r\n    const el = ref(null);\r\n    const state = reactive({\r\n      converters: {\r\n        center(arr) {\r\n          if (\r\n            Object.prototype.toString.call(arr) === \"[object Array]\" &&\r\n            arr[0] &&\r\n            arr[1]\r\n          ) {\r\n            return new AMap.LngLat(arr[0], arr[1]);\r\n          }\r\n        },\r\n      },\r\n      $amap: \"\",\r\n      $amapComponent: \"\",\r\n      loadPromise: null,\r\n      circleMarker: \"\",\r\n      plugins: computed(() => {\r\n        let plus = [];\r\n        //地图前缀\r\n        const amap_prefix_reg = /^AMap./;\r\n\r\n        //  获取带前缀的名称\r\n        const parseFullName = (pluginName) => {\r\n          return amap_prefix_reg.test(pluginName)\r\n            ? pluginName\r\n            : \"AMap.\" + pluginName;\r\n        };\r\n\r\n        // 获取不带前缀的名称\r\n        const parseShortName = (pluginName) => {\r\n          return pluginName.replace(amap_prefix_reg, \"\");\r\n        };\r\n\r\n        if (typeof props.plugin === \"string\") {\r\n          plus.push({\r\n            pName: parseFullName(props.plugin),\r\n            sName: parseShortName(props.plugin),\r\n          });\r\n        } else if (props.plugin instanceof Array) {\r\n          plus = props.plugin.map((oPlugin) => {\r\n            let nPlugin = {};\r\n\r\n            if (typeof oPlugin === \"string\") {\r\n              nPlugin = {\r\n                pName: parseFullName(oPlugin),\r\n                sName: parseShortName(oPlugin),\r\n              };\r\n            } else {\r\n              oPlugin.pName = parseFullName(oPlugin.pName);\r\n              oPlugin.sName = parseShortName(oPlugin.pName);\r\n              nPlugin = oPlugin;\r\n            }\r\n            return nPlugin;\r\n          });\r\n        }\r\n        return plus;\r\n      }),\r\n    });\r\n    // 挂载前  加载地图脚本\r\n    onBeforeMount(() => {\r\n      state.loadPromise = lazyAMapApiLoaderInstance.load();\r\n    });\r\n    watch(\r\n      () => props.center,\r\n      (newValue, oldValue) => {\r\n        if (state.$amapComponent) {\r\n          const map = state.$amapComponent;\r\n          map.setCenter(newValue);\r\n          emit(\"setCircleMarker\", newValue, map);\r\n        }\r\n      }\r\n    );\r\n    // 加载地图\r\n    onMounted(() => {\r\n      createMap();\r\n    });\r\n    onUnmounted(() => {\r\n      state.$amap.destroy();\r\n    });\r\n    const createMap = () => {\r\n      state.loadPromise.then(() => {\r\n        // 构造地图\r\n        const mapElement = el.value.querySelector(\".el-vue-amap\");\r\n        const elementID = props.vid || guid();\r\n        mapElement.id = elementID;\r\n        state.$amap = state.$amapComponent = new AMap.Map(\r\n          elementID,\r\n          convertProps()\r\n        );\r\n        if (props.amapManager) props.amapManager.setMap(state.$amap);\r\n        // emit(CONST.AMAP_READY_EVENT, this.$amap);\r\n        // 添加插件\r\n        if (state.plugins && state.plugins.length) {\r\n          const mapPlugin = new MapPlugin();\r\n          mapPlugin.addPlugins(state.$amapComponent, state.plugins);\r\n        }\r\n        // 注册事件\r\n        if (props.events) {\r\n          Object.keys(props.events).forEach((eventName) => {\r\n            AMap.event.addListener(\r\n              state.$amapComponent,\r\n              eventName,\r\n              props.events[eventName]\r\n            );\r\n          });\r\n        }\r\n        emit(\"afterInit\", props.center, state.$amapComponent);\r\n      });\r\n    };\r\n    const convertProps = () => {\r\n      const propsObj = {};\r\n      if (state.$amap) propsObj.map = state.$amap;\r\n      return Object.keys(props).reduce((res, _key) => {\r\n        const key = _key;\r\n        const propsValue = convertSignalProp(key, props[key]);\r\n        if (propsValue === undefined) return res;\r\n        propsObj[key] = propsValue;\r\n        return res;\r\n      }, propsObj);\r\n    };\r\n    const convertSignalProp = (key, sourceData) => {\r\n      const converter = \"\";\r\n      const type = \"\";\r\n      if (type && converter) {\r\n        return converter(sourceData);\r\n      } else if (state.converters && state.converters[key]) {\r\n        return state.converters[key].call(this, sourceData);\r\n      }\r\n      return sourceData;\r\n    };\r\n\r\n    return {\r\n      el,\r\n      state,\r\n      createMap,\r\n      convertProps,\r\n      convertSignalProp,\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.el-vue-amap-container {\r\n  height: 100%;\r\n  & .el-vue-amap {\r\n    height: 100%;\r\n  }\r\n}\r\n</style>\r\n",null,"<template>\r\n  <div>\r\n    <div :style=\"{ width: width, height: height }\">\r\n      <el-amap\r\n        ref=\"map\"\r\n        vid=\"amapDemo\"\r\n        :resizeEnable=\"resizeEnable\"\r\n        :dragEnable=\"dragEnable\"\r\n        :zoomEnable=\"zoomEnable\"\r\n        :center=\"center\"\r\n        :zoom=\"zoom\"\r\n        :plugin=\"plugin\"\r\n        :events=\"events\"\r\n        :amapManager=\"amapManager\"\r\n        @afterInit=\"afterInit\"\r\n        @setCircleMarker=\"afterInit\"\r\n      >\r\n      </el-amap>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent, ref } from \"vue\";\r\nimport VueAMap, { AMapManager } from \"./index\";\r\n\r\nexport default defineComponent({\r\n  name: \"fm-map\",\r\n  components: {},\r\n  inject: {\r\n    mapService: { default: null },\r\n  },\r\n  props: {\r\n    width: {\r\n      type: String,\r\n      default: \"100%\",\r\n    },\r\n    height: {\r\n      type: String,\r\n      default: \"400px\",\r\n    },\r\n    zoomEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    dragEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    resizeEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    zoom: {\r\n      type: Number,\r\n      default: 12,\r\n    },\r\n    center: {\r\n      type: Array,\r\n      default: () => [0, 0],\r\n    },\r\n    markers: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    limitCity: {\r\n      type: String,\r\n      default: \"山东\",\r\n    },\r\n    limitSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    showSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    mapKey: {\r\n      type: String,\r\n      default: \"ee46e4ad4d6e45789dc9f2754271e2a6\",\r\n    },\r\n    displayDireaction: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  created() {\r\n    VueAMap.initAMapApiLoader({\r\n      key: this.mapKey,\r\n      plugin: [\r\n        \"AMap.Autocomplete\",\r\n        \"AMap.PlaceSearch\",\r\n        \"AMap.Scale\",\r\n        \"AMap.OverView\",\r\n        \"AMap.Geolocation\",\r\n        \"AMap.ToolBar\",\r\n        \"AMap.MapType\",\r\n        \"AMap.PolyEditor\",\r\n        \"AMap.CircleEditor\",\r\n        \"AMap.Geocoder\",\r\n      ],\r\n      // 默认高德 sdk 版本为 1.4.4\r\n      v: \"1.4.4\",\r\n    });\r\n  },\r\n  mounted() {},\r\n  unmounted() {\r\n    if (this.mapMarkers && this.mapMarkers.length) {\r\n      this.emptyMarkers();\r\n    }\r\n  },\r\n  data() {\r\n    const self = this;\r\n    return {\r\n      amapManager: new AMapManager(),\r\n      subject: null,\r\n      mapMarkers: [],\r\n      // amapManager,\r\n      defaultCenter: [0, 0],\r\n      events: {\r\n        init: (o) => {\r\n          this.addMarkers(this.markers, o);\r\n        },\r\n        zoomchange: () => {\r\n          this.$emit(\"zoomChange\");\r\n        },\r\n        click: (e) => {\r\n          const geocoder = new AMap.Geocoder({\r\n            radius: 1000,\r\n            extensions: \"all\",\r\n          });\r\n          const that = this;\r\n          let address = \"\";\r\n          geocoder.getAddress([e.lnglat.lng, e.lnglat.lat], function(\r\n            status,\r\n            result\r\n          ) {\r\n            if (status === \"complete\" && result.info === \"OK\") {\r\n              if (result && result.regeocode) {\r\n                address = result.regeocode.formattedAddress;\r\n                e.address = address;\r\n                that.$emit(\"markMap\", e);\r\n                // 设置位置\r\n                // 显示位置\r\n              }\r\n            }\r\n          });\r\n        },\r\n      },\r\n      plugin: [\r\n        {\r\n          pName: \"Scale\",\r\n          events: {\r\n            init(instance) {},\r\n          },\r\n        },\r\n        {\r\n          pName: \"Geolocation\", //定位\r\n          events: {\r\n            init(o) {\r\n              //   if (!self.center || self.center[0] == 0 || self.center[1] == 0) {\r\n              //     o.getCurrentPosition((status, result) => {\r\n              //       if (result && result.position) {\r\n              //         // 设置中心点\r\n              //         self.defaultCenter = [\r\n              //           result.position.lng,\r\n              //           result.position.lat,\r\n              //         ]; //设置坐标\r\n              //         // 设置点坐标\r\n              //         // const map = self.amapManager.getMap();\r\n              //         self.resetMarkers(self.markers);\r\n              //         self.$nextTick(); //页面渲染好后\r\n              //         self.$emit(\"getCurrentLocation\", result);\r\n              //       }\r\n              //     });\r\n              //   }\r\n            },\r\n          },\r\n          // 禁止移动端浏览器定位\r\n          noGeoLocation: 1,\r\n          // 外网访问\r\n          // noGeoLocation: 0,\r\n          enableHighAccuracy: false, //是否使用高精度定位，默认:true\r\n          timeout: 10000, //超过10秒后停止定位，默认：无穷大\r\n          maximumAge: 0, //定位结果缓存0毫秒，默认：0\r\n          convert: true, //自动偏移坐标，偏移后的坐标为高德坐标，默认：true\r\n          showButton:\r\n            !self.center || self.center[0] == 0 || self.center[1] == 0, //显示定位按钮，默认：true\r\n          buttonPosition: \"LB\", //定位按钮停靠位置，默认：'LB'，左下角\r\n          //buttonOffset: window.AMap&&new window.AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)\r\n          showMarker: true, //定位成功后在定位到的位置显示点标记，默认：true\r\n          showCircle: true, //定位成功后用圆圈表示定位精度范围，默认：true\r\n          panToLocation: true, //定位成功后将定位到的位置作为地图中心点，默认：true\r\n          zoomToAccuracy: true, //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false\r\n        },\r\n      ],\r\n      markerEvents: {\r\n        click: (e) => {\r\n          // 点击事件  返回坐标\r\n          this.$emit(\"clickMaker\", e);\r\n        },\r\n        dragend: (e) => {\r\n          // 拖拽结束事件  返回坐标\r\n          // this.markers[0].position = [e.lnglat.lng, e.lnglat.lat];\r\n          this.$emit(\"dragMarkerEnd\", e);\r\n        },\r\n      },\r\n      defaultMarkers: [],\r\n      mapCenter: \"\",\r\n    };\r\n  },\r\n  watch: {\r\n    markers(value) {\r\n      if (window.AMap && value) {\r\n        this.resetMarkers(value);\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    computedMarkers() {\r\n      if (!this.markers) {\r\n        return [];\r\n      }\r\n      if (window.AMap) {\r\n        // this.resetMarkers(this.markers);\r\n      }\r\n      return this.markers.length ? this.markers : this.defaultMarkers;\r\n    },\r\n    computedCenter() {\r\n      return this.center || this.defaultCenter;\r\n    },\r\n  },\r\n  methods: {\r\n    getPosition() {\r\n      this.mapService.getCurrentLocation();\r\n    },\r\n    afterInit(center, map): void {\r\n      this.addMarkers(this.markers, map);\r\n      if (\r\n        Object.prototype.toString.call(this.center) === \"[object Array]\" &&\r\n        this.center[0] &&\r\n        this.center[1]\r\n      ) {\r\n        const circleMarker = new AMap.CircleMarker({\r\n          center,\r\n          radius: 10, //3D视图下，CircleMarker半径不要超过64px\r\n          strokeColor: \"white\",\r\n          strokeWeight: 2,\r\n          strokeOpacity: 0.5,\r\n          fillColor: \"rgba(30,144,255)\",\r\n          fillOpacity: 0.5,\r\n          zIndex: 10,\r\n          bubble: true,\r\n          cursor: \"pointer\",\r\n          clickable: true,\r\n        });\r\n        circleMarker.setMap(map);\r\n      }\r\n      this.resetMarkers(this.markers);\r\n    },\r\n    getCurrentLocation() {},\r\n    onSearchResult(e) {},\r\n    getCenter() {\r\n      return this.$refs.map.$$getCenter();\r\n    },\r\n    getCurrentPosition() {},\r\n    // 添加坐标\r\n    addMarkers(markers, map) {\r\n      // const map = this.amapManager.getMap();\r\n      const mapMarkers = markers.map((marker) => {\r\n        return new AMap.Marker({\r\n          position: marker.position,\r\n        });\r\n      });\r\n      // 存储坐标\r\n      this.mapMarkers = [...mapMarkers];\r\n      this.mapMarkers.forEach((ele) => {\r\n        map.add(ele);\r\n      });\r\n    },\r\n    removeMarkers() {},\r\n    emptyMarkers() {\r\n      const map = this.amapManager.getMap();\r\n      map.remove(this.mapMarkers);\r\n      this.mapMarkers.splice(0, this.mapMarkers.length);\r\n    },\r\n    resetMarkers(markers) {\r\n      this.emptyMarkers();\r\n      this.addMarkers(markers, this.amapManager.getMap());\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.farris-mobile-map {\r\n  width: 100%;\r\n  height: 450px;\r\n}\r\n.amap-logo {\r\n  visibility: hidden;\r\n}\r\n.amap-scalecontrol {\r\n  visibility: hidden !important;\r\n}\r\n.amap-copyright {\r\n  visibility: hidden !important;\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <div :style=\"{ width: width, height: height }\">\r\n      <el-amap\r\n        ref=\"map\"\r\n        vid=\"amapDemo\"\r\n        :resizeEnable=\"resizeEnable\"\r\n        :dragEnable=\"dragEnable\"\r\n        :zoomEnable=\"zoomEnable\"\r\n        :center=\"center\"\r\n        :zoom=\"zoom\"\r\n        :plugin=\"plugin\"\r\n        :events=\"events\"\r\n        :amapManager=\"amapManager\"\r\n        @afterInit=\"afterInit\"\r\n        @setCircleMarker=\"afterInit\"\r\n      >\r\n      </el-amap>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent, ref } from \"vue\";\r\nimport VueAMap, { AMapManager } from \"./index\";\r\n\r\nexport default defineComponent({\r\n  name: \"fm-map\",\r\n  components: {},\r\n  inject: {\r\n    mapService: { default: null },\r\n  },\r\n  props: {\r\n    width: {\r\n      type: String,\r\n      default: \"100%\",\r\n    },\r\n    height: {\r\n      type: String,\r\n      default: \"400px\",\r\n    },\r\n    zoomEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    dragEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    resizeEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    zoom: {\r\n      type: Number,\r\n      default: 12,\r\n    },\r\n    center: {\r\n      type: Array,\r\n      default: () => [0, 0],\r\n    },\r\n    markers: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    limitCity: {\r\n      type: String,\r\n      default: \"山东\",\r\n    },\r\n    limitSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    showSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    mapKey: {\r\n      type: String,\r\n      default: \"ee46e4ad4d6e45789dc9f2754271e2a6\",\r\n    },\r\n    displayDireaction: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  created() {\r\n    VueAMap.initAMapApiLoader({\r\n      key: this.mapKey,\r\n      plugin: [\r\n        \"AMap.Autocomplete\",\r\n        \"AMap.PlaceSearch\",\r\n        \"AMap.Scale\",\r\n        \"AMap.OverView\",\r\n        \"AMap.Geolocation\",\r\n        \"AMap.ToolBar\",\r\n        \"AMap.MapType\",\r\n        \"AMap.PolyEditor\",\r\n        \"AMap.CircleEditor\",\r\n        \"AMap.Geocoder\",\r\n      ],\r\n      // 默认高德 sdk 版本为 1.4.4\r\n      v: \"1.4.4\",\r\n    });\r\n  },\r\n  mounted() {},\r\n  unmounted() {\r\n    if (this.mapMarkers && this.mapMarkers.length) {\r\n      this.emptyMarkers();\r\n    }\r\n  },\r\n  data() {\r\n    const self = this;\r\n    return {\r\n      amapManager: new AMapManager(),\r\n      subject: null,\r\n      mapMarkers: [],\r\n      // amapManager,\r\n      defaultCenter: [0, 0],\r\n      events: {\r\n        init: (o) => {\r\n          this.addMarkers(this.markers, o);\r\n        },\r\n        zoomchange: () => {\r\n          this.$emit(\"zoomChange\");\r\n        },\r\n        click: (e) => {\r\n          const geocoder = new AMap.Geocoder({\r\n            radius: 1000,\r\n            extensions: \"all\",\r\n          });\r\n          const that = this;\r\n          let address = \"\";\r\n          geocoder.getAddress([e.lnglat.lng, e.lnglat.lat], function(\r\n            status,\r\n            result\r\n          ) {\r\n            if (status === \"complete\" && result.info === \"OK\") {\r\n              if (result && result.regeocode) {\r\n                address = result.regeocode.formattedAddress;\r\n                e.address = address;\r\n                that.$emit(\"markMap\", e);\r\n                // 设置位置\r\n                // 显示位置\r\n              }\r\n            }\r\n          });\r\n        },\r\n      },\r\n      plugin: [\r\n        {\r\n          pName: \"Scale\",\r\n          events: {\r\n            init(instance) {},\r\n          },\r\n        },\r\n        {\r\n          pName: \"Geolocation\", //定位\r\n          events: {\r\n            init(o) {\r\n              //   if (!self.center || self.center[0] == 0 || self.center[1] == 0) {\r\n              //     o.getCurrentPosition((status, result) => {\r\n              //       if (result && result.position) {\r\n              //         // 设置中心点\r\n              //         self.defaultCenter = [\r\n              //           result.position.lng,\r\n              //           result.position.lat,\r\n              //         ]; //设置坐标\r\n              //         // 设置点坐标\r\n              //         // const map = self.amapManager.getMap();\r\n              //         self.resetMarkers(self.markers);\r\n              //         self.$nextTick(); //页面渲染好后\r\n              //         self.$emit(\"getCurrentLocation\", result);\r\n              //       }\r\n              //     });\r\n              //   }\r\n            },\r\n          },\r\n          // 禁止移动端浏览器定位\r\n          noGeoLocation: 1,\r\n          // 外网访问\r\n          // noGeoLocation: 0,\r\n          enableHighAccuracy: false, //是否使用高精度定位，默认:true\r\n          timeout: 10000, //超过10秒后停止定位，默认：无穷大\r\n          maximumAge: 0, //定位结果缓存0毫秒，默认：0\r\n          convert: true, //自动偏移坐标，偏移后的坐标为高德坐标，默认：true\r\n          showButton:\r\n            !self.center || self.center[0] == 0 || self.center[1] == 0, //显示定位按钮，默认：true\r\n          buttonPosition: \"LB\", //定位按钮停靠位置，默认：'LB'，左下角\r\n          //buttonOffset: window.AMap&&new window.AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)\r\n          showMarker: true, //定位成功后在定位到的位置显示点标记，默认：true\r\n          showCircle: true, //定位成功后用圆圈表示定位精度范围，默认：true\r\n          panToLocation: true, //定位成功后将定位到的位置作为地图中心点，默认：true\r\n          zoomToAccuracy: true, //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false\r\n        },\r\n      ],\r\n      markerEvents: {\r\n        click: (e) => {\r\n          // 点击事件  返回坐标\r\n          this.$emit(\"clickMaker\", e);\r\n        },\r\n        dragend: (e) => {\r\n          // 拖拽结束事件  返回坐标\r\n          // this.markers[0].position = [e.lnglat.lng, e.lnglat.lat];\r\n          this.$emit(\"dragMarkerEnd\", e);\r\n        },\r\n      },\r\n      defaultMarkers: [],\r\n      mapCenter: \"\",\r\n    };\r\n  },\r\n  watch: {\r\n    markers(value) {\r\n      if (window.AMap && value) {\r\n        this.resetMarkers(value);\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    computedMarkers() {\r\n      if (!this.markers) {\r\n        return [];\r\n      }\r\n      if (window.AMap) {\r\n        // this.resetMarkers(this.markers);\r\n      }\r\n      return this.markers.length ? this.markers : this.defaultMarkers;\r\n    },\r\n    computedCenter() {\r\n      return this.center || this.defaultCenter;\r\n    },\r\n  },\r\n  methods: {\r\n    getPosition() {\r\n      this.mapService.getCurrentLocation();\r\n    },\r\n    afterInit(center, map): void {\r\n      this.addMarkers(this.markers, map);\r\n      if (\r\n        Object.prototype.toString.call(this.center) === \"[object Array]\" &&\r\n        this.center[0] &&\r\n        this.center[1]\r\n      ) {\r\n        const circleMarker = new AMap.CircleMarker({\r\n          center,\r\n          radius: 10, //3D视图下，CircleMarker半径不要超过64px\r\n          strokeColor: \"white\",\r\n          strokeWeight: 2,\r\n          strokeOpacity: 0.5,\r\n          fillColor: \"rgba(30,144,255)\",\r\n          fillOpacity: 0.5,\r\n          zIndex: 10,\r\n          bubble: true,\r\n          cursor: \"pointer\",\r\n          clickable: true,\r\n        });\r\n        circleMarker.setMap(map);\r\n      }\r\n      this.resetMarkers(this.markers);\r\n    },\r\n    getCurrentLocation() {},\r\n    onSearchResult(e) {},\r\n    getCenter() {\r\n      return this.$refs.map.$$getCenter();\r\n    },\r\n    getCurrentPosition() {},\r\n    // 添加坐标\r\n    addMarkers(markers, map) {\r\n      // const map = this.amapManager.getMap();\r\n      const mapMarkers = markers.map((marker) => {\r\n        return new AMap.Marker({\r\n          position: marker.position,\r\n        });\r\n      });\r\n      // 存储坐标\r\n      this.mapMarkers = [...mapMarkers];\r\n      this.mapMarkers.forEach((ele) => {\r\n        map.add(ele);\r\n      });\r\n    },\r\n    removeMarkers() {},\r\n    emptyMarkers() {\r\n      const map = this.amapManager.getMap();\r\n      map.remove(this.mapMarkers);\r\n      this.mapMarkers.splice(0, this.mapMarkers.length);\r\n    },\r\n    resetMarkers(markers) {\r\n      this.emptyMarkers();\r\n      this.addMarkers(markers, this.amapManager.getMap());\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.farris-mobile-map {\r\n  width: 100%;\r\n  height: 450px;\r\n}\r\n.amap-logo {\r\n  visibility: hidden;\r\n}\r\n.amap-scalecontrol {\r\n  visibility: hidden !important;\r\n}\r\n.amap-copyright {\r\n  visibility: hidden !important;\r\n}\r\n</style>\r\n",null,null,"\r\n\r\n<template>\r\n  <div class=\"fm-tmpl-struct-wrapper\" v-if=\"visiavle\" id=\"section-83f5062\">\r\n    <div class=\"fm-tmpl-section fm-tmpl-section-form\">\r\n      <div class=\"fm-tmpl-section-header\">\r\n        <div class=\"fm-title\">\r\n          <span class=\"fm-title-text\">{{ title }}</span>\r\n        </div>\r\n      </div>\r\n      <div id=\"approval-logs-container\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { onMounted, watch, toRefs, defineComponent } from \"vue\";\r\n\r\ndeclare const System: any;\r\n\r\nexport default defineComponent({\r\n  name: \"approval-logs\",\r\n\r\n  props: {\r\n    dataId: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"审批记录\",\r\n    },\r\n    visiavle: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n\r\n  setup(props) {\r\n    const { dataId } = toRefs(props);\r\n\r\n    const getApprovalLogs = () => {\r\n      if (!dataId.value) {\r\n        return;\r\n      }\r\n      const containerElem = document.getElementById(\"approval-logs-container\");\r\n      let approvalLogUrl =\r\n        \"/platform/runtime/wf/webapp/mobiletaskcenter/taskComment.js\";\r\n      const version = \"\" + new Date().getTime();\r\n      approvalLogUrl = approvalLogUrl + `?version=${version}`;\r\n\r\n      System.import(approvalLogUrl).then(() => {\r\n        const taskLogsPayload = {\r\n          bizInstId: dataId.value,\r\n          procInstId: \"\",\r\n          isIncludeHistory: false,\r\n        };\r\n        const ApprovalLogUtil = window[\"gspTaskCenterBizLog\"].ApprovalLogUtil;\r\n        ApprovalLogUtil.getBizlogHtml(taskLogsPayload, containerElem);\r\n      });\r\n    };\r\n\r\n    onMounted(getApprovalLogs);\r\n\r\n    watch(dataId, getApprovalLogs);\r\n\r\n    return {};\r\n  },\r\n});\r\n</script>\r\n","\r\n\r\n<template>\r\n  <div class=\"fm-tmpl-struct-wrapper\" v-if=\"visiavle\" id=\"section-83f5062\">\r\n    <div class=\"fm-tmpl-section fm-tmpl-section-form\">\r\n      <div class=\"fm-tmpl-section-header\">\r\n        <div class=\"fm-title\">\r\n          <span class=\"fm-title-text\">{{ title }}</span>\r\n        </div>\r\n      </div>\r\n      <div id=\"approval-logs-container\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { onMounted, watch, toRefs, defineComponent } from \"vue\";\r\n\r\ndeclare const System: any;\r\n\r\nexport default defineComponent({\r\n  name: \"approval-logs\",\r\n\r\n  props: {\r\n    dataId: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"审批记录\",\r\n    },\r\n    visiavle: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n\r\n  setup(props) {\r\n    const { dataId } = toRefs(props);\r\n\r\n    const getApprovalLogs = () => {\r\n      if (!dataId.value) {\r\n        return;\r\n      }\r\n      const containerElem = document.getElementById(\"approval-logs-container\");\r\n      let approvalLogUrl =\r\n        \"/platform/runtime/wf/webapp/mobiletaskcenter/taskComment.js\";\r\n      const version = \"\" + new Date().getTime();\r\n      approvalLogUrl = approvalLogUrl + `?version=${version}`;\r\n\r\n      System.import(approvalLogUrl).then(() => {\r\n        const taskLogsPayload = {\r\n          bizInstId: dataId.value,\r\n          procInstId: \"\",\r\n          isIncludeHistory: false,\r\n        };\r\n        const ApprovalLogUtil = window[\"gspTaskCenterBizLog\"].ApprovalLogUtil;\r\n        ApprovalLogUtil.getBizlogHtml(taskLogsPayload, containerElem);\r\n      });\r\n    };\r\n\r\n    onMounted(getApprovalLogs);\r\n\r\n    watch(dataId, getApprovalLogs);\r\n\r\n    return {};\r\n  },\r\n});\r\n</script>\r\n",null,null],"names":["uuid","d","Date","getTime","replace","c","r","Math","random","floor","toString","defineComponent","name","components","Uploader","Empty","Image","Popup","Grid","GridItem","Row","Col","ImagePreview","Component","inject","attachmentService","default","uploadAttachmentService","props","fileList","type","Array","multiple","Boolean","accept","String","disabled","beforeReadFile","Function","uploadFile","previewFile","allowDefaultEntrance","beforeTakePhoto","uploadInfo","Object","parentDirName","rootId","pattern","ccWork","photo","quality","mode","mark","isPhoto","selectFile","mType","maxNum","video","id","time","isVideo","album","isAlbum","cloudPlus","encodingType","targetWidth","targetHeight","maximum","fileType","isFile","externalVideoUrl","data","fromProp","rawFiles","showAction","saveAction","selectedFile","selectedFilePath","description","notUploadedFileList","previewPages","pdfUrl","show","showPdf","showDoc","videoUrl","selectedAttachmentId","subscription","imgHeight","imhWidth","hasFiles","docStyle","computed","uploadFiles","self","concat","map","file","length","find","f","$nextTick","goTouchStart","rawFile","attachmentId","$loading","hide","calculateImgSize","previewEnable","gridNumber","Number","created","mounted","collectFile","subscribe","res","prototype","call","console","log","afterRead","unmounted","unsubscribe","methods","appendFile","selectAttachment","$refs","fileUploadRef","chooseFile","getSysInfo","platform","beforeRead","beforeReadRes","fileItem","$notify","warning","url","substring","lastIndexOf","upload","list","fileName","metadataId","$emit","l","deleteFile","deleteAttachment","item","toLowerCase","includes","getToken","mergeString","str","str1","min","i","array","str2","str3","randomArray","ceil","push","splice","timeStamp","round","switchStr","genPreview","originMeta","document","getElementsByName","meta","createElement","content","head","getElementsByTagName","removeChild","appendChild","search","getAttachmentPath","getAttachmentPathByType","attachment","getFitToWidth","pageWidth","pageHeight","pageWidth1","ptToPx","pageHeight1","offsetWidth","window","innerWidth","pt","isMobile","width","isTablet","isDesktop","takePhoto","selectFromAlbum","takeShortVideo","getVideoFile","externalSize","size","attach","getBoundingClientRect","naviSize","navigation","height","imgContainer","imgContainerHeight","closed","class","ref","_createVNode","_createBlock","_hoisted_1","_ctx","_hoisted_2","_hoisted_3","fit","src","onClick","controls","controlslist","closeable","onClosed","style","title","onClickLeft","left","color","scrolling","page","index","key","innerHTML","_createCommentVNode","_hoisted_5","clickable","text","icon","justify","span","onTouchstart","_hoisted_6","styleInject","css","insertAt","firstChild","insertBefore","styleSheet","cssText","createTextNode","Attachment","install","app","component","UploadOptions","removable","direction","uploadOptions","showPhoto","showAlbum","showVideo","showFile","photoQuality","albumQuality","fileMaxCount","videoId","videoQuality","videoTime","disablePhoto","disableAlbum","disableFile","disableVideo","hidePhoto","hideAlbum","hideFile","maxCount","maxSize","displayMaxCount","allowMaxSize","allowMaxCount","isSelectAction","isPreviewAction","actions","albumDisabled","photoDisabled","fileDisabled","previewAction","navibarDisplay","footerDisplay","isEmpty","setTimeout","top","backFn","pageElem","querySelector","attachPreviewContainer","closeScale","e","openScale","currentDoc","transformSize","pow","toFixed","selectAction","actionName","downloadAttachment","selectFileFromMobile","selectFileFromAlbum","toUpload","onCancel","beyondLimit","some","realStr","indexOf","realStrLen","fSize","parseInt","$dialog","alert","message","removedCount","count","slice","findWorkFlow","previewFileInWorkFlow","playShortVideo","pushOriginGoback","getAttachmentUrl","ishttps","location","protocol","host","attachmentName","attachmentUrl","options","saveName","popOriginGoback","hideWorkFlowNavibar","workFlowNavibar","getComputedStyle","display","workFlowFooter","displayWorkFlowNavibar","isWorkFlow","href","attachId","previewUrl","previewHtml","previewContainerElem","classList","add","backBtn","addEventListener","openDownloadList","_hoisted_4","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","onSelect","listData","finished","showFinishedText","className","listViewHeader","_hoisted_11","max","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","plain","_hoisted_19","_hoisted_20","createTime","listviewEmpty","_hoisted_21","_hoisted_22","AttachmentFile","requestUpload","autoplay","AttachmentEntry","second","run","start","timer","stop","setDisabled","val","VerifyCode","AttachmentUtil","getCurrentData","bindingField","dataItem","dataItemAttachmentId","modifyData","fields","fieldsValue","forEach","field","fieldArr","split","newField","getContextData","context","setContextData","appendToContextData","updateContextData","oldData","appendToContextOldData","removeContextDataById","findIndex","RemoGeoLocation","_remoteSvrUrl","_callbackList","_seqBase","_frameReady","_watchIdMap","_getSeq","_onRrameReady","callback","_frameReadyList","_prepareIframe","_iframeWin","ifrm","position","allow","timeoutId","_callbackFrameReadyList","onload","clearTimeout","body","contentWindow","_handleRemoteMsg","len","_pickCallback","seqNum","keepInList","callbackList","cbkInfo","msg","warn","_postMessage","cmd","args","seq","postMessage","getCurrentPosition","succHandler","errHandler","err","result","watchPosition","watchKey","cmdSeq","stat","watchInfo","clearWatch","clearId","DEFAULT_AMP_CONFIG","v","hostAndPath","plugin","patchIOS11Geo","AMap","UA","ios","android","remoGeo","navigator","geolocation","apply","arguments","AMapAPILoader","config","_config","_document","_window","_scriptLoaded","_queueEvents","load","Map","loadUIAMap","_scriptLoadingPromise","script","async","defer","_getScriptSrc","UIPromise","uiVersion","Promise","resolve","reject","pop","then","onerror","error","AMapUI","UIScript","versionMain","versionSub","versionDetail","undefined","amap_prefix_reg","paramKeys","plugins","prefixName","test","pureName","params","keys","filter","k","isArray","value","join","entry","lazyAMapApiLoaderInstance","initAMapApiLoader","MapPlugin","addPlugins","_notInjectPlugins","_plugin","sName","addMapControls","$plugins","realPluginOptions","convertAMapPluginProps","pluginInstance","pName","addControl","events","event","addListener","offset","toPixel","arr","Pixel","guid","s","hexDigits","substr","upperCamelCase","cased","camelCase","charAt","toUpperCase","trim","m","p1","AMapManager","_componentMap","_map","setMap","getMap","setComponent","set","getComponent","get","getChildInstance","removeComponent","delete","extendFields","showNavBar","path","displayAttachmentInfo","displayAttachmentId","displayAttachmentName","setup","emit","state","reactive","attachmentExtendFields","getData","updateData","removeDataById","setData","appendData","removed","currentData","rawData","nextTick","getDataValue","selectedData","filterData","onMounted","initContext","uploadAttachment","removeAttachment","selectChange","goBack","bindingFields","extendField","ele","oldListData","blur","toAttachmentDetailPage","attachmentInfoFields","editorType","readonly","label","visible","bind","NavBar","Icon","Field","onRemove","onUpload","onBlur","onSelectChange","onAfterAppendFile","BusinessAttachment","Navbar","LookupInput","Picker","Button","processReadFlag","nextNodeReadFlag","assigneeReadFlag","cancelDisabled","confirmDisabled","process","processOc","processData","nextNode","nextNodeOc","nextNodeData","assignee","assigneeOc","assigneeData","submit","cancel","assignInfos","selectedValues","multiSelect","assigneeHolder","nextNodeHolder","processHolder","emits","attrs","slots","_processOc","_nextNodeOc","_assigneeOc","close","$_confirm","_cancel","assigneeInfo","assigneeUsers","instance","backAfterClose","isFirst","useExpose","apis","getCurrentInstance","assign","proxy","usePopupState","toggle","open","mountComponent","RootComponent","createApp","use","Vant","FarrisMobileUi","root","mount","unmount","initInstance","a","closeTheInstance","SubmitApprove","clear","confirm","FMApprove","cmp","AttachmentPreview","FMAttachmentPreview","el","converters","center","LngLat","$amap","$amapComponent","loadPromise","circleMarker","plus","parseFullName","pluginName","parseShortName","oPlugin","nPlugin","onBeforeMount","watch","newValue","oldValue","setCenter","createMap","onUnmounted","destroy","mapElement","elementID","vid","convertProps","amapManager","mapPlugin","eventName","propsObj","reduce","_key","propsValue","convertSignalProp","sourceData","_renderSlot","VAMap","VueAMap","installed","optionMergeStrategies","deferredReady","_component","mapService","zoomEnable","dragEnable","resizeEnable","zoom","markers","limitCity","limitSearch","showSearch","mapKey","displayDireaction","mapMarkers","emptyMarkers","subject","defaultCenter","init","o","addMarkers","zoomchange","click","geocoder","Geocoder","radius","extensions","that","address","getAddress","lnglat","lng","lat","status","info","regeocode","formattedAddress","noGeoLocation","enableHighAccuracy","timeout","maximumAge","convert","showButton","buttonPosition","showMarker","showCircle","panToLocation","zoomToAccuracy","markerEvents","dragend","defaultMarkers","mapCenter","resetMarkers","computedMarkers","computedCenter","getPosition","getCurrentLocation","afterInit","CircleMarker","strokeColor","strokeWeight","strokeOpacity","fillColor","fillOpacity","zIndex","bubble","cursor","onSearchResult","getCenter","$$getCenter","marker","Marker","removeMarkers","remove","onAfterInit","onSetCircleMarker","BusinessMap","globalProperties","$filterAttachment","entityListData","isComponentAdapter","$filterMap","currentEntityData","lngPath","latPath","filterMapData","dataId","required","visiavle","toRefs","getApprovalLogs","containerElem","getElementById","approvalLogUrl","version","System","import","taskLogsPayload","bizInstId","procInstId","isIncludeHistory","ApprovalLogUtil","getBizlogHtml","ApprovalLogs","BusinessVerifyCode","FarrisBusinessPlugin"],"mappings":"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"}
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("vant"),require("@farris/mobile-vue-adapter"),require("@farris/mobile-ui")):"function"==typeof define&&define.amd?define(["exports","vue","vant","@farris/mobile-vue-adapter","@farris/mobile-ui"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).umd_min={},e.vue,e.Vant,e.mobileVueAdapter,e.FarrisMobileUi)}(this,(function(e,t,n,a,i){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r,l=o(n),c=o(i),s=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}));return t},d=t.defineComponent({name:"fm-attachment",components:(r={"van-uploader":n.Uploader,"van-empty":n.Empty,"van-image":n.Image,"van-popup":n.Popup,"van-grid":n.Grid,"van-grid-item":n.GridItem,"van-row":n.Row,"van-col":n.Col},r[n.ImagePreview.Component.name]=n.ImagePreview.Component,r),inject:{attachmentService:{default:null},uploadAttachmentService:{default:null}},props:{fileList:{type:Array,default:function(){return[]}},multiple:{type:Boolean,default:!0},accept:{type:String,default:"application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain"},disabled:{type:Boolean,default:!1},beforeReadFile:{type:Function},uploadFile:{type:Function},previewFile:{type:Function},allowDefaultEntrance:{type:Boolean,default:!0},beforeTakePhoto:{type:Function},uploadInfo:{type:Object,default:null},parentDirName:{type:String,default:""},rootId:{type:String,default:""},pattern:{type:String,default:"ccWork"},ccWork:{type:Object,default:function(){return{photo:{quality:"high",mode:"camera",mark:"",isPhoto:!0},selectFile:{mType:"0",maxNum:6},video:{id:"af700826-7552-4858-a5e0-e64f5e20288b",quality:.8,time:15,isVideo:!0},album:{isAlbum:!0,mType:"0",maxNum:9}}}},cloudPlus:{type:Object,default:function(){return{photo:{quality:60,encodingType:1,targetWidth:602,targetHeight:600,isPhoto:!0},selectFile:{maximum:3,fileType:".jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|.txt",isFile:!0},album:{isAlbum:!0,quality:60,encodingType:1,targetWidth:600,targetHeight:600}}}},externalVideoUrl:{type:String,default:""}},data:function(){return{fromProp:!1,rawFiles:[],showAction:!1,saveAction:!1,selectedFile:null,selectedFilePath:"",description:"",notUploadedFileList:[],previewPages:[],pdfUrl:"",show:!1,showPdf:!1,showDoc:!1,videoUrl:"",selectedAttachmentId:"",subscription:"",imgHeight:0,imhWidth:0,hasFiles:!1,docStyle:{}}},computed:{uploadFiles:function(){var e,t=this,n=this;return this.rawFiles=(e=[]).concat.apply(e,this.fileList.map((function(e){return e}))),this.rawFiles&&this.rawFiles.length?(this.selectedFile&&this.rawFiles.find((function(e){return e.id===t.selectedFile.id}))||(this.selectedFile=this.rawFiles[0],this.$nextTick((function(){n.goTouchStart(t.selectedFile)}))),this.selectedAttachmentId&&(this.selectedFile=this.rawFiles.find((function(e){return e.attachmentId===t.selectedAttachmentId})),this.selectedFile&&this.$nextTick((function(){n.goTouchStart(t.selectedFile),t.$loading.hide()}))),this.selectedFile||(this.selectedFile=this.rawFiles[this.rawFiles.length-1]),this.hasFiles||this.$nextTick((function(){t.calculateImgSize(80),t.hasFiles=!0})),this.rawFiles):(this.hasFiles&&this.$nextTick((function(){t.calculateImgSize(),t.hasFiles=!1})),this.selectedFile=null,[])},previewEnable:function(){return this.showAction&&this.rawFiles&&!!this.rawFiles.length},gridNumber:function(){return"ccWork"===this.pattern?Number(this.ccWork.photo.isPhoto)+Number(this.ccWork.video.isVideo)+Number(this.ccWork.album.isAlbum):"cloudPlus"===this.pattern?Number(this.cloudPlus.photo.isPhoto)+Number(this.cloudPlus.selectFile.isFile)+Number(this.cloudPlus.album.isAlbum):3}},created:function(){},mounted:function(){var e=this;this.attachmentService&&(this.subscription=this.attachmentService.collectFile.subscribe((function(t){"[object Array]"===Object.prototype.toString.call(t)&&0===t.length||(console.log(t),e.rawFiles=[].concat(e.rawFiles,t),e.afterRead(t))})))},unmounted:function(){this.subscription&&this.subscription.unsubscribe(),this.$loading.hide()},methods:{appendFile:function(){var e=this;"ccWork"===this.pattern?this.attachmentService.selectAttachment(this.ccWork.album):"html"===this.pattern?this.$refs.fileUploadRef.chooseFile():"cloudPlus"===this.pattern&&this.attachmentService.getSysInfo().subscribe((function(t){t&&"Android"===t.platform?e.attachmentService.selectFile(e.cloudPlus.selectFile):t&&"iOS"===t.platform&&e.$refs.fileUploadRef.chooseFile()}))},beforeRead:function(e){return!this.beforeReadFile||this.beforeReadFile(e)},afterRead:function(e){var t=this;if(console.log(e),this.$loading.show("附件上传中"),e&&e.length?this.notUploadedFileList=e.map((function(e){return e.id=s(),e})):(e.id=s(),this.notUploadedFileList=[e]),this.notUploadedFileList.length>this.maxNum)this.$notify.warning("最多上传"+this.maxNum+"个附件");else if(this.selectedAttachmentId=this.notUploadedFileList[0].id,this.uploadAttachmentService)"video/mp4"===e.type?(this.videoUrl=e.url.substring(0,e.url.lastIndexOf("/")),this.uploadAttachmentService.upload([e],{parentDirName:this.parentDirName,rootId:this.rootId}).subscribe((function(n){var a={fileName:e.file.name,metadataId:e.id};t.$emit("afterAppendFile",[a])}))):this.uploadAttachmentService.upload(this.notUploadedFileList,{parentDirName:this.parentDirName,rootId:this.rootId}).subscribe((function(e){var n=t.notUploadedFileList.map((function(e){return{fileName:e.file.name,metadataId:e.id}}));t.$emit("afterAppendFile",n)}));else{var n=this.notUploadedFileList.map((function(e){return{fileName:e.file.name,metadataId:e.id}}));this.$emit("afterAppendFile",n)}},deleteFile:function(){this.rawFiles&&this.rawFiles.length&&this.deleteAttachment(this.selectedFile)},goTouchStart:function(e){this.selectedFile=e,(this.selectedFile.name&&this.selectedFile.name.toLowerCase().includes("mp4")||this.selectedFile.name.toLowerCase().includes("webm")||this.selectedFile.name.toLowerCase().includes("ogg"))&&this.externalVideoUrl&&(this.selectedFile.url=this.externalVideoUrl+"?metadataId="+this.selectedFile.attachmentId+"&rootid="+this.rootId+"&token="+this.getToken(this.mergeString(this.selectedFile.attachmentId,this.rootId))),this.selectedAttachmentId=e.attachmentId,this.$emit("beforeSelect",e)},selectFile:function(e){this.selectedFile=e,this.$emit("selectChange",e)},mergeString:function(e,t){var n=e.length<t.length?e.length:t.length,a="",i=0;for(i=0;i<n;i++)a+=e.substring(i,i+1),a+=t.substring(i,i+1);return a+=e.length<t.length?t.substring(i):e.substring(i)},getToken:function(e){var t=[1,2,3];e.length>24&&(e=e.substring(0,24));var n=Math.floor(e.length/3),a=e.substring(0,n),i=e.substring(n,2*n),o=e.substring(2*n,3*n),r=[],l=Math.ceil(3*Math.random());r.push(t[l-1]),t.splice(l-1,1),l=Math.ceil(2*Math.random()),r.push(t[l-1]),t.splice(l-1,1),r.push(t[0]);var c=Math.round((new Date).getTime()/1e3)+"";return c.substring(0,5)+"times"+r[0]+r[1]+r[2]+this.switchStr(a,i,o,r[0])+this.switchStr(a,i,o,r[1])+this.switchStr(a,i,o,r[2])+"times"+c.substring(5)},switchStr:function(e,t,n,a){switch(a){case 1:return e;case 2:return t;case 3:return n}},genPreview:function(){if(this.selectedFile&&this.selectedFile.name){var e=document.getElementsByName("viewport")[0],t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1.0";var n=document.getElementsByTagName("head")[0];e&&n.removeChild(e),n.appendChild(t),this.uploadAttachmentService&&(this.selectedFile.name.search(/\.(png|jpe?g|gif|svg)(\?.*)?$/)>=0||this.selectedFile.name.includes("pdf")?(this.show=!0,this.showPdf=!0,this.showDoc=!1,this.pdfUrl="/platform/runtime/dfs/viewpage/index.html?metadataId="+this.selectedFile.attachmentId+"&rootId="+this.rootId+"&fileType=2"):this.selectedFile.name.includes("mp4")||(this.show=!0,this.showPdf=!0,this.showDoc=!1,this.pdfUrl="/platform/runtime/dfs/viewpage/index.html?metadataId="+this.selectedFile.attachmentId+"&rootId="+this.rootId+"&fileType=2")),this.$emit("preview",this.selectedFile)}},getAttachmentPath:function(e){return this.uploadAttachmentService.getAttachmentPath(e,this.rootId)},getAttachmentPathByType:function(e){return e.name.search(/\.(png|jpe?g|gif|svg)(\?.*)?$/)>=0?this.getAttachmentPath(e.attachmentId):e.content||e.url},getFitToWidth:function(e,t){var n=this.ptToPx(e),a=this.ptToPx(t),i=n||window.innerWidth;return a>n&&Math.round(i/window.innerWidth)<=1?200-Math.round(100*i/window.innerWidth):Math.round(100*window.innerWidth/i)},ptToPx:function(e){return 96*e/72},isMobile:function(e){return e<=425},isTablet:function(e){return e<=1024},isDesktop:function(e){return!this.isMobile(e)&&!this.isTablet(e)},deleteAttachment:function(e){this.selectedFile=null,this.$emit("remove",[e.attachmentId])},takePhoto:function(){"ccWork"===this.pattern?this.attachmentService.takePhoto(this.ccWork.photo):"cloudPlus"!==this.pattern&&"html"!==this.pattern||this.attachmentService.takePhoto(this.cloudPlus.photo)},selectFromAlbum:function(){"ccWork"===this.pattern?this.attachmentService.selectAttachment(this.ccWork.album):"cloudPlus"!==this.pattern&&"html"!==this.pattern||this.attachmentService.selectAttachment(this.cloudPlus.album)},takeShortVideo:function(){"ccWork"===this.pattern&&this.attachmentService.takeShortVideo(this.ccWork.video)},getVideoFile:function(e){return{fileName:e.name,metadataId:e.url}},calculateImgSize:function(e){void 0===e&&(e=0);var t=this.$refs.attach.getBoundingClientRect(),n=this.$refs.navigation.getBoundingClientRect(),a=t.height-n.height-e;if(this.$refs.imgContainer){var i=this.$refs.imgContainer.getBoundingClientRect().height;i>a&&(this.imgHeight=i)}else this.imgHeight=a},closed:function(){var e=document.getElementsByName("viewport")[0],t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";var n=document.getElementsByTagName("head")[0];e&&n.removeChild(e),n.appendChild(t),this.show=!1}}}),m=t.withScopeId("data-v-443ecfba");t.pushScopeId("data-v-443ecfba");var p={class:"farris-attachment attachment",ref:"attach"},u={class:"farris-attachment-img"},h={key:1,class:"img-container",ref:"imgContainer"},f={key:2},v={class:"attachment-navigation",ref:"navigation"},g=t.createVNode("span",{class:"fm-icon fm-icon-close"},null,-1);t.popScopeId();var w=m((function(e,n,a,i,o,r){var l=t.resolveComponent("van-uploader"),c=t.resolveComponent("van-empty"),s=t.resolveComponent("van-image"),d=t.resolveComponent("van-icon"),w=t.resolveComponent("fm-navbar"),b=t.resolveComponent("van-popup"),y=t.resolveComponent("van-grid-item"),x=t.resolveComponent("van-grid"),k=t.resolveComponent("van-col"),C=t.resolveComponent("van-row");return t.openBlock(),t.createBlock("div",p,[t.withDirectives(t.createVNode(l,{multiple:e.multiple,ref:"fileUploadRef","max-count":e.maxNum,modelValue:e.rawFiles,"onUpdate:modelValue":n[1]||(n[1]=function(t){return e.rawFiles=t}),disabled:e.disabled,"preview-full-image":e.previewEnable,accept:e.accept,"before-read":e.beforeRead,"after-read":e.afterRead},null,8,["multiple","max-count","modelValue","disabled","preview-full-image","accept","before-read","after-read"]),[[t.vShow,!1]]),t.createVNode("div",u,[e.selectedFile&&(e.selectedFile.url||e.selectedFile.file)?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock(c,{key:0,description:"附件为空"})),e.selectedFile&&e.selectedFile.url?(t.openBlock(),t.createBlock("div",h,[e.selectedFile.name.toLowerCase().search(/\.(png|jpe?g|gif|svg|ppt|pptx|xls|xlsx|doc|docx|txt|pdf)(\?.*)?$/)>=0?(t.openBlock(),t.createBlock(s,{key:0,height:e.imgHeight,fit:"scale-down",src:e.getAttachmentPathByType(e.selectedFile),onClick:e.genPreview},null,8,["height","src","onClick"])):t.createCommentVNode("v-if",!0),e.selectedFile&&e.selectedFile.name&&e.selectedFile.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock("video",{key:1,controls:"controls",height:e.imgHeight,controlslist:"nodownload"},[t.createVNode("source",{src:e.selectedFile.url,type:"video/mp4"},null,8,["src"])],8,["height"])):t.createCommentVNode("v-if",!0),e.selectedFile&&e.selectedFile.name&&e.selectedFile.name.toLowerCase().includes("mp4")||e.selectedFile.name.toLowerCase().includes("webm")||e.selectedFile.name.toLowerCase().includes("ogg")?(t.openBlock(),t.createBlock("video",{key:2,src:e.selectedFile.url,controls:"controls",height:e.imgHeight,controlslist:"nodownload"}," 您的浏览器不支持 video 标签。 ",8,["src","height"])):t.createCommentVNode("v-if",!0),t.createVNode(b,{show:e.show,"onUpdate:show":n[2]||(n[2]=function(t){return e.show=t}),closeable:"",onClosed:e.closed,style:{height:"100%",width:"100%"}},{default:m((function(){return[t.createVNode(w,{title:e.selectedFile&&e.selectedFile.name,onClickLeft:e.closed},{left:m((function(){return[t.createVNode(d,{name:"arrow-left",size:"18",color:"#333"})]})),_:1},8,["title","onClickLeft"]),e.showPdf?(t.openBlock(),t.createBlock("iframe",{key:0,class:"pdf-iframe",scrolling:"yes",src:e.pdfUrl,width:"100%",height:"100%"},"\r\n          ",8,["src"])):t.createCommentVNode("v-if",!0),e.showDoc?(t.openBlock(),t.createBlock("div",{key:1,class:"panzoom",style:e.docStyle},[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.previewPages,(function(e,n){return t.openBlock(),t.createBlock("div",{class:"page",style:{width:"unset",height:"unset"},key:n},[e.data?(t.openBlock(),t.createBlock("div",{key:0,innerHTML:e.data},null,8,["innerHTML"])):t.createCommentVNode("v-if",!0)])})),128))],4)):t.createCommentVNode("v-if",!0)]})),_:1},8,["show","onClosed"])],512)):t.createCommentVNode("v-if",!0),e.selectedFile&&e.selectedFile.file?(t.openBlock(),t.createBlock("div",f)):t.createCommentVNode("v-if",!0),t.createCommentVNode(" </van-col> ")]),t.createVNode("div",v,[t.createVNode(x,{clickable:"","column-num":e.gridNumber},{default:m((function(){return[t.createCommentVNode(" 拍照  只有云+ 云上协同支持"),"ccWork"===e.pattern&&e.ccWork.photo&&e.ccWork.photo.isPhoto||"cloudPlus"===e.pattern&&e.cloudPlus.photo&&e.cloudPlus.photo.isPhoto||"html"===e.pattern?(t.openBlock(),t.createBlock(y,{key:0,text:"拍摄",icon:"photograph",onClick:e.takePhoto},null,8,["onClick"])):t.createCommentVNode("v-if",!0),t.createCommentVNode(" 相册 均支持 "),"ccWork"===e.pattern&&e.ccWork.album&&e.ccWork.album.isAlbum||"cloudPlus"===e.pattern&&e.cloudPlus.album&&e.cloudPlus.album.isAlbum||"html"===e.pattern?(t.openBlock(),t.createBlock(y,{key:1,text:"相册",icon:"photo",onClick:e.selectFromAlbum},null,8,["onClick"])):t.createCommentVNode("v-if",!0),t.createCommentVNode(" 目前只有云上协同支持 "),"ccWork"===e.pattern&&e.ccWork.video&&e.ccWork.video.isVideo?(t.openBlock(),t.createBlock(y,{key:2,text:"短视频",icon:"video",onClick:e.takeShortVideo},null,8,["onClick"])):t.createCommentVNode("v-if",!0),t.createCommentVNode(" 选择文件 目前只有原生模式和云+支持 "),"cloudPlus"===e.pattern&&e.cloudPlus.selectFile.isFile||"html"===e.pattern?(t.openBlock(),t.createBlock(y,{key:3,text:"文件",icon:"card",onClick:e.appendFile},null,8,["onClick"])):t.createCommentVNode("v-if",!0)]})),_:1},8,["column-num"]),t.createVNode(C,{type:"flex",justify:"center"},{default:m((function(){return[t.createVNode(k,{class:"attachment-navigation-1 last-navigation",span:"24"},{default:m((function(){return[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.uploadFiles,(function(n,a){return t.openBlock(),t.createBlock("div",{class:{"attachment-navigation-item":!0,"selected-file":!!e.selectedFile&&(n.id===e.selectedFile.id&&e.selectedAttachmentId===e.selectedFile.attachmentId)},key:a,onTouchstart:function(t){return e.goTouchStart(n)},onClick:t.withModifiers((function(t){return e.selectFile(n)}),["stop"])},[n&&n.name&&!n.name.includes("mp4")||!n.name?(t.openBlock(),t.createBlock(s,{key:0,src:e.getAttachmentPathByType(n),class:"item-img",width:"80",height:"80"},null,8,["src"])):t.createCommentVNode("v-if",!0),n&&n.name&&n.name.toLowerCase().includes("mp4")||n.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock(s,{key:1,src:"/platform/runtime/dfs/images/file.png",class:"item-img",width:"80",height:"80"})):t.createCommentVNode("v-if",!0),e.selectedFile&&(n.id===e.selectedFile.id&&e.selectedAttachmentId===e.selectedFile.attachmentId)?(t.openBlock(),t.createBlock("div",{key:2,class:"item-icon-delete",onClick:function(t){return e.deleteAttachment(n)}},[g],8,["onClick"])):t.createCommentVNode("v-if",!0)],42,["onTouchstart","onClick"])})),128))]})),_:1})]})),_:1})],512)],512)}));function b(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}b('.attachment[data-v-443ecfba] {\n  display: flex;\n  flex-direction: column;\n  height: 100%; }\n  .attachment[data-v-443ecfba] .farris-attachment-img {\n    display: flex;\n    flex: 1;\n    justify-content: center;\n    align-items: center; }\n  .attachment[data-v-443ecfba] .img-container {\n    text-align: center;\n    width: 100%;\n    height: 100%; }\n  .attachment[data-v-443ecfba] video {\n    width: 100%; }\n\n.panzoom[data-v-443ecfba] {\n  transform: none;\n  backface-visibility: hidden;\n  transform-origin: 50% 50% 0px;\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap; }\n\n.page[data-v-443ecfba] {\n  display: inline-block;\n  background-color: #ffffff;\n  margin: 20px;\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  transition: all 0.3s; }\n\n.preview-mask[data-v-443ecfba] {\n  width: 100%;\n  height: 100%; }\n\n.farris-attachment[data-v-443ecfba] {\n  clear: both; }\n  .farris-attachment[data-v-443ecfba] .attachment-detail {\n    background: #fff;\n    height: 100%;\n    width: 100%; }\n  .farris-attachment[data-v-443ecfba] .selected-file {\n    box-shadow: inset 0px 0px 3px 3px #59a1ff;\n    border-radius: 5px; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation {\n    overflow: inherit;\n    white-space: nowrap; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation-1 {\n    overflow: auto; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item {\n    position: relative;\n    display: inline-block; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-img {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item img {\n      border-radius: 5px; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-pdf {\n      width: 100%;\n      height: 100%;\n      background-image: url("data:image/png;base64,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");\n      background-size: contain; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-icon-delete {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      right: -6px;\n      top: -6px;\n      width: 16px;\n      height: 16px;\n      background: #888;\n      border-radius: 50%; }\n      .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-icon-delete .fm-icon {\n        color: #fff;\n        font-size: 12px; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-icon {\n      position: absolute; }\n  .farris-attachment[data-v-443ecfba] .first-navigation {\n    max-width: 80%; }\n  .farris-attachment[data-v-443ecfba] .first-navigation .attachment-navigation-item {\n    width: 55px;\n    height: 55px; }\n  .farris-attachment[data-v-443ecfba] .last-navigation .attachment-navigation-item {\n    margin: 6px;\n    width: 80px;\n    height: 80px; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation-icon {\n    text-align: center; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation-icon .add-icon {\n      margin: 8px 0;\n      width: 55px;\n      height: 55px; }\n  .farris-attachment[data-v-443ecfba] .van-grid-item .van-image img {\n    width: auto;\n    height: 300px; }\n  .farris-attachment[data-v-443ecfba] .fixed-bottom {\n    position: absolute;\n    bottom: 0;\n    width: 100%; }\n  .farris-attachment[data-v-443ecfba] .small-imgs-child {\n    width: 80px;\n    height: 80px;\n    background-size: contain; }\n  .farris-attachment[data-v-443ecfba] .small-imgs-item {\n    position: relative;\n    border-radius: 5px; }\n  .farris-attachment[data-v-443ecfba] .small-imgs-item img {\n    border-radius: 5px; }\n  .farris-attachment[data-v-443ecfba] .action-grid {\n    position: absolute;\n    width: 100%;\n    bottom: 100px; }\n  .farris-attachment[data-v-443ecfba] .preview-img img {\n    width: auto;\n    height: 300px; }\n  .farris-attachment[data-v-443ecfba] .upload-icon {\n    position: absolute;\n    top: 0.5rem;\n    left: 0.5rem; }\n  .farris-attachment[data-v-443ecfba] .upload-progress {\n    position: absolute;\n    bottom: 0;\n    left: 0; }\n  .farris-attachment[data-v-443ecfba] .upload-progress {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 5%; }\n  .farris-attachment[data-v-443ecfba] .van-image-preview .van-swipe-item .van-image {\n    position: absolute; }\n  .farris-attachment[data-v-443ecfba] .van-image-preview .van-swipe-item .van-image {\n    position: absolute; }\n'),d.render=w,d.__scopeId="data-v-443ecfba",d.__file="src/components/attachment/src/attachment.vue",d.install=function(e){e.component(d.name,d)};var y,x=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}));return t},k=t.defineComponent({name:"fm-attachment-file",components:(y={"van-image":n.Image},y[n.ImagePreview.Component.name]=n.ImagePreview.Component,y),inject:{attachmentService:{default:null},uploadAttachmentService:{default:{}}},props:{rootId:{type:String,default:""},parentDirName:{type:String,default:""},accept:{type:String,default:"application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,text/plain,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,image/jpg,image/gif,image/jpeg,image/png,image/bmp"},multiple:{type:Boolean,default:!0},fileList:{type:Array,default:function(){return[]}},maxNum:{type:Number,default:9},disabled:{type:Boolean,default:!1},beforeReadFile:{type:Function},uploadFile:{type:Function},previewFile:{type:Function},beforeTakePhoto:{type:Function},removable:{type:Boolean,default:!1},direction:{type:String,default:"vertical"},title:{type:String,default:"附件"},cloudPlus:{type:Object,default:function(){return{photo:{quality:60,encodingType:1,targetWidth:602,targetHeight:600},album:{quality:60,encodingType:1,targetWidth:600,targetHeight:600},selectFile:{maximum:5,fileType:".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX"}}}},uploadOptions:{type:function(){},default:function(){return{showPhoto:!0,showAlbum:!0,showVideo:!1,showFile:!0,photoQuality:100,albumQuality:100,fileMaxCount:6,videoId:x(),videoQuality:.8,videoTime:30}}},disablePhoto:{type:Boolean,default:!1},disableAlbum:{type:Boolean,default:!1},disableFile:{type:Boolean,default:!1},disableVideo:{type:Boolean,default:!1},hidePhoto:{type:Boolean,default:!1},hideAlbum:{type:Boolean,default:!1},hideFile:{type:Boolean,default:!1},maxCount:{type:Number,default:30},maxSize:{type:Number,default:20},displayMaxCount:{type:Boolean,default:!1},allowMaxSize:{type:Boolean,default:!1},allowMaxCount:{type:Boolean,default:!1}},data:function(){return{fromProp:!1,subscription:"",rawFiles:[],showAction:!1,saveAction:!1,selectedFile:null,selectedFilePath:"",description:"",notUploadedFileList:[],previewPages:[],pdfUrl:"",show:!1,showPdf:!1,showDoc:!1,showVideo:!1,isSelectAction:!1,isPreviewAction:!1,docStyle:{},actions:[{name:"从相册选择",disabled:this.albumDisabled},{name:"相机",disabled:this.photoDisabled},{name:"手机文件",disabled:this.fileDisabled}],previewAction:[{name:"在线预览"},{name:"下载"}],navibarDisplay:"",footerDisplay:""}},computed:{uploadFiles:function(){var e,t=this;return this.rawFiles=(e=[]).concat.apply(e,this.fileList.map((function(e){return e}))),this.rawFiles&&this.rawFiles.length?(this.selectedFile&&this.rawFiles.find((function(e){return e.id===t.selectedFile.id}))||(this.selectedFile=this.rawFiles[0]),this.selectedFile&&this.$loading.hide(),this.selectedFile||(this.selectedFile=this.rawFiles[this.rawFiles.length-1]),this.rawFiles):(this.selectedFile=null,[])},isEmpty:function(){return this.rawFiles&&!this.rawFiles.length},previewEnable:function(){return this.showAction&&this.rawFiles&&!!this.rawFiles.length}},mounted:function(){var e=this;setTimeout((function(){window.top.detailBackBtnClickHandler=function(t){var n=window.top.document.querySelector(".fm-page-record-deatial"),a=n.querySelector("#fm-attach-preview-container");if(!n||!a)return!0;try{return e.closeScale(window.top.document),n.removeChild(a),!1}catch(e){return!0}}}),0),this.attachmentService&&(this.subscription=this.attachmentService.collectFile.subscribe((function(t){"[object Array]"===Object.prototype.toString.call(t)&&0===t.length||(e.rawFiles=[].concat(e.rawFiles,t),e.afterRead(t))})))},unmounted:function(){this.subscription&&this.subscription.unsubscribe()},methods:{openScale:function(e){var t=e.getElementsByName("viewport")[0],n=e.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1.0";var a=e.getElementsByTagName("head")[0];t&&a.removeChild(t),a.appendChild(n)},closeScale:function(e){var t=e.getElementsByName("viewport")[0],n=e.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n";var a=e.getElementsByTagName("head")[0];t&&a.removeChild(t),a.appendChild(n)},transformSize:function(e){return e<Math.pow(1024,2)?(e/1024).toFixed(2)+"KB":e>=Math.pow(1024,2)&&e<Math.pow(1024,3)?(e/Math.pow(1024,2)).toFixed(2)+"MB":e>=Math.pow(1024,3)&&e<Math.pow(1024,4)?(e/Math.pow(1024,3)).toFixed(2)+"GB":void 0},selectAction:function(e){var t=e.name;"在线预览"===t?this.genPreview(this.selectedFile):"下载"===t&&this.downloadAttachment(this.selectedFile)},selectFileFromMobile:function(){var e=this;this.disableFile||(this.attachmentService.getSysInfo().subscribe((function(t){t&&"Android"===t.platform?e.attachmentService.selectFile({maximum:e.uploadOptions&&e.uploadOptions.fileMaxCount||6,fileType:".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX"}):t&&"iOS"===t.platform&&e.$refs.fileUploadRef.chooseFile()})),this.isSelectAction=!1)},selectFileFromAlbum:function(){this.disableAlbum||(this.attachmentService.selectAttachment({quality:this.uploadOptions&&this.uploadOptions.albumQuality||100,encodingType:1,mType:0,maxNum:8,targetWidth:this.uploadOptions.targetWidth||1e3,targetHeight:this.uploadOptions.targetHeight||1e3}),this.isSelectAction=!1)},takePhoto:function(){this.disablePhoto||(this.attachmentService.takePhoto({quality:this.uploadOptions&&this.uploadOptions.photoQuality||100,encodingType:1,targetWidth:this.uploadOptions.targetWidth||1e3,targetHeight:this.uploadOptions.targetHeight||1e3}),this.isSelectAction=!1)},takeShortVideo:function(){this.attachmentService.takeShortVideo({id:this.uploadOptions&&this.uploadOptions.videoId||x(),quality:.8,time:this.uploadOptions&&this.uploadOptions.videoTime||20}),this.isSelectAction=!1},appendFile:function(){this.$refs.fileUploadRef.chooseFile()},toUpload:function(){this.isSelectAction=!0},onCancel:function(){this.isSelectAction=!1},beforeRead:function(e){return!this.beforeReadFile||this.beforeReadFile(e)},afterRead:function(e){var t=this;if((e&&e.length?this.notUploadedFileList=e.map((function(e){return e.id=x(),e})):(e.id=x(),this.notUploadedFileList=[e]),this.allowMaxSize)&&this.notUploadedFileList.some((function(e){var n=e.content.substring(e.content.indexOf(",")+1).length;return parseInt(n-n/8*2)>t.maxSize*Math.pow(1024,2)})))return void this.$dialog.alert({title:"上传失败",message:"上传文件太大，请重新选择！"});if(this.allowMaxCount&&this.notUploadedFileList.length+this.uploadFiles.length>this.maxCount){var n=this.notUploadedFileList.length+this.uploadFiles.length-this.maxCount,a=this.notUploadedFileList.length-n;this.notUploadedFileList=this.notUploadedFileList.slice(0,a)}if(this.$loading.show("附件上传中"),this.uploadAttachmentService)"video/mp4"===e.type?(this.videoUrl=e.url.substring(0,e.url.lastIndexOf("/")),this.uploadAttachmentService.upload([e],{parentDirName:this.parentDirName,rootId:this.rootId}).subscribe((function(n){var a={fileName:e.file.name,metadataId:e.id};t.$emit("afterAppendFile",[a])}))):this.uploadAttachmentService.upload(this.notUploadedFileList,{parentDirName:this.parentDirName,rootId:this.rootId}).subscribe((function(e){var n=t.notUploadedFileList.map((function(e){return{fileName:e.file.name,metadataId:e.id}}));t.$emit("afterAppendFile",n)}));else{var i=this.notUploadedFileList.map((function(e){return{fileName:e.file.name,metadataId:e.id}}));this.$emit("afterAppendFile",i)}},selectFile:function(e){this.genPreview(e),this.selectedFile=e,this.$emit("selectCurrentItem")},deleteAttachment:function(e){this.$emit("remove",[e.attachmentId])},genPreview:function(e){if(e&&e.name){if(this.selectedFile=e,this.findWorkFlow())this.previewFileInWorkFlow(e.attachmentId,this.rootId,e.name);else if(window.top&&window.top!==window.self&&this.openScale(window.top.document),this.openScale(window.document),e.name.toLowerCase().includes("mp4")||e.name.toLowerCase().includes("mov")){this.show=!0,this.showPdf=!1,this.showDoc=!1,this.showVideo=!0;var t=e.content||e.url;this.attachmentService.playShortVideo(t+"/"+e.name)}else this.show=!0,this.showPdf=!0,this.pdfUrl="/platform/runtime/dfs/viewpage/index.html?metadataId="+e.attachmentId+"&rootId="+this.rootId+"&fileType=2";window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.pushOriginGoback&&window.MOBILE_ORIGIN_BACK.pushOriginGoback(this.closed),this.$emit("preview",e)}},getAttachmentUrl:function(e){var t="https:"==document.location.protocol,n=window.location.host;return n=t?"https://"+n:"http://"+n,n+=this.uploadAttachmentService.getAttachmentPath(e,this.rootId)},downloadAttachment:function(e){var t=e.name,n={url:this.getAttachmentUrl(e.attachmentId),saveName:t};this.attachmentService.downloadAttachment(n).subscribe((function(e){}))},closed:function(){window.top&&window.top!==window.self&&this.closeScale(window.top.document),this.closeScale(window.document),this.show=!1,this.showPdf=!1,window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.popOriginGoback&&window.MOBILE_ORIGIN_BACK.popOriginGoback()},hideWorkFlowNavibar:function(){if(this.findWorkFlow()){var e=window.top.document.querySelector("fmapprove-navbar");e&&(this.navibarDisplay=window.top.getComputedStyle(e).display,e.style.display="none");var t=window.top.document.querySelector("div.fm-page-footer");t&&(this.footerDisplay=window.top.getComputedStyle(t).display,t.style.display="none")}},displayWorkFlowNavibar:function(){if(this.findWorkFlow()){var e=window.top.document.querySelector("fmapprove-navbar");e&&(e.style.display=this.navibarDisplay);var t=window.top.document.querySelector("div.fm-page-footer");t&&(t.style.display=this.footerDisplay)}},findWorkFlow:function(){return window.top!==window.self&&window.top.location.href.includes("/platform/runtime/wf/webapp/")},previewFileInWorkFlow:function(e,t,n){var a=this;this.openScale(window.top.document);var i='\n              <div class="fm-file-preview">\n\n              <div class="fm-file-preview-header">\n                <nav class="fm-navbar">\n                    <div id="fm-attach-preview-back-btn" class="fm-navbar-left fm-navbar-left-padding">\n                        <span class="fm-navbar-left-arrow fm-icon fm-icon-arrow-chevron-left"></span>\n                    </div>\n                    <div class="fm-navbar-title">'+(n=n||"附件预览")+'</div>\n                </nav>\n              </div>\n                <div class="fm-file-preview-content">\n                  <div class="preview-content">\n                    <iframe src="'+("/platform/runtime/dfs/viewpage/index.html?metadataId="+e+"&rootId="+t+"&fileType=2")+'"></iframe>\n                  </div>\n                </div>\n              </div>\n            ',o=window.top.document.querySelector(".fm-page-record-deatial"),r=document.createElement("div");r.id="fm-attach-preview-container",r.classList.add("fm-attach-preview-container"),r.innerHTML=i,r.querySelector("div.fm-navbar-left").addEventListener("click",(function(){a.closeScale(window.top.document),o.removeChild(r)})),o.appendChild(r)},openDownloadList:function(e){this.isPreviewAction=!0,this.selectedFile=e}}}),C={class:"p-md attachment-bg"},A={key:0,class:"fm-attachment-container attachment-navigation"},F={class:"fm-attachment-files-list"},B=t.createVNode("span",{class:"fm-icon fm-icon-close"},null,-1),N=t.createVNode("div",{class:"fm-attachment-upload-btn"},[t.createVNode("span",{class:"fm-icon fm-icon-addbutton"})],-1),V={class:"attachment-actionsheet-content"},I=t.createVNode("span",{class:"demo-actionsheet-item-text"},"从相册选择",-1),M=t.createVNode("span",{class:"attachment-actionsheet-item-text"},"相机",-1),S=t.createVNode("span",{class:"attachment-actionsheet-item-text"},"短视频",-1),P=t.createVNode("span",{class:"attachment-actionsheet-item-text"},"手机文件",-1),L={style:{padding:".5rem 0"}},D={key:0},U=t.createTextVNode(") "),T={class:"fm-tmpl-attachment-img"},O={class:"attachment-text"},R={class:"fm-tmpl-attachment-name"},E={class:"attachment-button"},z=t.createTextVNode("预览"),j={class:"fm-tmpl-attachment-footer"},W={class:"fm-tmpl-attachment-footer-text"},_=t.createVNode("span",null,null,-1),H=t.createVNode("div",{class:"fm-attachment-upload-btn"},[t.createVNode("span",{class:"fm-icon fm-icon-addbutton"})],-1);var q;b(".attachment-actionsheet-item-disabled {\n  color: #ccc; }\n\n.attachment-actionsheet-content {\n  flex: 1 auto;\n  overflow-y: auto; }\n  .attachment-actionsheet-content .attachment-actionsheet-item {\n    display: block;\n    width: 100%;\n    padding: 14px 16px;\n    font-size: 16px;\n    text-align: center;\n    background-color: #fff;\n    border: none;\n    cursor: pointer;\n    text-align: center; }\n\n.attachment-bg {\n  background: #fff; }\n\n.listview-content .fm-listview-item {\n  margin: 12px 0; }\n\n.listview-content .fm-tmpl-attachment-img {\n  width: 48px;\n  height: 48px;\n  margin: auto 0; }\n  .listview-content .fm-tmpl-attachment-img .item-img {\n    width: 100%;\n    height: 100%; }\n  .listview-content .fm-tmpl-attachment-img img {\n    border-radius: 3px;\n    width: 48px;\n    height: 48px; }\n\n.listview-content .attachment-text {\n  flex: 1;\n  margin: auto 12px; }\n  .listview-content .attachment-text > div {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 5px; }\n\n.listview-content .fm-tmpl-attachment-name {\n  line-height: 22px;\n  font-family: PingFangSC-Regular;\n  font-size: 16px;\n  color: #333333;\n  letter-spacing: 0.21px;\n  margin-bottom: 2px;\n  word-break: break-all; }\n\n.listview-content .fm-tmpl-attachment-footer {\n  line-height: 18px;\n  font-family: PingFangSC-Regular;\n  font-size: 12px;\n  color: #888888;\n  letter-spacing: 0; }\n\n.listview-content .fm-tmpl-listview-attachment {\n  padding: 0;\n  display: flex;\n  justify-content: space-between; }\n\n.listview-content .attachment-button .attachment-button-custom {\n  padding: 0;\n  width: 50px;\n  height: 20px;\n  font-family: PingFangSC-Regular;\n  font-size: 12px;\n  letter-spacing: 0;\n  border-radius: 10px; }\n\n.listview-content .attachment-icon {\n  margin: auto 0;\n  width: 16px;\n  height: 16px; }\n\n.panzoom {\n  transform: none;\n  backface-visibility: hidden;\n  transform-origin: 50% 50% 0px;\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap; }\n\n.page {\n  display: inline-block;\n  background-color: #ffffff;\n  margin: 20px;\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  transition: all 0.3s; }\n\n.farris-attachment-entry-vertical {\n  flex-direction: column; }\n\n.farris-attachment-entry {\n  display: flex;\n  clear: both; }\n  .farris-attachment-entry .fm-attachment-disabled {\n    cursor: not-allowed;\n    pointer-events: none; }\n  .farris-attachment-entry .attachment-navigation {\n    overflow: inherit;\n    white-space: nowrap; }\n  .farris-attachment-entry .attachment-navigation .attachment-navigation-item {\n    position: relative;\n    display: inline-block; }\n    .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-img {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0; }\n    .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-icon-delete {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 16px;\n      height: 16px;\n      background: #888; }\n      .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-icon-delete .fm-icon {\n        color: #fff;\n        font-size: 12px; }\n    .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-icon {\n      position: absolute; }\n  .farris-attachment-entry .fm-attachment-container {\n    box-sizing: border-box;\n    float: left;\n    position: relative;\n    margin: 0 100px 0 0;\n    padding: 0 52px 0 0;\n    max-width: 100%;\n    height: 54px; }\n    .farris-attachment-entry .fm-attachment-container .fm-attachment-files-list {\n      padding-top: 6px;\n      overflow: auto;\n      max-width: 100%; }\n    .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item {\n      position: relative;\n      width: 48px;\n      height: 48px;\n      margin-right: 20px; }\n      .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item .item-icon-delete {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: absolute;\n        right: -6px;\n        top: -6px;\n        width: 16px;\n        height: 16px;\n        background: #888;\n        border-radius: 50%; }\n        .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item .item-icon-delete .fm-icon {\n          color: #fff;\n          font-size: 12px; }\n      .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item .van-image__img {\n        border-radius: 5px; }\n    .farris-attachment-entry .fm-attachment-container .fm-attachment-upload-btn-container {\n      position: absolute;\n      right: 0;\n      top: 50%;\n      margin-top: -20px;\n      z-index: 8;\n      width: 48px;\n      height: 48px;\n      background: #f6f6f6;\n      border-radius: 3px; }\n      .farris-attachment-entry .fm-attachment-container .fm-attachment-upload-btn-container .fm-attachment-upload-btn .fm-icon {\n        display: block;\n        font-size: 20px;\n        color: #ddd;\n        line-height: 48px;\n        margin: 0 auto; }\n  .farris-attachment-entry .fm-attachment-upload-listview-btn-container {\n    z-index: 8;\n    width: 48px;\n    height: 48px;\n    background: #f6f6f6;\n    border-radius: 3px; }\n    .farris-attachment-entry .fm-attachment-upload-listview-btn-container .fm-attachment-upload-btn .fm-icon {\n      display: block;\n      font-size: 20px;\n      color: #ddd;\n      line-height: 48px;\n      margin: 0 auto; }\n"),k.render=function(e,n,a,i,o,r){var l=t.resolveComponent("van-uploader"),c=t.resolveComponent("van-image"),s=t.resolveComponent("fm-action-sheet"),d=t.resolveComponent("fm-button"),m=t.resolveComponent("fm-icon"),p=t.resolveComponent("fm-listview"),u=t.resolveComponent("van-icon"),h=t.resolveComponent("fm-navbar"),f=t.resolveComponent("van-popup");return t.openBlock(),t.createBlock("div",null,[t.createVNode("div",C,[t.createVNode("div",{class:["farris-attachment-entry",{"farris-attachment-entry-vertical":"vertical"===e.direction}]},[t.withDirectives(t.createVNode(l,{multiple:e.multiple,ref:"fileUploadRef","max-count":e.maxNum,modelValue:e.rawFiles,"onUpdate:modelValue":n[1]||(n[1]=function(t){return e.rawFiles=t}),disabled:e.disabled,"preview-full-image":!0,accept:e.accept,"before-read":e.beforeRead,"after-read":e.afterRead},null,8,["multiple","max-count","modelValue","disabled","accept","before-read","after-read"]),[[t.vShow,!1]]),"horizontal"===e.direction?(t.openBlock(),t.createBlock("div",A,[t.createVNode("div",F,[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.uploadFiles,(function(n,a){return t.openBlock(),t.createBlock("div",{class:"fm-attachment-files-item attachment-navigation-item",key:a,onClick:t.withModifiers((function(t){return e.downloadAttachment(n)}),["stop"])},[n&&n.name&&!n.name.includes("mp4")||!n.name?(t.openBlock(),t.createBlock(c,{key:0,src:n.content||n.url,class:"item-img",width:"100%",height:"100%"},null,8,["src"])):t.createCommentVNode("v-if",!0),n&&n.name&&n.name.toLowerCase().includes("mp4")||n.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock(c,{key:1,src:"/platform/runtime/dfs/images/file.png",class:"item-img",width:"48",height:"48"},null,8,["src"])):t.createCommentVNode("v-if",!0),e.uploadFiles&&e.uploadFiles.length&&!e.removable?(t.openBlock(),t.createBlock("div",{key:2,class:["item-icon-delete",{"fm-attachment-disabled":e.disabled}],onClick:t.withModifiers((function(t){return e.deleteAttachment(n)}),["stop"])},[B],10,["onClick"])):t.createCommentVNode("v-if",!0)],8,["onClick"])})),128))]),e.removable?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock("div",{key:0,class:["fm-attachment-upload-btn-container",{"fm-attachment-disabled":e.disabled}],onClick:n[2]||(n[2]=function(){return e.toUpload&&e.toUpload.apply(e,arguments)})},[N],2))])):t.createCommentVNode("v-if",!0),t.createVNode(s,{show:e.isSelectAction,"onUpdate:show":n[7]||(n[7]=function(t){return e.isSelectAction=t}),actions:e.actions,"cancel-text":"取消","close-on-click-action":""},{default:t.withCtx((function(){return[t.createVNode("div",V,[e.uploadOptions&&e.uploadOptions.showAlbum?(t.openBlock(),t.createBlock("div",{key:0,class:["attachment-actionsheet-item",{"attachment-actionsheet-item-disabled":e.disableAlbum}],onClick:n[3]||(n[3]=function(){return e.selectFileFromAlbum&&e.selectFileFromAlbum.apply(e,arguments)})},[I],2)):t.createCommentVNode("v-if",!0),e.uploadOptions&&e.uploadOptions.showPhoto?(t.openBlock(),t.createBlock("div",{key:1,class:["attachment-actionsheet-item",{"attachment-actionsheet-item-disabled":e.disablePhoto}],onClick:n[4]||(n[4]=function(){return e.takePhoto&&e.takePhoto.apply(e,arguments)})},[M],2)):t.createCommentVNode("v-if",!0),e.uploadOptions&&e.uploadOptions.showVideo?(t.openBlock(),t.createBlock("div",{key:2,class:["attachment-actionsheet-item",{"attachment-actionsheet-item-disabled":e.disablePhoto}],onClick:n[5]||(n[5]=function(){return e.takeShortVideo&&e.takeShortVideo.apply(e,arguments)})},[S],2)):t.createCommentVNode("v-if",!0),e.uploadOptions&&e.uploadOptions.showFile?(t.openBlock(),t.createBlock("div",{key:3,class:["attachment-actionsheet-item",{"attachment-actionsheet-item-disabled":e.disableFile}],onClick:n[6]||(n[6]=function(){return e.selectFileFromMobile&&e.selectFileFromMobile.apply(e,arguments)})},[P],2)):t.createCommentVNode("v-if",!0)])]})),_:1},8,["show","actions"]),t.createVNode(s,{show:e.isPreviewAction,"onUpdate:show":n[8]||(n[8]=function(t){return e.isPreviewAction=t}),actions:e.previewAction,"cancel-text":"取消","close-on-click-action":"",onSelect:e.selectAction},null,8,["show","actions","onSelect"]),"vertical"===e.direction?(t.openBlock(),t.createBlock(p,{key:1,listData:e.uploadFiles,finished:!0,showFinishedText:!1,className:"listview-content"},{listViewHeader:t.withCtx((function(){return[t.createVNode("div",L,[t.createTextVNode(" 附件("+t.toDisplayString(e.uploadFiles.length),1),e.allowMaxCount?(t.openBlock(),t.createBlock("span",D,"/"+t.toDisplayString(Math.max(e.uploadFiles.length,e.maxCount)),1)):t.createCommentVNode("v-if",!0),U])]})),default:t.withCtx((function(n){return[t.createVNode("div",{class:"fm-tmpl-listview-attachment",onClick:t.withModifiers((function(t){return e.openDownloadList(n.item)}),["stop"])},[t.createVNode("div",T,[n.item&&n.item.name&&!n.item.name.includes("mp4")||!n.item.name?(t.openBlock(),t.createBlock(c,{key:0,src:n.item.content||n.item.url,class:"item-img"},null,8,["src"])):t.createCommentVNode("v-if",!0),n.item&&n.item.name&&n.item.name.toLowerCase().includes("mp4")||n.item.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock(c,{key:1,src:"/platform/runtime/dfs/images/file.png",class:"item-img"},null,8,["src"])):t.createCommentVNode("v-if",!0)]),t.createVNode("div",O,[t.createVNode("div",null,[t.createVNode("div",R,[t.createVNode("span",null,t.toDisplayString(n.item.name),1)]),t.createVNode("div",E,[t.createVNode(d,{className:"attachment-button-custom",color:"#3A90FF",plain:"",onClick:t.withModifiers((function(t){return e.genPreview(n.item)}),["stop"])},{default:t.withCtx((function(){return[z]})),_:2},1032,["onClick"])])]),t.createVNode("div",j,[t.createVNode("span",W,t.toDisplayString(e.transformSize(n.item.size)),1),t.createVNode("span",null,t.toDisplayString(n.item.createTime),1)])]),e.removable?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock("div",{key:0,class:"attachment-icon",onClick:t.withModifiers((function(t){return e.deleteAttachment(n.item)}),["stop"])},[t.createVNode(m,{name:"s-clear",color:"#888",size:"16"})],8,["onClick"]))],8,["onClick"])]})),listviewEmpty:t.withCtx((function(){return[_]})),_:1},8,["listData"])):t.createCommentVNode("v-if",!0),e.removable||"vertical"!==e.direction||!(e.allowMaxCount&&e.uploadFiles.length<e.maxCount)&&e.allowMaxCount?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock("div",{key:2,class:["fm-attachment-upload-listview-btn-container",{"fm-attachment-disabled":e.disabled}],onClick:n[9]||(n[9]=function(){return e.toUpload&&e.toUpload.apply(e,arguments)})},[H],2)),t.createVNode(f,{show:e.show,"onUpdate:show":n[10]||(n[10]=function(t){return e.show=t}),style:{height:"100%",width:"100%"}},{default:t.withCtx((function(){return[t.createVNode(h,{title:e.selectedFile&&e.selectedFile.name,onClickLeft:e.closed},{left:t.withCtx((function(){return[t.createVNode(u,{name:"arrow-left",size:"18",color:"#333"})]})),_:1},8,["title","onClickLeft"]),e.showPdf?(t.openBlock(),t.createBlock("iframe",{key:0,class:"pdf-iframe",scrolling:"yes",src:e.pdfUrl,width:"100%",height:"100%"},"\r\n          ",8,["src"])):t.createCommentVNode("v-if",!0)]})),_:1},8,["show"])],2)])])},k.__file="src/components/attachment-file/src/attachment-file.vue",k.install=function(e){e.component(k.name,k)};var G=t.defineComponent({name:"fm-attachment-entry",components:(q={"van-image":n.Image},q[n.ImagePreview.Component.name]=n.ImagePreview.Component,q),inject:{attachmentService:{default:null},uploadAttachmentService:{default:{}}},props:{rootId:{type:String,default:""},fileList:{type:Array,default:function(){return[]}},multiple:{type:Boolean,default:!0},accept:{type:String,default:"image/gif,image/jpg,image/jpeg,image/bmp,image/png"},disabled:{type:Boolean,default:!1},beforeReadFile:{type:Function},uploadFile:{type:Function},previewFile:{type:Function},beforeTakePhoto:{type:Function},removable:{type:Boolean,default:!1},direction:{type:String,default:"horizontal"},title:{type:String,default:"附件"},externalVideoUrl:{type:String,default:""}},data:function(){return{fromProp:!1,rawFiles:[],showAction:!1,saveAction:!1,selectedFile:null,selectedFilePath:"",description:"",notUploadedFileList:[],previewPages:[],pdfUrl:"",show:!1,showPdf:!1,showVideo:!1,docStyle:{}}},computed:{uploadFiles:function(){var e;return this.rawFiles=(e=[]).concat.apply(e,this.fileList.map((function(e){return e}))),this.rawFiles&&this.rawFiles.length?(this.selectedFile=this.rawFiles[0],this.rawFiles):(this.selectedFile=null,[])},isEmpty:function(){return this.rawFiles&&!this.rawFiles.length},previewEnable:function(){return this.showAction&&this.rawFiles&&!!this.rawFiles.length}},mounted:function(){this.allowDefaultEntrance||(this.showAction=!0)},methods:{getAttachmentPath:function(e){return this.uploadAttachmentService.getAttachmentPath(e,this.rootId)},getAttachmentPathByType:function(e){return e.name.search(/\.(png|jpe?g|gif|svg)(\?.*)?$/)>=0?this.getAttachmentPath(e.attachmentId):e.content||e.url},appendFile:function(){this.$refs.fileUploadRef.chooseFile()},toUpload:function(){this.$emit("upload")},beforeRead:function(e){return!this.beforeReadFile||this.beforeReadFile(e)},afterRead:function(e){this.showAction=!0,e&&e.length?(this.selectedFile=e[e.length-1],this.notUploadedFileList=e):(this.selectedFile=e,this.notUploadedFileList=[e]),this.$emit("afterAppendFile",e),this.requestUpload()},deleteFile:function(){this.rawFiles&&this.rawFiles.length&&this.deleteAttachment(this.selectedFile)},mergeString:function(e,t){var n=e.length<t.length?e.length:t.length,a="",i=0;for(i=0;i<n;i++)a+=e.substring(i,i+1),a+=t.substring(i,i+1);return a+=e.length<t.length?t.substring(i):e.substring(i)},getToken:function(e){var t=[1,2,3];e.length>24&&(e=e.substring(0,24));var n=Math.floor(e.length/3),a=e.substring(0,n),i=e.substring(n,2*n),o=e.substring(2*n,3*n),r=[],l=Math.ceil(3*Math.random());r.push(t[l-1]),t.splice(l-1,1),l=Math.ceil(2*Math.random()),r.push(t[l-1]),t.splice(l-1,1),r.push(t[0]);var c=Math.round((new Date).getTime()/1e3)+"";return c.substring(0,5)+"times"+r[0]+r[1]+r[2]+this.switchStr(a,i,o,r[0])+this.switchStr(a,i,o,r[1])+this.switchStr(a,i,o,r[2])+"times"+c.substring(5)},switchStr:function(e,t,n,a){switch(a){case 1:return e;case 2:return t;case 3:return n}},selectFile:function(e){this.genPreview(e),this.selectedFile=e,this.$emit("selectCurrentItem")},deleteAttachment:function(e){this.$emit("remove",[e.attachmentId])},genPreview:function(e){if(e&&e.name){var t=document.getElementsByName("viewport")[0],n=document.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1.0";var a=document.getElementsByTagName("head")[0];t&&a.removeChild(t),a.appendChild(n),e.name.toLowerCase().includes("mp4")||e.name.toLowerCase().includes("mov")?(this.externalVideoUrl&&(e.url=this.externalVideoUrl+"?metadataId="+e.attachmentId+"&rootid="+this.rootId+"&token="+this.getToken(this.mergeString(e.attachmentId,this.rootId))),this.show=!0,this.showPdf=!1,this.showVideo=!0):(this.show=!0,this.showPdf=!0,this.pdfUrl="/platform/runtime/dfs/viewpage/index.html?metadataId="+e.attachmentId+"&rootId="+this.rootId+"&fileType=2"),this.$emit("preview",e)}},getFitToWidth:function(e,t){var n=this.ptToPx(e),a=this.ptToPx(t),i=n||window.innerWidth;return a>n&&Math.round(i/window.innerWidth)<=1?200-Math.round(100*i/window.innerWidth):Math.round(100*window.innerWidth/i)},ptToPx:function(e){return 96*e/72},isMobile:function(e){return e<=425},isTablet:function(e){return e<=1024},isDesktop:function(e){return!this.isMobile(e)&&!this.isTablet(e)},closed:function(){var e=document.getElementsByName("viewport")[0],t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";var n=document.getElementsByTagName("head")[0];e&&n.removeChild(e),n.appendChild(t),this.show=!1}}}),K=t.withScopeId("data-v-0d94d79a");t.pushScopeId("data-v-0d94d79a");var X={key:0,class:"fm-attachment-container attachment-navigation"},Z={class:"fm-attachment-files-list"},J=t.createVNode("span",{class:"fm-icon fm-icon-close"},null,-1),Y=t.createVNode("div",{class:"fm-attachment-upload-btn"},[t.createVNode("span",{class:"fm-icon fm-icon-addbutton"})],-1),Q={class:"fm-tmpl-listview-goods"},$={class:"fm-tmpl-goods-name"},ee=t.createVNode("div",{class:"fm-attachment-upload-btn"},[t.createVNode("span",{class:"fm-icon fm-icon-addbutton"})],-1),te={key:1,autoplay:"",controls:"controls",style:{width:"100%",height:"100%"}};t.popScopeId();var ne=K((function(e,n,a,i,o,r){var l=t.resolveComponent("van-image"),c=t.resolveComponent("fm-listview"),s=t.resolveComponent("van-icon"),d=t.resolveComponent("fm-navbar"),m=t.resolveComponent("van-popup");return t.openBlock(),t.createBlock("div",{class:["farris-attachment-entry",{"farris-attachment-entry-vertical":"vertical"===e.direction}]},["horizontal"===e.direction?(t.openBlock(),t.createBlock("div",X,[t.createVNode("div",Z,[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.uploadFiles,(function(n,a){return t.openBlock(),t.createBlock("div",{class:"fm-attachment-files-item attachment-navigation-item",key:a,onClick:function(t){return e.selectFile(n)}},[n&&n.name&&!n.name.includes("mp4")||!n.name?(t.openBlock(),t.createBlock(l,{key:0,src:e.getAttachmentPathByType(n),class:"item-img",width:"100%",height:"100%"},null,8,["src"])):t.createCommentVNode("v-if",!0),n&&n.name&&n.name.toLowerCase().includes("mp4")||n.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock(l,{key:1,src:"/platform/runtime/dfs/images/file.png",class:"item-img",width:"48",height:"48"},null,8,["src"])):t.createCommentVNode("v-if",!0),e.uploadFiles&&e.uploadFiles.length&&!e.removable?(t.openBlock(),t.createBlock("div",{key:2,class:["item-icon-delete",{"fm-attachment-disabled":e.disabled}],onClick:t.withModifiers((function(t){return e.deleteAttachment(n)}),["stop"])},[J],10,["onClick"])):t.createCommentVNode("v-if",!0)],8,["onClick"])})),128))]),e.removable?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock("div",{key:0,class:["fm-attachment-upload-btn-container",{"fm-attachment-disabled":e.disabled}],onClick:n[1]||(n[1]=function(){return e.toUpload&&e.toUpload.apply(e,arguments)})},[Y],2))])):t.createCommentVNode("v-if",!0),"vertical"===e.direction?(t.openBlock(),t.createBlock(c,{key:1,listData:e.uploadFiles,finished:!0,showFinishedText:!1},{listViewHeader:K((function(){return[]})),default:K((function(n){return[t.createVNode("div",Q,[t.createVNode("div",{class:"fm-tmpl-goods-img",onClick:function(t){return e.selectFile(n.item)}},[n.item&&n.item.name&&!n.item.name.includes("mp4")||!n.item.name?(t.openBlock(),t.createBlock(l,{key:0,src:n.item.content||n.item.url,class:"item-img"},null,8,["src"])):t.createCommentVNode("v-if",!0),n.item&&n.item.name&&n.item.name.toLowerCase().includes("mp4")||n.item.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock(l,{key:1,src:"/platform/runtime/dfs/images/file.png",class:"item-img"},null,8,["src"])):t.createCommentVNode("v-if",!0)],8,["onClick"]),t.createVNode("div",null,[t.createVNode("div",$,[t.createVNode("span",null,t.toDisplayString(n.item.name),1),t.createCommentVNode(' <div class="fm-tmpl-goods-add">\r\n\t\t\t\t\t\t\t\t可以添加下载\r\n\t\t\t\t\t\t\t\t<span class="fm-icon fm-icon-print"></span>\r\n\t\t\t\t\t\t\t</div> ')]),t.createCommentVNode(' <div class="fm-tmpl-goods-price">\r\n\t\t\t\t\t\t\t<span class="fm-tmpl-goods-price-text">已上传</span>\r\n\t\t\t\t\t\t</div> ')])])]})),_:1},8,["listData"])):t.createCommentVNode("v-if",!0),e.removable||"vertical"!==e.direction?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createBlock("div",{key:2,class:["fm-attachment-upload-listview-btn-container",{"fm-attachment-disabled":e.disabled}],onClick:n[2]||(n[2]=function(){return e.toUpload&&e.toUpload.apply(e,arguments)})},[ee],2)),t.createVNode(m,{show:e.show,"onUpdate:show":n[3]||(n[3]=function(t){return e.show=t}),closeable:"",onClosed:e.closed,style:{height:"100%",width:"100%"}},{default:K((function(){return[t.createVNode(d,{title:e.selectedFile&&e.selectedFile.name,onClickLeft:e.closed},{left:K((function(){return[t.createVNode(s,{name:"arrow-left",size:"18",color:"#333"})]})),_:1},8,["title","onClickLeft"]),e.showPdf?(t.openBlock(),t.createBlock("iframe",{key:0,class:"pdf-iframe",scrolling:"yes",src:e.pdfUrl,width:"100%",height:"100%"},"\r\n      ",8,["src"])):t.createCommentVNode("v-if",!0),e.showVideo&&e.selectedFile&&e.selectedFile.name&&e.selectedFile.name.toLowerCase().includes("mov")?(t.openBlock(),t.createBlock("video",te,[t.createVNode("source",{src:e.selectedFile.url,type:"video/mp4"},null,8,["src"])])):t.createCommentVNode("v-if",!0),e.showVideo&&e.selectedFile&&e.selectedFile.name&&e.selectedFile.name.toLowerCase().includes("mp4")||e.selectedFile.name.toLowerCase().includes("webm")||e.selectedFile.name.toLowerCase().includes("ogg")?(t.openBlock(),t.createBlock("video",{key:2,autoplay:"",src:e.selectedFile.url,controls:"controls",style:{width:"100%",height:"100%"}}," 您的浏览器不支持 video 标签。 ",8,["src"])):t.createCommentVNode("v-if",!0)]})),_:1},8,["show","onClosed"])],2)}));b('.fm-tmpl-listview-goods[data-v-0d94d79a] {\n  margin-bottom: 0.5rem;\n  padding: 0; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] img {\n    height: 48px;\n    width: 48px;\n    border-radius: 5px; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-price .fm-tmpl-goods-price-text {\n    font-size: 12px;\n    color: #666; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-name {\n    line-height: 1;\n    margin: 0;\n    min-height: 0;\n    font-size: 14px;\n    color: #000;\n    padding: 0;\n    overflow-wrap: break-word; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-img {\n    width: 48px;\n    height: 48px; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-content {\n    padding: 0; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-content::after {\n    content: ""; }\n\n.panzoom[data-v-0d94d79a] {\n  transform: none;\n  backface-visibility: hidden;\n  transform-origin: 50% 50% 0px;\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap; }\n\n.page[data-v-0d94d79a] {\n  display: inline-block;\n  background-color: #ffffff;\n  margin: 20px;\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  transition: all 0.3s; }\n\n.farris-attachment-entry-vertical[data-v-0d94d79a] {\n  flex-direction: column; }\n\n.farris-attachment-entry[data-v-0d94d79a] {\n  display: flex;\n  clear: both; }\n  .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-disabled {\n    cursor: not-allowed;\n    pointer-events: none; }\n  .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation {\n    overflow: inherit;\n    white-space: nowrap; }\n  .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item {\n    position: relative;\n    display: inline-block; }\n    .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-img {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0; }\n    .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-icon-delete {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 16px;\n      height: 16px;\n      background: #888; }\n      .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-icon-delete .fm-icon {\n        color: #fff;\n        font-size: 12px; }\n    .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-icon {\n      position: absolute; }\n  .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container {\n    box-sizing: border-box;\n    float: left;\n    position: relative;\n    margin: 0 100px 0 0;\n    padding: 0 52px 0 0;\n    max-width: 100%;\n    height: 54px; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-list {\n      padding-top: 6px;\n      overflow: auto;\n      max-width: 100%; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item {\n      position: relative;\n      width: 48px;\n      height: 48px;\n      margin-right: 20px; }\n      .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item .item-icon-delete {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: absolute;\n        right: -6px;\n        top: -6px;\n        width: 16px;\n        height: 16px;\n        background: #888;\n        border-radius: 50%; }\n        .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item .item-icon-delete .fm-icon {\n          color: #fff;\n          font-size: 12px; }\n      .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item .van-image__img {\n        border-radius: 5px; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-upload-btn-container {\n      position: absolute;\n      right: 0;\n      top: 50%;\n      margin-top: -20px;\n      z-index: 8;\n      width: 48px;\n      height: 48px;\n      background: #f6f6f6;\n      border-radius: 3px; }\n      .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-upload-btn-container .fm-attachment-upload-btn .fm-icon {\n        display: block;\n        font-size: 20px;\n        color: #ddd;\n        line-height: 48px;\n        margin: 0 auto; }\n  .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-upload-listview-btn-container {\n    z-index: 8;\n    width: 48px;\n    height: 48px;\n    background: #f6f6f6;\n    border-radius: 3px; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-upload-listview-btn-container .fm-attachment-upload-btn .fm-icon {\n      display: block;\n      font-size: 20px;\n      color: #ddd;\n      line-height: 48px;\n      margin: 0 auto; }\n'),G.render=ne,G.__scopeId="data-v-0d94d79a",G.__file="src/components/attachment-entry/src/attachment-entry.vue",G.install=function(e){e.component(G.name,G)};var ae=t.defineComponent({name:"fm-verify-code",props:{second:{type:Number,default:60}},data:function(){return{time:0,disabled:!1}},methods:{run:function(){this.disabled||this.time>0||(this.$emit("run"),this.start())},start:function(){this.time=this.second,this.timer()},stop:function(){this.time=0,this.disabled=!1},setDisabled:function(e){this.disabled=e},timer:function(){this.time>0?(this.time--,setTimeout(this.timer,1e3)):this.disabled=!1}},computed:{text:function(){return this.time>0?this.time+"s":"获取验证码"}}}),ie=t.withScopeId("data-v-607c2323");t.pushScopeId("data-v-607c2323");var oe={class:"text"};t.popScopeId();var re=ie((function(e,n,a,i,o,r){return t.openBlock(),t.createBlock("div",{class:["fm-verify-code",{"fm-verify-code-disabled":e.disabled||e.time>0}],onClick:n[1]||(n[1]=function(t){return e.run()})},[t.createVNode("span",oe,t.toDisplayString(e.text),1)],2)}));b(".fm-verify-code[data-v-607c2323] .text {\n  font-size: 15px;\n  color: #31A4FB; }\n\n.fm-verify-code[data-v-607c2323]-disabled .text {\n  color: #999; }\n"),ae.render=re,ae.__scopeId="data-v-607c2323",ae.__file="src/business/verify-code/src/index.vue",ae.install=function(e){e.component(ae.name,ae)};var le=function(){function e(){}return e.getCurrentData=function(e,t,n){return t.find((function(t){return t[n].attachmentId===e}))},e.modifyData=function(e,t,n){t.forEach((function(t){var a=t.split("_");if(a.length>1){var i=a[1].substring(0,1).toLowerCase()+a[1].substring(1);e[a[0]][i]=n[t]}else e[t]=n[t]}))},e.getContextData=function(e){return e.data},e.setContextData=function(e,t){e.data=t},e.appendToContextData=function(e,t){e.data=[].concat(e.data,t)},e.updateContextData=function(e,t){e.oldData=t},e.appendToContextOldData=function(e,t){e.oldData=[].concat(e.oldData,t)},e.removeContextDataById=function(e,t){var n=e.data.findIndex((function(e){return e.id===t}));e.data.splice(n,1)},e}();function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var se=function(){function e(){this._remoteSvrUrl="https://webapi.amap.com/html/geolocate.html",this._callbackList=[],this._seqBase=1,this._frameReady=0,this._watchIdMap={}}var t=e.prototype;return t._getSeq=function(){return this._seqBase++},t._onRrameReady=function(e){if(0===this._frameReady)return this._frameReadyList||(this._frameReadyList=[]),this._frameReadyList.push(e),void this._prepareIframe();e.call(this)},t._prepareIframe=function(){var e=this;if(!this._iframeWin){var t=document.createElement("iframe");t.src=this._remoteSvrUrl+(this._remoteSvrUrl.indexOf("?")>0?"&":"?"),t.width="0px",t.height="0px",t.style.position="absolute",t.style.display="none",t.allow="geolocation";var n=setTimeout((function(){e._frameReady=!1,e._callbackFrameReadyList()}),5e3);t.onload=function(){clearTimeout(n),e._frameReady=!0,e._callbackFrameReadyList(),t.onload=null},document.body.appendChild(t),this._iframeWin=t.contentWindow,window.addEventListener("message",(function(t){0===e._remoteSvrUrl.indexOf(t.origin)&&e._handleRemoteMsg(t.data)}),!1)}},t._callbackFrameReadyList=function(){if(this._frameReadyList){var e=this._frameReadyList;this._frameReadyList=null;for(var t=0,n=e.length;t<n;t++)e[t].call(this,this._frameReady)}},t._pickCallback=function(e,t){for(var n=this._callbackList,a=0,i=n.length;a<i;a++){var o=n[a];if(e===o.seq)return t||n.splice(a,1),o}},t._handleRemoteMsg=function(e){var t=e.seq,n=this._pickCallback(t,!!e.notify);n?n.cbk.call(null,e.error,e.result):console.warn("Receive remote msg: ",e)},t._postMessage=function(e,t,n,a){var i=this;this._prepareIframe();var o={cmd:e,args:t,seq:a||this._getSeq()};this._callbackList.push({cbk:n,seq:o.seq}),this._onRrameReady((function(){if(!0===i._frameReady)try{i._iframeWin.postMessage(o,"*")}catch(e){i._pickCallback(o.seq),n(e)}else i._pickCallback(o.seq),n({message:"iFrame load failed!"})}))},t.getCurrentPosition=function(e,t,n){this._postMessage("getCurrentPosition",[n],(function(n,a){n?t&&t(n):e&&e(a)}))},t.watchPosition=function(e,t,n){var a=this,i="wk"+this._getSeq(),o=this._getSeq();this._watchIdMap[i]={stat:0,seq:o};var r=this;return this._postMessage("watchPosition",[n],(function(n,o){var l=null;o&&(l=o.id);var c=a._watchIdMap[i];if(c.id=l,c.stat=1,c.callbackList){var s=c.callbackList;c.callbackList=null;for(var d=0,m=s.length;d<m;d++)s[d].call(r,l)}n?t&&t(n):e&&e(o.pos)}),o),i},t.clearWatch=function(e,t){if(this._watchIdMap[e]){var n=this._watchIdMap[e],a=this,i=function(i){a._postMessage("clearWatch",[i],(function(i,o){i||(a._pickCallback(n.seq),delete a._watchIdMap[e]),t&&t(i,o)}))};n.stat<1?(n.callbackList||(n.callbackList=[]),n.callbackList.push((function(e){i(e)}))):i(n.id)}else t("Id not exists: "+e)},e}(),de={key:null,v:"1.4.4",protocol:"https",hostAndPath:"webapi.amap.com/maps",plugin:[],callback:"amapInitComponent"};function me(){if((window.AMap.UA.ios||window.AMap.UA.android)&&"https:"!==document.location.protocol){var e=new se;navigator.geolocation.getCurrentPosition=function(){return e.getCurrentPosition.apply(e,arguments)},navigator.geolocation.watchPosition=function(){return e.watchPosition.apply(e,arguments)}}}var pe=function(){function e(e){this._config=ce({},de,e),this._document=document,this._window=window,this._scriptLoaded=!1,this._queueEvents=[me]}var t=e.prototype;return t.load=function(){var e=this;if(this._window.AMap&&this._window.AMap.Map)return this.loadUIAMap();if(this._scriptLoadingPromise)return this._scriptLoadingPromise;var t=this._document.createElement("script");t.type="text/javascript",t.async=!0,t.defer=!0,t.src=this._getScriptSrc();var n=this._config.uiVersion?this.loadUIAMap():null;return this._scriptLoadingPromise=new Promise((function(a,i){e._window.amapInitComponent=function(){for(;e._queueEvents.length;)e._queueEvents.pop().apply();if(!n)return a();n.then((function(){window.initAMapUI(),setTimeout(a)}))},t.onerror=function(e){return i(e)}})),this._document.head.appendChild(t),this._scriptLoadingPromise},t.loadUIAMap=function(){var e=this;return!this._config.uiVersion||window.AMapUI?Promise.resolve():new Promise((function(t,n){var a=document.createElement("script"),i=e._config.uiVersion.split("."),o=i[0],r=i[1],l=i[2];if(void 0!==o&&void 0!==r){var c=e._config.protocol+"://webapi.amap.com/ui/"+o+"."+r+"/main-async.js";l&&(c+="?v="+o+"."+r+"."+l),a.src=c,a.type="text/javascript",a.async=!0,e._document.head.appendChild(a),a.onload=function(){setTimeout(t,0)},a.onerror=function(){return n()}}else console.error("amap ui version is not correct, please check! version: ",e._config.uiVersion)}))},t._getScriptSrc=function(){var e=/^AMap./,t=this._config,n=["v","key","plugin","callback"];if(t.plugin&&t.plugin.length>0){t.plugin.push("Autocomplete","PlaceSearch","PolyEditor","CircleEditor");var a=[];t.plugin.forEach((function(t){var n=e.test(t)?t:"AMap."+t,i=n.replace(e,"");a.push(n,i)})),t.plugin=a}var i=Object.keys(t).filter((function(e){return~n.indexOf(e)})).filter((function(e){return null!=t[e]})).filter((function(e){return!Array.isArray(t[e])||Array.isArray(t[e])&&t[e].length>0})).map((function(e){var n=t[e];return Array.isArray(n)?{key:e,value:n.join(",")}:{key:e,value:n}})).map((function(e){return e.key+"="+e.value})).join("&");return this._config.protocol+"://"+this._config.hostAndPath+"?"+i},e}(),ue=null,he=function(){function e(){}var t=e.prototype;return t.addPlugins=function(e,t){var n=window.AMap,a=t.filter((function(e){return!n[e.sName]}));return a&&a.length?e.plugin(a,this.addMapControls):this.addMapControls(e,t)},t.addMapControls=function(e,t){var n=this;if(t&&t.length){var a={},i=window.AMap;t.forEach((function(t){var o=n.convertAMapPluginProps(t),r=a[o.pName]=new i[o.sName](o);if(e.addControl(r),t.events)for(var l in t.events){var c=t.events[l];"init"===l?c(r):i.event.addListener(r,l,c)}}))}},t.convertAMapPluginProps=function(e){if("object"==typeof e&&e.pName){switch(e.pName){case"AMap.ToolBar":case"AMap.Scale":e.offset&&e.offset instanceof Array&&(e.offset=this.toPixel(e.offset))}return e}return""},t.toPixel=function(e){return new window.AMap.Pixel(e[0],e[1])},e}();function fe(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}var ve=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=[].map.call(t,(function(e){return e.trim()})).filter((function(e){return e.length})).join("-");return a.length?1!==a.length&&/[_.\- ]+/.test(a)?a.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})):a[0]===a[0].toLowerCase()&&a.slice(1)!==a.slice(1).toLowerCase()?a:a.toLowerCase():""},ge=function(){function e(){this._componentMap=new Map,this._map=null}var t=e.prototype;return t.setMap=function(e){this._map=e},t.getMap=function(){return this._map},t.setComponent=function(e,t){this._componentMap.set(e,t)},t.getComponent=function(e){return this._componentMap.get(e)},t.getChildInstance=function(e){return this.getComponent(e)},t.removeComponent=function(e){this._componentMap.delete(e)},e}(),we=t.defineComponent({name:"fm-business-attachment",props:{extendFields:{type:Array,default:function(){return[{}]}},showNavBar:{type:Boolean,default:!0},parentDirName:{type:String,default:""},rootId:{type:String,default:"default-root"},path:{type:String,default:""},title:{type:String,default:"导航栏"},displayAttachmentInfo:{type:Boolean,default:!1},removable:{type:Boolean,default:!1},displayAttachmentId:{type:Boolean,default:!0},displayAttachmentName:{type:Boolean,default:!0},externalVideoUrl:{type:String,default:""}},setup:function(e,n){var i=n.emit,o=t.reactive({show:!1,fieldsValue:{},attachmentExtendFields:[],selectedAttachmentId:"",context:{data:[],oldData:[],getData:null,updateData:null,removeDataById:null,setData:null,appendData:null,removed:!1},currentData:null,fields:t.computed((function(){return e.extendFields||[{}]})),rawData:t.computed((function(){if(!o.currentData&&o.context.data.length&&(o.currentData=o.context.data[0],t.nextTick((function(){Object.keys(o.fieldsValue).forEach((function(e){o.fieldsValue[e]=l(o.currentData,e)}))}))),o.selectedAttachmentId){var n=o.context.data.find((function(t){return t[e.path.substring(1)].attachmentId===o.selectedAttachmentId}));n?(o.currentData=n,t.nextTick((function(){Object.keys(o.fieldsValue).forEach((function(e){o.fieldsValue[e]=l(o.currentData,e)}))}))):(o.context.data.length,t.nextTick((function(){Object.keys(o.fieldsValue).forEach((function(e){o.fieldsValue[e]=l(o.context.data[o.context.data.length-1],e)}))})))}return o.context.data})),filterData:t.computed((function(){return a.filterData(o.rawData,e.path,e.rootId)}))});t.onMounted((function(){r(),i("getRawData",o.context),!o.currentData&&o.context.data&&o.context.data.length&&(o.currentData=o.context.data[0])}));var r=function(){o.context.getData=le.getContextData.bind(null,o.context),o.context.updateData=le.updateContextData.bind(null,o.context),o.context.removeDataById=le.removeContextDataById.bind(null,o.context),o.context.setData=le.setContextData.bind(null,o.context),o.context.appendData=le.appendToContextData.bind(null,o.context)},l=function(e,t){if(e){var n=t.split("_");if(n.length>1){var a=n[1].substring(0,1).toLowerCase()+n[1].substring(1);return e[n[0]][a]}return e[t]}return""};return{state:o,uploadAttachment:function(e){o.selectedAttachmentId=e[0].metadataId,i("upload",{context:o.context,rootId:o.rootId,parentDirName:o.parentDirName,data:e})},removeAttachment:function(e){o.removed=!0,i("remove",{context:o.context,rootId:o.rootId,parentDirName:o.parentDirName,data:e})},selectChange:function(t){var n=t.attachmentId;o.selectedAttachmentId=n;var a=e.path.split("/")[1];o.currentData=le.getCurrentData(n,o.context.data,a),Object.keys(o.fieldsValue).forEach((function(e){o.fieldsValue[e]=l(o.currentData,e)})),i("selectChange",{context:o.context,rootId:o.rootId,parentDirName:o.parentDirName,data:t,currentData:o.currentData})},goBack:function(){if(o.show=!1,o.selectedAttachmentId="",o.currentData){var t=e.extendFields.map((function(e){return e.bindingField})).filter((function(e){return e}));le.modifyData(o.currentData,t,o.fieldsValue)}i("goBack",{listData:o.context.data,oldListData:o.context.oldData,context:o.context})},blur:function(e){var t=e.bindingField;o.currentData&&le.modifyData(o.currentData,[t],o.fieldsValue),i("blur",{field:e,context:o.context})},toAttachmentDetailPage:function(){o.show=!0,o.currentData=o.context.data[0];var t=[{id:fe(),bindingField:e.path.substring(1)+"_AttachmentId",editorType:"TextBox",position:"right",readonly:!0,label:"附件id",visible:e.displayAttachmentId},{id:fe(),bindingField:e.path.substring(1)+"_FileName",editorType:"TextBox",position:"right",readonly:!0,label:"附件名称",visible:e.displayAttachmentName}];e.displayAttachmentInfo&&(o.attachmentExtendFields=[].concat(t)),[].concat(o.attachmentExtendFields,e.extendFields).forEach((function(e){o.fieldsValue[e.bindingField]=o.currentData&&l(o.currentData,e.bindingField)}))},initContext:r,getDataValue:l}},components:{"fm-attachment-entry":G,"fm-attachment":d,"van-nav-bar":n.NavBar,"van-popup":n.Popup,"van-icon":n.Icon,"van-field":n.Field}}),be=t.withScopeId("data-v-75253ace");t.pushScopeId("data-v-75253ace");var ye={class:"fm-input-item fm-input-item-inline",id:"attachment-container"},xe={class:"fm-input-item pr-md pl-md",id:"attachment-container"},ke={class:"fm-edit-input-list",id:"detail-form-layout"},Ce={class:"fm-input-wrapper"},Ae={class:"fm-input-wrapper"};t.popScopeId();var Fe=be((function(e,n,a,i,o,r){var l=t.resolveComponent("fm-attachment-entry"),c=t.resolveComponent("van-icon"),s=t.resolveComponent("fm-navbar"),d=t.resolveComponent("van-field"),m=t.resolveComponent("fm-attachment"),p=t.resolveComponent("van-popup");return t.openBlock(),t.createBlock("div",null,[t.createVNode("div",ye,[t.createVNode("div",xe,[t.createVNode(l,{fileList:e.state.filterData,externalVideoUrl:e.externalVideoUrl,removable:e.removable,parentDirName:e.parentDirName,rootId:e.rootId,onRemove:e.removeAttachment,onUpload:e.toAttachmentDetailPage},null,8,["fileList","externalVideoUrl","removable","parentDirName","rootId","onRemove","onUpload"])])]),e.state.show?(t.openBlock(),t.createBlock(p,{key:0,show:e.state.show,"onUpdate:show":n[1]||(n[1]=function(t){return e.state.show=t}),position:"right",style:{width:"100%",height:"100%",display:"flex","flex-direction":"column",background:"#fff"}},{default:be((function(){return[e.showNavBar?(t.openBlock(),t.createBlock(s,{key:0,title:e.title,onClickLeft:e.goBack},{left:be((function(){return[t.createVNode(c,{name:"arrow-left",size:"18",color:"#333"})]})),_:1},8,["title","onClickLeft"])):t.createCommentVNode("v-if",!0),t.createVNode("div",ke,[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.state.attachmentExtendFields,(function(n){return t.openBlock(),t.createBlock("div",Ce,["TextBox"===n.editorType&&n.visible?(t.openBlock(),t.createBlock(d,{key:0,label:n.label,modelValue:e.state.fieldsValue[n.bindingField],"onUpdate:modelValue":function(t){return e.state.fieldsValue[n.bindingField]=t},readonly:n.readonly,onBlur:function(t){return e.blur(n)}},null,8,["label","modelValue","onUpdate:modelValue","readonly","onBlur"])):t.createCommentVNode("v-if",!0),"NumberBox"===n.editorType&&n.visible?(t.openBlock(),t.createBlock(d,{key:1,label:n.label,modelValue:e.state.fieldsValue[n.bindingField],"onUpdate:modelValue":function(t){return e.state.fieldsValue[n.bindingField]=t},readonly:n.readonly,type:"number",onBlur:function(t){return e.blur(n)}},null,8,["label","modelValue","onUpdate:modelValue","readonly","onBlur"])):t.createCommentVNode("v-if",!0)])})),256)),(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.extendFields,(function(n){return t.openBlock(),t.createBlock("div",Ae,["TextBox"===n.editorType?(t.openBlock(),t.createBlock(d,{key:0,label:n.label,modelValue:e.state.fieldsValue[n.bindingField],"onUpdate:modelValue":function(t){return e.state.fieldsValue[n.bindingField]=t},readonly:n.readonly,onBlur:function(t){return e.blur(n)}},null,8,["label","modelValue","onUpdate:modelValue","readonly","onBlur"])):t.createCommentVNode("v-if",!0),"NumberBox"===n.editorType?(t.openBlock(),t.createBlock(d,{key:1,label:n.label,modelValue:e.state.fieldsValue[n.bindingField],"onUpdate:modelValue":function(t){return e.state.fieldsValue[n.bindingField]=t},readonly:n.readonly,type:"number",onBlur:function(t){return e.blur(n)}},null,8,["label","modelValue","onUpdate:modelValue","readonly","onBlur"])):t.createCommentVNode("v-if",!0)])})),256))]),e.state.show?(t.openBlock(),t.createBlock(m,{key:1,fileList:e.state.filterData,parentDirName:e.parentDirName,externalVideoUrl:e.externalVideoUrl,rootId:e.rootId,onSelectChange:e.selectChange,onRemove:e.removeAttachment,onAfterAppendFile:e.uploadAttachment},null,8,["fileList","parentDirName","externalVideoUrl","rootId","onSelectChange","onRemove","onAfterAppendFile"])):t.createCommentVNode("v-if",!0)]})),_:1},8,["show"])):t.createCommentVNode("v-if",!0)])}));b(".van-nav-bar .van-nav-bar__content[data-v-75253ace] {\n  flex: 1; }\n"),we.render=Fe,we.__scopeId="data-v-75253ace",we.__file="src/business/attachment/attachment.vue",we.install=function(e){e.component(we.name,we)};var Be,Ne,Ve=t.defineComponent({name:"fm-approve",components:{"fm-popup":i.Popup,"fm-navbar":i.Navbar,"fm-lookup-input":i.LookupInput,"fm-picker":i.Picker,"fm-button":i.Button},props:{show:{type:Boolean,default:!1},processReadFlag:Boolean,nextNodeReadFlag:Boolean,assigneeReadFlag:Boolean,cancelDisabled:Boolean,confirmDisabled:Boolean,process:[String,Number],processOc:Function,processData:Array,nextNode:[String,Number],nextNodeOc:Function,nextNodeData:Array,assignee:[String,Number],assigneeOc:Function,assigneeData:Object,submit:Function,cancel:Function,assignInfos:[Object],selectedValues:[String],multiSelect:{type:Boolean,default:!0},assigneeHolder:{type:String,default:""},nextNodeHolder:{type:String,default:""},processHolder:{type:String,default:""}},emits:["update:show","open","close"],setup:function(e,n){n.attrs,n.slots;var a=n.emit,i=function(t){"function"==typeof e.processOc&&e.processOc(t)},o=function(t){"function"==typeof e.nextNodeOc&&e.nextNodeOc(t)},r=function(){"function"==typeof e.submit&&e.submit()},l=function(){a("update:show",!1),"function"==typeof e.cancel&&e.cancel()};return function(){var n,a=e.process,c=void 0===a?"":a;e.processOc;var s=e.processData,d=void 0===s?[]:s,m=e.nextNode,p=void 0===m?"":m;e.nextNodeOc;var u=e.nextNodeData,h=void 0===u?[]:u;e.assignee,e.assigneeOc,e.assigneeData,e.submit,e.cancel;var f=e.selectedValues,v=void 0===f?[]:f,g=e.processReadFlag,w=e.nextNodeReadFlag;e.assigneeReadFlag,e.cancelDisabled;var b=e.confirmDisabled;e.multiSelect,e.assigneeHolder;var y,x=e.nextNodeHolder,k=e.processHolder,C=e.assignInfos,A=void 0===C?[]:C;return t.createVNode("div",null,[t.createVNode(t.resolveComponent("fm-popup"),{show:e.show,position:"right",style:"width:100%"},(y=n=t.createVNode("div",{class:"fm-submit-approve"},[t.createVNode("div",{class:"fm-submit-approve-header"},[t.createVNode(t.resolveComponent("fm-navbar"),{title:"流程选择",leftArrow:!0,onClickLeft:l},null)]),t.createVNode("div",{class:"fm-submit-approve-main"},[t.createVNode("div",{class:"fm-submit-approve-form"},[t.createVNode(t.resolveComponent("fm-picker"),{name:"picker",modelValue:c,"onUpdate:modelValue":function(e){return c=e},label:"选择流程",placeholder:k,onChange:i,"show-toolbar":!0,data:d,readonly:g,textField:"name",valueField:"id",mapFields:{id:"id"}},null),t.createVNode(t.resolveComponent("fm-picker"),{name:"picker",modelValue:p,"onUpdate:modelValue":function(e){return p=e},label:"下一环节",placeholder:x,onChange:o,"show-toolbar":!0,data:h,readonly:w,textField:"name",valueField:"id",mapFields:{id:"id"}},null),A.map((function(n,a){return t.createVNode(t.resolveComponent("fm-lookup-input"),{name:"lookup-input",modelValue:n.assignee,"onUpdate:modelValue":function(e){return n.assignee=e},placeholder:n.assigneeHolder,label:n.label,idField:"id",textField:"name",data:n.assigneeInfo.assigneeUsers,readonly:n.assigneeReadFlag,multiSelect:n.assigneeInfo&&n.assigneeInfo.multiSelect,selectedValues:"clear"===v[a]?"":v[a],onValueChange:function(t){!function(t,n){"function"==typeof e.assigneeOc&&e.assigneeOc(t,n)}(t,a)}},null)}))]),t.createVNode("div",{class:"fm-submit-approve-btn"},[t.createVNode(t.resolveComponent("fm-button"),{type:"info",round:!0,block:!0,key:"confirm",disabled:b,onClick:r},{default:function(){return[t.createTextVNode("确定")]}})])])]),"function"==typeof y||"[object Object]"===Object.prototype.toString.call(y)&&!t.isVNode(y)?n:{default:function(){return[n]}}))])}}}),Ie=!1;function Me(){var e=t.reactive({show:!1}),n=function(t){e.show=t},a=function(a){Object.assign(e,a),Ie||(window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.pushOriginGoback(Pe),Ie=!0),t.nextTick((function(){n(!0)}))},i=function(){n(!1),window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.popOriginGoback(),Ne&&Ne(),Be=void 0};return function(e){var n=t.getCurrentInstance();n&&Object.assign(n.proxy,e)}({open:a,close:i,toggle:n}),{open:a,close:i,state:e,toggle:n}}var Se=function(){var e=function(e){var n=t.createApp(e);n.use(l.default).use(c.default);var a=document.createElement("div");return document.body.appendChild(a),{instance:n.mount(a),unmount:function(){n.unmount(a),document.body.removeChild(a)}}}({setup:function(){var e=Me(),n=e.state,a=e.toggle;return function(){return t.createVNode(Ve,ce({},n,{"onUpdate:show":a}),null)}}});Be=e.instance,Ne=e.unmount};function Pe(){Ie=!1,Be.close()}function Le(e){if("undefined"!=typeof window)return Be||Se(),console.log("instance",Be),Be.open(e),Be}Le.clear=function(){Be&&Be.toggle(!1)},Le.confirm=function(e){return Le(e)},Le.install=function(e){e.component(Ve.name,Ve)},Le.Component=Ve;var De,Ue,Te=t.defineComponent({name:"fm-attachment-preview",components:{"fm-popup":i.Popup,"fm-navbar":i.Navbar},props:{title:{type:String,default:""},attachmentId:{type:String,default:""},rootId:{type:String,default:""},show:{type:Boolean,default:!1},path:{type:String,default:""}},emits:["update:show","open","close"],setup:function(e,n){var a=n.emit,i=function(){a("update:show",!1)},o=t.reactive({attachmentUrl:t.computed((function(){return"/platform/runtime/dfs/viewpage/index.html?metadataId="+e.attachmentId+"&rootId="+e.rootId+"&fileType=2"})),show:!1});return function(){return t.createVNode("div",null,[t.createVNode(t.resolveComponent("fm-popup"),{show:e.show,style:"width:100%;height:100%"},{default:function(){return[t.createVNode(t.resolveComponent("fm-navbar"),{title:e.title,onClickLeft:i},null),t.createVNode("iframe",{class:"pdf-iframe",scrolling:"yes",src:e.path||o.attachmentUrl,width:"100%",height:"100%"},null)]}})])}}}),Oe=!1;function Re(){var e=t.reactive({show:!1}),n=function(t){e.show=t},a=function(a){Object.assign(e,a),Oe||(window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.pushOriginGoback(ze),Oe=!0),window.top&&window.top!==window.self&&We(window.top.document),We(window.document),t.nextTick((function(){n(!0)}))},i=function(){n(!1),window.MOBILE_ORIGIN_BACK&&window.MOBILE_ORIGIN_BACK.popOriginGoback(),window.top&&window.top!==window.self&&_e(window.top.document),_e(window.document),Ue&&Ue(),De=void 0};return function(e){var n=t.getCurrentInstance();n&&Object.assign(n.proxy,e)}({open:a,close:i,toggle:n}),{open:a,close:i,state:e,toggle:n}}var Ee=function(){var e=function(e){var n=t.createApp(e);n.use(l.default).use(c.default);var a=document.createElement("div");return document.body.appendChild(a),{instance:n.mount(a),unmount:function(){n.unmount(a),document.body.removeChild(a)}}}({setup:function(){var e=Re(),n=e.state,a=e.toggle;return function(){return t.createVNode(Te,ce({},n,{"onUpdate:show":a}),null)}}});De=e.instance,Ue=e.unmount};function ze(){Oe=!1,De.close()}function je(e){if("undefined"!=typeof window)return De||Ee(),De.open(e),De}function We(e){var t=e.getElementsByName("viewport")[0],n=e.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1.0";var a=e.getElementsByTagName("head")[0];t&&a.removeChild(t),a.appendChild(n)}function _e(e){var t=e.getElementsByName("viewport")[0],n=e.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n";var a=e.getElementsByTagName("head")[0];t&&a.removeChild(t),a.appendChild(n)}je.close=function(){De&&De.toggle(!1)},je.show=function(e){return je(e)},je.install=function(e){e.component(Te.name,Te)},je.Component=Te;var He={name:"el-amap",props:["viewMode","skyColor","rotateEnable","pitch","buildingAnimation","pitchEnable","vid","events","center","zoom","draggEnable","level","zooms","lang","defaultCursor","crs","animateEnable","isHotspot","defaultLayer","resizeEnable","showIndoorMap","indoorMap","expandZoomRange","dragEnable","zoomEnable","doubleClickZoom","keyboardEnable","jogEnable","scrollWheel","touchZoom","mapStyle","plugin","features","amapManager","markers"],setup:function(e,n){var a=this,i=n.emit;n.attrs,n.slots;var o=t.ref(null),r=t.reactive({converters:{center:function(e){if("[object Array]"===Object.prototype.toString.call(e)&&e[0]&&e[1])return new AMap.LngLat(e[0],e[1])}},$amap:"",$amapComponent:"",loadPromise:null,circleMarker:"",plugins:t.computed((function(){var t=[],n=/^AMap./,a=function(e){return n.test(e)?e:"AMap."+e},i=function(e){return e.replace(n,"")};return"string"==typeof e.plugin?t.push({pName:a(e.plugin),sName:i(e.plugin)}):e.plugin instanceof Array&&(t=e.plugin.map((function(e){var t={};return"string"==typeof e?t={pName:a(e),sName:i(e)}:(e.pName=a(e.pName),e.sName=i(e.pName),t=e),t}))),t}))});t.onBeforeMount((function(){r.loadPromise=ue.load()})),t.watch((function(){return e.center}),(function(e,t){if(r.$amapComponent){var n=r.$amapComponent;n.setCenter(e),i("setCircleMarker",e,n)}})),t.onMounted((function(){l()})),t.onUnmounted((function(){r.$amap.destroy()}));var l=function(){r.loadPromise.then((function(){var t=o.value.querySelector(".el-vue-amap"),n=e.vid||fe();(t.id=n,r.$amap=r.$amapComponent=new AMap.Map(n,c()),e.amapManager&&e.amapManager.setMap(r.$amap),r.plugins&&r.plugins.length)&&(new he).addPlugins(r.$amapComponent,r.plugins);e.events&&Object.keys(e.events).forEach((function(t){AMap.event.addListener(r.$amapComponent,t,e.events[t])})),i("afterInit",e.center,r.$amapComponent)}))},c=function(){var t={};return r.$amap&&(t.map=r.$amap),Object.keys(e).reduce((function(n,a){var i=a,o=s(i,e[i]);return void 0===o||(t[i]=o),n}),t)},s=function(e,t){return r.converters&&r.converters[e]?r.converters[e].call(a,t):t};return{el:o,state:r,createMap:l,convertProps:c,convertSignalProp:s}}},qe=t.withScopeId("data-v-958f0908");t.pushScopeId("data-v-958f0908");var Ge={ref:"el",class:"el-vue-amap-container"},Ke=t.createVNode("div",{class:"el-vue-amap"},null,-1);t.popScopeId();var Xe=qe((function(e,n,a,i,o,r){return t.openBlock(),t.createBlock("div",Ge,[Ke,t.renderSlot(e.$slots,"default")],512)}));b(".el-vue-amap-container[data-v-958f0908] {\n  height: 100%; }\n  .el-vue-amap-container[data-v-958f0908] .el-vue-amap {\n    height: 100%; }\n"),He.render=Xe,He.__scopeId="data-v-958f0908",He.__file="src/business/map/src/busi-map.vue";var Ze=[He],Je={initAMapApiLoader:function(e){ue||(ue||(ue=new pe(e)),ue.load())},AMapManager:ge};Je.install=function(e){Je.installed||(e.config.optionMergeStrategies.deferredReady=e.config.optionMergeStrategies.created,Ze.map((function(t){e.component(t.name,t),Je[function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=ve.apply(ve,t);return a.charAt(0).toUpperCase()+a.slice(1)}(t.name).replace(/^El/,"")]=t})))};var Ye=t.defineComponent({name:"fm-map",components:{},inject:{mapService:{default:null}},props:{width:{type:String,default:"100%"},height:{type:String,default:"400px"},zoomEnable:{type:Boolean,default:!0},dragEnable:{type:Boolean,default:!0},resizeEnable:{type:Boolean,default:!0},zoom:{type:Number,default:12},center:{type:Array,default:function(){return[0,0]}},markers:{type:Array,default:function(){return[]}},limitCity:{type:String,default:"山东"},limitSearch:{type:Boolean,default:!1},showSearch:{type:Boolean,default:!1},mapKey:{type:String,default:"ee46e4ad4d6e45789dc9f2754271e2a6"},displayDireaction:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},created:function(){Je.initAMapApiLoader({key:this.mapKey,plugin:["AMap.Autocomplete","AMap.PlaceSearch","AMap.Scale","AMap.OverView","AMap.Geolocation","AMap.ToolBar","AMap.MapType","AMap.PolyEditor","AMap.CircleEditor","AMap.Geocoder"],v:"1.4.4"})},mounted:function(){},unmounted:function(){this.mapMarkers&&this.mapMarkers.length&&this.emptyMarkers()},data:function(){var e=this,t=this;return{amapManager:new ge,subject:null,mapMarkers:[],defaultCenter:[0,0],events:{init:function(t){e.addMarkers(e.markers,t)},zoomchange:function(){e.$emit("zoomChange")},click:function(t){var n=new AMap.Geocoder({radius:1e3,extensions:"all"}),a=e,i="";n.getAddress([t.lnglat.lng,t.lnglat.lat],(function(e,n){"complete"===e&&"OK"===n.info&&n&&n.regeocode&&(i=n.regeocode.formattedAddress,t.address=i,a.$emit("markMap",t))}))}},plugin:[{pName:"Scale",events:{init:function(e){}}},{pName:"Geolocation",events:{init:function(e){}},noGeoLocation:1,enableHighAccuracy:!1,timeout:1e4,maximumAge:0,convert:!0,showButton:!t.center||0==t.center[0]||0==t.center[1],buttonPosition:"LB",showMarker:!0,showCircle:!0,panToLocation:!0,zoomToAccuracy:!0}],markerEvents:{click:function(t){e.$emit("clickMaker",t)},dragend:function(t){e.$emit("dragMarkerEnd",t)}},defaultMarkers:[],mapCenter:""}},watch:{markers:function(e){window.AMap&&e&&this.resetMarkers(e)}},computed:{computedMarkers:function(){return this.markers?this.markers.length?this.markers:this.defaultMarkers:[]},computedCenter:function(){return this.center||this.defaultCenter}},methods:{getPosition:function(){this.mapService.getCurrentLocation()},afterInit:function(e,t){(this.addMarkers(this.markers,t),"[object Array]"===Object.prototype.toString.call(this.center)&&this.center[0]&&this.center[1])&&new AMap.CircleMarker({center:e,radius:10,strokeColor:"white",strokeWeight:2,strokeOpacity:.5,fillColor:"rgba(30,144,255)",fillOpacity:.5,zIndex:10,bubble:!0,cursor:"pointer",clickable:!0}).setMap(t);this.resetMarkers(this.markers)},getCurrentLocation:function(){},onSearchResult:function(e){},getCenter:function(){return this.$refs.map.$$getCenter()},getCurrentPosition:function(){},addMarkers:function(e,t){var n=e.map((function(e){return new AMap.Marker({position:e.position})}));this.mapMarkers=[].concat(n),this.mapMarkers.forEach((function(e){t.add(e)}))},removeMarkers:function(){},emptyMarkers:function(){this.amapManager.getMap().remove(this.mapMarkers),this.mapMarkers.splice(0,this.mapMarkers.length)},resetMarkers:function(e){this.emptyMarkers(),this.addMarkers(e,this.amapManager.getMap())}}});b(".farris-mobile-map {\n  width: 100%;\n  height: 450px; }\n\n.amap-logo {\n  visibility: hidden; }\n\n.amap-scalecontrol {\n  visibility: hidden !important; }\n\n.amap-copyright {\n  visibility: hidden !important; }\n"),Ye.render=function(e,n,a,i,o,r){var l=t.resolveComponent("el-amap");return t.openBlock(),t.createBlock("div",null,[t.createVNode("div",{style:{width:e.width,height:e.height}},[t.createVNode(l,{ref:"map",vid:"amapDemo",resizeEnable:e.resizeEnable,dragEnable:e.dragEnable,zoomEnable:e.zoomEnable,center:e.center,zoom:e.zoom,plugin:e.plugin,events:e.events,amapManager:e.amapManager,onAfterInit:e.afterInit,onSetCircleMarker:e.afterInit},null,8,["resizeEnable","dragEnable","zoomEnable","center","zoom","plugin","events","amapManager","onAfterInit","onSetCircleMarker"])],4)])},Ye.__file="src/business/map/src/map.vue",Ye.install=function(e){e.component(Ye.name,Ye).use(Je)};var Qe={install:function(e){e.config.globalProperties.$filterAttachment=function(e,t,n,i){return void 0===i&&(i=!0),a.filterData(e,t,n,i)},e.config.globalProperties.$filterMap=function(e,t,n){return a.filterMapData(e,t,n)}}},$e=t.defineComponent({name:"approval-logs",props:{dataId:{type:String,required:!0},title:{type:String,default:"审批记录"},visiavle:{type:Boolean,default:!0}},setup:function(e){var n=t.toRefs(e).dataId,a=function(){if(n.value){var e=document.getElementById("approval-logs-container"),t="/platform/runtime/wf/webapp/mobiletaskcenter/taskComment.js";t=t+"?version="+(""+(new Date).getTime()),System.import(t).then((function(){var t={bizInstId:n.value,procInstId:"",isIncludeHistory:!1};window.gspTaskCenterBizLog.ApprovalLogUtil.getBizlogHtml(t,e)}))}};return t.onMounted(a),t.watch(n,a),{}}}),et={key:0,class:"fm-tmpl-struct-wrapper",id:"section-83f5062"},tt={class:"fm-tmpl-section fm-tmpl-section-form"},nt={class:"fm-tmpl-section-header"},at={class:"fm-title"},it={class:"fm-title-text"},ot=t.createVNode("div",{id:"approval-logs-container"},null,-1);$e.render=function(e,n,a,i,o,r){return e.visiavle?(t.openBlock(),t.createBlock("div",et,[t.createVNode("div",tt,[t.createVNode("div",nt,[t.createVNode("div",at,[t.createVNode("span",it,t.toDisplayString(e.title),1)])]),ot])])):t.createCommentVNode("v-if",!0)},$e.__file="src/business/approval-logs/approval-logs.vue",$e.install=function(e){e.component($e.name,$e)};var rt=[ae,we,d,k,G,Le,$e,Ye,Qe,je],lt=function(e){rt.forEach((function(t){e.use(t)}))},ct={install:lt};e.ApprovalLogs=$e,e.Attachment=d,e.AttachmentEntry=G,e.AttachmentFile=k,e.AttachmentPreview=je,e.BusinessAttachment=we,e.BusinessMap=Ye,e.BusinessVerifyCode=ae,e.FarrisBusinessPlugin=Qe,e.SubmitApprove=Le,e.default=ct,e.install=lt,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=mobile-business-ui.min.js.map

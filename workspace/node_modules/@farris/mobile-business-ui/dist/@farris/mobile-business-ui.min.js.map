{"version":3,"file":"mobile-business-ui.min.js","sources":["../../src/components/attachment/src/service/uuid.ts","../../src/components/attachment/src/attachment.vue","../../src/components/attachment/src/attachment.vue?vue&type=template&id=443ecfba&lang.js","../../node_modules/style-inject/dist/style-inject.es.js","../../src/components/attachment/index.ts","../../src/components/attachment-file/src/service/uuid.ts","../../src/components/attachment-file/src/attachment-file.vue","../../src/components/attachment-file/src/attachment-file.vue?vue&type=template&id=9380a99c&lang.js","../../src/components/attachment-file/index.ts","../../src/components/attachment-entry/src/attachment-entry.vue","../../src/components/attachment-entry/src/attachment-entry.vue?vue&type=template&id=0d94d79a&lang.js","../../src/components/attachment-entry/index.ts","../../src/business/verify-code/src/index.vue","../../src/business/verify-code/src/index.vue?vue&type=template&id=607c2323&lang.js","../../src/business/verify-code/index.ts","../../src/business/attachment/attachment.service.ts","../../src/business/map/service/remote.ts","../../src/business/map/service/load-map-api.ts","../../src/business/map/service/inject-api.ts","../../src/business/map/service/map-plugin.ts","../../src/business/map/service/utils.ts","../../src/business/map/service/amap-manager.ts","../../src/business/attachment/attachment.vue","../../src/business/attachment/attachment.vue?vue&type=template&id=75253ace&lang.js","../../src/business/attachment/index.ts","../../src/business/submit-approve/src/index.jsx","../../src/business/submit-approve/src/approve.jsx","../../src/components/attachment-preview/src/index.jsx","../../src/components/attachment-preview/src/attachment-preview.jsx","../../src/business/map/src/busi-map.vue","../../src/business/map/src/busi-map.vue?vue&type=template&id=958f0908&lang.js","../../src/business/map/src/index.ts","../../src/business/map/src/map.vue","../../src/business/map/src/map.vue?vue&type=template&id=b762bdf0&lang.js","../../src/business/map/index.ts","../../src/plugin/filter.ts","../../src/business/approval-logs/approval-logs.vue","../../src/business/approval-logs/approval-logs.vue?vue&type=template&id=7b17e026&lang.js","../../src/business/approval-logs/index.ts","../../src/index.ts"],"sourcesContent":[null,"<template>\r\n  <div class=\"farris-attachment attachment\" ref=\"attach\">\r\n    <van-uploader\r\n      :multiple=\"multiple\"\r\n      ref=\"fileUploadRef\"\r\n      :max-count=\"maxNum\"\r\n      v-model=\"rawFiles\"\r\n      :disabled=\"disabled\"\r\n      :preview-full-image=\"previewEnable\"\r\n      :accept=\"accept\"\r\n      :before-read=\"beforeRead\"\r\n      :after-read=\"afterRead\"\r\n      v-show=\"false\"\r\n    />\r\n    <div class=\"farris-attachment-img\">\r\n      <van-empty\r\n        description=\"附件为空\"\r\n        v-if=\"!selectedFile || (!selectedFile.url && !selectedFile.file)\"\r\n      />\r\n      <div\r\n        class=\"img-container\"\r\n        v-if=\"selectedFile && selectedFile.url\"\r\n        ref=\"imgContainer\"\r\n      >\r\n        <van-image\r\n          :height=\"imgHeight\"\r\n          fit=\"scale-down\"\r\n          :src=\"getAttachmentPathByType(selectedFile)\"\r\n          @click=\"genPreview\"\r\n          v-if=\"\r\n            selectedFile.name\r\n              .toLowerCase()\r\n              .search(\r\n                /\\.(png|jpe?g|gif|svg|ppt|pptx|xls|xlsx|doc|docx|txt|pdf)(\\?.*)?$/\r\n              ) >= 0\r\n          \"\r\n        />\r\n        <video\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mov')\r\n          \"\r\n        >\r\n          <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n        </video>\r\n        <video\r\n          :src=\"selectedFile.url\"\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            (selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mp4')) ||\r\n              selectedFile.name.toLowerCase().includes('webm') ||\r\n              selectedFile.name.toLowerCase().includes('ogg')\r\n          \"\r\n        >\r\n          您的浏览器不支持 video 标签。\r\n        </video>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          closeable\r\n          @closed=\"closed\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n          <div v-if=\"showDoc\" class=\"panzoom\" :style=\"docStyle\">\r\n            <div\r\n              v-for=\"(page, index) in previewPages\"\r\n              class=\"page\"\r\n              :style=\"{ width: 'unset', height: 'unset' }\"\r\n              :key=\"index\"\r\n            >\r\n              <div v-html=\"page.data\" v-if=\"page.data\"></div>\r\n            </div>\r\n          </div>\r\n        </van-popup>\r\n      </div>\r\n      <div v-if=\"selectedFile && selectedFile.file\"></div>\r\n      <!-- </van-col> -->\r\n    </div>\r\n    <div class=\"attachment-navigation\" ref=\"navigation\">\r\n      <van-grid clickable :column-num=\"gridNumber\">\r\n        <!-- 拍照  只有云+ 云上协同支持-->\r\n        <van-grid-item\r\n          text=\"拍摄\"\r\n          icon=\"photograph\"\r\n          @click=\"takePhoto\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.photo && ccWork.photo.isPhoto) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.photo &&\r\n                cloudPlus.photo.isPhoto) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 相册 均支持 -->\r\n        <van-grid-item\r\n          text=\"相册\"\r\n          icon=\"photo\"\r\n          @click=\"selectFromAlbum\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.album && ccWork.album.isAlbum) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.album &&\r\n                cloudPlus.album.isAlbum) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 目前只有云上协同支持 -->\r\n        <van-grid-item\r\n          text=\"短视频\"\r\n          icon=\"video\"\r\n          @click=\"takeShortVideo\"\r\n          v-if=\"pattern === 'ccWork' && ccWork.video && ccWork.video.isVideo\"\r\n        />\r\n        <!-- 选择文件 目前只有原生模式和云+支持 -->\r\n        <van-grid-item\r\n          text=\"文件\"\r\n          icon=\"card\"\r\n          @click=\"appendFile\"\r\n          v-if=\"\r\n            (pattern === 'cloudPlus' && cloudPlus.selectFile.isFile) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n      </van-grid>\r\n      <van-row type=\"flex\" justify=\"center\">\r\n        <van-col class=\"attachment-navigation-1 last-navigation\" span=\"24\">\r\n          <div\r\n            v-for=\"(item, index) in uploadFiles\"\r\n            :class=\"{\r\n              'attachment-navigation-item': true,\r\n              'selected-file': selectedFile\r\n                ? item.id === selectedFile.id &&\r\n                  selectedAttachmentId === selectedFile.attachmentId\r\n                : false,\r\n            }\"\r\n            :key=\"index\"\r\n            @touchstart=\"goTouchStart(item)\"\r\n            @click.stop=\"selectFile(item)\"\r\n          >\r\n            <van-image\r\n              :src=\"getAttachmentPathByType(item)\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item && item.name && !item.name.includes('mp4')) || !item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              src=\"/platform/runtime/dfs/images/file.png\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item &&\r\n                  item.name &&\r\n                  item.name.toLowerCase().includes('mp4')) ||\r\n                  item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n            <div\r\n              class=\"item-icon-delete\"\r\n              @click=\"deleteAttachment(item)\"\r\n              v-if=\"\r\n                selectedFile\r\n                  ? item.id === selectedFile.id &&\r\n                    selectedAttachmentId === selectedFile.attachmentId\r\n                  : false\r\n              \"\r\n            >\r\n              <span class=\"fm-icon fm-icon-close\"></span>\r\n            </div>\r\n          </div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n<style scoped lang=\"scss\">\r\n.attachment {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  & .farris-attachment-img {\r\n    display: flex;\r\n    flex: 1;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  & .img-container {\r\n    text-align: center;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  & video {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.preview-mask {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.farris-attachment {\r\n  clear: both;\r\n\r\n  // 附件组件背景和尺寸\r\n  & .attachment-detail {\r\n    background: #fff;\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n\r\n  // 选中附件样式\r\n  & .selected-file {\r\n    box-shadow: inset 0px 0px 3px 3px #59a1ff;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  & .attachment-navigation-1 {\r\n    overflow: auto;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & img {\r\n      border-radius: 5px;\r\n    }\r\n\r\n    & .item-pdf {\r\n      width: 100%;\r\n      height: 100%;\r\n      background-image: url(\"data:image/png;base64,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\");\r\n      background-size: contain;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: -6px;\r\n      top: -6px;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n      border-radius: 50%;\r\n\r\n      .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .first-navigation {\r\n    max-width: 80%;\r\n  }\r\n\r\n  // 内置前置导航\r\n  & .first-navigation .attachment-navigation-item {\r\n    width: 55px;\r\n    height: 55px;\r\n  }\r\n\r\n  // 后置导航\r\n  & .last-navigation .attachment-navigation-item {\r\n    margin: 6px;\r\n    width: 80px;\r\n    height: 80px;\r\n  }\r\n\r\n  & .attachment-navigation-icon {\r\n    text-align: center;\r\n\r\n    & .add-icon {\r\n      margin: 8px 0;\r\n      width: 55px;\r\n      height: 55px;\r\n    }\r\n  }\r\n\r\n  & .van-grid-item .van-image img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .fixed-bottom {\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n  }\r\n\r\n  & .small-imgs-child {\r\n    width: 80px;\r\n    height: 80px;\r\n    background-size: contain;\r\n  }\r\n\r\n  & .small-imgs-item {\r\n    position: relative;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .small-imgs-item img {\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .action-grid {\r\n    position: absolute;\r\n    width: 100%;\r\n    bottom: 100px;\r\n  }\r\n\r\n  & .preview-img img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .upload-icon {\r\n    position: absolute;\r\n    top: 0.5rem;\r\n    left: 0.5rem;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 5%;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport {\r\n  Uploader,\r\n  Empty,\r\n  Image,\r\n  Popup,\r\n  Grid,\r\n  GridItem,\r\n  Row,\r\n  Col,\r\n  ImagePreview,\r\n} from \"vant\";\r\nimport { uuid } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment\",\r\n  components: {\r\n    \"van-uploader\": Uploader,\r\n    \"van-empty\": Empty,\r\n    \"van-image\": Image,\r\n    \"van-popup\": Popup,\r\n    \"van-grid\": Grid,\r\n    \"van-grid-item\": GridItem,\r\n    \"van-row\": Row,\r\n    \"van-col\": Col,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: null },\r\n  },\r\n  props: {\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      default:\r\n        \"application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain\",\r\n      // default: 'application/pdf,image/*,application/msword,text/html'\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 自定义进入附件组件的入口\r\n    allowDefaultEntrance: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    // 上传附件信息\r\n    uploadInfo: {\r\n      type: Object,\r\n      default: null,\r\n    },\r\n    // parentDirName\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 上传模式  html ccWork cloudPlus\r\n    pattern: {\r\n      type: String,\r\n      default: \"ccWork\",\r\n    },\r\n    // 云上协同配置\r\n    ccWork: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: \"high\",\r\n            mode: \"camera\",\r\n            mark: \"\",\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            mType: \"0\",\r\n            maxNum: 6,\r\n          },\r\n          video: {\r\n            id: \"af700826-7552-4858-a5e0-e64f5e20288b\",\r\n            quality: 0.8,\r\n            time: 15,\r\n            isVideo: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            mType: \"0\",\r\n            maxNum: 9,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 云+配置\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            maximum: 3,\r\n            fileType: \".jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|.txt\",\r\n            isFile: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 原生模式\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t弹出层显示\r\n\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      videoUrl: \"\",\r\n      selectedAttachmentId: \"\",\r\n      subscription: \"\",\r\n      // 图片尺寸\r\n      imgHeight: 0,\r\n      imhWidth: 0,\r\n      // 尺寸开关\r\n      hasFiles: false,\r\n      // 预览文件尺寸\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      const self = this;\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n          this.$nextTick(() => {\r\n            self.goTouchStart(this.selectedFile);\r\n          });\r\n        }\r\n        if (this.selectedAttachmentId) {\r\n          this.selectedFile = this.rawFiles.find(\r\n            (rawFile) => rawFile.attachmentId === this.selectedAttachmentId\r\n          );\r\n          if (this.selectedFile) {\r\n            // 上传成功后  选中新上传的附件且附件信息同步变更\r\n            this.$nextTick(() => {\r\n              self.goTouchStart(this.selectedFile);\r\n              this.$loading.hide();\r\n            });\r\n          }\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        // 没有url属性的 没有上传\r\n        if (!this.hasFiles) {\r\n          this.$nextTick(() => {\r\n            this.calculateImgSize(80);\r\n            this.hasFiles = true;\r\n          });\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      // 没有url属性的 没有上传\r\n      if (this.hasFiles) {\r\n        this.$nextTick(() => {\r\n          this.calculateImgSize();\r\n          this.hasFiles = false;\r\n        });\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n    // 拍照  选择文件  拍摄短视频等\r\n    gridNumber() {\r\n      if (this.pattern === \"ccWork\") {\r\n        return (\r\n          Number(this.ccWork.photo.isPhoto) +\r\n          Number(this.ccWork.video.isVideo) +\r\n          Number(this.ccWork.album.isAlbum)\r\n        );\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        return (\r\n          Number(this.cloudPlus.photo.isPhoto) +\r\n          Number(this.cloudPlus.selectFile.isFile) +\r\n          Number(this.cloudPlus.album.isAlbum)\r\n        );\r\n      } else {\r\n        // 原生模式\r\n        return 3;\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n  },\r\n  mounted() {\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          console.log(res);\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n    this.$loading.hide();\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"html\") {\r\n        this.$refs.fileUploadRef.chooseFile();\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        // 选择文件服务\r\n        this.attachmentService.getSysInfo().subscribe((res) => {\r\n          if (res && res.platform === \"Android\") {\r\n            this.attachmentService.selectFile(this.cloudPlus.selectFile);\r\n          } else if (res && res.platform === \"iOS\") {\r\n            this.$refs.fileUploadRef.chooseFile();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 使用h5文件API 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      console.log(file);\r\n      this.$loading.show(\"附件上传中\");\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      if (this.notUploadedFileList.length > this.maxNum) {\r\n        this.$notify.warning(\"最多上传\" + this.maxNum + \"个附件\");\r\n        return;\r\n      }\r\n      // 赋值最新的上传文件附件id\r\n      this.selectedAttachmentId = this.notUploadedFileList[0].id;\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n\r\n    goTouchStart(item) {\r\n      this.selectedFile = item;\r\n      if (\r\n        (this.selectedFile.name &&\r\n          this.selectedFile.name.toLowerCase().includes(\"mp4\")) ||\r\n        this.selectedFile.name.toLowerCase().includes(\"webm\") ||\r\n        this.selectedFile.name.toLowerCase().includes(\"ogg\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          this.selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${this.selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(this.selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n      }\r\n      this.selectedAttachmentId = item.attachmentId;\r\n      this.$emit(\"beforeSelect\", item);\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.selectedFile = item;\r\n\r\n      this.$emit(\"selectChange\", item);\r\n    },\r\n\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 生成预览\r\n     */\r\n    genPreview() {\r\n      if (!this.selectedFile || !this.selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (this.uploadAttachmentService) {\r\n        if (\r\n          this.selectedFile.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0\r\n        ) {\r\n          // 图片预览\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        } else if (this.selectedFile.name.includes(\"pdf\")) {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          // pdf预览\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n          // window.open(`/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`);\r\n        } else if (this.selectedFile.name.includes(\"mp4\")) {\r\n          // this.attachmentService.playShortVideo(\r\n          //   this.videoUrl + \"/\" + this.selectedFile.name\r\n          // );\r\n        } else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n      this.$emit(\"preview\", this.selectedFile);\r\n    },\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    /**\r\n\t\t删除附件\r\n\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.selectedFile = null;\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    /**\r\n     * 拍照\r\n     */\r\n    takePhoto() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.ccWork.photo);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.cloudPlus.photo);\r\n      }\r\n    },\r\n    selectFromAlbum() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 选择文件服务\r\n        this.attachmentService.selectAttachment(this.cloudPlus.album);\r\n      }\r\n    },\r\n    /**\r\n\t\t拍摄短视频\r\n\t\t\t*/\r\n    takeShortVideo() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takeShortVideo(this.ccWork.video);\r\n      }\r\n    },\r\n\r\n    getVideoFile(file) {\r\n      const fileName = file.name;\r\n      const metadataId = file.url;\r\n      return { fileName, metadataId };\r\n    },\r\n\r\n    calculateImgSize(externalSize = 0) {\r\n      // 计算图片尺寸\r\n      const size = this.$refs.attach.getBoundingClientRect();\r\n      const naviSize = this.$refs.navigation.getBoundingClientRect();\r\n      const imgHeight = size.height - naviSize.height - externalSize;\r\n      if (this.$refs.imgContainer) {\r\n        const imgContainerHeight = this.$refs.imgContainer.getBoundingClientRect()\r\n          .height;\r\n        if (imgContainerHeight > imgHeight) {\r\n          this.imgHeight = imgContainerHeight;\r\n        }\r\n      } else {\r\n        this.imgHeight = imgHeight;\r\n      }\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n","<template>\r\n  <div class=\"farris-attachment attachment\" ref=\"attach\">\r\n    <van-uploader\r\n      :multiple=\"multiple\"\r\n      ref=\"fileUploadRef\"\r\n      :max-count=\"maxNum\"\r\n      v-model=\"rawFiles\"\r\n      :disabled=\"disabled\"\r\n      :preview-full-image=\"previewEnable\"\r\n      :accept=\"accept\"\r\n      :before-read=\"beforeRead\"\r\n      :after-read=\"afterRead\"\r\n      v-show=\"false\"\r\n    />\r\n    <div class=\"farris-attachment-img\">\r\n      <van-empty\r\n        description=\"附件为空\"\r\n        v-if=\"!selectedFile || (!selectedFile.url && !selectedFile.file)\"\r\n      />\r\n      <div\r\n        class=\"img-container\"\r\n        v-if=\"selectedFile && selectedFile.url\"\r\n        ref=\"imgContainer\"\r\n      >\r\n        <van-image\r\n          :height=\"imgHeight\"\r\n          fit=\"scale-down\"\r\n          :src=\"getAttachmentPathByType(selectedFile)\"\r\n          @click=\"genPreview\"\r\n          v-if=\"\r\n            selectedFile.name\r\n              .toLowerCase()\r\n              .search(\r\n                /\\.(png|jpe?g|gif|svg|ppt|pptx|xls|xlsx|doc|docx|txt|pdf)(\\?.*)?$/\r\n              ) >= 0\r\n          \"\r\n        />\r\n        <video\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mov')\r\n          \"\r\n        >\r\n          <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n        </video>\r\n        <video\r\n          :src=\"selectedFile.url\"\r\n          controls=\"controls\"\r\n          :height=\"imgHeight\"\r\n          controlslist=\"nodownload\"\r\n          v-if=\"\r\n            (selectedFile &&\r\n              selectedFile.name &&\r\n              selectedFile.name.toLowerCase().includes('mp4')) ||\r\n              selectedFile.name.toLowerCase().includes('webm') ||\r\n              selectedFile.name.toLowerCase().includes('ogg')\r\n          \"\r\n        >\r\n          您的浏览器不支持 video 标签。\r\n        </video>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          closeable\r\n          @closed=\"closed\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n          <div v-if=\"showDoc\" class=\"panzoom\" :style=\"docStyle\">\r\n            <div\r\n              v-for=\"(page, index) in previewPages\"\r\n              class=\"page\"\r\n              :style=\"{ width: 'unset', height: 'unset' }\"\r\n              :key=\"index\"\r\n            >\r\n              <div v-html=\"page.data\" v-if=\"page.data\"></div>\r\n            </div>\r\n          </div>\r\n        </van-popup>\r\n      </div>\r\n      <div v-if=\"selectedFile && selectedFile.file\"></div>\r\n      <!-- </van-col> -->\r\n    </div>\r\n    <div class=\"attachment-navigation\" ref=\"navigation\">\r\n      <van-grid clickable :column-num=\"gridNumber\">\r\n        <!-- 拍照  只有云+ 云上协同支持-->\r\n        <van-grid-item\r\n          text=\"拍摄\"\r\n          icon=\"photograph\"\r\n          @click=\"takePhoto\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.photo && ccWork.photo.isPhoto) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.photo &&\r\n                cloudPlus.photo.isPhoto) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 相册 均支持 -->\r\n        <van-grid-item\r\n          text=\"相册\"\r\n          icon=\"photo\"\r\n          @click=\"selectFromAlbum\"\r\n          v-if=\"\r\n            (pattern === 'ccWork' && ccWork.album && ccWork.album.isAlbum) ||\r\n              (pattern === 'cloudPlus' &&\r\n                cloudPlus.album &&\r\n                cloudPlus.album.isAlbum) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n        <!-- 目前只有云上协同支持 -->\r\n        <van-grid-item\r\n          text=\"短视频\"\r\n          icon=\"video\"\r\n          @click=\"takeShortVideo\"\r\n          v-if=\"pattern === 'ccWork' && ccWork.video && ccWork.video.isVideo\"\r\n        />\r\n        <!-- 选择文件 目前只有原生模式和云+支持 -->\r\n        <van-grid-item\r\n          text=\"文件\"\r\n          icon=\"card\"\r\n          @click=\"appendFile\"\r\n          v-if=\"\r\n            (pattern === 'cloudPlus' && cloudPlus.selectFile.isFile) ||\r\n              pattern === 'html'\r\n          \"\r\n        />\r\n      </van-grid>\r\n      <van-row type=\"flex\" justify=\"center\">\r\n        <van-col class=\"attachment-navigation-1 last-navigation\" span=\"24\">\r\n          <div\r\n            v-for=\"(item, index) in uploadFiles\"\r\n            :class=\"{\r\n              'attachment-navigation-item': true,\r\n              'selected-file': selectedFile\r\n                ? item.id === selectedFile.id &&\r\n                  selectedAttachmentId === selectedFile.attachmentId\r\n                : false,\r\n            }\"\r\n            :key=\"index\"\r\n            @touchstart=\"goTouchStart(item)\"\r\n            @click.stop=\"selectFile(item)\"\r\n          >\r\n            <van-image\r\n              :src=\"getAttachmentPathByType(item)\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item && item.name && !item.name.includes('mp4')) || !item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              src=\"/platform/runtime/dfs/images/file.png\"\r\n              class=\"item-img\"\r\n              width=\"80\"\r\n              height=\"80\"\r\n              v-if=\"\r\n                (item &&\r\n                  item.name &&\r\n                  item.name.toLowerCase().includes('mp4')) ||\r\n                  item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n            <div\r\n              class=\"item-icon-delete\"\r\n              @click=\"deleteAttachment(item)\"\r\n              v-if=\"\r\n                selectedFile\r\n                  ? item.id === selectedFile.id &&\r\n                    selectedAttachmentId === selectedFile.attachmentId\r\n                  : false\r\n              \"\r\n            >\r\n              <span class=\"fm-icon fm-icon-close\"></span>\r\n            </div>\r\n          </div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n<style scoped lang=\"scss\">\r\n.attachment {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  & .farris-attachment-img {\r\n    display: flex;\r\n    flex: 1;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  & .img-container {\r\n    text-align: center;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  & video {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.preview-mask {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.farris-attachment {\r\n  clear: both;\r\n\r\n  // 附件组件背景和尺寸\r\n  & .attachment-detail {\r\n    background: #fff;\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n\r\n  // 选中附件样式\r\n  & .selected-file {\r\n    box-shadow: inset 0px 0px 3px 3px #59a1ff;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  & .attachment-navigation-1 {\r\n    overflow: auto;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & img {\r\n      border-radius: 5px;\r\n    }\r\n\r\n    & .item-pdf {\r\n      width: 100%;\r\n      height: 100%;\r\n      background-image: url(\"data:image/png;base64,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\");\r\n      background-size: contain;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: -6px;\r\n      top: -6px;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n      border-radius: 50%;\r\n\r\n      .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .first-navigation {\r\n    max-width: 80%;\r\n  }\r\n\r\n  // 内置前置导航\r\n  & .first-navigation .attachment-navigation-item {\r\n    width: 55px;\r\n    height: 55px;\r\n  }\r\n\r\n  // 后置导航\r\n  & .last-navigation .attachment-navigation-item {\r\n    margin: 6px;\r\n    width: 80px;\r\n    height: 80px;\r\n  }\r\n\r\n  & .attachment-navigation-icon {\r\n    text-align: center;\r\n\r\n    & .add-icon {\r\n      margin: 8px 0;\r\n      width: 55px;\r\n      height: 55px;\r\n    }\r\n  }\r\n\r\n  & .van-grid-item .van-image img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .fixed-bottom {\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n  }\r\n\r\n  & .small-imgs-child {\r\n    width: 80px;\r\n    height: 80px;\r\n    background-size: contain;\r\n  }\r\n\r\n  & .small-imgs-item {\r\n    position: relative;\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .small-imgs-item img {\r\n    border-radius: 5px;\r\n  }\r\n\r\n  & .action-grid {\r\n    position: absolute;\r\n    width: 100%;\r\n    bottom: 100px;\r\n  }\r\n\r\n  & .preview-img img {\r\n    width: auto;\r\n    height: 300px;\r\n  }\r\n\r\n  & .upload-icon {\r\n    position: absolute;\r\n    top: 0.5rem;\r\n    left: 0.5rem;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n  }\r\n\r\n  & .upload-progress {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 5%;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n\r\n  & .van-image-preview .van-swipe-item .van-image {\r\n    position: absolute;\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport {\r\n  Uploader,\r\n  Empty,\r\n  Image,\r\n  Popup,\r\n  Grid,\r\n  GridItem,\r\n  Row,\r\n  Col,\r\n  ImagePreview,\r\n} from \"vant\";\r\nimport { uuid } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment\",\r\n  components: {\r\n    \"van-uploader\": Uploader,\r\n    \"van-empty\": Empty,\r\n    \"van-image\": Image,\r\n    \"van-popup\": Popup,\r\n    \"van-grid\": Grid,\r\n    \"van-grid-item\": GridItem,\r\n    \"van-row\": Row,\r\n    \"van-col\": Col,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: null },\r\n  },\r\n  props: {\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      default:\r\n        \"application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain\",\r\n      // default: 'application/pdf,image/*,application/msword,text/html'\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 自定义进入附件组件的入口\r\n    allowDefaultEntrance: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    // 上传附件信息\r\n    uploadInfo: {\r\n      type: Object,\r\n      default: null,\r\n    },\r\n    // parentDirName\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 上传模式  html ccWork cloudPlus\r\n    pattern: {\r\n      type: String,\r\n      default: \"ccWork\",\r\n    },\r\n    // 云上协同配置\r\n    ccWork: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: \"high\",\r\n            mode: \"camera\",\r\n            mark: \"\",\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            mType: \"0\",\r\n            maxNum: 6,\r\n          },\r\n          video: {\r\n            id: \"af700826-7552-4858-a5e0-e64f5e20288b\",\r\n            quality: 0.8,\r\n            time: 15,\r\n            isVideo: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            mType: \"0\",\r\n            maxNum: 9,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 云+配置\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            isPhoto: true,\r\n          },\r\n          selectFile: {\r\n            maximum: 3,\r\n            fileType: \".jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|.txt\",\r\n            isFile: true,\r\n          },\r\n          album: {\r\n            isAlbum: true,\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n        };\r\n      },\r\n    },\r\n    // 原生模式\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t弹出层显示\r\n\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      videoUrl: \"\",\r\n      selectedAttachmentId: \"\",\r\n      subscription: \"\",\r\n      // 图片尺寸\r\n      imgHeight: 0,\r\n      imhWidth: 0,\r\n      // 尺寸开关\r\n      hasFiles: false,\r\n      // 预览文件尺寸\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      const self = this;\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n          this.$nextTick(() => {\r\n            self.goTouchStart(this.selectedFile);\r\n          });\r\n        }\r\n        if (this.selectedAttachmentId) {\r\n          this.selectedFile = this.rawFiles.find(\r\n            (rawFile) => rawFile.attachmentId === this.selectedAttachmentId\r\n          );\r\n          if (this.selectedFile) {\r\n            // 上传成功后  选中新上传的附件且附件信息同步变更\r\n            this.$nextTick(() => {\r\n              self.goTouchStart(this.selectedFile);\r\n              this.$loading.hide();\r\n            });\r\n          }\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        // 没有url属性的 没有上传\r\n        if (!this.hasFiles) {\r\n          this.$nextTick(() => {\r\n            this.calculateImgSize(80);\r\n            this.hasFiles = true;\r\n          });\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      // 没有url属性的 没有上传\r\n      if (this.hasFiles) {\r\n        this.$nextTick(() => {\r\n          this.calculateImgSize();\r\n          this.hasFiles = false;\r\n        });\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n    // 拍照  选择文件  拍摄短视频等\r\n    gridNumber() {\r\n      if (this.pattern === \"ccWork\") {\r\n        return (\r\n          Number(this.ccWork.photo.isPhoto) +\r\n          Number(this.ccWork.video.isVideo) +\r\n          Number(this.ccWork.album.isAlbum)\r\n        );\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        return (\r\n          Number(this.cloudPlus.photo.isPhoto) +\r\n          Number(this.cloudPlus.selectFile.isFile) +\r\n          Number(this.cloudPlus.album.isAlbum)\r\n        );\r\n      } else {\r\n        // 原生模式\r\n        return 3;\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n  },\r\n  mounted() {\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          console.log(res);\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n    this.$loading.hide();\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"html\") {\r\n        this.$refs.fileUploadRef.chooseFile();\r\n      } else if (this.pattern === \"cloudPlus\") {\r\n        // 选择文件服务\r\n        this.attachmentService.getSysInfo().subscribe((res) => {\r\n          if (res && res.platform === \"Android\") {\r\n            this.attachmentService.selectFile(this.cloudPlus.selectFile);\r\n          } else if (res && res.platform === \"iOS\") {\r\n            this.$refs.fileUploadRef.chooseFile();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 使用h5文件API 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      console.log(file);\r\n      this.$loading.show(\"附件上传中\");\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      if (this.notUploadedFileList.length > this.maxNum) {\r\n        this.$notify.warning(\"最多上传\" + this.maxNum + \"个附件\");\r\n        return;\r\n      }\r\n      // 赋值最新的上传文件附件id\r\n      this.selectedAttachmentId = this.notUploadedFileList[0].id;\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n\r\n    goTouchStart(item) {\r\n      this.selectedFile = item;\r\n      if (\r\n        (this.selectedFile.name &&\r\n          this.selectedFile.name.toLowerCase().includes(\"mp4\")) ||\r\n        this.selectedFile.name.toLowerCase().includes(\"webm\") ||\r\n        this.selectedFile.name.toLowerCase().includes(\"ogg\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          this.selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${this.selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(this.selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n      }\r\n      this.selectedAttachmentId = item.attachmentId;\r\n      this.$emit(\"beforeSelect\", item);\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.selectedFile = item;\r\n\r\n      this.$emit(\"selectChange\", item);\r\n    },\r\n\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 生成预览\r\n     */\r\n    genPreview() {\r\n      if (!this.selectedFile || !this.selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (this.uploadAttachmentService) {\r\n        if (\r\n          this.selectedFile.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0\r\n        ) {\r\n          // 图片预览\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        } else if (this.selectedFile.name.includes(\"pdf\")) {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          // pdf预览\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n          // window.open(`/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`);\r\n        } else if (this.selectedFile.name.includes(\"mp4\")) {\r\n          // this.attachmentService.playShortVideo(\r\n          //   this.videoUrl + \"/\" + this.selectedFile.name\r\n          // );\r\n        } else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.showDoc = false;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n      this.$emit(\"preview\", this.selectedFile);\r\n    },\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    /**\r\n\t\t删除附件\r\n\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.selectedFile = null;\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    /**\r\n     * 拍照\r\n     */\r\n    takePhoto() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.ccWork.photo);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takePhoto(this.cloudPlus.photo);\r\n      }\r\n    },\r\n    selectFromAlbum() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的选择图片服务\r\n        this.attachmentService.selectAttachment(this.ccWork.album);\r\n      } else if (this.pattern === \"cloudPlus\" || this.pattern === \"html\") {\r\n        // 选择文件服务\r\n        this.attachmentService.selectAttachment(this.cloudPlus.album);\r\n      }\r\n    },\r\n    /**\r\n\t\t拍摄短视频\r\n\t\t\t*/\r\n    takeShortVideo() {\r\n      if (this.pattern === \"ccWork\") {\r\n        // 使用第三方提供的拍照服务\r\n        this.attachmentService.takeShortVideo(this.ccWork.video);\r\n      }\r\n    },\r\n\r\n    getVideoFile(file) {\r\n      const fileName = file.name;\r\n      const metadataId = file.url;\r\n      return { fileName, metadataId };\r\n    },\r\n\r\n    calculateImgSize(externalSize = 0) {\r\n      // 计算图片尺寸\r\n      const size = this.$refs.attach.getBoundingClientRect();\r\n      const naviSize = this.$refs.navigation.getBoundingClientRect();\r\n      const imgHeight = size.height - naviSize.height - externalSize;\r\n      if (this.$refs.imgContainer) {\r\n        const imgContainerHeight = this.$refs.imgContainer.getBoundingClientRect()\r\n          .height;\r\n        if (imgContainerHeight > imgHeight) {\r\n          this.imgHeight = imgContainerHeight;\r\n        }\r\n      } else {\r\n        this.imgHeight = imgHeight;\r\n      }\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n",null,null,"<template>\r\n  <div>\r\n    <div class=\"p-md attachment-bg\">\r\n      <div\r\n        class=\"farris-attachment-entry\"\r\n        :class=\"{\r\n          'farris-attachment-entry-vertical': direction === 'vertical',\r\n        }\"\r\n      >\r\n        <van-uploader\r\n          :multiple=\"multiple\"\r\n          ref=\"fileUploadRef\"\r\n          :max-count=\"maxNum\"\r\n          v-model=\"rawFiles\"\r\n          :disabled=\"disabled\"\r\n          :preview-full-image=\"true\"\r\n          :accept=\"accept\"\r\n          :before-read=\"beforeRead\"\r\n          :after-read=\"afterRead\"\r\n          v-show=\"false\"\r\n        />\r\n        <div\r\n          class=\"fm-attachment-container attachment-navigation\"\r\n          v-if=\"direction === 'horizontal'\"\r\n        >\r\n          <div class=\"fm-attachment-files-list\">\r\n            <div\r\n              class=\"fm-attachment-files-item attachment-navigation-item\"\r\n              v-for=\"(item, index) in uploadFiles\"\r\n              :key=\"index\"\r\n              @click.stop=\"downloadAttachment(item)\"\r\n            >\r\n              <van-image\r\n                :src=\"item.content || item.url\"\r\n                class=\"item-img\"\r\n                width=\"100%\"\r\n                height=\"100%\"\r\n                v-if=\"\r\n                  (item && item.name && !item.name.includes('mp4')) ||\r\n                    !item.name\r\n                \"\r\n              />\r\n              <van-image\r\n                :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                class=\"item-img\"\r\n                width=\"48\"\r\n                height=\"48\"\r\n                v-if=\"\r\n                  (item &&\r\n                    item.name &&\r\n                    item.name.toLowerCase().includes('mp4')) ||\r\n                    item.name.toLowerCase().includes('mov')\r\n                \"\r\n              />\r\n              <div\r\n                class=\"item-icon-delete\"\r\n                :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n                @click.stop=\"deleteAttachment(item)\"\r\n                v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n              >\r\n                <span class=\"fm-icon fm-icon-close\"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"fm-attachment-upload-btn-container\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            v-if=\"!removable\"\r\n            @click=\"toUpload\"\r\n          >\r\n            <div class=\"fm-attachment-upload-btn\">\r\n              <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <fm-action-sheet\r\n          v-model:show=\"isSelectAction\"\r\n          :actions=\"actions\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n        >\r\n          <div class=\"attachment-actionsheet-content\">\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableAlbum,\r\n              }\"\r\n              @click=\"selectFileFromAlbum\"\r\n              v-if=\"uploadOptions && uploadOptions.showAlbum\"\r\n            >\r\n              <span class=\"demo-actionsheet-item-text\">从相册选择</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takePhoto\"\r\n              v-if=\"uploadOptions && uploadOptions.showPhoto\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">相机</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takeShortVideo\"\r\n              v-if=\"uploadOptions && uploadOptions.showVideo\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">短视频</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableFile,\r\n              }\"\r\n              @click=\"selectFileFromMobile\"\r\n              v-if=\"uploadOptions && uploadOptions.showFile\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">手机文件</span>\r\n            </div>\r\n          </div>\r\n        </fm-action-sheet>\r\n        <fm-action-sheet\r\n          v-model:show=\"isPreviewAction\"\r\n          :actions=\"previewAction\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n          @select=\"selectAction\"\r\n        >\r\n        </fm-action-sheet>\r\n        <fm-listview\r\n          :listData=\"uploadFiles\"\r\n          :finished=\"true\"\r\n          :showFinishedText=\"false\"\r\n          className=\"listview-content\"\r\n          v-if=\"direction === 'vertical'\"\r\n        >\r\n          <template v-slot:listViewHeader\r\n            ><div style=\"padding:.5rem 0\">\r\n              附件({{ uploadFiles.length\r\n              }}<span v-if=\"allowMaxCount\"\r\n                >/{{ Math.max(uploadFiles.length, maxCount) }}</span\r\n              >)\r\n            </div></template\r\n          >\r\n          <template v-slot=\"props\">\r\n            <div\r\n              class=\"fm-tmpl-listview-attachment\"\r\n              @click.stop=\"openDownloadList(props.item)\"\r\n            >\r\n              <div class=\"fm-tmpl-attachment-img\">\r\n                <van-image\r\n                  :src=\"props.item.content || props.item.url\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      !props.item.name.includes('mp4')) ||\r\n                      !props.item.name\r\n                  \"\r\n                />\r\n                <van-image\r\n                  :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      props.item.name.toLowerCase().includes('mp4')) ||\r\n                      props.item.name.toLowerCase().includes('mov')\r\n                  \"\r\n                />\r\n              </div>\r\n              <div class=\"attachment-text\">\r\n                <div>\r\n                  <div class=\"fm-tmpl-attachment-name\">\r\n                    <span>{{ props.item.name }}</span>\r\n                  </div>\r\n                  <div class=\"attachment-button\">\r\n                    <fm-button\r\n                      className=\"attachment-button-custom\"\r\n                      color=\"#3A90FF\"\r\n                      plain\r\n                      @click.stop=\"genPreview(props.item)\"\r\n                      >预览</fm-button\r\n                    >\r\n                  </div>\r\n                </div>\r\n                <div class=\"fm-tmpl-attachment-footer\">\r\n                  <span class=\"fm-tmpl-attachment-footer-text\">{{\r\n                    transformSize(props.item.size)\r\n                  }}</span>\r\n                  <span>{{ props.item.createTime }}</span>\r\n                </div>\r\n              </div>\r\n              <div\r\n                class=\"attachment-icon\"\r\n                @click.stop=\"deleteAttachment(props.item)\"\r\n                v-if=\"!removable\"\r\n              >\r\n                <fm-icon name=\"s-clear\" color=\"#888\" size=\"16\" />\r\n              </div>\r\n            </div>\r\n          </template>\r\n          <template v-slot:listviewEmpty><span></span></template>\r\n        </fm-listview>\r\n        <div\r\n          class=\"fm-attachment-upload-listview-btn-container\"\r\n          :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n          v-if=\"\r\n            !removable &&\r\n              direction === 'vertical' &&\r\n              ((allowMaxCount && uploadFiles.length < maxCount) ||\r\n                !allowMaxCount)\r\n          \"\r\n          @click=\"toUpload\"\r\n        >\r\n          <div class=\"fm-attachment-upload-btn\">\r\n            <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n          </div>\r\n        </div>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n        </van-popup>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nimport { uuid, UploadOptions } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-file\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      //default:'application/vnd.ms-powerpoint MS PowerPoint Presentation,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword MS Word Document,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel MS Excel Spreadsheet,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf Portable Document Format'\r\n      default:\r\n        \"application/msexcel,\" +\r\n        \"application/msword,\" +\r\n        \"application/vnd.ms-powerpoint,\" +\r\n        // pdf\r\n        \"application/pdf,\" +\r\n        // txt\r\n        \"text/plain,\" +\r\n        // ppt  pptx\r\n        \"application/vnd.openxmlformats-officedocument.presentationml.presentation,\" +\r\n        // xls xlsx\r\n        \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,\" +\r\n        // doc docx\r\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document,\" +\r\n        \"image/jpg,image/gif,image/jpeg,image/png,image/bmp\",\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    maxNum: {\r\n      type: Number,\r\n      default: 9,\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"vertical\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            // isPhoto: true\r\n          },\r\n          album: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n          selectFile: {\r\n            maximum: 5,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          },\r\n        };\r\n      },\r\n    },\r\n    uploadOptions: {\r\n      type: UploadOptions,\r\n      default: () => {\r\n        return {\r\n          showPhoto: true,\r\n          showAlbum: true,\r\n          showVideo: false,\r\n          showFile: true,\r\n          // 照片质量\r\n          photoQuality: 100,\r\n          // 相册图片质量\r\n          albumQuality: 100,\r\n          // 文件上传数量\r\n          fileMaxCount: 6,\r\n          // 短视频id\r\n          videoId: uuid(),\r\n          // 短视频质量\r\n          videoQuality: 0.8,\r\n          // 短视频时间\r\n          videoTime: 30,\r\n        };\r\n      },\r\n    },\r\n    disablePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 禁用\r\n    disableAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableVideo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 隐藏\r\n    hidePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 上传图片的最大数量\r\n    maxCount: {\r\n      type: Number,\r\n      default: 30,\r\n    },\r\n    // 上传图片最大尺寸  默认10M\r\n    maxSize: {\r\n      type: Number,\r\n      default: 20,\r\n    },\r\n    displayMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxSize: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      subscription: \"\",\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      showVideo: false,\r\n      isSelectAction: false,\r\n      isPreviewAction: false,\r\n      docStyle: {},\r\n      actions: [\r\n        { name: \"从相册选择\", disabled: this.albumDisabled },\r\n        { name: \"相机\", disabled: this.photoDisabled },\r\n        { name: \"手机文件\", disabled: this.fileDisabled },\r\n      ],\r\n      previewAction: [{ name: \"在线预览\" }, { name: \"下载\" }],\r\n      navibarDisplay: \"\",\r\n      footerDisplay: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n        }\r\n        if (this.selectedFile) {\r\n          this.$loading.hide();\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    // 处理原生返回\r\n    setTimeout(() => {\r\n      window.top[\"detailBackBtnClickHandler\"] = (backFn) => {\r\n        const pageElem = window.top.document.querySelector(\r\n          \".fm-page-record-deatial\"\r\n        );\r\n        const attachPreviewContainer = pageElem.querySelector(\r\n          \"#fm-attach-preview-container\"\r\n        );\r\n        if (!pageElem || !attachPreviewContainer) {\r\n          return true;\r\n        } else {\r\n          try {\r\n            this.closeScale(window.top.document);\r\n            pageElem.removeChild(attachPreviewContainer);\r\n            return false;\r\n          } catch (e) {\r\n            return true;\r\n          }\r\n        }\r\n      };\r\n    }, 0);\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  },\r\n  methods: {\r\n    openScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    closeScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    transformSize(size) {\r\n      if (size < Math.pow(1024, 2)) {\r\n        return (size / 1024).toFixed(2) + \"KB\";\r\n      } else if (size >= Math.pow(1024, 2) && size < Math.pow(1024, 3)) {\r\n        return (size / Math.pow(1024, 2)).toFixed(2) + \"MB\";\r\n      } else if (size >= Math.pow(1024, 3) && size < Math.pow(1024, 4)) {\r\n        return (size / Math.pow(1024, 3)).toFixed(2) + \"GB\";\r\n      }\r\n    },\r\n    selectAction(res) {\r\n      const actionName = res.name;\r\n      if (actionName === \"在线预览\") {\r\n        this.genPreview(this.selectedFile);\r\n      } else if (actionName === \"下载\") {\r\n        this.downloadAttachment(this.selectedFile);\r\n      }\r\n    },\r\n\r\n    selectFileFromMobile() {\r\n      if (this.disableFile) {\r\n        return;\r\n      }\r\n      this.attachmentService.getSysInfo().subscribe((res) => {\r\n        if (res && res.platform === \"Android\") {\r\n          this.attachmentService.selectFile({\r\n            maximum:\r\n              (this.uploadOptions && this.uploadOptions.fileMaxCount) || 6,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          });\r\n        } else if (res && res.platform === \"iOS\") {\r\n          this.$refs.fileUploadRef.chooseFile();\r\n        }\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    selectFileFromAlbum() {\r\n      if (this.disableAlbum) {\r\n        return;\r\n      }\r\n      this.attachmentService.selectAttachment({\r\n        quality: (this.uploadOptions && this.uploadOptions.albumQuality) || 100,\r\n        encodingType: 1,\r\n        mType: 0,\r\n        // 云+默认最多8张不支持配置  故此属性不作为输入属性\r\n        maxNum: 8,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takePhoto() {\r\n      if (this.disablePhoto) {\r\n        return;\r\n      }\r\n      this.attachmentService.takePhoto({\r\n        quality: (this.uploadOptions && this.uploadOptions.photoQuality) || 100,\r\n        encodingType: 1,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takeShortVideo() {\r\n      this.attachmentService.takeShortVideo({\r\n        id: (this.uploadOptions && this.uploadOptions.videoId) || uuid(),\r\n        quality: 0.8,\r\n        time: (this.uploadOptions && this.uploadOptions.videoTime) || 20,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n    },\r\n\r\n    toUpload() {\r\n      this.isSelectAction = true;\r\n    },\r\n    onCancel() {\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    afterRead(file) {\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // 允许设置最大尺寸\r\n      if (this.allowMaxSize) {\r\n        const beyondLimit = this.notUploadedFileList.some((f) => {\r\n          const realStr = f.content.substring(f.content.indexOf(\",\") + 1);\r\n          const realStrLen = realStr.length;\r\n          // base64转换成字节\r\n          const fSize = parseInt(realStrLen - (realStrLen / 8) * 2);\r\n          return fSize > this.maxSize * Math.pow(1024, 2);\r\n        });\r\n        if (beyondLimit) {\r\n          this.$dialog.alert({\r\n            title: \"上传失败\",\r\n            message: \"上传文件太大，请重新选择！\",\r\n          });\r\n          return;\r\n        }\r\n      }\r\n      //   计算附件上传数量\r\n      if (this.allowMaxCount) {\r\n        if (\r\n          this.notUploadedFileList.length + this.uploadFiles.length >\r\n          this.maxCount\r\n        ) {\r\n          const removedCount =\r\n            this.notUploadedFileList.length +\r\n            this.uploadFiles.length -\r\n            this.maxCount;\r\n          const count = this.notUploadedFileList.length - removedCount;\r\n          this.notUploadedFileList = this.notUploadedFileList.slice(0, count);\r\n        }\r\n      }\r\n      this.$loading.show(\"附件上传中\");\r\n      // 赋值最新的上传文件附件id\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      this.selectedFile = selectedFile;\r\n      // 隐藏工作流工具栏\r\n      //this.hideWorkFlowNavibar();\r\n      if (this.findWorkFlow()) {\r\n        this.previewFileInWorkFlow(\r\n          selectedFile.attachmentId,\r\n          this.rootId,\r\n          selectedFile.name\r\n        );\r\n      } else {\r\n        if (window.top && window.top !== window.self) {\r\n          this.openScale(window.top.document);\r\n        }\r\n        this.openScale(window.document);\r\n        if (\r\n          selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n          selectedFile.name.toLowerCase().includes(\"mov\")\r\n        ) {\r\n          this.show = true;\r\n          this.showPdf = false;\r\n          this.showDoc = false;\r\n          this.showVideo = true;\r\n          const videoUrl = selectedFile.content || selectedFile.url;\r\n          this.attachmentService.playShortVideo(\r\n            videoUrl + \"/\" + selectedFile.name\r\n          );\r\n        }\r\n        else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback(this.closed);\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n\r\n    getAttachmentUrl(attachmentId) {\r\n      var ishttps = \"https:\" == document.location.protocol ? true : false;\r\n      var url = window.location.host;\r\n      if (ishttps) {\r\n        url = \"https://\" + url;\r\n      } else {\r\n        url = \"http://\" + url;\r\n      }\r\n      url += this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n      return url;\r\n    },\r\n    downloadAttachment(attachment) {\r\n      const attachmentName = attachment.name;\r\n      const attachmentUrl = this.getAttachmentUrl(attachment.attachmentId);\r\n      const options = {\r\n        url: attachmentUrl,\r\n        saveName: attachmentName,\r\n        // autoOpen,\r\n      };\r\n      this.attachmentService.downloadAttachment(options).subscribe((res) => {});\r\n    },\r\n    closed() {\r\n      if (window.top && window.top !== window.self) {\r\n        this.closeScale(window.top.document);\r\n      }\r\n      this.closeScale(window.document);\r\n      // 隐藏工作流头部工具栏\r\n      //this.displayWorkFlowNavibar();\r\n      this.show = false;\r\n      this.showPdf = false;\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback();\r\n      }\r\n    },\r\n    hideWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        this.navibarDisplay = window.top.getComputedStyle(\r\n          workFlowNavibar\r\n        ).display;\r\n        workFlowNavibar.style.display = \"none\";\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        this.footerDisplay = window.top.getComputedStyle(\r\n          workFlowFooter\r\n        ).display;\r\n        workFlowFooter.style.display = \"none\";\r\n      }\r\n    },\r\n    displayWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        workFlowNavibar.style.display = this.navibarDisplay;\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        workFlowFooter.style.display = this.footerDisplay;\r\n      }\r\n    },\r\n\r\n    findWorkFlow() {\r\n      if (window.top === window.self) {\r\n        return false;\r\n      }\r\n      const isWorkFlow = window.top.location.href.includes(\r\n        \"/platform/runtime/wf/webapp/\"\r\n      );\r\n      return isWorkFlow;\r\n    },\r\n\r\n    /**\r\n     * 预览附件\r\n     */\r\n    previewFileInWorkFlow(attachId, rootId, fileName) {\r\n      // 打开缩放\r\n      this.openScale(window.top.document);\r\n\r\n      fileName = fileName || \"附件预览\";\r\n      const previewUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${attachId}&rootId=${rootId}&fileType=2`;\r\n      const previewHtml = `\r\n              <div class=\"fm-file-preview\">\r\n\r\n              <div class=\"fm-file-preview-header\">\r\n                <nav class=\"fm-navbar\">\r\n                    <div id=\"fm-attach-preview-back-btn\" class=\"fm-navbar-left fm-navbar-left-padding\">\r\n                        <span class=\"fm-navbar-left-arrow fm-icon fm-icon-arrow-chevron-left\"></span>\r\n                    </div>\r\n                    <div class=\"fm-navbar-title\">${fileName}</div>\r\n                </nav>\r\n              </div>\r\n                <div class=\"fm-file-preview-content\">\r\n                  <div class=\"preview-content\">\r\n                    <iframe src=\"${previewUrl}\"></iframe>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            `;\r\n\r\n      const pageElem = window.top.document.querySelector(\r\n        \".fm-page-record-deatial\"\r\n      );\r\n\r\n      // 预览容器\r\n      const previewContainerElem = document.createElement(\"div\");\r\n      previewContainerElem.id = \"fm-attach-preview-container\";\r\n      previewContainerElem.classList.add(\"fm-attach-preview-container\");\r\n      previewContainerElem.innerHTML = previewHtml;\r\n\r\n      // 返回按钮处理\r\n      const backBtn = previewContainerElem.querySelector(\"div.fm-navbar-left\");\r\n      backBtn.addEventListener(\"click\", () => {\r\n        this.closeScale(window.top.document);\r\n        pageElem.removeChild(previewContainerElem);\r\n      });\r\n\r\n      pageElem.appendChild(previewContainerElem);\r\n    },\r\n    openDownloadList(item) {\r\n      this.isPreviewAction = true;\r\n      this.selectedFile = item;\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.attachment-actionsheet-item-disabled {\r\n  color: #ccc;\r\n}\r\n.attachment-actionsheet-content {\r\n  flex: 1 auto;\r\n  overflow-y: auto;\r\n  .attachment-actionsheet-item {\r\n    display: block;\r\n    width: 100%;\r\n    padding: 14px 16px;\r\n    font-size: 16px;\r\n    text-align: center;\r\n    background-color: #fff;\r\n    border: none;\r\n    cursor: pointer;\r\n    text-align: center;\r\n  }\r\n}\r\n.attachment-bg {\r\n  background: #fff;\r\n}\r\n.listview-content {\r\n  .fm-listview-item {\r\n    margin: 12px 0;\r\n  }\r\n  .fm-tmpl-attachment-img {\r\n    width: 48px;\r\n    height: 48px;\r\n    margin: auto 0;\r\n    .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    img {\r\n      border-radius: 3px;\r\n      width: 48px;\r\n      height: 48px;\r\n    }\r\n  }\r\n  .attachment-text {\r\n    flex: 1;\r\n    margin: auto 12px;\r\n    & > div {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 5px;\r\n    }\r\n  }\r\n  .fm-tmpl-attachment-name {\r\n    line-height: 22px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 16px;\r\n    color: #333333;\r\n    letter-spacing: 0.21px;\r\n    margin-bottom: 2px;\r\n    word-break: break-all;\r\n  }\r\n  .fm-tmpl-attachment-footer {\r\n    line-height: 18px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 12px;\r\n    color: #888888;\r\n    letter-spacing: 0;\r\n  }\r\n  .fm-tmpl-listview-attachment {\r\n    padding: 0;\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n  .attachment-button {\r\n    .attachment-button-custom {\r\n      padding: 0;\r\n      width: 50px;\r\n      height: 20px;\r\n      font-family: PingFangSC-Regular;\r\n      font-size: 12px;\r\n      letter-spacing: 0;\r\n      border-radius: 10px;\r\n    }\r\n  }\r\n  .attachment-icon {\r\n    margin: auto 0;\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <div class=\"p-md attachment-bg\">\r\n      <div\r\n        class=\"farris-attachment-entry\"\r\n        :class=\"{\r\n          'farris-attachment-entry-vertical': direction === 'vertical',\r\n        }\"\r\n      >\r\n        <van-uploader\r\n          :multiple=\"multiple\"\r\n          ref=\"fileUploadRef\"\r\n          :max-count=\"maxNum\"\r\n          v-model=\"rawFiles\"\r\n          :disabled=\"disabled\"\r\n          :preview-full-image=\"true\"\r\n          :accept=\"accept\"\r\n          :before-read=\"beforeRead\"\r\n          :after-read=\"afterRead\"\r\n          v-show=\"false\"\r\n        />\r\n        <div\r\n          class=\"fm-attachment-container attachment-navigation\"\r\n          v-if=\"direction === 'horizontal'\"\r\n        >\r\n          <div class=\"fm-attachment-files-list\">\r\n            <div\r\n              class=\"fm-attachment-files-item attachment-navigation-item\"\r\n              v-for=\"(item, index) in uploadFiles\"\r\n              :key=\"index\"\r\n              @click.stop=\"downloadAttachment(item)\"\r\n            >\r\n              <van-image\r\n                :src=\"item.content || item.url\"\r\n                class=\"item-img\"\r\n                width=\"100%\"\r\n                height=\"100%\"\r\n                v-if=\"\r\n                  (item && item.name && !item.name.includes('mp4')) ||\r\n                    !item.name\r\n                \"\r\n              />\r\n              <van-image\r\n                :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                class=\"item-img\"\r\n                width=\"48\"\r\n                height=\"48\"\r\n                v-if=\"\r\n                  (item &&\r\n                    item.name &&\r\n                    item.name.toLowerCase().includes('mp4')) ||\r\n                    item.name.toLowerCase().includes('mov')\r\n                \"\r\n              />\r\n              <div\r\n                class=\"item-icon-delete\"\r\n                :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n                @click.stop=\"deleteAttachment(item)\"\r\n                v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n              >\r\n                <span class=\"fm-icon fm-icon-close\"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"fm-attachment-upload-btn-container\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            v-if=\"!removable\"\r\n            @click=\"toUpload\"\r\n          >\r\n            <div class=\"fm-attachment-upload-btn\">\r\n              <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <fm-action-sheet\r\n          v-model:show=\"isSelectAction\"\r\n          :actions=\"actions\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n        >\r\n          <div class=\"attachment-actionsheet-content\">\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableAlbum,\r\n              }\"\r\n              @click=\"selectFileFromAlbum\"\r\n              v-if=\"uploadOptions && uploadOptions.showAlbum\"\r\n            >\r\n              <span class=\"demo-actionsheet-item-text\">从相册选择</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takePhoto\"\r\n              v-if=\"uploadOptions && uploadOptions.showPhoto\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">相机</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disablePhoto,\r\n              }\"\r\n              @click=\"takeShortVideo\"\r\n              v-if=\"uploadOptions && uploadOptions.showVideo\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">短视频</span>\r\n            </div>\r\n            <div\r\n              class=\"attachment-actionsheet-item\"\r\n              :class=\"{\r\n                'attachment-actionsheet-item-disabled': disableFile,\r\n              }\"\r\n              @click=\"selectFileFromMobile\"\r\n              v-if=\"uploadOptions && uploadOptions.showFile\"\r\n            >\r\n              <span class=\"attachment-actionsheet-item-text\">手机文件</span>\r\n            </div>\r\n          </div>\r\n        </fm-action-sheet>\r\n        <fm-action-sheet\r\n          v-model:show=\"isPreviewAction\"\r\n          :actions=\"previewAction\"\r\n          cancel-text=\"取消\"\r\n          close-on-click-action\r\n          @select=\"selectAction\"\r\n        >\r\n        </fm-action-sheet>\r\n        <fm-listview\r\n          :listData=\"uploadFiles\"\r\n          :finished=\"true\"\r\n          :showFinishedText=\"false\"\r\n          className=\"listview-content\"\r\n          v-if=\"direction === 'vertical'\"\r\n        >\r\n          <template v-slot:listViewHeader\r\n            ><div style=\"padding:.5rem 0\">\r\n              附件({{ uploadFiles.length\r\n              }}<span v-if=\"allowMaxCount\"\r\n                >/{{ Math.max(uploadFiles.length, maxCount) }}</span\r\n              >)\r\n            </div></template\r\n          >\r\n          <template v-slot=\"props\">\r\n            <div\r\n              class=\"fm-tmpl-listview-attachment\"\r\n              @click.stop=\"openDownloadList(props.item)\"\r\n            >\r\n              <div class=\"fm-tmpl-attachment-img\">\r\n                <van-image\r\n                  :src=\"props.item.content || props.item.url\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      !props.item.name.includes('mp4')) ||\r\n                      !props.item.name\r\n                  \"\r\n                />\r\n                <van-image\r\n                  :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n                  class=\"item-img\"\r\n                  v-if=\"\r\n                    (props.item &&\r\n                      props.item.name &&\r\n                      props.item.name.toLowerCase().includes('mp4')) ||\r\n                      props.item.name.toLowerCase().includes('mov')\r\n                  \"\r\n                />\r\n              </div>\r\n              <div class=\"attachment-text\">\r\n                <div>\r\n                  <div class=\"fm-tmpl-attachment-name\">\r\n                    <span>{{ props.item.name }}</span>\r\n                  </div>\r\n                  <div class=\"attachment-button\">\r\n                    <fm-button\r\n                      className=\"attachment-button-custom\"\r\n                      color=\"#3A90FF\"\r\n                      plain\r\n                      @click.stop=\"genPreview(props.item)\"\r\n                      >预览</fm-button\r\n                    >\r\n                  </div>\r\n                </div>\r\n                <div class=\"fm-tmpl-attachment-footer\">\r\n                  <span class=\"fm-tmpl-attachment-footer-text\">{{\r\n                    transformSize(props.item.size)\r\n                  }}</span>\r\n                  <span>{{ props.item.createTime }}</span>\r\n                </div>\r\n              </div>\r\n              <div\r\n                class=\"attachment-icon\"\r\n                @click.stop=\"deleteAttachment(props.item)\"\r\n                v-if=\"!removable\"\r\n              >\r\n                <fm-icon name=\"s-clear\" color=\"#888\" size=\"16\" />\r\n              </div>\r\n            </div>\r\n          </template>\r\n          <template v-slot:listviewEmpty><span></span></template>\r\n        </fm-listview>\r\n        <div\r\n          class=\"fm-attachment-upload-listview-btn-container\"\r\n          :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n          v-if=\"\r\n            !removable &&\r\n              direction === 'vertical' &&\r\n              ((allowMaxCount && uploadFiles.length < maxCount) ||\r\n                !allowMaxCount)\r\n          \"\r\n          @click=\"toUpload\"\r\n        >\r\n          <div class=\"fm-attachment-upload-btn\">\r\n            <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n          </div>\r\n        </div>\r\n        <van-popup\r\n          v-model:show=\"show\"\r\n          :style=\"{ height: '100%', width: '100%' }\"\r\n        >\r\n          <fm-navbar\r\n            :title=\"selectedFile && selectedFile.name\"\r\n            @click-left=\"closed\"\r\n          >\r\n            <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template>\r\n          </fm-navbar>\r\n          <iframe\r\n            class=\"pdf-iframe\"\r\n            scrolling=\"yes\"\r\n            :src=\"pdfUrl\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"showPdf\"\r\n          >\r\n          </iframe>\r\n        </van-popup>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nimport { uuid, UploadOptions } from \"./service\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-file\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      //default:'application/vnd.ms-powerpoint MS PowerPoint Presentation,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword MS Word Document,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel MS Excel Spreadsheet,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf Portable Document Format'\r\n      default:\r\n        \"application/msexcel,\" +\r\n        \"application/msword,\" +\r\n        \"application/vnd.ms-powerpoint,\" +\r\n        // pdf\r\n        \"application/pdf,\" +\r\n        // txt\r\n        \"text/plain,\" +\r\n        // ppt  pptx\r\n        \"application/vnd.openxmlformats-officedocument.presentationml.presentation,\" +\r\n        // xls xlsx\r\n        \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,\" +\r\n        // doc docx\r\n        \"application/vnd.openxmlformats-officedocument.wordprocessingml.document,\" +\r\n        \"image/jpg,image/gif,image/jpeg,image/png,image/bmp\",\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    maxNum: {\r\n      type: Number,\r\n      default: 9,\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"vertical\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    cloudPlus: {\r\n      type: Object,\r\n      default: () => {\r\n        return {\r\n          photo: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 602,\r\n            targetHeight: 600,\r\n            // isPhoto: true\r\n          },\r\n          album: {\r\n            quality: 60,\r\n            encodingType: 1,\r\n            targetWidth: 600,\r\n            targetHeight: 600,\r\n          },\r\n          selectFile: {\r\n            maximum: 5,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          },\r\n        };\r\n      },\r\n    },\r\n    uploadOptions: {\r\n      type: UploadOptions,\r\n      default: () => {\r\n        return {\r\n          showPhoto: true,\r\n          showAlbum: true,\r\n          showVideo: false,\r\n          showFile: true,\r\n          // 照片质量\r\n          photoQuality: 100,\r\n          // 相册图片质量\r\n          albumQuality: 100,\r\n          // 文件上传数量\r\n          fileMaxCount: 6,\r\n          // 短视频id\r\n          videoId: uuid(),\r\n          // 短视频质量\r\n          videoQuality: 0.8,\r\n          // 短视频时间\r\n          videoTime: 30,\r\n        };\r\n      },\r\n    },\r\n    disablePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 禁用\r\n    disableAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disableVideo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 隐藏\r\n    hidePhoto: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideAlbum: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    hideFile: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 上传图片的最大数量\r\n    maxCount: {\r\n      type: Number,\r\n      default: 30,\r\n    },\r\n    // 上传图片最大尺寸  默认10M\r\n    maxSize: {\r\n      type: Number,\r\n      default: 20,\r\n    },\r\n    displayMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxSize: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    allowMaxCount: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      subscription: \"\",\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showDoc: false,\r\n      showVideo: false,\r\n      isSelectAction: false,\r\n      isPreviewAction: false,\r\n      docStyle: {},\r\n      actions: [\r\n        { name: \"从相册选择\", disabled: this.albumDisabled },\r\n        { name: \"相机\", disabled: this.photoDisabled },\r\n        { name: \"手机文件\", disabled: this.fileDisabled },\r\n      ],\r\n      previewAction: [{ name: \"在线预览\" }, { name: \"下载\" }],\r\n      navibarDisplay: \"\",\r\n      footerDisplay: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        if (\r\n          !this.selectedFile ||\r\n          !this.rawFiles.find((f) => f.id === this.selectedFile.id)\r\n        ) {\r\n          this.selectedFile = this.rawFiles[0];\r\n        }\r\n        if (this.selectedFile) {\r\n          this.$loading.hide();\r\n        }\r\n        if (!this.selectedFile) {\r\n          // 删除的附件\r\n          this.selectedFile = this.rawFiles[this.rawFiles.length - 1];\r\n        }\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    // 处理原生返回\r\n    setTimeout(() => {\r\n      window.top[\"detailBackBtnClickHandler\"] = (backFn) => {\r\n        const pageElem = window.top.document.querySelector(\r\n          \".fm-page-record-deatial\"\r\n        );\r\n        const attachPreviewContainer = pageElem.querySelector(\r\n          \"#fm-attach-preview-container\"\r\n        );\r\n        if (!pageElem || !attachPreviewContainer) {\r\n          return true;\r\n        } else {\r\n          try {\r\n            this.closeScale(window.top.document);\r\n            pageElem.removeChild(attachPreviewContainer);\r\n            return false;\r\n          } catch (e) {\r\n            return true;\r\n          }\r\n        }\r\n      };\r\n    }, 0);\r\n    // 不同设备选择文件\r\n    if (this.attachmentService) {\r\n      this.subscription = this.attachmentService.collectFile.subscribe(\r\n        (res) => {\r\n          if (\r\n            Object.prototype.toString.call(res) === \"[object Array]\" &&\r\n            res.length === 0\r\n          ) {\r\n            return;\r\n          }\r\n          this.rawFiles = [...this.rawFiles, ...res];\r\n          this.afterRead(res);\r\n        }\r\n      );\r\n    }\r\n  },\r\n  unmounted() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  },\r\n  methods: {\r\n    openScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    closeScale(currentDoc) {\r\n      const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n      const meta = currentDoc.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n\";\r\n      const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n    },\r\n    transformSize(size) {\r\n      if (size < Math.pow(1024, 2)) {\r\n        return (size / 1024).toFixed(2) + \"KB\";\r\n      } else if (size >= Math.pow(1024, 2) && size < Math.pow(1024, 3)) {\r\n        return (size / Math.pow(1024, 2)).toFixed(2) + \"MB\";\r\n      } else if (size >= Math.pow(1024, 3) && size < Math.pow(1024, 4)) {\r\n        return (size / Math.pow(1024, 3)).toFixed(2) + \"GB\";\r\n      }\r\n    },\r\n    selectAction(res) {\r\n      const actionName = res.name;\r\n      if (actionName === \"在线预览\") {\r\n        this.genPreview(this.selectedFile);\r\n      } else if (actionName === \"下载\") {\r\n        this.downloadAttachment(this.selectedFile);\r\n      }\r\n    },\r\n\r\n    selectFileFromMobile() {\r\n      if (this.disableFile) {\r\n        return;\r\n      }\r\n      this.attachmentService.getSysInfo().subscribe((res) => {\r\n        if (res && res.platform === \"Android\") {\r\n          this.attachmentService.selectFile({\r\n            maximum:\r\n              (this.uploadOptions && this.uploadOptions.fileMaxCount) || 6,\r\n            fileType:\r\n              \".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX\",\r\n          });\r\n        } else if (res && res.platform === \"iOS\") {\r\n          this.$refs.fileUploadRef.chooseFile();\r\n        }\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    selectFileFromAlbum() {\r\n      if (this.disableAlbum) {\r\n        return;\r\n      }\r\n      this.attachmentService.selectAttachment({\r\n        quality: (this.uploadOptions && this.uploadOptions.albumQuality) || 100,\r\n        encodingType: 1,\r\n        mType: 0,\r\n        // 云+默认最多8张不支持配置  故此属性不作为输入属性\r\n        maxNum: 8,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takePhoto() {\r\n      if (this.disablePhoto) {\r\n        return;\r\n      }\r\n      this.attachmentService.takePhoto({\r\n        quality: (this.uploadOptions && this.uploadOptions.photoQuality) || 100,\r\n        encodingType: 1,\r\n        targetWidth: this.uploadOptions.targetWidth || 1000,\r\n        targetHeight: this.uploadOptions.targetHeight || 1000,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    takeShortVideo() {\r\n      this.attachmentService.takeShortVideo({\r\n        id: (this.uploadOptions && this.uploadOptions.videoId) || uuid(),\r\n        quality: 0.8,\r\n        time: (this.uploadOptions && this.uploadOptions.videoTime) || 20,\r\n      });\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n    },\r\n\r\n    toUpload() {\r\n      this.isSelectAction = true;\r\n    },\r\n    onCancel() {\r\n      this.isSelectAction = false;\r\n    },\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    afterRead(file) {\r\n      if (file && file.length) {\r\n        this.notUploadedFileList = file.map((fileItem) => {\r\n          fileItem.id = uuid();\r\n          return fileItem;\r\n        });\r\n      } else {\r\n        file.id = uuid();\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // 允许设置最大尺寸\r\n      if (this.allowMaxSize) {\r\n        const beyondLimit = this.notUploadedFileList.some((f) => {\r\n          const realStr = f.content.substring(f.content.indexOf(\",\") + 1);\r\n          const realStrLen = realStr.length;\r\n          // base64转换成字节\r\n          const fSize = parseInt(realStrLen - (realStrLen / 8) * 2);\r\n          return fSize > this.maxSize * Math.pow(1024, 2);\r\n        });\r\n        if (beyondLimit) {\r\n          this.$dialog.alert({\r\n            title: \"上传失败\",\r\n            message: \"上传文件太大，请重新选择！\",\r\n          });\r\n          return;\r\n        }\r\n      }\r\n      //   计算附件上传数量\r\n      if (this.allowMaxCount) {\r\n        if (\r\n          this.notUploadedFileList.length + this.uploadFiles.length >\r\n          this.maxCount\r\n        ) {\r\n          const removedCount =\r\n            this.notUploadedFileList.length +\r\n            this.uploadFiles.length -\r\n            this.maxCount;\r\n          const count = this.notUploadedFileList.length - removedCount;\r\n          this.notUploadedFileList = this.notUploadedFileList.slice(0, count);\r\n        }\r\n      }\r\n      this.$loading.show(\"附件上传中\");\r\n      // 赋值最新的上传文件附件id\r\n      if (this.uploadAttachmentService) {\r\n        // 固定的服务  缓存附件到服务器\r\n        if (file.type === \"video/mp4\") {\r\n          this.videoUrl = file.url.substring(0, file.url.lastIndexOf(\"/\"));\r\n          this.uploadAttachmentService\r\n            .upload([file], {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = {\r\n                fileName: file.file.name,\r\n                metadataId: file.id,\r\n              };\r\n              this.$emit(\"afterAppendFile\", [list]);\r\n            });\r\n        } else {\r\n          this.uploadAttachmentService\r\n            .upload(this.notUploadedFileList, {\r\n              parentDirName: this.parentDirName,\r\n              rootId: this.rootId,\r\n            })\r\n            .subscribe((res) => {\r\n              const list = this.notUploadedFileList.map((l) => {\r\n                return {\r\n                  fileName: l.file.name,\r\n                  metadataId: l.id,\r\n                };\r\n              });\r\n              this.$emit(\"afterAppendFile\", list);\r\n            });\r\n        }\r\n      } else {\r\n        // h5 添加文件后事件\r\n        const list = this.notUploadedFileList.map((l) => {\r\n          return {\r\n            fileName: l.file.name,\r\n            metadataId: l.id,\r\n          };\r\n        });\r\n        this.$emit(\"afterAppendFile\", list);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      this.selectedFile = selectedFile;\r\n      // 隐藏工作流工具栏\r\n      //this.hideWorkFlowNavibar();\r\n      if (this.findWorkFlow()) {\r\n        this.previewFileInWorkFlow(\r\n          selectedFile.attachmentId,\r\n          this.rootId,\r\n          selectedFile.name\r\n        );\r\n      } else {\r\n        if (window.top && window.top !== window.self) {\r\n          this.openScale(window.top.document);\r\n        }\r\n        this.openScale(window.document);\r\n        if (\r\n          selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n          selectedFile.name.toLowerCase().includes(\"mov\")\r\n        ) {\r\n          this.show = true;\r\n          this.showPdf = false;\r\n          this.showDoc = false;\r\n          this.showVideo = true;\r\n          const videoUrl = selectedFile.content || selectedFile.url;\r\n          this.attachmentService.playShortVideo(\r\n            videoUrl + \"/\" + selectedFile.name\r\n          );\r\n        }\r\n        else {\r\n          this.show = true;\r\n          this.showPdf = true;\r\n          this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n        }\r\n      }\r\n\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback(this.closed);\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n\r\n    getAttachmentUrl(attachmentId) {\r\n      var ishttps = \"https:\" == document.location.protocol ? true : false;\r\n      var url = window.location.host;\r\n      if (ishttps) {\r\n        url = \"https://\" + url;\r\n      } else {\r\n        url = \"http://\" + url;\r\n      }\r\n      url += this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n      return url;\r\n    },\r\n    downloadAttachment(attachment) {\r\n      const attachmentName = attachment.name;\r\n      const attachmentUrl = this.getAttachmentUrl(attachment.attachmentId);\r\n      const options = {\r\n        url: attachmentUrl,\r\n        saveName: attachmentName,\r\n        // autoOpen,\r\n      };\r\n      this.attachmentService.downloadAttachment(options).subscribe((res) => {});\r\n    },\r\n    closed() {\r\n      if (window.top && window.top !== window.self) {\r\n        this.closeScale(window.top.document);\r\n      }\r\n      this.closeScale(window.document);\r\n      // 隐藏工作流头部工具栏\r\n      //this.displayWorkFlowNavibar();\r\n      this.show = false;\r\n      this.showPdf = false;\r\n      if (\r\n        window[\"MOBILE_ORIGIN_BACK\"] &&\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback\r\n      ) {\r\n        window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback();\r\n      }\r\n    },\r\n    hideWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        this.navibarDisplay = window.top.getComputedStyle(\r\n          workFlowNavibar\r\n        ).display;\r\n        workFlowNavibar.style.display = \"none\";\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        this.footerDisplay = window.top.getComputedStyle(\r\n          workFlowFooter\r\n        ).display;\r\n        workFlowFooter.style.display = \"none\";\r\n      }\r\n    },\r\n    displayWorkFlowNavibar() {\r\n      const findWorkFlow = this.findWorkFlow();\r\n      if (!findWorkFlow) {\r\n        return;\r\n      }\r\n      const workFlowNavibar = window.top.document.querySelector(\r\n        \"fmapprove-navbar\"\r\n      );\r\n      if (workFlowNavibar) {\r\n        workFlowNavibar.style.display = this.navibarDisplay;\r\n      }\r\n      const workFlowFooter = window.top.document.querySelector(\r\n        \"div.fm-page-footer\"\r\n      );\r\n      if (workFlowFooter) {\r\n        workFlowFooter.style.display = this.footerDisplay;\r\n      }\r\n    },\r\n\r\n    findWorkFlow() {\r\n      if (window.top === window.self) {\r\n        return false;\r\n      }\r\n      const isWorkFlow = window.top.location.href.includes(\r\n        \"/platform/runtime/wf/webapp/\"\r\n      );\r\n      return isWorkFlow;\r\n    },\r\n\r\n    /**\r\n     * 预览附件\r\n     */\r\n    previewFileInWorkFlow(attachId, rootId, fileName) {\r\n      // 打开缩放\r\n      this.openScale(window.top.document);\r\n\r\n      fileName = fileName || \"附件预览\";\r\n      const previewUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${attachId}&rootId=${rootId}&fileType=2`;\r\n      const previewHtml = `\r\n              <div class=\"fm-file-preview\">\r\n\r\n              <div class=\"fm-file-preview-header\">\r\n                <nav class=\"fm-navbar\">\r\n                    <div id=\"fm-attach-preview-back-btn\" class=\"fm-navbar-left fm-navbar-left-padding\">\r\n                        <span class=\"fm-navbar-left-arrow fm-icon fm-icon-arrow-chevron-left\"></span>\r\n                    </div>\r\n                    <div class=\"fm-navbar-title\">${fileName}</div>\r\n                </nav>\r\n              </div>\r\n                <div class=\"fm-file-preview-content\">\r\n                  <div class=\"preview-content\">\r\n                    <iframe src=\"${previewUrl}\"></iframe>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            `;\r\n\r\n      const pageElem = window.top.document.querySelector(\r\n        \".fm-page-record-deatial\"\r\n      );\r\n\r\n      // 预览容器\r\n      const previewContainerElem = document.createElement(\"div\");\r\n      previewContainerElem.id = \"fm-attach-preview-container\";\r\n      previewContainerElem.classList.add(\"fm-attach-preview-container\");\r\n      previewContainerElem.innerHTML = previewHtml;\r\n\r\n      // 返回按钮处理\r\n      const backBtn = previewContainerElem.querySelector(\"div.fm-navbar-left\");\r\n      backBtn.addEventListener(\"click\", () => {\r\n        this.closeScale(window.top.document);\r\n        pageElem.removeChild(previewContainerElem);\r\n      });\r\n\r\n      pageElem.appendChild(previewContainerElem);\r\n    },\r\n    openDownloadList(item) {\r\n      this.isPreviewAction = true;\r\n      this.selectedFile = item;\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.attachment-actionsheet-item-disabled {\r\n  color: #ccc;\r\n}\r\n.attachment-actionsheet-content {\r\n  flex: 1 auto;\r\n  overflow-y: auto;\r\n  .attachment-actionsheet-item {\r\n    display: block;\r\n    width: 100%;\r\n    padding: 14px 16px;\r\n    font-size: 16px;\r\n    text-align: center;\r\n    background-color: #fff;\r\n    border: none;\r\n    cursor: pointer;\r\n    text-align: center;\r\n  }\r\n}\r\n.attachment-bg {\r\n  background: #fff;\r\n}\r\n.listview-content {\r\n  .fm-listview-item {\r\n    margin: 12px 0;\r\n  }\r\n  .fm-tmpl-attachment-img {\r\n    width: 48px;\r\n    height: 48px;\r\n    margin: auto 0;\r\n    .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    img {\r\n      border-radius: 3px;\r\n      width: 48px;\r\n      height: 48px;\r\n    }\r\n  }\r\n  .attachment-text {\r\n    flex: 1;\r\n    margin: auto 12px;\r\n    & > div {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 5px;\r\n    }\r\n  }\r\n  .fm-tmpl-attachment-name {\r\n    line-height: 22px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 16px;\r\n    color: #333333;\r\n    letter-spacing: 0.21px;\r\n    margin-bottom: 2px;\r\n    word-break: break-all;\r\n  }\r\n  .fm-tmpl-attachment-footer {\r\n    line-height: 18px;\r\n    font-family: PingFangSC-Regular;\r\n    font-size: 12px;\r\n    color: #888888;\r\n    letter-spacing: 0;\r\n  }\r\n  .fm-tmpl-listview-attachment {\r\n    padding: 0;\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n  .attachment-button {\r\n    .attachment-button-custom {\r\n      padding: 0;\r\n      width: 50px;\r\n      height: 20px;\r\n      font-family: PingFangSC-Regular;\r\n      font-size: 12px;\r\n      letter-spacing: 0;\r\n      border-radius: 10px;\r\n    }\r\n  }\r\n  .attachment-icon {\r\n    margin: auto 0;\r\n    width: 16px;\r\n    height: 16px;\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n",null,"<template>\r\n  <div\r\n    class=\"farris-attachment-entry\"\r\n    :class=\"{ 'farris-attachment-entry-vertical': direction === 'vertical' }\"\r\n  >\r\n    <div\r\n      class=\"fm-attachment-container attachment-navigation\"\r\n      v-if=\"direction === 'horizontal'\"\r\n    >\r\n      <div class=\"fm-attachment-files-list\">\r\n        <div\r\n          class=\"fm-attachment-files-item attachment-navigation-item\"\r\n          v-for=\"(item, index) in uploadFiles\"\r\n          :key=\"index\"\r\n          @click=\"selectFile(item)\"\r\n        >\r\n          <van-image\r\n            :src=\"getAttachmentPathByType(item)\"\r\n            class=\"item-img\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"\r\n              (item && item.name && !item.name.includes('mp4')) || !item.name\r\n            \"\r\n          />\r\n          <van-image\r\n            :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n            class=\"item-img\"\r\n            width=\"48\"\r\n            height=\"48\"\r\n            v-if=\"\r\n              (item && item.name && item.name.toLowerCase().includes('mp4')) ||\r\n                item.name.toLowerCase().includes('mov')\r\n            \"\r\n          />\r\n          <div\r\n            class=\"item-icon-delete\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            @click.stop=\"deleteAttachment(item)\"\r\n            v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n          >\r\n            <span class=\"fm-icon fm-icon-close\"></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div\r\n        class=\"fm-attachment-upload-btn-container\"\r\n        :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n        v-if=\"!removable\"\r\n        @click=\"toUpload\"\r\n      >\r\n        <div class=\"fm-attachment-upload-btn\">\r\n          <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <fm-listview\r\n      :listData=\"uploadFiles\"\r\n      :finished=\"true\"\r\n      :showFinishedText=\"false\"\r\n      v-if=\"direction === 'vertical'\"\r\n    >\r\n      <template v-slot:listViewHeader> </template>\r\n      <template v-slot=\"props\">\r\n        <div class=\"fm-tmpl-listview-goods\">\r\n          <div class=\"fm-tmpl-goods-img\" @click=\"selectFile(props.item)\">\r\n            <van-image\r\n              :src=\"props.item.content || props.item.url\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  !props.item.name.includes('mp4')) ||\r\n                  !props.item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  props.item.name.toLowerCase().includes('mp4')) ||\r\n                  props.item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n          </div>\r\n          <div>\r\n            <div class=\"fm-tmpl-goods-name\">\r\n              <span>{{ props.item.name }}</span>\r\n              <!-- <div class=\"fm-tmpl-goods-add\">\r\n\t\t\t\t\t\t\t\t可以添加下载\r\n\t\t\t\t\t\t\t\t<span class=\"fm-icon fm-icon-print\"></span>\r\n\t\t\t\t\t\t\t</div> -->\r\n            </div>\r\n            <!-- <div class=\"fm-tmpl-goods-price\">\r\n\t\t\t\t\t\t\t<span class=\"fm-tmpl-goods-price-text\">已上传</span>\r\n\t\t\t\t\t\t</div> -->\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </fm-listview>\r\n    <div\r\n      class=\"fm-attachment-upload-listview-btn-container\"\r\n      :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n      v-if=\"!removable && direction === 'vertical'\"\r\n      @click=\"toUpload\"\r\n    >\r\n      <div class=\"fm-attachment-upload-btn\">\r\n        <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-model:show=\"show\"\r\n      closeable\r\n      @closed=\"closed\"\r\n      :style=\"{ height: '100%', width: '100%' }\"\r\n    >\r\n      <fm-navbar\r\n        :title=\"selectedFile && selectedFile.name\"\r\n        @click-left=\"closed\"\r\n      >\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <iframe\r\n        class=\"pdf-iframe\"\r\n        scrolling=\"yes\"\r\n        :src=\"pdfUrl\"\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        v-if=\"showPdf\"\r\n      >\r\n      </iframe>\r\n      <video\r\n        autoplay\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mov')\r\n        \"\r\n      >\r\n        <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n      </video>\r\n      <video\r\n        autoplay\r\n        :src=\"selectedFile.url\"\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          (showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mp4')) ||\r\n            selectedFile.name.toLowerCase().includes('webm') ||\r\n            selectedFile.name.toLowerCase().includes('ogg')\r\n        \"\r\n      >\r\n        您的浏览器不支持 video 标签。\r\n      </video>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.fm-tmpl-listview-goods {\r\n  margin-bottom: 0.5rem;\r\n  padding: 0;\r\n  & img {\r\n    height: 48px;\r\n    width: 48px;\r\n    border-radius: 5px;\r\n  }\r\n  & .fm-tmpl-goods-price .fm-tmpl-goods-price-text {\r\n    font-size: 12px;\r\n    color: #666;\r\n  }\r\n  & .fm-tmpl-goods-name {\r\n    line-height: 1;\r\n    margin: 0;\r\n    min-height: 0;\r\n    font-size: 14px;\r\n    color: #000;\r\n    padding: 0;\r\n    overflow-wrap: break-word;\r\n  }\r\n  & .fm-tmpl-goods-img {\r\n    width: 48px;\r\n    height: 48px;\r\n  }\r\n  & .fm-tmpl-goods-content {\r\n    padding: 0;\r\n  }\r\n\r\n  & .fm-tmpl-goods-content::after {\r\n    content: \"\";\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-entry\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      // default: 'application/pdf,image/*,application/msword,text/html',\r\n      default: \"image/gif,image/jpg,image/jpeg,image/bmp,image/png\",\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"horizontal\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showVideo: false,\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        this.selectedFile = this.rawFiles[0];\r\n        // 没有url属性的 没有上传\r\n        // this.notUploadedFileList = this.rawFiles.filter((file) => !file.url);\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    if (!this.allowDefaultEntrance) {\r\n      this.showAction = true;\r\n    }\r\n  },\r\n  methods: {\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n      // this.$emit('chooseFile');\r\n    },\r\n\r\n    toUpload() {\r\n      this.$emit(\"upload\");\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      this.showAction = true;\r\n      if (file && file.length) {\r\n        this.selectedFile = file[file.length - 1];\r\n        this.notUploadedFileList = file;\r\n      } else {\r\n        this.selectedFile = file;\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // emit 添加文件后事件\r\n      this.$emit(\"afterAppendFile\", file);\r\n      // 添加文件后直接上传\r\n      this.requestUpload();\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (\r\n        selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n        selectedFile.name.toLowerCase().includes(\"mov\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n        this.show = true;\r\n        this.showPdf = false;\r\n        this.showVideo = true;\r\n        // const videoUrl = selectedFile.content || selectedFile.url;\r\n        // this.attachmentService.playShortVideo(\r\n        //   videoUrl + \"/\" + selectedFile.name\r\n        // );\r\n      } else {\r\n        // 图片文件直接预览\r\n        this.show = true;\r\n        this.showPdf = true;\r\n        this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n","<template>\r\n  <div\r\n    class=\"farris-attachment-entry\"\r\n    :class=\"{ 'farris-attachment-entry-vertical': direction === 'vertical' }\"\r\n  >\r\n    <div\r\n      class=\"fm-attachment-container attachment-navigation\"\r\n      v-if=\"direction === 'horizontal'\"\r\n    >\r\n      <div class=\"fm-attachment-files-list\">\r\n        <div\r\n          class=\"fm-attachment-files-item attachment-navigation-item\"\r\n          v-for=\"(item, index) in uploadFiles\"\r\n          :key=\"index\"\r\n          @click=\"selectFile(item)\"\r\n        >\r\n          <van-image\r\n            :src=\"getAttachmentPathByType(item)\"\r\n            class=\"item-img\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n            v-if=\"\r\n              (item && item.name && !item.name.includes('mp4')) || !item.name\r\n            \"\r\n          />\r\n          <van-image\r\n            :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n            class=\"item-img\"\r\n            width=\"48\"\r\n            height=\"48\"\r\n            v-if=\"\r\n              (item && item.name && item.name.toLowerCase().includes('mp4')) ||\r\n                item.name.toLowerCase().includes('mov')\r\n            \"\r\n          />\r\n          <div\r\n            class=\"item-icon-delete\"\r\n            :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n            @click.stop=\"deleteAttachment(item)\"\r\n            v-if=\"uploadFiles && uploadFiles.length && !removable\"\r\n          >\r\n            <span class=\"fm-icon fm-icon-close\"></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div\r\n        class=\"fm-attachment-upload-btn-container\"\r\n        :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n        v-if=\"!removable\"\r\n        @click=\"toUpload\"\r\n      >\r\n        <div class=\"fm-attachment-upload-btn\">\r\n          <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <fm-listview\r\n      :listData=\"uploadFiles\"\r\n      :finished=\"true\"\r\n      :showFinishedText=\"false\"\r\n      v-if=\"direction === 'vertical'\"\r\n    >\r\n      <template v-slot:listViewHeader> </template>\r\n      <template v-slot=\"props\">\r\n        <div class=\"fm-tmpl-listview-goods\">\r\n          <div class=\"fm-tmpl-goods-img\" @click=\"selectFile(props.item)\">\r\n            <van-image\r\n              :src=\"props.item.content || props.item.url\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  !props.item.name.includes('mp4')) ||\r\n                  !props.item.name\r\n              \"\r\n            />\r\n            <van-image\r\n              :src=\"'/platform/runtime/dfs/images/file.png'\"\r\n              class=\"item-img\"\r\n              v-if=\"\r\n                (props.item &&\r\n                  props.item.name &&\r\n                  props.item.name.toLowerCase().includes('mp4')) ||\r\n                  props.item.name.toLowerCase().includes('mov')\r\n              \"\r\n            />\r\n          </div>\r\n          <div>\r\n            <div class=\"fm-tmpl-goods-name\">\r\n              <span>{{ props.item.name }}</span>\r\n              <!-- <div class=\"fm-tmpl-goods-add\">\r\n\t\t\t\t\t\t\t\t可以添加下载\r\n\t\t\t\t\t\t\t\t<span class=\"fm-icon fm-icon-print\"></span>\r\n\t\t\t\t\t\t\t</div> -->\r\n            </div>\r\n            <!-- <div class=\"fm-tmpl-goods-price\">\r\n\t\t\t\t\t\t\t<span class=\"fm-tmpl-goods-price-text\">已上传</span>\r\n\t\t\t\t\t\t</div> -->\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </fm-listview>\r\n    <div\r\n      class=\"fm-attachment-upload-listview-btn-container\"\r\n      :class=\"{ 'fm-attachment-disabled': disabled }\"\r\n      v-if=\"!removable && direction === 'vertical'\"\r\n      @click=\"toUpload\"\r\n    >\r\n      <div class=\"fm-attachment-upload-btn\">\r\n        <span class=\"fm-icon fm-icon-addbutton\"></span>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-model:show=\"show\"\r\n      closeable\r\n      @closed=\"closed\"\r\n      :style=\"{ height: '100%', width: '100%' }\"\r\n    >\r\n      <fm-navbar\r\n        :title=\"selectedFile && selectedFile.name\"\r\n        @click-left=\"closed\"\r\n      >\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <iframe\r\n        class=\"pdf-iframe\"\r\n        scrolling=\"yes\"\r\n        :src=\"pdfUrl\"\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        v-if=\"showPdf\"\r\n      >\r\n      </iframe>\r\n      <video\r\n        autoplay\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mov')\r\n        \"\r\n      >\r\n        <source :src=\"selectedFile.url\" type=\"video/mp4\" />\r\n      </video>\r\n      <video\r\n        autoplay\r\n        :src=\"selectedFile.url\"\r\n        controls=\"controls\"\r\n        style=\"width: 100%; height: 100%\"\r\n        v-if=\"\r\n          (showVideo &&\r\n            selectedFile &&\r\n            selectedFile.name &&\r\n            selectedFile.name.toLowerCase().includes('mp4')) ||\r\n            selectedFile.name.toLowerCase().includes('webm') ||\r\n            selectedFile.name.toLowerCase().includes('ogg')\r\n        \"\r\n      >\r\n        您的浏览器不支持 video 标签。\r\n      </video>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.fm-tmpl-listview-goods {\r\n  margin-bottom: 0.5rem;\r\n  padding: 0;\r\n  & img {\r\n    height: 48px;\r\n    width: 48px;\r\n    border-radius: 5px;\r\n  }\r\n  & .fm-tmpl-goods-price .fm-tmpl-goods-price-text {\r\n    font-size: 12px;\r\n    color: #666;\r\n  }\r\n  & .fm-tmpl-goods-name {\r\n    line-height: 1;\r\n    margin: 0;\r\n    min-height: 0;\r\n    font-size: 14px;\r\n    color: #000;\r\n    padding: 0;\r\n    overflow-wrap: break-word;\r\n  }\r\n  & .fm-tmpl-goods-img {\r\n    width: 48px;\r\n    height: 48px;\r\n  }\r\n  & .fm-tmpl-goods-content {\r\n    padding: 0;\r\n  }\r\n\r\n  & .fm-tmpl-goods-content::after {\r\n    content: \"\";\r\n  }\r\n}\r\n.panzoom {\r\n  transform: none;\r\n  backface-visibility: hidden;\r\n  transform-origin: 50% 50% 0px;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n.page {\r\n  display: inline-block;\r\n  background-color: #ffffff;\r\n  margin: 20px;\r\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\r\n  transition: all 0.3s;\r\n}\r\n.farris-attachment-entry-vertical {\r\n  flex-direction: column;\r\n}\r\n.farris-attachment-entry {\r\n  display: flex;\r\n  clear: both;\r\n\r\n  & .fm-attachment-disabled {\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  }\r\n\r\n  // 附件导航栏\r\n  & .attachment-navigation {\r\n    overflow: inherit;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  // 附件子元素\r\n  & .attachment-navigation .attachment-navigation-item {\r\n    position: relative;\r\n    display: inline-block;\r\n\r\n    & .item-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n    }\r\n\r\n    & .item-icon-delete {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      width: 16px;\r\n      height: 16px;\r\n      background: #888;\r\n\r\n      & .fm-icon {\r\n        color: #fff;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n\r\n    & .item-icon {\r\n      position: absolute;\r\n    }\r\n  }\r\n\r\n  & .fm-attachment-container {\r\n    box-sizing: border-box;\r\n    float: left;\r\n    position: relative;\r\n    margin: 0 100px 0 0;\r\n    padding: 0 52px 0 0;\r\n    max-width: 100%;\r\n    height: 54px;\r\n\r\n    & .fm-attachment-files-list {\r\n      padding-top: 6px;\r\n      overflow: auto;\r\n      max-width: 100%;\r\n    }\r\n\r\n    & .fm-attachment-files-item {\r\n      position: relative;\r\n      width: 48px;\r\n      height: 48px;\r\n      margin-right: 20px;\r\n\r\n      & .item-icon-delete {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: absolute;\r\n        right: -6px;\r\n        top: -6px;\r\n        width: 16px;\r\n        height: 16px;\r\n        background: #888;\r\n        border-radius: 50%;\r\n\r\n        & .fm-icon {\r\n          color: #fff;\r\n          font-size: 12px;\r\n        }\r\n      }\r\n\r\n      & .van-image__img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n    & .fm-attachment-upload-btn-container {\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      margin-top: -20px;\r\n      z-index: 8;\r\n      width: 48px;\r\n      height: 48px;\r\n      background: #f6f6f6;\r\n      border-radius: 3px;\r\n\r\n      & .fm-attachment-upload-btn {\r\n        & .fm-icon {\r\n          display: block;\r\n          font-size: 20px;\r\n          color: #ddd;\r\n          line-height: 48px;\r\n          margin: 0 auto;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  & .fm-attachment-upload-listview-btn-container {\r\n    z-index: 8;\r\n    width: 48px;\r\n    height: 48px;\r\n    background: #f6f6f6;\r\n    border-radius: 3px;\r\n\r\n    & .fm-attachment-upload-btn {\r\n      & .fm-icon {\r\n        display: block;\r\n        font-size: 20px;\r\n        color: #ddd;\r\n        line-height: 48px;\r\n        margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { Image, ImagePreview } from \"vant\";\r\nexport default defineComponent({\r\n  name: \"fm-attachment-entry\",\r\n  components: {\r\n    \"van-image\": Image,\r\n    [ImagePreview.Component.name]: ImagePreview.Component,\r\n  },\r\n  inject: {\r\n    attachmentService: { default: null },\r\n    uploadAttachmentService: { default: {} },\r\n  },\r\n  props: {\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 传入文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    // 多选\r\n    multiple: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 文件类型\r\n    accept: {\r\n      type: String,\r\n      // default: 'application/pdf,image/*,application/msword,text/html',\r\n      default: \"image/gif,image/jpg,image/jpeg,image/bmp,image/png\",\r\n    },\r\n    // 禁用上传\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // 读取文件前事件\r\n    beforeReadFile: {\r\n      type: Function,\r\n    },\r\n    // 上传事件\r\n    uploadFile: {\r\n      type: Function,\r\n    },\r\n    // 文件预览事件\r\n    previewFile: {\r\n      type: Function,\r\n    },\r\n    // 拍照前回调\r\n    beforeTakePhoto: {\r\n      type: Function,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    direction: {\r\n      // type: 'vertical' | 'horizontal',\r\n      type: String,\r\n      default: \"horizontal\",\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"附件\",\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      fromProp: false,\r\n      /**\r\n       * 文件列表\r\n       */\r\n      rawFiles: [],\r\n      /**\r\n       * 展示附件上传界面开关\r\n       */\r\n      showAction: false,\r\n\r\n      /**\r\n       * 附件保存页面\r\n       */\r\n      saveAction: false,\r\n\r\n      /**\r\n       * 当前选中附件\r\n       */\r\n      selectedFile: null,\r\n\r\n      /**\r\n       * 选中文件预览路径\r\n       */\r\n      selectedFilePath: \"\",\r\n\r\n      /**\r\n       * 附件描述\r\n       */\r\n      description: \"\",\r\n\r\n      /**\r\n       * 未上传的文件列表\r\n       */\r\n      notUploadedFileList: [],\r\n      /**\r\n\t\t\t预览页面\r\n\t\t\t*/\r\n      previewPages: [],\r\n      pdfUrl: \"\",\r\n      /**\r\n\t\t\t\t弹出层显示\r\n\t\t\t\t\t*/\r\n      show: false,\r\n      showPdf: false,\r\n      showVideo: false,\r\n      docStyle: {},\r\n    };\r\n  },\r\n  computed: {\r\n    uploadFiles() {\r\n      this.rawFiles = [].concat(...this.fileList.map((file) => file));\r\n      if (this.rawFiles && this.rawFiles.length) {\r\n        this.selectedFile = this.rawFiles[0];\r\n        // 没有url属性的 没有上传\r\n        // this.notUploadedFileList = this.rawFiles.filter((file) => !file.url);\r\n        return this.rawFiles;\r\n      }\r\n      this.selectedFile = null;\r\n      return [];\r\n    },\r\n    isEmpty() {\r\n      return this.rawFiles && !this.rawFiles.length;\r\n    },\r\n    previewEnable() {\r\n      return this.showAction && this.rawFiles && !!this.rawFiles.length;\r\n    },\r\n  },\r\n  mounted() {\r\n    if (!this.allowDefaultEntrance) {\r\n      this.showAction = true;\r\n    }\r\n  },\r\n  methods: {\r\n    getAttachmentPath(attachmentId) {\r\n      return this.uploadAttachmentService.getAttachmentPath(\r\n        attachmentId,\r\n        this.rootId\r\n      );\r\n    },\r\n    getAttachmentPathByType(attachment) {\r\n      if (attachment.name.search(/\\.(png|jpe?g|gif|svg)(\\?.*)?$/) >= 0) {\r\n        return this.getAttachmentPath(attachment.attachmentId);\r\n      }\r\n      return attachment.content || attachment.url;\r\n    },\r\n    /**\r\n     * 添加文件\r\n     */\r\n    appendFile() {\r\n      this.$refs.fileUploadRef.chooseFile();\r\n      // this.$emit('chooseFile');\r\n    },\r\n\r\n    toUpload() {\r\n      this.$emit(\"upload\");\r\n    },\r\n\r\n    /**\r\n     * 读取文件之前\r\n     */\r\n    beforeRead(file) {\r\n      if (this.beforeReadFile) {\r\n        // 读取文件前事件\r\n        const beforeReadRes = this.beforeReadFile(file);\r\n        return beforeReadRes;\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * 加载文件后事件\r\n     */\r\n    afterRead(file) {\r\n      this.showAction = true;\r\n      if (file && file.length) {\r\n        this.selectedFile = file[file.length - 1];\r\n        this.notUploadedFileList = file;\r\n      } else {\r\n        this.selectedFile = file;\r\n        this.notUploadedFileList = [file];\r\n      }\r\n      // emit 添加文件后事件\r\n      this.$emit(\"afterAppendFile\", file);\r\n      // 添加文件后直接上传\r\n      this.requestUpload();\r\n    },\r\n    /**\r\n     * 删除选中文件\r\n     */\r\n    deleteFile() {\r\n      if (!this.rawFiles || !this.rawFiles.length) {\r\n        return;\r\n      }\r\n      this.deleteAttachment(this.selectedFile);\r\n    },\r\n    mergeString(str, str1) {\r\n      let min = str.length < str1.length ? str.length : str1.length;\r\n      let res = \"\";\r\n      let i = 0;\r\n      for (i = 0; i < min; i++) {\r\n        res += str.substring(i, i + 1);\r\n        res += str1.substring(i, i + 1);\r\n      }\r\n      res += str.length < str1.length ? str1.substring(i) : str.substring(i);\r\n      return res;\r\n    },\r\n\r\n    getToken(str) {\r\n      let array = [1, 2, 3];\r\n      if (str.length > 24) {\r\n        str = str.substring(0, 24);\r\n      }\r\n      let length = Math.floor(str.length / 3);\r\n      let str1 = str.substring(0, length);\r\n      let str2 = str.substring(length, 2 * length);\r\n      let str3 = str.substring(2 * length, 3 * length);\r\n      let randomArray = [];\r\n      var random = Math.ceil(Math.random() * 3);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      random = Math.ceil(Math.random() * 2);\r\n      randomArray.push(array[random - 1]);\r\n      array.splice(random - 1, 1);\r\n      randomArray.push(array[0]);\r\n      let timeStamp = Math.round(new Date().getTime() / 1000) + \"\";\r\n      return (\r\n        timeStamp.substring(0, 5) +\r\n        \"times\" +\r\n        randomArray[0] +\r\n        \"\" +\r\n        randomArray[1] +\r\n        \"\" +\r\n        randomArray[2] +\r\n        this.switchStr(str1, str2, str3, randomArray[0]) +\r\n        this.switchStr(str1, str2, str3, randomArray[1]) +\r\n        this.switchStr(str1, str2, str3, randomArray[2]) +\r\n        \"times\" +\r\n        timeStamp.substring(5)\r\n      );\r\n    },\r\n    switchStr(str1, str2, str3, i) {\r\n      switch (i) {\r\n        case 1:\r\n          return str1;\r\n        case 2:\r\n          return str2;\r\n        case 3:\r\n          return str3;\r\n      }\r\n    },\r\n    /**\r\n     * 选中文件\r\n     */\r\n    selectFile(item) {\r\n      this.genPreview(item);\r\n      this.selectedFile = item;\r\n      this.$emit(\"selectCurrentItem\");\r\n    },\r\n\r\n    /**\r\n\t\t\t删除附件\r\n\t\t\t\t*/\r\n    deleteAttachment(item) {\r\n      this.$emit(\"remove\", [item.attachmentId]);\r\n    },\r\n    genPreview(selectedFile) {\r\n      if (!selectedFile || !selectedFile.name) {\r\n        return;\r\n      }\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content = \"width=device-width, initial-scale=1.0\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      if (\r\n        selectedFile.name.toLowerCase().includes(\"mp4\") ||\r\n        selectedFile.name.toLowerCase().includes(\"mov\")\r\n      ) {\r\n        if (this.externalVideoUrl) {\r\n          selectedFile.url =\r\n            this.externalVideoUrl +\r\n            `?metadataId=${selectedFile.attachmentId}&rootid=${\r\n              this.rootId\r\n            }&token=${this.getToken(\r\n              this.mergeString(selectedFile.attachmentId, this.rootId)\r\n            )}`;\r\n        }\r\n        this.show = true;\r\n        this.showPdf = false;\r\n        this.showVideo = true;\r\n        // const videoUrl = selectedFile.content || selectedFile.url;\r\n        // this.attachmentService.playShortVideo(\r\n        //   videoUrl + \"/\" + selectedFile.name\r\n        // );\r\n      } else {\r\n        // 图片文件直接预览\r\n        this.show = true;\r\n        this.showPdf = true;\r\n        this.pdfUrl = `/platform/runtime/dfs/viewpage/index.html?metadataId=${selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`;\r\n      }\r\n      this.$emit(\"preview\", selectedFile);\r\n    },\r\n    getFitToWidth(pageWidth, pageHeight) {\r\n      const pageWidth1 = this.ptToPx(pageWidth);\r\n      const pageHeight1 = this.ptToPx(pageHeight);\r\n      const offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;\r\n      return pageHeight1 > pageWidth1 &&\r\n        Math.round(offsetWidth / window.innerWidth) <= 1\r\n        ? 200 - Math.round((offsetWidth * 100) / window.innerWidth)\r\n        : Math.round((window.innerWidth * 100) / offsetWidth);\r\n    },\r\n    ptToPx(pt) {\r\n      return (pt * 96) / 72;\r\n    },\r\n\r\n    isMobile(width) {\r\n      return width <= 425;\r\n    },\r\n\r\n    isTablet(width) {\r\n      return width <= 1024;\r\n    },\r\n\r\n    isDesktop(width) {\r\n      return !this.isMobile(width) && !this.isTablet(width);\r\n    },\r\n    closed() {\r\n      // 生成缩放的meta标签\r\n      const originMeta = document.getElementsByName(\"viewport\")[0];\r\n      const meta = document.createElement(\"meta\");\r\n      meta.name = \"viewport\";\r\n      // meta.content =\r\n      //   \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      meta.content =\r\n        \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\";\r\n      const head = document.getElementsByTagName(\"head\")[0];\r\n      if (originMeta) {\r\n        head.removeChild(originMeta);\r\n      }\r\n      head.appendChild(meta);\r\n      this.show = false;\r\n    },\r\n  },\r\n});\r\n</script>\r\n",null,"<template>\r\n\t<div\r\n\t\tclass=\"fm-verify-code\"\r\n\t\t:class=\"{ 'fm-verify-code-disabled': disabled || time > 0 }\"\r\n\t\t@click=\"run()\"\r\n\t>\r\n\t\t<span class=\"text\">{{ text }}</span>\r\n\t</div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\n\r\nexport default defineComponent({\r\n\tname: 'fm-verify-code',\r\n\tprops: {\r\n\t\tsecond: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 60\r\n\t\t}\r\n\t},\r\n\tdata: function () {\r\n\t\treturn {\r\n\t\t\ttime: 0,\r\n\t\t\tdisabled: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trun: function () {\r\n\t\t\tif (this.disabled || this.time > 0) return;\r\n\t\t\tthis.$emit('run');\r\n\t\t\tthis.start();\r\n\t\t},\r\n\t\tstart: function () {\r\n\t\t\tthis.time = this.second;\r\n\t\t\tthis.timer();\r\n\t\t},\r\n\t\tstop: function () {\r\n\t\t\tthis.time = 0;\r\n\t\t\tthis.disabled = false;\r\n\t\t},\r\n\t\tsetDisabled: function (val) {\r\n\t\t\tthis.disabled = val;\r\n\t\t},\r\n\t\ttimer: function () {\r\n\t\t\tif (this.time > 0) {\r\n\t\t\t\tthis.time--;\r\n\t\t\t\tsetTimeout(this.timer, 1000);\r\n\t\t\t} else {\r\n\t\t\t\tthis.disabled = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\tcomputed: {\r\n\t\ttext: function () {\r\n\t\t\treturn this.time > 0 ? this.time + 's' : '获取验证码';\r\n\t\t}\r\n\t}\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '../../../assets/style/mixins/_hairline';\r\n.fm-verify-code{\r\n    .text{\r\n        font-size: 15px;\r\n        color: #31A4FB;\r\n    }\r\n    &-disabled{\r\n        .text{\r\n            color: #999;\r\n        }\r\n    }\r\n}\r\n\r\n</style>\r\n","<template>\r\n\t<div\r\n\t\tclass=\"fm-verify-code\"\r\n\t\t:class=\"{ 'fm-verify-code-disabled': disabled || time > 0 }\"\r\n\t\t@click=\"run()\"\r\n\t>\r\n\t\t<span class=\"text\">{{ text }}</span>\r\n\t</div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\n\r\nexport default defineComponent({\r\n\tname: 'fm-verify-code',\r\n\tprops: {\r\n\t\tsecond: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 60\r\n\t\t}\r\n\t},\r\n\tdata: function () {\r\n\t\treturn {\r\n\t\t\ttime: 0,\r\n\t\t\tdisabled: false\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trun: function () {\r\n\t\t\tif (this.disabled || this.time > 0) return;\r\n\t\t\tthis.$emit('run');\r\n\t\t\tthis.start();\r\n\t\t},\r\n\t\tstart: function () {\r\n\t\t\tthis.time = this.second;\r\n\t\t\tthis.timer();\r\n\t\t},\r\n\t\tstop: function () {\r\n\t\t\tthis.time = 0;\r\n\t\t\tthis.disabled = false;\r\n\t\t},\r\n\t\tsetDisabled: function (val) {\r\n\t\t\tthis.disabled = val;\r\n\t\t},\r\n\t\ttimer: function () {\r\n\t\t\tif (this.time > 0) {\r\n\t\t\t\tthis.time--;\r\n\t\t\t\tsetTimeout(this.timer, 1000);\r\n\t\t\t} else {\r\n\t\t\t\tthis.disabled = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\tcomputed: {\r\n\t\ttext: function () {\r\n\t\t\treturn this.time > 0 ? this.time + 's' : '获取验证码';\r\n\t\t}\r\n\t}\r\n})\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import '../../../assets/style/mixins/_hairline';\r\n.fm-verify-code{\r\n    .text{\r\n        font-size: 15px;\r\n        color: #31A4FB;\r\n    }\r\n    &-disabled{\r\n        .text{\r\n            color: #999;\r\n        }\r\n    }\r\n}\r\n\r\n</style>\r\n",null,null,null,null,null,null,null,null,"<template>\r\n  <div>\r\n    <div class=\"fm-input-item fm-input-item-inline\" id=\"attachment-container\">\r\n      <div class=\"fm-input-item pr-md pl-md\" id=\"attachment-container\">\r\n        <fm-attachment-entry\r\n          :fileList=\"state.filterData\"\r\n          :externalVideoUrl=\"externalVideoUrl\"\r\n          :removable=\"removable\"\r\n          :parentDirName=\"parentDirName\"\r\n          :rootId=\"rootId\"\r\n          @remove=\"removeAttachment\"\r\n          @upload=\"toAttachmentDetailPage\"\r\n        ></fm-attachment-entry>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-if=\"state.show\"\r\n      v-model:show=\"state.show\"\r\n      position=\"right\"\r\n      :style=\"{\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        'flex-direction': 'column',\r\n        background: '#fff',\r\n      }\"\r\n    >\r\n      <fm-navbar :title=\"title\" @click-left=\"goBack\" v-if=\"showNavBar\">\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <div class=\"fm-edit-input-list\" id=\"detail-form-layout\">\r\n        <div\r\n          class=\"fm-input-wrapper\"\r\n          v-for=\"field in state.attachmentExtendFields\"\r\n        >\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox' && field.visible\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox' && field.visible\"\r\n          />\r\n        </div>\r\n        <div class=\"fm-input-wrapper\" v-for=\"field in extendFields\">\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox'\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox'\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <fm-attachment\r\n        :fileList=\"state.filterData\"\r\n        :parentDirName=\"parentDirName\"\r\n        :externalVideoUrl=\"externalVideoUrl\"\r\n        :rootId=\"rootId\"\r\n        @selectChange=\"selectChange\"\r\n        @remove=\"removeAttachment\"\r\n        @afterAppendFile=\"uploadAttachment\"\r\n        v-if=\"state.show\"\r\n      >\r\n      </fm-attachment>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { computed, reactive, onMounted, defineComponent, nextTick } from \"vue\";\r\nimport { Popup, Field, NavBar, Icon } from \"vant\";\r\nimport { filterData } from \"@farris/mobile-vue-adapter\";\r\nimport { AttachmentUtil } from \"./attachment.service\";\r\nimport { guid } from \"../map/service\";\r\nimport AttachmentEntry from \"../../components/attachment-entry\";\r\nimport Attachment from \"../../components/attachment\";\r\nexport default defineComponent({\r\n  // 组件名称\r\n  name: \"fm-business-attachment\",\r\n  props: {\r\n    // 输入属性\r\n    extendFields: {\r\n      type: Array,\r\n      default: () => [{}],\r\n    },\r\n    // 是否显示头部导航\r\n    showNavBar: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 附件目录信息\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // rootId\r\n    rootId: {\r\n      type: String,\r\n      default: \"default-root\",\r\n    },\r\n    // 主表或子表路径\r\n    path: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 获取服务端数据\r\n    // getRawData: {\r\n    // \ttype: Function\r\n    // },\r\n    title: {\r\n      type: String,\r\n      default: \"导航栏\",\r\n    },\r\n    // 是否展示附件信息\r\n    displayAttachmentInfo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    displayAttachmentId: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    displayAttachmentName: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  setup(props, { emit }) {\r\n    const state = reactive({\r\n      show: false,\r\n      fieldsValue: {\r\n        // name: ''\r\n      },\r\n      attachmentExtendFields: [],\r\n      selectedAttachmentId: \"\",\r\n      context: {\r\n        // 原值\r\n        data: [],\r\n        // 旧值  用于扩展字段变更\r\n        oldData: [],\r\n        // 获取数据\r\n        getData: null,\r\n        // 更新旧值\r\n        updateData: null,\r\n        // 删除数据\r\n        removeDataById: null,\r\n        // 设置数据\r\n        setData: null,\r\n        // 追加数据\r\n        appendData: null,\r\n        removed: false,\r\n      },\r\n      currentData: null,\r\n      fields: computed(() => {\r\n        return props.extendFields || [{}];\r\n      }),\r\n      rawData: computed(() => {\r\n        if (!state.currentData && state.context.data.length) {\r\n          state.currentData = state.context.data[0];\r\n          // 选择该数据\r\n          nextTick(() => {\r\n            Object.keys(state.fieldsValue).forEach((key) => {\r\n              state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n            });\r\n          });\r\n        }\r\n        if (state.selectedAttachmentId) {\r\n          const selectedData = state.context.data.find(\r\n            (dataItem) =>\r\n              dataItem[props.path.substring(1)].attachmentId ===\r\n              state.selectedAttachmentId\r\n          );\r\n          if (selectedData) {\r\n            state.currentData = selectedData;\r\n            // 选择该数据\r\n            nextTick(() => {\r\n              Object.keys(state.fieldsValue).forEach((key) => {\r\n                state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n              });\r\n            });\r\n          } else {\r\n            if (state.context.data.length) {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            } else {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            }\r\n          }\r\n        }\r\n        // 删除标记\r\n        return state.context.data;\r\n      }),\r\n      filterData: computed(() =>\r\n        filterData(state.rawData, props.path, props.rootId)\r\n      ),\r\n    });\r\n    onMounted(() => {\r\n      // 初始化上下文\r\n      initContext();\r\n      // 初始化获取附件信息\r\n      // if (props.getRawData) {\r\n      // props.getRawData(state.context);\r\n      // 获取服务端数据\r\n      emit(\"getRawData\", state.context);\r\n      if (\r\n        !state.currentData &&\r\n        state.context.data &&\r\n        state.context.data.length\r\n      ) {\r\n        state.currentData = state.context.data[0];\r\n      }\r\n      // }\r\n    });\r\n    /**\r\n     * 上传附件\r\n     */\r\n    const uploadAttachment = (e) => {\r\n      state.selectedAttachmentId = e[0].metadataId;\r\n      emit(\"upload\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 删除附件\r\n     */\r\n    const removeAttachment = (e) => {\r\n      state.removed = true;\r\n      emit(\"remove\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n    /**\r\n     * 选择附件\r\n     */\r\n    const selectChange = (e) => {\r\n      const attachmentId = e.attachmentId;\r\n      state.selectedAttachmentId = attachmentId;\r\n      // 获取当前数据\r\n      const bindingField = props.path.split(\"/\")[1];\r\n      state.currentData = AttachmentUtil.getCurrentData(\r\n        attachmentId,\r\n        state.context.data,\r\n        bindingField\r\n      );\r\n      Object.keys(state.fieldsValue).forEach((key) => {\r\n        state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n      });\r\n      emit(\"selectChange\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n        currentData: state.currentData,\r\n      });\r\n    };\r\n    /**\r\n     * 回退事件\r\n     */\r\n    const goBack = () => {\r\n      state.show = false;\r\n      state.selectedAttachmentId = \"\";\r\n      // 赋值当前数据\r\n      if (state.currentData) {\r\n        const bindingFields = props.extendFields\r\n          .map((extendField) => {\r\n            return extendField.bindingField;\r\n          })\r\n          .filter((ele) => ele);\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          bindingFields,\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 回退抛出事件\r\n      emit(\"goBack\", {\r\n        listData: state.context.data,\r\n        oldListData: state.context.oldData,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 失去焦点事件\r\n     */\r\n    const blur = (field) => {\r\n      const bindingField = field.bindingField;\r\n      // 赋值\r\n      if (state.currentData) {\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          [bindingField],\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 抛出失去焦点事件\r\n      emit(\"blur\", {\r\n        field,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    const toAttachmentDetailPage = () => {\r\n      state.show = true;\r\n      // 由于附件组件重新加载都会定位第一个附件  所以要重新赋值为第一个附件的数据\r\n      state.currentData = state.context.data[0];\r\n      // 组建扩展字段数组\r\n      const attachmentInfoFields = [\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_AttachmentId`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件id\",\r\n          visible: props.displayAttachmentId,\r\n        },\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_FileName`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件名称\",\r\n          visible: props.displayAttachmentName,\r\n        },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileSize`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件大小'\r\n        // },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileCreateTime`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件上传时间'\r\n        // }\r\n      ];\r\n      if (props.displayAttachmentInfo) {\r\n        state.attachmentExtendFields = [...attachmentInfoFields];\r\n      }\r\n      const extendFields = [\r\n        ...state.attachmentExtendFields,\r\n        ...props.extendFields,\r\n      ];\r\n      // 创建字段绑定值变量\r\n      // if (props.extendFields.length && state.currentData) {\r\n      extendFields.forEach((ele) => {\r\n        // if (!state.fieldsValue[ele.bindingField]) {\r\n        state.fieldsValue[ele.bindingField] =\r\n          state.currentData &&\r\n          getDataValue(state.currentData, ele.bindingField);\r\n        // }\r\n      });\r\n\r\n      // }\r\n    };\r\n\r\n    /**\r\n     * 初始化上下文\r\n     */\r\n    const initContext = () => {\r\n      // 获取数据\r\n      state.context.getData = AttachmentUtil.getContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 更新旧值\r\n      state.context.updateData = AttachmentUtil.updateContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 删除数据\r\n      state.context.removeDataById = AttachmentUtil.removeContextDataById.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 设置数据\r\n      state.context.setData = AttachmentUtil.setContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 追加数据\r\n      state.context.appendData = AttachmentUtil.appendToContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n    };\r\n\r\n    const getDataValue = (data, field) => {\r\n      if (data) {\r\n        const fieldArr = field.split(\"_\");\r\n        if (fieldArr.length > 1) {\r\n          const newField =\r\n            fieldArr[1].substring(0, 1).toLowerCase() +\r\n            fieldArr[1].substring(1);\r\n          return data[fieldArr[0]][newField];\r\n        }\r\n        return data[field];\r\n      }\r\n      return \"\";\r\n    };\r\n\r\n    return {\r\n      state,\r\n      uploadAttachment,\r\n      removeAttachment,\r\n      selectChange,\r\n      goBack,\r\n      blur,\r\n      toAttachmentDetailPage,\r\n      initContext,\r\n      getDataValue,\r\n    };\r\n  },\r\n  components: {\r\n    \"fm-attachment-entry\": AttachmentEntry,\r\n    \"fm-attachment\": Attachment,\r\n    \"van-nav-bar\": NavBar,\r\n    \"van-popup\": Popup,\r\n    \"van-icon\": Icon,\r\n    \"van-field\": Field,\r\n  },\r\n});\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.van-nav-bar .van-nav-bar__content {\r\n  flex: 1;\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <div class=\"fm-input-item fm-input-item-inline\" id=\"attachment-container\">\r\n      <div class=\"fm-input-item pr-md pl-md\" id=\"attachment-container\">\r\n        <fm-attachment-entry\r\n          :fileList=\"state.filterData\"\r\n          :externalVideoUrl=\"externalVideoUrl\"\r\n          :removable=\"removable\"\r\n          :parentDirName=\"parentDirName\"\r\n          :rootId=\"rootId\"\r\n          @remove=\"removeAttachment\"\r\n          @upload=\"toAttachmentDetailPage\"\r\n        ></fm-attachment-entry>\r\n      </div>\r\n    </div>\r\n    <van-popup\r\n      v-if=\"state.show\"\r\n      v-model:show=\"state.show\"\r\n      position=\"right\"\r\n      :style=\"{\r\n        width: '100%',\r\n        height: '100%',\r\n        display: 'flex',\r\n        'flex-direction': 'column',\r\n        background: '#fff',\r\n      }\"\r\n    >\r\n      <fm-navbar :title=\"title\" @click-left=\"goBack\" v-if=\"showNavBar\">\r\n        <template #left>\r\n          <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n        </template>\r\n      </fm-navbar>\r\n      <div class=\"fm-edit-input-list\" id=\"detail-form-layout\">\r\n        <div\r\n          class=\"fm-input-wrapper\"\r\n          v-for=\"field in state.attachmentExtendFields\"\r\n        >\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox' && field.visible\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox' && field.visible\"\r\n          />\r\n        </div>\r\n        <div class=\"fm-input-wrapper\" v-for=\"field in extendFields\">\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'TextBox'\"\r\n          />\r\n          <van-field\r\n            :label=\"field.label\"\r\n            v-model=\"state.fieldsValue[field.bindingField]\"\r\n            :readonly=\"field.readonly\"\r\n            type=\"number\"\r\n            @blur=\"blur(field)\"\r\n            v-if=\"field.editorType === 'NumberBox'\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <fm-attachment\r\n        :fileList=\"state.filterData\"\r\n        :parentDirName=\"parentDirName\"\r\n        :externalVideoUrl=\"externalVideoUrl\"\r\n        :rootId=\"rootId\"\r\n        @selectChange=\"selectChange\"\r\n        @remove=\"removeAttachment\"\r\n        @afterAppendFile=\"uploadAttachment\"\r\n        v-if=\"state.show\"\r\n      >\r\n      </fm-attachment>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { computed, reactive, onMounted, defineComponent, nextTick } from \"vue\";\r\nimport { Popup, Field, NavBar, Icon } from \"vant\";\r\nimport { filterData } from \"@farris/mobile-vue-adapter\";\r\nimport { AttachmentUtil } from \"./attachment.service\";\r\nimport { guid } from \"../map/service\";\r\nimport AttachmentEntry from \"../../components/attachment-entry\";\r\nimport Attachment from \"../../components/attachment\";\r\nexport default defineComponent({\r\n  // 组件名称\r\n  name: \"fm-business-attachment\",\r\n  props: {\r\n    // 输入属性\r\n    extendFields: {\r\n      type: Array,\r\n      default: () => [{}],\r\n    },\r\n    // 是否显示头部导航\r\n    showNavBar: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // 附件目录信息\r\n    parentDirName: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // rootId\r\n    rootId: {\r\n      type: String,\r\n      default: \"default-root\",\r\n    },\r\n    // 主表或子表路径\r\n    path: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    // 获取服务端数据\r\n    // getRawData: {\r\n    // \ttype: Function\r\n    // },\r\n    title: {\r\n      type: String,\r\n      default: \"导航栏\",\r\n    },\r\n    // 是否展示附件信息\r\n    displayAttachmentInfo: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    removable: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    displayAttachmentId: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    displayAttachmentName: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    externalVideoUrl: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  setup(props, { emit }) {\r\n    const state = reactive({\r\n      show: false,\r\n      fieldsValue: {\r\n        // name: ''\r\n      },\r\n      attachmentExtendFields: [],\r\n      selectedAttachmentId: \"\",\r\n      context: {\r\n        // 原值\r\n        data: [],\r\n        // 旧值  用于扩展字段变更\r\n        oldData: [],\r\n        // 获取数据\r\n        getData: null,\r\n        // 更新旧值\r\n        updateData: null,\r\n        // 删除数据\r\n        removeDataById: null,\r\n        // 设置数据\r\n        setData: null,\r\n        // 追加数据\r\n        appendData: null,\r\n        removed: false,\r\n      },\r\n      currentData: null,\r\n      fields: computed(() => {\r\n        return props.extendFields || [{}];\r\n      }),\r\n      rawData: computed(() => {\r\n        if (!state.currentData && state.context.data.length) {\r\n          state.currentData = state.context.data[0];\r\n          // 选择该数据\r\n          nextTick(() => {\r\n            Object.keys(state.fieldsValue).forEach((key) => {\r\n              state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n            });\r\n          });\r\n        }\r\n        if (state.selectedAttachmentId) {\r\n          const selectedData = state.context.data.find(\r\n            (dataItem) =>\r\n              dataItem[props.path.substring(1)].attachmentId ===\r\n              state.selectedAttachmentId\r\n          );\r\n          if (selectedData) {\r\n            state.currentData = selectedData;\r\n            // 选择该数据\r\n            nextTick(() => {\r\n              Object.keys(state.fieldsValue).forEach((key) => {\r\n                state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n              });\r\n            });\r\n          } else {\r\n            if (state.context.data.length) {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            } else {\r\n              nextTick(() => {\r\n                Object.keys(state.fieldsValue).forEach((key) => {\r\n                  state.fieldsValue[key] = getDataValue(\r\n                    state.context.data[state.context.data.length - 1],\r\n                    key\r\n                  );\r\n                });\r\n              });\r\n            }\r\n          }\r\n        }\r\n        // 删除标记\r\n        return state.context.data;\r\n      }),\r\n      filterData: computed(() =>\r\n        filterData(state.rawData, props.path, props.rootId)\r\n      ),\r\n    });\r\n    onMounted(() => {\r\n      // 初始化上下文\r\n      initContext();\r\n      // 初始化获取附件信息\r\n      // if (props.getRawData) {\r\n      // props.getRawData(state.context);\r\n      // 获取服务端数据\r\n      emit(\"getRawData\", state.context);\r\n      if (\r\n        !state.currentData &&\r\n        state.context.data &&\r\n        state.context.data.length\r\n      ) {\r\n        state.currentData = state.context.data[0];\r\n      }\r\n      // }\r\n    });\r\n    /**\r\n     * 上传附件\r\n     */\r\n    const uploadAttachment = (e) => {\r\n      state.selectedAttachmentId = e[0].metadataId;\r\n      emit(\"upload\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 删除附件\r\n     */\r\n    const removeAttachment = (e) => {\r\n      state.removed = true;\r\n      emit(\"remove\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n      });\r\n    };\r\n    /**\r\n     * 选择附件\r\n     */\r\n    const selectChange = (e) => {\r\n      const attachmentId = e.attachmentId;\r\n      state.selectedAttachmentId = attachmentId;\r\n      // 获取当前数据\r\n      const bindingField = props.path.split(\"/\")[1];\r\n      state.currentData = AttachmentUtil.getCurrentData(\r\n        attachmentId,\r\n        state.context.data,\r\n        bindingField\r\n      );\r\n      Object.keys(state.fieldsValue).forEach((key) => {\r\n        state.fieldsValue[key] = getDataValue(state.currentData, key);\r\n      });\r\n      emit(\"selectChange\", {\r\n        context: state.context,\r\n        rootId: state.rootId,\r\n        parentDirName: state.parentDirName,\r\n        data: e,\r\n        currentData: state.currentData,\r\n      });\r\n    };\r\n    /**\r\n     * 回退事件\r\n     */\r\n    const goBack = () => {\r\n      state.show = false;\r\n      state.selectedAttachmentId = \"\";\r\n      // 赋值当前数据\r\n      if (state.currentData) {\r\n        const bindingFields = props.extendFields\r\n          .map((extendField) => {\r\n            return extendField.bindingField;\r\n          })\r\n          .filter((ele) => ele);\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          bindingFields,\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 回退抛出事件\r\n      emit(\"goBack\", {\r\n        listData: state.context.data,\r\n        oldListData: state.context.oldData,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    /**\r\n     * 失去焦点事件\r\n     */\r\n    const blur = (field) => {\r\n      const bindingField = field.bindingField;\r\n      // 赋值\r\n      if (state.currentData) {\r\n        AttachmentUtil.modifyData(\r\n          state.currentData,\r\n          [bindingField],\r\n          state.fieldsValue\r\n        );\r\n      }\r\n      // 抛出失去焦点事件\r\n      emit(\"blur\", {\r\n        field,\r\n        context: state.context,\r\n      });\r\n    };\r\n\r\n    const toAttachmentDetailPage = () => {\r\n      state.show = true;\r\n      // 由于附件组件重新加载都会定位第一个附件  所以要重新赋值为第一个附件的数据\r\n      state.currentData = state.context.data[0];\r\n      // 组建扩展字段数组\r\n      const attachmentInfoFields = [\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_AttachmentId`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件id\",\r\n          visible: props.displayAttachmentId,\r\n        },\r\n        {\r\n          id: guid(),\r\n          bindingField: `${props.path.substring(1)}_FileName`,\r\n          editorType: \"TextBox\",\r\n          position: \"right\",\r\n          readonly: true,\r\n          label: \"附件名称\",\r\n          visible: props.displayAttachmentName,\r\n        },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileSize`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件大小'\r\n        // },\r\n        // {\r\n        // \tid: guid(),\r\n        // \tbindingField: `${props.path.substring(1)}_FileCreateTime`,\r\n        // \teditorType: 'TextBox',\r\n        // \tposition: 'right',\r\n        // \treadonly: true,\r\n        // \tlabel: '附件上传时间'\r\n        // }\r\n      ];\r\n      if (props.displayAttachmentInfo) {\r\n        state.attachmentExtendFields = [...attachmentInfoFields];\r\n      }\r\n      const extendFields = [\r\n        ...state.attachmentExtendFields,\r\n        ...props.extendFields,\r\n      ];\r\n      // 创建字段绑定值变量\r\n      // if (props.extendFields.length && state.currentData) {\r\n      extendFields.forEach((ele) => {\r\n        // if (!state.fieldsValue[ele.bindingField]) {\r\n        state.fieldsValue[ele.bindingField] =\r\n          state.currentData &&\r\n          getDataValue(state.currentData, ele.bindingField);\r\n        // }\r\n      });\r\n\r\n      // }\r\n    };\r\n\r\n    /**\r\n     * 初始化上下文\r\n     */\r\n    const initContext = () => {\r\n      // 获取数据\r\n      state.context.getData = AttachmentUtil.getContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 更新旧值\r\n      state.context.updateData = AttachmentUtil.updateContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 删除数据\r\n      state.context.removeDataById = AttachmentUtil.removeContextDataById.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 设置数据\r\n      state.context.setData = AttachmentUtil.setContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n      // 追加数据\r\n      state.context.appendData = AttachmentUtil.appendToContextData.bind(\r\n        null,\r\n        state.context\r\n      );\r\n    };\r\n\r\n    const getDataValue = (data, field) => {\r\n      if (data) {\r\n        const fieldArr = field.split(\"_\");\r\n        if (fieldArr.length > 1) {\r\n          const newField =\r\n            fieldArr[1].substring(0, 1).toLowerCase() +\r\n            fieldArr[1].substring(1);\r\n          return data[fieldArr[0]][newField];\r\n        }\r\n        return data[field];\r\n      }\r\n      return \"\";\r\n    };\r\n\r\n    return {\r\n      state,\r\n      uploadAttachment,\r\n      removeAttachment,\r\n      selectChange,\r\n      goBack,\r\n      blur,\r\n      toAttachmentDetailPage,\r\n      initContext,\r\n      getDataValue,\r\n    };\r\n  },\r\n  components: {\r\n    \"fm-attachment-entry\": AttachmentEntry,\r\n    \"fm-attachment\": Attachment,\r\n    \"van-nav-bar\": NavBar,\r\n    \"van-popup\": Popup,\r\n    \"van-icon\": Icon,\r\n    \"van-field\": Field,\r\n  },\r\n});\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.van-nav-bar .van-nav-bar__content {\r\n  flex: 1;\r\n}\r\n</style>\r\n",null,"import { createApp, nextTick, reactive, getCurrentInstance } from \"vue\";\r\nimport FarrisMobileUi from '@farris/mobile-ui'\r\nimport Vant from 'vant';\r\nimport FMApprove from './approve'\r\n\r\nlet instance\r\nlet backAfterClose\r\nlet isFirst = false;\r\nfunction useExpose(apis) {\r\n  const instance = getCurrentInstance();\r\n  if (instance) {\r\n    Object.assign(instance.proxy, apis);\r\n  }\r\n}\r\n\r\nfunction usePopupState() {\r\n  const state = reactive({\r\n    show: false,\r\n  });\r\n\r\n  const toggle = (show) => {\r\n    state.show = show;\r\n  };\r\n\r\n  const open = (props) => {\r\n    Object.assign(state, props);\r\n    pushOriginGoback()\r\n    nextTick(() => {\r\n      toggle(true);\r\n    });\r\n  };\r\n\r\n  const close = () => {\r\n    toggle(false);\r\n    popOriginGoback()\r\n    backAfterClose && backAfterClose();\r\n    instance = undefined\r\n  };\r\n\r\n  useExpose({ open, close, toggle });\r\n\r\n  return {\r\n    open,\r\n    close,\r\n    state,\r\n    toggle,\r\n  };\r\n}\r\n\r\nfunction mountComponent(RootComponent) {\r\n  const app = createApp(RootComponent);\r\n  app.use(Vant).use(FarrisMobileUi);\r\n  const root = document.createElement('div');\r\n  document.body.appendChild(root);\r\n\r\n  return {\r\n    instance: app.mount(root),\r\n    unmount() {\r\n      app.unmount(root);\r\n      document.body.removeChild(root);\r\n    },\r\n  };\r\n}\r\n\r\nconst initInstance = () => {\r\n  const a = mountComponent({\r\n    setup() {\r\n      const { state, toggle } = usePopupState()\r\n      return () => <FMApprove {...{ ...state, 'onUpdate:show': toggle }} />\r\n    },\r\n  })\r\n  instance = a.instance\r\n  backAfterClose = a.unmount\r\n}\r\n\r\nfunction pushOriginGoback() {\r\n  if (!isFirst) {\r\n    window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].pushOriginGoback(closeTheInstance)\r\n    isFirst = true\r\n  }\r\n}\r\n\r\nfunction closeTheInstance() {\r\n  isFirst = false\r\n  instance.close()\r\n}\r\n\r\nfunction popOriginGoback() {\r\n  window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].popOriginGoback()\r\n}\r\n\r\nfunction SubmitApprove(options) {\r\n  if (typeof window === 'undefined') {\r\n    return\r\n  }\r\n\r\n  if (!instance) {\r\n    initInstance()\r\n  }\r\n\r\n  console.log('instance', instance)\r\n  instance.open(options)\r\n  return instance\r\n}\r\n\r\nSubmitApprove.clear = () => {\r\n  if (instance) {\r\n    instance.toggle(false)\r\n  }\r\n}\r\n\r\nSubmitApprove.confirm = options => {\r\n  return SubmitApprove(options)\r\n}\r\n\r\n\r\nSubmitApprove.install = app => {\r\n  app.component(FMApprove.name, FMApprove)\r\n}\r\n\r\nSubmitApprove.Component = FMApprove\r\n\r\nexport default SubmitApprove\r\n","import { defineComponent, ref, watch } from 'vue'\r\nimport {\r\n  Popup,\r\n  Navbar,\r\n  LookupInput,\r\n  LookupPanel,\r\n  Picker,\r\n  Button,\r\n} from \"@farris/mobile-ui\";\r\n\r\nexport default defineComponent({\r\n  name: 'fm-approve',\r\n  components: {\r\n    \"fm-popup\": Popup,\r\n    \"fm-navbar\": Navbar,\r\n    \"fm-lookup-input\": LookupInput,\r\n    \"fm-picker\": Picker,\r\n    \"fm-button\": Button,\r\n  },\r\n  props: {\r\n    show: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    processReadFlag: Boolean,\r\n    nextNodeReadFlag: Boolean,\r\n    assigneeReadFlag: Boolean,\r\n    cancelDisabled: Boolean,\r\n    confirmDisabled: Boolean,\r\n    process: [String, Number],\r\n    processOc: Function,\r\n    processData: Array,\r\n    nextNode: [String, Number],\r\n    nextNodeOc: Function,\r\n    nextNodeData: Array,\r\n    assignee: [String, Number],\r\n    assigneeOc: Function,\r\n    assigneeData: Object,\r\n    submit: Function,\r\n    cancel: Function,\r\n    assignInfos: [Object],\r\n    selectedValues: [String],\r\n    multiSelect: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    assigneeHolder: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    nextNodeHolder: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    processHolder: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  emits: [\r\n    \"update:show\",\r\n    \"open\",\r\n    \"close\"\r\n  ],\r\n  setup(props, { attrs, slots, emit }) {\r\n\r\n\r\n    const _processOc = (value) => {\r\n      if (typeof props.processOc === \"function\") {\r\n        props.processOc(value);\r\n      }\r\n    }\r\n    const _nextNodeOc = (value) => {\r\n      if (typeof props.nextNodeOc === \"function\") {\r\n        props.nextNodeOc(value);\r\n      }\r\n    }\r\n    const _assigneeOc = (value, index) => {\r\n      if (typeof props.assigneeOc === \"function\") {\r\n        props.assigneeOc(value, index);\r\n      }\r\n    }\r\n\r\n    const close = () => {\r\n      emit('update:show', false)\r\n    }\r\n\r\n    const $_confirm = () => {\r\n      if (typeof props.submit === \"function\") {\r\n        props.submit();\r\n      }\r\n    }\r\n    const _cancel = () => {\r\n      close()\r\n      if (typeof props.cancel === \"function\") {\r\n        props.cancel();\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      const {\r\n        process = '',\r\n        processOc,\r\n        processData = [],\r\n        nextNode = '',\r\n        nextNodeOc,\r\n        nextNodeData = [],\r\n        assignee,\r\n        assigneeOc,\r\n        assigneeData,\r\n        submit,\r\n        cancel,\r\n        selectedValues = [],\r\n        processReadFlag,\r\n        nextNodeReadFlag,\r\n        assigneeReadFlag,\r\n        cancelDisabled,\r\n        confirmDisabled,\r\n        multiSelect,\r\n        assigneeHolder,\r\n        nextNodeHolder,\r\n        processHolder,\r\n        assignInfos = []\r\n      } = props\r\n\r\n      // watch(props, (newValue, oldValue) => {\r\n      //   console.log('The new counter value is:newValue ', newValue)\r\n\r\n      //   console.log('The new counter value is: oldValue', oldValue)\r\n\r\n      //   console.log('The new counter value is: ', props)\r\n      // })\r\n\r\n      return (\r\n        <div >\r\n          <fm-popup\r\n            show={props.show}\r\n            position=\"right\"\r\n            style=\"width:100%\"\r\n          >\r\n            <div class=\"fm-submit-approve\">\r\n              <div class=\"fm-submit-approve-header\">\r\n                <fm-navbar title=\"流程选择\" leftArrow={true} onClickLeft={_cancel} />\r\n              </div>\r\n              <div class=\"fm-submit-approve-main\">\r\n                <div class=\"fm-submit-approve-form\">\r\n                  <fm-picker\r\n                    name=\"picker\"\r\n                    v-model={process}\r\n                    label=\"选择流程\"\r\n                    placeholder={processHolder}\r\n                    onChange={_processOc}\r\n                    show-toolbar\r\n                    data={processData}\r\n                    readonly={processReadFlag}\r\n                    textField=\"name\"\r\n                    valueField=\"id\"\r\n                    mapFields={{ id: 'id' }}\r\n                  ></fm-picker>\r\n                  <fm-picker\r\n                    name=\"picker\"\r\n                    v-model={nextNode}\r\n                    label=\"下一环节\"\r\n                    placeholder={nextNodeHolder}\r\n                    onChange={_nextNodeOc}\r\n                    show-toolbar\r\n                    data={nextNodeData}\r\n                    readonly={nextNodeReadFlag}\r\n                    textField=\"name\"\r\n                    valueField=\"id\"\r\n                    mapFields={{ id: 'id' }}\r\n                  ></fm-picker>\r\n                  {\r\n\r\n                    assignInfos.map(\r\n                      (item, index) => {\r\n                        return <fm-lookup-input\r\n                          name=\"lookup-input\"\r\n                          v-model={item.assignee}\r\n                          placeholder={item.assigneeHolder}\r\n                          label={item.label}\r\n                          idField=\"id\"\r\n                          textField=\"name\"\r\n                          data={item.assigneeInfo.assigneeUsers}\r\n                          readonly={item.assigneeReadFlag}\r\n                          multiSelect={item.assigneeInfo && item.assigneeInfo.multiSelect}\r\n                          selectedValues={selectedValues[index] === 'clear' ? '' : selectedValues[index]}\r\n                          onValueChange={(e) => { _assigneeOc(e, index) }}\r\n                        ></fm-lookup-input>\r\n                      }\r\n                    )\r\n                  }\r\n                </div>\r\n                <div class=\"fm-submit-approve-btn\">\r\n                  <fm-button\r\n                    type=\"info\"\r\n                    round\r\n                    block\r\n                    key=\"confirm\"\r\n                    disabled={confirmDisabled}\r\n                    onClick={$_confirm}\r\n                  >确定</fm-button\r\n                  >\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </fm-popup>\r\n        </div>\r\n      )\r\n    }\r\n  },\r\n})\r\n","import { createApp, nextTick, reactive, getCurrentInstance } from \"vue\";\r\nimport FarrisMobileUi from \"@farris/mobile-ui\";\r\nimport Vant from \"vant\";\r\nimport FMAttachmentPreview from \"./attachment-preview\";\r\n\r\nlet instance;\r\nlet backAfterClose;\r\nlet isFirst = false;\r\nfunction useExpose(apis) {\r\n  const instance = getCurrentInstance();\r\n  if (instance) {\r\n    Object.assign(instance.proxy, apis);\r\n  }\r\n}\r\n\r\nfunction usePopupState() {\r\n  const state = reactive({\r\n    show: false,\r\n  });\r\n\r\n  const toggle = (show) => {\r\n    state.show = show;\r\n  };\r\n\r\n  const open = (props) => {\r\n    Object.assign(state, props);\r\n    pushOriginGoback();\r\n    if (window.top && window.top !== window.self) {\r\n      openScale(window.top.document);\r\n    }\r\n    openScale(window.document);\r\n    nextTick(() => {\r\n      toggle(true);\r\n    });\r\n  };\r\n\r\n  const close = () => {\r\n    toggle(false);\r\n    popOriginGoback();\r\n    if (window.top && window.top !== window.self) {\r\n      closeScale(window.top.document);\r\n    }\r\n    closeScale(window.document);\r\n    backAfterClose && backAfterClose();\r\n    instance = undefined;\r\n  };\r\n\r\n  useExpose({ open, close, toggle });\r\n\r\n  return {\r\n    open,\r\n    close,\r\n    state,\r\n    toggle,\r\n  };\r\n}\r\n\r\nfunction mountComponent(RootComponent) {\r\n  const app = createApp(RootComponent);\r\n  app.use(Vant).use(FarrisMobileUi);\r\n  const root = document.createElement(\"div\");\r\n  document.body.appendChild(root);\r\n\r\n  return {\r\n    instance: app.mount(root),\r\n    unmount() {\r\n      app.unmount(root);\r\n      document.body.removeChild(root);\r\n    },\r\n  };\r\n}\r\n\r\nconst initInstance = () => {\r\n  const cmp = mountComponent({\r\n    setup() {\r\n      const { state, toggle } = usePopupState();\r\n      return () => (\r\n        <FMAttachmentPreview {...{ ...state, \"onUpdate:show\": toggle }} />\r\n      );\r\n    },\r\n  });\r\n  instance = cmp.instance;\r\n  backAfterClose = cmp.unmount;\r\n};\r\n\r\nfunction pushOriginGoback() {\r\n  if (!isFirst) {\r\n    window[\"MOBILE_ORIGIN_BACK\"] &&\r\n      window[\"MOBILE_ORIGIN_BACK\"].pushOriginGoback(closeTheInstance);\r\n    isFirst = true;\r\n  }\r\n}\r\n\r\nfunction closeTheInstance() {\r\n  isFirst = false;\r\n  instance.close();\r\n}\r\n\r\nfunction popOriginGoback() {\r\n  window[\"MOBILE_ORIGIN_BACK\"] &&\r\n    window[\"MOBILE_ORIGIN_BACK\"].popOriginGoback();\r\n}\r\n\r\nfunction AttachmentPreview(options) {\r\n  if (typeof window === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  if (!instance) {\r\n    initInstance();\r\n  }\r\n  instance.open(options);\r\n  return instance;\r\n}\r\n\r\nfunction openScale(currentDoc) {\r\n  const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n  const meta = currentDoc.createElement(\"meta\");\r\n  meta.name = \"viewport\";\r\n  meta.content = \"width=device-width, initial-scale=1.0\";\r\n  const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n  if (originMeta) {\r\n    head.removeChild(originMeta);\r\n  }\r\n  head.appendChild(meta);\r\n}\r\n\r\nfunction closeScale(currentDoc) {\r\n  const originMeta = currentDoc.getElementsByName(\"viewport\")[0];\r\n  const meta = currentDoc.createElement(\"meta\");\r\n  meta.name = \"viewport\";\r\n  meta.content =\r\n    \"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n\";\r\n  const head = currentDoc.getElementsByTagName(\"head\")[0];\r\n  if (originMeta) {\r\n    head.removeChild(originMeta);\r\n  }\r\n  head.appendChild(meta);\r\n}\r\n\r\nAttachmentPreview.close = () => {\r\n  if (instance) {\r\n    instance.toggle(false);\r\n  }\r\n};\r\n\r\nAttachmentPreview.show = (options) => {\r\n  return AttachmentPreview(options);\r\n};\r\n\r\nAttachmentPreview.install = (app) => {\r\n  app.component(FMAttachmentPreview.name, FMAttachmentPreview);\r\n};\r\n\r\nAttachmentPreview.Component = FMAttachmentPreview;\r\nexport default AttachmentPreview;\r\n","import { defineComponent, ref, watch, reactive, computed } from \"vue\";\r\nimport { Popup, Navbar } from \"@farris/mobile-ui\";\r\n\r\nexport default defineComponent({\r\n  name: \"fm-attachment-preview\",\r\n  components: {\r\n    \"fm-popup\": Popup,\r\n    \"fm-navbar\": Navbar,\r\n  },\r\n  props: {\r\n    title: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    attachmentId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    rootId: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    show: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    path: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n  },\r\n  emits: [\"update:show\", \"open\", \"close\"],\r\n  setup(props, { emit }) {\r\n    const close = () => {\r\n      emit(\"update:show\", false);\r\n    };\r\n    const state = reactive({\r\n      attachmentUrl: computed(() => {\r\n        return `/platform/runtime/dfs/viewpage/index.html?metadataId=${props.attachmentId}&rootId=${props.rootId}&fileType=2`;\r\n      }),\r\n      show: false,\r\n    });\r\n    return () => {\r\n      return (\r\n        <div>\r\n          <fm-popup show={props.show} style=\"width:100%;height:100%\">\r\n            <fm-navbar title={props.title} onClickLeft={close}>\r\n              {/* <template #left>\r\n              <van-icon name=\"arrow-left\" size=\"18\" color=\"#333\"></van-icon>\r\n            </template> */}\r\n            </fm-navbar>\r\n            <iframe\r\n              class=\"pdf-iframe\"\r\n              scrolling=\"yes\"\r\n              src={props.path || state.attachmentUrl}\r\n              width=\"100%\"\r\n              height=\"100%\"\r\n            ></iframe>\r\n          </fm-popup>\r\n        </div>\r\n      );\r\n    };\r\n  },\r\n});\r\n","<template>\r\n  <div ref=\"el\" class=\"el-vue-amap-container\">\r\n    <div class=\"el-vue-amap\"></div>\r\n    <slot></slot>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  computed,\r\n  onBeforeMount,\r\n  onMounted,\r\n  onUnmounted,\r\n  reactive,\r\n  ref,\r\n  watch,\r\n} from \"vue\";\r\nimport { lazyAMapApiLoaderInstance, MapPlugin, guid } from \"../service\";\r\n\r\nexport default {\r\n  name: \"el-amap\",\r\n  props: [\r\n    //  add v1.4.0 new feature\r\n    \"viewMode\",\r\n    \"skyColor\",\r\n    \"rotateEnable\",\r\n    \"pitch\",\r\n    \"buildingAnimation\",\r\n    \"pitchEnable\",\r\n    \"vid\",\r\n    \"events\",\r\n    \"center\",\r\n    \"zoom\",\r\n    \"draggEnable\",\r\n    \"level\",\r\n    \"zooms\",\r\n    \"lang\",\r\n    \"defaultCursor\",\r\n    \"crs\",\r\n    \"animateEnable\",\r\n    \"isHotspot\",\r\n    \"defaultLayer\",\r\n    \"resizeEnable\",\r\n    \"showIndoorMap\",\r\n    \"indoorMap\",\r\n    \"expandZoomRange\",\r\n    \"dragEnable\",\r\n    \"zoomEnable\",\r\n    \"doubleClickZoom\",\r\n    \"keyboardEnable\",\r\n    \"jogEnable\",\r\n    \"scrollWheel\",\r\n    \"touchZoom\",\r\n    \"mapStyle\",\r\n    \"plugin\",\r\n    \"features\",\r\n    \"amapManager\", // 地图管理 manager\r\n    \"markers\",\r\n  ],\r\n  setup(props, { emit, attrs, slots }) {\r\n    const el = ref(null);\r\n    const state = reactive({\r\n      converters: {\r\n        center(arr) {\r\n          if (\r\n            Object.prototype.toString.call(arr) === \"[object Array]\" &&\r\n            arr[0] &&\r\n            arr[1]\r\n          ) {\r\n            return new AMap.LngLat(arr[0], arr[1]);\r\n          }\r\n        },\r\n      },\r\n      $amap: \"\",\r\n      $amapComponent: \"\",\r\n      loadPromise: null,\r\n      circleMarker: \"\",\r\n      plugins: computed(() => {\r\n        let plus = [];\r\n        //地图前缀\r\n        const amap_prefix_reg = /^AMap./;\r\n\r\n        //  获取带前缀的名称\r\n        const parseFullName = (pluginName) => {\r\n          return amap_prefix_reg.test(pluginName)\r\n            ? pluginName\r\n            : \"AMap.\" + pluginName;\r\n        };\r\n\r\n        // 获取不带前缀的名称\r\n        const parseShortName = (pluginName) => {\r\n          return pluginName.replace(amap_prefix_reg, \"\");\r\n        };\r\n\r\n        if (typeof props.plugin === \"string\") {\r\n          plus.push({\r\n            pName: parseFullName(props.plugin),\r\n            sName: parseShortName(props.plugin),\r\n          });\r\n        } else if (props.plugin instanceof Array) {\r\n          plus = props.plugin.map((oPlugin) => {\r\n            let nPlugin = {};\r\n\r\n            if (typeof oPlugin === \"string\") {\r\n              nPlugin = {\r\n                pName: parseFullName(oPlugin),\r\n                sName: parseShortName(oPlugin),\r\n              };\r\n            } else {\r\n              oPlugin.pName = parseFullName(oPlugin.pName);\r\n              oPlugin.sName = parseShortName(oPlugin.pName);\r\n              nPlugin = oPlugin;\r\n            }\r\n            return nPlugin;\r\n          });\r\n        }\r\n        return plus;\r\n      }),\r\n    });\r\n    // 挂载前  加载地图脚本\r\n    onBeforeMount(() => {\r\n      state.loadPromise = lazyAMapApiLoaderInstance.load();\r\n    });\r\n    watch(\r\n      () => props.center,\r\n      (newValue, oldValue) => {\r\n        if (state.$amapComponent) {\r\n          const map = state.$amapComponent;\r\n          map.setCenter(newValue);\r\n          emit(\"setCircleMarker\", newValue, map);\r\n        }\r\n      }\r\n    );\r\n    // 加载地图\r\n    onMounted(() => {\r\n      createMap();\r\n    });\r\n    onUnmounted(() => {\r\n      state.$amap.destroy();\r\n    });\r\n    const createMap = () => {\r\n      state.loadPromise.then(() => {\r\n        // 构造地图\r\n        const mapElement = el.value.querySelector(\".el-vue-amap\");\r\n        const elementID = props.vid || guid();\r\n        mapElement.id = elementID;\r\n        state.$amap = state.$amapComponent = new AMap.Map(\r\n          elementID,\r\n          convertProps()\r\n        );\r\n        if (props.amapManager) props.amapManager.setMap(state.$amap);\r\n        // emit(CONST.AMAP_READY_EVENT, this.$amap);\r\n        // 添加插件\r\n        if (state.plugins && state.plugins.length) {\r\n          const mapPlugin = new MapPlugin();\r\n          mapPlugin.addPlugins(state.$amapComponent, state.plugins);\r\n        }\r\n        // 注册事件\r\n        if (props.events) {\r\n          Object.keys(props.events).forEach((eventName) => {\r\n            AMap.event.addListener(\r\n              state.$amapComponent,\r\n              eventName,\r\n              props.events[eventName]\r\n            );\r\n          });\r\n        }\r\n        emit(\"afterInit\", props.center, state.$amapComponent);\r\n      });\r\n    };\r\n    const convertProps = () => {\r\n      const propsObj = {};\r\n      if (state.$amap) propsObj.map = state.$amap;\r\n      return Object.keys(props).reduce((res, _key) => {\r\n        const key = _key;\r\n        const propsValue = convertSignalProp(key, props[key]);\r\n        if (propsValue === undefined) return res;\r\n        propsObj[key] = propsValue;\r\n        return res;\r\n      }, propsObj);\r\n    };\r\n    const convertSignalProp = (key, sourceData) => {\r\n      const converter = \"\";\r\n      const type = \"\";\r\n      if (type && converter) {\r\n        return converter(sourceData);\r\n      } else if (state.converters && state.converters[key]) {\r\n        return state.converters[key].call(this, sourceData);\r\n      }\r\n      return sourceData;\r\n    };\r\n\r\n    return {\r\n      el,\r\n      state,\r\n      createMap,\r\n      convertProps,\r\n      convertSignalProp,\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.el-vue-amap-container {\r\n  height: 100%;\r\n  & .el-vue-amap {\r\n    height: 100%;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div ref=\"el\" class=\"el-vue-amap-container\">\r\n    <div class=\"el-vue-amap\"></div>\r\n    <slot></slot>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  computed,\r\n  onBeforeMount,\r\n  onMounted,\r\n  onUnmounted,\r\n  reactive,\r\n  ref,\r\n  watch,\r\n} from \"vue\";\r\nimport { lazyAMapApiLoaderInstance, MapPlugin, guid } from \"../service\";\r\n\r\nexport default {\r\n  name: \"el-amap\",\r\n  props: [\r\n    //  add v1.4.0 new feature\r\n    \"viewMode\",\r\n    \"skyColor\",\r\n    \"rotateEnable\",\r\n    \"pitch\",\r\n    \"buildingAnimation\",\r\n    \"pitchEnable\",\r\n    \"vid\",\r\n    \"events\",\r\n    \"center\",\r\n    \"zoom\",\r\n    \"draggEnable\",\r\n    \"level\",\r\n    \"zooms\",\r\n    \"lang\",\r\n    \"defaultCursor\",\r\n    \"crs\",\r\n    \"animateEnable\",\r\n    \"isHotspot\",\r\n    \"defaultLayer\",\r\n    \"resizeEnable\",\r\n    \"showIndoorMap\",\r\n    \"indoorMap\",\r\n    \"expandZoomRange\",\r\n    \"dragEnable\",\r\n    \"zoomEnable\",\r\n    \"doubleClickZoom\",\r\n    \"keyboardEnable\",\r\n    \"jogEnable\",\r\n    \"scrollWheel\",\r\n    \"touchZoom\",\r\n    \"mapStyle\",\r\n    \"plugin\",\r\n    \"features\",\r\n    \"amapManager\", // 地图管理 manager\r\n    \"markers\",\r\n  ],\r\n  setup(props, { emit, attrs, slots }) {\r\n    const el = ref(null);\r\n    const state = reactive({\r\n      converters: {\r\n        center(arr) {\r\n          if (\r\n            Object.prototype.toString.call(arr) === \"[object Array]\" &&\r\n            arr[0] &&\r\n            arr[1]\r\n          ) {\r\n            return new AMap.LngLat(arr[0], arr[1]);\r\n          }\r\n        },\r\n      },\r\n      $amap: \"\",\r\n      $amapComponent: \"\",\r\n      loadPromise: null,\r\n      circleMarker: \"\",\r\n      plugins: computed(() => {\r\n        let plus = [];\r\n        //地图前缀\r\n        const amap_prefix_reg = /^AMap./;\r\n\r\n        //  获取带前缀的名称\r\n        const parseFullName = (pluginName) => {\r\n          return amap_prefix_reg.test(pluginName)\r\n            ? pluginName\r\n            : \"AMap.\" + pluginName;\r\n        };\r\n\r\n        // 获取不带前缀的名称\r\n        const parseShortName = (pluginName) => {\r\n          return pluginName.replace(amap_prefix_reg, \"\");\r\n        };\r\n\r\n        if (typeof props.plugin === \"string\") {\r\n          plus.push({\r\n            pName: parseFullName(props.plugin),\r\n            sName: parseShortName(props.plugin),\r\n          });\r\n        } else if (props.plugin instanceof Array) {\r\n          plus = props.plugin.map((oPlugin) => {\r\n            let nPlugin = {};\r\n\r\n            if (typeof oPlugin === \"string\") {\r\n              nPlugin = {\r\n                pName: parseFullName(oPlugin),\r\n                sName: parseShortName(oPlugin),\r\n              };\r\n            } else {\r\n              oPlugin.pName = parseFullName(oPlugin.pName);\r\n              oPlugin.sName = parseShortName(oPlugin.pName);\r\n              nPlugin = oPlugin;\r\n            }\r\n            return nPlugin;\r\n          });\r\n        }\r\n        return plus;\r\n      }),\r\n    });\r\n    // 挂载前  加载地图脚本\r\n    onBeforeMount(() => {\r\n      state.loadPromise = lazyAMapApiLoaderInstance.load();\r\n    });\r\n    watch(\r\n      () => props.center,\r\n      (newValue, oldValue) => {\r\n        if (state.$amapComponent) {\r\n          const map = state.$amapComponent;\r\n          map.setCenter(newValue);\r\n          emit(\"setCircleMarker\", newValue, map);\r\n        }\r\n      }\r\n    );\r\n    // 加载地图\r\n    onMounted(() => {\r\n      createMap();\r\n    });\r\n    onUnmounted(() => {\r\n      state.$amap.destroy();\r\n    });\r\n    const createMap = () => {\r\n      state.loadPromise.then(() => {\r\n        // 构造地图\r\n        const mapElement = el.value.querySelector(\".el-vue-amap\");\r\n        const elementID = props.vid || guid();\r\n        mapElement.id = elementID;\r\n        state.$amap = state.$amapComponent = new AMap.Map(\r\n          elementID,\r\n          convertProps()\r\n        );\r\n        if (props.amapManager) props.amapManager.setMap(state.$amap);\r\n        // emit(CONST.AMAP_READY_EVENT, this.$amap);\r\n        // 添加插件\r\n        if (state.plugins && state.plugins.length) {\r\n          const mapPlugin = new MapPlugin();\r\n          mapPlugin.addPlugins(state.$amapComponent, state.plugins);\r\n        }\r\n        // 注册事件\r\n        if (props.events) {\r\n          Object.keys(props.events).forEach((eventName) => {\r\n            AMap.event.addListener(\r\n              state.$amapComponent,\r\n              eventName,\r\n              props.events[eventName]\r\n            );\r\n          });\r\n        }\r\n        emit(\"afterInit\", props.center, state.$amapComponent);\r\n      });\r\n    };\r\n    const convertProps = () => {\r\n      const propsObj = {};\r\n      if (state.$amap) propsObj.map = state.$amap;\r\n      return Object.keys(props).reduce((res, _key) => {\r\n        const key = _key;\r\n        const propsValue = convertSignalProp(key, props[key]);\r\n        if (propsValue === undefined) return res;\r\n        propsObj[key] = propsValue;\r\n        return res;\r\n      }, propsObj);\r\n    };\r\n    const convertSignalProp = (key, sourceData) => {\r\n      const converter = \"\";\r\n      const type = \"\";\r\n      if (type && converter) {\r\n        return converter(sourceData);\r\n      } else if (state.converters && state.converters[key]) {\r\n        return state.converters[key].call(this, sourceData);\r\n      }\r\n      return sourceData;\r\n    };\r\n\r\n    return {\r\n      el,\r\n      state,\r\n      createMap,\r\n      convertProps,\r\n      convertSignalProp,\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style scoped lang=\"scss\">\r\n.el-vue-amap-container {\r\n  height: 100%;\r\n  & .el-vue-amap {\r\n    height: 100%;\r\n  }\r\n}\r\n</style>\r\n",null,"<template>\r\n  <div>\r\n    <div :style=\"{ width: width, height: height }\">\r\n      <el-amap\r\n        ref=\"map\"\r\n        vid=\"amapDemo\"\r\n        :resizeEnable=\"resizeEnable\"\r\n        :dragEnable=\"dragEnable\"\r\n        :zoomEnable=\"zoomEnable\"\r\n        :center=\"center\"\r\n        :zoom=\"zoom\"\r\n        :plugin=\"plugin\"\r\n        :events=\"events\"\r\n        :amapManager=\"amapManager\"\r\n        @afterInit=\"afterInit\"\r\n        @setCircleMarker=\"afterInit\"\r\n      >\r\n      </el-amap>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent, ref } from \"vue\";\r\nimport VueAMap, { AMapManager } from \"./index\";\r\n\r\nexport default defineComponent({\r\n  name: \"fm-map\",\r\n  components: {},\r\n  inject: {\r\n    mapService: { default: null },\r\n  },\r\n  props: {\r\n    width: {\r\n      type: String,\r\n      default: \"100%\",\r\n    },\r\n    height: {\r\n      type: String,\r\n      default: \"400px\",\r\n    },\r\n    zoomEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    dragEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    resizeEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    zoom: {\r\n      type: Number,\r\n      default: 12,\r\n    },\r\n    center: {\r\n      type: Array,\r\n      default: () => [0, 0],\r\n    },\r\n    markers: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    limitCity: {\r\n      type: String,\r\n      default: \"山东\",\r\n    },\r\n    limitSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    showSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    mapKey: {\r\n      type: String,\r\n      default: \"ee46e4ad4d6e45789dc9f2754271e2a6\",\r\n    },\r\n    displayDireaction: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  created() {\r\n    VueAMap.initAMapApiLoader({\r\n      key: this.mapKey,\r\n      plugin: [\r\n        \"AMap.Autocomplete\",\r\n        \"AMap.PlaceSearch\",\r\n        \"AMap.Scale\",\r\n        \"AMap.OverView\",\r\n        \"AMap.Geolocation\",\r\n        \"AMap.ToolBar\",\r\n        \"AMap.MapType\",\r\n        \"AMap.PolyEditor\",\r\n        \"AMap.CircleEditor\",\r\n        \"AMap.Geocoder\",\r\n      ],\r\n      // 默认高德 sdk 版本为 1.4.4\r\n      v: \"1.4.4\",\r\n    });\r\n  },\r\n  mounted() {},\r\n  unmounted() {\r\n    if (this.mapMarkers && this.mapMarkers.length) {\r\n      this.emptyMarkers();\r\n    }\r\n  },\r\n  data() {\r\n    const self = this;\r\n    return {\r\n      amapManager: new AMapManager(),\r\n      subject: null,\r\n      mapMarkers: [],\r\n      // amapManager,\r\n      defaultCenter: [0, 0],\r\n      events: {\r\n        init: (o) => {\r\n          this.addMarkers(this.markers, o);\r\n        },\r\n        zoomchange: () => {\r\n          this.$emit(\"zoomChange\");\r\n        },\r\n        click: (e) => {\r\n          const geocoder = new AMap.Geocoder({\r\n            radius: 1000,\r\n            extensions: \"all\",\r\n          });\r\n          const that = this;\r\n          let address = \"\";\r\n          geocoder.getAddress([e.lnglat.lng, e.lnglat.lat], function(\r\n            status,\r\n            result\r\n          ) {\r\n            if (status === \"complete\" && result.info === \"OK\") {\r\n              if (result && result.regeocode) {\r\n                address = result.regeocode.formattedAddress;\r\n                e.address = address;\r\n                that.$emit(\"markMap\", e);\r\n                // 设置位置\r\n                // 显示位置\r\n              }\r\n            }\r\n          });\r\n        },\r\n      },\r\n      plugin: [\r\n        {\r\n          pName: \"Scale\",\r\n          events: {\r\n            init(instance) {},\r\n          },\r\n        },\r\n        {\r\n          pName: \"Geolocation\", //定位\r\n          events: {\r\n            init(o) {\r\n              //   if (!self.center || self.center[0] == 0 || self.center[1] == 0) {\r\n              //     o.getCurrentPosition((status, result) => {\r\n              //       if (result && result.position) {\r\n              //         // 设置中心点\r\n              //         self.defaultCenter = [\r\n              //           result.position.lng,\r\n              //           result.position.lat,\r\n              //         ]; //设置坐标\r\n              //         // 设置点坐标\r\n              //         // const map = self.amapManager.getMap();\r\n              //         self.resetMarkers(self.markers);\r\n              //         self.$nextTick(); //页面渲染好后\r\n              //         self.$emit(\"getCurrentLocation\", result);\r\n              //       }\r\n              //     });\r\n              //   }\r\n            },\r\n          },\r\n          // 禁止移动端浏览器定位\r\n          noGeoLocation: 1,\r\n          // 外网访问\r\n          // noGeoLocation: 0,\r\n          enableHighAccuracy: false, //是否使用高精度定位，默认:true\r\n          timeout: 10000, //超过10秒后停止定位，默认：无穷大\r\n          maximumAge: 0, //定位结果缓存0毫秒，默认：0\r\n          convert: true, //自动偏移坐标，偏移后的坐标为高德坐标，默认：true\r\n          showButton:\r\n            !self.center || self.center[0] == 0 || self.center[1] == 0, //显示定位按钮，默认：true\r\n          buttonPosition: \"LB\", //定位按钮停靠位置，默认：'LB'，左下角\r\n          //buttonOffset: window.AMap&&new window.AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)\r\n          showMarker: true, //定位成功后在定位到的位置显示点标记，默认：true\r\n          showCircle: true, //定位成功后用圆圈表示定位精度范围，默认：true\r\n          panToLocation: true, //定位成功后将定位到的位置作为地图中心点，默认：true\r\n          zoomToAccuracy: true, //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false\r\n        },\r\n      ],\r\n      markerEvents: {\r\n        click: (e) => {\r\n          // 点击事件  返回坐标\r\n          this.$emit(\"clickMaker\", e);\r\n        },\r\n        dragend: (e) => {\r\n          // 拖拽结束事件  返回坐标\r\n          // this.markers[0].position = [e.lnglat.lng, e.lnglat.lat];\r\n          this.$emit(\"dragMarkerEnd\", e);\r\n        },\r\n      },\r\n      defaultMarkers: [],\r\n      mapCenter: \"\",\r\n    };\r\n  },\r\n  watch: {\r\n    markers(value) {\r\n      if (window.AMap && value) {\r\n        this.resetMarkers(value);\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    computedMarkers() {\r\n      if (!this.markers) {\r\n        return [];\r\n      }\r\n      if (window.AMap) {\r\n        // this.resetMarkers(this.markers);\r\n      }\r\n      return this.markers.length ? this.markers : this.defaultMarkers;\r\n    },\r\n    computedCenter() {\r\n      return this.center || this.defaultCenter;\r\n    },\r\n  },\r\n  methods: {\r\n    getPosition() {\r\n      this.mapService.getCurrentLocation();\r\n    },\r\n    afterInit(center, map): void {\r\n      this.addMarkers(this.markers, map);\r\n      if (\r\n        Object.prototype.toString.call(this.center) === \"[object Array]\" &&\r\n        this.center[0] &&\r\n        this.center[1]\r\n      ) {\r\n        const circleMarker = new AMap.CircleMarker({\r\n          center,\r\n          radius: 10, //3D视图下，CircleMarker半径不要超过64px\r\n          strokeColor: \"white\",\r\n          strokeWeight: 2,\r\n          strokeOpacity: 0.5,\r\n          fillColor: \"rgba(30,144,255)\",\r\n          fillOpacity: 0.5,\r\n          zIndex: 10,\r\n          bubble: true,\r\n          cursor: \"pointer\",\r\n          clickable: true,\r\n        });\r\n        circleMarker.setMap(map);\r\n      }\r\n      this.resetMarkers(this.markers);\r\n    },\r\n    getCurrentLocation() {},\r\n    onSearchResult(e) {},\r\n    getCenter() {\r\n      return this.$refs.map.$$getCenter();\r\n    },\r\n    getCurrentPosition() {},\r\n    // 添加坐标\r\n    addMarkers(markers, map) {\r\n      // const map = this.amapManager.getMap();\r\n      const mapMarkers = markers.map((marker) => {\r\n        return new AMap.Marker({\r\n          position: marker.position,\r\n        });\r\n      });\r\n      // 存储坐标\r\n      this.mapMarkers = [...mapMarkers];\r\n      this.mapMarkers.forEach((ele) => {\r\n        map.add(ele);\r\n      });\r\n    },\r\n    removeMarkers() {},\r\n    emptyMarkers() {\r\n      const map = this.amapManager.getMap();\r\n      map.remove(this.mapMarkers);\r\n      this.mapMarkers.splice(0, this.mapMarkers.length);\r\n    },\r\n    resetMarkers(markers) {\r\n      this.emptyMarkers();\r\n      this.addMarkers(markers, this.amapManager.getMap());\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.farris-mobile-map {\r\n  width: 100%;\r\n  height: 450px;\r\n}\r\n.amap-logo {\r\n  visibility: hidden;\r\n}\r\n.amap-scalecontrol {\r\n  visibility: hidden !important;\r\n}\r\n.amap-copyright {\r\n  visibility: hidden !important;\r\n}\r\n</style>\r\n","<template>\r\n  <div>\r\n    <div :style=\"{ width: width, height: height }\">\r\n      <el-amap\r\n        ref=\"map\"\r\n        vid=\"amapDemo\"\r\n        :resizeEnable=\"resizeEnable\"\r\n        :dragEnable=\"dragEnable\"\r\n        :zoomEnable=\"zoomEnable\"\r\n        :center=\"center\"\r\n        :zoom=\"zoom\"\r\n        :plugin=\"plugin\"\r\n        :events=\"events\"\r\n        :amapManager=\"amapManager\"\r\n        @afterInit=\"afterInit\"\r\n        @setCircleMarker=\"afterInit\"\r\n      >\r\n      </el-amap>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { defineComponent, ref } from \"vue\";\r\nimport VueAMap, { AMapManager } from \"./index\";\r\n\r\nexport default defineComponent({\r\n  name: \"fm-map\",\r\n  components: {},\r\n  inject: {\r\n    mapService: { default: null },\r\n  },\r\n  props: {\r\n    width: {\r\n      type: String,\r\n      default: \"100%\",\r\n    },\r\n    height: {\r\n      type: String,\r\n      default: \"400px\",\r\n    },\r\n    zoomEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    dragEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    resizeEnable: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    zoom: {\r\n      type: Number,\r\n      default: 12,\r\n    },\r\n    center: {\r\n      type: Array,\r\n      default: () => [0, 0],\r\n    },\r\n    markers: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    limitCity: {\r\n      type: String,\r\n      default: \"山东\",\r\n    },\r\n    limitSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    showSearch: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    mapKey: {\r\n      type: String,\r\n      default: \"ee46e4ad4d6e45789dc9f2754271e2a6\",\r\n    },\r\n    displayDireaction: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  created() {\r\n    VueAMap.initAMapApiLoader({\r\n      key: this.mapKey,\r\n      plugin: [\r\n        \"AMap.Autocomplete\",\r\n        \"AMap.PlaceSearch\",\r\n        \"AMap.Scale\",\r\n        \"AMap.OverView\",\r\n        \"AMap.Geolocation\",\r\n        \"AMap.ToolBar\",\r\n        \"AMap.MapType\",\r\n        \"AMap.PolyEditor\",\r\n        \"AMap.CircleEditor\",\r\n        \"AMap.Geocoder\",\r\n      ],\r\n      // 默认高德 sdk 版本为 1.4.4\r\n      v: \"1.4.4\",\r\n    });\r\n  },\r\n  mounted() {},\r\n  unmounted() {\r\n    if (this.mapMarkers && this.mapMarkers.length) {\r\n      this.emptyMarkers();\r\n    }\r\n  },\r\n  data() {\r\n    const self = this;\r\n    return {\r\n      amapManager: new AMapManager(),\r\n      subject: null,\r\n      mapMarkers: [],\r\n      // amapManager,\r\n      defaultCenter: [0, 0],\r\n      events: {\r\n        init: (o) => {\r\n          this.addMarkers(this.markers, o);\r\n        },\r\n        zoomchange: () => {\r\n          this.$emit(\"zoomChange\");\r\n        },\r\n        click: (e) => {\r\n          const geocoder = new AMap.Geocoder({\r\n            radius: 1000,\r\n            extensions: \"all\",\r\n          });\r\n          const that = this;\r\n          let address = \"\";\r\n          geocoder.getAddress([e.lnglat.lng, e.lnglat.lat], function(\r\n            status,\r\n            result\r\n          ) {\r\n            if (status === \"complete\" && result.info === \"OK\") {\r\n              if (result && result.regeocode) {\r\n                address = result.regeocode.formattedAddress;\r\n                e.address = address;\r\n                that.$emit(\"markMap\", e);\r\n                // 设置位置\r\n                // 显示位置\r\n              }\r\n            }\r\n          });\r\n        },\r\n      },\r\n      plugin: [\r\n        {\r\n          pName: \"Scale\",\r\n          events: {\r\n            init(instance) {},\r\n          },\r\n        },\r\n        {\r\n          pName: \"Geolocation\", //定位\r\n          events: {\r\n            init(o) {\r\n              //   if (!self.center || self.center[0] == 0 || self.center[1] == 0) {\r\n              //     o.getCurrentPosition((status, result) => {\r\n              //       if (result && result.position) {\r\n              //         // 设置中心点\r\n              //         self.defaultCenter = [\r\n              //           result.position.lng,\r\n              //           result.position.lat,\r\n              //         ]; //设置坐标\r\n              //         // 设置点坐标\r\n              //         // const map = self.amapManager.getMap();\r\n              //         self.resetMarkers(self.markers);\r\n              //         self.$nextTick(); //页面渲染好后\r\n              //         self.$emit(\"getCurrentLocation\", result);\r\n              //       }\r\n              //     });\r\n              //   }\r\n            },\r\n          },\r\n          // 禁止移动端浏览器定位\r\n          noGeoLocation: 1,\r\n          // 外网访问\r\n          // noGeoLocation: 0,\r\n          enableHighAccuracy: false, //是否使用高精度定位，默认:true\r\n          timeout: 10000, //超过10秒后停止定位，默认：无穷大\r\n          maximumAge: 0, //定位结果缓存0毫秒，默认：0\r\n          convert: true, //自动偏移坐标，偏移后的坐标为高德坐标，默认：true\r\n          showButton:\r\n            !self.center || self.center[0] == 0 || self.center[1] == 0, //显示定位按钮，默认：true\r\n          buttonPosition: \"LB\", //定位按钮停靠位置，默认：'LB'，左下角\r\n          //buttonOffset: window.AMap&&new window.AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)\r\n          showMarker: true, //定位成功后在定位到的位置显示点标记，默认：true\r\n          showCircle: true, //定位成功后用圆圈表示定位精度范围，默认：true\r\n          panToLocation: true, //定位成功后将定位到的位置作为地图中心点，默认：true\r\n          zoomToAccuracy: true, //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false\r\n        },\r\n      ],\r\n      markerEvents: {\r\n        click: (e) => {\r\n          // 点击事件  返回坐标\r\n          this.$emit(\"clickMaker\", e);\r\n        },\r\n        dragend: (e) => {\r\n          // 拖拽结束事件  返回坐标\r\n          // this.markers[0].position = [e.lnglat.lng, e.lnglat.lat];\r\n          this.$emit(\"dragMarkerEnd\", e);\r\n        },\r\n      },\r\n      defaultMarkers: [],\r\n      mapCenter: \"\",\r\n    };\r\n  },\r\n  watch: {\r\n    markers(value) {\r\n      if (window.AMap && value) {\r\n        this.resetMarkers(value);\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    computedMarkers() {\r\n      if (!this.markers) {\r\n        return [];\r\n      }\r\n      if (window.AMap) {\r\n        // this.resetMarkers(this.markers);\r\n      }\r\n      return this.markers.length ? this.markers : this.defaultMarkers;\r\n    },\r\n    computedCenter() {\r\n      return this.center || this.defaultCenter;\r\n    },\r\n  },\r\n  methods: {\r\n    getPosition() {\r\n      this.mapService.getCurrentLocation();\r\n    },\r\n    afterInit(center, map): void {\r\n      this.addMarkers(this.markers, map);\r\n      if (\r\n        Object.prototype.toString.call(this.center) === \"[object Array]\" &&\r\n        this.center[0] &&\r\n        this.center[1]\r\n      ) {\r\n        const circleMarker = new AMap.CircleMarker({\r\n          center,\r\n          radius: 10, //3D视图下，CircleMarker半径不要超过64px\r\n          strokeColor: \"white\",\r\n          strokeWeight: 2,\r\n          strokeOpacity: 0.5,\r\n          fillColor: \"rgba(30,144,255)\",\r\n          fillOpacity: 0.5,\r\n          zIndex: 10,\r\n          bubble: true,\r\n          cursor: \"pointer\",\r\n          clickable: true,\r\n        });\r\n        circleMarker.setMap(map);\r\n      }\r\n      this.resetMarkers(this.markers);\r\n    },\r\n    getCurrentLocation() {},\r\n    onSearchResult(e) {},\r\n    getCenter() {\r\n      return this.$refs.map.$$getCenter();\r\n    },\r\n    getCurrentPosition() {},\r\n    // 添加坐标\r\n    addMarkers(markers, map) {\r\n      // const map = this.amapManager.getMap();\r\n      const mapMarkers = markers.map((marker) => {\r\n        return new AMap.Marker({\r\n          position: marker.position,\r\n        });\r\n      });\r\n      // 存储坐标\r\n      this.mapMarkers = [...mapMarkers];\r\n      this.mapMarkers.forEach((ele) => {\r\n        map.add(ele);\r\n      });\r\n    },\r\n    removeMarkers() {},\r\n    emptyMarkers() {\r\n      const map = this.amapManager.getMap();\r\n      map.remove(this.mapMarkers);\r\n      this.mapMarkers.splice(0, this.mapMarkers.length);\r\n    },\r\n    resetMarkers(markers) {\r\n      this.emptyMarkers();\r\n      this.addMarkers(markers, this.amapManager.getMap());\r\n    },\r\n  },\r\n});\r\n</script>\r\n<style lang=\"scss\">\r\n.farris-mobile-map {\r\n  width: 100%;\r\n  height: 450px;\r\n}\r\n.amap-logo {\r\n  visibility: hidden;\r\n}\r\n.amap-scalecontrol {\r\n  visibility: hidden !important;\r\n}\r\n.amap-copyright {\r\n  visibility: hidden !important;\r\n}\r\n</style>\r\n",null,null,"\r\n\r\n<template>\r\n  <div class=\"fm-tmpl-struct-wrapper\" v-if=\"visiavle\" id=\"section-83f5062\">\r\n    <div class=\"fm-tmpl-section fm-tmpl-section-form\">\r\n      <div class=\"fm-tmpl-section-header\">\r\n        <div class=\"fm-title\">\r\n          <span class=\"fm-title-text\">{{ title }}</span>\r\n        </div>\r\n      </div>\r\n      <div id=\"approval-logs-container\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { onMounted, watch, toRefs, defineComponent } from \"vue\";\r\n\r\ndeclare const System: any;\r\n\r\nexport default defineComponent({\r\n  name: \"approval-logs\",\r\n\r\n  props: {\r\n    dataId: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"审批记录\",\r\n    },\r\n    visiavle: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n\r\n  setup(props) {\r\n    const { dataId } = toRefs(props);\r\n\r\n    const getApprovalLogs = () => {\r\n      if (!dataId.value) {\r\n        return;\r\n      }\r\n      const containerElem = document.getElementById(\"approval-logs-container\");\r\n      let approvalLogUrl =\r\n        \"/platform/runtime/wf/webapp/mobiletaskcenter/taskComment.js\";\r\n      const version = \"\" + new Date().getTime();\r\n      approvalLogUrl = approvalLogUrl + `?version=${version}`;\r\n\r\n      System.import(approvalLogUrl).then(() => {\r\n        const taskLogsPayload = {\r\n          bizInstId: dataId.value,\r\n          procInstId: \"\",\r\n          isIncludeHistory: false,\r\n        };\r\n        const ApprovalLogUtil = window[\"gspTaskCenterBizLog\"].ApprovalLogUtil;\r\n        ApprovalLogUtil.getBizlogHtml(taskLogsPayload, containerElem);\r\n      });\r\n    };\r\n\r\n    onMounted(getApprovalLogs);\r\n\r\n    watch(dataId, getApprovalLogs);\r\n\r\n    return {};\r\n  },\r\n});\r\n</script>\r\n","\r\n\r\n<template>\r\n  <div class=\"fm-tmpl-struct-wrapper\" v-if=\"visiavle\" id=\"section-83f5062\">\r\n    <div class=\"fm-tmpl-section fm-tmpl-section-form\">\r\n      <div class=\"fm-tmpl-section-header\">\r\n        <div class=\"fm-title\">\r\n          <span class=\"fm-title-text\">{{ title }}</span>\r\n        </div>\r\n      </div>\r\n      <div id=\"approval-logs-container\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\">\r\nimport { onMounted, watch, toRefs, defineComponent } from \"vue\";\r\n\r\ndeclare const System: any;\r\n\r\nexport default defineComponent({\r\n  name: \"approval-logs\",\r\n\r\n  props: {\r\n    dataId: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"审批记录\",\r\n    },\r\n    visiavle: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n\r\n  setup(props) {\r\n    const { dataId } = toRefs(props);\r\n\r\n    const getApprovalLogs = () => {\r\n      if (!dataId.value) {\r\n        return;\r\n      }\r\n      const containerElem = document.getElementById(\"approval-logs-container\");\r\n      let approvalLogUrl =\r\n        \"/platform/runtime/wf/webapp/mobiletaskcenter/taskComment.js\";\r\n      const version = \"\" + new Date().getTime();\r\n      approvalLogUrl = approvalLogUrl + `?version=${version}`;\r\n\r\n      System.import(approvalLogUrl).then(() => {\r\n        const taskLogsPayload = {\r\n          bizInstId: dataId.value,\r\n          procInstId: \"\",\r\n          isIncludeHistory: false,\r\n        };\r\n        const ApprovalLogUtil = window[\"gspTaskCenterBizLog\"].ApprovalLogUtil;\r\n        ApprovalLogUtil.getBizlogHtml(taskLogsPayload, containerElem);\r\n      });\r\n    };\r\n\r\n    onMounted(getApprovalLogs);\r\n\r\n    watch(dataId, getApprovalLogs);\r\n\r\n    return {};\r\n  },\r\n});\r\n</script>\r\n",null,null],"names":["uuid","d","Date","getTime","replace","c","r","Math","random","floor","toString","defineComponent","name","components","Uploader","Empty","Image","Popup","Grid","GridItem","Row","Col","ImagePreview","Component","inject","attachmentService","default","uploadAttachmentService","props","fileList","type","Array","multiple","Boolean","accept","String","disabled","beforeReadFile","Function","uploadFile","previewFile","allowDefaultEntrance","beforeTakePhoto","uploadInfo","Object","parentDirName","rootId","pattern","ccWork","photo","quality","mode","mark","isPhoto","selectFile","mType","maxNum","video","id","time","isVideo","album","isAlbum","cloudPlus","encodingType","targetWidth","targetHeight","maximum","fileType","isFile","externalVideoUrl","data","fromProp","rawFiles","showAction","saveAction","selectedFile","selectedFilePath","description","notUploadedFileList","previewPages","pdfUrl","show","showPdf","showDoc","videoUrl","selectedAttachmentId","subscription","imgHeight","imhWidth","hasFiles","docStyle","computed","uploadFiles","self","this","concat","map","file","length","find","f","_this","$nextTick","goTouchStart","rawFile","attachmentId","$loading","hide","calculateImgSize","previewEnable","gridNumber","Number","created","mounted","collectFile","subscribe","res","prototype","call","console","log","_this2","afterRead","unmounted","unsubscribe","methods","appendFile","selectAttachment","$refs","fileUploadRef","chooseFile","getSysInfo","platform","_this3","beforeRead","fileItem","$notify","warning","url","substring","lastIndexOf","upload","list","fileName","metadataId","_this4","$emit","l","deleteFile","deleteAttachment","item","toLowerCase","includes","getToken","mergeString","str","str1","min","i","array","str2","str3","randomArray","ceil","push","splice","timeStamp","round","switchStr","genPreview","originMeta","document","getElementsByName","meta","createElement","content","head","getElementsByTagName","removeChild","appendChild","search","getAttachmentPath","getAttachmentPathByType","attachment","getFitToWidth","pageWidth","pageHeight","pageWidth1","ptToPx","pageHeight1","offsetWidth","window","innerWidth","pt","isMobile","width","isTablet","isDesktop","takePhoto","selectFromAlbum","takeShortVideo","getVideoFile","externalSize","size","attach","getBoundingClientRect","naviSize","navigation","height","imgContainer","imgContainerHeight","closed","class","ref","_createVNode","_createBlock","_hoisted_1","_ctx","_hoisted_2","_hoisted_3","fit","src","onClick","controls","controlslist","closeable","onClosed","style","title","onClickLeft","left","color","scrolling","page","index","key","innerHTML","_createCommentVNode","_hoisted_5","clickable","text","icon","justify","span","onTouchstart","_hoisted_6","styleInject","css","insertAt","firstChild","insertBefore","styleSheet","cssText","createTextNode","install","app","component","Attachment","removable","direction","uploadOptions","showPhoto","showAlbum","showVideo","showFile","photoQuality","albumQuality","fileMaxCount","videoId","videoQuality","videoTime","disablePhoto","disableAlbum","disableFile","disableVideo","hidePhoto","hideAlbum","hideFile","maxCount","maxSize","displayMaxCount","allowMaxSize","allowMaxCount","isSelectAction","isPreviewAction","actions","albumDisabled","photoDisabled","fileDisabled","previewAction","navibarDisplay","footerDisplay","isEmpty","setTimeout","top","backFn","pageElem","querySelector","attachPreviewContainer","closeScale","e","openScale","currentDoc","transformSize","pow","toFixed","selectAction","actionName","downloadAttachment","selectFileFromMobile","selectFileFromAlbum","toUpload","onCancel","some","realStrLen","indexOf","parseInt","$dialog","alert","message","removedCount","count","slice","findWorkFlow","previewFileInWorkFlow","playShortVideo","pushOriginGoback","getAttachmentUrl","ishttps","location","protocol","host","attachmentName","options","saveName","popOriginGoback","hideWorkFlowNavibar","workFlowNavibar","getComputedStyle","display","workFlowFooter","displayWorkFlowNavibar","href","attachId","previewHtml","previewContainerElem","classList","add","addEventListener","_this5","openDownloadList","_hoisted_4","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","onSelect","listData","finished","showFinishedText","className","listViewHeader","_hoisted_11","max","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","plain","_hoisted_19","_hoisted_20","createTime","listviewEmpty","_hoisted_21","_hoisted_22","AttachmentFile","requestUpload","autoplay","AttachmentEntry","second","run","start","timer","stop","setDisabled","val","VerifyCode","AttachmentUtil","getCurrentData","bindingField","dataItem","modifyData","fields","fieldsValue","forEach","field","fieldArr","split","newField","getContextData","context","setContextData","appendToContextData","updateContextData","oldData","appendToContextOldData","removeContextDataById","findIndex","RemoGeoLocation","_remoteSvrUrl","_callbackList","_seqBase","_frameReady","_watchIdMap","_getSeq","_onRrameReady","callback","_frameReadyList","_prepareIframe","_iframeWin","ifrm","position","allow","timeoutId","_callbackFrameReadyList","onload","clearTimeout","body","contentWindow","_handleRemoteMsg","len","_pickCallback","seqNum","keepInList","callbackList","cbkInfo","msg","warn","_postMessage","cmd","args","seq","postMessage","getCurrentPosition","succHandler","errHandler","err","result","watchPosition","watchKey","cmdSeq","stat","watchInfo","clearWatch","clearId","DEFAULT_AMP_CONFIG","v","hostAndPath","plugin","patchIOS11Geo","AMap","UA","ios","android","remoGeo","navigator","geolocation","apply","arguments","AMapAPILoader","config","_config","_document","_window","_scriptLoaded","_queueEvents","load","Map","loadUIAMap","_scriptLoadingPromise","script","async","defer","_getScriptSrc","UIPromise","uiVersion","Promise","resolve","reject","pop","then","onerror","error","AMapUI","UIScript","versionMain","versionSub","versionDetail","undefined","amap_prefix_reg","paramKeys","plugins","prefixName","test","pureName","params","keys","filter","k","isArray","value","join","entry","lazyAMapApiLoaderInstance","MapPlugin","addPlugins","_notInjectPlugins","_plugin","sName","addMapControls","$plugins","realPluginOptions","convertAMapPluginProps","pluginInstance","pName","addControl","events","event","addListener","offset","toPixel","arr","Pixel","guid","s","hexDigits","substr","camelCase","trim","m","p1","toUpperCase","AMapManager","_componentMap","_map","setMap","getMap","setComponent","set","getComponent","get","getChildInstance","removeComponent","delete","extendFields","showNavBar","path","displayAttachmentInfo","displayAttachmentId","displayAttachmentName","setup","emit","state","reactive","attachmentExtendFields","getData","updateData","removeDataById","setData","appendData","removed","currentData","rawData","nextTick","getDataValue","selectedData","filterData","onMounted","initContext","bind","uploadAttachment","removeAttachment","selectChange","goBack","bindingFields","extendField","ele","oldListData","blur","toAttachmentDetailPage","attachmentInfoFields","editorType","readonly","label","visible","NavBar","Icon","Field","onRemove","onUpload","onBlur","onSelectChange","onAfterAppendFile","BusinessAttachment","instance","backAfterClose","Navbar","LookupInput","Picker","Button","processReadFlag","nextNodeReadFlag","assigneeReadFlag","cancelDisabled","confirmDisabled","process","processOc","processData","nextNode","nextNodeOc","nextNodeData","assignee","assigneeOc","assigneeData","submit","cancel","assignInfos","selectedValues","multiSelect","assigneeHolder","nextNodeHolder","processHolder","emits","attrs","slots","_processOc","_nextNodeOc","$_confirm","_cancel","assigneeInfo","assigneeUsers","_assigneeOc","isFirst","usePopupState","toggle","open","assign","closeTheInstance","close","apis","getCurrentInstance","proxy","useExpose","initInstance","a","RootComponent","createApp","use","Vant","FarrisMobileUi","root","mount","unmount","mountComponent","SubmitApprove","clear","confirm","FMApprove","attachmentUrl","cmp","AttachmentPreview","FMAttachmentPreview","el","converters","center","LngLat","$amap","$amapComponent","loadPromise","circleMarker","plus","parseFullName","pluginName","parseShortName","oPlugin","nPlugin","onBeforeMount","watch","newValue","oldValue","setCenter","createMap","onUnmounted","destroy","mapElement","elementID","vid","convertProps","amapManager","eventName","propsObj","reduce","_key","propsValue","convertSignalProp","sourceData","_renderSlot","VAMap","VueAMap","initAMapApiLoader","installed","optionMergeStrategies","deferredReady","_component","cased","charAt","upperCamelCase","mapService","zoomEnable","dragEnable","resizeEnable","zoom","markers","limitCity","limitSearch","showSearch","mapKey","displayDireaction","mapMarkers","emptyMarkers","subject","defaultCenter","init","o","addMarkers","zoomchange","click","geocoder","Geocoder","radius","extensions","that","address","getAddress","lnglat","lng","lat","status","info","regeocode","formattedAddress","noGeoLocation","enableHighAccuracy","timeout","maximumAge","convert","showButton","buttonPosition","showMarker","showCircle","panToLocation","zoomToAccuracy","markerEvents","dragend","defaultMarkers","mapCenter","resetMarkers","computedMarkers","computedCenter","getPosition","getCurrentLocation","afterInit","CircleMarker","strokeColor","strokeWeight","strokeOpacity","fillColor","fillOpacity","zIndex","bubble","cursor","onSearchResult","getCenter","$$getCenter","marker","Marker","removeMarkers","remove","onAfterInit","onSetCircleMarker","BusinessMap","globalProperties","$filterAttachment","entityListData","isComponentAdapter","$filterMap","currentEntityData","lngPath","latPath","filterMapData","dataId","required","visiavle","toRefs","getApprovalLogs","containerElem","getElementById","approvalLogUrl","System","import","taskLogsPayload","bizInstId","procInstId","isIncludeHistory","ApprovalLogUtil","getBizlogHtml","ApprovalLogs","FarrisBusinessPlugin"],"mappings":"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"}
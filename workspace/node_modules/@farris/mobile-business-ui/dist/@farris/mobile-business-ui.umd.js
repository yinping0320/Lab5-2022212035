(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('vue'), require('vant'), require('@farris/mobile-vue-adapter'), require('@farris/mobile-ui')) :
    typeof define === 'function' && define.amd ? define(['exports', 'vue', 'vant', '@farris/mobile-vue-adapter', '@farris/mobile-ui'], factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.lazyLoad = {}, global.vue, global.Vant, global.mobileVueAdapter, global.FarrisMobileUi));
}(this, (function (exports, vue, Vant, mobileVueAdapter, FarrisMobileUi) { 'use strict';

    function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

    var Vant__default = /*#__PURE__*/_interopDefaultLegacy(Vant);
    var FarrisMobileUi__default = /*#__PURE__*/_interopDefaultLegacy(FarrisMobileUi);

    var uuid = function uuid() {
      var d = new Date().getTime();
      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c === 'x' ? r : r & 0x3 | 0x8).toString(16);
      });
      return uuid;
    };

    var _components;
    var script = vue.defineComponent({
      name: "fm-attachment",
      components: (_components = {
        "van-uploader": Vant.Uploader,
        "van-empty": Vant.Empty,
        "van-image": Vant.Image,
        "van-popup": Vant.Popup,
        "van-grid": Vant.Grid,
        "van-grid-item": Vant.GridItem,
        "van-row": Vant.Row,
        "van-col": Vant.Col
      }, _components[Vant.ImagePreview.Component.name] = Vant.ImagePreview.Component, _components),
      inject: {
        attachmentService: {
          default: null
        },
        uploadAttachmentService: {
          default: null
        }
      },
      props: {
        // 传入文件列表
        fileList: {
          type: Array,
          default: function _default() {
            return [];
          }
        },
        // 多选
        multiple: {
          type: Boolean,
          default: true
        },
        // 文件类型
        accept: {
          type: String,
          default: "application/msexcel,application/msword,application/vnd.ms-powerpoint,application/pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain" // default: 'application/pdf,image/*,application/msword,text/html'

        },
        // 禁用上传
        disabled: {
          type: Boolean,
          default: false
        },
        // 读取文件前事件
        beforeReadFile: {
          type: Function
        },
        // 上传事件
        uploadFile: {
          type: Function
        },
        // 文件预览事件
        previewFile: {
          type: Function
        },
        // 自定义进入附件组件的入口
        allowDefaultEntrance: {
          type: Boolean,
          default: true
        },
        // 拍照前回调
        beforeTakePhoto: {
          type: Function
        },
        // 上传附件信息
        uploadInfo: {
          type: Object,
          default: null
        },
        // parentDirName
        parentDirName: {
          type: String,
          default: ""
        },
        rootId: {
          type: String,
          default: ""
        },
        // 上传模式  html ccWork cloudPlus
        pattern: {
          type: String,
          default: "ccWork"
        },
        // 云上协同配置
        ccWork: {
          type: Object,
          default: function _default() {
            return {
              photo: {
                quality: "high",
                mode: "camera",
                mark: "",
                isPhoto: true
              },
              selectFile: {
                mType: "0",
                maxNum: 6
              },
              video: {
                id: "af700826-7552-4858-a5e0-e64f5e20288b",
                quality: 0.8,
                time: 15,
                isVideo: true
              },
              album: {
                isAlbum: true,
                mType: "0",
                maxNum: 9
              }
            };
          }
        },
        // 云+配置
        cloudPlus: {
          type: Object,
          default: function _default() {
            return {
              photo: {
                quality: 60,
                encodingType: 1,
                targetWidth: 602,
                targetHeight: 600,
                isPhoto: true
              },
              selectFile: {
                maximum: 3,
                fileType: ".jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.pdf|.txt",
                isFile: true
              },
              album: {
                isAlbum: true,
                quality: 60,
                encodingType: 1,
                targetWidth: 600,
                targetHeight: 600
              }
            };
          }
        },
        // 原生模式
        externalVideoUrl: {
          type: String,
          default: ""
        }
      },
      data: function data() {
        return {
          fromProp: false,

          /**
           * 文件列表
           */
          rawFiles: [],

          /**
           * 展示附件上传界面开关
           */
          showAction: false,

          /**
           * 附件保存页面
           */
          saveAction: false,

          /**
           * 当前选中附件
           */
          selectedFile: null,

          /**
           * 选中文件预览路径
           */
          selectedFilePath: "",

          /**
           * 附件描述
           */
          description: "",

          /**
           * 未上传的文件列表
           */
          notUploadedFileList: [],

          /**
          预览页面
          */
          previewPages: [],
          pdfUrl: "",

          /**
          弹出层显示
          */
          show: false,
          showPdf: false,
          showDoc: false,
          videoUrl: "",
          selectedAttachmentId: "",
          subscription: "",
          // 图片尺寸
          imgHeight: 0,
          imhWidth: 0,
          // 尺寸开关
          hasFiles: false,
          // 预览文件尺寸
          docStyle: {}
        };
      },
      computed: {
        uploadFiles: function uploadFiles() {
          var _ref,
              _this = this;

          var self = this;
          this.rawFiles = (_ref = []).concat.apply(_ref, this.fileList.map(function (file) {
            return file;
          }));

          if (this.rawFiles && this.rawFiles.length) {
            if (!this.selectedFile || !this.rawFiles.find(function (f) {
              return f.id === _this.selectedFile.id;
            })) {
              this.selectedFile = this.rawFiles[0];
              this.$nextTick(function () {
                self.goTouchStart(_this.selectedFile);
              });
            }

            if (this.selectedAttachmentId) {
              this.selectedFile = this.rawFiles.find(function (rawFile) {
                return rawFile.attachmentId === _this.selectedAttachmentId;
              });

              if (this.selectedFile) {
                // 上传成功后  选中新上传的附件且附件信息同步变更
                this.$nextTick(function () {
                  self.goTouchStart(_this.selectedFile);

                  _this.$loading.hide();
                });
              }
            }

            if (!this.selectedFile) {
              // 删除的附件
              this.selectedFile = this.rawFiles[this.rawFiles.length - 1];
            } // 没有url属性的 没有上传


            if (!this.hasFiles) {
              this.$nextTick(function () {
                _this.calculateImgSize(80);

                _this.hasFiles = true;
              });
            }

            return this.rawFiles;
          } // 没有url属性的 没有上传


          if (this.hasFiles) {
            this.$nextTick(function () {
              _this.calculateImgSize();

              _this.hasFiles = false;
            });
          }

          this.selectedFile = null;
          return [];
        },
        previewEnable: function previewEnable() {
          return this.showAction && this.rawFiles && !!this.rawFiles.length;
        },
        // 拍照  选择文件  拍摄短视频等
        gridNumber: function gridNumber() {
          if (this.pattern === "ccWork") {
            return Number(this.ccWork.photo.isPhoto) + Number(this.ccWork.video.isVideo) + Number(this.ccWork.album.isAlbum);
          } else if (this.pattern === "cloudPlus") {
            return Number(this.cloudPlus.photo.isPhoto) + Number(this.cloudPlus.selectFile.isFile) + Number(this.cloudPlus.album.isAlbum);
          } else {
            // 原生模式
            return 3;
          }
        }
      },
      created: function created() {// this.selectedFile = this.rawFiles[this.rawFiles.length - 1];
      },
      mounted: function mounted() {
        var _this2 = this;

        // 不同设备选择文件
        if (this.attachmentService) {
          this.subscription = this.attachmentService.collectFile.subscribe(function (res) {
            if (Object.prototype.toString.call(res) === "[object Array]" && res.length === 0) {
              return;
            }

            console.log(res);
            _this2.rawFiles = [].concat(_this2.rawFiles, res);

            _this2.afterRead(res);
          });
        }
      },
      unmounted: function unmounted() {
        if (this.subscription) {
          this.subscription.unsubscribe();
        }

        this.$loading.hide();
      },
      methods: {
        /**
         * 添加文件
         */
        appendFile: function appendFile() {
          var _this3 = this;

          if (this.pattern === "ccWork") {
            // 使用第三方提供的选择图片服务
            this.attachmentService.selectAttachment(this.ccWork.album);
          } else if (this.pattern === "html") {
            this.$refs.fileUploadRef.chooseFile();
          } else if (this.pattern === "cloudPlus") {
            // 选择文件服务
            this.attachmentService.getSysInfo().subscribe(function (res) {
              if (res && res.platform === "Android") {
                _this3.attachmentService.selectFile(_this3.cloudPlus.selectFile);
              } else if (res && res.platform === "iOS") {
                _this3.$refs.fileUploadRef.chooseFile();
              }
            });
          }
        },

        /**
         * 读取文件之前
         */
        beforeRead: function beforeRead(file) {
          if (this.beforeReadFile) {
            // 读取文件前事件
            var beforeReadRes = this.beforeReadFile(file);
            return beforeReadRes;
          }

          return true;
        },

        /**
         * 使用h5文件API 加载文件后事件
         */
        afterRead: function afterRead(file) {
          var _this4 = this;

          console.log(file);
          this.$loading.show("附件上传中");

          if (file && file.length) {
            this.notUploadedFileList = file.map(function (fileItem) {
              fileItem.id = uuid();
              return fileItem;
            });
          } else {
            file.id = uuid();
            this.notUploadedFileList = [file];
          }

          if (this.notUploadedFileList.length > this.maxNum) {
            this.$notify.warning("最多上传" + this.maxNum + "个附件");
            return;
          } // 赋值最新的上传文件附件id


          this.selectedAttachmentId = this.notUploadedFileList[0].id;

          if (this.uploadAttachmentService) {
            // 固定的服务  缓存附件到服务器
            if (file.type === "video/mp4") {
              this.videoUrl = file.url.substring(0, file.url.lastIndexOf("/"));
              this.uploadAttachmentService.upload([file], {
                parentDirName: this.parentDirName,
                rootId: this.rootId
              }).subscribe(function (res) {
                var list = {
                  fileName: file.file.name,
                  metadataId: file.id
                };

                _this4.$emit("afterAppendFile", [list]);
              });
            } else {
              this.uploadAttachmentService.upload(this.notUploadedFileList, {
                parentDirName: this.parentDirName,
                rootId: this.rootId
              }).subscribe(function (res) {
                var list = _this4.notUploadedFileList.map(function (l) {
                  return {
                    fileName: l.file.name,
                    metadataId: l.id
                  };
                });

                _this4.$emit("afterAppendFile", list);
              });
            }
          } else {
            // h5 添加文件后事件
            var list = this.notUploadedFileList.map(function (l) {
              return {
                fileName: l.file.name,
                metadataId: l.id
              };
            });
            this.$emit("afterAppendFile", list);
          }
        },

        /**
         * 删除选中文件
         */
        deleteFile: function deleteFile() {
          if (!this.rawFiles || !this.rawFiles.length) {
            return;
          }

          this.deleteAttachment(this.selectedFile);
        },
        goTouchStart: function goTouchStart(item) {
          this.selectedFile = item;

          if (this.selectedFile.name && this.selectedFile.name.toLowerCase().includes("mp4") || this.selectedFile.name.toLowerCase().includes("webm") || this.selectedFile.name.toLowerCase().includes("ogg")) {
            if (this.externalVideoUrl) {
              this.selectedFile.url = this.externalVideoUrl + ("?metadataId=" + this.selectedFile.attachmentId + "&rootid=" + this.rootId + "&token=" + this.getToken(this.mergeString(this.selectedFile.attachmentId, this.rootId)));
            }
          }

          this.selectedAttachmentId = item.attachmentId;
          this.$emit("beforeSelect", item);
        },

        /**
         * 选中文件
         */
        selectFile: function selectFile(item) {
          this.selectedFile = item;
          this.$emit("selectChange", item);
        },
        mergeString: function mergeString(str, str1) {
          var min = str.length < str1.length ? str.length : str1.length;
          var res = "";
          var i = 0;

          for (i = 0; i < min; i++) {
            res += str.substring(i, i + 1);
            res += str1.substring(i, i + 1);
          }

          res += str.length < str1.length ? str1.substring(i) : str.substring(i);
          return res;
        },
        getToken: function getToken(str) {
          var array = [1, 2, 3];

          if (str.length > 24) {
            str = str.substring(0, 24);
          }

          var length = Math.floor(str.length / 3);
          var str1 = str.substring(0, length);
          var str2 = str.substring(length, 2 * length);
          var str3 = str.substring(2 * length, 3 * length);
          var randomArray = [];
          var random = Math.ceil(Math.random() * 3);
          randomArray.push(array[random - 1]);
          array.splice(random - 1, 1);
          random = Math.ceil(Math.random() * 2);
          randomArray.push(array[random - 1]);
          array.splice(random - 1, 1);
          randomArray.push(array[0]);
          var timeStamp = Math.round(new Date().getTime() / 1000) + "";
          return timeStamp.substring(0, 5) + "times" + randomArray[0] + "" + randomArray[1] + "" + randomArray[2] + this.switchStr(str1, str2, str3, randomArray[0]) + this.switchStr(str1, str2, str3, randomArray[1]) + this.switchStr(str1, str2, str3, randomArray[2]) + "times" + timeStamp.substring(5);
        },
        switchStr: function switchStr(str1, str2, str3, i) {
          switch (i) {
            case 1:
              return str1;

            case 2:
              return str2;

            case 3:
              return str3;
          }
        },

        /**
         * 生成预览
         */
        genPreview: function genPreview() {
          if (!this.selectedFile || !this.selectedFile.name) {
            return;
          } // 生成缩放的meta标签


          var originMeta = document.getElementsByName("viewport")[0];
          var meta = document.createElement("meta");
          meta.name = "viewport"; // meta.content =
          //   "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";

          meta.content = "width=device-width, initial-scale=1.0";
          var head = document.getElementsByTagName("head")[0];

          if (originMeta) {
            head.removeChild(originMeta);
          }

          head.appendChild(meta);

          if (this.uploadAttachmentService) {
            if (this.selectedFile.name.search(/\.(png|jpe?g|gif|svg)(\?.*)?$/) >= 0) {
              // 图片预览
              this.show = true;
              this.showPdf = true;
              this.showDoc = false;
              this.pdfUrl = "/platform/runtime/dfs/viewpage/index.html?metadataId=" + this.selectedFile.attachmentId + "&rootId=" + this.rootId + "&fileType=2";
            } else if (this.selectedFile.name.includes("pdf")) {
              this.show = true;
              this.showPdf = true;
              this.showDoc = false; // pdf预览

              this.pdfUrl = "/platform/runtime/dfs/viewpage/index.html?metadataId=" + this.selectedFile.attachmentId + "&rootId=" + this.rootId + "&fileType=2"; // window.open(`/platform/runtime/dfs/viewpage/index.html?metadataId=${this.selectedFile.attachmentId}&rootId=${this.rootId}&fileType=2`);
            } else if (this.selectedFile.name.includes("mp4")) ; else {
              this.show = true;
              this.showPdf = true;
              this.showDoc = false;
              this.pdfUrl = "/platform/runtime/dfs/viewpage/index.html?metadataId=" + this.selectedFile.attachmentId + "&rootId=" + this.rootId + "&fileType=2";
            }
          }

          this.$emit("preview", this.selectedFile);
        },
        getAttachmentPath: function getAttachmentPath(attachmentId) {
          return this.uploadAttachmentService.getAttachmentPath(attachmentId, this.rootId);
        },
        getAttachmentPathByType: function getAttachmentPathByType(attachment) {
          if (attachment.name.search(/\.(png|jpe?g|gif|svg)(\?.*)?$/) >= 0) {
            return this.getAttachmentPath(attachment.attachmentId);
          }

          return attachment.content || attachment.url;
        },
        getFitToWidth: function getFitToWidth(pageWidth, pageHeight) {
          var pageWidth1 = this.ptToPx(pageWidth);
          var pageHeight1 = this.ptToPx(pageHeight);
          var offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;
          return pageHeight1 > pageWidth1 && Math.round(offsetWidth / window.innerWidth) <= 1 ? 200 - Math.round(offsetWidth * 100 / window.innerWidth) : Math.round(window.innerWidth * 100 / offsetWidth);
        },
        ptToPx: function ptToPx(pt) {
          return pt * 96 / 72;
        },
        isMobile: function isMobile(width) {
          return width <= 425;
        },
        isTablet: function isTablet(width) {
          return width <= 1024;
        },
        isDesktop: function isDesktop(width) {
          return !this.isMobile(width) && !this.isTablet(width);
        },

        /**
        删除附件
        */
        deleteAttachment: function deleteAttachment(item) {
          this.selectedFile = null;
          this.$emit("remove", [item.attachmentId]);
        },

        /**
         * 拍照
         */
        takePhoto: function takePhoto() {
          if (this.pattern === "ccWork") {
            // 使用第三方提供的拍照服务
            this.attachmentService.takePhoto(this.ccWork.photo);
          } else if (this.pattern === "cloudPlus" || this.pattern === "html") {
            // 使用第三方提供的拍照服务
            this.attachmentService.takePhoto(this.cloudPlus.photo);
          }
        },
        selectFromAlbum: function selectFromAlbum() {
          if (this.pattern === "ccWork") {
            // 使用第三方提供的选择图片服务
            this.attachmentService.selectAttachment(this.ccWork.album);
          } else if (this.pattern === "cloudPlus" || this.pattern === "html") {
            // 选择文件服务
            this.attachmentService.selectAttachment(this.cloudPlus.album);
          }
        },

        /**
        拍摄短视频
        */
        takeShortVideo: function takeShortVideo() {
          if (this.pattern === "ccWork") {
            // 使用第三方提供的拍照服务
            this.attachmentService.takeShortVideo(this.ccWork.video);
          }
        },
        getVideoFile: function getVideoFile(file) {
          var fileName = file.name;
          var metadataId = file.url;
          return {
            fileName: fileName,
            metadataId: metadataId
          };
        },
        calculateImgSize: function calculateImgSize(externalSize) {
          if (externalSize === void 0) {
            externalSize = 0;
          }

          // 计算图片尺寸
          var size = this.$refs.attach.getBoundingClientRect();
          var naviSize = this.$refs.navigation.getBoundingClientRect();
          var imgHeight = size.height - naviSize.height - externalSize;

          if (this.$refs.imgContainer) {
            var imgContainerHeight = this.$refs.imgContainer.getBoundingClientRect().height;

            if (imgContainerHeight > imgHeight) {
              this.imgHeight = imgContainerHeight;
            }
          } else {
            this.imgHeight = imgHeight;
          }
        },
        closed: function closed() {
          // 生成缩放的meta标签
          var originMeta = document.getElementsByName("viewport")[0];
          var meta = document.createElement("meta");
          meta.name = "viewport"; // meta.content =
          //   "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";

          meta.content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";
          var head = document.getElementsByTagName("head")[0];

          if (originMeta) {
            head.removeChild(originMeta);
          }

          head.appendChild(meta);
          this.show = false;
        }
      }
    });

    var _withId = /*#__PURE__*/vue.withScopeId("data-v-443ecfba");

    vue.pushScopeId("data-v-443ecfba");

    var _hoisted_1 = {
      class: "farris-attachment attachment",
      ref: "attach"
    };
    var _hoisted_2 = {
      class: "farris-attachment-img"
    };
    var _hoisted_3 = {
      key: 1,
      class: "img-container",
      ref: "imgContainer"
    };
    var _hoisted_4 = {
      key: 2
    };
    var _hoisted_5 = {
      class: "attachment-navigation",
      ref: "navigation"
    };

    var _hoisted_6 = /*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-close"
    }, null, -1
    /* HOISTED */
    );

    vue.popScopeId();

    var render = /*#__PURE__*/_withId(function (_ctx, _cache, $props, $setup, $data, $options) {
      var _component_van_uploader = vue.resolveComponent("van-uploader");

      var _component_van_empty = vue.resolveComponent("van-empty");

      var _component_van_image = vue.resolveComponent("van-image");

      var _component_van_icon = vue.resolveComponent("van-icon");

      var _component_fm_navbar = vue.resolveComponent("fm-navbar");

      var _component_van_popup = vue.resolveComponent("van-popup");

      var _component_van_grid_item = vue.resolveComponent("van-grid-item");

      var _component_van_grid = vue.resolveComponent("van-grid");

      var _component_van_col = vue.resolveComponent("van-col");

      var _component_van_row = vue.resolveComponent("van-row");

      return vue.openBlock(), vue.createBlock("div", _hoisted_1, [vue.withDirectives(vue.createVNode(_component_van_uploader, {
        multiple: _ctx.multiple,
        ref: "fileUploadRef",
        "max-count": _ctx.maxNum,
        modelValue: _ctx.rawFiles,
        "onUpdate:modelValue": _cache[1] || (_cache[1] = function ($event) {
          return _ctx.rawFiles = $event;
        }),
        disabled: _ctx.disabled,
        "preview-full-image": _ctx.previewEnable,
        accept: _ctx.accept,
        "before-read": _ctx.beforeRead,
        "after-read": _ctx.afterRead
      }, null, 8
      /* PROPS */
      , ["multiple", "max-count", "modelValue", "disabled", "preview-full-image", "accept", "before-read", "after-read"]), [[vue.vShow, false]]), vue.createVNode("div", _hoisted_2, [!_ctx.selectedFile || !_ctx.selectedFile.url && !_ctx.selectedFile.file ? (vue.openBlock(), vue.createBlock(_component_van_empty, {
        key: 0,
        description: "附件为空"
      })) : vue.createCommentVNode("v-if", true), _ctx.selectedFile && _ctx.selectedFile.url ? (vue.openBlock(), vue.createBlock("div", _hoisted_3, [_ctx.selectedFile.name.toLowerCase().search(/\.(png|jpe?g|gif|svg|ppt|pptx|xls|xlsx|doc|docx|txt|pdf)(\?.*)?$/) >= 0 ? (vue.openBlock(), vue.createBlock(_component_van_image, {
        key: 0,
        height: _ctx.imgHeight,
        fit: "scale-down",
        src: _ctx.getAttachmentPathByType(_ctx.selectedFile),
        onClick: _ctx.genPreview
      }, null, 8
      /* PROPS */
      , ["height", "src", "onClick"])) : vue.createCommentVNode("v-if", true), _ctx.selectedFile && _ctx.selectedFile.name && _ctx.selectedFile.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock("video", {
        key: 1,
        controls: "controls",
        height: _ctx.imgHeight,
        controlslist: "nodownload"
      }, [vue.createVNode("source", {
        src: _ctx.selectedFile.url,
        type: "video/mp4"
      }, null, 8
      /* PROPS */
      , ["src"])], 8
      /* PROPS */
      , ["height"])) : vue.createCommentVNode("v-if", true), _ctx.selectedFile && _ctx.selectedFile.name && _ctx.selectedFile.name.toLowerCase().includes('mp4') || _ctx.selectedFile.name.toLowerCase().includes('webm') || _ctx.selectedFile.name.toLowerCase().includes('ogg') ? (vue.openBlock(), vue.createBlock("video", {
        key: 2,
        src: _ctx.selectedFile.url,
        controls: "controls",
        height: _ctx.imgHeight,
        controlslist: "nodownload"
      }, " 您的浏览器不支持 video 标签。 ", 8
      /* PROPS */
      , ["src", "height"])) : vue.createCommentVNode("v-if", true), vue.createVNode(_component_van_popup, {
        show: _ctx.show,
        "onUpdate:show": _cache[2] || (_cache[2] = function ($event) {
          return _ctx.show = $event;
        }),
        closeable: "",
        onClosed: _ctx.closed,
        style: {
          height: '100%',
          width: '100%'
        }
      }, {
        default: _withId(function () {
          return [vue.createVNode(_component_fm_navbar, {
            title: _ctx.selectedFile && _ctx.selectedFile.name,
            onClickLeft: _ctx.closed
          }, {
            left: _withId(function () {
              return [vue.createVNode(_component_van_icon, {
                name: "arrow-left",
                size: "18",
                color: "#333"
              })];
            }),
            _: 1
            /* STABLE */

          }, 8
          /* PROPS */
          , ["title", "onClickLeft"]), _ctx.showPdf ? (vue.openBlock(), vue.createBlock("iframe", {
            key: 0,
            class: "pdf-iframe",
            scrolling: "yes",
            src: _ctx.pdfUrl,
            width: "100%",
            height: "100%"
          }, "\r\n          ", 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true), _ctx.showDoc ? (vue.openBlock(), vue.createBlock("div", {
            key: 1,
            class: "panzoom",
            style: _ctx.docStyle
          }, [(vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.previewPages, function (page, index) {
            return vue.openBlock(), vue.createBlock("div", {
              class: "page",
              style: {
                width: 'unset',
                height: 'unset'
              },
              key: index
            }, [page.data ? (vue.openBlock(), vue.createBlock("div", {
              key: 0,
              innerHTML: page.data
            }, null, 8
            /* PROPS */
            , ["innerHTML"])) : vue.createCommentVNode("v-if", true)]);
          }), 128
          /* KEYED_FRAGMENT */
          ))], 4
          /* STYLE */
          )) : vue.createCommentVNode("v-if", true)];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["show", "onClosed"])], 512
      /* NEED_PATCH */
      )) : vue.createCommentVNode("v-if", true), _ctx.selectedFile && _ctx.selectedFile.file ? (vue.openBlock(), vue.createBlock("div", _hoisted_4)) : vue.createCommentVNode("v-if", true), vue.createCommentVNode(" </van-col> ")]), vue.createVNode("div", _hoisted_5, [vue.createVNode(_component_van_grid, {
        clickable: "",
        "column-num": _ctx.gridNumber
      }, {
        default: _withId(function () {
          return [vue.createCommentVNode(" 拍照  只有云+ 云上协同支持"), _ctx.pattern === 'ccWork' && _ctx.ccWork.photo && _ctx.ccWork.photo.isPhoto || _ctx.pattern === 'cloudPlus' && _ctx.cloudPlus.photo && _ctx.cloudPlus.photo.isPhoto || _ctx.pattern === 'html' ? (vue.openBlock(), vue.createBlock(_component_van_grid_item, {
            key: 0,
            text: "拍摄",
            icon: "photograph",
            onClick: _ctx.takePhoto
          }, null, 8
          /* PROPS */
          , ["onClick"])) : vue.createCommentVNode("v-if", true), vue.createCommentVNode(" 相册 均支持 "), _ctx.pattern === 'ccWork' && _ctx.ccWork.album && _ctx.ccWork.album.isAlbum || _ctx.pattern === 'cloudPlus' && _ctx.cloudPlus.album && _ctx.cloudPlus.album.isAlbum || _ctx.pattern === 'html' ? (vue.openBlock(), vue.createBlock(_component_van_grid_item, {
            key: 1,
            text: "相册",
            icon: "photo",
            onClick: _ctx.selectFromAlbum
          }, null, 8
          /* PROPS */
          , ["onClick"])) : vue.createCommentVNode("v-if", true), vue.createCommentVNode(" 目前只有云上协同支持 "), _ctx.pattern === 'ccWork' && _ctx.ccWork.video && _ctx.ccWork.video.isVideo ? (vue.openBlock(), vue.createBlock(_component_van_grid_item, {
            key: 2,
            text: "短视频",
            icon: "video",
            onClick: _ctx.takeShortVideo
          }, null, 8
          /* PROPS */
          , ["onClick"])) : vue.createCommentVNode("v-if", true), vue.createCommentVNode(" 选择文件 目前只有原生模式和云+支持 "), _ctx.pattern === 'cloudPlus' && _ctx.cloudPlus.selectFile.isFile || _ctx.pattern === 'html' ? (vue.openBlock(), vue.createBlock(_component_van_grid_item, {
            key: 3,
            text: "文件",
            icon: "card",
            onClick: _ctx.appendFile
          }, null, 8
          /* PROPS */
          , ["onClick"])) : vue.createCommentVNode("v-if", true)];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["column-num"]), vue.createVNode(_component_van_row, {
        type: "flex",
        justify: "center"
      }, {
        default: _withId(function () {
          return [vue.createVNode(_component_van_col, {
            class: "attachment-navigation-1 last-navigation",
            span: "24"
          }, {
            default: _withId(function () {
              return [(vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.uploadFiles, function (item, index) {
                return vue.openBlock(), vue.createBlock("div", {
                  class: {
                    'attachment-navigation-item': true,
                    'selected-file': _ctx.selectedFile ? item.id === _ctx.selectedFile.id && _ctx.selectedAttachmentId === _ctx.selectedFile.attachmentId : false
                  },
                  key: index,
                  onTouchstart: function onTouchstart($event) {
                    return _ctx.goTouchStart(item);
                  },
                  onClick: vue.withModifiers(function ($event) {
                    return _ctx.selectFile(item);
                  }, ["stop"])
                }, [item && item.name && !item.name.includes('mp4') || !item.name ? (vue.openBlock(), vue.createBlock(_component_van_image, {
                  key: 0,
                  src: _ctx.getAttachmentPathByType(item),
                  class: "item-img",
                  width: "80",
                  height: "80"
                }, null, 8
                /* PROPS */
                , ["src"])) : vue.createCommentVNode("v-if", true), item && item.name && item.name.toLowerCase().includes('mp4') || item.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock(_component_van_image, {
                  key: 1,
                  src: "/platform/runtime/dfs/images/file.png",
                  class: "item-img",
                  width: "80",
                  height: "80"
                })) : vue.createCommentVNode("v-if", true), (_ctx.selectedFile ? item.id === _ctx.selectedFile.id && _ctx.selectedAttachmentId === _ctx.selectedFile.attachmentId : false) ? (vue.openBlock(), vue.createBlock("div", {
                  key: 2,
                  class: "item-icon-delete",
                  onClick: function onClick($event) {
                    return _ctx.deleteAttachment(item);
                  }
                }, [_hoisted_6], 8
                /* PROPS */
                , ["onClick"])) : vue.createCommentVNode("v-if", true)], 42
                /* CLASS, PROPS, HYDRATE_EVENTS */
                , ["onTouchstart", "onClick"]);
              }), 128
              /* KEYED_FRAGMENT */
              ))];
            }),
            _: 1
            /* STABLE */

          })];
        }),
        _: 1
        /* STABLE */

      })], 512
      /* NEED_PATCH */
      )], 512
      /* NEED_PATCH */
      );
    });

    function styleInject(css, ref) {
      if (ref === void 0) ref = {};
      var insertAt = ref.insertAt;

      if (!css || typeof document === 'undefined') {
        return;
      }

      var head = document.head || document.getElementsByTagName('head')[0];
      var style = document.createElement('style');
      style.type = 'text/css';

      if (insertAt === 'top') {
        if (head.firstChild) {
          head.insertBefore(style, head.firstChild);
        } else {
          head.appendChild(style);
        }
      } else {
        head.appendChild(style);
      }

      if (style.styleSheet) {
        style.styleSheet.cssText = css;
      } else {
        style.appendChild(document.createTextNode(css));
      }
    }

    var css_248z = ".attachment[data-v-443ecfba] {\n  display: flex;\n  flex-direction: column;\n  height: 100%; }\n  .attachment[data-v-443ecfba] .farris-attachment-img {\n    display: flex;\n    flex: 1;\n    justify-content: center;\n    align-items: center; }\n  .attachment[data-v-443ecfba] .img-container {\n    text-align: center;\n    width: 100%;\n    height: 100%; }\n  .attachment[data-v-443ecfba] video {\n    width: 100%; }\n\n.panzoom[data-v-443ecfba] {\n  transform: none;\n  backface-visibility: hidden;\n  transform-origin: 50% 50% 0px;\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap; }\n\n.page[data-v-443ecfba] {\n  display: inline-block;\n  background-color: #ffffff;\n  margin: 20px;\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  transition: all 0.3s; }\n\n.preview-mask[data-v-443ecfba] {\n  width: 100%;\n  height: 100%; }\n\n.farris-attachment[data-v-443ecfba] {\n  clear: both; }\n  .farris-attachment[data-v-443ecfba] .attachment-detail {\n    background: #fff;\n    height: 100%;\n    width: 100%; }\n  .farris-attachment[data-v-443ecfba] .selected-file {\n    box-shadow: inset 0px 0px 3px 3px #59a1ff;\n    border-radius: 5px; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation {\n    overflow: inherit;\n    white-space: nowrap; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation-1 {\n    overflow: auto; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item {\n    position: relative;\n    display: inline-block; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-img {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item img {\n      border-radius: 5px; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-pdf {\n      width: 100%;\n      height: 100%;\n      background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH5AIKAjsgUCRbrgAAEkxJREFUeNrtnHuUHFWdxz9V1a/peXT3PBJCXpMAMQGJuyuvREPgAMsqGCIEIQSFg7CHgCirrotP4Hh4iq4HQViQ4AsIj2RZ8YhodMEsENmgPJIhQ0LCMJNkMt2Z6Z7p6WfVvftHP6aquqq7OtHj/sHvnJqux+/+fr/7vb/7u79769bA+/Q+vU9/RVKaLbC+E4YUaBUwzQ/dGhSBgAItaulXA1SlVrh0UCxt1/VImvkkxFtjHPndnzDj5KUYuo6u6xQKBTKZDPl8Hp/PRzweZ9/evUxKydz2dk674IKm6uvzyvhAJ0wKCPtgVRh+kiA0zU+3gJ68YE4euguSQFABnwKaGQG32kvbtWJ7ptjKm+4pErKqj7yiMpGepJjPUSwWyefz5HK5gpQy0RoOvychvn94OPG5L3059+pLL/Lz+++nrb2dlWvWeKp3w4Z7MAondsDuHJw/grJxGsdENVZGNJb7FBYGFSISOgC/WhGoHIJrmgySHvkGdZXcWRfy0ZtuJxTrRBgGUkqEEABFRVEmcvl8Ui8Wd4wlk5sPJhIbl5x55tsvbdrEwsWLeeEXv+CTV1556AA91AkHivDRdthbZM5sP2s7NFYHFeb6DhWBvxApwEABXs/CwpUXseymO2jp7kaWwJniUxSklOi6TjabfTeZSj26Z8+e++f29g5u+vWzzJw5i3MuvthVj+b2YF25S31pDrw+wbLeIA90alwcVImqinMP8EJe+RvFJgVIGTCsw8G3tpOJH+DIE5bgb2sDWeuDqqoSCoWira2tyzra208Z3r+//9yLV7/3pz9u4YpL1vDIU095B+iBKMT1Eji/jHPO7ADrIhrHKSZrvXSDvzYlDTigl9CK920jM3KAmSd/BH9rqyNIFaBaWlpmh8Phs/q3bXv7zPPO2/nCc7/milUX8vgzzzg2RA29OhvSBiR1ls0J8Ei7xmwnvkPxokYxW/FY1tzFzLTo/NWcevOdhGKxmu5mp1QqNbh79+41XT3dmztnHEkkFqvhqfGgH8agKGDMYHZvgAc6fBznNLiYEXYCye26HgCNwLYPZqmKB5mUJPq3kxnez5En1fckgGAoFPEHAot29vf/dnRkJHXOGWfw+NNPW3hUe6GMgFVxmB3g6naNUyoGVQ7LtXS57+Ha7QAQHnicqi0VkELy1sbH+MNN/0Y2HkdRVdxIAWLR6Cnz5s9fu/Sss5T0xEQNj8WDHonA9CCsCrNgRoDvhFSirh5RtlCxNbdTcPXaFaUsy7PJrt63Va4SpC33ywNI4q1tZOMjHHnS0rqepGkaiqLMXnH22b+aPmPGwU/OmsUjmzc7A7S0A5aHISf4bMzHKnfs/zZkqaLi0MVsz+N928gm4qXAHQ7XAymaLxSGFp944otb581jw913V59ZMAgV4WcHCUU0lntJsb2MZLIJ3kbUbOolgb6nHuWFb32F7OhB1+7m8/nojMVOu+fb3w75nnvO+sx80eOHHj/dmsLCZgE4LJCaTaYoTTXMMcmRRwEpJX3/uR4pBMtvvtM1mfQHAgv/YenSHhRl0BWgLg0E9JSnD3+VJNAcj5CgaBpquA2EwJicqMaQqvEu8mX1T31dFWVvPf0EaBqnfvNWwj09FpCklIRCoUhnJNKt+f3uABWBnGCugI5D7RpePUpKUFta6f7Ct/AdMQcjcYDMK8+T/s3TFlRkHflmD6rbMGWQ+jY8BlKy/KY7aOnqsoAkhGjPZDJzW9rb/2wuaumUwdIkswvwN4lLw0rUACcgvOR0Yld9kfyubYz/6gmia9aiTZ9ZL3XxrNtuQwXBvo3reeHmG8iNjVlikqIofhRlRltXl0WeNUirEFQJVLpAM4c5dwFnUCxlJPhnzUHx+zDGEmS2vkR+Zx+BeUcjhXe9lRNZPpAgTNfS9LxCfRvX8/yNXyF7cCpwq6qK3++PzZzba7HZZ78IKFOVOdTWs5PTEkapVUuOKosFpA7pTc9gjI/XeoBDHuTWCI1sqQjcvuExpJAsv/E2wj09KIqCpmlhVbOOdBaANGUqMbK7eWlEcEgMzcmdYiqn1IJjlymlUWZSQYXsjjdALyLNNkp3e9xAsa9W2hur8mz7xvWgKpx2420EojHQtJrQUpPuOGXGislAp/ggzf3KXjGcqeT+ZYD8/pI35HOIQramvFtW7uZB9bzHnmxuf+oxUFVO/cYtqP5ATaLkcxPiUFfPq31eSAJGKgWA2hoBDVpOXEZm6x8QmcmqPqcKexniPZNSSiaFbtC94kIFzWgMUD3QvC5H1FTIahMoUNizE5GeILRoMWpHlOAxxzL5yvOWMk4yK89iGvxdS/P21Nol4TdPMLh1M/NH97oD5DRrblTZZp9XeRQoJoYxxpP458wjMH8hWnsUUSjU2OMmI6xCqzoF+uE4lUCQP7CXaT3Avqn7tZMTaT11G67rPbdXznG5QwF97CD5d3YS6D2ayMdWIYwiUjdclzacfoXLUS8NES5lpQPKFoDqeZBZsBMAbms29RI3I5Mht3M7vu4eYpdeRXH/EELUD7xuGb5T3HRbZ3Iqb7bLFSA34XYlTooageR4X0Jm68tIXUcNBinsG2hoQ6MEtZH9rrJckLN6kImpnje4tRBNPKfcWpk3XkEfGUbqRYzJiVIu5VCmkXfaAWvU4G722qmmi1VbxJT3CHNcMqfxpmvhAqpZuTBNAyr8enIMfTSB2tpGy3EfnpJZtkWYeJuyp0HjmG2y2N0oBll+HQzBqYCTsWWN5nlRjR4BwWOOJTBrLgCdn7oMrbOzWtbusl7skTZ++yEcbLKvrXvzoL/ggdt9n0rnhZeh+APoiTgtHzqByFkrm5qsNhVnGtnTCCAnahSLnHhqPMXJKAGhoxfRcca5pH7/LAfuuwtF0+i56noCs2YjhbO+ZuxxqosXu10BMvd/L8Ok12DqyK9A9BMX4eueRvJXG0g8/iPSr7xIy6Lj6fnMteDTqrZwiPbIJu6bdbkD5NYnZX0FXt25Wl5AsPcYui68jFz/Nia2PE8xMcq+u25EHxul54rPEf2nCxCiVp+TNxxOd7TLahikHQublzHMiLsEzqoc6cBbfh79xEUEZs0hsf5hCgeGwQcTL/+e4btvQw21MPOrt9J2whKEUavDoR6u9iAdGstl4HBaqaiJQdKm0Ow99iHVblwN0g5KhYDQUR+g59KryO/ZRfI3T5dSfEAKyYGf3cvIz/6DYO9R9H5vHR1LT0caUyOPueLCgz3SZI+0tz7O5esCZPckt7jkyOfhAOg87xICM+dwcOOj5AbfnUoOFRDZLEN3fJ34Iw8SOnoh8/79YTpXrkbxBxAGpUMvHbL8KwzTuU51unJI9tmQqpnNO51D7cYBM4/iwm/mLXkIhI5aQNeqT5N7521GHl9XalXbbgh9bIz3bvoXCgeGOeLKzzPvew/RfvIy4o+vQw2ECMyagy8SQVF9KL4gis+HLBQQooAxnmTyta3k3t2JNIyalc16+yadvKhmPUiaBLkBUG9YtYNnKadC90VXEJw7j8HbvkZ+aKDkw5LSkAQofg1/dzf+aTPIDw2Q3dFH20lLmHb5Wro+uRo0H6o/gJ4aQxTypUX3au0V1JYwMp/jwI9/yP7770QWC6722BvciequB9mBqkeNeKWA8MIP0r3q00xue434+nVUVlx9sRihuUcTPfUfCR/7IcLHLkaLxEBKjPQ4yU3PInJZOj6yHF8kiiwUmNjyP4ys/xG5Pf1loBRQfQSmzaT95GVEz/g4Y5t+SWb7aw2zPXMYaQyQQ9Q/HGCmNGlMv+xa/NOOYOi7NyMMg9jHVhBZdibtJyzB3zUdPTVGfu97xDf8nNzAO2R3vImeGkUfG0UKQevxH6Zn1WeInXUunSsuoO3EUxh/8b9JPv8ck2++Wirz7gCpV14i+cJv0ccOVgeARlR9heg1BtkrX9c7XK6ri+sGRE5cStd5F1Pct5fwwsX0XPBptI4IuYHdJJ55ksk3/kSm7zWMdAojVyyVr+y4KldyYuvLpP+8heEf30Pn2SuJnv4xYmevoGvlxRipJOk3/kR+3wCKolCMx9l7zy2Wethts9veOAZJkxfZ3o855R2V7b6VVz9uuYmvvY0jr70BXzRKeuAdpK4z9INbyex4k2JiGJEv72HRynj4rC5ffdOigZCSyR3bmdyxnX3r7qZl/gLCHziejqWnEeqdT/gDH8SYTJN45kn0zOTUHiO7xzjY7K2LYe1qVQ91cKGaXMP8TIDW2oqq+Yme8XGip5/N+JbN9F97CcX9Q0hReh2GQvVlnDlzd9OjQCmmKGBMTjDx+qtMvPYqIxt+ihIIlLb9CoHI56vv8tzIXEc3trpdTHF46CTIoqDcMh2nnEr4qIVk+rcz89qvIHI5hu6+lcLeoRIgWq1ee3e2D832nR1VsAApBTKfszYo7jrsLBXHsG/79PRezLUF7NcGBKZNY8bl1xGa3cvg3bdwxKX/TOtxH2L4pw+QfPF3td7iIE+Uja/8eol9ssHzemXMSaK9jGsXc1Ng5rUYL6D1uMXM++ZdoCrs/NJnaV24mOlrriS7q5+h+7+DKBRL3cqj/EY8de1pgup9VuIIkP3cKQu1dAMBbcf/PQu+/xOMTJr+ay4BKZl7wy2owRCDP7id7O5dKFrziZobr5M9Xso7gWI6kYV6w7xlOdJhE5NjBi0gfNQCFnz/x2gtYfqvu5TiaJxj7nyQ1uMWs++hexl5+lHrhgRbDZtp9Ubdyolcd5eYzsuxRyStb56tABmALpswWIIaDDL781+nZf4C+q/7DJldbzHvhtvoOX81yT/8jsF7bkUUCigqtfMuB0WVnSLlmYPr1hdXk6RJjkmN286UCm/5tBC37Zq1bsGTkJclNFXp7P6Wvi6gZd4COs88h/h/PUHylc303nAbM6/+Iuntr7PrxuvJ7d9XBccpHQCruzut/ZhHUDd7as4d7K9Z0zLdFxJ0SWakHkAZAXlBUZS7mJfRQxTzFPbvRU8lWXTvo0SWLCf54vPs+tb1pN/aVgKnjgzzVpZGGx8OZTTz2hsEoEvGDtoAskSGYklaQpb2czYmFTJ7dtK3djX6xDjG5CS7vvEF+q6+iHTfG1VwnEZH8zceTutLFaq3GcorIHYAnfQARQWG6wZpDQiqDAATEjrrrfdMaZSk3+4jfdc3Uf0+REEvTUFcPKdRbuNWqUNZfmkQ7iz2KDARVBmwjyUWgMYMkJCIaqT8Cp2KTWGFalq1LFXo+lRmi3O8cKuwHQy3Mp7scQGmHmAFSTJlELeXtwCWKMKuHHFdsqMy9Dml3/UybdnE4VZG2H4xXVcOL/a4eZY9bRFAUbJjV45E3Rg0CnwqRi4t2GzIxl2hXqWdWtvLx8+Kh/Nm7HFrjIpMCRgSJgSbV3WSS9Xb/rLAB2/mYNxgQ04yIBso92Jso2vZ4Bq879jw0phO13nJwITBxm1ZONomxALQtUnYW4Rrxtg5KXjMkFZhzRhwqJXxMhVxk+E0O29kjyFhUvDoNWO8PVSEtbZv6mpWa0MK3BtD7i9yX1qwRdQR7iWeuCWH1JHjNXZBfS+s3KtOnxz404It+4vcd28MWhz6sWPX3jAdcgakBcuO8PFIq8tHvQ1nmg7PzdMNc9Zb83WhyXs9/6MC0xTFC00aDA7rrGlT2RxS4YKRWh7H9f53MrAtCyuibB7RWTspGLRsUDK3mMSy4uc0StS8MZBWcLDLkVPAVCJpzb4B+68JTKe9SHZdkwaDIzprV0TYvC0Lu21fT1fI8bv53xbgvDBsmYTLutj5xwxbfQqL/AqznKYGXqYDh0tuo2HNCKi4l0MpxZy0YEsZnE0PJqBDg38dd9Zb1xnviJSSxw+GIKEze7qPq8MqlwRVeivLyWajndaAG/XCZgCq96GwY8A2PTCAgmQgbfDYiM59PT7e68tCzAdfTrnr1ahDm/KwMghdAcgJxq8Y5fenBni2KBlCoWhINKX0OtwvQPOSHB7ODjbA9bOraiIpS2AYpallKicYzkm2JA0eTuh87YpRnvxEC6moH7K6u+dYgPZCt3dAVsAMPxwVhOfGCfUG6Y6o9GQlc4AZGkQ1hRYJQWmaxrh5kb2bHo6nKaArkNclWQOSCgy3qAykDBLv5Yl/PEquPwf7CxBU4avjnuU2Rw93wv9mYKYfIj6IalCQpe/Mohq0adDjg5hq7XaVf4hSOa+AUhl5JKURo5JWaPbllnI5c9pR6UFCwqgBCQMmjNLn4kUJfqX0/z1SBrwr4SMqXJ7ifXqf3qf/P/R/ShQShKVd6yQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMTItMjhUMDk6MzE6NTYrMDA6MDC4axO5AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTAxLTA4VDE5OjQzOjU5KzAwOjAwnbLSDAAAACB0RVh0c29mdHdhcmUAaHR0cHM6Ly9pbWFnZW1hZ2ljay5vcme8zx2dAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAGHRFWHRUaHVtYjo6SW1hZ2U6OkhlaWdodAA1MTKPjVOBAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADUxMhx8A9wAAAAZdEVYdFRodW1iOjpNaW1ldHlwZQBpbWFnZS9wbmc/slZOAAAAF3RFWHRUaHVtYjo6TVRpbWUAMTU0Njk3NjYzOTogPbcAAAATdEVYdFRodW1iOjpTaXplADE4Mzc0NkJvZ7DBAAAAWnRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vZGF0YS93d3dyb290L3d3dy5lYXN5aWNvbi5uZXQvY2RuLWltZy5lYXN5aWNvbi5jbi9maWxlcy8xMTgvMTE4NDI1NS5wbmcVP1e2AAAAAElFTkSuQmCC\");\n      background-size: contain; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-icon-delete {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      right: -6px;\n      top: -6px;\n      width: 16px;\n      height: 16px;\n      background: #888;\n      border-radius: 50%; }\n      .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-icon-delete .fm-icon {\n        color: #fff;\n        font-size: 12px; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation .attachment-navigation-item .item-icon {\n      position: absolute; }\n  .farris-attachment[data-v-443ecfba] .first-navigation {\n    max-width: 80%; }\n  .farris-attachment[data-v-443ecfba] .first-navigation .attachment-navigation-item {\n    width: 55px;\n    height: 55px; }\n  .farris-attachment[data-v-443ecfba] .last-navigation .attachment-navigation-item {\n    margin: 6px;\n    width: 80px;\n    height: 80px; }\n  .farris-attachment[data-v-443ecfba] .attachment-navigation-icon {\n    text-align: center; }\n    .farris-attachment[data-v-443ecfba] .attachment-navigation-icon .add-icon {\n      margin: 8px 0;\n      width: 55px;\n      height: 55px; }\n  .farris-attachment[data-v-443ecfba] .van-grid-item .van-image img {\n    width: auto;\n    height: 300px; }\n  .farris-attachment[data-v-443ecfba] .fixed-bottom {\n    position: absolute;\n    bottom: 0;\n    width: 100%; }\n  .farris-attachment[data-v-443ecfba] .small-imgs-child {\n    width: 80px;\n    height: 80px;\n    background-size: contain; }\n  .farris-attachment[data-v-443ecfba] .small-imgs-item {\n    position: relative;\n    border-radius: 5px; }\n  .farris-attachment[data-v-443ecfba] .small-imgs-item img {\n    border-radius: 5px; }\n  .farris-attachment[data-v-443ecfba] .action-grid {\n    position: absolute;\n    width: 100%;\n    bottom: 100px; }\n  .farris-attachment[data-v-443ecfba] .preview-img img {\n    width: auto;\n    height: 300px; }\n  .farris-attachment[data-v-443ecfba] .upload-icon {\n    position: absolute;\n    top: 0.5rem;\n    left: 0.5rem; }\n  .farris-attachment[data-v-443ecfba] .upload-progress {\n    position: absolute;\n    bottom: 0;\n    left: 0; }\n  .farris-attachment[data-v-443ecfba] .upload-progress {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 5%; }\n  .farris-attachment[data-v-443ecfba] .van-image-preview .van-swipe-item .van-image {\n    position: absolute; }\n  .farris-attachment[data-v-443ecfba] .van-image-preview .van-swipe-item .van-image {\n    position: absolute; }\n";
    styleInject(css_248z);

    script.render = render;
    script.__scopeId = "data-v-443ecfba";
    script.__file = "src/components/attachment/src/attachment.vue";

    script.install = function (app) {
      app.component(script.name, script);
    };

    var uuid$1 = function uuid() {
      var d = new Date().getTime();
      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c === 'x' ? r : r & 0x3 | 0x8).toString(16);
      });
      return uuid;
    };

    var UploadOptions = function UploadOptions() {};

    var _components$1;
    var script$1 = vue.defineComponent({
      name: "fm-attachment-file",
      components: (_components$1 = {
        "van-image": Vant.Image
      }, _components$1[Vant.ImagePreview.Component.name] = Vant.ImagePreview.Component, _components$1),
      inject: {
        attachmentService: {
          default: null
        },
        uploadAttachmentService: {
          default: {}
        }
      },
      props: {
        rootId: {
          type: String,
          default: ""
        },
        parentDirName: {
          type: String,
          default: ""
        },
        // 文件类型
        accept: {
          type: String,
          //default:'application/vnd.ms-powerpoint MS PowerPoint Presentation,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/msword MS Word Document,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel MS Excel Spreadsheet,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/pdf Portable Document Format'
          default: "application/msexcel," + "application/msword," + "application/vnd.ms-powerpoint," + // pdf
          "application/pdf," + // txt
          "text/plain," + // ppt  pptx
          "application/vnd.openxmlformats-officedocument.presentationml.presentation," + // xls xlsx
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet," + // doc docx
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document," + "image/jpg,image/gif,image/jpeg,image/png,image/bmp"
        },
        // 多选
        multiple: {
          type: Boolean,
          default: true
        },
        // 传入文件列表
        fileList: {
          type: Array,
          default: function _default() {
            return [];
          }
        },
        // 多选
        maxNum: {
          type: Number,
          default: 9
        },
        // 禁用上传
        disabled: {
          type: Boolean,
          default: false
        },
        // 读取文件前事件
        beforeReadFile: {
          type: Function
        },
        // 上传事件
        uploadFile: {
          type: Function
        },
        // 文件预览事件
        previewFile: {
          type: Function
        },
        // 拍照前回调
        beforeTakePhoto: {
          type: Function
        },
        removable: {
          type: Boolean,
          default: false
        },
        direction: {
          // type: 'vertical' | 'horizontal',
          type: String,
          default: "vertical"
        },
        title: {
          type: String,
          default: "附件"
        },
        cloudPlus: {
          type: Object,
          default: function _default() {
            return {
              photo: {
                quality: 60,
                encodingType: 1,
                targetWidth: 602,
                targetHeight: 600 // isPhoto: true

              },
              album: {
                quality: 60,
                encodingType: 1,
                targetWidth: 600,
                targetHeight: 600
              },
              selectFile: {
                maximum: 5,
                fileType: ".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX"
              }
            };
          }
        },
        uploadOptions: {
          type: UploadOptions,
          default: function _default() {
            return {
              showPhoto: true,
              showAlbum: true,
              showVideo: false,
              showFile: true,
              // 照片质量
              photoQuality: 100,
              // 相册图片质量
              albumQuality: 100,
              // 文件上传数量
              fileMaxCount: 6,
              // 短视频id
              videoId: uuid$1(),
              // 短视频质量
              videoQuality: 0.8,
              // 短视频时间
              videoTime: 30
            };
          }
        },
        disablePhoto: {
          type: Boolean,
          default: false
        },
        // 禁用
        disableAlbum: {
          type: Boolean,
          default: false
        },
        disableFile: {
          type: Boolean,
          default: false
        },
        disableVideo: {
          type: Boolean,
          default: false
        },
        // 隐藏
        hidePhoto: {
          type: Boolean,
          default: false
        },
        hideAlbum: {
          type: Boolean,
          default: false
        },
        hideFile: {
          type: Boolean,
          default: false
        },
        // 上传图片的最大数量
        maxCount: {
          type: Number,
          default: 30
        },
        // 上传图片最大尺寸  默认10M
        maxSize: {
          type: Number,
          default: 20
        },
        displayMaxCount: {
          type: Boolean,
          default: false
        },
        allowMaxSize: {
          type: Boolean,
          default: false
        },
        allowMaxCount: {
          type: Boolean,
          default: false
        }
      },
      data: function data() {
        return {
          fromProp: false,
          subscription: "",

          /**
           * 文件列表
           */
          rawFiles: [],

          /**
           * 展示附件上传界面开关
           */
          showAction: false,

          /**
           * 附件保存页面
           */
          saveAction: false,

          /**
           * 当前选中附件
           */
          selectedFile: null,

          /**
           * 选中文件预览路径
           */
          selectedFilePath: "",

          /**
           * 附件描述
           */
          description: "",

          /**
           * 未上传的文件列表
           */
          notUploadedFileList: [],

          /**
          预览页面
          */
          previewPages: [],
          pdfUrl: "",

          /**
          弹出层显示
          */
          show: false,
          showPdf: false,
          showDoc: false,
          showVideo: false,
          isSelectAction: false,
          isPreviewAction: false,
          docStyle: {},
          actions: [{
            name: "从相册选择",
            disabled: this.albumDisabled
          }, {
            name: "相机",
            disabled: this.photoDisabled
          }, {
            name: "手机文件",
            disabled: this.fileDisabled
          }],
          previewAction: [{
            name: "在线预览"
          }, {
            name: "下载"
          }],
          navibarDisplay: "",
          footerDisplay: ""
        };
      },
      computed: {
        uploadFiles: function uploadFiles() {
          var _ref,
              _this = this;

          this.rawFiles = (_ref = []).concat.apply(_ref, this.fileList.map(function (file) {
            return file;
          }));

          if (this.rawFiles && this.rawFiles.length) {
            if (!this.selectedFile || !this.rawFiles.find(function (f) {
              return f.id === _this.selectedFile.id;
            })) {
              this.selectedFile = this.rawFiles[0];
            }

            if (this.selectedFile) {
              this.$loading.hide();
            }

            if (!this.selectedFile) {
              // 删除的附件
              this.selectedFile = this.rawFiles[this.rawFiles.length - 1];
            }

            return this.rawFiles;
          }

          this.selectedFile = null;
          return [];
        },
        isEmpty: function isEmpty() {
          return this.rawFiles && !this.rawFiles.length;
        },
        previewEnable: function previewEnable() {
          return this.showAction && this.rawFiles && !!this.rawFiles.length;
        }
      },
      mounted: function mounted() {
        var _this2 = this;

        // 处理原生返回
        setTimeout(function () {
          window.top["detailBackBtnClickHandler"] = function (backFn) {
            var pageElem = window.top.document.querySelector(".fm-page-record-deatial");
            var attachPreviewContainer = pageElem.querySelector("#fm-attach-preview-container");

            if (!pageElem || !attachPreviewContainer) {
              return true;
            } else {
              try {
                _this2.closeScale(window.top.document);

                pageElem.removeChild(attachPreviewContainer);
                return false;
              } catch (e) {
                return true;
              }
            }
          };
        }, 0); // 不同设备选择文件

        if (this.attachmentService) {
          this.subscription = this.attachmentService.collectFile.subscribe(function (res) {
            if (Object.prototype.toString.call(res) === "[object Array]" && res.length === 0) {
              return;
            }

            _this2.rawFiles = [].concat(_this2.rawFiles, res);

            _this2.afterRead(res);
          });
        }
      },
      unmounted: function unmounted() {
        if (this.subscription) {
          this.subscription.unsubscribe();
        }
      },
      methods: {
        openScale: function openScale(currentDoc) {
          var originMeta = currentDoc.getElementsByName("viewport")[0];
          var meta = currentDoc.createElement("meta");
          meta.name = "viewport";
          meta.content = "width=device-width, initial-scale=1.0";
          var head = currentDoc.getElementsByTagName("head")[0];

          if (originMeta) {
            head.removeChild(originMeta);
          }

          head.appendChild(meta);
        },
        closeScale: function closeScale(currentDoc) {
          var originMeta = currentDoc.getElementsByName("viewport")[0];
          var meta = currentDoc.createElement("meta");
          meta.name = "viewport";
          meta.content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n";
          var head = currentDoc.getElementsByTagName("head")[0];

          if (originMeta) {
            head.removeChild(originMeta);
          }

          head.appendChild(meta);
        },
        transformSize: function transformSize(size) {
          if (size < Math.pow(1024, 2)) {
            return (size / 1024).toFixed(2) + "KB";
          } else if (size >= Math.pow(1024, 2) && size < Math.pow(1024, 3)) {
            return (size / Math.pow(1024, 2)).toFixed(2) + "MB";
          } else if (size >= Math.pow(1024, 3) && size < Math.pow(1024, 4)) {
            return (size / Math.pow(1024, 3)).toFixed(2) + "GB";
          }
        },
        selectAction: function selectAction(res) {
          var actionName = res.name;

          if (actionName === "在线预览") {
            this.genPreview(this.selectedFile);
          } else if (actionName === "下载") {
            this.downloadAttachment(this.selectedFile);
          }
        },
        selectFileFromMobile: function selectFileFromMobile() {
          var _this3 = this;

          if (this.disableFile) {
            return;
          }

          this.attachmentService.getSysInfo().subscribe(function (res) {
            if (res && res.platform === "Android") {
              _this3.attachmentService.selectFile({
                maximum: _this3.uploadOptions && _this3.uploadOptions.fileMaxCount || 6,
                fileType: ".pdf|.jpg|.png|.doc|.docx|.xls|.xlsx|.ppt|.pptx|.txt|.DOC|.DOCX|.XLS|.XLSX|.PPT|.PPTX"
              });
            } else if (res && res.platform === "iOS") {
              _this3.$refs.fileUploadRef.chooseFile();
            }
          });
          this.isSelectAction = false;
        },
        selectFileFromAlbum: function selectFileFromAlbum() {
          if (this.disableAlbum) {
            return;
          }

          this.attachmentService.selectAttachment({
            quality: this.uploadOptions && this.uploadOptions.albumQuality || 100,
            encodingType: 1,
            mType: 0,
            // 云+默认最多8张不支持配置  故此属性不作为输入属性
            maxNum: 8,
            targetWidth: this.uploadOptions.targetWidth || 1000,
            targetHeight: this.uploadOptions.targetHeight || 1000
          });
          this.isSelectAction = false;
        },
        takePhoto: function takePhoto() {
          if (this.disablePhoto) {
            return;
          }

          this.attachmentService.takePhoto({
            quality: this.uploadOptions && this.uploadOptions.photoQuality || 100,
            encodingType: 1,
            targetWidth: this.uploadOptions.targetWidth || 1000,
            targetHeight: this.uploadOptions.targetHeight || 1000
          });
          this.isSelectAction = false;
        },
        takeShortVideo: function takeShortVideo() {
          this.attachmentService.takeShortVideo({
            id: this.uploadOptions && this.uploadOptions.videoId || uuid$1(),
            quality: 0.8,
            time: this.uploadOptions && this.uploadOptions.videoTime || 20
          });
          this.isSelectAction = false;
        },

        /**
         * 添加文件
         */
        appendFile: function appendFile() {
          this.$refs.fileUploadRef.chooseFile();
        },
        toUpload: function toUpload() {
          this.isSelectAction = true;
        },
        onCancel: function onCancel() {
          this.isSelectAction = false;
        },

        /**
         * 读取文件之前
         */
        beforeRead: function beforeRead(file) {
          if (this.beforeReadFile) {
            // 读取文件前事件
            var beforeReadRes = this.beforeReadFile(file);
            return beforeReadRes;
          }

          return true;
        },
        afterRead: function afterRead(file) {
          var _this4 = this;

          if (file && file.length) {
            this.notUploadedFileList = file.map(function (fileItem) {
              fileItem.id = uuid$1();
              return fileItem;
            });
          } else {
            file.id = uuid$1();
            this.notUploadedFileList = [file];
          } // 允许设置最大尺寸


          if (this.allowMaxSize) {
            var beyondLimit = this.notUploadedFileList.some(function (f) {
              var realStr = f.content.substring(f.content.indexOf(",") + 1);
              var realStrLen = realStr.length; // base64转换成字节

              var fSize = parseInt(realStrLen - realStrLen / 8 * 2);
              return fSize > _this4.maxSize * Math.pow(1024, 2);
            });

            if (beyondLimit) {
              this.$dialog.alert({
                title: "上传失败",
                message: "上传文件太大，请重新选择！"
              });
              return;
            }
          } //   计算附件上传数量


          if (this.allowMaxCount) {
            if (this.notUploadedFileList.length + this.uploadFiles.length > this.maxCount) {
              var removedCount = this.notUploadedFileList.length + this.uploadFiles.length - this.maxCount;
              var count = this.notUploadedFileList.length - removedCount;
              this.notUploadedFileList = this.notUploadedFileList.slice(0, count);
            }
          }

          this.$loading.show("附件上传中"); // 赋值最新的上传文件附件id

          if (this.uploadAttachmentService) {
            // 固定的服务  缓存附件到服务器
            if (file.type === "video/mp4") {
              this.videoUrl = file.url.substring(0, file.url.lastIndexOf("/"));
              this.uploadAttachmentService.upload([file], {
                parentDirName: this.parentDirName,
                rootId: this.rootId
              }).subscribe(function (res) {
                var list = {
                  fileName: file.file.name,
                  metadataId: file.id
                };

                _this4.$emit("afterAppendFile", [list]);
              });
            } else {
              this.uploadAttachmentService.upload(this.notUploadedFileList, {
                parentDirName: this.parentDirName,
                rootId: this.rootId
              }).subscribe(function (res) {
                var list = _this4.notUploadedFileList.map(function (l) {
                  return {
                    fileName: l.file.name,
                    metadataId: l.id
                  };
                });

                _this4.$emit("afterAppendFile", list);
              });
            }
          } else {
            // h5 添加文件后事件
            var list = this.notUploadedFileList.map(function (l) {
              return {
                fileName: l.file.name,
                metadataId: l.id
              };
            });
            this.$emit("afterAppendFile", list);
          }
        },

        /**
         * 选中文件
         */
        selectFile: function selectFile(item) {
          this.genPreview(item);
          this.selectedFile = item;
          this.$emit("selectCurrentItem");
        },

        /**
        删除附件
        */
        deleteAttachment: function deleteAttachment(item) {
          this.$emit("remove", [item.attachmentId]);
        },
        genPreview: function genPreview(selectedFile) {
          if (!selectedFile || !selectedFile.name) {
            return;
          }

          this.selectedFile = selectedFile; // 隐藏工作流工具栏
          //this.hideWorkFlowNavibar();

          if (this.findWorkFlow()) {
            this.previewFileInWorkFlow(selectedFile.attachmentId, this.rootId, selectedFile.name);
          } else {
            if (window.top && window.top !== window.self) {
              this.openScale(window.top.document);
            }

            this.openScale(window.document);

            if (selectedFile.name.toLowerCase().includes("mp4") || selectedFile.name.toLowerCase().includes("mov")) {
              this.show = true;
              this.showPdf = false;
              this.showDoc = false;
              this.showVideo = true;
              var videoUrl = selectedFile.content || selectedFile.url;
              this.attachmentService.playShortVideo(videoUrl + "/" + selectedFile.name);
            } else {
              this.show = true;
              this.showPdf = true;
              this.pdfUrl = "/platform/runtime/dfs/viewpage/index.html?metadataId=" + selectedFile.attachmentId + "&rootId=" + this.rootId + "&fileType=2";
            }
          }

          if (window["MOBILE_ORIGIN_BACK"] && window["MOBILE_ORIGIN_BACK"].pushOriginGoback) {
            window["MOBILE_ORIGIN_BACK"].pushOriginGoback(this.closed);
          }

          this.$emit("preview", selectedFile);
        },
        getAttachmentUrl: function getAttachmentUrl(attachmentId) {
          var ishttps = "https:" == document.location.protocol ? true : false;
          var url = window.location.host;

          if (ishttps) {
            url = "https://" + url;
          } else {
            url = "http://" + url;
          }

          url += this.uploadAttachmentService.getAttachmentPath(attachmentId, this.rootId);
          return url;
        },
        downloadAttachment: function downloadAttachment(attachment) {
          var attachmentName = attachment.name;
          var attachmentUrl = this.getAttachmentUrl(attachment.attachmentId);
          var options = {
            url: attachmentUrl,
            saveName: attachmentName // autoOpen,

          };
          this.attachmentService.downloadAttachment(options).subscribe(function (res) {});
        },
        closed: function closed() {
          if (window.top && window.top !== window.self) {
            this.closeScale(window.top.document);
          }

          this.closeScale(window.document); // 隐藏工作流头部工具栏
          //this.displayWorkFlowNavibar();

          this.show = false;
          this.showPdf = false;

          if (window["MOBILE_ORIGIN_BACK"] && window["MOBILE_ORIGIN_BACK"].popOriginGoback) {
            window["MOBILE_ORIGIN_BACK"].popOriginGoback();
          }
        },
        hideWorkFlowNavibar: function hideWorkFlowNavibar() {
          var findWorkFlow = this.findWorkFlow();

          if (!findWorkFlow) {
            return;
          }

          var workFlowNavibar = window.top.document.querySelector("fmapprove-navbar");

          if (workFlowNavibar) {
            this.navibarDisplay = window.top.getComputedStyle(workFlowNavibar).display;
            workFlowNavibar.style.display = "none";
          }

          var workFlowFooter = window.top.document.querySelector("div.fm-page-footer");

          if (workFlowFooter) {
            this.footerDisplay = window.top.getComputedStyle(workFlowFooter).display;
            workFlowFooter.style.display = "none";
          }
        },
        displayWorkFlowNavibar: function displayWorkFlowNavibar() {
          var findWorkFlow = this.findWorkFlow();

          if (!findWorkFlow) {
            return;
          }

          var workFlowNavibar = window.top.document.querySelector("fmapprove-navbar");

          if (workFlowNavibar) {
            workFlowNavibar.style.display = this.navibarDisplay;
          }

          var workFlowFooter = window.top.document.querySelector("div.fm-page-footer");

          if (workFlowFooter) {
            workFlowFooter.style.display = this.footerDisplay;
          }
        },
        findWorkFlow: function findWorkFlow() {
          if (window.top === window.self) {
            return false;
          }

          var isWorkFlow = window.top.location.href.includes("/platform/runtime/wf/webapp/");
          return isWorkFlow;
        },

        /**
         * 预览附件
         */
        previewFileInWorkFlow: function previewFileInWorkFlow(attachId, rootId, fileName) {
          var _this5 = this;

          // 打开缩放
          this.openScale(window.top.document);
          fileName = fileName || "附件预览";
          var previewUrl = "/platform/runtime/dfs/viewpage/index.html?metadataId=" + attachId + "&rootId=" + rootId + "&fileType=2";
          var previewHtml = "\n              <div class=\"fm-file-preview\">\n\n              <div class=\"fm-file-preview-header\">\n                <nav class=\"fm-navbar\">\n                    <div id=\"fm-attach-preview-back-btn\" class=\"fm-navbar-left fm-navbar-left-padding\">\n                        <span class=\"fm-navbar-left-arrow fm-icon fm-icon-arrow-chevron-left\"></span>\n                    </div>\n                    <div class=\"fm-navbar-title\">" + fileName + "</div>\n                </nav>\n              </div>\n                <div class=\"fm-file-preview-content\">\n                  <div class=\"preview-content\">\n                    <iframe src=\"" + previewUrl + "\"></iframe>\n                  </div>\n                </div>\n              </div>\n            ";
          var pageElem = window.top.document.querySelector(".fm-page-record-deatial"); // 预览容器

          var previewContainerElem = document.createElement("div");
          previewContainerElem.id = "fm-attach-preview-container";
          previewContainerElem.classList.add("fm-attach-preview-container");
          previewContainerElem.innerHTML = previewHtml; // 返回按钮处理

          var backBtn = previewContainerElem.querySelector("div.fm-navbar-left");
          backBtn.addEventListener("click", function () {
            _this5.closeScale(window.top.document);

            pageElem.removeChild(previewContainerElem);
          });
          pageElem.appendChild(previewContainerElem);
        },
        openDownloadList: function openDownloadList(item) {
          this.isPreviewAction = true;
          this.selectedFile = item;
        }
      }
    });

    var _hoisted_1$1 = {
      class: "p-md attachment-bg"
    };
    var _hoisted_2$1 = {
      key: 0,
      class: "fm-attachment-container attachment-navigation"
    };
    var _hoisted_3$1 = {
      class: "fm-attachment-files-list"
    };

    var _hoisted_4$1 = /*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-close"
    }, null, -1
    /* HOISTED */
    );

    var _hoisted_5$1 = /*#__PURE__*/vue.createVNode("div", {
      class: "fm-attachment-upload-btn"
    }, [/*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-addbutton"
    })], -1
    /* HOISTED */
    );

    var _hoisted_6$1 = {
      class: "attachment-actionsheet-content"
    };

    var _hoisted_7 = /*#__PURE__*/vue.createVNode("span", {
      class: "demo-actionsheet-item-text"
    }, "从相册选择", -1
    /* HOISTED */
    );

    var _hoisted_8 = /*#__PURE__*/vue.createVNode("span", {
      class: "attachment-actionsheet-item-text"
    }, "相机", -1
    /* HOISTED */
    );

    var _hoisted_9 = /*#__PURE__*/vue.createVNode("span", {
      class: "attachment-actionsheet-item-text"
    }, "短视频", -1
    /* HOISTED */
    );

    var _hoisted_10 = /*#__PURE__*/vue.createVNode("span", {
      class: "attachment-actionsheet-item-text"
    }, "手机文件", -1
    /* HOISTED */
    );

    var _hoisted_11 = {
      style: {
        "padding": ".5rem 0"
      }
    };
    var _hoisted_12 = {
      key: 0
    };

    var _hoisted_13 = /*#__PURE__*/vue.createTextVNode(") ");

    var _hoisted_14 = {
      class: "fm-tmpl-attachment-img"
    };
    var _hoisted_15 = {
      class: "attachment-text"
    };
    var _hoisted_16 = {
      class: "fm-tmpl-attachment-name"
    };
    var _hoisted_17 = {
      class: "attachment-button"
    };

    var _hoisted_18 = /*#__PURE__*/vue.createTextVNode("预览");

    var _hoisted_19 = {
      class: "fm-tmpl-attachment-footer"
    };
    var _hoisted_20 = {
      class: "fm-tmpl-attachment-footer-text"
    };

    var _hoisted_21 = /*#__PURE__*/vue.createVNode("span", null, null, -1
    /* HOISTED */
    );

    var _hoisted_22 = /*#__PURE__*/vue.createVNode("div", {
      class: "fm-attachment-upload-btn"
    }, [/*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-addbutton"
    })], -1
    /* HOISTED */
    );

    function render$1(_ctx, _cache, $props, $setup, $data, $options) {
      var _component_van_uploader = vue.resolveComponent("van-uploader");

      var _component_van_image = vue.resolveComponent("van-image");

      var _component_fm_action_sheet = vue.resolveComponent("fm-action-sheet");

      var _component_fm_button = vue.resolveComponent("fm-button");

      var _component_fm_icon = vue.resolveComponent("fm-icon");

      var _component_fm_listview = vue.resolveComponent("fm-listview");

      var _component_van_icon = vue.resolveComponent("van-icon");

      var _component_fm_navbar = vue.resolveComponent("fm-navbar");

      var _component_van_popup = vue.resolveComponent("van-popup");

      return vue.openBlock(), vue.createBlock("div", null, [vue.createVNode("div", _hoisted_1$1, [vue.createVNode("div", {
        class: ["farris-attachment-entry", {
          'farris-attachment-entry-vertical': _ctx.direction === 'vertical'
        }]
      }, [vue.withDirectives(vue.createVNode(_component_van_uploader, {
        multiple: _ctx.multiple,
        ref: "fileUploadRef",
        "max-count": _ctx.maxNum,
        modelValue: _ctx.rawFiles,
        "onUpdate:modelValue": _cache[1] || (_cache[1] = function ($event) {
          return _ctx.rawFiles = $event;
        }),
        disabled: _ctx.disabled,
        "preview-full-image": true,
        accept: _ctx.accept,
        "before-read": _ctx.beforeRead,
        "after-read": _ctx.afterRead
      }, null, 8
      /* PROPS */
      , ["multiple", "max-count", "modelValue", "disabled", "accept", "before-read", "after-read"]), [[vue.vShow, false]]), _ctx.direction === 'horizontal' ? (vue.openBlock(), vue.createBlock("div", _hoisted_2$1, [vue.createVNode("div", _hoisted_3$1, [(vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.uploadFiles, function (item, index) {
        return vue.openBlock(), vue.createBlock("div", {
          class: "fm-attachment-files-item attachment-navigation-item",
          key: index,
          onClick: vue.withModifiers(function ($event) {
            return _ctx.downloadAttachment(item);
          }, ["stop"])
        }, [item && item.name && !item.name.includes('mp4') || !item.name ? (vue.openBlock(), vue.createBlock(_component_van_image, {
          key: 0,
          src: item.content || item.url,
          class: "item-img",
          width: "100%",
          height: "100%"
        }, null, 8
        /* PROPS */
        , ["src"])) : vue.createCommentVNode("v-if", true), item && item.name && item.name.toLowerCase().includes('mp4') || item.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock(_component_van_image, {
          key: 1,
          src: '/platform/runtime/dfs/images/file.png',
          class: "item-img",
          width: "48",
          height: "48"
        }, null, 8
        /* PROPS */
        , ["src"])) : vue.createCommentVNode("v-if", true), _ctx.uploadFiles && _ctx.uploadFiles.length && !_ctx.removable ? (vue.openBlock(), vue.createBlock("div", {
          key: 2,
          class: ["item-icon-delete", {
            'fm-attachment-disabled': _ctx.disabled
          }],
          onClick: vue.withModifiers(function ($event) {
            return _ctx.deleteAttachment(item);
          }, ["stop"])
        }, [_hoisted_4$1], 10
        /* CLASS, PROPS */
        , ["onClick"])) : vue.createCommentVNode("v-if", true)], 8
        /* PROPS */
        , ["onClick"]);
      }), 128
      /* KEYED_FRAGMENT */
      ))]), !_ctx.removable ? (vue.openBlock(), vue.createBlock("div", {
        key: 0,
        class: ["fm-attachment-upload-btn-container", {
          'fm-attachment-disabled': _ctx.disabled
        }],
        onClick: _cache[2] || (_cache[2] = function () {
          return _ctx.toUpload && _ctx.toUpload.apply(_ctx, arguments);
        })
      }, [_hoisted_5$1], 2
      /* CLASS */
      )) : vue.createCommentVNode("v-if", true)])) : vue.createCommentVNode("v-if", true), vue.createVNode(_component_fm_action_sheet, {
        show: _ctx.isSelectAction,
        "onUpdate:show": _cache[7] || (_cache[7] = function ($event) {
          return _ctx.isSelectAction = $event;
        }),
        actions: _ctx.actions,
        "cancel-text": "取消",
        "close-on-click-action": ""
      }, {
        default: vue.withCtx(function () {
          return [vue.createVNode("div", _hoisted_6$1, [_ctx.uploadOptions && _ctx.uploadOptions.showAlbum ? (vue.openBlock(), vue.createBlock("div", {
            key: 0,
            class: ["attachment-actionsheet-item", {
              'attachment-actionsheet-item-disabled': _ctx.disableAlbum
            }],
            onClick: _cache[3] || (_cache[3] = function () {
              return _ctx.selectFileFromAlbum && _ctx.selectFileFromAlbum.apply(_ctx, arguments);
            })
          }, [_hoisted_7], 2
          /* CLASS */
          )) : vue.createCommentVNode("v-if", true), _ctx.uploadOptions && _ctx.uploadOptions.showPhoto ? (vue.openBlock(), vue.createBlock("div", {
            key: 1,
            class: ["attachment-actionsheet-item", {
              'attachment-actionsheet-item-disabled': _ctx.disablePhoto
            }],
            onClick: _cache[4] || (_cache[4] = function () {
              return _ctx.takePhoto && _ctx.takePhoto.apply(_ctx, arguments);
            })
          }, [_hoisted_8], 2
          /* CLASS */
          )) : vue.createCommentVNode("v-if", true), _ctx.uploadOptions && _ctx.uploadOptions.showVideo ? (vue.openBlock(), vue.createBlock("div", {
            key: 2,
            class: ["attachment-actionsheet-item", {
              'attachment-actionsheet-item-disabled': _ctx.disablePhoto
            }],
            onClick: _cache[5] || (_cache[5] = function () {
              return _ctx.takeShortVideo && _ctx.takeShortVideo.apply(_ctx, arguments);
            })
          }, [_hoisted_9], 2
          /* CLASS */
          )) : vue.createCommentVNode("v-if", true), _ctx.uploadOptions && _ctx.uploadOptions.showFile ? (vue.openBlock(), vue.createBlock("div", {
            key: 3,
            class: ["attachment-actionsheet-item", {
              'attachment-actionsheet-item-disabled': _ctx.disableFile
            }],
            onClick: _cache[6] || (_cache[6] = function () {
              return _ctx.selectFileFromMobile && _ctx.selectFileFromMobile.apply(_ctx, arguments);
            })
          }, [_hoisted_10], 2
          /* CLASS */
          )) : vue.createCommentVNode("v-if", true)])];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["show", "actions"]), vue.createVNode(_component_fm_action_sheet, {
        show: _ctx.isPreviewAction,
        "onUpdate:show": _cache[8] || (_cache[8] = function ($event) {
          return _ctx.isPreviewAction = $event;
        }),
        actions: _ctx.previewAction,
        "cancel-text": "取消",
        "close-on-click-action": "",
        onSelect: _ctx.selectAction
      }, null, 8
      /* PROPS */
      , ["show", "actions", "onSelect"]), _ctx.direction === 'vertical' ? (vue.openBlock(), vue.createBlock(_component_fm_listview, {
        key: 1,
        listData: _ctx.uploadFiles,
        finished: true,
        showFinishedText: false,
        className: "listview-content"
      }, {
        listViewHeader: vue.withCtx(function () {
          return [vue.createVNode("div", _hoisted_11, [vue.createTextVNode(" 附件(" + vue.toDisplayString(_ctx.uploadFiles.length), 1
          /* TEXT */
          ), _ctx.allowMaxCount ? (vue.openBlock(), vue.createBlock("span", _hoisted_12, "/" + vue.toDisplayString(Math.max(_ctx.uploadFiles.length, _ctx.maxCount)), 1
          /* TEXT */
          )) : vue.createCommentVNode("v-if", true), _hoisted_13])];
        }),
        default: vue.withCtx(function (props) {
          return [vue.createVNode("div", {
            class: "fm-tmpl-listview-attachment",
            onClick: vue.withModifiers(function ($event) {
              return _ctx.openDownloadList(props.item);
            }, ["stop"])
          }, [vue.createVNode("div", _hoisted_14, [props.item && props.item.name && !props.item.name.includes('mp4') || !props.item.name ? (vue.openBlock(), vue.createBlock(_component_van_image, {
            key: 0,
            src: props.item.content || props.item.url,
            class: "item-img"
          }, null, 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true), props.item && props.item.name && props.item.name.toLowerCase().includes('mp4') || props.item.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock(_component_van_image, {
            key: 1,
            src: '/platform/runtime/dfs/images/file.png',
            class: "item-img"
          }, null, 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true)]), vue.createVNode("div", _hoisted_15, [vue.createVNode("div", null, [vue.createVNode("div", _hoisted_16, [vue.createVNode("span", null, vue.toDisplayString(props.item.name), 1
          /* TEXT */
          )]), vue.createVNode("div", _hoisted_17, [vue.createVNode(_component_fm_button, {
            className: "attachment-button-custom",
            color: "#3A90FF",
            plain: "",
            onClick: vue.withModifiers(function ($event) {
              return _ctx.genPreview(props.item);
            }, ["stop"])
          }, {
            default: vue.withCtx(function () {
              return [_hoisted_18];
            }),
            _: 2
            /* DYNAMIC */

          }, 1032
          /* PROPS, DYNAMIC_SLOTS */
          , ["onClick"])])]), vue.createVNode("div", _hoisted_19, [vue.createVNode("span", _hoisted_20, vue.toDisplayString(_ctx.transformSize(props.item.size)), 1
          /* TEXT */
          ), vue.createVNode("span", null, vue.toDisplayString(props.item.createTime), 1
          /* TEXT */
          )])]), !_ctx.removable ? (vue.openBlock(), vue.createBlock("div", {
            key: 0,
            class: "attachment-icon",
            onClick: vue.withModifiers(function ($event) {
              return _ctx.deleteAttachment(props.item);
            }, ["stop"])
          }, [vue.createVNode(_component_fm_icon, {
            name: "s-clear",
            color: "#888",
            size: "16"
          })], 8
          /* PROPS */
          , ["onClick"])) : vue.createCommentVNode("v-if", true)], 8
          /* PROPS */
          , ["onClick"])];
        }),
        listviewEmpty: vue.withCtx(function () {
          return [_hoisted_21];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["listData"])) : vue.createCommentVNode("v-if", true), !_ctx.removable && _ctx.direction === 'vertical' && (_ctx.allowMaxCount && _ctx.uploadFiles.length < _ctx.maxCount || !_ctx.allowMaxCount) ? (vue.openBlock(), vue.createBlock("div", {
        key: 2,
        class: ["fm-attachment-upload-listview-btn-container", {
          'fm-attachment-disabled': _ctx.disabled
        }],
        onClick: _cache[9] || (_cache[9] = function () {
          return _ctx.toUpload && _ctx.toUpload.apply(_ctx, arguments);
        })
      }, [_hoisted_22], 2
      /* CLASS */
      )) : vue.createCommentVNode("v-if", true), vue.createVNode(_component_van_popup, {
        show: _ctx.show,
        "onUpdate:show": _cache[10] || (_cache[10] = function ($event) {
          return _ctx.show = $event;
        }),
        style: {
          height: '100%',
          width: '100%'
        }
      }, {
        default: vue.withCtx(function () {
          return [vue.createVNode(_component_fm_navbar, {
            title: _ctx.selectedFile && _ctx.selectedFile.name,
            onClickLeft: _ctx.closed
          }, {
            left: vue.withCtx(function () {
              return [vue.createVNode(_component_van_icon, {
                name: "arrow-left",
                size: "18",
                color: "#333"
              })];
            }),
            _: 1
            /* STABLE */

          }, 8
          /* PROPS */
          , ["title", "onClickLeft"]), _ctx.showPdf ? (vue.openBlock(), vue.createBlock("iframe", {
            key: 0,
            class: "pdf-iframe",
            scrolling: "yes",
            src: _ctx.pdfUrl,
            width: "100%",
            height: "100%"
          }, "\r\n          ", 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true)];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["show"])], 2
      /* CLASS */
      )])]);
    }

    var css_248z$1 = ".attachment-actionsheet-item-disabled {\n  color: #ccc; }\n\n.attachment-actionsheet-content {\n  flex: 1 auto;\n  overflow-y: auto; }\n  .attachment-actionsheet-content .attachment-actionsheet-item {\n    display: block;\n    width: 100%;\n    padding: 14px 16px;\n    font-size: 16px;\n    text-align: center;\n    background-color: #fff;\n    border: none;\n    cursor: pointer;\n    text-align: center; }\n\n.attachment-bg {\n  background: #fff; }\n\n.listview-content .fm-listview-item {\n  margin: 12px 0; }\n\n.listview-content .fm-tmpl-attachment-img {\n  width: 48px;\n  height: 48px;\n  margin: auto 0; }\n  .listview-content .fm-tmpl-attachment-img .item-img {\n    width: 100%;\n    height: 100%; }\n  .listview-content .fm-tmpl-attachment-img img {\n    border-radius: 3px;\n    width: 48px;\n    height: 48px; }\n\n.listview-content .attachment-text {\n  flex: 1;\n  margin: auto 12px; }\n  .listview-content .attachment-text > div {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 5px; }\n\n.listview-content .fm-tmpl-attachment-name {\n  line-height: 22px;\n  font-family: PingFangSC-Regular;\n  font-size: 16px;\n  color: #333333;\n  letter-spacing: 0.21px;\n  margin-bottom: 2px;\n  word-break: break-all; }\n\n.listview-content .fm-tmpl-attachment-footer {\n  line-height: 18px;\n  font-family: PingFangSC-Regular;\n  font-size: 12px;\n  color: #888888;\n  letter-spacing: 0; }\n\n.listview-content .fm-tmpl-listview-attachment {\n  padding: 0;\n  display: flex;\n  justify-content: space-between; }\n\n.listview-content .attachment-button .attachment-button-custom {\n  padding: 0;\n  width: 50px;\n  height: 20px;\n  font-family: PingFangSC-Regular;\n  font-size: 12px;\n  letter-spacing: 0;\n  border-radius: 10px; }\n\n.listview-content .attachment-icon {\n  margin: auto 0;\n  width: 16px;\n  height: 16px; }\n\n.panzoom {\n  transform: none;\n  backface-visibility: hidden;\n  transform-origin: 50% 50% 0px;\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap; }\n\n.page {\n  display: inline-block;\n  background-color: #ffffff;\n  margin: 20px;\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  transition: all 0.3s; }\n\n.farris-attachment-entry-vertical {\n  flex-direction: column; }\n\n.farris-attachment-entry {\n  display: flex;\n  clear: both; }\n  .farris-attachment-entry .fm-attachment-disabled {\n    cursor: not-allowed;\n    pointer-events: none; }\n  .farris-attachment-entry .attachment-navigation {\n    overflow: inherit;\n    white-space: nowrap; }\n  .farris-attachment-entry .attachment-navigation .attachment-navigation-item {\n    position: relative;\n    display: inline-block; }\n    .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-img {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0; }\n    .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-icon-delete {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 16px;\n      height: 16px;\n      background: #888; }\n      .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-icon-delete .fm-icon {\n        color: #fff;\n        font-size: 12px; }\n    .farris-attachment-entry .attachment-navigation .attachment-navigation-item .item-icon {\n      position: absolute; }\n  .farris-attachment-entry .fm-attachment-container {\n    box-sizing: border-box;\n    float: left;\n    position: relative;\n    margin: 0 100px 0 0;\n    padding: 0 52px 0 0;\n    max-width: 100%;\n    height: 54px; }\n    .farris-attachment-entry .fm-attachment-container .fm-attachment-files-list {\n      padding-top: 6px;\n      overflow: auto;\n      max-width: 100%; }\n    .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item {\n      position: relative;\n      width: 48px;\n      height: 48px;\n      margin-right: 20px; }\n      .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item .item-icon-delete {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: absolute;\n        right: -6px;\n        top: -6px;\n        width: 16px;\n        height: 16px;\n        background: #888;\n        border-radius: 50%; }\n        .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item .item-icon-delete .fm-icon {\n          color: #fff;\n          font-size: 12px; }\n      .farris-attachment-entry .fm-attachment-container .fm-attachment-files-item .van-image__img {\n        border-radius: 5px; }\n    .farris-attachment-entry .fm-attachment-container .fm-attachment-upload-btn-container {\n      position: absolute;\n      right: 0;\n      top: 50%;\n      margin-top: -20px;\n      z-index: 8;\n      width: 48px;\n      height: 48px;\n      background: #f6f6f6;\n      border-radius: 3px; }\n      .farris-attachment-entry .fm-attachment-container .fm-attachment-upload-btn-container .fm-attachment-upload-btn .fm-icon {\n        display: block;\n        font-size: 20px;\n        color: #ddd;\n        line-height: 48px;\n        margin: 0 auto; }\n  .farris-attachment-entry .fm-attachment-upload-listview-btn-container {\n    z-index: 8;\n    width: 48px;\n    height: 48px;\n    background: #f6f6f6;\n    border-radius: 3px; }\n    .farris-attachment-entry .fm-attachment-upload-listview-btn-container .fm-attachment-upload-btn .fm-icon {\n      display: block;\n      font-size: 20px;\n      color: #ddd;\n      line-height: 48px;\n      margin: 0 auto; }\n";
    styleInject(css_248z$1);

    script$1.render = render$1;
    script$1.__file = "src/components/attachment-file/src/attachment-file.vue";

    script$1.install = function (app) {
      app.component(script$1.name, script$1);
    };

    var _components$2;
    var script$2 = vue.defineComponent({
      name: "fm-attachment-entry",
      components: (_components$2 = {
        "van-image": Vant.Image
      }, _components$2[Vant.ImagePreview.Component.name] = Vant.ImagePreview.Component, _components$2),
      inject: {
        attachmentService: {
          default: null
        },
        uploadAttachmentService: {
          default: {}
        }
      },
      props: {
        rootId: {
          type: String,
          default: ""
        },
        // 传入文件列表
        fileList: {
          type: Array,
          default: function _default() {
            return [];
          }
        },
        // 多选
        multiple: {
          type: Boolean,
          default: true
        },
        // 文件类型
        accept: {
          type: String,
          // default: 'application/pdf,image/*,application/msword,text/html',
          default: "image/gif,image/jpg,image/jpeg,image/bmp,image/png"
        },
        // 禁用上传
        disabled: {
          type: Boolean,
          default: false
        },
        // 读取文件前事件
        beforeReadFile: {
          type: Function
        },
        // 上传事件
        uploadFile: {
          type: Function
        },
        // 文件预览事件
        previewFile: {
          type: Function
        },
        // 拍照前回调
        beforeTakePhoto: {
          type: Function
        },
        removable: {
          type: Boolean,
          default: false
        },
        direction: {
          // type: 'vertical' | 'horizontal',
          type: String,
          default: "horizontal"
        },
        title: {
          type: String,
          default: "附件"
        },
        externalVideoUrl: {
          type: String,
          default: ""
        }
      },
      data: function data() {
        return {
          fromProp: false,

          /**
           * 文件列表
           */
          rawFiles: [],

          /**
           * 展示附件上传界面开关
           */
          showAction: false,

          /**
           * 附件保存页面
           */
          saveAction: false,

          /**
           * 当前选中附件
           */
          selectedFile: null,

          /**
           * 选中文件预览路径
           */
          selectedFilePath: "",

          /**
           * 附件描述
           */
          description: "",

          /**
           * 未上传的文件列表
           */
          notUploadedFileList: [],

          /**
          预览页面
          */
          previewPages: [],
          pdfUrl: "",

          /**
          弹出层显示
          */
          show: false,
          showPdf: false,
          showVideo: false,
          docStyle: {}
        };
      },
      computed: {
        uploadFiles: function uploadFiles() {
          var _ref;

          this.rawFiles = (_ref = []).concat.apply(_ref, this.fileList.map(function (file) {
            return file;
          }));

          if (this.rawFiles && this.rawFiles.length) {
            this.selectedFile = this.rawFiles[0]; // 没有url属性的 没有上传
            // this.notUploadedFileList = this.rawFiles.filter((file) => !file.url);

            return this.rawFiles;
          }

          this.selectedFile = null;
          return [];
        },
        isEmpty: function isEmpty() {
          return this.rawFiles && !this.rawFiles.length;
        },
        previewEnable: function previewEnable() {
          return this.showAction && this.rawFiles && !!this.rawFiles.length;
        }
      },
      mounted: function mounted() {
        if (!this.allowDefaultEntrance) {
          this.showAction = true;
        }
      },
      methods: {
        getAttachmentPath: function getAttachmentPath(attachmentId) {
          return this.uploadAttachmentService.getAttachmentPath(attachmentId, this.rootId);
        },
        getAttachmentPathByType: function getAttachmentPathByType(attachment) {
          if (attachment.name.search(/\.(png|jpe?g|gif|svg)(\?.*)?$/) >= 0) {
            return this.getAttachmentPath(attachment.attachmentId);
          }

          return attachment.content || attachment.url;
        },

        /**
         * 添加文件
         */
        appendFile: function appendFile() {
          this.$refs.fileUploadRef.chooseFile(); // this.$emit('chooseFile');
        },
        toUpload: function toUpload() {
          this.$emit("upload");
        },

        /**
         * 读取文件之前
         */
        beforeRead: function beforeRead(file) {
          if (this.beforeReadFile) {
            // 读取文件前事件
            var beforeReadRes = this.beforeReadFile(file);
            return beforeReadRes;
          }

          return true;
        },

        /**
         * 加载文件后事件
         */
        afterRead: function afterRead(file) {
          this.showAction = true;

          if (file && file.length) {
            this.selectedFile = file[file.length - 1];
            this.notUploadedFileList = file;
          } else {
            this.selectedFile = file;
            this.notUploadedFileList = [file];
          } // emit 添加文件后事件


          this.$emit("afterAppendFile", file); // 添加文件后直接上传

          this.requestUpload();
        },

        /**
         * 删除选中文件
         */
        deleteFile: function deleteFile() {
          if (!this.rawFiles || !this.rawFiles.length) {
            return;
          }

          this.deleteAttachment(this.selectedFile);
        },
        mergeString: function mergeString(str, str1) {
          var min = str.length < str1.length ? str.length : str1.length;
          var res = "";
          var i = 0;

          for (i = 0; i < min; i++) {
            res += str.substring(i, i + 1);
            res += str1.substring(i, i + 1);
          }

          res += str.length < str1.length ? str1.substring(i) : str.substring(i);
          return res;
        },
        getToken: function getToken(str) {
          var array = [1, 2, 3];

          if (str.length > 24) {
            str = str.substring(0, 24);
          }

          var length = Math.floor(str.length / 3);
          var str1 = str.substring(0, length);
          var str2 = str.substring(length, 2 * length);
          var str3 = str.substring(2 * length, 3 * length);
          var randomArray = [];
          var random = Math.ceil(Math.random() * 3);
          randomArray.push(array[random - 1]);
          array.splice(random - 1, 1);
          random = Math.ceil(Math.random() * 2);
          randomArray.push(array[random - 1]);
          array.splice(random - 1, 1);
          randomArray.push(array[0]);
          var timeStamp = Math.round(new Date().getTime() / 1000) + "";
          return timeStamp.substring(0, 5) + "times" + randomArray[0] + "" + randomArray[1] + "" + randomArray[2] + this.switchStr(str1, str2, str3, randomArray[0]) + this.switchStr(str1, str2, str3, randomArray[1]) + this.switchStr(str1, str2, str3, randomArray[2]) + "times" + timeStamp.substring(5);
        },
        switchStr: function switchStr(str1, str2, str3, i) {
          switch (i) {
            case 1:
              return str1;

            case 2:
              return str2;

            case 3:
              return str3;
          }
        },

        /**
         * 选中文件
         */
        selectFile: function selectFile(item) {
          this.genPreview(item);
          this.selectedFile = item;
          this.$emit("selectCurrentItem");
        },

        /**
        删除附件
        */
        deleteAttachment: function deleteAttachment(item) {
          this.$emit("remove", [item.attachmentId]);
        },
        genPreview: function genPreview(selectedFile) {
          if (!selectedFile || !selectedFile.name) {
            return;
          } // 生成缩放的meta标签


          var originMeta = document.getElementsByName("viewport")[0];
          var meta = document.createElement("meta");
          meta.name = "viewport"; // meta.content =
          //   "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";

          meta.content = "width=device-width, initial-scale=1.0";
          var head = document.getElementsByTagName("head")[0];

          if (originMeta) {
            head.removeChild(originMeta);
          }

          head.appendChild(meta);

          if (selectedFile.name.toLowerCase().includes("mp4") || selectedFile.name.toLowerCase().includes("mov")) {
            if (this.externalVideoUrl) {
              selectedFile.url = this.externalVideoUrl + ("?metadataId=" + selectedFile.attachmentId + "&rootid=" + this.rootId + "&token=" + this.getToken(this.mergeString(selectedFile.attachmentId, this.rootId)));
            }

            this.show = true;
            this.showPdf = false;
            this.showVideo = true; // const videoUrl = selectedFile.content || selectedFile.url;
            // this.attachmentService.playShortVideo(
            //   videoUrl + "/" + selectedFile.name
            // );
          } else {
            // 图片文件直接预览
            this.show = true;
            this.showPdf = true;
            this.pdfUrl = "/platform/runtime/dfs/viewpage/index.html?metadataId=" + selectedFile.attachmentId + "&rootId=" + this.rootId + "&fileType=2";
          }

          this.$emit("preview", selectedFile);
        },
        getFitToWidth: function getFitToWidth(pageWidth, pageHeight) {
          var pageWidth1 = this.ptToPx(pageWidth);
          var pageHeight1 = this.ptToPx(pageHeight);
          var offsetWidth = pageWidth1 ? pageWidth1 : window.innerWidth;
          return pageHeight1 > pageWidth1 && Math.round(offsetWidth / window.innerWidth) <= 1 ? 200 - Math.round(offsetWidth * 100 / window.innerWidth) : Math.round(window.innerWidth * 100 / offsetWidth);
        },
        ptToPx: function ptToPx(pt) {
          return pt * 96 / 72;
        },
        isMobile: function isMobile(width) {
          return width <= 425;
        },
        isTablet: function isTablet(width) {
          return width <= 1024;
        },
        isDesktop: function isDesktop(width) {
          return !this.isMobile(width) && !this.isTablet(width);
        },
        closed: function closed() {
          // 生成缩放的meta标签
          var originMeta = document.getElementsByName("viewport")[0];
          var meta = document.createElement("meta");
          meta.name = "viewport"; // meta.content =
          //   "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";

          meta.content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";
          var head = document.getElementsByTagName("head")[0];

          if (originMeta) {
            head.removeChild(originMeta);
          }

          head.appendChild(meta);
          this.show = false;
        }
      }
    });

    var _withId$1 = /*#__PURE__*/vue.withScopeId("data-v-0d94d79a");

    vue.pushScopeId("data-v-0d94d79a");

    var _hoisted_1$2 = {
      key: 0,
      class: "fm-attachment-container attachment-navigation"
    };
    var _hoisted_2$2 = {
      class: "fm-attachment-files-list"
    };

    var _hoisted_3$2 = /*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-close"
    }, null, -1
    /* HOISTED */
    );

    var _hoisted_4$2 = /*#__PURE__*/vue.createVNode("div", {
      class: "fm-attachment-upload-btn"
    }, [/*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-addbutton"
    })], -1
    /* HOISTED */
    );

    var _hoisted_5$2 = {
      class: "fm-tmpl-listview-goods"
    };
    var _hoisted_6$2 = {
      class: "fm-tmpl-goods-name"
    };

    var _hoisted_7$1 = /*#__PURE__*/vue.createVNode("div", {
      class: "fm-attachment-upload-btn"
    }, [/*#__PURE__*/vue.createVNode("span", {
      class: "fm-icon fm-icon-addbutton"
    })], -1
    /* HOISTED */
    );

    var _hoisted_8$1 = {
      key: 1,
      autoplay: "",
      controls: "controls",
      style: {
        "width": "100%",
        "height": "100%"
      }
    };

    vue.popScopeId();

    var render$2 = /*#__PURE__*/_withId$1(function (_ctx, _cache, $props, $setup, $data, $options) {
      var _component_van_image = vue.resolveComponent("van-image");

      var _component_fm_listview = vue.resolveComponent("fm-listview");

      var _component_van_icon = vue.resolveComponent("van-icon");

      var _component_fm_navbar = vue.resolveComponent("fm-navbar");

      var _component_van_popup = vue.resolveComponent("van-popup");

      return vue.openBlock(), vue.createBlock("div", {
        class: ["farris-attachment-entry", {
          'farris-attachment-entry-vertical': _ctx.direction === 'vertical'
        }]
      }, [_ctx.direction === 'horizontal' ? (vue.openBlock(), vue.createBlock("div", _hoisted_1$2, [vue.createVNode("div", _hoisted_2$2, [(vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.uploadFiles, function (item, index) {
        return vue.openBlock(), vue.createBlock("div", {
          class: "fm-attachment-files-item attachment-navigation-item",
          key: index,
          onClick: function onClick($event) {
            return _ctx.selectFile(item);
          }
        }, [item && item.name && !item.name.includes('mp4') || !item.name ? (vue.openBlock(), vue.createBlock(_component_van_image, {
          key: 0,
          src: _ctx.getAttachmentPathByType(item),
          class: "item-img",
          width: "100%",
          height: "100%"
        }, null, 8
        /* PROPS */
        , ["src"])) : vue.createCommentVNode("v-if", true), item && item.name && item.name.toLowerCase().includes('mp4') || item.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock(_component_van_image, {
          key: 1,
          src: '/platform/runtime/dfs/images/file.png',
          class: "item-img",
          width: "48",
          height: "48"
        }, null, 8
        /* PROPS */
        , ["src"])) : vue.createCommentVNode("v-if", true), _ctx.uploadFiles && _ctx.uploadFiles.length && !_ctx.removable ? (vue.openBlock(), vue.createBlock("div", {
          key: 2,
          class: ["item-icon-delete", {
            'fm-attachment-disabled': _ctx.disabled
          }],
          onClick: vue.withModifiers(function ($event) {
            return _ctx.deleteAttachment(item);
          }, ["stop"])
        }, [_hoisted_3$2], 10
        /* CLASS, PROPS */
        , ["onClick"])) : vue.createCommentVNode("v-if", true)], 8
        /* PROPS */
        , ["onClick"]);
      }), 128
      /* KEYED_FRAGMENT */
      ))]), !_ctx.removable ? (vue.openBlock(), vue.createBlock("div", {
        key: 0,
        class: ["fm-attachment-upload-btn-container", {
          'fm-attachment-disabled': _ctx.disabled
        }],
        onClick: _cache[1] || (_cache[1] = function () {
          return _ctx.toUpload && _ctx.toUpload.apply(_ctx, arguments);
        })
      }, [_hoisted_4$2], 2
      /* CLASS */
      )) : vue.createCommentVNode("v-if", true)])) : vue.createCommentVNode("v-if", true), _ctx.direction === 'vertical' ? (vue.openBlock(), vue.createBlock(_component_fm_listview, {
        key: 1,
        listData: _ctx.uploadFiles,
        finished: true,
        showFinishedText: false
      }, {
        listViewHeader: _withId$1(function () {
          return [];
        }),
        default: _withId$1(function (props) {
          return [vue.createVNode("div", _hoisted_5$2, [vue.createVNode("div", {
            class: "fm-tmpl-goods-img",
            onClick: function onClick($event) {
              return _ctx.selectFile(props.item);
            }
          }, [props.item && props.item.name && !props.item.name.includes('mp4') || !props.item.name ? (vue.openBlock(), vue.createBlock(_component_van_image, {
            key: 0,
            src: props.item.content || props.item.url,
            class: "item-img"
          }, null, 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true), props.item && props.item.name && props.item.name.toLowerCase().includes('mp4') || props.item.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock(_component_van_image, {
            key: 1,
            src: '/platform/runtime/dfs/images/file.png',
            class: "item-img"
          }, null, 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true)], 8
          /* PROPS */
          , ["onClick"]), vue.createVNode("div", null, [vue.createVNode("div", _hoisted_6$2, [vue.createVNode("span", null, vue.toDisplayString(props.item.name), 1
          /* TEXT */
          ), vue.createCommentVNode(" <div class=\"fm-tmpl-goods-add\">\r\n\t\t\t\t\t\t\t\t可以添加下载\r\n\t\t\t\t\t\t\t\t<span class=\"fm-icon fm-icon-print\"></span>\r\n\t\t\t\t\t\t\t</div> ")]), vue.createCommentVNode(" <div class=\"fm-tmpl-goods-price\">\r\n\t\t\t\t\t\t\t<span class=\"fm-tmpl-goods-price-text\">已上传</span>\r\n\t\t\t\t\t\t</div> ")])])];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["listData"])) : vue.createCommentVNode("v-if", true), !_ctx.removable && _ctx.direction === 'vertical' ? (vue.openBlock(), vue.createBlock("div", {
        key: 2,
        class: ["fm-attachment-upload-listview-btn-container", {
          'fm-attachment-disabled': _ctx.disabled
        }],
        onClick: _cache[2] || (_cache[2] = function () {
          return _ctx.toUpload && _ctx.toUpload.apply(_ctx, arguments);
        })
      }, [_hoisted_7$1], 2
      /* CLASS */
      )) : vue.createCommentVNode("v-if", true), vue.createVNode(_component_van_popup, {
        show: _ctx.show,
        "onUpdate:show": _cache[3] || (_cache[3] = function ($event) {
          return _ctx.show = $event;
        }),
        closeable: "",
        onClosed: _ctx.closed,
        style: {
          height: '100%',
          width: '100%'
        }
      }, {
        default: _withId$1(function () {
          return [vue.createVNode(_component_fm_navbar, {
            title: _ctx.selectedFile && _ctx.selectedFile.name,
            onClickLeft: _ctx.closed
          }, {
            left: _withId$1(function () {
              return [vue.createVNode(_component_van_icon, {
                name: "arrow-left",
                size: "18",
                color: "#333"
              })];
            }),
            _: 1
            /* STABLE */

          }, 8
          /* PROPS */
          , ["title", "onClickLeft"]), _ctx.showPdf ? (vue.openBlock(), vue.createBlock("iframe", {
            key: 0,
            class: "pdf-iframe",
            scrolling: "yes",
            src: _ctx.pdfUrl,
            width: "100%",
            height: "100%"
          }, "\r\n      ", 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true), _ctx.showVideo && _ctx.selectedFile && _ctx.selectedFile.name && _ctx.selectedFile.name.toLowerCase().includes('mov') ? (vue.openBlock(), vue.createBlock("video", _hoisted_8$1, [vue.createVNode("source", {
            src: _ctx.selectedFile.url,
            type: "video/mp4"
          }, null, 8
          /* PROPS */
          , ["src"])])) : vue.createCommentVNode("v-if", true), _ctx.showVideo && _ctx.selectedFile && _ctx.selectedFile.name && _ctx.selectedFile.name.toLowerCase().includes('mp4') || _ctx.selectedFile.name.toLowerCase().includes('webm') || _ctx.selectedFile.name.toLowerCase().includes('ogg') ? (vue.openBlock(), vue.createBlock("video", {
            key: 2,
            autoplay: "",
            src: _ctx.selectedFile.url,
            controls: "controls",
            style: {
              "width": "100%",
              "height": "100%"
            }
          }, " 您的浏览器不支持 video 标签。 ", 8
          /* PROPS */
          , ["src"])) : vue.createCommentVNode("v-if", true)];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["show", "onClosed"])], 2
      /* CLASS */
      );
    });

    var css_248z$2 = ".fm-tmpl-listview-goods[data-v-0d94d79a] {\n  margin-bottom: 0.5rem;\n  padding: 0; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] img {\n    height: 48px;\n    width: 48px;\n    border-radius: 5px; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-price .fm-tmpl-goods-price-text {\n    font-size: 12px;\n    color: #666; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-name {\n    line-height: 1;\n    margin: 0;\n    min-height: 0;\n    font-size: 14px;\n    color: #000;\n    padding: 0;\n    overflow-wrap: break-word; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-img {\n    width: 48px;\n    height: 48px; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-content {\n    padding: 0; }\n  .fm-tmpl-listview-goods[data-v-0d94d79a] .fm-tmpl-goods-content::after {\n    content: \"\"; }\n\n.panzoom[data-v-0d94d79a] {\n  transform: none;\n  backface-visibility: hidden;\n  transform-origin: 50% 50% 0px;\n  display: flex;\n  justify-content: center;\n  flex-wrap: wrap; }\n\n.page[data-v-0d94d79a] {\n  display: inline-block;\n  background-color: #ffffff;\n  margin: 20px;\n  -webkit-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  -moz-box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  box-shadow: 0px 4px 12px -4px rgba(0, 0, 0, 0.38);\n  transition: all 0.3s; }\n\n.farris-attachment-entry-vertical[data-v-0d94d79a] {\n  flex-direction: column; }\n\n.farris-attachment-entry[data-v-0d94d79a] {\n  display: flex;\n  clear: both; }\n  .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-disabled {\n    cursor: not-allowed;\n    pointer-events: none; }\n  .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation {\n    overflow: inherit;\n    white-space: nowrap; }\n  .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item {\n    position: relative;\n    display: inline-block; }\n    .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-img {\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0; }\n    .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-icon-delete {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      right: 0;\n      top: 0;\n      width: 16px;\n      height: 16px;\n      background: #888; }\n      .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-icon-delete .fm-icon {\n        color: #fff;\n        font-size: 12px; }\n    .farris-attachment-entry[data-v-0d94d79a] .attachment-navigation .attachment-navigation-item .item-icon {\n      position: absolute; }\n  .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container {\n    box-sizing: border-box;\n    float: left;\n    position: relative;\n    margin: 0 100px 0 0;\n    padding: 0 52px 0 0;\n    max-width: 100%;\n    height: 54px; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-list {\n      padding-top: 6px;\n      overflow: auto;\n      max-width: 100%; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item {\n      position: relative;\n      width: 48px;\n      height: 48px;\n      margin-right: 20px; }\n      .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item .item-icon-delete {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        position: absolute;\n        right: -6px;\n        top: -6px;\n        width: 16px;\n        height: 16px;\n        background: #888;\n        border-radius: 50%; }\n        .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item .item-icon-delete .fm-icon {\n          color: #fff;\n          font-size: 12px; }\n      .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-files-item .van-image__img {\n        border-radius: 5px; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-upload-btn-container {\n      position: absolute;\n      right: 0;\n      top: 50%;\n      margin-top: -20px;\n      z-index: 8;\n      width: 48px;\n      height: 48px;\n      background: #f6f6f6;\n      border-radius: 3px; }\n      .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-container .fm-attachment-upload-btn-container .fm-attachment-upload-btn .fm-icon {\n        display: block;\n        font-size: 20px;\n        color: #ddd;\n        line-height: 48px;\n        margin: 0 auto; }\n  .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-upload-listview-btn-container {\n    z-index: 8;\n    width: 48px;\n    height: 48px;\n    background: #f6f6f6;\n    border-radius: 3px; }\n    .farris-attachment-entry[data-v-0d94d79a] .fm-attachment-upload-listview-btn-container .fm-attachment-upload-btn .fm-icon {\n      display: block;\n      font-size: 20px;\n      color: #ddd;\n      line-height: 48px;\n      margin: 0 auto; }\n";
    styleInject(css_248z$2);

    script$2.render = render$2;
    script$2.__scopeId = "data-v-0d94d79a";
    script$2.__file = "src/components/attachment-entry/src/attachment-entry.vue";

    script$2.install = function (app) {
      app.component(script$2.name, script$2);
    };

    var script$3 = vue.defineComponent({
      name: 'fm-verify-code',
      props: {
        second: {
          type: Number,
          default: 60
        }
      },
      data: function data() {
        return {
          time: 0,
          disabled: false
        };
      },
      methods: {
        run: function run() {
          if (this.disabled || this.time > 0) return;
          this.$emit('run');
          this.start();
        },
        start: function start() {
          this.time = this.second;
          this.timer();
        },
        stop: function stop() {
          this.time = 0;
          this.disabled = false;
        },
        setDisabled: function setDisabled(val) {
          this.disabled = val;
        },
        timer: function timer() {
          if (this.time > 0) {
            this.time--;
            setTimeout(this.timer, 1000);
          } else {
            this.disabled = false;
          }
        }
      },
      computed: {
        text: function text() {
          return this.time > 0 ? this.time + 's' : '获取验证码';
        }
      }
    });

    var _withId$2 = /*#__PURE__*/vue.withScopeId("data-v-607c2323");

    vue.pushScopeId("data-v-607c2323");

    var _hoisted_1$3 = {
      class: "text"
    };

    vue.popScopeId();

    var render$3 = /*#__PURE__*/_withId$2(function (_ctx, _cache, $props, $setup, $data, $options) {
      return vue.openBlock(), vue.createBlock("div", {
        class: ["fm-verify-code", {
          'fm-verify-code-disabled': _ctx.disabled || _ctx.time > 0
        }],
        onClick: _cache[1] || (_cache[1] = function ($event) {
          return _ctx.run();
        })
      }, [vue.createVNode("span", _hoisted_1$3, vue.toDisplayString(_ctx.text), 1
      /* TEXT */
      )], 2
      /* CLASS */
      );
    });

    var css_248z$3 = ".fm-verify-code[data-v-607c2323] .text {\n  font-size: 15px;\n  color: #31A4FB; }\n\n.fm-verify-code[data-v-607c2323]-disabled .text {\n  color: #999; }\n";
    styleInject(css_248z$3);

    script$3.render = render$3;
    script$3.__scopeId = "data-v-607c2323";
    script$3.__file = "src/business/verify-code/src/index.vue";

    script$3.install = function (app) {
      app.component(script$3.name, script$3);
    };

    var AttachmentUtil = /*#__PURE__*/function () {
      function AttachmentUtil() {}

      AttachmentUtil.getCurrentData = function getCurrentData(attachmentId, listData, bindingField) {
        return listData.find(function (dataItem) {
          var dataItemAttachmentId = dataItem[bindingField].attachmentId;
          return dataItemAttachmentId === attachmentId;
        });
      }
      /**
       * 修改某条
       * @param {Object} dataItem
       * @param {String[]} fields
       * @param {Array} fieldsValue
       */
      ;

      AttachmentUtil.modifyData = function modifyData(dataItem, fields, fieldsValue) {
        fields.forEach(function (field) {
          var fieldArr = field.split('_');

          if (fieldArr.length > 1) {
            var newField = fieldArr[1].substring(0, 1).toLowerCase() + fieldArr[1].substring(1);
            dataItem[fieldArr[0]][newField] = fieldsValue[field];
          } else {
            dataItem[field] = fieldsValue[field];
          }
        });
      };

      AttachmentUtil.getContextData = function getContextData(context) {
        return context.data;
      }
      /**
       * 赋值
       * @param {Object} context
       * @param {Array} data
       */
      ;

      AttachmentUtil.setContextData = function setContextData(context, data) {
        context.data = data;
      }
      /**
       * 追加数据
       * @param {Object} context
       * @param {Array} data
       */
      ;

      AttachmentUtil.appendToContextData = function appendToContextData(context, data) {
        context.data = [].concat(context.data, data);
      }
      /**
       * 更新旧值
       * @param {Object} context 抛出对象上下文
       * @param {Array} data 新数据
       */
      ;

      AttachmentUtil.updateContextData = function updateContextData(context, data) {
        context.oldData = data;
      }
      /**
       * 追加到旧值
       * @param {Object} context 抛出对象上下文
       * @param {Array} data 追加的数据
       */
      ;

      AttachmentUtil.appendToContextOldData = function appendToContextOldData(context, data) {
        context.oldData = [].concat(context.oldData, data);
      }
      /**
       * 删除数据
       * @param {Object} context 对象上下文
       * @param {String} id 数据id
       */
      ;

      AttachmentUtil.removeContextDataById = function removeContextDataById(context, id) {
        var index = context.data.findIndex(function (dataItem) {
          return dataItem.id === id;
        });
        context.data.splice(index, 1);
      };

      return AttachmentUtil;
    }();

    function _extends() {
      _extends = Object.assign || function (target) {
        for (var i = 1; i < arguments.length; i++) {
          var source = arguments[i];

          for (var key in source) {
            if (Object.prototype.hasOwnProperty.call(source, key)) {
              target[key] = source[key];
            }
          }
        }

        return target;
      };

      return _extends.apply(this, arguments);
    }

    // http://a.amap.com/jsapi_demos/static/remogeo/remogeo.js
    var RemoGeoLocation = /*#__PURE__*/function () {
      function RemoGeoLocation() {
        this._remoteSvrUrl = 'https://webapi.amap.com/html/geolocate.html';
        this._callbackList = [];
        this._seqBase = 1;
        this._frameReady = 0;
        this._watchIdMap = {};
      }

      var _proto = RemoGeoLocation.prototype;

      _proto._getSeq = function _getSeq() {
        return this._seqBase++;
      };

      _proto._onRrameReady = function _onRrameReady(callback) {
        if (this._frameReady === 0) {
          if (!this._frameReadyList) {
            this._frameReadyList = [];
          }

          this._frameReadyList.push(callback);

          this._prepareIframe();

          return;
        }

        callback.call(this);
      };

      _proto._prepareIframe = function _prepareIframe() {
        var _this = this;

        if (this._iframeWin) {
          return;
        } // 创建地图画布


        var ifrm = document.createElement('iframe');
        ifrm.src = this._remoteSvrUrl + (this._remoteSvrUrl.indexOf('?') > 0 ? '&' : '?');
        ifrm.width = '0px';
        ifrm.height = '0px';
        ifrm.style.position = 'absolute';
        ifrm.style.display = 'none';
        ifrm.allow = 'geolocation'; // var self = this;

        var timeoutId = setTimeout(function () {
          _this._frameReady = false;

          _this._callbackFrameReadyList();
        }, 5000);

        ifrm.onload = function () {
          clearTimeout(timeoutId);
          _this._frameReady = true;

          _this._callbackFrameReadyList();

          ifrm.onload = null;
        };

        document.body.appendChild(ifrm);
        this._iframeWin = ifrm.contentWindow;
        window.addEventListener('message', function (e) {
          if (_this._remoteSvrUrl.indexOf(e['origin']) !== 0) {
            return;
          }

          _this._handleRemoteMsg(e['data']);
        }, false);
      };

      _proto._callbackFrameReadyList = function _callbackFrameReadyList() {
        if (this._frameReadyList) {
          var list = this._frameReadyList;
          this._frameReadyList = null;

          for (var i = 0, len = list.length; i < len; i++) {
            list[i].call(this, this._frameReady);
          }
        }
      };

      _proto._pickCallback = function _pickCallback(seqNum, keepInList) {
        var callbackList = this._callbackList;

        for (var i = 0, len = callbackList.length; i < len; i++) {
          var cbkInfo = callbackList[i];

          if (seqNum === cbkInfo['seq']) {
            if (!keepInList) {
              callbackList.splice(i, 1);
            }

            return cbkInfo;
          }
        }
      };

      _proto._handleRemoteMsg = function _handleRemoteMsg(msg) {
        var seqNum = msg['seq'];

        var cbkInfo = this._pickCallback(seqNum, !!msg['notify']);

        if (cbkInfo) {
          cbkInfo['cbk'].call(null, msg['error'], msg['result']);
        } else {
          console.warn('Receive remote msg: ', msg);
        }
      };

      _proto._postMessage = function _postMessage(cmd, args, callback, seq) {
        var _this2 = this;

        this._prepareIframe();

        var msg = {
          'cmd': cmd,
          'args': args,
          'seq': seq || this._getSeq()
        };

        this._callbackList.push({
          'cbk': callback,
          'seq': msg['seq']
        });

        this._onRrameReady(function () {
          if (_this2._frameReady === true) {
            try {
              _this2._iframeWin.postMessage(msg, '*');
            } catch (e) {
              _this2._pickCallback(msg['seq']);

              callback(e);
            }
          } else {
            _this2._pickCallback(msg['seq']);

            callback({
              'message': 'iFrame load failed!'
            });
          }
        });
      };

      _proto.getCurrentPosition = function getCurrentPosition(succHandler, errHandler, options) {
        this._postMessage('getCurrentPosition', [options], function (err, result) {
          if (err) {
            if (errHandler) {
              errHandler(err);
            }

            return;
          }

          if (succHandler) {
            succHandler(result);
          }
        });
      };

      _proto.watchPosition = function watchPosition(succHandler, errHandler, options) {
        var _this3 = this;

        var watchKey = 'wk' + this._getSeq();

        var cmdSeq = this._getSeq();

        this._watchIdMap[watchKey] = {
          stat: 0,
          seq: cmdSeq
        };
        var self = this;

        this._postMessage('watchPosition', [options], function (err, result) {
          var id = null;

          if (result) {
            id = result['id'];
          }

          var watchInfo = _this3._watchIdMap[watchKey];
          watchInfo.id = id;
          watchInfo.stat = 1;

          if (watchInfo.callbackList) {
            var list = watchInfo.callbackList;
            watchInfo.callbackList = null;

            for (var i = 0, len = list.length; i < len; i++) {
              list[i].call(self, id);
            }
          }

          if (err) {
            if (errHandler) {
              errHandler(err);
            }

            return;
          }

          if (succHandler) {
            succHandler(result['pos']);
          }
        }, cmdSeq);

        return watchKey;
      };

      _proto.clearWatch = function clearWatch(watchKey, callback) {
        if (!this._watchIdMap[watchKey]) {
          callback('Id not exists: ' + watchKey);
          return;
        }

        var watchInfo = this._watchIdMap[watchKey];
        var self = this;

        var clearId = function clearId(id) {
          self._postMessage('clearWatch', [id], function (err, result) {
            if (!err) {
              self._pickCallback(watchInfo.seq);

              delete self._watchIdMap[watchKey];
            }

            if (callback) {
              callback(err, result);
            }
          });
        };

        if (watchInfo.stat < 1) {
          if (!watchInfo.callbackList) {
            watchInfo.callbackList = [];
          }

          watchInfo.callbackList.push(function (id) {
            clearId(id);
          });
        } else {
          clearId(watchInfo.id);
        }
      };

      return RemoGeoLocation;
    }();

    var DEFAULT_AMP_CONFIG = {
      key: null,
      v: '1.4.4',
      protocol: 'https',
      hostAndPath: 'webapi.amap.com/maps',
      plugin: [],
      callback: 'amapInitComponent'
    };
    function patchIOS11Geo() {
      // ios环境切换到使用远程https定位
      if ((window.AMap.UA.ios || window.AMap.UA.android) && document.location.protocol !== 'https:') {
        // 使用远程定位，见 remogeo.js
        var remoGeo = new RemoGeoLocation(); // 替换方法

        navigator.geolocation.getCurrentPosition = function () {
          return remoGeo.getCurrentPosition.apply(remoGeo, arguments);
        }; // 替换方法


        navigator.geolocation.watchPosition = function () {
          return remoGeo.watchPosition.apply(remoGeo, arguments);
        };
      }
    }

    var AMapAPILoader = /*#__PURE__*/function () {
      /**
       * @param config required 初始化参数
       */
      function AMapAPILoader(config) {
        this._config = _extends({}, DEFAULT_AMP_CONFIG, config);
        this._document = document;
        this._window = window;
        this._scriptLoaded = false;
        this._queueEvents = [patchIOS11Geo];
      }

      var _proto = AMapAPILoader.prototype;

      _proto.load = function load() {
        var _this = this;

        if (this._window.AMap && this._window.AMap.Map) {
          return this.loadUIAMap();
        }

        if (this._scriptLoadingPromise) return this._scriptLoadingPromise;

        var script = this._document.createElement('script');

        script.type = 'text/javascript';
        script.async = true;
        script.defer = true;
        script.src = this._getScriptSrc();
        var UIPromise = this._config.uiVersion ? this.loadUIAMap() : null;
        this._scriptLoadingPromise = new Promise(function (resolve, reject) {
          _this._window['amapInitComponent'] = function () {
            while (_this._queueEvents.length) {
              _this._queueEvents.pop().apply();
            }

            if (UIPromise) {
              UIPromise.then(function () {
                window['initAMapUI']();
                setTimeout(resolve);
              });
            } else {
              return resolve();
            }
          };

          script.onerror = function (error) {
            return reject(error);
          };
        });

        this._document.head.appendChild(script);

        return this._scriptLoadingPromise;
      };

      _proto.loadUIAMap = function loadUIAMap() {
        var _this2 = this;

        if (!this._config.uiVersion || window.AMapUI) return Promise.resolve();
        return new Promise(function (resolve, reject) {
          var UIScript = document.createElement('script');

          var _this2$_config$uiVers = _this2._config.uiVersion.split('.'),
              versionMain = _this2$_config$uiVers[0],
              versionSub = _this2$_config$uiVers[1],
              versionDetail = _this2$_config$uiVers[2];

          if (versionMain === undefined || versionSub === undefined) {
            console.error('amap ui version is not correct, please check! version: ', _this2._config.uiVersion);
            return;
          }

          var src = _this2._config.protocol + "://webapi.amap.com/ui/" + versionMain + "." + versionSub + "/main-async.js";
          if (versionDetail) src += "?v=" + versionMain + "." + versionSub + "." + versionDetail;
          UIScript.src = src;
          UIScript.type = 'text/javascript';
          UIScript.async = true;

          _this2._document.head.appendChild(UIScript);

          UIScript.onload = function () {
            setTimeout(resolve, 0);
          };

          UIScript.onerror = function () {
            return reject();
          };
        });
      };

      _proto._getScriptSrc = function _getScriptSrc() {
        // amap plugin prefix reg
        var amap_prefix_reg = /^AMap./;
        var config = this._config;
        var paramKeys = ['v', 'key', 'plugin', 'callback']; // check 'AMap.' prefix

        if (config.plugin && config.plugin.length > 0) {
          // push default types
          config.plugin.push('Autocomplete', 'PlaceSearch', 'PolyEditor', 'CircleEditor');
          var plugins = []; // fixed plugin name compatibility.

          config.plugin.forEach(function (item) {
            var prefixName = amap_prefix_reg.test(item) ? item : 'AMap.' + item;
            var pureName = prefixName.replace(amap_prefix_reg, '');
            plugins.push(prefixName, pureName);
          });
          config.plugin = plugins;
        }

        var params = Object.keys(config).filter(function (k) {
          return ~paramKeys.indexOf(k);
        }).filter(function (k) {
          return config[k] != null;
        }).filter(function (k) {
          return !Array.isArray(config[k]) || Array.isArray(config[k]) && config[k].length > 0;
        }).map(function (k) {
          var v = config[k];
          if (Array.isArray(v)) return {
            key: k,
            value: v.join(',')
          };
          return {
            key: k,
            value: v
          };
        }).map(function (entry) {
          return entry.key + "=" + entry.value;
        }).join('&');
        return this._config.protocol + "://" + this._config.hostAndPath + "?" + params;
      };

      return AMapAPILoader;
    }();

    var lazyAMapApiLoaderInstance = null;
    var initAMapApiLoader = function initAMapApiLoader(config) {
      // if (createApp({}).config.globalProperties.$isServer) return;
      // if (lazyAMapApiLoaderInstance) throw new Error('You has already initial your lazyAMapApiLoaderInstance, just import it');
      if (lazyAMapApiLoaderInstance) return;
      if (!lazyAMapApiLoaderInstance) lazyAMapApiLoaderInstance = new AMapAPILoader(config);
      lazyAMapApiLoaderInstance.load();
    };

    var MapPlugin = /*#__PURE__*/function () {
      function MapPlugin() {}

      var _proto = MapPlugin.prototype;

      _proto.addPlugins = function addPlugins(map, plugins) {
        var AMap = window['AMap'];

        var _notInjectPlugins = plugins.filter(function (_plugin) {
          return !AMap[_plugin.sName];
        });

        if (!_notInjectPlugins || !_notInjectPlugins.length) return this.addMapControls(map, plugins);
        return map.plugin(_notInjectPlugins, this.addMapControls);
      } // 添加插件
      ;

      _proto.addMapControls = function addMapControls(map, plugins) {
        var _this = this;

        if (!plugins || !plugins.length) return; //  store plugin instances

        var $plugins = {};
        var AMap = window['AMap'];
        plugins.forEach(function (_plugin) {
          var realPluginOptions = _this.convertAMapPluginProps(_plugin);

          var pluginInstance = $plugins[realPluginOptions.pName] = new AMap[realPluginOptions.sName](realPluginOptions); // add plugin into map

          map.addControl(pluginInstance); // register plugin event

          if (_plugin.events) {
            for (var k in _plugin.events) {
              var v = _plugin.events[k];
              if (k === 'init') v(pluginInstance);else AMap.event.addListener(pluginInstance, k, v);
            }
          }
        });
      };

      _proto.convertAMapPluginProps = function convertAMapPluginProps(plugin) {
        if (typeof plugin === 'object' && plugin.pName) {
          switch (plugin.pName) {
            case 'AMap.ToolBar':
              {
                // parse offset
                if (plugin.offset && plugin.offset instanceof Array) {
                  plugin.offset = this.toPixel(plugin.offset);
                }

                break;
              }

            case 'AMap.Scale':
              {
                // parse offset
                if (plugin.offset && plugin.offset instanceof Array) {
                  plugin.offset = this.toPixel(plugin.offset);
                }

                break;
              }
          }

          return plugin;
        } else {
          return '';
        }
      };

      _proto.toPixel = function toPixel(arr) {
        return new window.AMap.Pixel(arr[0], arr[1]);
      };

      return MapPlugin;
    }();

    function guid() {
      var s = [];
      var hexDigits = '0123456789abcdef';

      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }

      s[14] = '4'; // bits 12-15 of the time_hi_and_version field to 0010

      s[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01

      s[8] = s[13] = s[18] = s[23] = '-';
      var uuid = s.join('');
      return uuid;
    }

    var upperCamelCase = function upperCamelCase() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      // 转换成大驼峰
      var cased = camelCase.apply(camelCase, args);
      return cased.charAt(0).toUpperCase() + cased.slice(1);
    };

    var camelCase = function camelCase() {
      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        args[_key2] = arguments[_key2];
      }

      var str = [].map.call(args, function (str) {
        return str.trim();
      }).filter(function (str) {
        return str.length;
      }).join('-');

      if (!str.length) {
        return '';
      }

      if (str.length === 1 || !/[_.\- ]+/.test(str)) {
        if (str[0] === str[0].toLowerCase() && str.slice(1) !== str.slice(1).toLowerCase()) {
          return str;
        }

        return str.toLowerCase();
      }

      return str.replace(/^[_.\- ]+/, '').toLowerCase().replace(/[_.\- ]+(\w|$)/g, function (m, p1) {
        return p1.toUpperCase();
      });
    };

    var AMapManager = /*#__PURE__*/function () {
      function AMapManager() {
        this._componentMap = new Map();
        this._map = null;
      }

      var _proto = AMapManager.prototype;

      _proto.setMap = function setMap(map) {
        this._map = map;
      };

      _proto.getMap = function getMap() {
        return this._map;
      };

      _proto.setComponent = function setComponent(id, component) {
        this._componentMap.set(id, component);
      };

      _proto.getComponent = function getComponent(id) {
        return this._componentMap.get(id);
      };

      _proto.getChildInstance = function getChildInstance(id) {
        return this.getComponent(id);
      };

      _proto.removeComponent = function removeComponent(id) {
        this._componentMap.delete(id);
      };

      return AMapManager;
    }();

    var script$4 = vue.defineComponent({
      // 组件名称
      name: "fm-business-attachment",
      props: {
        // 输入属性
        extendFields: {
          type: Array,
          default: function _default() {
            return [{}];
          }
        },
        // 是否显示头部导航
        showNavBar: {
          type: Boolean,
          default: true
        },
        // 附件目录信息
        parentDirName: {
          type: String,
          default: ""
        },
        // rootId
        rootId: {
          type: String,
          default: "default-root"
        },
        // 主表或子表路径
        path: {
          type: String,
          default: ""
        },
        // 获取服务端数据
        // getRawData: {
        // 	type: Function
        // },
        title: {
          type: String,
          default: "导航栏"
        },
        // 是否展示附件信息
        displayAttachmentInfo: {
          type: Boolean,
          default: false
        },
        removable: {
          type: Boolean,
          default: false
        },
        displayAttachmentId: {
          type: Boolean,
          default: true
        },
        displayAttachmentName: {
          type: Boolean,
          default: true
        },
        externalVideoUrl: {
          type: String,
          default: ""
        }
      },
      setup: function setup(props, _ref) {
        var emit = _ref.emit;
        var state = vue.reactive({
          show: false,
          fieldsValue: {// name: ''
          },
          attachmentExtendFields: [],
          selectedAttachmentId: "",
          context: {
            // 原值
            data: [],
            // 旧值  用于扩展字段变更
            oldData: [],
            // 获取数据
            getData: null,
            // 更新旧值
            updateData: null,
            // 删除数据
            removeDataById: null,
            // 设置数据
            setData: null,
            // 追加数据
            appendData: null,
            removed: false
          },
          currentData: null,
          fields: vue.computed(function () {
            return props.extendFields || [{}];
          }),
          rawData: vue.computed(function () {
            if (!state.currentData && state.context.data.length) {
              state.currentData = state.context.data[0]; // 选择该数据

              vue.nextTick(function () {
                Object.keys(state.fieldsValue).forEach(function (key) {
                  state.fieldsValue[key] = getDataValue(state.currentData, key);
                });
              });
            }

            if (state.selectedAttachmentId) {
              var selectedData = state.context.data.find(function (dataItem) {
                return dataItem[props.path.substring(1)].attachmentId === state.selectedAttachmentId;
              });

              if (selectedData) {
                state.currentData = selectedData; // 选择该数据

                vue.nextTick(function () {
                  Object.keys(state.fieldsValue).forEach(function (key) {
                    state.fieldsValue[key] = getDataValue(state.currentData, key);
                  });
                });
              } else {
                if (state.context.data.length) {
                  vue.nextTick(function () {
                    Object.keys(state.fieldsValue).forEach(function (key) {
                      state.fieldsValue[key] = getDataValue(state.context.data[state.context.data.length - 1], key);
                    });
                  });
                } else {
                  vue.nextTick(function () {
                    Object.keys(state.fieldsValue).forEach(function (key) {
                      state.fieldsValue[key] = getDataValue(state.context.data[state.context.data.length - 1], key);
                    });
                  });
                }
              }
            } // 删除标记


            return state.context.data;
          }),
          filterData: vue.computed(function () {
            return mobileVueAdapter.filterData(state.rawData, props.path, props.rootId);
          })
        });
        vue.onMounted(function () {
          // 初始化上下文
          initContext(); // 初始化获取附件信息
          // if (props.getRawData) {
          // props.getRawData(state.context);
          // 获取服务端数据

          emit("getRawData", state.context);

          if (!state.currentData && state.context.data && state.context.data.length) {
            state.currentData = state.context.data[0];
          } // }

        });
        /**
         * 上传附件
         */

        var uploadAttachment = function uploadAttachment(e) {
          state.selectedAttachmentId = e[0].metadataId;
          emit("upload", {
            context: state.context,
            rootId: state.rootId,
            parentDirName: state.parentDirName,
            data: e
          });
        };
        /**
         * 删除附件
         */


        var removeAttachment = function removeAttachment(e) {
          state.removed = true;
          emit("remove", {
            context: state.context,
            rootId: state.rootId,
            parentDirName: state.parentDirName,
            data: e
          });
        };
        /**
         * 选择附件
         */


        var selectChange = function selectChange(e) {
          var attachmentId = e.attachmentId;
          state.selectedAttachmentId = attachmentId; // 获取当前数据

          var bindingField = props.path.split("/")[1];
          state.currentData = AttachmentUtil.getCurrentData(attachmentId, state.context.data, bindingField);
          Object.keys(state.fieldsValue).forEach(function (key) {
            state.fieldsValue[key] = getDataValue(state.currentData, key);
          });
          emit("selectChange", {
            context: state.context,
            rootId: state.rootId,
            parentDirName: state.parentDirName,
            data: e,
            currentData: state.currentData
          });
        };
        /**
         * 回退事件
         */


        var goBack = function goBack() {
          state.show = false;
          state.selectedAttachmentId = ""; // 赋值当前数据

          if (state.currentData) {
            var bindingFields = props.extendFields.map(function (extendField) {
              return extendField.bindingField;
            }).filter(function (ele) {
              return ele;
            });
            AttachmentUtil.modifyData(state.currentData, bindingFields, state.fieldsValue);
          } // 回退抛出事件


          emit("goBack", {
            listData: state.context.data,
            oldListData: state.context.oldData,
            context: state.context
          });
        };
        /**
         * 失去焦点事件
         */


        var blur = function blur(field) {
          var bindingField = field.bindingField; // 赋值

          if (state.currentData) {
            AttachmentUtil.modifyData(state.currentData, [bindingField], state.fieldsValue);
          } // 抛出失去焦点事件


          emit("blur", {
            field: field,
            context: state.context
          });
        };

        var toAttachmentDetailPage = function toAttachmentDetailPage() {
          state.show = true; // 由于附件组件重新加载都会定位第一个附件  所以要重新赋值为第一个附件的数据

          state.currentData = state.context.data[0]; // 组建扩展字段数组

          var attachmentInfoFields = [{
            id: guid(),
            bindingField: props.path.substring(1) + "_AttachmentId",
            editorType: "TextBox",
            position: "right",
            readonly: true,
            label: "附件id",
            visible: props.displayAttachmentId
          }, {
            id: guid(),
            bindingField: props.path.substring(1) + "_FileName",
            editorType: "TextBox",
            position: "right",
            readonly: true,
            label: "附件名称",
            visible: props.displayAttachmentName
          } // {
          // 	id: guid(),
          // 	bindingField: `${props.path.substring(1)}_FileSize`,
          // 	editorType: 'TextBox',
          // 	position: 'right',
          // 	readonly: true,
          // 	label: '附件大小'
          // },
          // {
          // 	id: guid(),
          // 	bindingField: `${props.path.substring(1)}_FileCreateTime`,
          // 	editorType: 'TextBox',
          // 	position: 'right',
          // 	readonly: true,
          // 	label: '附件上传时间'
          // }
          ];

          if (props.displayAttachmentInfo) {
            state.attachmentExtendFields = [].concat(attachmentInfoFields);
          }

          var extendFields = [].concat(state.attachmentExtendFields, props.extendFields); // 创建字段绑定值变量
          // if (props.extendFields.length && state.currentData) {

          extendFields.forEach(function (ele) {
            // if (!state.fieldsValue[ele.bindingField]) {
            state.fieldsValue[ele.bindingField] = state.currentData && getDataValue(state.currentData, ele.bindingField); // }
          }); // }
        };
        /**
         * 初始化上下文
         */


        var initContext = function initContext() {
          // 获取数据
          state.context.getData = AttachmentUtil.getContextData.bind(null, state.context); // 更新旧值

          state.context.updateData = AttachmentUtil.updateContextData.bind(null, state.context); // 删除数据

          state.context.removeDataById = AttachmentUtil.removeContextDataById.bind(null, state.context); // 设置数据

          state.context.setData = AttachmentUtil.setContextData.bind(null, state.context); // 追加数据

          state.context.appendData = AttachmentUtil.appendToContextData.bind(null, state.context);
        };

        var getDataValue = function getDataValue(data, field) {
          if (data) {
            var fieldArr = field.split("_");

            if (fieldArr.length > 1) {
              var newField = fieldArr[1].substring(0, 1).toLowerCase() + fieldArr[1].substring(1);
              return data[fieldArr[0]][newField];
            }

            return data[field];
          }

          return "";
        };

        return {
          state: state,
          uploadAttachment: uploadAttachment,
          removeAttachment: removeAttachment,
          selectChange: selectChange,
          goBack: goBack,
          blur: blur,
          toAttachmentDetailPage: toAttachmentDetailPage,
          initContext: initContext,
          getDataValue: getDataValue
        };
      },
      components: {
        "fm-attachment-entry": script$2,
        "fm-attachment": script,
        "van-nav-bar": Vant.NavBar,
        "van-popup": Vant.Popup,
        "van-icon": Vant.Icon,
        "van-field": Vant.Field
      }
    });

    var _withId$3 = /*#__PURE__*/vue.withScopeId("data-v-75253ace");

    vue.pushScopeId("data-v-75253ace");

    var _hoisted_1$4 = {
      class: "fm-input-item fm-input-item-inline",
      id: "attachment-container"
    };
    var _hoisted_2$3 = {
      class: "fm-input-item pr-md pl-md",
      id: "attachment-container"
    };
    var _hoisted_3$3 = {
      class: "fm-edit-input-list",
      id: "detail-form-layout"
    };
    var _hoisted_4$3 = {
      class: "fm-input-wrapper"
    };
    var _hoisted_5$3 = {
      class: "fm-input-wrapper"
    };

    vue.popScopeId();

    var render$4 = /*#__PURE__*/_withId$3(function (_ctx, _cache, $props, $setup, $data, $options) {
      var _component_fm_attachment_entry = vue.resolveComponent("fm-attachment-entry");

      var _component_van_icon = vue.resolveComponent("van-icon");

      var _component_fm_navbar = vue.resolveComponent("fm-navbar");

      var _component_van_field = vue.resolveComponent("van-field");

      var _component_fm_attachment = vue.resolveComponent("fm-attachment");

      var _component_van_popup = vue.resolveComponent("van-popup");

      return vue.openBlock(), vue.createBlock("div", null, [vue.createVNode("div", _hoisted_1$4, [vue.createVNode("div", _hoisted_2$3, [vue.createVNode(_component_fm_attachment_entry, {
        fileList: _ctx.state.filterData,
        externalVideoUrl: _ctx.externalVideoUrl,
        removable: _ctx.removable,
        parentDirName: _ctx.parentDirName,
        rootId: _ctx.rootId,
        onRemove: _ctx.removeAttachment,
        onUpload: _ctx.toAttachmentDetailPage
      }, null, 8
      /* PROPS */
      , ["fileList", "externalVideoUrl", "removable", "parentDirName", "rootId", "onRemove", "onUpload"])])]), _ctx.state.show ? (vue.openBlock(), vue.createBlock(_component_van_popup, {
        key: 0,
        show: _ctx.state.show,
        "onUpdate:show": _cache[1] || (_cache[1] = function ($event) {
          return _ctx.state.show = $event;
        }),
        position: "right",
        style: {
          width: '100%',
          height: '100%',
          display: 'flex',
          'flex-direction': 'column',
          background: '#fff'
        }
      }, {
        default: _withId$3(function () {
          return [_ctx.showNavBar ? (vue.openBlock(), vue.createBlock(_component_fm_navbar, {
            key: 0,
            title: _ctx.title,
            onClickLeft: _ctx.goBack
          }, {
            left: _withId$3(function () {
              return [vue.createVNode(_component_van_icon, {
                name: "arrow-left",
                size: "18",
                color: "#333"
              })];
            }),
            _: 1
            /* STABLE */

          }, 8
          /* PROPS */
          , ["title", "onClickLeft"])) : vue.createCommentVNode("v-if", true), vue.createVNode("div", _hoisted_3$3, [(vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.state.attachmentExtendFields, function (field) {
            return vue.openBlock(), vue.createBlock("div", _hoisted_4$3, [field.editorType === 'TextBox' && field.visible ? (vue.openBlock(), vue.createBlock(_component_van_field, {
              key: 0,
              label: field.label,
              modelValue: _ctx.state.fieldsValue[field.bindingField],
              "onUpdate:modelValue": function onUpdateModelValue($event) {
                return _ctx.state.fieldsValue[field.bindingField] = $event;
              },
              readonly: field.readonly,
              onBlur: function onBlur($event) {
                return _ctx.blur(field);
              }
            }, null, 8
            /* PROPS */
            , ["label", "modelValue", "onUpdate:modelValue", "readonly", "onBlur"])) : vue.createCommentVNode("v-if", true), field.editorType === 'NumberBox' && field.visible ? (vue.openBlock(), vue.createBlock(_component_van_field, {
              key: 1,
              label: field.label,
              modelValue: _ctx.state.fieldsValue[field.bindingField],
              "onUpdate:modelValue": function onUpdateModelValue($event) {
                return _ctx.state.fieldsValue[field.bindingField] = $event;
              },
              readonly: field.readonly,
              type: "number",
              onBlur: function onBlur($event) {
                return _ctx.blur(field);
              }
            }, null, 8
            /* PROPS */
            , ["label", "modelValue", "onUpdate:modelValue", "readonly", "onBlur"])) : vue.createCommentVNode("v-if", true)]);
          }), 256
          /* UNKEYED_FRAGMENT */
          )), (vue.openBlock(true), vue.createBlock(vue.Fragment, null, vue.renderList(_ctx.extendFields, function (field) {
            return vue.openBlock(), vue.createBlock("div", _hoisted_5$3, [field.editorType === 'TextBox' ? (vue.openBlock(), vue.createBlock(_component_van_field, {
              key: 0,
              label: field.label,
              modelValue: _ctx.state.fieldsValue[field.bindingField],
              "onUpdate:modelValue": function onUpdateModelValue($event) {
                return _ctx.state.fieldsValue[field.bindingField] = $event;
              },
              readonly: field.readonly,
              onBlur: function onBlur($event) {
                return _ctx.blur(field);
              }
            }, null, 8
            /* PROPS */
            , ["label", "modelValue", "onUpdate:modelValue", "readonly", "onBlur"])) : vue.createCommentVNode("v-if", true), field.editorType === 'NumberBox' ? (vue.openBlock(), vue.createBlock(_component_van_field, {
              key: 1,
              label: field.label,
              modelValue: _ctx.state.fieldsValue[field.bindingField],
              "onUpdate:modelValue": function onUpdateModelValue($event) {
                return _ctx.state.fieldsValue[field.bindingField] = $event;
              },
              readonly: field.readonly,
              type: "number",
              onBlur: function onBlur($event) {
                return _ctx.blur(field);
              }
            }, null, 8
            /* PROPS */
            , ["label", "modelValue", "onUpdate:modelValue", "readonly", "onBlur"])) : vue.createCommentVNode("v-if", true)]);
          }), 256
          /* UNKEYED_FRAGMENT */
          ))]), _ctx.state.show ? (vue.openBlock(), vue.createBlock(_component_fm_attachment, {
            key: 1,
            fileList: _ctx.state.filterData,
            parentDirName: _ctx.parentDirName,
            externalVideoUrl: _ctx.externalVideoUrl,
            rootId: _ctx.rootId,
            onSelectChange: _ctx.selectChange,
            onRemove: _ctx.removeAttachment,
            onAfterAppendFile: _ctx.uploadAttachment
          }, null, 8
          /* PROPS */
          , ["fileList", "parentDirName", "externalVideoUrl", "rootId", "onSelectChange", "onRemove", "onAfterAppendFile"])) : vue.createCommentVNode("v-if", true)];
        }),
        _: 1
        /* STABLE */

      }, 8
      /* PROPS */
      , ["show"])) : vue.createCommentVNode("v-if", true)]);
    });

    var css_248z$4 = ".van-nav-bar .van-nav-bar__content[data-v-75253ace] {\n  flex: 1; }\n";
    styleInject(css_248z$4);

    script$4.render = render$4;
    script$4.__scopeId = "data-v-75253ace";
    script$4.__file = "src/business/attachment/attachment.vue";

    script$4.install = function (app) {
      app.component(script$4.name, script$4);
    };

    function _isSlot(s) {
      return typeof s === 'function' || Object.prototype.toString.call(s) === '[object Object]' && !vue.isVNode(s);
    }

    var FMApprove = vue.defineComponent({
      name: 'fm-approve',
      components: {
        "fm-popup": FarrisMobileUi.Popup,
        "fm-navbar": FarrisMobileUi.Navbar,
        "fm-lookup-input": FarrisMobileUi.LookupInput,
        "fm-picker": FarrisMobileUi.Picker,
        "fm-button": FarrisMobileUi.Button
      },
      props: {
        show: {
          type: Boolean,
          default: false
        },
        processReadFlag: Boolean,
        nextNodeReadFlag: Boolean,
        assigneeReadFlag: Boolean,
        cancelDisabled: Boolean,
        confirmDisabled: Boolean,
        process: [String, Number],
        processOc: Function,
        processData: Array,
        nextNode: [String, Number],
        nextNodeOc: Function,
        nextNodeData: Array,
        assignee: [String, Number],
        assigneeOc: Function,
        assigneeData: Object,
        submit: Function,
        cancel: Function,
        assignInfos: [Object],
        selectedValues: [String],
        multiSelect: {
          type: Boolean,
          default: true
        },
        assigneeHolder: {
          type: String,
          default: ""
        },
        nextNodeHolder: {
          type: String,
          default: ""
        },
        processHolder: {
          type: String,
          default: ""
        }
      },
      emits: ["update:show", "open", "close"],
      setup: function setup(props, _ref) {
        _ref.attrs;
            _ref.slots;
            var emit = _ref.emit;

        var _processOc = function _processOc(value) {
          if (typeof props.processOc === "function") {
            props.processOc(value);
          }
        };

        var _nextNodeOc = function _nextNodeOc(value) {
          if (typeof props.nextNodeOc === "function") {
            props.nextNodeOc(value);
          }
        };

        var _assigneeOc = function _assigneeOc(value, index) {
          if (typeof props.assigneeOc === "function") {
            props.assigneeOc(value, index);
          }
        };

        var close = function close() {
          emit('update:show', false);
        };

        var $_confirm = function $_confirm() {
          if (typeof props.submit === "function") {
            props.submit();
          }
        };

        var _cancel = function _cancel() {
          close();

          if (typeof props.cancel === "function") {
            props.cancel();
          }
        };

        return function () {
          var _slot;

          var _props$process = props.process,
              process = _props$process === void 0 ? '' : _props$process;
              props.processOc;
              var _props$processData = props.processData,
              processData = _props$processData === void 0 ? [] : _props$processData,
              _props$nextNode = props.nextNode,
              nextNode = _props$nextNode === void 0 ? '' : _props$nextNode;
              props.nextNodeOc;
              var _props$nextNodeData = props.nextNodeData,
              nextNodeData = _props$nextNodeData === void 0 ? [] : _props$nextNodeData;
              props.assignee;
              props.assigneeOc;
              props.assigneeData;
              props.submit;
              props.cancel;
              var _props$selectedValues = props.selectedValues,
              selectedValues = _props$selectedValues === void 0 ? [] : _props$selectedValues,
              processReadFlag = props.processReadFlag,
              nextNodeReadFlag = props.nextNodeReadFlag;
              props.assigneeReadFlag;
              props.cancelDisabled;
              var confirmDisabled = props.confirmDisabled;
              props.multiSelect;
              props.assigneeHolder;
              var nextNodeHolder = props.nextNodeHolder,
              processHolder = props.processHolder,
              _props$assignInfos = props.assignInfos,
              assignInfos = _props$assignInfos === void 0 ? [] : _props$assignInfos; // watch(props, (newValue, oldValue) => {
          //   console.log('The new counter value is:newValue ', newValue)
          //   console.log('The new counter value is: oldValue', oldValue)
          //   console.log('The new counter value is: ', props)
          // })

          return vue.createVNode("div", null, [vue.createVNode(vue.resolveComponent("fm-popup"), {
            "show": props.show,
            "position": "right",
            "style": "width:100%"
          }, _isSlot(_slot = vue.createVNode("div", {
            "class": "fm-submit-approve"
          }, [vue.createVNode("div", {
            "class": "fm-submit-approve-header"
          }, [vue.createVNode(vue.resolveComponent("fm-navbar"), {
            "title": "流程选择",
            "leftArrow": true,
            "onClickLeft": _cancel
          }, null)]), vue.createVNode("div", {
            "class": "fm-submit-approve-main"
          }, [vue.createVNode("div", {
            "class": "fm-submit-approve-form"
          }, [vue.createVNode(vue.resolveComponent("fm-picker"), {
            "name": "picker",
            "modelValue": process,
            "onUpdate:modelValue": function onUpdateModelValue($event) {
              return process = $event;
            },
            "label": "选择流程",
            "placeholder": processHolder,
            "onChange": _processOc,
            "show-toolbar": true,
            "data": processData,
            "readonly": processReadFlag,
            "textField": "name",
            "valueField": "id",
            "mapFields": {
              id: 'id'
            }
          }, null), vue.createVNode(vue.resolveComponent("fm-picker"), {
            "name": "picker",
            "modelValue": nextNode,
            "onUpdate:modelValue": function onUpdateModelValue($event) {
              return nextNode = $event;
            },
            "label": "下一环节",
            "placeholder": nextNodeHolder,
            "onChange": _nextNodeOc,
            "show-toolbar": true,
            "data": nextNodeData,
            "readonly": nextNodeReadFlag,
            "textField": "name",
            "valueField": "id",
            "mapFields": {
              id: 'id'
            }
          }, null), assignInfos.map(function (item, index) {
            return vue.createVNode(vue.resolveComponent("fm-lookup-input"), {
              "name": "lookup-input",
              "modelValue": item.assignee,
              "onUpdate:modelValue": function onUpdateModelValue($event) {
                return item.assignee = $event;
              },
              "placeholder": item.assigneeHolder,
              "label": item.label,
              "idField": "id",
              "textField": "name",
              "data": item.assigneeInfo.assigneeUsers,
              "readonly": item.assigneeReadFlag,
              "multiSelect": item.assigneeInfo && item.assigneeInfo.multiSelect,
              "selectedValues": selectedValues[index] === 'clear' ? '' : selectedValues[index],
              "onValueChange": function onValueChange(e) {
                _assigneeOc(e, index);
              }
            }, null);
          })]), vue.createVNode("div", {
            "class": "fm-submit-approve-btn"
          }, [vue.createVNode(vue.resolveComponent("fm-button"), {
            "type": "info",
            "round": true,
            "block": true,
            "key": "confirm",
            "disabled": confirmDisabled,
            "onClick": $_confirm
          }, {
            default: function _default() {
              return [vue.createTextVNode("\u786E\u5B9A")];
            }
          })])])])) ? _slot : {
            default: function _default() {
              return [_slot];
            }
          })]);
        };
      }
    });

    var instance;
    var backAfterClose;
    var isFirst = false;

    function useExpose(apis) {
      var instance = vue.getCurrentInstance();

      if (instance) {
        Object.assign(instance.proxy, apis);
      }
    }

    function usePopupState() {
      var state = vue.reactive({
        show: false
      });

      var toggle = function toggle(show) {
        state.show = show;
      };

      var open = function open(props) {
        Object.assign(state, props);
        pushOriginGoback();
        vue.nextTick(function () {
          toggle(true);
        });
      };

      var close = function close() {
        toggle(false);
        popOriginGoback();
        backAfterClose && backAfterClose();
        instance = undefined;
      };

      useExpose({
        open: open,
        close: close,
        toggle: toggle
      });
      return {
        open: open,
        close: close,
        state: state,
        toggle: toggle
      };
    }

    function mountComponent(RootComponent) {
      var app = vue.createApp(RootComponent);
      app.use(Vant__default['default']).use(FarrisMobileUi__default['default']);
      var root = document.createElement('div');
      document.body.appendChild(root);
      return {
        instance: app.mount(root),
        unmount: function unmount() {
          app.unmount(root);
          document.body.removeChild(root);
        }
      };
    }

    var initInstance = function initInstance() {
      var a = mountComponent({
        setup: function setup() {
          var _usePopupState = usePopupState(),
              state = _usePopupState.state,
              toggle = _usePopupState.toggle;

          return function () {
            return vue.createVNode(FMApprove, _extends({}, state, {
              'onUpdate:show': toggle
            }), null);
          };
        }
      });
      instance = a.instance;
      backAfterClose = a.unmount;
    };

    function pushOriginGoback() {
      if (!isFirst) {
        window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].pushOriginGoback(closeTheInstance);
        isFirst = true;
      }
    }

    function closeTheInstance() {
      isFirst = false;
      instance.close();
    }

    function popOriginGoback() {
      window['MOBILE_ORIGIN_BACK'] && window['MOBILE_ORIGIN_BACK'].popOriginGoback();
    }

    function SubmitApprove(options) {
      if (typeof window === 'undefined') {
        return;
      }

      if (!instance) {
        initInstance();
      }

      console.log('instance', instance);
      instance.open(options);
      return instance;
    }

    SubmitApprove.clear = function () {
      if (instance) {
        instance.toggle(false);
      }
    };

    SubmitApprove.confirm = function (options) {
      return SubmitApprove(options);
    };

    SubmitApprove.install = function (app) {
      app.component(FMApprove.name, FMApprove);
    };

    SubmitApprove.Component = FMApprove;

    var FMAttachmentPreview = vue.defineComponent({
      name: "fm-attachment-preview",
      components: {
        "fm-popup": FarrisMobileUi.Popup,
        "fm-navbar": FarrisMobileUi.Navbar
      },
      props: {
        title: {
          type: String,
          default: ""
        },
        attachmentId: {
          type: String,
          default: ""
        },
        rootId: {
          type: String,
          default: ""
        },
        show: {
          type: Boolean,
          default: false
        },
        path: {
          type: String,
          default: ""
        }
      },
      emits: ["update:show", "open", "close"],
      setup: function setup(props, _ref) {
        var emit = _ref.emit;

        var close = function close() {
          emit("update:show", false);
        };

        var state = vue.reactive({
          attachmentUrl: vue.computed(function () {
            return "/platform/runtime/dfs/viewpage/index.html?metadataId=" + props.attachmentId + "&rootId=" + props.rootId + "&fileType=2";
          }),
          show: false
        });
        return function () {
          return vue.createVNode("div", null, [vue.createVNode(vue.resolveComponent("fm-popup"), {
            "show": props.show,
            "style": "width:100%;height:100%"
          }, {
            default: function _default() {
              return [vue.createVNode(vue.resolveComponent("fm-navbar"), {
                "title": props.title,
                "onClickLeft": close
              }, null), vue.createVNode("iframe", {
                "class": "pdf-iframe",
                "scrolling": "yes",
                "src": props.path || state.attachmentUrl,
                "width": "100%",
                "height": "100%"
              }, null)];
            }
          })]);
        };
      }
    });

    var instance$1;
    var backAfterClose$1;
    var isFirst$1 = false;

    function useExpose$1(apis) {
      var instance = vue.getCurrentInstance();

      if (instance) {
        Object.assign(instance.proxy, apis);
      }
    }

    function usePopupState$1() {
      var state = vue.reactive({
        show: false
      });

      var toggle = function toggle(show) {
        state.show = show;
      };

      var open = function open(props) {
        Object.assign(state, props);
        pushOriginGoback$1();

        if (window.top && window.top !== window.self) {
          openScale(window.top.document);
        }

        openScale(window.document);
        vue.nextTick(function () {
          toggle(true);
        });
      };

      var close = function close() {
        toggle(false);
        popOriginGoback$1();

        if (window.top && window.top !== window.self) {
          closeScale(window.top.document);
        }

        closeScale(window.document);
        backAfterClose$1 && backAfterClose$1();
        instance$1 = undefined;
      };

      useExpose$1({
        open: open,
        close: close,
        toggle: toggle
      });
      return {
        open: open,
        close: close,
        state: state,
        toggle: toggle
      };
    }

    function mountComponent$1(RootComponent) {
      var app = vue.createApp(RootComponent);
      app.use(Vant__default['default']).use(FarrisMobileUi__default['default']);
      var root = document.createElement("div");
      document.body.appendChild(root);
      return {
        instance: app.mount(root),
        unmount: function unmount() {
          app.unmount(root);
          document.body.removeChild(root);
        }
      };
    }

    var initInstance$1 = function initInstance() {
      var cmp = mountComponent$1({
        setup: function setup() {
          var _usePopupState = usePopupState$1(),
              state = _usePopupState.state,
              toggle = _usePopupState.toggle;

          return function () {
            return vue.createVNode(FMAttachmentPreview, _extends({}, state, {
              "onUpdate:show": toggle
            }), null);
          };
        }
      });
      instance$1 = cmp.instance;
      backAfterClose$1 = cmp.unmount;
    };

    function pushOriginGoback$1() {
      if (!isFirst$1) {
        window["MOBILE_ORIGIN_BACK"] && window["MOBILE_ORIGIN_BACK"].pushOriginGoback(closeTheInstance$1);
        isFirst$1 = true;
      }
    }

    function closeTheInstance$1() {
      isFirst$1 = false;
      instance$1.close();
    }

    function popOriginGoback$1() {
      window["MOBILE_ORIGIN_BACK"] && window["MOBILE_ORIGIN_BACK"].popOriginGoback();
    }

    function AttachmentPreview(options) {
      if (typeof window === "undefined") {
        return;
      }

      if (!instance$1) {
        initInstance$1();
      }

      instance$1.open(options);
      return instance$1;
    }

    function openScale(currentDoc) {
      var originMeta = currentDoc.getElementsByName("viewport")[0];
      var meta = currentDoc.createElement("meta");
      meta.name = "viewport";
      meta.content = "width=device-width, initial-scale=1.0";
      var head = currentDoc.getElementsByTagName("head")[0];

      if (originMeta) {
        head.removeChild(originMeta);
      }

      head.appendChild(meta);
    }

    function closeScale(currentDoc) {
      var originMeta = currentDoc.getElementsByName("viewport")[0];
      var meta = currentDoc.createElement("meta");
      meta.name = "viewport";
      meta.content = "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=n";
      var head = currentDoc.getElementsByTagName("head")[0];

      if (originMeta) {
        head.removeChild(originMeta);
      }

      head.appendChild(meta);
    }

    AttachmentPreview.close = function () {
      if (instance$1) {
        instance$1.toggle(false);
      }
    };

    AttachmentPreview.show = function (options) {
      return AttachmentPreview(options);
    };

    AttachmentPreview.install = function (app) {
      app.component(FMAttachmentPreview.name, FMAttachmentPreview);
    };

    AttachmentPreview.Component = FMAttachmentPreview;

    var script$5 = {
      name: "el-amap",
      props: [//  add v1.4.0 new feature
      "viewMode", "skyColor", "rotateEnable", "pitch", "buildingAnimation", "pitchEnable", "vid", "events", "center", "zoom", "draggEnable", "level", "zooms", "lang", "defaultCursor", "crs", "animateEnable", "isHotspot", "defaultLayer", "resizeEnable", "showIndoorMap", "indoorMap", "expandZoomRange", "dragEnable", "zoomEnable", "doubleClickZoom", "keyboardEnable", "jogEnable", "scrollWheel", "touchZoom", "mapStyle", "plugin", "features", "amapManager", // 地图管理 manager
      "markers"],
      setup: function setup(props, _ref) {
        var _this = this;

        var emit = _ref.emit;
            _ref.attrs;
            _ref.slots;
        var el = vue.ref(null);
        var state = vue.reactive({
          converters: {
            center: function center(arr) {
              if (Object.prototype.toString.call(arr) === "[object Array]" && arr[0] && arr[1]) {
                return new AMap.LngLat(arr[0], arr[1]);
              }
            }
          },
          $amap: "",
          $amapComponent: "",
          loadPromise: null,
          circleMarker: "",
          plugins: vue.computed(function () {
            var plus = []; //地图前缀

            var amap_prefix_reg = /^AMap./; //  获取带前缀的名称

            var parseFullName = function parseFullName(pluginName) {
              return amap_prefix_reg.test(pluginName) ? pluginName : "AMap." + pluginName;
            }; // 获取不带前缀的名称


            var parseShortName = function parseShortName(pluginName) {
              return pluginName.replace(amap_prefix_reg, "");
            };

            if (typeof props.plugin === "string") {
              plus.push({
                pName: parseFullName(props.plugin),
                sName: parseShortName(props.plugin)
              });
            } else if (props.plugin instanceof Array) {
              plus = props.plugin.map(function (oPlugin) {
                var nPlugin = {};

                if (typeof oPlugin === "string") {
                  nPlugin = {
                    pName: parseFullName(oPlugin),
                    sName: parseShortName(oPlugin)
                  };
                } else {
                  oPlugin.pName = parseFullName(oPlugin.pName);
                  oPlugin.sName = parseShortName(oPlugin.pName);
                  nPlugin = oPlugin;
                }

                return nPlugin;
              });
            }

            return plus;
          })
        }); // 挂载前  加载地图脚本

        vue.onBeforeMount(function () {
          state.loadPromise = lazyAMapApiLoaderInstance.load();
        });
        vue.watch(function () {
          return props.center;
        }, function (newValue, oldValue) {
          if (state.$amapComponent) {
            var map = state.$amapComponent;
            map.setCenter(newValue);
            emit("setCircleMarker", newValue, map);
          }
        }); // 加载地图

        vue.onMounted(function () {
          createMap();
        });
        vue.onUnmounted(function () {
          state.$amap.destroy();
        });

        var createMap = function createMap() {
          state.loadPromise.then(function () {
            // 构造地图
            var mapElement = el.value.querySelector(".el-vue-amap");
            var elementID = props.vid || guid();
            mapElement.id = elementID;
            state.$amap = state.$amapComponent = new AMap.Map(elementID, convertProps());
            if (props.amapManager) props.amapManager.setMap(state.$amap); // emit(CONST.AMAP_READY_EVENT, this.$amap);
            // 添加插件

            if (state.plugins && state.plugins.length) {
              var mapPlugin = new MapPlugin();
              mapPlugin.addPlugins(state.$amapComponent, state.plugins);
            } // 注册事件


            if (props.events) {
              Object.keys(props.events).forEach(function (eventName) {
                AMap.event.addListener(state.$amapComponent, eventName, props.events[eventName]);
              });
            }

            emit("afterInit", props.center, state.$amapComponent);
          });
        };

        var convertProps = function convertProps() {
          var propsObj = {};
          if (state.$amap) propsObj.map = state.$amap;
          return Object.keys(props).reduce(function (res, _key) {
            var key = _key;
            var propsValue = convertSignalProp(key, props[key]);
            if (propsValue === undefined) return res;
            propsObj[key] = propsValue;
            return res;
          }, propsObj);
        };

        var convertSignalProp = function convertSignalProp(key, sourceData) {

          if (state.converters && state.converters[key]) {
            return state.converters[key].call(_this, sourceData);
          }

          return sourceData;
        };

        return {
          el: el,
          state: state,
          createMap: createMap,
          convertProps: convertProps,
          convertSignalProp: convertSignalProp
        };
      }
    };

    var _withId$4 = /*#__PURE__*/vue.withScopeId("data-v-958f0908");

    vue.pushScopeId("data-v-958f0908");

    var _hoisted_1$5 = {
      ref: "el",
      class: "el-vue-amap-container"
    };

    var _hoisted_2$4 = /*#__PURE__*/vue.createVNode("div", {
      class: "el-vue-amap"
    }, null, -1
    /* HOISTED */
    );

    vue.popScopeId();

    var render$5 = /*#__PURE__*/_withId$4(function (_ctx, _cache, $props, $setup, $data, $options) {
      return vue.openBlock(), vue.createBlock("div", _hoisted_1$5, [_hoisted_2$4, vue.renderSlot(_ctx.$slots, "default")], 512
      /* NEED_PATCH */
      );
    });

    var css_248z$5 = ".el-vue-amap-container[data-v-958f0908] {\n  height: 100%; }\n  .el-vue-amap-container[data-v-958f0908] .el-vue-amap {\n    height: 100%; }\n";
    styleInject(css_248z$5);

    script$5.render = render$5;
    script$5.__scopeId = "data-v-958f0908";
    script$5.__file = "src/business/map/src/busi-map.vue";

    // polyfills
    var components = [script$5];
    var VueAMap = {
      initAMapApiLoader: initAMapApiLoader,
      AMapManager: AMapManager
    };

    VueAMap.install = function (app) {
      if (VueAMap.installed) return;
      app.config.optionMergeStrategies.deferredReady = app.config.optionMergeStrategies.created; // app.config.globalProperties.$mitt = $mitt;

      components.map(function (_component) {
        // register component
        app.component(_component.name, _component); // .use(_component);
        // component cache

        VueAMap[upperCamelCase(_component.name).replace(/^El/, '')] = _component;
      });
    };

    var script$6 = vue.defineComponent({
      name: "fm-map",
      components: {},
      inject: {
        mapService: {
          default: null
        }
      },
      props: {
        width: {
          type: String,
          default: "100%"
        },
        height: {
          type: String,
          default: "400px"
        },
        zoomEnable: {
          type: Boolean,
          default: true
        },
        dragEnable: {
          type: Boolean,
          default: true
        },
        resizeEnable: {
          type: Boolean,
          default: true
        },
        zoom: {
          type: Number,
          default: 12
        },
        center: {
          type: Array,
          default: function _default() {
            return [0, 0];
          }
        },
        markers: {
          type: Array,
          default: function _default() {
            return [];
          }
        },
        limitCity: {
          type: String,
          default: "山东"
        },
        limitSearch: {
          type: Boolean,
          default: false
        },
        showSearch: {
          type: Boolean,
          default: false
        },
        mapKey: {
          type: String,
          default: "ee46e4ad4d6e45789dc9f2754271e2a6"
        },
        displayDireaction: {
          type: Boolean,
          default: false
        },
        disabled: {
          type: Boolean,
          default: false
        }
      },
      created: function created() {
        VueAMap.initAMapApiLoader({
          key: this.mapKey,
          plugin: ["AMap.Autocomplete", "AMap.PlaceSearch", "AMap.Scale", "AMap.OverView", "AMap.Geolocation", "AMap.ToolBar", "AMap.MapType", "AMap.PolyEditor", "AMap.CircleEditor", "AMap.Geocoder"],
          // 默认高德 sdk 版本为 1.4.4
          v: "1.4.4"
        });
      },
      mounted: function mounted() {},
      unmounted: function unmounted() {
        if (this.mapMarkers && this.mapMarkers.length) {
          this.emptyMarkers();
        }
      },
      data: function data() {
        var _this = this;

        var self = this;
        return {
          amapManager: new AMapManager(),
          subject: null,
          mapMarkers: [],
          // amapManager,
          defaultCenter: [0, 0],
          events: {
            init: function init(o) {
              _this.addMarkers(_this.markers, o);
            },
            zoomchange: function zoomchange() {
              _this.$emit("zoomChange");
            },
            click: function click(e) {
              var geocoder = new AMap.Geocoder({
                radius: 1000,
                extensions: "all"
              });
              var that = _this;
              var address = "";
              geocoder.getAddress([e.lnglat.lng, e.lnglat.lat], function (status, result) {
                if (status === "complete" && result.info === "OK") {
                  if (result && result.regeocode) {
                    address = result.regeocode.formattedAddress;
                    e.address = address;
                    that.$emit("markMap", e); // 设置位置
                    // 显示位置
                  }
                }
              });
            }
          },
          plugin: [{
            pName: "Scale",
            events: {
              init: function init(instance) {}
            }
          }, {
            pName: "Geolocation",
            //定位
            events: {
              init: function init(o) {//   if (!self.center || self.center[0] == 0 || self.center[1] == 0) {
                //     o.getCurrentPosition((status, result) => {
                //       if (result && result.position) {
                //         // 设置中心点
                //         self.defaultCenter = [
                //           result.position.lng,
                //           result.position.lat,
                //         ]; //设置坐标
                //         // 设置点坐标
                //         // const map = self.amapManager.getMap();
                //         self.resetMarkers(self.markers);
                //         self.$nextTick(); //页面渲染好后
                //         self.$emit("getCurrentLocation", result);
                //       }
                //     });
                //   }
              }
            },
            // 禁止移动端浏览器定位
            noGeoLocation: 1,
            // 外网访问
            // noGeoLocation: 0,
            enableHighAccuracy: false,
            //是否使用高精度定位，默认:true
            timeout: 10000,
            //超过10秒后停止定位，默认：无穷大
            maximumAge: 0,
            //定位结果缓存0毫秒，默认：0
            convert: true,
            //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
            showButton: !self.center || self.center[0] == 0 || self.center[1] == 0,
            //显示定位按钮，默认：true
            buttonPosition: "LB",
            //定位按钮停靠位置，默认：'LB'，左下角
            //buttonOffset: window.AMap&&new window.AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            showMarker: true,
            //定位成功后在定位到的位置显示点标记，默认：true
            showCircle: true,
            //定位成功后用圆圈表示定位精度范围，默认：true
            panToLocation: true,
            //定位成功后将定位到的位置作为地图中心点，默认：true
            zoomToAccuracy: true //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false

          }],
          markerEvents: {
            click: function click(e) {
              // 点击事件  返回坐标
              _this.$emit("clickMaker", e);
            },
            dragend: function dragend(e) {
              // 拖拽结束事件  返回坐标
              // this.markers[0].position = [e.lnglat.lng, e.lnglat.lat];
              _this.$emit("dragMarkerEnd", e);
            }
          },
          defaultMarkers: [],
          mapCenter: ""
        };
      },
      watch: {
        markers: function markers(value) {
          if (window.AMap && value) {
            this.resetMarkers(value);
          }
        }
      },
      computed: {
        computedMarkers: function computedMarkers() {
          if (!this.markers) {
            return [];
          }

          return this.markers.length ? this.markers : this.defaultMarkers;
        },
        computedCenter: function computedCenter() {
          return this.center || this.defaultCenter;
        }
      },
      methods: {
        getPosition: function getPosition() {
          this.mapService.getCurrentLocation();
        },
        afterInit: function afterInit(center, map) {
          this.addMarkers(this.markers, map);

          if (Object.prototype.toString.call(this.center) === "[object Array]" && this.center[0] && this.center[1]) {
            var circleMarker = new AMap.CircleMarker({
              center: center,
              radius: 10,
              //3D视图下，CircleMarker半径不要超过64px
              strokeColor: "white",
              strokeWeight: 2,
              strokeOpacity: 0.5,
              fillColor: "rgba(30,144,255)",
              fillOpacity: 0.5,
              zIndex: 10,
              bubble: true,
              cursor: "pointer",
              clickable: true
            });
            circleMarker.setMap(map);
          }

          this.resetMarkers(this.markers);
        },
        getCurrentLocation: function getCurrentLocation() {},
        onSearchResult: function onSearchResult(e) {},
        getCenter: function getCenter() {
          return this.$refs.map.$$getCenter();
        },
        getCurrentPosition: function getCurrentPosition() {},
        // 添加坐标
        addMarkers: function addMarkers(markers, map) {
          // const map = this.amapManager.getMap();
          var mapMarkers = markers.map(function (marker) {
            return new AMap.Marker({
              position: marker.position
            });
          }); // 存储坐标

          this.mapMarkers = [].concat(mapMarkers);
          this.mapMarkers.forEach(function (ele) {
            map.add(ele);
          });
        },
        removeMarkers: function removeMarkers() {},
        emptyMarkers: function emptyMarkers() {
          var map = this.amapManager.getMap();
          map.remove(this.mapMarkers);
          this.mapMarkers.splice(0, this.mapMarkers.length);
        },
        resetMarkers: function resetMarkers(markers) {
          this.emptyMarkers();
          this.addMarkers(markers, this.amapManager.getMap());
        }
      }
    });

    function render$6(_ctx, _cache, $props, $setup, $data, $options) {
      var _component_el_amap = vue.resolveComponent("el-amap");

      return vue.openBlock(), vue.createBlock("div", null, [vue.createVNode("div", {
        style: {
          width: _ctx.width,
          height: _ctx.height
        }
      }, [vue.createVNode(_component_el_amap, {
        ref: "map",
        vid: "amapDemo",
        resizeEnable: _ctx.resizeEnable,
        dragEnable: _ctx.dragEnable,
        zoomEnable: _ctx.zoomEnable,
        center: _ctx.center,
        zoom: _ctx.zoom,
        plugin: _ctx.plugin,
        events: _ctx.events,
        amapManager: _ctx.amapManager,
        onAfterInit: _ctx.afterInit,
        onSetCircleMarker: _ctx.afterInit
      }, null, 8
      /* PROPS */
      , ["resizeEnable", "dragEnable", "zoomEnable", "center", "zoom", "plugin", "events", "amapManager", "onAfterInit", "onSetCircleMarker"])], 4
      /* STYLE */
      )]);
    }

    var css_248z$6 = ".farris-mobile-map {\n  width: 100%;\n  height: 450px; }\n\n.amap-logo {\n  visibility: hidden; }\n\n.amap-scalecontrol {\n  visibility: hidden !important; }\n\n.amap-copyright {\n  visibility: hidden !important; }\n";
    styleInject(css_248z$6);

    script$6.render = render$6;
    script$6.__file = "src/business/map/src/map.vue";

    script$6.install = function (app) {
      app.component(script$6.name, script$6).use(VueAMap);
    };

    var FarrisBusinessPlugin = {
      install: function install(app) {
        app.config.globalProperties.$filterAttachment = function (entityListData, path, rootId, isComponentAdapter) {
          if (isComponentAdapter === void 0) {
            isComponentAdapter = true;
          }

          return mobileVueAdapter.filterData(entityListData, path, rootId, isComponentAdapter);
        };

        app.config.globalProperties.$filterMap = function (currentEntityData, lngPath, latPath) {
          return mobileVueAdapter.filterMapData(currentEntityData, lngPath, latPath);
        };
      }
    };

    var script$7 = vue.defineComponent({
      name: "approval-logs",
      props: {
        dataId: {
          type: String,
          required: true
        },
        title: {
          type: String,
          default: "审批记录"
        },
        visiavle: {
          type: Boolean,
          default: true
        }
      },
      setup: function setup(props) {
        var _toRefs = vue.toRefs(props),
            dataId = _toRefs.dataId;

        var getApprovalLogs = function getApprovalLogs() {
          if (!dataId.value) {
            return;
          }

          var containerElem = document.getElementById("approval-logs-container");
          var approvalLogUrl = "/platform/runtime/wf/webapp/mobiletaskcenter/taskComment.js";
          var version = "" + new Date().getTime();
          approvalLogUrl = approvalLogUrl + ("?version=" + version);
          System.import(approvalLogUrl).then(function () {
            var taskLogsPayload = {
              bizInstId: dataId.value,
              procInstId: "",
              isIncludeHistory: false
            };
            var ApprovalLogUtil = window["gspTaskCenterBizLog"].ApprovalLogUtil;
            ApprovalLogUtil.getBizlogHtml(taskLogsPayload, containerElem);
          });
        };

        vue.onMounted(getApprovalLogs);
        vue.watch(dataId, getApprovalLogs);
        return {};
      }
    });

    var _hoisted_1$6 = {
      key: 0,
      class: "fm-tmpl-struct-wrapper",
      id: "section-83f5062"
    };
    var _hoisted_2$5 = {
      class: "fm-tmpl-section fm-tmpl-section-form"
    };
    var _hoisted_3$4 = {
      class: "fm-tmpl-section-header"
    };
    var _hoisted_4$4 = {
      class: "fm-title"
    };
    var _hoisted_5$4 = {
      class: "fm-title-text"
    };

    var _hoisted_6$3 = /*#__PURE__*/vue.createVNode("div", {
      id: "approval-logs-container"
    }, null, -1
    /* HOISTED */
    );

    function render$7(_ctx, _cache, $props, $setup, $data, $options) {
      return _ctx.visiavle ? (vue.openBlock(), vue.createBlock("div", _hoisted_1$6, [vue.createVNode("div", _hoisted_2$5, [vue.createVNode("div", _hoisted_3$4, [vue.createVNode("div", _hoisted_4$4, [vue.createVNode("span", _hoisted_5$4, vue.toDisplayString(_ctx.title), 1
      /* TEXT */
      )])]), _hoisted_6$3])])) : vue.createCommentVNode("v-if", true);
    }

    script$7.render = render$7;
    script$7.__file = "src/business/approval-logs/approval-logs.vue";

    script$7.install = function (app) {
      app.component(script$7.name, script$7);
    };

    var components$1 = [// 业务组件
    script$3, script$4, script, script$1, script$2, SubmitApprove, script$7, script$6, // 业务插件
    FarrisBusinessPlugin, AttachmentPreview];

    var install = function install(app) {
      // app.use(Vant);
      // app.use(FarrisMobileUI);
      // 监听事件第三方插件 代替$on等
      // 组件注册  直接注册到vue根实例中
      components$1.forEach(function (component) {
        app.use(component);
      }); // 业务插件
    };
    var index = {
      install: install
    };

    exports.ApprovalLogs = script$7;
    exports.Attachment = script;
    exports.AttachmentEntry = script$2;
    exports.AttachmentFile = script$1;
    exports.AttachmentPreview = AttachmentPreview;
    exports.BusinessAttachment = script$4;
    exports.BusinessMap = script$6;
    exports.BusinessVerifyCode = script$3;
    exports.FarrisBusinessPlugin = FarrisBusinessPlugin;
    exports.SubmitApprove = SubmitApprove;
    exports.default = index;
    exports.install = install;

    Object.defineProperty(exports, '__esModule', { value: true });

})));
//# sourceMappingURL=mobile-business-ui.umd.js.map

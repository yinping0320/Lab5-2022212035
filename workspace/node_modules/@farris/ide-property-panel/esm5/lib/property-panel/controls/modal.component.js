/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, EventEmitter, Injector, Output } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { NotifyService } from '@farris/ui-notify';
var ModalPropertyComponent = /** @class */ (function () {
    function ModalPropertyComponent(notifyServ, resolver, modalService, injector) {
        this.notifyServ = notifyServ;
        this.resolver = resolver;
        this.modalService = modalService;
        this.injector = injector;
        this.valueChanged = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.showClearButton = false;
    }
    Object.defineProperty(ModalPropertyComponent.prototype, "elementConfig", {
        get: /**
         * @return {?}
         */
        function () {
            return this._elementConfig;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._elementConfig = value;
            this.convertModalShowValue(this._elementValue);
            this.showClearButton = this.elementConfig.showClearButton && !this.elementConfig.readonly;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ModalPropertyComponent.prototype, "elementValue", {
        get: /**
         * @return {?}
         */
        function () {
            return this._elementValue;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._elementValue = value;
            this.convertModalShowValue(this._elementValue);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ModalPropertyComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ModalPropertyComponent.prototype.changeValue = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.valueChanged.next({ $event: $event, elementValue: this.elementValue });
    };
    /**
     * 清除模态框内容
     */
    /**
     * 清除模态框内容
     * @return {?}
     */
    ModalPropertyComponent.prototype.modalClear = /**
     * 清除模态框内容
     * @return {?}
     */
    function () {
        // 数据转换
        this.convertModalShowValue(null);
        // 若有清除后事件，先执行方法
        if (Object.keys(this.elementConfig).indexOf('afterClickClearButton') > -1 &&
            typeof (this.elementConfig.afterClickClearButton) === 'function') {
            this.elementConfig.afterClickClearButton(this.elementValue);
        }
        this.valueChanged.next({ elementValue: null });
    };
    /**
     * 模态框场景下将属性值转换为输入框中显示的值
     * @param value 属性值
     */
    /**
     * 模态框场景下将属性值转换为输入框中显示的值
     * @private
     * @param {?} value 属性值
     * @return {?}
     */
    ModalPropertyComponent.prototype.convertModalShowValue = /**
     * 模态框场景下将属性值转换为输入框中显示的值
     * @private
     * @param {?} value 属性值
     * @return {?}
     */
    function (value) {
        if (this.elementConfig.converter) {
            this.elementShowValue = this.elementConfig.converter.convertTo(value);
            return;
        }
        if (value && value instanceof Object) {
            this.elementShowValue = JSON.stringify(value);
            return;
        }
        this.elementShowValue = value;
    };
    /**
     * 自定义编辑器使用模态框打开
     */
    /**
     * 自定义编辑器使用模态框打开
     * @return {?}
     */
    ModalPropertyComponent.prototype.openModal = /**
     * 自定义编辑器使用模态框打开
     * @return {?}
     */
    function () {
        if (this.elementConfig.readonly) {
            return;
        }
        if (Object.keys(this.elementConfig).indexOf('beforeOpenModal') > -1 && typeof (this.elementConfig.beforeOpenModal) === 'function') {
            /** @type {?} */
            var result = this.elementConfig.beforeOpenModal();
            if (result && !result.result) {
                this.notifyServ.warning(result.message);
                return;
            }
        }
        this.createEditorComponent();
    };
    /**
     * 创建自定义编辑器
     */
    /**
     * 创建自定义编辑器
     * @private
     * @return {?}
     */
    ModalPropertyComponent.prototype.createEditorComponent = /**
     * 创建自定义编辑器
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var editor = this.elementConfig.editor;
        if (!editor) {
            return;
        }
        // 创建模态框组件
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(editor);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.value = this.elementValue;
        // 编辑器需要的额外参数
        compRef.instance.editorParams = this.elementConfig.editorParams;
        /** @type {?} */
        var modalConfig = compRef.instance.modalConfig;
        if (!modalConfig) {
            modalConfig = {
                title: '属性配置',
                width: 800,
                height: 400,
                showButtons: false
            };
        }
        else if (modalConfig.showButtons) {
            modalConfig.buttons = compRef.instance.modalFooter;
        }
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        // 监听关闭模态框
        if (compRef.instance.closeModal && compRef.instance.closeModal instanceof EventEmitter) {
            compRef.instance.closeModal.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                // 数据转换
                if (data) {
                    _this.convertModalShowValue(data);
                    _this.valueChanged.next({ elementValue: data });
                }
                dialog.close();
            }));
        }
        // 弹出框关闭事件，带参数，格式为{ value, parameters }
        if (compRef.instance.submitModal && compRef.instance.submitModal instanceof EventEmitter) {
            compRef.instance.submitModal.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                if (!data) {
                    dialog.close();
                    return;
                }
                var value = data.value, parameters = data.parameters;
                // 数据转换
                _this.convertModalShowValue(value);
                _this.submitModal.next({ elementValue: value, parameters: parameters });
                dialog.close();
            }));
        }
    };
    ModalPropertyComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-modal-prop',
                    template: "\n    <div class=\"farris-input-wrap modalIcon\">\n        <input type=\"input\" class=\"form-control form-control-sm\" [(ngModel)]=\"elementShowValue\" readonly>\n        <span [class.allowClear]=\"showClearButton\" class=\"showClearButton\" (click)=\"modalClear()\">\n            <i class=\"material-icons clearIcon\">close</i>\n        </span>\n        <i class=\"material-icons moreIcon\" (click)=\"openModal()\">filter_none</i>\n    </div>\n    ",
                    styles: ["\n        .modalIcon .showClearButton {\n            display: none;\n        }\n        .modalIcon:hover .allowClear.showClearButton {\n            display: block;\n        }\n        .modalIcon input {\n            padding-right: 30px;\n        }\n        .modalIcon .moreIcon {\n            position: absolute;\n            top: 6px;\n            right: 6px;\n            cursor: pointer;\n            font-size: 16px;\n            color: #758a96;\n        }\n        .modalIcon .clearIcon {\n            position: absolute;\n            top: 5px;\n            right: 30px;\n            cursor: pointer;\n            font-size: 19px;\n            color: #758a96;\n        }\n        "]
                }] }
    ];
    /** @nocollapse */
    ModalPropertyComponent.ctorParameters = function () { return [
        { type: NotifyService },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: Injector }
    ]; };
    ModalPropertyComponent.propDecorators = {
        valueChanged: [{ type: Output }],
        submitModal: [{ type: Output }]
    };
    return ModalPropertyComponent;
}());
export { ModalPropertyComponent };
if (false) {
    /** @type {?} */
    ModalPropertyComponent.prototype.valueChanged;
    /** @type {?} */
    ModalPropertyComponent.prototype.submitModal;
    /**
     * @type {?}
     * @private
     */
    ModalPropertyComponent.prototype._elementConfig;
    /**
     * @type {?}
     * @private
     */
    ModalPropertyComponent.prototype._elementValue;
    /**
     * 输入框中显示的值
     * @type {?}
     */
    ModalPropertyComponent.prototype.elementShowValue;
    /** @type {?} */
    ModalPropertyComponent.prototype.showClearButton;
    /**
     * @type {?}
     * @private
     */
    ModalPropertyComponent.prototype.notifyServ;
    /**
     * @type {?}
     * @private
     */
    ModalPropertyComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    ModalPropertyComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ModalPropertyComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9pZGUtcHJvcGVydHktcGFuZWwvIiwic291cmNlcyI6WyJsaWIvcHJvcGVydHktcGFuZWwvY29udHJvbHMvbW9kYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLHdCQUF3QixFQUFFLFlBQVksRUFBRSxRQUFRLEVBQTRCLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5SCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBR2xEO0lBNEVJLGdDQUNZLFVBQXlCLEVBQ3pCLFFBQWtDLEVBQ2xDLFlBQTRCLEVBQzVCLFFBQWtCO1FBSGxCLGVBQVUsR0FBVixVQUFVLENBQWU7UUFDekIsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFDbEMsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFwQ3BCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFTaEQsb0JBQWUsR0FBRyxLQUFLLENBQUM7SUEwQlUsQ0FBQztJQXpCbkMsc0JBQUksaURBQWE7Ozs7UUFBakI7WUFDSSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDL0IsQ0FBQzs7Ozs7UUFFRCxVQUFrQixLQUFLO1lBQ25CLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO1lBRTVCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFFL0MsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO1FBQzlGLENBQUM7OztPQVJBO0lBU0Qsc0JBQUksZ0RBQVk7Ozs7UUFBaEI7WUFDSSxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDOUIsQ0FBQzs7Ozs7UUFFRCxVQUFpQixLQUFLO1lBQ2xCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1lBRTNCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkQsQ0FBQzs7O09BTkE7Ozs7SUFjRCx5Q0FBUTs7O0lBQVI7SUFFQSxDQUFDOzs7OztJQUVELDRDQUFXOzs7O0lBQVgsVUFBWSxNQUFNO1FBQ2QsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLFFBQUEsRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUNEOztPQUVHOzs7OztJQUNILDJDQUFVOzs7O0lBQVY7UUFDSSxPQUFPO1FBQ1AsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWpDLGdCQUFnQjtRQUNoQixJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyRSxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLFVBQVUsRUFBRTtZQUNsRSxJQUFJLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUMvRDtRQUVELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7OztJQUNLLHNEQUFxQjs7Ozs7O0lBQTdCLFVBQThCLEtBQUs7UUFDL0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRTtZQUM5QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RFLE9BQU87U0FDVjtRQUNELElBQUksS0FBSyxJQUFJLEtBQUssWUFBWSxNQUFNLEVBQUU7WUFDbEMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUMsT0FBTztTQUNWO1FBQ0QsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztJQUNsQyxDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0gsMENBQVM7Ozs7SUFBVDtRQUNJLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUU7WUFDN0IsT0FBTztTQUNWO1FBQ0QsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsS0FBSyxVQUFVLEVBQUU7O2dCQUN6SCxNQUFNLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUU7WUFDbkQsSUFBSSxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO2dCQUMxQixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3hDLE9BQU87YUFDVjtTQUNKO1FBQ0QsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHOzs7Ozs7SUFDSyxzREFBcUI7Ozs7O0lBQTdCO1FBQUEsaUJBMkRDOztZQTFEUyxNQUFNLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNO1FBQ3hDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDVCxPQUFPO1NBQ1Y7OztZQUVLLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLE1BQU0sQ0FBQzs7WUFDM0QsT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNqRCxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQzNDLGFBQWE7UUFDYixPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQzs7WUFFNUQsV0FBVyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVztRQUM5QyxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2QsV0FBVyxHQUFHO2dCQUNWLEtBQUssRUFBRSxNQUFNO2dCQUNiLEtBQUssRUFBRSxHQUFHO2dCQUNWLE1BQU0sRUFBRSxHQUFHO2dCQUNYLFdBQVcsRUFBRSxLQUFLO2FBQ3JCLENBQUM7U0FDTDthQUFNLElBQUksV0FBVyxDQUFDLFdBQVcsRUFBRTtZQUNoQyxXQUFXLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO1NBQ3REOztZQUVLLE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDO1FBRTNELFVBQVU7UUFDVixJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxZQUFZLFlBQVksRUFBRTtZQUNwRixPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQyxJQUFJO2dCQUN2QyxPQUFPO2dCQUNQLElBQUksSUFBSSxFQUFFO29CQUNOLEtBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFFakMsS0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztpQkFDbEQ7Z0JBRUQsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ25CLENBQUMsRUFBQyxDQUFDO1NBQ047UUFJRCx1Q0FBdUM7UUFDdkMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsWUFBWSxZQUFZLEVBQUU7WUFDdEYsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsU0FBUzs7OztZQUFDLFVBQUEsSUFBSTtnQkFDdkMsSUFBSSxDQUFDLElBQUksRUFBRTtvQkFDUCxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQ2YsT0FBTztpQkFDVjtnQkFDTyxJQUFBLGtCQUFLLEVBQUUsNEJBQVU7Z0JBQ3pCLE9BQU87Z0JBQ1AsS0FBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUVsQyxLQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsVUFBVSxZQUFBLEVBQUUsQ0FBQyxDQUFDO2dCQUUzRCxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDbkIsQ0FBQyxFQUFDLENBQUM7U0FDTjtJQUVMLENBQUM7O2dCQXhNSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLG9jQVFUOzZCQUVHLCtxQkEwQkM7aUJBRVI7Ozs7Z0JBM0NRLGFBQWE7Z0JBRkYsd0JBQXdCO2dCQUNuQyxjQUFjO2dCQURxQyxRQUFROzs7K0JBaUQvRCxNQUFNOzhCQUNOLE1BQU07O0lBNEpYLDZCQUFDO0NBQUEsQUF6TUQsSUF5TUM7U0FoS1ksc0JBQXNCOzs7SUFHL0IsOENBQWlEOztJQUNqRCw2Q0FBZ0Q7Ozs7O0lBRWhELGdEQUF1Qzs7Ozs7SUFDdkMsK0NBQTJCOzs7OztJQUkzQixrREFBeUI7O0lBRXpCLGlEQUF3Qjs7Ozs7SUF1QnBCLDRDQUFpQzs7Ozs7SUFDakMsMENBQTBDOzs7OztJQUMxQyw4Q0FBb0M7Ozs7O0lBQ3BDLDBDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUVudGl0eSB9IGZyb20gJy4uL2VudGl0eS9wcm9wZXJ0eS1lbnRpdHknO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1tb2RhbC1wcm9wJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IGNsYXNzPVwiZmFycmlzLWlucHV0LXdyYXAgbW9kYWxJY29uXCI+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJpbnB1dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sIGZvcm0tY29udHJvbC1zbVwiIFsobmdNb2RlbCldPVwiZWxlbWVudFNob3dWYWx1ZVwiIHJlYWRvbmx5PlxyXG4gICAgICAgIDxzcGFuIFtjbGFzcy5hbGxvd0NsZWFyXT1cInNob3dDbGVhckJ1dHRvblwiIGNsYXNzPVwic2hvd0NsZWFyQnV0dG9uXCIgKGNsaWNrKT1cIm1vZGFsQ2xlYXIoKVwiPlxyXG4gICAgICAgICAgICA8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIGNsZWFySWNvblwiPmNsb3NlPC9pPlxyXG4gICAgICAgIDwvc3Bhbj5cclxuICAgICAgICA8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIG1vcmVJY29uXCIgKGNsaWNrKT1cIm9wZW5Nb2RhbCgpXCI+ZmlsdGVyX25vbmU8L2k+XHJcbiAgICA8L2Rpdj5cclxuICAgIGAsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgLm1vZGFsSWNvbiAuc2hvd0NsZWFyQnV0dG9uIHtcclxuICAgICAgICAgICAgZGlzcGxheTogbm9uZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLm1vZGFsSWNvbjpob3ZlciAuYWxsb3dDbGVhci5zaG93Q2xlYXJCdXR0b24ge1xyXG4gICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcclxuICAgICAgICB9XHJcbiAgICAgICAgLm1vZGFsSWNvbiBpbnB1dCB7XHJcbiAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDMwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5tb2RhbEljb24gLm1vcmVJY29uIHtcclxuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgICAgICAgICB0b3A6IDZweDtcclxuICAgICAgICAgICAgcmlnaHQ6IDZweDtcclxuICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xyXG4gICAgICAgICAgICBmb250LXNpemU6IDE2cHg7XHJcbiAgICAgICAgICAgIGNvbG9yOiAjNzU4YTk2O1xyXG4gICAgICAgIH1cclxuICAgICAgICAubW9kYWxJY29uIC5jbGVhckljb24ge1xyXG4gICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgICAgICAgIHRvcDogNXB4O1xyXG4gICAgICAgICAgICByaWdodDogMzBweDtcclxuICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xyXG4gICAgICAgICAgICBmb250LXNpemU6IDE5cHg7XHJcbiAgICAgICAgICAgIGNvbG9yOiAjNzU4YTk2O1xyXG4gICAgICAgIH1cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNb2RhbFByb3BlcnR5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcblxyXG4gICAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBfZWxlbWVudENvbmZpZzogUHJvcGVydHlFbnRpdHk7XHJcbiAgICBwcml2YXRlIF9lbGVtZW50VmFsdWU6IGFueTtcclxuXHJcblxyXG4gICAgLyoqIOi+k+WFpeahhuS4reaYvuekuueahOWAvCAqL1xyXG4gICAgZWxlbWVudFNob3dWYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgIHNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gICAgZ2V0IGVsZW1lbnRDb25maWcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRDb25maWc7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGVsZW1lbnRDb25maWcodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50Q29uZmlnID0gdmFsdWU7XHJcblxyXG4gICAgICAgIHRoaXMuY29udmVydE1vZGFsU2hvd1ZhbHVlKHRoaXMuX2VsZW1lbnRWYWx1ZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gdGhpcy5lbGVtZW50Q29uZmlnLnNob3dDbGVhckJ1dHRvbiAmJiAhdGhpcy5lbGVtZW50Q29uZmlnLnJlYWRvbmx5O1xyXG4gICAgfVxyXG4gICAgZ2V0IGVsZW1lbnRWYWx1ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBlbGVtZW50VmFsdWUodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50VmFsdWUgPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgdGhpcy5jb252ZXJ0TW9kYWxTaG93VmFsdWUodGhpcy5fZWxlbWVudFZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIG5vdGlmeVNlcnY6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcikgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZVZhbHVlKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2VkLm5leHQoeyAkZXZlbnQsIGVsZW1lbnRWYWx1ZTogdGhpcy5lbGVtZW50VmFsdWUgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOa4hemZpOaooeaAgeahhuWGheWuuVxyXG4gICAgICovXHJcbiAgICBtb2RhbENsZWFyKCkge1xyXG4gICAgICAgIC8vIOaVsOaNrui9rOaNolxyXG4gICAgICAgIHRoaXMuY29udmVydE1vZGFsU2hvd1ZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgICAvLyDoi6XmnInmuIXpmaTlkI7kuovku7bvvIzlhYjmiafooYzmlrnms5VcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5lbGVtZW50Q29uZmlnKS5pbmRleE9mKCdhZnRlckNsaWNrQ2xlYXJCdXR0b24nKSA+IC0xICYmXHJcbiAgICAgICAgICAgIHR5cGVvZiAodGhpcy5lbGVtZW50Q29uZmlnLmFmdGVyQ2xpY2tDbGVhckJ1dHRvbikgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50Q29uZmlnLmFmdGVyQ2xpY2tDbGVhckJ1dHRvbih0aGlzLmVsZW1lbnRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlZC5uZXh0KHsgZWxlbWVudFZhbHVlOiBudWxsIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5oCB5qGG5Zy65pmv5LiL5bCG5bGe5oCn5YC86L2s5o2i5Li66L6T5YWl5qGG5Lit5pi+56S655qE5YC8XHJcbiAgICAgKiBAcGFyYW0gdmFsdWUg5bGe5oCn5YC8XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY29udmVydE1vZGFsU2hvd1ZhbHVlKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudENvbmZpZy5jb252ZXJ0ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50U2hvd1ZhbHVlID0gdGhpcy5lbGVtZW50Q29uZmlnLmNvbnZlcnRlci5jb252ZXJ0VG8odmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRTaG93VmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbGVtZW50U2hvd1ZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDoh6rlrprkuYnnvJbovpHlmajkvb/nlKjmqKHmgIHmoYbmiZPlvIBcclxuICAgICAqL1xyXG4gICAgb3Blbk1vZGFsKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRDb25maWcucmVhZG9ubHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5lbGVtZW50Q29uZmlnKS5pbmRleE9mKCdiZWZvcmVPcGVuTW9kYWwnKSA+IC0xICYmIHR5cGVvZiAodGhpcy5lbGVtZW50Q29uZmlnLmJlZm9yZU9wZW5Nb2RhbCkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5lbGVtZW50Q29uZmlnLmJlZm9yZU9wZW5Nb2RhbCgpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0ICYmICFyZXN1bHQucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnYud2FybmluZyhyZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jcmVhdGVFZGl0b3JDb21wb25lbnQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuiHquWumuS5iee8lui+keWZqFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNyZWF0ZUVkaXRvckNvbXBvbmVudCgpIHtcclxuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVsZW1lbnRDb25maWcuZWRpdG9yO1xyXG4gICAgICAgIGlmICghZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5Yib5bu65qih5oCB5qGG57uE5Lu2XHJcbiAgICAgICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGVkaXRvcik7XHJcbiAgICAgICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLnZhbHVlID0gdGhpcy5lbGVtZW50VmFsdWU7XHJcbiAgICAgICAgLy8g57yW6L6R5Zmo6ZyA6KaB55qE6aKd5aSW5Y+C5pWwXHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5lZGl0b3JQYXJhbXMgPSB0aGlzLmVsZW1lbnRDb25maWcuZWRpdG9yUGFyYW1zO1xyXG5cclxuICAgICAgICBsZXQgbW9kYWxDb25maWcgPSBjb21wUmVmLmluc3RhbmNlLm1vZGFsQ29uZmlnO1xyXG4gICAgICAgIGlmICghbW9kYWxDb25maWcpIHtcclxuICAgICAgICAgICAgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+WxnuaAp+mFjee9ricsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogODAwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiA0MDAsXHJcbiAgICAgICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2UgaWYgKG1vZGFsQ29uZmlnLnNob3dCdXR0b25zKSB7XHJcbiAgICAgICAgICAgIG1vZGFsQ29uZmlnLmJ1dHRvbnMgPSBjb21wUmVmLmluc3RhbmNlLm1vZGFsRm9vdGVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcblxyXG4gICAgICAgIC8vIOebkeWQrOWFs+mXreaooeaAgeahhlxyXG4gICAgICAgIGlmIChjb21wUmVmLmluc3RhbmNlLmNsb3NlTW9kYWwgJiYgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsIGluc3RhbmNlb2YgRXZlbnRFbWl0dGVyKSB7XHJcbiAgICAgICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VNb2RhbC5zdWJzY3JpYmUoKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIOaVsOaNrui9rOaNolxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnRNb2RhbFNob3dWYWx1ZShkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZWQubmV4dCh7IGVsZW1lbnRWYWx1ZTogZGF0YSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIC8vIOW8ueWHuuahhuWFs+mXreS6i+S7tu+8jOW4puWPguaVsO+8jOagvOW8j+S4unsgdmFsdWUsIHBhcmFtZXRlcnMgfVxyXG4gICAgICAgIGlmIChjb21wUmVmLmluc3RhbmNlLnN1Ym1pdE1vZGFsICYmIGNvbXBSZWYuaW5zdGFuY2Uuc3VibWl0TW9kYWwgaW5zdGFuY2VvZiBFdmVudEVtaXR0ZXIpIHtcclxuICAgICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXRNb2RhbC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHZhbHVlLCBwYXJhbWV0ZXJzIH0gPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgLy8g5pWw5o2u6L2s5o2iXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnZlcnRNb2RhbFNob3dWYWx1ZSh2YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJtaXRNb2RhbC5uZXh0KHsgZWxlbWVudFZhbHVlOiB2YWx1ZSwgcGFyYW1ldGVycyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufVxyXG4iXX0=
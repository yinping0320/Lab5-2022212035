/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChildren, ViewEncapsulation } from '@angular/core';
import { ElementPropertyConfig } from '../../entity/property-entity';
import { FPropertyItemComponent } from '../farris-property-item/property-item.component';
import { PropertyItemComponent } from '../property-item/property-item.component';
export class PropertyItemListComponent {
    constructor() {
        // 属性值
        this.dynamicControl = false;
        this.valueChanged = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.triggerRefreshPanel = new EventEmitter();
    }
    /**
     * @param {?} simpleChanges
     * @return {?}
     */
    ngOnChanges(simpleChanges) {
        // 若分类下有propertyData，则取分类下的propertyData；否则取整体的propertyData
        if (this.category.propertyData && this.category.enableCascade) {
            this.data = this.category.propertyData;
        }
        else {
            this.data = this.propertyData;
        }
        this.adaptProperties();
    }
    /**
     * 适配属性
     * @private
     * @return {?}
     */
    adaptProperties() {
        this.category.properties.forEach((/**
         * @param {?} propItem
         * @return {?}
         */
        propItem => {
            if (propItem.propertyType === 'cascade') {
                this.cascadeValueStringify(propItem, this.data[propItem.propertyID]);
                if (Object.keys(propItem).indexOf('visible') < 0) {
                    propItem.visible = true;
                }
            }
        }));
    }
    /**
     * @return {?}
     */
    refresh() {
        // 若分类下有propertyData，则取分类下的propertyData；否则取整体的propertyData
        if (this.category.propertyData && this.category.enableCascade) {
            this.data = this.category.propertyData;
        }
        else {
            this.data = this.propertyData;
        }
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => item.refresh()));
        this.fitems.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => item.refresh()));
    }
    /**
     * 一般属性变更
     * @param {?} $event
     * @return {?}
     */
    _itemChanged($event) {
        const { changeObject } = $event;
        this.data[changeObject.propertyID] = changeObject.propertyValue;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
            this.fitems.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
        }
        changeObject.categoryId = this.category.categoryId;
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID;
        }
        this.valueChanged.emit(changeObject);
    }
    /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param {?} $event
     * @return {?}
     */
    _submitModal($event) {
        const { changeObject, parameters } = $event;
        this.data[changeObject.propertyID] = changeObject.propertyValue;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data, parameters);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
            this.fitems.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
        }
        changeObject.categoryId = this.category.categoryId;
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID;
        }
        this.submitModal.emit($event);
    }
    /**
     * 级联属性变更
     * @param {?} $event
     * @param {?} propItem
     * @return {?}
     */
    _cascadeitemChanged($event, propItem) {
        /** @type {?} */
        const parentPropertyID = propItem.propertyID;
        if (!parentPropertyID) {
            return;
        }
        const { changeObject } = $event;
        if (!this.data[parentPropertyID]) {
            this.data[parentPropertyID] = {};
        }
        this.data[parentPropertyID][changeObject.propertyID] = changeObject.propertyValue;
        changeObject.categoryId = this.category.categoryId;
        changeObject.parentPropertyID = changeObject.propertyPath = parentPropertyID;
        // 分类启用了级联，并且分类下有级联属性
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID + '.' + changeObject.parentPropertyID;
        }
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
            this.fitems.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
        }
        this.cascadeValueStringify(propItem, this.data[parentPropertyID]);
        this.valueChanged.emit(changeObject);
    }
    /**
     * 级联模态框属性变更
     * @param {?} $event
     * @param {?} propItem
     * @return {?}
     */
    __cascadeitemSubmitModal($event, propItem) {
        /** @type {?} */
        const parentPropertyID = propItem.propertyID;
        if (!parentPropertyID) {
            return;
        }
        const { changeObject, parameters } = $event;
        if (!this.data[parentPropertyID]) {
            this.data[parentPropertyID] = {};
        }
        this.data[parentPropertyID][changeObject.propertyID] = changeObject.propertyValue;
        changeObject.categoryId = this.category.categoryId;
        changeObject.parentPropertyID = changeObject.propertyPath = parentPropertyID;
        // 分类启用了级联，并且分类下有级联属性
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID + '.' + changeObject.parentPropertyID;
        }
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data, parameters);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
            this.fitems.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => item.refresh()));
        }
        this.cascadeValueStringify(propItem, this.data[parentPropertyID]);
        this.submitModal.emit($event);
    }
    /**
     * 级联属性的汇总信息
     * @param {?} propItem
     * @param {?} valueObject
     * @return {?}
     */
    cascadeValueStringify(propItem, valueObject) {
        if (!propItem || !propItem.cascadeConfig) {
            return;
        }
        if (!valueObject) {
            propItem.cascadeSummary = '';
            return;
        }
        if (!propItem.cascadeConverter || !propItem.cascadeConverter.convertTo) {
            propItem.cascadeSummary = JSON.stringify(valueObject);
        }
        else {
            propItem.cascadeSummary = propItem.cascadeConverter.convertTo(valueObject, propItem.cascadeConfig);
        }
    }
    /**
     *  已废弃
     * @param {?} propItem
     * @return {?}
     */
    _checkCascadeVisible(propItem) {
        if (Object.keys(propItem).indexOf('visible') < 0) {
            return true;
        }
        else {
            return propItem.visible;
        }
    }
    /**
     * @return {?}
     */
    refreshPanel() {
        this.triggerRefreshPanel.emit();
    }
    /**
     * @param {?} index
     * @param {?} PropItem
     * @return {?}
     */
    trackByPropId(index, PropItem) {
        return PropItem.propertyID;
    }
}
PropertyItemListComponent.decorators = [
    { type: Component, args: [{
                selector: 'webide-property-item-list',
                template: "<div *ngFor=\"let propItem of category.properties; trackBy:trackByPropId\">\r\n    <!-- \u975E\u52A8\u6001\u521B\u5EFA-->\r\n    <ng-container *ngIf=\"!dynamicControl\">\r\n        <div *ngIf=\"propItem.propertyType != 'cascade'\" class=\"px-2\">\r\n            <webide-property-item (valueChanged)=\"_itemChanged($event)\" (submitModal)=\"_submitModal($event)\"\r\n                [elementValue]=\"data[propItem.propertyID]\" [elementConfig]=\"propItem\"\r\n                (triggerRefreshPanel)=\"refreshPanel()\"></webide-property-item>\r\n        </div>\r\n\r\n        <div class=\"farris-panel\" *ngIf=\"propItem.propertyType == 'cascade' && propItem.visible\">\r\n            <div class=\"propertyCascadeItem farris-panel-item card\">\r\n                <div class=\"card-header\" (click)=\"propItem.isExpand=!propItem.isExpand\">\r\n                    <div class=\"panel-item-title\">\r\n                        <div class=\"form-group farris-form-group\">\r\n                            <div class=\"f-section-formgroup-legend\">\r\n                                <div class=\"f-header px-0  col-form-label\" style=\"font-size: inherit;\">\r\n                                    <div class=\"f-title f-utils-fill\">{{propItem.propertyName}}</div>\r\n                                    <div class=\"f-toolbar\">\r\n                                        <button class=\"btn f-btn-collapse-expand f-btn-mx\"\r\n                                            [class.f-state-expand]=\"propItem.isExpand\"><span></span></button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"farris-input-wrap\" *ngIf=\"!propItem.hideCascadeTitle\">\r\n                                <input type=\"input\" class=\"form-control form-control-sm\" readonly\r\n                                    [value]=\"propItem.cascadeSummary\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"card-body\" [style.display]=\"propItem.isExpand?'block':'none'\">\r\n                    <div *ngFor=\"let cascadeItem of propItem.cascadeConfig\" class=\"px-2\">\r\n                        <webide-property-item (valueChanged)=\"_cascadeitemChanged($event,propItem)\"\r\n                            (submitModal)=\"__cascadeitemSubmitModal($event, propItem)\"\r\n                            [elementValue]=\"data[propItem.propertyID]?data[propItem.propertyID][cascadeItem.propertyID]:''\"\r\n                            [elementConfig]=\"cascadeItem\" (triggerRefreshPanel)=\"refreshPanel()\">\r\n                        </webide-property-item>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n\r\n    </ng-container>\r\n\r\n\r\n    <!-- \u52A8\u6001\u521B\u5EFA-->\r\n    <ng-container *ngIf=\"dynamicControl\">\r\n        <div *ngIf=\"propItem.propertyType !== 'cascade'\" class=\"px-2\">\r\n            <dynamic-property-item *ngIf=\"dynamicControl\" (valueChanged)=\"_itemChanged($event)\"\r\n                (submitModal)=\"_submitModal($event)\" [elementValue]=\"data[propItem.propertyID]\"\r\n                [elementConfig]=\"propItem\" (triggerRefreshPanel)=\"refreshPanel()\"></dynamic-property-item>\r\n        </div>\r\n\r\n        <div class=\"farris-panel\" *ngIf=\"propItem.propertyType === 'cascade'\">\r\n            <div class=\"propertyCascadeItem farris-panel-item card\" [hidden]=\"!propItem.visible\">\r\n                <div class=\"card-header\" (click)=\"propItem.isExpand=!propItem.isExpand\">\r\n                    <div class=\"panel-item-title\">\r\n                        <div class=\"form-group farris-form-group\">\r\n                            <div class=\"f-section-formgroup-legend\">\r\n                                <div class=\"f-header px-0  col-form-label\" style=\"font-size: inherit;\">\r\n                                    <div class=\"f-title f-utils-fill\">{{propItem.propertyName}}</div>\r\n                                    <div class=\"f-toolbar\">\r\n                                        <button class=\"btn f-btn-collapse-expand f-btn-mx\"\r\n                                            [class.f-state-expand]=\"propItem.isExpand\"><span></span></button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"farris-input-wrap\" *ngIf=\"!propItem.hideCascadeTitle\">\r\n                                <input type=\"input\" class=\"form-control form-control-sm\" readonly\r\n                                    [value]=\"propItem.cascadeSummary\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"card-body\" [hidden]=\"!propItem.isExpand\">\r\n                    <div *ngFor=\"let cascadeItem of propItem.cascadeConfig\" class=\"px-2\">\r\n\r\n                        <dynamic-property-item *ngIf=\"dynamicControl\"\r\n                            (valueChanged)=\"_cascadeitemChanged($event,propItem)\"\r\n                            (submitModal)=\"__cascadeitemSubmitModal($event, propItem)\"\r\n                            [elementValue]=\"data[propItem.propertyID]?data[propItem.propertyID][cascadeItem.propertyID]:''\"\r\n                            [elementConfig]=\"cascadeItem\" (triggerRefreshPanel)=\"refreshPanel()\">\r\n                        </dynamic-property-item>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </ng-container>\r\n\r\n</div>\r\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".propertyCascadeItem{background-color:transparent!important;border:none!important}.propertyCascadeItem .card-header{background-color:transparent!important;padding:4px 12px!important;color:inherit!important}.propertyCascadeItem .card-header .panel-item-title{width:100%;position:relative;font-size:inherit!important}.propertyCascadeItem .card-header .panel-item-title .farris-input-wrap{margin-left:-5px;margin-right:-5px}.propertyCascadeItem .f-accordion-collapse,.propertyCascadeItem .f-accordion-expand{right:0;left:auto!important;top:6px;color:#6b94ec!important;position:absolute}.propertyCascadeItem .card-body{padding:3px 12px!important;background:rgba(255,255,255,.8);border-radius:8px;margin:4px 8px}"]
            }] }
];
/** @nocollapse */
PropertyItemListComponent.ctorParameters = () => [];
PropertyItemListComponent.propDecorators = {
    category: [{ type: Input }],
    propertyData: [{ type: Input }],
    dynamicControl: [{ type: Input }],
    valueChanged: [{ type: Output }],
    submitModal: [{ type: Output }],
    triggerRefreshPanel: [{ type: Output }],
    items: [{ type: ViewChildren, args: [PropertyItemComponent,] }],
    fitems: [{ type: ViewChildren, args: [FPropertyItemComponent,] }]
};
if (false) {
    /**
     * 某一分类下的属性配置
     * @type {?}
     */
    PropertyItemListComponent.prototype.category;
    /** @type {?} */
    PropertyItemListComponent.prototype.propertyData;
    /** @type {?} */
    PropertyItemListComponent.prototype.dynamicControl;
    /** @type {?} */
    PropertyItemListComponent.prototype.valueChanged;
    /** @type {?} */
    PropertyItemListComponent.prototype.submitModal;
    /** @type {?} */
    PropertyItemListComponent.prototype.triggerRefreshPanel;
    /** @type {?} */
    PropertyItemListComponent.prototype.items;
    /** @type {?} */
    PropertyItemListComponent.prototype.fitems;
    /** @type {?} */
    PropertyItemListComponent.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktaXRlbS1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLXByb3BlcnR5LXBhbmVsLyIsInNvdXJjZXMiOlsibGliL3Byb3BlcnR5LXBhbmVsL2NvbXBvbmVudHMvcHJvcGVydHktaXRlbS1saXN0L3Byb3BlcnR5LWl0ZW0tbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUE0QixpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsSSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUN6RixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQVNqRixNQUFNLE9BQU8seUJBQXlCO0lBZ0JwQzs7UUFaUyxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUV0QixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdkMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RDLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7SUFReEMsQ0FBQzs7Ozs7SUFFakIsV0FBVyxDQUFDLGFBQTRCO1FBQ3RDLDBEQUEwRDtRQUMxRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFO1lBQzdELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUM7U0FDeEM7YUFBTTtZQUNMLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztTQUMvQjtRQUVELElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUV6QixDQUFD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QVksU0FBQyxzQkFBc0I7Ozs7Ozs7SUFUcEMsNkNBQXlDOztJQUN6QyxpREFBc0I7O0lBQ3RCLG1EQUFnQzs7SUFFaEMsaURBQWlEOztJQUNqRCxnREFBZ0Q7O0lBQ2hELHdEQUF3RDs7SUFFeEQsMENBQXlFOztJQUN6RSwyQ0FBNEU7O0lBRzVFLHlDQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZHJlbiwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFbGVtZW50UHJvcGVydHlDb25maWcgfSBmcm9tICcuLi8uLi9lbnRpdHkvcHJvcGVydHktZW50aXR5JztcclxuaW1wb3J0IHsgRlByb3BlcnR5SXRlbUNvbXBvbmVudCB9IGZyb20gJy4uL2ZhcnJpcy1wcm9wZXJ0eS1pdGVtL3Byb3BlcnR5LWl0ZW0uY29tcG9uZW50JztcclxuaW1wb3J0IHsgUHJvcGVydHlJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi4vcHJvcGVydHktaXRlbS9wcm9wZXJ0eS1pdGVtLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dlYmlkZS1wcm9wZXJ0eS1pdGVtLWxpc3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wcm9wZXJ0eS1pdGVtLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3Byb3BlcnR5LWl0ZW0tbGlzdC5jb21wb25lbnQuY3NzJ10sXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG5cclxufSlcclxuZXhwb3J0IGNsYXNzIFByb3BlcnR5SXRlbUxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xyXG4gIC8qKiDmn5DkuIDliIbnsbvkuIvnmoTlsZ7mgKfphY3nva4gKi9cclxuICBASW5wdXQoKSBjYXRlZ29yeTogRWxlbWVudFByb3BlcnR5Q29uZmlnO1xyXG4gIEBJbnB1dCgpIHByb3BlcnR5RGF0YTsgLy8g5bGe5oCn5YC8XHJcbiAgQElucHV0KCkgZHluYW1pY0NvbnRyb2wgPSBmYWxzZTtcclxuXHJcbiAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSB0cmlnZ2VyUmVmcmVzaFBhbmVsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBWaWV3Q2hpbGRyZW4oUHJvcGVydHlJdGVtQ29tcG9uZW50KSBpdGVtczogQXJyYXk8UHJvcGVydHlJdGVtQ29tcG9uZW50PjtcclxuICBAVmlld0NoaWxkcmVuKEZQcm9wZXJ0eUl0ZW1Db21wb25lbnQpIGZpdGVtczogQXJyYXk8RlByb3BlcnR5SXRlbUNvbXBvbmVudD47XHJcblxyXG4gIC8vIOWunumZheWxnuaAp+WAvFxyXG4gIGRhdGE7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKHNpbXBsZUNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIC8vIOiLpeWIhuexu+S4i+aciXByb3BlcnR5RGF0Ye+8jOWImeWPluWIhuexu+S4i+eahHByb3BlcnR5RGF0Ye+8m+WQpuWImeWPluaVtOS9k+eahHByb3BlcnR5RGF0YVxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkucHJvcGVydHlEYXRhICYmIHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICB0aGlzLmRhdGEgPSB0aGlzLmNhdGVnb3J5LnByb3BlcnR5RGF0YTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGF0YSA9IHRoaXMucHJvcGVydHlEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYWRhcHRQcm9wZXJ0aWVzKCk7XHJcblxyXG4gIH1cclxuICAvKipcclxuICAgKiDpgILphY3lsZ7mgKdcclxuICAgKi9cclxuICBwcml2YXRlIGFkYXB0UHJvcGVydGllcygpIHtcclxuICAgIHRoaXMuY2F0ZWdvcnkucHJvcGVydGllcy5mb3JFYWNoKHByb3BJdGVtID0+IHtcclxuICAgICAgaWYgKHByb3BJdGVtLnByb3BlcnR5VHlwZSA9PT0gJ2Nhc2NhZGUnKSB7XHJcbiAgICAgICAgdGhpcy5jYXNjYWRlVmFsdWVTdHJpbmdpZnkocHJvcEl0ZW0sIHRoaXMuZGF0YVtwcm9wSXRlbS5wcm9wZXJ0eUlEXSk7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHByb3BJdGVtKS5pbmRleE9mKCd2aXNpYmxlJykgPCAwKSB7XHJcbiAgICAgICAgICBwcm9wSXRlbS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmVmcmVzaCgpIHtcclxuICAgIC8vIOiLpeWIhuexu+S4i+aciXByb3BlcnR5RGF0Ye+8jOWImeWPluWIhuexu+S4i+eahHByb3BlcnR5RGF0Ye+8m+WQpuWImeWPluaVtOS9k+eahHByb3BlcnR5RGF0YVxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkucHJvcGVydHlEYXRhICYmIHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICB0aGlzLmRhdGEgPSB0aGlzLmNhdGVnb3J5LnByb3BlcnR5RGF0YTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGF0YSA9IHRoaXMucHJvcGVydHlEYXRhO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgdGhpcy5maXRlbXMuZm9yRWFjaChpdGVtID0+IGl0ZW0ucmVmcmVzaCgpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4gOiIrOWxnuaAp+WPmOabtFxyXG4gICAqL1xyXG4gIF9pdGVtQ2hhbmdlZCgkZXZlbnQpIHtcclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0IH0gPSAkZXZlbnQ7XHJcbiAgICB0aGlzLmRhdGFbY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgICB0aGlzLmZpdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEO1xyXG4gICAgfVxyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdChjaGFuZ2VPYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qih5oCB5qGG5pWw5o2u5Y+Y5pu077yIVE9ETzrlvoXkvJjljJbvvIzlkIjlubZ2YWx1ZUNoYW5nZeS6i+S7tu+8iVxyXG4gICAqL1xyXG4gIF9zdWJtaXRNb2RhbCgkZXZlbnQpIHtcclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0LCBwYXJhbWV0ZXJzIH0gPSAkZXZlbnQ7XHJcbiAgICB0aGlzLmRhdGFbY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgICB0aGlzLmZpdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZU9iamVjdC5jYXRlZ29yeUlkID0gdGhpcy5jYXRlZ29yeS5jYXRlZ29yeUlkO1xyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KCRldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnuqfogZTlsZ7mgKflj5jmm7RcclxuICAgKi9cclxuICBfY2FzY2FkZWl0ZW1DaGFuZ2VkKCRldmVudCwgcHJvcEl0ZW0pIHtcclxuICAgIGNvbnN0IHBhcmVudFByb3BlcnR5SUQgPSBwcm9wSXRlbS5wcm9wZXJ0eUlEO1xyXG4gICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUlEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0IH0gPSAkZXZlbnQ7XHJcbiAgICBpZiAoIXRoaXMuZGF0YVtwYXJlbnRQcm9wZXJ0eUlEXSkge1xyXG4gICAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF1bY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQgPSBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gcGFyZW50UHJvcGVydHlJRDtcclxuICAgIC8vIOWIhuexu+WQr+eUqOS6hue6p+iBlO+8jOW5tuS4lOWIhuexu+S4i+aciee6p+iBlOWxnuaAp1xyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEICsgJy4nICsgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgICB0aGlzLmZpdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FzY2FkZVZhbHVlU3RyaW5naWZ5KHByb3BJdGVtLCB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0pO1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdChjaGFuZ2VPYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57qn6IGU5qih5oCB5qGG5bGe5oCn5Y+Y5pu0XHJcbiAgICovXHJcbiAgX19jYXNjYWRlaXRlbVN1Ym1pdE1vZGFsKCRldmVudCwgcHJvcEl0ZW0pIHtcclxuICAgIGNvbnN0IHBhcmVudFByb3BlcnR5SUQgPSBwcm9wSXRlbS5wcm9wZXJ0eUlEO1xyXG4gICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUlEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0LCBwYXJhbWV0ZXJzIH0gPSAkZXZlbnQ7XHJcbiAgICBpZiAoIXRoaXMuZGF0YVtwYXJlbnRQcm9wZXJ0eUlEXSkge1xyXG4gICAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF1bY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQgPSBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gcGFyZW50UHJvcGVydHlJRDtcclxuICAgIC8vIOWIhuexu+WQr+eUqOS6hue6p+iBlO+8jOW5tuS4lOWIhuexu+S4i+aciee6p+iBlOWxnuaAp1xyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEICsgJy4nICsgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgICB0aGlzLmZpdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FzY2FkZVZhbHVlU3RyaW5naWZ5KHByb3BJdGVtLCB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0pO1xyXG5cclxuICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdCgkZXZlbnQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnuqfogZTlsZ7mgKfnmoTmsYfmgLvkv6Hmga9cclxuICAgKiBAcGFyYW0gcHJvcEl0ZW1cclxuICAgKiBAcGFyYW0gdmFsdWVPYmplY3RcclxuICAgKi9cclxuICBjYXNjYWRlVmFsdWVTdHJpbmdpZnkocHJvcEl0ZW0sIHZhbHVlT2JqZWN0KSB7XHJcbiAgICBpZiAoIXByb3BJdGVtIHx8ICFwcm9wSXRlbS5jYXNjYWRlQ29uZmlnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghdmFsdWVPYmplY3QpIHtcclxuICAgICAgcHJvcEl0ZW0uY2FzY2FkZVN1bW1hcnkgPSAnJztcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFwcm9wSXRlbS5jYXNjYWRlQ29udmVydGVyIHx8ICFwcm9wSXRlbS5jYXNjYWRlQ29udmVydGVyLmNvbnZlcnRUbykge1xyXG4gICAgICBwcm9wSXRlbS5jYXNjYWRlU3VtbWFyeSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlT2JqZWN0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHByb3BJdGVtLmNhc2NhZGVTdW1tYXJ5ID0gcHJvcEl0ZW0uY2FzY2FkZUNvbnZlcnRlci5jb252ZXJ0VG8odmFsdWVPYmplY3QsIHByb3BJdGVtLmNhc2NhZGVDb25maWcpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogIOW3suW6n+W8g1xyXG4gICAqL1xyXG4gIF9jaGVja0Nhc2NhZGVWaXNpYmxlKHByb3BJdGVtKSB7XHJcbiAgICBpZiAoT2JqZWN0LmtleXMocHJvcEl0ZW0pLmluZGV4T2YoJ3Zpc2libGUnKSA8IDApIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcHJvcEl0ZW0udmlzaWJsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICByZWZyZXNoUGFuZWwoKSB7XHJcbiAgICB0aGlzLnRyaWdnZXJSZWZyZXNoUGFuZWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgdHJhY2tCeVByb3BJZChpbmRleDogbnVtYmVyLCBQcm9wSXRlbTogYW55KTogc3RyaW5nIHtcclxuICAgIHJldHVybiBQcm9wSXRlbS5wcm9wZXJ0eUlEO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
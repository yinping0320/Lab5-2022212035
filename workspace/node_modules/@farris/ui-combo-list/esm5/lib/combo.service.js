/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector } from '@angular/core';
import { BehaviorSubject, Subject, of } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { debounceTime, map, switchMap, catchError, tap, delay } from 'rxjs/operators';
import { LoadingService } from '@farris/ui-loading';
import { LookupUtils, ServerSideToken } from '@farris/ui-lookup';
import { ComboServerSideToken } from './http/ComboHttpService';
var ComboService = /** @class */ (function () {
    function ComboService(http, loadingService, injector) {
        var _this = this;
        this.http = http;
        this.loadingService = loadingService;
        this.injector = injector;
        this.selections$ = new Subject();
        this.isOpen$ = new BehaviorSubject(false);
        this.data$ = new BehaviorSubject('');
        this.serachValue$ = new Subject();
        this.loadSuccess$ = new Subject();
        this.treeInfo$ = new BehaviorSubject(null);
        this.displayType = 'LIST';
        this.separator = ',';
        this.columns = [];
        this.remoteSearch = true;
        this.panelElement = null;
        this.treeSearchHandler = null;
        // 树帮助加载设置
        this.treeloadconfig = null;
        this._data = [];
        this.serachValue$.pipe(debounceTime(300)).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (!_this.remoteSearch) {
                _this.filterData(value, _this.textField);
            }
            else {
                _this.filterDataOnServer(value);
            }
        }));
    }
    Object.defineProperty(ComboService.prototype, "uri", {
        get: /**
         * @return {?}
         */
        function () {
            return this._uri;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._uri = val;
            this.data$.next([]);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboService.prototype, "data", {
        get: /**
         * @return {?}
         */
        function () {
            return this._data;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._data = value || [];
            if (Array.isArray(value)) {
                this.data$.next(value);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ComboService.prototype.injectService = /**
     * @return {?}
     */
    function () {
        if (this.injector && !this.comboHttp) {
            this.lookupUtils = this.injector.get(LookupUtils, null);
            if (this.displayType.indexOf('LOOKUP') > -1) {
                this.comboHttp = this.injector.get(ServerSideToken, null);
            }
            else {
                this.comboHttp = this.injector.get(ComboServerSideToken, null);
            }
        }
    };
    /**
     * @param {?} value
     * @return {?}
     */
    ComboService.prototype.toBoolean = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        return value != null && "" + value !== 'false';
    };
    /**
     * @param {?} data
     * @param {?=} index
     * @param {?=} emitEvent
     * @return {?}
     */
    ComboService.prototype.selectItem = /**
     * @param {?} data
     * @param {?=} index
     * @param {?=} emitEvent
     * @return {?}
     */
    function (data, index, emitEvent) {
        var _this = this;
        if (emitEvent === void 0) { emitEvent = true; }
        if (!this.multiSelect) {
            this.selections = [];
        }
        if (Array.isArray(data)) {
            data.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                if (_this.selections.findIndex((/**
                 * @param {?} s
                 * @return {?}
                 */
                function (s) { return s[_this.idField] === n[_this.idField]; })) === -1) {
                    _this.selections.push(n);
                }
            }));
        }
        else {
            if (this.selections.findIndex((/**
             * @param {?} s
             * @return {?}
             */
            function (s) { return s[_this.idField] === data[_this.idField]; })) === -1) {
                this.selections.push(data);
            }
        }
        if (emitEvent) {
            this.selections$.next({ action: 'clicked' });
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ComboService.prototype.unSelectItem = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.selections = this.selections.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            // return item[this.idField] !== data[this.idField];
            return JSON.stringify(item) !== JSON.stringify(data);
        }));
        this.selections$.next({ action: 'clicked' });
    };
    /**
     * @param {?} datas
     * @return {?}
     */
    ComboService.prototype.selectAll = /**
     * @param {?} datas
     * @return {?}
     */
    function (datas) {
        var _this = this;
        (datas || []).forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (!_this.selections.find((/**
             * @param {?} i
             * @return {?}
             */
            function (i) { return i[_this.idField] === n[_this.idField]; }))) {
                _this.selections.push(n);
            }
        }));
        // this.selections = datas;
        this.selections$.next({ action: 'clicked' });
    };
    /**
     * @param {?} datas
     * @return {?}
     */
    ComboService.prototype.unSelectAll = /**
     * @param {?} datas
     * @return {?}
     */
    function (datas) {
        var _this = this;
        // this.selections = [];
        datas = datas || [];
        this.selections = (this.selections || []).filter((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return datas.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i[_this.idField] === n[_this.idField]; })) === -1; }));
        this.selections$.next({ action: 'clicked' });
    };
    /**
     * @param {?} id
     * @return {?}
     */
    ComboService.prototype.isSelect = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        if (this.selections && this.selections.length) {
            return this.selections.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item[_this.idField] === id; })) !== undefined;
        }
        return false;
    };
    /**
     * @param {?} data
     * @param {?=} selectValues
     * @param {?=} callback
     * @return {?}
     */
    ComboService.prototype.loadData = /**
     * @param {?} data
     * @param {?=} selectValues
     * @param {?=} callback
     * @return {?}
     */
    function (data, selectValues, callback) {
        if (selectValues === void 0) { selectValues = ''; }
        if (data) {
            if (selectValues === null || selectValues === undefined) {
                selectValues = '';
            }
            if (typeof selectValues === 'boolean') {
                selectValues = '' + selectValues;
            }
            // this.data$.next(data);
            if (selectValues) {
                /** @type {?} */
                var vals = [(selectValues + '')];
                if (this.multiSelect) {
                    vals = (selectValues + '').split(this.separator);
                }
                /** @type {?} */
                var selectedItems = vals.map((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) {
                    return callback(data, val);
                }));
                selectedItems = selectedItems.filter((/**
                 * @param {?} el
                 * @return {?}
                 */
                function (el) { return el; }));
                if ((!this.selections || !this.selections.length) && selectedItems.length) {
                    this.selections = selectedItems;
                }
            }
            else {
                this.selections = [];
            }
            this.selections$.next({ action: 'initData' });
        }
    };
    /**
     * @param {?} params
     * @return {?}
     */
    ComboService.prototype.filterDataOnServer = /**
     * @param {?} params
     * @return {?}
     */
    function (params) {
        var _this = this;
        this.getData(params).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            _this.closeLoading();
            _this.loadingService.clearAll();
            if (r && r.items) {
                switch (_this.displayType) {
                    case 'LOOKUPLIST': {
                        _this.loadLookUpDataTable(r, true);
                        break;
                    }
                    case 'LOOKUPTREELIST': {
                        _this.loadLookUpDataTree(r);
                        break;
                    }
                }
            }
            else {
                _this.data$.next([]);
            }
        }));
    };
    // 客户端过滤
    // 客户端过滤
    /**
     * @param {?} val
     * @param {?=} field
     * @return {?}
     */
    ComboService.prototype.filterData = 
    // 客户端过滤
    /**
     * @param {?} val
     * @param {?=} field
     * @return {?}
     */
    function (val, field) {
        var _this = this;
        if (field === void 0) { field = 'text'; }
        if (val) {
            /** @type {?} */
            var data = [];
            if (this.displayType === 'LOOKUPLIST' || this.displayType === 'LIST') {
                data = this.data.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    /** @type {?} */
                    var itemval = _this.getValueByObj(field, item);
                    if (itemval != '' && itemval !== null && itemval !== undefined) {
                        itemval = String(itemval).toLowerCase();
                    }
                    return itemval.indexOf(val.toLowerCase()) > -1;
                }));
            }
            // const data = this.data
            //     ? this.data.filter(item => {
            //         if (this.getValueByObj(filed, item)) {
            //             return String(this.getValueByObj(filed, item)).indexOf(val) > -1;
            //         } else if (item.data && this.getValueByObj(filed, item.data)) {
            //             return String(this.getValueByObj(filed, item.data)).indexOf(val) > -1;
            //         }
            //     })
            //     : [];
            this.data$.next(data);
        }
        else {
            this.data$.next(this.data);
        }
    };
    /**
     * @return {?}
     */
    ComboService.prototype.getSelections = /**
     * @return {?}
     */
    function () {
        return this.selections;
    };
    /**
     * @return {?}
     */
    ComboService.prototype.clearSelections = /**
     * @return {?}
     */
    function () {
        this.selections = [];
    };
    /**
     * @param {?} prop
     * @param {?=} selections
     * @return {?}
     */
    ComboService.prototype.getValue = /**
     * @param {?} prop
     * @param {?=} selections
     * @return {?}
     */
    function (prop, selections) {
        var _this = this;
        selections = selections ? selections : this.selections;
        if (selections && selections.length) {
            /** @type {?} */
            var tmp = selections.map((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                return _this.getValueByObj(prop, item);
            }));
            if (tmp && (tmp.length > 1 || tmp.length === 0)) {
                return tmp.join(this.separator);
            }
            else {
                return tmp[0];
            }
        }
        return '';
    };
    /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    ComboService.prototype.getValueByObj = /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    function (field, data) {
        if (!data) {
            return '';
        }
        /** @type {?} */
        var resultVal = '';
        if (field.indexOf('.') === -1) {
            if (data.hasOwnProperty(field)) {
                resultVal = data[field];
            }
            else {
                // console.log(`%cError: The %c"${field}"%c is not in `,
                //         'color: #bb0000;font-weight: bold;', 'color: red;font-style: italic', 'color: #bb0000;font-weight: bold;', data);
                resultVal = null;
            }
        }
        else {
            resultVal = field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            function (obj, key) {
                if (obj) {
                    return obj[key];
                }
                else {
                    // console.log(`%cError: The %c"${key}"%c is not in  `,
                    // 'color: #bb0000;font-weight: bold', 'color: red;font-style: italic', 'color: #bb0000;font-weight: bold;', obj);
                    return null;
                }
            }), data);
        }
        return resultVal;
    };
    /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} selectedIds
     * @return {?}
     */
    ComboService.prototype.initData = /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} selectedIds
     * @return {?}
     */
    function (params, method, selectedIds) {
        var _this = this;
        if (params === void 0) { params = {}; }
        if (method === void 0) { method = 'get'; }
        if (selectedIds === void 0) { selectedIds = ''; }
        switch (this.displayType) {
            case 'TreeList':
            case 'LIST': {
                if (params.data) {
                    params = params.data;
                }
                this.getData(params, method).subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) {
                    /** @type {?} */
                    var __data = d;
                    if (!_this.uri) {
                        __data = _this.data;
                    }
                    if (_this.displayType === 'TreeList') {
                        _this.loadDataTree(__data);
                    }
                    else {
                        _this.loadDataTable(__data);
                    }
                    _this.loadSuccess$.next(true);
                }));
                break;
            }
            case 'LOOKUPLIST':
            case 'LOOKUPTREELIST': {
                // TFS 466104
                if (!selectedIds) {
                    this.selections = [];
                    this.selectedValues = '';
                }
                this.loadLookupData(params, selectedIds, 'get', this.displayType === 'LOOKUPTREELIST');
                break;
            }
        }
        return this.loadSuccess$;
    };
    // 此方法用于筛选选中的数据
    // 进一步优化：需要服务器端提供一个不构造树结构、根据ID返回简单的列表即可
    // 此方法用于筛选选中的数据
    // 进一步优化：需要服务器端提供一个不构造树结构、根据ID返回简单的列表即可
    /**
     * @private
     * @param {?} treeNodes
     * @param {?=} arr
     * @return {?}
     */
    ComboService.prototype.treeNodesToFlatData = 
    // 此方法用于筛选选中的数据
    // 进一步优化：需要服务器端提供一个不构造树结构、根据ID返回简单的列表即可
    /**
     * @private
     * @param {?} treeNodes
     * @param {?=} arr
     * @return {?}
     */
    function (treeNodes, arr) {
        var _this = this;
        if (arr === void 0) { arr = []; }
        treeNodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            if (!n['addtional']) {
                arr.push(n.data);
            }
            if (n.children && n.children.length) {
                _this.treeNodesToFlatData(n.children, arr);
            }
        }));
    };
    /**
     * @private
     * @param {?} params
     * @param {?} selectedIds
     * @param {?=} method
     * @param {?=} isTree
     * @return {?}
     */
    ComboService.prototype.loadLookupData = /**
     * @private
     * @param {?} params
     * @param {?} selectedIds
     * @param {?=} method
     * @param {?=} isTree
     * @return {?}
     */
    function (params, selectedIds, method, isTree) {
        var _this = this;
        if (method === void 0) { method = 'get'; }
        if (isTree === void 0) { isTree = false; }
        var data = params.data, enableFullTree = params.enableFullTree, loadTreeDataType = params.loadTreeDataType, searchValue = params.searchValue;
        if (data) {
            params = { customData: data };
        }
        if (this.displayType === 'LOOKUPTREELIST' && !this['treeToList']) {
            params.enableFullTree = enableFullTree;
            // params.loadTreeDataType = 'loadall'; 
            params.searchValue = { "category": "all" };
            this.treeloadconfig = { enableFullTree: enableFullTree, loadTreeDataType: loadTreeDataType };
            if (!isNaN(Number(params.expandLevel))) {
                // 前端 -1 不展开   0 全展开
                // 后端  0 不展开  -1 全展开
                if (params.expandLevel) {
                    if (params.expandLevel === -1) {
                        params.expandLevel = 0;
                    }
                }
                else {
                    params.expandLevel = -1;
                }
                params.searchValue['layerNum'] = params.expandLevel;
            }
            params.searchValue = JSON.stringify(params.searchValue);
        }
        if (searchValue) {
            params.searchValue = searchValue;
        }
        if (this['treeToList']) {
            isTree = false;
            this.displayType = 'LOOKUPLIST';
        }
        this.getData(params, method).pipe(switchMap((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (selectedIds) {
                return _this.getSelectedItems(selectedIds).pipe(map((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) {
                    if (d && d.items) {
                        // data.selectedItems = isTree ?  d.items.map(n => n.data) : d.items;
                        if (isTree) {
                            /** @type {?} */
                            var arr = [];
                            _this.treeNodesToFlatData(d.items, arr);
                            data.selectedItems = arr;
                        }
                        else {
                            data.selectedItems = d.items;
                        }
                    }
                    else {
                        if (Array.isArray(d)) {
                            data.selectedItems = (selectedIds + '').split(_this.separator).map((/**
                             * @param {?} val
                             * @return {?}
                             */
                            function (val) {
                                if (isTree) {
                                    return _this.treeNodeToFlatData(d, val, _this.idField);
                                }
                                else {
                                    return d.find((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    function (n) { return n[_this.idField] + '' == val || n[_this.textField] == val; }));
                                }
                            })).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            function (n) { return n != undefined && n != null; }));
                        }
                    }
                    return data;
                })), catchError((/**
                 * @return {?}
                 */
                function () {
                    return of(data);
                })));
            }
            else {
                data.selectedItems = [];
            }
            return of(data);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.loadingService.clearAll();
            if (data) {
                if (isTree) {
                    _this.loadLookUpDataTree(data);
                }
                else {
                    _this.loadLookUpDataTable(data);
                }
            }
            _this.loadSuccess$.next(true);
        }));
    };
    /**
     * @param {?} selIds
     * @return {?}
     */
    ComboService.prototype.getSelectedItems = /**
     * @param {?} selIds
     * @return {?}
     */
    function (selIds) {
        /** @type {?} */
        var searchParam = {
            category: 'fav', favoriteIds: ('' + selIds).split(this.separator)
        };
        /** @type {?} */
        var p = { searchValue: JSON.stringify(searchParam), enableFullTree: false, loadTreeDataType: 'default' };
        return this.getData(p);
    };
    /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} loadChild
     * @return {?}
     */
    ComboService.prototype.getData = /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} loadChild
     * @return {?}
     */
    function (params, method, loadChild) {
        var _this = this;
        if (params === void 0) { params = {}; }
        if (method === void 0) { method = 'get'; }
        if (loadChild === void 0) { loadChild = false; }
        if (this.uri) {
            // this.data = []
            // tfs 470519
            if (this.data && this.data.length && !loadChild) {
                this.data = [];
            }
            params['treeToList'] = this['treeToList'];
            params['navTreeToList'] = this['navTreeToList'];
            if (this['treeToList']) {
                this.displayType = 'LOOKUPLIST';
            }
            this.showLoading();
            if (this.comboHttp) {
                if (this.context) {
                    this.comboHttp.context = this.context;
                }
                return this.comboHttp.getData(this.uri, params, method).pipe(tap((/**
                 * @return {?}
                 */
                function () {
                    _this.closeLoading();
                })));
            }
            else {
                return this.http.request(method, this.uri, params).pipe(tap((/**
                 * @return {?}
                 */
                function () {
                    _this.closeLoading();
                })));
            }
        }
        else {
            if (this.data) {
                return of(this.data).pipe(delay(10));
            }
            else {
                return of([]).pipe(delay(10));
            }
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ComboService.prototype.loadDataTable = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (data instanceof Array) {
            this.data = data;
        }
        else {
            this.data = data ? data.returnValue : [];
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        function (dataArr, val) {
            return dataArr.find((/**
             * @param {?} d
             * @return {?}
             */
            function (d) { return d[_this.idField] + '' == val || d[_this.textField] == val; }));
        }));
        this.closeLoading();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ComboService.prototype.loadDataTree = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        if (data instanceof Array) {
            this.data = data;
        }
        else {
            this.data = data ? data.returnValue : [];
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        function (dataArr, val) {
            return eachData(dataArr, val, _this.idField);
            /**
             * @param {?} paramData
             * @param {?} paramVal
             * @param {?} idField
             * @return {?}
             */
            function eachData(paramData, paramVal, idField) {
                /** @type {?} */
                var rtnData = '';
                paramData.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) {
                    if (d.data[idField] == paramVal) {
                        rtnData = d.data;
                        return true;
                    }
                    else if (d.children && d.children.length) {
                        rtnData = eachData(d.children, paramVal, idField);
                    }
                    else {
                        return false;
                    }
                }));
                return rtnData;
            }
        }));
        this.closeLoading();
    };
    /**
     * @param {?} resData
     * @param {?=} sortable
     * @return {?}
     */
    ComboService.prototype.loadLookUpDataTable = /**
     * @param {?} resData
     * @param {?=} sortable
     * @return {?}
     */
    function (resData, sortable) {
        var _this = this;
        if (sortable === void 0) { sortable = false; }
        this.closeLoading();
        if (typeof resData === 'object') {
            if (resData.returnValue) {
                resData = resData.returnValue;
            }
            if (!sortable && resData.columns) {
                this.columns = resData.columns;
            }
            if (resData.pageInfo) {
                this.pageInfo = resData.pageInfo;
                this.pageInfo.total = resData.total ? resData.total : 0;
            }
            if (resData.items) {
                this.data = resData.items;
            }
        }
        if (resData && resData.selectedItems) {
            this.selections = resData.selectedItems || [];
        }
        if (this.selections) {
            /** @type {?} */
            var ids = this.selections.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this.idField]; })).join(this.separator);
            if (ids !== this['__SELECTEDIDS__']) {
                // this.selectedValues = ids;
                this['__SELECTEDIDS__'] = ids;
            }
        }
        this.loadData(this.data, this['__SELECTEDIDS__'], (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        function (dataArr, val) {
            /** @type {?} */
            var isMaped = dataArr.find((/**
             * @param {?} d
             * @return {?}
             */
            function (d) { return d[_this.idField] + '' == val; }));
            if (_this.selections) {
                isMaped = !isMaped ? _this.selections.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) { return d[_this.idField] + '' == val; })) : isMaped;
            }
            return isMaped;
        }));
    };
    /**
     * @param {?} nodes
     * @param {?=} allData
     * @return {?}
     */
    ComboService.prototype.checkNodeCanBeSelect = /**
     * @param {?} nodes
     * @param {?=} allData
     * @return {?}
     */
    function (nodes, allData) {
        var _this = this;
        if (allData === void 0) { allData = true; }
        if (nodes && nodes.length) {
            return nodes.map((/**
             * @param {?} node
             * @return {?}
             */
            function (node) {
                if (node.hasOwnProperty('addtional')) {
                    node.selectable = !node['addtional'];
                }
                if (node.children && node.children.length) {
                    _this.checkNodeCanBeSelect(node.children, allData);
                }
                else {
                    if (allData) {
                        node.leaf = true;
                    }
                }
                return node;
            }));
        }
        return nodes;
    };
    /**
     * @param {?} resData
     * @return {?}
     */
    ComboService.prototype.loadLookUpDataTree = /**
     * @param {?} resData
     * @return {?}
     */
    function (resData) {
        var _this = this;
        this.closeLoading();
        if (!resData) {
            return;
        }
        if (resData instanceof Array) {
            this.data = resData;
            if (resData['selectedItems']) {
                this.selections = resData['selectedItems'] || [];
            }
        }
        else {
            if (resData.returnValue) {
                resData = resData.returnValue;
            }
            this.columns = resData.columns;
            this.treeInfo = resData.treeInfo;
            this.treeInfo$.next(this.treeInfo);
            if (resData.selectedItems) {
                this.selections = resData.selectedItems || [];
            }
            if (this.treeInfo && !this.treeInfo['treeDataIsInit']) {
                if (this.treeInfo.layerType.toLowerCase() === 'pathcode') {
                    this.data = this.lookupUtils.makeTree(resData.items, this.treeInfo);
                }
                else {
                    this.data = this.lookupUtils.makeTreeWithParentID(resData.items, '', this.treeInfo.dataField + "." + this.treeInfo.parentField, this.idField);
                }
            }
            else if (resData.items) {
                // this.data = resData.items;
                /** @type {?} */
                var isLoadAllTreeData = (/**
                 * @return {?}
                 */
                function () {
                    if (_this.treeloadconfig.loadTreeDataType === 'default') {
                        return _this.treeInfo.loadDataType === 'all';
                    }
                    else {
                        return _this.treeloadconfig.loadTreeDataType === 'loadall';
                    }
                });
                this.data = this.checkNodeCanBeSelect(resData.items, isLoadAllTreeData());
            }
        }
        if (this.selections) {
            /** @type {?} */
            var ids = this.selections.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this.idField]; })).join(this.separator);
            if (ids !== this['__SELECTEDIDS__']) {
                this['__SELECTEDIDS__'] = ids;
            }
        }
        this.loadData(this.data, this['__SELECTEDIDS__'], (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        function (dataArr, val) {
            return _this.treeNodeToFlatData(dataArr, val, _this.idField);
        }));
    };
    /**
     * @param {?} paramData
     * @param {?} paramVal
     * @param {?} idField
     * @return {?}
     */
    ComboService.prototype.treeNodeToFlatData = /**
     * @param {?} paramData
     * @param {?} paramVal
     * @param {?} idField
     * @return {?}
     */
    function (paramData, paramVal, idField) {
        var _this = this;
        /** @type {?} */
        var rtnData = '';
        paramData.find((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            if ((d.data && d.data[idField] == paramVal) || d[idField] == paramVal) {
                rtnData = d.data;
                return true;
            }
            else if (d.children && d.children.length) {
                rtnData = _this.treeNodeToFlatData(d.children, paramVal, idField);
                return rtnData ? true : false;
            }
            else {
                return false;
            }
        }));
        return rtnData;
    };
    /**
     * @private
     * @return {?}
     */
    ComboService.prototype.showLoading = /**
     * @private
     * @return {?}
     */
    function () {
        this.loading = this.loadingService.show({ container: this.panelElement, delay: 100 });
    };
    /**
     * @return {?}
     */
    ComboService.prototype.closeLoading = /**
     * @return {?}
     */
    function () {
        if (this.loading) {
            this.loading.close();
            this.loading = null;
        }
    };
    ComboService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ComboService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: LoadingService },
        { type: Injector }
    ]; };
    return ComboService;
}());
export { ComboService };
if (false) {
    /** @type {?} */
    ComboService.prototype.selections$;
    /** @type {?} */
    ComboService.prototype.isOpen$;
    /** @type {?} */
    ComboService.prototype.data$;
    /** @type {?} */
    ComboService.prototype.serachValue$;
    /** @type {?} */
    ComboService.prototype.loadSuccess$;
    /** @type {?} */
    ComboService.prototype.treeInfo$;
    /** @type {?} */
    ComboService.prototype.selections;
    /** @type {?} */
    ComboService.prototype.idField;
    /** @type {?} */
    ComboService.prototype.valueField;
    /** @type {?} */
    ComboService.prototype.textField;
    /** @type {?} */
    ComboService.prototype.multiSelect;
    /** @type {?} */
    ComboService.prototype.displayType;
    /** @type {?} */
    ComboService.prototype.separator;
    /** @type {?} */
    ComboService.prototype._uri;
    /** @type {?} */
    ComboService.prototype.selectedValues;
    /** @type {?} */
    ComboService.prototype.pageInfo;
    /** @type {?} */
    ComboService.prototype.treeInfo;
    /** @type {?} */
    ComboService.prototype.columns;
    /** @type {?} */
    ComboService.prototype.context;
    /** @type {?} */
    ComboService.prototype.remoteSearch;
    /** @type {?} */
    ComboService.prototype.panelElement;
    /** @type {?} */
    ComboService.prototype.treeSearchHandler;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.treeloadconfig;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype._data;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.lookupUtils;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.comboHttp;
    /** @type {?} */
    ComboService.prototype.http;
    /** @type {?} */
    ComboService.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktY29tYm8tbGlzdC8iLCJzb3VyY2VzIjpbImxpYi9jb21iby5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxjQUFjLEVBQW9CLE1BQU0sb0JBQW9CLENBQUM7QUFDdEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsb0JBQW9CLEVBQW9CLE1BQU0seUJBQXlCLENBQUM7QUFHakY7SUF5REksc0JBQW1CLElBQWdCLEVBQVMsY0FBOEIsRUFBVSxRQUFrQjtRQUF0RyxpQkFRQztRQVJrQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXREdEcsZ0JBQVcsR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO1FBQ2pDLFlBQU8sR0FBRyxJQUFJLGVBQWUsQ0FBYyxLQUFLLENBQUMsQ0FBQztRQUVsRCxVQUFLLEdBQUcsSUFBSSxlQUFlLENBQU0sRUFBRSxDQUFDLENBQUM7UUFDckMsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUM3QixjQUFTLEdBQUcsSUFBSSxlQUFl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Qzs7Ozs7SUFDakMsaUNBQW9DOztJQVl4Qiw0QkFBdUI7O0lBQUUsc0NBQXFDOzs7OztJQUFFLGdDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgU3ViamVjdCwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBtYXAsIHN3aXRjaE1hcCwgY2F0Y2hFcnJvciwgdGFwLCBkZWxheSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgTG9hZGluZ1NlcnZpY2UsIExvYWRpbmdDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWxvYWRpbmcnO1xyXG5pbXBvcnQgeyBMb29rdXBVdGlscywgU2VydmVyU2lkZVRva2VuIH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBDb21ib1NlcnZlclNpZGVUb2tlbiwgQ29tYm9IdHRwU2VydmljZSB9IGZyb20gJy4vaHR0cC9Db21ib0h0dHBTZXJ2aWNlJztcclxuaW1wb3J0IHsgTm9ybWFsT2JqZWN0IH0gZnJvbSAnLi9jb21iby5pbnRlcmZhY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQ29tYm9TZXJ2aWNlIHtcclxuXHJcbiAgICBzZWxlY3Rpb25zJCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIGlzT3BlbiQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW58YW55PihmYWxzZSk7XHJcblxyXG4gICAgZGF0YSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4oJycpO1xyXG4gICAgc2VyYWNoVmFsdWUkID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgbG9hZFN1Y2Nlc3MkID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHRyZWVJbmZvJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55PihudWxsKTtcclxuXHJcbiAgICBzZWxlY3Rpb25zOiBOb3JtYWxPYmplY3RbXTtcclxuICAgIGlkRmllbGQ6IHN0cmluZztcclxuICAgIHZhbHVlRmllbGQ6IHN0cmluZztcclxuICAgIHRleHRGaWVsZDogc3RyaW5nO1xyXG4gICAgbXVsdGlTZWxlY3Q6IGJvb2xlYW47XHJcbiAgICBkaXNwbGF5VHlwZSA9ICdMSVNUJztcclxuICAgIHNlcGFyYXRvciA9ICcsJztcclxuXHJcblxyXG4gICAgX3VyaTogc3RyaW5nO1xyXG4gICAgZ2V0IHVyaSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdXJpO1xyXG4gICAgfVxyXG4gICAgc2V0IHVyaSh2YWw6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuX3VyaSA9IHZhbDtcclxuICAgICAgICB0aGlzLmRhdGEkLm5leHQoW10pO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdGVkVmFsdWVzO1xyXG4gICAgcGFnZUluZm86IGFueTtcclxuICAgIHRyZWVJbmZvOiBhbnk7XHJcbiAgICBjb2x1bW5zOiBOb3JtYWxPYmplY3RbXSA9IFtdO1xyXG4gICAgY29udGV4dDogYW55O1xyXG4gICAgcmVtb3RlU2VhcmNoID0gdHJ1ZTtcclxuXHJcbiAgICBwYW5lbEVsZW1lbnQ6IGFueSA9IG51bGw7XHJcblxyXG4gICAgdHJlZVNlYXJjaEhhbmRsZXI6IGFueSA9IG51bGw7XHJcblxyXG4gICAgLy8g5qCR5biu5Yqp5Yqg6L296K6+572uXHJcbiAgICBwcml2YXRlIHRyZWVsb2FkY29uZmlnID0gbnVsbDtcclxuICAgIHByaXZhdGUgX2RhdGE6IE5vcm1hbE9iamVjdFtdID0gW107XHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGxvb2t1cFV0aWxzOiBMb29rdXBVdGlscztcclxuICAgIHByaXZhdGUgY29tYm9IdHRwOiBDb21ib0h0dHBTZXJ2aWNlO1xyXG4gICAgZ2V0IGRhdGEoKTogTm9ybWFsT2JqZWN0W10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xyXG4gICAgfVxyXG4gICAgc2V0IGRhdGEodmFsdWU6IE5vcm1hbE9iamVjdFtdKSB7XHJcbiAgICAgICAgdGhpcy5fZGF0YSA9IHZhbHVlIHx8IFtdO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEkLm5leHQodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIGh0dHA6IEh0dHBDbGllbnQsIHB1YmxpYyBsb2FkaW5nU2VydmljZTogTG9hZGluZ1NlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5zZXJhY2hWYWx1ZSQucGlwZShkZWJvdW5jZVRpbWUoMzAwKSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlbW90ZVNlYXJjaCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJEYXRhKHZhbHVlLCB0aGlzLnRleHRGaWVsZCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckRhdGFPblNlcnZlcih2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpbmplY3RTZXJ2aWNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmluamVjdG9yICYmICF0aGlzLmNvbWJvSHR0cCkge1xyXG4gICAgICAgICAgICB0aGlzLmxvb2t1cFV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoTG9va3VwVXRpbHMsIG51bGwpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZS5pbmRleE9mKCdMT09LVVAnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbWJvSHR0cCA9IHRoaXMuaW5qZWN0b3IuZ2V0KFNlcnZlclNpZGVUb2tlbiwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbWJvSHR0cCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENvbWJvU2VydmVyU2lkZVRva2VuLCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b0Jvb2xlYW4odmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIGAke3ZhbHVlfWAgIT09ICdmYWxzZSc7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0SXRlbShkYXRhOiBhbnksIGluZGV4PzogbnVtYmVyLCBlbWl0RXZlbnQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgICAgICBkYXRhLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25zLmZpbmRJbmRleChzID0+IHNbdGhpcy5pZEZpZWxkXSA9PT0gblt0aGlzLmlkRmllbGRdKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgocyA9PiBzW3RoaXMuaWRGaWVsZF0gPT09IGRhdGFbdGhpcy5pZEZpZWxkXSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW1pdEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyQubmV4dCh7YWN0aW9uOiAnY2xpY2tlZCd9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RJdGVtKGRhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IHRoaXMuc2VsZWN0aW9ucy5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIC8vIHJldHVybiBpdGVtW3RoaXMuaWRGaWVsZF0gIT09IGRhdGFbdGhpcy5pZEZpZWxkXTtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGl0ZW0pICE9PSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHNlbGVjdEFsbChkYXRhcykge1xyXG4gICAgICAgIChkYXRhcyB8fCBbXSkuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbnMuZmluZChpID0+IGlbdGhpcy5pZEZpZWxkXSA9PT0gblt0aGlzLmlkRmllbGRdKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2gobik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyB0aGlzLnNlbGVjdGlvbnMgPSBkYXRhcztcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdW5TZWxlY3RBbGwoZGF0YXMpIHtcclxuICAgICAgICAvLyB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICBkYXRhcyA9IGRhdGFzIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9ICh0aGlzLnNlbGVjdGlvbnMgfHwgW10pLmZpbHRlcihuID0+IGRhdGFzLmZpbmRJbmRleChpID0+IGlbdGhpcy5pZEZpZWxkXSA9PT0gblt0aGlzLmlkRmllbGRdKSA9PT0gLTEgKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTZWxlY3QoaWQ6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMgJiYgdGhpcy5zZWxlY3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zLmZpbmQoaXRlbSA9PiBpdGVtW3RoaXMuaWRGaWVsZF0gPT09IGlkKSAhPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZERhdGEoZGF0YTogYW55LCBzZWxlY3RWYWx1ZXMgPSAnJywgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlbGVjdFZhbHVlcyA9PT0gbnVsbCB8fCBzZWxlY3RWYWx1ZXMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0VmFsdWVzID0gJyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0VmFsdWVzID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdFZhbHVlcyA9ICcnICsgc2VsZWN0VmFsdWVzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzLmRhdGEkLm5leHQoZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZXMpIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWxzID0gWyhzZWxlY3RWYWx1ZXMgKyAnJyldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxzID0gKHNlbGVjdFZhbHVlcyArICcnKS5zcGxpdCh0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSB2YWxzLm1hcCh2YWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhkYXRhLCB2YWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW1zID0gc2VsZWN0ZWRJdGVtcy5maWx0ZXIoZWwgPT4gZWwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCghdGhpcy5zZWxlY3Rpb25zIHx8ICF0aGlzLnNlbGVjdGlvbnMubGVuZ3RoKSAmJiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IHNlbGVjdGVkSXRlbXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2luaXREYXRhJ30pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmaWx0ZXJEYXRhT25TZXJ2ZXIocGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5nZXREYXRhKHBhcmFtcykuc3Vic2NyaWJlKHIgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XHJcbiAgICAgICAgICAgIGlmIChyICYmIHIuaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5kaXNwbGF5VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xPT0tVUExJU1QnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZExvb2tVcERhdGFUYWJsZShyLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xPT0tVUFRSRUVMSVNUJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRMb29rVXBEYXRhVHJlZShyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSQubmV4dChbXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlrqLmiLfnq6/ov4fmu6RcclxuICAgIGZpbHRlckRhdGEodmFsOiBzdHJpbmcsIGZpZWxkOiBhbnkgPSAndGV4dCcpIHtcclxuICAgICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZSA9PT0gJ0xPT0tVUExJU1QnIHx8IHRoaXMuZGlzcGxheVR5cGUgPT09ICdMSVNUJykge1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IHRoaXMuZGF0YS5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW12YWwgPSB0aGlzLmdldFZhbHVlQnlPYmooZmllbGQsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtdmFsICE9ICcnICYmIGl0ZW12YWwgIT09IG51bGwgJiYgaXRlbXZhbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW12YWwgPSBTdHJpbmcoaXRlbXZhbCkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW12YWwuaW5kZXhPZih2YWwudG9Mb3dlckNhc2UoKSkgPiAtMTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBjb25zdCBkYXRhID0gdGhpcy5kYXRhXHJcbiAgICAgICAgICAgIC8vICAgICA/IHRoaXMuZGF0YS5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgaWYgKHRoaXMuZ2V0VmFsdWVCeU9iaihmaWxlZCwgaXRlbSkpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh0aGlzLmdldFZhbHVlQnlPYmooZmlsZWQsIGl0ZW0pKS5pbmRleE9mKHZhbCkgPiAtMTtcclxuICAgICAgICAgICAgLy8gICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0YSAmJiB0aGlzLmdldFZhbHVlQnlPYmooZmlsZWQsIGl0ZW0uZGF0YSkpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh0aGlzLmdldFZhbHVlQnlPYmooZmlsZWQsIGl0ZW0uZGF0YSkpLmluZGV4T2YodmFsKSA+IC0xO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gICAgIH0pXHJcbiAgICAgICAgICAgIC8vICAgICA6IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEkLm5leHQoZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhJC5uZXh0KHRoaXMuZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRTZWxlY3Rpb25zKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJTZWxlY3Rpb25zKCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZhbHVlKHByb3A6IHN0cmluZywgc2VsZWN0aW9ucz86IGFueSk6IHN0cmluZyB7XHJcbiAgICAgICAgc2VsZWN0aW9ucyA9IHNlbGVjdGlvbnMgPyBzZWxlY3Rpb25zIDogdGhpcy5zZWxlY3Rpb25zO1xyXG4gICAgICAgIGlmIChzZWxlY3Rpb25zICYmIHNlbGVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRtcCA9IHNlbGVjdGlvbnMubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWVCeU9iaihwcm9wLCBpdGVtKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmICh0bXAgJiYgKHRtcC5sZW5ndGggPiAxIHx8IHRtcC5sZW5ndGggPT09IDApKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG1wLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRtcFswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VmFsdWVCeU9iaihmaWVsZDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcmVzdWx0VmFsID0gJyc7XHJcbiAgICAgICAgaWYgKGZpZWxkLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoZmllbGQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRWYWwgPSBkYXRhW2ZpZWxkXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGAlY0Vycm9yOiBUaGUgJWNcIiR7ZmllbGR9XCIlYyBpcyBub3QgaW4gYCxcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgJ2NvbG9yOiAjYmIwMDAwO2ZvbnQtd2VpZ2h0OiBib2xkOycsICdjb2xvcjogcmVkO2ZvbnQtc3R5bGU6IGl0YWxpYycsICdjb2xvcjogI2JiMDAwMDtmb250LXdlaWdodDogYm9sZDsnLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFZhbCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHRWYWwgPSBmaWVsZC5zcGxpdCgnLicpLnJlZHVjZSgob2JqLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqW2tleV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGAlY0Vycm9yOiBUaGUgJWNcIiR7a2V5fVwiJWMgaXMgbm90IGluICBgLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vICdjb2xvcjogI2JiMDAwMDtmb250LXdlaWdodDogYm9sZCcsICdjb2xvcjogcmVkO2ZvbnQtc3R5bGU6IGl0YWxpYycsICdjb2xvcjogI2JiMDAwMDtmb250LXdlaWdodDogYm9sZDsnLCBvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFZhbDtcclxuICAgIH1cclxuXHJcbiAgICBpbml0RGF0YShwYXJhbXM6IGFueSA9IHt9LCBtZXRob2QgPSAnZ2V0Jywgc2VsZWN0ZWRJZHMgPSAnJykge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5kaXNwbGF5VHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdUcmVlTGlzdCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ0xJU1QnOiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMuZGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RGF0YShwYXJhbXMsIG1ldGhvZCkuc3Vic2NyaWJlKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBfX2RhdGEgPSBkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy51cmkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX19kYXRhID0gdGhpcy5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXNwbGF5VHlwZSA9PT0gJ1RyZWVMaXN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhVHJlZShfX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGFUYWJsZShfX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTdWNjZXNzJC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICdMT09LVVBMSVNUJzpcclxuICAgICAgICAgICAgY2FzZSAnTE9PS1VQVFJFRUxJU1QnOiB7XHJcbiAgICAgICAgICAgICAgICAvLyBURlMgNDY2MTA0XHJcbiAgICAgICAgICAgICAgICBpZiAoIXNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9ICcnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9va3VwRGF0YShwYXJhbXMsIHNlbGVjdGVkSWRzLCAnZ2V0JywgdGhpcy5kaXNwbGF5VHlwZSA9PT0gJ0xPT0tVUFRSRUVMSVNUJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZFN1Y2Nlc3MkO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOatpOaWueazleeUqOS6juetm+mAiemAieS4reeahOaVsOaNrlxyXG4gICAgLy8g6L+b5LiA5q2l5LyY5YyW77ya6ZyA6KaB5pyN5Yqh5Zmo56uv5o+Q5L6b5LiA5Liq5LiN5p6E6YCg5qCR57uT5p6E44CB5qC55o2uSUTov5Tlm57nroDljZXnmoTliJfooajljbPlj69cclxuICAgIHByaXZhdGUgdHJlZU5vZGVzVG9GbGF0RGF0YSh0cmVlTm9kZXM6IFtdLCBhcnIgPSBbXSkge1xyXG4gICAgICAgIHRyZWVOb2Rlcy5mb3JFYWNoKChuOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFuWydhZGR0aW9uYWwnXSkge1xyXG4gICAgICAgICAgICAgICAgYXJyLnB1c2gobi5kYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobi5jaGlsZHJlbiAmJiBuLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlTm9kZXNUb0ZsYXREYXRhKG4uY2hpbGRyZW4sIGFycik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWRMb29rdXBEYXRhKHBhcmFtczogYW55LCBzZWxlY3RlZElkcywgbWV0aG9kID0gJ2dldCcsIGlzVHJlZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlbmFibGVGdWxsVHJlZSwgbG9hZFRyZWVEYXRhVHlwZSwgc2VhcmNoVmFsdWUgfSA9IHBhcmFtcztcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICBwYXJhbXMgPSB7IGN1c3RvbURhdGE6IGRhdGEgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdMT09LVVBUUkVFTElTVCcgJiYgIXRoaXNbJ3RyZWVUb0xpc3QnXSkge1xyXG4gICAgICAgICAgICBwYXJhbXMuZW5hYmxlRnVsbFRyZWUgPSBlbmFibGVGdWxsVHJlZTtcclxuICAgICAgICAgICAgLy8gcGFyYW1zLmxvYWRUcmVlRGF0YVR5cGUgPSAnbG9hZGFsbCc7IFxyXG4gICAgICAgICAgICBwYXJhbXMuc2VhcmNoVmFsdWUgPSB7XCJjYXRlZ29yeVwiOlwiYWxsXCJ9O1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVsb2FkY29uZmlnID0geyBlbmFibGVGdWxsVHJlZSwgbG9hZFRyZWVEYXRhVHlwZSB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKCFpc05hTihOdW1iZXIocGFyYW1zLmV4cGFuZExldmVsKSkpIHtcclxuICAgICAgICAgICAgICAgIC8vIOWJjeerryAtMSDkuI3lsZXlvIAgICAwIOWFqOWxleW8gFxyXG4gICAgICAgICAgICAgICAgLy8g5ZCO56uvICAwIOS4jeWxleW8gCAgLTEg5YWo5bGV5byAXHJcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLmV4cGFuZExldmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5leHBhbmRMZXZlbCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4cGFuZExldmVsID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leHBhbmRMZXZlbCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcGFyYW1zLnNlYXJjaFZhbHVlWydsYXllck51bSddID0gcGFyYW1zLmV4cGFuZExldmVsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwYXJhbXMuc2VhcmNoVmFsdWUgPSBKU09OLnN0cmluZ2lmeShwYXJhbXMuc2VhcmNoVmFsdWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHNlYXJjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHBhcmFtcy5zZWFyY2hWYWx1ZSA9IHNlYXJjaFZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXNbJ3RyZWVUb0xpc3QnXSkge1xyXG4gICAgICAgICAgICBpc1RyZWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9ICdMT09LVVBMSVNUJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0RGF0YShwYXJhbXMsIG1ldGhvZCkucGlwZShcclxuICAgICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTZWxlY3RlZEl0ZW1zKHNlbGVjdGVkSWRzKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXAoZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGF0YS5zZWxlY3RlZEl0ZW1zID0gaXNUcmVlID8gIGQuaXRlbXMubWFwKG4gPT4gbi5kYXRhKSA6IGQuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVHJlZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnIgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlTm9kZXNUb0ZsYXREYXRhKGQuaXRlbXMsIGFycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc2VsZWN0ZWRJdGVtcyA9IGFycjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNlbGVjdGVkSXRlbXMgPSAgZC5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc2VsZWN0ZWRJdGVtcyA9IChzZWxlY3RlZElkcyArICcnKS5zcGxpdCh0aGlzLnNlcGFyYXRvcikubWFwKHZhbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcmVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJlZU5vZGVUb0ZsYXREYXRhKGQsIHZhbCwgdGhpcy5pZEZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuZmluZChuID0+IG5bdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCB8fCBuW3RoaXMudGV4dEZpZWxkXSA9PSB2YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5maWx0ZXIobiA9PiBuICE9dW5kZWZpbmVkICYmIG4gIT0gbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBvZihkYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5jbGVhckFsbCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1RyZWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRMb29rVXBEYXRhVHJlZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9va1VwRGF0YVRhYmxlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmxvYWRTdWNjZXNzJC5uZXh0KHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBnZXRTZWxlY3RlZEl0ZW1zKHNlbElkcykge1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaFBhcmFtID0ge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogJ2ZhdicsIGZhdm9yaXRlSWRzOiAoJycgKyBzZWxJZHMpLnNwbGl0KHRoaXMuc2VwYXJhdG9yKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgcCA9IHtzZWFyY2hWYWx1ZTogSlNPTi5zdHJpbmdpZnkoc2VhcmNoUGFyYW0pLCAgZW5hYmxlRnVsbFRyZWU6IGZhbHNlLCBsb2FkVHJlZURhdGFUeXBlOiAnZGVmYXVsdCd9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldERhdGEocCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0YShwYXJhbXMgPSB7fSwgbWV0aG9kID0gJ2dldCcsIGxvYWRDaGlsZCA9IGZhbHNlKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBpZiAodGhpcy51cmkpIHtcclxuICAgICAgICAgICAgLy8gdGhpcy5kYXRhID0gW11cclxuICAgICAgICAgICAgLy8gdGZzIDQ3MDUxOVxyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhICYmIHRoaXMuZGF0YS5sZW5ndGggJiYgIWxvYWRDaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gW107XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHBhcmFtc1sndHJlZVRvTGlzdCddID0gdGhpc1sndHJlZVRvTGlzdCddO1xyXG4gICAgICAgICAgICBwYXJhbXNbJ25hdlRyZWVUb0xpc3QnXSA9IHRoaXNbJ25hdlRyZWVUb0xpc3QnXTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzWyd0cmVlVG9MaXN0J10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVR5cGUgPSAnTE9PS1VQTElTVCc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29tYm9IdHRwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21ib0h0dHAuY29udGV4dCA9IHRoaXMuY29udGV4dDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbWJvSHR0cC5nZXREYXRhKHRoaXMudXJpLCBwYXJhbXMsIG1ldGhvZCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChtZXRob2QsIHRoaXMudXJpLCBwYXJhbXMpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YodGhpcy5kYXRhKS5waXBlKGRlbGF5KDEwKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YoW10pLnBpcGUoZGVsYXkoMTApKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBsb2FkRGF0YVRhYmxlKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhID8gZGF0YS5yZXR1cm5WYWx1ZSA6IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvYWREYXRhKHRoaXMuZGF0YSwgdGhpcy5zZWxlY3RlZFZhbHVlcywgKGRhdGFBcnIsIHZhbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YUFyci5maW5kKGQgPT4gZFt0aGlzLmlkRmllbGRdICsgJycgPT0gdmFsIHx8IGRbdGhpcy50ZXh0RmllbGRdID09IHZhbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkRGF0YVRyZWUoZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGEgPyBkYXRhLnJldHVyblZhbHVlIDogW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubG9hZERhdGEodGhpcy5kYXRhLCB0aGlzLnNlbGVjdGVkVmFsdWVzLCAoZGF0YUFyciwgdmFsKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBlYWNoRGF0YShkYXRhQXJyLCB2YWwsIHRoaXMuaWRGaWVsZCk7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGVhY2hEYXRhKHBhcmFtRGF0YSwgcGFyYW1WYWwsIGlkRmllbGQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBydG5EYXRhOiBhbnkgPSAnJztcclxuICAgICAgICAgICAgICAgIHBhcmFtRGF0YS5maW5kKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkLmRhdGFbaWRGaWVsZF0gPT0gcGFyYW1WYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnRuRGF0YSA9IGQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkLmNoaWxkcmVuICYmIGQuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0bkRhdGEgPSBlYWNoRGF0YShkLmNoaWxkcmVuLCBwYXJhbVZhbCwgaWRGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ0bkRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWRMb29rVXBEYXRhVGFibGUocmVzRGF0YTogYW55LCBzb3J0YWJsZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiByZXNEYXRhID09PSAnb2JqZWN0Jykge1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlc0RhdGEucmV0dXJuVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJlc0RhdGEgPSByZXNEYXRhLnJldHVyblZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXNvcnRhYmxlICYmICByZXNEYXRhLmNvbHVtbnMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29sdW1ucyA9IHJlc0RhdGEuY29sdW1ucztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVzRGF0YS5wYWdlSW5mbykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSW5mbyA9IHJlc0RhdGEucGFnZUluZm87XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhZ2VJbmZvLnRvdGFsID0gcmVzRGF0YS50b3RhbCA/IHJlc0RhdGEudG90YWwgOiAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIHJlc0RhdGEuaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHJlc0RhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNEYXRhICYmIHJlc0RhdGEuc2VsZWN0ZWRJdGVtcykge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSByZXNEYXRhLnNlbGVjdGVkSXRlbXMgfHwgW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgaWRzID0gdGhpcy5zZWxlY3Rpb25zLm1hcChuID0+IG5bdGhpcy5pZEZpZWxkXSkuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIGlmIChpZHMgIT09IHRoaXNbJ19fU0VMRUNURURJRFNfXyddKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnNlbGVjdGVkVmFsdWVzID0gaWRzO1xyXG4gICAgICAgICAgICAgICAgdGhpc1snX19TRUxFQ1RFRElEU19fJ10gPSBpZHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubG9hZERhdGEodGhpcy5kYXRhLCB0aGlzWydfX1NFTEVDVEVESURTX18nXSwgKGRhdGFBcnIsIHZhbCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgaXNNYXBlZCA9IGRhdGFBcnIuZmluZChkID0+IGRbdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGlzTWFwZWQgPSAhaXNNYXBlZCA/IHRoaXMuc2VsZWN0aW9ucy5maW5kKGQgPT4gZFt0aGlzLmlkRmllbGRdICsgJycgPT0gdmFsKSA6IGlzTWFwZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGlzTWFwZWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tOb2RlQ2FuQmVTZWxlY3Qobm9kZXMsIGFsbERhdGEgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKG5vZGVzICYmIG5vZGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbm9kZXMubWFwKChub2RlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlLmhhc093blByb3BlcnR5KCdhZGR0aW9uYWwnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc2VsZWN0YWJsZSA9ICFub2RlWydhZGR0aW9uYWwnXTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tOb2RlQ2FuQmVTZWxlY3Qobm9kZS5jaGlsZHJlbiwgYWxsRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbGxEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVhZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vZGVzO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWRMb29rVXBEYXRhVHJlZShyZXNEYXRhOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG5cclxuICAgICAgICBpZiAoIXJlc0RhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHJlc0RhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSByZXNEYXRhO1xyXG4gICAgICAgICAgICBpZiAocmVzRGF0YVsnc2VsZWN0ZWRJdGVtcyddKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSByZXNEYXRhWydzZWxlY3RlZEl0ZW1zJ10gfHwgW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAocmVzRGF0YS5yZXR1cm5WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmVzRGF0YSA9IHJlc0RhdGEucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jb2x1bW5zID0gcmVzRGF0YS5jb2x1bW5zO1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVJbmZvID0gcmVzRGF0YS50cmVlSW5mbztcclxuXHJcbiAgICAgICAgICAgIHRoaXMudHJlZUluZm8kLm5leHQodGhpcy50cmVlSW5mbyk7XHJcbiAgICAgICAgICAgIGlmIChyZXNEYXRhLnNlbGVjdGVkSXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IHJlc0RhdGEuc2VsZWN0ZWRJdGVtcyB8fCBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodGhpcy50cmVlSW5mbyAmJiAhdGhpcy50cmVlSW5mb1sndHJlZURhdGFJc0luaXQnXSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudHJlZUluZm8ubGF5ZXJUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdwYXRoY29kZScpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmxvb2t1cFV0aWxzLm1ha2VUcmVlKHJlc0RhdGEuaXRlbXMsIHRoaXMudHJlZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmxvb2t1cFV0aWxzLm1ha2VUcmVlV2l0aFBhcmVudElEKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNEYXRhLml0ZW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYCR7dGhpcy50cmVlSW5mby5kYXRhRmllbGR9LiR7dGhpcy50cmVlSW5mby5wYXJlbnRGaWVsZH1gLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkRmllbGRcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc0RhdGEuaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZGF0YSA9IHJlc0RhdGEuaXRlbXM7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgaXNMb2FkQWxsVHJlZURhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJlZWxvYWRjb25maWcubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2RlZmF1bHQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRyZWVJbmZvLmxvYWREYXRhVHlwZSA9PT0gJ2FsbCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJlZWxvYWRjb25maWcubG9hZFRyZWVEYXRhVHlwZSA9PT0gJ2xvYWRhbGwnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5jaGVja05vZGVDYW5CZVNlbGVjdChyZXNEYXRhLml0ZW1zLCBpc0xvYWRBbGxUcmVlRGF0YSgpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBpZHMgPSB0aGlzLnNlbGVjdGlvbnMubWFwKG4gPT4gblt0aGlzLmlkRmllbGRdKS5qb2luKHRoaXMuc2VwYXJhdG9yKTtcclxuICAgICAgICAgICAgaWYgKGlkcyAhPT0gdGhpc1snX19TRUxFQ1RFRElEU19fJ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXNbJ19fU0VMRUNURURJRFNfXyddID0gaWRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmxvYWREYXRhKHRoaXMuZGF0YSwgdGhpc1snX19TRUxFQ1RFRElEU19fJ10sIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJlZU5vZGVUb0ZsYXREYXRhKGRhdGFBcnIsIHZhbCwgdGhpcy5pZEZpZWxkKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0cmVlTm9kZVRvRmxhdERhdGEocGFyYW1EYXRhLCBwYXJhbVZhbCwgaWRGaWVsZCkge1xyXG4gICAgICAgIGxldCBydG5EYXRhOiBhbnkgPSAnJztcclxuICAgICAgICBwYXJhbURhdGEuZmluZChkID0+IHtcclxuICAgICAgICAgICAgaWYgKChkLmRhdGEgJiYgZC5kYXRhW2lkRmllbGRdID09IHBhcmFtVmFsKSB8fCBkW2lkRmllbGRdID09IHBhcmFtVmFsKSB7XHJcbiAgICAgICAgICAgICAgICBydG5EYXRhID0gZC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5jaGlsZHJlbiAmJiBkLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcnRuRGF0YSA9IHRoaXMudHJlZU5vZGVUb0ZsYXREYXRhKGQuY2hpbGRyZW4sIHBhcmFtVmFsLCBpZEZpZWxkKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5EYXRhID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJ0bkRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzaG93TG9hZGluZygpIHtcclxuICAgICAgICB0aGlzLmxvYWRpbmcgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coeyBjb250YWluZXI6IHRoaXMucGFuZWxFbGVtZW50LCBkZWxheTogMTAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlTG9hZGluZygpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2FkaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
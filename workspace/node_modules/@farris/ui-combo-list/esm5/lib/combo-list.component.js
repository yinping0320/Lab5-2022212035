/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, ChangeDetectorRef, Inject, Renderer2, forwardRef, ChangeDetectionStrategy, ViewEncapsulation, Input, Injector, ViewChild, HostBinding, HostListener } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DatalistComponent } from '@farris/ui-datalist';
import { BaseComboComponent } from './base-combo.component';
import { ComboService } from './combo.service';
/** @type {?} */
export var INPUT_COMBO_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return ComboListComponent; })),
    multi: true
};
var ComboListComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ComboListComponent, _super);
    function ComboListComponent(el, cdr, document, render, comboService, injector) {
        var _this = _super.call(this, el, cdr, document, render, comboService, injector) || this;
        _this.el = el;
        _this.cdr = cdr;
        _this.document = document;
        _this.render = render;
        _this.comboService = comboService;
        _this.injector = injector;
        /**
         * 数据中标识禁用的字段名称，默认为 disabled
         */
        _this.disabledField = 'disabled';
        /**
         * 列表中是否显示已禁用的项，默认 true
         */
        _this.showDisabledItem = true;
        /**
         * 显示面板方式： click | focus, 默认： click
         */
        _this.showPanelType = 'click';
        _this.cls = true;
        _this.filterData = [];
        return _this;
    }
    Object.defineProperty(ComboListComponent.prototype, "clsTag", {
        get: /**
         * @return {?}
         */
        function () {
            return this.viewType === 'tag';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ComboListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        if (this.multiSelect) {
            this.enableCancelSelected = this.multiSelect;
        }
        this.remoteSearch = false;
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ComboListComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /**
         * 如果直接绑定一个数组作为列表数据并且 data 是异步数据，需要此方法，同步displayText与selectedValues
         */
        if (changes.data && !changes.data.firstChange && !this.uri && !this.nosearch) {
            /** @type {?} */
            var datas = changes.data.currentValue;
            /** @type {?} */
            var val = this.ngControl ? this.ngControl.value || this.selectedValues : this.selectedValues;
            if (this.selectedValues === undefined || this.selectedValues === null) {
                val = this.displayText;
            }
            if (val !== undefined && val !== null && datas && datas.length > 0) {
                /** @type {?} */
                var textArr = this.filterSelections(val, this.data);
                this.displayText = textArr.filter((/**
                 * @param {?} v
                 * @return {?}
                 */
                function (v) { return !!v; })).join(this.separator);
                this.updateSelections(val, this.data);
                this.comboService.selections$.next({ action: 'initData' });
            }
            else {
                this.selections = [];
                this.displayText = '';
            }
        }
        // if (changes.multiSelect && !changes.multiSelect.isFirstChange()) {
        //     this.enableCancelSelected = this.multiSelect;
        // }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboListComponent.prototype.registerKeyboardEvent = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        if (this.multiSelect || (this.readonly || this.disabled)) {
            return;
        }
        if ($event.code === 'ArrowUp' || $event.code === 'ArrowDown' ||
            (!this.editable && !this.readonly && !this.disabled && $event.code === 'Space')) {
            $event.preventDefault();
            $event.stopPropagation();
        }
        /** @type {?} */
        var selectItem = (/**
         * @param {?} index
         * @return {?}
         */
        function (index) {
            _this.comboService.selectItem(data[index], index, false);
            /** @type {?} */
            var params = { data: data[index], index: index };
            if (_this.isOpen) {
                _this.scrollToCurrentItem(index);
            }
            _this.updateSelectValues(params);
        });
        /** @type {?} */
        var data = this.filterData && this.filterData.length ? this.filterData : this.data;
        if (!this['_cmbPanel']) {
            data = this.data;
        }
        /** @type {?} */
        var _data = [];
        if (this.disabledField) {
            _data = data.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return !_this.commonUtils.getValue(_this.disabledField, n); }));
        }
        /** @type {?} */
        var getrealIndex = (/**
         * @param {?} idx
         * @param {?} nextIdx
         * @param {?=} isNext
         * @return {?}
         */
        function (idx, nextIdx, isNext) {
            if (isNext === void 0) { isNext = true; }
            if (data[nextIdx]) {
                // 判断下一项是否禁用
                /** @type {?} */
                var isDisabled = _this.commonUtils.getValue(_this.disabledField, data[nextIdx]);
                if (isDisabled) {
                    /** @type {?} */
                    var _idx = _data.findIndex((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) { return _this.commonUtils.getValue(_this.idField, n) === _this.commonUtils.getValue(_this.idField, data[idx]); }));
                    if (isNext) {
                        nextIdx = _idx + 1;
                    }
                    else {
                        nextIdx = _idx - 1;
                    }
                    if (_data[nextIdx]) {
                        return data.findIndex((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return _this.commonUtils.getValue(_this.idField, n) === _this.commonUtils.getValue(_this.idField, _data[nextIdx]); }));
                    }
                    else {
                        /** @type {?} */
                        var newIdex_1 = nextIdx > 0 ? 0 : _data.length - 1;
                        return data.findIndex((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return _this.commonUtils.getValue(_this.idField, n) === _this.commonUtils.getValue(_this.idField, _data[newIdex_1]) && !_this.commonUtils.getValue(_this.disabledField, n); }));
                    }
                }
                return nextIdx;
            }
        });
        /** @type {?} */
        var idx = data.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        function (n) { return _this.commonUtils.getValue(_this.idField, n) == _this.selectedValues; }));
        if ($event.code === 'ArrowUp') { // up
            // up
            /** @type {?} */
            var prevIdx = idx - 1;
            if (prevIdx < 0) {
                prevIdx = data.length - 1;
            }
            if (this.disabledField) {
                prevIdx = getrealIndex(idx, prevIdx, false);
            }
            selectItem(prevIdx);
        }
        if ($event.code === 'ArrowDown' || ($event.code === 'Space' && !this.editable)) { // down
            // down
            /** @type {?} */
            var nextIdx = idx + 1;
            if (nextIdx >= data.length) {
                nextIdx = 0;
            }
            if (this.disabledField) {
                nextIdx = getrealIndex(idx, nextIdx);
            }
            selectItem(nextIdx);
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboListComponent.prototype.escHandlerEvent = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.isOpen) {
            this.hide(false);
        }
    };
    /**
     * @protected
     * @param {?} v
     * @return {?}
     */
    ComboListComponent.prototype.onSelectionsChange = /**
     * @protected
     * @param {?} v
     * @return {?}
     */
    function (v) {
        var _this = this;
        if (this.uri) {
            if (this.selections && this.selections.length) {
                this.selectedValues = this.selections.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n[_this.idField]; })).join(this.separator);
            }
        }
    };
    /**
     * @private
     * @param {?} item
     * @param {?=} emitEvent
     * @return {?}
     */
    ComboListComponent.prototype.updateSelectValues = /**
     * @private
     * @param {?} item
     * @param {?=} emitEvent
     * @return {?}
     */
    function (item, emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        var _a = tslib_1.__assign({}, item), data = _a.data, index = _a.index;
        this.comboService.selectItem(data, index);
        if (this.dataListRef) {
            this.selectedValues = this.dataListRef.selectedValues;
        }
        if (!this.multiSelect) {
            this.selectedValues = data[this.idField];
        }
        /** @type {?} */
        var _displayText = this.comboService.getValue(this.textField);
        if (emitEvent) {
            this.selectChange.emit({ data: data, index: index, instance: this, selections: this.selections });
            this.cdr.markForCheck();
            this.onValueChange({ text: _displayText, value: this.selectedValues, selections: this.selections });
        }
    };
    /**
     * @private
     * @param {?} index
     * @return {?}
     */
    ComboListComponent.prototype.scrollToCurrentItem = /**
     * @private
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (this.dataListRef && this.dataListRef.el) {
            /** @type {?} */
            var ulEl = this.dataListRef.el.nativeElement.querySelector('ul.list-group');
            if (ulEl && ulEl.children && ulEl.children[index]) {
                ulEl.children[index].scrollIntoView({ block: 'nearest' });
            }
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    ComboListComponent.prototype.onSelect = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.updateSelectValues(item, true);
        if (!this.multiSelect) {
            this.comboService.isOpen$.next(false);
        }
    };
    /**
     * @param {?} value
     * @return {?}
     */
    ComboListComponent.prototype.onUnSelected = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var data = tslib_1.__assign({}, value).data;
        this.comboService.unSelectItem(data);
        if (this.dataListRef) {
            this.selectedValues = this.dataListRef.selectedValues;
        }
        // if (!this.multiSelect) {
        //     this.selectedValues = data[this.idField];
        // }
        /** @type {?} */
        var _displayText = this.comboService.getValue(this.textField);
        this.cdr.markForCheck();
        this.onValueChange({ text: _displayText, value: this.selectedValues, selections: this.selections });
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ComboListComponent.prototype.onEnter = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.isOpen) {
            this.hide();
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboListComponent.prototype.onKeyup = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboListComponent.prototype.onKeydown = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if ($event.code === 'Tab') {
            this.hide(false);
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ComboListComponent.prototype.onFocus = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.showPanelType === 'focus') {
            this.show();
        }
    };
    /**
     * @param {?} $event
     * @param {?} item
     * @return {?}
     */
    ComboListComponent.prototype.removeSelectItem = /**
     * @param {?} $event
     * @param {?} item
     * @return {?}
     */
    function ($event, item) {
        if ($event) {
            $event.stopPropagation();
        }
        this.comboService.unSelectItem(item);
        this.selectedValues = this.comboService.getValue(this.idField);
        /** @type {?} */
        var _displayText = this.comboService.getValue(this.textField);
        this.cdr.detectChanges();
        this.onValueChange({ text: _displayText, value: this.selectedValues, selections: this.selections });
    };
    /**
     * @protected
     * @return {?}
     */
    ComboListComponent.prototype.initDatasChangeAction = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        this.comboService.data$.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.filterData = data;
            if (data && data.length && !_this.editable) {
                if (typeof _this.selectedValues === 'boolean') {
                    return;
                }
                if (_this.selectedValues) {
                    /** @type {?} */
                    var idx_1 = -1;
                    /** @type {?} */
                    var items = [];
                    if (typeof _this.selectedValues === 'number' || typeof _this.selectedValues === 'boolean') {
                        items = data.filter((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) {
                            return n[_this.idField] === _this.selectedValues || n[_this.textField] === _this.selectedValues;
                        }));
                    }
                    else {
                        items = _this.selectedValues.split(_this.separator).map((/**
                         * @param {?} val
                         * @return {?}
                         */
                        function (val) {
                            return data.find((/**
                             * @param {?} n
                             * @param {?} i
                             * @return {?}
                             */
                            function (n, i) {
                                return n[_this.idField] === val || n[_this.textField] === val;
                            }));
                        }));
                    }
                    if (!_this.selections || !_this.selections.length) {
                        if (items && items.length) {
                            _this.selectedValues = items.map((/**
                             * @param {?} i
                             * @return {?}
                             */
                            function (i) {
                                return _this.commonUtils.getValue(_this.idField, i);
                            })).join(_this.separator);
                            _this.selections = items;
                        }
                    }
                    idx_1 = data.findIndex((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        return _this.commonUtils.getValue(_this.idField, n) === _this.commonUtils.getValue(_this.idField, _this.selections[0]) ||
                            _this.commonUtils.getValue(_this.textField, n) === _this.commonUtils.getValue(_this.textField, _this.selections[0]);
                    }));
                    if (idx_1 > -1) {
                        setTimeout((/**
                         * @return {?}
                         */
                        function () {
                            _this.scrollToCurrentItem(idx_1);
                        }), 300);
                    }
                }
            }
        }));
    };
    ComboListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'farris-combo-list',
                    template: "<input-group *ngIf=\"!viewType || viewType === 'text'\"\r\n    #input\r\n    [attr.title]=\"enableTitle? displayText: ''\"\r\n    [class.actived]=\"isOpen\"\r\n    [(value)]=\"displayText\"\r\n    [disabled]=\"disabled\"\r\n    [readonly]=\"readonly\"\r\n    [forcePlaceholder]=\"forcePlaceholder\"\r\n    [editable]=\"editable\"\r\n    [groupText]=\"groupIcon\"\r\n    [placeholder]=\"placeholder\"\r\n    [enableClear] = \"enableClear\"\r\n    [maxLength]=\"maxLength\"\r\n    (clickHandle)=\"onClick($event)\"\r\n    (enterHandle)=\"onEnter($event)\"\r\n    (blurHandle)=\"onBlur($event)\"\r\n    (inputClick)=\"onInputclick($event)\"\r\n    (focusHandle)=\"onFocus($event)\"\r\n    (valueChange)=\"onTextChange($event)\"\r\n    (clear)=\"onClear()\"\r\n    (keyupHandle)=\"onKeyup($event)\"\r\n    (keydownHandle)=\"onKeydown($event)\"\r\n    style=\"display: block;\">\r\n</input-group>\r\n\r\n<div #input2 class=\"f-cmp-inputgroup\" *ngIf=\"viewType === 'tag'\" (click)=\"onClick($event)\" [attr.title]=\"displayText\">\r\n    <div class=\"input-group\" [class.f-state-disabled]=\"disabled\" [class.f-state-readonly]=\"readonly\">\r\n        <div class=\"form-control f-cmp-inputgroup--multi-wrapper multi-more\">\r\n            <div class=\"multi--content\">\r\n                <span class=\"multi--item\" *ngFor=\"let it of selections\" >\r\n                    {{it[textField]}}\r\n                    <i class=\"f-icon multi--close\" *ngIf=\"!readonly && !disabled \" (click)=\"removeSelectItem($event, it)\"></i>\r\n                </span>\r\n            </div>\r\n            <div class=\"multi--more\" *ngIf=\"selections && selections.length\">\r\n                <i class=\"f-icon multi--more-icon\"></i><span class=\"multi--more-text\">{{selections.length}}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"input-group-append\" >\r\n            <span class=\"input-group-text input-group-clear ng-star-inserted\" style=\"display: none;\">\r\n                <i class=\"f-icon modal_close\"></i>\r\n            </span>\r\n            <span class=\"input-group-text ng-star-inserted\" (click)=\"onClick($event)\">\r\n                <span class=\"f-icon f-icon-arrow-60-down\"></span>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div class=\"comboPanel f-area-hide\" *ngIf=\"isOpen\" style=\"z-index: 99999;transition: transform 0.12s ease;\"  #comboPanel>\r\n    <farris-datalist\r\n        #dl\r\n        [itemHeight]=\"itemHeight\"\r\n        [height]=\"panelHeight\"\r\n        [data]=\"comboService.data$ | async\"\r\n        [idField]=\"idField\"\r\n        [multiSelect]=\"multiSelect\"\r\n        [selectedValues]=\"selectedValuesStr\"\r\n        [valueField]=\"valueField\"\r\n        [textField]=\"textField\"\r\n        [enableCancelSelected]=\"enableCancelSelected\"\r\n        (selected)=\"onSelect($event)\"\r\n        (unSelected)=\"onUnSelected($event)\"\r\n        [separator]=\"separator\"\r\n        style=\"position: relative;\"\r\n        [emptyMessage]=\"emptyMsg\"\r\n        [disabledField]=\"disabledField\"\r\n        [showDisabledItem]=\"showDisabledItem\"\r\n    >\r\n        <ng-template list-item-tmp let-item=\"data.data\" let-idx=\"index\" *ngIf=\"itemTemplate\">\r\n            <ng-container *ngTemplateOutlet=\"itemTemplate; context: { $implicit: item, index: idx }\"> </ng-container>\r\n        </ng-template>\r\n    </farris-datalist>\r\n</div>\r\n",
                    // styleUrls: ['./combo-list.component.scss'],
                    encapsulation: ViewEncapsulation.None,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [INPUT_COMBO_VALUE_ACCESSOR, ComboService]
                }] }
    ];
    /** @nocollapse */
    ComboListComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
        { type: Renderer2 },
        { type: ComboService },
        { type: Injector }
    ]; };
    ComboListComponent.propDecorators = {
        itemTemplate: [{ type: Input }],
        disabledField: [{ type: Input }],
        showDisabledItem: [{ type: Input }],
        showPanelType: [{ type: Input }],
        dataListRef: [{ type: ViewChild, args: ['dl',] }],
        itemHeight: [{ type: Input }],
        cls: [{ type: HostBinding, args: ['class.f-combo-list',] }],
        clsTag: [{ type: HostBinding, args: ['class.f-combo-list--tag',] }],
        registerKeyboardEvent: [{ type: HostListener, args: ['keydown', ['$event'],] }],
        escHandlerEvent: [{ type: HostListener, args: ['keydown.esc', ['$event'],] }]
    };
    return ComboListComponent;
}(BaseComboComponent));
export { ComboListComponent };
if (false) {
    /** @type {?} */
    ComboListComponent.prototype.itemTemplate;
    /**
     * 数据中标识禁用的字段名称，默认为 disabled
     * @type {?}
     */
    ComboListComponent.prototype.disabledField;
    /**
     * 列表中是否显示已禁用的项，默认 true
     * @type {?}
     */
    ComboListComponent.prototype.showDisabledItem;
    /**
     * 显示面板方式： click | focus, 默认： click
     * @type {?}
     */
    ComboListComponent.prototype.showPanelType;
    /** @type {?} */
    ComboListComponent.prototype.dataListRef;
    /** @type {?} */
    ComboListComponent.prototype.itemHeight;
    /** @type {?} */
    ComboListComponent.prototype.cls;
    /**
     * @type {?}
     * @private
     */
    ComboListComponent.prototype.filterData;
    /** @type {?} */
    ComboListComponent.prototype.el;
    /** @type {?} */
    ComboListComponent.prototype.cdr;
    /** @type {?} */
    ComboListComponent.prototype.document;
    /** @type {?} */
    ComboListComponent.prototype.render;
    /** @type {?} */
    ComboListComponent.prototype.comboService;
    /** @type {?} */
    ComboListComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tbGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWNvbWJvLWxpc3QvIiwic291cmNlcyI6WyJsaWIvY29tYm8tbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSx1QkFBdUIsRUFDaEcsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBb0MsU0FBUyxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0ksT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7QUFJL0MsTUFBTSxLQUFPLDBCQUEwQixHQUFRO0lBQzNDLE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVU7OztJQUFDLGNBQU0sT0FBQSxrQkFBa0IsRUFBbEIsQ0FBa0IsRUFBQztJQUNqRCxLQUFLLEVBQUUsSUFBSTtDQUNkO0FBQ0Q7SUFRd0MsOENBQWtCO0lBcUJ0RCw0QkFDVyxFQUFjLEVBQ2QsR0FBc0IsRUFDSixRQUFhLEVBQy9CLE1BQWlCLEVBQ2pCLFlBQTBCLEVBQzFCLFFBQWtCO1FBTjdCLFlBUUksa0JBQU0sRUFBRSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxRQUFRLENBQUMsU0FDM0Q7UUFSVSxRQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsU0FBRyxH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O2lCQUN4RDs7OztnQkF2Qm1CLFVBQVU7Z0JBQUUsaUJBQWlCO2dEQWdEeEMsTUFBTSxTQUFDLFFBQVE7Z0JBaERtQyxTQUFTO2dCQU8zRCxZQUFZO2dCQU5jLFFBQVE7OzsrQkF3QnRDLEtBQUs7Z0NBR0wsS0FBSzttQ0FFTCxLQUFLO2dDQUtMLEtBQUs7OEJBQ0wsU0FBUyxTQUFDLElBQUk7NkJBQ2QsS0FBSztzQkFDTCxXQUFXLFNBQUMsb0JBQW9CO3lCQUNoQyxXQUFXLFNBQUMseUJBQXlCO3dDQXFEckMsWUFBWSxTQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQztrQ0F3RmxDLFlBQVksU0FBQyxhQUFhLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBeUozQyx5QkFBQztDQUFBLEFBN1RELENBUXdDLGtCQUFrQixHQXFUekQ7U0FyVFksa0JBQWtCOzs7SUFDM0IsMENBQTJCOzs7OztJQUczQiwyQ0FBb0M7Ozs7O0lBRXBDLDhDQUFpQzs7Ozs7SUFLakMsMkNBQWtEOztJQUNsRCx5Q0FBZ0Q7O0lBQ2hELHdDQUE0Qjs7SUFDNUIsaUNBQThDOzs7OztJQU05Qyx3Q0FBK0I7O0lBRTNCLGdDQUFxQjs7SUFDckIsaUNBQTZCOztJQUM3QixzQ0FBc0M7O0lBQ3RDLG9DQUF3Qjs7SUFDeEIsMENBQWlDOztJQUNqQyxzQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0LCBSZW5kZXJlcjIsIGZvcndhcmRSZWYsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gICAgICAgICBWaWV3RW5jYXBzdWxhdGlvbiwgSW5wdXQsIEluamVjdG9yLCBPbkluaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBIb3N0QmluZGluZywgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IERhdGFsaXN0Q29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhbGlzdCc7XHJcbmltcG9ydCB7IEJhc2VDb21ib0NvbXBvbmVudCB9IGZyb20gJy4vYmFzZS1jb21iby5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTZWxlY3RJdGVtIH0gZnJvbSAnLi9jb21iby5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBDb21ib1NlcnZpY2UgfSBmcm9tICcuL2NvbWJvLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBmaWx0ZXIsIHRha2UsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcblxyXG5leHBvcnQgY29uc3QgSU5QVVRfQ09NQk9fVkFMVUVfQUNDRVNTT1I6IGFueSA9IHtcclxuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQ29tYm9MaXN0Q29tcG9uZW50KSxcclxuICAgIG11bHRpOiB0cnVlXHJcbn07XHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtY29tYm8tbGlzdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29tYm8tbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAvLyBzdHlsZVVybHM6IFsnLi9jb21iby1saXN0LmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbiAgICBwcm92aWRlcnM6IFtJTlBVVF9DT01CT19WQUxVRV9BQ0NFU1NPUiwgQ29tYm9TZXJ2aWNlXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29tYm9MaXN0Q29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbWJvQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gICAgQElucHV0KCkgaXRlbVRlbXBsYXRlOiBhbnk7XHJcblxyXG4gICAgLyoqIOaVsOaNruS4reagh+ivhuemgeeUqOeahOWtl+auteWQjeensO+8jOm7mOiupOS4uiBkaXNhYmxlZCAqL1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWRGaWVsZCA9ICdkaXNhYmxlZCc7XHJcbiAgICAvKiog5YiX6KGo5Lit5piv5ZCm5pi+56S65bey56aB55So55qE6aG577yM6buY6K6kIHRydWUgKi9cclxuICAgIEBJbnB1dCgpIHNob3dEaXNhYmxlZEl0ZW0gPSB0cnVlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pi+56S66Z2i5p2/5pa55byP77yaIGNsaWNrIHwgZm9jdXMsIOm7mOiupO+8miBjbGlja1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBzaG93UGFuZWxUeXBlOiAnY2xpY2snfCdmb2N1cycgPSAnY2xpY2snO1xyXG4gICAgQFZpZXdDaGlsZCgnZGwnKSBkYXRhTGlzdFJlZjogRGF0YWxpc3RDb21wb25lbnQ7XHJcbiAgICBASW5wdXQoKSBpdGVtSGVpZ2h0OiBudW1iZXI7XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmYtY29tYm8tbGlzdCcpIGNscyA9IHRydWU7XHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmYtY29tYm8tbGlzdC0tdGFnJylcclxuICAgIGdldCBjbHNUYWcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1R5cGUgPT09ICd0YWcnO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZmlsdGVyRGF0YTogYW55W10gPSBbXTtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwdWJsaWMgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICBASW5qZWN0KERPQ1VNRU5UKSBwdWJsaWMgZG9jdW1lbnQ6IGFueSxcclxuICAgICAgICBwdWJsaWMgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHVibGljIGNvbWJvU2VydmljZTogQ29tYm9TZXJ2aWNlLFxyXG4gICAgICAgIHB1YmxpYyBpbmplY3RvcjogSW5qZWN0b3JcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKGVsLCBjZHIsIGRvY3VtZW50LCByZW5kZXIsIGNvbWJvU2VydmljZSwgaW5qZWN0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgc3VwZXIubmdPbkluaXQoKTtcclxuICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlQ2FuY2VsU2VsZWN0ZWQgPSB0aGlzLm11bHRpU2VsZWN0O1xyXG4gICAgICAgfVxyXG4gICAgICAgdGhpcy5yZW1vdGVTZWFyY2ggPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog5aaC5p6c55u05o6l57uR5a6a5LiA5Liq5pWw57uE5L2c5Li65YiX6KGo5pWw5o2u5bm25LiUIGRhdGEg5piv5byC5q2l5pWw5o2u77yM6ZyA6KaB5q2k5pa55rOV77yM5ZCM5q2lZGlzcGxheVRleHTkuI5zZWxlY3RlZFZhbHVlc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmRhdGEgJiYgIWNoYW5nZXMuZGF0YS5maXJzdENoYW5nZSAmJiAhdGhpcy51cmkgJiYgIXRoaXMubm9zZWFyY2gpIHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YXMgPSBjaGFuZ2VzLmRhdGEuY3VycmVudFZhbHVlO1xyXG4gICAgICAgICAgICBsZXQgdmFsID0gdGhpcy5uZ0NvbnRyb2wgPyB0aGlzLm5nQ29udHJvbC52YWx1ZSB8fCB0aGlzLnNlbGVjdGVkVmFsdWVzIDogdGhpcy5zZWxlY3RlZFZhbHVlcztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVmFsdWVzID09PSB1bmRlZmluZWQgfHwgdGhpcy5zZWxlY3RlZFZhbHVlcyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gdGhpcy5kaXNwbGF5VGV4dDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZhbCAhPT0gdW5kZWZpbmVkICYmIHZhbCAhPT0gbnVsbCAmJiBkYXRhcyAmJiBkYXRhcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0QXJyID0gdGhpcy5maWx0ZXJTZWxlY3Rpb25zKHZhbCwgdGhpcy5kYXRhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVRleHQgPSB0ZXh0QXJyLmZpbHRlcih2ID0+ICEhdikuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvbnModmFsLCB0aGlzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21ib1NlcnZpY2Uuc2VsZWN0aW9ucyQubmV4dCh7YWN0aW9uOiAnaW5pdERhdGEnfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVRleHQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaWYgKGNoYW5nZXMubXVsdGlTZWxlY3QgJiYgIWNoYW5nZXMubXVsdGlTZWxlY3QuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuZW5hYmxlQ2FuY2VsU2VsZWN0ZWQgPSB0aGlzLm11bHRpU2VsZWN0O1xyXG4gICAgICAgIC8vIH1cclxuICAgIH1cclxuXHJcbiAgICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcclxuICAgIHJlZ2lzdGVyS2V5Ym9hcmRFdmVudCgkZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QgfHwgKHRoaXMucmVhZG9ubHkgfHwgdGhpcy5kaXNhYmxlZCkpICB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ0Fycm93VXAnIHx8ICRldmVudC5jb2RlID09PSAnQXJyb3dEb3duJyB8fFxyXG4gICAgICAgICAgICAoIXRoaXMuZWRpdGFibGUgJiYgIXRoaXMucmVhZG9ubHkgJiYgIXRoaXMuZGlzYWJsZWQgJiYgJGV2ZW50LmNvZGUgPT09ICdTcGFjZScpKSB7XHJcbiAgICAgICAgICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzZWxlY3RJdGVtID0gKGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tYm9TZXJ2aWNlLnNlbGVjdEl0ZW0oZGF0YVtpbmRleF0sIGluZGV4LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtkYXRhOiBkYXRhW2luZGV4XSwgaW5kZXh9O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9DdXJyZW50SXRlbShpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RWYWx1ZXMocGFyYW1zKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmZpbHRlckRhdGEgJiYgdGhpcy5maWx0ZXJEYXRhLmxlbmd0aCA/IHRoaXMuZmlsdGVyRGF0YSA6IHRoaXMuZGF0YTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzWydfY21iUGFuZWwnXSkge1xyXG4gICAgICAgICAgICBkYXRhID0gdGhpcy5kYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IF9kYXRhID0gW107XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkRmllbGQpIHtcclxuICAgICAgICAgICAgX2RhdGEgPSBkYXRhLmZpbHRlcihuID0+ICF0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMuZGlzYWJsZWRGaWVsZCwgbikpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBnZXRyZWFsSW5kZXggPSAoaWR4LCBuZXh0SWR4LCBpc05leHQgPSB0cnVlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhW25leHRJZHhdKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDliKTmlq3kuIvkuIDpobnmmK/lkKbnpoHnlKhcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzRGlzYWJsZWQgPSB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMuZGlzYWJsZWRGaWVsZCwgZGF0YVtuZXh0SWR4XSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNEaXNhYmxlZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfaWR4ID0gX2RhdGEuZmluZEluZGV4KG4gPT4gdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLmlkRmllbGQsIG4pID09PSB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMuaWRGaWVsZCwgZGF0YVtpZHhdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0SWR4ID0gX2lkeCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElkeCA9IF9pZHggLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2RhdGFbbmV4dElkeF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuZmluZEluZGV4KG4gPT4gdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLmlkRmllbGQsIG4pID09PSB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMuaWRGaWVsZCwgX2RhdGFbbmV4dElkeF0pKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdJZGV4ID0gbmV4dElkeCA+IDAgPyAwIDogX2RhdGEubGVuZ3RoIC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5maW5kSW5kZXgobiA9PiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMuaWRGaWVsZCwgbikgPT09IHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGhpcy5pZEZpZWxkLCBfZGF0YVtuZXdJZGV4XSkgJiYgIXRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGhpcy5kaXNhYmxlZEZpZWxkLCBuKSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dElkeDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaWR4ID0gZGF0YS5maW5kSW5kZXgobiA9PiB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMuaWRGaWVsZCwgbikgPT0gdGhpcy5zZWxlY3RlZFZhbHVlcyk7XHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ0Fycm93VXAnKSB7ICAvLyB1cFxyXG4gICAgICAgICAgICBsZXQgcHJldklkeCA9IGlkeCAtIDE7XHJcbiAgICAgICAgICAgIGlmIChwcmV2SWR4IDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcHJldklkeCA9IGRhdGEubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgcHJldklkeCA9IGdldHJlYWxJbmRleChpZHgscHJldklkeCwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZWxlY3RJdGVtKHByZXZJZHgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJGV2ZW50LmNvZGUgPT09ICdBcnJvd0Rvd24nIHx8ICgkZXZlbnQuY29kZSA9PT0gJ1NwYWNlJyAmJiAhdGhpcy5lZGl0YWJsZSkpIHsgLy8gZG93blxyXG4gICAgICAgICAgICBsZXQgbmV4dElkeCA9IGlkeCArIDE7XHJcbiAgICAgICAgICAgIGlmIChuZXh0SWR4ID49IGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0SWR4ID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWRGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgbmV4dElkeCA9IGdldHJlYWxJbmRleChpZHgsbmV4dElkeCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNlbGVjdEl0ZW0obmV4dElkeCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bi5lc2MnLCBbJyRldmVudCddKVxyXG4gICAgZXNjSGFuZGxlckV2ZW50KCRldmVudDogS2V5Ym9hcmRFdmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGUoZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJvdGVjdGVkIG9uU2VsZWN0aW9uc0NoYW5nZSh2OiBhbnlbXSkge1xyXG4gICAgICAgIGlmICh0aGlzLnVyaSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25zICYmIHRoaXMuc2VsZWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLnNlbGVjdGlvbnMubWFwKG4gPT4gblt0aGlzLmlkRmllbGRdKS5qb2luKHRoaXMuc2VwYXJhdG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZVNlbGVjdFZhbHVlcyhpdGVtOiBTZWxlY3RJdGVtLCBlbWl0RXZlbnQgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCBpbmRleCB9ID0geyAuLi5pdGVtIH07XHJcbiAgICAgICAgdGhpcy5jb21ib1NlcnZpY2Uuc2VsZWN0SXRlbShkYXRhLCBpbmRleCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YUxpc3RSZWYpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IHRoaXMuZGF0YUxpc3RSZWYuc2VsZWN0ZWRWYWx1ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gZGF0YVt0aGlzLmlkRmllbGRdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgX2Rpc3BsYXlUZXh0ID0gdGhpcy5jb21ib1NlcnZpY2UuZ2V0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgIGlmIChlbWl0RXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RDaGFuZ2UuZW1pdCh7IGRhdGEsIGluZGV4LCBpbnN0YW5jZTogdGhpcywgc2VsZWN0aW9uczogdGhpcy5zZWxlY3Rpb25zIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICAgICAgdGhpcy5vblZhbHVlQ2hhbmdlKHsgdGV4dDogX2Rpc3BsYXlUZXh0LCB2YWx1ZTogdGhpcy5zZWxlY3RlZFZhbHVlcywgc2VsZWN0aW9uczogdGhpcy5zZWxlY3Rpb25zIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNjcm9sbFRvQ3VycmVudEl0ZW0oaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGFMaXN0UmVmICYmIHRoaXMuZGF0YUxpc3RSZWYuZWwpIHtcclxuICAgICAgICAgICAgY29uc3QgdWxFbCA9IHRoaXMuZGF0YUxpc3RSZWYuZWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bC5saXN0LWdyb3VwJyk7XHJcbiAgICAgICAgICAgIGlmICh1bEVsICYmIHVsRWwuY2hpbGRyZW4gJiYgdWxFbC5jaGlsZHJlbltpbmRleF0pIHtcclxuICAgICAgICAgICAgICAgIHVsRWwuY2hpbGRyZW5baW5kZXhdLnNjcm9sbEludG9WaWV3KHtibG9jazogJ25lYXJlc3QnfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25TZWxlY3QoaXRlbTogU2VsZWN0SXRlbSkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0VmFsdWVzKGl0ZW0sIHRydWUpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5jb21ib1NlcnZpY2UuaXNPcGVuJC5uZXh0KGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25VblNlbGVjdGVkKHZhbHVlOiBTZWxlY3RJdGVtKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB7IC4uLnZhbHVlIH07XHJcbiAgICAgICAgdGhpcy5jb21ib1NlcnZpY2UudW5TZWxlY3RJdGVtKGRhdGEpO1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGFMaXN0UmVmKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLmRhdGFMaXN0UmVmLnNlbGVjdGVkVmFsdWVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiAoIXRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IGRhdGFbdGhpcy5pZEZpZWxkXTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgY29uc3QgX2Rpc3BsYXlUZXh0ID0gdGhpcy5jb21ib1NlcnZpY2UuZ2V0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgIHRoaXMub25WYWx1ZUNoYW5nZSh7IHRleHQ6IF9kaXNwbGF5VGV4dCwgdmFsdWU6IHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIHNlbGVjdGlvbnM6IHRoaXMuc2VsZWN0aW9ucyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkVudGVyKGV2ZW50OiBFdmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzT3Blbikge1xyXG4gICAgICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25LZXl1cCgkZXZlbnQpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgb25LZXlkb3duKCRldmVudDogS2V5Ym9hcmRFdmVudCkge1xyXG4gICAgICAgIGlmICgkZXZlbnQuY29kZSA9PT0gJ1RhYicpIHtcclxuICAgICAgICAgICAgdGhpcy5oaWRlKGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25Gb2N1cygkZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5zaG93UGFuZWxUeXBlID09PSAnZm9jdXMnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvdygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVTZWxlY3RJdGVtKCRldmVudDogTW91c2VFdmVudCwgaXRlbSkge1xyXG4gICAgICAgIGlmICgkZXZlbnQpIHtcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbWJvU2VydmljZS51blNlbGVjdEl0ZW0oaXRlbSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IHRoaXMuY29tYm9TZXJ2aWNlLmdldFZhbHVlKHRoaXMuaWRGaWVsZCk7XHJcbiAgICAgICAgY29uc3QgX2Rpc3BsYXlUZXh0ID0gdGhpcy5jb21ib1NlcnZpY2UuZ2V0VmFsdWUodGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB0aGlzLm9uVmFsdWVDaGFuZ2UoeyB0ZXh0OiBfZGlzcGxheVRleHQsIHZhbHVlOiB0aGlzLnNlbGVjdGVkVmFsdWVzLCBzZWxlY3Rpb25zOiB0aGlzLnNlbGVjdGlvbnMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGluaXREYXRhc0NoYW5nZUFjdGlvbigpIHtcclxuICAgICAgICB0aGlzLmNvbWJvU2VydmljZS5kYXRhJC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyRGF0YSA9IGRhdGE7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggJiYgIXRoaXMuZWRpdGFibGUpIHtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5zZWxlY3RlZFZhbHVlcyA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlkeCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5zZWxlY3RlZFZhbHVlcyA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IGRhdGEuZmlsdGVyKChuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gblt0aGlzLmlkRmllbGRdID09PSB0aGlzLnNlbGVjdGVkVmFsdWVzIHx8IG5bdGhpcy50ZXh0RmllbGRdID09PSB0aGlzLnNlbGVjdGVkVmFsdWVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc3BsaXQodGhpcy5zZXBhcmF0b3IpLm1hcCh2YWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuZmluZCgobiwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuW3RoaXMuaWRGaWVsZF0gPT09IHZhbCB8fCBuW3RoaXMudGV4dEZpZWxkXSA9PT0gdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3Rpb25zIHx8ICF0aGlzLnNlbGVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSBpdGVtcy5tYXAoaSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGhpcy5pZEZpZWxkLCBpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWR4ID0gZGF0YS5maW5kSW5kZXgobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAgdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLmlkRmllbGQsIG4pICA9PT0gdGhpcy5jb21tb25VdGlscy5nZXRWYWx1ZSh0aGlzLmlkRmllbGQsIHRoaXMuc2VsZWN0aW9uc1swXSkgfHwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbHMuZ2V0VmFsdWUodGhpcy50ZXh0RmllbGQsIG4pID09PSB0aGlzLmNvbW1vblV0aWxzLmdldFZhbHVlKHRoaXMudGV4dEZpZWxkLCB0aGlzLnNlbGVjdGlvbnNbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFRvQ3VycmVudEl0ZW0oaWR4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXX0=
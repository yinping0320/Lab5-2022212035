/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector } from '@angular/core';
import { BehaviorSubject, Subject, of } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { debounceTime, map, switchMap, catchError, tap, delay } from 'rxjs/operators';
import { LoadingService } from '@farris/ui-loading';
import { LookupUtils, ServerSideToken } from '@farris/ui-lookup';
import { ComboServerSideToken } from './http/ComboHttpService';
export class ComboService {
    /**
     * @param {?} http
     * @param {?} loadingService
     * @param {?} injector
     */
    constructor(http, loadingService, injector) {
        this.http = http;
        this.loadingService = loadingService;
        this.injector = injector;
        this.selections$ = new Subject();
        this.isOpen$ = new BehaviorSubject(false);
        this.data$ = new BehaviorSubject('');
        this.serachValue$ = new Subject();
        this.loadSuccess$ = new Subject();
        this.treeInfo$ = new BehaviorSubject(null);
        this.displayType = 'LIST';
        this.separator = ',';
        this.columns = [];
        this.remoteSearch = true;
        this.panelElement = null;
        this.treeSearchHandler = null;
        // 树帮助加载设置
        this.treeloadconfig = null;
        this._data = [];
        this.serachValue$.pipe(debounceTime(300)).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (!this.remoteSearch) {
                this.filterData(value, this.textField);
            }
            else {
                this.filterDataOnServer(value);
            }
        }));
    }
    /**
     * @return {?}
     */
    get uri() {
        return this._uri;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set uri(val) {
        this._uri = val;
        this.data$.next([]);
    }
    /**
     * @return {?}
     */
    get data() {
        return this._data;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set data(value) {
        this._data = value || [];
        if (Array.isArray(value)) {
            this.data$.next(value);
        }
    }
    /**
     * @return {?}
     */
    injectService() {
        if (this.injector && !this.comboHttp) {
            this.lookupUtils = this.injector.get(LookupUtils, null);
            if (this.displayType.indexOf('LOOKUP') > -1) {
                this.comboHttp = this.injector.get(ServerSideToken, null);
            }
            else {
                this.comboHttp = this.injector.get(ComboServerSideToken, null);
            }
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    toBoolean(value) {
        return value != null && `${value}` !== 'false';
    }
    /**
     * @param {?} data
     * @param {?=} index
     * @param {?=} emitEvent
     * @return {?}
     */
    selectItem(data, index, emitEvent = true) {
        if (!this.multiSelect) {
            this.selections = [];
        }
        if (Array.isArray(data)) {
            data.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (this.selections.findIndex((/**
                 * @param {?} s
                 * @return {?}
                 */
                s => s[this.idField] === n[this.idField])) === -1) {
                    this.selections.push(n);
                }
            }));
        }
        else {
            if (this.selections.findIndex((/**
             * @param {?} s
             * @return {?}
             */
            s => s[this.idField] === data[this.idField])) === -1) {
                this.selections.push(data);
            }
        }
        if (emitEvent) {
            this.selections$.next({ action: 'clicked' });
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    unSelectItem(data) {
        this.selections = this.selections.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            // return item[this.idField] !== data[this.idField];
            return JSON.stringify(item) !== JSON.stringify(data);
        }));
        this.selections$.next({ action: 'clicked' });
    }
    /**
     * @param {?} datas
     * @return {?}
     */
    selectAll(datas) {
        (datas || []).forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (!this.selections.find((/**
             * @param {?} i
             * @return {?}
             */
            i => i[this.idField] === n[this.idField]))) {
                this.selections.push(n);
            }
        }));
        // this.selections = datas;
        this.selections$.next({ action: 'clicked' });
    }
    /**
     * @param {?} datas
     * @return {?}
     */
    unSelectAll(datas) {
        // this.selections = [];
        datas = datas || [];
        this.selections = (this.selections || []).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => datas.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        i => i[this.idField] === n[this.idField])) === -1));
        this.selections$.next({ action: 'clicked' });
    }
    /**
     * @param {?} id
     * @return {?}
     */
    isSelect(id) {
        if (this.selections && this.selections.length) {
            return this.selections.find((/**
             * @param {?} item
             * @return {?}
             */
            item => item[this.idField] === id)) !== undefined;
        }
        return false;
    }
    /**
     * @param {?} data
     * @param {?=} selectValues
     * @param {?=} callback
     * @return {?}
     */
    loadData(data, selectValues = '', callback) {
        if (data) {
            if (selectValues === null || selectValues === undefined) {
                selectValues = '';
            }
            if (typeof selectValues === 'boolean') {
                selectValues = '' + selectValues;
            }
            // this.data$.next(data);
            if (selectValues) {
                /** @type {?} */
                let vals = [(selectValues + '')];
                if (this.multiSelect) {
                    vals = (selectValues + '').split(this.separator);
                }
                /** @type {?} */
                let selectedItems = vals.map((/**
                 * @param {?} val
                 * @return {?}
                 */
                val => {
                    return callback(data, val);
                }));
                selectedItems = selectedItems.filter((/**
                 * @param {?} el
                 * @return {?}
                 */
                el => el));
                if ((!this.selections || !this.selections.length) && selectedItems.length) {
                    this.selections = selectedItems;
                }
            }
            else {
                this.selections = [];
            }
            this.selections$.next({ action: 'initData' });
        }
    }
    /**
     * @param {?} params
     * @return {?}
     */
    filterDataOnServer(params) {
        this.getData(params).subscribe((/**
         * @param {?} r
         * @return {?}
         */
        r => {
            this.closeLoading();
            this.loadingService.clearAll();
            if (r && r.items) {
                switch (this.displayType) {
                    case 'LOOKUPLIST': {
                        this.loadLookUpDataTable(r, true);
                        break;
                    }
                    case 'LOOKUPTREELIST': {
                        this.loadLookUpDataTree(r);
                        break;
                    }
                }
            }
            else {
                this.data$.next([]);
            }
        }));
    }
    // 客户端过滤
    /**
     * @param {?} val
     * @param {?=} field
     * @return {?}
     */
    filterData(val, field = 'text') {
        if (val) {
            /** @type {?} */
            let data = [];
            if (this.displayType === 'LOOKUPLIST' || this.displayType === 'LIST') {
                data = this.data.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => {
                    /** @type {?} */
                    let itemval = this.getValueByObj(field, item);
                    if (itemval != '' && itemval !== null && itemval !== undefined) {
                        itemval = String(itemval).toLowerCase();
                    }
                    return itemval.indexOf(val.toLowerCase()) > -1;
                }));
            }
            // const data = this.data
            //     ? this.data.filter(item => {
            //         if (this.getValueByObj(filed, item)) {
            //             return String(this.getValueByObj(filed, item)).indexOf(val) > -1;
            //         } else if (item.data && this.getValueByObj(filed, item.data)) {
            //             return String(this.getValueByObj(filed, item.data)).indexOf(val) > -1;
            //         }
            //     })
            //     : [];
            this.data$.next(data);
        }
        else {
            this.data$.next(this.data);
        }
    }
    /**
     * @return {?}
     */
    getSelections() {
        return this.selections;
    }
    /**
     * @return {?}
     */
    clearSelections() {
        this.selections = [];
    }
    /**
     * @param {?} prop
     * @param {?=} selections
     * @return {?}
     */
    getValue(prop, selections) {
        selections = selections ? selections : this.selections;
        if (selections && selections.length) {
            /** @type {?} */
            const tmp = selections.map((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                return this.getValueByObj(prop, item);
            }));
            if (tmp && (tmp.length > 1 || tmp.length === 0)) {
                return tmp.join(this.separator);
            }
            else {
                return tmp[0];
            }
        }
        return '';
    }
    /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    getValueByObj(field, data) {
        if (!data) {
            return '';
        }
        /** @type {?} */
        let resultVal = '';
        if (field.indexOf('.') === -1) {
            if (data.hasOwnProperty(field)) {
                resultVal = data[field];
            }
            else {
                // console.log(`%cError: The %c"${field}"%c is not in `,
                //         'color: #bb0000;font-weight: bold;', 'color: red;font-style: italic', 'color: #bb0000;font-weight: bold;', data);
                resultVal = null;
            }
        }
        else {
            resultVal = field.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            (obj, key) => {
                if (obj) {
                    return obj[key];
                }
                else {
                    // console.log(`%cError: The %c"${key}"%c is not in  `,
                    // 'color: #bb0000;font-weight: bold', 'color: red;font-style: italic', 'color: #bb0000;font-weight: bold;', obj);
                    return null;
                }
            }), data);
        }
        return resultVal;
    }
    /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} selectedIds
     * @return {?}
     */
    initData(params = {}, method = 'get', selectedIds = '') {
        switch (this.displayType) {
            case 'TreeList':
            case 'LIST': {
                if (params.data) {
                    params = params.data;
                }
                this.getData(params, method).subscribe((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    /** @type {?} */
                    let __data = d;
                    if (!this.uri) {
                        __data = this.data;
                    }
                    if (this.displayType === 'TreeList') {
                        this.loadDataTree(__data);
                    }
                    else {
                        this.loadDataTable(__data);
                    }
                    this.loadSuccess$.next(true);
                }));
                break;
            }
            case 'LOOKUPLIST':
            case 'LOOKUPTREELIST': {
                // TFS 466104
                if (!selectedIds) {
                    this.selections = [];
                    this.selectedValues = '';
                }
                this.loadLookupData(params, selectedIds, 'get', this.displayType === 'LOOKUPTREELIST');
                break;
            }
        }
        return this.loadSuccess$;
    }
    // 此方法用于筛选选中的数据
    // 进一步优化：需要服务器端提供一个不构造树结构、根据ID返回简单的列表即可
    /**
     * @private
     * @param {?} treeNodes
     * @param {?=} arr
     * @return {?}
     */
    treeNodesToFlatData(treeNodes, arr = []) {
        treeNodes.forEach((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            if (!n['addtional']) {
                arr.push(n.data);
            }
            if (n.children && n.children.length) {
                this.treeNodesToFlatData(n.children, arr);
            }
        }));
    }
    /**
     * @private
     * @param {?} params
     * @param {?} selectedIds
     * @param {?=} method
     * @param {?=} isTree
     * @return {?}
     */
    loadLookupData(params, selectedIds, method = 'get', isTree = false) {
        const { data, enableFullTree, loadTreeDataType, searchValue } = params;
        if (data) {
            params = { customData: data };
        }
        if (this.displayType === 'LOOKUPTREELIST' && !this['treeToList']) {
            params.enableFullTree = enableFullTree;
            // params.loadTreeDataType = 'loadall'; 
            params.searchValue = { "category": "all" };
            this.treeloadconfig = { enableFullTree, loadTreeDataType };
            if (!isNaN(Number(params.expandLevel))) {
                // 前端 -1 不展开   0 全展开
                // 后端  0 不展开  -1 全展开
                if (params.expandLevel) {
                    if (params.expandLevel === -1) {
                        params.expandLevel = 0;
                    }
                }
                else {
                    params.expandLevel = -1;
                }
                params.searchValue['layerNum'] = params.expandLevel;
            }
            params.searchValue = JSON.stringify(params.searchValue);
        }
        if (searchValue) {
            params.searchValue = searchValue;
        }
        if (this['treeToList']) {
            isTree = false;
            this.displayType = 'LOOKUPLIST';
        }
        this.getData(params, method).pipe(switchMap((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (selectedIds) {
                return this.getSelectedItems(selectedIds).pipe(map((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    if (d && d.items) {
                        // data.selectedItems = isTree ?  d.items.map(n => n.data) : d.items;
                        if (isTree) {
                            /** @type {?} */
                            const arr = [];
                            this.treeNodesToFlatData(d.items, arr);
                            data.selectedItems = arr;
                        }
                        else {
                            data.selectedItems = d.items;
                        }
                    }
                    else {
                        if (Array.isArray(d)) {
                            data.selectedItems = (selectedIds + '').split(this.separator).map((/**
                             * @param {?} val
                             * @return {?}
                             */
                            val => {
                                if (isTree) {
                                    return this.treeNodeToFlatData(d, val, this.idField);
                                }
                                else {
                                    return d.find((/**
                                     * @param {?} n
                                     * @return {?}
                                     */
                                    n => n[this.idField] + '' == val || n[this.textField] == val));
                                }
                            })).filter((/**
                             * @param {?} n
                             * @return {?}
                             */
                            n => n != undefined && n != null));
                        }
                    }
                    return data;
                })), catchError((/**
                 * @return {?}
                 */
                () => {
                    return of(data);
                })));
            }
            else {
                data.selectedItems = [];
            }
            return of(data);
        }))).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            this.loadingService.clearAll();
            if (data) {
                if (isTree) {
                    this.loadLookUpDataTree(data);
                }
                else {
                    this.loadLookUpDataTable(data);
                }
            }
            this.loadSuccess$.next(true);
        }));
    }
    /**
     * @param {?} selIds
     * @return {?}
     */
    getSelectedItems(selIds) {
        /** @type {?} */
        const searchParam = {
            category: 'fav', favoriteIds: ('' + selIds).split(this.separator)
        };
        /** @type {?} */
        const p = { searchValue: JSON.stringify(searchParam), enableFullTree: false, loadTreeDataType: 'default' };
        return this.getData(p);
    }
    /**
     * @param {?=} params
     * @param {?=} method
     * @param {?=} loadChild
     * @return {?}
     */
    getData(params = {}, method = 'get', loadChild = false) {
        if (this.uri) {
            // this.data = []
            // tfs 470519
            if (this.data && this.data.length && !loadChild) {
                this.data = [];
            }
            params['treeToList'] = this['treeToList'];
            params['navTreeToList'] = this['navTreeToList'];
            if (this['treeToList']) {
                this.displayType = 'LOOKUPLIST';
            }
            this.showLoading();
            if (this.comboHttp) {
                if (this.context) {
                    this.comboHttp.context = this.context;
                }
                return this.comboHttp.getData(this.uri, params, method).pipe(tap((/**
                 * @return {?}
                 */
                () => {
                    this.closeLoading();
                })));
            }
            else {
                return this.http.request(method, this.uri, params).pipe(tap((/**
                 * @return {?}
                 */
                () => {
                    this.closeLoading();
                })));
            }
        }
        else {
            if (this.data) {
                return of(this.data).pipe(delay(10));
            }
            else {
                return of([]).pipe(delay(10));
            }
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    loadDataTable(data) {
        if (data instanceof Array) {
            this.data = data;
        }
        else {
            this.data = data ? data.returnValue : [];
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            return dataArr.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d[this.idField] + '' == val || d[this.textField] == val));
        }));
        this.closeLoading();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    loadDataTree(data) {
        if (data instanceof Array) {
            this.data = data;
        }
        else {
            this.data = data ? data.returnValue : [];
        }
        this.loadData(this.data, this.selectedValues, (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            return eachData(dataArr, val, this.idField);
            /**
             * @param {?} paramData
             * @param {?} paramVal
             * @param {?} idField
             * @return {?}
             */
            function eachData(paramData, paramVal, idField) {
                /** @type {?} */
                let rtnData = '';
                paramData.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    if (d.data[idField] == paramVal) {
                        rtnData = d.data;
                        return true;
                    }
                    else if (d.children && d.children.length) {
                        rtnData = eachData(d.children, paramVal, idField);
                    }
                    else {
                        return false;
                    }
                }));
                return rtnData;
            }
        }));
        this.closeLoading();
    }
    /**
     * @param {?} resData
     * @param {?=} sortable
     * @return {?}
     */
    loadLookUpDataTable(resData, sortable = false) {
        this.closeLoading();
        if (typeof resData === 'object') {
            if (resData.returnValue) {
                resData = resData.returnValue;
            }
            if (!sortable && resData.columns) {
                this.columns = resData.columns;
            }
            if (resData.pageInfo) {
                this.pageInfo = resData.pageInfo;
                this.pageInfo.total = resData.total ? resData.total : 0;
            }
            if (resData.items) {
                this.data = resData.items;
            }
        }
        if (resData && resData.selectedItems) {
            this.selections = resData.selectedItems || [];
        }
        if (this.selections) {
            /** @type {?} */
            const ids = this.selections.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField])).join(this.separator);
            if (ids !== this['__SELECTEDIDS__']) {
                // this.selectedValues = ids;
                this['__SELECTEDIDS__'] = ids;
            }
        }
        this.loadData(this.data, this['__SELECTEDIDS__'], (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            /** @type {?} */
            let isMaped = dataArr.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d[this.idField] + '' == val));
            if (this.selections) {
                isMaped = !isMaped ? this.selections.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => d[this.idField] + '' == val)) : isMaped;
            }
            return isMaped;
        }));
    }
    /**
     * @param {?} nodes
     * @param {?=} allData
     * @return {?}
     */
    checkNodeCanBeSelect(nodes, allData = true) {
        if (nodes && nodes.length) {
            return nodes.map((/**
             * @param {?} node
             * @return {?}
             */
            (node) => {
                if (node.hasOwnProperty('addtional')) {
                    node.selectable = !node['addtional'];
                }
                if (node.children && node.children.length) {
                    this.checkNodeCanBeSelect(node.children, allData);
                }
                else {
                    if (allData) {
                        node.leaf = true;
                    }
                }
                return node;
            }));
        }
        return nodes;
    }
    /**
     * @param {?} resData
     * @return {?}
     */
    loadLookUpDataTree(resData) {
        this.closeLoading();
        if (!resData) {
            return;
        }
        if (resData instanceof Array) {
            this.data = resData;
            if (resData['selectedItems']) {
                this.selections = resData['selectedItems'] || [];
            }
        }
        else {
            if (resData.returnValue) {
                resData = resData.returnValue;
            }
            this.columns = resData.columns;
            this.treeInfo = resData.treeInfo;
            this.treeInfo$.next(this.treeInfo);
            if (resData.selectedItems) {
                this.selections = resData.selectedItems || [];
            }
            if (this.treeInfo && !this.treeInfo['treeDataIsInit']) {
                if (this.treeInfo.layerType.toLowerCase() === 'pathcode') {
                    this.data = this.lookupUtils.makeTree(resData.items, this.treeInfo);
                }
                else {
                    this.data = this.lookupUtils.makeTreeWithParentID(resData.items, '', `${this.treeInfo.dataField}.${this.treeInfo.parentField}`, this.idField);
                }
            }
            else if (resData.items) {
                // this.data = resData.items;
                /** @type {?} */
                const isLoadAllTreeData = (/**
                 * @return {?}
                 */
                () => {
                    if (this.treeloadconfig.loadTreeDataType === 'default') {
                        return this.treeInfo.loadDataType === 'all';
                    }
                    else {
                        return this.treeloadconfig.loadTreeDataType === 'loadall';
                    }
                });
                this.data = this.checkNodeCanBeSelect(resData.items, isLoadAllTreeData());
            }
        }
        if (this.selections) {
            /** @type {?} */
            const ids = this.selections.map((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.idField])).join(this.separator);
            if (ids !== this['__SELECTEDIDS__']) {
                this['__SELECTEDIDS__'] = ids;
            }
        }
        this.loadData(this.data, this['__SELECTEDIDS__'], (/**
         * @param {?} dataArr
         * @param {?} val
         * @return {?}
         */
        (dataArr, val) => {
            return this.treeNodeToFlatData(dataArr, val, this.idField);
        }));
    }
    /**
     * @param {?} paramData
     * @param {?} paramVal
     * @param {?} idField
     * @return {?}
     */
    treeNodeToFlatData(paramData, paramVal, idField) {
        /** @type {?} */
        let rtnData = '';
        paramData.find((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            if ((d.data && d.data[idField] == paramVal) || d[idField] == paramVal) {
                rtnData = d.data;
                return true;
            }
            else if (d.children && d.children.length) {
                rtnData = this.treeNodeToFlatData(d.children, paramVal, idField);
                return rtnData ? true : false;
            }
            else {
                return false;
            }
        }));
        return rtnData;
    }
    /**
     * @private
     * @return {?}
     */
    showLoading() {
        this.loading = this.loadingService.show({ container: this.panelElement, delay: 100 });
    }
    /**
     * @return {?}
     */
    closeLoading() {
        if (this.loading) {
            this.loading.close();
            this.loading = null;
        }
    }
}
ComboService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
ComboService.ctorParameters = () => [
    { type: HttpClient },
    { type: LoadingService },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    ComboService.prototype.selections$;
    /** @type {?} */
    ComboService.prototype.isOpen$;
    /** @type {?} */
    ComboService.prototype.data$;
    /** @type {?} */
    ComboService.prototype.serachValue$;
    /** @type {?} */
    ComboService.prototype.loadSuccess$;
    /** @type {?} */
    ComboService.prototype.treeInfo$;
    /** @type {?} */
    ComboService.prototype.selections;
    /** @type {?} */
    ComboService.prototype.idField;
    /** @type {?} */
    ComboService.prototype.valueField;
    /** @type {?} */
    ComboService.prototype.textField;
    /** @type {?} */
    ComboService.prototype.multiSelect;
    /** @type {?} */
    ComboService.prototype.displayType;
    /** @type {?} */
    ComboService.prototype.separator;
    /** @type {?} */
    ComboService.prototype._uri;
    /** @type {?} */
    ComboService.prototype.selectedValues;
    /** @type {?} */
    ComboService.prototype.pageInfo;
    /** @type {?} */
    ComboService.prototype.treeInfo;
    /** @type {?} */
    ComboService.prototype.columns;
    /** @type {?} */
    ComboService.prototype.context;
    /** @type {?} */
    ComboService.prototype.remoteSearch;
    /** @type {?} */
    ComboService.prototype.panelElement;
    /** @type {?} */
    ComboService.prototype.treeSearchHandler;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.treeloadconfig;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype._data;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.lookupUtils;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.comboHttp;
    /** @type {?} */
    ComboService.prototype.http;
    /** @type {?} */
    ComboService.prototype.loadingService;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktY29tYm8tbGlzdC8iLCJzb3VyY2VzIjpbImxpYi9jb21iby5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxjQUFjLEVBQW9CLE1BQU0sb0JBQW9CLENBQUM7QUFDdEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsb0JBQW9CLEVBQW9CLE1BQU0seUJBQXlCLENBQUM7QUFJakYsTUFBTSxPQUFPLFlBQVk7Ozs7OztJQXdEckIsWUFBbUIsSUFBZ0IsRUFBUyxjQUE4QixFQUFVLFFBQWtCO1FBQW5GLFNBQUksR0FBSixJQUFJLENBQVk7UUFBUyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBdER0RyxnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDakMsWUFBTyxHQUFHLElBQUksZUFBZSxDQUFjLEtBQUssQ0FBQyxDQUFDO1FBRWxELFVBQUssR0FBRyxJQUFJLGVBQWUsQ0FBTSxFQUFFLENBQUMsQ0FBQztRQUNyQyxpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDbEMsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzdCLGNBQVMsR0FBRyxJ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aEIsNEJBQWE7O0lBU2Isc0NBQWU7O0lBQ2YsZ0NBQWM7O0lBQ2QsZ0NBQWM7O0lBQ2QsK0JBQTZCOztJQUM3QiwrQkFBYTs7SUFDYixvQ0FBb0I7O0lBRXBCLG9DQUF5Qjs7SUFFekIseUNBQThCOzs7OztJQUc5QixzQ0FBOEI7Ozs7O0lBQzlCLDZCQUFtQzs7Ozs7SUFDbkMsK0JBQWtDOzs7OztJQUNsQyxtQ0FBaUM7Ozs7O0lBQ2pDLGlDQUFvQzs7SUFZeEIsNEJBQXVCOztJQUFFLHNDQUFxQzs7Ozs7SUFBRSxnQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgbWFwLCBzd2l0Y2hNYXAsIGNhdGNoRXJyb3IsIHRhcCwgZGVsYXkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlLCBMb2FkaW5nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTG9va3VwVXRpbHMsIFNlcnZlclNpZGVUb2tlbiB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgQ29tYm9TZXJ2ZXJTaWRlVG9rZW4sIENvbWJvSHR0cFNlcnZpY2UgfSBmcm9tICcuL2h0dHAvQ29tYm9IdHRwU2VydmljZSc7XHJcbmltcG9ydCB7IE5vcm1hbE9iamVjdCB9IGZyb20gJy4vY29tYm8uaW50ZXJmYWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIENvbWJvU2VydmljZSB7XHJcblxyXG4gICAgc2VsZWN0aW9ucyQgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBpc09wZW4kID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFufGFueT4oZmFsc2UpO1xyXG5cclxuICAgIGRhdGEkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KCcnKTtcclxuICAgIHNlcmFjaFZhbHVlJCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICAgIGxvYWRTdWNjZXNzJCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB0cmVlSW5mbyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4obnVsbCk7XHJcblxyXG4gICAgc2VsZWN0aW9uczogTm9ybWFsT2JqZWN0W107XHJcbiAgICBpZEZpZWxkOiBzdHJpbmc7XHJcbiAgICB2YWx1ZUZpZWxkOiBzdHJpbmc7XHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIG11bHRpU2VsZWN0OiBib29sZWFuO1xyXG4gICAgZGlzcGxheVR5cGUgPSAnTElTVCc7XHJcbiAgICBzZXBhcmF0b3IgPSAnLCc7XHJcblxyXG5cclxuICAgIF91cmk6IHN0cmluZztcclxuICAgIGdldCB1cmkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VyaTtcclxuICAgIH1cclxuICAgIHNldCB1cmkodmFsOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl91cmkgPSB2YWw7XHJcbiAgICAgICAgdGhpcy5kYXRhJC5uZXh0KFtdKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RlZFZhbHVlcztcclxuICAgIHBhZ2VJbmZvOiBhbnk7XHJcbiAgICB0cmVlSW5mbzogYW55O1xyXG4gICAgY29sdW1uczogTm9ybWFsT2JqZWN0W10gPSBbXTtcclxuICAgIGNvbnRleHQ6IGFueTtcclxuICAgIHJlbW90ZVNlYXJjaCA9IHRydWU7XHJcblxyXG4gICAgcGFuZWxFbGVtZW50OiBhbnkgPSBudWxsO1xyXG5cclxuICAgIHRyZWVTZWFyY2hIYW5kbGVyOiBhbnkgPSBudWxsO1xyXG5cclxuICAgIC8vIOagkeW4ruWKqeWKoOi9veiuvue9rlxyXG4gICAgcHJpdmF0ZSB0cmVlbG9hZGNvbmZpZyA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9kYXRhOiBOb3JtYWxPYmplY3RbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBsb2FkaW5nOiBMb2FkaW5nQ29tcG9uZW50O1xyXG4gICAgcHJpdmF0ZSBsb29rdXBVdGlsczogTG9va3VwVXRpbHM7XHJcbiAgICBwcml2YXRlIGNvbWJvSHR0cDogQ29tYm9IdHRwU2VydmljZTtcclxuICAgIGdldCBkYXRhKCk6IE5vcm1hbE9iamVjdFtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTtcclxuICAgIH1cclxuICAgIHNldCBkYXRhKHZhbHVlOiBOb3JtYWxPYmplY3RbXSkge1xyXG4gICAgICAgIHRoaXMuX2RhdGEgPSB2YWx1ZSB8fCBbXTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhJC5uZXh0KHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBodHRwOiBIdHRwQ2xpZW50LCBwdWJsaWMgbG9hZGluZ1NlcnZpY2U6IExvYWRpbmdTZXJ2aWNlLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMuc2VyYWNoVmFsdWUkLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5yZW1vdGVTZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyRGF0YSh2YWx1ZSwgdGhpcy50ZXh0RmllbGQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJEYXRhT25TZXJ2ZXIodmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5qZWN0U2VydmljZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbmplY3RvciAmJiAhdGhpcy5jb21ib0h0dHApIHtcclxuICAgICAgICAgICAgdGhpcy5sb29rdXBVdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvb2t1cFV0aWxzLCBudWxsKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUuaW5kZXhPZignTE9PS1VQJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21ib0h0dHAgPSB0aGlzLmluamVjdG9yLmdldChTZXJ2ZXJTaWRlVG9rZW4sIG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21ib0h0dHAgPSB0aGlzLmluamVjdG9yLmdldChDb21ib1NlcnZlclNpZGVUb2tlbiwgbnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdG9Cb29sZWFuKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiBgJHt2YWx1ZX1gICE9PSAnZmFsc2UnO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdEl0ZW0oZGF0YTogYW55LCBpbmRleD86IG51bWJlciwgZW1pdEV2ZW50ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgICAgICAgZGF0YS5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9ucy5maW5kSW5kZXgocyA9PiBzW3RoaXMuaWRGaWVsZF0gPT09IG5bdGhpcy5pZEZpZWxkXSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2gobik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMuZmluZEluZGV4KHMgPT4gc1t0aGlzLmlkRmllbGRdID09PSBkYXRhW3RoaXMuaWRGaWVsZF0pID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGVtaXRFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMkLm5leHQoe2FjdGlvbjogJ2NsaWNrZWQnfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVuU2VsZWN0SXRlbShkYXRhOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSB0aGlzLnNlbGVjdGlvbnMuZmlsdGVyKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAvLyByZXR1cm4gaXRlbVt0aGlzLmlkRmllbGRdICE9PSBkYXRhW3RoaXMuaWRGaWVsZF07XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShpdGVtKSAhPT0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zJC5uZXh0KHthY3Rpb246ICdjbGlja2VkJ30pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBzZWxlY3RBbGwoZGF0YXMpIHtcclxuICAgICAgICAoZGF0YXMgfHwgW10pLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3Rpb25zLmZpbmQoaSA9PiBpW3RoaXMuaWRGaWVsZF0gPT09IG5bdGhpcy5pZEZpZWxkXSkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucy5wdXNoKG4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gdGhpcy5zZWxlY3Rpb25zID0gZGF0YXM7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zJC5uZXh0KHthY3Rpb246ICdjbGlja2VkJ30pO1xyXG4gICAgfVxyXG5cclxuICAgIHVuU2VsZWN0QWxsKGRhdGFzKSB7XHJcbiAgICAgICAgLy8gdGhpcy5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgZGF0YXMgPSBkYXRhcyB8fCBbXTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSAodGhpcy5zZWxlY3Rpb25zIHx8IFtdKS5maWx0ZXIobiA9PiBkYXRhcy5maW5kSW5kZXgoaSA9PiBpW3RoaXMuaWRGaWVsZF0gPT09IG5bdGhpcy5pZEZpZWxkXSkgPT09IC0xICk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25zJC5uZXh0KHthY3Rpb246ICdjbGlja2VkJ30pO1xyXG4gICAgfVxyXG5cclxuICAgIGlzU2VsZWN0KGlkOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25zICYmIHRoaXMuc2VsZWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9ucy5maW5kKGl0ZW0gPT4gaXRlbVt0aGlzLmlkRmllbGRdID09PSBpZCkgIT09IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGxvYWREYXRhKGRhdGE6IGFueSwgc2VsZWN0VmFsdWVzID0gJycsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZXMgPT09IG51bGwgfHwgc2VsZWN0VmFsdWVzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdFZhbHVlcyA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGVjdFZhbHVlcyA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RWYWx1ZXMgPSAnJyArIHNlbGVjdFZhbHVlcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gdGhpcy5kYXRhJC5uZXh0KGRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoc2VsZWN0VmFsdWVzKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFscyA9IFsoc2VsZWN0VmFsdWVzICsgJycpXTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFscyA9IChzZWxlY3RWYWx1ZXMgKyAnJykuc3BsaXQodGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZEl0ZW1zID0gdmFscy5tYXAodmFsID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YSwgdmFsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdGVkSXRlbXMuZmlsdGVyKGVsID0+IGVsKTtcclxuICAgICAgICAgICAgICAgIGlmICgoIXRoaXMuc2VsZWN0aW9ucyB8fCAhdGhpcy5zZWxlY3Rpb25zLmxlbmd0aCkgJiYgc2VsZWN0ZWRJdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBzZWxlY3RlZEl0ZW1zO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zJC5uZXh0KHthY3Rpb246ICdpbml0RGF0YSd9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZmlsdGVyRGF0YU9uU2VydmVyKHBhcmFtcykge1xyXG4gICAgICAgIHRoaXMuZ2V0RGF0YShwYXJhbXMpLnN1YnNjcmliZShyID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5jbGVhckFsbCgpO1xyXG4gICAgICAgICAgICBpZiAociAmJiByLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuZGlzcGxheVR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdMT09LVVBMSVNUJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRMb29rVXBEYXRhVGFibGUociwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdMT09LVVBUUkVFTElTVCc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9va1VwRGF0YVRyZWUocik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEkLm5leHQoW10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5a6i5oi356uv6L+H5rukXHJcbiAgICBmaWx0ZXJEYXRhKHZhbDogc3RyaW5nLCBmaWVsZDogYW55ID0gJ3RleHQnKSB7XHJcbiAgICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdMT09LVVBMSVNUJyB8fCB0aGlzLmRpc3BsYXlUeXBlID09PSAnTElTVCcpIHtcclxuICAgICAgICAgICAgICAgIGRhdGEgPSB0aGlzLmRhdGEuZmlsdGVyKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpdGVtdmFsID0gdGhpcy5nZXRWYWx1ZUJ5T2JqKGZpZWxkLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXZhbCAhPSAnJyAmJiBpdGVtdmFsICE9PSBudWxsICYmIGl0ZW12YWwgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtdmFsID0gU3RyaW5nKGl0ZW12YWwpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtdmFsLmluZGV4T2YodmFsLnRvTG93ZXJDYXNlKCkpID4gLTE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gY29uc3QgZGF0YSA9IHRoaXMuZGF0YVxyXG4gICAgICAgICAgICAvLyAgICAgPyB0aGlzLmRhdGEuZmlsdGVyKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGlmICh0aGlzLmdldFZhbHVlQnlPYmooZmlsZWQsIGl0ZW0pKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHJldHVybiBTdHJpbmcodGhpcy5nZXRWYWx1ZUJ5T2JqKGZpbGVkLCBpdGVtKSkuaW5kZXhPZih2YWwpID4gLTE7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmRhdGEgJiYgdGhpcy5nZXRWYWx1ZUJ5T2JqKGZpbGVkLCBpdGVtLmRhdGEpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHJldHVybiBTdHJpbmcodGhpcy5nZXRWYWx1ZUJ5T2JqKGZpbGVkLCBpdGVtLmRhdGEpKS5pbmRleE9mKHZhbCkgPiAtMTtcclxuICAgICAgICAgICAgLy8gICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vICAgICB9KVxyXG4gICAgICAgICAgICAvLyAgICAgOiBbXTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhJC5uZXh0KGRhdGEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSQubmV4dCh0aGlzLmRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0U2VsZWN0aW9ucygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyU2VsZWN0aW9ucygpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRWYWx1ZShwcm9wOiBzdHJpbmcsIHNlbGVjdGlvbnM/OiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIHNlbGVjdGlvbnMgPSBzZWxlY3Rpb25zID8gc2VsZWN0aW9ucyA6IHRoaXMuc2VsZWN0aW9ucztcclxuICAgICAgICBpZiAoc2VsZWN0aW9ucyAmJiBzZWxlY3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCB0bXAgPSBzZWxlY3Rpb25zLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlQnlPYmoocHJvcCwgaXRlbSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAodG1wICYmICh0bXAubGVuZ3RoID4gMSB8fCB0bXAubGVuZ3RoID09PSAwKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRtcC5qb2luKHRoaXMuc2VwYXJhdG9yKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0bXBbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFZhbHVlQnlPYmooZmllbGQ6IHN0cmluZywgZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJlc3VsdFZhbCA9ICcnO1xyXG4gICAgICAgIGlmIChmaWVsZC5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGZpZWxkKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0VmFsID0gZGF0YVtmaWVsZF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgJWNFcnJvcjogVGhlICVjXCIke2ZpZWxkfVwiJWMgaXMgbm90IGluIGAsXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICdjb2xvcjogI2JiMDAwMDtmb250LXdlaWdodDogYm9sZDsnLCAnY29sb3I6IHJlZDtmb250LXN0eWxlOiBpdGFsaWMnLCAnY29sb3I6ICNiYjAwMDA7Zm9udC13ZWlnaHQ6IGJvbGQ7JywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRWYWwgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gZmllbGQuc3BsaXQoJy4nKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgJWNFcnJvcjogVGhlICVjXCIke2tleX1cIiVjIGlzIG5vdCBpbiAgYCxcclxuICAgICAgICAgICAgICAgICAgICAvLyAnY29sb3I6ICNiYjAwMDA7Zm9udC13ZWlnaHQ6IGJvbGQnLCAnY29sb3I6IHJlZDtmb250LXN0eWxlOiBpdGFsaWMnLCAnY29sb3I6ICNiYjAwMDA7Zm9udC13ZWlnaHQ6IGJvbGQ7Jywgb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRWYWw7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdERhdGEocGFyYW1zOiBhbnkgPSB7fSwgbWV0aG9kID0gJ2dldCcsIHNlbGVjdGVkSWRzID0gJycpIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuZGlzcGxheVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnVHJlZUxpc3QnOlxyXG4gICAgICAgICAgICBjYXNlICdMSVNUJzoge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldERhdGEocGFyYW1zLCBtZXRob2QpLnN1YnNjcmliZShkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgX19kYXRhID0gZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudXJpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZGF0YSA9IHRoaXMuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUgPT09ICdUcmVlTGlzdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YVRyZWUoX19kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhVGFibGUoX19kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU3VjY2VzcyQubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAnTE9PS1VQTElTVCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ0xPT0tVUFRSRUVMSVNUJzoge1xyXG4gICAgICAgICAgICAgICAgLy8gVEZTIDQ2NjEwNFxyXG4gICAgICAgICAgICAgICAgaWYgKCFzZWxlY3RlZElkcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSAnJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMubG9hZExvb2t1cERhdGEocGFyYW1zLCBzZWxlY3RlZElkcywgJ2dldCcsIHRoaXMuZGlzcGxheVR5cGUgPT09ICdMT09LVVBUUkVFTElTVCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRTdWNjZXNzJDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmraTmlrnms5XnlKjkuo7nrZvpgInpgInkuK3nmoTmlbDmja5cclxuICAgIC8vIOi/m+S4gOatpeS8mOWMlu+8mumcgOimgeacjeWKoeWZqOerr+aPkOS+m+S4gOS4quS4jeaehOmAoOagkee7k+aehOOAgeagueaNrklE6L+U5Zue566A5Y2V55qE5YiX6KGo5Y2z5Y+vXHJcbiAgICBwcml2YXRlIHRyZWVOb2Rlc1RvRmxhdERhdGEodHJlZU5vZGVzOiBbXSwgYXJyID0gW10pIHtcclxuICAgICAgICB0cmVlTm9kZXMuZm9yRWFjaCgobjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghblsnYWRkdGlvbmFsJ10pIHtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKG4uZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG4uY2hpbGRyZW4gJiYgbi5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZU5vZGVzVG9GbGF0RGF0YShuLmNoaWxkcmVuLCBhcnIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkTG9va3VwRGF0YShwYXJhbXM6IGFueSwgc2VsZWN0ZWRJZHMsIG1ldGhvZCA9ICdnZXQnLCBpc1RyZWUgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZW5hYmxlRnVsbFRyZWUsIGxvYWRUcmVlRGF0YVR5cGUsIHNlYXJjaFZhbHVlIH0gPSBwYXJhbXM7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgcGFyYW1zID0geyBjdXN0b21EYXRhOiBkYXRhIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUeXBlID09PSAnTE9PS1VQVFJFRUxJU1QnICYmICF0aGlzWyd0cmVlVG9MaXN0J10pIHtcclxuICAgICAgICAgICAgcGFyYW1zLmVuYWJsZUZ1bGxUcmVlID0gZW5hYmxlRnVsbFRyZWU7XHJcbiAgICAgICAgICAgIC8vIHBhcmFtcy5sb2FkVHJlZURhdGFUeXBlID0gJ2xvYWRhbGwnOyBcclxuICAgICAgICAgICAgcGFyYW1zLnNlYXJjaFZhbHVlID0ge1wiY2F0ZWdvcnlcIjpcImFsbFwifTtcclxuICAgICAgICAgICAgdGhpcy50cmVlbG9hZGNvbmZpZyA9IHsgZW5hYmxlRnVsbFRyZWUsIGxvYWRUcmVlRGF0YVR5cGUgfTtcclxuXHJcbiAgICAgICAgICAgIGlmICghaXNOYU4oTnVtYmVyKHBhcmFtcy5leHBhbmRMZXZlbCkpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDliY3nq68gLTEg5LiN5bGV5byAICAgMCDlhajlsZXlvIBcclxuICAgICAgICAgICAgICAgIC8vIOWQjuerryAgMCDkuI3lsZXlvIAgIC0xIOWFqOWxleW8gFxyXG4gICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5leHBhbmRMZXZlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuZXhwYW5kTGV2ZWwgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leHBhbmRMZXZlbCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuZXhwYW5kTGV2ZWwgPSAtMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBhcmFtcy5zZWFyY2hWYWx1ZVsnbGF5ZXJOdW0nXSA9IHBhcmFtcy5leHBhbmRMZXZlbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcGFyYW1zLnNlYXJjaFZhbHVlID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLnNlYXJjaFZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzZWFyY2hWYWx1ZSkge1xyXG4gICAgICAgICAgICBwYXJhbXMuc2VhcmNoVmFsdWUgPSBzZWFyY2hWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzWyd0cmVlVG9MaXN0J10pIHtcclxuICAgICAgICAgICAgaXNUcmVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheVR5cGUgPSAnTE9PS1VQTElTVCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdldERhdGEocGFyYW1zLCBtZXRob2QpLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkSWRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U2VsZWN0ZWRJdGVtcyhzZWxlY3RlZElkcykucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgJiYgZC5pdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRhdGEuc2VsZWN0ZWRJdGVtcyA9IGlzVHJlZSA/ICBkLml0ZW1zLm1hcChuID0+IG4uZGF0YSkgOiBkLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1RyZWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJlZU5vZGVzVG9GbGF0RGF0YShkLml0ZW1zLCBhcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNlbGVjdGVkSXRlbXMgPSBhcnI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zZWxlY3RlZEl0ZW1zID0gIGQuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNlbGVjdGVkSXRlbXMgPSAoc2VsZWN0ZWRJZHMgKyAnJykuc3BsaXQodGhpcy5zZXBhcmF0b3IpLm1hcCh2YWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVHJlZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRyZWVOb2RlVG9GbGF0RGF0YShkLCB2YWwsIHRoaXMuaWRGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmZpbmQobiA9PiBuW3RoaXMuaWRGaWVsZF0gKyAnJyA9PSB2YWwgfHwgblt0aGlzLnRleHRGaWVsZF0gPT0gdmFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmlsdGVyKG4gPT4gbiAhPXVuZGVmaW5lZCAmJiBuICE9IG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YoZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuY2xlYXJBbGwoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNUcmVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkTG9va1VwRGF0YVRyZWUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZExvb2tVcERhdGFUYWJsZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5sb2FkU3VjY2VzcyQubmV4dCh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2VsZWN0ZWRJdGVtcyhzZWxJZHMpIHtcclxuICAgICAgICBjb25zdCBzZWFyY2hQYXJhbSA9IHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6ICdmYXYnLCBmYXZvcml0ZUlkczogKCcnICsgc2VsSWRzKS5zcGxpdCh0aGlzLnNlcGFyYXRvcilcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHAgPSB7c2VhcmNoVmFsdWU6IEpTT04uc3RyaW5naWZ5KHNlYXJjaFBhcmFtKSwgIGVuYWJsZUZ1bGxUcmVlOiBmYWxzZSwgbG9hZFRyZWVEYXRhVHlwZTogJ2RlZmF1bHQnfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXREYXRhKHApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldERhdGEocGFyYW1zID0ge30sIG1ldGhvZCA9ICdnZXQnLCBsb2FkQ2hpbGQgPSBmYWxzZSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgaWYgKHRoaXMudXJpKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZGF0YSA9IFtdXHJcbiAgICAgICAgICAgIC8vIHRmcyA0NzA1MTlcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoICYmICFsb2FkQ2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwYXJhbXNbJ3RyZWVUb0xpc3QnXSA9IHRoaXNbJ3RyZWVUb0xpc3QnXTtcclxuICAgICAgICAgICAgcGFyYW1zWyduYXZUcmVlVG9MaXN0J10gPSB0aGlzWyduYXZUcmVlVG9MaXN0J107XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpc1sndHJlZVRvTGlzdCddKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlUeXBlID0gJ0xPT0tVUExJU1QnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbWJvSHR0cCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tYm9IdHRwLmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb21ib0h0dHAuZ2V0RGF0YSh0aGlzLnVyaSwgcGFyYW1zLCBtZXRob2QpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QobWV0aG9kLCB0aGlzLnVyaSwgcGFyYW1zKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRoaXMuZGF0YSkucGlwZShkZWxheSgxMCkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKFtdKS5waXBlKGRlbGF5KDEwKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZERhdGFUYWJsZShkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YSA/IGRhdGEucmV0dXJuVmFsdWUgOiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFBcnIuZmluZChkID0+IGRbdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCB8fCBkW3RoaXMudGV4dEZpZWxkXSA9PSB2YWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9hZERhdGFUcmVlKGRhdGE6IGFueSkge1xyXG4gICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhID8gZGF0YS5yZXR1cm5WYWx1ZSA6IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvYWREYXRhKHRoaXMuZGF0YSwgdGhpcy5zZWxlY3RlZFZhbHVlcywgKGRhdGFBcnIsIHZhbCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZWFjaERhdGEoZGF0YUFyciwgdmFsLCB0aGlzLmlkRmllbGQpO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBlYWNoRGF0YShwYXJhbURhdGEsIHBhcmFtVmFsLCBpZEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcnRuRGF0YTogYW55ID0gJyc7XHJcbiAgICAgICAgICAgICAgICBwYXJhbURhdGEuZmluZChkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZC5kYXRhW2lkRmllbGRdID09IHBhcmFtVmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0bkRhdGEgPSBkLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5jaGlsZHJlbiAmJiBkLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydG5EYXRhID0gZWFjaERhdGEoZC5jaGlsZHJlbiwgcGFyYW1WYWwsIGlkRmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5EYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkTG9va1VwRGF0YVRhYmxlKHJlc0RhdGE6IGFueSwgc29ydGFibGUgPSBmYWxzZSkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgcmVzRGF0YSA9PT0gJ29iamVjdCcpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNEYXRhLnJldHVyblZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXNEYXRhID0gcmVzRGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFzb3J0YWJsZSAmJiAgcmVzRGF0YS5jb2x1bW5zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbnMgPSByZXNEYXRhLmNvbHVtbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlc0RhdGEucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnZUluZm8gPSByZXNEYXRhLnBhZ2VJbmZvO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlSW5mby50b3RhbCA9IHJlc0RhdGEudG90YWwgPyByZXNEYXRhLnRvdGFsIDogMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCByZXNEYXRhLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSByZXNEYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVzRGF0YSAmJiByZXNEYXRhLnNlbGVjdGVkSXRlbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gcmVzRGF0YS5zZWxlY3RlZEl0ZW1zIHx8IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkcyA9IHRoaXMuc2VsZWN0aW9ucy5tYXAobiA9PiBuW3RoaXMuaWRGaWVsZF0pLmpvaW4odGhpcy5zZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICBpZiAoaWRzICE9PSB0aGlzWydfX1NFTEVDVEVESURTX18nXSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3RlZFZhbHVlcyA9IGlkcztcclxuICAgICAgICAgICAgICAgIHRoaXNbJ19fU0VMRUNURURJRFNfXyddID0gaWRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmxvYWREYXRhKHRoaXMuZGF0YSwgdGhpc1snX19TRUxFQ1RFRElEU19fJ10sIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgICAgICAgICAgbGV0IGlzTWFwZWQgPSBkYXRhQXJyLmZpbmQoZCA9PiBkW3RoaXMuaWRGaWVsZF0gKyAnJyA9PSB2YWwpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBpc01hcGVkID0gIWlzTWFwZWQgPyB0aGlzLnNlbGVjdGlvbnMuZmluZChkID0+IGRbdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCkgOiBpc01hcGVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBpc01hcGVkO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrTm9kZUNhbkJlU2VsZWN0KG5vZGVzLCBhbGxEYXRhID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChub2RlcyAmJiBub2Rlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5vZGVzLm1hcCgobm9kZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZS5oYXNPd25Qcm9wZXJ0eSgnYWRkdGlvbmFsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnNlbGVjdGFibGUgPSAhbm9kZVsnYWRkdGlvbmFsJ107XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTm9kZUNhbkJlU2VsZWN0KG5vZGUuY2hpbGRyZW4sIGFsbERhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWxsRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLmxlYWYgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlcztcclxuICAgIH1cclxuXHJcbiAgICBsb2FkTG9va1VwRGF0YVRyZWUocmVzRGF0YTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuXHJcbiAgICAgICAgaWYgKCFyZXNEYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChyZXNEYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gcmVzRGF0YTtcclxuICAgICAgICAgICAgaWYgKHJlc0RhdGFbJ3NlbGVjdGVkSXRlbXMnXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gcmVzRGF0YVsnc2VsZWN0ZWRJdGVtcyddIHx8IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHJlc0RhdGEucmV0dXJuVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJlc0RhdGEgPSByZXNEYXRhLnJldHVyblZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY29sdW1ucyA9IHJlc0RhdGEuY29sdW1ucztcclxuICAgICAgICAgICAgdGhpcy50cmVlSW5mbyA9IHJlc0RhdGEudHJlZUluZm87XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRyZWVJbmZvJC5uZXh0KHRoaXMudHJlZUluZm8pO1xyXG4gICAgICAgICAgICBpZiAocmVzRGF0YS5zZWxlY3RlZEl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSByZXNEYXRhLnNlbGVjdGVkSXRlbXMgfHwgW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRoaXMudHJlZUluZm8gJiYgIXRoaXMudHJlZUluZm9bJ3RyZWVEYXRhSXNJbml0J10pIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyZWVJbmZvLmxheWVyVHlwZS50b0xvd2VyQ2FzZSgpID09PSAncGF0aGNvZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5sb29rdXBVdGlscy5tYWtlVHJlZShyZXNEYXRhLml0ZW1zLCB0aGlzLnRyZWVJbmZvKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5sb29rdXBVdGlscy5tYWtlVHJlZVdpdGhQYXJlbnRJRChcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzRGF0YS5pdGVtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGAke3RoaXMudHJlZUluZm8uZGF0YUZpZWxkfS4ke3RoaXMudHJlZUluZm8ucGFyZW50RmllbGR9YCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pZEZpZWxkXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNEYXRhLml0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmRhdGEgPSByZXNEYXRhLml0ZW1zO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGlzTG9hZEFsbFRyZWVEYXRhID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyZWVsb2FkY29uZmlnLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPT09ICdhbGwnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRyZWVsb2FkY29uZmlnLmxvYWRUcmVlRGF0YVR5cGUgPT09ICdsb2FkYWxsJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuY2hlY2tOb2RlQ2FuQmVTZWxlY3QocmVzRGF0YS5pdGVtcywgaXNMb2FkQWxsVHJlZURhdGEoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uc3QgaWRzID0gdGhpcy5zZWxlY3Rpb25zLm1hcChuID0+IG5bdGhpcy5pZEZpZWxkXSkuam9pbih0aGlzLnNlcGFyYXRvcik7XHJcbiAgICAgICAgICAgIGlmIChpZHMgIT09IHRoaXNbJ19fU0VMRUNURURJRFNfXyddKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzWydfX1NFTEVDVEVESURTX18nXSA9IGlkcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXNbJ19fU0VMRUNURURJRFNfXyddLCAoZGF0YUFyciwgdmFsKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyZWVOb2RlVG9GbGF0RGF0YShkYXRhQXJyLCB2YWwsIHRoaXMuaWRGaWVsZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJlZU5vZGVUb0ZsYXREYXRhKHBhcmFtRGF0YSwgcGFyYW1WYWwsIGlkRmllbGQpIHtcclxuICAgICAgICBsZXQgcnRuRGF0YTogYW55ID0gJyc7XHJcbiAgICAgICAgcGFyYW1EYXRhLmZpbmQoZCA9PiB7XHJcbiAgICAgICAgICAgIGlmICgoZC5kYXRhICYmIGQuZGF0YVtpZEZpZWxkXSA9PSBwYXJhbVZhbCkgfHwgZFtpZEZpZWxkXSA9PSBwYXJhbVZhbCkge1xyXG4gICAgICAgICAgICAgICAgcnRuRGF0YSA9IGQuZGF0YTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGQuY2hpbGRyZW4gJiYgZC5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJ0bkRhdGEgPSB0aGlzLnRyZWVOb2RlVG9GbGF0RGF0YShkLmNoaWxkcmVuLCBwYXJhbVZhbCwgaWRGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcnRuRGF0YSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBydG5EYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2hvd0xvYWRpbmcoKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93KHsgY29udGFpbmVyOiB0aGlzLnBhbmVsRWxlbWVudCwgZGVsYXk6IDEwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZUxvYWRpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZykge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
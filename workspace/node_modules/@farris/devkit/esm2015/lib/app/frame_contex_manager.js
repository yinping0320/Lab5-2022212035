/*
 * @Author: Witt
 * @Date: 2018-12-30 17:11:37
 * @Last Modified by: Witt
 * @Last Modified time: 2018-12-30 17:19:01
 */
// tslint:disable: max-line-length
import { Injectable } from '@angular/core';
import { RunMode } from '../core';
import { AppContext } from './app_context';
/**
 * FrameContext管理类
 */
class FrameContextManager {
    /**
     * 构造函数
     */
    constructor(appContext) {
        this.frameContextMap = new Map();
        this.frameContextSet = new Set();
        this.appContext = appContext;
    }
    /**
     * 注册FrameContext
     */
    regFrameContext(frameContext) {
        const frameId = frameContext.frameId;
        // 如果存在，先删除
        if (this.frameContextMap.has(frameId) === true) {
            const existedFrameContext = this.frameContextMap.get(frameId);
            this.frameContextMap.delete(frameId);
            this.frameContextSet.delete(existedFrameContext);
        }
        frameContext.index = this.frameContextSet.size;
        this.frameContextMap.set(frameId, frameContext);
        this.frameContextSet.add(frameContext);
    }
    /**
     * 注销组件注册
     */
    unregFrameContext(frameContext) {
        const frameId = frameContext.frameId;
        this.frameContextMap.delete(frameId);
        this.frameContextSet.delete(frameContext);
        // 仅在高速模式下才会在bindingDataManager中注册绑定数据实例
        if (this.appContext.runMode === RunMode.highSpeed) {
            const namespace = frameContext.namespace;
            const repositoryName = frameContext.repository && frameContext.repository.name;
            // 获取ns相同的framecontext，如果已经没有组件上下文了需要销毁bindingData
            const frameContexts = this.getFrameContextsByNamespace(namespace);
            if (!frameContexts || frameContexts.length < 1) {
                this.appContext.bindingDataManager.unRegisteBindingData(repositoryName);
            }
        }
    }
    /**
     * 获取FrameContextMap
     */
    getFrameContextMap() {
        return this.frameContextMap;
    }
    /**
     * 获取全部FrameContext
     */
    getFrameContexts() {
        return Array.from(this.frameContextSet);
    }
    /**
     * 获取组合表单某个表单的所有frameContext
     * @param namespace 命名空间
     */
    getFrameContextsByNamespace(namespace) {
        return Array.from(this.frameContextSet).filter((frameContext) => frameContext && frameContext.namespace === namespace);
    }
    /**
     * 根据id获取FrameContext
     */
    getFrameContextById(frameId) {
        const targetFrameContext = this.frameContextMap.get(frameId);
        if (targetFrameContext) {
            return targetFrameContext;
        }
        return this.getFrameContextFromAllAppContexts(frameId);
    }
    /**
     * Get the root FrameContext instance
     * @return Return the FrameContext instance whose parent is null, and undefined otherwise.
     */
    getRootFrameContext() {
        const frameContexts = this.getFrameContexts();
        const rootFrameContext = frameContexts.find((frameContext) => {
            return frameContext.parent === null;
        });
        return rootFrameContext;
    }
    dispose() {
        this.frameContextMap.clear();
        this.frameContextSet.clear();
    }
    /**
     * 遍历所有的AppContext查找指定的
     * @summary
     * 1、老表单中所有的frameId均不重复；
     * 2、现在隔离了AppContxt，在当前AppContext找不到的时候，查找所有AppContext；
     * 3、隔离后，标准的访问方式是通过事件通信，此处仅仅是临时兼容。
     */
    getFrameContextFromAllAppContexts(frameId) {
        if (!this.appContext.appContextManager) {
            return;
        }
        let targetFrameContext;
        const appContexts = this.appContext.appContextManager.getAppContexts();
        appContexts.some((appContext) => {
            const frameContextMap = appContext.frameContextManager.getFrameContextMap();
            if (frameContextMap.has(frameId) === true) {
                targetFrameContext = frameContextMap.get(frameId);
                return true;
            }
            else {
                return false;
            }
        });
        return targetFrameContext;
    }
}
FrameContextManager.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FrameContextManager.ctorParameters = () => [
    { type: AppContext }
];
export { FrameContextManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWVfY29udGV4X21hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9hcHAvZnJhbWVfY29udGV4X21hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFDSCxrQ0FBa0M7QUFDbEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWUsT0FBTyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRS9DLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0M7O0dBRUc7QUFDSCxNQUNNLG1CQUFtQjtJQWlCdkI7O09BRUc7SUFDSCxZQUFZLFVBQXNCO1FBQ2hDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxHQUFHLEVBQXdCLENBQUM7UUFDdkQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLEdBQUcsRUFBZ0IsQ0FBQztRQUMvQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDO0lBRUQ7O09BRUc7SUFDSSxlQUFlLENBQUMsWUFBMEI7UUFDL0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQztRQUVyQyxXQUFXO1FBQ1gsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDOUMsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM5RCxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1NBQ2xEO1FBQ0QsWUFBWSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQztRQUMvQyxJQUFJLENBQUMsZUFB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O1lBQzFDLE1BQU0sZUFBZSxHQUFHLFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1lBQzVFLElBQUksZUFBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUU7Z0JBQ3pDLGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ2xELE9BQU8sSUFBSSxDQUFDO2FBQ2I7aUJBQU07Z0JBQ0wsT0FBTyxLQUFLLENBQUM7YUFDZDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxrQkFBa0IsQ0FBQztJQUM1QixDQUFDOzs7WUFwSUYsVUFBVTs7OztZQUxGLFVBQVU7O0FBNEluQixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTgtMTItMzAgMTc6MTE6MzdcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IFdpdHRcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOC0xMi0zMCAxNzoxOTowMVxyXG4gKi9cclxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IElEaXNwb3NhYmxlLCBSdW5Nb2RlIH0gZnJvbSAnLi4vY29yZSc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJy4uL2ZyYW1lL2luZGV4JztcclxuaW1wb3J0IHsgQXBwQ29udGV4dCB9IGZyb20gJy4vYXBwX2NvbnRleHQnO1xyXG5cclxuLyoqXHJcbiAqIEZyYW1lQ29udGV4dOeuoeeQhuexu1xyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBGcmFtZUNvbnRleHRNYW5hZ2VyIGltcGxlbWVudHMgSURpc3Bvc2FibGUge1xyXG5cclxuICAvKipcclxuICAgKiBGcmFtZUNvbnRleHTlrZflhbgo5YW85a656ICB6KGo5Y2VKVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZnJhbWVDb250ZXh0TWFwOiBNYXA8c3RyaW5nLCBGcmFtZUNvbnRleHQ+O1xyXG5cclxuICAvKipcclxuICAgKiBGcmFtZUNvbnRleHTpm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGZyYW1lQ29udGV4dFNldDogU2V0PEZyYW1lQ29udGV4dD47XHJcblxyXG4gIC8qKlxyXG4gICAqIEFwcENvbnRleHRcclxuICAgKi9cclxuICBwcml2YXRlIGFwcENvbnRleHQ6IEFwcENvbnRleHQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGFwcENvbnRleHQ6IEFwcENvbnRleHQpIHtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0TWFwID0gbmV3IE1hcDxzdHJpbmcsIEZyYW1lQ29udGV4dD4oKTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0U2V0ID0gbmV3IFNldDxGcmFtZUNvbnRleHQ+KCk7XHJcbiAgICB0aGlzLmFwcENvbnRleHQgPSBhcHBDb250ZXh0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo5YaMRnJhbWVDb250ZXh0XHJcbiAgICovXHJcbiAgcHVibGljIHJlZ0ZyYW1lQ29udGV4dChmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCk6IHZvaWQge1xyXG4gICAgY29uc3QgZnJhbWVJZCA9IGZyYW1lQ29udGV4dC5mcmFtZUlkO1xyXG5cclxuICAgIC8vIOWmguaenOWtmOWcqO+8jOWFiOWIoOmZpFxyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0TWFwLmhhcyhmcmFtZUlkKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBjb25zdCBleGlzdGVkRnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHRNYXAuZ2V0KGZyYW1lSWQpO1xyXG4gICAgICB0aGlzLmZyYW1lQ29udGV4dE1hcC5kZWxldGUoZnJhbWVJZCk7XHJcbiAgICAgIHRoaXMuZnJhbWVDb250ZXh0U2V0LmRlbGV0ZShleGlzdGVkRnJhbWVDb250ZXh0KTtcclxuICAgIH1cclxuICAgIGZyYW1lQ29udGV4dC5pbmRleCA9IHRoaXMuZnJhbWVDb250ZXh0U2V0LnNpemU7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dE1hcC5zZXQoZnJhbWVJZCwgZnJhbWVDb250ZXh0KTtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0U2V0LmFkZChmcmFtZUNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5rOo6ZSA57uE5Lu25rOo5YaMXHJcbiAgICovXHJcbiAgcHVibGljIHVucmVnRnJhbWVDb250ZXh0KGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0KTogdm9pZCB7XHJcbiAgICBjb25zdCBmcmFtZUlkID0gZnJhbWVDb250ZXh0LmZyYW1lSWQ7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dE1hcC5kZWxldGUoZnJhbWVJZCk7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dFNldC5kZWxldGUoZnJhbWVDb250ZXh0KTtcclxuICAgIC8vIOS7heWcqOmrmOmAn+aooeW8j+S4i+aJjeS8muWcqGJpbmRpbmdEYXRhTWFuYWdlcuS4reazqOWGjOe7keWumuaVsOaNruWunuS+i1xyXG4gICAgaWYgKHRoaXMuYXBwQ29udGV4dC5ydW5Nb2RlID09PSBSdW5Nb2RlLmhpZ2hTcGVlZCkge1xyXG4gICAgICBjb25zdCBuYW1lc3BhY2UgPSBmcmFtZUNvbnRleHQubmFtZXNwYWNlO1xyXG4gICAgICBjb25zdCByZXBvc2l0b3J5TmFtZSA9IGZyYW1lQ29udGV4dC5yZXBvc2l0b3J5ICYmIGZyYW1lQ29udGV4dC5yZXBvc2l0b3J5Lm5hbWU7XHJcbiAgICAgIC8vIOiOt+WPlm5z55u45ZCM55qEZnJhbWVjb250ZXh077yM5aaC5p6c5bey57uP5rKh5pyJ57uE5Lu25LiK5LiL5paH5LqG6ZyA6KaB6ZSA5q+BYmluZGluZ0RhdGFcclxuICAgICAgY29uc3QgZnJhbWVDb250ZXh0cyA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0c0J5TmFtZXNwYWNlKG5hbWVzcGFjZSk7XHJcbiAgICAgIGlmICghZnJhbWVDb250ZXh0cyB8fCBmcmFtZUNvbnRleHRzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICB0aGlzLmFwcENvbnRleHQuYmluZGluZ0RhdGFNYW5hZ2VyLnVuUmVnaXN0ZUJpbmRpbmdEYXRhKHJlcG9zaXRvcnlOYW1lKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WRnJhbWVDb250ZXh0TWFwXHJcbiAgICovXHJcbiAgcHVibGljIGdldEZyYW1lQ29udGV4dE1hcCgpIHtcclxuICAgIHJldHVybiB0aGlzLmZyYW1lQ29udGV4dE1hcDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWFqOmDqEZyYW1lQ29udGV4dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRGcmFtZUNvbnRleHRzKCk6IEZyYW1lQ29udGV4dFtdIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZnJhbWVDb250ZXh0U2V0KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W57uE5ZCI6KGo5Y2V5p+Q5Liq6KGo5Y2V55qE5omA5pyJZnJhbWVDb250ZXh0XHJcbiAgICogQHBhcmFtIG5hbWVzcGFjZSDlkb3lkI3nqbrpl7RcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RnJhbWVDb250ZXh0c0J5TmFtZXNwYWNlKG5hbWVzcGFjZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmZyYW1lQ29udGV4dFNldCkuZmlsdGVyKChmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkgPT4gZnJhbWVDb250ZXh0ICYmIGZyYW1lQ29udGV4dC5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk6I635Y+WRnJhbWVDb250ZXh0XHJcbiAgICovXHJcbiAgcHVibGljIGdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZDogc3RyaW5nKTogRnJhbWVDb250ZXh0IHtcclxuICAgIGNvbnN0IHRhcmdldEZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0TWFwLmdldChmcmFtZUlkKTtcclxuICAgIGlmICh0YXJnZXRGcmFtZUNvbnRleHQpIHtcclxuICAgICAgcmV0dXJuIHRhcmdldEZyYW1lQ29udGV4dDtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdldEZyYW1lQ29udGV4dEZyb21BbGxBcHBDb250ZXh0cyhmcmFtZUlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgcm9vdCBGcmFtZUNvbnRleHQgaW5zdGFuY2VcclxuICAgKiBAcmV0dXJuIFJldHVybiB0aGUgRnJhbWVDb250ZXh0IGluc3RhbmNlIHdob3NlIHBhcmVudCBpcyBudWxsLCBhbmQgdW5kZWZpbmVkIG90aGVyd2lzZS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Um9vdEZyYW1lQ29udGV4dCgpOiBGcmFtZUNvbnRleHQge1xyXG4gICAgY29uc3QgZnJhbWVDb250ZXh0cyA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0cygpO1xyXG4gICAgY29uc3Qgcm9vdEZyYW1lQ29udGV4dCA9IGZyYW1lQ29udGV4dHMuZmluZCgoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpID0+IHtcclxuICAgICAgcmV0dXJuIGZyYW1lQ29udGV4dC5wYXJlbnQgPT09IG51bGw7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByb290RnJhbWVDb250ZXh0O1xyXG4gIH1cclxuICBwdWJsaWMgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0TWFwLmNsZWFyKCk7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dFNldC5jbGVhcigpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgY3ljobmiYDmnInnmoRBcHBDb250ZXh05p+l5om+5oyH5a6a55qEXHJcbiAgICogQHN1bW1hcnlcclxuICAgKiAx44CB6ICB6KGo5Y2V5Lit5omA5pyJ55qEZnJhbWVJZOWdh+S4jemHjeWkje+8m1xyXG4gICAqIDLjgIHnjrDlnKjpmpTnprvkuoZBcHBDb250eHTvvIzlnKjlvZPliY1BcHBDb250ZXh05om+5LiN5Yiw55qE5pe25YCZ77yM5p+l5om+5omA5pyJQXBwQ29udGV4dO+8m1xyXG4gICAqIDPjgIHpmpTnprvlkI7vvIzmoIflh4bnmoTorr/pl67mlrnlvI/mmK/pgJrov4fkuovku7bpgJrkv6HvvIzmraTlpITku4Xku4XmmK/kuLTml7blhbzlrrnjgIJcclxuICAgKi9cclxuICBwcml2YXRlIGdldEZyYW1lQ29udGV4dEZyb21BbGxBcHBDb250ZXh0cyhmcmFtZUlkOiBzdHJpbmcpOiBGcmFtZUNvbnRleHQge1xyXG4gICAgaWYgKCF0aGlzLmFwcENvbnRleHQuYXBwQ29udGV4dE1hbmFnZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHRhcmdldEZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0O1xyXG4gICAgY29uc3QgYXBwQ29udGV4dHMgPSB0aGlzLmFwcENvbnRleHQuYXBwQ29udGV4dE1hbmFnZXIuZ2V0QXBwQ29udGV4dHMoKTtcclxuICAgIGFwcENvbnRleHRzLnNvbWUoKGFwcENvbnRleHQ6IEFwcENvbnRleHQpID0+IHtcclxuICAgICAgY29uc3QgZnJhbWVDb250ZXh0TWFwID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dE1hcCgpO1xyXG4gICAgICBpZiAoZnJhbWVDb250ZXh0TWFwLmhhcyhmcmFtZUlkKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHRhcmdldEZyYW1lQ29udGV4dCA9IGZyYW1lQ29udGV4dE1hcC5nZXQoZnJhbWVJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0YXJnZXRGcmFtZUNvbnRleHQ7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBGcmFtZUNvbnRleHRNYW5hZ2VyIH07XHJcbiJdfQ==
import { Subject } from 'rxjs';
import { ChangeSet } from '../changeset';
import { SchemaEntityField$Type } from '../schema/schema';
import { EntityList } from './entity_list';
import { entityPrototype } from './entity_prototype';
import { NG_FIELD, NG_LIST, NG_OBJECT } from './metadata';
import { PARENT_CLASS, PARENT_PATH } from './types';
import { Validator } from './validator';
import { ValidationUtils } from './validator/validation_utils';
import { UserSettingsService } from '../i18n/user_settings_service';
import { ZonedTime } from '../i18n/zoned_time';
/**
 * 实体类型工厂
 * 用来根据实体Schema描述信息创建实体类型
 */
export class EntityTypeFactory {
    constructor() { }
    /**
     * 由实体Schema结构创建实体类型
     * @param schema 实体Schema结构
     * @returns 实体类型
     */
    create(schema) {
        // 提取Schema定义中的第一个是实体描述
        const schemaType = schema.entities[0].type;
        // 创建实体类型
        const entityType = this.createClass(schemaType, schema.entities[0]);
        return entityType;
    }
    /**
     * 由实体Schema类型描述创建实体类
     * @param schemaType Schema实体类型描述
     * @returns 实体类型
     */
    createClass(schemaType, relateSchema) {
        const attachEntityInstanceData = this.createEntityInstanceDataInitializer(schemaType);
        // 创建指定实体类型的初始化函数，用来在实体类型构造函数中为实体实例赋值
        const initialize = (entityInstance, entityData, entityTypeConstructor) => {
            entityInstance.isInitializing = true;
            attachEntityInstanceData(entityInstance, entityData, entityTypeConstructor);
            entityInstance.isInitializing = false;
        };
        // 声明实体类构造函数
        const ConcreteEntity = function (data) {
            // 创建实体变更集
            this.changeSet = new ChangeSet();
            // 初始化实体验证状态
            this.isValidating = false;
            // 设置unsubscribe 取消订阅事件
            this.unsubscribe = new Subject();
            // 初始化实体验证信息
            this.validErrors = {};
            // 初始化验证器
            this.validator = new Validator();
            // 初始化实体数据副本
            this.innerData = Object.assign({}, data);
            // 初始化子实体对象集合
            this.innerEntities = {};
            // 初始化实体值变化事件
            this.valueChanged = new Subject();
            this.onValueChanged = this.valueChanged;
            this.validateFromUtilSync = function (propertyName, value, cb, context) {
                this.validErrors = {};
                const result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
                if (result && !result.isValid) {
                    this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
                }
                cb(result);
            };
            // 调用初始化方法，初始化实体数据
            initialize(this, data, ConcreteEntity);
            this.load = (newData) => {
                attachEntityInstanceData(this, newData, ConcreteEntity);
                this.data = newData;
            };
        };
        // 在实体类构造函数中记录视图类型名称
        ConcreteEntity.typeName = `${schemaType.name}Entity`;
        ConcreteEntity.code = relateSchema.code;
        ConcreteEntity.label = relateSchema.label;
        // 在实体类构造函数中记录其下直接引用的子类型
        ConcreteEntity.types = {};
        ConcreteEntity.__prop__metadata__ = {};
        // 构造实体类的原型对象
        const entityTypePrototype = Object.assign({ typeName: 'ConcreteEntityPrototype' }, entityPrototype);
        // 向实体类原型对象中定义预制属性
        this.definePresetProperty(entityTypePrototype, schemaType);
        // 向实体类原型对象中定义字段属性get/set方法
        this.defineFieldsToPrototype(entityTypePrototype, schemaType.fields, schemaType.primary, ConcreteEntity);
        // 向实体类原型对象中定义访问子实体的get/set方法
        this.defineEntitiesToPrototype(entityTypePrototype, schemaType.entities, ConcreteEntity);
        // 将实体类的原型对象指向新构造的原型对象。
        ConcreteEntity.prototype = entityTypePrototype;
        return ConcreteEntity;
    }
    /**
     * 向实体类原型对象中定义预制属性
     * @param prototypeObject 实体类原型对象
     * @param schemaType Schema类型描述
     */
    definePresetProperty(prototypeObject, schemaType) {
        /**
         * 实体数据
         */
        Object.defineProperty(prototypeObject, 'data', {
            get: function () {
                if (!this.innerData) {
                    this.innerData = {};
                }
                return this.innerData;
            },
            set: function (value) {
                this.innerData = value;
            }
        });
        /**
         * 实体验证信息
         */
        Object.defineProperty(prototypeObject, 'errors', {
            get: function () {
                return this.validErrors;
            },
            set: function (errors) {
                this.validErrors = errors;
            }
        });
        /**
         * 实体变更集
         */
        Object.defineProperty(prototypeObject, 'changes', {
            get: function () {
                return this.changeSet.changes;
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryProperty', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                // return schemaType.primary;
                return prototypeObject.innerPrimaryProperty || { dataField: schemaType.primary };
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryKey', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                return schemaType.primary || '';
            }
        });
        /**
         * 实体主键的值
         */
        Object.defineProperty(prototypeObject, 'primaryValue', {
            get: function () {
                if (this.primaryKey) {
                    // return this[this.primaryProperty.property].toString();
                    const primaryValue = this[this.primaryKey];
                    return primaryValue ? primaryValue : '';
                }
                else {
                    return '';
                }
            }
        });
    }
    /**
     * 向实体类定义字段属性
     * @param prototypeObject 实体类原型对象
     * @param fields 字段描述集合
     * @param parentEntityType 父类型
     */
    defineFieldsToPrototype(prototypeObject, fields, primary, parentEntityType) {
        if (fields && fields.length) {
            // 遍历Schema中描述的字段，在实体原型对象上定义字段访问函数
            fields.forEach(schemaEntityField => {
                switch (schemaEntityField.$type) {
                    // 定义简单类型字段
                    case SchemaEntityField$Type.SimpleField:
                        this.defineSimpleFieldToPrototype(prototypeObject, schemaEntityField, primary, parentEntityType);
                        break;
                    // 定义复杂类型字段
                    case SchemaEntityField$Type.ComplexField:
                        this.defineComplexFieldToPrototype(prototypeObject, schemaEntityField, parentEntityType);
                        break;
                }
            });
        }
    }
    /**
     * 向实体类定义简单类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     */
    defineSimpleFieldToPrototype(prototypeObject, schemaField, primary, parentEntityType) {
        const propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                return this.getFieldValue(schemaField);
            },
            set: function (newPropValue) {
                // 值相同时不触发变更。
                const oldPropValue = this.getFieldValue(schemaField);
                if (this.isFieldValueChanged(schemaField, newPropValue, oldPropValue) === false) {
                    return;
                }
                this.setFieldValue(schemaField, newPropValue);
                this.emitFieldValueChange(schemaField, newPropValue, oldPropValue);
            }
        });
        const fieldMetadata = {
            /** 字段名称 */
            dataField: this.getDataField(schemaField),
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 原始字段类型 */
            originalDataFieldType: schemaField.type.name,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            primary: schemaField.label === primary,
            enableMultiLangInput: this.getEnableMultiLangInput(schemaField),
            defaultValue: schemaField.defaultValue,
            ngMetadataName: NG_FIELD
        };
        if (schemaField['enableStdTimeFormat'] && fieldMetadata.originalDataFieldType == "DateTime") {
            fieldMetadata["enableTimeZone"] = true;
        }
        if (fieldMetadata.primary) {
            prototypeObject.innerPrimaryProperty = fieldMetadata;
        }
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    }
    getDataField(schemaField) {
        if (schemaField.multiLanguage) {
            return schemaField.label + "_" + "MULTILANGUAGE";
        }
        return schemaField.label;
    }
    getEnableMultiLangInput(schemaField) {
        if (schemaField.multiLanguage) {
            return true;
        }
    }
    /**
     * 向实体类定义复杂类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     * @param parentEntityType 父类型
     */
    defineComplexFieldToPrototype(prototypeObject, schemaField, parentEntityType) {
        const complexFieldType = this.createClass(schemaField.type, schemaField);
        parentEntityType.types[schemaField.type.name] = complexFieldType;
        const propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                const fieldValue = this.getComplexFieldValue(schemaField);
                return fieldValue;
            },
            set: function (value) {
                this.setComplexFieldValue(schemaField, complexFieldType, value);
            }
        });
        const fieldMetadata = {
            /** 映射字段 */
            dataField: schemaField.label,
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 引用实体类型 */
            type: complexFieldType,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            ngMetadataName: NG_OBJECT
        };
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    }
    /**
     * 向实体类定义子实体
     * @param prototypeObject 实体类原型对象
     * @param entities 实体描述集合
     * @param parentEntityType 父类型
     */
    defineEntitiesToPrototype(prototypeObject, entities, parentEntityType) {
        if (entities && entities.length) {
            // 遍历Schema中描述的子实体，在实体对象上定义子实体列表
            entities.forEach(schemaEntity => {
                const complexFieldType = this.createClass(schemaEntity.type, schemaEntity);
                parentEntityType.types[schemaEntity.type.name] = complexFieldType;
                // 提取子实体在实体对象上的属性名
                const propertyName = schemaEntity.label;
                Object.defineProperty(prototypeObject, propertyName, {
                    get: function () {
                        const fieldValue = this.getEntities(schemaEntity);
                        return fieldValue;
                    },
                    set: function (value) {
                        this.setEntities(schemaEntity, value);
                    }
                });
                const entitMetadata = {
                    /** 字段名称 */
                    dataField: schemaEntity.label,
                    /** 原始字段名称 */
                    originalDataField: '',
                    /** 实体类型 */
                    type: complexFieldType,
                    ngMetadataName: NG_LIST
                };
                if (!parentEntityType.__prop__metadata__[propertyName]) {
                    parentEntityType.__prop__metadata__[propertyName] = [];
                }
                parentEntityType.__prop__metadata__[propertyName].push(entitMetadata);
            });
        }
    }
    /**
     * 创建初始化实体对象方法
     * @param schemaType 实体类型描述
     * @returns 初始化实体对象方法
     */
    createEntityInstanceDataInitializer(schemaType) {
        /**
         * 实体初始化函数，用来初始化实体的复杂类型数据和子实体数据
         * @param entityInstance 实体类型实例
         * @param data 实体原始数据
         * @param entityTypeConstructor 实体类型构造函数
         */
        const initializer = (entityInstance, entityData, entityTypeConstructor) => {
            // 初始化复杂类型字段
            schemaType.fields
                // 过滤复杂类型字段
                .filter(field => field.$type === SchemaEntityField$Type.ComplexField)
                // 遍历复杂类型字段创建对应实体类型数据
                .forEach(field => {
                // 提取字段名
                const fieldName = field.label;
                // 提取实体类型下的所有子实体类型
                const includedEntityTypes = entityTypeConstructor.types;
                // 获取复杂类型字段对应的实体类型
                const ComplexField = includedEntityTypes[field.type.name];
                // 提取复杂类型字段原始数据
                const fieldData = entityData ? entityData[fieldName] : null;
                // 创建复杂类型字段对象路径
                const path = entityInstance.createPath(fieldName);
                let complexFieldValue = entityInstance[fieldName];
                if (complexFieldValue instanceof ComplexField) {
                    complexFieldValue.load(fieldData);
                }
                else {
                    // 创建复杂类型字段实体实例
                    complexFieldValue = new ComplexField(fieldData);
                    complexFieldValue.constructor = ComplexField;
                    complexFieldValue[PARENT_CLASS] = entityInstance;
                    complexFieldValue[PARENT_PATH] = path;
                    complexFieldValue.onValueChanged.subscribe(changes => {
                        if (changes) {
                            changes.path = (entityInstance[PARENT_PATH] || []).concat(changes.path);
                            const modification = Object.assign({}, changes, { fromParent: true });
                            entityInstance.setChanges(modification);
                        }
                    });
                    entityInstance[fieldName] = complexFieldValue;
                }
            });
            // 初始化子实体
            if (schemaType.entities) {
                // 遍历子实体创建对应实体类型的数据
                schemaType.entities.forEach(schemaEntity => {
                    // 提取子实体名
                    const subEntityName = schemaEntity.label;
                    // 提取实体类型下的所有子实体类型
                    const includedEntityTypes = entityTypeConstructor.types;
                    // 创建子实体对象路径
                    const path = entityInstance.createPath(subEntityName);
                    // 创建子实体对象集合
                    let entityList = entityInstance[subEntityName];
                    if (!(entityList instanceof EntityList)) {
                        entityList = new EntityList();
                        // 向子实体列表注册子实体变化事件
                        entityList.onListChanged.subscribe(value => {
                            if (value) {
                                if (entityList[PARENT_PATH][0] !== value.path[0]) {
                                    value.path = entityList[PARENT_PATH].concat(value.path);
                                }
                                entityInstance.setChanges(value);
                            }
                        });
                        // 向实体类型实例上直接存储子实体对象列表
                        entityInstance[subEntityName] = entityList;
                    }
                    entityList[PARENT_CLASS] = entityTypeConstructor;
                    entityList[PARENT_PATH] = path;
                    // 提取子实体类型名称
                    const schemaEntityTypeName = schemaEntity.type.name;
                    // 获取子实体类型
                    const ConcreteEntity = includedEntityTypes[schemaEntityTypeName];
                    const originalEntityDataArray = entityData ? entityData[subEntityName] : null;
                    // 构造子实体集合
                    if (originalEntityDataArray) {
                        // 遍历子实体原始数据，构造实体对象集合
                        const entities = originalEntityDataArray.map((originalEntityData) => {
                            const concreteEntityInstance = new ConcreteEntity(originalEntityData);
                            concreteEntityInstance.constructor = ConcreteEntity;
                            return concreteEntityInstance;
                        });
                        // 向子实体列表中添加子实体对象
                        entityList.loadEntities(entities);
                    }
                });
            }
            // 初始化简单字段
            schemaType.fields
                // 过滤复杂类型字段
                .filter(field => field.$type === SchemaEntityField$Type.SimpleField)
                // 遍历复杂类型字段创建对应实体类型数据
                .forEach(function (field) {
                // 提取字段名
                const fieldName = field.label;
                let propValue = entityData ? entityData[fieldName] : null;
                if (field['enableTimeZone'] === true) {
                    const timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                    if (timeZoneOffset !== null && propValue) {
                        propValue = ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(propValue, timeZoneOffset);
                    }
                }
                entityInstance[fieldName] = propValue;
            });
        };
        return initializer;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3R5cGVfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS9lbnRpdHlfdHlwZV9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxjQUFjLENBQUM7QUFDdkQsT0FBTyxFQUEyQyxzQkFBc0IsRUFBYyxNQUFNLGtCQUFrQixDQUFDO0FBRS9HLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBYSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNyRSxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFRL0M7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLGlCQUFpQjtJQUU1QixnQkFBZ0IsQ0FBQztJQUNqQjs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLE1BQWM7UUFDMUIsdUJBQXVCO1FBQ3ZCLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzNDLFNBQVM7UUFDVCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMs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QUcsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztvQkFDL0QsSUFBSSxjQUFjLEtBQUssSUFBSSxJQUFJLFNBQVMsRUFBRTt3QkFDeEMsU0FBUyxHQUFHLFNBQVMsQ0FBQywwQ0FBMEMsQ0FBQyxTQUFTLEVBQUUsY0FBYyxDQUFDLENBQUM7cUJBQzdGO2lCQUNGO2dCQUNELGNBQWMsQ0FBQyxTQUFTLENBQUMsR0FBRyxTQUFTLENBQUM7WUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUM7UUFDRixPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENoYW5nZVNldCwgTW9kaWZpY2F0aW9uIH0gZnJvbSAnLi4vY2hhbmdlc2V0JztcclxuaW1wb3J0IHsgU2NoZW1hLCBTY2hlbWFFbnRpdHksIFNjaGVtYUVudGl0eUZpZWxkLCBTY2hlbWFFbnRpdHlGaWVsZCRUeXBlLCBTY2hlbWFUeXBlIH0gZnJvbSAnLi4vc2NoZW1hL3NjaGVtYSc7XHJcbmltcG9ydCB7IEVudGl0eSB9IGZyb20gJy4vZW50aXR5JztcclxuaW1wb3J0IHsgRW50aXR5TGlzdCB9IGZyb20gJy4vZW50aXR5X2xpc3QnO1xyXG5pbXBvcnQgeyBlbnRpdHlQcm90b3R5cGUgfSBmcm9tICcuL2VudGl0eV9wcm90b3R5cGUnO1xyXG5pbXBvcnQgeyBOR19FTlRJVFksIE5HX0ZJRUxELCBOR19MSVNULCBOR19PQkpFQ1QgfSBmcm9tICcuL21ldGFkYXRhJztcclxuaW1wb3J0IHsgUEFSRU5UX0NMQVNTLCBQQVJFTlRfUEFUSCB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3IgfSBmcm9tICcuL3ZhbGlkYXRvcic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25VdGlscyB9IGZyb20gJy4vdmFsaWRhdG9yL3ZhbGlkYXRpb25fdXRpbHMnO1xyXG5pbXBvcnQgeyBVc2VyU2V0dGluZ3NTZXJ2aWNlIH0gZnJvbSAnLi4vaTE4bi91c2VyX3NldHRpbmdzX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBab25lZFRpbWUgfSBmcm9tICcuLi9pMThuL3pvbmVkX3RpbWUnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBYnN0cmFjdEVudGl0eVR5cGUge1xyXG4gIHR5cGVOYW1lOiBzdHJpbmc7XHJcbiAgdHlwZXM6IGFueTtcclxuICBfX3Byb3BfX21ldGFkYXRhX186IGFueTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOWunuS9k+exu+Wei+W3peWOglxyXG4gKiDnlKjmnaXmoLnmja7lrp7kvZNTY2hlbWHmj4/ov7Dkv6Hmga/liJvlu7rlrp7kvZPnsbvlnotcclxuICovXHJcbmV4cG9ydCBjbGFzcyBFbnRpdHlUeXBlRmFjdG9yeSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcbiAgLyoqXHJcbiAgICog55Sx5a6e5L2TU2NoZW1h57uT5p6E5Yib5bu65a6e5L2T57G75Z6LXHJcbiAgICogQHBhcmFtIHNjaGVtYSDlrp7kvZNTY2hlbWHnu5PmnoRcclxuICAgKiBAcmV0dXJucyDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlKHNjaGVtYTogU2NoZW1hKSB7XHJcbiAgICAvLyDmj5Dlj5ZTY2hlbWHlrprkuYnkuK3nmoTnrKzkuIDkuKrmmK/lrp7kvZPmj4/ov7BcclxuICAgIGNvbnN0IHNjaGVtYVR5cGUgPSBzY2hlbWEuZW50aXRpZXNbMF0udHlwZTtcclxuICAgIC8vIOWIm+W7uuWunuS9k+exu+Wei1xyXG4gICAgY29uc3QgZW50aXR5VHlwZSA9IHRoaXMuY3JlYXRlQ2xhc3Moc2NoZW1hVHlwZSwgc2NoZW1hLmVudGl0aWVzWzBdKTtcclxuICAgIHJldHVybiBlbnRpdHlUeXBlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnlLHlrp7kvZNTY2hlbWHnsbvlnovmj4/ov7DliJvlu7rlrp7kvZPnsbtcclxuICAgKiBAcGFyYW0gc2NoZW1hVHlwZSBTY2hlbWHlrp7kvZPnsbvlnovmj4/ov7BcclxuICAgKiBAcmV0dXJucyDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZUNsYXNzKHNjaGVtYVR5cGU6IFNjaGVtYVR5cGUsIHJlbGF0ZVNjaGVtYTogYW55KSB7XHJcbiAgICBjb25zdCBhdHRhY2hFbnRpdHlJbnN0YW5jZURhdGEgPSB0aGlzLmNyZWF0ZUVudGl0eUluc3RhbmNlRGF0YUluaXRpYWxpemVyKHNjaGVtYVR5cGUpO1xyXG4gICAgLy8g5Yib5bu65oyH5a6a5a6e5L2T57G75Z6L55qE5Yid5aeL5YyW5Ye95pWw77yM55So5p2l5Zyo5a6e5L2T57G75Z6L5p6E6YCg5Ye95pWw5Lit5Li65a6e5L2T5a6e5L6L6LWL5YC8XHJcbiAgICBjb25zdCBpbml0aWFsaXplID0gKGVudGl0eUluc3RhbmNlOiBhbnksIGVudGl0eURhdGE6IGFueSwgZW50aXR5VHlwZUNvbnN0cnVjdG9yOiBhbnkpID0+IHtcclxuICAgICAgZW50aXR5SW5zdGFuY2UuaXNJbml0aWFsaXppbmcgPSB0cnVlO1xyXG4gICAgICBhdHRhY2hFbnRpdHlJbnN0YW5jZURhdGEoZW50aXR5SW5zdGFuY2UsIGVudGl0eURhdGEsIGVudGl0eVR5cGVDb25zdHJ1Y3Rvcik7XHJcbiAgICAgIGVudGl0eUluc3RhbmNlLmlzSW5pdGlhbGl6aW5nID0gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgLy8g5aOw5piO5a6e5L2T57G75p6E6YCg5Ye95pWwXHJcbiAgICBjb25zdCBDb25jcmV0ZUVudGl0eSA9IGZ1bmN0aW9uIChkYXRhOiBhbnkpIHtcclxuICAgICAgLy8g5Yib5bu65a6e5L2T5Y+Y5pu06ZuGXHJcbiAgICAgIHRoaXMuY2hhbmdlU2V0ID0gbmV3IENoYW5nZVNldCgpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrp7kvZPpqozor4HnirbmgIFcclxuICAgICAgdGhpcy5pc1ZhbGlkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgLy8g6K6+572udW5zdWJzY3JpYmUg5Y+W5raI6K6i6ZiF5LqL5Lu2XHJcbiAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrp7kvZPpqozor4Hkv6Hmga9cclxuICAgICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgICAvLyDliJ3lp4vljJbpqozor4HlmahcclxuICAgICAgdGhpcy52YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKCk7XHJcbiAgICAgIC8vIOWIneWni+WMluWunuS9k+aVsOaNruWJr+acrFxyXG4gICAgICB0aGlzLmlubmVyRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xyXG4gICAgICAvLyDliJ3lp4vljJblrZDlrp7kvZPlr7nosaHpm4blkIhcclxuICAgICAgdGhpcy5pbm5lckVudGl0aWVzID0ge307XHJcbiAgICAgIC8vIOWIneWni+WMluWunuS9k+WAvOWPmOWMluS6i+S7tlxyXG4gICAgICB0aGlzLnZhbHVlQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcclxuICAgICAgdGhpcy5vblZhbHVlQ2hhbmdlZCA9IHRoaXMudmFsdWVDaGFuZ2VkO1xyXG4gICAgICB0aGlzLnZhbGlkYXRlRnJvbVV0aWxTeW5jID0gZnVuY3Rpb24gKHByb3BlcnR5TmFtZSwgdmFsdWUsIGNiLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMudmFsaWRhdG9yLnZlcmlmeSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHZhbHVlLCBudWxsLCB1bmRlZmluZWQsIGNvbnRleHQgJiYgY29udGV4dC5mcmFtZUNvbnRleHQgfHwgbnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgaWYgKHJlc3VsdCAmJiAhcmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KHJlc3VsdC5lcnJvcnMsIHt9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2IocmVzdWx0KTtcclxuICAgICAgfTtcclxuICAgICAgLy8g6LCD55So5Yid5aeL5YyW5pa55rOV77yM5Yid5aeL5YyW5a6e5L2T5pWw5o2uXHJcbiAgICAgIGluaXRpYWxpemUodGhpcywgZGF0YSwgQ29uY3JldGVFbnRpdHkpO1xyXG4gICAgICB0aGlzLmxvYWQgPSAobmV3RGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgYXR0YWNoRW50aXR5SW5zdGFuY2VEYXRhKHRoaXMsIG5ld0RhdGEsIENvbmNyZXRlRW50aXR5KTtcclxuICAgICAgICB0aGlzLmRhdGEgPSBuZXdEYXRhO1xyXG4gICAgICB9O1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8g5Zyo5a6e5L2T57G75p6E6YCg5Ye95pWw5Lit6K6w5b2V6KeG5Zu+57G75Z6L5ZCN56ewXHJcbiAgICBDb25jcmV0ZUVudGl0eS50eXBlTmFtZSA9IGAke3NjaGVtYVR5cGUubmFtZX1FbnRpdHlgO1xyXG4gICAgQ29uY3JldGVFbnRpdHkuY29kZSA9IHJlbGF0ZVNjaGVtYS5jb2RlO1xyXG4gICAgQ29uY3JldGVFbnRpdHkubGFiZWwgPSByZWxhdGVTY2hlbWEubGFiZWw7XHJcbiAgICAvLyDlnKjlrp7kvZPnsbvmnoTpgKDlh73mlbDkuK3orrDlvZXlhbbkuIvnm7TmjqXlvJXnlKjnmoTlrZDnsbvlnotcclxuICAgIENvbmNyZXRlRW50aXR5LnR5cGVzID0ge307XHJcbiAgICBDb25jcmV0ZUVudGl0eS5fX3Byb3BfX21ldGFkYXRhX18gPSB7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAvLyDmnoTpgKDlrp7kvZPnsbvnmoTljp/lnovlr7nosaFcclxuICAgIGNvbnN0IGVudGl0eVR5cGVQcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKHsgdHlwZU5hbWU6ICdDb25jcmV0ZUVudGl0eVByb3RvdHlwZScgfSwgZW50aXR5UHJvdG90eXBlKTtcclxuICAgIC8vIOWQkeWunuS9k+exu+WOn+Wei+WvueixoeS4reWumuS5iemihOWItuWxnuaAp1xyXG4gICAgdGhpcy5kZWZpbmVQcmVzZXRQcm9wZXJ0eShlbnRpdHlUeXBlUHJvdG90eXBlLCBzY2hlbWFUeXBlKTtcclxuICAgIC8vIOWQkeWunuS9k+exu+WOn+Wei+WvueixoeS4reWumuS5ieWtl+auteWxnuaAp2dldC9zZXTmlrnms5VcclxuICAgIHRoaXMuZGVmaW5lRmllbGRzVG9Qcm90b3R5cGUoZW50aXR5VHlwZVByb3RvdHlwZSwgc2NoZW1hVHlwZS5maWVsZHMsIHNjaGVtYVR5cGUucHJpbWFyeSwgQ29uY3JldGVFbnRpdHkpO1xyXG4gICAgLy8g5ZCR5a6e5L2T57G75Y6f5Z6L5a+56LGh5Lit5a6a5LmJ6K6/6Zeu5a2Q5a6e5L2T55qEZ2V0L3NldOaWueazlVxyXG4gICAgdGhpcy5kZWZpbmVFbnRpdGllc1RvUHJvdG90eXBlKGVudGl0eVR5cGVQcm90b3R5cGUsIHNjaGVtYVR5cGUuZW50aXRpZXMsIENvbmNyZXRlRW50aXR5KTtcclxuICAgIC8vIOWwhuWunuS9k+exu+eahOWOn+Wei+WvueixoeaMh+WQkeaWsOaehOmAoOeahOWOn+Wei+WvueixoeOAglxyXG4gICAgQ29uY3JldGVFbnRpdHkucHJvdG90eXBlID0gZW50aXR5VHlwZVByb3RvdHlwZTtcclxuXHJcblxyXG4gICAgcmV0dXJuIENvbmNyZXRlRW50aXR5O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlkJHlrp7kvZPnsbvljp/lnovlr7nosaHkuK3lrprkuYnpooTliLblsZ7mgKdcclxuICAgKiBAcGFyYW0gcHJvdG90eXBlT2JqZWN0IOWunuS9k+exu+WOn+Wei+WvueixoVxyXG4gICAqIEBwYXJhbSBzY2hlbWFUeXBlIFNjaGVtYeexu+Wei+aPj+i/sFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lUHJlc2V0UHJvcGVydHkocHJvdG90eXBlT2JqZWN0OiBhbnksIHNjaGVtYVR5cGU6IFNjaGVtYVR5cGUpIHtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdkYXRhJywge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaW5uZXJEYXRhKSB7XHJcbiAgICAgICAgICB0aGlzLmlubmVyRGF0YSA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5pbm5lckRhdGE7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5pbm5lckRhdGEgPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+mqjOivgeS/oeaBr1xyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAnZXJyb3JzJywge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWxpZEVycm9ycztcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAoZXJyb3JzOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnZhbGlkRXJyb3JzID0gZXJyb3JzO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Y+Y5pu06ZuGXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdjaGFuZ2VzJywge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VTZXQuY2hhbmdlcztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+S4u+mUrlxyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAncHJpbWFyeVByb3BlcnR5Jywge1xyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG9ubHktYXJyb3ctZnVuY3Rpb25zXHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIHJldHVybiBzY2hlbWFUeXBlLnByaW1hcnk7XHJcbiAgICAgICAgcmV0dXJuIHByb3RvdHlwZU9iamVjdC5pbm5lclByaW1hcnlQcm9wZXJ0eSB8fCB7IGRhdGFGaWVsZDogc2NoZW1hVHlwZS5wcmltYXJ5IH07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPkuLvplK5cclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ3ByaW1hcnlLZXknLCB7XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogb25seS1hcnJvdy1mdW5jdGlvbnNcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHNjaGVtYVR5cGUucHJpbWFyeSB8fCAnJztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+S4u+mUrueahOWAvFxyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAncHJpbWFyeVZhbHVlJywge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5wcmltYXJ5S2V5KSB7XHJcbiAgICAgICAgICAvLyByZXR1cm4gdGhpc1t0aGlzLnByaW1hcnlQcm9wZXJ0eS5wcm9wZXJ0eV0udG9TdHJpbmcoKTtcclxuICAgICAgICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IHRoaXNbdGhpcy5wcmltYXJ5S2V5XTtcclxuICAgICAgICAgIHJldHVybiBwcmltYXJ5VmFsdWUgPyBwcmltYXJ5VmFsdWUgOiAnJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WumuS5ieWtl+auteWxnuaAp1xyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIGZpZWxkcyDlrZfmrrXmj4/ov7Dpm4blkIhcclxuICAgKiBAcGFyYW0gcGFyZW50RW50aXR5VHlwZSDniLbnsbvlnotcclxuICAgKi9cclxuICBwcml2YXRlIGRlZmluZUZpZWxkc1RvUHJvdG90eXBlKFxyXG4gICAgcHJvdG90eXBlT2JqZWN0OiBhbnksXHJcbiAgICBmaWVsZHM6IFNjaGVtYUVudGl0eUZpZWxkW10sXHJcbiAgICBwcmltYXJ5OiBzdHJpbmcsXHJcbiAgICBwYXJlbnRFbnRpdHlUeXBlOiBBYnN0cmFjdEVudGl0eVR5cGVcclxuICApOiB2b2lkIHtcclxuICAgIGlmIChmaWVsZHMgJiYgZmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAvLyDpgY3ljoZTY2hlbWHkuK3mj4/ov7DnmoTlrZfmrrXvvIzlnKjlrp7kvZPljp/lnovlr7nosaHkuIrlrprkuYnlrZfmrrXorr/pl67lh73mlbBcclxuICAgICAgZmllbGRzLmZvckVhY2goc2NoZW1hRW50aXR5RmllbGQgPT4ge1xyXG4gICAgICAgIHN3aXRjaCAoc2NoZW1hRW50aXR5RmllbGQuJHR5cGUpIHtcclxuICAgICAgICAgIC8vIOWumuS5ieeugOWNleexu+Wei+Wtl+autVxyXG4gICAgICAgICAgY2FzZSBTY2hlbWFFbnRpdHlGaWVsZCRUeXBlLlNpbXBsZUZpZWxkOlxyXG4gICAgICAgICAgICB0aGlzLmRlZmluZVNpbXBsZUZpZWxkVG9Qcm90b3R5cGUocHJvdG90eXBlT2JqZWN0LCBzY2hlbWFFbnRpdHlGaWVsZCwgcHJpbWFyeSwgcGFyZW50RW50aXR5VHlwZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgLy8g5a6a5LmJ5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICAgICAgICBjYXNlIFNjaGVtYUVudGl0eUZpZWxkJFR5cGUuQ29tcGxleEZpZWxkOlxyXG4gICAgICAgICAgICB0aGlzLmRlZmluZUNvbXBsZXhGaWVsZFRvUHJvdG90eXBlKHByb3RvdHlwZU9iamVjdCwgc2NoZW1hRW50aXR5RmllbGQsIHBhcmVudEVudGl0eVR5cGUpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDlkJHlrp7kvZPnsbvlrprkuYnnroDljZXnsbvlnovlrZfmrrVcclxuICAgKiBAcGFyYW0gcHJvdG90eXBlT2JqZWN0IOWunuS9k+exu+WOn+Wei+WvueixoVxyXG4gICAqIEBwYXJhbSBzY2hlbWFGaWVsZCDlrZfmrrXmj4/ov7BcclxuICAgKi9cclxuICBwcml2YXRlIGRlZmluZVNpbXBsZUZpZWxkVG9Qcm90b3R5cGUoXHJcbiAgICBwcm90b3R5cGVPYmplY3Q6IGFueSxcclxuICAgIHNjaGVtYUZpZWxkOiBTY2hlbWFFbnRpdHlGaWVsZCxcclxuICAgIHByaW1hcnk6IHN0cmluZyxcclxuICAgIHBhcmVudEVudGl0eVR5cGU6IEFic3RyYWN0RW50aXR5VHlwZVxyXG4gICkge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gc2NoZW1hRmllbGQubGFiZWw7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRWYWx1ZShzY2hlbWFGaWVsZCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogZnVuY3Rpb24gKG5ld1Byb3BWYWx1ZSkge1xyXG4gICAgICAgIC8vIOWAvOebuOWQjOaXtuS4jeinpuWPkeWPmOabtOOAglxyXG4gICAgICAgIGNvbnN0IG9sZFByb3BWYWx1ZSA9IHRoaXMuZ2V0RmllbGRWYWx1ZShzY2hlbWFGaWVsZCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNGaWVsZFZhbHVlQ2hhbmdlZChzY2hlbWFGaWVsZCwgbmV3UHJvcFZhbHVlLCBvbGRQcm9wVmFsdWUpID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldEZpZWxkVmFsdWUoc2NoZW1hRmllbGQsIG5ld1Byb3BWYWx1ZSk7XHJcbiAgICAgICAgdGhpcy5lbWl0RmllbGRWYWx1ZUNoYW5nZShzY2hlbWFGaWVsZCwgbmV3UHJvcFZhbHVlLCBvbGRQcm9wVmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGZpZWxkTWV0YWRhdGEgPSB7XHJcbiAgICAgIC8qKiDlrZfmrrXlkI3np7AgKi9cclxuICAgICAgZGF0YUZpZWxkOiB0aGlzLmdldERhdGFGaWVsZChzY2hlbWFGaWVsZCksXHJcbiAgICAgIC8qKiDljp/lp4vlrZfmrrXlkI3np7AgKi9cclxuICAgICAgb3JpZ2luYWxEYXRhRmllbGQ6IHNjaGVtYUZpZWxkLmNvZGUsXHJcbiAgICAgIC8qKiDljp/lp4vlrZfmrrXnsbvlnosgKi9cclxuICAgICAgb3JpZ2luYWxEYXRhRmllbGRUeXBlOiBzY2hlbWFGaWVsZC50eXBlLm5hbWUsXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiDljp/lp4vlrZfmrrVcclxuICAgICAgICogQGRlc2NyaXB0aW9uIOWvueW6lOWIsHNjaGVtZeeahHBhdGjlsZ7mgKdcclxuICAgICAgICovXHJcbiAgICAgIHBhdGg6IHNjaGVtYUZpZWxkLnBhdGgsXHJcbiAgICAgIHByaW1hcnk6IHNjaGVtYUZpZWxkLmxhYmVsID09PSBwcmltYXJ5LFxyXG4gICAgICBlbmFibGVNdWx0aUxhbmdJbnB1dDogdGhpcy5nZXRFbmFibGVNdWx0aUxhbmdJbnB1dChzY2hlbWFGaWVsZCksXHJcbiAgICAgIGRlZmF1bHRWYWx1ZTogc2NoZW1hRmllbGQuZGVmYXVsdFZhbHVlLFxyXG4gICAgICBuZ01ldGFkYXRhTmFtZTogTkdfRklFTERcclxuICAgIH07XHJcbiAgICBpZiAoc2NoZW1hRmllbGRbJ2VuYWJsZVN0ZFRpbWVGb3JtYXQnXSAmJiBmaWVsZE1ldGFkYXRhLm9yaWdpbmFsRGF0YUZpZWxkVHlwZSA9PSBcIkRhdGVUaW1lXCIpIHtcclxuICAgICAgZmllbGRNZXRhZGF0YVtcImVuYWJsZVRpbWVab25lXCJdID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmIChmaWVsZE1ldGFkYXRhLnByaW1hcnkpIHtcclxuICAgICAgcHJvdG90eXBlT2JqZWN0LmlubmVyUHJpbWFyeVByb3BlcnR5ID0gZmllbGRNZXRhZGF0YTtcclxuICAgIH1cclxuICAgIGlmICghcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdID0gW107XHJcbiAgICB9XHJcbiAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdLnB1c2goZmllbGRNZXRhZGF0YSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldERhdGFGaWVsZChzY2hlbWFGaWVsZDogU2NoZW1hRW50aXR5RmllbGQpIHtcclxuICAgIGlmIChzY2hlbWFGaWVsZC5tdWx0aUxhbmd1YWdlKSB7XHJcbiAgICAgIHJldHVybiBzY2hlbWFGaWVsZC5sYWJlbCArIFwiX1wiICsgXCJNVUxUSUxBTkdVQUdFXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2NoZW1hRmllbGQubGFiZWw7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEVuYWJsZU11bHRpTGFuZ0lucHV0KHNjaGVtYUZpZWxkOiBTY2hlbWFFbnRpdHlGaWVsZCkge1xyXG4gICAgaWYgKHNjaGVtYUZpZWxkLm11bHRpTGFuZ3VhZ2UpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlkJHlrp7kvZPnsbvlrprkuYnlpI3mnYLnsbvlnovlrZfmrrVcclxuICAgKiBAcGFyYW0gcHJvdG90eXBlT2JqZWN0IOWunuS9k+exu+WOn+Wei+WvueixoVxyXG4gICAqIEBwYXJhbSBzY2hlbWFGaWVsZCDlrZfmrrXmj4/ov7BcclxuICAgKiBAcGFyYW0gcGFyZW50RW50aXR5VHlwZSDniLbnsbvlnotcclxuICAgKi9cclxuICBwcml2YXRlIGRlZmluZUNvbXBsZXhGaWVsZFRvUHJvdG90eXBlKHByb3RvdHlwZU9iamVjdDogYW55LCBzY2hlbWFGaWVsZDogU2NoZW1hRW50aXR5RmllbGQsIHBhcmVudEVudGl0eVR5cGU6IEFic3RyYWN0RW50aXR5VHlwZSkge1xyXG4gICAgY29uc3QgY29tcGxleEZpZWxkVHlwZSA9IHRoaXMuY3JlYXRlQ2xhc3Moc2NoZW1hRmllbGQudHlwZSwgc2NoZW1hRmllbGQpO1xyXG4gICAgcGFyZW50RW50aXR5VHlwZS50eXBlc1tzY2hlbWFGaWVsZC50eXBlLm5hbWVdID0gY29tcGxleEZpZWxkVHlwZTtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHNjaGVtYUZpZWxkLmxhYmVsO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IGZpZWxkVmFsdWUgPSB0aGlzLmdldENvbXBsZXhGaWVsZFZhbHVlKHNjaGVtYUZpZWxkKTtcclxuICAgICAgICByZXR1cm4gZmllbGRWYWx1ZTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMuc2V0Q29tcGxleEZpZWxkVmFsdWUoc2NoZW1hRmllbGQsIGNvbXBsZXhGaWVsZFR5cGUsIHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0ge1xyXG4gICAgICAvKiog5pig5bCE5a2X5q61ICovXHJcbiAgICAgIGRhdGFGaWVsZDogc2NoZW1hRmllbGQubGFiZWwsXHJcbiAgICAgIC8qKiDljp/lp4vlrZfmrrXlkI3np7AgKi9cclxuICAgICAgb3JpZ2luYWxEYXRhRmllbGQ6IHNjaGVtYUZpZWxkLmNvZGUsXHJcbiAgICAgIC8qKiDlvJXnlKjlrp7kvZPnsbvlnosgKi9cclxuICAgICAgdHlwZTogY29tcGxleEZpZWxkVHlwZSxcclxuICAgICAgLyoqXHJcbiAgICAgICAqIOWOn+Wni+Wtl+autVxyXG4gICAgICAgKiBAZGVzY3JpcHRpb24g5a+55bqU5Yiwc2NoZW1l55qEcGF0aOWxnuaAp1xyXG4gICAgICAgKi9cclxuICAgICAgcGF0aDogc2NoZW1hRmllbGQucGF0aCxcclxuICAgICAgbmdNZXRhZGF0YU5hbWU6IE5HX09CSkVDVFxyXG4gICAgfTtcclxuICAgIGlmICghcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdID0gW107XHJcbiAgICB9XHJcbiAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdLnB1c2goZmllbGRNZXRhZGF0YSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WumuS5ieWtkOWunuS9k1xyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIGVudGl0aWVzIOWunuS9k+aPj+i/sOmbhuWQiFxyXG4gICAqIEBwYXJhbSBwYXJlbnRFbnRpdHlUeXBlIOeItuexu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lRW50aXRpZXNUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3Q6IGFueSwgZW50aXRpZXM6IFNjaGVtYUVudGl0eVtdLCBwYXJlbnRFbnRpdHlUeXBlOiBBYnN0cmFjdEVudGl0eVR5cGUpIHtcclxuICAgIGlmIChlbnRpdGllcyAmJiBlbnRpdGllcy5sZW5ndGgpIHtcclxuICAgICAgLy8g6YGN5Y6GU2NoZW1h5Lit5o+P6L+w55qE5a2Q5a6e5L2T77yM5Zyo5a6e5L2T5a+56LGh5LiK5a6a5LmJ5a2Q5a6e5L2T5YiX6KGoXHJcbiAgICAgIGVudGl0aWVzLmZvckVhY2goc2NoZW1hRW50aXR5ID0+IHtcclxuICAgICAgICBjb25zdCBjb21wbGV4RmllbGRUeXBlID0gdGhpcy5jcmVhdGVDbGFzcyhzY2hlbWFFbnRpdHkudHlwZSwgc2NoZW1hRW50aXR5KTtcclxuICAgICAgICBwYXJlbnRFbnRpdHlUeXBlLnR5cGVzW3NjaGVtYUVudGl0eS50eXBlLm5hbWVdID0gY29tcGxleEZpZWxkVHlwZTtcclxuICAgICAgICAvLyDmj5Dlj5blrZDlrp7kvZPlnKjlrp7kvZPlr7nosaHkuIrnmoTlsZ7mgKflkI1cclxuICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBzY2hlbWFFbnRpdHkubGFiZWw7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc3QgZmllbGRWYWx1ZSA9IHRoaXMuZ2V0RW50aXRpZXMoc2NoZW1hRW50aXR5KTtcclxuICAgICAgICAgICAgcmV0dXJuIGZpZWxkVmFsdWU7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWU6IGFueSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldEVudGl0aWVzKHNjaGVtYUVudGl0eSwgdmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IGVudGl0TWV0YWRhdGEgPSB7XHJcbiAgICAgICAgICAvKiog5a2X5q615ZCN56ewICovXHJcbiAgICAgICAgICBkYXRhRmllbGQ6IHNjaGVtYUVudGl0eS5sYWJlbCxcclxuICAgICAgICAgIC8qKiDljp/lp4vlrZfmrrXlkI3np7AgKi9cclxuICAgICAgICAgIG9yaWdpbmFsRGF0YUZpZWxkOiAnJyxcclxuICAgICAgICAgIC8qKiDlrp7kvZPnsbvlnosgKi9cclxuICAgICAgICAgIHR5cGU6IGNvbXBsZXhGaWVsZFR5cGUsXHJcbiAgICAgICAgICBuZ01ldGFkYXRhTmFtZTogTkdfTElTVFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKCFwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgICBwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0ucHVzaChlbnRpdE1ldGFkYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuWIneWni+WMluWunuS9k+WvueixoeaWueazlVxyXG4gICAqIEBwYXJhbSBzY2hlbWFUeXBlIOWunuS9k+exu+Wei+aPj+i/sFxyXG4gICAqIEByZXR1cm5zIOWIneWni+WMluWunuS9k+WvueixoeaWueazlVxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlRW50aXR5SW5zdGFuY2VEYXRhSW5pdGlhbGl6ZXIoc2NoZW1hVHlwZTogU2NoZW1hVHlwZSkge1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPliJ3lp4vljJblh73mlbDvvIznlKjmnaXliJ3lp4vljJblrp7kvZPnmoTlpI3mnYLnsbvlnovmlbDmja7lkozlrZDlrp7kvZPmlbDmja5cclxuICAgICAqIEBwYXJhbSBlbnRpdHlJbnN0YW5jZSDlrp7kvZPnsbvlnovlrp7kvotcclxuICAgICAqIEBwYXJhbSBkYXRhIOWunuS9k+WOn+Wni+aVsOaNrlxyXG4gICAgICogQHBhcmFtIGVudGl0eVR5cGVDb25zdHJ1Y3RvciDlrp7kvZPnsbvlnovmnoTpgKDlh73mlbBcclxuICAgICAqL1xyXG4gICAgY29uc3QgaW5pdGlhbGl6ZXIgPSAoZW50aXR5SW5zdGFuY2U6IGFueSwgZW50aXR5RGF0YTogYW55LCBlbnRpdHlUeXBlQ29uc3RydWN0b3I6IGFueSkgPT4ge1xyXG4gICAgICAvLyDliJ3lp4vljJblpI3mnYLnsbvlnovlrZfmrrVcclxuICAgICAgc2NoZW1hVHlwZS5maWVsZHNcclxuICAgICAgICAvLyDov4fmu6TlpI3mnYLnsbvlnovlrZfmrrVcclxuICAgICAgICAuZmlsdGVyKGZpZWxkID0+IGZpZWxkLiR0eXBlID09PSBTY2hlbWFFbnRpdHlGaWVsZCRUeXBlLkNvbXBsZXhGaWVsZClcclxuICAgICAgICAvLyDpgY3ljoblpI3mnYLnsbvlnovlrZfmrrXliJvlu7rlr7nlupTlrp7kvZPnsbvlnovmlbDmja5cclxuICAgICAgICAuZm9yRWFjaChmaWVsZCA9PiB7XHJcbiAgICAgICAgICAvLyDmj5Dlj5blrZfmrrXlkI1cclxuICAgICAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IGZpZWxkLmxhYmVsO1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a6e5L2T57G75Z6L5LiL55qE5omA5pyJ5a2Q5a6e5L2T57G75Z6LXHJcbiAgICAgICAgICBjb25zdCBpbmNsdWRlZEVudGl0eVR5cGVzID0gZW50aXR5VHlwZUNvbnN0cnVjdG9yLnR5cGVzO1xyXG4gICAgICAgICAgLy8g6I635Y+W5aSN5p2C57G75Z6L5a2X5q615a+55bqU55qE5a6e5L2T57G75Z6LXHJcbiAgICAgICAgICBjb25zdCBDb21wbGV4RmllbGQgPSBpbmNsdWRlZEVudGl0eVR5cGVzW2ZpZWxkLnR5cGUubmFtZV07XHJcbiAgICAgICAgICAvLyDmj5Dlj5blpI3mnYLnsbvlnovlrZfmrrXljp/lp4vmlbDmja5cclxuICAgICAgICAgIGNvbnN0IGZpZWxkRGF0YSA9IGVudGl0eURhdGEgPyBlbnRpdHlEYXRhW2ZpZWxkTmFtZV0gOiBudWxsO1xyXG4gICAgICAgICAgLy8g5Yib5bu65aSN5p2C57G75Z6L5a2X5q615a+56LGh6Lev5b6EXHJcbiAgICAgICAgICBjb25zdCBwYXRoID0gZW50aXR5SW5zdGFuY2UuY3JlYXRlUGF0aChmaWVsZE5hbWUpO1xyXG4gICAgICAgICAgbGV0IGNvbXBsZXhGaWVsZFZhbHVlID0gZW50aXR5SW5zdGFuY2VbZmllbGROYW1lXTtcclxuICAgICAgICAgIGlmIChjb21wbGV4RmllbGRWYWx1ZSBpbnN0YW5jZW9mIENvbXBsZXhGaWVsZCkge1xyXG4gICAgICAgICAgICBjb21wbGV4RmllbGRWYWx1ZS5sb2FkKGZpZWxkRGF0YSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDliJvlu7rlpI3mnYLnsbvlnovlrZfmrrXlrp7kvZPlrp7kvotcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUgPSBuZXcgQ29tcGxleEZpZWxkKGZpZWxkRGF0YSk7XHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlLmNvbnN0cnVjdG9yID0gQ29tcGxleEZpZWxkO1xyXG4gICAgICAgICAgICBjb21wbGV4RmllbGRWYWx1ZVtQQVJFTlRfQ0xBU1NdID0gZW50aXR5SW5zdGFuY2U7XHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlW1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlLm9uVmFsdWVDaGFuZ2VkLnN1YnNjcmliZShjaGFuZ2VzID0+IHtcclxuICAgICAgICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICAgICAgY2hhbmdlcy5wYXRoID0gKGVudGl0eUluc3RhbmNlW1BBUkVOVF9QQVRIXSB8fCBbXSkuY29uY2F0KGNoYW5nZXMucGF0aCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RpZmljYXRpb24gPSB7IC4uLmNoYW5nZXMsIGZyb21QYXJlbnQ6IHRydWUgfTtcclxuICAgICAgICAgICAgICAgIGVudGl0eUluc3RhbmNlLnNldENoYW5nZXMobW9kaWZpY2F0aW9uKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBlbnRpdHlJbnN0YW5jZVtmaWVsZE5hbWVdID0gY29tcGxleEZpZWxkVmFsdWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIC8vIOWIneWni+WMluWtkOWunuS9k1xyXG4gICAgICBpZiAoc2NoZW1hVHlwZS5lbnRpdGllcykge1xyXG4gICAgICAgIC8vIOmBjeWOhuWtkOWunuS9k+WIm+W7uuWvueW6lOWunuS9k+exu+Wei+eahOaVsOaNrlxyXG4gICAgICAgIHNjaGVtYVR5cGUuZW50aXRpZXMuZm9yRWFjaChzY2hlbWFFbnRpdHkgPT4ge1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a2Q5a6e5L2T5ZCNXHJcbiAgICAgICAgICBjb25zdCBzdWJFbnRpdHlOYW1lID0gc2NoZW1hRW50aXR5LmxhYmVsO1xyXG4gICAgICAgICAgLy8g5o+Q5Y+W5a6e5L2T57G75Z6L5LiL55qE5omA5pyJ5a2Q5a6e5L2T57G75Z6LXHJcbiAgICAgICAgICBjb25zdCBpbmNsdWRlZEVudGl0eVR5cGVzID0gZW50aXR5VHlwZUNvbnN0cnVjdG9yLnR5cGVzO1xyXG4gICAgICAgICAgLy8g5Yib5bu65a2Q5a6e5L2T5a+56LGh6Lev5b6EXHJcbiAgICAgICAgICBjb25zdCBwYXRoID0gZW50aXR5SW5zdGFuY2UuY3JlYXRlUGF0aChzdWJFbnRpdHlOYW1lKTtcclxuICAgICAgICAgIC8vIOWIm+W7uuWtkOWunuS9k+WvueixoembhuWQiFxyXG4gICAgICAgICAgbGV0IGVudGl0eUxpc3QgPSBlbnRpdHlJbnN0YW5jZVtzdWJFbnRpdHlOYW1lXTtcclxuICAgICAgICAgIGlmICghKGVudGl0eUxpc3QgaW5zdGFuY2VvZiBFbnRpdHlMaXN0KSkge1xyXG4gICAgICAgICAgICBlbnRpdHlMaXN0ID0gbmV3IEVudGl0eUxpc3Q8RW50aXR5PigpO1xyXG4gICAgICAgICAgICAvLyDlkJHlrZDlrp7kvZPliJfooajms6jlhozlrZDlrp7kvZPlj5jljJbkuovku7ZcclxuICAgICAgICAgICAgZW50aXR5TGlzdC5vbkxpc3RDaGFuZ2VkLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5TGlzdFtQQVJFTlRfUEFUSF1bMF0gIT09IHZhbHVlLnBhdGhbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgdmFsdWUucGF0aCA9IGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdLmNvbmNhdCh2YWx1ZS5wYXRoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVudGl0eUluc3RhbmNlLnNldENoYW5nZXModmFsdWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOWQkeWunuS9k+exu+Wei+WunuS+i+S4iuebtOaOpeWtmOWCqOWtkOWunuS9k+WvueixoeWIl+ihqFxyXG4gICAgICAgICAgICBlbnRpdHlJbnN0YW5jZVtzdWJFbnRpdHlOYW1lXSA9IGVudGl0eUxpc3Q7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbnRpdHlMaXN0W1BBUkVOVF9DTEFTU10gPSBlbnRpdHlUeXBlQ29uc3RydWN0b3I7XHJcbiAgICAgICAgICBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcbiAgICAgICAgICAvLyDmj5Dlj5blrZDlrp7kvZPnsbvlnovlkI3np7BcclxuICAgICAgICAgIGNvbnN0IHNjaGVtYUVudGl0eVR5cGVOYW1lID0gc2NoZW1hRW50aXR5LnR5cGUubmFtZTtcclxuICAgICAgICAgIC8vIOiOt+WPluWtkOWunuS9k+exu+Wei1xyXG4gICAgICAgICAgY29uc3QgQ29uY3JldGVFbnRpdHkgPSBpbmNsdWRlZEVudGl0eVR5cGVzW3NjaGVtYUVudGl0eVR5cGVOYW1lXTtcclxuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRW50aXR5RGF0YUFycmF5ID0gZW50aXR5RGF0YSA/IGVudGl0eURhdGFbc3ViRW50aXR5TmFtZV0gOiBudWxsO1xyXG4gICAgICAgICAgLy8g5p6E6YCg5a2Q5a6e5L2T6ZuG5ZCIXHJcbiAgICAgICAgICBpZiAob3JpZ2luYWxFbnRpdHlEYXRhQXJyYXkpIHtcclxuICAgICAgICAgICAgLy8g6YGN5Y6G5a2Q5a6e5L2T5Y6f5aeL5pWw5o2u77yM5p6E6YCg5a6e5L2T5a+56LGh6ZuG5ZCIXHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gb3JpZ2luYWxFbnRpdHlEYXRhQXJyYXkubWFwKChvcmlnaW5hbEVudGl0eURhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGNvbmNyZXRlRW50aXR5SW5zdGFuY2UgPSBuZXcgQ29uY3JldGVFbnRpdHkob3JpZ2luYWxFbnRpdHlEYXRhKTtcclxuICAgICAgICAgICAgICBjb25jcmV0ZUVudGl0eUluc3RhbmNlLmNvbnN0cnVjdG9yID0gQ29uY3JldGVFbnRpdHk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbmNyZXRlRW50aXR5SW5zdGFuY2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyDlkJHlrZDlrp7kvZPliJfooajkuK3mt7vliqDlrZDlrp7kvZPlr7nosaFcclxuICAgICAgICAgICAgZW50aXR5TGlzdC5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOWIneWni+WMlueugOWNleWtl+autVxyXG4gICAgICBzY2hlbWFUeXBlLmZpZWxkc1xyXG4gICAgICAgIC8vIOi/h+a7pOWkjeadguexu+Wei+Wtl+autVxyXG4gICAgICAgIC5maWx0ZXIoZmllbGQgPT4gZmllbGQuJHR5cGUgPT09IFNjaGVtYUVudGl0eUZpZWxkJFR5cGUuU2ltcGxlRmllbGQpXHJcbiAgICAgICAgLy8g6YGN5Y6G5aSN5p2C57G75Z6L5a2X5q615Yib5bu65a+55bqU5a6e5L2T57G75Z6L5pWw5o2uXHJcbiAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XHJcbiAgICAgICAgICAvLyDmj5Dlj5blrZfmrrXlkI1cclxuICAgICAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IGZpZWxkLmxhYmVsO1xyXG4gICAgICAgICAgbGV0IHByb3BWYWx1ZSA9IGVudGl0eURhdGEgPyBlbnRpdHlEYXRhW2ZpZWxkTmFtZV0gOiBudWxsO1xyXG4gICAgICAgICAgaWYgKGZpZWxkWydlbmFibGVUaW1lWm9uZSddID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRpbWVab25lT2Zmc2V0ID0gVXNlclNldHRpbmdzU2VydmljZS5nZXRUaW1lWm9uZU9mZnNldCgpO1xyXG4gICAgICAgICAgICBpZiAodGltZVpvbmVPZmZzZXQgIT09IG51bGwgJiYgcHJvcFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgcHJvcFZhbHVlID0gWm9uZWRUaW1lLnpvbmVkVGltZVRvU3BlY2lhbFRpbWVab25lT2Zmc2V0VGltZVN0cmluZyhwcm9wVmFsdWUsIHRpbWVab25lT2Zmc2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZW50aXR5SW5zdGFuY2VbZmllbGROYW1lXSA9IHByb3BWYWx1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gaW5pdGlhbGl6ZXI7XHJcbiAgfVxyXG59XHJcbiJdfQ==
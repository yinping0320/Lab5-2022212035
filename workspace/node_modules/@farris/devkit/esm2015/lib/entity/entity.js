import { Subject, from } from 'rxjs';
import { tap } from 'rxjs/operators';
import { FieldMetadataUtil } from './metadata/index';
import { ModifyType, ChangeSet } from '../changeset/index';
import { PARENT_PATH, PARENT_CLASS } from './types';
import { EntityList } from './entity_list';
import { EntityFactory } from './entity_factory';
import { Validator } from './validator/index';
import { ValidationUtils } from './validator/validation_utils';
import { BigNumberType, RunMode } from '../core/types';
import { UserSettingsService } from '../i18n/user_settings_service';
import { ZonedTime } from '../i18n/zoned_time';
import { RunModeService } from '../misc';
/**
 * @author Lucas Huang
 * 实体抽象基类，所有实体必须扩展自Entity
 *
 * ### 使用示例
 * ```
 * export class UserEntity extends Entity {
 *    userId: string;
 *    userName: string;
 *
 *    constructor(data: any){
 *        super(data);
 *    }
 * }
 * ```
 */
export class Entity {
    // #endregion
    /**
     * @param data JSON数据
     */
    constructor(data) {
        // #region 私有、保护属性
        /**
         * 验证错误集合
         */
        this.validErrors = {};
        this.primaryFieldMetadata = null;
        this.originalData = undefined;
        /**
         * 增量变更集合
         */
        this.changeSet = new ChangeSet();
        /**
         * 是否正在验证
         */
        this.isValidating = false;
        /**
         * 新数据
         */
        this.newData = undefined;
        /**
         * 销毁流
         */
        this.unsubscribe = new Subject();
        // #endregion
        // #region 公有属性
        /**
         * 变更流
         */
        this.valueChanged = new Subject();
        /**
         * 属性值改变时触发
         *
         * ### 使用示例
         * ```
         *  const entity = new UserEntity(data);
         *  entity.onValueChanged.subscribe((data: Modification) => {
         *      console.log(data);
         *  })
         *
         * ```
         *
         * @event
         */
        this.onValueChanged = this.valueChanged.asObservable();
        this.onUpdate = new Subject();
        this.validator = new Validator();
        this.newData = Object.assign({}, data);
        this.originalData = Object.assign({}, data);
        this.onValueChanged = this.valueChanged;
        // this.onValueChanged = this.valueChanged.pipe(
        //     scan((x: Modification, curr: Modification) => {
        //         if (x) {
        //             if (isEqual(x.path, curr.path) && x.type === curr.type) {
        //                 return Object.assign(x, curr);
        //             }
        //             return curr;
        //         }
        //         return curr;
        //     })
        // );
        if (RunModeService.getRunMode() === RunMode.compatible) {
            this.initialize();
        }
        // this.validate();
    }
    /**
     * 返回JSON格式的数据
     */
    get data() {
        return this.newData;
    }
    set data(value) {
        this.newData = value;
    }
    /**
     * 验证错误集合
     */
    get errors() {
        return this.validErrors;
    }
    set errors(errors) {
        this.validErrors = errors;
    }
    set changeSetPolicy(policy) {
        this._changeSetPolicy = policy;
    }
    get changeSetPolicy() {
        return this._changeSetPolicy;
    }
    /**
     * 实体变更集
     */
    get changes() {
        return this.changeSet.changes;
    }
    /**
     * 实体主键元数据
     */
    get primaryProperty() {
        if (!this.primaryFieldMetadata) {
            this.primaryFieldMetadata = FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);
        }
        return this.primaryFieldMetadata;
    }
    /**
     * 主键
     * @todo
     * 1、没有主键时返回''不合理，应该返回undefined
     */
    get primaryKey() {
        if (this.primaryProperty) {
            return this.primaryProperty.property;
        }
        else {
            return '';
        }
    }
    /**
     * 实体主键值
     * 1、没有主键时返回''不合理，应该返回undefined
     */
    get primaryValue() {
        if (this.primaryKey) {
            // return this[this.primaryProperty.property].toString();
            const primaryValue = this[this.primaryProperty.property];
            return primaryValue ? primaryValue : '';
        }
        else {
            return '';
        }
    }
    // #region 公有方法
    /**
     * 将变更记录保存至变更集中
     * @param value 变更记录
     */
    setChanges(value) {
        const propertyName = value.path[value.path.length - 1];
        // @todo：事件会从下级向上冒泡，change可能是下级的，不能和当前Entity的newData合并。
        // this.newData = Object.assign(this.newData, { [propertyName]: value.value });
        this.valueChanged.next(value);
        if (!(this.validErrors && Object.keys(this.validErrors).includes(propertyName) && this.changeSetPolicy === 'valid')) {
            if (value && value.changeSetValue !== undefined) {
                value = JSON.parse(JSON.stringify(value));
                value.value = value.changeSetValue;
            }
            this.changeSet.append(value);
        }
    }
    /**
     * 校验实体各属性的值
     * @param propertyName 属性名称，如果为空，则验证实体中所有设置了验证规则的属性
     * @returns Observable<ValidationResult>
     * ### 示例
     * ```
     *  const entity = new UserEntity(data);
     *  entity.validate().subscribe(result =>{
     *      if(result.isValid){
     *          ...
     *      } else {
     *          console.log(result.message);
     *      }
     *  })
     *
     * ```
     */
    // tslint:disable-next-line: max-line-length
    validate(propertyName, value, externalRules, index, frameContext) {
        return from(this.validator.validate(this, propertyName, value, externalRules, index, frameContext)).pipe(tap(result => {
            if (!result.isValid) {
                this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
            }
            else {
                this.validErrors = {};
            }
        }));
    }
    validateAll(validateContext) {
    }
    // 用于在entity_util中调用，如果有错误，会将验证结果传入回调cb
    validateFromUtil(propertyName, value, cb, context) {
        this.validErrors = {};
        from(this.validator.validate(this, propertyName, value, null, undefined, context && context.frameContext || null)).subscribe(result => {
            if (!result.isValid) {
                this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
            }
            // 不应重新赋值，这里仅是实体校验通过
            /*else {
              // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
              if (this[propertyName] === value) {
                return;
              }
              this[propertyName] = value;
            }*/
            cb(result);
        });
    }
    /**
     * 同步校验
     * @param propertyName
     * @param value
     * @param cb
     */
    validateFromUtilSync(propertyName, value, cb, context) {
        this.validErrors = {};
        const result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
        if (result && !result.isValid) {
            this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
        }
        cb(result);
    }
    getPaths() {
        const pathObj = {
            path: [],
            isUdt: false,
            isGrid: false
        };
        const handleParent = item => {
            const parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                const prop = parentPaths[parentPaths.length - 1];
                // 父级所在实体包含的ngObject，存在当前实体字段，则判断为UDt字段
                if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {
                    pathObj.isUdt = true;
                }
                // 存在类型为ngList，则判断为grid
                if (item instanceof EntityList === true) {
                    pathObj.isGrid = true;
                }
                else {
                    pathObj.path.push(prop);
                }
            }
            if (item[PARENT_CLASS]) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        pathObj.path = pathObj.path.reverse();
        return pathObj;
    }
    getEntityListPath() {
        let paths = [];
        const handleParent = (item) => {
            const parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                if (item instanceof EntityList === true) {
                    const path = parentPaths.concat([]).reverse();
                    Array.prototype.push.apply(paths, path);
                }
            }
            if (item[PARENT_CLASS]) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        return paths.reverse();
    }
    getMainEntityPrimaryValue() {
        let item = this;
        while (item[PARENT_CLASS]) {
            item = item[PARENT_CLASS];
        }
        return item.primaryValue;
    }
    /**
     * 加载数据
     * @param data 新数据
     */
    load(data, options = {}) {
        if (!data) {
            data = {};
        }
        this.loadFields(data);
        if (!options || (options && options.loadChild !== false)) {
            this.loadLists(data);
        }
        this.loadObjects(data);
        this.loadDynamicObjects(data);
        this.newData = Object.assign({}, data);
        this.originalData = Object.assign({}, data);
    }
    /**
     * 转换为JSON
     * @param buildChanges 是否构造变更集
     * @param includeMultiLanguageField 是否包含多语字段
     */
    toJSON(buildChanges) {
        const result = {};
        // 简单属性
        const ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach((propName) => {
            const ngField = ngFields[propName];
            const dataField = ngField.dataField || propName;
            if (buildChanges === true && ngField.enableTimeZone === true) {
                result[dataField] = this.data[propName];
            }
            else {
                result[dataField] = this[propName];
            }
        });
        // 对象属性
        const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach((propName) => {
            const ngObject = ngObjects[propName];
            const dataField = ngObject.dataField || propName;
            result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};
        });
        // 动态属性
        const ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamics).forEach((propName) => {
            const ngDynamic = ngDynamics[propName];
            const dataField = ngDynamic.dataField || propName;
            result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};
        });
        // 列表属性
        const ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach((propName) => {
            const ngList = ngLists[propName];
            const dataField = ngList.dataField || propName;
            result[dataField] = this[propName] ? this[propName].toJSON(buildChanges) : {};
        });
        return result;
    }
    // #endregion
    //#region 实体初始化相关private方法
    /**
     * 初始化实体
     */
    initialize() {
        const constructor = this.constructor;
        const ngFields = FieldMetadataUtil.getNgFields(constructor);
        const ngObjects = FieldMetadataUtil.getNgObjects(constructor);
        const ngLists = FieldMetadataUtil.getNgList(constructor);
        const ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);
        this.initializeNormalField(ngFields);
        this.initializeList(ngLists);
        this.initializeObject(ngObjects);
        this.initializeDynamic(ngDynamic);
    }
    /**
     * 创建path
     * @param propertyName 属性名称
     */
    createPath(propertyName) {
        const primaryFieldMetadata = this.primaryProperty;
        if (primaryFieldMetadata) {
            const primaryDataField = primaryFieldMetadata.dataField;
            return [primaryDataField + ':' + this.primaryValue, propertyName];
        }
        else {
            return [':', propertyName];
        }
    }
    /**
     * 属性字段初始化
     * @param ngFields 属性字段元数据
     */
    initializeNormalField(ngFields) {
        Object.keys(ngFields).forEach(propName => {
            const ngField = ngFields[propName];
            const dataField = ngField.dataField || propName;
            if (delete this[propName]) {
                Object.defineProperty(this, propName, {
                    get: function () {
                        const value = this.getPropValue(propName, ngField);
                        return value;
                    },
                    set: function (newPropValue) {
                        // 值相同时不触发变更。
                        const oldPropValue = this.getPropValue(propName, ngField);
                        if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {
                            return;
                        }
                        this.setPropValue(propName, ngField, newPropValue);
                        const changeSetValue = this.preparePropValue(propName, ngField, newPropValue);
                        this.emitValueChange(propName, ngField, newPropValue, oldPropValue, changeSetValue);
                    }
                });
            }
        });
    }
    /**
     * 初始化列表类型的元数据
     * @param ngListMetadata 列表类型元数据
     */
    initializeList(ngListMetadata) {
        Object.keys(ngListMetadata).forEach(propertyName => {
            const fieldMetadata = ngListMetadata[propertyName];
            const path = this.createPath(propertyName);
            const dataField = fieldMetadata.dataField || propertyName;
            const val = this.data[dataField];
            const entityList = new EntityList();
            entityList[PARENT_CLASS] = this;
            entityList[PARENT_PATH] = path;
            if (val) {
                const entities = val.map(v => EntityFactory(fieldMetadata.type, v));
                entityList.loadEntities(entities);
            }
            entityList.onListChanged.subscribe(value => {
                if (value) {
                    if (entityList[PARENT_PATH][0] !== value.path[0]) {
                        value.path = entityList[PARENT_PATH].concat(value.path);
                    }
                    this.setChanges(value);
                }
            });
            this[propertyName] = entityList;
        });
    }
    /**
     * 初始化子对象
     * @param ngObjectMetadata 子对象元数据
     */
    initializeObject(ngObjectMetadata) {
        Object.keys(ngObjectMetadata).forEach(propertyName => {
            const fieldMetadata = ngObjectMetadata[propertyName];
            const path = this.createPath(propertyName);
            const dataField = fieldMetadata.dataField || propertyName;
            // val不存在时，用空对象代替
            const val = this.data[dataField] || {};
            const createEntityFromJsonData = (value) => {
                let instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(changes => {
                    if (changes) {
                        changes.path = (this[PARENT_PATH] || []).concat(changes.path);
                        this.setChanges(changes);
                    }
                });
                return instance;
            };
            // 如果没有值用一个空对象代替
            let childEntity = createEntityFromJsonData(val);
            if (delete this[propertyName]) {
                Object.defineProperty(this, propertyName, {
                    get: () => {
                        return childEntity;
                    },
                    set: function (value) {
                        const modifyInfo = {
                            path: childEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        childEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    }
                });
            }
        });
    }
    initializeDynamic(ngDynamicMetadata) {
        Object.keys(ngDynamicMetadata).forEach(propertyName => {
            const fieldMetadata = ngDynamicMetadata[propertyName];
            const path = this.createPath(propertyName);
            const dataField = fieldMetadata.dataField || propertyName;
            const originalData = this.data[dataField] || {};
            const createEntityFromJsonData = (value) => {
                let instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(changes => {
                    if (changes) {
                        changes.path = (this[PARENT_PATH] || []).concat(changes.path);
                        this.setChanges(changes);
                    }
                });
                return instance;
            };
            let dynamicEntity = createEntityFromJsonData(originalData);
            if (delete this[propertyName]) {
                Object.defineProperty(this, propertyName, {
                    get: function () {
                        return dynamicEntity;
                    },
                    set: function (value) {
                        const modifyInfo = {
                            path: dynamicEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        dynamicEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    }
                });
            }
        });
    }
    //#endregion
    // #region 加载实体数据相关private、projected方法
    /**
     * 加载简单字段值
     * @todo 临时用修改的方式模拟
     */
    loadFields(data) {
        const ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach((propName) => {
            const ngField = ngFields[propName];
            const dataField = ngField.dataField || propName;
            // if (ngField.primary === false) {
            //   this[propName] = data[dataField];
            // }
            let propValue = data[dataField];
            if (ngField.enableTimeZone === true) {
                const timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                if (timeZoneOffset !== null && propValue) {
                    propValue = ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(propValue, timeZoneOffset);
                }
            }
            this[propName] = propValue;
        });
    }
    /**
     * 加载子列表数据
     * @param data 数据
     */
    loadLists(data) {
        const ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach((propName) => {
            const ngList = ngLists[propName];
            const dataField = ngList.dataField || propName;
            const entityType = ngList.type;
            // 创建实体
            const listData = data[dataField];
            if (listData) {
                const entities = listData.map((entityData) => {
                    return EntityFactory(entityType, entityData);
                });
                this[propName].loadEntities(entities);
            }
            else {
                this[propName].loadEntities([]);
            }
        });
    }
    loadObjects(data) {
        const ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach((propName) => {
            const ngObject = ngObjects[propName];
            const dataField = ngObject.dataField || propName;
            const objectData = data[dataField];
            const entity = this[propName];
            if (!entity || !objectData) {
                return;
            }
            entity.load(objectData);
        });
    }
    loadDynamicObjects(data) {
        const ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamicObjects).forEach((propName) => {
            const ngDynamicObject = ngDynamicObjects[propName];
            const dataField = ngDynamicObject.dataField || propName;
            const dynamicData = data[dataField] || {};
            const dynamicEntity = this[propName];
            if (!dynamicEntity) {
                return;
            }
            dynamicEntity.loadDynamicData(dynamicData);
        });
    }
    // #endregion
    // #region 私有工具方法
    /**
     * 发送值变更
     */
    emitValueChange(propName, propMetadata, newPropValue, oldPropValue, changeSetValue = undefined) {
        const change = {
            path: this.createPath(propName),
            value: newPropValue,
            changeSetValue,
            preValue: oldPropValue,
            type: ModifyType.ValueChange
        };
        if (this[PARENT_PATH]) {
            change.path = this[PARENT_PATH].concat(change.path);
        }
        this.setChanges(change);
    }
    /**
     * 准备提交给后端的属性值
     * @param propName 属性
     * @param propMetadata 属性描述
     * @param propValue 属性值
     */
    preparePropValue(propName, propMetadata, propValue) {
        let value = undefined;
        // 只要启用时区，传给后端的时间就必须带时区，因此当获取用户时区失败的时候，获取浏览器当前时区
        if (propMetadata.enableTimeZone === true) {
            const timeZoneOffset = UserSettingsService.getTimeZoneOffset();
            if (timeZoneOffset !== null && propValue) {
                value = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);
            }
        }
        return value;
    }
    /**
     * 获取属性值
     */
    getPropValue(propName, propMetadata) {
        const dataField = propMetadata.dataField || propName;
        let value = this.data[dataField];
        // 对多语录入字段，query不返回问题进行兼容
        if (propMetadata.enableMultiLangInput === true && !value) {
            const langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';
            const originDataField = dataField.replace('_MULTILANGUAGE', '');
            return {
                [langCode]: this.data[originDataField]
            };
        }
        // 启用时区
        if (propMetadata.enableTimeZone === true) {
            const timeZoneOffset = UserSettingsService.getTimeZoneOffset();
            if (timeZoneOffset !== null && value) {
                return ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(value, timeZoneOffset);
            }
        }
        if (propMetadata.originalDataFieldType === BigNumberType) {
            value = value !== null && value !== undefined && value.toString() || null;
        }
        return value;
    }
    /**
     * 设置属性值
     */
    setPropValue(propName, propMetadata, propValue) {
        const dataField = propMetadata.dataField || propName;
        if (propMetadata.originalDataFieldType === BigNumberType) {
            this.data[dataField] = propValue === null ? null : propValue && propValue.toString() || '';
        }
        else {
            if (propMetadata.enableTimeZone === true) {
                const timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                if (timeZoneOffset !== null && propValue) {
                    propValue = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);
                }
            }
            this.data[dataField] = propValue;
        }
    }
    /**
     * 检查属性值是否发生变化
     */
    isPropValueChanged(propName, propMetadata, newPropValue, oldPropValue) {
        if (propMetadata.enableMultiLangInput === true) {
            if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {
                return false;
            }
            return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);
        }
        else if (propMetadata.originalDataFieldType === BigNumberType) {
            if (typeof newPropValue !== 'string' && newPropValue !== null && newPropValue !== undefined) {
                newPropValue = newPropValue.toString();
            }
            return newPropValue !== oldPropValue;
        }
        else {
            return newPropValue !== oldPropValue;
        }
    }
    /**
     * 多语录入字段的值是否为空
     */
    isEmptyMultiLangPropValue(value) {
        if (!value) {
            return true;
        }
        const keys = Object.keys(value);
        if (keys.length === 0) {
            return true;
        }
        // 值全部为空，视为空
        const vals = Object.values(value);
        const allEmptyVal = vals.every((val) => {
            return !val;
        });
        if (allEmptyVal === true) {
            return true;
        }
        return false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUF3RSxpQkFBaUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNILE9BQU8sRUFBZ0IsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQWtDLE1BQU0sbUJBQW1CLENBQUM7QUFDOUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQW1CLE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUN6Qzs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFDSCxNQUFNLE9BQWdCLE1BQU07SUFtSTFCLGFBQWE7SUFHYjs7T0FFRztJQUNILFlBQVksSUFBUztRQXhJckIsa0JBQWtCO1FBRWxCOztXQUVHO1FBQ0ssZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIseUJBQW9CLEdBQW9CLElBQUksQ0FBQztRQUM3QyxpQkFBWSxH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RUYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBmcm9tIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgTmdGaWVsZFByb3BlcnR5LCBOZ0xpc3RQcm9wZXJ0eSwgTmdPYmplY3RQcm9wZXJ0eSwgTmdEeW5hbWljUHJvcGVydHksIEZpZWxkTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi9tZXRhZGF0YS9pbmRleCc7XHJcbmltcG9ydCB7IE1vZGlmaWNhdGlvbiwgTW9kaWZ5VHlwZSwgQ2hhbmdlU2V0IH0gZnJvbSAnLi4vY2hhbmdlc2V0L2luZGV4JztcclxuaW1wb3J0IHsgUEFSRU5UX1BBVEgsIFBBUkVOVF9DTEFTUywgRHluYW1pYyB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBFbnRpdHlMaXN0IH0gZnJvbSAnLi9lbnRpdHlfbGlzdCc7XHJcbmltcG9ydCB7IEVudGl0eUZhY3RvcnkgfSBmcm9tICcuL2VudGl0eV9mYWN0b3J5JztcclxuaW1wb3J0IHsgVmFsaWRhdG9yLCBWYWxpZGF0aW9uUmVzdWx0LCBWYWxpZGF0ZVJ1bGUgfSBmcm9tICcuL3ZhbGlkYXRvci9pbmRleCc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25VdGlscyB9IGZyb20gJy4vdmFsaWRhdG9yL3ZhbGlkYXRpb25fdXRpbHMnO1xyXG5pbXBvcnQgeyBCaWdOdW1iZXJUeXBlLCBDaGFuZ2VTZXRQb2xpY3ksIFJ1bk1vZGUgfSBmcm9tICcuLi9jb3JlL3R5cGVzJztcclxuaW1wb3J0IHsgVXNlclNldHRpbmdzU2VydmljZSB9IGZyb20gJy4uL2kxOG4vdXNlcl9zZXR0aW5nc19zZXJ2aWNlJztcclxuaW1wb3J0IHsgWm9uZWRUaW1lIH0gZnJvbSAnLi4vaTE4bi96b25lZF90aW1lJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnLi4vZnJhbWUvaW5kZXgnO1xyXG5pbXBvcnQgeyBSdW5Nb2RlU2VydmljZSB9IGZyb20gJy4uL21pc2MnO1xyXG4vKipcclxuICogQGF1dGhvciBMdWNhcyBIdWFuZ1xyXG4gKiDlrp7kvZPmir3osaHln7rnsbvvvIzmiYDmnInlrp7kvZPlv4XpobvmianlsZXoh6pFbnRpdHlcclxuICpcclxuICogIyMjIOS9v+eUqOekuuS+i1xyXG4gKiBgYGBcclxuICogZXhwb3J0IGNsYXNzIFVzZXJFbnRpdHkgZXh0ZW5kcyBFbnRpdHkge1xyXG4gKiAgICB1c2VySWQ6IHN0cmluZztcclxuICogICAgdXNlck5hbWU6IHN0cmluZztcclxuICpcclxuICogICAgY29uc3RydWN0b3IoZGF0YTogYW55KXtcclxuICogICAgICAgIHN1cGVyKGRhdGEpO1xyXG4gKiAgICB9XHJcbiAqIH1cclxuICogYGBgXHJcbiAqL1xyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRW50aXR5IHtcclxuICAvLyAjcmVnaW9uIOengeacieOAgeS/neaKpOWxnuaAp1xyXG5cclxuICAvKipcclxuICAgKiDpqozor4HplJnor6/pm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIHZhbGlkRXJyb3JzID0ge307XHJcbiAgcHJpdmF0ZSBwcmltYXJ5RmllbGRNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5ID0gbnVsbDtcclxuICBwcml2YXRlIG9yaWdpbmFsRGF0YSA9IHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiDpqozor4HlmahcclxuICAgKi9cclxuICBwcml2YXRlIHZhbGlkYXRvcjogVmFsaWRhdG9yPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWinumHj+WPmOabtOmbhuWQiFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjaGFuZ2VTZXQgPSBuZXcgQ2hhbmdlU2V0KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuato+WcqOmqjOivgVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBpc1ZhbGlkYXRpbmcgPSBmYWxzZTtcclxuXHJcbiAgLyoqXHJcbiAgICog5paw5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIG5ld0RhdGEgPSB1bmRlZmluZWQ7XHJcbiAgLyoqXHJcbiAgICog6ZSA5q+B5rWBXHJcbiAgICovXHJcbiAgcHVibGljIHVuc3Vic2NyaWJlOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xyXG4gIC8qKlxyXG4gICAqIOWPmOabtOaPkOS6pOetlueVpVxyXG4gICAqL1xyXG4gIHByaXZhdGUgX2NoYW5nZVNldFBvbGljeTogQ2hhbmdlU2V0UG9saWN5O1xyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24g5YWs5pyJ5bGe5oCnXHJcblxyXG4gIC8qKlxyXG4gICAqIOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHB1YmxpYyB2YWx1ZUNoYW5nZWQgPSBuZXcgU3ViamVjdDxNb2RpZmljYXRpb24+KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxnuaAp+WAvOaUueWPmOaXtuinpuWPkVxyXG4gICAqXHJcbiAgICogIyMjIOS9v+eUqOekuuS+i1xyXG4gICAqIGBgYFxyXG4gICAqICBjb25zdCBlbnRpdHkgPSBuZXcgVXNlckVudGl0eShkYXRhKTtcclxuICAgKiAgZW50aXR5Lm9uVmFsdWVDaGFuZ2VkLnN1YnNjcmliZSgoZGF0YTogTW9kaWZpY2F0aW9uKSA9PiB7XHJcbiAgICogICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgKiAgfSlcclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqXHJcbiAgICogQGV2ZW50XHJcbiAgICovXHJcbiAgcHVibGljIG9uVmFsdWVDaGFuZ2VkID0gdGhpcy52YWx1ZUNoYW5nZWQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgcHVibGljIG9uVXBkYXRlID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gIC8qKlxyXG4gICAqIOi/lOWbnkpTT07moLzlvI/nmoTmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGRhdGEoKTogYW55IHtcclxuICAgIHJldHVybiB0aGlzLm5ld0RhdGE7XHJcbiAgfVxyXG4gIHB1YmxpYyBzZXQgZGF0YSh2YWx1ZTogYW55KSB7XHJcbiAgICB0aGlzLm5ld0RhdGEgPSB2YWx1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6aqM6K+B6ZSZ6K+v6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlcnJvcnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy52YWxpZEVycm9ycztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgZXJyb3JzKGVycm9yczogYW55KSB7XHJcbiAgICB0aGlzLnZhbGlkRXJyb3JzID0gZXJyb3JzO1xyXG4gIH1cclxuICBwdWJsaWMgc2V0IGNoYW5nZVNldFBvbGljeShwb2xpY3k6IENoYW5nZVNldFBvbGljeSkge1xyXG4gICAgdGhpcy5fY2hhbmdlU2V0UG9saWN5ID0gcG9saWN5O1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0IGNoYW5nZVNldFBvbGljeSgpOiBDaGFuZ2VTZXRQb2xpY3kge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NoYW5nZVNldFBvbGljeTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Y+Y5pu06ZuGXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBjaGFuZ2VzKCk6IE1vZGlmaWNhdGlvbltdIHtcclxuICAgIHJldHVybiB0aGlzLmNoYW5nZVNldC5jaGFuZ2VzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlrp7kvZPkuLvplK7lhYPmlbDmja5cclxuICAgKi9cclxuXHJcbiAgcHVibGljIGdldCBwcmltYXJ5UHJvcGVydHkoKTogTmdGaWVsZFByb3BlcnR5IHtcclxuICAgIGlmICghdGhpcy5wcmltYXJ5RmllbGRNZXRhZGF0YSkge1xyXG4gICAgICB0aGlzLnByaW1hcnlGaWVsZE1ldGFkYXRhID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0UHJpbWFyeUZpZWxkTWV0YWRhdGEodGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5wcmltYXJ5RmllbGRNZXRhZGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUrlxyXG4gICAqIEB0b2RvXHJcbiAgICogMeOAgeayoeacieS4u+mUruaXtui/lOWbnicn5LiN5ZCI55CG77yM5bqU6K+l6L+U5ZuedW5kZWZpbmVkXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBwcmltYXJ5S2V5KCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5wcmltYXJ5UHJvcGVydHkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Li76ZSu5YC8XHJcbiAgICogMeOAgeayoeacieS4u+mUruaXtui/lOWbnicn5LiN5ZCI55CG77yM5bqU6K+l6L+U5ZuedW5kZWZpbmVkXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBwcmltYXJ5VmFsdWUoKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLnByaW1hcnlLZXkpIHtcclxuICAgICAgLy8gcmV0dXJuIHRoaXNbdGhpcy5wcmltYXJ5UHJvcGVydHkucHJvcGVydHldLnRvU3RyaW5nKCk7XHJcbiAgICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IHRoaXNbdGhpcy5wcmltYXJ5UHJvcGVydHkucHJvcGVydHldO1xyXG4gICAgICByZXR1cm4gcHJpbWFyeVZhbHVlID8gcHJpbWFyeVZhbHVlIDogJyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gZGF0YSBKU09O5pWw5o2uXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoZGF0YTogYW55KSB7XHJcbiAgICB0aGlzLnZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoKTtcclxuICAgIHRoaXMubmV3RGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xyXG4gICAgdGhpcy5vcmlnaW5hbERhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcclxuICAgIHRoaXMub25WYWx1ZUNoYW5nZWQgPSB0aGlzLnZhbHVlQ2hhbmdlZDtcclxuICAgIC8vIHRoaXMub25WYWx1ZUNoYW5nZWQgPSB0aGlzLnZhbHVlQ2hhbmdlZC5waXBlKFxyXG4gICAgLy8gICAgIHNjYW4oKHg6IE1vZGlmaWNhdGlvbiwgY3VycjogTW9kaWZpY2F0aW9uKSA9PiB7XHJcbiAgICAvLyAgICAgICAgIGlmICh4KSB7XHJcbiAgICAvLyAgICAgICAgICAgICBpZiAoaXNFcXVhbCh4LnBhdGgsIGN1cnIucGF0aCkgJiYgeC50eXBlID09PSBjdXJyLnR5cGUpIHtcclxuICAgIC8vICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih4LCBjdXJyKTtcclxuICAgIC8vICAgICAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgICAgIHJldHVybiBjdXJyO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgIHJldHVybiBjdXJyO1xyXG4gICAgLy8gICAgIH0pXHJcbiAgICAvLyApO1xyXG4gICAgaWYgKFJ1bk1vZGVTZXJ2aWNlLmdldFJ1bk1vZGUoKSA9PT0gUnVuTW9kZS5jb21wYXRpYmxlKSB7XHJcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZSgpO1xyXG4gICAgfVxyXG4gICAgLy8gdGhpcy52YWxpZGF0ZSgpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8vICNyZWdpb24g5YWs5pyJ5pa55rOVXHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhuWPmOabtOiusOW9leS/neWtmOiHs+WPmOabtOmbhuS4rVxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlj5jmm7TorrDlvZVcclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q2hhbmdlcyh2YWx1ZTogTW9kaWZpY2F0aW9uKTogdm9pZCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSB2YWx1ZS5wYXRoW3ZhbHVlLnBhdGgubGVuZ3RoIC0gMV07XHJcblxyXG4gICAgLy8gQHRvZG/vvJrkuovku7bkvJrku47kuIvnuqflkJHkuIrlhpLms6HvvIxjaGFuZ2Xlj6/og73mmK/kuIvnuqfnmoTvvIzkuI3og73lkozlvZPliY1FbnRpdHnnmoRuZXdEYXRh5ZCI5bm244CCXHJcbiAgICAvLyB0aGlzLm5ld0RhdGEgPSBPYmplY3QuYXNzaWduKHRoaXMubmV3RGF0YSwgeyBbcHJvcGVydHlOYW1lXTogdmFsdWUudmFsdWUgfSk7XHJcblxyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQubmV4dCh2YWx1ZSk7XHJcbiAgICBpZiAoISh0aGlzLnZhbGlkRXJyb3JzICYmIE9iamVjdC5rZXlzKHRoaXMudmFsaWRFcnJvcnMpLmluY2x1ZGVzKHByb3BlcnR5TmFtZSkgJiYgdGhpcy5jaGFuZ2VTZXRQb2xpY3kgPT09ICd2YWxpZCcpKSB7XHJcbiAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5jaGFuZ2VTZXRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdmFsdWUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICAgICAgdmFsdWUudmFsdWUgPSB2YWx1ZS5jaGFuZ2VTZXRWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmNoYW5nZVNldC5hcHBlbmQodmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qCh6aqM5a6e5L2T5ZCE5bGe5oCn55qE5YC8XHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSDlsZ7mgKflkI3np7DvvIzlpoLmnpzkuLrnqbrvvIzliJnpqozor4Hlrp7kvZPkuK3miYDmnInorr7nva7kuobpqozor4Hop4TliJnnmoTlsZ7mgKdcclxuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlPFZhbGlkYXRpb25SZXN1bHQ+XHJcbiAgICogIyMjIOekuuS+i1xyXG4gICAqIGBgYFxyXG4gICAqICBjb25zdCBlbnRpdHkgPSBuZXcgVXNlckVudGl0eShkYXRhKTtcclxuICAgKiAgZW50aXR5LnZhbGlkYXRlKCkuc3Vic2NyaWJlKHJlc3VsdCA9PntcclxuICAgKiAgICAgIGlmKHJlc3VsdC5pc1ZhbGlkKXtcclxuICAgKiAgICAgICAgICAuLi5cclxuICAgKiAgICAgIH0gZWxzZSB7XHJcbiAgICogICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0Lm1lc3NhZ2UpO1xyXG4gICAqICAgICAgfVxyXG4gICAqICB9KVxyXG4gICAqXHJcbiAgICogYGBgXHJcbiAgICovXHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXHJcbiAgcHVibGljIHZhbGlkYXRlKHByb3BlcnR5TmFtZT86IHN0cmluZywgdmFsdWU/LCBleHRlcm5hbFJ1bGVzPzogTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+LCBpbmRleD86IG51bWJlciwgZnJhbWVDb250ZXh0PzogRnJhbWVDb250ZXh0KTogT2JzZXJ2YWJsZTxWYWxpZGF0aW9uUmVzdWx0PiB7XHJcbiAgICByZXR1cm4gZnJvbSh0aGlzLnZhbGlkYXRvci52YWxpZGF0ZSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHZhbHVlLCBleHRlcm5hbFJ1bGVzLCBpbmRleCwgZnJhbWVDb250ZXh0KSkucGlwZShcclxuICAgICAgdGFwKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXN1bHQuaXNWYWxpZCkge1xyXG4gICAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IFZhbGlkYXRpb25VdGlscy5jb252ZXJ0RXJyb3JzVG9Ob3JtYWxPYmplY3QocmVzdWx0LmVycm9ycywge30pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnZhbGlkRXJyb3JzID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB2YWxpZGF0ZUFsbCh2YWxpZGF0ZUNvbnRleHQ/OiBNYXA8c3RyaW5nLCBWYWxpZGF0ZVJ1bGVbXT4pIHtcclxuXHJcbiAgfVxyXG5cclxuICAvLyDnlKjkuo7lnKhlbnRpdHlfdXRpbOS4reiwg+eUqO+8jOWmguaenOaciemUmeivr++8jOS8muWwhumqjOivgee7k+aenOS8oOWFpeWbnuiwg2NiXHJcbiAgcHVibGljIHZhbGlkYXRlRnJvbVV0aWwocHJvcGVydHlOYW1lOiBzdHJpbmcsIHZhbHVlLCBjYiwgY29udGV4dD86IGFueSkge1xyXG4gICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgZnJvbSh0aGlzLnZhbGlkYXRvci52YWxpZGF0ZSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHZhbHVlLCBudWxsLCB1bmRlZmluZWQsIGNvbnRleHQgJiYgY29udGV4dC5mcmFtZUNvbnRleHQgfHwgbnVsbCkpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xyXG4gICAgICBpZiAoIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IFZhbGlkYXRpb25VdGlscy5jb252ZXJ0RXJyb3JzVG9Ob3JtYWxPYmplY3QocmVzdWx0LmVycm9ycywge30pO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOS4jeW6lOmHjeaWsOi1i+WAvO+8jOi/memHjOS7heaYr+WunuS9k+agoemqjOmAmui/h1xyXG4gICAgICAvKmVsc2Uge1xyXG4gICAgICAgIC8vIOWmguaenEJpbmRpbmdPYmplY3TkuIrnmoTlsZ7mgKflgLzlkoxFbnRpdHnkuIrlr7nlupTlsZ7mgKflgLzkuIDmoLfvvIzliJnkuI3lho3orr7nva5cclxuICAgICAgICBpZiAodGhpc1twcm9wZXJ0eU5hbWVdID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzW3Byb3BlcnR5TmFtZV0gPSB2YWx1ZTtcclxuICAgICAgfSovXHJcbiAgICAgIGNiKHJlc3VsdCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCM5q2l5qCh6aqMXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSBcclxuICAgKiBAcGFyYW0gdmFsdWUgXHJcbiAgICogQHBhcmFtIGNiIFxyXG4gICAqL1xyXG4gIHB1YmxpYyB2YWxpZGF0ZUZyb21VdGlsU3luYyhwcm9wZXJ0eU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSwgY2I6IGFueSwgY29udGV4dD86IGFueSkge1xyXG4gICAgdGhpcy52YWxpZEVycm9ycyA9IHt9O1xyXG4gICAgY29uc3QgcmVzdWx0OiBhbnkgPSB0aGlzLnZhbGlkYXRvci52ZXJpZnkodGhpcywgcHJvcGVydHlOYW1lLCB2YWx1ZSwgbnVsbCwgdW5kZWZpbmVkLCBjb250ZXh0ICYmIGNvbnRleHQuZnJhbWVDb250ZXh0IHx8IG51bGwsIHRydWUpO1xyXG4gICAgaWYgKHJlc3VsdCAmJiAhcmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgdGhpcy52YWxpZEVycm9ycyA9IFZhbGlkYXRpb25VdGlscy5jb252ZXJ0RXJyb3JzVG9Ob3JtYWxPYmplY3QocmVzdWx0LmVycm9ycywge30pO1xyXG4gICAgfVxyXG4gICAgY2IocmVzdWx0KTtcclxuICB9XHJcbiAgcHVibGljIGdldFBhdGhzKCkge1xyXG4gICAgY29uc3QgcGF0aE9iaiA9IHtcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIGlzVWR0OiBmYWxzZSxcclxuICAgICAgaXNHcmlkOiBmYWxzZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGhhbmRsZVBhcmVudCA9IGl0ZW0gPT4ge1xyXG4gICAgICBjb25zdCBwYXJlbnRQYXRocyA9IGl0ZW1bUEFSRU5UX1BBVEhdO1xyXG4gICAgICBpZiAocGFyZW50UGF0aHMpIHtcclxuICAgICAgICBjb25zdCBwcm9wID0gcGFyZW50UGF0aHNbcGFyZW50UGF0aHMubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgLy8g54i257qn5omA5Zyo5a6e5L2T5YyF5ZCr55qEbmdPYmplY3TvvIzlrZjlnKjlvZPliY3lrp7kvZPlrZfmrrXvvIzliJnliKTmlq3kuLpVRHTlrZfmrrVcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKGl0ZW1bUEFSRU5UX0NMQVNTXS5jb25zdHJ1Y3RvcikpLmluZGV4T2YocHJvcCkgPiAtMSkge1xyXG4gICAgICAgICAgcGF0aE9iai5pc1VkdCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWtmOWcqOexu+Wei+S4um5nTGlzdO+8jOWImeWIpOaWreS4umdyaWRcclxuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIEVudGl0eUxpc3QgPT09IHRydWUpIHtcclxuICAgICAgICAgIHBhdGhPYmouaXNHcmlkID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcGF0aE9iai5wYXRoLnB1c2gocHJvcCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfVxyXG4gICAgICBpZiAoaXRlbVtQQVJFTlRfQ0xBU1NdKSB7XHJcbiAgICAgICAgaGFuZGxlUGFyZW50KGl0ZW1bUEFSRU5UX0NMQVNTXSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBoYW5kbGVQYXJlbnQodGhpcyk7XHJcbiAgICBwYXRoT2JqLnBhdGggPSBwYXRoT2JqLnBhdGgucmV2ZXJzZSgpO1xyXG4gICAgcmV0dXJuIHBhdGhPYmo7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRFbnRpdHlMaXN0UGF0aCgpIHtcclxuICAgIGxldCBwYXRocyA9IFtdO1xyXG4gICAgY29uc3QgaGFuZGxlUGFyZW50ID0gKGl0ZW06IEVudGl0eSkgPT4ge1xyXG4gICAgICBjb25zdCBwYXJlbnRQYXRocyA9IGl0ZW1bUEFSRU5UX1BBVEhdO1xyXG4gICAgICBpZiAocGFyZW50UGF0aHMpIHtcclxuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIEVudGl0eUxpc3QgPT09IHRydWUpIHtcclxuICAgICAgICAgIGNvbnN0IHBhdGggPSBwYXJlbnRQYXRocy5jb25jYXQoW10pLnJldmVyc2UoKTtcclxuICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHBhdGhzLCBwYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGl0ZW1bUEFSRU5UX0NMQVNTXSkge1xyXG4gICAgICAgIGhhbmRsZVBhcmVudChpdGVtW1BBUkVOVF9DTEFTU10pO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgaGFuZGxlUGFyZW50KHRoaXMpO1xyXG4gICAgcmV0dXJuIHBhdGhzLnJldmVyc2UoKTtcclxuICB9XHJcbiAgcHVibGljIGdldE1haW5FbnRpdHlQcmltYXJ5VmFsdWUoKSB7XHJcbiAgICBsZXQgaXRlbSA9IHRoaXM7XHJcbiAgICB3aGlsZSAoaXRlbVtQQVJFTlRfQ0xBU1NdKSB7XHJcbiAgICAgIGl0ZW0gPSBpdGVtW1BBUkVOVF9DTEFTU107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlbS5wcmltYXJ5VmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWKoOi9veaVsOaNrlxyXG4gICAqIEBwYXJhbSBkYXRhIOaWsOaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkKGRhdGE6IGFueSwgb3B0aW9uczogYW55ID0ge30pIHtcclxuICAgIGlmICghZGF0YSkge1xyXG4gICAgICBkYXRhID0ge307XHJcbiAgICB9XHJcbiAgICB0aGlzLmxvYWRGaWVsZHMoZGF0YSk7XHJcbiAgICBpZiAoIW9wdGlvbnMgfHwgKG9wdGlvbnMgJiYgb3B0aW9ucy5sb2FkQ2hpbGQgIT09IGZhbHNlKSkge1xyXG4gICAgICB0aGlzLmxvYWRMaXN0cyhkYXRhKTtcclxuICAgIH1cclxuICAgIHRoaXMubG9hZE9iamVjdHMoZGF0YSk7XHJcbiAgICB0aGlzLmxvYWREeW5hbWljT2JqZWN0cyhkYXRhKTtcclxuICAgIHRoaXMubmV3RGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xyXG4gICAgdGhpcy5vcmlnaW5hbERhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6SlNPTlxyXG4gICAqIEBwYXJhbSBidWlsZENoYW5nZXMg5piv5ZCm5p6E6YCg5Y+Y5pu06ZuGXHJcbiAgICogQHBhcmFtIGluY2x1ZGVNdWx0aUxhbmd1YWdlRmllbGQg5piv5ZCm5YyF5ZCr5aSa6K+t5a2X5q61XHJcbiAgICovXHJcbiAgcHVibGljIHRvSlNPTihidWlsZENoYW5nZXM/OiBib29sZWFuKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcclxuXHJcbiAgICAvLyDnroDljZXlsZ7mgKdcclxuICAgIGNvbnN0IG5nRmllbGRzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0ZpZWxkID0gbmdGaWVsZHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgaWYgKGJ1aWxkQ2hhbmdlcyA9PT0gdHJ1ZSAmJiBuZ0ZpZWxkLmVuYWJsZVRpbWVab25lID09PSB0cnVlKSB7XHJcbiAgICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzLmRhdGFbcHJvcE5hbWVdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWvueixoeWxnuaAp1xyXG4gICAgY29uc3QgbmdPYmplY3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nT2JqZWN0ID0gbmdPYmplY3RzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdPYmplY3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdID8gdGhpc1twcm9wTmFtZV0udG9KU09OKGJ1aWxkQ2hhbmdlcykgOiB7fTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWKqOaAgeWxnuaAp1xyXG4gICAgY29uc3QgbmdEeW5hbWljcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY3MpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdEeW5hbWljID0gbmdEeW5hbWljc1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nRHluYW1pYy5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV0gPyB0aGlzW3Byb3BOYW1lXS50b0pTT04oYnVpbGRDaGFuZ2VzKSA6IHt9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5YiX6KGo5bGe5oCnXHJcbiAgICBjb25zdCBuZ0xpc3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdMaXN0KHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdMaXN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0xpc3QgPSBuZ0xpc3RzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdMaXN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzW3Byb3BOYW1lXSA/IHRoaXNbcHJvcE5hbWVdLnRvSlNPTihidWlsZENoYW5nZXMpIDoge307XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8jcmVnaW9uIOWunuS9k+WIneWni+WMluebuOWFs3ByaXZhdGXmlrnms5VcclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW5a6e5L2TXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplKCkge1xyXG4gICAgY29uc3QgY29uc3RydWN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yO1xyXG5cclxuICAgIGNvbnN0IG5nRmllbGRzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHMoY29uc3RydWN0b3IpO1xyXG4gICAgY29uc3QgbmdPYmplY3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKGNvbnN0cnVjdG9yKTtcclxuICAgIGNvbnN0IG5nTGlzdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QoY29uc3RydWN0b3IpO1xyXG4gICAgY29uc3QgbmdEeW5hbWljID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGNvbnN0cnVjdG9yKTtcclxuXHJcbiAgICB0aGlzLmluaXRpYWxpemVOb3JtYWxGaWVsZChuZ0ZpZWxkcyk7XHJcbiAgICB0aGlzLmluaXRpYWxpemVMaXN0KG5nTGlzdHMpO1xyXG4gICAgdGhpcy5pbml0aWFsaXplT2JqZWN0KG5nT2JqZWN0cyk7XHJcbiAgICB0aGlzLmluaXRpYWxpemVEeW5hbWljKG5nRHluYW1pYyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7pwYXRoXHJcbiAgICogQHBhcmFtIHByb3BlcnR5TmFtZSDlsZ7mgKflkI3np7BcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IHByaW1hcnlGaWVsZE1ldGFkYXRhID0gdGhpcy5wcmltYXJ5UHJvcGVydHk7XHJcbiAgICBpZiAocHJpbWFyeUZpZWxkTWV0YWRhdGEpIHtcclxuICAgICAgY29uc3QgcHJpbWFyeURhdGFGaWVsZCA9IHByaW1hcnlGaWVsZE1ldGFkYXRhLmRhdGFGaWVsZDtcclxuICAgICAgcmV0dXJuIFtwcmltYXJ5RGF0YUZpZWxkICsgJzonICsgdGhpcy5wcmltYXJ5VmFsdWUsIHByb3BlcnR5TmFtZV07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gWyc6JywgcHJvcGVydHlOYW1lXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxnuaAp+Wtl+auteWIneWni+WMllxyXG4gICAqIEBwYXJhbSBuZ0ZpZWxkcyDlsZ7mgKflrZfmrrXlhYPmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGluaXRpYWxpemVOb3JtYWxGaWVsZChuZ0ZpZWxkczogeyBba2V5OiBzdHJpbmddOiBOZ0ZpZWxkUHJvcGVydHkgfSk6IHZvaWQge1xyXG4gICAgT2JqZWN0LmtleXMobmdGaWVsZHMpLmZvckVhY2gocHJvcE5hbWUgPT4ge1xyXG4gICAgICBjb25zdCBuZ0ZpZWxkID0gbmdGaWVsZHNbcHJvcE5hbWVdIGFzIE5nRmllbGRQcm9wZXJ0eTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdGaWVsZC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcblxyXG4gICAgICBpZiAoZGVsZXRlIHRoaXNbcHJvcE5hbWVdKSB7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BOYW1lLCB7XHJcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCk7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdQcm9wVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8g5YC855u45ZCM5pe25LiN6Kem5Y+R5Y+Y5pu044CCXHJcbiAgICAgICAgICAgIGNvbnN0IG9sZFByb3BWYWx1ZSA9IHRoaXMuZ2V0UHJvcFZhbHVlKHByb3BOYW1lLCBuZ0ZpZWxkKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNQcm9wVmFsdWVDaGFuZ2VkKHByb3BOYW1lLCBuZ0ZpZWxkLCBuZXdQcm9wVmFsdWUsIG9sZFByb3BWYWx1ZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UHJvcFZhbHVlKHByb3BOYW1lLCBuZ0ZpZWxkLCBuZXdQcm9wVmFsdWUpO1xyXG4gICAgICAgICAgICBjb25zdCBjaGFuZ2VTZXRWYWx1ZSA9IHRoaXMucHJlcGFyZVByb3BWYWx1ZShwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5lbWl0VmFsdWVDaGFuZ2UocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSwgb2xkUHJvcFZhbHVlLCBjaGFuZ2VTZXRWYWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW5YiX6KGo57G75Z6L55qE5YWD5pWw5o2uXHJcbiAgICogQHBhcmFtIG5nTGlzdE1ldGFkYXRhIOWIl+ihqOexu+Wei+WFg+aVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUxpc3QobmdMaXN0TWV0YWRhdGE6IHsgW2tleTogc3RyaW5nXTogTmdMaXN0UHJvcGVydHkgfSk6IHZvaWQge1xyXG4gICAgT2JqZWN0LmtleXMobmdMaXN0TWV0YWRhdGEpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IG5nTGlzdE1ldGFkYXRhW3Byb3BlcnR5TmFtZV0gYXMgTmdMaXN0UHJvcGVydHk7XHJcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gZmllbGRNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcGVydHlOYW1lO1xyXG4gICAgICBjb25zdCB2YWwgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXTtcclxuXHJcbiAgICAgIGNvbnN0IGVudGl0eUxpc3QgPSBuZXcgRW50aXR5TGlzdDx0eXBlb2YgZmllbGRNZXRhZGF0YS50eXBlPigpO1xyXG4gICAgICBlbnRpdHlMaXN0W1BBUkVOVF9DTEFTU10gPSB0aGlzO1xyXG4gICAgICBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXSA9IHBhdGg7XHJcblxyXG4gICAgICBpZiAodmFsKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXMgPSB2YWwubWFwKHYgPT4gRW50aXR5RmFjdG9yeTx0eXBlb2YgZmllbGRNZXRhZGF0YS50eXBlPihmaWVsZE1ldGFkYXRhLnR5cGUsIHYpKTtcclxuICAgICAgICBlbnRpdHlMaXN0LmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGVudGl0eUxpc3Qub25MaXN0Q2hhbmdlZC5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgaWYgKGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdWzBdICE9PSB2YWx1ZS5wYXRoWzBdKSB7XHJcbiAgICAgICAgICAgIHZhbHVlLnBhdGggPSBlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXS5jb25jYXQodmFsdWUucGF0aCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLnNldENoYW5nZXModmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXNbcHJvcGVydHlOYW1lXSA9IGVudGl0eUxpc3Q7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW5a2Q5a+56LGhXHJcbiAgICogQHBhcmFtIG5nT2JqZWN0TWV0YWRhdGEg5a2Q5a+56LGh5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplT2JqZWN0KG5nT2JqZWN0TWV0YWRhdGE6IHsgW2tleTogc3RyaW5nXTogTmdPYmplY3RQcm9wZXJ0eSB9KSB7XHJcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdE1ldGFkYXRhKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpZWxkTWV0YWRhdGEgPSBuZ09iamVjdE1ldGFkYXRhW3Byb3BlcnR5TmFtZV0gYXMgTmdPYmplY3RQcm9wZXJ0eTtcclxuICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBmaWVsZE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wZXJ0eU5hbWU7XHJcblxyXG4gICAgICAvLyB2YWzkuI3lrZjlnKjml7bvvIznlKjnqbrlr7nosaHku6Pmm79cclxuICAgICAgY29uc3QgdmFsID0gdGhpcy5kYXRhW2RhdGFGaWVsZF0gfHwge307XHJcblxyXG4gICAgICBjb25zdCBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEgPSAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZTtcclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBmaWVsZE1ldGFkYXRhLnR5cGUpIHtcclxuICAgICAgICAgIGluc3RhbmNlID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGluc3RhbmNlID0gRW50aXR5RmFjdG9yeShmaWVsZE1ldGFkYXRhLnR5cGUsIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5zdGFuY2VbUEFSRU5UX0NMQVNTXSA9IHRoaXM7XHJcbiAgICAgICAgaW5zdGFuY2VbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuXHJcbiAgICAgICAgaW5zdGFuY2Uub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xyXG4gICAgICAgICAgaWYgKGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgY2hhbmdlcy5wYXRoID0gKHRoaXNbUEFSRU5UX1BBVEhdIHx8IFtdKS5jb25jYXQoY2hhbmdlcy5wYXRoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyDlpoLmnpzmsqHmnInlgLznlKjkuIDkuKrnqbrlr7nosaHku6Pmm79cclxuICAgICAgbGV0IGNoaWxkRW50aXR5ID0gY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhKHZhbCk7XHJcbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICAgICAgZ2V0OiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZEVudGl0eTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGlmeUluZm8gPSB7XHJcbiAgICAgICAgICAgICAgcGF0aDogY2hpbGRFbnRpdHlbUEFSRU5UX1BBVEhdLFxyXG4gICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS5kYXRhLFxyXG4gICAgICAgICAgICAgIHByZVZhbHVlOiB0aGlzW3Byb3BlcnR5TmFtZV0uZGF0YSxcclxuICAgICAgICAgICAgICB0eXBlOiBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNoaWxkRW50aXR5ID0gY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhKHZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKG1vZGlmeUluZm8pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUR5bmFtaWMobmdEeW5hbWljTWV0YWRhdGE6IHsgW2tleTogc3RyaW5nXTogTmdEeW5hbWljUHJvcGVydHkgfSkge1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljTWV0YWRhdGEpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IG5nRHluYW1pY01ldGFkYXRhW3Byb3BlcnR5TmFtZV0gYXMgTmdEeW5hbWljUHJvcGVydHk7XHJcbiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocHJvcGVydHlOYW1lKTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gZmllbGRNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcGVydHlOYW1lO1xyXG5cclxuICAgICAgY29uc3Qgb3JpZ2luYWxEYXRhID0gdGhpcy5kYXRhW2RhdGFGaWVsZF0gfHwge307XHJcblxyXG4gICAgICBjb25zdCBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEgPSAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZTtcclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBmaWVsZE1ldGFkYXRhLnR5cGUpIHtcclxuICAgICAgICAgIGluc3RhbmNlID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGluc3RhbmNlID0gRW50aXR5RmFjdG9yeShmaWVsZE1ldGFkYXRhLnR5cGUsIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5zdGFuY2VbUEFSRU5UX0NMQVNTXSA9IHRoaXM7XHJcbiAgICAgICAgaW5zdGFuY2VbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuXHJcbiAgICAgICAgaW5zdGFuY2Uub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xyXG4gICAgICAgICAgaWYgKGNoYW5nZXMpIHtcclxuICAgICAgICAgICAgY2hhbmdlcy5wYXRoID0gKHRoaXNbUEFSRU5UX1BBVEhdIHx8IFtdKS5jb25jYXQoY2hhbmdlcy5wYXRoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRDaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsZXQgZHluYW1pY0VudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YShvcmlnaW5hbERhdGEpO1xyXG4gICAgICBpZiAoZGVsZXRlIHRoaXNbcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZHluYW1pY0VudGl0eTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBtb2RpZnlJbmZvID0ge1xyXG4gICAgICAgICAgICAgIHBhdGg6IGR5bmFtaWNFbnRpdHlbUEFSRU5UX1BBVEhdLFxyXG4gICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS5kYXRhLFxyXG4gICAgICAgICAgICAgIHByZVZhbHVlOiB0aGlzW3Byb3BlcnR5TmFtZV0uZGF0YSxcclxuICAgICAgICAgICAgICB0eXBlOiBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGR5bmFtaWNFbnRpdHkgPSBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEodmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMobW9kaWZ5SW5mbyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOWKoOi9veWunuS9k+aVsOaNruebuOWFs3ByaXZhdGXjgIFwcm9qZWN0ZWTmlrnms5VcclxuXHJcbiAgLyoqXHJcbiAgICog5Yqg6L29566A5Y2V5a2X5q615YC8XHJcbiAgICogQHRvZG8g5Li05pe255So5L+u5pS555qE5pa55byP5qih5oufXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGxvYWRGaWVsZHMoZGF0YTogYW55KSB7XHJcbiAgICBjb25zdCBuZ0ZpZWxkcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRmllbGRzKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdGaWVsZHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdGaWVsZCA9IG5nRmllbGRzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdGaWVsZC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIC8vIGlmIChuZ0ZpZWxkLnByaW1hcnkgPT09IGZhbHNlKSB7XHJcbiAgICAgIC8vICAgdGhpc1twcm9wTmFtZV0gPSBkYXRhW2RhdGFGaWVsZF07XHJcbiAgICAgIC8vIH1cclxuICAgICAgbGV0IHByb3BWYWx1ZSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgICAgaWYgKG5nRmllbGQuZW5hYmxlVGltZVpvbmUgPT09IHRydWUpIHtcclxuICAgICAgICBjb25zdCB0aW1lWm9uZU9mZnNldCA9IFVzZXJTZXR0aW5nc1NlcnZpY2UuZ2V0VGltZVpvbmVPZmZzZXQoKTtcclxuICAgICAgICBpZiAodGltZVpvbmVPZmZzZXQgIT09IG51bGwgJiYgcHJvcFZhbHVlKSB7XHJcbiAgICAgICAgICBwcm9wVmFsdWUgPSBab25lZFRpbWUuem9uZWRUaW1lVG9TcGVjaWFsVGltZVpvbmVPZmZzZXRUaW1lU3RyaW5nKHByb3BWYWx1ZSwgdGltZVpvbmVPZmZzZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzW3Byb3BOYW1lXSA9IHByb3BWYWx1ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yqg6L295a2Q5YiX6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGRhdGEg5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGxvYWRMaXN0cyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nTGlzdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QodGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nTGlzdCA9IG5nTGlzdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0xpc3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gbmdMaXN0LnR5cGU7XHJcblxyXG4gICAgICAvLyDliJvlu7rlrp7kvZNcclxuICAgICAgY29uc3QgbGlzdERhdGEgPSBkYXRhW2RhdGFGaWVsZF07XHJcbiAgICAgIGlmIChsaXN0RGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gbGlzdERhdGEubWFwKChlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgIHJldHVybiBFbnRpdHlGYWN0b3J5PHR5cGVvZiBlbnRpdHlUeXBlPihlbnRpdHlUeXBlLCBlbnRpdHlEYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzW3Byb3BOYW1lXS5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXNbcHJvcE5hbWVdLmxvYWRFbnRpdGllcyhbXSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsb2FkT2JqZWN0cyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0cykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ09iamVjdCA9IG5nT2JqZWN0c1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nT2JqZWN0LmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgY29uc3Qgb2JqZWN0RGF0YSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgICAgY29uc3QgZW50aXR5ID0gdGhpc1twcm9wTmFtZV0gYXMgRW50aXR5O1xyXG4gICAgICBpZiAoIWVudGl0eSB8fCAhb2JqZWN0RGF0YSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBlbnRpdHkubG9hZChvYmplY3REYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGxvYWREeW5hbWljT2JqZWN0cyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nRHluYW1pY09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNPYmplY3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRHluYW1pY09iamVjdCA9IG5nRHluYW1pY09iamVjdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0R5bmFtaWNPYmplY3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG5cclxuICAgICAgY29uc3QgZHluYW1pY0RhdGEgPSBkYXRhW2RhdGFGaWVsZF0gfHwge307XHJcbiAgICAgIGNvbnN0IGR5bmFtaWNFbnRpdHkgPSB0aGlzW3Byb3BOYW1lXSBhcyBEeW5hbWljO1xyXG4gICAgICBpZiAoIWR5bmFtaWNFbnRpdHkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgZHluYW1pY0VudGl0eS5sb2FkRHluYW1pY0RhdGEoZHluYW1pY0RhdGEpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vICNyZWdpb24g56eB5pyJ5bel5YW35pa55rOVXHJcblxyXG5cclxuICAvKipcclxuICAgKiDlj5HpgIHlgLzlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIGVtaXRWYWx1ZUNoYW5nZShwcm9wTmFtZTogc3RyaW5nLCBwcm9wTWV0YWRhdGE6IE5nRmllbGRQcm9wZXJ0eSwgbmV3UHJvcFZhbHVlOiBhbnksIG9sZFByb3BWYWx1ZTogYW55LCBjaGFuZ2VTZXRWYWx1ZTogYW55ID0gdW5kZWZpbmVkKTogdm9pZCB7XHJcbiAgICBjb25zdCBjaGFuZ2UgPSB7XHJcbiAgICAgIHBhdGg6IHRoaXMuY3JlYXRlUGF0aChwcm9wTmFtZSksXHJcbiAgICAgIHZhbHVlOiBuZXdQcm9wVmFsdWUsXHJcbiAgICAgIGNoYW5nZVNldFZhbHVlLFxyXG4gICAgICBwcmVWYWx1ZTogb2xkUHJvcFZhbHVlLFxyXG4gICAgICB0eXBlOiBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh0aGlzW1BBUkVOVF9QQVRIXSkge1xyXG4gICAgICBjaGFuZ2UucGF0aCA9IHRoaXNbUEFSRU5UX1BBVEhdLmNvbmNhdChjaGFuZ2UucGF0aCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldENoYW5nZXMoY2hhbmdlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5YeG5aSH5o+Q5Lqk57uZ5ZCO56uv55qE5bGe5oCn5YC8XHJcbiAgICogQHBhcmFtIHByb3BOYW1lIOWxnuaAp1xyXG4gICAqIEBwYXJhbSBwcm9wTWV0YWRhdGEg5bGe5oCn5o+P6L+wXHJcbiAgICogQHBhcmFtIHByb3BWYWx1ZSDlsZ7mgKflgLxcclxuICAgKi9cclxuICBwcml2YXRlIHByZXBhcmVQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHksIHByb3BWYWx1ZTogYW55KSB7XHJcbiAgICBsZXQgdmFsdWUgPSB1bmRlZmluZWQ7XHJcbiAgICAvLyDlj6ropoHlkK/nlKjml7bljLrvvIzkvKDnu5nlkI7nq6/nmoTml7bpl7TlsLHlv4XpobvluKbml7bljLrvvIzlm6DmraTlvZPojrflj5bnlKjmiLfml7bljLrlpLHotKXnmoTml7blgJnvvIzojrflj5bmtY/op4jlmajlvZPliY3ml7bljLpcclxuICAgIGlmIChwcm9wTWV0YWRhdGEuZW5hYmxlVGltZVpvbmUgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgdGltZVpvbmVPZmZzZXQgPSBVc2VyU2V0dGluZ3NTZXJ2aWNlLmdldFRpbWVab25lT2Zmc2V0KCk7XHJcbiAgICAgIGlmICh0aW1lWm9uZU9mZnNldCAhPT0gbnVsbCAmJiBwcm9wVmFsdWUpIHtcclxuICAgICAgICB2YWx1ZSA9IFpvbmVkVGltZS50aW1lWm9uZU9mZnNldFRpbWVUb1V0Y1RpbWVTdHJpbmcocHJvcFZhbHVlLCB0aW1lWm9uZU9mZnNldCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB2YWx1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHkpIHtcclxuICAgIGNvbnN0IGRhdGFGaWVsZCA9IHByb3BNZXRhZGF0YS5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICBsZXQgdmFsdWUgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXTtcclxuXHJcbiAgICAvLyDlr7nlpJror63lvZXlhaXlrZfmrrXvvIxxdWVyeeS4jei/lOWbnumXrumimOi/m+ihjOWFvOWuuVxyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVNdWx0aUxhbmdJbnB1dCA9PT0gdHJ1ZSAmJiAhdmFsdWUpIHtcclxuICAgICAgY29uc3QgbGFuZ0NvZGUgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIHx8ICd6aC1DSFMnO1xyXG4gICAgICBjb25zdCBvcmlnaW5EYXRhRmllbGQgPSBkYXRhRmllbGQucmVwbGFjZSgnX01VTFRJTEFOR1VBR0UnLCAnJyk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgW2xhbmdDb2RlXTogdGhpcy5kYXRhW29yaWdpbkRhdGFGaWVsZF1cclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIC8vIOWQr+eUqOaXtuWMulxyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVUaW1lWm9uZSA9PT0gdHJ1ZSkge1xyXG4gICAgICBjb25zdCB0aW1lWm9uZU9mZnNldCA9IFVzZXJTZXR0aW5nc1NlcnZpY2UuZ2V0VGltZVpvbmVPZmZzZXQoKTtcclxuICAgICAgaWYgKHRpbWVab25lT2Zmc2V0ICE9PSBudWxsICYmIHZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIFpvbmVkVGltZS56b25lZFRpbWVUb1NwZWNpYWxUaW1lWm9uZU9mZnNldFRpbWVTdHJpbmcodmFsdWUsIHRpbWVab25lT2Zmc2V0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5vcmlnaW5hbERhdGFGaWVsZFR5cGUgPT09IEJpZ051bWJlclR5cGUpIHtcclxuICAgICAgdmFsdWUgPSB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlLnRvU3RyaW5nKCkgfHwgbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiB2YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWxnuaAp+WAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0UHJvcFZhbHVlKHByb3BOYW1lOiBzdHJpbmcsIHByb3BNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5LCBwcm9wVmFsdWU6IGFueSkge1xyXG4gICAgY29uc3QgZGF0YUZpZWxkID0gcHJvcE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgIGlmIChwcm9wTWV0YWRhdGEub3JpZ2luYWxEYXRhRmllbGRUeXBlID09PSBCaWdOdW1iZXJUeXBlKSB7XHJcbiAgICAgIHRoaXMuZGF0YVtkYXRhRmllbGRdID0gcHJvcFZhbHVlID09PSBudWxsID8gbnVsbCA6IHByb3BWYWx1ZSAmJiBwcm9wVmFsdWUudG9TdHJpbmcoKSB8fCAnJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChwcm9wTWV0YWRhdGEuZW5hYmxlVGltZVpvbmUgPT09IHRydWUpIHtcclxuICAgICAgICBjb25zdCB0aW1lWm9uZU9mZnNldCA9IFVzZXJTZXR0aW5nc1NlcnZpY2UuZ2V0VGltZVpvbmVPZmZzZXQoKTtcclxuICAgICAgICBpZiAodGltZVpvbmVPZmZzZXQgIT09IG51bGwgJiYgcHJvcFZhbHVlKSB7XHJcbiAgICAgICAgICBwcm9wVmFsdWUgPSBab25lZFRpbWUudGltZVpvbmVPZmZzZXRUaW1lVG9VdGNUaW1lU3RyaW5nKHByb3BWYWx1ZSwgdGltZVpvbmVPZmZzZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRhdGFbZGF0YUZpZWxkXSA9IHByb3BWYWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpeWxnuaAp+WAvOaYr+WQpuWPkeeUn+WPmOWMllxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNQcm9wVmFsdWVDaGFuZ2VkKHByb3BOYW1lOiBzdHJpbmcsIHByb3BNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5LCBuZXdQcm9wVmFsdWU6IGFueSwgb2xkUHJvcFZhbHVlOiBhbnkpIHtcclxuICAgIGlmIChwcm9wTWV0YWRhdGEuZW5hYmxlTXVsdGlMYW5nSW5wdXQgPT09IHRydWUpIHtcclxuICAgICAgaWYgKHRoaXMuaXNFbXB0eU11bHRpTGFuZ1Byb3BWYWx1ZShuZXdQcm9wVmFsdWUpID09PSB0cnVlICYmIHRoaXMuaXNFbXB0eU11bHRpTGFuZ1Byb3BWYWx1ZShvbGRQcm9wVmFsdWUpID09PSB0cnVlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShuZXdQcm9wVmFsdWUpICE9PSBKU09OLnN0cmluZ2lmeShvbGRQcm9wVmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmIChwcm9wTWV0YWRhdGEub3JpZ2luYWxEYXRhRmllbGRUeXBlID09PSBCaWdOdW1iZXJUeXBlKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgbmV3UHJvcFZhbHVlICE9PSAnc3RyaW5nJyAmJiBuZXdQcm9wVmFsdWUgIT09IG51bGwgJiYgbmV3UHJvcFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBuZXdQcm9wVmFsdWUgPSBuZXdQcm9wVmFsdWUudG9TdHJpbmcoKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbmV3UHJvcFZhbHVlICE9PSBvbGRQcm9wVmFsdWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3UHJvcFZhbHVlICE9PSBvbGRQcm9wVmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpJror63lvZXlhaXlrZfmrrXnmoTlgLzmmK/lkKbkuLrnqbpcclxuICAgKi9cclxuICBwcml2YXRlIGlzRW1wdHlNdWx0aUxhbmdQcm9wVmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpO1xyXG4gICAgaWYgKGtleXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWAvOWFqOmDqOS4uuepuu+8jOinhuS4uuepulxyXG4gICAgY29uc3QgdmFscyA9IE9iamVjdC52YWx1ZXModmFsdWUpO1xyXG4gICAgY29uc3QgYWxsRW1wdHlWYWwgPSB2YWxzLmV2ZXJ5KCh2YWwpID0+IHtcclxuICAgICAgcmV0dXJuICF2YWw7XHJcbiAgICB9KTtcclxuICAgIGlmIChhbGxFbXB0eVZhbCA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIC8vICNlbmRyZWdpb25cclxufVxyXG4iXX0=
/**
 * 数据验证帮助类，提供一些公共的操作方法函数
 */
export class ValidationUtils {
    /**
     * 将错误信息集合转变为可读性高的文本数组
     * @param errors 验证失败错误集合
     * @param messages 返回的错误信息文本集合
     * @param parentPath 验证属性上级路径
     */
    static createDetailedErrorMessage(errors, messages = [], parentPath = '') {
        errors.forEach(error => {
            const targetName = error.target ? error.target.constructor.name : '';
            const property = error.propertyName;
            const propConstraintFailed = (propertyName) => `   - 属性 ${parentPath}${propertyName} 验证失败的规则:  \n` +
                `${Object.keys(error.constraints)
                    .map(ruleName => {
                    return `        #${ruleName}: ${error.constraints[ruleName]}\n`;
                })
                    .join('')}`;
            if (!parentPath) {
                messages.push(`类型为 ${targetName} 的实例对象数据验证失败，详细信息：\n`);
                if (error.constraints) {
                    messages.push(propConstraintFailed(property));
                }
                if (error.children.length) {
                    ValidationUtils.createDetailedErrorMessage(error.children, messages, property);
                }
            }
            else {
                const formattedProperty = Number.isInteger(+error.index)
                    ? `[${error.index}].${property}`
                    : `${parentPath ? `.` : ``}${property}`;
                if (error.constraints) {
                    messages.push(propConstraintFailed(formattedProperty));
                }
                if (error.children.length) {
                    ValidationUtils.createDetailedErrorMessage(error.children, messages, `${parentPath}${formattedProperty}`);
                }
            }
        });
        return messages;
    }
    /**
     * 错误信息集合转换为简单对象格式
     * @param errors 错误信息集合
     * @param errObj 返回简单对象。如:
     * ```
     * { name: { required: '必填', max: '最大值99' },
     *   list: {
     *      0: { name:{required: '必填'},
     *           age: { min: '最小值 20' }
     *         },
     *      2: { ... }
     *   }
     * }
     *
     * ```
     */
    static convertErrorsToNormalObject(errors, errObj) {
        errors.forEach(err => {
            const property = err.propertyName;
            const buildArray = (childErrors) => {
                const itemErr = {};
                childErrors.forEach((childErr) => {
                    if (childErr.children.length) {
                        itemErr[childErr.index] = ValidationUtils.convertErrorsToNormalObject(childErr.children, childErr);
                    }
                    else {
                        if (itemErr[childErr.index]) {
                            itemErr[childErr.index] = Object.assign({}, itemErr[childErr.index], {
                                [childErr.propertyName]: childErr.constraints
                            });
                        }
                        else {
                            itemErr[childErr.index] = { [childErr.propertyName]: childErr.constraints };
                        }
                    }
                });
                return itemErr;
            };
            if (!err.isArray) {
                if (!err.children.length) {
                    errObj[property] = err.constraints;
                }
                else {
                    errObj[property] = ValidationUtils.convertErrorsToNormalObject(err.children, errObj);
                }
            }
            else {
                errObj[property] = buildArray(err.children);
            }
        });
        return errObj;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbl91dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS92YWxpZGF0b3IvdmFsaWRhdGlvbl91dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQTs7R0FFRztBQUNILE1BQU0sT0FBTyxlQUFlO0lBRTFCOzs7OztPQUtHO0lBQ0gsTUFBTSxDQUFDLDBCQUEwQixDQUMvQixNQUF5QixFQUN6QixXQUFxQixFQUFFLEVBQ3ZCLGFBQXFCLEVBQUU7UUFFdkIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNyQixNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNyRSxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDO1lBRXBDLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxZQUFvQixFQUFVLEVBQUUsQ0FDNUQsV0FBVyxVQUFVLEdBQUcsWUFBWSxlQUFlO2dCQUNuRCxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztxQkFDOUIsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFFO29CQUNkLE9BQU8sWUFBWSxRQUFRLEtBQUssS0FBSyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO2dCQUNsRSxDQUFDLENBQUM7cUJBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFFaEIsSUFBSSxDQUFDLFVBQVUsRUFBRTtnQkFDZixRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sVUFBVSxzQkFBc0IsQ0FBQyxDQUFDO2dCQUV2RCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUU7b0JBQ3JCLFFBQVEsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFD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QUMsQ0FBQzthQUM3QztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmFsaWRhdGlvbkVycm9yIH0gZnJvbSAnLi92YWxpZGF0aW9uX2Vycm9yJztcclxuaW1wb3J0IHsgVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gJy4vdHlwZXMnO1xyXG4vKipcclxuICog5pWw5o2u6aqM6K+B5biu5Yqp57G777yM5o+Q5L6b5LiA5Lqb5YWs5YWx55qE5pON5L2c5pa55rOV5Ye95pWwXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvblV0aWxzIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5bCG6ZSZ6K+v5L+h5oGv6ZuG5ZCI6L2s5Y+Y5Li65Y+v6K+75oCn6auY55qE5paH5pys5pWw57uEXHJcbiAgICogQHBhcmFtIGVycm9ycyDpqozor4HlpLHotKXplJnor6/pm4blkIhcclxuICAgKiBAcGFyYW0gbWVzc2FnZXMg6L+U5Zue55qE6ZSZ6K+v5L+h5oGv5paH5pys6ZuG5ZCIXHJcbiAgICogQHBhcmFtIHBhcmVudFBhdGgg6aqM6K+B5bGe5oCn5LiK57qn6Lev5b6EXHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZURldGFpbGVkRXJyb3JNZXNzYWdlKFxyXG4gICAgZXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSxcclxuICAgIG1lc3NhZ2VzOiBzdHJpbmdbXSA9IFtdLFxyXG4gICAgcGFyZW50UGF0aDogc3RyaW5nID0gJydcclxuICApOiBzdHJpbmdbXSB7XHJcbiAgICBlcnJvcnMuZm9yRWFjaChlcnJvciA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldE5hbWUgPSBlcnJvci50YXJnZXQgPyBlcnJvci50YXJnZXQuY29uc3RydWN0b3IubmFtZSA6ICcnO1xyXG4gICAgICBjb25zdCBwcm9wZXJ0eSA9IGVycm9yLnByb3BlcnR5TmFtZTtcclxuXHJcbiAgICAgIGNvbnN0IHByb3BDb25zdHJhaW50RmFpbGVkID0gKHByb3BlcnR5TmFtZTogc3RyaW5nKTogc3RyaW5nID0+XHJcbiAgICAgICAgYCAgIC0g5bGe5oCnICR7cGFyZW50UGF0aH0ke3Byb3BlcnR5TmFtZX0g6aqM6K+B5aSx6LSl55qE6KeE5YiZOiAgXFxuYCArXHJcbiAgICAgICAgYCR7T2JqZWN0LmtleXMoZXJyb3IuY29uc3RyYWludHMpXHJcbiAgICAgICAgICAubWFwKHJ1bGVOYW1lID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGAgICAgICAgICMke3J1bGVOYW1lfTogJHtlcnJvci5jb25zdHJhaW50c1tydWxlTmFtZV19XFxuYDtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuam9pbignJyl9YDtcclxuXHJcbiAgICAgIGlmICghcGFyZW50UGF0aCkge1xyXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goYOexu+Wei+S4uiAke3RhcmdldE5hbWV9IOeahOWunuS+i+WvueixoeaVsOaNrumqjOivgeWksei0pe+8jOivpue7huS/oeaBr++8mlxcbmApO1xyXG5cclxuICAgICAgICBpZiAoZXJyb3IuY29uc3RyYWludHMpIHtcclxuICAgICAgICAgIG1lc3NhZ2VzLnB1c2gocHJvcENvbnN0cmFpbnRGYWlsZWQocHJvcGVydHkpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChlcnJvci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgIFZhbGlkYXRpb25VdGlscy5jcmVhdGVEZXRhaWxlZEVycm9yTWVzc2FnZShlcnJvci5jaGlsZHJlbiwgbWVzc2FnZXMsIHByb3BlcnR5KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkUHJvcGVydHkgPSBOdW1iZXIuaXNJbnRlZ2VyKCtlcnJvci5pbmRleClcclxuICAgICAgICAgID8gYFske2Vycm9yLmluZGV4fV0uJHtwcm9wZXJ0eX1gXHJcbiAgICAgICAgICA6IGAke3BhcmVudFBhdGggPyBgLmAgOiBgYH0ke3Byb3BlcnR5fWA7XHJcbiAgICAgICAgaWYgKGVycm9yLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKHByb3BDb25zdHJhaW50RmFpbGVkKGZvcm1hdHRlZFByb3BlcnR5KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlcnJvci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgIFZhbGlkYXRpb25VdGlscy5jcmVhdGVEZXRhaWxlZEVycm9yTWVzc2FnZShlcnJvci5jaGlsZHJlbiwgbWVzc2FnZXMsIGAke3BhcmVudFBhdGh9JHtmb3JtYXR0ZWRQcm9wZXJ0eX1gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBtZXNzYWdlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmUmeivr+S/oeaBr+mbhuWQiOi9rOaNouS4uueugOWNleWvueixoeagvOW8j1xyXG4gICAqIEBwYXJhbSBlcnJvcnMg6ZSZ6K+v5L+h5oGv6ZuG5ZCIXHJcbiAgICogQHBhcmFtIGVyck9iaiDov5Tlm57nroDljZXlr7nosaHjgILlpoI6XHJcbiAgICogYGBgXHJcbiAgICogeyBuYW1lOiB7IHJlcXVpcmVkOiAn5b+F5aGrJywgbWF4OiAn5pyA5aSn5YC8OTknIH0sXHJcbiAgICogICBsaXN0OiB7XHJcbiAgICogICAgICAwOiB7IG5hbWU6e3JlcXVpcmVkOiAn5b+F5aGrJ30sXHJcbiAgICogICAgICAgICAgIGFnZTogeyBtaW46ICfmnIDlsI/lgLwgMjAnIH1cclxuICAgKiAgICAgICAgIH0sXHJcbiAgICogICAgICAyOiB7IC4uLiB9XHJcbiAgICogICB9XHJcbiAgICogfVxyXG4gICAqXHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgc3RhdGljIGNvbnZlcnRFcnJvcnNUb05vcm1hbE9iamVjdChlcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdLCBlcnJPYmo6IHt9KToge30ge1xyXG4gICAgZXJyb3JzLmZvckVhY2goZXJyID0+IHtcclxuICAgICAgY29uc3QgcHJvcGVydHkgPSBlcnIucHJvcGVydHlOYW1lO1xyXG5cclxuICAgICAgY29uc3QgYnVpbGRBcnJheSA9IChjaGlsZEVycm9yczogVmFsaWRhdGlvbkVycm9yW10pID0+IHtcclxuICAgICAgICBjb25zdCBpdGVtRXJyID0ge307XHJcbiAgICAgICAgY2hpbGRFcnJvcnMuZm9yRWFjaCgoY2hpbGRFcnI6IFZhbGlkYXRpb25FcnJvcikgPT4ge1xyXG4gICAgICAgICAgaWYgKGNoaWxkRXJyLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpdGVtRXJyW2NoaWxkRXJyLmluZGV4XSA9IFZhbGlkYXRpb25VdGlscy5jb252ZXJ0RXJyb3JzVG9Ob3JtYWxPYmplY3QoY2hpbGRFcnIuY2hpbGRyZW4sIGNoaWxkRXJyKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtRXJyW2NoaWxkRXJyLmluZGV4XSkge1xyXG4gICAgICAgICAgICAgIGl0ZW1FcnJbY2hpbGRFcnIuaW5kZXhdID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbUVycltjaGlsZEVyci5pbmRleF0sIHtcclxuICAgICAgICAgICAgICAgIFtjaGlsZEVyci5wcm9wZXJ0eU5hbWVdOiBjaGlsZEVyci5jb25zdHJhaW50c1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGl0ZW1FcnJbY2hpbGRFcnIuaW5kZXhdID0geyBbY2hpbGRFcnIucHJvcGVydHlOYW1lXTogY2hpbGRFcnIuY29uc3RyYWludHMgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gaXRlbUVycjtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGlmICghZXJyLmlzQXJyYXkpIHtcclxuICAgICAgICBpZiAoIWVyci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgIGVyck9ialtwcm9wZXJ0eV0gPSBlcnIuY29uc3RyYWludHM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGVyck9ialtwcm9wZXJ0eV0gPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KGVyci5jaGlsZHJlbiwgZXJyT2JqKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZXJyT2JqW3Byb3BlcnR5XSA9IGJ1aWxkQXJyYXkoZXJyLmNoaWxkcmVuKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGVyck9iajtcclxuICB9XHJcbn1cclxuIl19
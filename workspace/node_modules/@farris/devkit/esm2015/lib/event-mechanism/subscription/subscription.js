import { Injectable } from '@angular/core';
import { MetadataUtil } from '../../metadata/index';
import { NG_SUBSCRIPTION } from './subscription_decorator';
class Subscription {
    /**
     * 初始化
     */
    init(frameComponent) {
        if (!frameComponent) {
            return;
        }
        return this.bindSubscription(frameComponent, null);
    }
    /**
     *  根据订阅列表进行初始化
     * @param frameComponent
     * @param ngEvents 订阅列表
     * @returns eventPipes
     */
    initWithSubscriptions(frameComponent, ngEvents) {
        if (!frameComponent) {
            return;
        }
        return this.bindSubscription(frameComponent, ngEvents);
    }
    /**
     * 更改成为public形式 目的为了解析表单可以进行重新绑定
     * @param frameComponent
     * @param ngEvents
     * @returns
     */
    bindSubscription(frameComponent, ngEvents) {
        const context = frameComponent.context;
        if (!context) {
            return;
        }
        const ngEventHandlerProps = ngEvents ? ngEvents : this.getNgEvents(frameComponent);
        if (!ngEventHandlerProps) {
            return;
        }
        const eventPipes = [];
        Object.keys(ngEventHandlerProps).forEach((propertyName) => {
            const ngImportEvent = ngEventHandlerProps[propertyName];
            // 获取待订阅方法详情，尝试执行订阅
            const targetContext = context;
            const receiver = frameComponent;
            const emitter = ngImportEvent.token;
            const tokenValue = ngImportEvent.token;
            const eventName = ngImportEvent.name;
            const paramMapCollection = ngImportEvent.paramMapCollection;
            const eventPipe = targetContext.eventBus.on(emitter, tokenValue, eventName, receiver, (eventArgs) => {
                this.subscriptionHandler(eventArgs, paramMapCollection, targetContext);
                const eventHandler = frameComponent[eventName];
                if (!eventHandler) {
                    return;
                }
                try {
                    eventHandler(receiver, eventArgs);
                }
                catch (_a) {
                    throw new Error('Error invoking method ' + eventName);
                }
            });
            eventPipes.push(eventPipe);
        });
        return eventPipes;
    }
    /**
     * 获取组件订阅列表
     * @param frameComponent 表单component
     * @returns 组件订阅列表信息
     */
    getNgEvents(frameComponent) {
        return MetadataUtil.getPropsMetadatasByName(frameComponent.constructor, NG_SUBSCRIPTION);
    }
    subscriptionHandler(param, paramMapCollection, currentFrameContext) {
        if (!param || !paramMapCollection || paramMapCollection.length <= 0 || !currentFrameContext) {
            return;
        }
        this.paramMap2UiState(param, paramMapCollection, currentFrameContext);
    }
    /**
     * 设置paramMap后，将param映射到UISTATE上
     */
    paramMap2UiState(param, paramMapCollection, currentFrameContext) {
        for (let i = 0; i < paramMapCollection.length; i++) {
            const from = paramMapCollection[i].from;
            const frameId = paramMapCollection[i].frameId;
            const to = paramMapCollection[i].to;
            if (!from || !frameId || !to) {
                continue;
            }
            const destContext = this.getFrameContext(frameId, currentFrameContext);
            if (destContext == null) {
                continue;
            }
            this.setUiStateProperty(to, param[from], destContext.uiState);
            // this.setUiStateProperty(to, param[from], currentFrameContext.uiState);
        }
    }
    getFrameContext(targetFrameContextId, currentContext) {
        let destContext = null;
        try {
            destContext = currentContext.appContext.getFrameContext(targetFrameContextId);
        }
        catch (_a) {
            throw new Error('Error in Getting FrameContext');
        }
        return destContext;
    }
    setUiStateProperty(propertyName, propertyValue, uiState) {
        try {
            uiState.setPropertyValue(propertyName, propertyValue);
        }
        catch (_a) {
            throw new Error("Error in Setting Property Value of the current UISTATE" + uiState);
        }
    }
}
Subscription.decorators = [
    { type: Injectable }
];
export { Subscription };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Vic2NyaXB0aW9uLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZXZlbnQtbWVjaGFuaXNtL3N1YnNjcmlwdGlvbi9zdWJzY3JpcHRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHcEQsT0FBTyxFQUFFLGVBQWUsRUFBNEIsTUFBTSwwQkFBMEIsQ0FBQztBQUdyRixNQUNNLFlBQVk7SUFFaEI7O09BRUc7SUFDSSxJQUFJLENBQUMsY0FBOEI7UUFDeEMsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFFRCxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUdEOzs7OztPQUtHO0lBQ0kscUJBQXFCLENBQUMsY0FBOEIsRUFBRSxRQUU1RDtRQUNDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDbkIsT0FBTztTQUNSO1FBRUQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLGdCQUFnQixDQUFDLGNBQThCLEVBQUUsUUFFdkQ7UUFDQyxNQUFNLE9BQU8sR0FBRyxjQUFjLENBQUMsT0FBTyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixPQUFPO1NBQ1I7UUFFRCxNQUFNLG1CQUFtQixHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxtQkFBbUIsRUFBRTtZQUN4QixPQUFPO1NBQ1I7UUFFRCxNQUFNLFVBQVUsR0FBa0IsRUFBRSxD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T0FBTyxDQUFDLENBQUM7WUFDOUQseUVBQXlFO1NBQzFFO0lBQ0gsQ0FBQztJQUVPLGVBQWUsQ0FBQyxvQkFBNEIsRUFBRSxjQUE0QjtRQUNoRixJQUFJLFdBQVcsR0FBaUIsSUFBSSxDQUFDO1FBQ3JDLElBQUk7WUFDRixXQUFXLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUMsQ0FBQztTQUMvRTtRQUFDLFdBQU07WUFDTixNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUM7U0FDbEQ7UUFDRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRU8sa0JBQWtCLENBQUMsWUFBb0IsRUFBRSxhQUFxQixFQUFFLE9BQWdCO1FBQ3RGLElBQUk7WUFDRixPQUFPLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQ3ZEO1FBQUMsV0FBTTtZQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsd0RBQXdELEdBQUcsT0FBTyxDQUFDLENBQUM7U0FDckY7SUFDSCxDQUFDOzs7WUE3SUYsVUFBVTs7QUFpSlgsT0FBTyxFQUFFLFlBQVksRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWV0YWRhdGFVdGlsIH0gZnJvbSAnLi4vLi4vbWV0YWRhdGEvaW5kZXgnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIEZyYW1lQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZnJhbWUvaW5kZXgnO1xyXG5pbXBvcnQgeyBVSVN0YXRlIH0gZnJvbSAnLi4vLi4vdWktc3RhdGUvaW5kZXgnO1xyXG5pbXBvcnQgeyBOR19TVUJTQ1JJUFRJT04sIE5nU3Vic2NyaXB0aW9uLCBQYXJhbU1hcCB9IGZyb20gJy4vc3Vic2NyaXB0aW9uX2RlY29yYXRvcic7XHJcbmltcG9ydCB7IElEaXNwb3NhYmxlIH0gZnJvbSAnLi4vLi4vY29yZS9pbmRleCc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIFN1YnNjcmlwdGlvbiB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMllxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0KGZyYW1lQ29tcG9uZW50OiBGcmFtZUNvbXBvbmVudCk6IElEaXNwb3NhYmxlW10ge1xyXG4gICAgaWYgKCFmcmFtZUNvbXBvbmVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuYmluZFN1YnNjcmlwdGlvbihmcmFtZUNvbXBvbmVudCwgbnVsbCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogIOagueaNruiuoumYheWIl+ihqOi/m+ihjOWIneWni+WMllxyXG4gICAqIEBwYXJhbSBmcmFtZUNvbXBvbmVudCBcclxuICAgKiBAcGFyYW0gbmdFdmVudHMg6K6i6ZiF5YiX6KGoXHJcbiAgICogQHJldHVybnMgZXZlbnRQaXBlc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpbml0V2l0aFN1YnNjcmlwdGlvbnMoZnJhbWVDb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50LCBuZ0V2ZW50czoge1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbiAgfSk6IElEaXNwb3NhYmxlW10ge1xyXG4gICAgaWYgKCFmcmFtZUNvbXBvbmVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuYmluZFN1YnNjcmlwdGlvbihmcmFtZUNvbXBvbmVudCwgbmdFdmVudHMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pu05pS55oiQ5Li6cHVibGlj5b2i5byPIOebrueahOS4uuS6huino+aekOihqOWNleWPr+S7pei/m+ihjOmHjeaWsOe7keWumlxyXG4gICAqIEBwYXJhbSBmcmFtZUNvbXBvbmVudCBcclxuICAgKiBAcGFyYW0gbmdFdmVudHMgXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHVibGljIGJpbmRTdWJzY3JpcHRpb24oZnJhbWVDb21wb25lbnQ6IEZyYW1lQ29tcG9uZW50LCBuZ0V2ZW50czoge1xyXG4gICAgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnk7XHJcbiAgfSkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IGZyYW1lQ29tcG9uZW50LmNvbnRleHQ7XHJcbiAgICBpZiAoIWNvbnRleHQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5nRXZlbnRIYW5kbGVyUHJvcHMgPSBuZ0V2ZW50cyA/IG5nRXZlbnRzIDogdGhpcy5nZXROZ0V2ZW50cyhmcmFtZUNvbXBvbmVudCk7XHJcbiAgICBpZiAoIW5nRXZlbnRIYW5kbGVyUHJvcHMpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGV2ZW50UGlwZXM6IElEaXNwb3NhYmxlW10gPSBbXTtcclxuICAgIE9iamVjdC5rZXlzKG5nRXZlbnRIYW5kbGVyUHJvcHMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nSW1wb3J0RXZlbnQ6IE5nU3Vic2NyaXB0aW9uID0gbmdFdmVudEhhbmRsZXJQcm9wc1twcm9wZXJ0eU5hbWVdO1xyXG5cclxuICAgICAgLy8g6I635Y+W5b6F6K6i6ZiF5pa55rOV6K+m5oOF77yM5bCd6K+V5omn6KGM6K6i6ZiFXHJcbiAgICAgIGNvbnN0IHRhcmdldENvbnRleHQgPSBjb250ZXh0O1xyXG5cclxuICAgICAgY29uc3QgcmVjZWl2ZXIgPSBmcmFtZUNvbXBvbmVudDtcclxuICAgICAgY29uc3QgZW1pdHRlciA9IG5nSW1wb3J0RXZlbnQudG9rZW47XHJcbiAgICAgIGNvbnN0IHRva2VuVmFsdWUgPSBuZ0ltcG9ydEV2ZW50LnRva2VuO1xyXG4gICAgICBjb25zdCBldmVudE5hbWUgPSBuZ0ltcG9ydEV2ZW50Lm5hbWU7XHJcblxyXG4gICAgICBjb25zdCBwYXJhbU1hcENvbGxlY3Rpb24gPSBuZ0ltcG9ydEV2ZW50LnBhcmFtTWFwQ29sbGVjdGlvbjtcclxuICAgICAgY29uc3QgZXZlbnRQaXBlID0gdGFyZ2V0Q29udGV4dC5ldmVudEJ1cy5vbihlbWl0dGVyLCB0b2tlblZhbHVlLCBldmVudE5hbWUsIHJlY2VpdmVyLFxyXG4gICAgICAgIChldmVudEFyZ3MpID0+IHtcclxuICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uSGFuZGxlcihldmVudEFyZ3MsIHBhcmFtTWFwQ29sbGVjdGlvbiwgdGFyZ2V0Q29udGV4dCk7XHJcblxyXG4gICAgICAgICAgY29uc3QgZXZlbnRIYW5kbGVyOiBGdW5jdGlvbiA9IGZyYW1lQ29tcG9uZW50W2V2ZW50TmFtZV07XHJcbiAgICAgICAgICBpZiAoIWV2ZW50SGFuZGxlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgZXZlbnRIYW5kbGVyKHJlY2VpdmVyLCBldmVudEFyZ3MpO1xyXG4gICAgICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgaW52b2tpbmcgbWV0aG9kICcgKyBldmVudE5hbWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIGV2ZW50UGlwZXMucHVzaChldmVudFBpcGUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGV2ZW50UGlwZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bnu4Tku7borqLpmIXliJfooahcclxuICAgKiBAcGFyYW0gZnJhbWVDb21wb25lbnQg6KGo5Y2VY29tcG9uZW50XHJcbiAgICogQHJldHVybnMg57uE5Lu26K6i6ZiF5YiX6KGo5L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIGdldE5nRXZlbnRzKGZyYW1lQ29tcG9uZW50OiBGcmFtZUNvbXBvbmVudCkge1xyXG4gICAgcmV0dXJuIE1ldGFkYXRhVXRpbC5nZXRQcm9wc01ldGFkYXRhc0J5TmFtZShmcmFtZUNvbXBvbmVudC5jb25zdHJ1Y3RvciwgTkdfU1VCU0NSSVBUSU9OKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uSGFuZGxlcihwYXJhbTogYW55LCBwYXJhbU1hcENvbGxlY3Rpb246IFBhcmFtTWFwW10sIGN1cnJlbnRGcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xyXG5cclxuICAgIGlmICghcGFyYW0gfHwgIXBhcmFtTWFwQ29sbGVjdGlvbiB8fCBwYXJhbU1hcENvbGxlY3Rpb24ubGVuZ3RoIDw9IDAgfHwgIWN1cnJlbnRGcmFtZUNvbnRleHQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucGFyYW1NYXAyVWlTdGF0ZShwYXJhbSwgcGFyYW1NYXBDb2xsZWN0aW9uLCBjdXJyZW50RnJhbWVDb250ZXh0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9rnBhcmFtTWFw5ZCO77yM5bCGcGFyYW3mmKDlsITliLBVSVNUQVRF5LiKXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwYXJhbU1hcDJVaVN0YXRlKHBhcmFtOiBhbnksIHBhcmFtTWFwQ29sbGVjdGlvbjogUGFyYW1NYXBbXSwgY3VycmVudEZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0KSB7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmFtTWFwQ29sbGVjdGlvbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBmcm9tID0gcGFyYW1NYXBDb2xsZWN0aW9uW2ldLmZyb207XHJcbiAgICAgIGNvbnN0IGZyYW1lSWQgPSBwYXJhbU1hcENvbGxlY3Rpb25baV0uZnJhbWVJZDtcclxuICAgICAgY29uc3QgdG8gPSBwYXJhbU1hcENvbGxlY3Rpb25baV0udG87XHJcblxyXG4gICAgICBpZiAoIWZyb20gfHwgIWZyYW1lSWQgfHwgIXRvKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgZGVzdENvbnRleHQ6IEZyYW1lQ29udGV4dCA9IHRoaXMuZ2V0RnJhbWVDb250ZXh0KGZyYW1lSWQsIGN1cnJlbnRGcmFtZUNvbnRleHQpO1xyXG4gICAgICBpZiAoZGVzdENvbnRleHQgPT0gbnVsbCkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc2V0VWlTdGF0ZVByb3BlcnR5KHRvLCBwYXJhbVtmcm9tXSwgZGVzdENvbnRleHQudWlTdGF0ZSk7XHJcbiAgICAgIC8vIHRoaXMuc2V0VWlTdGF0ZVByb3BlcnR5KHRvLCBwYXJhbVtmcm9tXSwgY3VycmVudEZyYW1lQ29udGV4dC51aVN0YXRlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RnJhbWVDb250ZXh0KHRhcmdldEZyYW1lQ29udGV4dElkOiBzdHJpbmcsIGN1cnJlbnRDb250ZXh0OiBGcmFtZUNvbnRleHQpOiBGcmFtZUNvbnRleHQge1xyXG4gICAgbGV0IGRlc3RDb250ZXh0OiBGcmFtZUNvbnRleHQgPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgZGVzdENvbnRleHQgPSBjdXJyZW50Q29udGV4dC5hcHBDb250ZXh0LmdldEZyYW1lQ29udGV4dCh0YXJnZXRGcmFtZUNvbnRleHRJZCk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBpbiBHZXR0aW5nIEZyYW1lQ29udGV4dCcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRlc3RDb250ZXh0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRVaVN0YXRlUHJvcGVydHkocHJvcGVydHlOYW1lOiBzdHJpbmcsIHByb3BlcnR5VmFsdWU6IHN0cmluZywgdWlTdGF0ZTogVUlTdGF0ZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgdWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5TmFtZSwgcHJvcGVydHlWYWx1ZSk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXJyb3IgaW4gU2V0dGluZyBQcm9wZXJ0eSBWYWx1ZSBvZiB0aGUgY3VycmVudCBVSVNUQVRFXCIgKyB1aVN0YXRlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBTdWJzY3JpcHRpb24gfTtcclxuIl19
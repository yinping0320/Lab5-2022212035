/* eslint-disable new-cap */
/* eslint-disable require-jsdoc */
/* eslint-disable valid-jsdoc */
import { Injectable } from '@angular/core';
import { Repository } from '../repository/index';
import { ExpressionUtil } from '../utils/expression_util';
import { ENTITY_TEMPLATE } from './types';
export class EntityDependencyResolver {
    constructor(repository) {
        this.repository = repository;
        this.entityTypeInfo = this.repository && this.repository.entityTypeInfo || null;
    }
    /**
     * 解析用户表达式中的实体依赖
     * @param expr 用户配置的完整表达式
     * @returns
     */
    resolve(expr) {
        const groupFunctionDependencies = ExpressionUtil.getGroupFunctionDependency(expr, this.repository.entityTypeInfo);
        const entityDependencies = this.getEntityDependency(expr);
        // 去除错误的到子表的依赖
        if (groupFunctionDependencies && groupFunctionDependencies.length > 0 && entityDependencies && entityDependencies.length > 0) {
            groupFunctionDependencies.forEach((dep) => {
                const index = entityDependencies.findIndex((item) => dep.startsWith(item));
                if (index !== -1) {
                    entityDependencies.splice(index, 1);
                }
            });
        }
        // 去重
        const merged = [...groupFunctionDependencies, ...entityDependencies];
        const deps = [...new Set(merged)];
        return deps;
    }
    /**
     * 获取合法的实体属性表达式
     * @param entityPropertyExpression 实体属性表达式
     * @returns
     */
    getValidEntityPropertyExpression(entityPropertyExpression) {
        const propPaths = entityPropertyExpression.split('.');
        let propInfo = null;
        try {
            propInfo = this.entityTypeInfo.getPropInfoByPath(propPaths);
        }
        catch (e) { }
        if (!propInfo) {
            if (propPaths.length > 1) {
                propPaths.pop();
                return this.getValidEntityPropertyExpression(propPaths.join('.'));
            }
            else {
                return null;
            }
        }
        else {
            return entityPropertyExpression.split('.');
        }
    }
    /**
     * 获取所有实体依赖
     * @param expr 表达式字符串
     * @returns
     */
    getEntityDependency(expr) {
        const deps = [];
        if (this.entityTypeInfo) {
            // 使用正则匹配出所有实体
            const regex = new RegExp(`[\\'\\"]?\\s*(${this.entityTypeInfo.entityInfo.nodeCode}|${this.entityTypeInfo.entityInfo.originalCode})[\\.\\[\\]a-zA-Z0-9_]+\\s*[\\'\\"]?`, 'g');
            const entityPropertyExpressions = expr.match(regex);
            if (Array.isArray(entityPropertyExpressions) && entityPropertyExpressions.length > 0) {
                // 解析出所有实体相关的字符串，以主实体名字开头，包含主实体属性或子表
                entityPropertyExpressions.forEach((item) => {
                    if (item.indexOf('.') === -1) {
                        return;
                    }
                    // 去空格
                    item = item.trim().replace(/\"/g, '');
                    const paths = ExpressionUtil.convertToNodeCode(item, this.repository.entityTypeInfo);
                    item = paths.join('.');
                    // 截去主实体及点
                    item = item.substr(item.indexOf('.') + 1);
                    const dep = this.getValidEntityPropertyExpression(item);
                    if (dep && Array.isArray(dep) && dep.length > 0) {
                        // 此处必须加上主实体的名字来区分依赖的是实体还是其他类型的数据
                        dep.splice(0, 0, ENTITY_TEMPLATE);
                        deps.push(dep.join('/'));
                    }
                });
            }
        }
        else {
        }
        return deps;
    }
}
EntityDependencyResolver.decorators = [
    { type: Injectable }
];
/** @nocollapse */
EntityDependencyResolver.ctorParameters = () => [
    { type: Repository }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2RlcGVuZGVuY3lfcmVzb2x2ZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXNvbHZlci9lbnRpdHlfZGVwZW5kZW5jeV9yZXNvbHZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw0QkFBNEI7QUFDNUIsa0NBQWtDO0FBQ2xDLGdDQUFnQztBQUNoQyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUMvQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDeEQsT0FBTyxFQUFDLGVBQWUsRUFBWSxNQUFNLFNBQVMsQ0FBQztBQUduRCxNQUFNLE9BQU8sd0JBQXdCO0lBRW5DLFlBQW9CLFVBQTJCO1FBQTNCLGVBQVUsR0FBVixVQUFVLENBQWlCO1FBQzdDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUM7SUFDbEYsQ0FBQztJQUNEOzs7O09BSUc7SUFDSSxPQUFPLENBQUMsSUFBWTtRQUN6QixNQUFNLHlCQUF5QixHQUFHLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNsSCxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxRCxjQUFjO1FBQ2QsSUFBSSx5QkFBeUIsSUFBSSx5QkFBeUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLGtCQUFrQixJQUFJLGtCQUFrQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDNUgseUJBQXlCLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7Z0JBQ2hELE1BQU0sS0FBSyxHQUFH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QUksQ0FBQyxDQUFDO29CQUN4RCxJQUFJLEdBQUcsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO3dCQUMvQyxpQ0FBaUM7d0JBQ2pDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxlQUFlLENBQUMsQ0FBQzt3QkFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7cUJBQzFCO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ0o7U0FDRjthQUFNO1NBQ047UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7OztZQXBGRixVQUFVOzs7O1lBSkgsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi9cclxuLyogZXNsaW50LWRpc2FibGUgcmVxdWlyZS1qc2RvYyAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSB2YWxpZC1qc2RvYyAqL1xyXG5pbXBvcnQge0luamVjdGFibGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0RhdGFUeXBlSW5mb30gZnJvbSAnLi4vY29yZS9pbmRleCc7XHJcbmltcG9ydCB7UmVwb3NpdG9yeX0gZnJvbSAnLi4vcmVwb3NpdG9yeS9pbmRleCc7XHJcbmltcG9ydCB7RXhwcmVzc2lvblV0aWx9IGZyb20gJy4uL3V0aWxzL2V4cHJlc3Npb25fdXRpbCc7XHJcbmltcG9ydCB7RU5USVRZX1RFTVBMQVRFLCBJUmVzb2x2ZXJ9IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRW50aXR5RGVwZW5kZW5jeVJlc29sdmVyIGltcGxlbWVudHMgSVJlc29sdmVyIHtcclxuICBwcml2YXRlIGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm87XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4pIHtcclxuICAgIHRoaXMuZW50aXR5VHlwZUluZm8gPSB0aGlzLnJlcG9zaXRvcnkgJiYgdGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvIHx8IG51bGw7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOino+aekOeUqOaIt+ihqOi+vuW8j+S4reeahOWunuS9k+S+nei1llxyXG4gICAqIEBwYXJhbSBleHByIOeUqOaIt+mFjee9rueahOWujOaVtOihqOi+vuW8j1xyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIHJlc29sdmUoZXhwcjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgZ3JvdXBGdW5jdGlvbkRlcGVuZGVuY2llcyA9IEV4cHJlc3Npb25VdGlsLmdldEdyb3VwRnVuY3Rpb25EZXBlbmRlbmN5KGV4cHIsIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbyk7XHJcbiAgICBjb25zdCBlbnRpdHlEZXBlbmRlbmNpZXMgPSB0aGlzLmdldEVudGl0eURlcGVuZGVuY3koZXhwcik7XHJcbiAgICAvLyDljrvpmaTplJnor6/nmoTliLDlrZDooajnmoTkvp3otZZcclxuICAgIGlmIChncm91cEZ1bmN0aW9uRGVwZW5kZW5jaWVzICYmIGdyb3VwRnVuY3Rpb25EZXBlbmRlbmNpZXMubGVuZ3RoID4gMCAmJiBlbnRpdHlEZXBlbmRlbmNpZXMgJiYgZW50aXR5RGVwZW5kZW5jaWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZ3JvdXBGdW5jdGlvbkRlcGVuZGVuY2llcy5mb3JFYWNoKChkZXA6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gZW50aXR5RGVwZW5kZW5jaWVzLmZpbmRJbmRleCgoaXRlbSkgPT4gZGVwLnN0YXJ0c1dpdGgoaXRlbSkpO1xyXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgIGVudGl0eURlcGVuZGVuY2llcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyDljrvph41cclxuICAgIGNvbnN0IG1lcmdlZCA9IFsuLi5ncm91cEZ1bmN0aW9uRGVwZW5kZW5jaWVzLCAuLi5lbnRpdHlEZXBlbmRlbmNpZXNdO1xyXG4gICAgY29uc3QgZGVwcyA9IFsuLi5uZXcgU2V0KG1lcmdlZCldO1xyXG4gICAgcmV0dXJuIGRlcHM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWQiOazleeahOWunuS9k+WxnuaAp+ihqOi+vuW8j1xyXG4gICAqIEBwYXJhbSBlbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb24g5a6e5L2T5bGe5oCn6KGo6L6+5byPXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcml2YXRlIGdldFZhbGlkRW50aXR5UHJvcGVydHlFeHByZXNzaW9uKGVudGl0eVByb3BlcnR5RXhwcmVzc2lvbjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcHJvcFBhdGhzID0gZW50aXR5UHJvcGVydHlFeHByZXNzaW9uLnNwbGl0KCcuJyk7XHJcbiAgICBsZXQgcHJvcEluZm8gPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcHJvcEluZm8gPSB0aGlzLmVudGl0eVR5cGVJbmZvLmdldFByb3BJbmZvQnlQYXRoKHByb3BQYXRocyk7XHJcbiAgICB9IGNhdGNoIChlKSB7IH1cclxuICAgIGlmICghcHJvcEluZm8pIHtcclxuICAgICAgaWYgKHByb3BQYXRocy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgcHJvcFBhdGhzLnBvcCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFZhbGlkRW50aXR5UHJvcGVydHlFeHByZXNzaW9uKHByb3BQYXRocy5qb2luKCcuJykpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZW50aXR5UHJvcGVydHlFeHByZXNzaW9uLnNwbGl0KCcuJyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaJgOacieWunuS9k+S+nei1llxyXG4gICAqIEBwYXJhbSBleHByIOihqOi+vuW8j+Wtl+espuS4slxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRFbnRpdHlEZXBlbmRlbmN5KGV4cHI6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IGRlcHMgPSBbXTtcclxuICAgIGlmICh0aGlzLmVudGl0eVR5cGVJbmZvKSB7XHJcbiAgICAgIC8vIOS9v+eUqOato+WImeWMuemFjeWHuuaJgOacieWunuS9k1xyXG4gICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFtcXFxcJ1xcXFxcIl0/XFxcXHMqKCR7dGhpcy5lbnRpdHlUeXBlSW5mby5lbnRpdHlJbmZvLm5vZGVDb2RlfXwke3RoaXMuZW50aXR5VHlwZUluZm8uZW50aXR5SW5mby5vcmlnaW5hbENvZGV9KVtcXFxcLlxcXFxbXFxcXF1hLXpBLVowLTlfXStcXFxccypbXFxcXCdcXFxcXCJdP2AsICdnJyk7XHJcbiAgICAgIGNvbnN0IGVudGl0eVByb3BlcnR5RXhwcmVzc2lvbnM6IFJlZ0V4cE1hdGNoQXJyYXkgPSBleHByLm1hdGNoKHJlZ2V4KTtcclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZW50aXR5UHJvcGVydHlFeHByZXNzaW9ucykgJiYgZW50aXR5UHJvcGVydHlFeHByZXNzaW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgLy8g6Kej5p6Q5Ye65omA5pyJ5a6e5L2T55u45YWz55qE5a2X56ym5Liy77yM5Lul5Li75a6e5L2T5ZCN5a2X5byA5aS077yM5YyF5ZCr5Li75a6e5L2T5bGe5oCn5oiW5a2Q6KGoXHJcbiAgICAgICAgZW50aXR5UHJvcGVydHlFeHByZXNzaW9ucy5mb3JFYWNoKChpdGVtOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGlmIChpdGVtLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLy8g5Y6756m65qC8XHJcbiAgICAgICAgICBpdGVtID0gaXRlbS50cmltKCkucmVwbGFjZSgvXFxcIi9nLCAnJyk7XHJcbiAgICAgICAgICBjb25zdCBwYXRocyA9IEV4cHJlc3Npb25VdGlsLmNvbnZlcnRUb05vZGVDb2RlKGl0ZW0sIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbyk7XHJcbiAgICAgICAgICBpdGVtID0gcGF0aHMuam9pbignLicpO1xyXG4gICAgICAgICAgLy8g5oiq5Y675Li75a6e5L2T5Y+K54K5XHJcbiAgICAgICAgICBpdGVtID0gaXRlbS5zdWJzdHIoaXRlbS5pbmRleE9mKCcuJykgKyAxKTtcclxuICAgICAgICAgIGNvbnN0IGRlcCA9IHRoaXMuZ2V0VmFsaWRFbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb24oaXRlbSk7XHJcbiAgICAgICAgICBpZiAoZGVwICYmIEFycmF5LmlzQXJyYXkoZGVwKSAmJiBkZXAubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAvLyDmraTlpITlv4XpobvliqDkuIrkuLvlrp7kvZPnmoTlkI3lrZfmnaXljLrliIbkvp3otZbnmoTmmK/lrp7kvZPov5jmmK/lhbbku5bnsbvlnovnmoTmlbDmja5cclxuICAgICAgICAgICAgZGVwLnNwbGljZSgwLCAwLCBFTlRJVFlfVEVNUExBVEUpO1xyXG4gICAgICAgICAgICBkZXBzLnB1c2goZGVwLmpvaW4oJy8nKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVwcztcclxuICB9XHJcbn1cclxuIl19
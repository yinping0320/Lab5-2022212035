/**
 * 绑定对象工厂相关定义
 * @author Witt<jiwt@inspur.com>
 */
import { PropertyUtil } from './property_util';
import { BindingPropertyType } from './binding_property';
import { BindingListFactory } from './binding_list_factory';
import { BindingObjectTypeFactory } from './binding_object_type_factory';
/**
 * BindingObject工厂用于创建一个空的BindingObject对象，并对其属性进行扩展。
 *
 * **扩展属性处理**
 *
 * 对于要扩展的属性（BindingProperty）有三种处理：
 * - 普通属性：初始化为一个undefined，并包装get、set方法，通过set方法监听变更；
 * - 对象属性：初始化为一个空的BindingObject对象，并监听子对象的变更；
 * - 列表属性：初始化为一个空的BindingList对象，并监听子列表的变更；
 *
 * **示例代码**
 *
 * ```ts
 *  const empProperties = PropertyUtil.getProperties(EmpEntity);
 * const empBindingObject = BindingObjectFactory.create(properties);
 * ```
 */
class BindingObjectFactory {
    /**
     * 创建BindingObject实例
     * @param properties 要扩展的属性集合
     * @returns 带扩展属性的空BindingObject对象
     */
    static create(properties, fromEntity) {
        const bindingObjectType = BindingObjectTypeFactory.create(properties /*, data*/);
        bindingObjectType.fromEntity = fromEntity;
        return bindingObjectType;
    }
    static createDynamicBindingObject(data) {
        const properties = PropertyUtil.getDynamicProperties(data);
        const object = BindingObjectTypeFactory.create(properties /*, data*/); //new BindingObject(properties);
        this.extendProperties(object, properties);
        return object;
    }
    /**
     * 扩展属性绑定对象的属性
     * @param object     要扩展的绑定对象
     * @param properties 绑定属性集合
     */
    static extendProperties(object, properties) {
        // 扩展BindingObject属性
        properties.forEach((property) => {
            if (property.type === BindingPropertyType.List) {
                this.extendListProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Object) {
                this.extendObjectProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                this.extendDynamicObjectProperty(object, property);
            }
            else {
                this.extendPlainProperty(object, property);
            }
        });
    }
    /**
     * 扩展列表类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 列表类型的绑定属性集合
     */
    static extendListProperty(object, property) {
        const propertyName = property.name;
        const childListProperties = PropertyUtil.getProperties(property.entityType);
        const childList = BindingListFactory.create(childListProperties);
        // 指定子List的parent、监听子List的changes事件
        childList.parent = object;
        childList.changes.subscribe((change) => {
            change.path.unshift(propertyName);
            change.isBindingListTransmited = true;
            object.changes.next(change);
        });
        // 将子的BindingList实例赋值给当前属性
        Object.defineProperty(object, propertyName, {
            value: childList
        });
    }
    /**
     * 扩展对象类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 对象类型的绑定属性集合
     */
    static extendObjectProperty(object, property) {
        const propertyName = property.name;
        const childObjectProperties = PropertyUtil.getProperties(property.entityType);
        const childObject = this.create(childObjectProperties);
        // 指定子Object的parent、监听子Object的changes事件
        childObject.parent = object;
        childObject.changes.subscribe((change) => {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: childObject
        });
    }
    static extendDynamicObjectProperty(object, property) {
        const propertyName = property.name;
        object[propertyName] = null;
    }
    static attachDynamicObjectProperty(object, propertyName, dynamicObject) {
        dynamicObject.parent = object;
        dynamicObject.changes.subscribe((change) => {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: dynamicObject
        });
    }
    /**
     * 扩展简单类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 简单类型的绑定属性集合
     */
    static extendPlainProperty(object, property) {
        const propertyName = property.name;
        Object.defineProperty(object, propertyName, {
            get: () => {
                return object.getValue(propertyName);
            },
            set: (value) => {
                const oldValue = object.getValue(propertyName);
                if (value === oldValue) {
                    return;
                }
                object.setValue(propertyName, value, true, true);
            }
        });
    }
}
export { BindingObjectFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19vYmplY3RfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2JpbmRpbmctZGF0YS9iaW5kaW5nX29iamVjdF9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUdILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFMUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFekU7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFDSCxNQUFNLG9CQUFvQjtJQUV4Qjs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUE2QixFQUFFLFVBQW9CO1FBQy9ELE1BQU0saUJBQWlCLEdBQUcsd0JBQXdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQSxVQUFVLENBQUMsQ0FBQztRQUNoRixpQkFBaUIsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzFDLE9BQU8saUJBQWlCLENBQUM7SUFDM0IsQ0FBQztJQUVELE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxJQUFTO1FBQ3pDLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzRCxNQUFNLE1BQU0sR0FBRyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFBLFVBQVUsQ0FBQyxDQUFDLENBQUEsZ0NBQWdDO1FBQ3JHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDMUMsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBcUIsRUFB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5Y6C55u45YWz5a6a5LmJXHJcbiAqIEBhdXRob3IgV2l0dDxqaXd0QGluc3B1ci5jb20+XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ2hhbmdlIH0gZnJvbSAnLi9jaGFuZ2VzJztcclxuaW1wb3J0IHsgUHJvcGVydHlVdGlsIH0gZnJvbSAnLi9wcm9wZXJ0eV91dGlsJztcclxuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5LCBCaW5kaW5nUHJvcGVydHlUeXBlIH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcclxuaW1wb3J0IHsgQmluZGluZ09iamVjdCB9IGZyb20gJy4vYmluZGluZ19vYmplY3QnO1xyXG5pbXBvcnQgeyBCaW5kaW5nTGlzdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfbGlzdF9mYWN0b3J5JztcclxuaW1wb3J0IHsgQmluZGluZ09iamVjdFR5cGVGYWN0b3J5IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdF90eXBlX2ZhY3RvcnknO1xyXG5cclxuLyoqXHJcbiAqIEJpbmRpbmdPYmplY3Tlt6XljoLnlKjkuo7liJvlu7rkuIDkuKrnqbrnmoRCaW5kaW5nT2JqZWN05a+56LGh77yM5bm25a+55YW25bGe5oCn6L+b6KGM5omp5bGV44CCXHJcbiAqXHJcbiAqICoq5omp5bGV5bGe5oCn5aSE55CGKipcclxuICpcclxuICog5a+55LqO6KaB5omp5bGV55qE5bGe5oCn77yIQmluZGluZ1Byb3BlcnR577yJ5pyJ5LiJ56eN5aSE55CG77yaXHJcbiAqIC0g5pmu6YCa5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5LiqdW5kZWZpbmVk77yM5bm25YyF6KOFZ2V044CBc2V05pa55rOV77yM6YCa6L+Hc2V05pa55rOV55uR5ZCs5Y+Y5pu077ybXHJcbiAqIC0g5a+56LGh5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5Liq56m655qEQmluZGluZ09iamVjdOWvueixoe+8jOW5tuebkeWQrOWtkOWvueixoeeahOWPmOabtO+8m1xyXG4gKiAtIOWIl+ihqOWxnuaAp++8muWIneWni+WMluS4uuS4gOS4quepuueahEJpbmRpbmdMaXN05a+56LGh77yM5bm255uR5ZCs5a2Q5YiX6KGo55qE5Y+Y5pu077ybXHJcbiAqXHJcbiAqICoq56S65L6L5Luj56CBKipcclxuICpcclxuICogYGBgdHNcclxuICogIGNvbnN0IGVtcFByb3BlcnRpZXMgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydGllcyhFbXBFbnRpdHkpO1xyXG4gKiBjb25zdCBlbXBCaW5kaW5nT2JqZWN0ID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKHByb3BlcnRpZXMpO1xyXG4gKiBgYGBcclxuICovXHJcbmNsYXNzIEJpbmRpbmdPYmplY3RGYWN0b3J5IHtcclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu6QmluZGluZ09iamVjdOWunuS+i1xyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOimgeaJqeWxleeahOWxnuaAp+mbhuWQiFxyXG4gICAqIEByZXR1cm5zIOW4puaJqeWxleWxnuaAp+eahOepukJpbmRpbmdPYmplY3Tlr7nosaFcclxuICAgKi9cclxuICBzdGF0aWMgY3JlYXRlKHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdLCBmcm9tRW50aXR5PzogYm9vbGVhbik6IEJpbmRpbmdPYmplY3Qge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdFR5cGUgPSBCaW5kaW5nT2JqZWN0VHlwZUZhY3RvcnkuY3JlYXRlKHByb3BlcnRpZXMvKiwgZGF0YSovKTtcclxuICAgIGJpbmRpbmdPYmplY3RUeXBlLmZyb21FbnRpdHkgPSBmcm9tRW50aXR5O1xyXG4gICAgcmV0dXJuIGJpbmRpbmdPYmplY3RUeXBlO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNyZWF0ZUR5bmFtaWNCaW5kaW5nT2JqZWN0KGRhdGE6IGFueSk6IEJpbmRpbmdPYmplY3Qge1xyXG4gICAgY29uc3QgcHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXREeW5hbWljUHJvcGVydGllcyhkYXRhKTtcclxuICAgIGNvbnN0IG9iamVjdCA9IEJpbmRpbmdPYmplY3RUeXBlRmFjdG9yeS5jcmVhdGUocHJvcGVydGllcy8qLCBkYXRhKi8pOy8vbmV3IEJpbmRpbmdPYmplY3QocHJvcGVydGllcyk7XHJcbiAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXMob2JqZWN0LCBwcm9wZXJ0aWVzKTtcclxuICAgIHJldHVybiBvYmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmianlsZXlsZ7mgKfnu5Hlrprlr7nosaHnmoTlsZ7mgKdcclxuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDnu5HlrprlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBzdGF0aWMgZXh0ZW5kUHJvcGVydGllcyhvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKTogdm9pZCB7XHJcbiAgICAvLyDmianlsZVCaW5kaW5nT2JqZWN05bGe5oCnXHJcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goKHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpID0+IHtcclxuICAgICAgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuTGlzdCkge1xyXG4gICAgICAgIHRoaXMuZXh0ZW5kTGlzdFByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpO1xyXG4gICAgICB9IGVsc2UgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuT2JqZWN0KSB7XHJcbiAgICAgICAgdGhpcy5leHRlbmRPYmplY3RQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5KTtcclxuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eS50eXBlID09PSBCaW5kaW5nUHJvcGVydHlUeXBlLkR5bmFtaWMpIHtcclxuICAgICAgICB0aGlzLmV4dGVuZER5bmFtaWNPYmplY3RQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmV4dGVuZFBsYWluUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omp5bGV5YiX6KGo57G75Z6L55qE57uR5a6a5bGe5oCnXHJcbiAgICogQHBhcmFtIG9iamVjdCAgICAg6KaB5omp5bGV55qE57uR5a6a5a+56LGhXHJcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg5YiX6KGo57G75Z6L55qE57uR5a6a5bGe5oCn6ZuG5ZCIXHJcbiAgICovXHJcbiAgc3RhdGljIGV4dGVuZExpc3RQcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICBjb25zdCBjaGlsZExpc3RQcm9wZXJ0aWVzID0gUHJvcGVydHlVdGlsLmdldFByb3BlcnRpZXMocHJvcGVydHkuZW50aXR5VHlwZSk7XHJcbiAgICBjb25zdCBjaGlsZExpc3QgPSBCaW5kaW5nTGlzdEZhY3RvcnkuY3JlYXRlKGNoaWxkTGlzdFByb3BlcnRpZXMpO1xyXG5cclxuICAgIC8vIOaMh+WumuWtkExpc3TnmoRwYXJlbnTjgIHnm5HlkKzlrZBMaXN055qEY2hhbmdlc+S6i+S7tlxyXG4gICAgY2hpbGRMaXN0LnBhcmVudCA9IG9iamVjdDtcclxuICAgIGNoaWxkTGlzdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgY2hhbmdlLnBhdGgudW5zaGlmdChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBjaGFuZ2UuaXNCaW5kaW5nTGlzdFRyYW5zbWl0ZWQgPSB0cnVlO1xyXG4gICAgICBvYmplY3QuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDlsIblrZDnmoRCaW5kaW5nTGlzdOWunuS+i+i1i+WAvOe7meW9k+WJjeWxnuaAp1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIHZhbHVlOiBjaGlsZExpc3RcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omp5bGV5a+56LGh57G75Z6L55qE57uR5a6a5bGe5oCnXHJcbiAgICogQHBhcmFtIG9iamVjdCAgICAg6KaB5omp5bGV55qE57uR5a6a5a+56LGhXHJcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg5a+56LGh57G75Z6L55qE57uR5a6a5bGe5oCn6ZuG5ZCIXHJcbiAgICovXHJcbiAgc3RhdGljIGV4dGVuZE9iamVjdFByb3BlcnR5KG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSk6IHZvaWQge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTtcclxuICAgIGNvbnN0IGNoaWxkT2JqZWN0UHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXRQcm9wZXJ0aWVzKHByb3BlcnR5LmVudGl0eVR5cGUpO1xyXG4gICAgY29uc3QgY2hpbGRPYmplY3QgPSB0aGlzLmNyZWF0ZShjaGlsZE9iamVjdFByb3BlcnRpZXMpO1xyXG5cclxuICAgIC8vIOaMh+WumuWtkE9iamVjdOeahHBhcmVudOOAgeebkeWQrOWtkE9iamVjdOeahGNoYW5nZXPkuovku7ZcclxuICAgIGNoaWxkT2JqZWN0LnBhcmVudCA9IG9iamVjdDtcclxuICAgIGNoaWxkT2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBjaGFuZ2UucGF0aC51bnNoaWZ0KHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIG9iamVjdC5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICB2YWx1ZTogY2hpbGRPYmplY3RcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGV4dGVuZER5bmFtaWNPYmplY3RQcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICBvYmplY3RbcHJvcGVydHlOYW1lXSA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgYXR0YWNoRHluYW1pY09iamVjdFByb3BlcnR5KG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydHlOYW1lOiBzdHJpbmcsIGR5bmFtaWNPYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcclxuICAgIGR5bmFtaWNPYmplY3QucGFyZW50ID0gb2JqZWN0O1xyXG4gICAgZHluYW1pY09iamVjdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgY2hhbmdlLnBhdGgudW5zaGlmdChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBvYmplY3QuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICB2YWx1ZTogZHluYW1pY09iamVjdFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmianlsZXnroDljZXnsbvlnovnmoTnu5HlrprlsZ7mgKdcclxuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDnroDljZXnsbvlnovnmoTnu5HlrprlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBzdGF0aWMgZXh0ZW5kUGxhaW5Qcm9wZXJ0eShvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpOiB2b2lkIHtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgZ2V0OiAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG9iamVjdC5nZXRWYWx1ZShwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBvYmplY3QuZ2V0VmFsdWUocHJvcGVydHlOYW1lKTtcclxuICAgICAgICBpZiAodmFsdWUgPT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ09iamVjdEZhY3RvcnkgfTtcclxuIl19
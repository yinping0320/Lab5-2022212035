// tslint:disable: max-line-length member-ordering
/**
 * 绑定数据相关定义
 * @author Witt<jiwt@inspur.com>
 * @todo
 * 1、全局的BindingData和局部的BindingData应该拆成两个类，两个类之间是装饰关系；；
 * 2、为了保持兼容，减少改动量，暂时放在一起，待进一步重构。
 */
import { Injectable } from '@angular/core';
import { ChangeType } from './changes';
import { BindingList } from './binding_list';
import { BindingListFactory } from './binding_list_factory';
import { PropertyUtil } from './property_util';
import { EntityUtil } from './entity_util';
/**
 * 绑定数据
 * @description
 * # BindingData
 *
 * BindingData用于直接和界面绑定，它持有一个不可变的数据集合（BindingList），数据集合中是一个个不可变的数据对象（BindingObject）。
 *
 * ## 更新界面数据
 *
 * ### 接口定义
 *
 * ```javascript
 * //根据paths设置属性值
 * //@param paths 属性路径数组
 * //@param value 属性值
 * //@param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。
 * //@param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。
 * public setValue(paths: string[], value: any, emitEventToView: boolean = false, emitEventToEntity: boolean = true)
 * ```
 *
 * ### 示例
 *
 * - 更新主表数据
 *
 *   ```javascript
 *   bindingData.setValue(['name'],'ESG');
 *   ```
 *
 * - 更新子表数据
 *
 *   ```javascript
 *   bindingData.setValue(['soItems','price'],20);
 *   ```
 *
 * - 更新业务字段数据
 *
 *   ```javascript
 *   bindingData.setValue(['udt','udt_field'],'value');
 *   ```
 *
 * - 仅更新界面数据（不提交变更集）
 *
 *   ```javascript
 *   bindingData.setValue(['name'],'ESG',true,false);
 *   ```
 *
 *   > 注意：
 *   >
 *   > 仅更新界面数据时bindingData必须是对应组件上下文的bindingData。
 *   >
 *   > 更新数据的命令挂载到不同的组件，产生的效果也不相同。如果命令挂到了卡片视图模型，那么可以直接在构件中注入`FrameContext`或`BindingData`并更新数据就可以。但如果命令挂到了非卡片视图 * 模型，则应该先获取到卡片上下文的bindingData。
 *   >
 *   > - 命令挂在卡片视图模型:
 *   >
 *   >   ```javascript
 *   >   const frameContext = this.frameContext.bindingData;
 *   >   frameContext.bindingData.setValue(['name'],'ESG');
 *   >   ```
 *   >
 *   > - 命令挂在非卡片视图模型：
 *   >
 *   >   ```javascript
 *   >   const cardFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('card-frameId');
 *   >   cardFrameContext.bindingData.setValue(['name'],'ESG');
 *   >   ```
 *
 * ## 获取界面数据
 *
 * ### 接口定义
 *
 *   ```javascript
 *   //获取paths对应的属性值
 *   //@param  paths 属性路径数组
 *   //@returns 属性值
 *   public getValue(paths: string[], useInitValue = false)
 *   ```
 *
 * ### 示例
 *
 * - 获取主表数据
 *
 *   ```javascript
 *   bindingData.getValue(['name']) //'ESG'
 *   ```
 *
 * - 获取从表中字段属性
 *
 *   ```javascript
 *   bindingData.getValue(['soItems','price']); // 20
 *   ```
 *
 * - 获取业务字段数据
 *
 *   ```javascript
 *   bindingData.getValue(['udt','udt_field']); // 'value'
 *   ```
 *
 * ## 获取指定BindingObject
 *
 * ### 接口定义
 *
 * ```javascript
 * //通过主键获取对应的bindingObject
 * bindingData.list.findById(id: string): BindingObject;
 * ```
 *
 * ### 示例
 * - 获取某个主实体
 *   ```javascript
 *   bindingData.list.findById("id");
 *   ```
 * - 获取某个实体下子表的所有数据
 *   ```javascript
 *   // 获取主实体
 *   const bindingObject = bindingData.list.findById("id") as BindingObject;
 *   // 获取该实体下的某个子表数据
 *   const bindingList = bindingObject.getValue("soItems") as BindingList;
 *   ```
 *
 * - 获取子表某一行数据
 *
 *   ```javascript
 *   //获取主实体
 *   const bindingObject = bindingData.list.findById("id") as BindingObject;
 *   //获取该实体下的某个子表数据
 *   const bindingList = bindingObject.getValue("soItems") as BindingList;
 *   //子表行数据
 *   const childrenBindingObject = bindingList.findById('子表数据id');
 *   const name = childrenBindingObject.getValue("name"); // 或者childrenBindingObject['name']
 *   ```
 *
 * ## 常见问题
 *
 * ### 赋值或取值时为何不用指定主键？
 *
 *    示例中取值或赋值时并没有指定主键值，这是由于BindingData赋值或取值时都是对当前行就行操作的，所以不需要指定主键。所以在计算&行切换场景下会导致取值或赋值错误，如本来想给第一行的某个字 * 段赋值，结果由于行切换导致把值赋给了其他行。
 *
 *    如果遇到赋值错误的情况可以通过BindingObject赋值或取值。
 *
 * ### 通过bindingData赋值了，界面也刷新了，但保存不上
 *
 *    这种情况多发生在有后端请求的情况下，比如通过bindingData赋值后紧接着有一个后端请求。由于bindingData赋值是异步的（目前是），这就可能导致赋值还没有结束（还没有产生变更）请求就发送 * 了，从而请求中没有对应的变更，请求回来后会默认清空本地变更，从而导致界面上显示数据已经修改，但数据库中数据并未修改。
 *
 *    解决该类问题可以通过实体赋值的方式，给实体赋值是同步的，赋值完成后变更就会产生，这样再发送请求时就可以把变更带到后端。
 */
class BindingData {
    constructor() {
        this.paginationInfo = null;
    }
    set pagingInfo(pagingInfo) {
        this.paginationInfo = pagingInfo;
        this.firePagingChangeEvent();
    }
    get pagingInfo() {
        return this.paginationInfo;
    }
    dispose(options) {
        this.list.dispose();
    }
    ngOnDestroy() {
        this.dispose();
    }
    /**
     * 设置分页信息
     * @param skip 跳过
     * @param take 获取
     * @param bindingPath 路径
     */
    setPagingInfo(skip, take, bindingPath) {
        if (bindingPath.length < 1 || bindingPath === '/') {
            this.paginationInfo = Object.assign(this.paginationInfo, { pageSize: take, pageIndex: skip / take + 1 });
        }
        else {
            let pagingInfo = this.paginationInfo || {};
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0); // .map(item => item.substring(0, item.length - 1));
            let nodeCode = bindingPaths[bindingPaths.length - 1];
            // 去s
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            // 找到父级
            // 获取当前实体上级的主键
            const paths = bindingPaths.slice(0, bindingPaths.length - 1);
            const parentObject = this.getValue(paths);
            if (parentObject && parentObject[parentObject.primaryKey]) {
                // const key = `${nodeCode}_${parentObject[parentObject.primaryKey]}`;
                const key = `${nodeCode}`;
                pagingInfo = pagingInfo[key] || {};
                pagingInfo.pageIndex = ((skip / take) || 0) + 1;
                pagingInfo.pageSize = take || 0;
            }
        }
        this.firePagingChangeEvent();
    }
    updatePagingInfo(pageInfo, bindingPath) {
        if (bindingPath.length < 1 || bindingPath === '/') {
            this.paginationInfo = Object.assign(this.paginationInfo, pageInfo);
        }
        else {
            let pagingInfo = this.paginationInfo || {};
            const bindingPaths = bindingPath.substr(1).split('/').filter(item => !!item && item.length > 0); // .map(item => item.substring(0, item.length - 1));
            let nodeCode = bindingPaths[bindingPaths.length - 1];
            // 去s
            nodeCode = nodeCode.substr(0, nodeCode.length - 1);
            pagingInfo[nodeCode] = Object.assign(pagingInfo[nodeCode], pageInfo);
        }
        this.firePagingChangeEvent();
    }
    firePagingChangeEvent() {
        this.list.changes.next({
            type: ChangeType.PaginationInfoChange,
            path: this.bindingPath && this.bindingPath.split('/').filter(p => p) || [],
            value: this.paginationInfo
        });
    }
    /**
     * 变更集
     */
    get changes() {
        return this.list.changes;
    }
    /**
     * 设置值变化执行器工厂
     * @param value 值变化执行器工厂
     */
    setValueChangeInvokerFactory(value) {
        this.valueChangeInvokerFactory = value;
    }
    getValudChangeInvokerFactory() {
        return this.valueChangeInvokerFactory;
    }
    /**
     * 初始化（已废弃）
     */
    init(repository, bindingPath) {
        this.initByRepository(repository, bindingPath);
    }
    /**
     * 根据Repository对BindingData进行初始化
     */
    initByRepository(repository, bindingPath) {
        this.bindingPath = bindingPath;
        this.properties = PropertyUtil.getProperties(repository.entityType);
        this.list = BindingListFactory.create(this.properties);
        // 从repository初始化bindingData
        this.pagingInfo = repository.entityCollection.paginationInfo;
        // @todo
        // BindingData不应该知道Repository，加载数据、建立关联关系的过程应该转移到外边
        EntityUtil.loadRepository(repository, this.list);
        this.dataTypeInfo = repository.entityTypeInfo;
        this.extendProperties(this.properties);
    }
    /**
     * 初始化
     */
    initByBindingList(bindingList, bindingPath) {
        this.list = bindingList;
        this.bindingPath = bindingPath;
        this.extendProperties(this.list.properties);
    }
    setDataTypeInfo(dataTypeInfo) {
        this.dataTypeInfo = dataTypeInfo;
    }
    /**
     * 获取界面数据
     * @param paths 属性路径数组
     * @param useInitValue 是否使用默认值，默认为`false`
     * @returns 属性值
     */
    getValue(paths, useInitValue = false) {
        let target = this.list;
        paths.forEach((path) => {
            if (target) {
                target = target[path];
            }
        });
        if (useInitValue === true && paths && paths.length > 0) {
            const initValue = this.getInitValueByPaths(paths);
            if (target === undefined && target !== initValue) {
                target = initValue;
            }
        }
        return target;
    }
    /**
     * 该方法可以更新绑定层数据，从而达到更新界面数据的目的，进而更新本地仓库实体数据，产生变更，下次请求时会将变更带到后端并更新后端数据。
     * @param paths 属性路径数组
     * @param value 属性值
     * @param emitEventToView 如果设置为true，则发送事件通知订阅它的组件、指令去更新界面，默认为false。
     * @param emitEventToEntity 如果设置为true，则同步去更新Entity上对应的字段，默认为true。
     * @description
     * ## 示例
     *
     * ### 更新界面数据
     * 使用该方法时只传递path和value参数，其余参数使用默认值。该用法会更新界面数据，同时更新实体数据，实体数据更新时会产生变更，这样在下次请求时会将该变更带到后端，
     * 进而更新后端数据。
     * ```typescript
     * this.frameContext.bindingData.setValue(paths,value);
     * ```
     *
     * ### 仅更新界面数据
     * 有些场景下我们希望只更新界面的数据，不希望对后端数据产生影响，此时除传递paths和value参数外，还需要将emitEventToView设为true，emitEventToEntity设为false，
     * 此时必须使用对应BindingData的setValue方法：
     * ```typescript
     * const tableFrameContext = this.frameContext.appContext.frameContextManager.getFrameContextById('data-grid-component');
     * tableFrameContext.bindingData.setValue(paths,value,true,false);
     * ```
     * ## 注意事项
     * setValue为异步方法，如果调用该方法后随即发送后端请求，此时实体变更尚未产生，但请求已经发送，变更无法带到后端，导致变更丢失，出现界面上显示数据已经修改，
     * 但后端并未修改的问题。
     * 因此，如果赋值后随即发送请求应该使用实体赋值的方法。
     */
    setValue(paths, value, emitEventToView = false, emitEventToEntity = true, errors = {}, context) {
        if (!paths || paths.length === 0) {
            throw Error('路径不能为空');
        }
        const parentPaths = paths.slice(0, paths.length - 1);
        const propName = paths[paths.length - 1];
        let parent = this.getValue(parentPaths);
        if (!parent) {
            throw Error('找不到要设置的对象');
        }
        if (parent instanceof BindingData) {
            parent = parent.list.currentItem;
        }
        else if (parent instanceof BindingList) {
            parent = parent.currentItem;
        }
        if (!!this.valueChangeInvokerFactory) {
            parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, this.valueChangeInvokerFactory(paths), context);
        }
        else {
            parent.setValue(propName, value, emitEventToView, emitEventToEntity, errors, null, context);
        }
    }
    /**
     * 根据paths清空属性值
     */
    clearValue(paths, emitEventToView = false, emitEventToEntity = true, context) {
        let initValue;
        const propInfo = this.dataTypeInfo.getPropInfoByPath(paths);
        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {
            initValue = propInfo.metadataInfo.initValue;
        }
        else {
            // 原来的帮助映射中，强行纠正了数值的情况，保持一致
            const oldValue = this.getValue(paths);
            if (typeof oldValue === 'number') {
                initValue = 0;
            }
            else {
                initValue = '';
            }
        }
        this.setValue(paths, initValue, emitEventToView, emitEventToEntity, null, context);
    }
    /**
     * 获取当前列表
     */
    getList() {
        if (!this.bindingPath || this.bindingPath === '/') {
            return this.list;
        }
        const bindingPath = this.bindingPath.substr(1);
        const bindingPathArray = bindingPath.split('/').filter((part) => {
            return part !== '';
        });
        return this.getValue(bindingPathArray);
    }
    /**
     * 获取当前对象
     */
    getObject() {
        const bindingList = this.getList();
        return bindingList.currentItem;
    }
    /**
     * 绑定路径（仅路径部分，不包括属性）
     * @param bindingPath 绑定路径
     */
    getPath(bindingPath) {
        const bindingPaths = bindingPath.filter(p => p);
        const path = [`${this.list.primaryKey}:${this.list.currentId}`];
        bindingPaths.forEach((item) => {
            path.push(item);
            const list = this[item];
            if (list) {
                path.push(`${list.primaryKey}:${list.currentId}`);
            }
        });
        return path;
    }
    /**
     * 清空绑定数据
     */
    reset() {
        this.list.clear(true);
    }
    /**
     * 通过绑定路径获取属性初始值
     * @param paths 绑定路径
     */
    getInitValueByPaths(paths) {
        let initValue;
        const propInfo = this.dataTypeInfo && this.dataTypeInfo.getPropInfoByPath(paths) || null;
        if (propInfo && propInfo.metadataInfo && propInfo.metadataInfo.initValue !== undefined) {
            initValue = propInfo.metadataInfo.initValue;
        }
        return initValue;
    }
    /**
     * 扩展BindingData属性，映射BindingData所持有的绑定列表当前行的属性，减少绑定层级。
     * @param properties 关联实体的属性集合
     */
    extendProperties(properties) {
        properties.forEach((property) => {
            const propName = property.name;
            Object.defineProperty(this, propName, {
                get: () => {
                    return this.list.currentItem[propName];
                },
                set: (value) => {
                    this.list.currentItem[propName] = value;
                }
            });
        });
    }
}
BindingData.decorators = [
    { type: Injectable }
];
export { BindingData };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19kYXRhLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrREFBa0Q7QUFDbEQ7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUl0RCxPQUFPLEVBQVUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRS9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUszQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0pHO0FBQ0gsTUFDTSxXQUFXO0lBRGpCO1FBeUJVLG1CQUFjLEdBQUcsSUFBSSxDQUFDO0lBcVNoQyxDQUFDO0lBblNDLElBQVcsVUFBVSxDQUFDLFVBQWU7UUFDbkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxVQUFVLENBQUM7UUFDakMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVELElBQVcsVUFBVTtRQUNuQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDN0IsQ0FBQztJQUNELE9BQU8sQ0FBQyxPQUFhO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUNELFdBQVc7UUFDVCxJQUFJLENBQUMs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aW5nXHJcbi8qKlxyXG4gKiDnu5HlrprmlbDmja7nm7jlhbPlrprkuYlcclxuICogQGF1dGhvciBXaXR0PGppd3RAaW5zcHVyLmNvbT5cclxuICogQHRvZG9cclxuICogMeOAgeWFqOWxgOeahEJpbmRpbmdEYXRh5ZKM5bGA6YOo55qEQmluZGluZ0RhdGHlupTor6Xmi4bmiJDkuKTkuKrnsbvvvIzkuKTkuKrnsbvkuYvpl7TmmK/oo4XppbDlhbPns7vvvJvvvJtcclxuICogMuOAgeS4uuS6huS/neaMgeWFvOWuue+8jOWHj+WwkeaUueWKqOmHj++8jOaaguaXtuaUvuWcqOS4gOi1t++8jOW+hei/m+S4gOatpemHjeaehOOAglxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IERhdGFUeXBlSW5mbyB9IGZyb20gJy4uL2NvcmUvZGF0YS10eXBlLWluZm8nO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yeS9pbmRleCc7XHJcbmltcG9ydCB7IENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0IH0gZnJvbSAnLi9iaW5kaW5nX2xpc3QnO1xyXG5pbXBvcnQgeyBCaW5kaW5nTGlzdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfbGlzdF9mYWN0b3J5JztcclxuaW1wb3J0IHsgUHJvcGVydHlVdGlsIH0gZnJvbSAnLi9wcm9wZXJ0eV91dGlsJztcclxuaW1wb3J0IHsgRW50aXR5VXRpbCB9IGZyb20gJy4vZW50aXR5X3V0aWwnO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEludm9rZU9uVmFsdWVDaGFuZ2UgfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgSURpc3Bvc2FibGUgfSBmcm9tICcuLi9jb3JlJztcclxuXHJcbi8qKlxyXG4gKiDnu5HlrprmlbDmja5cclxuICogQGRlc2NyaXB0aW9uXHJcbiAqICMgQmluZGluZ0RhdGFcclxuICogXHJcbiAqIEJpbmRpbmdEYXRh55So5LqO55u05o6l5ZKM55WM6Z2i57uR5a6a77yM5a6D5oyB5pyJ5LiA5Liq5LiN5Y+v5Y+Y55qE5pWw5o2u6ZuG5ZCI77yIQmluZGluZ0xpc3TvvInvvIzmlbDmja7pm4blkIjkuK3mmK/kuIDkuKrkuKrkuI3lj6/lj5jnmoTmlbDmja7lr7nosaHvvIhCaW5kaW5nT2JqZWN077yJ44CCXHJcbiAqIFxyXG4gKiAjIyDmm7TmlrDnlYzpnaLmlbDmja5cclxuICogXHJcbiAqICMjIyDmjqXlj6PlrprkuYlcclxuICogXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy/moLnmja5wYXRoc+iuvue9ruWxnuaAp+WAvFxyXG4gKiAvL0BwYXJhbSBwYXRocyDlsZ7mgKfot6/lvoTmlbDnu4RcclxuICogLy9AcGFyYW0gdmFsdWUg5bGe5oCn5YC8XHJcbiAqIC8vQHBhcmFtIGVtaXRFdmVudFRvVmlldyDlpoLmnpzorr7nva7kuLp0cnVl77yM5YiZ5Y+R6YCB5LqL5Lu26YCa55+l6K6i6ZiF5a6D55qE57uE5Lu244CB5oyH5Luk5Y675pu05paw55WM6Z2i77yM6buY6K6k5Li6ZmFsc2XjgIJcclxuICogLy9AcGFyYW0gZW1pdEV2ZW50VG9FbnRpdHkg5aaC5p6c6K6+572u5Li6dHJ1Ze+8jOWImeWQjOatpeWOu+abtOaWsEVudGl0eeS4iuWvueW6lOeahOWtl+aute+8jOm7mOiupOS4unRydWXjgIJcclxuICogcHVibGljIHNldFZhbHVlKHBhdGhzOiBzdHJpbmdbXSwgdmFsdWU6IGFueSwgZW1pdEV2ZW50VG9WaWV3OiBib29sZWFuID0gZmFsc2UsIGVtaXRFdmVudFRvRW50aXR5OiBib29sZWFuID0gdHJ1ZSlcclxuICogYGBgXHJcbiAqIFxyXG4gKiAjIyMg56S65L6LXHJcbiAqIFxyXG4gKiAtIOabtOaWsOS4u+ihqOaVsOaNrlxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycpO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDmm7TmlrDlrZDooajmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLnNldFZhbHVlKFsnc29JdGVtcycsJ3ByaWNlJ10sMjApO1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDmm7TmlrDkuJrliqHlrZfmrrXmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLnNldFZhbHVlKFsndWR0JywndWR0X2ZpZWxkJ10sJ3ZhbHVlJyk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAtIOS7heabtOaWsOeVjOmdouaVsOaNru+8iOS4jeaPkOS6pOWPmOabtOmbhu+8iVxyXG4gKiBcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycsdHJ1ZSxmYWxzZSk7XHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAgID4g5rOo5oSP77yaXHJcbiAqICAgPlxyXG4gKiAgID4g5LuF5pu05paw55WM6Z2i5pWw5o2u5pe2YmluZGluZ0RhdGHlv4XpobvmmK/lr7nlupTnu4Tku7bkuIrkuIvmlofnmoRiaW5kaW5nRGF0YeOAglxyXG4gKiAgID5cclxuICogICA+IOabtOaWsOaVsOaNrueahOWRveS7pOaMgui9veWIsOS4jeWQjOeahOe7hOS7tu+8jOS6p+eUn+eahOaViOaenOS5n+S4jeebuOWQjOOAguWmguaenOWRveS7pOaMguWIsOS6huWNoeeJh+inhuWbvuaooeWei++8jOmCo+S5iOWPr+S7peebtOaOpeWcqOaehOS7tuS4reazqOWFpWBGcmFtZUNvbnRleHRg5oiWYEJpbmRpbmdEYXRhYOW5tuabtOaWsOaVsOaNruWwseWPr+S7peOAguS9huWmguaenOWRveS7pOaMguWIsOS6humdnuWNoeeJh+inhuWbviAqIOaooeWei++8jOWImeW6lOivpeWFiOiOt+WPluWIsOWNoeeJh+S4iuS4i+aWh+eahGJpbmRpbmdEYXRh44CCXHJcbiAqICAgPlxyXG4gKiAgID4gLSDlkb3ku6TmjILlnKjljaHniYfop4blm77mqKHlnos6XHJcbiAqICAgPlxyXG4gKiAgID4gICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgPiAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gKiAgID4gICBmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuc2V0VmFsdWUoWyduYW1lJ10sJ0VTRycpO1xyXG4gKiAgID4gICBgYGBcclxuICogICA+XHJcbiAqICAgPiAtIOWRveS7pOaMguWcqOmdnuWNoeeJh+inhuWbvuaooeWei++8mlxyXG4gKiAgID5cclxuICogICA+ICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgID4gICBjb25zdCBjYXJkRnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoJ2NhcmQtZnJhbWVJZCcpO1xyXG4gKiAgID4gICBjYXJkRnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnNldFZhbHVlKFsnbmFtZSddLCdFU0cnKTtcclxuICogICA+ICAgYGBgXHJcbiAqIFxyXG4gKiAjIyDojrflj5bnlYzpnaLmlbDmja5cclxuICogXHJcbiAqICMjIyDmjqXlj6PlrprkuYlcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIC8v6I635Y+WcGF0aHPlr7nlupTnmoTlsZ7mgKflgLxcclxuICogICAvL0BwYXJhbSAgcGF0aHMg5bGe5oCn6Lev5b6E5pWw57uEXHJcbiAqICAgLy9AcmV0dXJucyDlsZ7mgKflgLxcclxuICogICBwdWJsaWMgZ2V0VmFsdWUocGF0aHM6IHN0cmluZ1tdLCB1c2VJbml0VmFsdWUgPSBmYWxzZSlcclxuICogICBgYGBcclxuICogXHJcbiAqICMjIyDnpLrkvotcclxuICogXHJcbiAqIC0g6I635Y+W5Li76KGo5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBiaW5kaW5nRGF0YS5nZXRWYWx1ZShbJ25hbWUnXSkgLy8nRVNHJ1xyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDojrflj5bku47ooajkuK3lrZfmrrXlsZ7mgKdcclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLmdldFZhbHVlKFsnc29JdGVtcycsJ3ByaWNlJ10pOyAvLyAyMFxyXG4gKiAgIGBgYFxyXG4gKiBcclxuICogLSDojrflj5bkuJrliqHlrZfmrrXmlbDmja5cclxuICogXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIGJpbmRpbmdEYXRhLmdldFZhbHVlKFsndWR0JywndWR0X2ZpZWxkJ10pOyAvLyAndmFsdWUnXHJcbiAqICAgYGBgXHJcbiAqIFxyXG4gKiAjIyDojrflj5bmjIflrppCaW5kaW5nT2JqZWN0XHJcbiAqIFxyXG4gKiAjIyMg5o6l5Y+j5a6a5LmJXHJcbiAqIFxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8v6YCa6L+H5Li76ZSu6I635Y+W5a+55bqU55qEYmluZGluZ09iamVjdFxyXG4gKiBiaW5kaW5nRGF0YS5saXN0LmZpbmRCeUlkKGlkOiBzdHJpbmcpOiBCaW5kaW5nT2JqZWN0O1xyXG4gKiBgYGBcclxuICogXHJcbiAqICMjIyDnpLrkvotcclxuICogLSDojrflj5bmn5DkuKrkuLvlrp7kvZNcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgYmluZGluZ0RhdGEubGlzdC5maW5kQnlJZChcImlkXCIpO1xyXG4gKiAgIGBgYFxyXG4gKiAtIOiOt+WPluafkOS4quWunuS9k+S4i+WtkOihqOeahOaJgOacieaVsOaNrlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICAvLyDojrflj5bkuLvlrp7kvZNcclxuICogICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gYmluZGluZ0RhdGEubGlzdC5maW5kQnlJZChcImlkXCIpIGFzIEJpbmRpbmdPYmplY3Q7XHJcbiAqICAgLy8g6I635Y+W6K+l5a6e5L2T5LiL55qE5p+Q5Liq5a2Q6KGo5pWw5o2uXHJcbiAqICAgY29uc3QgYmluZGluZ0xpc3QgPSBiaW5kaW5nT2JqZWN0LmdldFZhbHVlKFwic29JdGVtc1wiKSBhcyBCaW5kaW5nTGlzdDtcclxuICogICBgYGBcclxuICogXHJcbiAqIC0g6I635Y+W5a2Q6KGo5p+Q5LiA6KGM5pWw5o2uXHJcbiAqIFxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICAvL+iOt+WPluS4u+WunuS9k1xyXG4gKiAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBiaW5kaW5nRGF0YS5saXN0LmZpbmRCeUlkKFwiaWRcIikgYXMgQmluZGluZ09iamVjdDtcclxuICogICAvL+iOt+WPluivpeWunuS9k+S4i+eahOafkOS4quWtkOihqOaVsOaNrlxyXG4gKiAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gYmluZGluZ09iamVjdC5nZXRWYWx1ZShcInNvSXRlbXNcIikgYXMgQmluZGluZ0xpc3Q7XHJcbiAqICAgLy/lrZDooajooYzmlbDmja5cclxuICogICBjb25zdCBjaGlsZHJlbkJpbmRpbmdPYmplY3QgPSBiaW5kaW5nTGlzdC5maW5kQnlJZCgn5a2Q6KGo5pWw5o2uaWQnKTtcclxuICogICBjb25zdCBuYW1lID0gY2hpbGRyZW5CaW5kaW5nT2JqZWN0LmdldFZhbHVlKFwibmFtZVwiKTsgLy8g5oiW6ICFY2hpbGRyZW5CaW5kaW5nT2JqZWN0WyduYW1lJ11cclxuICogICBgYGBcclxuICogXHJcbiAqICMjIOW4uOingemXrumimFxyXG4gKiBcclxuICogIyMjIOi1i+WAvOaIluWPluWAvOaXtuS4uuS9leS4jeeUqOaMh+WumuS4u+mUru+8n1xyXG4gKiBcclxuICogICAg56S65L6L5Lit5Y+W5YC85oiW6LWL5YC85pe25bm25rKh5pyJ5oyH5a6a5Li76ZSu5YC877yM6L+Z5piv55Sx5LqOQmluZGluZ0RhdGHotYvlgLzmiJblj5blgLzml7bpg73mmK/lr7nlvZPliY3ooYzlsLHooYzmk43kvZznmoTvvIzmiYDku6XkuI3pnIDopoHmjIflrprkuLvplK7jgILmiYDku6XlnKjorqHnrpcm6KGM5YiH5o2i5Zy65pmv5LiL5Lya5a+86Ie05Y+W5YC85oiW6LWL5YC86ZSZ6K+v77yM5aaC5pys5p2l5oOz57uZ56ys5LiA6KGM55qE5p+Q5Liq5a2XICog5q616LWL5YC877yM57uT5p6c55Sx5LqO6KGM5YiH5o2i5a+86Ie05oqK5YC86LWL57uZ5LqG5YW25LuW6KGM44CCXHJcbiAqIFxyXG4gKiAgICDlpoLmnpzpgYfliLDotYvlgLzplJnor6/nmoTmg4XlhrXlj6/ku6XpgJrov4dCaW5kaW5nT2JqZWN06LWL5YC85oiW5Y+W5YC844CCXHJcbiAqIFxyXG4gKiAjIyMg6YCa6L+HYmluZGluZ0RhdGHotYvlgLzkuobvvIznlYzpnaLkuZ/liLfmlrDkuobvvIzkvYbkv53lrZjkuI3kuIpcclxuICogXHJcbiAqICAgIOi/meenjeaDheWGteWkmuWPkeeUn+WcqOacieWQjuerr+ivt+axgueahOaDheWGteS4i++8jOavlOWmgumAmui/h2JpbmRpbmdEYXRh6LWL5YC85ZCO57Sn5o6l552A5pyJ5LiA5Liq5ZCO56uv6K+35rGC44CC55Sx5LqOYmluZGluZ0RhdGHotYvlgLzmmK/lvILmraXnmoTvvIjnm67liY3mmK/vvInvvIzov5nlsLHlj6/og73lr7zoh7TotYvlgLzov5jmsqHmnInnu5PmnZ/vvIjov5jmsqHmnInkuqfnlJ/lj5jmm7TvvInor7fmsYLlsLHlj5HpgIEgKiDkuobvvIzku47ogIzor7fmsYLkuK3msqHmnInlr7nlupTnmoTlj5jmm7TvvIzor7fmsYLlm57mnaXlkI7kvJrpu5jorqTmuIXnqbrmnKzlnLDlj5jmm7TvvIzku47ogIzlr7zoh7TnlYzpnaLkuIrmmL7npLrmlbDmja7lt7Lnu4/kv67mlLnvvIzkvYbmlbDmja7lupPkuK3mlbDmja7lubbmnKrkv67mlLnjgIJcclxuICogXHJcbiAqICAgIOino+WGs+ivpeexu+mXrumimOWPr+S7pemAmui/h+WunuS9k+i1i+WAvOeahOaWueW8j++8jOe7meWunuS9k+i1i+WAvOaYr+WQjOatpeeahO+8jOi1i+WAvOWujOaIkOWQjuWPmOabtOWwseS8muS6p+eUn++8jOi/meagt+WGjeWPkemAgeivt+axguaXtuWwseWPr+S7peaKiuWPmOabtOW4puWIsOWQjuerr+OAglxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBCaW5kaW5nRGF0YSBpbXBsZW1lbnRzIElEaXNwb3NhYmxlLCBPbkRlc3Ryb3l7XHJcbiAgLyoqXHJcbiAgICog5pWw5o2u57G75Z6L5o+P6L+wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkYXRhVHlwZUluZm86IERhdGFUeXBlSW5mbztcclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a6K+l6Lev5b6EXHJcbiAgICovXHJcbiAgcHVibGljIGJpbmRpbmdQYXRoOiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPr+e7keWumueahOWxnuaAp+aPj+i/sFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcm9wZXJ0aWVzOiBCaW5kaW5nUHJvcGVydHlbXTtcclxuXHJcbiAgLyoqXHJcbiAgICog6KGM5YiH5o2i5LqL5Lu25pqC5YGc5oqb5Ye6XHJcbiAgICovXHJcbiAgcHVibGljIHJvd1NlbGVjdGVkRXZlbnRTdXNwZW5kOiBib29sZWFuO1xyXG4gIC8qKlxyXG4gICAqIOaVsOaNruWIl+ihqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBsaXN0OiBCaW5kaW5nTGlzdDtcclxuICBwcml2YXRlIHBhZ2luYXRpb25JbmZvID0gbnVsbDtcclxuXHJcbiAgcHVibGljIHNldCBwYWdpbmdJbmZvKHBhZ2luZ0luZm86IGFueSkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IHBhZ2luZ0luZm87XHJcbiAgICB0aGlzLmZpcmVQYWdpbmdDaGFuZ2VFdmVudCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBwYWdpbmdJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgfVxyXG4gIGRpc3Bvc2Uob3B0aW9ucz86IGFueSkge1xyXG4gICAgdGhpcy5saXN0LmRpc3Bvc2UoKTtcclxuICB9XHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6K6+572u5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHNraXAg6Lez6L+HXHJcbiAgICogQHBhcmFtIHRha2Ug6I635Y+WXHJcbiAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOi3r+W+hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRQYWdpbmdJbmZvKHNraXA6IG51bWJlciwgdGFrZTogbnVtYmVyLCBiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICBpZiAoYmluZGluZ1BhdGgubGVuZ3RoIDwgMSB8fCBiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHRoaXMucGFnaW5hdGlvbkluZm8sIHsgcGFnZVNpemU6IHRha2UsIHBhZ2VJbmRleDogc2tpcCAvIHRha2UgKyAxIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHBhZ2luZ0luZm8gPSB0aGlzLnBhZ2luYXRpb25JbmZvIHx8IHt9O1xyXG4gICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zdWJzdHIoMSkuc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS5sZW5ndGggPiAwKTsgLy8gLm1hcChpdGVtID0+IGl0ZW0uc3Vic3RyaW5nKDAsIGl0ZW0ubGVuZ3RoIC0gMSkpO1xyXG4gICAgICBsZXQgbm9kZUNvZGUgPSBiaW5kaW5nUGF0aHNbYmluZGluZ1BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAvLyDljrtzXHJcbiAgICAgIG5vZGVDb2RlID0gbm9kZUNvZGUuc3Vic3RyKDAsIG5vZGVDb2RlLmxlbmd0aCAtIDEpO1xyXG4gICAgICAvLyDmib7liLDniLbnuqdcclxuICAgICAgLy8g6I635Y+W5b2T5YmN5a6e5L2T5LiK57qn55qE5Li76ZSuXHJcbiAgICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGhzLnNsaWNlKDAsIGJpbmRpbmdQYXRocy5sZW5ndGggLSAxKTtcclxuICAgICAgY29uc3QgcGFyZW50T2JqZWN0ID0gdGhpcy5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ09iamVjdDtcclxuICAgICAgaWYgKHBhcmVudE9iamVjdCAmJiBwYXJlbnRPYmplY3RbcGFyZW50T2JqZWN0LnByaW1hcnlLZXldKSB7XHJcbiAgICAgICAgLy8gY29uc3Qga2V5ID0gYCR7bm9kZUNvZGV9XyR7cGFyZW50T2JqZWN0W3BhcmVudE9iamVjdC5wcmltYXJ5S2V5XX1gO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGAke25vZGVDb2RlfWA7XHJcbiAgICAgICAgcGFnaW5nSW5mbyA9IHBhZ2luZ0luZm9ba2V5XSB8fCB7fTtcclxuICAgICAgICBwYWdpbmdJbmZvLnBhZ2VJbmRleCA9ICgoc2tpcCAvIHRha2UpIHx8IDApICsgMTtcclxuICAgICAgICBwYWdpbmdJbmZvLnBhZ2VTaXplID0gdGFrZSB8fCAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpcmVQYWdpbmdDaGFuZ2VFdmVudCgpO1xyXG4gIH1cclxuICBwdWJsaWMgdXBkYXRlUGFnaW5nSW5mbyhwYWdlSW5mbzogeyBwYWdlSW5kZXg/OiBudW1iZXIsIHBhZ2VTaXplPzogbnVtYmVyLCB0b3RhbD86IG51bWJlciB9LCBiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICBpZiAoYmluZGluZ1BhdGgubGVuZ3RoIDwgMSB8fCBiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHRoaXMucGFnaW5hdGlvbkluZm8sIHBhZ2VJbmZvKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBwYWdpbmdJbmZvID0gdGhpcy5wYWdpbmF0aW9uSW5mbyB8fCB7fTtcclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3Vic3RyKDEpLnNwbGl0KCcvJykuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0ubGVuZ3RoID4gMCk7IC8vIC5tYXAoaXRlbSA9PiBpdGVtLnN1YnN0cmluZygwLCBpdGVtLmxlbmd0aCAtIDEpKTtcclxuICAgICAgbGV0IG5vZGVDb2RlID0gYmluZGluZ1BhdGhzW2JpbmRpbmdQYXRocy5sZW5ndGggLSAxXTtcclxuICAgICAgLy8g5Y67c1xyXG4gICAgICBub2RlQ29kZSA9IG5vZGVDb2RlLnN1YnN0cigwLCBub2RlQ29kZS5sZW5ndGggLSAxKTtcclxuICAgICAgcGFnaW5nSW5mb1tub2RlQ29kZV0gPSBPYmplY3QuYXNzaWduKHBhZ2luZ0luZm9bbm9kZUNvZGVdLCBwYWdlSW5mbyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmZpcmVQYWdpbmdDaGFuZ2VFdmVudCgpO1xyXG4gIH1cclxuICBwcml2YXRlIGZpcmVQYWdpbmdDaGFuZ2VFdmVudCgpIHtcclxuICAgIHRoaXMubGlzdC5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlLFxyXG4gICAgICBwYXRoOiB0aGlzLmJpbmRpbmdQYXRoICYmIHRoaXMuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKSB8fCBbXSxcclxuICAgICAgdmFsdWU6IHRoaXMucGFnaW5hdGlvbkluZm9cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlj5jmm7Tpm4ZcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGNoYW5nZXMoKTogU3ViamVjdDxDaGFuZ2U+IHtcclxuICAgIHJldHVybiB0aGlzLmxpc3QuY2hhbmdlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWAvOWPmOWMluaJp+ihjOWZqOW3peWOgu+8jOagueaNrui3r+W+hOS6p+eUn+aJp+ihjOWZqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdmFsdWVDaGFuZ2VJbnZva2VyRmFjdG9yeTogKHBhdGhzOiBzdHJpbmdbXSkgPT4gSW52b2tlT25WYWx1ZUNoYW5nZTtcclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5YC85Y+Y5YyW5omn6KGM5Zmo5bel5Y6CXHJcbiAgICogQHBhcmFtIHZhbHVlIOWAvOWPmOWMluaJp+ihjOWZqOW3peWOglxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRWYWx1ZUNoYW5nZUludm9rZXJGYWN0b3J5KHZhbHVlOiAocGF0aHM6IHN0cmluZ1tdKSA9PiBJbnZva2VPblZhbHVlQ2hhbmdlKSB7XHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlSW52b2tlckZhY3RvcnkgPSB2YWx1ZTtcclxuICB9XHJcbiAgcHVibGljIGdldFZhbHVkQ2hhbmdlSW52b2tlckZhY3RvcnkoKSB7XHJcbiAgICByZXR1cm4gdGhpcy52YWx1ZUNoYW5nZUludm9rZXJGYWN0b3J5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW77yI5bey5bqf5byD77yJXHJcbiAgICovXHJcbiAgcHVibGljIGluaXQocmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LCBiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmluaXRCeVJlcG9zaXRvcnkocmVwb3NpdG9yeSwgYmluZGluZ1BhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2uUmVwb3NpdG9yeeWvuUJpbmRpbmdEYXRh6L+b6KGM5Yid5aeL5YyWXHJcbiAgICovXHJcbiAgcHVibGljIGluaXRCeVJlcG9zaXRvcnkocmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LCBiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGg7XHJcblxyXG4gICAgdGhpcy5wcm9wZXJ0aWVzID0gUHJvcGVydHlVdGlsLmdldFByb3BlcnRpZXMocmVwb3NpdG9yeS5lbnRpdHlUeXBlKTtcclxuICAgIHRoaXMubGlzdCA9IEJpbmRpbmdMaXN0RmFjdG9yeS5jcmVhdGUodGhpcy5wcm9wZXJ0aWVzKTtcclxuICAgIC8vIOS7jnJlcG9zaXRvcnnliJ3lp4vljJZiaW5kaW5nRGF0YVxyXG4gICAgdGhpcy5wYWdpbmdJbmZvID0gcmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgLy8gQHRvZG9cclxuICAgIC8vIEJpbmRpbmdEYXRh5LiN5bqU6K+l55+l6YGTUmVwb3NpdG9yee+8jOWKoOi9veaVsOaNruOAgeW7uueri+WFs+iBlOWFs+ezu+eahOi/h+eoi+W6lOivpei9rOenu+WIsOWklui+uVxyXG4gICAgRW50aXR5VXRpbC5sb2FkUmVwb3NpdG9yeShyZXBvc2l0b3J5LCB0aGlzLmxpc3QpO1xyXG4gICAgdGhpcy5kYXRhVHlwZUluZm8gPSByZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvO1xyXG5cclxuICAgIHRoaXMuZXh0ZW5kUHJvcGVydGllcyh0aGlzLnByb3BlcnRpZXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyWXHJcbiAgICovXHJcbiAgcHVibGljIGluaXRCeUJpbmRpbmdMaXN0KGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCwgYmluZGluZ1BhdGg6IHN0cmluZykge1xyXG4gICAgdGhpcy5saXN0ID0gYmluZGluZ0xpc3Q7XHJcbiAgICB0aGlzLmJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGg7XHJcbiAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXModGhpcy5saXN0LnByb3BlcnRpZXMpO1xyXG4gIH1cclxuICBwdWJsaWMgc2V0RGF0YVR5cGVJbmZvKGRhdGFUeXBlSW5mbzogRGF0YVR5cGVJbmZvKSB7XHJcbiAgICB0aGlzLmRhdGFUeXBlSW5mbyA9IGRhdGFUeXBlSW5mbztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W55WM6Z2i5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhdGhzIOWxnuaAp+i3r+W+hOaVsOe7hFxyXG4gICAqIEBwYXJhbSB1c2VJbml0VmFsdWUg5piv5ZCm5L2/55So6buY6K6k5YC877yM6buY6K6k5Li6YGZhbHNlYFxyXG4gICAqIEByZXR1cm5zIOWxnuaAp+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRWYWx1ZShwYXRoczogc3RyaW5nW10sIHVzZUluaXRWYWx1ZSA9IGZhbHNlKSB7XHJcbiAgICBsZXQgdGFyZ2V0OiBhbnkgPSB0aGlzLmxpc3Q7XHJcbiAgICBwYXRocy5mb3JFYWNoKChwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgIHRhcmdldCA9IHRhcmdldFtwYXRoXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZiAodXNlSW5pdFZhbHVlID09PSB0cnVlICYmIHBhdGhzICYmIHBhdGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgaW5pdFZhbHVlID0gdGhpcy5nZXRJbml0VmFsdWVCeVBhdGhzKHBhdGhzKTtcclxuICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkICYmIHRhcmdldCAhPT0gaW5pdFZhbHVlKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gaW5pdFZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGFyZ2V0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K+l5pa55rOV5Y+v5Lul5pu05paw57uR5a6a5bGC5pWw5o2u77yM5LuO6ICM6L6+5Yiw5pu05paw55WM6Z2i5pWw5o2u55qE55uu55qE77yM6L+b6ICM5pu05paw5pys5Zyw5LuT5bqT5a6e5L2T5pWw5o2u77yM5Lqn55Sf5Y+Y5pu077yM5LiL5qyh6K+35rGC5pe25Lya5bCG5Y+Y5pu05bim5Yiw5ZCO56uv5bm25pu05paw5ZCO56uv5pWw5o2u44CCXHJcbiAgICogQHBhcmFtIHBhdGhzIOWxnuaAp+i3r+W+hOaVsOe7hFxyXG4gICAqIEBwYXJhbSB2YWx1ZSDlsZ7mgKflgLxcclxuICAgKiBAcGFyYW0gZW1pdEV2ZW50VG9WaWV3IOWmguaenOiuvue9ruS4unRydWXvvIzliJnlj5HpgIHkuovku7bpgJrnn6XorqLpmIXlroPnmoTnu4Tku7bjgIHmjIfku6Tljrvmm7TmlrDnlYzpnaLvvIzpu5jorqTkuLpmYWxzZeOAglxyXG4gICAqIEBwYXJhbSBlbWl0RXZlbnRUb0VudGl0eSDlpoLmnpzorr7nva7kuLp0cnVl77yM5YiZ5ZCM5q2l5Y675pu05pawRW50aXR55LiK5a+55bqU55qE5a2X5q6177yM6buY6K6k5Li6dHJ1ZeOAglxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqICMjIOekuuS+i1xyXG4gICAqIFxyXG4gICAqICMjIyDmm7TmlrDnlYzpnaLmlbDmja5cclxuICAgKiDkvb/nlKjor6Xmlrnms5Xml7blj6rkvKDpgJJwYXRo5ZKMdmFsdWXlj4LmlbDvvIzlhbbkvZnlj4LmlbDkvb/nlKjpu5jorqTlgLzjgILor6XnlKjms5XkvJrmm7TmlrDnlYzpnaLmlbDmja7vvIzlkIzml7bmm7TmlrDlrp7kvZPmlbDmja7vvIzlrp7kvZPmlbDmja7mm7TmlrDml7bkvJrkuqfnlJ/lj5jmm7TvvIzov5nmoLflnKjkuIvmrKHor7fmsYLml7bkvJrlsIbor6Xlj5jmm7TluKbliLDlkI7nq6/vvIxcclxuICAgKiDov5vogIzmm7TmlrDlkI7nq6/mlbDmja7jgIJcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuc2V0VmFsdWUocGF0aHMsdmFsdWUpO1xyXG4gICAqIGBgYFxyXG4gICAqIFxyXG4gICAqICMjIyDku4Xmm7TmlrDnlYzpnaLmlbDmja5cclxuICAgKiDmnInkupvlnLrmma/kuIvmiJHku6zluIzmnJvlj6rmm7TmlrDnlYzpnaLnmoTmlbDmja7vvIzkuI3luIzmnJvlr7nlkI7nq6/mlbDmja7kuqfnlJ/lvbHlk43vvIzmraTml7bpmaTkvKDpgJJwYXRoc+WSjHZhbHVl5Y+C5pWw5aSW77yM6L+Y6ZyA6KaB5bCGZW1pdEV2ZW50VG9WaWV36K6+5Li6dHJ1Ze+8jGVtaXRFdmVudFRvRW50aXR56K6+5Li6ZmFsc2XvvIxcclxuICAgKiDmraTml7blv4Xpobvkvb/nlKjlr7nlupRCaW5kaW5nRGF0YeeahHNldFZhbHVl5pa55rOV77yaXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHRhYmxlRnJhbWVDb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoJ2RhdGEtZ3JpZC1jb21wb25lbnQnKTtcclxuICAgKiB0YWJsZUZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5zZXRWYWx1ZShwYXRocyx2YWx1ZSx0cnVlLGZhbHNlKTtcclxuICAgKiBgYGBcclxuICAgKiAjIyDms6jmhI/kuovpoblcclxuICAgKiBzZXRWYWx1ZeS4uuW8guatpeaWueazle+8jOWmguaenOiwg+eUqOivpeaWueazleWQjumaj+WNs+WPkemAgeWQjuerr+ivt+axgu+8jOatpOaXtuWunuS9k+WPmOabtOWwmuacquS6p+eUn++8jOS9huivt+axguW3sue7j+WPkemAge+8jOWPmOabtOaXoOazleW4puWIsOWQjuerr++8jOWvvOiHtOWPmOabtOS4ouWkse+8jOWHuueOsOeVjOmdouS4iuaYvuekuuaVsOaNruW3sue7j+S/ruaUue+8jFxyXG4gICAqIOS9huWQjuerr+W5tuacquS/ruaUueeahOmXrumimOOAglxyXG4gICAqIOWboOatpO+8jOWmguaenOi1i+WAvOWQjumaj+WNs+WPkemAgeivt+axguW6lOivpeS9v+eUqOWunuS9k+i1i+WAvOeahOaWueazleOAglxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRWYWx1ZShwYXRoczogc3RyaW5nW10sIHZhbHVlOiBhbnksIGVtaXRFdmVudFRvVmlldzogYm9vbGVhbiA9IGZhbHNlLCBlbWl0RXZlbnRUb0VudGl0eTogYm9vbGVhbiA9IHRydWUsIGVycm9yczogYW55ID0ge30sIGNvbnRleHQ/OiBhbnkpIHtcclxuXHJcbiAgICBpZiAoIXBhdGhzIHx8IHBhdGhzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB0aHJvdyBFcnJvcign6Lev5b6E5LiN6IO95Li656m6Jyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXJlbnRQYXRocyA9IHBhdGhzLnNsaWNlKDAsIHBhdGhzLmxlbmd0aCAtIDEpO1xyXG4gICAgY29uc3QgcHJvcE5hbWUgPSBwYXRoc1twYXRocy5sZW5ndGggLSAxXTtcclxuXHJcbiAgICBsZXQgcGFyZW50ID0gdGhpcy5nZXRWYWx1ZShwYXJlbnRQYXRocyk7XHJcbiAgICBpZiAoIXBhcmVudCkge1xyXG4gICAgICB0aHJvdyBFcnJvcign5om+5LiN5Yiw6KaB6K6+572u55qE5a+56LGhJyk7XHJcbiAgICB9XHJcbiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgQmluZGluZ0RhdGEpIHtcclxuICAgICAgcGFyZW50ID0gcGFyZW50Lmxpc3QuY3VycmVudEl0ZW07XHJcbiAgICB9IGVsc2UgaWYgKHBhcmVudCBpbnN0YW5jZW9mIEJpbmRpbmdMaXN0KSB7XHJcbiAgICAgIHBhcmVudCA9IHBhcmVudC5jdXJyZW50SXRlbTtcclxuICAgIH1cclxuICAgIGlmICghIXRoaXMudmFsdWVDaGFuZ2VJbnZva2VyRmFjdG9yeSkge1xyXG4gICAgICBwYXJlbnQuc2V0VmFsdWUocHJvcE5hbWUsIHZhbHVlLCBlbWl0RXZlbnRUb1ZpZXcsIGVtaXRFdmVudFRvRW50aXR5LCBlcnJvcnMsIHRoaXMudmFsdWVDaGFuZ2VJbnZva2VyRmFjdG9yeShwYXRocyksIGNvbnRleHQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGFyZW50LnNldFZhbHVlKHByb3BOYW1lLCB2YWx1ZSwgZW1pdEV2ZW50VG9WaWV3LCBlbWl0RXZlbnRUb0VudGl0eSwgZXJyb3JzLCBudWxsLCBjb250ZXh0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrnBhdGhz5riF56m65bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyVmFsdWUocGF0aHM6IHN0cmluZ1tdLCBlbWl0RXZlbnRUb1ZpZXc6IGJvb2xlYW4gPSBmYWxzZSwgZW1pdEV2ZW50VG9FbnRpdHk6IGJvb2xlYW4gPSB0cnVlLCBjb250ZXh0PzogYW55KSB7XHJcbiAgICBsZXQgaW5pdFZhbHVlOiBhbnk7XHJcbiAgICBjb25zdCBwcm9wSW5mbyA9IHRoaXMuZGF0YVR5cGVJbmZvLmdldFByb3BJbmZvQnlQYXRoKHBhdGhzKTtcclxuICAgIGlmIChwcm9wSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm8gJiYgcHJvcEluZm8ubWV0YWRhdGFJbmZvLmluaXRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGluaXRWYWx1ZSA9IHByb3BJbmZvLm1ldGFkYXRhSW5mby5pbml0VmFsdWU7XHJcbiAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgLy8g5Y6f5p2l55qE5biu5Yqp5pig5bCE5Lit77yM5by66KGM57qg5q2j5LqG5pWw5YC855qE5oOF5Ya177yM5L+d5oyB5LiA6Ie0XHJcbiAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy5nZXRWYWx1ZShwYXRocyk7XHJcbiAgICAgIGlmICh0eXBlb2Ygb2xkVmFsdWUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgaW5pdFZhbHVlID0gMDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpbml0VmFsdWUgPSAnJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRWYWx1ZShwYXRocywgaW5pdFZhbHVlLCBlbWl0RXZlbnRUb1ZpZXcsIGVtaXRFdmVudFRvRW50aXR5LCBudWxsLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjeWIl+ihqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRMaXN0KCkge1xyXG4gICAgaWYgKCF0aGlzLmJpbmRpbmdQYXRoIHx8IHRoaXMuYmluZGluZ1BhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gdGhpcy5saXN0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gdGhpcy5iaW5kaW5nUGF0aC5zdWJzdHIoMSk7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aEFycmF5ID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIoKHBhcnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICByZXR1cm4gcGFydCAhPT0gJyc7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLmdldFZhbHVlKGJpbmRpbmdQYXRoQXJyYXkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5b2T5YmN5a+56LGhXHJcbiAgICovXHJcbiAgcHVibGljIGdldE9iamVjdCgpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdGhpcy5nZXRMaXN0KCk7XHJcbiAgICByZXR1cm4gYmluZGluZ0xpc3QuY3VycmVudEl0ZW07XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOe7keWumui3r+W+hO+8iOS7hei3r+W+hOmDqOWIhu+8jOS4jeWMheaLrOWxnuaAp++8iVxyXG4gICAqIEBwYXJhbSBiaW5kaW5nUGF0aCDnu5Hlrprot6/lvoRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UGF0aChiaW5kaW5nUGF0aD86IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5maWx0ZXIocCA9PiBwKTtcclxuICAgIGNvbnN0IHBhdGggPSBbYCR7dGhpcy5saXN0LnByaW1hcnlLZXl9OiR7dGhpcy5saXN0LmN1cnJlbnRJZH1gXTtcclxuXHJcbiAgICBiaW5kaW5nUGF0aHMuZm9yRWFjaCgoaXRlbTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHBhdGgucHVzaChpdGVtKTtcclxuICAgICAgY29uc3QgbGlzdCA9IHRoaXNbaXRlbV0gYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgIGlmIChsaXN0KSB7XHJcbiAgICAgICAgcGF0aC5wdXNoKGAke2xpc3QucHJpbWFyeUtleX06JHtsaXN0LmN1cnJlbnRJZH1gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcGF0aDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m657uR5a6a5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCkge1xyXG4gICAgdGhpcy5saXN0LmNsZWFyKHRydWUpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgJrov4fnu5Hlrprot6/lvoTojrflj5blsZ7mgKfliJ3lp4vlgLxcclxuICAgKiBAcGFyYW0gcGF0aHMg57uR5a6a6Lev5b6EXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRJbml0VmFsdWVCeVBhdGhzKHBhdGhzOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICBsZXQgaW5pdFZhbHVlOiBhbnk7XHJcbiAgICBjb25zdCBwcm9wSW5mbyA9IHRoaXMuZGF0YVR5cGVJbmZvICYmIHRoaXMuZGF0YVR5cGVJbmZvLmdldFByb3BJbmZvQnlQYXRoKHBhdGhzKSB8fCBudWxsO1xyXG4gICAgaWYgKHByb3BJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mbyAmJiBwcm9wSW5mby5tZXRhZGF0YUluZm8uaW5pdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgaW5pdFZhbHVlID0gcHJvcEluZm8ubWV0YWRhdGFJbmZvLmluaXRWYWx1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBpbml0VmFsdWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJqeWxlUJpbmRpbmdEYXRh5bGe5oCn77yM5pig5bCEQmluZGluZ0RhdGHmiYDmjIHmnInnmoTnu5HlrprliJfooajlvZPliY3ooYznmoTlsZ7mgKfvvIzlh4/lsJHnu5HlrprlsYLnuqfjgIJcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDlhbPogZTlrp7kvZPnmoTlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBwcml2YXRlIGV4dGVuZFByb3BlcnRpZXMocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICBjb25zdCBwcm9wTmFtZSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wTmFtZSwge1xyXG4gICAgICAgIGdldDogKCkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMubGlzdC5jdXJyZW50SXRlbVtwcm9wTmFtZV07XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxpc3QuY3VycmVudEl0ZW1bcHJvcE5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ0RhdGEgfTtcclxuIl19
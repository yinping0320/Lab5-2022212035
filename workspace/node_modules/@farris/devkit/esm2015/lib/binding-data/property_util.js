import { FieldMetadataUtil } from '../entity/index';
import { BindingPropertyType } from './binding_property';
/**
 * 属性工具类
 */
class PropertyUtil {
    /**
     * 获取实体上的属性集合，并将他们转换成BindingProperty集合
     * @param  entityType 实体类型
     * @returns 绑定属性集合
     */
    static getProperties(entityType) {
        const properties = [];
        // Plain
        const ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach((propertyName) => {
            const ngFieldProperty = ngFieldProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Plain,
                isPrimaryKey: ngFieldProperty.primary,
                isForeignKey: ngFieldProperty.foreign,
                enableMultiLangInput: ngFieldProperty.enableMultiLangInput
            });
        });
        // Object
        const ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach((propertyName) => {
            const ngObjectProperty = ngObjectProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Object,
                entityType: ngObjectProperty.type
            });
        });
        // List
        const ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach((propertyName) => {
            const ngListProperty = ngListProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.List,
                entityType: ngListProperty.type
            });
        });
        // Dynamics
        const ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach((propertyName) => {
            const ngDynamicProperty = ngDynamicProperties[propertyName];
            properties.push({
                name: propertyName,
                type: BindingPropertyType.Dynamic,
                entityType: ngDynamicProperty.type
            });
        });
        return properties;
    }
    static getDynamicProperties(dynamicData) {
        const properties = [];
        Object.keys(dynamicData).forEach((propertyName) => {
            if (dynamicData.hasOwnProperty(propertyName)) {
                if (dynamicData[propertyName] instanceof Object) {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Dynamic,
                        entityType: null
                    });
                }
                else {
                    properties.push({
                        name: propertyName,
                        type: BindingPropertyType.Plain,
                        isPrimaryKey: false,
                        isForeignKey: false
                    });
                }
            }
        });
        return properties;
    }
    /**
     * 根据属性名获取属性
     */
    static getPropertyByName(properties, propertyName) {
        const targetProperty = properties.find((property) => {
            return property.name === propertyName;
        });
        return targetProperty;
    }
    /**
     * 获取实体主键名
     * @param properties 属性集合
     * @returns 主键名
     */
    static getPrimaryKey(properties) {
        // 实体必须有主键，如果没有主键在构造实体的时候就已经报错，这里不需要再进行检查
        const primaryProperty = properties.find((property) => {
            return property.isPrimaryKey === true;
        });
        return primaryProperty ? primaryProperty.name : '';
    }
}
export { PropertyUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHlfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2JpbmRpbmctZGF0YS9wcm9wZXJ0eV91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBVSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzVELE9BQU8sRUFBbUIsbUJBQW1CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUUxRTs7R0FFRztBQUNILE1BQU0sWUFBWTtJQUVoQjs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUF3QjtRQUMzQyxNQUFNLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFFdEIsUUFBUTtRQUNSLE1BQU0saUJBQWlCLEdBQUcsaUJBQWlCLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BFLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFvQixFQUFFLEVBQUU7WUFDOUQsTUFBTSxlQUFlLEdBQUcsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDeEQsVUFBVSxDQUFDLElBQUksQ0FBQztnQkFDZCxJQUFJLEVBQUUsWUFBWTtnQkFDbEIsSUFBSSxFQUFFLG1CQUFtQixDQUFDLEtBQUs7Z0JBQy9CLFlBQVksRUFBRSxlQUFlLENBQUMsT0FBTztnQkFDckMsWUFBWSxFQUFFLGVBQWUsQ0FBQyxPQUFPO2dCQUNyQyxvQkFBb0IsRUFBRSxlQUFlLENBQUMsb0JBQW9CO2FBQzNELENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsU0FBUztRQUNULE1BQU0sa0JBQWtCLEdBQUcsaUJBQWlCLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFvQixFQUFFLEVBQUU7WUFDL0QsTUFB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RTtZQUNwRSxPQUFPLFFBQVEsQ0FBQyxZQUFZLEtBQUssSUFBSSxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxlQUFlLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNyRCxDQUFDO0NBRUY7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEVudGl0eSwgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xyXG5pbXBvcnQgeyBCaW5kaW5nUHJvcGVydHksIEJpbmRpbmdQcm9wZXJ0eVR5cGUgfSBmcm9tICcuL2JpbmRpbmdfcHJvcGVydHknO1xyXG5cclxuLyoqXHJcbiAqIOWxnuaAp+W3peWFt+exu1xyXG4gKi9cclxuY2xhc3MgUHJvcGVydHlVdGlsIHtcclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T5LiK55qE5bGe5oCn6ZuG5ZCI77yM5bm25bCG5LuW5Lus6L2s5o2i5oiQQmluZGluZ1Byb3BlcnR56ZuG5ZCIXHJcbiAgICogQHBhcmFtICBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xyXG4gICAqIEByZXR1cm5zIOe7keWumuWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcm9wZXJ0aWVzKGVudGl0eVR5cGU6IFR5cGU8RW50aXR5Pik6IEJpbmRpbmdQcm9wZXJ0eVtdIHtcclxuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbXTtcclxuXHJcbiAgICAvLyBQbGFpblxyXG4gICAgY29uc3QgbmdGaWVsZFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0ZpZWxkcyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRmllbGRQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0ZpZWxkUHJvcGVydHkgPSBuZ0ZpZWxkUHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgICBwcm9wZXJ0aWVzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcclxuICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLlBsYWluLFxyXG4gICAgICAgIGlzUHJpbWFyeUtleTogbmdGaWVsZFByb3BlcnR5LnByaW1hcnksXHJcbiAgICAgICAgaXNGb3JlaWduS2V5OiBuZ0ZpZWxkUHJvcGVydHkuZm9yZWlnbixcclxuICAgICAgICBlbmFibGVNdWx0aUxhbmdJbnB1dDogbmdGaWVsZFByb3BlcnR5LmVuYWJsZU11bHRpTGFuZ0lucHV0XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gT2JqZWN0XHJcbiAgICBjb25zdCBuZ09iamVjdFByb3BlcnRpZXMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydHkgPSBuZ09iamVjdFByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcclxuICAgICAgcHJvcGVydGllcy5wdXNoKHtcclxuICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXHJcbiAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5PYmplY3QsXHJcbiAgICAgICAgZW50aXR5VHlwZTogbmdPYmplY3RQcm9wZXJ0eS50eXBlXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gTGlzdFxyXG4gICAgY29uc3QgbmdMaXN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nTGlzdFByb3BlcnR5ID0gbmdMaXN0UHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgICBwcm9wZXJ0aWVzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcclxuICAgICAgICB0eXBlOiBCaW5kaW5nUHJvcGVydHlUeXBlLkxpc3QsXHJcbiAgICAgICAgZW50aXR5VHlwZTogbmdMaXN0UHJvcGVydHkudHlwZVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIER5bmFtaWNzXHJcbiAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljUHJvcGVydGllcykuZm9yRWFjaCgocHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdEeW5hbWljUHJvcGVydHkgPSBuZ0R5bmFtaWNQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XHJcbiAgICAgIHByb3BlcnRpZXMucHVzaCh7XHJcbiAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxyXG4gICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuRHluYW1pYyxcclxuICAgICAgICBlbnRpdHlUeXBlOiBuZ0R5bmFtaWNQcm9wZXJ0eS50eXBlXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHByb3BlcnRpZXM7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZ2V0RHluYW1pY1Byb3BlcnRpZXMoZHluYW1pY0RhdGE6IGFueSk6IEJpbmRpbmdQcm9wZXJ0eVtdIHtcclxuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbXTtcclxuICAgIE9iamVjdC5rZXlzKGR5bmFtaWNEYXRhKS5mb3JFYWNoKChwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAoZHluYW1pY0RhdGEuaGFzT3duUHJvcGVydHkocHJvcGVydHlOYW1lKSkge1xyXG4gICAgICAgIGlmIChkeW5hbWljRGF0YVtwcm9wZXJ0eU5hbWVdIGluc3RhbmNlb2YgT2JqZWN0KSB7XHJcbiAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goe1xyXG4gICAgICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXHJcbiAgICAgICAgICAgIHR5cGU6IEJpbmRpbmdQcm9wZXJ0eVR5cGUuRHluYW1pYyxcclxuICAgICAgICAgICAgZW50aXR5VHlwZTogbnVsbFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHByb3BlcnRpZXMucHVzaCh7XHJcbiAgICAgICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcclxuICAgICAgICAgICAgdHlwZTogQmluZGluZ1Byb3BlcnR5VHlwZS5QbGFpbixcclxuICAgICAgICAgICAgaXNQcmltYXJ5S2V5OiBmYWxzZSxcclxuICAgICAgICAgICAgaXNGb3JlaWduS2V5OiBmYWxzZVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBwcm9wZXJ0aWVzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja7lsZ7mgKflkI3ojrflj5blsZ7mgKdcclxuICAgKi9cclxuICBzdGF0aWMgZ2V0UHJvcGVydHlCeU5hbWUocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10sIHByb3BlcnR5TmFtZTogc3RyaW5nKTogQmluZGluZ1Byb3BlcnR5IHtcclxuICAgIGNvbnN0IHRhcmdldFByb3BlcnR5ID0gcHJvcGVydGllcy5maW5kKChwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KSA9PiB7XHJcbiAgICAgIHJldHVybiBwcm9wZXJ0eS5uYW1lID09PSBwcm9wZXJ0eU5hbWU7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0YXJnZXRQcm9wZXJ0eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWunuS9k+S4u+mUruWQjVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOWxnuaAp+mbhuWQiFxyXG4gICAqIEByZXR1cm5zIOS4u+mUruWQjVxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRQcmltYXJ5S2V5KHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKTogc3RyaW5nIHtcclxuXHJcbiAgICAvLyDlrp7kvZPlv4XpobvmnInkuLvplK7vvIzlpoLmnpzmsqHmnInkuLvplK7lnKjmnoTpgKDlrp7kvZPnmoTml7blgJnlsLHlt7Lnu4/miqXplJnvvIzov5nph4zkuI3pnIDopoHlho3ov5vooYzmo4Dmn6VcclxuICAgIGNvbnN0IHByaW1hcnlQcm9wZXJ0eSA9IHByb3BlcnRpZXMuZmluZCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICByZXR1cm4gcHJvcGVydHkuaXNQcmltYXJ5S2V5ID09PSB0cnVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcHJpbWFyeVByb3BlcnR5ID8gcHJpbWFyeVByb3BlcnR5Lm5hbWUgOiAnJztcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBQcm9wZXJ0eVV0aWwgfTtcclxuIl19
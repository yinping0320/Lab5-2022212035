/**
 * 绑定列表相关定义
 * @author Witt<jiwt@inspur.com>
 */
// tslint:disable: max-line-length
import { List } from 'immutable';
import { Subject } from 'rxjs';
import { ChangeType } from './changes';
import { BindingObjectFactory } from './binding_object_factory';
import { PropertyUtil } from './property_util';
import { BindingData } from './binding_data';
import { TranslateService } from '../i18n/translate_service';
import { ArrayFilterConditionDataFilter, ObjectFilterConditionDataFilter } from '../data-filter';
import { takeUntil } from 'rxjs/operators';
/**
 * BindingList是一个BindingObject集合
 */
class BindingList {
    /**
     * 构造函数
     */
    constructor(properties) {
        this.__type__ = 'BindingList';
        this.sortFields = [];
        this.sortDirections = [];
        /**
         * 界面数据源
         */
        this.defaultView = null;
        // #region 分页相关
        /**
         * 分页信息
         */
        this._paginationInfo = null;
        this.properties = properties;
        this.primaryKey = PropertyUtil.getPrimaryKey(properties);
        this.changes = new Subject();
        this.innerList = List();
        this.currentId = null;
        this.destroy$ = new Subject();
        this.updateDefaultView(this.changes);
    }
    set paginationInfo(sPaginationInfo) {
        this._paginationInfo = sPaginationInfo;
        if (this._paginationInfo === sPaginationInfo) {
            return;
        }
        this.changes.next({
            type: ChangeType.PaginationInfoChange,
            path: [],
            value: this._paginationInfo
        });
    }
    get paginationInfo() {
        return this._paginationInfo;
    }
    /**
     * 获取页码
     */
    get pageIndex() {
        if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageIndex")) {
            return this.paginationInfo.pageIndex;
        }
        return 1;
    }
    /**
     * 获取分页大小
     */
    get pageSize() {
        if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageSize")) {
            return this.paginationInfo.pageSize;
        }
        return 0;
    }
    /**
     * 获取数据总项数
     */
    get total() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || this.paginationInfo.totalCount;
        }
        return 0;
    }
    /**
     * 获取跳过的数据条数
     */
    get skip() {
        const pageIndex = this.pageIndex;
        const pageSize = this.pageSize;
        return (pageIndex - 1) * pageSize;
    }
    /**
     * 前台设置分页信息
     * @param skip skip
     * @param take take
     */
    setPaginationInfo(skip, take) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, {
            pageSize: take,
            pageIndex: skip / take + 1
        });
        /*this.changes.next({
          type: ChangeType.PaginationInfoChange,
          path: [],
          value: this.paginationInfo
        });*/
    }
    //#endregion
    /**
     * 当前行对应的绑定对象
     * 如果currentId为null，则创建一个空结构，防止绑定报错；
     */
    get currentItem() {
        const currentItem = this.findById(this.currentId);
        if (!currentItem) {
            if (!this.emptyCurrentItem) {
                this.emptyCurrentItem = BindingObjectFactory.create(this.properties);
            }
            return this.emptyCurrentItem;
        }
        return currentItem;
    }
    /**
     * 绑定对象的数量
     */
    get length() {
        return this.innerList.count();
    }
    /**
     * 销毁
     * @param options
     */
    dispose(options) {
        this.clear(true);
        if (this.destroy$) {
            this.destroy$.next();
            this.destroy$.complete();
            this.destroy$ = null;
        }
    }
    /**
     * 添加[Symbol.iterator]，使之能通过for of遍历
     */
    [Symbol.iterator]() {
        const self = this;
        let index = -1;
        const size = this.innerList.size;
        return {
            next: function () {
                index++;
                if (index < size) {
                    return { done: false, value: self.innerList.get(index) };
                }
                return { done: true, value: undefined };
            }
        };
    }
    /**
     * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。
     * @param objects 要加载绑定对象数组
     */
    load(objects, entityCreate = false) {
        // 重置列表
        this.innerList = this.innerList.clear();
        if (objects.length !== 0) {
            // 加载数据
            objects.forEach((object) => {
                this.add(object);
            });
            // 设置默认当前行
            const currentItem = this.findById(this.currentId);
            if (!currentItem) {
                const firstId = objects[0][this.primaryKey];
                this.setCurrentId(firstId, false, false);
            }
        }
        else {
            this.currentId = null;
        }
        const change = {
            type: ChangeType.Load,
            path: [],
            value: objects
        };
        change.create = entityCreate;
        // 触发事件
        this.changes.next(change);
    }
    /**
     * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。
     * @param objects 要加载绑定对象数组
     */
    append(objects, isCloned = false, options = null) {
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach((object) => {
            this.add(object);
        });
        // 当前行为新追加的最后1行
        const lastId = objects[objects.length - 1][this.primaryKey];
        this.setCurrentId(lastId, true, true);
        // 触发事件
        const change = {
            type: ChangeType.Append,
            path: [],
            value: objects,
            isTreeNodeLoadScene: options && options.isTreeNodeLoadScene
        };
        if (isCloned) {
            change.isCloned = true;
        }
        this.changes.next(change);
    }
    /**
     * 增加数据
     * @param objects 实体
     * @param options 上下文
     * @description 增加实体数据，但不切换当前行
     */
    addData(objects, options = null) {
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach((object) => {
            this.add(object);
        });
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: objects,
            isTreeNodeLoadScene: options && options.isTreeNodeLoadScene
        });
    }
    insert(object, position) {
        const currentIndex = this.innerList.findIndex((obj) => obj.primaryKeyValue === this.currentId);
        // 加载BindingObject
        if (position === 1) {
            this.innerList = this.innerList.insert(currentIndex + 1, object);
        }
        else if (position === -1) {
            this.innerList = this.innerList.insert(currentIndex, object);
        }
        else {
            this.innerList = this.innerList.push(object);
        }
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe((change) => {
            this.changes.next(change);
        });
        this.setCurrentId(object.primaryKeyValue, true, true);
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: object,
            detail: {
                type: 'insert',
                position
            }
        });
    }
    /**
     * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。
     * @param object 绑定对象
     */
    add(object) {
        this.innerList = this.innerList.push(object);
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe((change) => {
            this.changes.next(change);
        });
    }
    /**
     * 删除主键值数组对应的绑定对象。
     * @param ids 主键值数组
     */
    removeByIds(ids) {
        if (!ids || ids.length === 0) {
            return;
        }
        let nextCurrentId = this.currentId;
        ids.forEach((id) => {
            // 如果当前行被删除，计算下一当前行
            if (id === nextCurrentId) {
                nextCurrentId = this.getCurrentIdBeforeDeleting();
            }
            // 删除对象，找不到时跳过
            const index = this.getIndexById(id);
            if (index === -1) {
                return;
            }
            this.innerList = this.innerList.delete(index);
        });
        // 重新设置当前行
        if (this.innerList.count() === 0) {
            this.currentId = null;
        }
        else {
            this.setCurrentId(nextCurrentId, false, false);
        }
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    }
    /**
     * 删除数据（不切换当前行）
     * @param ids ids
     */
    removeDataByIds(ids) {
        if (!ids || ids.length === 0) {
            return;
        }
        ids.forEach((id) => {
            // 删除对象，找不到时跳过
            const index = this.getIndexById(id);
            if (index === -1) {
                return;
            }
            this.innerList = this.innerList.delete(index);
        });
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    }
    /**
     * 清空
     */
    clear(clearOnly = false) {
        this.innerList.forEach((item) => {
            item['_ENTITY_'] = null;
            item.unsubscribe.next();
            item.unsubscribe.complete();
            item.changes.complete();
            item.viewChanges.complete();
        });
        this.innerList = this.innerList.clear();
        if (!clearOnly) {
            this.currentId = null;
            this.changes.next({
                type: ChangeType.Remove,
                path: [],
                value: []
            });
        }
    }
    /**
     * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。
     * - 如果被删除的行是最后1行，则上移1行；
     * - 其他情况，下移1行。
     */
    getCurrentIdBeforeDeleting() {
        let nextIndex = -1;
        const currentIndex = this.getIndexById(this.currentId);
        if (currentIndex === this.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return this.getIdByIndex(nextIndex);
    }
    /**
     * 根据主键值获取对应绑定对象
     * @param   id 要查找的主键值
     * @returns 找到时返回对应BindingObject， 找不到时返回null
     */
    findById(id) {
        let target;
        target = this.innerList.find((item) => {
            return item.getValue(this.primaryKey) === id;
        });
        return target === undefined ? null : target;
    }
    /**
     * 将主键值为id的绑定对象设置为当前行
     * @param  id        要设置的主键值
     * @param  emitEvent 是否发送当前行变更事件
     * @param  force 强制切换
     */
    setCurrentId(id, emitEvent = true, emitGlobalEvent = true, force = false) {
        if (this.currentId === id && !force) {
            return;
        }
        // 不存在时设置为null
        // const currentObj = this.findById(id);
        // if (!currentObj) {
        //   this.currentId = null;
        // } else {
        //   this.currentId = id;
        // }
        // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。
        const currentObj = this.findById(id);
        if (!currentObj && !force) {
            return;
        }
        this.currentId = id;
        // 发出行切换事件
        if (emitEvent === true) {
            this.changes.next({
                type: ChangeType.SelectionChanged,
                path: [],
                value: this.currentItem,
                force
            });
        }
        // 是否发送全局的行切换事件
        if (emitGlobalEvent === true) {
            this.changes.next({
                type: ChangeType.GlobalSelectionChanged,
                path: [],
                value: this.currentItem,
                force
            });
        }
    }
    /**
     * 根据主键值为id的绑定对象的索引
     * @param id 主键值
     * @returns 找到时返回对应的index，找不到时返回-1
     */
    getIndexById(id) {
        return this.innerList.findIndex((obj) => {
            return obj[this.primaryKey] === id;
        });
    }
    /**
     * 根据索引位置获取对应绑定对象的主键值
     * @reutrn 找到时返回对应主键值，找不到返回null
     */
    getIdByIndex(index) {
        if (index < 0 || index > this.length) {
            return null;
        }
        if (this.innerList.has(index) === false) {
            return null;
        }
        const obj = this.innerList.get(index);
        return obj[this.primaryKey];
    }
    /**
     * 转换为BindingObject数组
     */
    toArray() {
        return this.innerList.toArray();
    }
    /**
     * 交互数据位置
     * @param id1 id1
     * @param id2 id2
     */
    swapById(id1, id2) {
        const item1 = this.innerList.find((element) => element.primaryKeyValue === id1);
        const item2 = this.innerList.find((element) => element.primaryKeyValue === id2);
        this.innerList = this.innerList.map((bindingObject, index) => {
            if (bindingObject.primaryKeyValue === id1) {
                return item2;
            }
            else if (bindingObject.primaryKeyValue === id2) {
                return item1;
            }
            else
                return bindingObject;
        }).toList();
        this.changes.next({
            type: ChangeType.Swap,
            path: [],
            detail: {
                type: 'swap',
                id: [id1, id2]
            }
        });
    }
    /**
     * 转换为JSON对象
     * @param options 配置
     * @returns 普通对象数组
     */
    toJSON(options) {
        const result = [];
        this.innerList.forEach((obj) => {
            result.push(obj.toJSON(options));
        });
        return result;
    }
    /**
     * 过滤列表数据
     * @param conditions 过滤条件
     */
    filter(conditions) {
        if (this.defaultView === null) {
            this.defaultView = this.innerList.toList();
        }
        let list;
        if (Array.isArray(conditions)) {
            const filter = new ArrayFilterConditionDataFilter();
            list = this.defaultView.filter((bindingObject) => {
                return filter.validateRowData(bindingObject, conditions);
            }).toList();
        }
        else {
            const filter = new ObjectFilterConditionDataFilter();
            list = this.defaultView.filter((bindingObject) => {
                return filter.validateRowData(bindingObject, conditions);
            }).toList();
        }
        // 如果有排序条件，则对过滤后的结果进行排序
        if (this.sortFields && this.sortFields.length > 0) {
            this.innerList = list.sort(this.comparator(this.sortFields, this.sortDirections)).toList();
        }
        else {
            this.innerList = list;
        }
    }
    /**
     * 获取分页信息
     * @param path 路径
     * @param defaultValue 默认值
     * @throws 路径必须为字符串！
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        const paths = path.split('/').filter((item) => !!item && item.trim().length > 0).map((item) => item.trim());
        let config = this.paginationInfo;
        paths.forEach((item) => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 对bindingList就行排序
     * @param fields - 排序字段
     * @param directions - 排序规则字段
     * @param options - 参数
     * @throws argument error
     */
    sortBy(fields, directions, options) {
        if (!this.defaultView) {
            this.defaultView = this.innerList.toList();
        }
        // 默认升序
        const arrFields = typeof fields === 'string' ? fields.split(',').filter((p) => p) : fields || [];
        const arrDirections = typeof directions === 'string' ? directions.split(',').filter((p) => p) : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length) {
            throw new Error('sortBy:fields and directions not match');
        }
        this.sortFields = arrFields;
        this.sortDirections = arrDirections;
        if (!this.sortFields || this.sortFields.length < 1) {
            if (this.defaultView) {
                this.innerList = this.defaultView.toList();
                // 清空过滤条件后重置原始数据源
                this.defaultView = null;
            }
        }
        else {
            this.innerList = this.innerList.sort(this.comparator(arrFields, arrDirections)).toList();
        }
    }
    getValue(target, propName, isMultiLangProp = false, currentLanguage = 'zh-CHS') {
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        let result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            const props = propName.split('.');
            for (const prop of props) {
                target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);
            }
        }
        if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {
            return result[currentLanguage];
        }
        else {
            return result;
        }
    }
    /**
     * 排序器
     * @param props - 排序字段
     * @param orders - 排序规则
     * @returns
     */
    comparator(props, orders) {
        return (item1, item2) => {
            return props.reduce((result, prop) => {
                if (result === 0) {
                    const bindingProperty = this.properties.find((item) => item.name === prop);
                    let isMultiLangProp = false;
                    if (bindingProperty) {
                        isMultiLangProp = bindingProperty.enableMultiLangInput;
                    }
                    const currentLanguage = TranslateService.getCurrentLanguage();
                    const order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                    let item1Value = this.getValue(item1, prop, isMultiLangProp, currentLanguage);
                    let item2Value = this.getValue(item2, prop, isMultiLangProp, currentLanguage);
                    if (item1Value === null || item1Value === undefined) {
                        item1Value = '';
                    }
                    if (item2Value === null || item2Value === undefined) {
                        item2Value = '';
                    }
                    if (typeof item1Value === 'string' && typeof item2Value === 'string') {
                        const localeCompareResult = item1Value.localeCompare(item2Value);
                        result = localeCompareResult * order;
                    }
                    else {
                        if (item1Value > item2Value) {
                            result = order * 1;
                        }
                        if (item1Value < item2Value) {
                            result = order * -1;
                        }
                    }
                }
                return result;
            }, 0);
        };
    }
    updateDefaultView(change) {
        change.pipe(takeUntil(this.destroy$)).subscribe((change) => {
            if (this.defaultView !== null && ((change.path.length === 0 && [ChangeType.Load, ChangeType.Append, ChangeType.Remove, ChangeType.Swap].includes(change.type)) || (change.type === ChangeType.ValueChanged && change.isBindingListTransmited !== true))) {
                switch (change.type) {
                    case ChangeType.Load:
                        this.defaultView = this.innerList.toList();
                        break;
                    case ChangeType.Append: {
                        // 插入
                        if (change.detail && change.detail.type === 'insert') {
                            const position = change.detail.position;
                            const object = change.value;
                            const currentIndex = this.innerList.findIndex((obj) => obj.primaryKeyValue === this.currentId);
                            // 加载BindingObject
                            if (position === 1) {
                                this.defaultView = this.defaultView.insert(currentIndex + 1, object);
                            }
                            else if (position === -1) {
                                this.defaultView = this.defaultView.insert(currentIndex, object);
                            }
                            else {
                                this.defaultView = this.defaultView.push(object);
                            }
                        }
                        else {
                            const objects = change.value;
                            this.defaultView = this.defaultView.push(...objects);
                        }
                        break;
                    }
                    case ChangeType.Remove:
                        const ids = change.value;
                        if (ids.length === 0) {
                            this.defaultView = this.defaultView.clear();
                        }
                        else {
                            ids.forEach((id) => {
                                const index = this.defaultView.findIndex((bindingObject) => bindingObject.primaryKeyValue === id);
                                this.defaultView = this.defaultView.delete(index);
                            });
                        }
                        break;
                    case ChangeType.ValueChanged:
                        const id = change.id;
                        const bindingObject = this.defaultView.find((obj) => obj.primaryKeyValue === id);
                        const paths = change.path.concat([]);
                        const propertyName = paths.pop();
                        const target = paths.reduce((object, path) => {
                            return object[path];
                        }, bindingObject);
                        if (target) {
                            target.setValue(propertyName, change.value);
                        }
                        break;
                    case ChangeType.Swap:
                        const [id1, id2] = change.detail && change.detail.id;
                        const item1 = this.defaultView.find((element) => element.primaryKeyValue === id1);
                        const item2 = this.defaultView.find((element) => element.primaryKeyValue === id2);
                        this.defaultView = this.defaultView.map((bindingObject, index) => {
                            if (bindingObject.primaryKeyValue === id1) {
                                return item2;
                            }
                            else if (bindingObject.primaryKeyValue === id2) {
                                return item1;
                            }
                            else
                                return bindingObject;
                        }).toList();
                        break;
                    // case ChangeType.SortChanged:
                    //   const { fields = [], directions = [] } = change.detail || {};
                    //   this.defaultView = this.defaultView.sort(this.comparator(fields, directions)).toList();
                    //   break;
                }
            }
        });
    }
}
export { BindingList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSCxrQ0FBa0M7QUFFbEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNqQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBVSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHL0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUU3RCxPQUFPLEVBQW1CLDhCQUE4QixFQUF5QiwrQkFBK0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pJLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQzs7R0FFRztBQUNILE1BQU0sV0FBVztJQTZJZjs7T0FFRztJQUNILFlBQVksVUFBNkI7UUEvSWxDLGFBQVEsR0FBRyxhQUFhLENBQUM7UUFNeEIsZUFBVSxHQUFhLEVBQUUsQ0FBQztRQUMxQixtQkFBYyxHQUFhLEVBQUUsQ0FBQztRQUN0Qzs7V0FFRztRQUNJLGdCQUFXLEdBQXdCLElBQUksQ0FBQztRQThCL0MsZUFBZTtRQUVmOztXQUVHO1FBQ0ksb0JBQWUsR0FBUSxJQUFJLENBQUM7UUFrR2pDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxVQUFVLEdBQUcsWUFBWSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUV6RCxJQUFJ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LElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLGVBQWUsS0FBSyxHQUFHLENBQUMsQ0FBQzt3QkFDbEYsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEtBQUssR0FBRyxDQUFDLENBQUM7d0JBQ2xGLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxhQUE0QixFQUFFLEtBQWEsRUFBRSxFQUFFOzRCQUN0RixJQUFJLGFBQWEsQ0FBQyxlQUFlLEtBQUssR0FBRyxFQUFFO2dDQUN6QyxPQUFPLEtBQUssQ0FBQzs2QkFDZDtpQ0FBTSxJQUFJLGFBQWEsQ0FBQyxlQUFlLEtBQUssR0FBRyxFQUFFO2dDQUNoRCxPQUFPLEtBQUssQ0FBQzs2QkFDZDs7Z0NBQU0sT0FBTyxhQUFhLENBQUM7d0JBQzlCLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO3dCQUNaLE1BQU07b0JBQ1IsK0JBQStCO29CQUMvQixrRUFBa0U7b0JBQ2xFLDRGQUE0RjtvQkFDNUYsV0FBVztpQkFDWjthQUNGO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFFRCxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog57uR5a6a5YiX6KGo55u45YWz5a6a5LmJXHJcbiAqIEBhdXRob3IgV2l0dDxqaXd0QGluc3B1ci5jb20+XHJcbiAqL1xyXG5cclxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5cclxuaW1wb3J0IHsgTGlzdCB9IGZyb20gJ2ltbXV0YWJsZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3QgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0JztcclxuaW1wb3J0IHsgQmluZGluZ1Byb3BlcnR5IH0gZnJvbSAnLi9iaW5kaW5nX3Byb3BlcnR5JztcclxuaW1wb3J0IHsgQmluZGluZ09iamVjdEZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eVV0aWwgfSBmcm9tICcuL3Byb3BlcnR5X3V0aWwnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSB9IGZyb20gJy4vYmluZGluZ19kYXRhJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJy4uL2kxOG4vdHJhbnNsYXRlX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBJRGlzcG9zYWJsZSB9IGZyb20gJy4uL2NvcmUnO1xyXG5pbXBvcnQgeyBGaWx0ZXJDb25kaXRpb24sIEFycmF5RmlsdGVyQ29uZGl0aW9uRGF0YUZpbHRlciwgT2JqZWN0RmlsdGVyQ29uZGl0aW9uLCBPYmplY3RGaWx0ZXJDb25kaXRpb25EYXRhRmlsdGVyIH0gZnJvbSAnLi4vZGF0YS1maWx0ZXInO1xyXG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG4vKipcclxuICogQmluZGluZ0xpc3TmmK/kuIDkuKpCaW5kaW5nT2JqZWN06ZuG5ZCIXHJcbiAqL1xyXG5jbGFzcyBCaW5kaW5nTGlzdCBpbXBsZW1lbnRzIElEaXNwb3NhYmxlIHtcclxuICBwdWJsaWMgX190eXBlX18gPSAnQmluZGluZ0xpc3QnO1xyXG4gIC8qKlxyXG4gICAqIGltbXV0YWJsZeeahEJpbmRpbmdPYmplY3TliJfooahcclxuICAgKi9cclxuICBwcml2YXRlIGlubmVyTGlzdDogTGlzdDxCaW5kaW5nT2JqZWN0PjtcclxuICBwcml2YXRlIGVtcHR5Q3VycmVudEl0ZW06IEJpbmRpbmdPYmplY3Q7XHJcbiAgcHJpdmF0ZSBzb3J0RmllbGRzOiBzdHJpbmdbXSA9IFtdO1xyXG4gIHByaXZhdGUgc29ydERpcmVjdGlvbnM6IHN0cmluZ1tdID0gW107XHJcbiAgLyoqXHJcbiAgICog55WM6Z2i5pWw5o2u5rqQXHJcbiAgICovXHJcbiAgcHVibGljIGRlZmF1bHRWaWV3OiBMaXN0PEJpbmRpbmdPYmplY3Q+ID0gbnVsbDtcclxuICAvKipcclxuICAgKiDlhbPogZTlrp7kvZPnmoTlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgcHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W107XHJcblxyXG4gIC8qKlxyXG4gICAqIOS4u+mUruWQjVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcmltYXJ5S2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOeItuWvueixoVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwYXJlbnQ6IEJpbmRpbmdPYmplY3Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjaGFuZ2VzOiBTdWJqZWN0PENoYW5nZT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOW9k+WJjeihjOWvueW6lOeahOe7keWumuWvueixoeeahOWGheeggVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjdXJyZW50SWQ6IHN0cmluZztcclxuICAvKipcclxuICAgKiBkZXN0b3J5IHNpZ25hbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZXN0cm95JDogU3ViamVjdDxhbnk+O1xyXG5cclxuICAvLyAjcmVnaW9uIOWIhumhteebuOWFs1xyXG5cclxuICAvKipcclxuICAgKiDliIbpobXkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgX3BhZ2luYXRpb25JbmZvOiBhbnkgPSBudWxsO1xyXG5cclxuICBzZXQgcGFnaW5hdGlvbkluZm8oc1BhZ2luYXRpb25JbmZvOiBhbnkpIHtcclxuICAgIHRoaXMuX3BhZ2luYXRpb25JbmZvID0gc1BhZ2luYXRpb25JbmZvO1xyXG4gICAgaWYgKHRoaXMuX3BhZ2luYXRpb25JbmZvID09PSBzUGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IHRoaXMuX3BhZ2luYXRpb25JbmZvXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldCBwYWdpbmF0aW9uSW5mbygpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BhZ2luYXRpb25JbmZvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bpobXnoIFcclxuICAgKi9cclxuICBnZXQgcGFnZUluZGV4KCkge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbyAmJiB0aGlzLnBhZ2luYXRpb25JbmZvLmhhc093blByb3BlcnR5KFwicGFnZUluZGV4XCIpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25JbmZvLnBhZ2VJbmRleDtcclxuICAgIH1cclxuICAgIHJldHVybiAxO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXlpKflsI9cclxuICAgKi9cclxuICBnZXQgcGFnZVNpemUoKSB7XHJcbiAgICBpZiAoISF0aGlzLnBhZ2luYXRpb25JbmZvICYmIHRoaXMucGFnaW5hdGlvbkluZm8uaGFzT3duUHJvcGVydHkoXCJwYWdlU2l6ZVwiKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlU2l6ZTtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5pWw5o2u5oC76aG55pWwXHJcbiAgICovXHJcbiAgZ2V0IHRvdGFsKCkge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbCB8fCB0aGlzLnBhZ2luYXRpb25JbmZvLnRvdGFsQ291bnQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W6Lez6L+H55qE5pWw5o2u5p2h5pWwXHJcbiAgICovXHJcbiAgZ2V0IHNraXAoKSB7XHJcbiAgICBjb25zdCBwYWdlSW5kZXggPSB0aGlzLnBhZ2VJbmRleDtcclxuICAgIGNvbnN0IHBhZ2VTaXplID0gdGhpcy5wYWdlU2l6ZTtcclxuICAgIHJldHVybiAocGFnZUluZGV4IC0gMSkgKiBwYWdlU2l6ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWJjeWPsOiuvue9ruWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBza2lwIHNraXBcclxuICAgKiBAcGFyYW0gdGFrZSB0YWtlXHJcbiAgICovXHJcbiAgcHVibGljIHNldFBhZ2luYXRpb25JbmZvKHNraXA6IG51bWJlciwgdGFrZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5wYWdpbmF0aW9uSW5mbywge1xyXG4gICAgICBwYWdlU2l6ZTogdGFrZSxcclxuICAgICAgcGFnZUluZGV4OiBza2lwIC8gdGFrZSArIDFcclxuICAgIH0pO1xyXG4gICAgLyp0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUGFnaW5hdGlvbkluZm9DaGFuZ2UsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogdGhpcy5wYWdpbmF0aW9uSW5mb1xyXG4gICAgfSk7Ki9cclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8qKlxyXG4gICAqIOW9k+WJjeihjOWvueW6lOeahOe7keWumuWvueixoVxyXG4gICAqIOWmguaenGN1cnJlbnRJZOS4um51bGzvvIzliJnliJvlu7rkuIDkuKrnqbrnu5PmnoTvvIzpmLLmraLnu5HlrprmiqXplJnvvJtcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGN1cnJlbnRJdGVtKCk6IEJpbmRpbmdPYmplY3Qge1xyXG4gICAgY29uc3QgY3VycmVudEl0ZW0gPSB0aGlzLmZpbmRCeUlkKHRoaXMuY3VycmVudElkKTtcclxuICAgIGlmICghY3VycmVudEl0ZW0pIHtcclxuICAgICAgaWYgKCF0aGlzLmVtcHR5Q3VycmVudEl0ZW0pIHtcclxuICAgICAgICB0aGlzLmVtcHR5Q3VycmVudEl0ZW0gPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUodGhpcy5wcm9wZXJ0aWVzKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGhpcy5lbXB0eUN1cnJlbnRJdGVtO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGN1cnJlbnRJdGVtO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5a+56LGh55qE5pWw6YePXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyTGlzdC5jb3VudCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pIHtcclxuICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7XHJcbiAgICB0aGlzLnByaW1hcnlLZXkgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJpbWFyeUtleShwcm9wZXJ0aWVzKTtcclxuXHJcbiAgICB0aGlzLmNoYW5nZXMgPSBuZXcgU3ViamVjdDxDaGFuZ2U+KCk7XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IExpc3Q8QmluZGluZ09iamVjdD4oKTtcclxuICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIHRoaXMuZGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgdGhpcy51cGRhdGVEZWZhdWx0Vmlldyh0aGlzLmNoYW5nZXMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDplIDmr4FcclxuICAgKiBAcGFyYW0gb3B0aW9uc1xyXG4gICAqL1xyXG4gIGRpc3Bvc2Uob3B0aW9ucz86IGFueSkge1xyXG4gICAgdGhpcy5jbGVhcih0cnVlKTtcclxuICAgIGlmICh0aGlzLmRlc3Ryb3kkKSB7XHJcbiAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICAgIHRoaXMuZGVzdHJveSQgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5re75YqgW1N5bWJvbC5pdGVyYXRvcl3vvIzkvb/kuYvog73pgJrov4dmb3Igb2bpgY3ljoZcclxuICAgKi9cclxuICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgbGV0IGluZGV4ID0gLTE7XHJcbiAgICBjb25zdCBzaXplID0gdGhpcy5pbm5lckxpc3Quc2l6ZTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaW5kZXgrKztcclxuICAgICAgICBpZiAoaW5kZXggPCBzaXplKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IHNlbGYuaW5uZXJMaXN0LmdldChpbmRleCkgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHVuZGVmaW5lZCB9O1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yqg6L2957uR5a6a5a+56LGh77yM5Yqg6L295LmL5YmN5YWI5riF56m657uR5a6a5YiX6KGo77yM5bm26YeN572u5b2T5YmN6KGM77yM5Yqg6L295LmL5ZCO5bCG56ys5LiA6KGM6K6+572u5Li66buY6K6k5b2T5YmN6KGM44CCXHJcbiAgICogQHBhcmFtIG9iamVjdHMg6KaB5Yqg6L2957uR5a6a5a+56LGh5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWQob2JqZWN0czogQmluZGluZ09iamVjdFtdLCBlbnRpdHlDcmVhdGU6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xyXG4gICAgLy8g6YeN572u5YiX6KGoXHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmNsZWFyKCk7XHJcbiAgICBpZiAob2JqZWN0cy5sZW5ndGggIT09IDApIHtcclxuICAgICAgLy8g5Yqg6L295pWw5o2uXHJcbiAgICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0OiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgICAgdGhpcy5hZGQob2JqZWN0KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyDorr7nva7pu5jorqTlvZPliY3ooYxcclxuICAgICAgY29uc3QgY3VycmVudEl0ZW0gPSB0aGlzLmZpbmRCeUlkKHRoaXMuY3VycmVudElkKTtcclxuICAgICAgaWYgKCFjdXJyZW50SXRlbSkge1xyXG4gICAgICAgIGNvbnN0IGZpcnN0SWQgPSBvYmplY3RzWzBdW3RoaXMucHJpbWFyeUtleV07XHJcbiAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoZmlyc3RJZCwgZmFsc2UsIGZhbHNlKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY2hhbmdlOiBDaGFuZ2UgPSB7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuTG9hZCxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiBvYmplY3RzXHJcbiAgICB9O1xyXG4gICAgY2hhbmdlLmNyZWF0ZSA9IGVudGl0eUNyZWF0ZTtcclxuICAgIC8vIOinpuWPkeS6i+S7tlxyXG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+i/veWKoOe7keWumuWvueixoe+8jOi/veWKoOS5i+WQjuWwhuacgOWQjuS4gOS4qui/veWKoOeahOe7keWumuWvueixoeiuvue9ruS4uuW9k+WJjeihjOOAglxyXG4gICAqIEBwYXJhbSBvYmplY3RzIOimgeWKoOi9vee7keWumuWvueixoeaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmQob2JqZWN0czogQmluZGluZ09iamVjdFtdLCBpc0Nsb25lZDogYm9vbGVhbiA9IGZhbHNlLCBvcHRpb25zOiBhbnkgPSBudWxsKTogdm9pZCB7XHJcbiAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5Yqg6L29QmluZGluZ09iamVjdFxyXG4gICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgdGhpcy5hZGQob2JqZWN0KTtcclxuICAgIH0pO1xyXG4gICAgLy8g5b2T5YmN6KGM5Li65paw6L+95Yqg55qE5pyA5ZCOMeihjFxyXG4gICAgY29uc3QgbGFzdElkID0gb2JqZWN0c1tvYmplY3RzLmxlbmd0aCAtIDFdW3RoaXMucHJpbWFyeUtleV07XHJcbiAgICB0aGlzLnNldEN1cnJlbnRJZChsYXN0SWQsIHRydWUsIHRydWUpO1xyXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XHJcbiAgICBjb25zdCBjaGFuZ2U6IENoYW5nZSA9IHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5BcHBlbmQsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogb2JqZWN0cyxcclxuICAgICAgaXNUcmVlTm9kZUxvYWRTY2VuZTogb3B0aW9ucyAmJiBvcHRpb25zLmlzVHJlZU5vZGVMb2FkU2NlbmVcclxuICAgIH07XHJcbiAgICBpZiAoaXNDbG9uZWQpIHtcclxuICAgICAgY2hhbmdlLmlzQ2xvbmVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWinuWKoOaVsOaNrlxyXG4gICAqIEBwYXJhbSBvYmplY3RzIOWunuS9k1xyXG4gICAqIEBwYXJhbSBvcHRpb25zIOS4iuS4i+aWh1xyXG4gICAqIEBkZXNjcmlwdGlvbiDlop7liqDlrp7kvZPmlbDmja7vvIzkvYbkuI3liIfmjaLlvZPliY3ooYxcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRGF0YShvYmplY3RzOiBCaW5kaW5nT2JqZWN0W10sIG9wdGlvbnM6IGFueSA9IG51bGwpOiB2b2lkIHtcclxuICAgIGlmIChvYmplY3RzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XHJcbiAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmFkZChvYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICAvLyDop6blj5Hkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5BcHBlbmQsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogb2JqZWN0cyxcclxuICAgICAgaXNUcmVlTm9kZUxvYWRTY2VuZTogb3B0aW9ucyAmJiBvcHRpb25zLmlzVHJlZU5vZGVMb2FkU2NlbmVcclxuICAgIH0pO1xyXG4gIH1cclxuICBwdWJsaWMgaW5zZXJ0KG9iamVjdDogQmluZGluZ09iamVjdCwgcG9zaXRpb24/OiAxIHwgLTEpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuaW5uZXJMaXN0LmZpbmRJbmRleCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiBvYmoucHJpbWFyeUtleVZhbHVlID09PSB0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XHJcbiAgICBpZiAocG9zaXRpb24gPT09IDEpIHtcclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5pbnNlcnQoY3VycmVudEluZGV4ICsgMSwgb2JqZWN0KTtcclxuICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09IC0xKSB7XHJcbiAgICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuaW5zZXJ0KGN1cnJlbnRJbmRleCwgb2JqZWN0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QucHVzaChvYmplY3QpO1xyXG4gICAgfVxyXG4gICAgb2JqZWN0LnBhcmVudCA9IHRoaXM7XHJcbiAgICAvLyDnm5HlkKxvYmplY3Tlj5jmm7TvvIzlubbnu6fnu63lkJHkuIrmipvvvIznlLHkuo5saXN05pyJ5b2T5YmN6KGM55qE5qaC5b+177yM5LiN6ZyA6KaB5ZyocGF0aOS4rei/veWKoOi3r+W+hFxyXG4gICAgb2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5zZXRDdXJyZW50SWQob2JqZWN0LnByaW1hcnlLZXlWYWx1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcblxyXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdCxcclxuICAgICAgZGV0YWlsOiB7XHJcbiAgICAgICAgdHlwZTogJ2luc2VydCcsXHJcbiAgICAgICAgcG9zaXRpb25cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOe7keWumuWvueixoe+8jOW5tuW7uueri+e7keWumuWvueixoeWSjOe7keWumuWIl+ihqOS5i+mXtOeahOWFs+iBlOOAglxyXG4gICAqIEBwYXJhbSBvYmplY3Qg57uR5a6a5a+56LGhXHJcbiAgICovXHJcbiAgcHVibGljIGFkZChvYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcclxuICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QucHVzaChvYmplY3QpO1xyXG4gICAgb2JqZWN0LnBhcmVudCA9IHRoaXM7XHJcblxyXG4gICAgLy8g55uR5ZCsb2JqZWN05Y+Y5pu077yM5bm257un57ut5ZCR5LiK5oqb77yM55Sx5LqObGlzdOacieW9k+WJjeihjOeahOamguW/te+8jOS4jemcgOimgeWcqHBhdGjkuK3ov73liqDot6/lvoRcclxuICAgIG9iamVjdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5Li76ZSu5YC85pWw57uE5a+55bqU55qE57uR5a6a5a+56LGh44CCXHJcbiAgICogQHBhcmFtIGlkcyDkuLvplK7lgLzmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZHMoaWRzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XHJcbiAgICBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbmV4dEN1cnJlbnRJZCA9IHRoaXMuY3VycmVudElkO1xyXG4gICAgaWRzLmZvckVhY2goKGlkOiBzdHJpbmcpID0+IHtcclxuICAgICAgLy8g5aaC5p6c5b2T5YmN6KGM6KKr5Yig6Zmk77yM6K6h566X5LiL5LiA5b2T5YmN6KGMXHJcbiAgICAgIGlmIChpZCA9PT0gbmV4dEN1cnJlbnRJZCkge1xyXG4gICAgICAgIG5leHRDdXJyZW50SWQgPSB0aGlzLmdldEN1cnJlbnRJZEJlZm9yZURlbGV0aW5nKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWIoOmZpOWvueixoe+8jOaJvuS4jeWIsOaXtui3s+i/h1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKGlkKTtcclxuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmRlbGV0ZShpbmRleCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDph43mlrDorr7nva7lvZPliY3ooYxcclxuICAgIGlmICh0aGlzLmlubmVyTGlzdC5jb3VudCgpID09PSAwKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2V0Q3VycmVudElkKG5leHRDdXJyZW50SWQsIGZhbHNlLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Ye65Y+R6KGM5Yig6Zmk5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IGlkc1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOaVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZURhdGFCeUlkcyhpZHM6IEFycmF5PHN0cmluZz4pOiB2b2lkIHtcclxuICAgIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlkcy5mb3JFYWNoKChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIC8vIOWIoOmZpOWvueixoe+8jOaJvuS4jeWIsOaXtui3s+i/h1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0SW5kZXhCeUlkKGlkKTtcclxuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmRlbGV0ZShpbmRleCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDlh7rlj5HooYzliKDpmaTkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5SZW1vdmUsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogaWRzXHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m6XHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyKGNsZWFyT25seTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICB0aGlzLmlubmVyTGlzdC5mb3JFYWNoKChpdGVtOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIGl0ZW1bJ19FTlRJVFlfJ10gPSBudWxsO1xyXG4gICAgICBpdGVtLnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgaXRlbS51bnN1YnNjcmliZS5jb21wbGV0ZSgpO1xyXG4gICAgICBpdGVtLmNoYW5nZXMuY29tcGxldGUoKTtcclxuICAgICAgaXRlbS52aWV3Q2hhbmdlcy5jb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LmNsZWFyKCk7XHJcbiAgICBpZiAoIWNsZWFyT25seSkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlJlbW92ZSxcclxuICAgICAgICBwYXRoOiBbXSxcclxuICAgICAgICB2YWx1ZTogW11cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpoLmnpzlvZPliY3ooYzooqvliKDpmaTvvIzliKDpmaTkuYvliY3ph43mlrDorqHnrpflvZPliY3ooYznmoTkvY3nva7vvIzlubbov5Tlm57kuIvkuIDlvZPliY3ooYznmoTkuLvplK7lgLzjgIJcclxuICAgKiAtIOWmguaenOiiq+WIoOmZpOeahOihjOaYr+acgOWQjjHooYzvvIzliJnkuIrnp7sx6KGM77ybXHJcbiAgICogLSDlhbbku5bmg4XlhrXvvIzkuIvnp7sx6KGM44CCXHJcbiAgICovXHJcbiAgcHVibGljIGdldEN1cnJlbnRJZEJlZm9yZURlbGV0aW5nKCk6IHN0cmluZyB7XHJcbiAgICBsZXQgbmV4dEluZGV4ID0gLTE7XHJcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmdldEluZGV4QnlJZCh0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICBpZiAoY3VycmVudEluZGV4ID09PSB0aGlzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgbmV4dEluZGV4ID0gY3VycmVudEluZGV4IC0gMTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5nZXRJZEJ5SW5kZXgobmV4dEluZGV4KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruS4u+mUruWAvOiOt+WPluWvueW6lOe7keWumuWvueixoVxyXG4gICAqIEBwYXJhbSAgIGlkIOimgeafpeaJvueahOS4u+mUruWAvFxyXG4gICAqIEByZXR1cm5zIOaJvuWIsOaXtui/lOWbnuWvueW6lEJpbmRpbmdPYmplY3TvvIwg5om+5LiN5Yiw5pe26L+U5ZuebnVsbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaW5kQnlJZChpZDogc3RyaW5nKTogQmluZGluZ09iamVjdCB8IG51bGwge1xyXG4gICAgbGV0IHRhcmdldDogQmluZGluZ09iamVjdDtcclxuICAgIHRhcmdldCA9IHRoaXMuaW5uZXJMaXN0LmZpbmQoKGl0ZW0pID0+IHtcclxuICAgICAgcmV0dXJuIGl0ZW0uZ2V0VmFsdWUodGhpcy5wcmltYXJ5S2V5KSA9PT0gaWQ7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0YXJnZXQgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB0YXJnZXQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsIbkuLvplK7lgLzkuLppZOeahOe7keWumuWvueixoeiuvue9ruS4uuW9k+WJjeihjFxyXG4gICAqIEBwYXJhbSAgaWQgICAgICAgIOimgeiuvue9rueahOS4u+mUruWAvFxyXG4gICAqIEBwYXJhbSAgZW1pdEV2ZW50IOaYr+WQpuWPkemAgeW9k+WJjeihjOWPmOabtOS6i+S7tlxyXG4gICAqIEBwYXJhbSAgZm9yY2Ug5by65Yi25YiH5o2iXHJcbiAgICovXHJcbiAgcHVibGljIHNldEN1cnJlbnRJZChpZDogc3RyaW5nLCBlbWl0RXZlbnQ6IGJvb2xlYW4gPSB0cnVlLCBlbWl0R2xvYmFsRXZlbnQ6IGJvb2xlYW4gPSB0cnVlLCBmb3JjZTogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50SWQgPT09IGlkICYmICFmb3JjZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5LiN5a2Y5Zyo5pe26K6+572u5Li6bnVsbFxyXG4gICAgLy8gY29uc3QgY3VycmVudE9iaiA9IHRoaXMuZmluZEJ5SWQoaWQpO1xyXG4gICAgLy8gaWYgKCFjdXJyZW50T2JqKSB7XHJcbiAgICAvLyAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgIHRoaXMuY3VycmVudElkID0gaWQ7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gQHRvZG/vvJrmib7kuI3liLDml7bmjInnkIblupTor6Xorr7nva7kuLpudWxs77yM55uu5YmN5piv55u05o6l6L+U5Zue77yM5qGG5p626YOo5YiG5Yqf6IO95L6d6LWW6K+l54m55oCn44CCXHJcbiAgICBjb25zdCBjdXJyZW50T2JqID0gdGhpcy5maW5kQnlJZChpZCk7XHJcbiAgICBpZiAoIWN1cnJlbnRPYmogJiYgIWZvcmNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY3VycmVudElkID0gaWQ7XHJcblxyXG4gICAgLy8g5Y+R5Ye66KGM5YiH5o2i5LqL5Lu2XHJcbiAgICBpZiAoZW1pdEV2ZW50ID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLlNlbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgICAgcGF0aDogW10sXHJcbiAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEl0ZW0sXHJcbiAgICAgICAgZm9yY2VcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5piv5ZCm5Y+R6YCB5YWo5bGA55qE6KGM5YiH5o2i5LqL5Lu2XHJcbiAgICBpZiAoZW1pdEdsb2JhbEV2ZW50ID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgICB0eXBlOiBDaGFuZ2VUeXBlLkdsb2JhbFNlbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgICAgcGF0aDogW10sXHJcbiAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEl0ZW0sXHJcbiAgICAgICAgZm9yY2VcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7kuLvplK7lgLzkuLppZOeahOe7keWumuWvueixoeeahOe0ouW8lVxyXG4gICAqIEBwYXJhbSBpZCDkuLvplK7lgLxcclxuICAgKiBAcmV0dXJucyDmib7liLDml7bov5Tlm57lr7nlupTnmoRpbmRleO+8jOaJvuS4jeWIsOaXtui/lOWbni0xXHJcbiAgICovXHJcbiAgcHVibGljIGdldEluZGV4QnlJZChpZDogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmlubmVyTGlzdC5maW5kSW5kZXgoKG9iajogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4gb2JqW3RoaXMucHJpbWFyeUtleV0gPT09IGlkO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7ntKLlvJXkvY3nva7ojrflj5blr7nlupTnu5Hlrprlr7nosaHnmoTkuLvplK7lgLxcclxuICAgKiBAcmV1dHJuIOaJvuWIsOaXtui/lOWbnuWvueW6lOS4u+mUruWAvO+8jOaJvuS4jeWIsOi/lOWbnm51bGxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0SWRCeUluZGV4KGluZGV4OiBudW1iZXIpOiBzdHJpbmcge1xyXG5cclxuICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPiB0aGlzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5pbm5lckxpc3QuaGFzKGluZGV4KSA9PT0gZmFsc2UpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBvYmogPSB0aGlzLmlubmVyTGlzdC5nZXQoaW5kZXgpO1xyXG4gICAgcmV0dXJuIG9ialt0aGlzLnByaW1hcnlLZXldO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6QmluZGluZ09iamVjdOaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0FycmF5KCk6IEJpbmRpbmdPYmplY3RbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QudG9BcnJheSgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkuqTkupLmlbDmja7kvY3nva5cclxuICAgKiBAcGFyYW0gaWQxIGlkMVxyXG4gICAqIEBwYXJhbSBpZDIgaWQyXHJcbiAgICovXHJcbiAgcHVibGljIHN3YXBCeUlkKGlkMTogYW55LCBpZDI6IGFueSkge1xyXG4gICAgY29uc3QgaXRlbTEgPSB0aGlzLmlubmVyTGlzdC5maW5kKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQxKTtcclxuICAgIGNvbnN0IGl0ZW0yID0gdGhpcy5pbm5lckxpc3QuZmluZCgoZWxlbWVudCkgPT4gZWxlbWVudC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMik7XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0Lm1hcCgoYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSkge1xyXG4gICAgICAgIHJldHVybiBpdGVtMjtcclxuICAgICAgfSBlbHNlIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQyKSB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0xO1xyXG4gICAgICB9IGVsc2UgcmV0dXJuIGJpbmRpbmdPYmplY3Q7XHJcbiAgICB9KS50b0xpc3QoKTtcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5Td2FwLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgZGV0YWlsOiB7XHJcbiAgICAgICAgdHlwZTogJ3N3YXAnLFxyXG4gICAgICAgIGlkOiBbaWQxLCBpZDJdXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDovazmjaLkuLpKU09O5a+56LGhXHJcbiAgICogQHBhcmFtIG9wdGlvbnMg6YWN572uXHJcbiAgICogQHJldHVybnMg5pmu6YCa5a+56LGh5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvSlNPTihvcHRpb25zPzogYW55KTogYW55W10ge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICB0aGlzLmlubmVyTGlzdC5mb3JFYWNoKChvYmo6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgcmVzdWx0LnB1c2gob2JqLnRvSlNPTihvcHRpb25zKSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi/h+a7pOWIl+ihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBjb25kaXRpb25zIOi/h+a7pOadoeS7tlxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaWx0ZXIoY29uZGl0aW9uczogQXJyYXk8RmlsdGVyQ29uZGl0aW9uPiB8IE9iamVjdEZpbHRlckNvbmRpdGlvbikge1xyXG4gICAgaWYgKHRoaXMuZGVmYXVsdFZpZXcgPT09IG51bGwpIHtcclxuICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IHRoaXMuaW5uZXJMaXN0LnRvTGlzdCgpO1xyXG4gICAgfVxyXG4gICAgbGV0IGxpc3Q6IExpc3Q8QmluZGluZ09iamVjdD47XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25kaXRpb25zKSkge1xyXG4gICAgICBjb25zdCBmaWx0ZXIgPSBuZXcgQXJyYXlGaWx0ZXJDb25kaXRpb25EYXRhRmlsdGVyKCk7XHJcbiAgICAgIGxpc3QgPSB0aGlzLmRlZmF1bHRWaWV3LmZpbHRlcigoYmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBmaWx0ZXIudmFsaWRhdGVSb3dEYXRhKGJpbmRpbmdPYmplY3QsIGNvbmRpdGlvbnMpO1xyXG4gICAgICB9KS50b0xpc3QoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGZpbHRlciA9IG5ldyBPYmplY3RGaWx0ZXJDb25kaXRpb25EYXRhRmlsdGVyKCk7XHJcbiAgICAgIGxpc3QgPSB0aGlzLmRlZmF1bHRWaWV3LmZpbHRlcigoYmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBmaWx0ZXIudmFsaWRhdGVSb3dEYXRhKGJpbmRpbmdPYmplY3QsIGNvbmRpdGlvbnMpO1xyXG4gICAgICB9KS50b0xpc3QoKTtcclxuICAgIH1cclxuICAgIC8vIOWmguaenOacieaOkuW6j+adoeS7tu+8jOWImeWvuei/h+a7pOWQjueahOe7k+aenOi/m+ihjOaOkuW6j1xyXG4gICAgaWYgKHRoaXMuc29ydEZpZWxkcyAmJiB0aGlzLnNvcnRGaWVsZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IGxpc3Quc29ydCh0aGlzLmNvbXBhcmF0b3IodGhpcy5zb3J0RmllbGRzLCB0aGlzLnNvcnREaXJlY3Rpb25zKSkudG9MaXN0KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IGxpc3Q7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXRoIOi3r+W+hFxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUg6buY6K6k5YC8XHJcbiAgICogQHRocm93cyDot6/lvoTlv4XpobvkuLrlrZfnrKbkuLLvvIFcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZT86IGFueSkge1xyXG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTlv4XpobvkuLrlrZfnrKbkuLLvvIEnKTtcclxuICAgIH1cclxuICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygxKTtcclxuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcigoaXRlbSkgPT4gISFpdGVtICYmIGl0ZW0udHJpbSgpLmxlbmd0aCA+IDApLm1hcCgoaXRlbSkgPT4gaXRlbS50cmltKCkpO1xyXG4gICAgbGV0IGNvbmZpZyA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICBwYXRocy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIGlmIChjb25maWcgJiYgY29uZmlnLmhhc093blByb3BlcnR5KGl0ZW0pKSB7XHJcbiAgICAgICAgY29uZmlnID0gY29uZmlnW2l0ZW1dO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbmZpZyA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuICEhY29uZmlnID8gY29uZmlnIDogdHlwZW9mIGRlZmF1bHRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWvuWJpbmRpbmdMaXN05bCx6KGM5o6S5bqPXHJcbiAgICogQHBhcmFtIGZpZWxkcyAtIOaOkuW6j+Wtl+autVxyXG4gICAqIEBwYXJhbSBkaXJlY3Rpb25zIC0g5o6S5bqP6KeE5YiZ5a2X5q61XHJcbiAgICogQHBhcmFtIG9wdGlvbnMgLSDlj4LmlbBcclxuICAgKiBAdGhyb3dzIGFyZ3VtZW50IGVycm9yXHJcbiAgICovXHJcbiAgcHVibGljIHNvcnRCeShmaWVsZHM6IHN0cmluZyB8IEFycmF5PHN0cmluZz4sIGRpcmVjdGlvbnM6IHN0cmluZyB8IEFycmF5PHN0cmluZz4sIG9wdGlvbnM/OiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSkge1xyXG4gICAgaWYgKCF0aGlzLmRlZmF1bHRWaWV3KSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmlubmVyTGlzdC50b0xpc3QoKTtcclxuICAgIH1cclxuICAgIC8vIOm7mOiupOWNh+W6j1xyXG4gICAgY29uc3QgYXJyRmllbGRzOiBBcnJheTxzdHJpbmc+ID0gdHlwZW9mIGZpZWxkcyA9PT0gJ3N0cmluZycgPyBmaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIoKHApID0+IHApIDogZmllbGRzIHx8IFtdO1xyXG4gICAgY29uc3QgYXJyRGlyZWN0aW9uczogQXJyYXk8c3RyaW5nPiA9IHR5cGVvZiBkaXJlY3Rpb25zID09PSAnc3RyaW5nJyA/IGRpcmVjdGlvbnMuc3BsaXQoJywnKS5maWx0ZXIoKHApID0+IHApIDogZGlyZWN0aW9ucyB8fCBbXTtcclxuICAgIC8vIOaOkuW6j+Wtl+auteWSjOaOkuW6j+aWueW8j+W6lOS4gOiHtFxyXG4gICAgaWYgKGFyckZpZWxkcy5sZW5ndGggIT09IGFyckRpcmVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignc29ydEJ5OmZpZWxkcyBhbmQgZGlyZWN0aW9ucyBub3QgbWF0Y2gnKTtcclxuICAgIH1cclxuICAgIHRoaXMuc29ydEZpZWxkcyA9IGFyckZpZWxkcztcclxuICAgIHRoaXMuc29ydERpcmVjdGlvbnMgPSBhcnJEaXJlY3Rpb25zO1xyXG4gICAgaWYgKCF0aGlzLnNvcnRGaWVsZHMgfHwgdGhpcy5zb3J0RmllbGRzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgaWYgKHRoaXMuZGVmYXVsdFZpZXcpIHtcclxuICAgICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuZGVmYXVsdFZpZXcudG9MaXN0KCk7XHJcbiAgICAgICAgLy8g5riF56m66L+H5ruk5p2h5Lu25ZCO6YeN572u5Y6f5aeL5pWw5o2u5rqQXHJcbiAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3Quc29ydCh0aGlzLmNvbXBhcmF0b3IoYXJyRmllbGRzLCBhcnJEaXJlY3Rpb25zKSkudG9MaXN0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0VmFsdWUodGFyZ2V0OiBhbnksIHByb3BOYW1lOiBzdHJpbmcsIGlzTXVsdGlMYW5nUHJvcDogYm9vbGVhbiA9IGZhbHNlLCBjdXJyZW50TGFuZ3VhZ2U6IHN0cmluZyA9ICd6aC1DSFMnKSB7XHJcbiAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQmluZGluZ0xpc3QpIHtcclxuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmN1cnJlbnRJdGVtO1xyXG4gICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBCaW5kaW5nRGF0YSkge1xyXG4gICAgICB0YXJnZXQgPSB0YXJnZXQubGlzdC5jdXJyZW50SXRlbTtcclxuICAgIH1cclxuICAgIGxldCByZXN1bHQgPSBudWxsO1xyXG4gICAgaWYgKHByb3BOYW1lLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgcmVzdWx0ID0gdGFyZ2V0W3Byb3BOYW1lXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHByb3BzID0gcHJvcE5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgZm9yIChjb25zdCBwcm9wIG9mIHByb3BzKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gcmVzdWx0ID0gdGhpcy5nZXRWYWx1ZSh0YXJnZXQsIHByb3AsIGlzTXVsdGlMYW5nUHJvcCwgY3VycmVudExhbmd1YWdlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGlzTXVsdGlMYW5nUHJvcCAmJiByZXN1bHQgJiYgcmVzdWx0Lmhhc093blByb3BlcnR5KGN1cnJlbnRMYW5ndWFnZSkpIHtcclxuICAgICAgcmV0dXJuIHJlc3VsdFtjdXJyZW50TGFuZ3VhZ2VdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5o6S5bqP5ZmoXHJcbiAgICogQHBhcmFtIHByb3BzIC0g5o6S5bqP5a2X5q61XHJcbiAgICogQHBhcmFtIG9yZGVycyAtIOaOkuW6j+inhOWImVxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb21wYXJhdG9yKHByb3BzOiBBcnJheTxzdHJpbmc+LCBvcmRlcnM6IEFycmF5PHN0cmluZz4pIHtcclxuICAgIHJldHVybiAoaXRlbTE6IEJpbmRpbmdPYmplY3QsIGl0ZW0yOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHJldHVybiBwcm9wcy5yZWR1Y2UoKHJlc3VsdCwgcHJvcCkgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQgPT09IDApIHtcclxuICAgICAgICAgIGNvbnN0IGJpbmRpbmdQcm9wZXJ0eSA9IHRoaXMucHJvcGVydGllcy5maW5kKChpdGVtKSA9PiBpdGVtLm5hbWUgPT09IHByb3ApO1xyXG4gICAgICAgICAgbGV0IGlzTXVsdGlMYW5nUHJvcCA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYgKGJpbmRpbmdQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICBpc011bHRpTGFuZ1Byb3AgPSBiaW5kaW5nUHJvcGVydHkuZW5hYmxlTXVsdGlMYW5nSW5wdXQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBjdXJyZW50TGFuZ3VhZ2UgPSBUcmFuc2xhdGVTZXJ2aWNlLmdldEN1cnJlbnRMYW5ndWFnZSgpO1xyXG4gICAgICAgICAgY29uc3Qgb3JkZXIgPSBbJ2FzYyddLmluY2x1ZGVzKG9yZGVyc1twcm9wcy5pbmRleE9mKHByb3ApXSkgPyAxIDogLTE7XHJcbiAgICAgICAgICBsZXQgaXRlbTFWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbTEsIHByb3AsIGlzTXVsdGlMYW5nUHJvcCwgY3VycmVudExhbmd1YWdlKTtcclxuICAgICAgICAgIGxldCBpdGVtMlZhbHVlID0gdGhpcy5nZXRWYWx1ZShpdGVtMiwgcHJvcCwgaXNNdWx0aUxhbmdQcm9wLCBjdXJyZW50TGFuZ3VhZ2UpO1xyXG5cclxuICAgICAgICAgIGlmIChpdGVtMVZhbHVlID09PSBudWxsIHx8IGl0ZW0xVmFsdWUgPT09IHVuZGVmaW5lZCkgeyBpdGVtMVZhbHVlID0gJyc7IH1cclxuICAgICAgICAgIGlmIChpdGVtMlZhbHVlID09PSBudWxsIHx8IGl0ZW0yVmFsdWUgPT09IHVuZGVmaW5lZCkgeyBpdGVtMlZhbHVlID0gJyc7IH1cclxuXHJcbiAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0xVmFsdWUgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBpdGVtMlZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhbGVDb21wYXJlUmVzdWx0ID0gaXRlbTFWYWx1ZS5sb2NhbGVDb21wYXJlKGl0ZW0yVmFsdWUpO1xyXG4gICAgICAgICAgICByZXN1bHQgPSBsb2NhbGVDb21wYXJlUmVzdWx0ICogb3JkZXI7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoaXRlbTFWYWx1ZSA+IGl0ZW0yVmFsdWUpIHtcclxuICAgICAgICAgICAgICByZXN1bHQgPSBvcmRlciAqIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPCBpdGVtMlZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0ID0gb3JkZXIgKiAtMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9LCAwKTtcclxuICAgIH07XHJcbiAgfVxyXG4gIHByaXZhdGUgdXBkYXRlRGVmYXVsdFZpZXcoY2hhbmdlOiBTdWJqZWN0PENoYW5nZT4pIHtcclxuICAgIGNoYW5nZS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5kZWZhdWx0VmlldyAhPT0gbnVsbCAmJiAoKGNoYW5nZS5wYXRoLmxlbmd0aCA9PT0gMCAmJiBbQ2hhbmdlVHlwZS5Mb2FkLCBDaGFuZ2VUeXBlLkFwcGVuZCwgQ2hhbmdlVHlwZS5SZW1vdmUsIENoYW5nZVR5cGUuU3dhcF0uaW5jbHVkZXMoY2hhbmdlLnR5cGUpKSB8fCAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuVmFsdWVDaGFuZ2VkICYmIGNoYW5nZS5pc0JpbmRpbmdMaXN0VHJhbnNtaXRlZCAhPT0gdHJ1ZSkpKSB7XHJcbiAgICAgICAgc3dpdGNoIChjaGFuZ2UudHlwZSkge1xyXG4gICAgICAgICAgY2FzZSBDaGFuZ2VUeXBlLkxvYWQ6XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmlubmVyTGlzdC50b0xpc3QoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlIENoYW5nZVR5cGUuQXBwZW5kOiB7XHJcbiAgICAgICAgICAgIC8vIOaPkuWFpVxyXG4gICAgICAgICAgICBpZiAoY2hhbmdlLmRldGFpbCAmJiBjaGFuZ2UuZGV0YWlsLnR5cGUgPT09ICdpbnNlcnQnKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBjaGFuZ2UuZGV0YWlsLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9iamVjdCA9IGNoYW5nZS52YWx1ZTtcclxuICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmlubmVyTGlzdC5maW5kSW5kZXgoKG9iajogQmluZGluZ09iamVjdCkgPT4gb2JqLnByaW1hcnlLZXlWYWx1ZSA9PT0gdGhpcy5jdXJyZW50SWQpO1xyXG4gICAgICAgICAgICAgIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcclxuICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmRlZmF1bHRWaWV3Lmluc2VydChjdXJyZW50SW5kZXggKyAxLCBvYmplY3QpO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5pbnNlcnQoY3VycmVudEluZGV4LCBvYmplY3QpO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5wdXNoKG9iamVjdCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9iamVjdHMgPSBjaGFuZ2UudmFsdWUgYXMgYW55W107XHJcbiAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IHRoaXMuZGVmYXVsdFZpZXcucHVzaCguLi5vYmplY3RzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNhc2UgQ2hhbmdlVHlwZS5SZW1vdmU6XHJcbiAgICAgICAgICAgIGNvbnN0IGlkcyA9IGNoYW5nZS52YWx1ZSBhcyBBcnJheTxzdHJpbmc+O1xyXG4gICAgICAgICAgICBpZiAoaWRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmRlZmF1bHRWaWV3LmNsZWFyKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgaWRzLmZvckVhY2goKGlkOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5kZWZhdWx0Vmlldy5maW5kSW5kZXgoKGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5kZWxldGUoaW5kZXgpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQ6XHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gY2hhbmdlLmlkO1xyXG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5kZWZhdWx0Vmlldy5maW5kKChvYmo6IEJpbmRpbmdPYmplY3QpID0+IG9iai5wcmltYXJ5S2V5VmFsdWUgPT09IGlkKTtcclxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBjaGFuZ2UucGF0aC5jb25jYXQoW10pO1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwYXRocy5wb3AoKTtcclxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0OiBCaW5kaW5nT2JqZWN0ID0gcGF0aHMucmVkdWNlKChvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiBvYmplY3RbcGF0aF07XHJcbiAgICAgICAgICAgIH0sIGJpbmRpbmdPYmplY3QpIGFzIEJpbmRpbmdPYmplY3Q7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgICB0YXJnZXQuc2V0VmFsdWUocHJvcGVydHlOYW1lLCBjaGFuZ2UudmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSBDaGFuZ2VUeXBlLlN3YXA6XHJcbiAgICAgICAgICAgIGNvbnN0IFtpZDEsIGlkMl0gPSBjaGFuZ2UuZGV0YWlsICYmIGNoYW5nZS5kZXRhaWwuaWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0xID0gdGhpcy5kZWZhdWx0Vmlldy5maW5kKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQxKTtcclxuICAgICAgICAgICAgY29uc3QgaXRlbTIgPSB0aGlzLmRlZmF1bHRWaWV3LmZpbmQoKGVsZW1lbnQpID0+IGVsZW1lbnQucHJpbWFyeUtleVZhbHVlID09PSBpZDIpO1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5tYXAoKGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0yO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0xO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gYmluZGluZ09iamVjdDtcclxuICAgICAgICAgICAgfSkudG9MaXN0KCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgLy8gY2FzZSBDaGFuZ2VUeXBlLlNvcnRDaGFuZ2VkOlxyXG4gICAgICAgICAgLy8gICBjb25zdCB7IGZpZWxkcyA9IFtdLCBkaXJlY3Rpb25zID0gW10gfSA9IGNoYW5nZS5kZXRhaWwgfHwge307XHJcbiAgICAgICAgICAvLyAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmRlZmF1bHRWaWV3LnNvcnQodGhpcy5jb21wYXJhdG9yKGZpZWxkcywgZGlyZWN0aW9ucykpLnRvTGlzdCgpO1xyXG4gICAgICAgICAgLy8gICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgQmluZGluZ0xpc3QgfTtcclxuIl19
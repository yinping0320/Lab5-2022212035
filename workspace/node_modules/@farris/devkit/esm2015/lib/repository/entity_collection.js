import { Modification, ModifyType } from '../changeset/index';
import { Subject } from 'rxjs';
import { Entity, FieldMetadataUtil, EntityList } from '../entity/index';
// tslint:disable: no-bitwise
/**
 * 实体集合
 * @todo：应该用EntityList代替。
 */
class EntityCollection {
    /**
     * 构造函数
     */
    constructor(entityType) {
        this.innerEntitySet = new Set();
        this.innerEntityMap = new Map();
        this.collectionChanged = new Subject();
        this.changes = new Subject();
        this.entityType = entityType;
        this.primaryKey = FieldMetadataUtil.getPrimaryKey(this.entityType) || entityType.prototype.primaryKey;
    }
    /**
     *变更策略
     */
    set changeSetPolicy(policy) {
        this._changeSetPolicy = policy;
    }
    get changeSetPolicy() {
        return this._changeSetPolicy;
    }
    /**
     * 实体数量
     */
    count() {
        return this.innerEntitySet.size;
    }
    get entityTypeName() {
        return this.entityType.name;
    }
    /**
     * 是否包含指定主键值的实体
     * @param id 主键值
     */
    has(id) {
        return this.innerEntityMap.has(id);
    }
    /**
     * 清空全部实体
     */
    clear() {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        this.notifyCollectionChanged(new Modification([], ModifyType.Load));
    }
    /**
     * 清空全部实体
     * @param isReset 是否为重置实体操作
     */
    reset(notify = true) {
        this.innerEntityMap.forEach(entity => {
            entity.unsubscribe.next();
            entity.unsubscribe.complete();
        });
        this.innerEntitySet.forEach(entity => {
            entity.unsubscribe.next();
            entity.unsubscribe.complete();
        });
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        if (notify === true) {
            const modification = new Modification([], ModifyType.Load);
            modification.isReset = true;
            this.notifyCollectionChanged(modification);
        }
    }
    /**
     * 转换为实体数组
     */
    toArray() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 转换为JSON数组
     */
    toJSON() {
        const result = [];
        const entities = this.toArray();
        entities.forEach((entity) => {
            result.push(entity.toJSON());
        });
        return result;
    }
    /**
     * 批量加载实体
     */
    loadEntities(entities, entityCreate = false) {
        this.innerEntityMap.clear();
        this.innerEntitySet.clear();
        entities.forEach(entity => {
            this.extendChangeSetPolicyProperty(entity);
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        const modification = new Modification(entities, ModifyType.Load);
        modification.entityCreate = entityCreate;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 追加实体
     * @param entity 要追加的实体
     * @param isCloned 实体是否是克隆的
     */
    addEntity(entity, isCloned = false) {
        this.verifyEntityToAdd(entity);
        this.extendChangeSetPolicyProperty(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        const modifyType = isCloned ? ModifyType.Clone : ModifyType.Add;
        this.notifyCollectionChanged(new Modification([entity], modifyType));
    }
    /**
     * 在当前行前或后插入数据
     * @param entity 实体
     * @param position 位置
     */
    insertEntity(entity, position) {
        this.verifyEntityToAdd(entity);
        this.extendChangeSetPolicyProperty(entity);
        this.innerEntitySet.add(entity);
        this.innerEntityMap.set(entity[this.primaryKey], entity);
        this.listenEntityChangeEvent(entity);
        this.notifyCollectionChanged(new Modification(entity, ModifyType.Insert, null, null, position));
    }
    /**
     * 更新实体
     * @param entity entity
     * @param data 实体数据
     */
    updateEntity(entity, data) {
        entity.load(data);
        this.notifyCollectionChanged(new Modification(data, ModifyType.Update, null, null));
    }
    /**
     * 批量追加实体
     * @param entities 要加载的实体数组
     */
    addEntities(entities, options = null) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.extendChangeSetPolicyProperty(entity);
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        const isTreeNodeLoadScene = options && options.isTreeNodeLoadScene || false;
        const modification = new Modification(entitiesToAdd, ModifyType.Add);
        modification.isTreeNodeLoadScene = isTreeNodeLoadScene;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 添加实体（不切换当前行）
     * @param entities 实体
     */
    addData(entities, options = null) {
        if (!entities) {
            return;
        }
        const entitiesToAdd = [];
        entities.forEach(entity => {
            this.verifyEntityToAdd(entity);
            entitiesToAdd.push(entity);
        });
        entitiesToAdd.forEach(entity => {
            this.extendChangeSetPolicyProperty(entity);
            this.innerEntitySet.add(entity);
            this.innerEntityMap.set(entity[this.primaryKey], entity);
            this.listenEntityChangeEvent(entity);
        });
        // 针对树分层加载场景
        const isTreeNodeLoadScene = options && options.isTreeNodeLoadScene || false;
        const modification = new Modification(entitiesToAdd, ModifyType.AddData);
        modification.isTreeNodeLoadScene = isTreeNodeLoadScene;
        this.notifyCollectionChanged(modification);
    }
    /**
     * 为实体扩展变更策略属性
     * @param entity
     */
    extendChangeSetPolicyProperty(entity) {
        if (entity) {
            entity.changeSetPolicy = this.changeSetPolicy;
        }
    }
    /**
     * 根据主键值获取实体
     */
    getEntityById(identity) {
        if (this.innerEntityMap.has(identity) === false) {
            return null;
        }
        const entity = this.innerEntityMap.get(identity);
        return entity;
    }
    /**
     * 根据路径获取实体
     */
    getEntityByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let parentNode = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && parentNode; i = i + 1) {
            const currentPath = pathArray[i];
            if ((parentNode instanceof Entity) || (parentNode.typeName === 'ConcreteEntityPrototype')) {
                // @todo：强识了别冒号
                if (currentPath.indexOf(':') === -1) {
                    parentNode = parentNode[pathArray[i]];
                }
            }
            else {
                parentNode = parentNode.get(pathArray[i].split(':')[1]);
            }
        }
        return parentNode;
    }
    /**
     * id:1/a/id:2/c
     * @param pathArray 路径数组
     */
    getEntitiesByPath(pathArray) {
        const rootEntityId = pathArray[0].split(':')[1];
        let entity = this.getEntityById(rootEntityId);
        for (let i = 1; i < pathArray.length && entity; i += 2) {
            const path = pathArray[i];
            entity = entity[path];
            if (!(entity instanceof EntityList)) {
                throw new Error('路径格式错误');
            }
            if ((i + 1) < pathArray.length) {
                const id = pathArray[i + 1].split(':')[1];
                entity = entity.get(id);
            }
        }
        return entity;
    }
    /**
     * 返回符合指定条件的实体集合
     * @param predicate 条件谓词
     */
    getEntities(predicate) {
        const entities = Array.from(this.innerEntitySet);
        const matchedEntities = entities.filter(predicate);
        return matchedEntities;
    }
    /**
     * 获取全部实体
     */
    getAllEntities() {
        return Array.from(this.innerEntitySet);
    }
    /**
     * 根据主键值删除对应实体
     * @param identity 主键值
     */
    removeEntityById(identity) {
        this.verifyEntityToRemove(identity);
        const entityToRemove = this.innerEntityMap.get(identity);
        this.innerEntityMap.delete(identity);
        this.innerEntitySet.delete(entityToRemove);
        this.notifyCollectionChanged(new Modification([entityToRemove], ModifyType.Remove));
        return entityToRemove;
    }
    removeEntitiesByIds(id) {
    }
    /**
     * 删除符合条件的实体集合
     */
    removeEntities(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.Remove));
        return entitiesToRemove;
    }
    /**
     * 移除数据（不切换当前行）
     * @param predicate 过滤函数
     */
    removeData(predicate) {
        const entitiesToRemove = Array.from(this.innerEntitySet).filter(predicate);
        entitiesToRemove.forEach(entityToRemove => {
            this.innerEntityMap.delete(entityToRemove[this.primaryKey]);
            this.innerEntitySet.delete(entityToRemove);
        });
        this.notifyCollectionChanged(new Modification(entitiesToRemove, ModifyType.RemoveData));
        return entitiesToRemove;
    }
    /**
     * 重置子表数据
     * @param paths 路径
     * 路径格式 ['id:provinceId','id:cityMDMs','zoneMDMs']
     * @description path参数格式
     * ```json
     * [
     * "id:b5ed23ca-88d9-4377-98ec-92f35c1325f1",
     * "cityMDMs",
     * "id:373706af-622f-4aea-a006-dddbffd7bda3",
     * "zoneMDMs"
     * ]
     * ```
     * @param entities 实体数组
     */
    resetEntities(paths, entities) {
        if (paths[0].indexOf(':') === -1) {
            throw new Error('路径格式错误');
        }
        // 获取主实体
        const id = paths[0].split(':')[1];
        let entity = this.innerEntityMap.get(id);
        let entityList = entity[paths[1]];
        if (!entity) {
            throw new Error(`找不到主键为${id}的实体`);
        }
        for (let index = 2; index < paths.length; index += 2) {
            const pathInfo = paths[index].split(':');
            const entityId = pathInfo[1];
            // 获取到当前层级的实体
            entity = entityList.get(entityId);
            if (!entity) {
                throw new Error(`找不到主键为${id}的实体`);
            }
            // 获取当前层级实体下的列表属性
            entityList = entity[paths[index + 1]];
        }
        entityList.clear();
        entityList.loadEntities(entities);
    }
    /**
     * 验证实体是否能够添加
     */
    verifyEntityToAdd(entity) {
        if (this.has(entity[this.primaryKey])) {
            throw new Error(`The repository already had an item with the save identity of '${entity[this.primaryKey]}'`);
        }
        return true;
    }
    /**
     * 验证实体是否能移除
     */
    verifyEntityToRemove(identity) {
        if (!this.has(identity)) {
            throw new Error(`The entity with identity of '${identity} dose not exsit.'`);
        }
        return true;
    }
    /**
     * 实体集合变更流
     */
    notifyCollectionChanged(modification) {
        this.collectionChanged.next(modification);
    }
    listenEntityChangeEvent(entity) {
        if (entity) {
            entity.onValueChanged.subscribe((change) => this.changes.next(change));
        }
    }
    //#region 分页
    /**
     * 设置分页大小
     */
    set pageSize(pageSize) {
        if (typeof (pageSize) !== 'number' || pageSize < 0) {
            throw new Error('Invalid parameter:pageSize');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageSize });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        // this.notifyCollectionChanged(new Modification(this.paginationInfo[this.entityTypeName], ModifyType.PaginationInfoChange));
        this.paginationInfo = Object.assign({}, original, { pageSize });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取分页大小
     * @description 如果用户未指定分页大小则默认为0，即获取所有数据
     */
    get pageSize() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageSize || 0;
        }
        return 0;
    }
    /**
     * 设置数据总条数
     */
    set totalCount(total) {
        if (typeof (total) !== 'number' || total < 0) {
            throw new Error('Invalid parameter:total');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { total });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { total });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取数据总条数
     */
    get totalCount() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.total || 0;
        }
        return 0;
    }
    /**
     * 设置当前页码
     */
    set pageIndex(pageIndex) {
        if (typeof (pageIndex) !== 'number' || pageIndex < 0) {
            throw new Error('Invalid parameter:pageIndex');
        }
        const original = this.paginationInfo;
        // const entityPaginationInfo = Object.assign({}, original[this.entityTypeName], { pageIndex });
        // this.paginationInfo = Object.assign({}, original, { [this.entityTypeName]: entityPaginationInfo });
        this.paginationInfo = Object.assign({}, original, { pageIndex });
        this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
    }
    /**
     * 获取当前页码
     */
    get pageIndex() {
        if (!!this.paginationInfo) {
            return this.paginationInfo.pageIndex || 1;
        }
        return 1;
    }
    /**
     * 更新分页信息
     * @param path 绑定路径
     * @param pageInfo 分页信息
     */
    updatePaginationInfoByPath(path, pageInfo) {
        const original = this.paginationInfo;
        const { pageIndex, pageSize } = pageInfo;
        const total = pageInfo && (pageInfo.totalCount || pageInfo.total) || 0;
        const paginationInfo = Object.assign({}, original, { pageIndex, pageSize, total });
        this.setPaginationConfigByPath(path, paginationInfo);
    }
    /**
     * 根据路径获取分页大小
     * @param path 路径
     */
    getPaginationConfigByPath(path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        const paths = path.split('/').filter(item => !!item && item.trim().length > 0).map(item => item.trim());
        let config = this.paginationInfo;
        paths.forEach(item => {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    }
    /**
     * 设置分页信息
     * @param path 路径
     * @param value 值，其中总条数key为total
     */
    setPaginationConfigByPath(path, value) {
        const original = JSON.stringify(this.paginationInfo);
        if (!path || path === '/') {
            this.paginationInfo = value;
        }
        else {
            if (!Array.isArray(path)) {
                path = path.toString().match(/[^/[\]]+/g) || [];
            }
            path.slice(0, -1).reduce((prev, current, index) => Object(prev[current]) === prev[current]
                ? prev[current]
                : prev[current] = Math.abs(path[index + 1]) >> 0 === +path[index + 1]
                    ? []
                    : {}, this.paginationInfo)[path[path.length - 1]] = value;
        }
        if (JSON.stringify(this.paginationInfo) !== original) {
            this.notifyCollectionChanged(new Modification(this.paginationInfo, ModifyType.PaginationInfoChange));
        }
        return this.paginationInfo;
    }
}
export { EntityCollection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2NvbGxlY3Rpb24uanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L2VudGl0eV9jb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDOUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXhFLDZCQUE2QjtBQUM3Qjs7O0dBR0c7QUFDSCxNQUFNLGdCQUFnQjtJQThDcEI7O09BRUc7SUFDSCxZQUFZLFVBQWU7UUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLEdBQUcsRUFBSyxDQUFDO1FBQ25DLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxPQUFPLEVBQWdCLENBQUM7UUFDckQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBZ0IsQ0FBQztRQUMzQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7SUFDeEcsQ0FBQztJQTlDRDs7T0FFRztJQUNILElBQVcsZUFBZSxDQUFDLE1BQXVCO1FBQ2hELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxNQUFNLENBQUM7SUFDakMsQ0FBQztJQUNELElBQVcsZUFBZTtRQUN4QixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztJQUMvQixDQUFDO0lBd0NEOztPQUVHO0lBQ0ksS0FBSztRQUNWLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7SUFDbEMsQ0FBQztJQUVELElBQVcsY0FBYztRQUN2QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO0lBQzlCLENBQUM7SUFDRDs7O09BR0c7SUFDSSxHQUFHLENBQUMsRUFBVTtRQUNuQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNJLEtBQUs7UUFDVixJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksWUFBWSxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksS0FBSyxDQUFDLFNBQWtCLElBQUk7UUFDakMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbkMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUMxQixNQUFNLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbkMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUMxQixNQUFNLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzVCLElBQUksTUFBTSxLQUFLLElBQUksRUFBRTtZQUNuQixNQUFNLFlBQVksR0FBRyxJQUFJLFlBQVksQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNELFlBQVksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQzVCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUM1QztJQUNILENBQUM7SUFDRDs7T0FFRztJQUNJLE9BQU87UUFDWixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU07UUFDWCxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDbEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2hDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFjLEVBQUUsRUFBRTtZQUNsQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksWUFBWSxDQUFDLFFBQWUsRUFBRSxlQUF3QixLQUFLO1FBQ2hFLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU1QixRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3hCLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3pELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakUsWUFBWSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDekMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTdDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksU0FBUyxDQUFDLE1BQVcsRUFBRSxXQUFvQixLQUFLO1FBQ3JELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsNkJBQTZCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckMsTUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDO1FBQ2hFLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDdkUsQ0FBQztJQUNEOzs7O09BSUc7SUFDSSxZQUFZLENBQUMsTUFBVyxFQUFFLFFBQWdCO1FBQy9DLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsNkJBQTZCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksWUFBWSxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNsRyxDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNJLFlBQVksQ0FBQyxNQUFXLEVBQUUsSUFBUztRQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN0RixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksV0FBVyxDQUFDLFFBQWUsRUFBRSxVQUFlLElBQUk7UUFDckQsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNiLE9BQU87U0FDUjtRQUNELE1BQU0sYUFBYSxHQUFVLEVBQUUsQ0FBQztRQUNoQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3hCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMvQixhQUFhLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUM3QixJQUFJLENBQUMsNkJBQTZCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLG1CQUFtQixHQUFHLE9BQU8sSUFBSSxPQUFPLENBQUMsbUJBQW1CLElBQUksS0FBSyxDQUFDO1FBQzVFLE1BQU0sWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckUsWUFBWSxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO1FBQ3ZELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksT0FBTyxDQUFDLFFBQWUsRUFBRSxVQUFlLElBQUk7UUFDakQsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNiLE9BQU87U0FDUjtRQUNELE1BQU0sYUFBYSxHQUFVLEVBQUUsQ0FBQztRQUNoQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ3hCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMvQixhQUFhLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO1FBQ0gsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUM3QixJQUFJLENBQUMsNkJBQTZCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFDSCxZQUFZO1FBQ1osTUFBTSxtQkFBbUIsR0FBRyxPQUFPLElBQUksT0FBTyxDQUFDLG1CQUFtQixJQUFJLEtBQUssQ0FBQztRQUM1RSxNQUFNLFlBQVksR0FBRyxJQUFJLFlBQVksQ0FBQyxhQUFhLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3pFLFlBQVksQ0FBQyxtQkFBbUIsR0FBRyxtQkFBbUIsQ0FBQztRQUN2RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUNEOzs7T0FHRztJQUNLLDZCQUE2QixDQUFDLE1BQVc7UUFDL0MsSUFBSSxNQUFNLEVBQUU7WUFDVixNQUFNLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7U0FDL0M7SUFDSCxDQUFDO0lBQ0Q7O09BRUc7SUFDSCxhQUFhLENBQUMsUUFBZ0I7UUFDNUIsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxLQUFLLEVBQUU7WUFDL0MsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNILGVBQWUsQ0FBQyxTQUFtQjtRQUNqQyxNQUFNLFlBQVksR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hELElBQUksVUFBVSxHQUFRLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdkQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLElBQUksVUFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzdELE1BQU0sV0FBVyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxJQUFJLENBQUMsVUFBVSxZQUFZLE1BQU0sQ0FBQyxJQUFJLENBQ3BDLFVBQVUsQ0FBQyxRQUFRLEtBQUsseUJBQXlCLENBQUMsRUFDbEQ7Z0JBQ0EsZUFBZTtnQkFDZixJQUFJLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7b0JBQ25DLFVBQVUsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3ZDO2FBQ0Y7aUJBQU07Z0JBQ0wsVUFBVSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3pEO1NBQ0Y7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksaUJBQWlCLENBQUMsU0FBbUI7UUFDMUMsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRCxJQUFJLE1BQU0sR0FBUSxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ25ELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxJQUFJLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RELE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxDQUFDLE1BQU0sWUFBWSxVQUFVLENBQUMsRUFBRTtnQkFDbkMsTUFBTSxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUMzQjtZQUNELElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRTtnQkFDOUIsTUFBTSxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQ3pCO1NBQ0Y7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0gsV0FBVyxDQUFDLFNBQTJEO1FBQ3JFLE1BQU0sUUFBUSxHQUFVLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3hELE1BQU0sZUFBZSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkQsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsY0FBYztRQUNaLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVEOzs7T0FHRztJQUNILGdCQUFnQixDQUFDLFFBQWdCO1FBQy9CLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwQyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxZQUFZLENBQUMsQ0FBQyxjQUFjLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNwRixPQUFPLGNBQWMsQ0FBQztJQUN4QixDQUFDO0lBRUQsbUJBQW1CLENBQUMsRUFBVTtJQUM5QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxjQUFjLENBQUMsU0FBMkQ7UUFDL0UsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDM0UsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUM1RCxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNwRixPQUFPLGdCQUFnQixDQUFDO0lBQzFCLENBQUM7SUFDRDs7O09BR0c7SUFDSSxVQUFVLENBQUMsU0FBMkQ7UUFDM0UsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDM0UsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUM1RCxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUN4RixPQUFPLGdCQUFnQixDQUFDO0lBQzFCLENBQUM7SUFDRDs7Ozs7Ozs7Ozs7Ozs7T0FjRztJQUNJLGFBQWEsQ0FBQyxLQUFlLEVBQUUsUUFBZTtRQUNuRCxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDaEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUMzQjtRQUNELFFBQVE7UUFDUixNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksTUFBTSxHQUFRLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzlDLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQW9CLENBQUM7UUFDckQsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQ25DO1FBQ0QsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRTtZQUNwRCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QixhQUFhO1lBQ2IsTUFBTSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDWCxNQUFNLElBQUksS0FBSyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQzthQUNuQztZQUNELGlCQUFpQjtZQUNqQixVQUFVLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN2QztRQUNELFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNuQixVQUFVLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRDs7T0FFRztJQUNLLGlCQUFpQixDQUFDLE1BQVc7UUFDbkMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRTtZQUNyQyxNQUFNLElBQUksS0FBSyxDQUFDLGlFQUFpRSxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUM5RztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOztPQUVHO0lBQ0ssb0JBQW9CLENBQUMsUUFBZ0I7UUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDdkIsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsUUFBUSxtQkFBbUIsQ0FBQyxDQUFDO1NBQzlFO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7SUFDSyx1QkFBdUIsQ0FBQyxZQUEwQjtRQUN4RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFDTyx1QkFBdUIsQ0FBQyxNQUFjO1FBQzVDLElBQUksTUFBTSxFQUFFO1lBQ1YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFvQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1NBQ3RGO0lBQ0gsQ0FBQztJQUVELFlBQVk7SUFFWjs7T0FFRztJQUNILElBQUksUUFBUSxDQUFDLFFBQWdCO1FBQzNCLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLFFBQVEsSUFBSSxRQUFRLEdBQUcsQ0FBQyxFQUFFO1lBQ2xELE1BQU0sSUFBSSxLQUFLLENBQUMsNEJBQTRCLENBQUMsQ0FBQztTQUMvQztRQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDckMsK0ZBQStGO1FBQy9GLHNHQUFzRztRQUN0Ryw2SEFBNkg7UUFDN0gsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7SUFDdkcsQ0FBQztJQUNEOzs7T0FHRztJQUNILElBQUksUUFBUTtRQUNWLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUM7U0FDMUM7UUFDRCxPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7SUFDRDs7T0FFRztJQUNILElBQUksVUFBVSxDQUFDLEtBQWE7UUFDMUIsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssUUFBUSxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDNUMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1NBQzVDO1FBRUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUNyQyw0RkFBNEY7UUFDNUYsc0dBQXNHO1FBQ3RHLElBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUM3RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxVQUFVLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0lBQ3ZHLENBQUM7SUFDRDs7T0FFRztJQUNILElBQUksVUFBVTtRQUNaLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7U0FDdkM7UUFDRCxPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7SUFDRDs7T0FFRztJQUNILElBQUksU0FBUyxDQUFDLFNBQWlCO1FBQzdCLElBQUksT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLFFBQVEsSUFBSSxTQUFTLEdBQUcsQ0FBQyxFQUFFO1lBQ3BELE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztTQUNoRDtRQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDckMsZ0dBQWdHO1FBQ2hHLHNHQUFzRztRQUN0RyxJQUFJLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztJQUN2RyxDQUFDO0lBQ0Q7O09BRUc7SUFDSCxJQUFJLFNBQVM7UUFDWCxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ3pCLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDO1NBQzNDO1FBQ0QsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNJLDBCQUEwQixDQUFDLElBQVksRUFBRSxRQUFpRjtRQUMvSCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQ3JDLE1BQU0sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEdBQUcsUUFBUSxDQUFDO1FBQ3pDLE1BQU0sS0FBSyxHQUFHLFFBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2RSxNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDbkYsSUFBSSxDQUFDLHlCQUF5QixDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0kseUJBQXlCLENBQUMsSUFBWSxFQUFFLFlBQWtCO1FBQy9ELElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxLQUFLLEdBQUcsRUFBRTtZQUN6QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7U0FDNUI7UUFDRCxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRTtZQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQzlCO1FBQ0QsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFDeEcsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUNqQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ25CLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ3pDLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDdkI7aUJBQU07Z0JBQ0wsTUFBTSxHQUFHLElBQUksQ0FBQzthQUNmO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxZQUFZLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUM1RixDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNJLHlCQUF5QixDQUFDLElBQXlCLEVBQUUsS0FBVTtRQUNwRSxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksS0FBSyxHQUFHLEVBQUU7WUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7U0FDN0I7YUFBTTtZQUNMLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUN4QixJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDakQ7WUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FDaEQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ3JDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNmLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7b0JBQ25FLENBQUMsQ0FBQyxFQUFFO29CQUNKLENBQUMsQ0FBQyxFQUFFLEVBQ1IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBQ3ZEO1FBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxRQUFRLEVBQUU7WUFDcEQsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztTQUN0RztRQUNELE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUM3QixDQUFDO0NBRUY7QUFFRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTgtMTAtMDEgMTk6MzY6NTFcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOS0wOS0wMyAxOTo0Njo0MlxyXG4gKi9cclxuaW1wb3J0IHsgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNb2RpZmljYXRpb24sIE1vZGlmeVR5cGUgfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEVudGl0eSwgRmllbGRNZXRhZGF0YVV0aWwsIEVudGl0eUxpc3QgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xyXG5pbXBvcnQgeyBDaGFuZ2VTZXRQb2xpY3kgfSBmcm9tICcuLi9jb3JlJztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLWJpdHdpc2VcclxuLyoqXHJcbiAqIOWunuS9k+mbhuWQiFxyXG4gKiBAdG9kb++8muW6lOivpeeUqEVudGl0eUxpc3Tku6Pmm7/jgIJcclxuICovXHJcbmNsYXNzIEVudGl0eUNvbGxlY3Rpb248VCBleHRlbmRzIEVudGl0eT4ge1xyXG5cclxuICAvKipcclxuICAgKiDlhoXpg6jlrp7kvZNTZXRcclxuICAgKi9cclxuICBwcml2YXRlIGlubmVyRW50aXR5U2V0OiBTZXQ8VD47XHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu05o+Q5Lqk562W55WlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY2hhbmdlU2V0UG9saWN5OiBDaGFuZ2VTZXRQb2xpY3k7XHJcbiAgLyoqXHJcbiAgICrlj5jmm7TnrZbnlaUgXHJcbiAgICovXHJcbiAgcHVibGljIHNldCBjaGFuZ2VTZXRQb2xpY3kocG9saWN5OiBDaGFuZ2VTZXRQb2xpY3kpIHtcclxuICAgIHRoaXMuX2NoYW5nZVNldFBvbGljeSA9IHBvbGljeTtcclxuICB9XHJcbiAgcHVibGljIGdldCBjaGFuZ2VTZXRQb2xpY3koKTogQ2hhbmdlU2V0UG9saWN5IHtcclxuICAgIHJldHVybiB0aGlzLl9jaGFuZ2VTZXRQb2xpY3k7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWGhemDqOWunuS9k01hcFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJFbnRpdHlNYXA6IE1hcDxzdHJpbmcsIFQ+O1xyXG4gIHB1YmxpYyBjaGFuZ2VzOiBTdWJqZWN0PE1vZGlmaWNhdGlvbj47XHJcblxyXG4gIC8qKlxyXG4gICAqIEVudGl0eembhuWQiOWPmOabtOa1gVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb2xsZWN0aW9uQ2hhbmdlZDogU3ViamVjdDxNb2RpZmljYXRpb24+O1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgcmVhZG9ubHkgZW50aXR5VHlwZTogVHlwZTxUPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Li76ZSuXHJcbiAgICovXHJcbiAgcHVibGljIHJlYWRvbmx5IHByaW1hcnlLZXk6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5b2T5YmN5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHBhZ2luYXRpb25JbmZvOiBhbnk7XHJcblxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihlbnRpdHlUeXBlOiBhbnkpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQgPSBuZXcgU2V0PFQ+KCk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwID0gbmV3IE1hcDxzdHJpbmcsIFQ+KCk7XHJcbiAgICB0aGlzLmNvbGxlY3Rpb25DaGFuZ2VkID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgdGhpcy5lbnRpdHlUeXBlID0gZW50aXR5VHlwZTtcclxuICAgIHRoaXMucHJpbWFyeUtleSA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldFByaW1hcnlLZXkodGhpcy5lbnRpdHlUeXBlKSB8fCBlbnRpdHlUeXBlLnByb3RvdHlwZS5wcmltYXJ5S2V5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5pWw6YePXHJcbiAgICovXHJcbiAgcHVibGljIGNvdW50KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckVudGl0eVNldC5zaXplO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBlbnRpdHlUeXBlTmFtZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmVudGl0eVR5cGUubmFtZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5YyF5ZCr5oyH5a6a5Li76ZSu5YC855qE5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIOS4u+mUruWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXMoaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJFbnRpdHlNYXAuaGFzKGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhcigpIHtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuY2xlYXIoKTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbXSwgTW9kaWZ5VHlwZS5Mb2FkKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepuuWFqOmDqOWunuS9k1xyXG4gICAqIEBwYXJhbSBpc1Jlc2V0IOaYr+WQpuS4uumHjee9ruWunuS9k+aTjeS9nFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldChub3RpZnk6IGJvb2xlYW4gPSB0cnVlKSB7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmZvckVhY2goZW50aXR5ID0+IHtcclxuICAgICAgZW50aXR5LnVuc3Vic2NyaWJlLm5leHQoKTtcclxuICAgICAgZW50aXR5LnVuc3Vic2NyaWJlLmNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICBlbnRpdHkudW5zdWJzY3JpYmUubmV4dCgpO1xyXG4gICAgICBlbnRpdHkudW5zdWJzY3JpYmUuY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5jbGVhcigpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eVNldC5jbGVhcigpO1xyXG4gICAgaWYgKG5vdGlmeSA9PT0gdHJ1ZSkge1xyXG4gICAgICBjb25zdCBtb2RpZmljYXRpb24gPSBuZXcgTW9kaWZpY2F0aW9uKFtdLCBNb2RpZnlUeXBlLkxvYWQpO1xyXG4gICAgICBtb2RpZmljYXRpb24uaXNSZXNldCA9IHRydWU7XHJcbiAgICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobW9kaWZpY2F0aW9uKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li65a6e5L2T5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvQXJyYXkoKTogRW50aXR5W10ge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDovazmjaLkuLpKU09O5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHRvSlNPTigpOiBhbnlbXSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy50b0FycmF5KCk7XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICByZXN1bHQucHVzaChlbnRpdHkudG9KU09OKCkpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yqg6L295a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRFbnRpdGllcyhlbnRpdGllczogYW55W10sIGVudGl0eUNyZWF0ZTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLmNsZWFyKCk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmNsZWFyKCk7XHJcblxyXG4gICAgZW50aXRpZXMuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLmV4dGVuZENoYW5nZVNldFBvbGljeVByb3BlcnR5KGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IG1vZGlmaWNhdGlvbiA9IG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXMsIE1vZGlmeVR5cGUuTG9hZCk7XHJcbiAgICBtb2RpZmljYXRpb24uZW50aXR5Q3JlYXRlID0gZW50aXR5Q3JlYXRlO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb24pO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOi/veWKoOWunuS9k1xyXG4gICAqIEBwYXJhbSBlbnRpdHkg6KaB6L+95Yqg55qE5a6e5L2TXHJcbiAgICogQHBhcmFtIGlzQ2xvbmVkIOWunuS9k+aYr+WQpuaYr+WFi+mahueahFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRFbnRpdHkoZW50aXR5OiBhbnksIGlzQ2xvbmVkOiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgIHRoaXMuZXh0ZW5kQ2hhbmdlU2V0UG9saWN5UHJvcGVydHkoZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5TWFwLnNldChlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XSwgZW50aXR5KTtcclxuICAgIHRoaXMubGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5KTtcclxuICAgIGNvbnN0IG1vZGlmeVR5cGUgPSBpc0Nsb25lZCA/IE1vZGlmeVR5cGUuQ2xvbmUgOiBNb2RpZnlUeXBlLkFkZDtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbZW50aXR5XSwgbW9kaWZ5VHlwZSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlnKjlvZPliY3ooYzliY3miJblkI7mj5LlhaXmlbDmja5cclxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k1xyXG4gICAqIEBwYXJhbSBwb3NpdGlvbiDkvY3nva5cclxuICAgKi9cclxuICBwdWJsaWMgaW5zZXJ0RW50aXR5KGVudGl0eTogYW55LCBwb3NpdGlvbjogMSB8IC0xKSB7XHJcbiAgICB0aGlzLnZlcmlmeUVudGl0eVRvQWRkKGVudGl0eSk7XHJcbiAgICB0aGlzLmV4dGVuZENoYW5nZVNldFBvbGljeVByb3BlcnR5KGVudGl0eSk7XHJcbiAgICB0aGlzLmlubmVyRW50aXR5U2V0LmFkZChlbnRpdHkpO1xyXG4gICAgdGhpcy5pbm5lckVudGl0eU1hcC5zZXQoZW50aXR5W3RoaXMucHJpbWFyeUtleV0sIGVudGl0eSk7XHJcbiAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24oZW50aXR5LCBNb2RpZnlUeXBlLkluc2VydCwgbnVsbCwgbnVsbCwgcG9zaXRpb24pKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5a6e5L2TXHJcbiAgICogQHBhcmFtIGVudGl0eSBlbnRpdHlcclxuICAgKiBAcGFyYW0gZGF0YSDlrp7kvZPmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlRW50aXR5KGVudGl0eTogYW55LCBkYXRhOiBhbnkpIHtcclxuICAgIGVudGl0eS5sb2FkKGRhdGEpO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChuZXcgTW9kaWZpY2F0aW9uKGRhdGEsIE1vZGlmeVR5cGUuVXBkYXRlLCBudWxsLCBudWxsKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+i/veWKoOWunuS9k1xyXG4gICAqIEBwYXJhbSBlbnRpdGllcyDopoHliqDovb3nmoTlrp7kvZPmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYWRkRW50aXRpZXMoZW50aXRpZXM6IGFueVtdLCBvcHRpb25zOiBhbnkgPSBudWxsKSB7XHJcbiAgICBpZiAoIWVudGl0aWVzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0aWVzVG9BZGQ6IGFueVtdID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgICAgZW50aXRpZXNUb0FkZC5wdXNoKGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGVudGl0aWVzVG9BZGQuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLmV4dGVuZENoYW5nZVNldFBvbGljeVByb3BlcnR5KGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGlzVHJlZU5vZGVMb2FkU2NlbmUgPSBvcHRpb25zICYmIG9wdGlvbnMuaXNUcmVlTm9kZUxvYWRTY2VuZSB8fCBmYWxzZTtcclxuICAgIGNvbnN0IG1vZGlmaWNhdGlvbiA9IG5ldyBNb2RpZmljYXRpb24oZW50aXRpZXNUb0FkZCwgTW9kaWZ5VHlwZS5BZGQpO1xyXG4gICAgbW9kaWZpY2F0aW9uLmlzVHJlZU5vZGVMb2FkU2NlbmUgPSBpc1RyZWVOb2RlTG9hZFNjZW5lO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb24pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmt7vliqDlrp7kvZPvvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gZW50aXRpZXMg5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGFkZERhdGEoZW50aXRpZXM6IGFueVtdLCBvcHRpb25zOiBhbnkgPSBudWxsKSB7XHJcbiAgICBpZiAoIWVudGl0aWVzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0aWVzVG9BZGQ6IGFueVtdID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKGVudGl0eSA9PiB7XHJcbiAgICAgIHRoaXMudmVyaWZ5RW50aXR5VG9BZGQoZW50aXR5KTtcclxuICAgICAgZW50aXRpZXNUb0FkZC5wdXNoKGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIGVudGl0aWVzVG9BZGQuZm9yRWFjaChlbnRpdHkgPT4ge1xyXG4gICAgICB0aGlzLmV4dGVuZENoYW5nZVNldFBvbGljeVByb3BlcnR5KGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuYWRkKGVudGl0eSk7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuc2V0KGVudGl0eVt0aGlzLnByaW1hcnlLZXldLCBlbnRpdHkpO1xyXG4gICAgICB0aGlzLmxpc3RlbkVudGl0eUNoYW5nZUV2ZW50KGVudGl0eSk7XHJcbiAgICB9KTtcclxuICAgIC8vIOmSiOWvueagkeWIhuWxguWKoOi9veWcuuaZr1xyXG4gICAgY29uc3QgaXNUcmVlTm9kZUxvYWRTY2VuZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5pc1RyZWVOb2RlTG9hZFNjZW5lIHx8IGZhbHNlO1xyXG4gICAgY29uc3QgbW9kaWZpY2F0aW9uID0gbmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvQWRkLCBNb2RpZnlUeXBlLkFkZERhdGEpO1xyXG4gICAgbW9kaWZpY2F0aW9uLmlzVHJlZU5vZGVMb2FkU2NlbmUgPSBpc1RyZWVOb2RlTG9hZFNjZW5lO1xyXG4gICAgdGhpcy5ub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb24pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkuLrlrp7kvZPmianlsZXlj5jmm7TnrZbnlaXlsZ7mgKdcclxuICAgKiBAcGFyYW0gZW50aXR5IFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZXh0ZW5kQ2hhbmdlU2V0UG9saWN5UHJvcGVydHkoZW50aXR5OiBhbnkpe1xyXG4gICAgaWYgKGVudGl0eSkge1xyXG4gICAgICBlbnRpdHkuY2hhbmdlU2V0UG9saWN5ID0gdGhpcy5jaGFuZ2VTZXRQb2xpY3k7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNruS4u+mUruWAvOiOt+WPluWunuS9k1xyXG4gICAqL1xyXG4gIGdldEVudGl0eUJ5SWQoaWRlbnRpdHk6IHN0cmluZyk6IGFueSB7XHJcbiAgICBpZiAodGhpcy5pbm5lckVudGl0eU1hcC5oYXMoaWRlbnRpdHkpID09PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuaW5uZXJFbnRpdHlNYXAuZ2V0KGlkZW50aXR5KTtcclxuICAgIHJldHVybiBlbnRpdHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7ot6/lvoTojrflj5blrp7kvZNcclxuICAgKi9cclxuICBnZXRFbnRpdHlCeVBhdGgocGF0aEFycmF5OiBzdHJpbmdbXSk6IGFueSB7XHJcbiAgICBjb25zdCByb290RW50aXR5SWQgPSBwYXRoQXJyYXlbMF0uc3BsaXQoJzonKVsxXTtcclxuICAgIGxldCBwYXJlbnROb2RlOiBhbnkgPSB0aGlzLmdldEVudGl0eUJ5SWQocm9vdEVudGl0eUlkKTtcclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGF0aEFycmF5Lmxlbmd0aCAmJiBwYXJlbnROb2RlOyBpID0gaSArIDEpIHtcclxuICAgICAgY29uc3QgY3VycmVudFBhdGggPSBwYXRoQXJyYXlbaV07XHJcbiAgICAgIGlmICgocGFyZW50Tm9kZSBpbnN0YW5jZW9mIEVudGl0eSkgfHwgKFxyXG4gICAgICAgIHBhcmVudE5vZGUudHlwZU5hbWUgPT09ICdDb25jcmV0ZUVudGl0eVByb3RvdHlwZScpXHJcbiAgICAgICkge1xyXG4gICAgICAgIC8vIEB0b2Rv77ya5by66K+G5LqG5Yir5YaS5Y+3XHJcbiAgICAgICAgaWYgKGN1cnJlbnRQYXRoLmluZGV4T2YoJzonKSA9PT0gLTEpIHtcclxuICAgICAgICAgIHBhcmVudE5vZGUgPSBwYXJlbnROb2RlW3BhdGhBcnJheVtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLmdldChwYXRoQXJyYXlbaV0uc3BsaXQoJzonKVsxXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBwYXJlbnROb2RlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBpZDoxL2EvaWQ6Mi9jXHJcbiAgICogQHBhcmFtIHBhdGhBcnJheSDot6/lvoTmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RW50aXRpZXNCeVBhdGgocGF0aEFycmF5OiBzdHJpbmdbXSkge1xyXG4gICAgY29uc3Qgcm9vdEVudGl0eUlkID0gcGF0aEFycmF5WzBdLnNwbGl0KCc6JylbMV07XHJcbiAgICBsZXQgZW50aXR5OiBhbnkgPSB0aGlzLmdldEVudGl0eUJ5SWQocm9vdEVudGl0eUlkKTtcclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcGF0aEFycmF5Lmxlbmd0aCAmJiBlbnRpdHk7IGkgKz0gMikge1xyXG4gICAgICBjb25zdCBwYXRoID0gcGF0aEFycmF5W2ldO1xyXG4gICAgICBlbnRpdHkgPSBlbnRpdHlbcGF0aF07XHJcbiAgICAgIGlmICghKGVudGl0eSBpbnN0YW5jZW9mIEVudGl0eUxpc3QpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfot6/lvoTmoLzlvI/plJnor68nKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoKGkgKyAxKSA8IHBhdGhBcnJheS5sZW5ndGgpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHBhdGhBcnJheVtpICsgMV0uc3BsaXQoJzonKVsxXTtcclxuICAgICAgICBlbnRpdHkgPSBlbnRpdHkuZ2V0KGlkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVudGl0eTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L+U5Zue56ym5ZCI5oyH5a6a5p2h5Lu255qE5a6e5L2T6ZuG5ZCIXHJcbiAgICogQHBhcmFtIHByZWRpY2F0ZSDmnaHku7bosJPor41cclxuICAgKi9cclxuICBnZXRFbnRpdGllcyhwcmVkaWNhdGU6ICh2YWx1ZTogYW55LCBpbmRleDogbnVtYmVyLCBhcnJheTogYW55W10pID0+IGFueSk6IGFueVtdIHtcclxuICAgIGNvbnN0IGVudGl0aWVzOiBhbnlbXSA9IEFycmF5LmZyb20odGhpcy5pbm5lckVudGl0eVNldCk7XHJcbiAgICBjb25zdCBtYXRjaGVkRW50aXRpZXMgPSBlbnRpdGllcy5maWx0ZXIocHJlZGljYXRlKTtcclxuICAgIHJldHVybiBtYXRjaGVkRW50aXRpZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blhajpg6jlrp7kvZNcclxuICAgKi9cclxuICBnZXRBbGxFbnRpdGllcygpOiBhbnlbXSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruS4u+mUruWAvOWIoOmZpOWvueW6lOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZGVudGl0eSDkuLvplK7lgLxcclxuICAgKi9cclxuICByZW1vdmVFbnRpdHlCeUlkKGlkZW50aXR5OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgdGhpcy52ZXJpZnlFbnRpdHlUb1JlbW92ZShpZGVudGl0eSk7XHJcbiAgICBjb25zdCBlbnRpdHlUb1JlbW92ZSA9IHRoaXMuaW5uZXJFbnRpdHlNYXAuZ2V0KGlkZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGlkZW50aXR5KTtcclxuICAgIHRoaXMuaW5uZXJFbnRpdHlTZXQuZGVsZXRlKGVudGl0eVRvUmVtb3ZlKTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihbZW50aXR5VG9SZW1vdmVdLCBNb2RpZnlUeXBlLlJlbW92ZSkpO1xyXG4gICAgcmV0dXJuIGVudGl0eVRvUmVtb3ZlO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlRW50aXRpZXNCeUlkcyhpZDogc3RyaW5nKSB7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTnrKblkIjmnaHku7bnmoTlrp7kvZPpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlRW50aXRpZXMocHJlZGljYXRlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgYXJyYXk6IGFueVtdKSA9PiBhbnkpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBlbnRpdGllc1RvUmVtb3ZlID0gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KS5maWx0ZXIocHJlZGljYXRlKTtcclxuICAgIGVudGl0aWVzVG9SZW1vdmUuZm9yRWFjaChlbnRpdHlUb1JlbW92ZSA9PiB7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGVudGl0eVRvUmVtb3ZlW3RoaXMucHJpbWFyeUtleV0pO1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmRlbGV0ZShlbnRpdHlUb1JlbW92ZSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvUmVtb3ZlLCBNb2RpZnlUeXBlLlJlbW92ZSkpO1xyXG4gICAgcmV0dXJuIGVudGl0aWVzVG9SZW1vdmU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOenu+mZpOaVsOaNru+8iOS4jeWIh+aNouW9k+WJjeihjO+8iVxyXG4gICAqIEBwYXJhbSBwcmVkaWNhdGUg6L+H5ruk5Ye95pWwXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZURhdGEocHJlZGljYXRlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgYXJyYXk6IGFueVtdKSA9PiBhbnkpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBlbnRpdGllc1RvUmVtb3ZlID0gQXJyYXkuZnJvbSh0aGlzLmlubmVyRW50aXR5U2V0KS5maWx0ZXIocHJlZGljYXRlKTtcclxuICAgIGVudGl0aWVzVG9SZW1vdmUuZm9yRWFjaChlbnRpdHlUb1JlbW92ZSA9PiB7XHJcbiAgICAgIHRoaXMuaW5uZXJFbnRpdHlNYXAuZGVsZXRlKGVudGl0eVRvUmVtb3ZlW3RoaXMucHJpbWFyeUtleV0pO1xyXG4gICAgICB0aGlzLmlubmVyRW50aXR5U2V0LmRlbGV0ZShlbnRpdHlUb1JlbW92ZSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbihlbnRpdGllc1RvUmVtb3ZlLCBNb2RpZnlUeXBlLlJlbW92ZURhdGEpKTtcclxuICAgIHJldHVybiBlbnRpdGllc1RvUmVtb3ZlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDph43nva7lrZDooajmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aHMg6Lev5b6EXHJcbiAgICog6Lev5b6E5qC85byPIFsnaWQ6cHJvdmluY2VJZCcsJ2lkOmNpdHlNRE1zJywnem9uZU1ETXMnXVxyXG4gICAqIEBkZXNjcmlwdGlvbiBwYXRo5Y+C5pWw5qC85byPXHJcbiAgICogYGBganNvblxyXG4gICAqIFtcclxuICAgKiBcImlkOmI1ZWQyM2NhLTg4ZDktNDM3Ny05OGVjLTkyZjM1YzEzMjVmMVwiLFxyXG4gICAqIFwiY2l0eU1ETXNcIixcclxuICAgKiBcImlkOjM3MzcwNmFmLTYyMmYtNGFlYS1hMDA2LWRkZGJmZmQ3YmRhM1wiLFxyXG4gICAqIFwiem9uZU1ETXNcIlxyXG4gICAqIF1cclxuICAgKiBgYGBcclxuICAgKiBAcGFyYW0gZW50aXRpZXMg5a6e5L2T5pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0RW50aXRpZXMocGF0aHM6IHN0cmluZ1tdLCBlbnRpdGllczogYW55W10pIHtcclxuICAgIGlmIChwYXRoc1swXS5pbmRleE9mKCc6JykgPT09IC0xKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5qC85byP6ZSZ6K+vJyk7XHJcbiAgICB9XHJcbiAgICAvLyDojrflj5bkuLvlrp7kvZNcclxuICAgIGNvbnN0IGlkID0gcGF0aHNbMF0uc3BsaXQoJzonKVsxXTtcclxuICAgIGxldCBlbnRpdHk6IGFueSA9IHRoaXMuaW5uZXJFbnRpdHlNYXAuZ2V0KGlkKTtcclxuICAgIGxldCBlbnRpdHlMaXN0ID0gZW50aXR5W3BhdGhzWzFdXSBhcyBFbnRpdHlMaXN0PGFueT47XHJcbiAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOaJvuS4jeWIsOS4u+mUruS4uiR7aWR955qE5a6e5L2TYCk7XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBpbmRleCA9IDI7IGluZGV4IDwgcGF0aHMubGVuZ3RoOyBpbmRleCArPSAyKSB7XHJcbiAgICAgIGNvbnN0IHBhdGhJbmZvID0gcGF0aHNbaW5kZXhdLnNwbGl0KCc6Jyk7XHJcbiAgICAgIGNvbnN0IGVudGl0eUlkID0gcGF0aEluZm9bMV07XHJcbiAgICAgIC8vIOiOt+WPluWIsOW9k+WJjeWxgue6p+eahOWunuS9k1xyXG4gICAgICBlbnRpdHkgPSBlbnRpdHlMaXN0LmdldChlbnRpdHlJZCk7XHJcbiAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDmib7kuI3liLDkuLvplK7kuLoke2lkfeeahOWunuS9k2ApO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOiOt+WPluW9k+WJjeWxgue6p+WunuS9k+S4i+eahOWIl+ihqOWxnuaAp1xyXG4gICAgICBlbnRpdHlMaXN0ID0gZW50aXR5W3BhdGhzW2luZGV4ICsgMV1dO1xyXG4gICAgfVxyXG4gICAgZW50aXR5TGlzdC5jbGVhcigpO1xyXG4gICAgZW50aXR5TGlzdC5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6aqM6K+B5a6e5L2T5piv5ZCm6IO95aSf5re75YqgXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2ZXJpZnlFbnRpdHlUb0FkZChlbnRpdHk6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKHRoaXMuaGFzKGVudGl0eVt0aGlzLnByaW1hcnlLZXldKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSByZXBvc2l0b3J5IGFscmVhZHkgaGFkIGFuIGl0ZW0gd2l0aCB0aGUgc2F2ZSBpZGVudGl0eSBvZiAnJHtlbnRpdHlbdGhpcy5wcmltYXJ5S2V5XX0nYCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmqjOivgeWunuS9k+aYr+WQpuiDveenu+mZpFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdmVyaWZ5RW50aXR5VG9SZW1vdmUoaWRlbnRpdHk6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLmhhcyhpZGVudGl0eSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZW50aXR5IHdpdGggaWRlbnRpdHkgb2YgJyR7aWRlbnRpdHl9IGRvc2Ugbm90IGV4c2l0LidgKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T6ZuG5ZCI5Y+Y5pu05rWBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBub3RpZnlDb2xsZWN0aW9uQ2hhbmdlZChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikge1xyXG4gICAgdGhpcy5jb2xsZWN0aW9uQ2hhbmdlZC5uZXh0KG1vZGlmaWNhdGlvbik7XHJcbiAgfVxyXG4gIHByaXZhdGUgbGlzdGVuRW50aXR5Q2hhbmdlRXZlbnQoZW50aXR5OiBFbnRpdHkpIHtcclxuICAgIGlmIChlbnRpdHkpIHtcclxuICAgICAgZW50aXR5Lm9uVmFsdWVDaGFuZ2VkLnN1YnNjcmliZSgoY2hhbmdlOiBNb2RpZmljYXRpb24pID0+IHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8jcmVnaW9uIOWIhumhtVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7liIbpobXlpKflsI9cclxuICAgKi9cclxuICBzZXQgcGFnZVNpemUocGFnZVNpemU6IG51bWJlcikge1xyXG4gICAgaWYgKHR5cGVvZiAocGFnZVNpemUpICE9PSAnbnVtYmVyJyB8fCBwYWdlU2l6ZSA8IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcjpwYWdlU2l6ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsID0gdGhpcy5wYWdpbmF0aW9uSW5mbztcclxuICAgIC8vIGNvbnN0IGVudGl0eVBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWxbdGhpcy5lbnRpdHlUeXBlTmFtZV0sIHsgcGFnZVNpemUgfSk7XHJcbiAgICAvLyB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgW3RoaXMuZW50aXR5VHlwZU5hbWVdOiBlbnRpdHlQYWdpbmF0aW9uSW5mbyB9KTtcclxuICAgIC8vIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvW3RoaXMuZW50aXR5VHlwZU5hbWVdLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgcGFnZVNpemUgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXlpKflsI9cclxuICAgKiBAZGVzY3JpcHRpb24g5aaC5p6c55So5oi35pyq5oyH5a6a5YiG6aG15aSn5bCP5YiZ6buY6K6k5Li6MO+8jOWNs+iOt+WPluaJgOacieaVsOaNrlxyXG4gICAqL1xyXG4gIGdldCBwYWdlU2l6ZSgpOiBudW1iZXIge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlU2l6ZSB8fCAwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruaVsOaNruaAu+adoeaVsFxyXG4gICAqL1xyXG4gIHNldCB0b3RhbENvdW50KHRvdGFsOiBudW1iZXIpIHtcclxuICAgIGlmICh0eXBlb2YgKHRvdGFsKSAhPT0gJ251bWJlcicgfHwgdG90YWwgPCAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXI6dG90YWwnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsW3RoaXMuZW50aXR5VHlwZU5hbWVdLCB7IHRvdGFsIH0pO1xyXG4gICAgLy8gdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IFt0aGlzLmVudGl0eVR5cGVOYW1lXTogZW50aXR5UGFnaW5hdGlvbkluZm8gfSk7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWwsIHsgdG90YWwgfSk7XHJcbiAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bmlbDmja7mgLvmnaHmlbBcclxuICAgKi9cclxuICBnZXQgdG90YWxDb3VudCgpOiBudW1iZXIge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbykge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbCB8fCAwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruW9k+WJjemhteeggVxyXG4gICAqL1xyXG4gIHNldCBwYWdlSW5kZXgocGFnZUluZGV4OiBudW1iZXIpIHtcclxuICAgIGlmICh0eXBlb2YgKHBhZ2VJbmRleCkgIT09ICdudW1iZXInIHx8IHBhZ2VJbmRleCA8IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBhcmFtZXRlcjpwYWdlSW5kZXgnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcmlnaW5hbCA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICAvLyBjb25zdCBlbnRpdHlQYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsW3RoaXMuZW50aXR5VHlwZU5hbWVdLCB7IHBhZ2VJbmRleCB9KTtcclxuICAgIC8vIHRoaXMucGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgeyBbdGhpcy5lbnRpdHlUeXBlTmFtZV06IGVudGl0eVBhZ2luYXRpb25JbmZvIH0pO1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VJbmRleCB9KTtcclxuICAgIHRoaXMubm90aWZ5Q29sbGVjdGlvbkNoYW5nZWQobmV3IE1vZGlmaWNhdGlvbih0aGlzLnBhZ2luYXRpb25JbmZvLCBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlKSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluW9k+WJjemhteeggVxyXG4gICAqL1xyXG4gIGdldCBwYWdlSW5kZXgoKTogbnVtYmVyIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZUluZGV4IHx8IDE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5pu05paw5YiG6aG15L+h5oGvXHJcbiAgICogQHBhcmFtIHBhdGgg57uR5a6a6Lev5b6EXHJcbiAgICogQHBhcmFtIHBhZ2VJbmZvIOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aChwYXRoOiBzdHJpbmcsIHBhZ2VJbmZvOiB7IHBhZ2VJbmRleDogYW55LCBwYWdlU2l6ZTogYW55LCB0b3RhbENvdW50OiBhbnksIFtwcm9wOiBzdHJpbmddOiBhbnkgfSkge1xyXG4gICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgY29uc3QgeyBwYWdlSW5kZXgsIHBhZ2VTaXplIH0gPSBwYWdlSW5mbztcclxuICAgIGNvbnN0IHRvdGFsID0gcGFnZUluZm8gJiYgKHBhZ2VJbmZvLnRvdGFsQ291bnQgfHwgcGFnZUluZm8udG90YWwpIHx8IDA7XHJcbiAgICBjb25zdCBwYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIG9yaWdpbmFsLCB7IHBhZ2VJbmRleCwgcGFnZVNpemUsIHRvdGFsIH0pO1xyXG4gICAgdGhpcy5zZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKHBhdGgsIHBhZ2luYXRpb25JbmZvKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qC55o2u6Lev5b6E6I635Y+W5YiG6aG15aSn5bCPXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICovXHJcbiAgcHVibGljIGdldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBhbnkpIHtcclxuICAgIGlmICghcGF0aCB8fCBwYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHBhdGggIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5b+F6aG75Li65a2X56ym5Liy77yBJyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS50cmltKCkubGVuZ3RoID4gMCkubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpO1xyXG4gICAgbGV0IGNvbmZpZyA9IHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICBwYXRocy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xyXG4gICAgICAgIGNvbmZpZyA9IGNvbmZpZ1tpdGVtXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25maWcgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiAhIWNvbmZpZyA/IGNvbmZpZyA6IHR5cGVvZiBkZWZhdWx0VmFsdWUgIT09ICd1bmRlZmluZWQnID8gZGVmYXVsdFZhbHVlIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7liIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gdmFsdWUg5YC877yM5YW25Lit5oC75p2h5pWwa2V55Li6dG90YWxcclxuICAgKi9cclxuICBwdWJsaWMgc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChwYXRoOiBzdHJpbmcgfCBBcnJheTxhbnk+LCB2YWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCBvcmlnaW5hbCA9IEpTT04uc3RyaW5naWZ5KHRoaXMucGFnaW5hdGlvbkluZm8pO1xyXG4gICAgaWYgKCFwYXRoIHx8IHBhdGggPT09ICcvJykge1xyXG4gICAgICB0aGlzLnBhZ2luYXRpb25JbmZvID0gdmFsdWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0aCkpIHtcclxuICAgICAgICBwYXRoID0gcGF0aC50b1N0cmluZygpLm1hdGNoKC9bXi9bXFxdXSsvZykgfHwgW107XHJcbiAgICAgIH1cclxuICAgICAgcGF0aC5zbGljZSgwLCAtMSkucmVkdWNlKChwcmV2LCBjdXJyZW50LCBpbmRleCkgPT5cclxuICAgICAgICBPYmplY3QocHJldltjdXJyZW50XSkgPT09IHByZXZbY3VycmVudF1cclxuICAgICAgICAgID8gcHJldltjdXJyZW50XVxyXG4gICAgICAgICAgOiBwcmV2W2N1cnJlbnRdID0gTWF0aC5hYnMocGF0aFtpbmRleCArIDFdKSA+PiAwID09PSArcGF0aFtpbmRleCArIDFdXHJcbiAgICAgICAgICAgID8gW11cclxuICAgICAgICAgICAgOiB7fSxcclxuICAgICAgICB0aGlzLnBhZ2luYXRpb25JbmZvKVtwYXRoW3BhdGgubGVuZ3RoIC0gMV1dID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKEpTT04uc3RyaW5naWZ5KHRoaXMucGFnaW5hdGlvbkluZm8pICE9PSBvcmlnaW5hbCkge1xyXG4gICAgICB0aGlzLm5vdGlmeUNvbGxlY3Rpb25DaGFuZ2VkKG5ldyBNb2RpZmljYXRpb24odGhpcy5wYWdpbmF0aW9uSW5mbywgTW9kaWZ5VHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG59XHJcblxyXG5leHBvcnQgeyBFbnRpdHlDb2xsZWN0aW9uIH07XHJcbiJdfQ==
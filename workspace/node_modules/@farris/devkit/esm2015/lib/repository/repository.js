import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { DataTypeInfo } from '../core/index';
import { MetadataUtil } from '../metadata/index';
import { createEntity, createEntities } from '../entity/index';
import { EntityCollection } from './entity_collection';
import { PaginationManager } from './pagination_manager';
import { DataChangeHistory } from './data_change_history';
import { SortConditionManager } from './sort_condition_manager';
import { FilterConditionManager } from './filter_condition_manager';
import { UID } from '../misc/uid';
/**
 * 本地仓库
 * @description
 * # Repository
 *
 * Repository负责与后台接口交互并将接口返回的数据转换为Entity集合进行保存。因此Repository有两个重要的职责：后端交互、数据存储。
 * Repository中存储的数据是Entity类型，可以通过API对数据进行修改或删除。由于Repository和BindingData相互监听，对数据仓库的操作最终会通过BindingData更新到界面上。
 *
 * ## 实体操作
 * 实体操作仅对Repository本地已经存在的数据进行操作，不会发送请求。
 *
 * - 通过主键获取实体
 *
 *   ```javascript
 *    this.repository.entityCollection.getEntityById("id");
 *   ```
 *
 * - 删除实体数据
 *
 *   ```javascript
 *   this.repository.entityCollection.removeEntityById("id")
 *   ```
 *
 * - 清空所有实体
 *
 *   ```javascript
 *   this.repository.entityCollection.clear();
 *   ```
 *
 * - 将实体数据转换为json格式
 *
 *   ```javascript
 *   this.repository.entityCollection.toJSON();
 *   ```
 *
 * - 添加实体
 *
 *   ```javascript
 *   this.repository.entityCollection.addEntity(entity:T);
 *   ```
 * - 添加子表实体
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   entityManager.appendEntityByPath("/主实体Id/子表名s",{子表JSON数据});
 *   ```
 * - 批量添加实体
 *
 *   ```javascript
 *   this.repository.entityCollection.addEntities(entities:T[])
 *   ```
 *
 * - 批量添加子表实体
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   const childrenEntities = entityManager.createEntitiesByPath(["主实体Id","子表名s"], entityListData: any[])
 *   entityManager.appendEntitiesByPath(["主实体Id","子表名s"],childrenEntities);
 *   ```
 *
 * - 批量加载实体
 *
 *   ```javascript
 *   this.repository.entityCollection.loadEntities(entities:T[]);
 *   ```
 *
 *   > 加载实体会将本地仓库数据置为加载的实体。
 *
 * - 创建实体
 *
 *   ```javascript
 *   this.repository.buildEntity(JSON数据);
 *   ```
 *
 * - 批量创建实体
 *
 *   ```javascript
 *   this.repository.buildEntities(JSON数据);
 *   ```
 *
 * - 获取子表数据
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   entityManager.getEntityByPath(["主实体Id","子表名","子表id"]);
 *   ```
 *
 *   !> **注意** entityManager属性仅存在于BefRepository类，因此在使用EntityManager时应先将Repository转换为BefRepository
 *
 * - 获取所有子表数据
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   const entityManager = befRepository.entityManager;
 *   entityManager.getEntitiesByPath(["主实体Id","子表名"]);
 *   ```
 *
 *   > EntityManager不仅可以获取子表数据，同样可以获取主表数据。
 *   >
 *   > ```javascript
 *   > entityManager.getEntitiesByPath(["主实体Id"]);
 *   > ```
 *
 * - 获取实体属性值
 *
 *   ```javascript
 *   const entity = this.repository.entityCollection.getEntityById("id");
 *   cosnt name = entity['name'];
 *   // 或者
 *   const entity: any = this.repository.entityCollection.getEntityById("id");
 *   cosnt name = entity.name;
 *   ```
 *
 * ## 后端交互
 *
 * ​	通过接口操作后端数据，会直接对数据产生影响。
 *
 * - 更新实体数据
 *
 *   ```javascript
 *   this.repository.updateById('id');
 *   ```
 *
 * - 删除实体
 *
 *   ```javascript
 *   this.repository.removeById("id");
 *   ```
 *
 * - 批量删除实体
 *
 *   ```javascript
 *   this.repository.removeByIds(ids:string[])
 *   ```
 *
 * - 删除下级表数据
 *
 *   ```javascript
 *   this.repository.removeByPath(['主表Id','子表名','子表Id'])
 *   ```
 *
 * - 新增主实体
 *
 *   ```javascript
 *   this.repository.append();
 *   ```
 *
 * - 新增子实体
 *
 *   ```javascript
 *   this.repository.appendByPath(['主表id','子表名']);
 *   ```
 *
 * - 加载实体数据
 *
 *   ```javascript
 *   this.repository.getById('id');
 *   ```
 *
 * - 获取主表数据
 *
 *   ```javascript
 *   this.repository.getEntities(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null)
 *
 *   ```
 *
 *   > pageSize、pageIndex可以不传。
 *
 * - 获取主表数据（POST方法）
 *
 *   ```javascript
 *   this.repository.filter(filter: any[], sorts: any[], pageSize: number | null, pageIndex: number | null)
 *   ```
 *
 * - 提交指定实体变更到后端
 *
 *   ```javascript
 *   this.repository.updateChangesById("id");
 *   ```
 *
 * - 提交所有变更
 *
 *   ```javascript
 *   this.repository.updateAllChanges();
 *   ```
 *
 * - 应用变更（保存）
 *
 *   ```javascript
 *   this.repository.applyChanges();
 *   ```
 *
 * - 取消变更
 *
 *   ```javascript
 *   this.repository.cancelChanges();
 *   ```
 *
 * - 清除Repository所有变更
 *
 *   ```javascript
 *   const befRepository = this.repository as BefRepository<any>;
 *   befRepository.entityManager.clearAllEntityChanges();
 *   ```
 *
 * - 批量新增子表数据
 *   ```javascript
 *   this.repository.batchAppendByPath(path: string, defaultValues: Array<any>);
 *   ```
 *
 *   > path `string`：/主表id/从表前端nodeCode，如果/1/orders
 *   >
 *   > defaultValues `Array<any>`：新增从表时的默认值，数组，元素为对象，key为字段名，value为默认值。
 *
 * - 批量删除子表数据
 *
 *   ```javascript
 *   this.repository.batchRemoveByPath(path: string, ids: string);
 *   ```
 *
 *   > path `string`： /主表id/从表前端nodeCode，如果/1/orders
 *   >
 *   > ids `string` ：要删除的子表数据id，格式为`id1,id2,id3`
 */
export class Repository {
    // #endregion
    /**
     * 构造函数
     */
    constructor() {
        /**
         * 用户分页配置信息
         */
        this.paginationInfo = null;
        this.readMetadata();
        if (this.entityType) {
            this.entityTypeInfo = new DataTypeInfo(this.entityType);
            this.entityCollection = new EntityCollection(this.entityType);
        }
        this.dataChangeHistory = new DataChangeHistory();
        this.sortConditionManager = new SortConditionManager();
        this.filterConditionManager = new FilterConditionManager();
        this.destroy$ = new Subject();
    }
    // #endregion
    // #region get/set方法
    /**
     * 实体主键
     */
    get primaryKey() {
        return this.entityCollection.primaryKey;
    }
    get changes() {
        return this.entityCollection.changes;
    }
    /**
     * 实体变更集合
     */
    get entityCollectionChange() {
        return this.entityCollection.collectionChanged;
    }
    /**
     * 获取名称
     */
    get name() {
        // 1、老表单没有name属性
        // 2、不能使用construcotr.name，压缩脚本会把name改掉，或者压缩成相同的名称（目前发现已知）
        if (!this.innerName) {
            const guid = UID.create();
            this.innerName = `Repository_${guid}`;
        }
        return this.innerName;
    }
    /**
     * 设置名称
     */
    set name(value) {
        this.innerName = value;
    }
    dispose(options) {
        this.paginationManager = null;
        if (this.destroy$) {
            this.destroy$.next();
            this.destroy$.complete();
            this.destroy$ = null;
        }
        if (this.entityCollection) {
            this.entityCollection.reset(false);
            // this.entityCollection = null;
        }
    }
    ngOnDestroy() {
        this.dispose();
    }
    updateEntityType(entityType) {
        this.entityType = entityType;
        this.entityTypeInfo = new DataTypeInfo(this.entityType);
        this.entityCollection = new EntityCollection(this.entityType);
    }
    /**
     * 读取元数据
     */
    readMetadata() {
        const repositoryMetadata = MetadataUtil.getClassMetadataByName(this.constructor, 'NgRepository');
        if (repositoryMetadata) {
            // API地址
            this.apiUri = repositoryMetadata.apiUrl;
            // 实体类型
            this.entityType = repositoryMetadata.entityType;
        }
    }
    /**
     * 初始化分页配置
     * @param config - 用户分页配置
     */
    setPaginationConfig(config) {
        this.paginationManager = new PaginationManager(this.entityType, config);
        const { pageSize = 0 } = this.paginationManager.getPaginationConfigByPath('/') || {};
        // tslint:disable-next-line: max-line-length
        this.entityCollection.paginationInfo = Object.assign({ pageSize }, this.paginationManager.pagination, this.entityCollection.paginationInfo);
        // 无需再单独设置一次pageSize，减少一次变更
        // this.entityCollection.pageSize = pageSize;
    }
    /**
     * 重置状态
     */
    reset() {
        this.entityCollection.reset();
    }
    /**
     * 创建实体
     * @param data
     */
    buildEntity(data) {
        const entity = createEntity(this.entityType, data);
        return entity;
    }
    /**
     * 批量创建实体
     * @param listData
     */
    buildEntities(listData) {
        const entities = createEntities(this.entityType, listData);
        return entities;
    }
}
Repository.decorators = [
    { type: Injectable }
];
/** @nocollapse */
Repository.ctorParameters = () => [];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL3JlcG9zaXRvcnkvcmVwb3NpdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3RELE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBZSxNQUFNLGVBQWUsQ0FBQztBQUUxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDakQsT0FBTyxFQUFVLFlBQVksRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWxDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBa09HO0FBRUgsTUFBTSxPQUFnQixVQUFVO0lBOEY5QixhQUFhO0lBRWI7O09B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O1lBQ1AsSUFBSSxDQUFDLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQyxVQUFVLENBQUM7U0FDakQ7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsbUJBQW1CLENBQUMsTUFBVztRQUM3QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3hFLE1BQU0sRUFBRSxRQUFRLEdBQUcsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLHlCQUF5QixDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyRiw0Q0FBNEM7UUFDNUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDNUksMkJBQTJCO1FBQzNCLDZDQUE2QztJQUMvQyxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxLQUFLO1FBQ1YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7O09BR0c7SUFDSSxXQUFXLENBQUMsSUFBUztRQUMxQixNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN0RCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksYUFBYSxDQUFDLFFBQWU7UUFDbEMsTUFBTSxRQUFRLEdBQVEsY0FBYyxDQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbkUsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQzs7O1lBdExGLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBEYXRhVHlwZUluZm8sIElEaXNwb3NhYmxlIH0gZnJvbSAnLi4vY29yZS9pbmRleCc7XHJcbmltcG9ydCB7IE1vZGlmaWNhdGlvbiB9IGZyb20gJy4uL2NoYW5nZXNldC9pbmRleCc7XHJcbmltcG9ydCB7IE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uL21ldGFkYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRW50aXR5LCBjcmVhdGVFbnRpdHksIGNyZWF0ZUVudGl0aWVzIH0gZnJvbSAnLi4vZW50aXR5L2luZGV4JztcclxuaW1wb3J0IHsgTmdSZXBvc2l0b3J5IH0gZnJvbSAnLi9kZWNvcmF0b3JzJztcclxuaW1wb3J0IHsgRW50aXR5Q29sbGVjdGlvbiB9IGZyb20gJy4vZW50aXR5X2NvbGxlY3Rpb24nO1xyXG5pbXBvcnQgeyBQYWdpbmF0aW9uTWFuYWdlciB9IGZyb20gJy4vcGFnaW5hdGlvbl9tYW5hZ2VyJztcclxuaW1wb3J0IHsgRGF0YUNoYW5nZUhpc3RvcnkgfSBmcm9tICcuL2RhdGFfY2hhbmdlX2hpc3RvcnknO1xyXG5pbXBvcnQgeyBTb3J0Q29uZGl0aW9uTWFuYWdlciB9IGZyb20gJy4vc29ydF9jb25kaXRpb25fbWFuYWdlcic7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvbk1hbmFnZXIgfSBmcm9tICcuL2ZpbHRlcl9jb25kaXRpb25fbWFuYWdlcic7XHJcbmltcG9ydCB7IFVJRCB9IGZyb20gJy4uL21pc2MvdWlkJztcclxuXHJcbi8qKlxyXG4gKiDmnKzlnLDku5PlupNcclxuICogQGRlc2NyaXB0aW9uXHJcbiAqICMgUmVwb3NpdG9yeVxyXG4gKlxyXG4gKiBSZXBvc2l0b3J56LSf6LSj5LiO5ZCO5Y+w5o6l5Y+j5Lqk5LqS5bm25bCG5o6l5Y+j6L+U5Zue55qE5pWw5o2u6L2s5o2i5Li6RW50aXR56ZuG5ZCI6L+b6KGM5L+d5a2Y44CC5Zug5q2kUmVwb3NpdG9yeeacieS4pOS4qumHjeimgeeahOiBjOi0o++8muWQjuerr+S6pOS6kuOAgeaVsOaNruWtmOWCqOOAglxyXG4gKiBSZXBvc2l0b3J55Lit5a2Y5YKo55qE5pWw5o2u5pivRW50aXR557G75Z6L77yM5Y+v5Lul6YCa6L+HQVBJ5a+55pWw5o2u6L+b6KGM5L+u5pS55oiW5Yig6Zmk44CC55Sx5LqOUmVwb3NpdG9yeeWSjEJpbmRpbmdEYXRh55u45LqS55uR5ZCs77yM5a+55pWw5o2u5LuT5bqT55qE5pON5L2c5pyA57uI5Lya6YCa6L+HQmluZGluZ0RhdGHmm7TmlrDliLDnlYzpnaLkuIrjgIJcclxuICpcclxuICogIyMg5a6e5L2T5pON5L2cXHJcbiAqIOWunuS9k+aTjeS9nOS7heWvuVJlcG9zaXRvcnnmnKzlnLDlt7Lnu4/lrZjlnKjnmoTmlbDmja7ov5vooYzmk43kvZzvvIzkuI3kvJrlj5HpgIHor7fmsYLjgIJcclxuICpcclxuICogLSDpgJrov4fkuLvplK7ojrflj5blrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoXCJpZFwiKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDliKDpmaTlrp7kvZPmlbDmja5cclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXR5QnlJZChcImlkXCIpXHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqIC0g5riF56m65omA5pyJ5a6e5L2TXHJcbiAqXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmNsZWFyKCk7XHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqIC0g5bCG5a6e5L2T5pWw5o2u6L2s5o2i5Li6anNvbuagvOW8j1xyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0pTT04oKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDmt7vliqDlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXR5KGVudGl0eTpUKTtcclxuICogICBgYGBcclxuICogLSDmt7vliqDlrZDooajlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAqICAgY29uc3QgZW50aXR5TWFuYWdlciA9IGJlZlJlcG9zaXRvcnkuZW50aXR5TWFuYWdlcjtcclxuICogICBlbnRpdHlNYW5hZ2VyLmFwcGVuZEVudGl0eUJ5UGF0aChcIi/kuLvlrp7kvZNJZC/lrZDooajlkI1zXCIse+WtkOihqEpTT07mlbDmja59KTtcclxuICogICBgYGBcclxuICogLSDmibnph4/mt7vliqDlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXRpZXMoZW50aXRpZXM6VFtdKVxyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOaJuemHj+a3u+WKoOWtkOihqOWunuS9k1xyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICogICBjb25zdCBlbnRpdHlNYW5hZ2VyID0gYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyO1xyXG4gKiAgIGNvbnN0IGNoaWxkcmVuRW50aXRpZXMgPSBlbnRpdHlNYW5hZ2VyLmNyZWF0ZUVudGl0aWVzQnlQYXRoKFtcIuS4u+WunuS9k0lkXCIsXCLlrZDooajlkI1zXCJdLCBlbnRpdHlMaXN0RGF0YTogYW55W10pXHJcbiAqICAgZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdGllc0J5UGF0aChbXCLkuLvlrp7kvZNJZFwiLFwi5a2Q6KGo5ZCNc1wiXSxjaGlsZHJlbkVudGl0aWVzKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDmibnph4/liqDovb3lrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKGVudGl0aWVzOlRbXSk7XHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqICAgPiDliqDovb3lrp7kvZPkvJrlsIbmnKzlnLDku5PlupPmlbDmja7nva7kuLrliqDovb3nmoTlrp7kvZPjgIJcclxuICpcclxuICogLSDliJvlu7rlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KEpTT07mlbDmja4pO1xyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOaJuemHj+WIm+W7uuWunuS9k1xyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdGllcyhKU09O5pWw5o2uKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDojrflj5blrZDooajmlbDmja5cclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAqICAgY29uc3QgZW50aXR5TWFuYWdlciA9IGJlZlJlcG9zaXRvcnkuZW50aXR5TWFuYWdlcjtcclxuICogICBlbnRpdHlNYW5hZ2VyLmdldEVudGl0eUJ5UGF0aChbXCLkuLvlrp7kvZNJZFwiLFwi5a2Q6KGo5ZCNXCIsXCLlrZDooahpZFwiXSk7XHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqICAgIT4gKirms6jmhI8qKiBlbnRpdHlNYW5hZ2Vy5bGe5oCn5LuF5a2Y5Zyo5LqOQmVmUmVwb3NpdG9yeeexu++8jOWboOatpOWcqOS9v+eUqEVudGl0eU1hbmFnZXLml7blupTlhYjlsIZSZXBvc2l0b3J56L2s5o2i5Li6QmVmUmVwb3NpdG9yeVxyXG4gKlxyXG4gKiAtIOiOt+WPluaJgOacieWtkOihqOaVsOaNrlxyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICogICBjb25zdCBlbnRpdHlNYW5hZ2VyID0gYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyO1xyXG4gKiAgIGVudGl0eU1hbmFnZXIuZ2V0RW50aXRpZXNCeVBhdGgoW1wi5Li75a6e5L2TSWRcIixcIuWtkOihqOWQjVwiXSk7XHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqICAgPiBFbnRpdHlNYW5hZ2Vy5LiN5LuF5Y+v5Lul6I635Y+W5a2Q6KGo5pWw5o2u77yM5ZCM5qC35Y+v5Lul6I635Y+W5Li76KGo5pWw5o2u44CCXHJcbiAqICAgPlxyXG4gKiAgID4gYGBgamF2YXNjcmlwdFxyXG4gKiAgID4gZW50aXR5TWFuYWdlci5nZXRFbnRpdGllc0J5UGF0aChbXCLkuLvlrp7kvZNJZFwiXSk7XHJcbiAqICAgPiBgYGBcclxuICpcclxuICogLSDojrflj5blrp7kvZPlsZ7mgKflgLxcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChcImlkXCIpO1xyXG4gKiAgIGNvc250IG5hbWUgPSBlbnRpdHlbJ25hbWUnXTtcclxuICogICAvLyDmiJbogIVcclxuICogICBjb25zdCBlbnRpdHk6IGFueSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoXCJpZFwiKTtcclxuICogICBjb3NudCBuYW1lID0gZW50aXR5Lm5hbWU7XHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqICMjIOWQjuerr+S6pOS6klxyXG4gKlxyXG4gKiDigItcdOmAmui/h+aOpeWPo+aTjeS9nOWQjuerr+aVsOaNru+8jOS8muebtOaOpeWvueaVsOaNruS6p+eUn+W9seWTjeOAglxyXG4gKlxyXG4gKiAtIOabtOaWsOWunuS9k+aVsOaNrlxyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkudXBkYXRlQnlJZCgnaWQnKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDliKDpmaTlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnJlbW92ZUJ5SWQoXCJpZFwiKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDmibnph4/liKDpmaTlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnJlbW92ZUJ5SWRzKGlkczpzdHJpbmdbXSlcclxuICogICBgYGBcclxuICpcclxuICogLSDliKDpmaTkuIvnuqfooajmlbDmja5cclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnJlbW92ZUJ5UGF0aChbJ+S4u+ihqElkJywn5a2Q6KGo5ZCNJywn5a2Q6KGoSWQnXSlcclxuICogICBgYGBcclxuICpcclxuICogLSDmlrDlop7kuLvlrp7kvZNcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmFwcGVuZCgpO1xyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOaWsOWinuWtkOWunuS9k1xyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYXBwZW5kQnlQYXRoKFsn5Li76KGoaWQnLCflrZDooajlkI0nXSk7XHJcbiAqICAgYGBgXHJcbiAqXHJcbiAqIC0g5Yqg6L295a6e5L2T5pWw5o2uXHJcbiAqXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5nZXRCeUlkKCdpZCcpO1xyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOiOt+WPluS4u+ihqOaVsOaNrlxyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuZ2V0RW50aXRpZXMoZmlsdGVyOiBhbnlbXSwgc29ydHM6IGFueVtdLCBwYWdlU2l6ZTogbnVtYmVyIHwgbnVsbCwgcGFnZUluZGV4OiBudW1iZXIgfCBudWxsKVxyXG4gKlxyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAgID4gcGFnZVNpemXjgIFwYWdlSW5kZXjlj6/ku6XkuI3kvKDjgIJcclxuICpcclxuICogLSDojrflj5bkuLvooajmlbDmja7vvIhQT1NU5pa55rOV77yJXHJcbiAqXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5maWx0ZXIoZmlsdGVyOiBhbnlbXSwgc29ydHM6IGFueVtdLCBwYWdlU2l6ZTogbnVtYmVyIHwgbnVsbCwgcGFnZUluZGV4OiBudW1iZXIgfCBudWxsKVxyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOaPkOS6pOaMh+WumuWunuS9k+WPmOabtOWIsOWQjuerr1xyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkudXBkYXRlQ2hhbmdlc0J5SWQoXCJpZFwiKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDmj5DkuqTmiYDmnInlj5jmm7RcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZUFsbENoYW5nZXMoKTtcclxuICogICBgYGBcclxuICpcclxuICogLSDlupTnlKjlj5jmm7TvvIjkv53lrZjvvIlcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgdGhpcy5yZXBvc2l0b3J5LmFwcGx5Q2hhbmdlcygpO1xyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOWPlua2iOWPmOabtFxyXG4gKlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuY2FuY2VsQ2hhbmdlcygpO1xyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOa4hemZpFJlcG9zaXRvcnnmiYDmnInlj5jmm7RcclxuICpcclxuICogICBgYGBqYXZhc2NyaXB0XHJcbiAqICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAqICAgYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyQWxsRW50aXR5Q2hhbmdlcygpO1xyXG4gKiAgIGBgYFxyXG4gKlxyXG4gKiAtIOaJuemHj+aWsOWinuWtkOihqOaVsOaNrlxyXG4gKiAgIGBgYGphdmFzY3JpcHRcclxuICogICB0aGlzLnJlcG9zaXRvcnkuYmF0Y2hBcHBlbmRCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWVzOiBBcnJheTxhbnk+KTtcclxuICogICBgYGBcclxuICpcclxuICogICA+IHBhdGggYHN0cmluZ2DvvJov5Li76KGoaWQv5LuO6KGo5YmN56uvbm9kZUNvZGXvvIzlpoLmnpwvMS9vcmRlcnNcclxuICogICA+XHJcbiAqICAgPiBkZWZhdWx0VmFsdWVzIGBBcnJheTxhbnk+YO+8muaWsOWinuS7juihqOaXtueahOm7mOiupOWAvO+8jOaVsOe7hO+8jOWFg+e0oOS4uuWvueixoe+8jGtleeS4uuWtl+auteWQje+8jHZhbHVl5Li66buY6K6k5YC844CCXHJcbiAqXHJcbiAqIC0g5om56YeP5Yig6Zmk5a2Q6KGo5pWw5o2uXHJcbiAqXHJcbiAqICAgYGBgamF2YXNjcmlwdFxyXG4gKiAgIHRoaXMucmVwb3NpdG9yeS5iYXRjaFJlbW92ZUJ5UGF0aChwYXRoOiBzdHJpbmcsIGlkczogc3RyaW5nKTtcclxuICogICBgYGBcclxuICpcclxuICogICA+IHBhdGggYHN0cmluZ2DvvJogL+S4u+ihqGlkL+S7juihqOWJjeerr25vZGVDb2Rl77yM5aaC5p6cLzEvb3JkZXJzXHJcbiAqICAgPlxyXG4gKiAgID4gaWRzIGBzdHJpbmdgIO+8muimgeWIoOmZpOeahOWtkOihqOaVsOaNrmlk77yM5qC85byP5Li6YGlkMSxpZDIsaWQzYFxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUmVwb3NpdG9yeTxUIGV4dGVuZHMgRW50aXR5PiBpbXBsZW1lbnRzIElEaXNwb3NhYmxlLCBPbkRlc3Ryb3kge1xyXG4gIC8vICNyZWdpb24g56eB5pyJ5bGe5oCnXHJcblxyXG4gIC8qKlxyXG4gICAqIOWQjeensFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJOYW1lOiBzdHJpbmc7XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiDlhazmnInlsZ7mgKfvvIjlhbHmnInlsZ7mgKfkuI3lupTor6Xnm7TmjqXmmrTpnLLvvIzlvoXljIXoo4XvvIlcclxuXHJcbiAgLyoqXHJcbiAgICogQVBJ5Zyw5Z2AXHJcbiAgICovXHJcbiAgcHVibGljIGFwaVVyaTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPnsbvlnotcclxuICAgKi9cclxuICBwdWJsaWMgZW50aXR5VHlwZTogYW55O1xyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPnsbvlnovkv6Hmga9cclxuICAgKiBAdG9kb++8muWunuS9k+WxguW6lOivpeS6i+WFiOS4gOS4qkVudGl0eVR5cGVJbmZv77yM5bm257un5om/RGF0YVR5cGVJbmZv44CCXHJcbiAgICovXHJcbiAgcHVibGljIGVudGl0eVR5cGVJbmZvOiBEYXRhVHlwZUluZm87XHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+mbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBlbnRpdHlDb2xsZWN0aW9uOiBFbnRpdHlDb2xsZWN0aW9uPFQ+O1xyXG5cclxuICAvKipcclxuICAgKiDnlKjmiLfliIbpobXphY3nva7kv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgcGFnaW5hdGlvbkluZm86IGFueSA9IG51bGw7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaVsOaNruWPmOabtOWOhuWPsu+8iOS7hemSiOWvueS4u+ihqOWinuWKoOOAgeWQhOenjeihqOWIoOmZpO+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBkYXRhQ2hhbmdlSGlzdG9yeTogRGF0YUNoYW5nZUhpc3Rvcnk7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaOkuW6j+adoeS7tueuoeeQhuWZqFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzb3J0Q29uZGl0aW9uTWFuYWdlcjogU29ydENvbmRpdGlvbk1hbmFnZXI7XHJcbiAgLyoqXHJcbiAgICog6L+H5ruk5p2h5Lu2566h55CG5ZmoXHJcbiAgICovXHJcbiAgcHVibGljIGZpbHRlckNvbmRpdGlvbk1hbmFnZXI6IEZpbHRlckNvbmRpdGlvbk1hbmFnZXI7XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiBnZXQvc2V05pa55rOVXHJcblxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgcHJpbWFyeUtleSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wcmltYXJ5S2V5O1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0IGNoYW5nZXMoKTogU3ViamVjdDxNb2RpZmljYXRpb24+IHtcclxuICAgIHJldHVybiB0aGlzLmVudGl0eUNvbGxlY3Rpb24uY2hhbmdlcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5Y+Y5pu06ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlbnRpdHlDb2xsZWN0aW9uQ2hhbmdlKCk6IFN1YmplY3Q8TW9kaWZpY2F0aW9uPiB7XHJcbiAgICByZXR1cm4gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNvbGxlY3Rpb25DaGFuZ2VkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBuYW1lKCk6IHN0cmluZyB7XHJcbiAgICAvLyAx44CB6ICB6KGo5Y2V5rKh5pyJbmFtZeWxnuaAp1xyXG4gICAgLy8gMuOAgeS4jeiDveS9v+eUqGNvbnN0cnVjb3RyLm5hbWXvvIzljovnvKnohJrmnKzkvJrmiopuYW1l5pS55o6J77yM5oiW6ICF5Y6L57yp5oiQ55u45ZCM55qE5ZCN56ew77yI55uu5YmN5Y+R546w5bey55+l77yJXHJcbiAgICBpZiAoIXRoaXMuaW5uZXJOYW1lKSB7XHJcbiAgICAgIGNvbnN0IGd1aWQgPSBVSUQuY3JlYXRlKCk7XHJcbiAgICAgIHRoaXMuaW5uZXJOYW1lID0gYFJlcG9zaXRvcnlfJHtndWlkfWA7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJOYW1lO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7lkI3np7BcclxuICAgKi9cclxuICBwdWJsaWMgc2V0IG5hbWUodmFsdWU6IHN0cmluZykge1xyXG4gICAgdGhpcy5pbm5lck5hbWUgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwYWdpbmF0aW9uTWFuYWdlcjogUGFnaW5hdGlvbk1hbmFnZXI8VD47XHJcbiAgcHVibGljIGRlc3Ryb3kkOiBTdWJqZWN0PGFueT47XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMucmVhZE1ldGFkYXRhKCk7XHJcbiAgICBpZiAodGhpcy5lbnRpdHlUeXBlKSB7XHJcbiAgICAgIHRoaXMuZW50aXR5VHlwZUluZm8gPSBuZXcgRGF0YVR5cGVJbmZvKHRoaXMuZW50aXR5VHlwZSk7XHJcbiAgICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbiA9IG5ldyBFbnRpdHlDb2xsZWN0aW9uPFQ+KHRoaXMuZW50aXR5VHlwZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmRhdGFDaGFuZ2VIaXN0b3J5ID0gbmV3IERhdGFDaGFuZ2VIaXN0b3J5KCk7XHJcbiAgICB0aGlzLnNvcnRDb25kaXRpb25NYW5hZ2VyID0gbmV3IFNvcnRDb25kaXRpb25NYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmZpbHRlckNvbmRpdGlvbk1hbmFnZXIgPSBuZXcgRmlsdGVyQ29uZGl0aW9uTWFuYWdlcigpO1xyXG4gICAgdGhpcy5kZXN0cm95JCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICB9XHJcbiAgZGlzcG9zZShvcHRpb25zPzogYW55KSB7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25NYW5hZ2VyID0gbnVsbDtcclxuICAgIGlmICh0aGlzLmRlc3Ryb3kkKSB7XHJcbiAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICAgIHRoaXMuZGVzdHJveSQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZW50aXR5Q29sbGVjdGlvbikge1xyXG4gICAgICB0aGlzLmVudGl0eUNvbGxlY3Rpb24ucmVzZXQoZmFsc2UpO1xyXG4gICAgICAvLyB0aGlzLmVudGl0eUNvbGxlY3Rpb24gPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZUVudGl0eVR5cGUoZW50aXR5VHlwZTogYW55KSB7XHJcbiAgICB0aGlzLmVudGl0eVR5cGUgPSBlbnRpdHlUeXBlO1xyXG4gICAgdGhpcy5lbnRpdHlUeXBlSW5mbyA9IG5ldyBEYXRhVHlwZUluZm8odGhpcy5lbnRpdHlUeXBlKTtcclxuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbiA9IG5ldyBFbnRpdHlDb2xsZWN0aW9uPFQ+KHRoaXMuZW50aXR5VHlwZSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog6K+75Y+W5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWFkTWV0YWRhdGEoKSB7XHJcbiAgICBjb25zdCByZXBvc2l0b3J5TWV0YWRhdGE6IE5nUmVwb3NpdG9yeSA9IE1ldGFkYXRhVXRpbC5nZXRDbGFzc01ldGFkYXRhQnlOYW1lKHRoaXMuY29uc3RydWN0b3IsICdOZ1JlcG9zaXRvcnknKTtcclxuICAgIGlmIChyZXBvc2l0b3J5TWV0YWRhdGEpIHtcclxuICAgICAgLy8gQVBJ5Zyw5Z2AXHJcbiAgICAgIHRoaXMuYXBpVXJpID0gcmVwb3NpdG9yeU1ldGFkYXRhLmFwaVVybDtcclxuICAgICAgLy8g5a6e5L2T57G75Z6LXHJcbiAgICAgIHRoaXMuZW50aXR5VHlwZSA9IHJlcG9zaXRvcnlNZXRhZGF0YS5lbnRpdHlUeXBlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yid5aeL5YyW5YiG6aG16YWN572uXHJcbiAgICogQHBhcmFtIGNvbmZpZyAtIOeUqOaIt+WIhumhtemFjee9rlxyXG4gICAqL1xyXG4gIHNldFBhZ2luYXRpb25Db25maWcoY29uZmlnOiBhbnkpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvbk1hbmFnZXIgPSBuZXcgUGFnaW5hdGlvbk1hbmFnZXIodGhpcy5lbnRpdHlUeXBlLCBjb25maWcpO1xyXG4gICAgY29uc3QgeyBwYWdlU2l6ZSA9IDAgfSA9IHRoaXMucGFnaW5hdGlvbk1hbmFnZXIuZ2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aCgnLycpIHx8IHt9O1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcclxuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oeyBwYWdlU2l6ZSB9LCB0aGlzLnBhZ2luYXRpb25NYW5hZ2VyLnBhZ2luYXRpb24sIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbyk7XHJcbiAgICAvLyDml6DpnIDlho3ljZXni6zorr7nva7kuIDmrKFwYWdlU2l6Ze+8jOWHj+WwkeS4gOasoeWPmOabtFxyXG4gICAgLy8gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnBhZ2VTaXplID0gcGFnZVNpemU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmHjee9rueKtuaAgVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZW50aXR5Q29sbGVjdGlvbi5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65a6e5L2TXHJcbiAgICogQHBhcmFtIGRhdGFcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRFbnRpdHkoZGF0YTogYW55KTogVCB7XHJcbiAgICBjb25zdCBlbnRpdHkgPSBjcmVhdGVFbnRpdHk8VD4odGhpcy5lbnRpdHlUeXBlLCBkYXRhKTtcclxuICAgIHJldHVybiBlbnRpdHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/liJvlu7rlrp7kvZNcclxuICAgKiBAcGFyYW0gbGlzdERhdGFcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRFbnRpdGllcyhsaXN0RGF0YTogYW55W10pOiBUW10ge1xyXG4gICAgY29uc3QgZW50aXRpZXM6IFRbXSA9IGNyZWF0ZUVudGl0aWVzPFQ+KHRoaXMuZW50aXR5VHlwZSwgbGlzdERhdGEpO1xyXG4gICAgcmV0dXJuIGVudGl0aWVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T5YiX6KGoXHJcbiAgICogQHBhcmFtIGZpbHRlcnMgLSAgICDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gc29ydHMgLSAgICAgIOaOkuW6j+adoeS7tlxyXG4gICAqIEBwYXJhbSBwYWdpbmF0aW9uIC0g5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgZ2V0RW50aXRpZXMoZmlsdGVyOiBhbnlbXSwgc29ydHM6IGFueVtdLCBwYWdlU2l6ZTogbnVtYmVyIHwgbnVsbCwgcGFnZUluZGV4OiBudW1iZXIgfCBudWxsKTogT2JzZXJ2YWJsZTxUW10+O1xyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWunuS9k+WIl+ihqFxyXG4gICAqIEBwYXJhbSBmaWx0ZXIgLSDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gc29ydHMgLSDmjpLluo/mnaHku7ZcclxuICAgKiBAcGFyYW0gcGFnZVNpemUgLSDliIbpobXlpKflsI9cclxuICAgKiBAcGFyYW0gcGFnZUluZGV4IC0g5b2T5YmN5YiG6aG1XHJcbiAgICovXHJcbiAgYWJzdHJhY3QgZmlsdGVyKGZpbHRlcj86IGFueVtdLCBzb3J0cz86IGFueVtdLCBwYWdlU2l6ZT86IG51bWJlciB8IG51bGwsIHBhZ2VJbmRleD86IG51bWJlciB8IG51bGwpOiBPYnNlcnZhYmxlPFRbXT47XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T5YiX6KGoXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgZ2V0TGlzdCgpOiBPYnNlcnZhYmxlPFRbXT47XHJcbiAgLyoqXHJcbiAgICog5qC55o2uaWTojrflj5blrp7kvZNcclxuICAgKiBAcGFyYW0gaWQgLSDlrp7kvZPmoIfor4ZcclxuICAgKi9cclxuICBhYnN0cmFjdCBnZXRCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+O1xyXG4gIC8qKlxyXG4gICAqIOagueaNrmlk6I635Y+W5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIC0g5Li75a6e5L2TaWRcclxuICAgKi9cclxuICBhYnN0cmFjdCBnZXRFbnRpdHlCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+O1xyXG4gIC8qKlxyXG4gICAqIOWIhumhteafpeivouS7juihqC/ku47ku47ooajmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aCAtIOe7keWumui3r+W+hFxyXG4gICAqIEBwYXJhbSBpZHMgLSDnu5Hlrprot6/lvoTlr7nlupTnmoTkuLvplK5cclxuICAgKiBAcGFyYW0gZmlsdGVyIC0g6L+H5ruk5p2h5Lu2XHJcbiAgICogQHBhcmFtIHNvcnQgLSDmjpLluo9cclxuICAgKi9cclxuICBhYnN0cmFjdCBxdWVyeUNoaWxkKHBhdGhzOiBzdHJpbmdbXSwgcGFnZUluZGV4OiBudW1iZXIsIHBhZ2VTaXplOiBudW1iZXIsIGZpbHRlcj86IHN0cmluZywgc29ydD86IHN0cmluZyk6IE9ic2VydmFibGU8VFtdPjtcclxuICAvKipcclxuICAgKiDmoLnmja5pZOabtOaWsOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCAtIOWunuS9k2lkXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgdXBkYXRlQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPjtcclxuICAvKipcclxuICAgKiDmm7TmlrDlrp7kvZPmlbDmja4o5a2Q6KGo5YiG6aG1KVxyXG4gICAqIEBwYXJhbSBpZCAtIOWunuS9k+S4u+mUrlxyXG4gICAqL1xyXG4gIGFic3RyYWN0IHVwZGF0ZUVudGl0eUJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD47XHJcbiAgLyoqXHJcbiAgICog5Yib5bu65paw5a6e5L2T77yM5bCG6K+l5a6e5L2T5Yqg6L295Yiw5YiX6KGoXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgY3JlYXRlKCk6IE9ic2VydmFibGU8YW55PjtcclxuXHJcbiAgLy8gLyoqXHJcbiAgLy8gICog5Yib5bu65ZCO5Luj5a6e5L2T77yM5bCG6K+l5a6e5L2T5Yqg6L295Yiw5ZCO5Luj5YiX6KGo77yI5pqC5peg6K+l5Zy65pmv77yJXHJcbiAgLy8gICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgLy8gICovXHJcbiAgLy8gYWJzdHJhY3QgY3JlYXRlQnlQYXRoKHBhdGg6IHN0cmluZyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuaWsOWunuS9k++8jOW5tui/veWKoOWIsOWunuS9k+WIl+ihqFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGFwcGVuZCgpOiBPYnNlcnZhYmxlPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuaWsOeahOWtkOWunuS9k++8jOW5tui/veWKoOWIsOWunuS9k+WIl+ihqFxyXG4gICAqIEBwYXJhbSBwYXRoIC0g5a6e5L2T6Lev5b6EXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgYXBwZW5kQnlQYXRoKHBhdGg6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PjtcclxuICAvKipcclxuICAgKiDlho3mjIflrprkvY3nva7mj5LlhaXmlbDmja5cclxuICAgKi9cclxuICBhYnN0cmFjdCBpbnNlcnQocG9zaXRpb246IDEgfCAtMSwgZGVmYXVsdFZhbHVlPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOWcqOaMh+WumuWunuS9k+i3r+W+hOaPkuWFpeWunuS9k1xyXG4gICAqIEBwYXJhbSBwYXRoIC0g5a6e5L2T6Lev5b6EXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgaW5zZXJ0QnlQYXRoKHBhdGg6IHN0cmluZywgcG9zaXRpb246IDEgfCAtMSk6IE9ic2VydmFibGU8YW55PjtcclxuICAvKipcclxuICAgKiDmoLnmja5pZOWIoOmZpOWvueW6lOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCAtIOWGheeggVxyXG4gICAqL1xyXG4gIGFic3RyYWN0IHJlbW92ZUJ5SWQoaWQ6IHN0cmluZywgaWZTYXZlPzogYm9vbGVhbik6IE9ic2VydmFibGU8YW55PjtcclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2uaWRz5om56YeP5Yig6Zmk5a6e5L2TXHJcbiAgICogQHBhcmFtIGlkIC0gaWRzXHJcbiAgICogQHBhcmFtIGlmU2F2ZSAtIOaYr+WQpuS/neWtmFxyXG4gICAqIEBkZXByZWNhdGVkIOW3suW6n+W8g++8jOivpeaOpeWPo+S9v+eUqHF1ZXJ5c3RyaW5n5Lyg5Y+C77yM5a2Y5Zyo6LaF6ZW/6Zeu6aKY44CC6K+35L2/55SoYmF0Y2hSZW1vdmXmjqXlj6Pmm7/ku6PjgIJcclxuICAgKi9cclxuICBhYnN0cmFjdCByZW1vdmVCeUlkcyhpZHM6IHN0cmluZ1tdLCBpZlNhdmU/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOagueaNrmlkc+aJuemHj+WIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZHMgLSBpZHNcclxuICAgKiBAcGFyYW0gaWZTYXZlIC0g5piv5ZCm5L+d5a2YXHJcbiAgICovXHJcbiAgYWJzdHJhY3QgYmF0Y2hSZW1vdmUoaWRzOiBzdHJpbmdbXSwgaWZTYXZlPzogYm9vbGVhbik6IE9ic2VydmFibGU8YW55PjtcclxuICAvKipcclxuICAgKiDmoLnmja5pZOWIoOmZpHBhdGjlr7nlupTnmoTlkI7ku6Plrp7kvZNcclxuICAgKi9cclxuICBhYnN0cmFjdCByZW1vdmVCeVBhdGgocGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTtcclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5LqkaWTlr7nlupTnmoTmoLnlrp7kvZPlj5jmm7RcclxuICAgKi9cclxuICBhYnN0cmFjdCB1cGRhdGVDaGFuZ2VzQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5LqkcGF0aOWvueW6lOeahOWunuS9k+WPmOabtFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IHVwZGF0ZUNoYW5nZXNCeVBhdGgocGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5pu05paw5omA5pyJ5Y+Y5pu0XHJcbiAgICovXHJcbiAgYWJzdHJhY3QgdXBkYXRlQWxsQ2hhbmdlcygpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiDlupTnlKjmnI3liqHlmajnq6/lj5jmm7RcclxuICAgKi9cclxuICBhYnN0cmFjdCBhcHBseUNoYW5nZXMoKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgLyoqXHJcbiAgICog5L+d5a2YaWTlr7nlupTmlbDmja7nmoTlj5jmm7RcclxuICAgKi9cclxuICBhYnN0cmFjdCBhcHBseUNoYW5nZXNCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojlj5jmm7Tpm4ZcclxuICAgKi9cclxuICBhYnN0cmFjdCBjYW5jZWxDaGFuZ2VzKG9wdGlvbnM/OiBhbnkpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpOWtkOihqFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGJhdGNoUmVtb3ZlQnlQYXRoKHBhdGg6IHN0cmluZywgaWRzOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aWsOWinuS7juihqC/ku47ku47ooajmlbDmja5cclxuICAgKiBAcGFyYW0gcGF0aCAtIOWunuS9k+e7keWumui3r+W+hO+8jGxpa2UgMS9jaGlsZHMgb3IgMS9jaGlsZHMvMTEvY2hpbGRjaGlsZHNcclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlcyAtIOm7mOiupOWunuS9k+aVsOaNruaVsOe7hFxyXG4gICAqIEBkZXNjcmlwdGlvbiDlkI7nq6/mjqXlj6Plj6rmlK/mjIHmibnph4/mlrDlop7lrZDooajvvIzmibnph4/mlrDlop7kuLvooajnm67liY3kuI3mlK/mjIFcclxuICAgKi9cclxuICBhYnN0cmFjdCBiYXRjaEFwcGVuZEJ5UGF0aChwYXRoOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZXM6IEFycmF5PGFueT4pOiBPYnNlcnZhYmxlPGFueT47XHJcbiAgLyoqXHJcbiAgICog5om56YeP5paw5aKe5Li76KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZXMgLSDpu5jorqTlrp7kvZPmlbDmja7mlbDnu4RcclxuICAgKi9cclxuICBhYnN0cmFjdCBiYXRjaEFwcGVuZChkZWZhdWx0VmFsdWVzOiBBcnJheTxhbnk+KTogT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIC8qKlxyXG4gICAqIOajgOafpeW9k+WJjeS4muWKoeS4iuS4i+aWh+WGheaYr+WQpuWtmOWcqOacquS/neWtmOeahOWPmOabtFxyXG4gICAqL1xyXG4gIGFic3RyYWN0IGhhc0NoYW5nZXMoKTogT2JzZXJ2YWJsZTxhbnk+O1xyXG59XHJcbiJdfQ==
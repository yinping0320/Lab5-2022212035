// tslint:disable: max-line-length
import { Injectable } from '@angular/core';
import { filter, takeUntil } from 'rxjs/operators';
import { FormControl, FormGroup } from '@angular/forms';
import { BigNumber } from 'bignumber.js';
import { MetadataUtil, PROP_METADATA } from '../metadata/index';
import { ChangeType } from '../binding-data/index';
import { NG_FORM_CONTROL, NG_CHILD_FORM, NG_VALIDATE_FORM } from './decorators';
import { DateUtil } from '../utils/index';
import { ValidationTypes } from '../entity/validator/validation_types';
import { ValidationExecutor } from '../entity/validator/validation_executor';
import * as ValidatorJS from 'validator';
import { DataTypeInfo, RunMode } from '../core';
import { TranslateService } from '../i18n/translate_service';
import { Subject } from 'rxjs';
import { parseISO } from 'date-fns';
/**
 * 表单定义
 */
class Form extends FormGroup {
    /**
     * 构造函数
     */
    constructor() {
        super({}, null, null);
        this.raisedByValidateEffector = false;
        this.isShowValidationMsg = false;
        this.validatorJs = ValidatorJS.default;
        this.controlIdMap = {};
        this.cardControls = {};
        this.isShowPropMap = {};
        this.destroy$ = new Subject();
        // this.excludeRuleTypes = {};
    }
    /**
     * 名称
     */
    get formGroupName() {
        return this.ngValidateForm ? this.ngValidateForm.formGroupName : '';
    }
    /**
     * 是否启用表单验证
     */
    get enableValidate() {
        return this.ngValidateForm ? this.ngValidateForm.enableValidate : false;
    }
    get translateService() {
        return this.translate;
    }
    ngOnDestroy() {
        this.dispose();
    }
    dispose(options) {
        if (this.destroy$) {
            this.destroy$.next();
            this.destroy$.complete();
            this.destroy$ = null;
        }
        Form.insMap[this.constructor.name] = null;
        this.frameContext = null;
        this.bindingData = null;
        this.ngChildForms = null;
        this.metaDatas = null;
        this.ngFormControls = {};
        this.controls = {};
        this.disposeValidation();
    }
    /**
     * 将formControl的错误信息更新到cardControl上
     */
    static updateErrors(propertyName, errorObj, id, value, isGrid) {
        Object.keys(Form.insMap).forEach(key => {
            const form = Form.insMap[key];
            if (!form) {
                return;
            }
            if (id) {
                form.setControlValue(propertyName, value);
            }
            if (form.enableValidate) {
                form.isFormValid(propertyName, errorObj, id, isGrid);
            }
        });
    }
    /**
     * 设置dom属性为显示状态
     * @param domPropertyName dom属性
     */
    setIsShowmap(domPropertyName) {
        this.isShowPropMap[domPropertyName] = true;
    }
    setShowValidationMsg(flag) {
        this.raisedByValidateEffector = false;
        this.isShowValidationMsg = flag;
    }
    setControlValue(key, value) {
        const bindingObject = this.bindingData && this.bindingData.getObject() || null;
        if (bindingObject && bindingObject.controlMap) {
            bindingObject.controlMap[key] = this.getGridItemControl(key, value);
        }
    }
    /**
     * 根据dom属性名称获取错误信息
     * @param domPropertyName dom属性名称
     */
    getCardControlErrors(domPropertyName) {
        this.setIsShowmap(domPropertyName);
        return this.cardControls[domPropertyName] && this.cardControls[domPropertyName].errors;
    }
    /**
     * 获取字段校验错误
     * @param domPropertyName
     * @returns
     */
    getFormControlErrors(domPropertyName) {
        return this.cardControls[domPropertyName] && this.cardControls[domPropertyName].errors;
    }
    getGridControlErrors(domPropertyName, id) {
        this.setIsShowmap(domPropertyName);
        return this.controlIdMap[id] && this.controlIdMap[id][domPropertyName] && this.controlIdMap[id][domPropertyName]['errors'];
    }
    isFormValid(propertyName, errorObj, id, isGrid) {
        let prefix = '';
        // 如果校验信息是由表达式触发的，不处理
        if (this.raisedByValidateEffector) {
            return;
        }
        const isGridComponent = this.frameContext.frameComponent.isGridComponent;
        if (isGridComponent !== undefined) {
            isGrid = isGridComponent;
        }
        //拼接子表frontNodeCode
        const bindingPaths = this.bindingPath.split('/').filter(p => p);
        if (bindingPaths.length > 0) {
            prefix = bindingPaths.join('.').concat('.');
        }
        // 界面上绑定的字段名
        const domPropertyName = this.getDomPropertyNameByEntityProp(propertyName, prefix);
        // 传了属性名，但却拿不到dom名称，说明当前组件中没有该字段对应的控件
        if (propertyName && !domPropertyName) {
            return true;
        }
        // 若界面上不存在当前属性（动态列），不进行验证
        if (domPropertyName && !this.isShowPropMap[domPropertyName]) {
            return true;
        }
        let isValid = true;
        const bindingObject = this.bindingData.getObject();
        const currentId = bindingObject.primaryKeyValue;
        const isSubForm = this.bindingPath !== '/';
        const bindingList = this.bindingData.getList();
        // 子表单无数据时，保存时会有一条空数据阻碍验证，所以此处跳过只有一行的情况
        if (isSubForm && bindingList.innerList.size === 0) {
            return true;
        }
        // 无数据时不做校验
        if (!currentId) {
            return true;
        }
        // dataGrid修改时，根据id，创建formControl，并设置错误对象
        if (id && domPropertyName) {
            // if (this.controlIdMap[id] && Object.keys(this.controlIdMap[id]).length === 0) {
            //   this.controlIdMap[id] = {};
            // }
            this.controlIdMap[id] = this.controlIdMap[id] || {};
            this.controlIdMap[id][domPropertyName] = {
                errors: errorObj
            };
        }
        // 将grid的FormControl同步到界面展示用的controlIDMap中
        // const currentBindingObject = bindingList.currentItem as BindingObject;
        const currentBindingObject = bindingObject;
        if (id && id !== currentId) {
            return;
        }
        // 验证全部字段时，清空已有的错误信息
        if (!propertyName && !id) {
            currentBindingObject.controlMap = {};
            this.controlIdMap = {};
            this.cardControls = {};
        }
        Object.keys(this.controls).forEach((key) => {
            if (this.isShowPropMap[key] !== true) {
                return;
            }
            // 同步实体错误信息
            if (key === domPropertyName) {
                // 实体验证的信息直接赋值
                if (errorObj && Object.keys(errorObj).length > 0) {
                    // 卡片的错误
                    if (!isGrid) {
                        // 实体层同步过来的错误，目前结构{ruleType:{name:'',value:'',originalErrors:[ValidationError]}}，其中name为校验失败的错误信息
                        // 遍历错误，将validator返回的错误信息国际化
                        Object.keys(errorObj).map((validType) => {
                            const validationError = errorObj[validType] && errorObj[validType]['error'] || null;
                            if (validationError) {
                                const validateRule = validationError.rule;
                                const ngFormControl = this.getngFormControlByBinding(validateRule.field);
                                if (ngFormControl) {
                                    validateRule.property = ngFormControl.name || ngFormControl.defaultI18nValue;
                                    validateRule.targetId = ngFormControl.id;
                                    validateRule.targetName = this.formGroupName;
                                    // 修正校验必填表达式类型和多语资源中key不一致的问题
                                    const fixedValidType = validType === 'require' ? 'required' : validType;
                                    const messageTemplate = ValidationTypes.getMessage(fixedValidType);
                                    if (messageTemplate) {
                                        const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, validateRule, ngFormControl.name);
                                        errorObj[validType]['name'] = invalidMessage;
                                    }
                                }
                                // todo: ngFormControl暂时不设置
                                // errorObj['name'] = this.getErrorByRuleType(validType, validateRule, null);
                            }
                        });
                        this.cardControls[key] = {
                            errors: errorObj
                        };
                    }
                }
                else {
                    this.cardControls[key] = {};
                }
            }
            if (this.controls[key] && this.controls[key].errors && Object.keys(this.controls[key].errors).length > 0) {
                // 将错误同步到界面展示的位置
                // 认为控件错误只包含错误类型，通过错误类型获取具体的错误信息
                this.cardControls[key] = {
                    errors: Object.assign({}, this.cardControls[key] && this.cardControls[key].errors, this.controls[key].errors)
                };
                isValid = false;
            }
        });
        // 处理只开启前端校验，未在BE上启用必填校验的情况
        if (this.cardControls) {
            Object.keys(this.cardControls).forEach(key => {
                if (this.cardControls[key] && this.cardControls[key].errors) {
                    Object.keys(this.cardControls[key].errors).forEach(validType => {
                        if (typeof this.cardControls[key].errors[validType] !== 'object') {
                            // 获取对应的校验信息
                            const validateRules = this.ngFormControls[key].validRules || [];
                            const rules = [].concat(validateRules);
                            const validateRule = rules.find(item => item.type === validType);
                            if (validateRule) {
                                validateRule.targetName = this.formGroupName;
                                const messageTemplate = ValidationTypes.getMessage(validType);
                                const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, validateRule, '');
                                this.cardControls[key].errors[key] = { value: this.controls[key] && this.controls[key].value || '', name: invalidMessage };
                            }
                        }
                    });
                }
            });
        }
        Object.keys(this.cardControls).forEach((key) => {
            if (this.cardControls[key] && this.cardControls[key].errors && Object.keys(this.cardControls[key].errors).length > 0) {
                isValid = false;
            }
        });
        return isValid;
    }
    /**
     * 更新表单错误信息
     * @param errors 错误消息
     */
    updateFormErrors(errors, forceShow = false, from = '') {
        if (from && from === 'backend') {
            this.clearBackendError();
        }
        // 原来是否已经显示错误，如果已经显示了则增加，否则替换
        if (this.isShowValidationMsg === true || forceShow === true) {
            this.isShowValidationMsg = true;
            Object.keys(errors).forEach((key) => {
                if (errors[key].errors && Object.keys(errors[key].errors).length > 0) {
                    // 如果控件本身没有错误，则直接使用外部传递过来的错误，否则合并错误
                    this.cardControls[key] = {
                        errors: Object.assign({}, this.cardControls[key] && this.cardControls[key].errors, errors[key].errors)
                    };
                }
                else {
                    // 移除内存中的错误信息
                    this.cardControls[key] = {
                        errors: {}
                    };
                    // 重置控件错误信息
                    this.controls[key].setErrors(null);
                    this.controls[key].markAsTouched();
                }
            });
        }
    }
    /**
     * 清空后端消息
     */
    clearBackendError() {
        Object.keys(this.cardControls).forEach(key => {
            const errors = this.cardControls[key] && this.cardControls[key].errors || null;
            if (errors) {
                Object.keys(errors).forEach(errorType => {
                    if (errorType && errorType.startsWith('backend-message-')) {
                        delete errors[errorType];
                    }
                });
                if (errors && Object.keys(errors).length === 0) {
                    delete this.cardControls[key].errors;
                }
            }
            else {
                this.cardControls[key] = {};
            }
        });
    }
    /**
     * 根据实体属性获取ngFormControl
     * @param binding 控件绑定的实体属性名
     */
    getngFormControlByBinding(binding) {
        return Object.values(this.ngFormControls).find((ngFormControl) => ngFormControl.binding && ngFormControl.binding === binding);
    }
    disposeValidation() {
        const properties = this.constructor[PROP_METADATA];
        if (properties && Object.keys(properties).length > 0) {
            Object.keys(properties).forEach((key) => {
                const props = this.constructor[PROP_METADATA][key];
                if (props && props.length > 0) {
                    props.forEach((item) => {
                        if (item.validRules && Array.isArray(item.validRules) && item.validRules.length > 0) {
                            item.validRules = item.validRules.filter(item => !(item.eval && typeof (item.eval) === 'function'));
                        }
                    });
                }
            });
        }
    }
    /**
     * 根据dom属性和校验类型获取错误信息
     * @param domProperty dom属性
     * @param validateRuleType 校验类型
     */
    getErrorMessage(domProperty, validateRuleType) {
        const formControl = this.ngFormControls[domProperty];
        if (formControl) {
            const validRules = formControl.validRules;
            const rules = [];
            if (!Array.isArray(validRules)) {
                rules.push(validRules);
            }
            else {
                rules.push(...validRules);
            }
            const rule = rules.find(item => item.type === validateRuleType);
            if (rule) {
                const controlName = formControl.name;
                const messageTemplate = ValidationTypes.getMessage(validateRuleType);
                const message = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, rule, controlName);
                return message;
            }
            return null;
        }
        return null;
    }
    /**
     * 初始化Form
     * @param context 上下文
     */
    init(bindingData, bindingPath, frameContext) {
        this.frameContext = frameContext;
        this.bindingData = bindingData;
        this.bindingPath = bindingPath;
        // 校验信息变化时重置卡片校验信息
        if (this.frameContext && this.frameContext.viewModel && this.frameContext.viewModel.verifycationChanged) {
            this.frameContext.viewModel.verifycationChanged.subscribe((verifycations) => {
                if (!verifycations || verifycations.length < 1) {
                    this.resetCardValidMsg();
                }
            });
        }
        this.buildForm();
        // @todo: 这种方式做key，如果脚本被压缩，存在风险
        Form.insMap[this.constructor.name] = this;
    }
    /**
     * 构造表单
     */
    buildForm() {
        this.collectMetadatas();
        // this.createChildFormArrays();
        this.createChildForms();
        this.createControls();
    }
    /**
     * 重置表单验证信息
     */
    resetCardValidMsg() {
        this.cardControls = {};
        // 剔除 列表中新增后取消,删除的项对应的control信息
        Object.keys(this.controlIdMap).forEach(id => {
            if (!this.bindingData.getList().innerList.map(x => x.id).includes(id)) {
                delete this.controlIdMap[id];
            }
        });
        this.resetFormControls();
        this.setShowValidationMsg(false);
    }
    /**
     * 更新字段校验规则
     * @param propertyName 属性名
     * @param isRequired 是否必填
     */
    updateFieldValidateRule(propertyName, isRequired) {
        if (!propertyName) {
            return;
        }
        const formControl = this.controls[propertyName];
        // 清空全部校验条件
        if (formControl) {
            formControl.clearValidators();
            formControl.markAsUntouched();
            formControl.markAsPristine();
            formControl.setErrors([]);
        }
        // 动态必填场景时生成器不再在formControl上生成必填规则
        // 因此validRules可能为空
        const ngFormControl = this.ngFormControls[propertyName];
        let validateRules = ngFormControl && ngFormControl.validRules || [];
        if (!Array.isArray(validateRules)) {
            validateRules = [validateRules];
        }
        const requiredRuleIndex = validateRules.findIndex((validateRule) => validateRule.type === ValidationTypes.REQUIRED);
        if (isRequired) {
            // 必填但控件没有必填规则，添加必填规则
            if (requiredRuleIndex == -1) {
                const validateRule = { type: ValidationTypes.REQUIRED, constraints: [true] };
                // 扩展属性，以生成正确的错误提示
                const displayFieldName = ngFormControl && (ngFormControl.name || ngFormControl.defaultI18nValue) || '';
                validateRule.targetId = ngFormControl && ngFormControl.id || null;
                validateRule.targetName = this.formGroupName;
                validateRule.property = displayFieldName;
                validateRule.field = ngFormControl && ngFormControl.binding;
                validateRules.push(validateRule);
            }
        }
        else {
            // 非必填场景，如果有必填规则，移除
            if (requiredRuleIndex !== -1) {
                validateRules.splice(requiredRuleIndex, 1);
            }
        }
        // 整理校验规则
        const validators = [];
        Array.prototype.forEach.call(validateRules, ((ruleObj) => {
            const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);
            if (validateFn) {
                validators.push(validateFn);
            }
        }));
        this.ngFormControls[propertyName].validRules = validateRules;
        this.controls[propertyName].setValidators(validators);
    }
    addFieldValidateRule(propertyName, message, expressionId, ruleType) {
        const formControl = this.controls[propertyName];
        if (formControl) {
            // 清空全部校验条件
            formControl.setErrors(null);
        }
        const ngFormControl = this.ngFormControls[propertyName];
        let validateRules = this.ngFormControls[propertyName].validRules;
        if (!validateRules) {
            validateRules = [];
        }
        if (!Array.isArray(validateRules)) {
            validateRules = [validateRules];
        }
        const index = validateRules.findIndex((rule) => rule && rule.expressionId === expressionId);
        if (index !== -1) {
            validateRules.splice(index, 1);
        }
        const bindingPath = this.frameContext.viewModel.bindingPath;
        const bindingPaths = bindingPath.split('/').filter(p => p);
        let fieldName = propertyName;
        if (bindingPaths.length !== 0) {
            const prefix = bindingPaths.join('/');
            const binding = ngFormControl.binding || '';
            const property = binding.split('.').join('/');
            fieldName = `${prefix}/${property}`;
        }
        const context = this.frameContext;
        const validateRule = {
            type: ruleType,
            message: message,
            expressionId: expressionId,
            constraints: [],
            bindingPath: bindingPaths.join('/'),
            eval: function (options) {
                return context.viewModel.expression.validate(expressionId, options);
            }
        };
        validateRules.push(validateRule);
        this.ngFormControls[propertyName].validRules = validateRules;
        // if (this.ngFormControls[propertyName] && validateRules.length > 0) {
        //   const validators: ValidatorFn[] = [];
        //   Array.prototype.forEach.call(validateRules, ((ruleObj: ValidateRule) => {
        //     const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);
        //     if (validateFn) {
        //       validators.push(validateFn);
        //     }
        //   }));
        //   this.controls[propertyName].setValidators(validators);
        // }
    }
    /**
     * 根据规则对象生成validator
     * @param ruleObj: ValidateRule
     */
    getValidatorByRuleObj(ruleObj, ngFormControl) {
        const { type, constraints = [], message = null } = ruleObj;
        const displayText = ngFormControl.name || ngFormControl.defaultI18nValue || '';
        const ruleHandlerObj = {
            required: (control) => {
                const value = control.value;
                let isValid = value !== '' && value !== null && value !== undefined && value !== '0001-01-01' && value !== '0001-01-01 00:00:00' && value !== '0001-01-01T00:00:00';
                const parentPaths = this.bindingPath.split('/').filter(p => p);
                const controlPaths = ngFormControl.binding.split('.');
                const paths = parentPaths.concat(controlPaths);
                const propInfo = this.getPropInfoByPath(paths);
                const isMultiLangInput = propInfo && propInfo.metadataInfo.enableMultiLangInput;
                if (isMultiLangInput) {
                    const currentLanguage = TranslateService.getCurrentLanguage();
                    const currentLangValue = value && value[currentLanguage];
                    isValid = currentLangValue !== '' && currentLangValue !== null && currentLangValue !== undefined && currentLangValue !== '0001-01-01' && currentLangValue !== '0001-01-01 00:00:00' && currentLangValue !== '0001-01-01T00:00:00';
                }
                const messageTemplate = ValidationTypes.getMessage(ValidationTypes.REQUIRED);
                const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                if (isValid && control.errors && control.errors.required) {
                    // 修复帮助映射早于控件赋值导致汇总错误消息时帮助必填错误未被清空的问题
                    delete control.errors.required;
                    this.isFormValid(paths.join('.'));
                }
                return isValid ? null : { required: { value: control.value, name: invalidMessage } };
            },
            maxLength: (control) => {
                const isInValid = control.value && control.value.toString().length > constraints[0];
                const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_LENGTH);
                const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                return isInValid ? { maxLength: { value: control.value, name: invalidMessage } } : null;
            },
            minLength: (control) => {
                const isInValid = control.value && control.value.toString().length < constraints[0];
                const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_LENGTH);
                const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                return isInValid ? { minLength: { value: control.value, name: invalidMessage } } : null;
            },
            minValue: (control) => {
                let isInValid = false;
                let invalidMessage = '';
                // 这里只做最小值判断，如果用户未输入则不应该做判断
                if (control.value === null || control.value === undefined) {
                    return null;
                }
                if (typeof control.value === 'number' && typeof constraints[0] === 'number') {
                    isInValid = control.value < constraints[0];
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MINVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                    // invalidMessage = `${ngFormControl.name}的值不应小于${constraints[0]}`;
                }
                else if (ngFormControl && ngFormControl.bigNumber === true) {
                    // 大数
                    const minValue = new BigNumber(constraints[0]);
                    const value = new BigNumber(control.value);
                    isInValid = minValue.isGreaterThan(value);
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MINVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                else {
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MIN_DATE);
                    // 假定为日期
                    // 不管控件的值为什么，只要条件不存咋或是null或0或undefined或""，则不对比大小，无意义
                    if (!constraints || constraints.length < 1 || !constraints[0]) {
                        return null;
                    }
                    if (control.value instanceof Date) {
                        isInValid = control.value < parseISO(constraints[0]);
                    }
                    else {
                        isInValid = parseISO(control.value) < parseISO(constraints[0]);
                    }
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                return isInValid ? { minValue: { value: control.value, name: invalidMessage } } : null;
            },
            maxValue: (control) => {
                let isInValid = false;
                let invalidMessage = '';
                if (control.value === null || control.value === undefined) {
                    return null;
                }
                if (typeof control.value === 'number' && typeof constraints[0] === 'number') {
                    isInValid = control.value > constraints[0];
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAXVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                    // invalidMessage = `${ngFormControl.name}的值不应大于${constraints[0]}`;
                }
                else if (ngFormControl && ngFormControl.bigNumber === true) {
                    // 大数
                    const maxValue = new BigNumber(constraints[0]);
                    const value = new BigNumber(control.value);
                    isInValid = maxValue.isLessThan(value);
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAXVALUE);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                else {
                    // 假定为日期
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MAX_DATE);
                    if (control.value instanceof Date) {
                        isInValid = control.value > new Date(constraints[0]);
                        // invalidMessage = `${ngFormControl.name}的值不应晚于${constraints[0]}`;
                    }
                    else {
                        isInValid = new Date(control.value) > new Date(constraints[0]);
                        // invalidMessage = `${ngFormControl.name}的值不应早于${constraints[0]}`;
                    }
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                return isInValid ? { maxValue: { value: control.value, name: invalidMessage } } : null;
            },
            exclude: (control) => {
                const isValid = typeof control.value === 'string' && !this.validatorJs.contains(control.value, constraints[0]);
                const messageTemplate = ValidationTypes.getMessage(ValidationTypes.EXCLUDE);
                const invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                return isValid ? null : { exclude: { value: control.value, name: invalidMessage } };
            },
            matches: (control) => {
                const value = (control.value === null || control.value === undefined) ? '' : control.value.toString();
                const isValid = value === '' ? true : this.validatorJs.matches(value, constraints[0]);
                let invalidMessage = message;
                if (!invalidMessage) {
                    const messageTemplate = ValidationTypes.getMessage(ValidationTypes.MATCHES);
                    invalidMessage = ValidationExecutor.replaceMessageSpecialTokens(messageTemplate, ruleObj, control.value);
                }
                return isValid ? null : { matches: { value: control.value, name: invalidMessage } };
            }
        };
        return ruleHandlerObj[type];
    }
    /**
     * 搜集属性装饰器
     */
    collectMetadatas() {
        this.ngValidateForm = this.frameContext.metadata.form ? MetadataUtil.translateMetadataByName(this.frameContext.metadata.form, this.translateService, ['formGroupName']) :
            MetadataUtil.getClassMetadataByNameWithTranslate(this.constructor, NG_VALIDATE_FORM, this.translateService, ['formGroupName']);
        this.ngFormControls = this.collectionFormControlMetadats(this.frameContext.metadata.formControls);
        this.ngChildForms = this.frameContext.metadata.subForms || MetadataUtil.getPropsMetadatasByName(this.constructor, NG_CHILD_FORM);
    }
    collectionFormControlMetadats(preloadMetadata = null) {
        const metadatas = preloadMetadata ? MetadataUtil.translateMetadatasByName(preloadMetadata, this.translateService, ['name']) :
            MetadataUtil.getPropsMetadatasByNameWithTranslate(this.constructor, NG_FORM_CONTROL, this.translateService, ['name']);
        // 向验证规则中附加表单信息，用于显示验证提示。
        if (metadatas) {
            Object.keys(metadatas).forEach((propName) => {
                const ngFormControl = metadatas[propName];
                const displayFieldName = ngFormControl.name || ngFormControl.defaultI18nValue || '';
                const formControlId = ngFormControl.id;
                if (Array.isArray(ngFormControl.validRules)) {
                    ngFormControl.validRules.forEach((validationRule) => {
                        validationRule.targetId = formControlId;
                        validationRule.targetName = this.formGroupName;
                        validationRule.property = displayFieldName;
                        validationRule.field = ngFormControl.binding;
                    });
                }
            });
        }
        return metadatas;
    }
    // 获取grid中每条数据的formControl
    getGridItemControl(propName, value) {
        const createControlFromRules = propertyName => {
            const validators = [];
            // 设置form中定义的验证规则
            if (this.ngFormControls[propertyName] && Array.isArray(this.ngFormControls[propertyName].validRules)) {
                Array.prototype.forEach.call(this.ngFormControls[propertyName].validRules, ((ruleObj) => {
                    const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propertyName]);
                    if (validateFn) {
                        validators.push(validateFn);
                    }
                }));
            }
            return new FormControl(value, { validators: validators, updateOn: 'blur' });
        };
        return createControlFromRules(propName);
    }
    // 根据实体属性名获取界面绑定的属性名
    getDomPropertyNameByEntityProp(propertyName, prefix = '') {
        let domPropertyName = '';
        Object.keys(this.ngFormControls).forEach(key => {
            const binding = `${prefix}${this.ngFormControls[key].binding}`;
            if (binding === propertyName) {
                domPropertyName = key;
            }
        });
        return domPropertyName;
    }
    /**
     * 创建FormControl
     */
    createControls() {
        Object.keys(this.ngFormControls).forEach((propName) => {
            const ngFormControl = this.ngFormControls[propName];
            const validators = [];
            // 设置form中定义的验证规则
            if (Array.isArray(this.ngFormControls[propName].validRules)) {
                Array.prototype.forEach.call(this.ngFormControls[propName].validRules, (ruleObj => {
                    const validateFn = this.getValidatorByRuleObj(ruleObj, this.ngFormControls[propName]);
                    if (validateFn) {
                        validators.push(validateFn);
                    }
                }));
            }
            const updateOn = ngFormControl.updateOn ? ngFormControl.updateOn : 'blur';
            const control = new FormControl(null, { validators: validators, updateOn: updateOn });
            if (ngFormControl.binding) {
                this.setUpBindingDataPipeline(control, ngFormControl.binding, ngFormControl.valueConverter);
            }
            this.controls[propName] = control;
            this[propName] = control;
        });
    }
    /**
     * 创建FormGroup
     */
    createChildForms() {
        Object.keys(this.ngChildForms).forEach((propName) => {
            const ngFormGroup = this.ngChildForms[propName];
            // 构造子Form
            const formGroup = new ngFormGroup.formType();
            formGroup.init(this.bindingData, this.bindingPath, this.frameContext);
            this.controls[propName] = formGroup;
            this[propName] = formGroup;
        });
    }
    /*
    * 新增FormControls
     */
    addControls(column, converter) {
        const updateOn = column && column.editor && column.editor.updateOn ? column.editor.updateOn : 'blur';
        const formControl = new FormControl('', { updateOn: updateOn });
        const fieldPath = column.dataField;
        // 日期格式  需要格式化
        // this.setUpBindingDataPipeline(formControl, fieldPath, converter);
        if (column.editor && column.editor.binding) {
            this.setUpBindingDataPipeline(formControl, fieldPath, converter);
            this.controls[column.editor.binding.path] = formControl;
            this[column.editor.binding.path] = formControl;
        }
    }
    /**
     * 搭建control和table之间的通道
     * @param control 控件
     * @param bindingFieldPath 绑定的字段名
     */
    setUpBindingDataPipeline(control, bindingFieldPath, converter) {
        if (!this.bindingData) {
            throw Error('当前组件上下文中找不到BindingData，请检查！');
        }
        // 如果converter存在，则写入上下文，Converter中可能会需要从injector中获取当前语言信息
        // __FRAME_CONTEXT__ 未使用
        /*if (converter) {
          converter['__FRAME_CONTEXT__'] = this.frameContext;
        }*/
        // 将bindignPath与bindingFieldPath合并
        if (this.bindingPath.length > 1) {
            bindingFieldPath = this.bindingPath.substr(1).replace(/\//g, '.') + '.' + bindingFieldPath;
        }
        const bindingPaths = bindingFieldPath.split('.');
        const propertyName = bindingPaths[bindingPaths.length - 1];
        // 设置初始值
        const initValue = this.getValueFromBindingData(bindingPaths, converter);
        control.setValue(initValue);
        // 设置初始值
        // BindingData => control
        this.bindingData.changes.pipe(takeUntil(this.destroy$)).pipe(filter((change) => {
            const bindingObject = this.bindingData.getObject();
            const changePath = change.path.join('.');
            if (change.isUdt) {
                return changePath === bindingFieldPath;
            }
            if (change.type === ChangeType.ValueChanged) {
                // path完全匹配
                return changePath === bindingFieldPath;
            }
            else if (change.type === ChangeType.Load || change.type === ChangeType.SelectionChanged || change.type === ChangeType.Remove || change.type === ChangeType.Update) {
                // 对于ObjectChanged、SelectionChanged，匹配到父级
                const changePathWithDot = changePath === '' ? changePath : changePath + '.';
                // 主表新增或切换时，重置错误信息
                if (change && change.type === ChangeType.Load) {
                    this.resetCardValidMsg();
                }
                return bindingFieldPath.indexOf(changePathWithDot) === 0;
            }
            else if (change.type === ChangeType.UpdateErrors) {
                if (changePath === bindingFieldPath) {
                    this.cardControls[propertyName] = this.cardControls[propertyName] || {};
                    if (bindingFieldPath && this.controls[propertyName]) {
                        if (bindingObject.primaryKeyValue === change.id) {
                            this.cardControls[propertyName].errors = change.errors;
                        }
                        else {
                            // 只更新当前行的错误提示信息，不是当前行的不处理，放到最终的实体校验里面
                            // this.cardControls[propertyName].errors = null;
                            // this.isFormValid(bindingFieldPath);
                        }
                    }
                    // 没有错误时
                    if (!change.path || !bindingFieldPath || !change.errors) {
                        this.cardControls[propertyName].errors = null;
                        this.isFormValid(bindingFieldPath);
                    }
                    return false;
                }
            }
            else {
                return false;
            }
        })).subscribe((change) => {
            let fullEntityProp = propertyName;
            // udt字段展示时需要将父级属性名和自身属性名用'_'连接
            let pathPrefix = '';
            if (change.isUdt) {
                if (change.isGrid) {
                    // grid 将从表主字段去除
                    change.path.shift();
                }
                if (change.path.length) {
                    pathPrefix = change.path.join('.');
                }
                fullEntityProp = pathPrefix;
            }
            const value = this.bindingData.getValue(bindingPaths, false);
            const newControlValue = converter ? converter.convertFrom(value) : value;
            // 设置FormControl
            const domPropName = this.getDomPropertyNameByEntityProp(fullEntityProp);
            this.cardControls[domPropName] = this.cardControls[domPropName] || {};
            if (change.errors) {
                this.cardControls[domPropName].errors = change.errors;
            }
            // dataGrid保存时，根据id，创建formControl，并设置错误对象
            if (change.id) {
                if (this.controlIdMap[change.id] && Object.keys(this.controlIdMap[change.id]).length === 0) {
                    this.controlIdMap[change.id] = {};
                }
                this.controlIdMap[change.id] = this.controlIdMap[change.id] || {};
                if (change.errors) {
                    this.controlIdMap[change.id][domPropName] = {
                        errors: change.errors
                    };
                }
            }
            // 如果和控件上的值一样，则不再更新控件的值
            if (JSON.stringify(control.value) === JSON.stringify(newControlValue)) {
                return;
            }
            // 正则判断是否为日期
            control.setValue(newControlValue);
        });
        // control => BindingData
        control.valueChanges.pipe(takeUntil(this.destroy$)).subscribe((value) => {
            const oldBindingValue = this.bindingData.getValue(bindingPaths);
            // 如果是日期，比较年月日是否相等，相等则不重新赋值
            if (value && value.constructor && value.constructor.name === 'Date') {
                const isValidDate = !isNaN(value);
                if (!isValidDate) {
                    return;
                }
                if (oldBindingValue && converter) {
                    const oldValue = converter.convertFrom(oldBindingValue);
                    if (this.compareDate(value, oldValue) === true) {
                        return;
                    }
                }
            }
            // 如果是日期，比较年月日是否相等，相等则不重新赋值
            if (this.isDate(converter) === true) {
                if (DateUtil.isEqual(value, oldBindingValue) === true) {
                    return;
                }
            }
            // 如果和BindingData上的值和控件最新的值一样，则不再更新BindingData
            const newBindingValue = converter ? converter.convertTo(value) : value;
            if (JSON.stringify(oldBindingValue) === JSON.stringify(newBindingValue)) {
                return;
            }
            // if (!this.isFormValid(propertyName, null, null, false)) {
            //   const errors = this.cardControls[propertyName] && this.cardControls[propertyName].errors || {};
            //   this.bindingData.setValue(bindingPaths, newBindingValue, false, true, errors);
            // } else {
            this.clearBackEndMessages(propertyName);
            const emitEventToView = this.frameContext.appContext.runMode === RunMode.highSpeed;
            this.bindingData.setValue(bindingPaths, newBindingValue, emitEventToView, true, null, { frameContext: this.frameContext });
            //}
        });
    }
    /**
     * 判断是否是日期字段
     * 1、目前没有办法判断一个字段是否是日期，只能根据Converter来判断；
     * 2、Devkit不能依赖KendoBinding，不能直接判断DateConverter；
     * 3、不能使用constructor.name,压缩后name变了；
     * 4、暂时根据format属性来判断，一旦其他Converter有format，则判断失效，暂时没有这种情况
     * @todo
     * 为日期字段添加注解，根据注解来判断
     */
    isDate(converter) {
        let isDateConverter = false;
        // if (converter && converter.constructor && converter.constructor.name === 'DateConverter') {
        //   isDateConverter = true;
        // }
        if (converter && converter.hasOwnProperty('format') === true) {
            isDateConverter = true;
        }
        return isDateConverter;
    }
    /**
     * 比较日期（只比较年月日）
     */
    compareDate(srcDate, dstDate) {
        if (!srcDate || !dstDate) {
            return srcDate === dstDate;
        }
        const isEqual = srcDate.getFullYear() === dstDate.getFullYear()
            && srcDate.getMonth() === dstDate.getMonth()
            && srcDate.getDate() === dstDate.getDate()
            && srcDate.getHours() === dstDate.getHours()
            && srcDate.getMinutes() === dstDate.getMinutes()
            && srcDate.getSeconds() === dstDate.getSeconds();
        return isEqual;
    }
    getPropInfoByPath(path) {
        const entityType = this.frameContext && this.frameContext.repository.entityType || null;
        if (entityType) {
            const dataTypeInfo = new DataTypeInfo(entityType);
            const propInfo = dataTypeInfo.getPropInfoByPath(path);
            return propInfo;
            // const isMultiLangInput = propInfo.metadataInfo.enableMultiLangInput;
        }
        return null;
    }
    /**
     * 从BindingData中获取指定路径的值
     */
    getValueFromBindingData(bindingPaths, converter) {
        const value = this.bindingData.getValue(bindingPaths);
        const converteredValue = converter ? converter.convertFrom(value) : value;
        return converteredValue;
    }
    getEntityValueChangingListeners() {
        const listeners = {};
        Object.keys(this.ngFormControls).forEach((propName) => {
            const ngFormControl = this.ngFormControls[propName];
            if (ngFormControl.valueChanging) {
                listeners[ngFormControl.binding] = ngFormControl.valueChanging;
            }
        });
        return listeners;
    }
    getEntityValueChangedListeners() {
        const listeners = {};
        Object.keys(this.ngFormControls).forEach((propName) => {
            const ngFormControl = this.ngFormControls[propName];
            if (ngFormControl.valueChanged) {
                listeners[ngFormControl.binding] = ngFormControl.valueChanged;
            }
        });
        return listeners;
    }
    /**
     * 获取所有的前端验证规则
     * @description
     * 返回的校验规则为Map<string,ValidateRule>,其中key为全路径，从bindingPath开始到实体属性，以/分隔
     */
    getValidationRules() {
        const validatoinRules = new Map();
        let parentPath = this.bindingPath;
        if (parentPath.length && parentPath === '/') {
            parentPath = '';
        }
        Object.keys(this.ngFormControls).forEach((propName) => {
            // const fieldName = `${parentPath}/${propName}`;
            if (this.isShowPropMap[propName] === true || Object.keys(this.isShowPropMap).length === 0) {
                const ngFormControl = this.ngFormControls[propName];
                const displayFieldName = ngFormControl.name || ngFormControl.defaultI18nValue || '';
                const bindingPathArray = ngFormControl.binding ? ngFormControl.binding.split('.') : [propName];
                const fieldNameArray = [parentPath, ...bindingPathArray];
                const fieldName = fieldNameArray.join('/');
                if (Array.isArray(ngFormControl.validRules) && ngFormControl.validRules.length > 0) {
                    let validationrulesToAdd = [...ngFormControl.validRules];
                    // if (this.excludeRuleTypes && this.excludeRuleTypes[propName] && this.excludeRuleTypes[propName].length > 0) {
                    //   validationrulesToAdd = ngFormControl.validRules.filter((item) => !this.excludeRuleTypes[propName].includes(item.type));
                    // }
                    validationrulesToAdd.forEach((validationRule) => {
                        validationRule.targetId = ngFormControl.id;
                        validationRule.targetName = this.formGroupName;
                        validationRule.property = displayFieldName;
                        validationRule.field = ngFormControl.binding;
                        validationRule.fullPath = fieldName;
                        if (this.frameContext) {
                            validationRule.frameContext = this.frameContext;
                        }
                    });
                    validatoinRules.set(fieldName, validationrulesToAdd);
                }
                else {
                    validatoinRules.set(fieldName, [{
                            type: 'setDisplayInfo',
                            targetId: ngFormControl.id,
                            targetName: this.formGroupName,
                            property: displayFieldName,
                            fullPath: fieldName,
                            frameContext: this.frameContext
                        }]);
                }
            }
        });
        return validatoinRules;
    }
    setTranslateService(translateService) {
        if (!translateService) {
            return;
        }
        this.translate = translateService;
        ValidationTypes.setCurrentLanguage(translateService.getCurrentLanguage());
    }
    /**
     * 重置控件状态
     */
    resetFormControls() {
        if (Object.keys(this.controls).length > 0) {
            Object.keys(this.controls).forEach((prop) => {
                const formControl = this.controls[prop];
                formControl.markAsUntouched();
                formControl.markAsPristine();
            });
        }
    }
    clearBackEndMessages(domPropertyName) {
        if (domPropertyName) {
            if (this.cardControls[domPropertyName] && this.cardControls[domPropertyName]['errors'] && !!Object.keys(this.cardControls[domPropertyName]['errors']).find(item => item.startsWith('message-'))) {
                const messageKeys = Object.keys(this.cardControls[domPropertyName]['errors']).filter(item => item.startsWith('message-'));
                const errors = Object.assign({}, this.cardControls[domPropertyName]['errors']);
                messageKeys.forEach(key => delete errors[key]);
                this.cardControls[domPropertyName] = { errors: errors };
            }
        }
        else {
            Object.keys(this.cardControls).forEach(propertyName => {
                if (this.cardControls[propertyName] && this.cardControls[propertyName]['errors'] && !!Object.keys(this.cardControls[propertyName]['errors']).find(item => item.startsWith('message-'))) {
                    const messageKeys = Object.keys(this.cardControls[propertyName]['errors']).filter(item => item.startsWith('message-'));
                    const errors = Object.assign({}, this.cardControls[propertyName]['errors']);
                    messageKeys.forEach(key => delete errors[key]);
                    this.cardControls[propertyName] = { errors: errors };
                }
            });
        }
    }
}
/**
 * 存放所有实例的映射
 */
Form.insMap = {};
Form.decorators = [
    { type: Injectable }
];
/** @nocollapse */
Form.ctorParameters = () => [];
export { Form };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2Zvcm0vZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrQ0FBa0M7QUFDbEMsT0FBTyxFQUFjLFVBQVUsRUFBdUIsTUFBTSxlQUFlLENBQUM7QUFFNUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBZSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVoRSxPQUFPLEVBQXVCLFVBQVUsRUFBaUIsTUFBTSx1QkFBdUIsQ0FBQztBQUV2RixPQUFPLEVBQ0wsZUFBZSxFQUNmLGFBQWEsRUFDRyxnQkFBZ0IsRUFDakMsTUFBTSxjQUFjLENBQUM7QUFFdEIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTFDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUN2RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUM3RSxPQUFPLEtBQUssV0FBVyxNQUFNLFdBQVcsQ0FBQztBQUV6QyxPQUFPLEVBQWdCLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDOUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFHN0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3BDOztHQUVHO0FBQ0gsTUFDTSxJQUFLLFNBQVEsU0FBUztJQW9DMUI7O09BRUc7SUFDSDtRQUNFLEtBQUssQ0FBQyxF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ZGlzYWJsZTogbWF4LWxpbmUtbGVuZ3RoXHJcbmltcG9ydCB7IEVsZW1lbnRSZWYsIEluamVjdGFibGUsIEluamVjdG9yLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgVmFsaWRhdG9yRm4gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7XHJcbmltcG9ydCB7IE1ldGFkYXRhVXRpbCwgUFJPUF9NRVRBREFUQSB9IGZyb20gJy4uL21ldGFkYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnLi4vZnJhbWUvaW5kZXgnO1xyXG5pbXBvcnQgeyBCaW5kaW5nRGF0YSwgQ2hhbmdlLCBDaGFuZ2VUeXBlLCBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi4vYmluZGluZy1kYXRhL2luZGV4JztcclxuaW1wb3J0IHsgVmFsaWRhdGVSdWxlLCBWYWxpZGF0aW9uIH0gZnJvbSAnLi4vZW50aXR5L3ZhbGlkYXRvci90eXBlcyc7XHJcbmltcG9ydCB7XHJcbiAgTkdfRk9STV9DT05UUk9MLCBOZ0Zvcm1Db250cm9sLFxyXG4gIE5HX0NISUxEX0ZPUk0sIE5nQ2hpbGRGb3JtLFxyXG4gIE5nVmFsaWRhdGVGb3JtLCBOR19WQUxJREFURV9GT1JNXHJcbn0gZnJvbSAnLi9kZWNvcmF0b3JzJztcclxuaW1wb3J0IHsgQ29udHJvbFZhbHVlQ29udmVydGVyIH0gZnJvbSAnLi9jb250cm9sX3ZhbHVlX2NvbnZlcnRlcic7XHJcbmltcG9ydCB7IERhdGVVdGlsIH0gZnJvbSAnLi4vdXRpbHMvaW5kZXgnO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGUgfSBmcm9tICcuLi9pMThuL3RyYW5zbGF0ZSc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25UeXBlcyB9IGZyb20gJy4uL2VudGl0eS92YWxpZGF0b3IvdmFsaWRhdGlvbl90eXBlcyc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25FeGVjdXRvciB9IGZyb20gJy4uL2VudGl0eS92YWxpZGF0b3IvdmFsaWRhdGlvbl9leGVjdXRvcic7XHJcbmltcG9ydCAqIGFzIFZhbGlkYXRvckpTIGZyb20gJ3ZhbGlkYXRvcic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4uL2VudGl0eSc7XHJcbmltcG9ydCB7IERhdGFQcm9wSW5mbywgRGF0YVR5cGVJbmZvLCBSdW5Nb2RlIH0gZnJvbSAnLi4vY29yZSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9pMThuL3RyYW5zbGF0ZV9zZXJ2aWNlJztcclxuaW1wb3J0IHsgUnVsZVR5cGUgfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgSURpc3Bvc2FibGUgfSBmcm9tICcuLi9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBwYXJzZUlTTyB9IGZyb20gJ2RhdGUtZm5zJztcclxuLyoqXHJcbiAqIOihqOWNleWumuS5iVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBGb3JtIGV4dGVuZHMgRm9ybUdyb3VwIGltcGxlbWVudHMgSURpc3Bvc2FibGUsIE9uRGVzdHJveSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtmOaUvuaJgOacieWunuS+i+eahOaYoOWwhFxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbnNNYXA6IHtcclxuICAgIFtmb3JtTmFtZTogc3RyaW5nXTogRm9ybVxyXG4gIH0gPSB7fTtcclxuXHJcbiAgLyoqXHJcbiAgICog5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBmb3JtR3JvdXBOYW1lKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubmdWYWxpZGF0ZUZvcm0gPyB0aGlzLm5nVmFsaWRhdGVGb3JtLmZvcm1Hcm91cE5hbWUgOiAnJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWQr+eUqOihqOWNlemqjOivgVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgZW5hYmxlVmFsaWRhdGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5uZ1ZhbGlkYXRlRm9ybSA/IHRoaXMubmdWYWxpZGF0ZUZvcm0uZW5hYmxlVmFsaWRhdGUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgdHJhbnNsYXRlU2VydmljZSgpOiBUcmFuc2xhdGUge1xyXG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmjpLpmaTnmoTmoKHpqozop4TliJnnsbvlnotcclxuICAgKi9cclxuICAvLyBwcml2YXRlIGV4Y2x1ZGVSdWxlVHlwZXM6IHsgW3Byb3BlcnR5TmFtZTogc3RyaW5nXTogc3RyaW5nW10gfTtcclxuXHJcbiAgLyoqXHJcbiAgICog5LiK5LiL5paHXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0O1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKHt9LCBudWxsLCBudWxsKTtcclxuICAgIHRoaXMuY29udHJvbElkTWFwID0ge307XHJcbiAgICB0aGlzLmNhcmRDb250cm9scyA9IHt9O1xyXG4gICAgdGhpcy5pc1Nob3dQcm9wTWFwID0ge307XHJcbiAgICB0aGlzLmRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgLy8gdGhpcy5leGNsdWRlUnVsZVR5cGVzID0ge307XHJcbiAgfVxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlKCk7XHJcbiAgfVxyXG4gIGRpc3Bvc2Uob3B0aW9ucz86IGFueSkge1xyXG4gICAgaWYgKHRoaXMuZGVzdHJveSQpIHtcclxuICAgICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuICAgICAgdGhpcy5kZXN0cm95JCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBGb3JtLmluc01hcFt0aGlzLmNvbnN0cnVjdG9yLm5hbWVdID0gbnVsbDtcclxuICAgIHRoaXMuZnJhbWVDb250ZXh0ID0gbnVsbDtcclxuICAgIHRoaXMuYmluZGluZ0RhdGEgPSBudWxsO1xyXG4gICAgdGhpcy5uZ0NoaWxkRm9ybXMgPSBudWxsO1xyXG4gICAgdGhpcy5tZXRhRGF0YXMgPSBudWxsO1xyXG4gICAgdGhpcy5uZ0Zvcm1Db250cm9scyA9IHt9O1xyXG4gICAgdGhpcy5jb250cm9scyA9IHt9O1xyXG4gICAgdGhpcy5kaXNwb3NlVmFsaWRhdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57uR5a6a5pWw5o2uXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YTtcclxuICAvKipcclxuICAgKiDnu5Hlrprot6/lvoRcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgYmluZGluZ1BhdGg6IHN0cmluZztcclxuICAvKipcclxuICAgKiBGb3Jt5o+P6L+wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBuZ1ZhbGlkYXRlRm9ybTogTmdWYWxpZGF0ZUZvcm07XHJcbiAgLyoqXHJcbiAgICog57uT5p6E5o+P6L+w77yaRm9ybUNvbnRyb2xcclxuICAgKi9cclxuICBwdWJsaWMgbmdGb3JtQ29udHJvbHM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBOZ0Zvcm1Db250cm9sIH07XHJcbiAgLyoqXHJcbiAgICog5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIG1ldGFEYXRhczogeyBbcHJvcE5hbWU6IHN0cmluZ106IGFueSB9O1xyXG4gIC8qKlxyXG4gICAqIOe7k+aehOaPj+i/sO+8mkZvcm1Hcm91cFxyXG4gICAqL1xyXG4gIHByaXZhdGUgbmdDaGlsZEZvcm1zOiB7IFtwcm9wTmFtZTogc3RyaW5nXTogTmdDaGlsZEZvcm0gfTtcclxuICAvKipcclxuICAgKiDlrZjmlL7mn5DmnaHmlbDmja7kuIvnmoTlsZ7mgKfplJnor6/kv6Hmga9cclxuICAgKi9cclxuICBwcml2YXRlIGNvbnRyb2xJZE1hcDoge1xyXG4gICAgW2lkOiBzdHJpbmddOiB7XHJcbiAgICAgIFtwcm9wTmFtZTogc3RyaW5nXTogb2JqZWN0XHJcbiAgICB9XHJcbiAgfTtcclxuICAvKipcclxuICAgKiDnlKjkuo7lrZjlgqjlsZ7mgKfplJnor69cclxuICAgKi9cclxuICBwcml2YXRlIGNhcmRDb250cm9sczogb2JqZWN0O1xyXG4gIHByaXZhdGUgcmFpc2VkQnlWYWxpZGF0ZUVmZmVjdG9yID0gZmFsc2U7XHJcbiAgcHVibGljIGlzU2hvd1ZhbGlkYXRpb25Nc2cgPSBmYWxzZTtcclxuXHJcbiAgLy8g5bGe5oCn5Zyo6aG16Z2i5LiK5bGV56S654q25oCB55qEbWFwLGtleeaYr2h0bWzkuK3kvb/nlKjnmoTlsZ7mgKflkI1cclxuICBwdWJsaWMgaXNTaG93UHJvcE1hcDoge1xyXG4gICAgW2RvbVByb3BlcnR5TmFtZTogc3RyaW5nXTogYm9vbGVhblxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGU7XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdG9ySnMgPSBWYWxpZGF0b3JKUy5kZWZhdWx0O1xyXG4gIHByaXZhdGUgZGVzdHJveSQ6IFN1YmplY3Q8YW55PjtcclxuICAvKipcclxuICAgKiDlsIZmb3JtQ29udHJvbOeahOmUmeivr+S/oeaBr+abtOaWsOWIsGNhcmRDb250cm9s5LiKXHJcbiAgICovXHJcbiAgc3RhdGljIHVwZGF0ZUVycm9ycyhwcm9wZXJ0eU5hbWUsIGVycm9yT2JqLCBpZCwgdmFsdWU/LCBpc0dyaWQ/KSB7XHJcbiAgICBPYmplY3Qua2V5cyhGb3JtLmluc01hcCkuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICBjb25zdCBmb3JtID0gRm9ybS5pbnNNYXBba2V5XTtcclxuICAgICAgaWYgKCFmb3JtKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpZCkge1xyXG4gICAgICAgIGZvcm0uc2V0Q29udHJvbFZhbHVlKHByb3BlcnR5TmFtZSwgdmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChmb3JtLmVuYWJsZVZhbGlkYXRlKSB7XHJcbiAgICAgICAgZm9ybS5pc0Zvcm1WYWxpZChwcm9wZXJ0eU5hbWUsIGVycm9yT2JqLCBpZCwgaXNHcmlkKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiuvue9rmRvbeWxnuaAp+S4uuaYvuekuueKtuaAgVxyXG4gICAqIEBwYXJhbSBkb21Qcm9wZXJ0eU5hbWUgZG9t5bGe5oCnXHJcbiAgICovXHJcbiAgcHVibGljIHNldElzU2hvd21hcChkb21Qcm9wZXJ0eU5hbWU6IHN0cmluZykge1xyXG4gICAgdGhpcy5pc1Nob3dQcm9wTWFwW2RvbVByb3BlcnR5TmFtZV0gPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldFNob3dWYWxpZGF0aW9uTXNnKGZsYWc6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMucmFpc2VkQnlWYWxpZGF0ZUVmZmVjdG9yID0gZmFsc2U7XHJcbiAgICB0aGlzLmlzU2hvd1ZhbGlkYXRpb25Nc2cgPSBmbGFnO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldENvbnRyb2xWYWx1ZShrZXk6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCA9IHRoaXMuYmluZGluZ0RhdGEgJiYgdGhpcy5iaW5kaW5nRGF0YS5nZXRPYmplY3QoKSB8fCBudWxsO1xyXG4gICAgaWYgKGJpbmRpbmdPYmplY3QgJiYgYmluZGluZ09iamVjdC5jb250cm9sTWFwKSB7XHJcbiAgICAgIGJpbmRpbmdPYmplY3QuY29udHJvbE1hcFtrZXldID0gdGhpcy5nZXRHcmlkSXRlbUNvbnRyb2woa2V5LCB2YWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrmRvbeWxnuaAp+WQjeensOiOt+WPlumUmeivr+S/oeaBr1xyXG4gICAqIEBwYXJhbSBkb21Qcm9wZXJ0eU5hbWUgZG9t5bGe5oCn5ZCN56ewXHJcbiAgICovXHJcbiAgcHVibGljIGdldENhcmRDb250cm9sRXJyb3JzKGRvbVByb3BlcnR5TmFtZT86IHN0cmluZyk6IG9iamVjdCB7XHJcbiAgICB0aGlzLnNldElzU2hvd21hcChkb21Qcm9wZXJ0eU5hbWUpO1xyXG4gICAgcmV0dXJuIHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV0gJiYgdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXS5lcnJvcnM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWtl+auteagoemqjOmUmeivr1xyXG4gICAqIEBwYXJhbSBkb21Qcm9wZXJ0eU5hbWUgXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHVibGljIGdldEZvcm1Db250cm9sRXJyb3JzKGRvbVByb3BlcnR5TmFtZT86IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV0gJiYgdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXS5lcnJvcnM7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRHcmlkQ29udHJvbEVycm9ycyhkb21Qcm9wZXJ0eU5hbWU6IHN0cmluZywgaWQ6IHN0cmluZyk6IG9iamVjdCB7XHJcbiAgICB0aGlzLnNldElzU2hvd21hcChkb21Qcm9wZXJ0eU5hbWUpO1xyXG4gICAgcmV0dXJuIHRoaXMuY29udHJvbElkTWFwW2lkXSAmJiB0aGlzLmNvbnRyb2xJZE1hcFtpZF1bZG9tUHJvcGVydHlOYW1lXSAmJiB0aGlzLmNvbnRyb2xJZE1hcFtpZF1bZG9tUHJvcGVydHlOYW1lXVsnZXJyb3JzJ107XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNGb3JtVmFsaWQocHJvcGVydHlOYW1lPzogc3RyaW5nLCBlcnJvck9iaj86IG9iamVjdCwgaWQ/OiBzdHJpbmcsIGlzR3JpZD86IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgIGxldCBwcmVmaXggPSAnJztcclxuICAgIC8vIOWmguaenOagoemqjOS/oeaBr+aYr+eUseihqOi+vuW8j+inpuWPkeeahO+8jOS4jeWkhOeQhlxyXG4gICAgaWYgKHRoaXMucmFpc2VkQnlWYWxpZGF0ZUVmZmVjdG9yKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGlzR3JpZENvbXBvbmVudCA9IHRoaXMuZnJhbWVDb250ZXh0LmZyYW1lQ29tcG9uZW50LmlzR3JpZENvbXBvbmVudDtcclxuICAgIGlmIChpc0dyaWRDb21wb25lbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBpc0dyaWQgPSBpc0dyaWRDb21wb25lbnQ7XHJcbiAgICB9XHJcbiAgICAvL+aLvOaOpeWtkOihqGZyb250Tm9kZUNvZGVcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IHRoaXMuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgIGlmIChiaW5kaW5nUGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBwcmVmaXggPSBiaW5kaW5nUGF0aHMuam9pbignLicpLmNvbmNhdCgnLicpO1xyXG4gICAgfVxyXG4gICAgLy8g55WM6Z2i5LiK57uR5a6a55qE5a2X5q615ZCNXHJcbiAgICBjb25zdCBkb21Qcm9wZXJ0eU5hbWUgPSB0aGlzLmdldERvbVByb3BlcnR5TmFtZUJ5RW50aXR5UHJvcChwcm9wZXJ0eU5hbWUsIHByZWZpeCk7XHJcbiAgICAvLyDkvKDkuoblsZ7mgKflkI3vvIzkvYbljbTmi7/kuI3liLBkb23lkI3np7DvvIzor7TmmI7lvZPliY3nu4Tku7bkuK3msqHmnInor6XlrZfmrrXlr7nlupTnmoTmjqfku7ZcclxuICAgIGlmIChwcm9wZXJ0eU5hbWUgJiYgIWRvbVByb3BlcnR5TmFtZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIC8vIOiLpeeVjOmdouS4iuS4jeWtmOWcqOW9k+WJjeWxnuaAp++8iOWKqOaAgeWIl++8ie+8jOS4jei/m+ihjOmqjOivgVxyXG4gICAgaWYgKGRvbVByb3BlcnR5TmFtZSAmJiAhdGhpcy5pc1Nob3dQcm9wTWFwW2RvbVByb3BlcnR5TmFtZV0pIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBsZXQgaXNWYWxpZCA9IHRydWU7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRPYmplY3QoKTtcclxuICAgIGNvbnN0IGN1cnJlbnRJZCA9IGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgY29uc3QgaXNTdWJGb3JtID0gdGhpcy5iaW5kaW5nUGF0aCAhPT0gJy8nO1xyXG4gICAgY29uc3QgYmluZGluZ0xpc3QgPSB0aGlzLmJpbmRpbmdEYXRhLmdldExpc3QoKTtcclxuXHJcbiAgICAvLyDlrZDooajljZXml6DmlbDmja7ml7bvvIzkv53lrZjml7bkvJrmnInkuIDmnaHnqbrmlbDmja7pmLvnoo3pqozor4HvvIzmiYDku6XmraTlpITot7Pov4flj6rmnInkuIDooYznmoTmg4XlhrVcclxuICAgIGlmIChpc1N1YkZvcm0gJiYgYmluZGluZ0xpc3QuaW5uZXJMaXN0LnNpemUgPT09IDApIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICAvLyDml6DmlbDmja7ml7bkuI3lgZrmoKHpqoxcclxuICAgIGlmICghY3VycmVudElkKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgLy8gZGF0YUdyaWTkv67mlLnml7bvvIzmoLnmja5pZO+8jOWIm+W7umZvcm1Db250cm9s77yM5bm26K6+572u6ZSZ6K+v5a+56LGhXHJcbiAgICBpZiAoaWQgJiYgZG9tUHJvcGVydHlOYW1lKSB7XHJcbiAgICAgIC8vIGlmICh0aGlzLmNvbnRyb2xJZE1hcFtpZF0gJiYgT2JqZWN0LmtleXModGhpcy5jb250cm9sSWRNYXBbaWRdKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgLy8gICB0aGlzLmNvbnRyb2xJZE1hcFtpZF0gPSB7fTtcclxuICAgICAgLy8gfVxyXG4gICAgICB0aGlzLmNvbnRyb2xJZE1hcFtpZF0gPSB0aGlzLmNvbnRyb2xJZE1hcFtpZF0gfHwge307XHJcbiAgICAgIHRoaXMuY29udHJvbElkTWFwW2lkXVtkb21Qcm9wZXJ0eU5hbWVdID0ge1xyXG4gICAgICAgIGVycm9yczogZXJyb3JPYmpcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlsIZncmlk55qERm9ybUNvbnRyb2zlkIzmraXliLDnlYzpnaLlsZXnpLrnlKjnmoRjb250cm9sSURNYXDkuK1cclxuICAgIC8vIGNvbnN0IGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gYmluZGluZ0xpc3QuY3VycmVudEl0ZW0gYXMgQmluZGluZ09iamVjdDtcclxuICAgIGNvbnN0IGN1cnJlbnRCaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0ID0gYmluZGluZ09iamVjdDtcclxuXHJcbiAgICBpZiAoaWQgJiYgaWQgIT09IGN1cnJlbnRJZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6aqM6K+B5YWo6YOo5a2X5q615pe277yM5riF56m65bey5pyJ55qE6ZSZ6K+v5L+h5oGvXHJcbiAgICBpZiAoIXByb3BlcnR5TmFtZSAmJiAhaWQpIHtcclxuICAgICAgY3VycmVudEJpbmRpbmdPYmplY3QuY29udHJvbE1hcCA9IHt9O1xyXG4gICAgICB0aGlzLmNvbnRyb2xJZE1hcCA9IHt9O1xyXG4gICAgICB0aGlzLmNhcmRDb250cm9scyA9IHt9O1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmtleXModGhpcy5jb250cm9scykuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmlzU2hvd1Byb3BNYXBba2V5XSAhPT0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyDlkIzmraXlrp7kvZPplJnor6/kv6Hmga9cclxuICAgICAgaWYgKGtleSA9PT0gZG9tUHJvcGVydHlOYW1lKSB7XHJcbiAgICAgICAgLy8g5a6e5L2T6aqM6K+B55qE5L+h5oGv55u05o6l6LWL5YC8XHJcbiAgICAgICAgaWYgKGVycm9yT2JqICYmIE9iamVjdC5rZXlzKGVycm9yT2JqKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAvLyDljaHniYfnmoTplJnor69cclxuICAgICAgICAgIGlmICghaXNHcmlkKSB7XHJcbiAgICAgICAgICAgIC8vIOWunuS9k+WxguWQjOatpei/h+adpeeahOmUmeivr++8jOebruWJjee7k+aehHtydWxlVHlwZTp7bmFtZTonJyx2YWx1ZTonJyxvcmlnaW5hbEVycm9yczpbVmFsaWRhdGlvbkVycm9yXX1977yM5YW25LitbmFtZeS4uuagoemqjOWksei0peeahOmUmeivr+S/oeaBr1xyXG4gICAgICAgICAgICAvLyDpgY3ljobplJnor6/vvIzlsIZ2YWxpZGF0b3Lov5Tlm57nmoTplJnor6/kv6Hmga/lm73pmYXljJZcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMoZXJyb3JPYmopLm1hcCgodmFsaWRUeXBlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uRXJyb3I6IFZhbGlkYXRpb25FcnJvciA9IGVycm9yT2JqW3ZhbGlkVHlwZV0gJiYgZXJyb3JPYmpbdmFsaWRUeXBlXVsnZXJyb3InXSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRlUnVsZTogVmFsaWRhdGVSdWxlID0gdmFsaWRhdGlvbkVycm9yLnJ1bGU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZ0Zvcm1Db250cm9sID0gdGhpcy5nZXRuZ0Zvcm1Db250cm9sQnlCaW5kaW5nKHZhbGlkYXRlUnVsZS5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmdGb3JtQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0ZVJ1bGUucHJvcGVydHkgPSBuZ0Zvcm1Db250cm9sLm5hbWUgfHwgbmdGb3JtQ29udHJvbC5kZWZhdWx0STE4blZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0ZVJ1bGUudGFyZ2V0SWQgPSBuZ0Zvcm1Db250cm9sLmlkO1xyXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0ZVJ1bGUudGFyZ2V0TmFtZSA9IHRoaXMuZm9ybUdyb3VwTmFtZTtcclxuICAgICAgICAgICAgICAgICAgLy8g5L+u5q2j5qCh6aqM5b+F5aGr6KGo6L6+5byP57G75Z6L5ZKM5aSa6K+t6LWE5rqQ5Lita2V55LiN5LiA6Ie055qE6Zeu6aKYXHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGZpeGVkVmFsaWRUeXBlID0gdmFsaWRUeXBlID09PSAncmVxdWlyZScgPyAncmVxdWlyZWQnIDogdmFsaWRUeXBlO1xyXG4gICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShmaXhlZFZhbGlkVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCB2YWxpZGF0ZVJ1bGUsIG5nRm9ybUNvbnRyb2wubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JPYmpbdmFsaWRUeXBlXVsnbmFtZSddID0gaW52YWxpZE1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHRvZG86IG5nRm9ybUNvbnRyb2zmmoLml7bkuI3orr7nva5cclxuICAgICAgICAgICAgICAgIC8vIGVycm9yT2JqWyduYW1lJ10gPSB0aGlzLmdldEVycm9yQnlSdWxlVHlwZSh2YWxpZFR5cGUsIHZhbGlkYXRlUnVsZSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNba2V5XSA9IHtcclxuICAgICAgICAgICAgICBlcnJvcnM6IGVycm9yT2JqXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW2tleV0gPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuY29udHJvbHNba2V5XSAmJiB0aGlzLmNvbnRyb2xzW2tleV0uZXJyb3JzICYmIE9iamVjdC5rZXlzKHRoaXMuY29udHJvbHNba2V5XS5lcnJvcnMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyDlsIbplJnor6/lkIzmraXliLDnlYzpnaLlsZXnpLrnmoTkvY3nva5cclxuICAgICAgICAvLyDorqTkuLrmjqfku7bplJnor6/lj6rljIXlkKvplJnor6/nsbvlnovvvIzpgJrov4fplJnor6/nsbvlnovojrflj5blhbfkvZPnmoTplJnor6/kv6Hmga9cclxuICAgICAgICB0aGlzLmNhcmRDb250cm9sc1trZXldID0ge1xyXG4gICAgICAgICAgZXJyb3JzOiB7XHJcbiAgICAgICAgICAgIC4uLnRoaXMuY2FyZENvbnRyb2xzW2tleV0gJiYgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnMsXHJcbiAgICAgICAgICAgIC4uLnRoaXMuY29udHJvbHNba2V5XS5lcnJvcnNcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDlpITnkIblj6rlvIDlkK/liY3nq6/moKHpqozvvIzmnKrlnKhCReS4iuWQr+eUqOW/heWhq+agoemqjOeahOaDheWGtVxyXG4gICAgaWYgKHRoaXMuY2FyZENvbnRyb2xzKSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2FyZENvbnRyb2xzW2tleV0gJiYgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnMpIHtcclxuICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzW2tleV0uZXJyb3JzKS5mb3JFYWNoKHZhbGlkVHlwZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnNbdmFsaWRUeXBlXSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAvLyDojrflj5blr7nlupTnmoTmoKHpqozkv6Hmga9cclxuICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZVJ1bGVzOiBWYWxpZGF0ZVJ1bGUgfCBWYWxpZGF0ZVJ1bGVbXSA9IHRoaXMubmdGb3JtQ29udHJvbHNba2V5XS52YWxpZFJ1bGVzIHx8IFtdO1xyXG4gICAgICAgICAgICAgIGNvbnN0IHJ1bGVzOiBWYWxpZGF0ZVJ1bGVbXSA9IFtdLmNvbmNhdCh2YWxpZGF0ZVJ1bGVzKTtcclxuICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZVJ1bGU6IFZhbGlkYXRlUnVsZSA9IHJ1bGVzLmZpbmQoaXRlbSA9PiBpdGVtLnR5cGUgPT09IHZhbGlkVHlwZSk7XHJcbiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlUnVsZSkge1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdGVSdWxlLnRhcmdldE5hbWUgPSB0aGlzLmZvcm1Hcm91cE5hbWU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZSh2YWxpZFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgdmFsaWRhdGVSdWxlLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9yc1trZXldID0geyB2YWx1ZTogdGhpcy5jb250cm9sc1trZXldICYmIHRoaXMuY29udHJvbHNba2V5XS52YWx1ZSB8fCAnJywgbmFtZTogaW52YWxpZE1lc3NhZ2UgfTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgaWYgKHRoaXMuY2FyZENvbnRyb2xzW2tleV0gJiYgdGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnMgJiYgT2JqZWN0LmtleXModGhpcy5jYXJkQ29udHJvbHNba2V5XS5lcnJvcnMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBpc1ZhbGlkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGlzVmFsaWQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOihqOWNlemUmeivr+S/oeaBr1xyXG4gICAqIEBwYXJhbSBlcnJvcnMg6ZSZ6K+v5raI5oGvXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUZvcm1FcnJvcnMoZXJyb3JzOiB7IFtkb21Qcm9wZXJ0eU5hbWU6IHN0cmluZ106IHsgZXJyb3JzOiB7IFtydWxlVHlwZTogc3RyaW5nXTogeyBuYW1lOiBzdHJpbmcsIFtwcm9wOiBzdHJpbmddOiBhbnkgfSB9IH0gfSwgZm9yY2VTaG93OiBib29sZWFuID0gZmFsc2UsIGZyb206IHN0cmluZyA9ICcnKSB7XHJcbiAgICBpZiAoZnJvbSAmJiBmcm9tID09PSAnYmFja2VuZCcpIHtcclxuICAgICAgdGhpcy5jbGVhckJhY2tlbmRFcnJvcigpO1xyXG4gICAgfVxyXG4gICAgLy8g5Y6f5p2l5piv5ZCm5bey57uP5pi+56S66ZSZ6K+v77yM5aaC5p6c5bey57uP5pi+56S65LqG5YiZ5aKe5Yqg77yM5ZCm5YiZ5pu/5o2iXHJcbiAgICBpZiAodGhpcy5pc1Nob3dWYWxpZGF0aW9uTXNnID09PSB0cnVlIHx8IGZvcmNlU2hvdyA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLmlzU2hvd1ZhbGlkYXRpb25Nc2cgPSB0cnVlO1xyXG4gICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yc1trZXldLmVycm9ycyAmJiBPYmplY3Qua2V5cyhlcnJvcnNba2V5XS5lcnJvcnMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIC8vIOWmguaenOaOp+S7tuacrOi6q+ayoeaciemUmeivr++8jOWImeebtOaOpeS9v+eUqOWklumDqOS8oOmAkui/h+adpeeahOmUmeivr++8jOWQpuWImeWQiOW5tumUmeivr1xyXG4gICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNba2V5XSA9IHtcclxuICAgICAgICAgICAgZXJyb3JzOiB7XHJcbiAgICAgICAgICAgICAgLi4udGhpcy5jYXJkQ29udHJvbHNba2V5XSAmJiB0aGlzLmNhcmRDb250cm9sc1trZXldLmVycm9ycyxcclxuICAgICAgICAgICAgICAuLi5lcnJvcnNba2V5XS5lcnJvcnNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g56e76Zmk5YaF5a2Y5Lit55qE6ZSZ6K+v5L+h5oGvXHJcbiAgICAgICAgICB0aGlzLmNhcmRDb250cm9sc1trZXldID0ge1xyXG4gICAgICAgICAgICBlcnJvcnM6IHt9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgLy8g6YeN572u5o6n5Lu26ZSZ6K+v5L+h5oGvXHJcbiAgICAgICAgICB0aGlzLmNvbnRyb2xzW2tleV0uc2V0RXJyb3JzKG51bGwpO1xyXG4gICAgICAgICAgdGhpcy5jb250cm9sc1trZXldLm1hcmtBc1RvdWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmuIXnqbrlkI7nq6/mtojmga9cclxuICAgKi9cclxuICBwdWJsaWMgY2xlYXJCYWNrZW5kRXJyb3IoKSB7XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLmNhcmRDb250cm9scykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICBjb25zdCBlcnJvcnMgPSB0aGlzLmNhcmRDb250cm9sc1trZXldICYmIHRoaXMuY2FyZENvbnRyb2xzW2tleV0uZXJyb3JzIHx8IG51bGw7XHJcbiAgICAgIGlmIChlcnJvcnMpIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZvckVhY2goZXJyb3JUeXBlID0+IHtcclxuICAgICAgICAgIGlmIChlcnJvclR5cGUgJiYgZXJyb3JUeXBlLnN0YXJ0c1dpdGgoJ2JhY2tlbmQtbWVzc2FnZS0nKSkge1xyXG4gICAgICAgICAgICBkZWxldGUgZXJyb3JzW2Vycm9yVHlwZV07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGVycm9ycyAmJiBPYmplY3Qua2V5cyhlcnJvcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgZGVsZXRlIHRoaXMuY2FyZENvbnRyb2xzW2tleV0uZXJyb3JzO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmNhcmRDb250cm9sc1trZXldID0ge307XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja7lrp7kvZPlsZ7mgKfojrflj5ZuZ0Zvcm1Db250cm9sXHJcbiAgICogQHBhcmFtIGJpbmRpbmcg5o6n5Lu257uR5a6a55qE5a6e5L2T5bGe5oCn5ZCNXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRuZ0Zvcm1Db250cm9sQnlCaW5kaW5nKGJpbmRpbmc6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5uZ0Zvcm1Db250cm9scykuZmluZCgobmdGb3JtQ29udHJvbDogTmdGb3JtQ29udHJvbCkgPT4gbmdGb3JtQ29udHJvbC5iaW5kaW5nICYmIG5nRm9ybUNvbnRyb2wuYmluZGluZyA9PT0gYmluZGluZyk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZGlzcG9zZVZhbGlkYXRpb24oKSB7XHJcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5jb25zdHJ1Y3RvcltQUk9QX01FVEFEQVRBXTtcclxuICAgIGlmIChwcm9wZXJ0aWVzICYmIE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgT2JqZWN0LmtleXMocHJvcGVydGllcykuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICBjb25zdCBwcm9wcyA9IHRoaXMuY29uc3RydWN0b3JbUFJPUF9NRVRBREFUQV1ba2V5XSBhcyBhbnlbXTtcclxuICAgICAgICBpZiAocHJvcHMgJiYgcHJvcHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgcHJvcHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbS52YWxpZFJ1bGVzICYmIEFycmF5LmlzQXJyYXkoaXRlbS52YWxpZFJ1bGVzKSAmJiBpdGVtLnZhbGlkUnVsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGl0ZW0udmFsaWRSdWxlcyA9IGl0ZW0udmFsaWRSdWxlcy5maWx0ZXIoaXRlbSA9PiAhKGl0ZW0uZXZhbCAmJiB0eXBlb2YgKGl0ZW0uZXZhbCkgPT09ICdmdW5jdGlvbicpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qC55o2uZG9t5bGe5oCn5ZKM5qCh6aqM57G75Z6L6I635Y+W6ZSZ6K+v5L+h5oGvXHJcbiAgICogQHBhcmFtIGRvbVByb3BlcnR5IGRvbeWxnuaAp1xyXG4gICAqIEBwYXJhbSB2YWxpZGF0ZVJ1bGVUeXBlIOagoemqjOexu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RXJyb3JNZXNzYWdlKGRvbVByb3BlcnR5OiBzdHJpbmcsIHZhbGlkYXRlUnVsZVR5cGU6IHN0cmluZykge1xyXG4gICAgY29uc3QgZm9ybUNvbnRyb2wgPSB0aGlzLm5nRm9ybUNvbnRyb2xzW2RvbVByb3BlcnR5XTtcclxuICAgIGlmIChmb3JtQ29udHJvbCkge1xyXG4gICAgICBjb25zdCB2YWxpZFJ1bGVzID0gZm9ybUNvbnRyb2wudmFsaWRSdWxlcztcclxuICAgICAgY29uc3QgcnVsZXMgPSBbXTtcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbGlkUnVsZXMpKSB7XHJcbiAgICAgICAgcnVsZXMucHVzaCh2YWxpZFJ1bGVzKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBydWxlcy5wdXNoKC4uLnZhbGlkUnVsZXMpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHJ1bGUgPSBydWxlcy5maW5kKGl0ZW0gPT4gaXRlbS50eXBlID09PSB2YWxpZGF0ZVJ1bGVUeXBlKTtcclxuICAgICAgaWYgKHJ1bGUpIHtcclxuICAgICAgICBjb25zdCBjb250cm9sTmFtZSA9IGZvcm1Db250cm9sLm5hbWU7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UodmFsaWRhdGVSdWxlVHlwZSk7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlLCBjb250cm9sTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIneWni+WMlkZvcm1cclxuICAgKiBAcGFyYW0gY29udGV4dCDkuIrkuIvmlodcclxuICAgKi9cclxuICBwdWJsaWMgaW5pdChiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsIGJpbmRpbmdQYXRoOiBzdHJpbmcsIGZyYW1lQ29udGV4dD86IEZyYW1lQ29udGV4dCkge1xyXG4gICAgdGhpcy5mcmFtZUNvbnRleHQgPSBmcmFtZUNvbnRleHQ7XHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhID0gYmluZGluZ0RhdGE7XHJcbiAgICB0aGlzLmJpbmRpbmdQYXRoID0gYmluZGluZ1BhdGg7XHJcbiAgICAvLyDmoKHpqozkv6Hmga/lj5jljJbml7bph43nva7ljaHniYfmoKHpqozkv6Hmga9cclxuICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwgJiYgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLnZlcmlmeWNhdGlvbkNoYW5nZWQpIHtcclxuICAgICAgdGhpcy5mcmFtZUNvbnRleHQudmlld01vZGVsLnZlcmlmeWNhdGlvbkNoYW5nZWQuc3Vic2NyaWJlKCh2ZXJpZnljYXRpb25zOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgIGlmICghdmVyaWZ5Y2F0aW9ucyB8fCB2ZXJpZnljYXRpb25zLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgIHRoaXMucmVzZXRDYXJkVmFsaWRNc2coKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5idWlsZEZvcm0oKTtcclxuICAgIC8vIEB0b2RvOiDov5nnp43mlrnlvI/lgZprZXnvvIzlpoLmnpzohJrmnKzooqvljovnvKnvvIzlrZjlnKjpo47pmalcclxuICAgIEZvcm0uaW5zTWFwW3RoaXMuY29uc3RydWN0b3IubmFtZV0gPSB0aGlzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKDooajljZVcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRGb3JtKCkge1xyXG4gICAgdGhpcy5jb2xsZWN0TWV0YWRhdGFzKCk7XHJcbiAgICAvLyB0aGlzLmNyZWF0ZUNoaWxkRm9ybUFycmF5cygpO1xyXG4gICAgdGhpcy5jcmVhdGVDaGlsZEZvcm1zKCk7XHJcbiAgICB0aGlzLmNyZWF0ZUNvbnRyb2xzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDph43nva7ooajljZXpqozor4Hkv6Hmga9cclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXRDYXJkVmFsaWRNc2coKTogdm9pZCB7XHJcbiAgICB0aGlzLmNhcmRDb250cm9scyA9IHt9O1xyXG4gICAgLy8g5YmU6ZmkIOWIl+ihqOS4reaWsOWinuWQjuWPlua2iCzliKDpmaTnmoTpobnlr7nlupTnmoRjb250cm9s5L+h5oGvXHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLmNvbnRyb2xJZE1hcCkuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5iaW5kaW5nRGF0YS5nZXRMaXN0KCkuaW5uZXJMaXN0Lm1hcCh4ID0+IHguaWQpLmluY2x1ZGVzKGlkKSkge1xyXG4gICAgICAgIGRlbGV0ZSB0aGlzLmNvbnRyb2xJZE1hcFtpZF07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5yZXNldEZvcm1Db250cm9scygpO1xyXG4gICAgdGhpcy5zZXRTaG93VmFsaWRhdGlvbk1zZyhmYWxzZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOabtOaWsOWtl+auteagoemqjOinhOWImVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5bGe5oCn5ZCNXHJcbiAgICogQHBhcmFtIGlzUmVxdWlyZWQg5piv5ZCm5b+F5aGrXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUZpZWxkVmFsaWRhdGVSdWxlKHByb3BlcnR5TmFtZTogc3RyaW5nLCBpc1JlcXVpcmVkOiBib29sZWFuKSB7XHJcbiAgICBpZiAoIXByb3BlcnR5TmFtZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBmb3JtQ29udHJvbDogQWJzdHJhY3RDb250cm9sID0gdGhpcy5jb250cm9sc1twcm9wZXJ0eU5hbWVdO1xyXG5cclxuICAgIC8vIOa4heepuuWFqOmDqOagoemqjOadoeS7tlxyXG4gICAgaWYgKGZvcm1Db250cm9sKSB7XHJcbiAgICAgIGZvcm1Db250cm9sLmNsZWFyVmFsaWRhdG9ycygpO1xyXG4gICAgICBmb3JtQ29udHJvbC5tYXJrQXNVbnRvdWNoZWQoKTtcclxuICAgICAgZm9ybUNvbnRyb2wubWFya0FzUHJpc3RpbmUoKTtcclxuICAgICAgZm9ybUNvbnRyb2wuc2V0RXJyb3JzKFtdKTtcclxuICAgIH1cclxuICAgIC8vIOWKqOaAgeW/heWhq+WcuuaZr+aXtueUn+aIkOWZqOS4jeWGjeWcqGZvcm1Db250cm9s5LiK55Sf5oiQ5b+F5aGr6KeE5YiZXHJcbiAgICAvLyDlm6DmraR2YWxpZFJ1bGVz5Y+v6IO95Li656m6XHJcbiAgICBjb25zdCBuZ0Zvcm1Db250cm9sID0gdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgbGV0IHZhbGlkYXRlUnVsZXM6IFZhbGlkYXRlUnVsZSB8IFZhbGlkYXRlUnVsZVtdID0gbmdGb3JtQ29udHJvbCAmJiBuZ0Zvcm1Db250cm9sLnZhbGlkUnVsZXMgfHwgW107XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsaWRhdGVSdWxlcykpIHtcclxuICAgICAgdmFsaWRhdGVSdWxlcyA9IFt2YWxpZGF0ZVJ1bGVzXTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcXVpcmVkUnVsZUluZGV4ID0gdmFsaWRhdGVSdWxlcy5maW5kSW5kZXgoKHZhbGlkYXRlUnVsZTogVmFsaWRhdGVSdWxlKSA9PiB2YWxpZGF0ZVJ1bGUudHlwZSA9PT0gVmFsaWRhdGlvblR5cGVzLlJFUVVJUkVEKTtcclxuICAgIGlmIChpc1JlcXVpcmVkKSB7XHJcbiAgICAgIC8vIOW/heWhq+S9huaOp+S7tuayoeacieW/heWhq+inhOWIme+8jOa3u+WKoOW/heWhq+inhOWImVxyXG4gICAgICBpZiAocmVxdWlyZWRSdWxlSW5kZXggPT0gLTEpIHtcclxuXHJcbiAgICAgICAgY29uc3QgdmFsaWRhdGVSdWxlOiBWYWxpZGF0ZVJ1bGUgPSB7IHR5cGU6IFZhbGlkYXRpb25UeXBlcy5SRVFVSVJFRCwgY29uc3RyYWludHM6IFt0cnVlXSB9O1xyXG4gICAgICAgIC8vIOaJqeWxleWxnuaAp++8jOS7peeUn+aIkOato+ehrueahOmUmeivr+aPkOekulxyXG4gICAgICAgIGNvbnN0IGRpc3BsYXlGaWVsZE5hbWUgPSBuZ0Zvcm1Db250cm9sICYmIChuZ0Zvcm1Db250cm9sLm5hbWUgfHwgbmdGb3JtQ29udHJvbC5kZWZhdWx0STE4blZhbHVlKSB8fCAnJztcclxuICAgICAgICB2YWxpZGF0ZVJ1bGUudGFyZ2V0SWQgPSBuZ0Zvcm1Db250cm9sICYmIG5nRm9ybUNvbnRyb2wuaWQgfHwgbnVsbDtcclxuICAgICAgICB2YWxpZGF0ZVJ1bGUudGFyZ2V0TmFtZSA9IHRoaXMuZm9ybUdyb3VwTmFtZTtcclxuICAgICAgICB2YWxpZGF0ZVJ1bGUucHJvcGVydHkgPSBkaXNwbGF5RmllbGROYW1lO1xyXG4gICAgICAgIHZhbGlkYXRlUnVsZS5maWVsZCA9IG5nRm9ybUNvbnRyb2wgJiYgbmdGb3JtQ29udHJvbC5iaW5kaW5nO1xyXG4gICAgICAgIHZhbGlkYXRlUnVsZXMucHVzaCh2YWxpZGF0ZVJ1bGUpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDpnZ7lv4XloavlnLrmma/vvIzlpoLmnpzmnInlv4Xloavop4TliJnvvIznp7vpmaRcclxuICAgICAgaWYgKHJlcXVpcmVkUnVsZUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgIHZhbGlkYXRlUnVsZXMuc3BsaWNlKHJlcXVpcmVkUnVsZUluZGV4LCAxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8g5pW055CG5qCh6aqM6KeE5YiZXHJcbiAgICBjb25zdCB2YWxpZGF0b3JzOiBWYWxpZGF0b3JGbltdID0gW107XHJcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKHZhbGlkYXRlUnVsZXMsICgocnVsZU9iajogVmFsaWRhdGVSdWxlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbGlkYXRlRm4gPSB0aGlzLmdldFZhbGlkYXRvckJ5UnVsZU9iaihydWxlT2JqLCB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgICBpZiAodmFsaWRhdGVGbikge1xyXG4gICAgICAgIHZhbGlkYXRvcnMucHVzaCh2YWxpZGF0ZUZuKTtcclxuICAgICAgfVxyXG4gICAgfSkpO1xyXG4gICAgdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wZXJ0eU5hbWVdLnZhbGlkUnVsZXMgPSB2YWxpZGF0ZVJ1bGVzO1xyXG4gICAgdGhpcy5jb250cm9sc1twcm9wZXJ0eU5hbWVdLnNldFZhbGlkYXRvcnModmFsaWRhdG9ycyk7XHJcbiAgfVxyXG4gIHB1YmxpYyBhZGRGaWVsZFZhbGlkYXRlUnVsZShwcm9wZXJ0eU5hbWU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBleHByZXNzaW9uSWQ6IHN0cmluZywgcnVsZVR5cGU6IFJ1bGVUeXBlKSB7XHJcbiAgICBjb25zdCBmb3JtQ29udHJvbDogQWJzdHJhY3RDb250cm9sID0gdGhpcy5jb250cm9sc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgaWYgKGZvcm1Db250cm9sKSB7XHJcbiAgICAgIC8vIOa4heepuuWFqOmDqOagoemqjOadoeS7tlxyXG4gICAgICBmb3JtQ29udHJvbC5zZXRFcnJvcnMobnVsbCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBuZ0Zvcm1Db250cm9sID0gdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wZXJ0eU5hbWVdO1xyXG4gICAgbGV0IHZhbGlkYXRlUnVsZXMgPSB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0udmFsaWRSdWxlcztcclxuICAgIGlmICghdmFsaWRhdGVSdWxlcykge1xyXG4gICAgICB2YWxpZGF0ZVJ1bGVzID0gW107XHJcbiAgICB9XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsaWRhdGVSdWxlcykpIHtcclxuICAgICAgdmFsaWRhdGVSdWxlcyA9IFt2YWxpZGF0ZVJ1bGVzXTtcclxuICAgIH1cclxuICAgIGNvbnN0IGluZGV4ID0gdmFsaWRhdGVSdWxlcy5maW5kSW5kZXgoKHJ1bGU6IFZhbGlkYXRlUnVsZSkgPT4gcnVsZSAmJiBydWxlLmV4cHJlc3Npb25JZCA9PT0gZXhwcmVzc2lvbklkKTtcclxuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgdmFsaWRhdGVSdWxlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ1BhdGggPSB0aGlzLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgbGV0IGZpZWxkTmFtZSA9IHByb3BlcnR5TmFtZTtcclxuICAgIGlmIChiaW5kaW5nUGF0aHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgIGNvbnN0IHByZWZpeCA9IGJpbmRpbmdQYXRocy5qb2luKCcvJyk7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmcgPSBuZ0Zvcm1Db250cm9sLmJpbmRpbmcgfHwgJyc7XHJcbiAgICAgIGNvbnN0IHByb3BlcnR5ID0gYmluZGluZy5zcGxpdCgnLicpLmpvaW4oJy8nKTtcclxuICAgICAgZmllbGROYW1lID0gYCR7cHJlZml4fS8ke3Byb3BlcnR5fWA7XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5mcmFtZUNvbnRleHQ7XHJcbiAgICBjb25zdCB2YWxpZGF0ZVJ1bGU6IFZhbGlkYXRlUnVsZSA9IHtcclxuICAgICAgdHlwZTogcnVsZVR5cGUsXHJcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXHJcbiAgICAgIGV4cHJlc3Npb25JZDogZXhwcmVzc2lvbklkLFxyXG4gICAgICBjb25zdHJhaW50czogW10sXHJcbiAgICAgIGJpbmRpbmdQYXRoOiBiaW5kaW5nUGF0aHMuam9pbignLycpLFxyXG4gICAgICBldmFsOiBmdW5jdGlvbiAob3B0aW9ucz86IGFueSkge1xyXG4gICAgICAgIHJldHVybiBjb250ZXh0LnZpZXdNb2RlbC5leHByZXNzaW9uLnZhbGlkYXRlKGV4cHJlc3Npb25JZCwgb3B0aW9ucyk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB2YWxpZGF0ZVJ1bGVzLnB1c2godmFsaWRhdGVSdWxlKTtcclxuICAgIHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXS52YWxpZFJ1bGVzID0gdmFsaWRhdGVSdWxlcztcclxuICAgIC8vIGlmICh0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0gJiYgdmFsaWRhdGVSdWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAvLyAgIGNvbnN0IHZhbGlkYXRvcnM6IFZhbGlkYXRvckZuW10gPSBbXTtcclxuICAgIC8vICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbCh2YWxpZGF0ZVJ1bGVzLCAoKHJ1bGVPYmo6IFZhbGlkYXRlUnVsZSkgPT4ge1xyXG4gICAgLy8gICAgIGNvbnN0IHZhbGlkYXRlRm4gPSB0aGlzLmdldFZhbGlkYXRvckJ5UnVsZU9iaihydWxlT2JqLCB0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgLy8gICAgIGlmICh2YWxpZGF0ZUZuKSB7XHJcbiAgICAvLyAgICAgICB2YWxpZGF0b3JzLnB1c2godmFsaWRhdGVGbik7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICB9KSk7XHJcbiAgICAvLyAgIHRoaXMuY29udHJvbHNbcHJvcGVydHlOYW1lXS5zZXRWYWxpZGF0b3JzKHZhbGlkYXRvcnMpO1xyXG4gICAgLy8gfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja7op4TliJnlr7nosaHnlJ/miJB2YWxpZGF0b3JcclxuICAgKiBAcGFyYW0gcnVsZU9iajogVmFsaWRhdGVSdWxlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRWYWxpZGF0b3JCeVJ1bGVPYmoocnVsZU9iajogVmFsaWRhdGVSdWxlLCBuZ0Zvcm1Db250cm9sOiBOZ0Zvcm1Db250cm9sKTogVmFsaWRhdG9yRm4ge1xyXG4gICAgY29uc3QgeyB0eXBlLCBjb25zdHJhaW50cyA9IFtdLCBtZXNzYWdlID0gbnVsbCB9ID0gcnVsZU9iajtcclxuICAgIGNvbnN0IGRpc3BsYXlUZXh0ID0gbmdGb3JtQ29udHJvbC5uYW1lIHx8IG5nRm9ybUNvbnRyb2wuZGVmYXVsdEkxOG5WYWx1ZSB8fCAnJztcclxuICAgIGNvbnN0IHJ1bGVIYW5kbGVyT2JqID0ge1xyXG4gICAgICByZXF1aXJlZDogKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0+IHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgbGV0IGlzVmFsaWQgPSB2YWx1ZSAhPT0gJycgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gJzAwMDEtMDEtMDEnICYmIHZhbHVlICE9PSAnMDAwMS0wMS0wMSAwMDowMDowMCcgJiYgdmFsdWUgIT09ICcwMDAxLTAxLTAxVDAwOjAwOjAwJztcclxuICAgICAgICBjb25zdCBwYXJlbnRQYXRocyA9IHRoaXMuYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICBjb25zdCBjb250cm9sUGF0aHMgPSBuZ0Zvcm1Db250cm9sLmJpbmRpbmcuc3BsaXQoJy4nKTtcclxuICAgICAgICBjb25zdCBwYXRocyA9IHBhcmVudFBhdGhzLmNvbmNhdChjb250cm9sUGF0aHMpO1xyXG4gICAgICAgIGNvbnN0IHByb3BJbmZvID0gdGhpcy5nZXRQcm9wSW5mb0J5UGF0aChwYXRocyk7XHJcbiAgICAgICAgY29uc3QgaXNNdWx0aUxhbmdJbnB1dCA9IHByb3BJbmZvICYmIHByb3BJbmZvLm1ldGFkYXRhSW5mby5lbmFibGVNdWx0aUxhbmdJbnB1dDtcclxuICAgICAgICBpZiAoaXNNdWx0aUxhbmdJbnB1dCkge1xyXG4gICAgICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlID0gVHJhbnNsYXRlU2VydmljZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRMYW5nVmFsdWUgPSB2YWx1ZSAmJiB2YWx1ZVtjdXJyZW50TGFuZ3VhZ2VdO1xyXG4gICAgICAgICAgaXNWYWxpZCA9IGN1cnJlbnRMYW5nVmFsdWUgIT09ICcnICYmIGN1cnJlbnRMYW5nVmFsdWUgIT09IG51bGwgJiYgY3VycmVudExhbmdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIGN1cnJlbnRMYW5nVmFsdWUgIT09ICcwMDAxLTAxLTAxJyAmJiBjdXJyZW50TGFuZ1ZhbHVlICE9PSAnMDAwMS0wMS0wMSAwMDowMDowMCcgJiYgY3VycmVudExhbmdWYWx1ZSAhPT0gJzAwMDEtMDEtMDFUMDA6MDA6MDAnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuUkVRVUlSRUQpO1xyXG4gICAgICAgIGNvbnN0IGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIGlmIChpc1ZhbGlkICYmIGNvbnRyb2wuZXJyb3JzICYmIGNvbnRyb2wuZXJyb3JzLnJlcXVpcmVkKSB7XHJcbiAgICAgICAgICAvLyDkv67lpI3luK7liqnmmKDlsITml6nkuo7mjqfku7botYvlgLzlr7zoh7TmsYfmgLvplJnor6/mtojmga/ml7bluK7liqnlv4XloavplJnor6/mnKrooqvmuIXnqbrnmoTpl67pophcclxuICAgICAgICAgIGRlbGV0ZSBjb250cm9sLmVycm9ycy5yZXF1aXJlZDtcclxuICAgICAgICAgIHRoaXMuaXNGb3JtVmFsaWQocGF0aHMuam9pbignLicpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQgPyBudWxsIDogeyByZXF1aXJlZDogeyB2YWx1ZTogY29udHJvbC52YWx1ZSwgbmFtZTogaW52YWxpZE1lc3NhZ2UgfSB9O1xyXG4gICAgICB9LFxyXG4gICAgICBtYXhMZW5ndGg6IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgbnVsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgaXNJblZhbGlkID0gY29udHJvbC52YWx1ZSAmJiBjb250cm9sLnZhbHVlLnRvU3RyaW5nKCkubGVuZ3RoID4gY29uc3RyYWludHNbMF07XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UoVmFsaWRhdGlvblR5cGVzLk1BWF9MRU5HVEgpO1xyXG4gICAgICAgIGNvbnN0IGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIHJldHVybiBpc0luVmFsaWQgPyB7IG1heExlbmd0aDogeyB2YWx1ZTogY29udHJvbC52YWx1ZSwgbmFtZTogaW52YWxpZE1lc3NhZ2UgfSB9IDogbnVsbDtcclxuICAgICAgfSxcclxuICAgICAgbWluTGVuZ3RoOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGwgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlzSW5WYWxpZCA9IGNvbnRyb2wudmFsdWUgJiYgY29udHJvbC52YWx1ZS50b1N0cmluZygpLmxlbmd0aCA8IGNvbnN0cmFpbnRzWzBdO1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NQVhfTEVOR1RIKTtcclxuICAgICAgICBjb25zdCBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICByZXR1cm4gaXNJblZhbGlkID8geyBtaW5MZW5ndGg6IHsgdmFsdWU6IGNvbnRyb2wudmFsdWUsIG5hbWU6IGludmFsaWRNZXNzYWdlIH0gfSA6IG51bGw7XHJcbiAgICAgIH0sXHJcbiAgICAgIG1pblZhbHVlOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGwgPT4ge1xyXG4gICAgICAgIGxldCBpc0luVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICBsZXQgaW52YWxpZE1lc3NhZ2UgPSAnJztcclxuICAgICAgICAvLyDov5nph4zlj6rlgZrmnIDlsI/lgLzliKTmlq3vvIzlpoLmnpznlKjmiLfmnKrovpPlhaXliJnkuI3lupTor6XlgZrliKTmlq1cclxuICAgICAgICBpZiAoY29udHJvbC52YWx1ZSA9PT0gbnVsbCB8fCBjb250cm9sLnZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGNvbnRyb2wudmFsdWUgPT09ICdudW1iZXInICYmIHR5cGVvZiBjb25zdHJhaW50c1swXSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgIGlzSW5WYWxpZCA9IGNvbnRyb2wudmFsdWUgPCBjb25zdHJhaW50c1swXTtcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NSU5WQUxVRSk7XHJcbiAgICAgICAgICBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICAgIC8vIGludmFsaWRNZXNzYWdlID0gYCR7bmdGb3JtQ29udHJvbC5uYW1lfeeahOWAvOS4jeW6lOWwj+S6jiR7Y29uc3RyYWludHNbMF19YDtcclxuICAgICAgICB9IGVsc2UgaWYgKG5nRm9ybUNvbnRyb2wgJiYgbmdGb3JtQ29udHJvbC5iaWdOdW1iZXIgPT09IHRydWUpIHtcclxuICAgICAgICAgIC8vIOWkp+aVsFxyXG4gICAgICAgICAgY29uc3QgbWluVmFsdWUgPSBuZXcgQmlnTnVtYmVyKGNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3IEJpZ051bWJlcihjb250cm9sLnZhbHVlKTtcclxuICAgICAgICAgIGlzSW5WYWxpZCA9IG1pblZhbHVlLmlzR3JlYXRlclRoYW4odmFsdWUpO1xyXG4gICAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UoVmFsaWRhdGlvblR5cGVzLk1JTlZBTFVFKTtcclxuICAgICAgICAgIGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuTUlOX0RBVEUpO1xyXG4gICAgICAgICAgLy8g5YGH5a6a5Li65pel5pyfXHJcbiAgICAgICAgICAvLyDkuI3nrqHmjqfku7bnmoTlgLzkuLrku4DkuYjvvIzlj6ropoHmnaHku7bkuI3lrZjlkovmiJbmmK9udWxs5oiWMOaIlnVuZGVmaW5lZOaIllwiXCLvvIzliJnkuI3lr7nmr5TlpKflsI/vvIzml6DmhI/kuYlcclxuICAgICAgICAgIGlmICghY29uc3RyYWludHMgfHwgY29uc3RyYWludHMubGVuZ3RoIDwgMSB8fCAhY29uc3RyYWludHNbMF0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoY29udHJvbC52YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcclxuICAgICAgICAgICAgaXNJblZhbGlkID0gY29udHJvbC52YWx1ZSA8IHBhcnNlSVNPKGNvbnN0cmFpbnRzWzBdKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlzSW5WYWxpZCA9IHBhcnNlSVNPKGNvbnRyb2wudmFsdWUpIDwgcGFyc2VJU08oY29uc3RyYWludHNbMF0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgcnVsZU9iaiwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpc0luVmFsaWQgPyB7IG1pblZhbHVlOiB7IHZhbHVlOiBjb250cm9sLnZhbHVlLCBuYW1lOiBpbnZhbGlkTWVzc2FnZSB9IH0gOiBudWxsO1xyXG4gICAgICB9LFxyXG4gICAgICBtYXhWYWx1ZTogKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0+IHtcclxuICAgICAgICBsZXQgaXNJblZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IGludmFsaWRNZXNzYWdlID0gJyc7XHJcbiAgICAgICAgaWYgKGNvbnRyb2wudmFsdWUgPT09IG51bGwgfHwgY29udHJvbC52YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjb250cm9sLnZhbHVlID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgY29uc3RyYWludHNbMF0gPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICBpc0luVmFsaWQgPSBjb250cm9sLnZhbHVlID4gY29uc3RyYWludHNbMF07XHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuTUFYVkFMVUUpO1xyXG4gICAgICAgICAgaW52YWxpZE1lc3NhZ2UgPSBWYWxpZGF0aW9uRXhlY3V0b3IucmVwbGFjZU1lc3NhZ2VTcGVjaWFsVG9rZW5zKG1lc3NhZ2VUZW1wbGF0ZSwgcnVsZU9iaiwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgICAvLyBpbnZhbGlkTWVzc2FnZSA9IGAke25nRm9ybUNvbnRyb2wubmFtZX3nmoTlgLzkuI3lupTlpKfkuo4ke2NvbnN0cmFpbnRzWzBdfWA7XHJcbiAgICAgICAgfSBlbHNlIGlmIChuZ0Zvcm1Db250cm9sICYmIG5nRm9ybUNvbnRyb2wuYmlnTnVtYmVyID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAvLyDlpKfmlbBcclxuICAgICAgICAgIGNvbnN0IG1heFZhbHVlID0gbmV3IEJpZ051bWJlcihjb25zdHJhaW50c1swXSk7XHJcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IG5ldyBCaWdOdW1iZXIoY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgICBpc0luVmFsaWQgPSBtYXhWYWx1ZS5pc0xlc3NUaGFuKHZhbHVlKTtcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VUZW1wbGF0ZSA9IFZhbGlkYXRpb25UeXBlcy5nZXRNZXNzYWdlKFZhbGlkYXRpb25UeXBlcy5NQVhWQUxVRSk7XHJcbiAgICAgICAgICBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5YGH5a6a5Li65pel5pyfXHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuTUFYX0RBVEUpO1xyXG4gICAgICAgICAgaWYgKGNvbnRyb2wudmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XHJcbiAgICAgICAgICAgIGlzSW5WYWxpZCA9IGNvbnRyb2wudmFsdWUgPiBuZXcgRGF0ZShjb25zdHJhaW50c1swXSk7XHJcbiAgICAgICAgICAgIC8vIGludmFsaWRNZXNzYWdlID0gYCR7bmdGb3JtQ29udHJvbC5uYW1lfeeahOWAvOS4jeW6lOaZmuS6jiR7Y29uc3RyYWludHNbMF19YDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlzSW5WYWxpZCA9IG5ldyBEYXRlKGNvbnRyb2wudmFsdWUpID4gbmV3IERhdGUoY29uc3RyYWludHNbMF0pO1xyXG4gICAgICAgICAgICAvLyBpbnZhbGlkTWVzc2FnZSA9IGAke25nRm9ybUNvbnRyb2wubmFtZX3nmoTlgLzkuI3lupTml6nkuo4ke2NvbnN0cmFpbnRzWzBdfWA7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlzSW5WYWxpZCA/IHsgbWF4VmFsdWU6IHsgdmFsdWU6IGNvbnRyb2wudmFsdWUsIG5hbWU6IGludmFsaWRNZXNzYWdlIH0gfSA6IG51bGw7XHJcbiAgICAgIH0sXHJcbiAgICAgIGV4Y2x1ZGU6IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgbnVsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgaXNWYWxpZCA9IHR5cGVvZiBjb250cm9sLnZhbHVlID09PSAnc3RyaW5nJyAmJiAhdGhpcy52YWxpZGF0b3JKcy5jb250YWlucyhjb250cm9sLnZhbHVlLCBjb25zdHJhaW50c1swXSk7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZVRlbXBsYXRlID0gVmFsaWRhdGlvblR5cGVzLmdldE1lc3NhZ2UoVmFsaWRhdGlvblR5cGVzLkVYQ0xVREUpO1xyXG4gICAgICAgIGNvbnN0IGludmFsaWRNZXNzYWdlID0gVmFsaWRhdGlvbkV4ZWN1dG9yLnJlcGxhY2VNZXNzYWdlU3BlY2lhbFRva2VucyhtZXNzYWdlVGVtcGxhdGUsIHJ1bGVPYmosIGNvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgIHJldHVybiBpc1ZhbGlkID8gbnVsbCA6IHsgZXhjbHVkZTogeyB2YWx1ZTogY29udHJvbC52YWx1ZSwgbmFtZTogaW52YWxpZE1lc3NhZ2UgfSB9O1xyXG4gICAgICB9LFxyXG4gICAgICBtYXRjaGVzOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGwgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gKGNvbnRyb2wudmFsdWUgPT09IG51bGwgfHwgY29udHJvbC52YWx1ZSA9PT0gdW5kZWZpbmVkKSA/ICcnIDogY29udHJvbC52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSB2YWx1ZSA9PT0gJycgPyB0cnVlIDogdGhpcy52YWxpZGF0b3JKcy5tYXRjaGVzKHZhbHVlLCBjb25zdHJhaW50c1swXSk7XHJcbiAgICAgICAgbGV0IGludmFsaWRNZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgICBpZiAoIWludmFsaWRNZXNzYWdlKSB7XHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlVGVtcGxhdGUgPSBWYWxpZGF0aW9uVHlwZXMuZ2V0TWVzc2FnZShWYWxpZGF0aW9uVHlwZXMuTUFUQ0hFUyk7XHJcbiAgICAgICAgICBpbnZhbGlkTWVzc2FnZSA9IFZhbGlkYXRpb25FeGVjdXRvci5yZXBsYWNlTWVzc2FnZVNwZWNpYWxUb2tlbnMobWVzc2FnZVRlbXBsYXRlLCBydWxlT2JqLCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBpc1ZhbGlkID8gbnVsbCA6IHsgbWF0Y2hlczogeyB2YWx1ZTogY29udHJvbC52YWx1ZSwgbmFtZTogaW52YWxpZE1lc3NhZ2UgfSB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gcnVsZUhhbmRsZXJPYmpbdHlwZV07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmkJzpm4blsZ7mgKfoo4XppbDlmahcclxuICAgKi9cclxuICBwcml2YXRlIGNvbGxlY3RNZXRhZGF0YXMoKSB7XHJcbiAgICB0aGlzLm5nVmFsaWRhdGVGb3JtID0gdGhpcy5mcmFtZUNvbnRleHQubWV0YWRhdGEuZm9ybSA/IE1ldGFkYXRhVXRpbC50cmFuc2xhdGVNZXRhZGF0YUJ5TmFtZSh0aGlzLmZyYW1lQ29udGV4dC5tZXRhZGF0YS5mb3JtLCB0aGlzLnRyYW5zbGF0ZVNlcnZpY2UsIFsnZm9ybUdyb3VwTmFtZSddKSA6XHJcbiAgICAgIE1ldGFkYXRhVXRpbC5nZXRDbGFzc01ldGFkYXRhQnlOYW1lV2l0aFRyYW5zbGF0ZSh0aGlzLmNvbnN0cnVjdG9yLCBOR19WQUxJREFURV9GT1JNLFxyXG4gICAgICAgIHRoaXMudHJhbnNsYXRlU2VydmljZSwgWydmb3JtR3JvdXBOYW1lJ10pO1xyXG4gICAgdGhpcy5uZ0Zvcm1Db250cm9scyA9IHRoaXMuY29sbGVjdGlvbkZvcm1Db250cm9sTWV0YWRhdHModGhpcy5mcmFtZUNvbnRleHQubWV0YWRhdGEuZm9ybUNvbnRyb2xzKTtcclxuICAgIHRoaXMubmdDaGlsZEZvcm1zID0gdGhpcy5mcmFtZUNvbnRleHQubWV0YWRhdGEuc3ViRm9ybXMgfHwgTWV0YWRhdGFVdGlsLmdldFByb3BzTWV0YWRhdGFzQnlOYW1lKHRoaXMuY29uc3RydWN0b3IsIE5HX0NISUxEX0ZPUk0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb2xsZWN0aW9uRm9ybUNvbnRyb2xNZXRhZGF0cyhwcmVsb2FkTWV0YWRhdGE6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBOZ0Zvcm1Db250cm9sIH0gPSBudWxsKTogeyBbcHJvcE5hbWU6IHN0cmluZ106IE5nRm9ybUNvbnRyb2wgfSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YXMgPSBwcmVsb2FkTWV0YWRhdGEgPyBNZXRhZGF0YVV0aWwudHJhbnNsYXRlTWV0YWRhdGFzQnlOYW1lKHByZWxvYWRNZXRhZGF0YSwgdGhpcy50cmFuc2xhdGVTZXJ2aWNlLCBbJ25hbWUnXSkgOlxyXG4gICAgICBNZXRhZGF0YVV0aWwuZ2V0UHJvcHNNZXRhZGF0YXNCeU5hbWVXaXRoVHJhbnNsYXRlKHRoaXMuY29uc3RydWN0b3IsIE5HX0ZPUk1fQ09OVFJPTCwgdGhpcy50cmFuc2xhdGVTZXJ2aWNlLCBbJ25hbWUnXSk7XHJcbiAgICAvLyDlkJHpqozor4Hop4TliJnkuK3pmYTliqDooajljZXkv6Hmga/vvIznlKjkuo7mmL7npLrpqozor4Hmj5DnpLrjgIJcclxuICAgIGlmIChtZXRhZGF0YXMpIHtcclxuICAgICAgT2JqZWN0LmtleXMobWV0YWRhdGFzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmdGb3JtQ29udHJvbCA9IG1ldGFkYXRhc1twcm9wTmFtZV07XHJcbiAgICAgICAgY29uc3QgZGlzcGxheUZpZWxkTmFtZSA9IG5nRm9ybUNvbnRyb2wubmFtZSB8fCBuZ0Zvcm1Db250cm9sLmRlZmF1bHRJMThuVmFsdWUgfHwgJyc7XHJcbiAgICAgICAgY29uc3QgZm9ybUNvbnRyb2xJZCA9IG5nRm9ybUNvbnRyb2wuaWQ7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmdGb3JtQ29udHJvbC52YWxpZFJ1bGVzKSkge1xyXG4gICAgICAgICAgbmdGb3JtQ29udHJvbC52YWxpZFJ1bGVzLmZvckVhY2goKHZhbGlkYXRpb25SdWxlOiBWYWxpZGF0ZVJ1bGUpID0+IHtcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUudGFyZ2V0SWQgPSBmb3JtQ29udHJvbElkO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS50YXJnZXROYW1lID0gdGhpcy5mb3JtR3JvdXBOYW1lO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS5wcm9wZXJ0eSA9IGRpc3BsYXlGaWVsZE5hbWU7XHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25SdWxlLmZpZWxkID0gbmdGb3JtQ29udHJvbC5iaW5kaW5nO1xyXG5cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gIH1cclxuXHJcbiAgLy8g6I635Y+WZ3JpZOS4reavj+adoeaVsOaNrueahGZvcm1Db250cm9sXHJcbiAgZ2V0R3JpZEl0ZW1Db250cm9sKHByb3BOYW1lOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgIGNvbnN0IGNyZWF0ZUNvbnRyb2xGcm9tUnVsZXMgPSBwcm9wZXJ0eU5hbWUgPT4ge1xyXG4gICAgICBjb25zdCB2YWxpZGF0b3JzID0gW107XHJcbiAgICAgIC8vIOiuvue9rmZvcm3kuK3lrprkuYnnmoTpqozor4Hop4TliJlcclxuICAgICAgaWYgKHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXSAmJiBBcnJheS5pc0FycmF5KHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXS52YWxpZFJ1bGVzKSkge1xyXG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwodGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wZXJ0eU5hbWVdLnZhbGlkUnVsZXMsICgocnVsZU9iaikgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdmFsaWRhdGVGbiA9IHRoaXMuZ2V0VmFsaWRhdG9yQnlSdWxlT2JqKHJ1bGVPYmosIHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcGVydHlOYW1lXSk7XHJcbiAgICAgICAgICBpZiAodmFsaWRhdGVGbikge1xyXG4gICAgICAgICAgICB2YWxpZGF0b3JzLnB1c2godmFsaWRhdGVGbik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBuZXcgRm9ybUNvbnRyb2wodmFsdWUsIHsgdmFsaWRhdG9yczogdmFsaWRhdG9ycywgdXBkYXRlT246ICdibHVyJyB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gY3JlYXRlQ29udHJvbEZyb21SdWxlcyhwcm9wTmFtZSk7XHJcbiAgfVxyXG5cclxuICAvLyDmoLnmja7lrp7kvZPlsZ7mgKflkI3ojrflj5bnlYzpnaLnu5HlrprnmoTlsZ7mgKflkI1cclxuICBnZXREb21Qcm9wZXJ0eU5hbWVCeUVudGl0eVByb3AocHJvcGVydHlOYW1lOiBzdHJpbmcsIHByZWZpeDogc3RyaW5nID0gJycpOiBzdHJpbmcge1xyXG4gICAgbGV0IGRvbVByb3BlcnR5TmFtZSA9ICcnO1xyXG4gICAgT2JqZWN0LmtleXModGhpcy5uZ0Zvcm1Db250cm9scykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICBjb25zdCBiaW5kaW5nID0gYCR7cHJlZml4fSR7dGhpcy5uZ0Zvcm1Db250cm9sc1trZXldLmJpbmRpbmd9YDtcclxuICAgICAgaWYgKGJpbmRpbmcgPT09IHByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgIGRvbVByb3BlcnR5TmFtZSA9IGtleTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZG9tUHJvcGVydHlOYW1lO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu6Rm9ybUNvbnRyb2xcclxuICAgKi9cclxuICBjcmVhdGVDb250cm9scygpIHtcclxuICAgIE9iamVjdC5rZXlzKHRoaXMubmdGb3JtQ29udHJvbHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdGb3JtQ29udHJvbCA9IHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCB2YWxpZGF0b3JzOiBWYWxpZGF0b3JGbltdID0gW107XHJcblxyXG4gICAgICAvLyDorr7nva5mb3Jt5Lit5a6a5LmJ55qE6aqM6K+B6KeE5YiZXHJcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcE5hbWVdLnZhbGlkUnVsZXMpKSB7XHJcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbCh0aGlzLm5nRm9ybUNvbnRyb2xzW3Byb3BOYW1lXS52YWxpZFJ1bGVzLCAocnVsZU9iaiA9PiB7XHJcbiAgICAgICAgICBjb25zdCB2YWxpZGF0ZUZuID0gdGhpcy5nZXRWYWxpZGF0b3JCeVJ1bGVPYmoocnVsZU9iaiwgdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wTmFtZV0pO1xyXG4gICAgICAgICAgaWYgKHZhbGlkYXRlRm4pIHtcclxuICAgICAgICAgICAgdmFsaWRhdG9ycy5wdXNoKHZhbGlkYXRlRm4pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdXBkYXRlT24gPSBuZ0Zvcm1Db250cm9sLnVwZGF0ZU9uID8gbmdGb3JtQ29udHJvbC51cGRhdGVPbiA6ICdibHVyJztcclxuICAgICAgY29uc3QgY29udHJvbCA9IG5ldyBGb3JtQ29udHJvbChudWxsLCB7IHZhbGlkYXRvcnM6IHZhbGlkYXRvcnMsIHVwZGF0ZU9uOiB1cGRhdGVPbiB9KTtcclxuICAgICAgaWYgKG5nRm9ybUNvbnRyb2wuYmluZGluZykge1xyXG4gICAgICAgIHRoaXMuc2V0VXBCaW5kaW5nRGF0YVBpcGVsaW5lKGNvbnRyb2wsIG5nRm9ybUNvbnRyb2wuYmluZGluZywgbmdGb3JtQ29udHJvbC52YWx1ZUNvbnZlcnRlcik7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5jb250cm9sc1twcm9wTmFtZV0gPSBjb250cm9sO1xyXG4gICAgICB0aGlzW3Byb3BOYW1lXSA9IGNvbnRyb2w7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7ukZvcm1Hcm91cFxyXG4gICAqL1xyXG4gIGNyZWF0ZUNoaWxkRm9ybXMoKSB7XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLm5nQ2hpbGRGb3JtcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0Zvcm1Hcm91cCA9IHRoaXMubmdDaGlsZEZvcm1zW3Byb3BOYW1lXTtcclxuXHJcbiAgICAgIC8vIOaehOmAoOWtkEZvcm1cclxuICAgICAgY29uc3QgZm9ybUdyb3VwID0gbmV3IG5nRm9ybUdyb3VwLmZvcm1UeXBlKCk7XHJcbiAgICAgIGZvcm1Hcm91cC5pbml0KHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuYmluZGluZ1BhdGgsIHRoaXMuZnJhbWVDb250ZXh0KTtcclxuXHJcbiAgICAgIHRoaXMuY29udHJvbHNbcHJvcE5hbWVdID0gZm9ybUdyb3VwO1xyXG4gICAgICB0aGlzW3Byb3BOYW1lXSA9IGZvcm1Hcm91cDtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKlxyXG4gICog5paw5aKeRm9ybUNvbnRyb2xzXHJcbiAgICovXHJcbiAgYWRkQ29udHJvbHMoY29sdW1uOiBhbnksIGNvbnZlcnRlcj86IENvbnRyb2xWYWx1ZUNvbnZlcnRlcikge1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZU9uID0gY29sdW1uICYmIGNvbHVtbi5lZGl0b3IgJiYgY29sdW1uLmVkaXRvci51cGRhdGVPbiA/IGNvbHVtbi5lZGl0b3IudXBkYXRlT24gOiAnYmx1cic7XHJcbiAgICBjb25zdCBmb3JtQ29udHJvbCA9IG5ldyBGb3JtQ29udHJvbCgnJywgeyB1cGRhdGVPbjogdXBkYXRlT24gfSk7XHJcbiAgICBjb25zdCBmaWVsZFBhdGggPSBjb2x1bW4uZGF0YUZpZWxkO1xyXG5cclxuICAgIC8vIOaXpeacn+agvOW8jyAg6ZyA6KaB5qC85byP5YyWXHJcbiAgICAvLyB0aGlzLnNldFVwQmluZGluZ0RhdGFQaXBlbGluZShmb3JtQ29udHJvbCwgZmllbGRQYXRoLCBjb252ZXJ0ZXIpO1xyXG4gICAgaWYgKGNvbHVtbi5lZGl0b3IgJiYgY29sdW1uLmVkaXRvci5iaW5kaW5nKSB7XHJcbiAgICAgIHRoaXMuc2V0VXBCaW5kaW5nRGF0YVBpcGVsaW5lKGZvcm1Db250cm9sLCBmaWVsZFBhdGgsIGNvbnZlcnRlcik7XHJcbiAgICAgIHRoaXMuY29udHJvbHNbY29sdW1uLmVkaXRvci5iaW5kaW5nLnBhdGhdID0gZm9ybUNvbnRyb2w7XHJcbiAgICAgIHRoaXNbY29sdW1uLmVkaXRvci5iaW5kaW5nLnBhdGhdID0gZm9ybUNvbnRyb2w7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5pCt5bu6Y29udHJvbOWSjHRhYmxl5LmL6Ze055qE6YCa6YGTXHJcbiAgICogQHBhcmFtIGNvbnRyb2wg5o6n5Lu2XHJcbiAgICogQHBhcmFtIGJpbmRpbmdGaWVsZFBhdGgg57uR5a6a55qE5a2X5q615ZCNXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRVcEJpbmRpbmdEYXRhUGlwZWxpbmUoY29udHJvbDogRm9ybUNvbnRyb2wsIGJpbmRpbmdGaWVsZFBhdGgsIGNvbnZlcnRlcj86IENvbnRyb2xWYWx1ZUNvbnZlcnRlcikge1xyXG5cclxuICAgIGlmICghdGhpcy5iaW5kaW5nRGF0YSkge1xyXG4gICAgICB0aHJvdyBFcnJvcign5b2T5YmN57uE5Lu25LiK5LiL5paH5Lit5om+5LiN5YiwQmluZGluZ0RhdGHvvIzor7fmo4Dmn6XvvIEnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlpoLmnpxjb252ZXJ0ZXLlrZjlnKjvvIzliJnlhpnlhaXkuIrkuIvmlofvvIxDb252ZXJ0ZXLkuK3lj6/og73kvJrpnIDopoHku45pbmplY3RvcuS4reiOt+WPluW9k+WJjeivreiogOS/oeaBr1xyXG4gICAgLy8gX19GUkFNRV9DT05URVhUX18g5pyq5L2/55SoXHJcbiAgICAvKmlmIChjb252ZXJ0ZXIpIHtcclxuICAgICAgY29udmVydGVyWydfX0ZSQU1FX0NPTlRFWFRfXyddID0gdGhpcy5mcmFtZUNvbnRleHQ7XHJcbiAgICB9Ki9cclxuXHJcbiAgICAvLyDlsIZiaW5kaWduUGF0aOS4jmJpbmRpbmdGaWVsZFBhdGjlkIjlubZcclxuICAgIGlmICh0aGlzLmJpbmRpbmdQYXRoLmxlbmd0aCA+IDEpIHtcclxuICAgICAgYmluZGluZ0ZpZWxkUGF0aCA9IHRoaXMuYmluZGluZ1BhdGguc3Vic3RyKDEpLnJlcGxhY2UoL1xcLy9nLCAnLicpICsgJy4nICsgYmluZGluZ0ZpZWxkUGF0aDtcclxuICAgIH1cclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoczogc3RyaW5nW10gPSBiaW5kaW5nRmllbGRQYXRoLnNwbGl0KCcuJyk7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBiaW5kaW5nUGF0aHNbYmluZGluZ1BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgLy8g6K6+572u5Yid5aeL5YC8XHJcbiAgICBjb25zdCBpbml0VmFsdWUgPSB0aGlzLmdldFZhbHVlRnJvbUJpbmRpbmdEYXRhKGJpbmRpbmdQYXRocywgY29udmVydGVyKTtcclxuICAgIGNvbnRyb2wuc2V0VmFsdWUoaW5pdFZhbHVlKTtcclxuXHJcbiAgICAvLyDorr7nva7liJ3lp4vlgLxcclxuXHJcbiAgICAvLyBCaW5kaW5nRGF0YSA9PiBjb250cm9sXHJcbiAgICB0aGlzLmJpbmRpbmdEYXRhLmNoYW5nZXMucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnBpcGUoZmlsdGVyKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRPYmplY3QoKTtcclxuICAgICAgY29uc3QgY2hhbmdlUGF0aCA9IGNoYW5nZS5wYXRoLmpvaW4oJy4nKTtcclxuICAgICAgaWYgKGNoYW5nZS5pc1VkdCkge1xyXG4gICAgICAgIHJldHVybiBjaGFuZ2VQYXRoID09PSBiaW5kaW5nRmllbGRQYXRoO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgICAvLyBwYXRo5a6M5YWo5Yy56YWNXHJcbiAgICAgICAgcmV0dXJuIGNoYW5nZVBhdGggPT09IGJpbmRpbmdGaWVsZFBhdGg7XHJcbiAgICAgIH0gZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuTG9hZCB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkIHx8IGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlJlbW92ZSB8fCBjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5VcGRhdGUpIHtcclxuICAgICAgICAvLyDlr7nkuo5PYmplY3RDaGFuZ2Vk44CBU2VsZWN0aW9uQ2hhbmdlZO+8jOWMuemFjeWIsOeItue6p1xyXG4gICAgICAgIGNvbnN0IGNoYW5nZVBhdGhXaXRoRG90ID0gY2hhbmdlUGF0aCA9PT0gJycgPyBjaGFuZ2VQYXRoIDogY2hhbmdlUGF0aCArICcuJztcclxuICAgICAgICAvLyDkuLvooajmlrDlop7miJbliIfmjaLml7bvvIzph43nva7plJnor6/kv6Hmga9cclxuICAgICAgICBpZiAoY2hhbmdlICYmIGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLkxvYWQpIHtcclxuICAgICAgICAgIHRoaXMucmVzZXRDYXJkVmFsaWRNc2coKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGJpbmRpbmdGaWVsZFBhdGguaW5kZXhPZihjaGFuZ2VQYXRoV2l0aERvdCkgPT09IDA7XHJcbiAgICAgIH0gZWxzZSBpZiAoY2hhbmdlLnR5cGUgPT09IENoYW5nZVR5cGUuVXBkYXRlRXJyb3JzKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZVBhdGggPT09IGJpbmRpbmdGaWVsZFBhdGgpIHtcclxuICAgICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0gPSB0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdIHx8IHt9O1xyXG4gICAgICAgICAgaWYgKGJpbmRpbmdGaWVsZFBhdGggJiYgdGhpcy5jb250cm9sc1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgICAgIGlmIChiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSA9PT0gY2hhbmdlLmlkKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXS5lcnJvcnMgPSBjaGFuZ2UuZXJyb3JzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vIOWPquabtOaWsOW9k+WJjeihjOeahOmUmeivr+aPkOekuuS/oeaBr++8jOS4jeaYr+W9k+WJjeihjOeahOS4jeWkhOeQhu+8jOaUvuWIsOacgOe7iOeahOWunuS9k+agoemqjOmHjOmdolxyXG4gICAgICAgICAgICAgIC8vIHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0uZXJyb3JzID0gbnVsbDtcclxuICAgICAgICAgICAgICAvLyB0aGlzLmlzRm9ybVZhbGlkKGJpbmRpbmdGaWVsZFBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyDmsqHmnInplJnor6/ml7ZcclxuICAgICAgICAgIGlmICghY2hhbmdlLnBhdGggfHwgIWJpbmRpbmdGaWVsZFBhdGggfHwgIWNoYW5nZS5lcnJvcnMpIHtcclxuICAgICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXS5lcnJvcnMgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmlzRm9ybVZhbGlkKGJpbmRpbmdGaWVsZFBhdGgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0pKS5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGxldCBmdWxsRW50aXR5UHJvcCA9IHByb3BlcnR5TmFtZTtcclxuICAgICAgLy8gdWR05a2X5q615bGV56S65pe26ZyA6KaB5bCG54i257qn5bGe5oCn5ZCN5ZKM6Ieq6Lqr5bGe5oCn5ZCN55SoJ18n6L+e5o6lXHJcbiAgICAgIGxldCBwYXRoUHJlZml4ID0gJyc7XHJcbiAgICAgIGlmIChjaGFuZ2UuaXNVZHQpIHtcclxuICAgICAgICBpZiAoY2hhbmdlLmlzR3JpZCkge1xyXG4gICAgICAgICAgLy8gZ3JpZCDlsIbku47ooajkuLvlrZfmrrXljrvpmaRcclxuICAgICAgICAgIGNoYW5nZS5wYXRoLnNoaWZ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGFuZ2UucGF0aC5sZW5ndGgpIHtcclxuICAgICAgICAgIHBhdGhQcmVmaXggPSBjaGFuZ2UucGF0aC5qb2luKCcuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bGxFbnRpdHlQcm9wID0gcGF0aFByZWZpeDtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRocywgZmFsc2UpO1xyXG4gICAgICBjb25zdCBuZXdDb250cm9sVmFsdWUgPSBjb252ZXJ0ZXIgPyBjb252ZXJ0ZXIuY29udmVydEZyb20odmFsdWUpIDogdmFsdWU7XHJcbiAgICAgIC8vIOiuvue9rkZvcm1Db250cm9sXHJcbiAgICAgIGNvbnN0IGRvbVByb3BOYW1lID0gdGhpcy5nZXREb21Qcm9wZXJ0eU5hbWVCeUVudGl0eVByb3AoZnVsbEVudGl0eVByb3ApO1xyXG4gICAgICB0aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wTmFtZV0gPSB0aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wTmFtZV0gfHwge307XHJcbiAgICAgIGlmIChjaGFuZ2UuZXJyb3JzKSB7XHJcbiAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcE5hbWVdLmVycm9ycyA9IGNoYW5nZS5lcnJvcnM7XHJcbiAgICAgIH1cclxuICAgICAgLy8gZGF0YUdyaWTkv53lrZjml7bvvIzmoLnmja5pZO+8jOWIm+W7umZvcm1Db250cm9s77yM5bm26K6+572u6ZSZ6K+v5a+56LGhXHJcbiAgICAgIGlmIChjaGFuZ2UuaWQpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250cm9sSWRNYXBbY2hhbmdlLmlkXSAmJiBPYmplY3Qua2V5cyh0aGlzLmNvbnRyb2xJZE1hcFtjaGFuZ2UuaWRdKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIHRoaXMuY29udHJvbElkTWFwW2NoYW5nZS5pZF0gPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb250cm9sSWRNYXBbY2hhbmdlLmlkXSA9IHRoaXMuY29udHJvbElkTWFwW2NoYW5nZS5pZF0gfHwge307XHJcbiAgICAgICAgaWYgKGNoYW5nZS5lcnJvcnMpIHtcclxuICAgICAgICAgIHRoaXMuY29udHJvbElkTWFwW2NoYW5nZS5pZF1bZG9tUHJvcE5hbWVdID0ge1xyXG4gICAgICAgICAgICBlcnJvcnM6IGNoYW5nZS5lcnJvcnNcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIOWmguaenOWSjOaOp+S7tuS4iueahOWAvOS4gOagt++8jOWImeS4jeWGjeabtOaWsOaOp+S7tueahOWAvFxyXG4gICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoY29udHJvbC52YWx1ZSkgPT09IEpTT04uc3RyaW5naWZ5KG5ld0NvbnRyb2xWYWx1ZSkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOato+WImeWIpOaWreaYr+WQpuS4uuaXpeacn1xyXG4gICAgICBjb250cm9sLnNldFZhbHVlKG5ld0NvbnRyb2xWYWx1ZSk7XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gY29udHJvbCA9PiBCaW5kaW5nRGF0YVxyXG4gICAgY29udHJvbC52YWx1ZUNoYW5nZXMucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICBjb25zdCBvbGRCaW5kaW5nVmFsdWUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRocyk7XHJcbiAgICAgIC8vIOWmguaenOaYr+aXpeacn++8jOavlOi+g+W5tOaciOaXpeaYr+WQpuebuOetie+8jOebuOetieWImeS4jemHjeaWsOi1i+WAvFxyXG4gICAgICBpZiAodmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgJiYgdmFsdWUuY29uc3RydWN0b3IubmFtZSA9PT0gJ0RhdGUnKSB7XHJcbiAgICAgICAgY29uc3QgaXNWYWxpZERhdGUgPSAhaXNOYU4odmFsdWUpO1xyXG4gICAgICAgIGlmICghaXNWYWxpZERhdGUpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9sZEJpbmRpbmdWYWx1ZSAmJiBjb252ZXJ0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IG9sZFZhbHVlID0gY29udmVydGVyLmNvbnZlcnRGcm9tKG9sZEJpbmRpbmdWYWx1ZSk7XHJcblxyXG4gICAgICAgICAgaWYgKHRoaXMuY29tcGFyZURhdGUodmFsdWUsIG9sZFZhbHVlKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDlpoLmnpzmmK/ml6XmnJ/vvIzmr5TovoPlubTmnIjml6XmmK/lkKbnm7jnrYnvvIznm7jnrYnliJnkuI3ph43mlrDotYvlgLxcclxuICAgICAgaWYgKHRoaXMuaXNEYXRlKGNvbnZlcnRlcikgPT09IHRydWUpIHtcclxuICAgICAgICBpZiAoRGF0ZVV0aWwuaXNFcXVhbCh2YWx1ZSwgb2xkQmluZGluZ1ZhbHVlKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5aaC5p6c5ZKMQmluZGluZ0RhdGHkuIrnmoTlgLzlkozmjqfku7bmnIDmlrDnmoTlgLzkuIDmoLfvvIzliJnkuI3lho3mm7TmlrBCaW5kaW5nRGF0YVxyXG4gICAgICBjb25zdCBuZXdCaW5kaW5nVmFsdWUgPSBjb252ZXJ0ZXIgPyBjb252ZXJ0ZXIuY29udmVydFRvKHZhbHVlKSA6IHZhbHVlO1xyXG4gICAgICBpZiAoSlNPTi5zdHJpbmdpZnkob2xkQmluZGluZ1ZhbHVlKSA9PT0gSlNPTi5zdHJpbmdpZnkobmV3QmluZGluZ1ZhbHVlKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiAoIXRoaXMuaXNGb3JtVmFsaWQocHJvcGVydHlOYW1lLCBudWxsLCBudWxsLCBmYWxzZSkpIHtcclxuICAgICAgLy8gICBjb25zdCBlcnJvcnMgPSB0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdICYmIHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0uZXJyb3JzIHx8IHt9O1xyXG4gICAgICAvLyAgIHRoaXMuYmluZGluZ0RhdGEuc2V0VmFsdWUoYmluZGluZ1BhdGhzLCBuZXdCaW5kaW5nVmFsdWUsIGZhbHNlLCB0cnVlLCBlcnJvcnMpO1xyXG4gICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmNsZWFyQmFja0VuZE1lc3NhZ2VzKHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIGNvbnN0IGVtaXRFdmVudFRvVmlldyA9IHRoaXMuZnJhbWVDb250ZXh0LmFwcENvbnRleHQucnVuTW9kZSA9PT0gUnVuTW9kZS5oaWdoU3BlZWQ7XHJcbiAgICAgIHRoaXMuYmluZGluZ0RhdGEuc2V0VmFsdWUoYmluZGluZ1BhdGhzLCBuZXdCaW5kaW5nVmFsdWUsIGVtaXRFdmVudFRvVmlldywgdHJ1ZSwgbnVsbCwgeyBmcmFtZUNvbnRleHQ6IHRoaXMuZnJhbWVDb250ZXh0IH0pO1xyXG4gICAgICAvL31cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yik5pat5piv5ZCm5piv5pel5pyf5a2X5q61XHJcbiAgICogMeOAgeebruWJjeayoeacieWKnuazleWIpOaWreS4gOS4quWtl+auteaYr+WQpuaYr+aXpeacn++8jOWPquiDveagueaNrkNvbnZlcnRlcuadpeWIpOaWre+8m1xyXG4gICAqIDLjgIFEZXZraXTkuI3og73kvp3otZZLZW5kb0JpbmRpbmfvvIzkuI3og73nm7TmjqXliKTmlq1EYXRlQ29udmVydGVy77ybXHJcbiAgICogM+OAgeS4jeiDveS9v+eUqGNvbnN0cnVjdG9yLm5hbWUs5Y6L57yp5ZCObmFtZeWPmOS6hu+8m1xyXG4gICAqIDTjgIHmmoLml7bmoLnmja5mb3JtYXTlsZ7mgKfmnaXliKTmlq3vvIzkuIDml6blhbbku5ZDb252ZXJ0ZXLmnIlmb3JtYXTvvIzliJnliKTmlq3lpLHmlYjvvIzmmoLml7bmsqHmnInov5nnp43mg4XlhrVcclxuICAgKiBAdG9kb1xyXG4gICAqIOS4uuaXpeacn+Wtl+autea3u+WKoOazqOino++8jOagueaNruazqOino+adpeWIpOaWrVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNEYXRlKGNvbnZlcnRlcjogQ29udHJvbFZhbHVlQ29udmVydGVyKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNEYXRlQ29udmVydGVyID0gZmFsc2U7XHJcblxyXG4gICAgLy8gaWYgKGNvbnZlcnRlciAmJiBjb252ZXJ0ZXIuY29uc3RydWN0b3IgJiYgY29udmVydGVyLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdEYXRlQ29udmVydGVyJykge1xyXG4gICAgLy8gICBpc0RhdGVDb252ZXJ0ZXIgPSB0cnVlO1xyXG4gICAgLy8gfVxyXG4gICAgaWYgKGNvbnZlcnRlciAmJiBjb252ZXJ0ZXIuaGFzT3duUHJvcGVydHkoJ2Zvcm1hdCcpID09PSB0cnVlKSB7XHJcbiAgICAgIGlzRGF0ZUNvbnZlcnRlciA9IHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXNEYXRlQ29udmVydGVyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5q+U6L6D5pel5pyf77yI5Y+q5q+U6L6D5bm05pyI5pel77yJXHJcbiAgICovXHJcbiAgY29tcGFyZURhdGUoc3JjRGF0ZTogRGF0ZSwgZHN0RGF0ZTogRGF0ZSkge1xyXG4gICAgaWYgKCFzcmNEYXRlIHx8ICFkc3REYXRlKSB7XHJcbiAgICAgIHJldHVybiBzcmNEYXRlID09PSBkc3REYXRlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaXNFcXVhbCA9XHJcbiAgICAgIHNyY0RhdGUuZ2V0RnVsbFllYXIoKSA9PT0gZHN0RGF0ZS5nZXRGdWxsWWVhcigpXHJcbiAgICAgICYmIHNyY0RhdGUuZ2V0TW9udGgoKSA9PT0gZHN0RGF0ZS5nZXRNb250aCgpXHJcbiAgICAgICYmIHNyY0RhdGUuZ2V0RGF0ZSgpID09PSBkc3REYXRlLmdldERhdGUoKVxyXG4gICAgICAmJiBzcmNEYXRlLmdldEhvdXJzKCkgPT09IGRzdERhdGUuZ2V0SG91cnMoKVxyXG4gICAgICAmJiBzcmNEYXRlLmdldE1pbnV0ZXMoKSA9PT0gZHN0RGF0ZS5nZXRNaW51dGVzKClcclxuICAgICAgJiYgc3JjRGF0ZS5nZXRTZWNvbmRzKCkgPT09IGRzdERhdGUuZ2V0U2Vjb25kcygpO1xyXG4gICAgcmV0dXJuIGlzRXF1YWw7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFByb3BJbmZvQnlQYXRoKHBhdGg6IEFycmF5PHN0cmluZz4pOiBEYXRhUHJvcEluZm8ge1xyXG4gICAgY29uc3QgZW50aXR5VHlwZSA9IHRoaXMuZnJhbWVDb250ZXh0ICYmIHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5VHlwZSB8fCBudWxsO1xyXG4gICAgaWYgKGVudGl0eVR5cGUpIHtcclxuICAgICAgY29uc3QgZGF0YVR5cGVJbmZvID0gbmV3IERhdGFUeXBlSW5mbyhlbnRpdHlUeXBlKTtcclxuICAgICAgY29uc3QgcHJvcEluZm86IERhdGFQcm9wSW5mbyA9IGRhdGFUeXBlSW5mby5nZXRQcm9wSW5mb0J5UGF0aChwYXRoKTtcclxuICAgICAgcmV0dXJuIHByb3BJbmZvO1xyXG4gICAgICAvLyBjb25zdCBpc011bHRpTGFuZ0lucHV0ID0gcHJvcEluZm8ubWV0YWRhdGFJbmZvLmVuYWJsZU11bHRpTGFuZ0lucHV0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7jkJpbmRpbmdEYXRh5Lit6I635Y+W5oyH5a6a6Lev5b6E55qE5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRWYWx1ZUZyb21CaW5kaW5nRGF0YShiaW5kaW5nUGF0aHM6IHN0cmluZ1tdLCBjb252ZXJ0ZXI/OiBDb250cm9sVmFsdWVDb252ZXJ0ZXIpIHtcclxuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShiaW5kaW5nUGF0aHMpO1xyXG4gICAgY29uc3QgY29udmVydGVyZWRWYWx1ZSA9IGNvbnZlcnRlciA/IGNvbnZlcnRlci5jb252ZXJ0RnJvbSh2YWx1ZSkgOiB2YWx1ZTtcclxuICAgIHJldHVybiBjb252ZXJ0ZXJlZFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEVudGl0eVZhbHVlQ2hhbmdpbmdMaXN0ZW5lcnMoKTogeyBbcHJvcGVydHk6IHN0cmluZ106IHN0cmluZyB9IHtcclxuICAgIGNvbnN0IGxpc3RlbmVycyA9IHt9O1xyXG4gICAgT2JqZWN0LmtleXModGhpcy5uZ0Zvcm1Db250cm9scykuZm9yRWFjaCgocHJvcE5hbWUpID0+IHtcclxuICAgICAgY29uc3QgbmdGb3JtQ29udHJvbCA9IHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcE5hbWVdO1xyXG4gICAgICBpZiAobmdGb3JtQ29udHJvbC52YWx1ZUNoYW5naW5nKSB7XHJcbiAgICAgICAgbGlzdGVuZXJzW25nRm9ybUNvbnRyb2wuYmluZGluZ10gPSBuZ0Zvcm1Db250cm9sLnZhbHVlQ2hhbmdpbmc7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGxpc3RlbmVycztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRFbnRpdHlWYWx1ZUNoYW5nZWRMaXN0ZW5lcnMoKTogeyBbcHJvcGVydHk6IHN0cmluZ106IHN0cmluZyB9IHtcclxuICAgIGNvbnN0IGxpc3RlbmVycyA9IHt9O1xyXG4gICAgT2JqZWN0LmtleXModGhpcy5uZ0Zvcm1Db250cm9scykuZm9yRWFjaCgocHJvcE5hbWUpID0+IHtcclxuICAgICAgY29uc3QgbmdGb3JtQ29udHJvbCA9IHRoaXMubmdGb3JtQ29udHJvbHNbcHJvcE5hbWVdO1xyXG4gICAgICBpZiAobmdGb3JtQ29udHJvbC52YWx1ZUNoYW5nZWQpIHtcclxuICAgICAgICBsaXN0ZW5lcnNbbmdGb3JtQ29udHJvbC5iaW5kaW5nXSA9IG5nRm9ybUNvbnRyb2wudmFsdWVDaGFuZ2VkO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBsaXN0ZW5lcnM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaJgOacieeahOWJjeerr+mqjOivgeinhOWImVxyXG4gICAqIEBkZXNjcmlwdGlvblxyXG4gICAqIOi/lOWbnueahOagoemqjOinhOWImeS4uk1hcDxzdHJpbmcsVmFsaWRhdGVSdWxlPizlhbbkuK1rZXnkuLrlhajot6/lvoTvvIzku45iaW5kaW5nUGF0aOW8gOWni+WIsOWunuS9k+WxnuaAp++8jOS7pS/liIbpmpRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VmFsaWRhdGlvblJ1bGVzKCk6IE1hcDxzdHJpbmcsIFZhbGlkYXRlUnVsZVtdPiB7XHJcbiAgICBjb25zdCB2YWxpZGF0b2luUnVsZXMgPSBuZXcgTWFwPHN0cmluZywgVmFsaWRhdGVSdWxlW10+KCk7XHJcbiAgICBsZXQgcGFyZW50UGF0aCA9IHRoaXMuYmluZGluZ1BhdGg7XHJcbiAgICBpZiAocGFyZW50UGF0aC5sZW5ndGggJiYgcGFyZW50UGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIHBhcmVudFBhdGggPSAnJztcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHRoaXMubmdGb3JtQ29udHJvbHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgLy8gY29uc3QgZmllbGROYW1lID0gYCR7cGFyZW50UGF0aH0vJHtwcm9wTmFtZX1gO1xyXG5cclxuICAgICAgaWYgKHRoaXMuaXNTaG93UHJvcE1hcFtwcm9wTmFtZV0gPT09IHRydWUgfHwgT2JqZWN0LmtleXModGhpcy5pc1Nob3dQcm9wTWFwKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBjb25zdCBuZ0Zvcm1Db250cm9sID0gdGhpcy5uZ0Zvcm1Db250cm9sc1twcm9wTmFtZV07XHJcbiAgICAgICAgY29uc3QgZGlzcGxheUZpZWxkTmFtZSA9IG5nRm9ybUNvbnRyb2wubmFtZSB8fCBuZ0Zvcm1Db250cm9sLmRlZmF1bHRJMThuVmFsdWUgfHwgJyc7XHJcbiAgICAgICAgY29uc3QgYmluZGluZ1BhdGhBcnJheSA9IG5nRm9ybUNvbnRyb2wuYmluZGluZyA/IG5nRm9ybUNvbnRyb2wuYmluZGluZy5zcGxpdCgnLicpIDogW3Byb3BOYW1lXTtcclxuICAgICAgICBjb25zdCBmaWVsZE5hbWVBcnJheSA9IFtwYXJlbnRQYXRoLCAuLi5iaW5kaW5nUGF0aEFycmF5XTtcclxuICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSBmaWVsZE5hbWVBcnJheS5qb2luKCcvJyk7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmdGb3JtQ29udHJvbC52YWxpZFJ1bGVzKSAmJiBuZ0Zvcm1Db250cm9sLnZhbGlkUnVsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgbGV0IHZhbGlkYXRpb25ydWxlc1RvQWRkID0gWy4uLm5nRm9ybUNvbnRyb2wudmFsaWRSdWxlc107XHJcbiAgICAgICAgICAvLyBpZiAodGhpcy5leGNsdWRlUnVsZVR5cGVzICYmIHRoaXMuZXhjbHVkZVJ1bGVUeXBlc1twcm9wTmFtZV0gJiYgdGhpcy5leGNsdWRlUnVsZVR5cGVzW3Byb3BOYW1lXS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAvLyAgIHZhbGlkYXRpb25ydWxlc1RvQWRkID0gbmdGb3JtQ29udHJvbC52YWxpZFJ1bGVzLmZpbHRlcigoaXRlbSkgPT4gIXRoaXMuZXhjbHVkZVJ1bGVUeXBlc1twcm9wTmFtZV0uaW5jbHVkZXMoaXRlbS50eXBlKSk7XHJcbiAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICB2YWxpZGF0aW9ucnVsZXNUb0FkZC5mb3JFYWNoKCh2YWxpZGF0aW9uUnVsZTogVmFsaWRhdGVSdWxlKSA9PiB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25SdWxlLnRhcmdldElkID0gbmdGb3JtQ29udHJvbC5pZDtcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUudGFyZ2V0TmFtZSA9IHRoaXMuZm9ybUdyb3VwTmFtZTtcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUucHJvcGVydHkgPSBkaXNwbGF5RmllbGROYW1lO1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uUnVsZS5maWVsZCA9IG5nRm9ybUNvbnRyb2wuYmluZGluZztcclxuICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGUuZnVsbFBhdGggPSBmaWVsZE5hbWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lQ29udGV4dCkge1xyXG4gICAgICAgICAgICAgIHZhbGlkYXRpb25SdWxlLmZyYW1lQ29udGV4dCA9IHRoaXMuZnJhbWVDb250ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHZhbGlkYXRvaW5SdWxlcy5zZXQoZmllbGROYW1lLCB2YWxpZGF0aW9ucnVsZXNUb0FkZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHZhbGlkYXRvaW5SdWxlcy5zZXQoZmllbGROYW1lLCBbe1xyXG4gICAgICAgICAgICB0eXBlOiAnc2V0RGlzcGxheUluZm8nLFxyXG4gICAgICAgICAgICB0YXJnZXRJZDogbmdGb3JtQ29udHJvbC5pZCxcclxuICAgICAgICAgICAgdGFyZ2V0TmFtZTogdGhpcy5mb3JtR3JvdXBOYW1lLFxyXG4gICAgICAgICAgICBwcm9wZXJ0eTogZGlzcGxheUZpZWxkTmFtZSxcclxuICAgICAgICAgICAgZnVsbFBhdGg6IGZpZWxkTmFtZSxcclxuICAgICAgICAgICAgZnJhbWVDb250ZXh0OiB0aGlzLmZyYW1lQ29udGV4dFxyXG4gICAgICAgICAgfV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdmFsaWRhdG9pblJ1bGVzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldFRyYW5zbGF0ZVNlcnZpY2UodHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlKSB7XHJcbiAgICBpZiAoIXRyYW5zbGF0ZVNlcnZpY2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy50cmFuc2xhdGUgPSB0cmFuc2xhdGVTZXJ2aWNlO1xyXG4gICAgVmFsaWRhdGlvblR5cGVzLnNldEN1cnJlbnRMYW5ndWFnZSh0cmFuc2xhdGVTZXJ2aWNlLmdldEN1cnJlbnRMYW5ndWFnZSgpKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YeN572u5o6n5Lu254q25oCBXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZXNldEZvcm1Db250cm9scygpIHtcclxuICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmNvbnRyb2xzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuY29udHJvbHMpLmZvckVhY2goKHByb3ApID0+IHtcclxuICAgICAgICBjb25zdCBmb3JtQ29udHJvbDogQWJzdHJhY3RDb250cm9sID0gdGhpcy5jb250cm9sc1twcm9wXTtcclxuICAgICAgICBmb3JtQ29udHJvbC5tYXJrQXNVbnRvdWNoZWQoKTtcclxuICAgICAgICBmb3JtQ29udHJvbC5tYXJrQXNQcmlzdGluZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIHByaXZhdGUgY2xlYXJCYWNrRW5kTWVzc2FnZXMoZG9tUHJvcGVydHlOYW1lOiBzdHJpbmcpIHtcclxuICAgIGlmIChkb21Qcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgaWYgKHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV0gJiYgdGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXVsnZXJyb3JzJ10gJiYgISFPYmplY3Qua2V5cyh0aGlzLmNhcmRDb250cm9sc1tkb21Qcm9wZXJ0eU5hbWVdWydlcnJvcnMnXSkuZmluZChpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnbWVzc2FnZS0nKSkpIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlS2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV1bJ2Vycm9ycyddKS5maWx0ZXIoaXRlbSA9PiBpdGVtLnN0YXJ0c1dpdGgoJ21lc3NhZ2UtJykpO1xyXG4gICAgICAgIGNvbnN0IGVycm9ycyA9IHsgLi4udGhpcy5jYXJkQ29udHJvbHNbZG9tUHJvcGVydHlOYW1lXVsnZXJyb3JzJ10gfTtcclxuICAgICAgICBtZXNzYWdlS2V5cy5mb3JFYWNoKGtleSA9PiBkZWxldGUgZXJyb3JzW2tleV0pO1xyXG4gICAgICAgIHRoaXMuY2FyZENvbnRyb2xzW2RvbVByb3BlcnR5TmFtZV0gPSB7IGVycm9yczogZXJyb3JzIH07XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHRoaXMuY2FyZENvbnRyb2xzKS5mb3JFYWNoKHByb3BlcnR5TmFtZSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV0gJiYgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXVsnZXJyb3JzJ10gJiYgISFPYmplY3Qua2V5cyh0aGlzLmNhcmRDb250cm9sc1twcm9wZXJ0eU5hbWVdWydlcnJvcnMnXSkuZmluZChpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnbWVzc2FnZS0nKSkpIHtcclxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VLZXlzID0gT2JqZWN0LmtleXModGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXVsnZXJyb3JzJ10pLmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnbWVzc2FnZS0nKSk7XHJcbiAgICAgICAgICBjb25zdCBlcnJvcnMgPSB7IC4uLnRoaXMuY2FyZENvbnRyb2xzW3Byb3BlcnR5TmFtZV1bJ2Vycm9ycyddIH07XHJcbiAgICAgICAgICBtZXNzYWdlS2V5cy5mb3JFYWNoKGtleSA9PiBkZWxldGUgZXJyb3JzW2tleV0pO1xyXG4gICAgICAgICAgdGhpcy5jYXJkQ29udHJvbHNbcHJvcGVydHlOYW1lXSA9IHsgZXJyb3JzOiBlcnJvcnMgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgRm9ybSB9O1xyXG4iXX0=
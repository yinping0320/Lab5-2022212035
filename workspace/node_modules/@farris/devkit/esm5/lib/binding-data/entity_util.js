import { PARENT_CLASS, FieldMetadataUtil } from '../entity/index';
import { ModifyType } from '../changeset/index';
import { ChangeType } from './changes';
import { BindingPropertyType } from './binding_property';
import { BindingObjectFactory } from './binding_object_factory';
import { Form } from '../form/index';
import { takeUntil } from 'rxjs/operators';
/**
 * 实体操作工具类
 */
var EntityUtil = /** @class */ (function () {
    function EntityUtil() {
    }
    /**
     * 将entity的数据加载到bindingObject中，并保持两者同步。
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    EntityUtil.loadEntity = function (entity, bindingObject) {
        var _this = this;
        // 遍历bindingObject的properties进行赋值
        bindingObject.properties.forEach(function (property) {
            var propertyName = property.name;
            if (property.type === BindingPropertyType.List) {
                _this.loadEntityList(entity[propertyName] || entity[PARENT_CLASS], bindingObject[propertyName]);
            }
            else if (property.type === BindingPropertyType.Object) {
                if (entity && entity[propertyName] && _this.isEffectiveField(entity, propertyName)) {
                    _this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                if (entity && entity[propertyName]) {
                    var dynamicObject = BindingObjectFactory.createDynamicBindingObject(entity[propertyName].data);
                    BindingObjectFactory.attachDynamicObjectProperty(bindingObject, propertyName, dynamicObject);
                    _this.loadEntity(entity[propertyName], bindingObject[propertyName]);
                }
            }
            else {
                if (_this.isEffectiveField(entity, propertyName)) {
                    var value = entity[propertyName];
                    bindingObject.setValue(propertyName, value, false, false);
                }
            }
        });
        this.setUpEntityPipeline(entity, bindingObject);
    };
    /**
     * 建立entity和bindingObject之间的关联
     * @param entity        实体对象
     * @param bindingObject 绑定对象
     */
    EntityUtil.setUpEntityPipeline = function (entity, bindingObject) {
        if (!entity || !bindingObject) {
            return;
        }
        // 监听entity变更
        entity.onValueChanged.pipe(takeUntil(entity.unsubscribe)).subscribe(function (modification) {
            if (modification.type !== ModifyType.ValueChange || modification.path.length === 0 || modification.fromParent === true) {
                return;
            }
            var propertyName = modification.path[modification.path.length - 1];
            var primaryKeyPath = modification.path[modification.path.length - 2];
            // 验证主键是否匹配
            // 存在主键并且主键不是id时才检查（值对象、关联对象不检查）
            if (bindingObject.primaryKey && bindingObject.primaryKey === 'id') {
                var primaryKey = bindingObject.primaryKey;
                var primaryKeyValue = bindingObject.getValue(primaryKey);
                if (primaryKeyPath !== primaryKey + ":" + primaryKeyValue) {
                    return;
                }
            }
            // TODO:修复动态列不触发变更的问题，临时方案，应该有单独的dynamicBindingObject类
            if (modification.dynamic) {
                if (bindingObject['__original__']) {
                    return;
                }
                var value_1 = modification.value;
                var target_1 = bindingObject[propertyName];
                if (!target_1) {
                    return;
                }
                Object.keys(value_1).forEach(function (key) {
                    if (target_1.getValue(key) === value_1[key]) {
                        return;
                    }
                    target_1.setValue(key, value_1[key], true, false);
                });
            }
            else {
                // 值没有发生变化，不再设置
                // TODO: 通过bindingObject修改entity属性值时，entity总会触发一个变更回来，如果不截获这个重复的变更，会导致重复或死循环
                if (bindingObject.getValue(propertyName) === modification.value) {
                    return;
                }
                bindingObject.setValue(propertyName, modification.value, true, false, modification.errors);
            }
        });
        // 监听bindingObject变更
        bindingObject.viewChanges.pipe(takeUntil(bindingObject.unsubscribe)).subscribe(function (viewChange) {
            var value = viewChange.value;
            var propertyName = viewChange.path[0];
            var pathPrefix = '';
            var pathData = entity.getPaths();
            var paths = pathData.path;
            var id = bindingObject['id'];
            bindingObject['__original__'] = true;
            // if (pathData.isUdt) {
            // grid中udt没有id，从父级中取出id，以便存放验证信息
            var getParentId = function (target) {
                var parentId = '';
                var findId = function (item) {
                    if (item && item && item['id']) {
                        parentId = item['id'];
                        return;
                    }
                    else if (item['parent']) {
                        findId(item['parent']);
                    }
                };
                findId(target);
                return parentId;
            };
            id = getParentId(bindingObject);
            // if (pathData.isGrid) {
            //   // grid 将从表主字段去除
            //   paths.pop();
            // }
            if (paths.length) {
                pathPrefix = paths.join('.') + '.';
            }
            // }
            var controlProp = pathPrefix + propertyName;
            // 调用实体验证，并将错误信息合并到formControl上
            var entityValidate = function (callback) {
                var enableValidate = Object.values(Form.insMap).find(function (item) { return item && item.enableValidate; });
                if (!enableValidate) {
                    if (typeof callback === 'function') {
                        callback(null);
                    }
                    return;
                }
                entity.validateFromUtilSync(propertyName, value, function (result) {
                    var _a;
                    var errorObj = {};
                    if (result.errors && result.errors.length > 0) {
                        result.errors.forEach(function (error) {
                            if (error.constraints) {
                                Object.keys(error.constraints).forEach(function (key) {
                                    errorObj[key] = {
                                        value: value,
                                        name: error.constraints[key],
                                        error: error
                                    };
                                });
                            }
                        });
                    }
                    // 先设置实体验证信息，再设置form验证信息，然后在form.isFormValid内部整合实体验证form验证信息
                    Form.updateErrors(controlProp, errorObj, id, value, pathData.isGrid);
                    var formErrors = viewChange['errors'] || {};
                    var mergedErrors = Object.assign({}, formErrors, errorObj);
                    var validateError = null;
                    if (Object.keys(mergedErrors).length > 0) {
                        validateError = (_a = {}, _a[propertyName] = mergedErrors, _a);
                    }
                    if (typeof (callback) === 'function') {
                        callback(validateError);
                    }
                }, viewChange.context);
            };
            // 不是主键值字段时，要先检查主键是否存在，并且主键是否相等（防止后代变更冒泡上来）
            // 非主键属性变更时，要先检查主键是否匹配（如果主键也修改了，要求先修改主键再修改其他值）
            if (bindingObject.primaryKey) {
                var primaryKey = bindingObject.primaryKey;
                if (propertyName !== primaryKey) {
                    if (!entity[primaryKey] || entity[primaryKey] !== bindingObject[primaryKey]) {
                        entityValidate();
                        return;
                    }
                }
                else if (entity[propertyName] !== value) {
                    // todo: 因异步校验未结束实体主键没有被赋值，导致实体其他属性无法赋值，待后续前端校验重构时去掉
                    entity[propertyName] = value;
                    entityValidate();
                    return;
                }
            }
            // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
            if (entity[propertyName] === value) {
                entityValidate();
                return;
            }
            // 调用表单验证,通过后调用实体验证
            // bingdingObject变化后，先调用实体上的验证，通过后再设置实体的变动
            entityValidate(function (errors) {
                entity.errors = errors;
                entity[propertyName] = value;
            });
        });
    };
    /**
     * 将entityList中的Entity对象转换为BindingObject对象，加载到bindingList中，并保持entityList和bindingList同步。
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    EntityUtil.loadEntityList = function (entityList, bindingList) {
        this.loadEntities(entityList.items, bindingList);
        this.setUpEntityListPipeline(entityList, bindingList);
    };
    /**
     * 建立entityList和bindingList之间的关联
     * @param entityList  实体列表
     * @param bindingList 绑定列表
     */
    EntityUtil.setUpEntityListPipeline = function (entityList, bindingList) {
        var _this = this;
        entityList.onListChanged.subscribe(function (modification) {
            var target = modification['target'];
            if (target && target !== entityList) {
                return;
            }
            switch (modification.type) {
                // 添加实体
                case ModifyType.Add:
                case ModifyType.Clone:
                    {
                        var entitiesToAdd = modification.value;
                        if (entitiesToAdd.length === 0) {
                            return;
                        }
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths_1 = modification.path;
                        var parentPath_1 = paths_1[paths_1.length - 2];
                        var parentId_1 = bindingList.parent.primaryKeyValue;
                        if (parentPath_1.indexOf(parentId_1) === -1) {
                            return;
                        }
                        _this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone);
                    }
                    break;
                case ModifyType.Insert:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths_2 = modification.path;
                        var parentPath_2 = paths_2[paths_2.length - 2];
                        var parentId_2 = bindingList.parent.primaryKeyValue;
                        var position = modification.position;
                        if (parentPath_2.indexOf(parentId_2) === -1) {
                            return;
                        }
                        _this.insertEntity(modification.value[0], bindingList, position);
                    }
                    break;
                // 删除实体
                case ModifyType.Remove:
                    {
                        // 检查父id是否一致，冒泡导致的变更不处理
                        var paths_3 = modification.path;
                        var parentPath_3 = paths_3[paths_3.length - 2];
                        var parentId_3 = bindingList.parent.primaryKeyValue;
                        if (parentPath_3.indexOf(parentId_3) === -1) {
                            return;
                        }
                        // 删除实体（value格式待商榷，目前value的格式为 { primaryKey: primaryValue}）
                        var id = modification.value[bindingList.primaryKey];
                        bindingList.removeByIds([id]);
                        // this.removeEntities(<Entity[]>modification.value, bindingList);
                    }
                    break;
                // 加载实体
                case ModifyType.Load:
                    // 检查父id是否一致，冒泡导致的变更不处理
                    var paths = modification.path;
                    var parentPath = paths[paths.length - 2];
                    var parentId = bindingList.parent.primaryKeyValue;
                    if (parentPath.indexOf(parentId) === -1) {
                        return;
                    }
                    var entities = modification.value;
                    _this.loadEntities(entities, bindingList);
                    break;
                default:
                    break;
            }
        });
    };
    /**
     * 监听repository变化，保持repository和bindingList同步。
     * @param repository  实体仓库
     * @param bindingList 绑定列表
     */
    EntityUtil.loadRepository = function (repository, bindingList) {
        var _this = this;
        // 初次加载
        var entities = Array.from(repository.entityCollection.toArray());
        this.loadEntities(entities, bindingList);
        // 监听变化
        repository.entityCollectionChange.pipe(takeUntil(repository.destroy$)).subscribe(function (modification) {
            switch (modification.type) {
                case ModifyType.Load:
                    bindingList.clear(true);
                    _this.loadEntities(modification.value, bindingList, modification.entityCreate);
                    break;
                case ModifyType.Add:
                case ModifyType.Clone:
                    _this.appendEntities(modification.value, bindingList, modification.type === ModifyType.Clone, { isTreeNodeLoadScene: modification.isTreeNodeLoadScene });
                    break;
                case ModifyType.AddData:
                    _this.addData(modification.value, bindingList, { isTreeNodeLoadScene: modification.isTreeNodeLoadScene });
                    break;
                case ModifyType.Insert:
                    _this.insertEntity(modification.value, bindingList, modification.position);
                    break;
                case ModifyType.Remove:
                    _this.removeEntities(modification.value, bindingList);
                    break;
                case ModifyType.RemoveData:
                    _this.removeData(modification.value, bindingList);
                    break;
                case ModifyType.PaginationInfoChange:
                    // 分页信息无需同步到bindingList，放到bindingData即可。保留此处只是为了兼容产品部可能使用bindingList上分页信息的场景
                    bindingList.paginationInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
        // 监听BindingList数据变化
        bindingList.changes.pipe(takeUntil(bindingList.destroy$)).subscribe(function (change) {
            if (change.type === ChangeType.PaginationInfoChange) {
                var entityCollection = repository.entityCollection;
                // const entityTypeName = entityCollection.entityTypeName;
                // const original = entityCollection.paginationInfo[entityTypeName];
                // const entityPaginationInfo = Object.assign({}, original, change.value);
                entityCollection.paginationInfo = Object.assign({}, entityCollection.paginationInfo, change.value);
            }
        });
    };
    /**
     * 将entities中的Entity对象转换为BindingObject对象，并加载到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.loadEntities = function (entities, bindingList, entityCreate) {
        if (entityCreate === void 0) { entityCreate = false; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.load(bindingObjects, entityCreate);
    };
    /**
     * 将entities中的Entity对象转换为BIndingObject对象，并追加到bindingList中
     * @param entities    实体数组
     * @param bindingList 绑定列表
     * @param isCloned 是否克隆数据
     * @param options 上下文
     */
    EntityUtil.appendEntities = function (entities, bindingList, isCloned, options) {
        if (isCloned === void 0) { isCloned = false; }
        if (options === void 0) { options = null; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.append(bindingObjects, isCloned, options);
    };
    /**
     * 是否是有效的字段
     * @param entity 实体
     * @param propertyName 字段
     * @returns
     */
    EntityUtil.isEffectiveField = function (entity, propertyName) {
        if (!entity || !propertyName) {
            return false;
        }
        propertyName = propertyName.toLowerCase();
        if (entity['__farris_effective_fields__']) {
            return entity['__farris_effective_fields__'].includes(propertyName);
        }
        if (entity['farris_effective_fields'] && typeof entity['farris_effective_fields'] === 'string') {
            var effectiveFields = entity['farris_effective_fields'].split(',').filter(function (p) { return p; }).map(function (item) { return item.toLowerCase(); });
            entity['__farris_effective_fields__'] = effectiveFields;
            return effectiveFields.includes(propertyName);
        }
        return true;
    };
    /**
     * 增加实体数据（不切换当前行）
     * @param entities
     * @param bindingList
     */
    EntityUtil.addData = function (entities, bindingList, options) {
        if (options === void 0) { options = null; }
        var bindingObjects = this.createBindingObjects(entities, bindingList);
        bindingList.addData(bindingObjects, options);
    };
    EntityUtil.insertEntity = function (entity, bindingList, position) {
        var bindingObject = this.createBindingObject(entity, bindingList);
        bindingList.insert(bindingObject, position);
    };
    /**
     * 从bindingList移除entities对应的BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.removeEntities = function (entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        var primaryKey = bindingList.primaryKey;
        var ids = [];
        entities.forEach(function (entity) {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeByIds(ids);
    };
    EntityUtil.removeData = function (entities, bindingList) {
        if (entities === null || entities.length === 0) {
            return;
        }
        // 归集要删除的id数组
        var primaryKey = bindingList.primaryKey;
        var ids = [];
        entities.forEach(function (entity) {
            ids.push(entity[primaryKey]);
        });
        bindingList.removeDataByIds(ids);
    };
    /**
     * 将entities中的Entity对象转换为BindingObject对象
     * @param entities    实体数组
     * @param bindingList 绑定列表
     */
    EntityUtil.createBindingObjects = function (entities, bindingList) {
        var _this = this;
        if (entities === null || entities.length === 0) {
            return [];
        }
        var bindingObjects = [];
        entities.forEach(function (entity) {
            var bindingObject = BindingObjectFactory.create(bindingList.properties, true);
            // bindingObject['_ENTITY_'] = entity;
            _this.loadEntity(entity, bindingObject);
            // // 为bindingObject设置默认值initialData属性
            // if (entity['initialData']) {
            //   bindingObject['initialData'] = entity['initialData'];
            // }
            bindingObjects.push(bindingObject);
        });
        return bindingObjects;
    };
    EntityUtil.createBindingObject = function (entity, bindingList) {
        var bindingObject = BindingObjectFactory.create(bindingList.properties, true);
        this.loadEntity(entity, bindingObject);
        return bindingObject;
    };
    EntityUtil.watchReposiroty = function (repository, bindingData) {
        // reposiroty => bindingData
        repository.entityCollectionChange.subscribe(function (modification) {
            switch (modification.type) {
                case ModifyType.PaginationInfoChange:
                    bindingData.pagingInfo = modification.value;
                    break;
                default:
                    break;
            }
        });
    };
    /**
     * 查找属性的类型
     * @param entityType 实体类型
     * @param targetPropName 属性名称
     * @return 属性信息，包含属性类型（NgField、NgObject、NgList）和属性对应的实体类型（当NgField类型时为null）
     */
    EntityUtil.getPropInfo = function (entityType, targetPropName) {
        var propType;
        var propEntityType;
        // NgField
        var ngFieldProperties = FieldMetadataUtil.getNgFields(entityType);
        Object.keys(ngFieldProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgField';
                propEntityType = null;
            }
        });
        // NgObject
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgObject';
                propEntityType = ngObjectProperties[propName].type;
            }
        });
        // NgList
        var ngListProperties = FieldMetadataUtil.getNgList(entityType);
        Object.keys(ngListProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgList';
                propEntityType = ngListProperties[propName].type;
            }
        });
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                propType = 'NgDynamic';
                propEntityType = ngDynamicProperties[propName].type;
            }
        });
        return { propType: propType, propEntityType: propEntityType };
    };
    /**
     * 获取实体的主键名
     * @param entityType 实体类型
     */
    EntityUtil.getPrimaryKey = function (entityType) {
        var primaryNgFiledProp = FieldMetadataUtil.getPrimaryFieldMetadata(entityType);
        if (primaryNgFiledProp) {
            return primaryNgFiledProp.dataField;
        }
        else {
            return '';
        }
    };
    /**
     * 是否为对象属性
     */
    EntityUtil.isObjectProp = function (entityType, targetPropName) {
        var isObjectProp = false;
        var ngObjectProperties = FieldMetadataUtil.getNgObjects(entityType);
        Object.keys(ngObjectProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                isObjectProp = true;
            }
        });
        return isObjectProp;
    };
    /**
     * 检查是否是动态列属性
     */
    EntityUtil.isDynamicProp = function (entityType, targetPropName) {
        var isDynamicProp = false;
        var ngDynamicProperties = FieldMetadataUtil.getNgDynamic(entityType);
        Object.keys(ngDynamicProperties).forEach(function (propName) {
            if (propName === targetPropName) {
                isDynamicProp = true;
            }
        });
        return isDynamicProp;
    };
    /**
     * 为实体增加initialData属性
     * @param entity 实体实例
     * @param initialData 默认值对象
     */
    EntityUtil.appendInitialData = function (entity, initialData) {
        var data = Object.assign({}, initialData);
        delete data.id;
        delete data.parentID;
        entity['initialData'] = data;
    };
    return EntityUtil;
}());
export { EntityUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3V0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9iaW5kaW5nLWRhdGEvZW50aXR5X3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFzQixZQUFZLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RixPQUFPLEVBQWdCLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzlELE9BQU8sRUFBc0IsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRzNELE9BQU8sRUFBbUIsbUJBQW1CLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3JDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQzs7R0FFRztBQUNIO0lBQUE7SUEraUJBLENBQUM7SUE3aUJDOzs7O09BSUc7SUFDSSxxQkFBVSxHQUFqQixVQUFrQixNQUFjLEVBQUUsYUFBNEI7UUFBOUQsaUJBeUJDO1FBeEJDLGlDQUFpQztRQUNqQyxhQUFhLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFDLFFBQXlCO1lBQ3pELElBQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDbkMsSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLG1CQUFtQixDQUFDLElBQUksRUFBRTtnQkFDOUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2FBQ2hHO2lCQUFNLElBQUksUUFBUSxDQUFDLElBQUksS0FBSyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZELElBQUksTUFBTSxJQUFJ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QyxDQUFDO1FBQ0gsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksd0JBQWEsR0FBcEIsVUFBcUIsVUFBZSxFQUFFLGNBQXNCO1FBQzFELElBQUksYUFBYSxHQUFHLEtBQUssQ0FBQztRQUMxQixJQUFNLG1CQUFtQixHQUFHLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN2RSxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUMsUUFBZ0I7WUFDeEQsSUFBSSxRQUFRLEtBQUssY0FBYyxFQUFFO2dCQUMvQixhQUFhLEdBQUcsSUFBSSxDQUFDO2FBQ3RCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLGFBQWEsQ0FBQztJQUN2QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLDRCQUFpQixHQUF4QixVQUF5QixNQUFNLEVBQUUsV0FBVztRQUMxQyxJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUM1QyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDZixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDckIsTUFBTSxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUMvQixDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQUFDLEFBL2lCRCxJQStpQkM7QUFFRCxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnLi4vcmVwb3NpdG9yeS9pbmRleCc7XHJcbmltcG9ydCB7IEVudGl0eSwgRW50aXR5TGlzdCwgUEFSRU5UX0NMQVNTLCBGaWVsZE1ldGFkYXRhVXRpbCB9IGZyb20gJy4uL2VudGl0eS9pbmRleCc7XHJcbmltcG9ydCB7IE1vZGlmaWNhdGlvbiwgTW9kaWZ5VHlwZSB9IGZyb20gJy4uL2NoYW5nZXNldC9pbmRleCc7XHJcbmltcG9ydCB7IFZpZXdDaGFuZ2UsIENoYW5nZSwgQ2hhbmdlVHlwZSB9IGZyb20gJy4vY2hhbmdlcyc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0IH0gZnJvbSAnLi9iaW5kaW5nX2xpc3QnO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSwgQmluZGluZ1Byb3BlcnR5VHlwZSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3RGYWN0b3J5IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdF9mYWN0b3J5JztcclxuaW1wb3J0IHsgRm9ybSB9IGZyb20gJy4uL2Zvcm0vaW5kZXgnO1xyXG5pbXBvcnQgeyBQYWdpbmF0aW9uIH0gZnJvbSAnLi4vY29yZSc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhIH0gZnJvbSAnLi9iaW5kaW5nX2RhdGEnO1xyXG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG4vKipcclxuICog5a6e5L2T5pON5L2c5bel5YW357G7XHJcbiAqL1xyXG5jbGFzcyBFbnRpdHlVdGlsIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5bCGZW50aXR555qE5pWw5o2u5Yqg6L295YiwYmluZGluZ09iamVjdOS4re+8jOW5tuS/neaMgeS4pOiAheWQjOatpeOAglxyXG4gICAqIEBwYXJhbSBlbnRpdHkgICAgICAgIOWunuS9k+WvueixoVxyXG4gICAqIEBwYXJhbSBiaW5kaW5nT2JqZWN0IOe7keWumuWvueixoVxyXG4gICAqL1xyXG4gIHN0YXRpYyBsb2FkRW50aXR5KGVudGl0eTogRW50aXR5LCBiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0KSB7XHJcbiAgICAvLyDpgY3ljoZiaW5kaW5nT2JqZWN055qEcHJvcGVydGllc+i/m+ihjOi1i+WAvFxyXG4gICAgYmluZGluZ09iamVjdC5wcm9wZXJ0aWVzLmZvckVhY2goKHByb3BlcnR5OiBCaW5kaW5nUHJvcGVydHkpID0+IHtcclxuICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTtcclxuICAgICAgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuTGlzdCkge1xyXG4gICAgICAgIHRoaXMubG9hZEVudGl0eUxpc3QoZW50aXR5W3Byb3BlcnR5TmFtZV0gfHwgZW50aXR5W1BBUkVOVF9DTEFTU10sIGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXSk7XHJcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5PYmplY3QpIHtcclxuICAgICAgICBpZiAoZW50aXR5ICYmIGVudGl0eVtwcm9wZXJ0eU5hbWVdICYmIHRoaXMuaXNFZmZlY3RpdmVGaWVsZChlbnRpdHksIHByb3BlcnR5TmFtZSkpIHtcclxuICAgICAgICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHlbcHJvcGVydHlOYW1lXSwgYmluZGluZ09iamVjdFtwcm9wZXJ0eU5hbWVdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5EeW5hbWljKSB7XHJcbiAgICAgICAgaWYgKGVudGl0eSAmJiBlbnRpdHlbcHJvcGVydHlOYW1lXSkge1xyXG4gICAgICAgICAgY29uc3QgZHluYW1pY09iamVjdCA9IEJpbmRpbmdPYmplY3RGYWN0b3J5LmNyZWF0ZUR5bmFtaWNCaW5kaW5nT2JqZWN0KGVudGl0eVtwcm9wZXJ0eU5hbWVdLmRhdGEpO1xyXG4gICAgICAgICAgQmluZGluZ09iamVjdEZhY3RvcnkuYXR0YWNoRHluYW1pY09iamVjdFByb3BlcnR5KGJpbmRpbmdPYmplY3QsIHByb3BlcnR5TmFtZSwgZHluYW1pY09iamVjdCk7XHJcbiAgICAgICAgICB0aGlzLmxvYWRFbnRpdHkoZW50aXR5W3Byb3BlcnR5TmFtZV0sIGJpbmRpbmdPYmplY3RbcHJvcGVydHlOYW1lXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmICh0aGlzLmlzRWZmZWN0aXZlRmllbGQoZW50aXR5LCBwcm9wZXJ0eU5hbWUpKSB7XHJcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGVudGl0eVtwcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5zZXRVcEVudGl0eVBpcGVsaW5lKGVudGl0eSwgYmluZGluZ09iamVjdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlu7rnq4tlbnRpdHnlkoxiaW5kaW5nT2JqZWN05LmL6Ze055qE5YWz6IGUXHJcbiAgICogQHBhcmFtIGVudGl0eSAgICAgICAg5a6e5L2T5a+56LGhXHJcbiAgICogQHBhcmFtIGJpbmRpbmdPYmplY3Qg57uR5a6a5a+56LGhXHJcbiAgICovXHJcbiAgc3RhdGljIHNldFVwRW50aXR5UGlwZWxpbmUoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QpIHtcclxuICAgIGlmICghZW50aXR5IHx8ICFiaW5kaW5nT2JqZWN0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOebkeWQrGVudGl0eeWPmOabtFxyXG4gICAgZW50aXR5Lm9uVmFsdWVDaGFuZ2VkLnBpcGUodGFrZVVudGlsKGVudGl0eS51bnN1YnNjcmliZSkpLnN1YnNjcmliZSgobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgICAgaWYgKG1vZGlmaWNhdGlvbi50eXBlICE9PSBNb2RpZnlUeXBlLlZhbHVlQ2hhbmdlIHx8IG1vZGlmaWNhdGlvbi5wYXRoLmxlbmd0aCA9PT0gMCB8fCBtb2RpZmljYXRpb24uZnJvbVBhcmVudCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBtb2RpZmljYXRpb24ucGF0aFttb2RpZmljYXRpb24ucGF0aC5sZW5ndGggLSAxXTtcclxuICAgICAgY29uc3QgcHJpbWFyeUtleVBhdGggPSBtb2RpZmljYXRpb24ucGF0aFttb2RpZmljYXRpb24ucGF0aC5sZW5ndGggLSAyXTtcclxuXHJcbiAgICAgIC8vIOmqjOivgeS4u+mUruaYr+WQpuWMuemFjVxyXG4gICAgICAvLyDlrZjlnKjkuLvplK7lubbkuJTkuLvplK7kuI3mmK9pZOaXtuaJjeajgOafpe+8iOWAvOWvueixoeOAgeWFs+iBlOWvueixoeS4jeajgOafpe+8iVxyXG4gICAgICBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5ICYmIGJpbmRpbmdPYmplY3QucHJpbWFyeUtleSA9PT0gJ2lkJykge1xyXG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXk7XHJcbiAgICAgICAgY29uc3QgcHJpbWFyeUtleVZhbHVlID0gYmluZGluZ09iamVjdC5nZXRWYWx1ZShwcmltYXJ5S2V5KTtcclxuICAgICAgICBpZiAocHJpbWFyeUtleVBhdGggIT09IGAke3ByaW1hcnlLZXl9OiR7cHJpbWFyeUtleVZhbHVlfWApIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgLy8gVE9ETzrkv67lpI3liqjmgIHliJfkuI3op6blj5Hlj5jmm7TnmoTpl67popjvvIzkuLTml7bmlrnmoYjvvIzlupTor6XmnInljZXni6znmoRkeW5hbWljQmluZGluZ09iamVjdOexu1xyXG4gICAgICBpZiAobW9kaWZpY2F0aW9uLmR5bmFtaWMpIHtcclxuICAgICAgICBpZiAoYmluZGluZ09iamVjdFsnX19vcmlnaW5hbF9fJ10pIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBtb2RpZmljYXRpb24udmFsdWU7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gYmluZGluZ09iamVjdFtwcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgIGlmICghdGFyZ2V0KSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5rZXlzKHZhbHVlKS5mb3JFYWNoKChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgaWYgKHRhcmdldC5nZXRWYWx1ZShrZXkpID09PSB2YWx1ZVtrZXldKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRhcmdldC5zZXRWYWx1ZShrZXksIHZhbHVlW2tleV0sIHRydWUsIGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDlgLzmsqHmnInlj5HnlJ/lj5jljJbvvIzkuI3lho3orr7nva5cclxuICAgICAgICAvLyBUT0RPOiDpgJrov4diaW5kaW5nT2JqZWN05L+u5pS5ZW50aXR55bGe5oCn5YC85pe277yMZW50aXR55oC75Lya6Kem5Y+R5LiA5Liq5Y+Y5pu05Zue5p2l77yM5aaC5p6c5LiN5oiq6I636L+Z5Liq6YeN5aSN55qE5Y+Y5pu077yM5Lya5a+86Ie06YeN5aSN5oiW5q275b6q546vXHJcbiAgICAgICAgaWYgKGJpbmRpbmdPYmplY3QuZ2V0VmFsdWUocHJvcGVydHlOYW1lKSA9PT0gbW9kaWZpY2F0aW9uLnZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJpbmRpbmdPYmplY3Quc2V0VmFsdWUocHJvcGVydHlOYW1lLCBtb2RpZmljYXRpb24udmFsdWUsIHRydWUsIGZhbHNlLCBtb2RpZmljYXRpb24uZXJyb3JzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDnm5HlkKxiaW5kaW5nT2JqZWN05Y+Y5pu0XHJcbiAgICBiaW5kaW5nT2JqZWN0LnZpZXdDaGFuZ2VzLnBpcGUodGFrZVVudGlsKGJpbmRpbmdPYmplY3QudW5zdWJzY3JpYmUpKS5zdWJzY3JpYmUoKHZpZXdDaGFuZ2U6IFZpZXdDaGFuZ2UpID0+IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSB2aWV3Q2hhbmdlLnZhbHVlO1xyXG4gICAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSB2aWV3Q2hhbmdlLnBhdGhbMF07XHJcblxyXG4gICAgICBsZXQgcGF0aFByZWZpeCA9ICcnO1xyXG4gICAgICBjb25zdCBwYXRoRGF0YSA9IGVudGl0eS5nZXRQYXRocygpO1xyXG4gICAgICBjb25zdCBwYXRocyA9IHBhdGhEYXRhLnBhdGg7XHJcbiAgICAgIGxldCBpZCA9IGJpbmRpbmdPYmplY3RbJ2lkJ107XHJcbiAgICAgIGJpbmRpbmdPYmplY3RbJ19fb3JpZ2luYWxfXyddID0gdHJ1ZTtcclxuICAgICAgLy8gaWYgKHBhdGhEYXRhLmlzVWR0KSB7XHJcbiAgICAgIC8vIGdyaWTkuK11ZHTmsqHmnIlpZO+8jOS7jueItue6p+S4reWPluWHumlk77yM5Lul5L6/5a2Y5pS+6aqM6K+B5L+h5oGvXHJcbiAgICAgIGNvbnN0IGdldFBhcmVudElkID0gKHRhcmdldDogYW55KSA9PiB7XHJcbiAgICAgICAgbGV0IHBhcmVudElkID0gJyc7XHJcbiAgICAgICAgY29uc3QgZmluZElkID0gKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbSAmJiBpdGVtWydpZCddKSB7XHJcbiAgICAgICAgICAgIHBhcmVudElkID0gaXRlbVsnaWQnXTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChpdGVtWydwYXJlbnQnXSkge1xyXG4gICAgICAgICAgICBmaW5kSWQoaXRlbVsncGFyZW50J10pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZmluZElkKHRhcmdldCk7XHJcbiAgICAgICAgcmV0dXJuIHBhcmVudElkO1xyXG4gICAgICB9O1xyXG4gICAgICBpZCA9IGdldFBhcmVudElkKGJpbmRpbmdPYmplY3QpO1xyXG4gICAgICAvLyBpZiAocGF0aERhdGEuaXNHcmlkKSB7XHJcbiAgICAgIC8vICAgLy8gZ3JpZCDlsIbku47ooajkuLvlrZfmrrXljrvpmaRcclxuICAgICAgLy8gICBwYXRocy5wb3AoKTtcclxuICAgICAgLy8gfVxyXG4gICAgICBpZiAocGF0aHMubGVuZ3RoKSB7XHJcbiAgICAgICAgcGF0aFByZWZpeCA9IHBhdGhzLmpvaW4oJy4nKSArICcuJztcclxuICAgICAgfVxyXG4gICAgICAvLyB9XHJcbiAgICAgIGNvbnN0IGNvbnRyb2xQcm9wID0gcGF0aFByZWZpeCArIHByb3BlcnR5TmFtZTtcclxuICAgICAgLy8g6LCD55So5a6e5L2T6aqM6K+B77yM5bm25bCG6ZSZ6K+v5L+h5oGv5ZCI5bm25YiwZm9ybUNvbnRyb2zkuIpcclxuICAgICAgY29uc3QgZW50aXR5VmFsaWRhdGUgPSAoY2FsbGJhY2s/OiAoZXJyb3I6IGFueSkgPT4gdm9pZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVuYWJsZVZhbGlkYXRlID0gT2JqZWN0LnZhbHVlcyhGb3JtLmluc01hcCkuZmluZChpdGVtID0+IGl0ZW0gJiYgaXRlbS5lbmFibGVWYWxpZGF0ZSk7XHJcbiAgICAgICAgaWYgKCFlbmFibGVWYWxpZGF0ZSkge1xyXG4gICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW50aXR5LnZhbGlkYXRlRnJvbVV0aWxTeW5jKHByb3BlcnR5TmFtZSwgdmFsdWUsIHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBlcnJvck9iaiA9IHt9O1xyXG4gICAgICAgICAgaWYgKHJlc3VsdC5lcnJvcnMgJiYgcmVzdWx0LmVycm9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5lcnJvcnMuZm9yRWFjaCgoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChlcnJvci5jb25zdHJhaW50cykge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZXJyb3IuY29uc3RyYWludHMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgZXJyb3JPYmpba2V5XSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZXJyb3IuY29uc3RyYWludHNba2V5XSxcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3JcclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyDlhYjorr7nva7lrp7kvZPpqozor4Hkv6Hmga/vvIzlho3orr7nva5mb3Jt6aqM6K+B5L+h5oGv77yM54S25ZCO5ZyoZm9ybS5pc0Zvcm1WYWxpZOWGhemDqOaVtOWQiOWunuS9k+mqjOivgWZvcm3pqozor4Hkv6Hmga9cclxuICAgICAgICAgIEZvcm0udXBkYXRlRXJyb3JzKGNvbnRyb2xQcm9wLCBlcnJvck9iaiwgaWQsIHZhbHVlLCBwYXRoRGF0YS5pc0dyaWQpO1xyXG4gICAgICAgICAgY29uc3QgZm9ybUVycm9ycyA9IHZpZXdDaGFuZ2VbJ2Vycm9ycyddIHx8IHt9O1xyXG4gICAgICAgICAgY29uc3QgbWVyZ2VkRXJyb3JzID0gT2JqZWN0LmFzc2lnbih7fSwgZm9ybUVycm9ycywgZXJyb3JPYmopO1xyXG4gICAgICAgICAgbGV0IHZhbGlkYXRlRXJyb3IgPSBudWxsO1xyXG4gICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG1lcmdlZEVycm9ycykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YWxpZGF0ZUVycm9yID0geyBbcHJvcGVydHlOYW1lXTogbWVyZ2VkRXJyb3JzIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAodHlwZW9mIChjYWxsYmFjaykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sodmFsaWRhdGVFcnJvcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgdmlld0NoYW5nZS5jb250ZXh0KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIOS4jeaYr+S4u+mUruWAvOWtl+auteaXtu+8jOimgeWFiOajgOafpeS4u+mUruaYr+WQpuWtmOWcqO+8jOW5tuS4lOS4u+mUruaYr+WQpuebuOetie+8iOmYsuatouWQjuS7o+WPmOabtOWGkuazoeS4iuadpe+8iVxyXG4gICAgICAvLyDpnZ7kuLvplK7lsZ7mgKflj5jmm7Tml7bvvIzopoHlhYjmo4Dmn6XkuLvplK7mmK/lkKbljLnphY3vvIjlpoLmnpzkuLvplK7kuZ/kv67mlLnkuobvvIzopoHmsYLlhYjkv67mlLnkuLvplK7lho3kv67mlLnlhbbku5blgLzvvIlcclxuICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleSkge1xyXG4gICAgICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXk7XHJcbiAgICAgICAgaWYgKHByb3BlcnR5TmFtZSAhPT0gcHJpbWFyeUtleSkge1xyXG4gICAgICAgICAgaWYgKCFlbnRpdHlbcHJpbWFyeUtleV0gfHwgZW50aXR5W3ByaW1hcnlLZXldICE9PSBiaW5kaW5nT2JqZWN0W3ByaW1hcnlLZXldKSB7XHJcbiAgICAgICAgICAgIGVudGl0eVZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGVudGl0eVtwcm9wZXJ0eU5hbWVdICE9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgLy8gdG9kbzog5Zug5byC5q2l5qCh6aqM5pyq57uT5p2f5a6e5L2T5Li76ZSu5rKh5pyJ6KKr6LWL5YC877yM5a+86Ie05a6e5L2T5YW25LuW5bGe5oCn5peg5rOV6LWL5YC877yM5b6F5ZCO57ut5YmN56uv5qCh6aqM6YeN5p6E5pe25Y675o6JXHJcbiAgICAgICAgICBlbnRpdHlbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgZW50aXR5VmFsaWRhdGUoKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIOWmguaenEJpbmRpbmdPYmplY3TkuIrnmoTlsZ7mgKflgLzlkoxFbnRpdHnkuIrlr7nlupTlsZ7mgKflgLzkuIDmoLfvvIzliJnkuI3lho3orr7nva5cclxuICAgICAgaWYgKGVudGl0eVtwcm9wZXJ0eU5hbWVdID09PSB2YWx1ZSkge1xyXG4gICAgICAgIGVudGl0eVZhbGlkYXRlKCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDosIPnlKjooajljZXpqozor4Es6YCa6L+H5ZCO6LCD55So5a6e5L2T6aqM6K+BXHJcbiAgICAgIC8vIGJpbmdkaW5nT2JqZWN05Y+Y5YyW5ZCO77yM5YWI6LCD55So5a6e5L2T5LiK55qE6aqM6K+B77yM6YCa6L+H5ZCO5YaN6K6+572u5a6e5L2T55qE5Y+Y5YqoXHJcbiAgICAgIGVudGl0eVZhbGlkYXRlKChlcnJvcnM6IGFueSkgPT4ge1xyXG4gICAgICAgIGVudGl0eS5lcnJvcnMgPSBlcnJvcnM7XHJcbiAgICAgICAgZW50aXR5W3Byb3BlcnR5TmFtZV0gPSB2YWx1ZTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhmVudGl0eUxpc3TkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGh77yM5Yqg6L295YiwYmluZGluZ0xpc3TkuK3vvIzlubbkv53mjIFlbnRpdHlMaXN05ZKMYmluZGluZ0xpc3TlkIzmraXjgIJcclxuICAgKiBAcGFyYW0gZW50aXR5TGlzdCAg5a6e5L2T5YiX6KGoXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBsb2FkRW50aXR5TGlzdChlbnRpdHlMaXN0OiBFbnRpdHlMaXN0PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXR5TGlzdC5pdGVtcywgYmluZGluZ0xpc3QpO1xyXG4gICAgdGhpcy5zZXRVcEVudGl0eUxpc3RQaXBlbGluZShlbnRpdHlMaXN0LCBiaW5kaW5nTGlzdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlu7rnq4tlbnRpdHlMaXN05ZKMYmluZGluZ0xpc3TkuYvpl7TnmoTlhbPogZRcclxuICAgKiBAcGFyYW0gZW50aXR5TGlzdCAg5a6e5L2T5YiX6KGoXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0IOe7keWumuWIl+ihqFxyXG4gICAqL1xyXG4gIHN0YXRpYyBzZXRVcEVudGl0eUxpc3RQaXBlbGluZShlbnRpdHlMaXN0OiBFbnRpdHlMaXN0PGFueT4sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgZW50aXR5TGlzdC5vbkxpc3RDaGFuZ2VkLnN1YnNjcmliZSgobW9kaWZpY2F0aW9uOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gbW9kaWZpY2F0aW9uWyd0YXJnZXQnXTtcclxuICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQgIT09IGVudGl0eUxpc3QpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgc3dpdGNoIChtb2RpZmljYXRpb24udHlwZSkge1xyXG4gICAgICAgIC8vIOa3u+WKoOWunuS9k1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGQ6XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkNsb25lOlxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdGllc1RvQWRkID0gPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKGVudGl0aWVzVG9BZGQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuYXBwZW5kRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QsIG1vZGlmaWNhdGlvbi50eXBlID09PSBNb2RpZnlUeXBlLkNsb25lKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5JbnNlcnQ6XHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGlmaWNhdGlvbi5wb3NpdGlvbjtcclxuICAgICAgICAgICAgaWYgKHBhcmVudFBhdGguaW5kZXhPZihwYXJlbnRJZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0RW50aXR5KG1vZGlmaWNhdGlvbi52YWx1ZVswXSwgYmluZGluZ0xpc3QsIHBvc2l0aW9uKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIC8vIOWIoOmZpOWunuS9k1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5SZW1vdmU6XHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gbW9kaWZpY2F0aW9uLnBhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoc1twYXRocy5sZW5ndGggLSAyXTtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50UGF0aC5pbmRleE9mKHBhcmVudElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5Yig6Zmk5a6e5L2T77yIdmFsdWXmoLzlvI/lvoXllYbmprfvvIznm67liY12YWx1ZeeahOagvOW8j+S4uiB7IHByaW1hcnlLZXk6IHByaW1hcnlWYWx1ZX3vvIlcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBtb2RpZmljYXRpb24udmFsdWVbYmluZGluZ0xpc3QucHJpbWFyeUtleV07XHJcbiAgICAgICAgICAgIGJpbmRpbmdMaXN0LnJlbW92ZUJ5SWRzKFtpZF0pO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnJlbW92ZUVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAvLyDliqDovb3lrp7kvZNcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuTG9hZDpcclxuICAgICAgICAgIC8vIOajgOafpeeItmlk5piv5ZCm5LiA6Ie077yM5YaS5rOh5a+86Ie055qE5Y+Y5pu05LiN5aSE55CGXHJcbiAgICAgICAgICBjb25zdCBwYXRocyA9IG1vZGlmaWNhdGlvbi5wYXRoO1xyXG4gICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDJdO1xyXG4gICAgICAgICAgY29uc3QgcGFyZW50SWQgPSBiaW5kaW5nTGlzdC5wYXJlbnQucHJpbWFyeUtleVZhbHVlO1xyXG4gICAgICAgICAgaWYgKHBhcmVudFBhdGguaW5kZXhPZihwYXJlbnRJZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGVudGl0aWVzID0gbW9kaWZpY2F0aW9uLnZhbHVlO1xyXG4gICAgICAgICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnm5HlkKxyZXBvc2l0b3J55Y+Y5YyW77yM5L+d5oyBcmVwb3NpdG9yeeWSjGJpbmRpbmdMaXN05ZCM5q2l44CCXHJcbiAgICogQHBhcmFtIHJlcG9zaXRvcnkgIOWunuS9k+S7k+W6k1xyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgbG9hZFJlcG9zaXRvcnkocmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIC8vIOWIneasoeWKoOi9vVxyXG4gICAgY29uc3QgZW50aXRpZXMgPSBBcnJheS5mcm9tKHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KCkpO1xyXG4gICAgdGhpcy5sb2FkRW50aXRpZXMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuXHJcbiAgICAvLyDnm5HlkKzlj5jljJZcclxuICAgIHJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbkNoYW5nZS5waXBlKHRha2VVbnRpbChyZXBvc2l0b3J5LmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkxvYWQ6XHJcbiAgICAgICAgICBiaW5kaW5nTGlzdC5jbGVhcih0cnVlKTtcclxuICAgICAgICAgIHRoaXMubG9hZEVudGl0aWVzKDxFbnRpdHlbXT5tb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24uZW50aXR5Q3JlYXRlKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5BZGQ6XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLkNsb25lOlxyXG4gICAgICAgICAgdGhpcy5hcHBlbmRFbnRpdGllcyg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgbW9kaWZpY2F0aW9uLnR5cGUgPT09IE1vZGlmeVR5cGUuQ2xvbmUsIHsgaXNUcmVlTm9kZUxvYWRTY2VuZTogbW9kaWZpY2F0aW9uLmlzVHJlZU5vZGVMb2FkU2NlbmUgfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE1vZGlmeVR5cGUuQWRkRGF0YTpcclxuICAgICAgICAgIHRoaXMuYWRkRGF0YSg8RW50aXR5W10+bW9kaWZpY2F0aW9uLnZhbHVlLCBiaW5kaW5nTGlzdCwgeyBpc1RyZWVOb2RlTG9hZFNjZW5lOiBtb2RpZmljYXRpb24uaXNUcmVlTm9kZUxvYWRTY2VuZSB9KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTW9kaWZ5VHlwZS5JbnNlcnQ6XHJcbiAgICAgICAgICB0aGlzLmluc2VydEVudGl0eShtb2RpZmljYXRpb24udmFsdWUsIGJpbmRpbmdMaXN0LCBtb2RpZmljYXRpb24ucG9zaXRpb24pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlJlbW92ZTpcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRW50aXRpZXMoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlJlbW92ZURhdGE6XHJcbiAgICAgICAgICB0aGlzLnJlbW92ZURhdGEoPEVudGl0eVtdPm1vZGlmaWNhdGlvbi52YWx1ZSwgYmluZGluZ0xpc3QpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlOlxyXG4gICAgICAgICAgLy8g5YiG6aG15L+h5oGv5peg6ZyA5ZCM5q2l5YiwYmluZGluZ0xpc3TvvIzmlL7liLBiaW5kaW5nRGF0YeWNs+WPr+OAguS/neeVmeatpOWkhOWPquaYr+S4uuS6huWFvOWuueS6p+WTgemDqOWPr+iDveS9v+eUqGJpbmRpbmdMaXN05LiK5YiG6aG15L+h5oGv55qE5Zy65pmvXHJcbiAgICAgICAgICBiaW5kaW5nTGlzdC5wYWdpbmF0aW9uSW5mbyA9IDxQYWdpbmF0aW9uPm1vZGlmaWNhdGlvbi52YWx1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g55uR5ZCsQmluZGluZ0xpc3TmlbDmja7lj5jljJZcclxuICAgIGJpbmRpbmdMaXN0LmNoYW5nZXMucGlwZSh0YWtlVW50aWwoYmluZGluZ0xpc3QuZGVzdHJveSQpKS5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eUNvbGxlY3Rpb24gPSByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb247XHJcbiAgICAgICAgLy8gY29uc3QgZW50aXR5VHlwZU5hbWUgPSBlbnRpdHlDb2xsZWN0aW9uLmVudGl0eVR5cGVOYW1lO1xyXG4gICAgICAgIC8vIGNvbnN0IG9yaWdpbmFsID0gZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mb1tlbnRpdHlUeXBlTmFtZV07XHJcbiAgICAgICAgLy8gY29uc3QgZW50aXR5UGFnaW5hdGlvbkluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBvcmlnaW5hbCwgY2hhbmdlLnZhbHVlKTtcclxuICAgICAgICBlbnRpdHlDb2xsZWN0aW9uLnBhZ2luYXRpb25JbmZvID0gT2JqZWN0LmFzc2lnbih7fSwgZW50aXR5Q29sbGVjdGlvbi5wYWdpbmF0aW9uSW5mbywgY2hhbmdlLnZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsIZlbnRpdGllc+S4reeahEVudGl0eeWvueixoei9rOaNouS4ukJpbmRpbmdPYmplY3Tlr7nosaHvvIzlubbliqDovb3liLBiaW5kaW5nTGlzdOS4rVxyXG4gICAqIEBwYXJhbSBlbnRpdGllcyAgICDlrp7kvZPmlbDnu4RcclxuICAgKiBAcGFyYW0gYmluZGluZ0xpc3Qg57uR5a6a5YiX6KGoXHJcbiAgICovXHJcbiAgc3RhdGljIGxvYWRFbnRpdGllcyhlbnRpdGllczogRW50aXR5W10sIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCwgZW50aXR5Q3JlYXRlOiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3RzID0gdGhpcy5jcmVhdGVCaW5kaW5nT2JqZWN0cyhlbnRpdGllcywgYmluZGluZ0xpc3QpO1xyXG4gICAgYmluZGluZ0xpc3QubG9hZChiaW5kaW5nT2JqZWN0cywgZW50aXR5Q3JlYXRlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhmVudGl0aWVz5Lit55qERW50aXR55a+56LGh6L2s5o2i5Li6QkluZGluZ09iamVjdOWvueixoe+8jOW5tui/veWKoOWIsGJpbmRpbmdMaXN05LitXHJcbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKiBAcGFyYW0gaXNDbG9uZWQg5piv5ZCm5YWL6ZqG5pWw5o2uXHJcbiAgICogQHBhcmFtIG9wdGlvbnMg5LiK5LiL5paHXHJcbiAgICovXHJcbiAgc3RhdGljIGFwcGVuZEVudGl0aWVzKGVudGl0aWVzOiBFbnRpdHlbXSwgYmluZGluZ0xpc3Q6IEJpbmRpbmdMaXN0LCBpc0Nsb25lZDogYm9vbGVhbiA9IGZhbHNlLCBvcHRpb25zOiBhbnkgPSBudWxsKSB7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0cyA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXMsIGJpbmRpbmdMaXN0KTtcclxuICAgIGJpbmRpbmdMaXN0LmFwcGVuZChiaW5kaW5nT2JqZWN0cywgaXNDbG9uZWQsIG9wdGlvbnMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmK/lkKbmmK/mnInmlYjnmoTlrZfmrrVcclxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k1xyXG4gICAqIEBwYXJhbSBwcm9wZXJ0eU5hbWUg5a2X5q61XHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBzdGF0aWMgaXNFZmZlY3RpdmVGaWVsZChlbnRpdHk6IEVudGl0eSwgcHJvcGVydHlOYW1lOiBzdHJpbmcpIHtcclxuICAgIGlmICghZW50aXR5IHx8ICFwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBpZiAoZW50aXR5WydfX2ZhcnJpc19lZmZlY3RpdmVfZmllbGRzX18nXSkge1xyXG4gICAgICByZXR1cm4gZW50aXR5WydfX2ZhcnJpc19lZmZlY3RpdmVfZmllbGRzX18nXS5pbmNsdWRlcyhwcm9wZXJ0eU5hbWUpO1xyXG4gICAgfVxyXG4gICAgaWYgKGVudGl0eVsnZmFycmlzX2VmZmVjdGl2ZV9maWVsZHMnXSAmJiB0eXBlb2YgZW50aXR5WydmYXJyaXNfZWZmZWN0aXZlX2ZpZWxkcyddID09PSAnc3RyaW5nJykge1xyXG4gICAgICBjb25zdCBlZmZlY3RpdmVGaWVsZHMgPSBlbnRpdHlbJ2ZhcnJpc19lZmZlY3RpdmVfZmllbGRzJ10uc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKS5tYXAoaXRlbSA9PiBpdGVtLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICBlbnRpdHlbJ19fZmFycmlzX2VmZmVjdGl2ZV9maWVsZHNfXyddID0gZWZmZWN0aXZlRmllbGRzO1xyXG4gICAgICByZXR1cm4gZWZmZWN0aXZlRmllbGRzLmluY2x1ZGVzKHByb3BlcnR5TmFtZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5aKe5Yqg5a6e5L2T5pWw5o2u77yI5LiN5YiH5o2i5b2T5YmN6KGM77yJXHJcbiAgICogQHBhcmFtIGVudGl0aWVzXHJcbiAgICogQHBhcmFtIGJpbmRpbmdMaXN0XHJcbiAgICovXHJcbiAgc3RhdGljIGFkZERhdGEoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIG9wdGlvbnM6IGFueSA9IG51bGwpIHtcclxuICAgIGNvbnN0IGJpbmRpbmdPYmplY3RzID0gdGhpcy5jcmVhdGVCaW5kaW5nT2JqZWN0cyhlbnRpdGllcywgYmluZGluZ0xpc3QpO1xyXG4gICAgYmluZGluZ0xpc3QuYWRkRGF0YShiaW5kaW5nT2JqZWN0cywgb3B0aW9ucyk7XHJcbiAgfVxyXG4gIHN0YXRpYyBpbnNlcnRFbnRpdHkoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCwgcG9zaXRpb246IC0xIHwgMSkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IHRoaXMuY3JlYXRlQmluZGluZ09iamVjdChlbnRpdHksIGJpbmRpbmdMaXN0KTtcclxuICAgIGJpbmRpbmdMaXN0Lmluc2VydChiaW5kaW5nT2JqZWN0LCBwb3NpdGlvbik7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7jmJpbmRpbmdMaXN056e76ZmkZW50aXRpZXPlr7nlupTnmoRCaW5kaW5nT2JqZWN05a+56LGhXHJcbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgcmVtb3ZlRW50aXRpZXMoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOW9kumbhuimgeWIoOmZpOeahGlk5pWw57uEXHJcbiAgICBjb25zdCBwcmltYXJ5S2V5ID0gYmluZGluZ0xpc3QucHJpbWFyeUtleTtcclxuICAgIGNvbnN0IGlkcyA9IFtdO1xyXG4gICAgZW50aXRpZXMuZm9yRWFjaCgoZW50aXR5OiBFbnRpdHkpID0+IHtcclxuICAgICAgaWRzLnB1c2goZW50aXR5W3ByaW1hcnlLZXldKTtcclxuICAgIH0pO1xyXG4gICAgYmluZGluZ0xpc3QucmVtb3ZlQnlJZHMoaWRzKTtcclxuICB9XHJcbiAgc3RhdGljIHJlbW92ZURhdGEoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5b2S6ZuG6KaB5Yig6Zmk55qEaWTmlbDnu4RcclxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSBiaW5kaW5nTGlzdC5wcmltYXJ5S2V5O1xyXG4gICAgY29uc3QgaWRzID0gW107XHJcbiAgICBlbnRpdGllcy5mb3JFYWNoKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBpZHMucHVzaChlbnRpdHlbcHJpbWFyeUtleV0pO1xyXG4gICAgfSk7XHJcbiAgICBiaW5kaW5nTGlzdC5yZW1vdmVEYXRhQnlJZHMoaWRzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCGZW50aXRpZXPkuK3nmoRFbnRpdHnlr7nosaHovazmjaLkuLpCaW5kaW5nT2JqZWN05a+56LGhXHJcbiAgICogQHBhcmFtIGVudGl0aWVzICAgIOWunuS9k+aVsOe7hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nTGlzdCDnu5HlrprliJfooahcclxuICAgKi9cclxuICBzdGF0aWMgY3JlYXRlQmluZGluZ09iamVjdHMoZW50aXRpZXM6IEVudGl0eVtdLCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QpIHtcclxuICAgIGlmIChlbnRpdGllcyA9PT0gbnVsbCB8fCBlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYmluZGluZ09iamVjdHMgPSBbXTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUoYmluZGluZ0xpc3QucHJvcGVydGllcywgdHJ1ZSk7XHJcbiAgICAgIC8vIGJpbmRpbmdPYmplY3RbJ19FTlRJVFlfJ10gPSBlbnRpdHk7XHJcbiAgICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xyXG5cclxuICAgICAgLy8gLy8g5Li6YmluZGluZ09iamVjdOiuvue9rum7mOiupOWAvGluaXRpYWxEYXRh5bGe5oCnXHJcbiAgICAgIC8vIGlmIChlbnRpdHlbJ2luaXRpYWxEYXRhJ10pIHtcclxuICAgICAgLy8gICBiaW5kaW5nT2JqZWN0Wydpbml0aWFsRGF0YSddID0gZW50aXR5Wydpbml0aWFsRGF0YSddO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGJpbmRpbmdPYmplY3RzLnB1c2goYmluZGluZ09iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBiaW5kaW5nT2JqZWN0cztcclxuICB9XHJcbiAgc3RhdGljIGNyZWF0ZUJpbmRpbmdPYmplY3QoZW50aXR5OiBFbnRpdHksIGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCkge1xyXG4gICAgY29uc3QgYmluZGluZ09iamVjdCA9IEJpbmRpbmdPYmplY3RGYWN0b3J5LmNyZWF0ZShiaW5kaW5nTGlzdC5wcm9wZXJ0aWVzLCB0cnVlKTtcclxuICAgIHRoaXMubG9hZEVudGl0eShlbnRpdHksIGJpbmRpbmdPYmplY3QpO1xyXG4gICAgcmV0dXJuIGJpbmRpbmdPYmplY3Q7XHJcbiAgfVxyXG4gIHB1YmxpYyBzdGF0aWMgd2F0Y2hSZXBvc2lyb3R5KHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55PiwgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhKSB7XHJcbiAgICAvLyByZXBvc2lyb3R5ID0+IGJpbmRpbmdEYXRhXHJcbiAgICByZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb25DaGFuZ2Uuc3Vic2NyaWJlKChtb2RpZmljYXRpb246IE1vZGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKG1vZGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBNb2RpZnlUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlOlxyXG4gICAgICAgICAgYmluZGluZ0RhdGEucGFnaW5nSW5mbyA9IG1vZGlmaWNhdGlvbi52YWx1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOafpeaJvuWxnuaAp+eahOexu+Wei1xyXG4gICAqIEBwYXJhbSBlbnRpdHlUeXBlIOWunuS9k+exu+Wei1xyXG4gICAqIEBwYXJhbSB0YXJnZXRQcm9wTmFtZSDlsZ7mgKflkI3np7BcclxuICAgKiBAcmV0dXJuIOWxnuaAp+S/oeaBr++8jOWMheWQq+WxnuaAp+exu+Wei++8iE5nRmllbGTjgIFOZ09iamVjdOOAgU5nTGlzdO+8ieWSjOWxnuaAp+WvueW6lOeahOWunuS9k+exu+Wei++8iOW9k05nRmllbGTnsbvlnovml7bkuLpudWxs77yJXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByb3BJbmZvKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZyk6IHsgcHJvcFR5cGU6IHN0cmluZywgcHJvcEVudGl0eVR5cGU6IGFueSB9IHtcclxuXHJcbiAgICBsZXQgcHJvcFR5cGU6IHN0cmluZztcclxuICAgIGxldCBwcm9wRW50aXR5VHlwZTogYW55O1xyXG5cclxuICAgIC8vIE5nRmllbGRcclxuICAgIGNvbnN0IG5nRmllbGRQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHMoZW50aXR5VHlwZSk7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdGaWVsZCc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBOZ09iamVjdFxyXG4gICAgY29uc3QgbmdPYmplY3RQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RQcm9wZXJ0aWVzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChwcm9wTmFtZSA9PT0gdGFyZ2V0UHJvcE5hbWUpIHtcclxuICAgICAgICBwcm9wVHlwZSA9ICdOZ09iamVjdCc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBuZ09iamVjdFByb3BlcnRpZXNbcHJvcE5hbWVdLnR5cGU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIE5nTGlzdFxyXG4gICAgY29uc3QgbmdMaXN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdFByb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIHByb3BUeXBlID0gJ05nTGlzdCc7XHJcbiAgICAgICAgcHJvcEVudGl0eVR5cGUgPSBuZ0xpc3RQcm9wZXJ0aWVzW3Byb3BOYW1lXS50eXBlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBuZ0R5bmFtaWNQcm9wZXJ0aWVzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKGVudGl0eVR5cGUpO1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljUHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgcHJvcFR5cGUgPSAnTmdEeW5hbWljJztcclxuICAgICAgICBwcm9wRW50aXR5VHlwZSA9IG5nRHluYW1pY1Byb3BlcnRpZXNbcHJvcE5hbWVdLnR5cGU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB7IHByb3BUeXBlLCBwcm9wRW50aXR5VHlwZSB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T55qE5Li76ZSu5ZCNXHJcbiAgICogQHBhcmFtIGVudGl0eVR5cGUg5a6e5L2T57G75Z6LXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByaW1hcnlLZXkoZW50aXR5VHlwZTogYW55KSB7XHJcbiAgICBjb25zdCBwcmltYXJ5TmdGaWxlZFByb3AgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXRQcmltYXJ5RmllbGRNZXRhZGF0YShlbnRpdHlUeXBlKTtcclxuICAgIGlmIChwcmltYXJ5TmdGaWxlZFByb3ApIHtcclxuICAgICAgcmV0dXJuIHByaW1hcnlOZ0ZpbGVkUHJvcC5kYXRhRmllbGQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmmK/lkKbkuLrlr7nosaHlsZ7mgKdcclxuICAgKi9cclxuICBzdGF0aWMgaXNPYmplY3RQcm9wKGVudGl0eVR5cGU6IGFueSwgdGFyZ2V0UHJvcE5hbWU6IHN0cmluZywpIHtcclxuICAgIGxldCBpc09iamVjdFByb3AgPSBmYWxzZTtcclxuICAgIGNvbnN0IG5nT2JqZWN0UHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0UHJvcGVydGllcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAocHJvcE5hbWUgPT09IHRhcmdldFByb3BOYW1lKSB7XHJcbiAgICAgICAgaXNPYmplY3RQcm9wID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaXNPYmplY3RQcm9wO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l5piv5ZCm5piv5Yqo5oCB5YiX5bGe5oCnXHJcbiAgICovXHJcbiAgc3RhdGljIGlzRHluYW1pY1Byb3AoZW50aXR5VHlwZTogYW55LCB0YXJnZXRQcm9wTmFtZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgaXNEeW5hbWljUHJvcCA9IGZhbHNlO1xyXG4gICAgY29uc3QgbmdEeW5hbWljUHJvcGVydGllcyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyhlbnRpdHlUeXBlKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY1Byb3BlcnRpZXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHByb3BOYW1lID09PSB0YXJnZXRQcm9wTmFtZSkge1xyXG4gICAgICAgIGlzRHluYW1pY1Byb3AgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBpc0R5bmFtaWNQcm9wO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Li65a6e5L2T5aKe5YqgaW5pdGlhbERhdGHlsZ7mgKdcclxuICAgKiBAcGFyYW0gZW50aXR5IOWunuS9k+WunuS+i1xyXG4gICAqIEBwYXJhbSBpbml0aWFsRGF0YSDpu5jorqTlgLzlr7nosaFcclxuICAgKi9cclxuICBzdGF0aWMgYXBwZW5kSW5pdGlhbERhdGEoZW50aXR5LCBpbml0aWFsRGF0YSkge1xyXG4gICAgY29uc3QgZGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGluaXRpYWxEYXRhKTtcclxuICAgIGRlbGV0ZSBkYXRhLmlkO1xyXG4gICAgZGVsZXRlIGRhdGEucGFyZW50SUQ7XHJcbiAgICBlbnRpdHlbJ2luaXRpYWxEYXRhJ10gPSBkYXRhO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHsgRW50aXR5VXRpbCB9O1xyXG4iXX0=
/**
 * 绑定列表相关定义
 * @author Witt<jiwt@inspur.com>
 */
import * as tslib_1 from "tslib";
// tslint:disable: max-line-length
import { List } from 'immutable';
import { Subject } from 'rxjs';
import { ChangeType } from './changes';
import { BindingObjectFactory } from './binding_object_factory';
import { PropertyUtil } from './property_util';
import { BindingData } from './binding_data';
import { TranslateService } from '../i18n/translate_service';
import { ArrayFilterConditionDataFilter, ObjectFilterConditionDataFilter } from '../data-filter';
import { takeUntil } from 'rxjs/operators';
/**
 * BindingList是一个BindingObject集合
 */
var BindingList = /** @class */ (function () {
    /**
     * 构造函数
     */
    function BindingList(properties) {
        this.__type__ = 'BindingList';
        this.sortFields = [];
        this.sortDirections = [];
        /**
         * 界面数据源
         */
        this.defaultView = null;
        // #region 分页相关
        /**
         * 分页信息
         */
        this._paginationInfo = null;
        this.properties = properties;
        this.primaryKey = PropertyUtil.getPrimaryKey(properties);
        this.changes = new Subject();
        this.innerList = List();
        this.currentId = null;
        this.destroy$ = new Subject();
        this.updateDefaultView(this.changes);
    }
    Object.defineProperty(BindingList.prototype, "paginationInfo", {
        get: function () {
            return this._paginationInfo;
        },
        set: function (sPaginationInfo) {
            this._paginationInfo = sPaginationInfo;
            if (this._paginationInfo === sPaginationInfo) {
                return;
            }
            this.changes.next({
                type: ChangeType.PaginationInfoChange,
                path: [],
                value: this._paginationInfo
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "pageIndex", {
        /**
         * 获取页码
         */
        get: function () {
            if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageIndex")) {
                return this.paginationInfo.pageIndex;
            }
            return 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "pageSize", {
        /**
         * 获取分页大小
         */
        get: function () {
            if (!!this.paginationInfo && this.paginationInfo.hasOwnProperty("pageSize")) {
                return this.paginationInfo.pageSize;
            }
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "total", {
        /**
         * 获取数据总项数
         */
        get: function () {
            if (!!this.paginationInfo) {
                return this.paginationInfo.total || this.paginationInfo.totalCount;
            }
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "skip", {
        /**
         * 获取跳过的数据条数
         */
        get: function () {
            var pageIndex = this.pageIndex;
            var pageSize = this.pageSize;
            return (pageIndex - 1) * pageSize;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 前台设置分页信息
     * @param skip skip
     * @param take take
     */
    BindingList.prototype.setPaginationInfo = function (skip, take) {
        this.paginationInfo = Object.assign({}, this.paginationInfo, {
            pageSize: take,
            pageIndex: skip / take + 1
        });
        /*this.changes.next({
          type: ChangeType.PaginationInfoChange,
          path: [],
          value: this.paginationInfo
        });*/
    };
    Object.defineProperty(BindingList.prototype, "currentItem", {
        //#endregion
        /**
         * 当前行对应的绑定对象
         * 如果currentId为null，则创建一个空结构，防止绑定报错；
         */
        get: function () {
            var currentItem = this.findById(this.currentId);
            if (!currentItem) {
                if (!this.emptyCurrentItem) {
                    this.emptyCurrentItem = BindingObjectFactory.create(this.properties);
                }
                return this.emptyCurrentItem;
            }
            return currentItem;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BindingList.prototype, "length", {
        /**
         * 绑定对象的数量
         */
        get: function () {
            return this.innerList.count();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 销毁
     * @param options
     */
    BindingList.prototype.dispose = function (options) {
        this.clear(true);
        if (this.destroy$) {
            this.destroy$.next();
            this.destroy$.complete();
            this.destroy$ = null;
        }
    };
    /**
     * 添加[Symbol.iterator]，使之能通过for of遍历
     */
    BindingList.prototype[Symbol.iterator] = function () {
        var self = this;
        var index = -1;
        var size = this.innerList.size;
        return {
            next: function () {
                index++;
                if (index < size) {
                    return { done: false, value: self.innerList.get(index) };
                }
                return { done: true, value: undefined };
            }
        };
    };
    /**
     * 批量加载绑定对象，加载之前先清空绑定列表，并重置当前行，加载之后将第一行设置为默认当前行。
     * @param objects 要加载绑定对象数组
     */
    BindingList.prototype.load = function (objects, entityCreate) {
        var _this = this;
        if (entityCreate === void 0) { entityCreate = false; }
        // 重置列表
        this.innerList = this.innerList.clear();
        if (objects.length !== 0) {
            // 加载数据
            objects.forEach(function (object) {
                _this.add(object);
            });
            // 设置默认当前行
            var currentItem = this.findById(this.currentId);
            if (!currentItem) {
                var firstId = objects[0][this.primaryKey];
                this.setCurrentId(firstId, false, false);
            }
        }
        else {
            this.currentId = null;
        }
        var change = {
            type: ChangeType.Load,
            path: [],
            value: objects
        };
        change.create = entityCreate;
        // 触发事件
        this.changes.next(change);
    };
    /**
     * 批量追加绑定对象，追加之后将最后一个追加的绑定对象设置为当前行。
     * @param objects 要加载绑定对象数组
     */
    BindingList.prototype.append = function (objects, isCloned, options) {
        var _this = this;
        if (isCloned === void 0) { isCloned = false; }
        if (options === void 0) { options = null; }
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach(function (object) {
            _this.add(object);
        });
        // 当前行为新追加的最后1行
        var lastId = objects[objects.length - 1][this.primaryKey];
        this.setCurrentId(lastId, true, true);
        // 触发事件
        var change = {
            type: ChangeType.Append,
            path: [],
            value: objects,
            isTreeNodeLoadScene: options && options.isTreeNodeLoadScene
        };
        if (isCloned) {
            change.isCloned = true;
        }
        this.changes.next(change);
    };
    /**
     * 增加数据
     * @param objects 实体
     * @param options 上下文
     * @description 增加实体数据，但不切换当前行
     */
    BindingList.prototype.addData = function (objects, options) {
        var _this = this;
        if (options === void 0) { options = null; }
        if (objects.length === 0) {
            return;
        }
        // 加载BindingObject
        objects.forEach(function (object) {
            _this.add(object);
        });
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: objects,
            isTreeNodeLoadScene: options && options.isTreeNodeLoadScene
        });
    };
    BindingList.prototype.insert = function (object, position) {
        var _this = this;
        var currentIndex = this.innerList.findIndex(function (obj) { return obj.primaryKeyValue === _this.currentId; });
        // 加载BindingObject
        if (position === 1) {
            this.innerList = this.innerList.insert(currentIndex + 1, object);
        }
        else if (position === -1) {
            this.innerList = this.innerList.insert(currentIndex, object);
        }
        else {
            this.innerList = this.innerList.push(object);
        }
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe(function (change) {
            _this.changes.next(change);
        });
        this.setCurrentId(object.primaryKeyValue, true, true);
        // 触发事件
        this.changes.next({
            type: ChangeType.Append,
            path: [],
            value: object,
            detail: {
                type: 'insert',
                position: position
            }
        });
    };
    /**
     * 添加绑定对象，并建立绑定对象和绑定列表之间的关联。
     * @param object 绑定对象
     */
    BindingList.prototype.add = function (object) {
        var _this = this;
        this.innerList = this.innerList.push(object);
        object.parent = this;
        // 监听object变更，并继续向上抛，由于list有当前行的概念，不需要在path中追加路径
        object.changes.subscribe(function (change) {
            _this.changes.next(change);
        });
    };
    /**
     * 删除主键值数组对应的绑定对象。
     * @param ids 主键值数组
     */
    BindingList.prototype.removeByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length === 0) {
            return;
        }
        var nextCurrentId = this.currentId;
        ids.forEach(function (id) {
            // 如果当前行被删除，计算下一当前行
            if (id === nextCurrentId) {
                nextCurrentId = _this.getCurrentIdBeforeDeleting();
            }
            // 删除对象，找不到时跳过
            var index = _this.getIndexById(id);
            if (index === -1) {
                return;
            }
            _this.innerList = _this.innerList.delete(index);
        });
        // 重新设置当前行
        if (this.innerList.count() === 0) {
            this.currentId = null;
        }
        else {
            this.setCurrentId(nextCurrentId, false, false);
        }
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    };
    /**
     * 删除数据（不切换当前行）
     * @param ids ids
     */
    BindingList.prototype.removeDataByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length === 0) {
            return;
        }
        ids.forEach(function (id) {
            // 删除对象，找不到时跳过
            var index = _this.getIndexById(id);
            if (index === -1) {
                return;
            }
            _this.innerList = _this.innerList.delete(index);
        });
        // 出发行删除事件
        this.changes.next({
            type: ChangeType.Remove,
            path: [],
            value: ids
        });
    };
    /**
     * 清空
     */
    BindingList.prototype.clear = function (clearOnly) {
        if (clearOnly === void 0) { clearOnly = false; }
        this.innerList.forEach(function (item) {
            item['_ENTITY_'] = null;
            item.unsubscribe.next();
            item.unsubscribe.complete();
            item.changes.complete();
            item.viewChanges.complete();
        });
        this.innerList = this.innerList.clear();
        if (!clearOnly) {
            this.currentId = null;
            this.changes.next({
                type: ChangeType.Remove,
                path: [],
                value: []
            });
        }
    };
    /**
     * 如果当前行被删除，删除之前重新计算当前行的位置，并返回下一当前行的主键值。
     * - 如果被删除的行是最后1行，则上移1行；
     * - 其他情况，下移1行。
     */
    BindingList.prototype.getCurrentIdBeforeDeleting = function () {
        var nextIndex = -1;
        var currentIndex = this.getIndexById(this.currentId);
        if (currentIndex === this.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return this.getIdByIndex(nextIndex);
    };
    /**
     * 根据主键值获取对应绑定对象
     * @param   id 要查找的主键值
     * @returns 找到时返回对应BindingObject， 找不到时返回null
     */
    BindingList.prototype.findById = function (id) {
        var _this = this;
        var target;
        target = this.innerList.find(function (item) {
            return item.getValue(_this.primaryKey) === id;
        });
        return target === undefined ? null : target;
    };
    /**
     * 将主键值为id的绑定对象设置为当前行
     * @param  id        要设置的主键值
     * @param  emitEvent 是否发送当前行变更事件
     * @param  force 强制切换
     */
    BindingList.prototype.setCurrentId = function (id, emitEvent, emitGlobalEvent, force) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (emitGlobalEvent === void 0) { emitGlobalEvent = true; }
        if (force === void 0) { force = false; }
        if (this.currentId === id && !force) {
            return;
        }
        // 不存在时设置为null
        // const currentObj = this.findById(id);
        // if (!currentObj) {
        //   this.currentId = null;
        // } else {
        //   this.currentId = id;
        // }
        // @todo：找不到时按理应该设置为null，目前是直接返回，框架部分功能依赖该特性。
        var currentObj = this.findById(id);
        if (!currentObj && !force) {
            return;
        }
        this.currentId = id;
        // 发出行切换事件
        if (emitEvent === true) {
            this.changes.next({
                type: ChangeType.SelectionChanged,
                path: [],
                value: this.currentItem,
                force: force
            });
        }
        // 是否发送全局的行切换事件
        if (emitGlobalEvent === true) {
            this.changes.next({
                type: ChangeType.GlobalSelectionChanged,
                path: [],
                value: this.currentItem,
                force: force
            });
        }
    };
    /**
     * 根据主键值为id的绑定对象的索引
     * @param id 主键值
     * @returns 找到时返回对应的index，找不到时返回-1
     */
    BindingList.prototype.getIndexById = function (id) {
        var _this = this;
        return this.innerList.findIndex(function (obj) {
            return obj[_this.primaryKey] === id;
        });
    };
    /**
     * 根据索引位置获取对应绑定对象的主键值
     * @reutrn 找到时返回对应主键值，找不到返回null
     */
    BindingList.prototype.getIdByIndex = function (index) {
        if (index < 0 || index > this.length) {
            return null;
        }
        if (this.innerList.has(index) === false) {
            return null;
        }
        var obj = this.innerList.get(index);
        return obj[this.primaryKey];
    };
    /**
     * 转换为BindingObject数组
     */
    BindingList.prototype.toArray = function () {
        return this.innerList.toArray();
    };
    /**
     * 交互数据位置
     * @param id1 id1
     * @param id2 id2
     */
    BindingList.prototype.swapById = function (id1, id2) {
        var item1 = this.innerList.find(function (element) { return element.primaryKeyValue === id1; });
        var item2 = this.innerList.find(function (element) { return element.primaryKeyValue === id2; });
        this.innerList = this.innerList.map(function (bindingObject, index) {
            if (bindingObject.primaryKeyValue === id1) {
                return item2;
            }
            else if (bindingObject.primaryKeyValue === id2) {
                return item1;
            }
            else
                return bindingObject;
        }).toList();
        this.changes.next({
            type: ChangeType.Swap,
            path: [],
            detail: {
                type: 'swap',
                id: [id1, id2]
            }
        });
    };
    /**
     * 转换为JSON对象
     * @param options 配置
     * @returns 普通对象数组
     */
    BindingList.prototype.toJSON = function (options) {
        var result = [];
        this.innerList.forEach(function (obj) {
            result.push(obj.toJSON(options));
        });
        return result;
    };
    /**
     * 过滤列表数据
     * @param conditions 过滤条件
     */
    BindingList.prototype.filter = function (conditions) {
        if (this.defaultView === null) {
            this.defaultView = this.innerList.toList();
        }
        var list;
        if (Array.isArray(conditions)) {
            var filter_1 = new ArrayFilterConditionDataFilter();
            list = this.defaultView.filter(function (bindingObject) {
                return filter_1.validateRowData(bindingObject, conditions);
            }).toList();
        }
        else {
            var filter_2 = new ObjectFilterConditionDataFilter();
            list = this.defaultView.filter(function (bindingObject) {
                return filter_2.validateRowData(bindingObject, conditions);
            }).toList();
        }
        // 如果有排序条件，则对过滤后的结果进行排序
        if (this.sortFields && this.sortFields.length > 0) {
            this.innerList = list.sort(this.comparator(this.sortFields, this.sortDirections)).toList();
        }
        else {
            this.innerList = list;
        }
    };
    /**
     * 获取分页信息
     * @param path 路径
     * @param defaultValue 默认值
     * @throws 路径必须为字符串！
     */
    BindingList.prototype.getPaginationConfigByPath = function (path, defaultValue) {
        if (!path || path === '/') {
            return this.paginationInfo;
        }
        if (typeof path !== 'string') {
            throw new Error('路径必须为字符串！');
        }
        path = path.substring(1);
        var paths = path.split('/').filter(function (item) { return !!item && item.trim().length > 0; }).map(function (item) { return item.trim(); });
        var config = this.paginationInfo;
        paths.forEach(function (item) {
            if (config && config.hasOwnProperty(item)) {
                config = config[item];
            }
            else {
                config = null;
            }
        });
        return !!config ? config : typeof defaultValue !== 'undefined' ? defaultValue : undefined;
    };
    /**
     * 对bindingList就行排序
     * @param fields - 排序字段
     * @param directions - 排序规则字段
     * @param options - 参数
     * @throws argument error
     */
    BindingList.prototype.sortBy = function (fields, directions, options) {
        if (!this.defaultView) {
            this.defaultView = this.innerList.toList();
        }
        // 默认升序
        var arrFields = typeof fields === 'string' ? fields.split(',').filter(function (p) { return p; }) : fields || [];
        var arrDirections = typeof directions === 'string' ? directions.split(',').filter(function (p) { return p; }) : directions || [];
        // 排序字段和排序方式应一致
        if (arrFields.length !== arrDirections.length) {
            throw new Error('sortBy:fields and directions not match');
        }
        this.sortFields = arrFields;
        this.sortDirections = arrDirections;
        if (!this.sortFields || this.sortFields.length < 1) {
            if (this.defaultView) {
                this.innerList = this.defaultView.toList();
                // 清空过滤条件后重置原始数据源
                this.defaultView = null;
            }
        }
        else {
            this.innerList = this.innerList.sort(this.comparator(arrFields, arrDirections)).toList();
        }
    };
    BindingList.prototype.getValue = function (target, propName, isMultiLangProp, currentLanguage) {
        if (isMultiLangProp === void 0) { isMultiLangProp = false; }
        if (currentLanguage === void 0) { currentLanguage = 'zh-CHS'; }
        var e_1, _a;
        if (target instanceof BindingList) {
            target = target.currentItem;
        }
        else if (target instanceof BindingData) {
            target = target.list.currentItem;
        }
        var result = null;
        if (propName.indexOf('.') === -1) {
            result = target[propName];
        }
        else {
            var props = propName.split('.');
            try {
                for (var props_1 = tslib_1.__values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {
                    var prop = props_1_1.value;
                    target = result = this.getValue(target, prop, isMultiLangProp, currentLanguage);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        if (isMultiLangProp && result && result.hasOwnProperty(currentLanguage)) {
            return result[currentLanguage];
        }
        else {
            return result;
        }
    };
    /**
     * 排序器
     * @param props - 排序字段
     * @param orders - 排序规则
     * @returns
     */
    BindingList.prototype.comparator = function (props, orders) {
        var _this = this;
        return function (item1, item2) {
            return props.reduce(function (result, prop) {
                if (result === 0) {
                    var bindingProperty = _this.properties.find(function (item) { return item.name === prop; });
                    var isMultiLangProp = false;
                    if (bindingProperty) {
                        isMultiLangProp = bindingProperty.enableMultiLangInput;
                    }
                    var currentLanguage = TranslateService.getCurrentLanguage();
                    var order = ['asc'].includes(orders[props.indexOf(prop)]) ? 1 : -1;
                    var item1Value = _this.getValue(item1, prop, isMultiLangProp, currentLanguage);
                    var item2Value = _this.getValue(item2, prop, isMultiLangProp, currentLanguage);
                    if (item1Value === null || item1Value === undefined) {
                        item1Value = '';
                    }
                    if (item2Value === null || item2Value === undefined) {
                        item2Value = '';
                    }
                    if (typeof item1Value === 'string' && typeof item2Value === 'string') {
                        var localeCompareResult = item1Value.localeCompare(item2Value);
                        result = localeCompareResult * order;
                    }
                    else {
                        if (item1Value > item2Value) {
                            result = order * 1;
                        }
                        if (item1Value < item2Value) {
                            result = order * -1;
                        }
                    }
                }
                return result;
            }, 0);
        };
    };
    BindingList.prototype.updateDefaultView = function (change) {
        var _this = this;
        change.pipe(takeUntil(this.destroy$)).subscribe(function (change) {
            var _a;
            if (_this.defaultView !== null && ((change.path.length === 0 && [ChangeType.Load, ChangeType.Append, ChangeType.Remove, ChangeType.Swap].includes(change.type)) || (change.type === ChangeType.ValueChanged && change.isBindingListTransmited !== true))) {
                switch (change.type) {
                    case ChangeType.Load:
                        _this.defaultView = _this.innerList.toList();
                        break;
                    case ChangeType.Append: {
                        // 插入
                        if (change.detail && change.detail.type === 'insert') {
                            var position = change.detail.position;
                            var object = change.value;
                            var currentIndex = _this.innerList.findIndex(function (obj) { return obj.primaryKeyValue === _this.currentId; });
                            // 加载BindingObject
                            if (position === 1) {
                                _this.defaultView = _this.defaultView.insert(currentIndex + 1, object);
                            }
                            else if (position === -1) {
                                _this.defaultView = _this.defaultView.insert(currentIndex, object);
                            }
                            else {
                                _this.defaultView = _this.defaultView.push(object);
                            }
                        }
                        else {
                            var objects = change.value;
                            _this.defaultView = (_a = _this.defaultView).push.apply(_a, tslib_1.__spread(objects));
                        }
                        break;
                    }
                    case ChangeType.Remove:
                        var ids = change.value;
                        if (ids.length === 0) {
                            _this.defaultView = _this.defaultView.clear();
                        }
                        else {
                            ids.forEach(function (id) {
                                var index = _this.defaultView.findIndex(function (bindingObject) { return bindingObject.primaryKeyValue === id; });
                                _this.defaultView = _this.defaultView.delete(index);
                            });
                        }
                        break;
                    case ChangeType.ValueChanged:
                        var id_1 = change.id;
                        var bindingObject = _this.defaultView.find(function (obj) { return obj.primaryKeyValue === id_1; });
                        var paths = change.path.concat([]);
                        var propertyName = paths.pop();
                        var target = paths.reduce(function (object, path) {
                            return object[path];
                        }, bindingObject);
                        if (target) {
                            target.setValue(propertyName, change.value);
                        }
                        break;
                    case ChangeType.Swap:
                        var _b = tslib_1.__read(change.detail && change.detail.id, 2), id1_1 = _b[0], id2_1 = _b[1];
                        var item1_1 = _this.defaultView.find(function (element) { return element.primaryKeyValue === id1_1; });
                        var item2_1 = _this.defaultView.find(function (element) { return element.primaryKeyValue === id2_1; });
                        _this.defaultView = _this.defaultView.map(function (bindingObject, index) {
                            if (bindingObject.primaryKeyValue === id1_1) {
                                return item2_1;
                            }
                            else if (bindingObject.primaryKeyValue === id2_1) {
                                return item1_1;
                            }
                            else
                                return bindingObject;
                        }).toList();
                        break;
                    // case ChangeType.SortChanged:
                    //   const { fields = [], directions = [] } = change.detail || {};
                    //   this.defaultView = this.defaultView.sort(this.comparator(fields, directions)).toList();
                    //   break;
                }
            }
        });
    };
    return BindingList;
}());
export { BindingList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19saXN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvYmluZGluZy1kYXRhL2JpbmRpbmdfbGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7O0FBRUgsa0NBQWtDO0FBRWxDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDakMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLEVBQVUsVUFBVSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRy9DLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFN0QsT0FBTyxFQUFtQiw4QkFBOEIsRUFBeUIsK0JBQStCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6SSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0M7O0dBRUc7QUFDSDtJQTZJRTs7T0FFRztJQUNILHFCQUFZLFVBQTZCO1FBL0lsQyxhQUFRLEdBQUcsYUFBYSxDQUFDO1FBTXhCLGVBQVUsR0FBYSxFQUFFLENBQUM7UUFDMUIsbUJBQWMsR0FBYSxFQUFFLENBQUM7UUFDdEM7O1dBRUc7UUFDSSxnQkFBVyxHQUF3QixJQUFJLENBQUM7UUE4Qi9DLGVBQWU7UUFFZjs7V0FFRztRQUNJLG9CQUFlLEdBQVEsSUFBSSxDQUFDO1FBa0dqQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsVUFBVSxHQUFHLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFekQsSUFBSSxDQUFDLE9B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LE9BQU8sYUFBYSxDQUFDO3dCQUM5QixDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQzt3QkFDWixNQUFNO29CQUNSLCtCQUErQjtvQkFDL0Isa0VBQWtFO29CQUNsRSw0RkFBNEY7b0JBQzVGLFdBQVc7aUJBQ1o7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNILGtCQUFDO0FBQUQsQ0FBQyxBQWx2QkQsSUFrdkJDO0FBRUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIOe7keWumuWIl+ihqOebuOWFs+WumuS5iVxyXG4gKiBAYXV0aG9yIFdpdHQ8aml3dEBpbnNwdXIuY29tPlxyXG4gKi9cclxuXHJcbi8vIHRzbGludDpkaXNhYmxlOiBtYXgtbGluZS1sZW5ndGhcclxuXHJcbmltcG9ydCB7IExpc3QgfSBmcm9tICdpbW11dGFibGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBDaGFuZ2UsIENoYW5nZVR5cGUgfSBmcm9tICcuL2NoYW5nZXMnO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdQcm9wZXJ0eSB9IGZyb20gJy4vYmluZGluZ19wcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJpbmRpbmdPYmplY3RGYWN0b3J5IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdF9mYWN0b3J5JztcclxuaW1wb3J0IHsgUHJvcGVydHlVdGlsIH0gZnJvbSAnLi9wcm9wZXJ0eV91dGlsJztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEgfSBmcm9tICcuL2JpbmRpbmdfZGF0YSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9pMThuL3RyYW5zbGF0ZV9zZXJ2aWNlJztcclxuaW1wb3J0IHsgSURpc3Bvc2FibGUgfSBmcm9tICcuLi9jb3JlJztcclxuaW1wb3J0IHsgRmlsdGVyQ29uZGl0aW9uLCBBcnJheUZpbHRlckNvbmRpdGlvbkRhdGFGaWx0ZXIsIE9iamVjdEZpbHRlckNvbmRpdGlvbiwgT2JqZWN0RmlsdGVyQ29uZGl0aW9uRGF0YUZpbHRlciB9IGZyb20gJy4uL2RhdGEtZmlsdGVyJztcclxuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuLyoqXHJcbiAqIEJpbmRpbmdMaXN05piv5LiA5LiqQmluZGluZ09iamVjdOmbhuWQiFxyXG4gKi9cclxuY2xhc3MgQmluZGluZ0xpc3QgaW1wbGVtZW50cyBJRGlzcG9zYWJsZSB7XHJcbiAgcHVibGljIF9fdHlwZV9fID0gJ0JpbmRpbmdMaXN0JztcclxuICAvKipcclxuICAgKiBpbW11dGFibGXnmoRCaW5kaW5nT2JqZWN05YiX6KGoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbm5lckxpc3Q6IExpc3Q8QmluZGluZ09iamVjdD47XHJcbiAgcHJpdmF0ZSBlbXB0eUN1cnJlbnRJdGVtOiBCaW5kaW5nT2JqZWN0O1xyXG4gIHByaXZhdGUgc29ydEZpZWxkczogc3RyaW5nW10gPSBbXTtcclxuICBwcml2YXRlIHNvcnREaXJlY3Rpb25zOiBzdHJpbmdbXSA9IFtdO1xyXG4gIC8qKlxyXG4gICAqIOeVjOmdouaVsOaNrua6kFxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZWZhdWx0VmlldzogTGlzdDxCaW5kaW5nT2JqZWN0PiA9IG51bGw7XHJcbiAgLyoqXHJcbiAgICog5YWz6IGU5a6e5L2T55qE5bGe5oCn6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdO1xyXG5cclxuICAvKipcclxuICAgKiDkuLvplK7lkI1cclxuICAgKi9cclxuICBwdWJsaWMgcHJpbWFyeUtleTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDniLblr7nosaFcclxuICAgKi9cclxuICBwdWJsaWMgcGFyZW50OiBCaW5kaW5nT2JqZWN0O1xyXG5cclxuICAvKipcclxuICAgKiDlj5jmm7TmtYFcclxuICAgKi9cclxuICBwdWJsaWMgY2hhbmdlczogU3ViamVjdDxDaGFuZ2U+O1xyXG5cclxuICAvKipcclxuICAgKiDlvZPliY3ooYzlr7nlupTnmoTnu5Hlrprlr7nosaHnmoTlhoXnoIFcclxuICAgKi9cclxuICBwdWJsaWMgY3VycmVudElkOiBzdHJpbmc7XHJcbiAgLyoqXHJcbiAgICogZGVzdG9yeSBzaWduYWxcclxuICAgKi9cclxuICBwdWJsaWMgZGVzdHJveSQ6IFN1YmplY3Q8YW55PjtcclxuXHJcbiAgLy8gI3JlZ2lvbiDliIbpobXnm7jlhbNcclxuXHJcbiAgLyoqXHJcbiAgICog5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHVibGljIF9wYWdpbmF0aW9uSW5mbzogYW55ID0gbnVsbDtcclxuXHJcbiAgc2V0IHBhZ2luYXRpb25JbmZvKHNQYWdpbmF0aW9uSW5mbzogYW55KSB7XHJcbiAgICB0aGlzLl9wYWdpbmF0aW9uSW5mbyA9IHNQYWdpbmF0aW9uSW5mbztcclxuICAgIGlmICh0aGlzLl9wYWdpbmF0aW9uSW5mbyA9PT0gc1BhZ2luYXRpb25JbmZvKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KHtcclxuICAgICAgdHlwZTogQ2hhbmdlVHlwZS5QYWdpbmF0aW9uSW5mb0NoYW5nZSxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiB0aGlzLl9wYWdpbmF0aW9uSW5mb1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXQgcGFnaW5hdGlvbkluZm8oKTogYW55IHtcclxuICAgIHJldHVybiB0aGlzLl9wYWdpbmF0aW9uSW5mbztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W6aG156CBXHJcbiAgICovXHJcbiAgZ2V0IHBhZ2VJbmRleCgpIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8gJiYgdGhpcy5wYWdpbmF0aW9uSW5mby5oYXNPd25Qcm9wZXJ0eShcInBhZ2VJbmRleFwiKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uSW5mby5wYWdlSW5kZXg7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YiG6aG15aSn5bCPXHJcbiAgICovXHJcbiAgZ2V0IHBhZ2VTaXplKCkge1xyXG4gICAgaWYgKCEhdGhpcy5wYWdpbmF0aW9uSW5mbyAmJiB0aGlzLnBhZ2luYXRpb25JbmZvLmhhc093blByb3BlcnR5KFwicGFnZVNpemVcIikpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8ucGFnZVNpemU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaVsOaNruaAu+mhueaVsFxyXG4gICAqL1xyXG4gIGdldCB0b3RhbCgpIHtcclxuICAgIGlmICghIXRoaXMucGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm8udG90YWwgfHwgdGhpcy5wYWdpbmF0aW9uSW5mby50b3RhbENvdW50O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlui3s+i/h+eahOaVsOaNruadoeaVsFxyXG4gICAqL1xyXG4gIGdldCBza2lwKCkge1xyXG4gICAgY29uc3QgcGFnZUluZGV4ID0gdGhpcy5wYWdlSW5kZXg7XHJcbiAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMucGFnZVNpemU7XHJcbiAgICByZXR1cm4gKHBhZ2VJbmRleCAtIDEpICogcGFnZVNpemU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliY3lj7Dorr7nva7liIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gc2tpcCBza2lwXHJcbiAgICogQHBhcmFtIHRha2UgdGFrZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRQYWdpbmF0aW9uSW5mbyhza2lwOiBudW1iZXIsIHRha2U6IG51bWJlcikge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uSW5mbyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucGFnaW5hdGlvbkluZm8sIHtcclxuICAgICAgcGFnZVNpemU6IHRha2UsXHJcbiAgICAgIHBhZ2VJbmRleDogc2tpcCAvIHRha2UgKyAxXHJcbiAgICB9KTtcclxuICAgIC8qdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlBhZ2luYXRpb25JbmZvQ2hhbmdlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IHRoaXMucGFnaW5hdGlvbkluZm9cclxuICAgIH0pOyovXHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvKipcclxuICAgKiDlvZPliY3ooYzlr7nlupTnmoTnu5Hlrprlr7nosaFcclxuICAgKiDlpoLmnpxjdXJyZW50SWTkuLpudWxs77yM5YiZ5Yib5bu65LiA5Liq56m657uT5p6E77yM6Ziy5q2i57uR5a6a5oql6ZSZ77ybXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBjdXJyZW50SXRlbSgpOiBCaW5kaW5nT2JqZWN0IHtcclxuICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy5maW5kQnlJZCh0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICBpZiAoIWN1cnJlbnRJdGVtKSB7XHJcbiAgICAgIGlmICghdGhpcy5lbXB0eUN1cnJlbnRJdGVtKSB7XHJcbiAgICAgICAgdGhpcy5lbXB0eUN1cnJlbnRJdGVtID0gQmluZGluZ09iamVjdEZhY3RvcnkuY3JlYXRlKHRoaXMucHJvcGVydGllcyk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXMuZW1wdHlDdXJyZW50SXRlbTtcclxuICAgIH1cclxuICAgIHJldHVybiBjdXJyZW50SXRlbTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7keWumuWvueixoeeahOaVsOmHj1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QuY291bnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByb3BlcnRpZXM6IEJpbmRpbmdQcm9wZXJ0eVtdKSB7XHJcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzO1xyXG4gICAgdGhpcy5wcmltYXJ5S2V5ID0gUHJvcGVydHlVdGlsLmdldFByaW1hcnlLZXkocHJvcGVydGllcyk7XHJcblxyXG4gICAgdGhpcy5jaGFuZ2VzID0gbmV3IFN1YmplY3Q8Q2hhbmdlPigpO1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSBMaXN0PEJpbmRpbmdPYmplY3Q+KCk7XHJcbiAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICB0aGlzLmRlc3Ryb3kkID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHRoaXMudXBkYXRlRGVmYXVsdFZpZXcodGhpcy5jaGFuZ2VzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6ZSA5q+BXHJcbiAgICogQHBhcmFtIG9wdGlvbnNcclxuICAgKi9cclxuICBkaXNwb3NlKG9wdGlvbnM/OiBhbnkpIHtcclxuICAgIHRoaXMuY2xlYXIodHJ1ZSk7XHJcbiAgICBpZiAodGhpcy5kZXN0cm95JCkge1xyXG4gICAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG4gICAgICB0aGlzLmRlc3Ryb3kkID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoFtTeW1ib2wuaXRlcmF0b3Jd77yM5L2/5LmL6IO96YCa6L+HZm9yIG9m6YGN5Y6GXHJcbiAgICovXHJcbiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGxldCBpbmRleCA9IC0xO1xyXG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMuaW5uZXJMaXN0LnNpemU7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgc2l6ZSkge1xyXG4gICAgICAgICAgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBzZWxmLmlubmVyTGlzdC5nZXQoaW5kZXgpIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiB1bmRlZmluZWQgfTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WKoOi9vee7keWumuWvueixoe+8jOWKoOi9veS5i+WJjeWFiOa4heepuue7keWumuWIl+ihqO+8jOW5tumHjee9ruW9k+WJjeihjO+8jOWKoOi9veS5i+WQjuWwhuesrOS4gOihjOiuvue9ruS4uum7mOiupOW9k+WJjeihjOOAglxyXG4gICAqIEBwYXJhbSBvYmplY3RzIOimgeWKoOi9vee7keWumuWvueixoeaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkKG9iamVjdHM6IEJpbmRpbmdPYmplY3RbXSwgZW50aXR5Q3JlYXRlOiBib29sZWFuID0gZmFsc2UpOiB2b2lkIHtcclxuICAgIC8vIOmHjee9ruWIl+ihqFxyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5jbGVhcigpO1xyXG4gICAgaWYgKG9iamVjdHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgIC8vIOWKoOi9veaVsOaNrlxyXG4gICAgICBvYmplY3RzLmZvckVhY2goKG9iamVjdDogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICAgIHRoaXMuYWRkKG9iamVjdCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8g6K6+572u6buY6K6k5b2T5YmN6KGMXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy5maW5kQnlJZCh0aGlzLmN1cnJlbnRJZCk7XHJcbiAgICAgIGlmICghY3VycmVudEl0ZW0pIHtcclxuICAgICAgICBjb25zdCBmaXJzdElkID0gb2JqZWN0c1swXVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0SWQsIGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3VycmVudElkID0gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGNoYW5nZTogQ2hhbmdlID0ge1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLkxvYWQsXHJcbiAgICAgIHBhdGg6IFtdLFxyXG4gICAgICB2YWx1ZTogb2JqZWN0c1xyXG4gICAgfTtcclxuICAgIGNoYW5nZS5jcmVhdGUgPSBlbnRpdHlDcmVhdGU7XHJcbiAgICAvLyDop6blj5Hkuovku7ZcclxuICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/ov73liqDnu5Hlrprlr7nosaHvvIzov73liqDkuYvlkI7lsIbmnIDlkI7kuIDkuKrov73liqDnmoTnu5Hlrprlr7nosaHorr7nva7kuLrlvZPliY3ooYzjgIJcclxuICAgKiBAcGFyYW0gb2JqZWN0cyDopoHliqDovb3nu5Hlrprlr7nosaHmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYXBwZW5kKG9iamVjdHM6IEJpbmRpbmdPYmplY3RbXSwgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSwgb3B0aW9uczogYW55ID0gbnVsbCk6IHZvaWQge1xyXG4gICAgaWYgKG9iamVjdHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOWKoOi9vUJpbmRpbmdPYmplY3RcclxuICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0OiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMuYWRkKG9iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIC8vIOW9k+WJjeihjOS4uuaWsOi/veWKoOeahOacgOWQjjHooYxcclxuICAgIGNvbnN0IGxhc3RJZCA9IG9iamVjdHNbb2JqZWN0cy5sZW5ndGggLSAxXVt0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgdGhpcy5zZXRDdXJyZW50SWQobGFzdElkLCB0cnVlLCB0cnVlKTtcclxuICAgIC8vIOinpuWPkeS6i+S7tlxyXG4gICAgY29uc3QgY2hhbmdlOiBDaGFuZ2UgPSB7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdHMsXHJcbiAgICAgIGlzVHJlZU5vZGVMb2FkU2NlbmU6IG9wdGlvbnMgJiYgb3B0aW9ucy5pc1RyZWVOb2RlTG9hZFNjZW5lXHJcbiAgICB9O1xyXG4gICAgaWYgKGlzQ2xvbmVkKSB7XHJcbiAgICAgIGNoYW5nZS5pc0Nsb25lZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlop7liqDmlbDmja5cclxuICAgKiBAcGFyYW0gb2JqZWN0cyDlrp7kvZNcclxuICAgKiBAcGFyYW0gb3B0aW9ucyDkuIrkuIvmlodcclxuICAgKiBAZGVzY3JpcHRpb24g5aKe5Yqg5a6e5L2T5pWw5o2u77yM5L2G5LiN5YiH5o2i5b2T5YmN6KGMXHJcbiAgICovXHJcbiAgcHVibGljIGFkZERhdGEob2JqZWN0czogQmluZGluZ09iamVjdFtdLCBvcHRpb25zOiBhbnkgPSBudWxsKTogdm9pZCB7XHJcbiAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5Yqg6L29QmluZGluZ09iamVjdFxyXG4gICAgb2JqZWN0cy5mb3JFYWNoKChvYmplY3Q6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgdGhpcy5hZGQob2JqZWN0KTtcclxuICAgIH0pO1xyXG4gICAgLy8g6Kem5Y+R5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuQXBwZW5kLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IG9iamVjdHMsXHJcbiAgICAgIGlzVHJlZU5vZGVMb2FkU2NlbmU6IG9wdGlvbnMgJiYgb3B0aW9ucy5pc1RyZWVOb2RlTG9hZFNjZW5lXHJcbiAgICB9KTtcclxuICB9XHJcbiAgcHVibGljIGluc2VydChvYmplY3Q6IEJpbmRpbmdPYmplY3QsIHBvc2l0aW9uPzogMSB8IC0xKSB7XHJcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLmlubmVyTGlzdC5maW5kSW5kZXgoKG9iajogQmluZGluZ09iamVjdCkgPT4gb2JqLnByaW1hcnlLZXlWYWx1ZSA9PT0gdGhpcy5jdXJyZW50SWQpO1xyXG4gICAgLy8g5Yqg6L29QmluZGluZ09iamVjdFxyXG4gICAgaWYgKHBvc2l0aW9uID09PSAxKSB7XHJcbiAgICAgIHRoaXMuaW5uZXJMaXN0ID0gdGhpcy5pbm5lckxpc3QuaW5zZXJ0KGN1cnJlbnRJbmRleCArIDEsIG9iamVjdCk7XHJcbiAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAtMSkge1xyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0Lmluc2VydChjdXJyZW50SW5kZXgsIG9iamVjdCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LnB1c2gob2JqZWN0KTtcclxuICAgIH1cclxuICAgIG9iamVjdC5wYXJlbnQgPSB0aGlzO1xyXG4gICAgLy8g55uR5ZCsb2JqZWN05Y+Y5pu077yM5bm257un57ut5ZCR5LiK5oqb77yM55Sx5LqObGlzdOacieW9k+WJjeihjOeahOamguW/te+8jOS4jemcgOimgeWcqHBhdGjkuK3ov73liqDot6/lvoRcclxuICAgIG9iamVjdC5jaGFuZ2VzLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgdGhpcy5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuc2V0Q3VycmVudElkKG9iamVjdC5wcmltYXJ5S2V5VmFsdWUsIHRydWUsIHRydWUpO1xyXG5cclxuICAgIC8vIOinpuWPkeS6i+S7tlxyXG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLkFwcGVuZCxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiBvYmplY3QsXHJcbiAgICAgIGRldGFpbDoge1xyXG4gICAgICAgIHR5cGU6ICdpbnNlcnQnLFxyXG4gICAgICAgIHBvc2l0aW9uXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmt7vliqDnu5Hlrprlr7nosaHvvIzlubblu7rnq4vnu5Hlrprlr7nosaHlkoznu5HlrprliJfooajkuYvpl7TnmoTlhbPogZTjgIJcclxuICAgKiBAcGFyYW0gb2JqZWN0IOe7keWumuWvueixoVxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGQob2JqZWN0OiBCaW5kaW5nT2JqZWN0KSB7XHJcbiAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LnB1c2gob2JqZWN0KTtcclxuICAgIG9iamVjdC5wYXJlbnQgPSB0aGlzO1xyXG5cclxuICAgIC8vIOebkeWQrG9iamVjdOWPmOabtO+8jOW5tue7p+e7reWQkeS4iuaKm++8jOeUseS6jmxpc3TmnInlvZPliY3ooYznmoTmpoLlv7XvvIzkuI3pnIDopoHlnKhwYXRo5Lit6L+95Yqg6Lev5b6EXHJcbiAgICBvYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIHRoaXMuY2hhbmdlcy5uZXh0KGNoYW5nZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOS4u+mUruWAvOaVsOe7hOWvueW6lOeahOe7keWumuWvueixoeOAglxyXG4gICAqIEBwYXJhbSBpZHMg5Li76ZSu5YC85pWw57uEXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUJ5SWRzKGlkczogQXJyYXk8c3RyaW5nPik6IHZvaWQge1xyXG4gICAgaWYgKCFpZHMgfHwgaWRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG5leHRDdXJyZW50SWQgPSB0aGlzLmN1cnJlbnRJZDtcclxuICAgIGlkcy5mb3JFYWNoKChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIC8vIOWmguaenOW9k+WJjeihjOiiq+WIoOmZpO+8jOiuoeeul+S4i+S4gOW9k+WJjeihjFxyXG4gICAgICBpZiAoaWQgPT09IG5leHRDdXJyZW50SWQpIHtcclxuICAgICAgICBuZXh0Q3VycmVudElkID0gdGhpcy5nZXRDdXJyZW50SWRCZWZvcmVEZWxldGluZygpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDliKDpmaTlr7nosaHvvIzmib7kuI3liLDml7bot7Pov4dcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XHJcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5kZWxldGUoaW5kZXgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g6YeN5paw6K6+572u5b2T5YmN6KGMXHJcbiAgICBpZiAodGhpcy5pbm5lckxpc3QuY291bnQoKSA9PT0gMCkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNldEN1cnJlbnRJZChuZXh0Q3VycmVudElkLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWHuuWPkeihjOWIoOmZpOS6i+S7tlxyXG4gICAgdGhpcy5jaGFuZ2VzLm5leHQoe1xyXG4gICAgICB0eXBlOiBDaGFuZ2VUeXBlLlJlbW92ZSxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIHZhbHVlOiBpZHNcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliKDpmaTmlbDmja7vvIjkuI3liIfmjaLlvZPliY3ooYzvvIlcclxuICAgKiBAcGFyYW0gaWRzIGlkc1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVEYXRhQnlJZHMoaWRzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XHJcbiAgICBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAvLyDliKDpmaTlr7nosaHvvIzmib7kuI3liLDml7bot7Pov4dcclxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmdldEluZGV4QnlJZChpZCk7XHJcbiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5kZWxldGUoaW5kZXgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Ye65Y+R6KGM5Yig6Zmk5LqL5Lu2XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuUmVtb3ZlLFxyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgdmFsdWU6IGlkc1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa4heepulxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhcihjbGVhck9ubHk6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgdGhpcy5pbm5lckxpc3QuZm9yRWFjaCgoaXRlbTogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICBpdGVtWydfRU5USVRZXyddID0gbnVsbDtcclxuICAgICAgaXRlbS51bnN1YnNjcmliZS5uZXh0KCk7XHJcbiAgICAgIGl0ZW0udW5zdWJzY3JpYmUuY29tcGxldGUoKTtcclxuICAgICAgaXRlbS5jaGFuZ2VzLmNvbXBsZXRlKCk7XHJcbiAgICAgIGl0ZW0udmlld0NoYW5nZXMuY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5jbGVhcigpO1xyXG4gICAgaWYgKCFjbGVhck9ubHkpIHtcclxuICAgICAgdGhpcy5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5SZW1vdmUsXHJcbiAgICAgICAgcGF0aDogW10sXHJcbiAgICAgICAgdmFsdWU6IFtdXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aaC5p6c5b2T5YmN6KGM6KKr5Yig6Zmk77yM5Yig6Zmk5LmL5YmN6YeN5paw6K6h566X5b2T5YmN6KGM55qE5L2N572u77yM5bm26L+U5Zue5LiL5LiA5b2T5YmN6KGM55qE5Li76ZSu5YC844CCXHJcbiAgICogLSDlpoLmnpzooqvliKDpmaTnmoTooYzmmK/mnIDlkI4x6KGM77yM5YiZ5LiK56e7MeihjO+8m1xyXG4gICAqIC0g5YW25LuW5oOF5Ya177yM5LiL56e7MeihjOOAglxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDdXJyZW50SWRCZWZvcmVEZWxldGluZygpOiBzdHJpbmcge1xyXG4gICAgbGV0IG5leHRJbmRleCA9IC0xO1xyXG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gdGhpcy5nZXRJbmRleEJ5SWQodGhpcy5jdXJyZW50SWQpO1xyXG4gICAgaWYgKGN1cnJlbnRJbmRleCA9PT0gdGhpcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggKyAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZ2V0SWRCeUluZGV4KG5leHRJbmRleCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7kuLvplK7lgLzojrflj5blr7nlupTnu5Hlrprlr7nosaFcclxuICAgKiBAcGFyYW0gICBpZCDopoHmn6Xmib7nmoTkuLvplK7lgLxcclxuICAgKiBAcmV0dXJucyDmib7liLDml7bov5Tlm57lr7nlupRCaW5kaW5nT2JqZWN077yMIOaJvuS4jeWIsOaXtui/lOWbnm51bGxcclxuICAgKi9cclxuICBwdWJsaWMgZmluZEJ5SWQoaWQ6IHN0cmluZyk6IEJpbmRpbmdPYmplY3QgfCBudWxsIHtcclxuICAgIGxldCB0YXJnZXQ6IEJpbmRpbmdPYmplY3Q7XHJcbiAgICB0YXJnZXQgPSB0aGlzLmlubmVyTGlzdC5maW5kKChpdGVtKSA9PiB7XHJcbiAgICAgIHJldHVybiBpdGVtLmdldFZhbHVlKHRoaXMucHJpbWFyeUtleSkgPT09IGlkO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGFyZ2V0ID09PSB1bmRlZmluZWQgPyBudWxsIDogdGFyZ2V0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bCG5Li76ZSu5YC85Li6aWTnmoTnu5Hlrprlr7nosaHorr7nva7kuLrlvZPliY3ooYxcclxuICAgKiBAcGFyYW0gIGlkICAgICAgICDopoHorr7nva7nmoTkuLvplK7lgLxcclxuICAgKiBAcGFyYW0gIGVtaXRFdmVudCDmmK/lkKblj5HpgIHlvZPliY3ooYzlj5jmm7Tkuovku7ZcclxuICAgKiBAcGFyYW0gIGZvcmNlIOW8uuWItuWIh+aNolxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDdXJyZW50SWQoaWQ6IHN0cmluZywgZW1pdEV2ZW50OiBib29sZWFuID0gdHJ1ZSwgZW1pdEdsb2JhbEV2ZW50OiBib29sZWFuID0gdHJ1ZSwgZm9yY2U6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuY3VycmVudElkID09PSBpZCAmJiAhZm9yY2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOS4jeWtmOWcqOaXtuiuvue9ruS4um51bGxcclxuICAgIC8vIGNvbnN0IGN1cnJlbnRPYmogPSB0aGlzLmZpbmRCeUlkKGlkKTtcclxuICAgIC8vIGlmICghY3VycmVudE9iaikge1xyXG4gICAgLy8gICB0aGlzLmN1cnJlbnRJZCA9IG51bGw7XHJcbiAgICAvLyB9IGVsc2Uge1xyXG4gICAgLy8gICB0aGlzLmN1cnJlbnRJZCA9IGlkO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIEB0b2Rv77ya5om+5LiN5Yiw5pe25oyJ55CG5bqU6K+l6K6+572u5Li6bnVsbO+8jOebruWJjeaYr+ebtOaOpei/lOWbnu+8jOahhuaetumDqOWIhuWKn+iDveS+nei1luivpeeJueaAp+OAglxyXG4gICAgY29uc3QgY3VycmVudE9iaiA9IHRoaXMuZmluZEJ5SWQoaWQpO1xyXG4gICAgaWYgKCFjdXJyZW50T2JqICYmICFmb3JjZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmN1cnJlbnRJZCA9IGlkO1xyXG5cclxuICAgIC8vIOWPkeWHuuihjOWIh+aNouS6i+S7tlxyXG4gICAgaWYgKGVtaXRFdmVudCA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5TZWxlY3Rpb25DaGFuZ2VkLFxyXG4gICAgICAgIHBhdGg6IFtdLFxyXG4gICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRJdGVtLFxyXG4gICAgICAgIGZvcmNlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaYr+WQpuWPkemAgeWFqOWxgOeahOihjOWIh+aNouS6i+S7tlxyXG4gICAgaWYgKGVtaXRHbG9iYWxFdmVudCA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgICAgdHlwZTogQ2hhbmdlVHlwZS5HbG9iYWxTZWxlY3Rpb25DaGFuZ2VkLFxyXG4gICAgICAgIHBhdGg6IFtdLFxyXG4gICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRJdGVtLFxyXG4gICAgICAgIGZvcmNlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u5Li76ZSu5YC85Li6aWTnmoTnu5Hlrprlr7nosaHnmoTntKLlvJVcclxuICAgKiBAcGFyYW0gaWQg5Li76ZSu5YC8XHJcbiAgICogQHJldHVybnMg5om+5Yiw5pe26L+U5Zue5a+55bqU55qEaW5kZXjvvIzmib7kuI3liLDml7bov5Tlm54tMVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRJbmRleEJ5SWQoaWQ6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lckxpc3QuZmluZEluZGV4KChvYmo6IEJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgcmV0dXJuIG9ialt0aGlzLnByaW1hcnlLZXldID09PSBpZDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2u57Si5byV5L2N572u6I635Y+W5a+55bqU57uR5a6a5a+56LGh55qE5Li76ZSu5YC8XHJcbiAgICogQHJldXRybiDmib7liLDml7bov5Tlm57lr7nlupTkuLvplK7lgLzvvIzmib7kuI3liLDov5Tlm55udWxsXHJcbiAgICovXHJcbiAgcHVibGljIGdldElkQnlJbmRleChpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcclxuXHJcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gdGhpcy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuaW5uZXJMaXN0LmhhcyhpbmRleCkgPT09IGZhbHNlKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb2JqID0gdGhpcy5pbm5lckxpc3QuZ2V0KGluZGV4KTtcclxuICAgIHJldHVybiBvYmpbdGhpcy5wcmltYXJ5S2V5XTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouS4ukJpbmRpbmdPYmplY3TmlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgdG9BcnJheSgpOiBCaW5kaW5nT2JqZWN0W10ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJMaXN0LnRvQXJyYXkoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Lqk5LqS5pWw5o2u5L2N572uXHJcbiAgICogQHBhcmFtIGlkMSBpZDFcclxuICAgKiBAcGFyYW0gaWQyIGlkMlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzd2FwQnlJZChpZDE6IGFueSwgaWQyOiBhbnkpIHtcclxuICAgIGNvbnN0IGl0ZW0xID0gdGhpcy5pbm5lckxpc3QuZmluZCgoZWxlbWVudCkgPT4gZWxlbWVudC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSk7XHJcbiAgICBjb25zdCBpdGVtMiA9IHRoaXMuaW5uZXJMaXN0LmZpbmQoKGVsZW1lbnQpID0+IGVsZW1lbnQucHJpbWFyeUtleVZhbHVlID09PSBpZDIpO1xyXG4gICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmlubmVyTGlzdC5tYXAoKGJpbmRpbmdPYmplY3Q6IEJpbmRpbmdPYmplY3QsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZDEpIHtcclxuICAgICAgICByZXR1cm4gaXRlbTI7XHJcbiAgICAgIH0gZWxzZSBpZiAoYmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMikge1xyXG4gICAgICAgIHJldHVybiBpdGVtMTtcclxuICAgICAgfSBlbHNlIHJldHVybiBiaW5kaW5nT2JqZWN0O1xyXG4gICAgfSkudG9MaXN0KCk7XHJcbiAgICB0aGlzLmNoYW5nZXMubmV4dCh7XHJcbiAgICAgIHR5cGU6IENoYW5nZVR5cGUuU3dhcCxcclxuICAgICAgcGF0aDogW10sXHJcbiAgICAgIGRldGFpbDoge1xyXG4gICAgICAgIHR5cGU6ICdzd2FwJyxcclxuICAgICAgICBpZDogW2lkMSwgaWQyXVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6SlNPTuWvueixoVxyXG4gICAqIEBwYXJhbSBvcHRpb25zIOmFjee9rlxyXG4gICAqIEByZXR1cm5zIOaZrumAmuWvueixoeaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b0pTT04ob3B0aW9ucz86IGFueSk6IGFueVtdIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG4gICAgdGhpcy5pbm5lckxpc3QuZm9yRWFjaCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgIHJlc3VsdC5wdXNoKG9iai50b0pTT04ob3B0aW9ucykpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDov4fmu6TliJfooajmlbDmja5cclxuICAgKiBAcGFyYW0gY29uZGl0aW9ucyDov4fmu6TmnaHku7ZcclxuICAgKi9cclxuICBwdWJsaWMgZmlsdGVyKGNvbmRpdGlvbnM6IEFycmF5PEZpbHRlckNvbmRpdGlvbj4gfCBPYmplY3RGaWx0ZXJDb25kaXRpb24pIHtcclxuICAgIGlmICh0aGlzLmRlZmF1bHRWaWV3ID09PSBudWxsKSB7XHJcbiAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmlubmVyTGlzdC50b0xpc3QoKTtcclxuICAgIH1cclxuICAgIGxldCBsaXN0OiBMaXN0PEJpbmRpbmdPYmplY3Q+O1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZGl0aW9ucykpIHtcclxuICAgICAgY29uc3QgZmlsdGVyID0gbmV3IEFycmF5RmlsdGVyQ29uZGl0aW9uRGF0YUZpbHRlcigpO1xyXG4gICAgICBsaXN0ID0gdGhpcy5kZWZhdWx0Vmlldy5maWx0ZXIoKGJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgICByZXR1cm4gZmlsdGVyLnZhbGlkYXRlUm93RGF0YShiaW5kaW5nT2JqZWN0LCBjb25kaXRpb25zKTtcclxuICAgICAgfSkudG9MaXN0KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBmaWx0ZXIgPSBuZXcgT2JqZWN0RmlsdGVyQ29uZGl0aW9uRGF0YUZpbHRlcigpO1xyXG4gICAgICBsaXN0ID0gdGhpcy5kZWZhdWx0Vmlldy5maWx0ZXIoKGJpbmRpbmdPYmplY3QpID0+IHtcclxuICAgICAgICByZXR1cm4gZmlsdGVyLnZhbGlkYXRlUm93RGF0YShiaW5kaW5nT2JqZWN0LCBjb25kaXRpb25zKTtcclxuICAgICAgfSkudG9MaXN0KCk7XHJcbiAgICB9XHJcbiAgICAvLyDlpoLmnpzmnInmjpLluo/mnaHku7bvvIzliJnlr7nov4fmu6TlkI7nmoTnu5Pmnpzov5vooYzmjpLluo9cclxuICAgIGlmICh0aGlzLnNvcnRGaWVsZHMgJiYgdGhpcy5zb3J0RmllbGRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSBsaXN0LnNvcnQodGhpcy5jb21wYXJhdG9yKHRoaXMuc29ydEZpZWxkcywgdGhpcy5zb3J0RGlyZWN0aW9ucykpLnRvTGlzdCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pbm5lckxpc3QgPSBsaXN0O1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliIbpobXkv6Hmga9cclxuICAgKiBAcGFyYW0gcGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlIOm7mOiupOWAvFxyXG4gICAqIEB0aHJvd3Mg6Lev5b6E5b+F6aG75Li65a2X56ym5Liy77yBXHJcbiAgICovXHJcbiAgcHVibGljIGdldFBhZ2luYXRpb25Db25maWdCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBhbnkpIHtcclxuICAgIGlmICghcGF0aCB8fCBwYXRoID09PSAnLycpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvbkluZm87XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHBhdGggIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign6Lev5b6E5b+F6aG75Li65a2X56ym5Liy77yBJyk7XHJcbiAgICB9XHJcbiAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMSk7XHJcbiAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIoKGl0ZW0pID0+ICEhaXRlbSAmJiBpdGVtLnRyaW0oKS5sZW5ndGggPiAwKS5tYXAoKGl0ZW0pID0+IGl0ZW0udHJpbSgpKTtcclxuICAgIGxldCBjb25maWcgPSB0aGlzLnBhZ2luYXRpb25JbmZvO1xyXG4gICAgcGF0aHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xyXG4gICAgICAgIGNvbmZpZyA9IGNvbmZpZ1tpdGVtXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25maWcgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiAhIWNvbmZpZyA/IGNvbmZpZyA6IHR5cGVvZiBkZWZhdWx0VmFsdWUgIT09ICd1bmRlZmluZWQnID8gZGVmYXVsdFZhbHVlIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlr7liaW5kaW5nTGlzdOWwseihjOaOkuW6j1xyXG4gICAqIEBwYXJhbSBmaWVsZHMgLSDmjpLluo/lrZfmrrVcclxuICAgKiBAcGFyYW0gZGlyZWN0aW9ucyAtIOaOkuW6j+inhOWImeWtl+autVxyXG4gICAqIEBwYXJhbSBvcHRpb25zIC0g5Y+C5pWwXHJcbiAgICogQHRocm93cyBhcmd1bWVudCBlcnJvclxyXG4gICAqL1xyXG4gIHB1YmxpYyBzb3J0QnkoZmllbGRzOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBkaXJlY3Rpb25zOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBvcHRpb25zPzogeyBbcHJvcDogc3RyaW5nXTogYW55IH0pIHtcclxuICAgIGlmICghdGhpcy5kZWZhdWx0Vmlldykge1xyXG4gICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5pbm5lckxpc3QudG9MaXN0KCk7XHJcbiAgICB9XHJcbiAgICAvLyDpu5jorqTljYfluo9cclxuICAgIGNvbnN0IGFyckZpZWxkczogQXJyYXk8c3RyaW5nPiA9IHR5cGVvZiBmaWVsZHMgPT09ICdzdHJpbmcnID8gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKChwKSA9PiBwKSA6IGZpZWxkcyB8fCBbXTtcclxuICAgIGNvbnN0IGFyckRpcmVjdGlvbnM6IEFycmF5PHN0cmluZz4gPSB0eXBlb2YgZGlyZWN0aW9ucyA9PT0gJ3N0cmluZycgPyBkaXJlY3Rpb25zLnNwbGl0KCcsJykuZmlsdGVyKChwKSA9PiBwKSA6IGRpcmVjdGlvbnMgfHwgW107XHJcbiAgICAvLyDmjpLluo/lrZfmrrXlkozmjpLluo/mlrnlvI/lupTkuIDoh7RcclxuICAgIGlmIChhcnJGaWVsZHMubGVuZ3RoICE9PSBhcnJEaXJlY3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NvcnRCeTpmaWVsZHMgYW5kIGRpcmVjdGlvbnMgbm90IG1hdGNoJyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNvcnRGaWVsZHMgPSBhcnJGaWVsZHM7XHJcbiAgICB0aGlzLnNvcnREaXJlY3Rpb25zID0gYXJyRGlyZWN0aW9ucztcclxuICAgIGlmICghdGhpcy5zb3J0RmllbGRzIHx8IHRoaXMuc29ydEZpZWxkcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIGlmICh0aGlzLmRlZmF1bHRWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5pbm5lckxpc3QgPSB0aGlzLmRlZmF1bHRWaWV3LnRvTGlzdCgpO1xyXG4gICAgICAgIC8vIOa4heepuui/h+a7pOadoeS7tuWQjumHjee9ruWOn+Wni+aVsOaNrua6kFxyXG4gICAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmlubmVyTGlzdCA9IHRoaXMuaW5uZXJMaXN0LnNvcnQodGhpcy5jb21wYXJhdG9yKGFyckZpZWxkcywgYXJyRGlyZWN0aW9ucykpLnRvTGlzdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGdldFZhbHVlKHRhcmdldDogYW55LCBwcm9wTmFtZTogc3RyaW5nLCBpc011bHRpTGFuZ1Byb3A6IGJvb2xlYW4gPSBmYWxzZSwgY3VycmVudExhbmd1YWdlOiBzdHJpbmcgPSAnemgtQ0hTJykge1xyXG4gICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEJpbmRpbmdMaXN0KSB7XHJcbiAgICAgIHRhcmdldCA9IHRhcmdldC5jdXJyZW50SXRlbTtcclxuICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQmluZGluZ0RhdGEpIHtcclxuICAgICAgdGFyZ2V0ID0gdGFyZ2V0Lmxpc3QuY3VycmVudEl0ZW07XHJcbiAgICB9XHJcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcclxuICAgIGlmIChwcm9wTmFtZS5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRhcmdldFtwcm9wTmFtZV07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBwcm9wcyA9IHByb3BOYW1lLnNwbGl0KCcuJyk7XHJcbiAgICAgIGZvciAoY29uc3QgcHJvcCBvZiBwcm9wcykge1xyXG4gICAgICAgIHRhcmdldCA9IHJlc3VsdCA9IHRoaXMuZ2V0VmFsdWUodGFyZ2V0LCBwcm9wLCBpc011bHRpTGFuZ1Byb3AsIGN1cnJlbnRMYW5ndWFnZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChpc011bHRpTGFuZ1Byb3AgJiYgcmVzdWx0ICYmIHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShjdXJyZW50TGFuZ3VhZ2UpKSB7XHJcbiAgICAgIHJldHVybiByZXN1bHRbY3VycmVudExhbmd1YWdlXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaOkuW6j+WZqFxyXG4gICAqIEBwYXJhbSBwcm9wcyAtIOaOkuW6j+Wtl+autVxyXG4gICAqIEBwYXJhbSBvcmRlcnMgLSDmjpLluo/op4TliJlcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY29tcGFyYXRvcihwcm9wczogQXJyYXk8c3RyaW5nPiwgb3JkZXJzOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICByZXR1cm4gKGl0ZW0xOiBCaW5kaW5nT2JqZWN0LCBpdGVtMjogQmluZGluZ09iamVjdCkgPT4ge1xyXG4gICAgICByZXR1cm4gcHJvcHMucmVkdWNlKChyZXN1bHQsIHByb3ApID0+IHtcclxuICAgICAgICBpZiAocmVzdWx0ID09PSAwKSB7XHJcbiAgICAgICAgICBjb25zdCBiaW5kaW5nUHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXMuZmluZCgoaXRlbSkgPT4gaXRlbS5uYW1lID09PSBwcm9wKTtcclxuICAgICAgICAgIGxldCBpc011bHRpTGFuZ1Byb3AgPSBmYWxzZTtcclxuICAgICAgICAgIGlmIChiaW5kaW5nUHJvcGVydHkpIHtcclxuICAgICAgICAgICAgaXNNdWx0aUxhbmdQcm9wID0gYmluZGluZ1Byb3BlcnR5LmVuYWJsZU11bHRpTGFuZ0lucHV0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgY3VycmVudExhbmd1YWdlID0gVHJhbnNsYXRlU2VydmljZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuICAgICAgICAgIGNvbnN0IG9yZGVyID0gWydhc2MnXS5pbmNsdWRlcyhvcmRlcnNbcHJvcHMuaW5kZXhPZihwcm9wKV0pID8gMSA6IC0xO1xyXG4gICAgICAgICAgbGV0IGl0ZW0xVmFsdWUgPSB0aGlzLmdldFZhbHVlKGl0ZW0xLCBwcm9wLCBpc011bHRpTGFuZ1Byb3AsIGN1cnJlbnRMYW5ndWFnZSk7XHJcbiAgICAgICAgICBsZXQgaXRlbTJWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoaXRlbTIsIHByb3AsIGlzTXVsdGlMYW5nUHJvcCwgY3VycmVudExhbmd1YWdlKTtcclxuXHJcbiAgICAgICAgICBpZiAoaXRlbTFWYWx1ZSA9PT0gbnVsbCB8fCBpdGVtMVZhbHVlID09PSB1bmRlZmluZWQpIHsgaXRlbTFWYWx1ZSA9ICcnOyB9XHJcbiAgICAgICAgICBpZiAoaXRlbTJWYWx1ZSA9PT0gbnVsbCB8fCBpdGVtMlZhbHVlID09PSB1bmRlZmluZWQpIHsgaXRlbTJWYWx1ZSA9ICcnOyB9XHJcblxyXG4gICAgICAgICAgaWYgKHR5cGVvZiBpdGVtMVZhbHVlID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgaXRlbTJWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYWxlQ29tcGFyZVJlc3VsdCA9IGl0ZW0xVmFsdWUubG9jYWxlQ29tcGFyZShpdGVtMlZhbHVlKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbG9jYWxlQ29tcGFyZVJlc3VsdCAqIG9yZGVyO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0xVmFsdWUgPiBpdGVtMlZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgcmVzdWx0ID0gb3JkZXIgKiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtMVZhbHVlIDwgaXRlbTJWYWx1ZSkge1xyXG4gICAgICAgICAgICAgIHJlc3VsdCA9IG9yZGVyICogLTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfSwgMCk7XHJcbiAgICB9O1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZURlZmF1bHRWaWV3KGNoYW5nZTogU3ViamVjdDxDaGFuZ2U+KSB7XHJcbiAgICBjaGFuZ2UucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgoY2hhbmdlOiBDaGFuZ2UpID0+IHtcclxuICAgICAgaWYgKHRoaXMuZGVmYXVsdFZpZXcgIT09IG51bGwgJiYgKChjaGFuZ2UucGF0aC5sZW5ndGggPT09IDAgJiYgW0NoYW5nZVR5cGUuTG9hZCwgQ2hhbmdlVHlwZS5BcHBlbmQsIENoYW5nZVR5cGUuUmVtb3ZlLCBDaGFuZ2VUeXBlLlN3YXBdLmluY2x1ZGVzKGNoYW5nZS50eXBlKSkgfHwgKGNoYW5nZS50eXBlID09PSBDaGFuZ2VUeXBlLlZhbHVlQ2hhbmdlZCAmJiBjaGFuZ2UuaXNCaW5kaW5nTGlzdFRyYW5zbWl0ZWQgIT09IHRydWUpKSkge1xyXG4gICAgICAgIHN3aXRjaCAoY2hhbmdlLnR5cGUpIHtcclxuICAgICAgICAgIGNhc2UgQ2hhbmdlVHlwZS5Mb2FkOlxyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5pbm5lckxpc3QudG9MaXN0KCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSBDaGFuZ2VUeXBlLkFwcGVuZDoge1xyXG4gICAgICAgICAgICAvLyDmj5LlhaVcclxuICAgICAgICAgICAgaWYgKGNoYW5nZS5kZXRhaWwgJiYgY2hhbmdlLmRldGFpbC50eXBlID09PSAnaW5zZXJ0Jykge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gY2hhbmdlLmRldGFpbC5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICBjb25zdCBvYmplY3QgPSBjaGFuZ2UudmFsdWU7XHJcbiAgICAgICAgICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gdGhpcy5pbm5lckxpc3QuZmluZEluZGV4KChvYmo6IEJpbmRpbmdPYmplY3QpID0+IG9iai5wcmltYXJ5S2V5VmFsdWUgPT09IHRoaXMuY3VycmVudElkKTtcclxuICAgICAgICAgICAgICAvLyDliqDovb1CaW5kaW5nT2JqZWN0XHJcbiAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5pbnNlcnQoY3VycmVudEluZGV4ICsgMSwgb2JqZWN0KTtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IHRoaXMuZGVmYXVsdFZpZXcuaW5zZXJ0KGN1cnJlbnRJbmRleCwgb2JqZWN0KTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IHRoaXMuZGVmYXVsdFZpZXcucHVzaChvYmplY3QpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjb25zdCBvYmplY3RzID0gY2hhbmdlLnZhbHVlIGFzIGFueVtdO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLmRlZmF1bHRWaWV3LnB1c2goLi4ub2JqZWN0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjYXNlIENoYW5nZVR5cGUuUmVtb3ZlOlxyXG4gICAgICAgICAgICBjb25zdCBpZHMgPSBjaGFuZ2UudmFsdWUgYXMgQXJyYXk8c3RyaW5nPjtcclxuICAgICAgICAgICAgaWYgKGlkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5jbGVhcigpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGlkcy5mb3JFYWNoKChpZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGVmYXVsdFZpZXcuZmluZEluZGV4KChiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0KSA9PiBiaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IHRoaXMuZGVmYXVsdFZpZXcuZGVsZXRlKGluZGV4KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlIENoYW5nZVR5cGUuVmFsdWVDaGFuZ2VkOlxyXG4gICAgICAgICAgICBjb25zdCBpZCA9IGNoYW5nZS5pZDtcclxuICAgICAgICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IHRoaXMuZGVmYXVsdFZpZXcuZmluZCgob2JqOiBCaW5kaW5nT2JqZWN0KSA9PiBvYmoucHJpbWFyeUtleVZhbHVlID09PSBpZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gY2hhbmdlLnBhdGguY29uY2F0KFtdKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlOYW1lID0gcGF0aHMucG9wKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldDogQmluZGluZ09iamVjdCA9IHBhdGhzLnJlZHVjZSgob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0W3BhdGhdO1xyXG4gICAgICAgICAgICB9LCBiaW5kaW5nT2JqZWN0KSBhcyBCaW5kaW5nT2JqZWN0O1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgdGFyZ2V0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgY2hhbmdlLnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgQ2hhbmdlVHlwZS5Td2FwOlxyXG4gICAgICAgICAgICBjb25zdCBbaWQxLCBpZDJdID0gY2hhbmdlLmRldGFpbCAmJiBjaGFuZ2UuZGV0YWlsLmlkO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtMSA9IHRoaXMuZGVmYXVsdFZpZXcuZmluZCgoZWxlbWVudCkgPT4gZWxlbWVudC5wcmltYXJ5S2V5VmFsdWUgPT09IGlkMSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0yID0gdGhpcy5kZWZhdWx0Vmlldy5maW5kKChlbGVtZW50KSA9PiBlbGVtZW50LnByaW1hcnlLZXlWYWx1ZSA9PT0gaWQyKTtcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IHRoaXMuZGVmYXVsdFZpZXcubWFwKChiaW5kaW5nT2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtMjtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlID09PSBpZDIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtMTtcclxuICAgICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGJpbmRpbmdPYmplY3Q7XHJcbiAgICAgICAgICAgIH0pLnRvTGlzdCgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIC8vIGNhc2UgQ2hhbmdlVHlwZS5Tb3J0Q2hhbmdlZDpcclxuICAgICAgICAgIC8vICAgY29uc3QgeyBmaWVsZHMgPSBbXSwgZGlyZWN0aW9ucyA9IFtdIH0gPSBjaGFuZ2UuZGV0YWlsIHx8IHt9O1xyXG4gICAgICAgICAgLy8gICB0aGlzLmRlZmF1bHRWaWV3ID0gdGhpcy5kZWZhdWx0Vmlldy5zb3J0KHRoaXMuY29tcGFyYXRvcihmaWVsZHMsIGRpcmVjdGlvbnMpKS50b0xpc3QoKTtcclxuICAgICAgICAgIC8vICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEJpbmRpbmdMaXN0IH07XHJcbiJdfQ==
/**
 * 绑定对象工厂相关定义
 * @author Witt<jiwt@inspur.com>
 */
import { PropertyUtil } from './property_util';
import { BindingPropertyType } from './binding_property';
import { BindingListFactory } from './binding_list_factory';
import { BindingObjectTypeFactory } from './binding_object_type_factory';
/**
 * BindingObject工厂用于创建一个空的BindingObject对象，并对其属性进行扩展。
 *
 * **扩展属性处理**
 *
 * 对于要扩展的属性（BindingProperty）有三种处理：
 * - 普通属性：初始化为一个undefined，并包装get、set方法，通过set方法监听变更；
 * - 对象属性：初始化为一个空的BindingObject对象，并监听子对象的变更；
 * - 列表属性：初始化为一个空的BindingList对象，并监听子列表的变更；
 *
 * **示例代码**
 *
 * ```ts
 *  const empProperties = PropertyUtil.getProperties(EmpEntity);
 * const empBindingObject = BindingObjectFactory.create(properties);
 * ```
 */
var BindingObjectFactory = /** @class */ (function () {
    function BindingObjectFactory() {
    }
    /**
     * 创建BindingObject实例
     * @param properties 要扩展的属性集合
     * @returns 带扩展属性的空BindingObject对象
     */
    BindingObjectFactory.create = function (properties, fromEntity) {
        var bindingObjectType = BindingObjectTypeFactory.create(properties /*, data*/);
        bindingObjectType.fromEntity = fromEntity;
        return bindingObjectType;
    };
    BindingObjectFactory.createDynamicBindingObject = function (data) {
        var properties = PropertyUtil.getDynamicProperties(data);
        var object = BindingObjectTypeFactory.create(properties /*, data*/); //new BindingObject(properties);
        this.extendProperties(object, properties);
        return object;
    };
    /**
     * 扩展属性绑定对象的属性
     * @param object     要扩展的绑定对象
     * @param properties 绑定属性集合
     */
    BindingObjectFactory.extendProperties = function (object, properties) {
        var _this = this;
        // 扩展BindingObject属性
        properties.forEach(function (property) {
            if (property.type === BindingPropertyType.List) {
                _this.extendListProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Object) {
                _this.extendObjectProperty(object, property);
            }
            else if (property.type === BindingPropertyType.Dynamic) {
                _this.extendDynamicObjectProperty(object, property);
            }
            else {
                _this.extendPlainProperty(object, property);
            }
        });
    };
    /**
     * 扩展列表类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 列表类型的绑定属性集合
     */
    BindingObjectFactory.extendListProperty = function (object, property) {
        var propertyName = property.name;
        var childListProperties = PropertyUtil.getProperties(property.entityType);
        var childList = BindingListFactory.create(childListProperties);
        // 指定子List的parent、监听子List的changes事件
        childList.parent = object;
        childList.changes.subscribe(function (change) {
            change.path.unshift(propertyName);
            change.isBindingListTransmited = true;
            object.changes.next(change);
        });
        // 将子的BindingList实例赋值给当前属性
        Object.defineProperty(object, propertyName, {
            value: childList
        });
    };
    /**
     * 扩展对象类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 对象类型的绑定属性集合
     */
    BindingObjectFactory.extendObjectProperty = function (object, property) {
        var propertyName = property.name;
        var childObjectProperties = PropertyUtil.getProperties(property.entityType);
        var childObject = this.create(childObjectProperties);
        // 指定子Object的parent、监听子Object的changes事件
        childObject.parent = object;
        childObject.changes.subscribe(function (change) {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: childObject
        });
    };
    BindingObjectFactory.extendDynamicObjectProperty = function (object, property) {
        var propertyName = property.name;
        object[propertyName] = null;
    };
    BindingObjectFactory.attachDynamicObjectProperty = function (object, propertyName, dynamicObject) {
        dynamicObject.parent = object;
        dynamicObject.changes.subscribe(function (change) {
            change.path.unshift(propertyName);
            object.changes.next(change);
        });
        Object.defineProperty(object, propertyName, {
            value: dynamicObject
        });
    };
    /**
     * 扩展简单类型的绑定属性
     * @param object     要扩展的绑定对象
     * @param properties 简单类型的绑定属性集合
     */
    BindingObjectFactory.extendPlainProperty = function (object, property) {
        var propertyName = property.name;
        Object.defineProperty(object, propertyName, {
            get: function () {
                return object.getValue(propertyName);
            },
            set: function (value) {
                var oldValue = object.getValue(propertyName);
                if (value === oldValue) {
                    return;
                }
                object.setValue(propertyName, value, true, true);
            }
        });
    };
    return BindingObjectFactory;
}());
export { BindingObjectFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19vYmplY3RfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2JpbmRpbmctZGF0YS9iaW5kaW5nX29iamVjdF9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUdILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFMUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFekU7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFDSDtJQUFBO0lBMkhBLENBQUM7SUF6SEM7Ozs7T0FJRztJQUNJLDJCQUFNLEdBQWIsVUFBYyxVQUE2QixFQUFFLFVBQW9CO1FBQy9ELElBQU0saUJBQWlCLEdBQUcsd0JBQXdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQSxVQUFVLENBQUMsQ0FBQztRQUNoRixpQkFBaUIsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzFDLE9BQU8saUJBQWlCLENBQUM7SUFDM0IsQ0FBQztJQUVNLCtDQUEwQixHQUFqQyxVQUFrQyxJQUFTO1FBQ3pDLElBQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzRCxJQUFNLE1BQU0sR0FBRyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFBLFVBQVUsQ0FBQyxDQUFDLENBQUEsZ0NBQWdDO1FBQ3JHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDMUMsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxxQ0FBZ0IsR0FBdkIsVUFBd0IsTUFBcUIsRUFBRSxVQUE2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QzFHLGFBQWEsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQzlCLGFBQWEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFVBQUMsTUFBYztZQUM3QyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFlBQVksRUFBRTtZQUMxQyxLQUFLLEVBQUUsYUFBYTtTQUNyQixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLHdDQUFtQixHQUExQixVQUEyQixNQUFxQixFQUFFLFFBQXlCO1FBQ3pFLElBQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDbkMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxFQUFFO1lBQzFDLEdBQUcsRUFBRTtnQkFDSCxPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDdkMsQ0FBQztZQUNELEdBQUcsRUFBRSxVQUFDLEtBQVU7Z0JBQ2QsSUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDL0MsSUFBSSxLQUFLLEtBQUssUUFBUSxFQUFFO29CQUN0QixPQUFPO2lCQUNSO2dCQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbkQsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFSCwyQkFBQztBQUFELENBQUMsQUEzSEQsSUEySEM7QUFFRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDnu5Hlrprlr7nosaHlt6XljoLnm7jlhbPlrprkuYlcclxuICogQGF1dGhvciBXaXR0PGppd3RAaW5zcHVyLmNvbT5cclxuICovXHJcblxyXG5pbXBvcnQgeyBDaGFuZ2UgfSBmcm9tICcuL2NoYW5nZXMnO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eVV0aWwgfSBmcm9tICcuL3Byb3BlcnR5X3V0aWwnO1xyXG5pbXBvcnQgeyBCaW5kaW5nUHJvcGVydHksIEJpbmRpbmdQcm9wZXJ0eVR5cGUgfSBmcm9tICcuL2JpbmRpbmdfcHJvcGVydHknO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi9iaW5kaW5nX29iamVjdCc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0RmFjdG9yeSB9IGZyb20gJy4vYmluZGluZ19saXN0X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBCaW5kaW5nT2JqZWN0VHlwZUZhY3RvcnkgfSBmcm9tICcuL2JpbmRpbmdfb2JqZWN0X3R5cGVfZmFjdG9yeSc7XHJcblxyXG4vKipcclxuICogQmluZGluZ09iamVjdOW3peWOgueUqOS6juWIm+W7uuS4gOS4quepuueahEJpbmRpbmdPYmplY3Tlr7nosaHvvIzlubblr7nlhbblsZ7mgKfov5vooYzmianlsZXjgIJcclxuICpcclxuICogKirmianlsZXlsZ7mgKflpITnkIYqKlxyXG4gKlxyXG4gKiDlr7nkuo7opoHmianlsZXnmoTlsZ7mgKfvvIhCaW5kaW5nUHJvcGVydHnvvInmnInkuInnp43lpITnkIbvvJpcclxuICogLSDmma7pgJrlsZ7mgKfvvJrliJ3lp4vljJbkuLrkuIDkuKp1bmRlZmluZWTvvIzlubbljIXoo4VnZXTjgIFzZXTmlrnms5XvvIzpgJrov4dzZXTmlrnms5Xnm5HlkKzlj5jmm7TvvJtcclxuICogLSDlr7nosaHlsZ7mgKfvvJrliJ3lp4vljJbkuLrkuIDkuKrnqbrnmoRCaW5kaW5nT2JqZWN05a+56LGh77yM5bm255uR5ZCs5a2Q5a+56LGh55qE5Y+Y5pu077ybXHJcbiAqIC0g5YiX6KGo5bGe5oCn77ya5Yid5aeL5YyW5Li65LiA5Liq56m655qEQmluZGluZ0xpc3Tlr7nosaHvvIzlubbnm5HlkKzlrZDliJfooajnmoTlj5jmm7TvvJtcclxuICpcclxuICogKirnpLrkvovku6PnoIEqKlxyXG4gKlxyXG4gKiBgYGB0c1xyXG4gKiAgY29uc3QgZW1wUHJvcGVydGllcyA9IFByb3BlcnR5VXRpbC5nZXRQcm9wZXJ0aWVzKEVtcEVudGl0eSk7XHJcbiAqIGNvbnN0IGVtcEJpbmRpbmdPYmplY3QgPSBCaW5kaW5nT2JqZWN0RmFjdG9yeS5jcmVhdGUocHJvcGVydGllcyk7XHJcbiAqIGBgYFxyXG4gKi9cclxuY2xhc3MgQmluZGluZ09iamVjdEZhY3Rvcnkge1xyXG5cclxuICAvKipcclxuICAgKiDliJvlu7pCaW5kaW5nT2JqZWN05a6e5L6LXHJcbiAgICogQHBhcmFtIHByb3BlcnRpZXMg6KaB5omp5bGV55qE5bGe5oCn6ZuG5ZCIXHJcbiAgICogQHJldHVybnMg5bim5omp5bGV5bGe5oCn55qE56m6QmluZGluZ09iamVjdOWvueixoVxyXG4gICAqL1xyXG4gIHN0YXRpYyBjcmVhdGUocHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10sIGZyb21FbnRpdHk/OiBib29sZWFuKTogQmluZGluZ09iamVjdCB7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0VHlwZSA9IEJpbmRpbmdPYmplY3RUeXBlRmFjdG9yeS5jcmVhdGUocHJvcGVydGllcy8qLCBkYXRhKi8pO1xyXG4gICAgYmluZGluZ09iamVjdFR5cGUuZnJvbUVudGl0eSA9IGZyb21FbnRpdHk7XHJcbiAgICByZXR1cm4gYmluZGluZ09iamVjdFR5cGU7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgY3JlYXRlRHluYW1pY0JpbmRpbmdPYmplY3QoZGF0YTogYW55KTogQmluZGluZ09iamVjdCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gUHJvcGVydHlVdGlsLmdldER5bmFtaWNQcm9wZXJ0aWVzKGRhdGEpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0gQmluZGluZ09iamVjdFR5cGVGYWN0b3J5LmNyZWF0ZShwcm9wZXJ0aWVzLyosIGRhdGEqLyk7Ly9uZXcgQmluZGluZ09iamVjdChwcm9wZXJ0aWVzKTtcclxuICAgIHRoaXMuZXh0ZW5kUHJvcGVydGllcyhvYmplY3QsIHByb3BlcnRpZXMpO1xyXG4gICAgcmV0dXJuIG9iamVjdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJqeWxleWxnuaAp+e7keWumuWvueixoeeahOWxnuaAp1xyXG4gICAqIEBwYXJhbSBvYmplY3QgICAgIOimgeaJqeWxleeahOe7keWumuWvueixoVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOe7keWumuWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHN0YXRpYyBleHRlbmRQcm9wZXJ0aWVzKG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydGllczogQmluZGluZ1Byb3BlcnR5W10pOiB2b2lkIHtcclxuICAgIC8vIOaJqeWxlUJpbmRpbmdPYmplY3TlsZ7mgKdcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSkgPT4ge1xyXG4gICAgICBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5MaXN0KSB7XHJcbiAgICAgICAgdGhpcy5leHRlbmRMaXN0UHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eSk7XHJcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkudHlwZSA9PT0gQmluZGluZ1Byb3BlcnR5VHlwZS5PYmplY3QpIHtcclxuICAgICAgICB0aGlzLmV4dGVuZE9iamVjdFByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpO1xyXG4gICAgICB9IGVsc2UgaWYgKHByb3BlcnR5LnR5cGUgPT09IEJpbmRpbmdQcm9wZXJ0eVR5cGUuRHluYW1pYykge1xyXG4gICAgICAgIHRoaXMuZXh0ZW5kRHluYW1pY09iamVjdFByb3BlcnR5KG9iamVjdCwgcHJvcGVydHkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZXh0ZW5kUGxhaW5Qcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmianlsZXliJfooajnsbvlnovnmoTnu5HlrprlsZ7mgKdcclxuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDliJfooajnsbvlnovnmoTnu5HlrprlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBzdGF0aWMgZXh0ZW5kTGlzdFByb3BlcnR5KG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSk6IHZvaWQge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTtcclxuICAgIGNvbnN0IGNoaWxkTGlzdFByb3BlcnRpZXMgPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydGllcyhwcm9wZXJ0eS5lbnRpdHlUeXBlKTtcclxuICAgIGNvbnN0IGNoaWxkTGlzdCA9IEJpbmRpbmdMaXN0RmFjdG9yeS5jcmVhdGUoY2hpbGRMaXN0UHJvcGVydGllcyk7XHJcblxyXG4gICAgLy8g5oyH5a6a5a2QTGlzdOeahHBhcmVudOOAgeebkeWQrOWtkExpc3TnmoRjaGFuZ2Vz5LqL5Lu2XHJcbiAgICBjaGlsZExpc3QucGFyZW50ID0gb2JqZWN0O1xyXG4gICAgY2hpbGRMaXN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBjaGFuZ2UucGF0aC51bnNoaWZ0KHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIGNoYW5nZS5pc0JpbmRpbmdMaXN0VHJhbnNtaXRlZCA9IHRydWU7XHJcbiAgICAgIG9iamVjdC5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWwhuWtkOeahEJpbmRpbmdMaXN05a6e5L6L6LWL5YC857uZ5b2T5YmN5bGe5oCnXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgdmFsdWU6IGNoaWxkTGlzdFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmianlsZXlr7nosaHnsbvlnovnmoTnu5HlrprlsZ7mgKdcclxuICAgKiBAcGFyYW0gb2JqZWN0ICAgICDopoHmianlsZXnmoTnu5Hlrprlr7nosaFcclxuICAgKiBAcGFyYW0gcHJvcGVydGllcyDlr7nosaHnsbvlnovnmoTnu5HlrprlsZ7mgKfpm4blkIhcclxuICAgKi9cclxuICBzdGF0aWMgZXh0ZW5kT2JqZWN0UHJvcGVydHkob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eTogQmluZGluZ1Byb3BlcnR5KTogdm9pZCB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgY29uc3QgY2hpbGRPYmplY3RQcm9wZXJ0aWVzID0gUHJvcGVydHlVdGlsLmdldFByb3BlcnRpZXMocHJvcGVydHkuZW50aXR5VHlwZSk7XHJcbiAgICBjb25zdCBjaGlsZE9iamVjdCA9IHRoaXMuY3JlYXRlKGNoaWxkT2JqZWN0UHJvcGVydGllcyk7XHJcblxyXG4gICAgLy8g5oyH5a6a5a2QT2JqZWN055qEcGFyZW5044CB55uR5ZCs5a2QT2JqZWN055qEY2hhbmdlc+S6i+S7tlxyXG4gICAgY2hpbGRPYmplY3QucGFyZW50ID0gb2JqZWN0O1xyXG4gICAgY2hpbGRPYmplY3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNoYW5nZTogQ2hhbmdlKSA9PiB7XHJcbiAgICAgIGNoYW5nZS5wYXRoLnVuc2hpZnQocHJvcGVydHlOYW1lKTtcclxuICAgICAgb2JqZWN0LmNoYW5nZXMubmV4dChjaGFuZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIHZhbHVlOiBjaGlsZE9iamVjdFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZXh0ZW5kRHluYW1pY09iamVjdFByb3BlcnR5KG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSk6IHZvaWQge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTtcclxuICAgIG9iamVjdFtwcm9wZXJ0eU5hbWVdID0gbnVsbDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBhdHRhY2hEeW5hbWljT2JqZWN0UHJvcGVydHkob2JqZWN0OiBCaW5kaW5nT2JqZWN0LCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgZHluYW1pY09iamVjdDogQmluZGluZ09iamVjdCkge1xyXG4gICAgZHluYW1pY09iamVjdC5wYXJlbnQgPSBvYmplY3Q7XHJcbiAgICBkeW5hbWljT2JqZWN0LmNoYW5nZXMuc3Vic2NyaWJlKChjaGFuZ2U6IENoYW5nZSkgPT4ge1xyXG4gICAgICBjaGFuZ2UucGF0aC51bnNoaWZ0KHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIG9iamVjdC5jaGFuZ2VzLm5leHQoY2hhbmdlKTtcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgIHZhbHVlOiBkeW5hbWljT2JqZWN0XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJqeWxleeugOWNleexu+Wei+eahOe7keWumuWxnuaAp1xyXG4gICAqIEBwYXJhbSBvYmplY3QgICAgIOimgeaJqeWxleeahOe7keWumuWvueixoVxyXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIOeugOWNleexu+Wei+eahOe7keWumuWxnuaAp+mbhuWQiFxyXG4gICAqL1xyXG4gIHN0YXRpYyBleHRlbmRQbGFpblByb3BlcnR5KG9iamVjdDogQmluZGluZ09iamVjdCwgcHJvcGVydHk6IEJpbmRpbmdQcm9wZXJ0eSk6IHZvaWQge1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gcHJvcGVydHkubmFtZTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICBnZXQ6ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gb2JqZWN0LmdldFZhbHVlKHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IG9iamVjdC5nZXRWYWx1ZShwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2JqZWN0LnNldFZhbHVlKHByb3BlcnR5TmFtZSwgdmFsdWUsIHRydWUsIHRydWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBCaW5kaW5nT2JqZWN0RmFjdG9yeSB9O1xyXG4iXX0=
import * as tslib_1 from "tslib";
import { Injectable, Injector } from '@angular/core';
import { AppContext } from '../app/index';
import { BindingData } from '../binding-data/index';
import { EffectorFactory } from '../effector/index';
import { BigNumber } from 'bignumber.js';
import { Expression, ExpressionExecutor, ExpressionRegistry, ExpressionResult } from '../expression/index';
import { Repository } from '../repository/index';
import { FrameContext } from '../frame';
import { ExpressionUtil } from '../utils/expression_util';
import { TranslateToken } from '../i18n/translate_token';
var EventHandler = /** @class */ (function () {
    function EventHandler(injector, repository, bindingData, expressionRegistry, effectorFactory, expressionExecutor, expressionResult) {
        this.injector = injector;
        this.repository = repository;
        this.bindingData = bindingData;
        this.expressionRegistry = expressionRegistry;
        this.effectorFactory = effectorFactory;
        this.expressionExecutor = expressionExecutor;
        this.expressionResult = expressionResult;
        this.frameContext = this.injector.get(FrameContext);
    }
    EventHandler.prototype.handleEvent = function (event, expressionObjects) {
        event = Object.assign({}, event);
        this.expressionObjects = expressionObjects;
        this.dispatch(event);
    };
    Object.defineProperty(EventHandler.prototype, "primaryValue", {
        //#endregion
        //#region 属性
        /**
         * 主表主键值
         */
        get: function () {
            return this.bindingData.list.currentItem.primaryKeyValue;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EventHandler.prototype, "entityOriginalNodeCode", {
        /**
         * 获取主实体原始字段名
         */
        get: function () {
            return this.repository && this.repository.entityTypeInfo && this.repository.entityTypeInfo.entityInfo && this.repository.entityTypeInfo.entityInfo.originalCode || null;
        },
        enumerable: true,
        configurable: true
    });
    //#endregion
    //#region 表达式核心
    /**
     * 执行表达式计算
     * @param expression 表达式
     * @param context 上下文
     * @returns any
     */
    EventHandler.prototype.perform = function (expressionObject, context) {
        return this.expressionExecutor.compile(expressionObject, context);
    };
    /**
     * 副作用
     * @param event event
     * @param expressionObject expressionObject
     */
    EventHandler.prototype.effect = function (event, expressionObject) {
        var effectTo = expressionObject.bindingType;
        var effector = this.effectorFactory.getEffector(expressionObject);
        if (!effector) {
            // console.warn(`EventHandler 没有对应的副作用器。${expressionObject.type}`);
            return;
        }
        if (effectTo === Expression.ExpressionBindingType.Field) {
            var effectPaths = expressionObject.effectPaths || [];
            if (effectPaths.length > 0) {
                effectPaths.forEach(function (path) {
                    var effectPath = path.split('/');
                    var effectOptions = { path: effectPath, message: expressionObject.message, expressionId: expressionObject.id };
                    effector.effect(expressionObject.path, expressionObject.result, effectOptions);
                });
            }
            else if (expressionObject.type === Expression.ExpressionType.Required || expressionObject.type === Expression.ExpressionType.Validate || expressionObject.type === Expression.ExpressionType.Readonly || expressionObject.type === Expression.ExpressionType.Visible) {
                var effectOptions = { message: expressionObject.message, expressionId: expressionObject.id };
                effector.effect(expressionObject.path, expressionObject.result, effectOptions);
            }
        }
        else {
            throw new Error('not supported！');
        }
    };
    //#endregion
    //#region util
    EventHandler.prototype.isValidateOrRequiredExpression = function (expressionObject) {
        return expressionObject && (expressionObject.type === Expression.ExpressionType.Validate || expressionObject.type === Expression.ExpressionType.Required);
    };
    /**
     * 以事件参数为依据构建实体路径
     * @param event event
     * @returns
     */
    EventHandler.prototype.getEntityPathFromEvent = function (event) {
        event = JSON.parse(JSON.stringify(event));
        if (!event || !event.path || event.path.length < 1) {
            return [];
        }
        var paths = event.path;
        return this.getEntityPath(paths);
    };
    /**
     * 获取事件路径中的实体路径
     * @param path path
     * @returns
     */
    EventHandler.prototype.getEntityPath = function (path) {
        var paths = path.filter(function (value, index) {
            if (index % 2 === 0 && value.includes(':')) {
                return false;
            }
            else {
                return true;
            }
        });
        return paths;
    };
    /**
     * 构造实体路径
     * @param path path
     * @description 删除路径中的id字段
     * @returns
     */
    EventHandler.prototype.buildEntityPath = function (path) {
        var paths = path.filter(function (value, index) {
            if (index % 2 === 0 && value.includes(':')) {
                return false;
            }
            else {
                return true;
            }
        });
        return paths;
    };
    /**
     * 清理事件路径中的id主键标识
     * @param path path
     * @returns
     */
    EventHandler.prototype.cleanEventPath = function (path) {
        path = path.filter(function (p) {
            if (p && p !== ':') {
                return true;
            }
            else {
                return false;
            }
        });
        return path.map(function (item) {
            if (item.includes(':')) {
                return item.split(':')[1];
            }
            else {
                return item;
            }
        });
    };
    /**
     * 获取子表事件行
     * @param paths
     * @param event
     * @returns
     */
    EventHandler.prototype.getCurrentRowByPaths = function (paths) {
        var result = null;
        var bindingList = this.bindingData.getValue(paths);
        if (bindingList && bindingList.length > 0) {
            var primaryValue = bindingList.currentItem.primaryKeyValue || null;
            if (primaryValue) {
                var bindingObject = bindingList.findById(primaryValue);
                if (bindingObject) {
                    result = bindingObject.toJSON();
                }
            }
        }
        return result;
    };
    /**
     * 获取事件路径中指定子表的事件行
     * @param path
     * @param tableCode
     * @returns
     */
    EventHandler.prototype.getEventId = function (path, tableCode) {
        if (!path || path.length < 1) {
            throw new Error('invalid path!');
        }
        var propertyIndex = path.findIndex(function (p) { return p === tableCode; });
        if (propertyIndex === -1) {
            return null;
        }
        var idIndex = propertyIndex + 1;
        if (idIndex > path.length - 1) {
            throw new Error('invalid propertyName or path');
        }
        var id = path[idIndex];
        if (id.indexOf(':') === -1) {
            throw new Error('compute error.');
        }
        return id.split(':')[1];
    };
    //#endregion
    //#region  构造上下文
    /**
     * 构造变量上下文
     * @param event
     * @returns
     */
    EventHandler.prototype.buildStateContext = function (event) {
        var ns = event.ns;
        var appContext = this.injector.get(AppContext, null);
        var frameContexts = appContext.frameContextManager.getFrameContextsByNamespace(ns);
        var result = {};
        if (frameContexts && frameContexts.length > 0) {
            var anonymousFrameContext = frameContexts[0];
            var rootFrameContext = anonymousFrameContext.getVirtualRootFrameContext();
            if (rootFrameContext) {
                var uiState_1 = rootFrameContext.viewModel.uiState;
                var propertyNames = Object.getOwnPropertyNames(uiState_1) || [];
                propertyNames.forEach(function (prop) {
                    if (prop.match(/^[a-zA-Z0-9_\$]+$/g) !== null) {
                        result[prop] = uiState_1[prop];
                    }
                });
            }
        }
        return result;
    };
    /**
     * 获取事件实体
     * @param event
     * @returns
     */
    EventHandler.prototype.buildEntityContext = function (event, expressionObject, currentRows) {
        var _this = this;
        var expressionBindingType = expressionObject.bindingType;
        if (expressionBindingType === Expression.ExpressionBindingType.Field) {
            var entityTypeInfo = this.repository.entityTypeInfo;
            var childrenEntityPaths = [];
            ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);
            // 获取当前行
            var row = currentRows && currentRows.find(function (row) { return row.bindingPath === '' || row.bindingPath === '/'; }) || null;
            var primaryValue = row && row.primaryValue || this.bindingData.list.currentId;
            var entity = this.bindingData.list.findById(primaryValue);
            if (!entity) {
                return {};
            }
            var object_1 = entity.toJSON();
            object_1['__type__'] = 'Entity';
            if (!childrenEntityPaths || childrenEntityPaths.length < 1) {
                return object_1;
            }
            childrenEntityPaths.sort(function (v1, v2) { return v1.length - v2.length; });
            // 找到所有子表
            childrenEntityPaths.forEach(function (paths) {
                var bindingList = _this.bindingData.getValue(paths);
                var currentRowId = bindingList.currentId;
                var propertyName = paths[paths.length - 1];
                // parent 为entity或entitylist或null
                var parent = paths.slice(0, paths.length - 1).reduce(function (object, path) {
                    return object && object[path] || null;
                }, object_1);
                if (!parent) {
                    return;
                }
                var data = parent;
                var node = null;
                if (!currentRowId) {
                    // 当前表没有数据
                    node = { __items__: [], __type__: 'List' };
                    node.length = function () { return node.__items__.length; };
                }
                else {
                    // 纠正当前行
                    if (currentRows && currentRows.length > 0) {
                        // 是否指定了当前行
                        var userAssignCurrentRow = currentRows.find(function (row) {
                            var bindingPaths = row.bindingPath.split('/').filter(function (p) { return p; });
                            return bindingPaths.join('/') === paths.join('/');
                        });
                        if (userAssignCurrentRow) {
                            currentRowId = userAssignCurrentRow.primaryValue;
                        }
                    }
                    // 子表当前行
                    var row_1 = bindingList.findById(currentRowId);
                    // 找到子表当前行的上级
                    var list = parent[propertyName];
                    node = tslib_1.__assign({ __items__: [] }, row_1 && row_1.toJSON() || {}, { __type__: 'List' });
                    node.length = function () { return node.__items__.length; };
                    if (list && Array.isArray(list)) {
                        node.__items__ = [].concat(list);
                    }
                }
                data[propertyName] = node;
            });
            return object_1;
        }
        else if (expressionBindingType === Expression.ExpressionBindingType.State) {
            // todo: 支持状态表达式
        }
        else {
            return null;
        }
    };
    /**
     * 构造表达式计算上下文
     * @param expressionObject 表达式
     * @param event 事件
     * @param entityContext 实体上下文
     * @param currentRows 当前行
     * @returns
     */
    EventHandler.prototype.buildContext = function (expressionObject, event, entityContext, currentRows) {
        var _a;
        var context = [];
        if (entityContext) {
            context.push(entityContext);
        }
        else {
            var entity_1 = this.buildEntityContext(event, expressionObject, currentRows);
            context.push(entity_1);
        }
        var stateContext = this.buildStateContext(event);
        var entityCode = this.entityOriginalNodeCode;
        var entity = null;
        if (context.length === 1) {
            entity = context.pop();
        }
        else {
            entity = context[0];
            if (!entity['__type__']) {
                entity['__type__'] = 'Entity';
            }
            entity['__items__'] = context;
        }
        var translate = this.injector.get(TranslateToken, null);
        return tslib_1.__assign((_a = {}, _a[entityCode] = entity, _a), stateContext, { BigNumber: BigNumber, frameContext: this.frameContext, bindingData: this.bindingData, repository: this.repository, CurrentLanguage: translate.getCurrentLanguage() || 'zh-CHS' });
    };
    //#endregion
    /**
     * 构造副作用路径
     * @param event
     * @param expressionObject
     * @returns
     */
    EventHandler.prototype.buildEffectPath = function (event, expressionObject) {
        var expressionPaths = expressionObject.path.split('/').filter(function (p) { return p; });
        var primaryValue = event.path[0] && event.path[0].split(':')[1];
        if (!primaryValue) {
            throw new Error('Invalid event path!');
        }
        if (expressionPaths.length === 1) {
            // 主表简单字段
            return [primaryValue, expressionPaths.pop()];
        }
        else {
            var result = [primaryValue];
            for (var index = 0; index < expressionPaths.length; index++) {
                var propertyName = expressionPaths[index];
                result.push(propertyName);
                var currentPaths = expressionPaths.slice(0, index + 1);
                var propertyInfo = this.repository.entityTypeInfo.getPropInfoByPath(currentPaths);
                if (propertyInfo.group === 'List') {
                    var id = this.getEventId(event.path, propertyInfo.name) || null;
                    // 事件和表达式不是同一个表
                    if (!id) {
                        var bindingList = this.bindingData.getValue(currentPaths);
                        if (bindingList) {
                            id = bindingList.currentId;
                        }
                    }
                    result.push(id);
                }
            }
            return result;
        }
    };
    //#region 辅助方法
    EventHandler.prototype.getPathInfo = function (path) {
        var paths = path.split('/').filter(function (p) { return p; });
        // 获取最大实体层级，其余为属性（简单属性、udt、关联、关联嵌套关联）
        var entityPath = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);
        var propertyName = paths.slice(entityPath.length).join('/');
        return { path: entityPath.join('/'), propertyName: propertyName, paths: entityPath, propertyNames: propertyName.split('/').filter(function (p) { return p; }) };
    };
    /**
     * get table paths from event paths
     * @param paths event paths
     * @returns
     */
    EventHandler.prototype.getTablePathsFromEventPaths = function (paths) {
        paths = this.getEntityPath(paths);
        var entityPaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);
        return entityPaths;
    };
    /**
     * get property paths from event paths
     * @param paths event paths
     * @returns
     */
    EventHandler.prototype.getPropertyPathsFromEventPaths = function (paths) {
        paths = this.getEntityPath(paths);
        var tablePaths = ExpressionUtil.getAvailableChildrenPathsFromEntityPaths(paths, this.repository.entityTypeInfo);
        return paths.slice(tablePaths.length);
    };
    /**
     * 分析事件和表达式的关系
     */
    EventHandler.prototype.analysis = function (event, expressionObject) {
        var expressionPathInfo = this.getPathInfo(expressionObject.path);
        var eventPaths = this.getEntityPath(event.path.slice(0));
        var eventPathInfo = this.getPathInfo(eventPaths.join('/'));
        if (!expressionPathInfo || !eventPathInfo) {
            console.warn("\u8868\u8FBE\u5F0F\u8DEF\u5F84\u6216\u4E8B\u4EF6\u8DEF\u5F84\u9519\u8BEF\uFF0C\u83B7\u53D6\u8DEF\u5F84\u4FE1\u606F\u5931\u8D25\u3002");
            return null;
        }
        var expressionTablePaths = expressionPathInfo.path.split('/').filter(function (p) { return p; });
        var expressionPropertyNames = expressionPathInfo.propertyName.split('/').filter(function (p) { return p; });
        var eventTablePaths = eventPathInfo.path.split('/').filter(function (p) { return p; });
        var eventPropertyNames = eventPathInfo.propertyName.split('/').filter(function (p) { return p; });
        var result = {
            distance: undefined,
            eventFromChildren: undefined,
            eventFromParent: undefined,
            expressionTablePaths: expressionTablePaths,
            expressionPropertyNames: expressionPropertyNames,
            eventTablePaths: eventTablePaths,
            eventPropertyNames: eventPropertyNames,
            isSameTable: false
        };
        result.distance = Math.abs(expressionTablePaths.length - eventTablePaths.length);
        if (result.distance === 1) {
            result.eventFromChildren = eventTablePaths.length > expressionTablePaths.length && eventTablePaths.join('/').startsWith(expressionTablePaths.join('/'));
            result.eventFromParent = eventTablePaths.length < expressionTablePaths.length && expressionTablePaths.join('/').startsWith(eventTablePaths.join('/'));
        }
        result.isSameTable = expressionTablePaths.join('/') === eventTablePaths.join('/');
        return result;
    };
    EventHandler.prototype.buildCurrentRows = function (tablePaths, fullPaths) {
        var currentRows = new Array();
        if (!tablePaths || tablePaths.length < 1) {
            currentRows.push({
                bindingPath: '/',
                primaryValue: fullPaths[0]
            });
        }
        else {
            var paths_1 = [];
            tablePaths.forEach(function (path, index) {
                if (index === 0) {
                    currentRows.push({
                        bindingPath: '/',
                        primaryValue: fullPaths[0]
                    });
                }
                paths_1.push(path);
                var primaryValue = fullPaths[index * 2 + 2];
                currentRows.push({
                    bindingPath: paths_1.join('/'),
                    primaryValue: primaryValue
                });
            });
        }
        return currentRows;
    };
    EventHandler.prototype.convertBooleanTypeExpressionResult = function (expressionObject, result) {
        if (this.isBooleanTypeExpression(expressionObject)) {
            return result === true ? true : false;
        }
        else {
            return result;
        }
    };
    EventHandler.prototype.isBooleanTypeExpression = function (expressionObject) {
        return this.isReadonlyExpression(expressionObject) || this.isVisibleExpression(expressionObject) || this.isValidateExpression(expressionObject) || this.isRequiredExpression(expressionObject) || this.isDependencyExpression(expressionObject);
    };
    EventHandler.prototype.isReadonlyExpression = function (expressionObject) {
        return expressionObject && expressionObject.type === Expression.ExpressionType.Readonly || false;
    };
    EventHandler.prototype.isVisibleExpression = function (expressionObject) {
        return expressionObject && expressionObject.type === Expression.ExpressionType.Visible;
    };
    EventHandler.prototype.isValidateExpression = function (expressionObject) {
        return expressionObject && expressionObject.type === Expression.ExpressionType.Validate;
    };
    EventHandler.prototype.isRequiredExpression = function (expressionObject) {
        return expressionObject && expressionObject.type === Expression.ExpressionType.Required;
    };
    EventHandler.prototype.isDependencyExpression = function (expressionObject) {
        return expressionObject && expressionObject.type === Expression.ExpressionType.Dependency;
    };
    EventHandler.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    EventHandler.ctorParameters = function () { return [
        { type: Injector },
        { type: Repository },
        { type: BindingData },
        { type: ExpressionRegistry },
        { type: EffectorFactory },
        { type: ExpressionExecutor },
        { type: ExpressionResult }
    ]; };
    return EventHandler;
}());
export { EventHandler };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRfaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2V2ZW50LWhhbmRsZXIvZXZlbnRfaGFuZGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsV0FBVyxFQUE4QixNQUFNLHVCQUF1QixDQUFDO0FBRWhGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxVQUFVLEVBQUUsa0JBQWtCLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMzRyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFakQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN4QyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFMUQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRXpEO0lBR0Usc0JBQXNCLFFBQWtCLEVBQVksVUFBMkIsRUFBWSxXQUF3QixFQUFZLGtCQUFzQyxFQUFZLGVBQWdDLEVBQVksa0JBQXNDLEVBQVksZ0JBQWtDO1FBQTNSLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBWSxlQUFVLEdBQVYsVUFBVSxDQUFpQjtRQUFZLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVksdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUFZLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFZLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFBWSxxQkFBZ0IsR0FBaEIsZ0JBQWdC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LE9BQU8sZ0JBQWdCLElBQUksZ0JBQWdCLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQyxjQUFjLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQztJQUNuRyxDQUFDO0lBQ08sMENBQW1CLEdBQTNCLFVBQTRCLGdCQUE2QztRQUN2RSxPQUFPLGdCQUFnQixJQUFJLGdCQUFnQixDQUFDLElBQUksS0FBSyxVQUFVLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQztJQUN6RixDQUFDO0lBQ08sMkNBQW9CLEdBQTVCLFVBQTZCLGdCQUE2QztRQUN4RSxPQUFPLGdCQUFnQixJQUFJLGdCQUFnQixDQUFDLElBQUksS0FBSyxVQUFVLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQztJQUMxRixDQUFDO0lBQ08sMkNBQW9CLEdBQTVCLFVBQTZCLGdCQUE2QztRQUN4RSxPQUFPLGdCQUFnQixJQUFJLGdCQUFnQixDQUFDLElBQUksS0FBSyxVQUFVLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQztJQUMxRixDQUFDO0lBQ08sNkNBQXNCLEdBQTlCLFVBQStCLGdCQUE2QztRQUMxRSxPQUFPLGdCQUFnQixJQUFJLGdCQUFnQixDQUFDLElBQUksS0FBSyxVQUFVLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQztJQUM1RixDQUFDOztnQkE5ZUYsVUFBVTs7OztnQkFkVSxRQUFRO2dCQU9wQixVQUFVO2dCQUxWLFdBQVc7Z0JBSXFCLGtCQUFrQjtnQkFGbEQsZUFBZTtnQkFFSCxrQkFBa0I7Z0JBQXNCLGdCQUFnQjs7SUF3ZjdFLG1CQUFDO0NBQUEsQUFoZkQsSUFnZkM7U0EvZXFCLFlBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBcHBDb250ZXh0IH0gZnJvbSAnLi4vYXBwL2luZGV4JztcclxuaW1wb3J0IHsgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0LCBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnLi4vYmluZGluZy1kYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRGF0YVByb3BJbmZvIH0gZnJvbSAnLi4vY29yZS9pbmRleCc7XHJcbmltcG9ydCB7IEVmZmVjdG9yRmFjdG9yeSB9IGZyb20gJy4uL2VmZmVjdG9yL2luZGV4JztcclxuaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnYmlnbnVtYmVyLmpzJztcclxuaW1wb3J0IHsgRXhwcmVzc2lvbiwgRXhwcmVzc2lvbkV4ZWN1dG9yLCBFeHByZXNzaW9uUmVnaXN0cnksIEV4cHJlc3Npb25SZXN1bHQgfSBmcm9tICcuLi9leHByZXNzaW9uL2luZGV4JztcclxuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcnkvaW5kZXgnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEVudGl0eUxpc3QgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICcuLi9mcmFtZSc7XHJcbmltcG9ydCB7IEV4cHJlc3Npb25VdGlsIH0gZnJvbSAnLi4vdXRpbHMvZXhwcmVzc2lvbl91dGlsJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlIH0gZnJvbSAnLi4vaTE4bi90cmFuc2xhdGUnO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGVUb2tlbiB9IGZyb20gJy4uL2kxOG4vdHJhbnNsYXRlX3Rva2VuJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEV2ZW50SGFuZGxlciBpbXBsZW1lbnRzIEV4cHJlc3Npb24uSUV2ZW50SGFuZGxlciB7XHJcbiAgcHJvdGVjdGVkIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0O1xyXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBpbmplY3RvcjogSW5qZWN0b3IsIHByb3RlY3RlZCByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIHByb3RlY3RlZCBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEsIHByb3RlY3RlZCBleHByZXNzaW9uUmVnaXN0cnk6IEV4cHJlc3Npb25SZWdpc3RyeSwgcHJvdGVjdGVkIGVmZmVjdG9yRmFjdG9yeTogRWZmZWN0b3JGYWN0b3J5LCBwcm90ZWN0ZWQgZXhwcmVzc2lvbkV4ZWN1dG9yOiBFeHByZXNzaW9uRXhlY3V0b3IsIHByb3RlY3RlZCBleHByZXNzaW9uUmVzdWx0OiBFeHByZXNzaW9uUmVzdWx0KSB7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEZyYW1lQ29udGV4dD4oRnJhbWVDb250ZXh0KTtcclxuICB9XHJcbiAgcHVibGljIGV4cHJlc3Npb25PYmplY3RzOiBFeHByZXNzaW9uLkV4cHJlc3Npb25PYmplY3RbXTtcclxuXHJcbiAgcHVibGljIGhhbmRsZUV2ZW50KGV2ZW50OiBFeHByZXNzaW9uLkV2ZW50QXJncywgZXhwcmVzc2lvbk9iamVjdHM6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdFtdKSB7XHJcbiAgICBldmVudCA9IE9iamVjdC5hc3NpZ24oe30sIGV2ZW50KTtcclxuICAgIHRoaXMuZXhwcmVzc2lvbk9iamVjdHMgPSBleHByZXNzaW9uT2JqZWN0cztcclxuICAgIHRoaXMuZGlzcGF0Y2goZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLy8jcmVnaW9uIOaKveixoeWHveaVsFxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluebuOWFs+ihqOi+vuW8j1xyXG4gICAqIEBwYXJhbSBldmVudCBldmVudFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhYnN0cmFjdCBmaWx0ZXIoZXZlbnQ6IEV4cHJlc3Npb24uRXZlbnRBcmdzKTtcclxuICAvKipcclxuICAgKiDlj5HluIPkuovku7ZcclxuICAgKiBAcGFyYW0gZXhwcmVzc2lvbk9iamVjdCDooajovr7lvI/lr7nosaFcclxuICAgKiBAcGFyYW0gZXZlbnQg5LqL5Lu2XHJcbiAgICovXHJcbiAgcHVibGljIGFic3RyYWN0IGRpc3BhdGNoKGV2ZW50OiBFeHByZXNzaW9uLkV2ZW50QXJncyk6IHZvaWQ7XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiDlsZ7mgKdcclxuXHJcbiAgLyoqXHJcbiAgICog5Li76KGo5Li76ZSu5YC8XHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldCBwcmltYXJ5VmFsdWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Li75a6e5L2T5Y6f5aeL5a2X5q615ZCNXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldCBlbnRpdHlPcmlnaW5hbE5vZGVDb2RlKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5ICYmIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbyAmJiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8uZW50aXR5SW5mbyAmJiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8uZW50aXR5SW5mby5vcmlnaW5hbENvZGUgfHwgbnVsbDtcclxuICB9XHJcblxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24g6KGo6L6+5byP5qC45b+DXHJcbiAgLyoqXHJcbiAgICog5omn6KGM6KGo6L6+5byP6K6h566XXHJcbiAgICogQHBhcmFtIGV4cHJlc3Npb24g6KGo6L6+5byPXHJcbiAgICogQHBhcmFtIGNvbnRleHQg5LiK5LiL5paHXHJcbiAgICogQHJldHVybnMgYW55XHJcbiAgICovXHJcbiAgcHVibGljIHBlcmZvcm0oZXhwcmVzc2lvbk9iamVjdDogRXhwcmVzc2lvbi5FeHByZXNzaW9uT2JqZWN0LCBjb250ZXh0OiBhbnkpIHtcclxuICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb25FeGVjdXRvci5jb21waWxlKGV4cHJlc3Npb25PYmplY3QsIGNvbnRleHQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlia/kvZznlKhcclxuICAgKiBAcGFyYW0gZXZlbnQgZXZlbnRcclxuICAgKiBAcGFyYW0gZXhwcmVzc2lvbk9iamVjdCBleHByZXNzaW9uT2JqZWN0XHJcbiAgICovXHJcbiAgcHVibGljIGVmZmVjdChldmVudDogRXhwcmVzc2lvbi5FdmVudEFyZ3MsIGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCk6IHZvaWQge1xyXG4gICAgY29uc3QgZWZmZWN0VG8gPSBleHByZXNzaW9uT2JqZWN0LmJpbmRpbmdUeXBlO1xyXG4gICAgY29uc3QgZWZmZWN0b3IgPSB0aGlzLmVmZmVjdG9yRmFjdG9yeS5nZXRFZmZlY3RvcihleHByZXNzaW9uT2JqZWN0KTtcclxuICAgIGlmICghZWZmZWN0b3IpIHtcclxuICAgICAgLy8gY29uc29sZS53YXJuKGBFdmVudEhhbmRsZXIg5rKh5pyJ5a+55bqU55qE5Ymv5L2c55So5Zmo44CCJHtleHByZXNzaW9uT2JqZWN0LnR5cGV9YCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChlZmZlY3RUbyA9PT0gRXhwcmVzc2lvbi5FeHByZXNzaW9uQmluZGluZ1R5cGUuRmllbGQpIHtcclxuICAgICAgY29uc3QgZWZmZWN0UGF0aHMgPSBleHByZXNzaW9uT2JqZWN0LmVmZmVjdFBhdGhzIHx8IFtdO1xyXG4gICAgICBpZiAoZWZmZWN0UGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGVmZmVjdFBhdGhzLmZvckVhY2goKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgZWZmZWN0UGF0aCA9IHBhdGguc3BsaXQoJy8nKTtcclxuICAgICAgICAgIGNvbnN0IGVmZmVjdE9wdGlvbnMgPSB7IHBhdGg6IGVmZmVjdFBhdGgsIG1lc3NhZ2U6IGV4cHJlc3Npb25PYmplY3QubWVzc2FnZSwgZXhwcmVzc2lvbklkOiBleHByZXNzaW9uT2JqZWN0LmlkIH07XHJcbiAgICAgICAgICBlZmZlY3Rvci5lZmZlY3QoZXhwcmVzc2lvbk9iamVjdC5wYXRoLCBleHByZXNzaW9uT2JqZWN0LnJlc3VsdCwgZWZmZWN0T3B0aW9ucyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXhwcmVzc2lvbk9iamVjdC50eXBlID09PSBFeHByZXNzaW9uLkV4cHJlc3Npb25UeXBlLlJlcXVpcmVkIHx8IGV4cHJlc3Npb25PYmplY3QudHlwZSA9PT0gRXhwcmVzc2lvbi5FeHByZXNzaW9uVHlwZS5WYWxpZGF0ZSB8fCBleHByZXNzaW9uT2JqZWN0LnR5cGUgPT09IEV4cHJlc3Npb24uRXhwcmVzc2lvblR5cGUuUmVhZG9ubHkgfHwgZXhwcmVzc2lvbk9iamVjdC50eXBlID09PSBFeHByZXNzaW9uLkV4cHJlc3Npb25UeXBlLlZpc2libGUpIHtcclxuICAgICAgICBjb25zdCBlZmZlY3RPcHRpb25zID0geyBtZXNzYWdlOiBleHByZXNzaW9uT2JqZWN0Lm1lc3NhZ2UsIGV4cHJlc3Npb25JZDogZXhwcmVzc2lvbk9iamVjdC5pZCB9O1xyXG4gICAgICAgIGVmZmVjdG9yLmVmZmVjdChleHByZXNzaW9uT2JqZWN0LnBhdGgsIGV4cHJlc3Npb25PYmplY3QucmVzdWx0LCBlZmZlY3RPcHRpb25zKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdub3Qgc3VwcG9ydGVk77yBJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyNlbmRyZWdpb25cclxuXHJcbiAgLy8jcmVnaW9uIHV0aWxcclxuXHJcbiAgcHJvdGVjdGVkIGlzVmFsaWRhdGVPclJlcXVpcmVkRXhwcmVzc2lvbihleHByZXNzaW9uT2JqZWN0OiBFeHByZXNzaW9uLkV4cHJlc3Npb25PYmplY3QpIHtcclxuICAgIHJldHVybiBleHByZXNzaW9uT2JqZWN0ICYmIChleHByZXNzaW9uT2JqZWN0LnR5cGUgPT09IEV4cHJlc3Npb24uRXhwcmVzc2lvblR5cGUuVmFsaWRhdGUgfHwgZXhwcmVzc2lvbk9iamVjdC50eXBlID09PSBFeHByZXNzaW9uLkV4cHJlc3Npb25UeXBlLlJlcXVpcmVkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Lul5LqL5Lu25Y+C5pWw5Li65L6d5o2u5p6E5bu65a6e5L2T6Lev5b6EXHJcbiAgICogQHBhcmFtIGV2ZW50IGV2ZW50XHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldEVudGl0eVBhdGhGcm9tRXZlbnQoZXZlbnQ6IEV4cHJlc3Npb24uRXZlbnRBcmdzKTogc3RyaW5nW10ge1xyXG4gICAgZXZlbnQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7XHJcbiAgICBpZiAoIWV2ZW50IHx8ICFldmVudC5wYXRoIHx8IGV2ZW50LnBhdGgubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXRocyA9IGV2ZW50LnBhdGg7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRFbnRpdHlQYXRoKHBhdGhzKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5LqL5Lu26Lev5b6E5Lit55qE5a6e5L2T6Lev5b6EXHJcbiAgICogQHBhcmFtIHBhdGggcGF0aFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRFbnRpdHlQYXRoKHBhdGg6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcGF0aHMgPSBwYXRoLmZpbHRlcigodmFsdWU6IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICBpZiAoaW5kZXggJSAyID09PSAwICYmIHZhbHVlLmluY2x1ZGVzKCc6JykpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHBhdGhzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKDlrp7kvZPot6/lvoRcclxuICAgKiBAcGFyYW0gcGF0aCBwYXRoXHJcbiAgICogQGRlc2NyaXB0aW9uIOWIoOmZpOi3r+W+hOS4reeahGlk5a2X5q61XHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGJ1aWxkRW50aXR5UGF0aChwYXRoOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5maWx0ZXIoKHZhbHVlOiBzdHJpbmcsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgaWYgKGluZGV4ICUgMiA9PT0gMCAmJiB2YWx1ZS5pbmNsdWRlcygnOicpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBwYXRocztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF55CG5LqL5Lu26Lev5b6E5Lit55qEaWTkuLvplK7moIfor4ZcclxuICAgKiBAcGFyYW0gcGF0aCBwYXRoXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGNsZWFuRXZlbnRQYXRoKHBhdGg6IHN0cmluZ1tdKSB7XHJcbiAgICBwYXRoID0gcGF0aC5maWx0ZXIocCA9PiB7XHJcbiAgICAgIGlmIChwICYmIHAgIT09ICc6Jykge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcGF0aC5tYXAoKGl0ZW06IHN0cmluZykgPT4ge1xyXG4gICAgICBpZiAoaXRlbS5pbmNsdWRlcygnOicpKSB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0uc3BsaXQoJzonKVsxXTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWtkOihqOS6i+S7tuihjFxyXG4gICAqIEBwYXJhbSBwYXRocyBcclxuICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldEN1cnJlbnRSb3dCeVBhdGhzKHBhdGhzOiBzdHJpbmdbXSk6IG51bGwgfCB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcclxuICAgIGNvbnN0IGJpbmRpbmdMaXN0OiBCaW5kaW5nTGlzdCA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUocGF0aHMpIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgaWYgKGJpbmRpbmdMaXN0ICYmIGJpbmRpbmdMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgbGV0IHByaW1hcnlWYWx1ZSA9IGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtLnByaW1hcnlLZXlWYWx1ZSB8fCBudWxsO1xyXG4gICAgICBpZiAocHJpbWFyeVZhbHVlKSB7XHJcbiAgICAgICAgY29uc3QgYmluZGluZ09iamVjdCA9IGJpbmRpbmdMaXN0LmZpbmRCeUlkKHByaW1hcnlWYWx1ZSk7XHJcbiAgICAgICAgaWYgKGJpbmRpbmdPYmplY3QpIHtcclxuICAgICAgICAgIHJlc3VsdCA9IGJpbmRpbmdPYmplY3QudG9KU09OKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bkuovku7bot6/lvoTkuK3mjIflrprlrZDooajnmoTkuovku7booYxcclxuICAgKiBAcGFyYW0gcGF0aCBcclxuICAgKiBAcGFyYW0gdGFibGVDb2RlIFxyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBnZXRFdmVudElkKHBhdGg6IHN0cmluZ1tdLCB0YWJsZUNvZGU6IHN0cmluZykge1xyXG4gICAgaWYgKCFwYXRoIHx8IHBhdGgubGVuZ3RoIDwgMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgcGF0aCEnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHByb3BlcnR5SW5kZXggPSBwYXRoLmZpbmRJbmRleChwID0+IHAgPT09IHRhYmxlQ29kZSk7XHJcbiAgICBpZiAocHJvcGVydHlJbmRleCA9PT0gLTEpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpZEluZGV4ID0gcHJvcGVydHlJbmRleCArIDE7XHJcbiAgICBpZiAoaWRJbmRleCA+IHBhdGgubGVuZ3RoIC0gMSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgcHJvcGVydHlOYW1lIG9yIHBhdGgnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGlkID0gcGF0aFtpZEluZGV4XTtcclxuICAgIGlmIChpZC5pbmRleE9mKCc6JykgPT09IC0xKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignY29tcHV0ZSBlcnJvci4nKTtcclxuICAgIH1cclxuICAgIHJldHVybiBpZC5zcGxpdCgnOicpWzFdO1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vI3JlZ2lvbiAg5p6E6YCg5LiK5LiL5paHXHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWPmOmHj+S4iuS4i+aWh1xyXG4gICAqIEBwYXJhbSBldmVudCBcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRTdGF0ZUNvbnRleHQoZXZlbnQ6IEV4cHJlc3Npb24uRXZlbnRBcmdzKSB7XHJcbiAgICBjb25zdCBucyA9IGV2ZW50Lm5zO1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xyXG4gICAgY29uc3QgZnJhbWVDb250ZXh0cyA9IGFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRzQnlOYW1lc3BhY2UobnMpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0ge307XHJcbiAgICBpZiAoZnJhbWVDb250ZXh0cyAmJiBmcmFtZUNvbnRleHRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgYW5vbnltb3VzRnJhbWVDb250ZXh0ID0gZnJhbWVDb250ZXh0c1swXTtcclxuICAgICAgY29uc3Qgcm9vdEZyYW1lQ29udGV4dCA9IGFub255bW91c0ZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpO1xyXG4gICAgICBpZiAocm9vdEZyYW1lQ29udGV4dCkge1xyXG4gICAgICAgIGNvbnN0IHVpU3RhdGUgPSByb290RnJhbWVDb250ZXh0LnZpZXdNb2RlbC51aVN0YXRlO1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh1aVN0YXRlKSB8fCBbXTtcclxuICAgICAgICBwcm9wZXJ0eU5hbWVzLmZvckVhY2goKHByb3A6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgaWYgKHByb3AubWF0Y2goL15bYS16QS1aMC05X1xcJF0rJC9nKSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB1aVN0YXRlW3Byb3BdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bkuovku7blrp7kvZNcclxuICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkRW50aXR5Q29udGV4dChldmVudDogRXhwcmVzc2lvbi5FdmVudEFyZ3MsIGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCwgY3VycmVudFJvd3M/OiBBcnJheTxFeHByZXNzaW9uLklDdXJyZW50Um93Pikge1xyXG4gICAgY29uc3QgZXhwcmVzc2lvbkJpbmRpbmdUeXBlID0gZXhwcmVzc2lvbk9iamVjdC5iaW5kaW5nVHlwZTtcclxuICAgIGlmIChleHByZXNzaW9uQmluZGluZ1R5cGUgPT09IEV4cHJlc3Npb24uRXhwcmVzc2lvbkJpbmRpbmdUeXBlLkZpZWxkKSB7XHJcbiAgICAgIGNvbnN0IGVudGl0eVR5cGVJbmZvID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvO1xyXG4gICAgICBjb25zdCBjaGlsZHJlbkVudGl0eVBhdGhzID0gW107XHJcbiAgICAgIEV4cHJlc3Npb25VdGlsLmdldENoaWxkcmVuRW50aXR5UGF0aHMoZW50aXR5VHlwZUluZm8sIGNoaWxkcmVuRW50aXR5UGF0aHMpO1xyXG4gICAgICAvLyDojrflj5blvZPliY3ooYxcclxuICAgICAgY29uc3Qgcm93ID0gY3VycmVudFJvd3MgJiYgY3VycmVudFJvd3MuZmluZChyb3cgPT4gcm93LmJpbmRpbmdQYXRoID09PSAnJyB8fCByb3cuYmluZGluZ1BhdGggPT09ICcvJykgfHwgbnVsbDtcclxuICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gcm93ICYmIHJvdy5wcmltYXJ5VmFsdWUgfHwgdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgICAgbGV0IGVudGl0eSA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xyXG4gICAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICAgIHJldHVybiB7fTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBvYmplY3QgPSBlbnRpdHkudG9KU09OKCk7XHJcbiAgICAgIG9iamVjdFsnX190eXBlX18nXSA9ICdFbnRpdHknO1xyXG4gICAgICBpZiAoIWNoaWxkcmVuRW50aXR5UGF0aHMgfHwgY2hpbGRyZW5FbnRpdHlQYXRocy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgcmV0dXJuIG9iamVjdDtcclxuICAgICAgfVxyXG4gICAgICBjaGlsZHJlbkVudGl0eVBhdGhzLnNvcnQoKHYxLCB2MikgPT4gdjEubGVuZ3RoIC0gdjIubGVuZ3RoKTtcclxuICAgICAgLy8g5om+5Yiw5omA5pyJ5a2Q6KGoXHJcbiAgICAgIGNoaWxkcmVuRW50aXR5UGF0aHMuZm9yRWFjaCgocGF0aHM6IHN0cmluZ1tdKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKHBhdGhzKSBhcyBCaW5kaW5nTGlzdDtcclxuICAgICAgICBsZXQgY3VycmVudFJvd0lkID0gYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHBhdGhzW3BhdGhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgIC8vIHBhcmVudCDkuLplbnRpdHnmiJZlbnRpdHlsaXN05oiWbnVsbFxyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHBhdGhzLnNsaWNlKDAsIHBhdGhzLmxlbmd0aCAtIDEpLnJlZHVjZSgob2JqZWN0OiBhbnksIHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIG9iamVjdCAmJiBvYmplY3RbcGF0aF0gfHwgbnVsbDtcclxuICAgICAgICB9LCBvYmplY3QpO1xyXG4gICAgICAgIGlmICghcGFyZW50KSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBwYXJlbnQ7XHJcbiAgICAgICAgbGV0IG5vZGU6IGFueSA9IG51bGw7XHJcbiAgICAgICAgaWYgKCFjdXJyZW50Um93SWQpIHtcclxuICAgICAgICAgIC8vIOW9k+WJjeihqOayoeacieaVsOaNrlxyXG4gICAgICAgICAgbm9kZSA9IHsgX19pdGVtc19fOiBbXSwgX190eXBlX186ICdMaXN0JyB9O1xyXG4gICAgICAgICAgbm9kZS5sZW5ndGggPSAoKSA9PiBub2RlLl9faXRlbXNfXy5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIOe6oOato+W9k+WJjeihjFxyXG4gICAgICAgICAgaWYgKGN1cnJlbnRSb3dzICYmIGN1cnJlbnRSb3dzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8g5piv5ZCm5oyH5a6a5LqG5b2T5YmN6KGMXHJcbiAgICAgICAgICAgIGNvbnN0IHVzZXJBc3NpZ25DdXJyZW50Um93ID0gY3VycmVudFJvd3MuZmluZChyb3cgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IHJvdy5iaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgICAgIHJldHVybiBiaW5kaW5nUGF0aHMuam9pbignLycpID09PSBwYXRocy5qb2luKCcvJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAodXNlckFzc2lnbkN1cnJlbnRSb3cpIHtcclxuICAgICAgICAgICAgICBjdXJyZW50Um93SWQgPSB1c2VyQXNzaWduQ3VycmVudFJvdy5wcmltYXJ5VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOWtkOihqOW9k+WJjeihjFxyXG4gICAgICAgICAgY29uc3Qgcm93ID0gYmluZGluZ0xpc3QuZmluZEJ5SWQoY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgIC8vIOaJvuWIsOWtkOihqOW9k+WJjeihjOeahOS4iue6p1xyXG4gICAgICAgICAgY29uc3QgbGlzdCA9IHBhcmVudFtwcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgICAgbm9kZSA9IHsgX19pdGVtc19fOiBbXSwgLi4ucm93ICYmIHJvdy50b0pTT04oKSB8fCB7fSwgX190eXBlX186ICdMaXN0JyB9O1xyXG4gICAgICAgICAgbm9kZS5sZW5ndGggPSAoKSA9PiBub2RlLl9faXRlbXNfXy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgaWYgKGxpc3QgJiYgQXJyYXkuaXNBcnJheShsaXN0KSkge1xyXG4gICAgICAgICAgICBub2RlLl9faXRlbXNfXyA9IFtdLmNvbmNhdChsaXN0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZGF0YVtwcm9wZXJ0eU5hbWVdID0gbm9kZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBvYmplY3Q7XHJcbiAgICB9IGVsc2UgaWYgKGV4cHJlc3Npb25CaW5kaW5nVHlwZSA9PT0gRXhwcmVzc2lvbi5FeHByZXNzaW9uQmluZGluZ1R5cGUuU3RhdGUpIHtcclxuICAgICAgLy8gdG9kbzog5pSv5oyB54q25oCB6KGo6L6+5byPXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg6KGo6L6+5byP6K6h566X5LiK5LiL5paHXHJcbiAgICogQHBhcmFtIGV4cHJlc3Npb25PYmplY3Qg6KGo6L6+5byPXHJcbiAgICogQHBhcmFtIGV2ZW50IOS6i+S7tlxyXG4gICAqIEBwYXJhbSBlbnRpdHlDb250ZXh0IOWunuS9k+S4iuS4i+aWh1xyXG4gICAqIEBwYXJhbSBjdXJyZW50Um93cyDlvZPliY3ooYxcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwdWJsaWMgYnVpbGRDb250ZXh0KGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCwgZXZlbnQ6IEV4cHJlc3Npb24uRXZlbnRBcmdzLCBlbnRpdHlDb250ZXh0PzogYW55LCBjdXJyZW50Um93cz86IEFycmF5PEV4cHJlc3Npb24uSUN1cnJlbnRSb3c+KTogYW55IHtcclxuICAgIGxldCBjb250ZXh0ID0gW107XHJcbiAgICBpZiAoZW50aXR5Q29udGV4dCkge1xyXG4gICAgICBjb250ZXh0LnB1c2goZW50aXR5Q29udGV4dCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmJ1aWxkRW50aXR5Q29udGV4dChldmVudCwgZXhwcmVzc2lvbk9iamVjdCwgY3VycmVudFJvd3MpO1xyXG4gICAgICBjb250ZXh0LnB1c2goZW50aXR5KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHN0YXRlQ29udGV4dCA9IHRoaXMuYnVpbGRTdGF0ZUNvbnRleHQoZXZlbnQpO1xyXG4gICAgY29uc3QgZW50aXR5Q29kZSA9IHRoaXMuZW50aXR5T3JpZ2luYWxOb2RlQ29kZTtcclxuICAgIGxldCBlbnRpdHkgPSBudWxsO1xyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIGVudGl0eSA9IGNvbnRleHQucG9wKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBlbnRpdHkgPSBjb250ZXh0WzBdO1xyXG4gICAgICBpZiAoIWVudGl0eVsnX190eXBlX18nXSkge1xyXG4gICAgICAgIGVudGl0eVsnX190eXBlX18nXSA9ICdFbnRpdHknO1xyXG4gICAgICB9XHJcbiAgICAgIGVudGl0eVsnX19pdGVtc19fJ10gPSBjb250ZXh0O1xyXG4gICAgfVxyXG4gICAgY29uc3QgdHJhbnNsYXRlID0gdGhpcy5pbmplY3Rvci5nZXQ8VHJhbnNsYXRlPihUcmFuc2xhdGVUb2tlbiwgbnVsbCk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBbZW50aXR5Q29kZV06IGVudGl0eSxcclxuICAgICAgLi4uc3RhdGVDb250ZXh0LFxyXG4gICAgICBCaWdOdW1iZXIsXHJcbiAgICAgIGZyYW1lQ29udGV4dDogdGhpcy5mcmFtZUNvbnRleHQsXHJcbiAgICAgIGJpbmRpbmdEYXRhOiB0aGlzLmJpbmRpbmdEYXRhLFxyXG4gICAgICByZXBvc2l0b3J5OiB0aGlzLnJlcG9zaXRvcnksXHJcbiAgICAgIEN1cnJlbnRMYW5ndWFnZTogdHJhbnNsYXRlLmdldEN1cnJlbnRMYW5ndWFnZSgpIHx8ICd6aC1DSFMnXHJcbiAgICB9O1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuICAvKipcclxuICAgKiDmnoTpgKDlia/kvZznlKjot6/lvoRcclxuICAgKiBAcGFyYW0gZXZlbnQgXHJcbiAgICogQHBhcmFtIGV4cHJlc3Npb25PYmplY3QgXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGJ1aWxkRWZmZWN0UGF0aChldmVudDogRXhwcmVzc2lvbi5FdmVudEFyZ3MsIGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IGV4cHJlc3Npb25QYXRocyA9IGV4cHJlc3Npb25PYmplY3QucGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgY29uc3QgcHJpbWFyeVZhbHVlID0gZXZlbnQucGF0aFswXSAmJiBldmVudC5wYXRoWzBdLnNwbGl0KCc6JylbMV07XHJcbiAgICBpZiAoIXByaW1hcnlWYWx1ZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZXZlbnQgcGF0aCEnKTtcclxuICAgIH1cclxuICAgIGlmIChleHByZXNzaW9uUGF0aHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIC8vIOS4u+ihqOeugOWNleWtl+autVxyXG4gICAgICByZXR1cm4gW3ByaW1hcnlWYWx1ZSwgZXhwcmVzc2lvblBhdGhzLnBvcCgpXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFtwcmltYXJ5VmFsdWVdO1xyXG4gICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZXhwcmVzc2lvblBhdGhzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IGV4cHJlc3Npb25QYXRoc1tpbmRleF07XHJcbiAgICAgICAgcmVzdWx0LnB1c2gocHJvcGVydHlOYW1lKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50UGF0aHMgPSBleHByZXNzaW9uUGF0aHMuc2xpY2UoMCwgaW5kZXggKyAxKTtcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eUluZm86IERhdGFQcm9wSW5mbyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mby5nZXRQcm9wSW5mb0J5UGF0aChjdXJyZW50UGF0aHMpO1xyXG4gICAgICAgIGlmIChwcm9wZXJ0eUluZm8uZ3JvdXAgPT09ICdMaXN0Jykge1xyXG4gICAgICAgICAgbGV0IGlkID0gdGhpcy5nZXRFdmVudElkKGV2ZW50LnBhdGgsIHByb3BlcnR5SW5mby5uYW1lKSB8fCBudWxsO1xyXG4gICAgICAgICAgLy8g5LqL5Lu25ZKM6KGo6L6+5byP5LiN5piv5ZCM5LiA5Liq6KGoXHJcbiAgICAgICAgICBpZiAoIWlkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShjdXJyZW50UGF0aHMpIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgICAgICAgICBpZiAoYmluZGluZ0xpc3QpIHtcclxuICAgICAgICAgICAgICBpZCA9IGJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmVzdWx0LnB1c2goaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8jcmVnaW9uIOi+heWKqeaWueazlVxyXG4gIHByb3RlY3RlZCBnZXRQYXRoSW5mbyhwYXRoOiBzdHJpbmcpOiB7IHBhdGg6IHN0cmluZywgcHJvcGVydHlOYW1lOiBzdHJpbmcsIHBhdGhzOiBzdHJpbmdbXSwgcHJvcGVydHlOYW1lczogc3RyaW5nW10gfSB7XHJcbiAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgIC8vIOiOt+WPluacgOWkp+WunuS9k+Wxgue6p++8jOWFtuS9meS4uuWxnuaAp++8iOeugOWNleWxnuaAp+OAgXVkdOOAgeWFs+iBlOOAgeWFs+iBlOW1jOWll+WFs+iBlO+8iVxyXG4gICAgY29uc3QgZW50aXR5UGF0aCA9IEV4cHJlc3Npb25VdGlsLmdldEF2YWlsYWJsZUNoaWxkcmVuUGF0aHNGcm9tRW50aXR5UGF0aHMocGF0aHMsIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbyk7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBwYXRocy5zbGljZShlbnRpdHlQYXRoLmxlbmd0aCkuam9pbignLycpO1xyXG4gICAgcmV0dXJuIHsgcGF0aDogZW50aXR5UGF0aC5qb2luKCcvJyksIHByb3BlcnR5TmFtZSwgcGF0aHM6IGVudGl0eVBhdGgsIHByb3BlcnR5TmFtZXM6IHByb3BlcnR5TmFtZS5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApIH07XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIGdldCB0YWJsZSBwYXRocyBmcm9tIGV2ZW50IHBhdGhzXHJcbiAgICogQHBhcmFtIHBhdGhzIGV2ZW50IHBhdGhzXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGdldFRhYmxlUGF0aHNGcm9tRXZlbnRQYXRocyhwYXRoczogc3RyaW5nW10pIHtcclxuICAgIHBhdGhzID0gdGhpcy5nZXRFbnRpdHlQYXRoKHBhdGhzKTtcclxuICAgIGNvbnN0IGVudGl0eVBhdGhzID0gRXhwcmVzc2lvblV0aWwuZ2V0QXZhaWxhYmxlQ2hpbGRyZW5QYXRoc0Zyb21FbnRpdHlQYXRocyhwYXRocywgdGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvKTtcclxuICAgIHJldHVybiBlbnRpdHlQYXRocztcclxuICB9XHJcbiAgLyoqXHJcbiAgICogZ2V0IHByb3BlcnR5IHBhdGhzIGZyb20gZXZlbnQgcGF0aHNcclxuICAgKiBAcGFyYW0gcGF0aHMgZXZlbnQgcGF0aHNcclxuICAgKiBAcmV0dXJucyBcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgZ2V0UHJvcGVydHlQYXRoc0Zyb21FdmVudFBhdGhzKHBhdGhzOiBzdHJpbmdbXSkge1xyXG4gICAgcGF0aHMgPSB0aGlzLmdldEVudGl0eVBhdGgocGF0aHMpO1xyXG4gICAgY29uc3QgdGFibGVQYXRocyA9IEV4cHJlc3Npb25VdGlsLmdldEF2YWlsYWJsZUNoaWxkcmVuUGF0aHNGcm9tRW50aXR5UGF0aHMocGF0aHMsIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbyk7XHJcbiAgICByZXR1cm4gcGF0aHMuc2xpY2UodGFibGVQYXRocy5sZW5ndGgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliIbmnpDkuovku7blkozooajovr7lvI/nmoTlhbPns7tcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgYW5hbHlzaXMoZXZlbnQ6IEV4cHJlc3Npb24uRXZlbnRBcmdzLCBleHByZXNzaW9uT2JqZWN0OiBFeHByZXNzaW9uLkV4cHJlc3Npb25PYmplY3QpIHtcclxuICAgIGNvbnN0IGV4cHJlc3Npb25QYXRoSW5mbyA9IHRoaXMuZ2V0UGF0aEluZm8oZXhwcmVzc2lvbk9iamVjdC5wYXRoKTtcclxuICAgIGNvbnN0IGV2ZW50UGF0aHMgPSB0aGlzLmdldEVudGl0eVBhdGgoZXZlbnQucGF0aC5zbGljZSgwKSk7XHJcbiAgICBjb25zdCBldmVudFBhdGhJbmZvID0gdGhpcy5nZXRQYXRoSW5mbyhldmVudFBhdGhzLmpvaW4oJy8nKSk7XHJcbiAgICBpZiAoIWV4cHJlc3Npb25QYXRoSW5mbyB8fCAhZXZlbnRQYXRoSW5mbykge1xyXG4gICAgICBjb25zb2xlLndhcm4oYOihqOi+vuW8j+i3r+W+hOaIluS6i+S7tui3r+W+hOmUmeivr++8jOiOt+WPlui3r+W+hOS/oeaBr+Wksei0peOAgmApO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGV4cHJlc3Npb25UYWJsZVBhdGhzID0gZXhwcmVzc2lvblBhdGhJbmZvLnBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgIGNvbnN0IGV4cHJlc3Npb25Qcm9wZXJ0eU5hbWVzID0gZXhwcmVzc2lvblBhdGhJbmZvLnByb3BlcnR5TmFtZS5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgY29uc3QgZXZlbnRUYWJsZVBhdGhzID0gZXZlbnRQYXRoSW5mby5wYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICBjb25zdCBldmVudFByb3BlcnR5TmFtZXMgPSBldmVudFBhdGhJbmZvLnByb3BlcnR5TmFtZS5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgY29uc3QgcmVzdWx0ID0ge1xyXG4gICAgICBkaXN0YW5jZTogdW5kZWZpbmVkLFxyXG4gICAgICBldmVudEZyb21DaGlsZHJlbjogdW5kZWZpbmVkLFxyXG4gICAgICBldmVudEZyb21QYXJlbnQ6IHVuZGVmaW5lZCxcclxuICAgICAgZXhwcmVzc2lvblRhYmxlUGF0aHMsXHJcbiAgICAgIGV4cHJlc3Npb25Qcm9wZXJ0eU5hbWVzLFxyXG4gICAgICBldmVudFRhYmxlUGF0aHMsXHJcbiAgICAgIGV2ZW50UHJvcGVydHlOYW1lcyxcclxuICAgICAgaXNTYW1lVGFibGU6IGZhbHNlXHJcbiAgICB9O1xyXG4gICAgcmVzdWx0LmRpc3RhbmNlID0gTWF0aC5hYnMoZXhwcmVzc2lvblRhYmxlUGF0aHMubGVuZ3RoIC0gZXZlbnRUYWJsZVBhdGhzLmxlbmd0aCk7XHJcbiAgICBpZiAocmVzdWx0LmRpc3RhbmNlID09PSAxKSB7XHJcbiAgICAgIHJlc3VsdC5ldmVudEZyb21DaGlsZHJlbiA9IGV2ZW50VGFibGVQYXRocy5sZW5ndGggPiBleHByZXNzaW9uVGFibGVQYXRocy5sZW5ndGggJiYgZXZlbnRUYWJsZVBhdGhzLmpvaW4oJy8nKS5zdGFydHNXaXRoKGV4cHJlc3Npb25UYWJsZVBhdGhzLmpvaW4oJy8nKSk7XHJcbiAgICAgIHJlc3VsdC5ldmVudEZyb21QYXJlbnQgPSBldmVudFRhYmxlUGF0aHMubGVuZ3RoIDwgZXhwcmVzc2lvblRhYmxlUGF0aHMubGVuZ3RoICYmIGV4cHJlc3Npb25UYWJsZVBhdGhzLmpvaW4oJy8nKS5zdGFydHNXaXRoKGV2ZW50VGFibGVQYXRocy5qb2luKCcvJykpO1xyXG4gICAgfVxyXG4gICAgcmVzdWx0LmlzU2FtZVRhYmxlID0gZXhwcmVzc2lvblRhYmxlUGF0aHMuam9pbignLycpID09PSBldmVudFRhYmxlUGF0aHMuam9pbignLycpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBidWlsZEN1cnJlbnRSb3dzKHRhYmxlUGF0aHM6IHN0cmluZ1tdLCBmdWxsUGF0aHM6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCBjdXJyZW50Um93cyA9IG5ldyBBcnJheTxFeHByZXNzaW9uLklDdXJyZW50Um93PigpO1xyXG4gICAgaWYgKCF0YWJsZVBhdGhzIHx8IHRhYmxlUGF0aHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICBjdXJyZW50Um93cy5wdXNoKHtcclxuICAgICAgICBiaW5kaW5nUGF0aDogJy8nLFxyXG4gICAgICAgIHByaW1hcnlWYWx1ZTogZnVsbFBhdGhzWzBdXHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgcGF0aHMgPSBbXTtcclxuICAgICAgdGFibGVQYXRocy5mb3JFYWNoKChwYXRoOiBzdHJpbmcsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICAgIGN1cnJlbnRSb3dzLnB1c2goe1xyXG4gICAgICAgICAgICBiaW5kaW5nUGF0aDogJy8nLFxyXG4gICAgICAgICAgICBwcmltYXJ5VmFsdWU6IGZ1bGxQYXRoc1swXVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhdGhzLnB1c2gocGF0aCk7XHJcbiAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gZnVsbFBhdGhzW2luZGV4ICogMiArIDJdO1xyXG4gICAgICAgIGN1cnJlbnRSb3dzLnB1c2goe1xyXG4gICAgICAgICAgYmluZGluZ1BhdGg6IHBhdGhzLmpvaW4oJy8nKSxcclxuICAgICAgICAgIHByaW1hcnlWYWx1ZTogcHJpbWFyeVZhbHVlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGN1cnJlbnRSb3dzO1xyXG4gIH1cclxuICBwcm90ZWN0ZWQgY29udmVydEJvb2xlYW5UeXBlRXhwcmVzc2lvblJlc3VsdChleHByZXNzaW9uT2JqZWN0OiBFeHByZXNzaW9uLkV4cHJlc3Npb25PYmplY3QsIHJlc3VsdDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5pc0Jvb2xlYW5UeXBlRXhwcmVzc2lvbihleHByZXNzaW9uT2JqZWN0KSkge1xyXG4gICAgICByZXR1cm4gcmVzdWx0ID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICB9XHJcbiAgcHJvdGVjdGVkIGlzQm9vbGVhblR5cGVFeHByZXNzaW9uKGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaXNSZWFkb25seUV4cHJlc3Npb24oZXhwcmVzc2lvbk9iamVjdCkgfHwgdGhpcy5pc1Zpc2libGVFeHByZXNzaW9uKGV4cHJlc3Npb25PYmplY3QpIHx8IHRoaXMuaXNWYWxpZGF0ZUV4cHJlc3Npb24oZXhwcmVzc2lvbk9iamVjdCkgfHwgdGhpcy5pc1JlcXVpcmVkRXhwcmVzc2lvbihleHByZXNzaW9uT2JqZWN0KSB8fCB0aGlzLmlzRGVwZW5kZW5jeUV4cHJlc3Npb24oZXhwcmVzc2lvbk9iamVjdCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgaXNSZWFkb25seUV4cHJlc3Npb24oZXhwcmVzc2lvbk9iamVjdDogRXhwcmVzc2lvbi5FeHByZXNzaW9uT2JqZWN0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gZXhwcmVzc2lvbk9iamVjdCAmJiBleHByZXNzaW9uT2JqZWN0LnR5cGUgPT09IEV4cHJlc3Npb24uRXhwcmVzc2lvblR5cGUuUmVhZG9ubHkgfHwgZmFsc2U7XHJcbiAgfVxyXG4gIHByaXZhdGUgaXNWaXNpYmxlRXhwcmVzc2lvbihleHByZXNzaW9uT2JqZWN0OiBFeHByZXNzaW9uLkV4cHJlc3Npb25PYmplY3QpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBleHByZXNzaW9uT2JqZWN0ICYmIGV4cHJlc3Npb25PYmplY3QudHlwZSA9PT0gRXhwcmVzc2lvbi5FeHByZXNzaW9uVHlwZS5WaXNpYmxlO1xyXG4gIH1cclxuICBwcml2YXRlIGlzVmFsaWRhdGVFeHByZXNzaW9uKGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGV4cHJlc3Npb25PYmplY3QgJiYgZXhwcmVzc2lvbk9iamVjdC50eXBlID09PSBFeHByZXNzaW9uLkV4cHJlc3Npb25UeXBlLlZhbGlkYXRlO1xyXG4gIH1cclxuICBwcml2YXRlIGlzUmVxdWlyZWRFeHByZXNzaW9uKGV4cHJlc3Npb25PYmplY3Q6IEV4cHJlc3Npb24uRXhwcmVzc2lvbk9iamVjdCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGV4cHJlc3Npb25PYmplY3QgJiYgZXhwcmVzc2lvbk9iamVjdC50eXBlID09PSBFeHByZXNzaW9uLkV4cHJlc3Npb25UeXBlLlJlcXVpcmVkO1xyXG4gIH1cclxuICBwcml2YXRlIGlzRGVwZW5kZW5jeUV4cHJlc3Npb24oZXhwcmVzc2lvbk9iamVjdDogRXhwcmVzc2lvbi5FeHByZXNzaW9uT2JqZWN0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gZXhwcmVzc2lvbk9iamVjdCAmJiBleHByZXNzaW9uT2JqZWN0LnR5cGUgPT09IEV4cHJlc3Npb24uRXhwcmVzc2lvblR5cGUuRGVwZW5kZW5jeTtcclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcbn0iXX0=
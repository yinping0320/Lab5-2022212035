import { DataTypeInfo, DataPropGroup } from '../../core/index';
import { DataPathNodeType } from './data_path_node';
import { DataPath } from './data_path';
/**
 * 数据Path工厂类
 */
var DataPathCreator = /** @class */ (function () {
    function DataPathCreator() {
    }
    /**
     * 将长路径数组或字符串转换为
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     */
    DataPathCreator.createByLongPathFromRoot = function (fullPathArrayOrString, entityManager) {
        var dataPath = new DataPath();
        var fullPathArray = fullPathArrayOrString;
        if (!fullPathArray || fullPathArray.length === 0) {
            return dataPath;
        }
        var currentNodeInfo = {
            nodeValue: fullPathArray.shift(),
            nodeType: DataPathNodeType.DataId,
            entityTypeInfo: new DataTypeInfo(entityManager.entityType)
        };
        while (currentNodeInfo) {
            dataPath.push(currentNodeInfo.nodeType, currentNodeInfo.nodeValue);
            // 处理下一个节点
            var nextNodeValue = fullPathArray.shift();
            if (!nextNodeValue || !currentNodeInfo.entityTypeInfo) {
                break;
            }
            currentNodeInfo = this.getNextPathNodeInfo(currentNodeInfo, nextNodeValue);
        }
        return dataPath;
    };
    /**
     * 获取下一个路径节点的信息
     * @param parentNodeInfo 当前路径节点信息
     * @param nextNodeValue 下一个路径节点的值
     * @summary
     * 1、这个递归写的很绕，说明数据结构设计不合理；
     * 2、多个因素混用了一个结构；
     */
    DataPathCreator.getNextPathNodeInfo = function (parentNodeInfo, nextNodeValue) {
        var parentNodeValue = parentNodeInfo.nodeValue;
        var parentNodeType = parentNodeInfo.nodeType;
        var parentEntityTypeInfo = parentNodeInfo.entityTypeInfo;
        if (!nextNodeValue || !parentEntityTypeInfo) {
            return null;
        }
        var nextPathNodeInfo = {
            nodeValue: nextNodeValue,
            nodeType: null,
            entityTypeInfo: null
        };
        // DataNodeType=List：下一节点肯定是Object，并且EntityTypeInfo不变
        if (parentNodeType === DataPathNodeType.DataId) {
            nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
            nextPathNodeInfo.entityTypeInfo = parentEntityTypeInfo;
        }
        else {
            // DataNodeType=Object：必然对应一个属性信息
            var nextPropInfo = parentEntityTypeInfo.getPropInfoByName(parentNodeValue);
            if (nextPropInfo.group === DataPropGroup.List) {
                // EntityPropGroup=EntityList：下一个节点是List类型。
                nextPathNodeInfo.nodeType = DataPathNodeType.DataId;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.typeInfo;
            }
            else {
                // EntityPropGroup=Entity：       下级entityTypeInfo为
                // EntityPropGroup=Dynamic|Plain：null
                nextPathNodeInfo.nodeType = DataPathNodeType.PropName;
                nextPathNodeInfo.entityTypeInfo = nextPropInfo.group === DataPropGroup.Object ? nextPropInfo.typeInfo : null;
            }
        }
        return nextPathNodeInfo;
    };
    /**
     * @param fullPathArrayOrString 路径数组或字符串
     * @param repository 实体仓库
     * @summary
     * 1、长路径格式说明参考：data-path.md
     * 2、shortPathArrayOrString暂时只支持字符串数组
     */
    DataPathCreator.createByShortPathFromRoot = function (shortPathArrayOrString, entityManager, bindingData) {
        var dataPath = new DataPath();
        var shortPathArray = shortPathArrayOrString;
        // 根节点
        var currentBindingObject = bindingData.list.currentItem;
        var currentEntityTypeInfo = new DataTypeInfo(entityManager.entityType);
        dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
        // 遍历下级节点
        shortPathArray.forEach(function (propName) {
            var propInfo = currentEntityTypeInfo.getPropInfoByName(propName);
            switch (propInfo.group) {
                case DataPropGroup.Plain:
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.Object:
                    currentBindingObject = currentBindingObject[propName];
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    break;
                case DataPropGroup.List:
                    var currentBindingList = currentBindingObject[propName];
                    currentBindingObject = currentBindingList.currentItem;
                    currentEntityTypeInfo = propInfo.typeInfo;
                    dataPath.push(DataPathNodeType.PropName, propName);
                    dataPath.push(DataPathNodeType.DataId, currentBindingObject.primaryKeyValue);
                    break;
                default:
                    break;
            }
        });
        return dataPath;
    };
    return DataPathCreator;
}());
export { DataPathCreator };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9wYXRoX2NyZWF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL2RhdGEtcGF0aC9kYXRhX3BhdGhfY3JlYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLGFBQWEsRUFBRyxNQUFNLGtCQUFrQixDQUFDO0FBSWhFLE9BQU8sRUFBZ0IsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDOztHQUVHO0FBQ0g7SUFBQTtJQXFJQSxDQUFDO0lBbklDOzs7Ozs7T0FNRztJQUNXLHdDQUF3QixHQUF0QyxVQUF1QyxxQkFBd0MsRUFBRSxhQUFvQztRQUNuSCxJQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQ2hDLElBQU0sYUFBYSxHQUFHLHFCQUFpQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxhQUFhLElBQUksYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDaEQsT0FBTyxRQUFRLENBQUM7U0FDakI7UUFFRCxJQUFJLGVBQWUsR0FBRztZQUNwQixTQUFTLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRTtZQUNoQyxRQUFRLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtZQUNqQyxjQUFjLEVBQUUsSUFBSSxZQUFZLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQztTQUMzRCxDQUFDO1FBQ0YsT0FBTyxlQUFlLEVBQUU7WUFDdEIsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVuRSxVQUFVO1lBQ1YsSUFBTSxhQUFhLEdBQUcsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzVDLElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxFQUFFO2dCQUNyRCxN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LFFBQVEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUVuRCxNQUFNO2dCQUNSLEtBQUssYUFBYSxDQUFDLElBQUk7b0JBQ3JCLElBQU0sa0JBQWtCLEdBQUcsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQzFELG9CQUFvQixHQUFHLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztvQkFDdEQscUJBQXFCLEdBQUcsUUFBUSxDQUFDLFFBQVEsQ0FBQztvQkFFMUMsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQ25ELFFBQVEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUFDO29CQUM3RSxNQUFNO2dCQUNSO29CQUNJLE1BQU07YUFDWDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVILHNCQUFDO0FBQUQsQ0FBQyxBQXJJRCxJQXFJQztBQUVELE9BQU8sRUFBRSxlQUFlLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBEYXRhVHlwZUluZm8sIERhdGFQcm9wR3JvdXAgIH0gZnJvbSAnLi4vLi4vY29yZS9pbmRleCc7XHJcbmltcG9ydCB7IEVudGl0eSAgfSBmcm9tICcuLi8uLi9lbnRpdHkvaW5kZXgnO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBFbnRpdHlNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vcmVwb3NpdG9yeS9pbmRleCc7XHJcbmltcG9ydCB7IEJpbmRpbmdEYXRhIH0gZnJvbSAnLi4vLi4vYmluZGluZy1kYXRhL2luZGV4JztcclxuaW1wb3J0IHsgRGF0YVBhdGhOb2RlLCBEYXRhUGF0aE5vZGVUeXBlIH0gZnJvbSAnLi9kYXRhX3BhdGhfbm9kZSc7XHJcbmltcG9ydCB7IERhdGFQYXRoIH0gZnJvbSAnLi9kYXRhX3BhdGgnO1xyXG5cclxuLyoqXHJcbiAqIOaVsOaNrlBhdGjlt6XljoLnsbtcclxuICovXHJcbmNsYXNzIERhdGFQYXRoQ3JlYXRvciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhumVv+i3r+W+hOaVsOe7hOaIluWtl+espuS4sui9rOaNouS4ulxyXG4gICAqIEBwYXJhbSBmdWxsUGF0aEFycmF5T3JTdHJpbmcg6Lev5b6E5pWw57uE5oiW5a2X56ym5LiyXHJcbiAgICogQHBhcmFtIHJlcG9zaXRvcnkg5a6e5L2T5LuT5bqTXHJcbiAgICogQHN1bW1hcnlcclxuICAgKiAx44CB6ZW/6Lev5b6E5qC85byP6K+05piO5Y+C6ICD77yaZGF0YS1wYXRoLm1kXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVCeUxvbmdQYXRoRnJvbVJvb3QoZnVsbFBhdGhBcnJheU9yU3RyaW5nOiBzdHJpbmdbXSB8IHN0cmluZywgZW50aXR5TWFuYWdlcjogRW50aXR5TWFuYWdlcjxFbnRpdHk+KTogRGF0YVBhdGgge1xyXG4gICAgY29uc3QgZGF0YVBhdGggPSBuZXcgRGF0YVBhdGgoKTtcclxuICAgIGNvbnN0IGZ1bGxQYXRoQXJyYXkgPSBmdWxsUGF0aEFycmF5T3JTdHJpbmcgYXMgc3RyaW5nW107XHJcbiAgICBpZiAoIWZ1bGxQYXRoQXJyYXkgfHwgZnVsbFBhdGhBcnJheS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGRhdGFQYXRoO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBjdXJyZW50Tm9kZUluZm8gPSB7XHJcbiAgICAgIG5vZGVWYWx1ZTogZnVsbFBhdGhBcnJheS5zaGlmdCgpLFxyXG4gICAgICBub2RlVHlwZTogRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQsXHJcbiAgICAgIGVudGl0eVR5cGVJbmZvOiBuZXcgRGF0YVR5cGVJbmZvKGVudGl0eU1hbmFnZXIuZW50aXR5VHlwZSlcclxuICAgIH07XHJcbiAgICB3aGlsZSAoY3VycmVudE5vZGVJbmZvKSB7XHJcbiAgICAgIGRhdGFQYXRoLnB1c2goY3VycmVudE5vZGVJbmZvLm5vZGVUeXBlLCBjdXJyZW50Tm9kZUluZm8ubm9kZVZhbHVlKTtcclxuXHJcbiAgICAgIC8vIOWkhOeQhuS4i+S4gOS4quiKgueCuVxyXG4gICAgICBjb25zdCBuZXh0Tm9kZVZhbHVlID0gZnVsbFBhdGhBcnJheS5zaGlmdCgpO1xyXG4gICAgICBpZiAoIW5leHROb2RlVmFsdWUgfHwgIWN1cnJlbnROb2RlSW5mby5lbnRpdHlUeXBlSW5mbykge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGN1cnJlbnROb2RlSW5mbyA9IHRoaXMuZ2V0TmV4dFBhdGhOb2RlSW5mbyhjdXJyZW50Tm9kZUluZm8sIG5leHROb2RlVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRhUGF0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluS4i+S4gOS4qui3r+W+hOiKgueCueeahOS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXJlbnROb2RlSW5mbyDlvZPliY3ot6/lvoToioLngrnkv6Hmga9cclxuICAgKiBAcGFyYW0gbmV4dE5vZGVWYWx1ZSDkuIvkuIDkuKrot6/lvoToioLngrnnmoTlgLxcclxuICAgKiBAc3VtbWFyeVxyXG4gICAqIDHjgIHov5nkuKrpgJLlvZLlhpnnmoTlvojnu5XvvIzor7TmmI7mlbDmja7nu5PmnoTorr7orqHkuI3lkIjnkIbvvJtcclxuICAgKiAy44CB5aSa5Liq5Zug57Sg5re355So5LqG5LiA5Liq57uT5p6E77ybXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0TmV4dFBhdGhOb2RlSW5mbyhwYXJlbnROb2RlSW5mbzogYW55LCBuZXh0Tm9kZVZhbHVlOiBzdHJpbmcpOiBhbnkge1xyXG5cclxuICAgIGNvbnN0IHBhcmVudE5vZGVWYWx1ZSA9IHBhcmVudE5vZGVJbmZvLm5vZGVWYWx1ZTtcclxuICAgIGNvbnN0IHBhcmVudE5vZGVUeXBlID0gcGFyZW50Tm9kZUluZm8ubm9kZVR5cGU7XHJcbiAgICBjb25zdCBwYXJlbnRFbnRpdHlUeXBlSW5mbyA9IHBhcmVudE5vZGVJbmZvLmVudGl0eVR5cGVJbmZvO1xyXG5cclxuICAgIGlmICghbmV4dE5vZGVWYWx1ZSB8fCAhcGFyZW50RW50aXR5VHlwZUluZm8pIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmV4dFBhdGhOb2RlSW5mbyA9IHtcclxuICAgICAgbm9kZVZhbHVlOiBuZXh0Tm9kZVZhbHVlLFxyXG4gICAgICBub2RlVHlwZTogbnVsbCxcclxuICAgICAgZW50aXR5VHlwZUluZm86IG51bGxcclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vIERhdGFOb2RlVHlwZT1MaXN077ya5LiL5LiA6IqC54K56IKv5a6a5pivT2JqZWN077yM5bm25LiURW50aXR5VHlwZUluZm/kuI3lj5hcclxuICAgIGlmIChwYXJlbnROb2RlVHlwZSA9PT0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQpIHtcclxuICAgICAgbmV4dFBhdGhOb2RlSW5mby5ub2RlVHlwZSA9IERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWU7XHJcbiAgICAgIG5leHRQYXRoTm9kZUluZm8uZW50aXR5VHlwZUluZm8gPSBwYXJlbnRFbnRpdHlUeXBlSW5mbztcclxuICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAvLyBEYXRhTm9kZVR5cGU9T2JqZWN077ya5b+F54S25a+55bqU5LiA5Liq5bGe5oCn5L+h5oGvXHJcbiAgICAgIGNvbnN0IG5leHRQcm9wSW5mbyA9IHBhcmVudEVudGl0eVR5cGVJbmZvLmdldFByb3BJbmZvQnlOYW1lKHBhcmVudE5vZGVWYWx1ZSk7XHJcbiAgICAgIGlmIChuZXh0UHJvcEluZm8uZ3JvdXAgPT09IERhdGFQcm9wR3JvdXAuTGlzdCkge1xyXG5cclxuICAgICAgICAvLyBFbnRpdHlQcm9wR3JvdXA9RW50aXR5TGlzdO+8muS4i+S4gOS4quiKgueCueaYr0xpc3TnsbvlnovjgIJcclxuICAgICAgICBuZXh0UGF0aE5vZGVJbmZvLm5vZGVUeXBlID0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQ7XHJcbiAgICAgICAgbmV4dFBhdGhOb2RlSW5mby5lbnRpdHlUeXBlSW5mbyA9IG5leHRQcm9wSW5mby50eXBlSW5mbztcclxuICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgLy8gRW50aXR5UHJvcEdyb3VwPUVudGl0ee+8miAgICAgICDkuIvnuqdlbnRpdHlUeXBlSW5mb+S4ulxyXG4gICAgICAgIC8vIEVudGl0eVByb3BHcm91cD1EeW5hbWljfFBsYWlu77yabnVsbFxyXG4gICAgICAgIG5leHRQYXRoTm9kZUluZm8ubm9kZVR5cGUgPSBEYXRhUGF0aE5vZGVUeXBlLlByb3BOYW1lO1xyXG4gICAgICAgIG5leHRQYXRoTm9kZUluZm8uZW50aXR5VHlwZUluZm8gPSBuZXh0UHJvcEluZm8uZ3JvdXAgPT09IERhdGFQcm9wR3JvdXAuT2JqZWN0ID8gbmV4dFByb3BJbmZvLnR5cGVJbmZvIDogbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXh0UGF0aE5vZGVJbmZvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGZ1bGxQYXRoQXJyYXlPclN0cmluZyDot6/lvoTmlbDnu4TmiJblrZfnrKbkuLJcclxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSDlrp7kvZPku5PlupNcclxuICAgKiBAc3VtbWFyeVxyXG4gICAqIDHjgIHplb/ot6/lvoTmoLzlvI/or7TmmI7lj4LogIPvvJpkYXRhLXBhdGgubWRcclxuICAgKiAy44CBc2hvcnRQYXRoQXJyYXlPclN0cmluZ+aaguaXtuWPquaUr+aMgeWtl+espuS4suaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQnlTaG9ydFBhdGhGcm9tUm9vdChcclxuICAgIHNob3J0UGF0aEFycmF5T3JTdHJpbmc6IHN0cmluZ1tdIHwgc3RyaW5nLCBlbnRpdHlNYW5hZ2VyOiBFbnRpdHlNYW5hZ2VyPEVudGl0eT4sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YVxyXG4gICk6IERhdGFQYXRoIHtcclxuXHJcbiAgICBjb25zdCBkYXRhUGF0aCA9IG5ldyBEYXRhUGF0aCgpO1xyXG4gICAgY29uc3Qgc2hvcnRQYXRoQXJyYXk6IHN0cmluZ1tdID0gc2hvcnRQYXRoQXJyYXlPclN0cmluZyBhcyBzdHJpbmdbXTtcclxuXHJcbiAgICAvLyDmoLnoioLngrlcclxuICAgIGxldCBjdXJyZW50QmluZGluZ09iamVjdCA9IGJpbmRpbmdEYXRhLmxpc3QuY3VycmVudEl0ZW07XHJcbiAgICBsZXQgY3VycmVudEVudGl0eVR5cGVJbmZvID0gbmV3IERhdGFUeXBlSW5mbyhlbnRpdHlNYW5hZ2VyLmVudGl0eVR5cGUpO1xyXG4gICAgZGF0YVBhdGgucHVzaChEYXRhUGF0aE5vZGVUeXBlLkRhdGFJZCwgY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlKTtcclxuXHJcbiAgICAvLyDpgY3ljobkuIvnuqfoioLngrlcclxuICAgIHNob3J0UGF0aEFycmF5LmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgcHJvcEluZm8gPSBjdXJyZW50RW50aXR5VHlwZUluZm8uZ2V0UHJvcEluZm9CeU5hbWUocHJvcE5hbWUpO1xyXG4gICAgICBzd2l0Y2ggKHByb3BJbmZvLmdyb3VwKSB7XHJcbiAgICAgICAgY2FzZSBEYXRhUHJvcEdyb3VwLlBsYWluOlxyXG4gICAgICAgICAgZGF0YVBhdGgucHVzaChEYXRhUGF0aE5vZGVUeXBlLlByb3BOYW1lLCBwcm9wTmFtZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIERhdGFQcm9wR3JvdXAuT2JqZWN0OlxyXG4gICAgICAgICAgY3VycmVudEJpbmRpbmdPYmplY3QgPSBjdXJyZW50QmluZGluZ09iamVjdFtwcm9wTmFtZV07XHJcbiAgICAgICAgICBjdXJyZW50RW50aXR5VHlwZUluZm8gPSBwcm9wSW5mby50eXBlSW5mbztcclxuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5Qcm9wTmFtZSwgcHJvcE5hbWUpO1xyXG5cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRGF0YVByb3BHcm91cC5MaXN0OlxyXG4gICAgICAgICAgY29uc3QgY3VycmVudEJpbmRpbmdMaXN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xyXG4gICAgICAgICAgY3VycmVudEJpbmRpbmdPYmplY3QgPSBjdXJyZW50QmluZGluZ0xpc3QuY3VycmVudEl0ZW07XHJcbiAgICAgICAgICBjdXJyZW50RW50aXR5VHlwZUluZm8gPSBwcm9wSW5mby50eXBlSW5mbztcclxuXHJcbiAgICAgICAgICBkYXRhUGF0aC5wdXNoKERhdGFQYXRoTm9kZVR5cGUuUHJvcE5hbWUsIHByb3BOYW1lKTtcclxuICAgICAgICAgIGRhdGFQYXRoLnB1c2goRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQsIGN1cnJlbnRCaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGRhdGFQYXRoO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IERhdGFQYXRoQ3JlYXRvciB9O1xyXG4iXX0=
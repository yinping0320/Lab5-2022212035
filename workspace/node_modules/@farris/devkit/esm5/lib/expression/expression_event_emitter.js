import * as tslib_1 from "tslib";
import { Injectable } from "@angular/core";
import { BehaviorSubject } from "rxjs";
import { Listeners } from "../listener/index";
/**
 * 事件监听器主要有以下几种类型的事件：
 * 1、值变化
 * 2、行切换
 *    行切换使用场景为需要为数据计算依赖当前行时
 * 3、数据加载
 */
var ExpressionEventEmitter = /** @class */ (function () {
    function ExpressionEventEmitter(listeners) {
        var _this = this;
        this.listeners = listeners;
        this.events = new Array();
        this.listeners.onEvent.subscribe(function (eventArgs) {
            if (_this.onEvent && _this.onEvent.observers.length > 0) {
                var events = [];
                if (_this.events.length > 0) {
                    events = tslib_1.__spread(_this.events);
                }
                events.push(eventArgs);
                _this.onEvent.next(events);
                _this.events = [];
            }
            else {
                _this.events.push(eventArgs);
            }
        });
    }
    ExpressionEventEmitter.prototype.attach = function () {
        if (!this.onEvent) {
            this.onEvent = new BehaviorSubject(this.events);
        }
        return this.onEvent.asObservable();
    };
    ExpressionEventEmitter.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ExpressionEventEmitter.ctorParameters = function () { return [
        { type: Listeners }
    ]; };
    return ExpressionEventEmitter;
}());
export { ExpressionEventEmitter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbl9ldmVudF9lbWl0dGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZXhwcmVzc2lvbi9leHByZXNzaW9uX2V2ZW50X2VtaXR0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFOUM7Ozs7OztHQU1HO0FBQ0g7SUFJRSxnQ0FBb0IsU0FBb0I7UUFBeEMsaUJBZUM7UUFmbUIsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUN0QyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksS0FBSyxFQUF3QixDQUFDO1FBQ2hELElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFDLFNBQStCO1lBQy9ELElBQUksS0FBSSxDQUFDLE9BQU8sSUFBSSxLQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNyRCxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7Z0JBQ2hCLElBQUksS0FBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUMxQixNQUFNLG9CQUFPLEtBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDM0I7Z0JBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDdkIsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzFCLEtBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO2FBQ2xCO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQzdCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ00sdUNBQU0sR0FBYjtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxlQUFlLENBQThCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM5RTtRQUNELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNyQyxDQUFDOztnQkF6QkYsVUFBVTs7OztnQkFURixTQUFTOztJQW1DbEIsNkJBQUM7Q0FBQSxBQTFCRCxJQTBCQztTQXpCWSxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgTGlzdGVuZXJzIH0gZnJvbSBcIi4uL2xpc3RlbmVyL2luZGV4XCI7XHJcbmltcG9ydCB7IEV4cHJlc3Npb24gfSBmcm9tIFwiLi90eXBlc1wiO1xyXG4vKipcclxuICog5LqL5Lu255uR5ZCs5Zmo5Li76KaB5pyJ5Lul5LiL5Yeg56eN57G75Z6L55qE5LqL5Lu277yaXHJcbiAqIDHjgIHlgLzlj5jljJZcclxuICogMuOAgeihjOWIh+aNolxyXG4gKiAgICDooYzliIfmjaLkvb/nlKjlnLrmma/kuLrpnIDopoHkuLrmlbDmja7orqHnrpfkvp3otZblvZPliY3ooYzml7ZcclxuICogM+OAgeaVsOaNruWKoOi9vVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRXhwcmVzc2lvbkV2ZW50RW1pdHRlciB7XHJcbiAgcHJpdmF0ZSBvbkV2ZW50OiBCZWhhdmlvclN1YmplY3Q8QXJyYXk8RXhwcmVzc2lvbi5FdmVudEFyZ3M+PjtcclxuICBwcml2YXRlIGV2ZW50czogQXJyYXk8RXhwcmVzc2lvbi5FdmVudEFyZ3M+O1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbGlzdGVuZXJzOiBMaXN0ZW5lcnMpIHtcclxuICAgIHRoaXMuZXZlbnRzID0gbmV3IEFycmF5PEV4cHJlc3Npb24uRXZlbnRBcmdzPigpO1xyXG4gICAgdGhpcy5saXN0ZW5lcnMub25FdmVudC5zdWJzY3JpYmUoKGV2ZW50QXJnczogRXhwcmVzc2lvbi5FdmVudEFyZ3MpID0+IHtcclxuICAgICAgaWYgKHRoaXMub25FdmVudCAmJiB0aGlzLm9uRXZlbnQub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBsZXQgZXZlbnRzID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGV2ZW50cyA9IFsuLi50aGlzLmV2ZW50c107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV2ZW50cy5wdXNoKGV2ZW50QXJncyk7XHJcbiAgICAgICAgdGhpcy5vbkV2ZW50Lm5leHQoZXZlbnRzKTtcclxuICAgICAgICB0aGlzLmV2ZW50cyA9IFtdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZXZlbnRzLnB1c2goZXZlbnRBcmdzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHB1YmxpYyBhdHRhY2goKTogT2JzZXJ2YWJsZTxBcnJheTxFeHByZXNzaW9uLkV2ZW50QXJncz4+IHtcclxuICAgIGlmICghdGhpcy5vbkV2ZW50KSB7XHJcbiAgICAgIHRoaXMub25FdmVudCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QXJyYXk8RXhwcmVzc2lvbi5FdmVudEFyZ3M+Pih0aGlzLmV2ZW50cyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5vbkV2ZW50LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxufSJdfQ==
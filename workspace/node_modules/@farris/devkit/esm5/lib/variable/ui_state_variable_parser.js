/**
 * session变量解析
 * @author Witt <jiwt@inspur.com>
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { ParseUtil } from './parse_util';
import { escape } from '../core/escape';
/**
 * 数据变量解析
 */
var UIStateVariableParser = /** @class */ (function () {
    function UIStateVariableParser() {
    }
    /**
     * 解析变量
     * @param expression 形如：/frameId/stateName
     * @param context 上下文
     */
    UIStateVariableParser.prototype.parse = function (expression, context) {
        var _this = this;
        var appContext = ParseUtil.getAppContext(context);
        var paths = this.extractPaths(expression);
        if (paths.length === 1) {
            var value = this.getUIState(paths[0], appContext);
            // 1、单个的表达式：直接求值
            if (expression === "{UISTATE~" + paths[0] + "}") {
                return value;
            }
            else if (expression === "{:UISTATE~" + paths[0] + "}") {
                return escape(value);
            }
        }
        // 2、其他情况：字符串替换
        paths.forEach(function (path) {
            var searchValue = "{UISTATE~" + path + "}";
            var replaceValue = _this.getUIState(path, appContext);
            expression = expression.replace(searchValue, replaceValue);
            var target = "{:UISTATE~" + path + "}";
            if (expression.includes(target)) {
                var value = escape(replaceValue);
                expression = expression.replace(target, value);
            }
        });
        return expression;
    };
    /**
     * 提取路径
     * 变量格式：{}
     */
    UIStateVariableParser.prototype.extractPaths = function (expression) {
        var paths = [];
        // 查找所有的uiState变量字符串
        var UI_STATE_PATTERN_G = /\{:?UISTATE~(\S+?)\}/g;
        var uiStateVariables = expression.match(UI_STATE_PATTERN_G);
        if (uiStateVariables === null) {
            return [];
        }
        // 提取后边的路径
        var UI_STATE_PATTERN = /\{:?UISTATE~(\S+?)\}/;
        uiStateVariables.forEach(function (uiStateVariable) {
            var pathMatches = uiStateVariable.match(UI_STATE_PATTERN);
            if (pathMatches != null && pathMatches.length === 2) {
                paths.push(pathMatches[1]);
            }
        });
        return paths;
    };
    /**
     * 获取UIState
     */
    UIStateVariableParser.prototype.getUIState = function (path, appContext) {
        var parts = path.split('/').filter(function (part) {
            return part !== '';
        });
        var _a = tslib_1.__read(parts, 2), frameId = _a[0], stateName = _a[1];
        var frameContext = appContext.getFrameContext(frameId);
        var state = frameContext && frameContext.uiState[stateName];
        if (state && state.constructor.toString().startsWith('function Date()')) {
            return this.formatDate(state);
        }
        for (var i = 2; i < parts.length; i++) {
            state = state[parts[i]];
            // 复杂对象一层层查找下去，如果某一层不存在，结果可以是undefined，但是要直接返回undefined避免报错。
            if (!state) {
                return state;
            }
        }
        return state;
    };
    /**
     * @todo：待删除
     */
    UIStateVariableParser.prototype.formatDate = function (value) {
        if (!value) {
            return '';
        }
        // 年
        var year = value.getFullYear();
        // 月
        var month = (value.getMonth() + 1).toString();
        month = month.length === 1 ? ('0' + month) : month;
        // 日
        var day = value.getDate().toString();
        day = day.length === 1 ? ('0' + day) : day;
        return year + "-" + month + "-" + day;
    };
    UIStateVariableParser.decorators = [
        { type: Injectable }
    ];
    return UIStateVariableParser;
}());
export { UIStateVariableParser };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWlfc3RhdGVfdmFyaWFibGVfcGFyc2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvdmFyaWFibGUvdWlfc3RhdGVfdmFyaWFibGVfcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRzs7QUFFSCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDOztHQUVHO0FBQ0g7SUFBQTtJQTRHQSxDQUFDO0lBekdDOzs7O09BSUc7SUFDSSxxQ0FBSyxHQUFaLFVBQWEsVUFBa0IsRUFBRSxPQUFZO1FBQTdDLGlCQTZCQztRQTNCQyxJQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BELElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFNUMsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUN0QixJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUNwRCxnQkFBZ0I7WUFDaEIsSUFBSSxVQUFVLEtBQUssY0FBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQUcsRUFBRTtnQkFDMUMsT0FBTyxLQUFLLENBQUM7YUFDZDtpQkFBTSxJQUFJLFVBQVUsS0FBSyxlQUFhLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBRyxFQUFFO2dCQUNsRCxPQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN0QjtTQUNGO1FBRUQsZUFBZTtRQUNmLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBQSxJQUFJO1lBQ2hCLElBQU0sV0FBVyxHQUFHLGNB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QVcsRUFBRSxDQUFDO1FBRWpDLElBQUk7UUFDSixJQUFJLEtBQUssR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QyxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFFbkQsSUFBSTtRQUNKLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNyQyxHQUFHLEdBQUcsR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDM0MsT0FBVSxJQUFJLFNBQUksS0FBSyxTQUFJLEdBQUssQ0FBQztJQUNuQyxDQUFDOztnQkEzR0YsVUFBVTs7SUE0R1gsNEJBQUM7Q0FBQSxBQTVHRCxJQTRHQztBQUVELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIHNlc3Npb27lj5jph4/op6PmnpBcclxuICogQGF1dGhvciBXaXR0IDxqaXd0QGluc3B1ci5jb20+XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBWYXJpYWJsZVBhcnNlciB9IGZyb20gJy4vdmFyaWFibGVfcGFyc2VyJztcclxuaW1wb3J0IHsgQXBwQ29udGV4dCB9IGZyb20gJy4uL2FwcC9pbmRleCc7XHJcbmltcG9ydCB7IFBhcnNlVXRpbCB9IGZyb20gJy4vcGFyc2VfdXRpbCc7XHJcbmltcG9ydCB7IGVzY2FwZSB9IGZyb20gJy4uL2NvcmUvZXNjYXBlJztcclxuLyoqXHJcbiAqIOaVsOaNruWPmOmHj+ino+aekFxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBVSVN0YXRlVmFyaWFibGVQYXJzZXIgaW1wbGVtZW50cyBWYXJpYWJsZVBhcnNlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOino+aekOWPmOmHj1xyXG4gICAqIEBwYXJhbSBleHByZXNzaW9uIOW9ouWmgu+8mi9mcmFtZUlkL3N0YXRlTmFtZVxyXG4gICAqIEBwYXJhbSBjb250ZXh0IOS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHB1YmxpYyBwYXJzZShleHByZXNzaW9uOiBzdHJpbmcsIGNvbnRleHQ6IGFueSk6IGFueSB7XHJcblxyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IFBhcnNlVXRpbC5nZXRBcHBDb250ZXh0KGNvbnRleHQpO1xyXG4gICAgY29uc3QgcGF0aHMgPSB0aGlzLmV4dHJhY3RQYXRocyhleHByZXNzaW9uKTtcclxuXHJcbiAgICBpZiAocGF0aHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRVSVN0YXRlKHBhdGhzWzBdLCBhcHBDb250ZXh0KTtcclxuICAgICAgLy8gMeOAgeWNleS4queahOihqOi+vuW8j++8muebtOaOpeaxguWAvFxyXG4gICAgICBpZiAoZXhwcmVzc2lvbiA9PT0gYHtVSVNUQVRFfiR7cGF0aHNbMF19fWApIHtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXhwcmVzc2lvbiA9PT0gYHs6VUlTVEFURX4ke3BhdGhzWzBdfX1gKSB7XHJcbiAgICAgICAgcmV0dXJuIGVzY2FwZSh2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAy44CB5YW25LuW5oOF5Ya177ya5a2X56ym5Liy5pu/5o2iXHJcbiAgICBwYXRocy5mb3JFYWNoKHBhdGggPT4ge1xyXG4gICAgICBjb25zdCBzZWFyY2hWYWx1ZSA9IGB7VUlTVEFURX4ke3BhdGh9fWA7XHJcbiAgICAgIGNvbnN0IHJlcGxhY2VWYWx1ZSA9IHRoaXMuZ2V0VUlTdGF0ZShwYXRoLCBhcHBDb250ZXh0KTtcclxuICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24ucmVwbGFjZShzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKTtcclxuXHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGB7OlVJU1RBVEV+JHtwYXRofX1gO1xyXG4gICAgICBpZiAoZXhwcmVzc2lvbi5pbmNsdWRlcyh0YXJnZXQpKSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBlc2NhcGUocmVwbGFjZVZhbHVlKTtcclxuICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKHRhcmdldCwgdmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZXhwcmVzc2lvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOWPlui3r+W+hFxyXG4gICAqIOWPmOmHj+agvOW8j++8mnt9XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBleHRyYWN0UGF0aHMoZXhwcmVzc2lvbjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcGF0aHM6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgLy8g5p+l5om+5omA5pyJ55qEdWlTdGF0ZeWPmOmHj+Wtl+espuS4slxyXG4gICAgY29uc3QgVUlfU1RBVEVfUEFUVEVSTl9HID0gL1xcezo/VUlTVEFURX4oXFxTKz8pXFx9L2c7XHJcbiAgICBjb25zdCB1aVN0YXRlVmFyaWFibGVzID0gZXhwcmVzc2lvbi5tYXRjaChVSV9TVEFURV9QQVRURVJOX0cpO1xyXG4gICAgaWYgKHVpU3RhdGVWYXJpYWJsZXMgPT09IG51bGwpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaPkOWPluWQjui+ueeahOi3r+W+hFxyXG4gICAgY29uc3QgVUlfU1RBVEVfUEFUVEVSTiA9IC9cXHs6P1VJU1RBVEV+KFxcUys/KVxcfS87XHJcbiAgICB1aVN0YXRlVmFyaWFibGVzLmZvckVhY2goKHVpU3RhdGVWYXJpYWJsZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdGhNYXRjaGVzID0gdWlTdGF0ZVZhcmlhYmxlLm1hdGNoKFVJX1NUQVRFX1BBVFRFUk4pO1xyXG4gICAgICBpZiAocGF0aE1hdGNoZXMgIT0gbnVsbCAmJiBwYXRoTWF0Y2hlcy5sZW5ndGggPT09IDIpIHtcclxuICAgICAgICBwYXRocy5wdXNoKHBhdGhNYXRjaGVzWzFdKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHBhdGhzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WVUlTdGF0ZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VUlTdGF0ZShwYXRoOiBzdHJpbmcsIGFwcENvbnRleHQ6IEFwcENvbnRleHQpIHtcclxuICAgIGNvbnN0IHBhcnRzID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcigocGFydDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXJ0ICE9PSAnJztcclxuICAgIH0pO1xyXG4gICAgY29uc3QgW2ZyYW1lSWQsIHN0YXRlTmFtZV0gPSBwYXJ0cztcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IGFwcENvbnRleHQuZ2V0RnJhbWVDb250ZXh0KGZyYW1lSWQpO1xyXG4gICAgbGV0IHN0YXRlID0gZnJhbWVDb250ZXh0ICYmIGZyYW1lQ29udGV4dC51aVN0YXRlW3N0YXRlTmFtZV07XHJcbiAgICBpZiAoc3RhdGUgJiYgc3RhdGUuY29uc3RydWN0b3IudG9TdHJpbmcoKS5zdGFydHNXaXRoKCdmdW5jdGlvbiBEYXRlKCknKSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXREYXRlKHN0YXRlKTtcclxuICAgIH1cclxuICAgIGZvciAobGV0IGkgPSAyOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgc3RhdGUgPSBzdGF0ZVtwYXJ0c1tpXV07XHJcbiAgICAgIC8vIOWkjeadguWvueixoeS4gOWxguWxguafpeaJvuS4i+WOu++8jOWmguaenOafkOS4gOWxguS4jeWtmOWcqO+8jOe7k+aenOWPr+S7peaYr3VuZGVmaW5lZO+8jOS9huaYr+imgeebtOaOpei/lOWbnnVuZGVmaW5lZOmBv+WFjeaKpemUmeOAglxyXG4gICAgICBpZiAoIXN0YXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RhdGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAdG9kb++8muW+heWIoOmZpFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZm9ybWF0RGF0ZSh2YWx1ZTogRGF0ZSk6IHN0cmluZyB7XHJcbiAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICAvLyDlubRcclxuICAgIGNvbnN0IHllYXIgPSB2YWx1ZS5nZXRGdWxsWWVhcigpO1xyXG5cclxuICAgIC8vIOaciFxyXG4gICAgbGV0IG1vbnRoID0gKHZhbHVlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpO1xyXG4gICAgbW9udGggPSBtb250aC5sZW5ndGggPT09IDEgPyAoJzAnICsgbW9udGgpIDogbW9udGg7XHJcblxyXG4gICAgLy8g5pelXHJcbiAgICBsZXQgZGF5ID0gdmFsdWUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICBkYXkgPSBkYXkubGVuZ3RoID09PSAxID8gKCcwJyArIGRheSkgOiBkYXk7XHJcbiAgICByZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFVJU3RhdGVWYXJpYWJsZVBhcnNlciB9O1xyXG4iXX0=
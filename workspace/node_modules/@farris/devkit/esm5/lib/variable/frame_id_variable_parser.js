/**
 * session变量解析
 * @author Witt <jiwt@inspur.com>
 */
import { Injectable } from '@angular/core';
import { ParseUtil } from './parse_util';
var VARIABLE_MATCHER = /#{\S+?}/g;
/**
 * 数据变量解析
 */
var FrameIdVariableParser = /** @class */ (function () {
    function FrameIdVariableParser() {
    }
    /**
     * 解析变量
     * @param expression 形如：/#{root-component}/stateName
     * @param context 上下文
     */
    FrameIdVariableParser.prototype.parse = function (expression, context) {
        var _this = this;
        this.context = context;
        var variables = this.extractVariables(expression);
        if (!variables || variables.length < 1) {
            return expression;
        }
        variables.forEach(function (exp) {
            var frameId = _this.getVariableValue(exp);
            expression = expression.replace(VARIABLE_MATCHER, frameId);
        });
        return expression;
    };
    /**
     * 计算表达式的值
     * @param expression like #{root-component}
     */
    FrameIdVariableParser.prototype.getVariableValue = function (expression) {
        var relativeFrameId = expression.substring(2, expression.length - 1);
        return this.getFullFrameId(relativeFrameId);
    };
    FrameIdVariableParser.prototype.extractVariables = function (expression) {
        if (!expression) {
            return [];
        }
        return expression.match(VARIABLE_MATCHER);
    };
    /**
     * 获取补全的frameId
     * @param frameId frameId
     */
    FrameIdVariableParser.prototype.getFullFrameId = function (frameId) {
        var frameContext = ParseUtil.getFrameContext(this.context);
        var namespace = frameContext.namespace || '';
        var prefix = namespace ? namespace + "_" : '';
        return "" + prefix + frameId;
    };
    FrameIdVariableParser.decorators = [
        { type: Injectable }
    ];
    return FrameIdVariableParser;
}());
export { FrameIdVariableParser };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWVfaWRfdmFyaWFibGVfcGFyc2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvdmFyaWFibGUvZnJhbWVfaWRfdmFyaWFibGVfcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUVILE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUV6QyxJQUFNLGdCQUFnQixHQUFHLFVBQVUsQ0FBQztBQUNwQzs7R0FFRztBQUNIO0lBQUE7SUE4Q0EsQ0FBQztJQTNDQzs7OztPQUlHO0lBQ0kscUNBQUssR0FBWixVQUFhLFVBQWtCLEVBQUUsT0FBWTtRQUE3QyxpQkFZQztRQVhDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVwRCxJQUFJLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3RDLE9BQU8sVUFBVSxDQUFDO1NBQ25CO1FBQ0QsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEdBQVc7WUFDNUIsSUFBTSxPQUFPLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzNDLFVBQVUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUNEOzs7T0FHRztJQUNLLGdEQUFnQixHQUF4QixVQUF5QixVQUFrQjtRQUN6QyxJQUFNLGVBQWUsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBQ08sZ0RBQWdCLEdBQXhCLFVBQXlCLFVBQWtCO1FBQ3pDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsT0FBTyxVQUFVLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVEOzs7T0FHRztJQUNLLDhDQUFjLEdBQXRCLFVBQXVCLE9BQWU7UUFDcEMsSUFBTSxZQUFZLEdBQWlCLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNFLElBQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDO1FBQy9DLElBQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUksU0FBUyxNQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNoRCxPQUFPLEtBQUcsTUFBTSxHQUFHLE9BQVMsQ0FBQztJQUMvQixDQUFDOztnQkE3Q0YsVUFBVTs7SUE4Q1gsNEJBQUM7Q0FBQSxBQTlDRCxJQThDQztBQUVELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIHNlc3Npb27lj5jph4/op6PmnpBcclxuICogQGF1dGhvciBXaXR0IDxqaXd0QGluc3B1ci5jb20+XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBWYXJpYWJsZVBhcnNlciB9IGZyb20gJy4vdmFyaWFibGVfcGFyc2VyJztcclxuaW1wb3J0IHsgQXBwQ29udGV4dCB9IGZyb20gJy4uL2FwcC9pbmRleCc7XHJcbmltcG9ydCB7IFBhcnNlVXRpbCB9IGZyb20gJy4vcGFyc2VfdXRpbCc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJy4uL2ZyYW1lJztcclxuY29uc3QgVkFSSUFCTEVfTUFUQ0hFUiA9IC8je1xcUys/fS9nO1xyXG4vKipcclxuICog5pWw5o2u5Y+Y6YeP6Kej5p6QXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEZyYW1lSWRWYXJpYWJsZVBhcnNlciBpbXBsZW1lbnRzIFZhcmlhYmxlUGFyc2VyIHtcclxuICBwdWJsaWMgY29udGV4dDogYW55O1xyXG4gIC8qKlxyXG4gICAqIOino+aekOWPmOmHj1xyXG4gICAqIEBwYXJhbSBleHByZXNzaW9uIOW9ouWmgu+8mi8je3Jvb3QtY29tcG9uZW50fS9zdGF0ZU5hbWVcclxuICAgKiBAcGFyYW0gY29udGV4dCDkuIrkuIvmlodcclxuICAgKi9cclxuICBwdWJsaWMgcGFyc2UoZXhwcmVzc2lvbjogc3RyaW5nLCBjb250ZXh0OiBhbnkpOiBhbnkge1xyXG4gICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcclxuICAgIGNvbnN0IHZhcmlhYmxlcyA9IHRoaXMuZXh0cmFjdFZhcmlhYmxlcyhleHByZXNzaW9uKTtcclxuXHJcbiAgICBpZiAoIXZhcmlhYmxlcyB8fCB2YXJpYWJsZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gZXhwcmVzc2lvbjtcclxuICAgIH1cclxuICAgIHZhcmlhYmxlcy5mb3JFYWNoKChleHA6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBmcmFtZUlkID0gdGhpcy5nZXRWYXJpYWJsZVZhbHVlKGV4cCk7XHJcbiAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLnJlcGxhY2UoVkFSSUFCTEVfTUFUQ0hFUiwgZnJhbWVJZCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBleHByZXNzaW9uO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorqHnrpfooajovr7lvI/nmoTlgLxcclxuICAgKiBAcGFyYW0gZXhwcmVzc2lvbiBsaWtlICN7cm9vdC1jb21wb25lbnR9XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRWYXJpYWJsZVZhbHVlKGV4cHJlc3Npb246IHN0cmluZykge1xyXG4gICAgY29uc3QgcmVsYXRpdmVGcmFtZUlkID0gZXhwcmVzc2lvbi5zdWJzdHJpbmcoMiwgZXhwcmVzc2lvbi5sZW5ndGggLSAxKTtcclxuICAgIHJldHVybiB0aGlzLmdldEZ1bGxGcmFtZUlkKHJlbGF0aXZlRnJhbWVJZCk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZXh0cmFjdFZhcmlhYmxlcyhleHByZXNzaW9uOiBzdHJpbmcpIHtcclxuICAgIGlmICghZXhwcmVzc2lvbikge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZXhwcmVzc2lvbi5tYXRjaChWQVJJQUJMRV9NQVRDSEVSKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluihpeWFqOeahGZyYW1lSWRcclxuICAgKiBAcGFyYW0gZnJhbWVJZCBmcmFtZUlkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRGdWxsRnJhbWVJZChmcmFtZUlkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0ID0gUGFyc2VVdGlsLmdldEZyYW1lQ29udGV4dCh0aGlzLmNvbnRleHQpO1xyXG4gICAgY29uc3QgbmFtZXNwYWNlID0gZnJhbWVDb250ZXh0Lm5hbWVzcGFjZSB8fCAnJztcclxuICAgIGNvbnN0IHByZWZpeCA9IG5hbWVzcGFjZSA/IGAke25hbWVzcGFjZX1fYCA6ICcnO1xyXG4gICAgcmV0dXJuIGAke3ByZWZpeH0ke2ZyYW1lSWR9YDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEZyYW1lSWRWYXJpYWJsZVBhcnNlciB9O1xyXG4iXX0=
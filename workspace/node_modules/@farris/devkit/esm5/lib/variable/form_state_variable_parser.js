import { ParseUtil } from './parse_util';
var FORM_STATES_EXP = /\{FORMSTATE~\/(\S+?)\}/g;
var FORM_STATE_EXP = /\{FORMSTATE~\/(\S+?)\}/;
var FormStateVariableParser = /** @class */ (function () {
    function FormStateVariableParser() {
    }
    /**
     * 解析表达式变量
     */
    FormStateVariableParser.prototype.parse = function (expression, context) {
        var _this = this;
        this.context = context;
        var variables = this.extractVariables(expression);
        if (!variables || variables.length < 1) {
            return expression;
        }
        variables.forEach(function (variableExpression) {
            var exprs = variableExpression.match(FORM_STATE_EXP);
            if (exprs && exprs.length === 2) {
                var variable = exprs[1];
                var value = _this.getVariableValue(variable);
                expression = expression.replace(FORM_STATE_EXP, value);
            }
        });
        return expression;
    };
    /**
     * 获取变量的值
     * @param variable 变量
     */
    FormStateVariableParser.prototype.getVariableValue = function (variable) {
        var frameContext = ParseUtil.getFrameContext(this.context);
        var appContext = frameContext.appContext;
        var formVariable = appContext.params.get(variable);
        return formVariable;
    };
    /**
     * 获取到表达式中所有FormState变量数组
     * @param expression 表达式
     */
    FormStateVariableParser.prototype.extractVariables = function (expression) {
        if (!expression) {
            return null;
        }
        var formStates = expression.match(FORM_STATES_EXP);
        if (!formStates || formStates.length < 1) {
            return null;
        }
        return formStates;
    };
    return FormStateVariableParser;
}());
export { FormStateVariableParser };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybV9zdGF0ZV92YXJpYWJsZV9wYXJzZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi92YXJpYWJsZS9mb3JtX3N0YXRlX3ZhcmlhYmxlX3BhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXpDLElBQU0sZUFBZSxHQUFHLHlCQUF5QixDQUFDO0FBQ2xELElBQU0sY0FBYyxHQUFHLHdCQUF3QixDQUFDO0FBRWhEO0lBQUE7SUE2Q0EsQ0FBQztJQTNDQzs7T0FFRztJQUNJLHVDQUFLLEdBQVosVUFBYSxVQUFrQixFQUFFLE9BQVk7UUFBN0MsaUJBZUM7UUFkQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN0QyxPQUFPLFVBQVUsQ0FBQztTQUNuQjtRQUNELFNBQVMsQ0FBQyxPQUFPLENBQUMsVUFBQSxrQkFBa0I7WUFDbEMsSUFBTSxLQUFLLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ3ZELElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUMvQixJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDOUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQ3hEO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ssa0RBQWdCLEdBQXhCLFVBQXlCLFFBQWdCO1FBQ3ZDLElBQU0sWUFBWSxHQUFpQixTQUFTLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMzRSxJQUFNLFVBQVUsR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDO1FBQzNDLElBQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFDRDs7O09BR0c7SUFDSyxrREFBZ0IsR0FBeEIsVUFBeUIsVUFBa0I7UUFDekMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNmLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxJQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxVQUFVLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDeEMsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFDSCw4QkFBQztBQUFELENBQUMsQUE3Q0QsSUE2Q0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICcuLi9mcmFtZSc7XHJcbmltcG9ydCB7IFBhcnNlVXRpbCB9IGZyb20gJy4vcGFyc2VfdXRpbCc7XHJcbmltcG9ydCB7IFZhcmlhYmxlUGFyc2VyIH0gZnJvbSAnLi92YXJpYWJsZV9wYXJzZXInO1xyXG5jb25zdCBGT1JNX1NUQVRFU19FWFAgPSAvXFx7Rk9STVNUQVRFflxcLyhcXFMrPylcXH0vZztcclxuY29uc3QgRk9STV9TVEFURV9FWFAgPSAvXFx7Rk9STVNUQVRFflxcLyhcXFMrPylcXH0vO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZvcm1TdGF0ZVZhcmlhYmxlUGFyc2VyIGltcGxlbWVudHMgVmFyaWFibGVQYXJzZXIge1xyXG4gIHB1YmxpYyBjb250ZXh0OiBhbnk7XHJcbiAgLyoqXHJcbiAgICog6Kej5p6Q6KGo6L6+5byP5Y+Y6YePXHJcbiAgICovXHJcbiAgcHVibGljIHBhcnNlKGV4cHJlc3Npb246IHN0cmluZywgY29udGV4dDogYW55KTogYW55IHtcclxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XHJcbiAgICBjb25zdCB2YXJpYWJsZXMgPSB0aGlzLmV4dHJhY3RWYXJpYWJsZXMoZXhwcmVzc2lvbik7XHJcbiAgICBpZiAoIXZhcmlhYmxlcyB8fCB2YXJpYWJsZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gZXhwcmVzc2lvbjtcclxuICAgIH1cclxuICAgIHZhcmlhYmxlcy5mb3JFYWNoKHZhcmlhYmxlRXhwcmVzc2lvbiA9PiB7XHJcbiAgICAgIGNvbnN0IGV4cHJzID0gdmFyaWFibGVFeHByZXNzaW9uLm1hdGNoKEZPUk1fU1RBVEVfRVhQKTtcclxuICAgICAgaWYgKGV4cHJzICYmIGV4cHJzLmxlbmd0aCA9PT0gMikge1xyXG4gICAgICAgIGNvbnN0IHZhcmlhYmxlID0gZXhwcnNbMV07XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhcmlhYmxlVmFsdWUodmFyaWFibGUpO1xyXG4gICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLnJlcGxhY2UoRk9STV9TVEFURV9FWFAsIHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZXhwcmVzc2lvbjtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Y+Y6YeP55qE5YC8XHJcbiAgICogQHBhcmFtIHZhcmlhYmxlIOWPmOmHj1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VmFyaWFibGVWYWx1ZSh2YXJpYWJsZTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCA9IFBhcnNlVXRpbC5nZXRGcmFtZUNvbnRleHQodGhpcy5jb250ZXh0KTtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSBmcmFtZUNvbnRleHQuYXBwQ29udGV4dDtcclxuICAgIGNvbnN0IGZvcm1WYXJpYWJsZSA9IGFwcENvbnRleHQucGFyYW1zLmdldCh2YXJpYWJsZSk7XHJcbiAgICByZXR1cm4gZm9ybVZhcmlhYmxlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bliLDooajovr7lvI/kuK3miYDmnIlGb3JtU3RhdGXlj5jph4/mlbDnu4RcclxuICAgKiBAcGFyYW0gZXhwcmVzc2lvbiDooajovr7lvI9cclxuICAgKi9cclxuICBwcml2YXRlIGV4dHJhY3RWYXJpYWJsZXMoZXhwcmVzc2lvbjogc3RyaW5nKTogc3RyaW5nW10gfCBudWxsIHtcclxuICAgIGlmICghZXhwcmVzc2lvbikge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGZvcm1TdGF0ZXMgPSBleHByZXNzaW9uLm1hdGNoKEZPUk1fU1RBVEVTX0VYUCk7XHJcbiAgICBpZiAoIWZvcm1TdGF0ZXMgfHwgZm9ybVN0YXRlcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZvcm1TdGF0ZXM7XHJcbiAgfVxyXG59XHJcbiJdfQ==
import { BindingPropertyType, PropertyUtil } from '../../binding-data/index';
import { BindingPathConverter } from './binding_path_converter';
/**
 * EntityPath转换器
 */
var EntityPathConverter = /** @class */ (function () {
    function EntityPathConverter() {
    }
    /**
     * 转换为Entity可识别的路径
     * 根：[]
     * 主表：['id:xxx', 'name'],
     * 关联：['id:xxx', 'deptInfo', 'id:xxx', 'name']
     * UDT: ['id:xxx', 'updateInfo', ':', 'createdOn']
     * 从表：['id:xxx', 'edus', 'id:xxx', 'name'],
     * 从从表：['id:xxx', 'edus', 'id:xxx', 'grades', 'id:xxx', 'name']
     */
    EntityPathConverter.toEntityPathArray = function (bindingPathString, bindingData) {
        var _this = this;
        var bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPathString);
        var entityPathArray = [];
        if (bindingPathArray.length === 0) {
            return entityPathArray;
        }
        // 根节点
        var currentBindingObject = bindingData.list.currentItem;
        entityPathArray.push(this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue));
        bindingPathArray.forEach(function (propName) {
            var propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);
            switch (propInfo.type) {
                case BindingPropertyType.Plain:
                    entityPathArray.push(propName);
                    break;
                case BindingPropertyType.Object:
                    currentBindingObject = currentBindingObject[propName];
                    entityPathArray.push(propName);
                    entityPathArray.push(_this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue));
                    break;
                case BindingPropertyType.List:
                    var currentBindingList = currentBindingObject[propName];
                    currentBindingObject = currentBindingList.currentItem;
                    entityPathArray.push(propName);
                    entityPathArray.push(_this.createPrimaryKeyPath(currentBindingObject.primaryKey, currentBindingObject.primaryKeyValue));
                    break;
                default:
                    break;
            }
        });
        return entityPathArray;
    };
    /**
     * 创建路径中的主键部分
     */
    EntityPathConverter.createPrimaryKeyPath = function (primaryKey, primaryKeyValue) {
        return primaryKey + ":" + primaryKeyValue;
    };
    return EntityPathConverter;
}());
export { EntityPathConverter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3BhdGhfY29udmVydGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvdXRpbHMvZGF0YS1wYXRoL2VudGl0eV9wYXRoX2NvbnZlcnRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ1EsbUJBQW1CLEVBQUUsWUFBWSxFQUMvQyxNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWhFOztHQUVHO0FBQ0g7SUFBQTtJQTZEQSxDQUFDO0lBM0RDOzs7Ozs7OztPQVFHO0lBQ1cscUNBQWlCLEdBQS9CLFVBQWdDLGlCQUF5QixFQUFFLFdBQXdCO1FBQW5GLGlCQXlDQztRQXhDQyxJQUFNLGdCQUFnQixHQUFhLG9CQUFvQixDQUFDLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDOUYsSUFBTSxlQUFlLEdBQWEsRUFBRSxDQUFDO1FBRXJDLElBQUksZ0JBQWdCLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUNqQyxPQUFPLGVBQWUsQ0FBQztTQUN4QjtRQUVELE1BQU07UUFDTixJQUFJLG9CQUFvQixHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3hELGVBQWUsQ0FBQyxJQUFJLENBQ2xCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQ2pHLENBQUM7UUFFRixnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsVUFBQyxRQUFnQjtZQUN4QyxJQUFNLFFBQVEsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzNGLFFBQVEsUUFBUSxDQUFDLElBQUksRUFBRTtnQkFDckIsS0FBSyxtQkFBbUIsQ0FBQyxLQUFLO29CQUM1QixlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMvQixNQUFNO2dCQUNSLEtBQUssbUJBQW1CLENBQUMsTUFBTTtvQkFDN0Isb0JBQW9CLEdBQUcsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQ3RELGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQy9CLGVBQWUsQ0FBQyxJQUFJLENBQ2xCLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxvQkFBb0IsQ0FBQyxVQUFVLEVBQUUsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQ2pHLENBQUM7b0JBQ0YsTUFBTTtnQkFDUixLQUFLLG1CQUFtQixDQUFDLElBQUk7b0JBQzNCLElBQU0sa0JBQWtCLEdBQUcsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQzFELG9CQUFvQixHQUFHLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztvQkFDdEQsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDL0IsZUFBZSxDQUFDLElBQUksQ0FDbEIsS0FBSSxDQUFDLG9CQUFvQixDQUFDLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsQ0FDakcsQ0FBQztvQkFDRixNQUFNO2dCQUNSO29CQUNJLE1BQU07YUFDWDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ1csd0NBQW9CLEdBQWxDLFVBQW1DLFVBQWtCLEVBQUUsZUFBdUI7UUFDNUUsT0FBVSxVQUFVLFNBQUksZUFBaUIsQ0FBQztJQUM1QyxDQUFDO0lBRUgsMEJBQUM7QUFBRCxDQUFDLEFBN0RELElBNkRDO0FBRUQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEJpbmRpbmdEYXRhLCBCaW5kaW5nUHJvcGVydHlUeXBlLCBQcm9wZXJ0eVV0aWxcclxufSBmcm9tICcuLi8uLi9iaW5kaW5nLWRhdGEvaW5kZXgnO1xyXG5pbXBvcnQgeyBCaW5kaW5nUGF0aENvbnZlcnRlciB9IGZyb20gJy4vYmluZGluZ19wYXRoX2NvbnZlcnRlcic7XHJcblxyXG4vKipcclxuICogRW50aXR5UGF0aOi9rOaNouWZqFxyXG4gKi9cclxuY2xhc3MgRW50aXR5UGF0aENvbnZlcnRlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOi9rOaNouS4ukVudGl0eeWPr+ivhuWIq+eahOi3r+W+hFxyXG4gICAqIOague+8mltdXHJcbiAgICog5Li76KGo77yaWydpZDp4eHgnLCAnbmFtZSddLFxyXG4gICAqIOWFs+iBlO+8mlsnaWQ6eHh4JywgJ2RlcHRJbmZvJywgJ2lkOnh4eCcsICduYW1lJ11cclxuICAgKiBVRFQ6IFsnaWQ6eHh4JywgJ3VwZGF0ZUluZm8nLCAnOicsICdjcmVhdGVkT24nXVxyXG4gICAqIOS7juihqO+8mlsnaWQ6eHh4JywgJ2VkdXMnLCAnaWQ6eHh4JywgJ25hbWUnXSxcclxuICAgKiDku47ku47ooajvvJpbJ2lkOnh4eCcsICdlZHVzJywgJ2lkOnh4eCcsICdncmFkZXMnLCAnaWQ6eHh4JywgJ25hbWUnXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgdG9FbnRpdHlQYXRoQXJyYXkoYmluZGluZ1BhdGhTdHJpbmc6IHN0cmluZywgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgYmluZGluZ1BhdGhBcnJheTogc3RyaW5nW10gPSBCaW5kaW5nUGF0aENvbnZlcnRlci50b0JpbmRpbmdQYXRoQXJyYXkoYmluZGluZ1BhdGhTdHJpbmcpO1xyXG4gICAgY29uc3QgZW50aXR5UGF0aEFycmF5OiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgIGlmIChiaW5kaW5nUGF0aEFycmF5Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gZW50aXR5UGF0aEFycmF5O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOagueiKgueCuVxyXG4gICAgbGV0IGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbTtcclxuICAgIGVudGl0eVBhdGhBcnJheS5wdXNoKFxyXG4gICAgICB0aGlzLmNyZWF0ZVByaW1hcnlLZXlQYXRoKGN1cnJlbnRCaW5kaW5nT2JqZWN0LnByaW1hcnlLZXksIGN1cnJlbnRCaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSlcclxuICAgICk7XHJcblxyXG4gICAgYmluZGluZ1BhdGhBcnJheS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BJbmZvID0gUHJvcGVydHlVdGlsLmdldFByb3BlcnR5QnlOYW1lKGN1cnJlbnRCaW5kaW5nT2JqZWN0LnByb3BlcnRpZXMsIHByb3BOYW1lKTtcclxuICAgICAgc3dpdGNoIChwcm9wSW5mby50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBCaW5kaW5nUHJvcGVydHlUeXBlLlBsYWluOlxyXG4gICAgICAgICAgZW50aXR5UGF0aEFycmF5LnB1c2gocHJvcE5hbWUpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCaW5kaW5nUHJvcGVydHlUeXBlLk9iamVjdDpcclxuICAgICAgICAgIGN1cnJlbnRCaW5kaW5nT2JqZWN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xyXG4gICAgICAgICAgZW50aXR5UGF0aEFycmF5LnB1c2gocHJvcE5hbWUpO1xyXG4gICAgICAgICAgZW50aXR5UGF0aEFycmF5LnB1c2goXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlUHJpbWFyeUtleVBhdGgoY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleSwgY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlKVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmluZGluZ1Byb3BlcnR5VHlwZS5MaXN0OlxyXG4gICAgICAgICAgY29uc3QgY3VycmVudEJpbmRpbmdMaXN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xyXG4gICAgICAgICAgY3VycmVudEJpbmRpbmdPYmplY3QgPSBjdXJyZW50QmluZGluZ0xpc3QuY3VycmVudEl0ZW07XHJcbiAgICAgICAgICBlbnRpdHlQYXRoQXJyYXkucHVzaChwcm9wTmFtZSk7XHJcbiAgICAgICAgICBlbnRpdHlQYXRoQXJyYXkucHVzaChcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVQcmltYXJ5S2V5UGF0aChjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5LCBjdXJyZW50QmluZGluZ09iamVjdC5wcmltYXJ5S2V5VmFsdWUpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBlbnRpdHlQYXRoQXJyYXk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rot6/lvoTkuK3nmoTkuLvplK7pg6jliIZcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZVByaW1hcnlLZXlQYXRoKHByaW1hcnlLZXk6IHN0cmluZywgcHJpbWFyeUtleVZhbHVlOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBgJHtwcmltYXJ5S2V5fToke3ByaW1hcnlLZXlWYWx1ZX1gO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB7IEVudGl0eVBhdGhDb252ZXJ0ZXIgfTtcclxuIl19
import * as tslib_1 from "tslib";
/* eslint-disable new-cap */
/* eslint-disable require-jsdoc */
/* eslint-disable valid-jsdoc */
import { Injectable } from '@angular/core';
import { Repository } from '../repository/index';
import { ExpressionUtil } from '../utils/expression_util';
import { ENTITY_TEMPLATE } from './types';
var EntityDependencyResolver = /** @class */ (function () {
    function EntityDependencyResolver(repository) {
        this.repository = repository;
        this.entityTypeInfo = this.repository && this.repository.entityTypeInfo || null;
    }
    /**
     * 解析用户表达式中的实体依赖
     * @param expr 用户配置的完整表达式
     * @returns
     */
    EntityDependencyResolver.prototype.resolve = function (expr) {
        var groupFunctionDependencies = ExpressionUtil.getGroupFunctionDependency(expr, this.repository.entityTypeInfo);
        var entityDependencies = this.getEntityDependency(expr);
        // 去除错误的到子表的依赖
        if (groupFunctionDependencies && groupFunctionDependencies.length > 0 && entityDependencies && entityDependencies.length > 0) {
            groupFunctionDependencies.forEach(function (dep) {
                var index = entityDependencies.findIndex(function (item) { return dep.startsWith(item); });
                if (index !== -1) {
                    entityDependencies.splice(index, 1);
                }
            });
        }
        // 去重
        var merged = tslib_1.__spread(groupFunctionDependencies, entityDependencies);
        var deps = tslib_1.__spread(new Set(merged));
        return deps;
    };
    /**
     * 获取合法的实体属性表达式
     * @param entityPropertyExpression 实体属性表达式
     * @returns
     */
    EntityDependencyResolver.prototype.getValidEntityPropertyExpression = function (entityPropertyExpression) {
        var propPaths = entityPropertyExpression.split('.');
        var propInfo = null;
        try {
            propInfo = this.entityTypeInfo.getPropInfoByPath(propPaths);
        }
        catch (e) { }
        if (!propInfo) {
            if (propPaths.length > 1) {
                propPaths.pop();
                return this.getValidEntityPropertyExpression(propPaths.join('.'));
            }
            else {
                return null;
            }
        }
        else {
            return entityPropertyExpression.split('.');
        }
    };
    /**
     * 获取所有实体依赖
     * @param expr 表达式字符串
     * @returns
     */
    EntityDependencyResolver.prototype.getEntityDependency = function (expr) {
        var _this = this;
        var deps = [];
        if (this.entityTypeInfo) {
            // 使用正则匹配出所有实体
            var regex = new RegExp("[\\'\\\"]?\\s*(" + this.entityTypeInfo.entityInfo.nodeCode + "|" + this.entityTypeInfo.entityInfo.originalCode + ")[\\.\\[\\]a-zA-Z0-9_]+\\s*[\\'\\\"]?", 'g');
            var entityPropertyExpressions = expr.match(regex);
            if (Array.isArray(entityPropertyExpressions) && entityPropertyExpressions.length > 0) {
                // 解析出所有实体相关的字符串，以主实体名字开头，包含主实体属性或子表
                entityPropertyExpressions.forEach(function (item) {
                    if (item.indexOf('.') === -1) {
                        return;
                    }
                    // 去空格
                    item = item.trim().replace(/\"/g, '');
                    var paths = ExpressionUtil.convertToNodeCode(item, _this.repository.entityTypeInfo);
                    item = paths.join('.');
                    // 截去主实体及点
                    item = item.substr(item.indexOf('.') + 1);
                    var dep = _this.getValidEntityPropertyExpression(item);
                    if (dep && Array.isArray(dep) && dep.length > 0) {
                        // 此处必须加上主实体的名字来区分依赖的是实体还是其他类型的数据
                        dep.splice(0, 0, ENTITY_TEMPLATE);
                        deps.push(dep.join('/'));
                    }
                });
            }
        }
        else {
        }
        return deps;
    };
    EntityDependencyResolver.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    EntityDependencyResolver.ctorParameters = function () { return [
        { type: Repository }
    ]; };
    return EntityDependencyResolver;
}());
export { EntityDependencyResolver };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X2RlcGVuZGVuY3lfcmVzb2x2ZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXNvbHZlci9lbnRpdHlfZGVwZW5kZW5jeV9yZXNvbHZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsNEJBQTRCO0FBQzVCLGtDQUFrQztBQUNsQyxnQ0FBZ0M7QUFDaEMsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV6QyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDL0MsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ3hELE9BQU8sRUFBQyxlQUFlLEVBQVksTUFBTSxTQUFTLENBQUM7QUFFbkQ7SUFHRSxrQ0FBb0IsVUFBMkI7UUFBM0IsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDN0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQztJQUNsRixDQUFDO0lBQ0Q7Ozs7T0FJRztJQUNJLDBDQUFPLEdBQWQsVUFBZSxJQUFZO1FBQ3pCLElBQU0seUJBQXlCLEdBQUcsY0FBYyxDQUFDLDBCQUEwQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2xILElBQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFELGNBQWM7UUFDZCxJQUFJLHlCQUF5QixJQUFJLHlCQUF5QixDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksa0JBQWtCLElBQUksa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUM1SCx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsVUFBQyxHQUFXO2dCQUM1QyxJQUFNLEtBQUssR0FBRyxrQkFBa0IsQ0FBQyxTQUFTLENB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LElBQUksR0FBRyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7d0JBQy9DLGlDQUFpQzt3QkFDakMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDO3dCQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDMUI7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7YUFDSjtTQUNGO2FBQU07U0FDTjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Z0JBcEZGLFVBQVU7Ozs7Z0JBSkgsVUFBVTs7SUF5RmxCLCtCQUFDO0NBQUEsQUFyRkQsSUFxRkM7U0FwRlksd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbmV3LWNhcCAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSByZXF1aXJlLWpzZG9jICovXHJcbi8qIGVzbGludC1kaXNhYmxlIHZhbGlkLWpzZG9jICovXHJcbmltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7RGF0YVR5cGVJbmZvfSBmcm9tICcuLi9jb3JlL2luZGV4JztcclxuaW1wb3J0IHtSZXBvc2l0b3J5fSBmcm9tICcuLi9yZXBvc2l0b3J5L2luZGV4JztcclxuaW1wb3J0IHtFeHByZXNzaW9uVXRpbH0gZnJvbSAnLi4vdXRpbHMvZXhwcmVzc2lvbl91dGlsJztcclxuaW1wb3J0IHtFTlRJVFlfVEVNUExBVEUsIElSZXNvbHZlcn0gZnJvbSAnLi90eXBlcyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBFbnRpdHlEZXBlbmRlbmN5UmVzb2x2ZXIgaW1wbGVtZW50cyBJUmVzb2x2ZXIge1xyXG4gIHByaXZhdGUgZW50aXR5VHlwZUluZm86IERhdGFUeXBlSW5mbztcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8YW55Pikge1xyXG4gICAgdGhpcy5lbnRpdHlUeXBlSW5mbyA9IHRoaXMucmVwb3NpdG9yeSAmJiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8gfHwgbnVsbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6Kej5p6Q55So5oi36KGo6L6+5byP5Lit55qE5a6e5L2T5L6d6LWWXHJcbiAgICogQHBhcmFtIGV4cHIg55So5oi36YWN572u55qE5a6M5pW06KGo6L6+5byPXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgcmVzb2x2ZShleHByOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBncm91cEZ1bmN0aW9uRGVwZW5kZW5jaWVzID0gRXhwcmVzc2lvblV0aWwuZ2V0R3JvdXBGdW5jdGlvbkRlcGVuZGVuY3koZXhwciwgdGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvKTtcclxuICAgIGNvbnN0IGVudGl0eURlcGVuZGVuY2llcyA9IHRoaXMuZ2V0RW50aXR5RGVwZW5kZW5jeShleHByKTtcclxuICAgIC8vIOWOu+mZpOmUmeivr+eahOWIsOWtkOihqOeahOS+nei1llxyXG4gICAgaWYgKGdyb3VwRnVuY3Rpb25EZXBlbmRlbmNpZXMgJiYgZ3JvdXBGdW5jdGlvbkRlcGVuZGVuY2llcy5sZW5ndGggPiAwICYmIGVudGl0eURlcGVuZGVuY2llcyAmJiBlbnRpdHlEZXBlbmRlbmNpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBncm91cEZ1bmN0aW9uRGVwZW5kZW5jaWVzLmZvckVhY2goKGRlcDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSBlbnRpdHlEZXBlbmRlbmNpZXMuZmluZEluZGV4KChpdGVtKSA9PiBkZXAuc3RhcnRzV2l0aChpdGVtKSk7XHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgZW50aXR5RGVwZW5kZW5jaWVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIC8vIOWOu+mHjVxyXG4gICAgY29uc3QgbWVyZ2VkID0gWy4uLmdyb3VwRnVuY3Rpb25EZXBlbmRlbmNpZXMsIC4uLmVudGl0eURlcGVuZGVuY2llc107XHJcbiAgICBjb25zdCBkZXBzID0gWy4uLm5ldyBTZXQobWVyZ2VkKV07XHJcbiAgICByZXR1cm4gZGVwcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5ZCI5rOV55qE5a6e5L2T5bGe5oCn6KGo6L6+5byPXHJcbiAgICogQHBhcmFtIGVudGl0eVByb3BlcnR5RXhwcmVzc2lvbiDlrp7kvZPlsZ7mgKfooajovr7lvI9cclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VmFsaWRFbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb24oZW50aXR5UHJvcGVydHlFeHByZXNzaW9uOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBwcm9wUGF0aHMgPSBlbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb24uc3BsaXQoJy4nKTtcclxuICAgIGxldCBwcm9wSW5mbyA9IG51bGw7XHJcbiAgICB0cnkge1xyXG4gICAgICBwcm9wSW5mbyA9IHRoaXMuZW50aXR5VHlwZUluZm8uZ2V0UHJvcEluZm9CeVBhdGgocHJvcFBhdGhzKTtcclxuICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgaWYgKCFwcm9wSW5mbykge1xyXG4gICAgICBpZiAocHJvcFBhdGhzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICBwcm9wUGF0aHMucG9wKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsaWRFbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb24ocHJvcFBhdGhzLmpvaW4oJy4nKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBlbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb24uc3BsaXQoJy4nKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5omA5pyJ5a6e5L2T5L6d6LWWXHJcbiAgICogQHBhcmFtIGV4cHIg6KGo6L6+5byP5a2X56ym5LiyXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcml2YXRlIGdldEVudGl0eURlcGVuZGVuY3koZXhwcjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgZGVwcyA9IFtdO1xyXG4gICAgaWYgKHRoaXMuZW50aXR5VHlwZUluZm8pIHtcclxuICAgICAgLy8g5L2/55So5q2j5YiZ5Yy56YWN5Ye65omA5pyJ5a6e5L2TXHJcbiAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgW1xcXFwnXFxcXFwiXT9cXFxccyooJHt0aGlzLmVudGl0eVR5cGVJbmZvLmVudGl0eUluZm8ubm9kZUNvZGV9fCR7dGhpcy5lbnRpdHlUeXBlSW5mby5lbnRpdHlJbmZvLm9yaWdpbmFsQ29kZX0pW1xcXFwuXFxcXFtcXFxcXWEtekEtWjAtOV9dK1xcXFxzKltcXFxcJ1xcXFxcIl0/YCwgJ2cnKTtcclxuICAgICAgY29uc3QgZW50aXR5UHJvcGVydHlFeHByZXNzaW9uczogUmVnRXhwTWF0Y2hBcnJheSA9IGV4cHIubWF0Y2gocmVnZXgpO1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShlbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb25zKSAmJiBlbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyDop6PmnpDlh7rmiYDmnInlrp7kvZPnm7jlhbPnmoTlrZfnrKbkuLLvvIzku6XkuLvlrp7kvZPlkI3lrZflvIDlpLTvvIzljIXlkKvkuLvlrp7kvZPlsZ7mgKfmiJblrZDooahcclxuICAgICAgICBlbnRpdHlQcm9wZXJ0eUV4cHJlc3Npb25zLmZvckVhY2goKGl0ZW06IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgaWYgKGl0ZW0uaW5kZXhPZignLicpID09PSAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyDljrvnqbrmoLxcclxuICAgICAgICAgIGl0ZW0gPSBpdGVtLnRyaW0oKS5yZXBsYWNlKC9cXFwiL2csICcnKTtcclxuICAgICAgICAgIGNvbnN0IHBhdGhzID0gRXhwcmVzc2lvblV0aWwuY29udmVydFRvTm9kZUNvZGUoaXRlbSwgdGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvKTtcclxuICAgICAgICAgIGl0ZW0gPSBwYXRocy5qb2luKCcuJyk7XHJcbiAgICAgICAgICAvLyDmiKrljrvkuLvlrp7kvZPlj4rngrlcclxuICAgICAgICAgIGl0ZW0gPSBpdGVtLnN1YnN0cihpdGVtLmluZGV4T2YoJy4nKSArIDEpO1xyXG4gICAgICAgICAgY29uc3QgZGVwID0gdGhpcy5nZXRWYWxpZEVudGl0eVByb3BlcnR5RXhwcmVzc2lvbihpdGVtKTtcclxuICAgICAgICAgIGlmIChkZXAgJiYgQXJyYXkuaXNBcnJheShkZXApICYmIGRlcC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIOatpOWkhOW/hemhu+WKoOS4iuS4u+WunuS9k+eahOWQjeWtl+adpeWMuuWIhuS+nei1lueahOaYr+WunuS9k+i/mOaYr+WFtuS7luexu+Wei+eahOaVsOaNrlxyXG4gICAgICAgICAgICBkZXAuc3BsaWNlKDAsIDAsIEVOVElUWV9URU1QTEFURSk7XHJcbiAgICAgICAgICAgIGRlcHMucHVzaChkZXAuam9pbignLycpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgIH1cclxuICAgIHJldHVybiBkZXBzO1xyXG4gIH1cclxufVxyXG4iXX0=
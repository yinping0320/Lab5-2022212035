import * as tslib_1 from "tslib";
/**
 * 过滤条件管理器
 */
var FilterConditionManager = /** @class */ (function () {
    function FilterConditionManager() {
        this.filters = new Map();
    }
    /**
     * 获取过滤条件
     * @param bindingPath 绑定路径
     */
    FilterConditionManager.prototype.getFilters = function (bindingPath) {
        return this.filters.get(bindingPath) || [];
    };
    /**
     * 自定义合并
     * @param bindingPath 绑定路径
     * @param merge 合并函数
     */
    FilterConditionManager.prototype.mergeCondition = function (bindingPath, merge) {
        var conditions = this.filters.get(bindingPath) || [];
        var result = merge(conditions);
        this.filters.set(bindingPath, result);
    };
    /**
     * 增加过滤条件
     * @param bindingPath 绑定路径
     * @param condition 过滤条件
     */
    FilterConditionManager.prototype.addCondition = function (bindingPath, condition) {
        // 通过bindingPath获取对应的过滤条件
        var conditions = this.filters.get(bindingPath);
        var index = this.findConditionIndex(bindingPath, condition);
        if (index !== -1) {
            conditions[index] = condition;
        }
        else {
            conditions.push(condition);
        }
    };
    /**
     * 批量增加过滤条件
     * @param bindingPath 绑定路径
     * @param conditions 过滤条件数组
     */
    FilterConditionManager.prototype.addConditions = function (bindingPath, conditions) {
        var _this = this;
        if (!conditions || !Array.isArray(conditions) || conditions.length < 1) {
            return;
        }
        conditions.forEach(function (condition) {
            _this.addCondition(bindingPath, condition);
        });
    };
    /**
     * 删除过滤条件
     * @param bindingPath 绑定路径
     * @param predicate 条件表达式
     */
    FilterConditionManager.prototype.removeCondition = function (bindingPath, predicate) {
        var _this = this;
        var conditions = this.filters.get(bindingPath);
        if (!conditions || conditions.length < 1) {
            return;
        }
        var removes = conditions.filter(predicate);
        if (removes) {
            removes.forEach(function (condition) {
                var index = _this.findConditionIndex(bindingPath, condition);
                if (index >= 0) {
                    conditions.splice(index, 1);
                }
            });
        }
    };
    /**
     * 清空过滤条件
     */
    FilterConditionManager.prototype.clear = function () {
        this.filters.clear();
    };
    /**
     * 设置过滤条件数组
     * @param bindingPath 绑定路径
     * @param conditions 过滤条件数组
     */
    FilterConditionManager.prototype.setConditions = function (bindingPath, conditions) {
        this.filters.set(bindingPath, conditions);
    };
    /**
     * 查找过滤条件索引
     * @param bindingPath 绑定路径
     * @param condition 过滤条件
     */
    FilterConditionManager.prototype.findConditionIndex = function (bindingPath, condition) {
        if (!condition || typeof (condition) !== 'object' || Object.keys(condition).length < 1) {
            return -1;
        }
        var conditions = this.filters.get(bindingPath);
        if (!conditions || conditions.length < 1) {
            return -1;
        }
        return conditions.findIndex(function (value, index) {
            var e_1, _a;
            var isEqual = true;
            var props = Object.keys(condition);
            try {
                for (var props_1 = tslib_1.__values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {
                    var prop = props_1_1.value;
                    if (!(value && value.hasOwnProperty(prop) && value[prop] === condition[prop])) {
                        isEqual = false;
                        break;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return isEqual;
        });
    };
    return FilterConditionManager;
}());
export { FilterConditionManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyX2NvbmRpdGlvbl9tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvcmVwb3NpdG9yeS9maWx0ZXJfY29uZGl0aW9uX21hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHO0FBQ0g7SUFBQTtRQUNZLFlBQU8sR0FBNEIsSUFBSSxHQUFHLEVBQXNCLENBQUM7SUEwRzdFLENBQUM7SUF6R0c7OztPQUdHO0lBQ0ksMkNBQVUsR0FBakIsVUFBa0IsV0FBbUI7UUFDakMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDL0MsQ0FBQztJQUNEOzs7O09BSUc7SUFDSSwrQ0FBYyxHQUFyQixVQUFzQixXQUFtQixFQUFFLEtBQStCO1FBQ3RFLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN2RCxJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFDRDs7OztPQUlHO0lBQ0ksNkNBQVksR0FBbkIsVUFBb0IsV0FBbUIsRUFBRSxTQUFjO1FBQ25ELHlCQUF5QjtRQUN6QixJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQzlELElBQUksS0FBSyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ2QsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLFNBQVMsQ0FBQztTQUNqQzthQUFNO1lBQ0gsVUFBVSxD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QUFPLE9BQU8sQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDTCw2QkFBQztBQUFELENBQUMsQUEzR0QsSUEyR0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog6L+H5ruk5p2h5Lu2566h55CG5ZmoXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRmlsdGVyQ29uZGl0aW9uTWFuYWdlciB7XHJcbiAgICBwcml2YXRlIGZpbHRlcnM6IE1hcDxzdHJpbmcsIEFycmF5PGFueT4+ID0gbmV3IE1hcDxzdHJpbmcsIEFycmF5PGFueT4+KCk7XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlui/h+a7pOadoeS7tlxyXG4gICAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOe7keWumui3r+W+hFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0RmlsdGVycyhiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVycy5nZXQoYmluZGluZ1BhdGgpIHx8IFtdO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDoh6rlrprkuYnlkIjlubZcclxuICAgICAqIEBwYXJhbSBiaW5kaW5nUGF0aCDnu5Hlrprot6/lvoRcclxuICAgICAqIEBwYXJhbSBtZXJnZSDlkIjlubblh73mlbBcclxuICAgICAqL1xyXG4gICAgcHVibGljIG1lcmdlQ29uZGl0aW9uKGJpbmRpbmdQYXRoOiBzdHJpbmcsIG1lcmdlOiAoY29uZGl0aW9uczogYW55KSA9PiBhbnkpIHtcclxuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5maWx0ZXJzLmdldChiaW5kaW5nUGF0aCkgfHwgW107XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbWVyZ2UoY29uZGl0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJzLnNldChiaW5kaW5nUGF0aCwgcmVzdWx0KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5aKe5Yqg6L+H5ruk5p2h5Lu2XHJcbiAgICAgKiBAcGFyYW0gYmluZGluZ1BhdGgg57uR5a6a6Lev5b6EXHJcbiAgICAgKiBAcGFyYW0gY29uZGl0aW9uIOi/h+a7pOadoeS7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkQ29uZGl0aW9uKGJpbmRpbmdQYXRoOiBzdHJpbmcsIGNvbmRpdGlvbjogYW55KSB7XHJcbiAgICAgICAgLy8g6YCa6L+HYmluZGluZ1BhdGjojrflj5blr7nlupTnmoTov4fmu6TmnaHku7ZcclxuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5maWx0ZXJzLmdldChiaW5kaW5nUGF0aCk7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmZpbmRDb25kaXRpb25JbmRleChiaW5kaW5nUGF0aCwgY29uZGl0aW9uKTtcclxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbnNbaW5kZXhdID0gY29uZGl0aW9uO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChjb25kaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5om56YeP5aKe5Yqg6L+H5ruk5p2h5Lu2XHJcbiAgICAgKiBAcGFyYW0gYmluZGluZ1BhdGgg57uR5a6a6Lev5b6EXHJcbiAgICAgKiBAcGFyYW0gY29uZGl0aW9ucyDov4fmu6TmnaHku7bmlbDnu4RcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFkZENvbmRpdGlvbnMoYmluZGluZ1BhdGg6IHN0cmluZywgY29uZGl0aW9uczogQXJyYXk8YW55Pikge1xyXG4gICAgICAgIGlmICghY29uZGl0aW9ucyB8fCAhQXJyYXkuaXNBcnJheShjb25kaXRpb25zKSB8fCBjb25kaXRpb25zLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25kaXRpb25zLmZvckVhY2goY29uZGl0aW9uID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hZGRDb25kaXRpb24oYmluZGluZ1BhdGgsIGNvbmRpdGlvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOi/h+a7pOadoeS7tlxyXG4gICAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOe7keWumui3r+W+hFxyXG4gICAgICogQHBhcmFtIHByZWRpY2F0ZSDmnaHku7booajovr7lvI9cclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlbW92ZUNvbmRpdGlvbihiaW5kaW5nUGF0aDogc3RyaW5nLCBwcmVkaWNhdGU6ICh2YWx1ZTogYW55LCBpbmRleDogbnVtYmVyLCBhcnJheTogYW55W10pID0+IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCBjb25kaXRpb25zOiBBcnJheTx7IFtwcm9wTmFtZTogc3RyaW5nXTogYW55IH0+ID0gdGhpcy5maWx0ZXJzLmdldChiaW5kaW5nUGF0aCk7XHJcbiAgICAgICAgaWYgKCFjb25kaXRpb25zIHx8IGNvbmRpdGlvbnMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJlbW92ZXMgPSBjb25kaXRpb25zLmZpbHRlcihwcmVkaWNhdGUpO1xyXG4gICAgICAgIGlmIChyZW1vdmVzKSB7XHJcbiAgICAgICAgICAgIHJlbW92ZXMuZm9yRWFjaChjb25kaXRpb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmZpbmRDb25kaXRpb25JbmRleChiaW5kaW5nUGF0aCwgY29uZGl0aW9uKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOa4heepuui/h+a7pOadoeS7tlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJzLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rui/h+a7pOadoeS7tuaVsOe7hFxyXG4gICAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOe7keWumui3r+W+hFxyXG4gICAgICogQHBhcmFtIGNvbmRpdGlvbnMg6L+H5ruk5p2h5Lu25pWw57uEXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXRDb25kaXRpb25zKGJpbmRpbmdQYXRoOiBzdHJpbmcsIGNvbmRpdGlvbnM6IEFycmF5PGFueT4pIHtcclxuICAgICAgICB0aGlzLmZpbHRlcnMuc2V0KGJpbmRpbmdQYXRoLCBjb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOafpeaJvui/h+a7pOadoeS7tue0ouW8lVxyXG4gICAgICogQHBhcmFtIGJpbmRpbmdQYXRoIOe7keWumui3r+W+hFxyXG4gICAgICogQHBhcmFtIGNvbmRpdGlvbiDov4fmu6TmnaHku7ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBmaW5kQ29uZGl0aW9uSW5kZXgoYmluZGluZ1BhdGg6IHN0cmluZywgY29uZGl0aW9uOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWNvbmRpdGlvbiB8fCB0eXBlb2YgKGNvbmRpdGlvbikgIT09ICdvYmplY3QnIHx8IE9iamVjdC5rZXlzKGNvbmRpdGlvbikubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbnM6IEFycmF5PGFueT4gPSB0aGlzLmZpbHRlcnMuZ2V0KGJpbmRpbmdQYXRoKTtcclxuICAgICAgICBpZiAoIWNvbmRpdGlvbnMgfHwgY29uZGl0aW9ucy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvbnMuZmluZEluZGV4KCh2YWx1ZSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgbGV0IGlzRXF1YWwgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wcyA9IE9iamVjdC5rZXlzKGNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcCBvZiBwcm9wcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgJiYgdmFsdWUuaGFzT3duUHJvcGVydHkocHJvcCkgJiYgdmFsdWVbcHJvcF0gPT09IGNvbmRpdGlvbltwcm9wXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpc0VxdWFsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGlzRXF1YWw7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
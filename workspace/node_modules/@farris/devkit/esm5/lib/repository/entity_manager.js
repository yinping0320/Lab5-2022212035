/*
 * @Author: Witt
 * @Date: 2019-03-07 17:24:38
 * @Last Modified by:   Witt
 * @Last Modified time: 2019-03-11 19:50:38
 */
import { createEntity, createEntities } from '../entity/index';
import { EntityCollection } from './entity_collection';
import { DataPathCreator, DataPathNodeType } from '../core/index';
import { EntityUtil } from '../binding-data/entity_util';
/**
 * 实体管理类
 */
var EntityManager = /** @class */ (function () {
    /**
     * 构造函数
     */
    function EntityManager(entityCollection) {
        this.entityCollection = entityCollection;
        this.entityType = entityCollection.entityType;
    }
    // #region 创建实体相关方法
    /**
     * 创建实体
     */
    EntityManager.prototype.createEntity = function (entityData) {
        var entity = createEntity(this.entityType, entityData);
        return entity;
    };
    /**
     * 批量创建实体
     */
    EntityManager.prototype.createEntities = function (entityListData, entityType) {
        var entities = createEntities(this.entityType, entityListData);
        return entities;
    };
    /**
     * 批量创建下级实体
     * @param fPath fpath
     * @param entityListData 实体数据
     */
    EntityManager.prototype.createEntitiesByPath = function (fPath, entityListData) {
        var subPaths = fPath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fPath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        if (entityListData.length < 1) {
            return [];
        }
        var childEntityList;
        var propInfo;
        var propName;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            propName = subPaths[i];
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            var entityType = propInfo ? propInfo.propEntityType : this.entityType;
            propInfo = EntityUtil.getPropInfo(entityType, propName);
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fPath);
            }
        }
        var entities = entityListData.map(function (entityData) {
            return createEntity(propInfo.propEntityType, entityData);
        });
        return entities;
    };
    // #endregion
    // #region 获取实体、实体数组相关方法
    /**
     * 获取path对应的实体
     */
    EntityManager.prototype.getEntityByPath = function (path) {
        var entity = this.getEntityNodeByPath(path);
        return entity;
    };
    /**
     * 获取path对应的实体
     */
    EntityManager.prototype.getEntitiesByPath = function (path) {
        var entityCollectionOrList = this.getEntityNodeByPath(path);
        var entities;
        if (entityCollectionOrList instanceof EntityCollection === true) {
            entities = entityCollectionOrList.toArray();
        }
        else {
            entities = entityCollectionOrList.toArray();
        }
        return entities;
    };
    /**
     * 获取实体节点
     * @param path 节点路径
     */
    EntityManager.prototype.getEntityNodeByPath = function (path) {
        var dataPath = DataPathCreator.createByLongPathFromRoot(path, this);
        var entityNode = this.entityCollection;
        var pathNode = dataPath.head.next;
        while (pathNode) {
            if (pathNode.type === DataPathNodeType.DataId) {
                if (entityNode instanceof EntityCollection === true) {
                    entityNode = entityNode.getEntityById(pathNode.value);
                }
                else {
                    entityNode = entityNode.get(pathNode.value);
                }
            }
            else {
                entityNode = entityNode[pathNode.value];
            }
            if (!entityNode) {
                throw new Error("\u627E\u4E0D\u5230" + pathNode.value + "\u5BF9\u5E94\u7684\u6570\u636E\u8282\u70B9");
            }
            pathNode = pathNode.next;
        }
        return entityNode;
    };
    // #endregion
    // #region 获取、设置属性值
    /**
     * 获取path对应的实体属性值
     */
    EntityManager.prototype.getPropValueByPath = function (path) {
        var propName = path.pop();
        var entity = this.getEntityByPath(path);
        return entity[propName];
    };
    /**
     * 设置path对应实体的属性值
     */
    EntityManager.prototype.setPropValueByPath = function (path, propValue) {
        var propName = path.pop();
        var entity = this.getEntityByPath(path);
        entity[propName] = propValue;
    };
    // #endregion
    // #region 插入实体
    /**
     * 在path对应实体前插入实体
     */
    EntityManager.prototype.insertEntityBeforeByPath = function (fpath) {
        throw new Error('Not Implemented');
    };
    /**
     * 在path对应实体前批量插入实体
     */
    EntityManager.prototype.insertEntitiesBeforeByPath = function () {
        throw new Error('Not Implemented');
    };
    /**
     * 在path对应实体前插入实体
     */
    EntityManager.prototype.insertEntityAfterByPath = function () {
        throw new Error('Not Implemented');
    };
    /**
     * 在path对应实体前批量插入实体
     */
    EntityManager.prototype.insertEntitiesAfterByPath = function () {
        throw new Error('Not Implemented');
    };
    // #endregion
    // #region 追加实体
    /**
     * 在path对应的实体集合中追加1个实体
     */
    // public appendEntityByPath(fpath: string[], entity: Entity): void {
    //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);
    //   if (entityCollectionOrList instanceof EntityCollection === true) {
    //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;
    //     entityCollection.addEntity(entity);
    //   } else {
    //     const entityList = (entityCollectionOrList as EntityList<Entity>);
    //     entityList.appendEntity(entity);
    //   }
    // }
    /**
     * 根据path获取实体集合
     * @param fpath 路径 /id/childsNode/id/xxx
     * @param entityData 实体数据
     * @param initialData[可选] 默认值
     */
    EntityManager.prototype.appendEntityByPath = function (fpath, entityData, initialData, isCloned) {
        if (isCloned === void 0) { isCloned = false; }
        var subPaths = fpath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fpath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        var childEntityList;
        var propInfo;
        var propName;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            propName = subPaths[i];
            // todo: EntityCollection重构之后这里无需差异处理
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            var entityType = propInfo ? propInfo.propEntityType : this.entityType;
            propInfo = EntityUtil.getPropInfo(entityType, propName);
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fpath);
            }
        }
        // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);
        var childEntity = createEntity(propInfo.propEntityType, entityData);
        // 在实体的实例上增加默认值属性，以便在createBindingObject时存放默认值
        // if (initialData) {
        //   EntityUtil.appendInitialData(childEntity, initialData);
        // }
        childEntityList.appendNew(childEntity, isCloned);
        return childEntity;
    };
    /**
     * 在指定位置插入实体
     * @param fpath 父路径
     * @param entityData 实体数据
     * @param initialData 初始数据
     * @param position 插入位置
     */
    EntityManager.prototype.insertEntityByPath = function (fpath, entityData, initialData, position) {
        var subPaths = fpath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fpath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        var childEntityList;
        var propInfo;
        var propName;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            propName = subPaths[i];
            // todo: EntityCollection重构之后这里无需差异处理
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            var entityType = propInfo ? propInfo.propEntityType : this.entityType;
            propInfo = EntityUtil.getPropInfo(entityType, propName);
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fpath);
            }
        }
        // const propInfo = EntityUtil.getPropInfo(this.entityType, propName);
        var childEntity = createEntity(propInfo.propEntityType, entityData);
        // 在实体的实例上增加默认值属性，以便在createBindingObject时存放默认值
        // if (initialData) {
        //   EntityUtil.appendInitialData(childEntity, initialData);
        // }
        childEntityList.insert(childEntity, position);
        return childEntity;
    };
    /**
     * 在path对应的实体集合中追加多个实体
     */
    EntityManager.prototype.appendEntitiesByPath = function (fpath, entities) {
        var entityCollectionOrList = this.getEntityNodeByPath(fpath);
        if (entityCollectionOrList instanceof EntityCollection === true) {
            var entityCollection = entityCollectionOrList;
            entityCollection.addEntities(entities);
        }
        else {
            var entityList = entityCollectionOrList;
            entityList.appendEntities(entities);
        }
    };
    // #endregion
    // #region 删除实体
    /**
     * 从fapth对应的实体集合中删除id对应的实体
     */
    // public removeEntityByPath(fpath: string[], id: string): void {
    //   const entityCollectionOrList = this.getEntityNodeByPath(fpath);
    //   if (entityCollectionOrList instanceof EntityCollection === true) {
    //     const entityCollection = entityCollectionOrList as EntityCollection<Entity>;
    //     entityCollection.removeEntityById(id);
    //   } else {
    //     const entityList = (entityCollectionOrList as EntityList<Entity>);
    //     entityList.remove(id);
    //   }
    // }
    /**
     * 根据path获取实体集合
     * @param fpath path
     */
    EntityManager.prototype.removeEntityByPath = function (fpath, id) {
        var subPaths = fpath.split('/');
        if (subPaths.length < 3) {
            throw Error("\u6839\u636Epath\u5220\u9664\u5B9E\u4F53\u6570\u636E\u51FA\u9519\u4E86\u3002\u4F20\u5165\u7684path[" + fpath + "]\u683C\u5F0F\u4E0D\u5BF9");
        }
        var childEntityList;
        for (var i = 2; i < subPaths.length; i = i + 2) {
            var fid = subPaths[i - 1];
            var propName = subPaths[i];
            var parentEntity = childEntityList ? childEntityList.get(fid) : this.entityCollection.getEntityById(fid);
            childEntityList = parentEntity[propName];
            if (!childEntityList) {
                throw Error("fpath\u53C2\u6570\u9519\u8BEF\uFF0C\u65E0\u6CD5\u627E\u5230" + propName + "\u5BF9\u5E94\u7684\u5B50\u8868\u3002fpath\u4E3A\uFF1A" + fpath);
            }
        }
        childEntityList.remove(id);
    };
    /**
     * 从fapth对应的实体集合中删除ids对应的实体
     */
    EntityManager.prototype.removeEntitiesByPath = function (fpath, ids) {
        // const entityCollectionOrList = this.getEntityNodeByPath(fpath);
        // if (entityCollectionOrList instanceof EntityCollection === true) {
        //   const entityCollection = entityCollectionOrList as EntityCollection<Entity>;
        //   entityCollection.removeEntitiesByIds(ids);
        // } else {
        //   const entityList = (entityCollectionOrList as EntityList<Entity>);
        //   entityList.remove(ids);
        // }
        throw new Error('Not Implemented');
    };
    // #endregion
    // #region 清空变更集相关方法
    /**
     * 清空所有实体的变更集
     */
    EntityManager.prototype.clearAllEntityChanges = function () {
        var entities = this.entityCollection.toArray();
        entities.forEach(function (entity) {
            entity.changes.splice(0, entity.changes.length);
        });
    };
    /**
     * 清空id指定的实体变更集
     */
    EntityManager.prototype.clearEntityChangesById = function (id) {
        var entity = this.entityCollection.getEntityById(id);
        if (!entity) {
            return;
        }
        entity.changes.splice(0, entity.changes.length);
    };
    /**
     * 清空ids数组中指定的实体的变更集
     */
    EntityManager.prototype.clearEntityChangesByIds = function (ids) {
        var _this = this;
        if (!ids || ids.length < 0) {
            return;
        }
        ids.forEach(function (id) {
            _this.clearEntityChangesById(id);
        });
    };
    // #endregion
    // #region 变更集检查相关方法
    /**
     * 检查所有的实体，是否有未提交的变更
     */
    EntityManager.prototype.checkAllEntityChanges = function () {
        var entities = this.entityCollection.toArray();
        var hasChanges = entities.some(function (entity) {
            if (entity.changes.length > 0) {
                return true;
            }
            else {
                return false;
            }
        });
        return hasChanges;
    };
    /**
     * 检查id对应的实体，是否有未提交的变更
     */
    EntityManager.prototype.checkEntityChangesById = function (id) {
        var entity = this.entityCollection.getEntityById(id);
        if (!entity) {
            return false;
        }
        return entity.changes.length > 0;
    };
    // #endregion
    // #region 不规范方法，待废弃
    /**
     * 待废弃
     * @deprecated
     */
    EntityManager.prototype.clearEntityChangesByArray = function (idArray) {
        this.clearEntityChangesByIds(idArray);
    };
    return EntityManager;
}());
export { EntityManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X21hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2RldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9yZXBvc2l0b3J5L2VudGl0eV9tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztHQUtHO0FBR0gsT0FBTyxFQUFzQixZQUFZLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDbkYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFZLGVBQWUsRUFBRSxnQkFBZ0IsRUFBZ0IsTUFBTSxlQUFlLENBQUM7QUFDMUYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBR3pEOztHQUVHO0FBQ0g7SUFZRTs7T0FFRztJQUNILHVCQUFZLGdCQUFxQztRQUMvQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDekMsSUFBSSxDQUFDLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7SUFDaEQsQ0FBQztJQUdELG1CQUFtQjtJQUVuQjs7T0FFRztJQUNJLG9DQUFZLEdBQW5CLFVBQW9CLFVBQWU7UUFDakMsSUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDNUQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksc0NBQWMsR0FBckIsVUFBc0IsY0FBcUIsRUFBRSxVQUFlO1FBQzFELElBQU0sUUFBUSxHQUFRLGNBQWMsQ0FBSSxJQUFJLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQ3pFLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFDRDs7OztPQUlHO0lBQ0ksNENBQW9CLEdBQTNCLFVBQTRCLEtBQWEsRUFBRSxjQUFxQjtRQUM5RCxJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FB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LGlEQUF5QixHQUFoQyxVQUFpQyxPQUFpQjtRQUNoRCxJQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUlILG9CQUFDO0FBQUQsQ0FBQyxBQS9hRCxJQSthQztBQUVELE9BQU8sRUFBRSxhQUFhLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTktMDMtMDcgMTc6MjQ6MzhcclxuICogQExhc3QgTW9kaWZpZWQgYnk6ICAgV2l0dFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE5LTAzLTExIDE5OjUwOjM4XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEVudGl0eUxpc3QsIGNyZWF0ZUVudGl0eSwgY3JlYXRlRW50aXRpZXMgfSBmcm9tICcuLi9lbnRpdHkvaW5kZXgnO1xyXG5pbXBvcnQgeyBFbnRpdHlDb2xsZWN0aW9uIH0gZnJvbSAnLi9lbnRpdHlfY29sbGVjdGlvbic7XHJcbmltcG9ydCB7IERhdGFQYXRoLCBEYXRhUGF0aENyZWF0b3IsIERhdGFQYXRoTm9kZVR5cGUsIERhdGFUeXBlSW5mbyB9IGZyb20gJy4uL2NvcmUvaW5kZXgnO1xyXG5pbXBvcnQgeyBFbnRpdHlVdGlsIH0gZnJvbSAnLi4vYmluZGluZy1kYXRhL2VudGl0eV91dGlsJztcclxuXHJcblxyXG4vKipcclxuICog5a6e5L2T566h55CG57G7XHJcbiAqL1xyXG5jbGFzcyBFbnRpdHlNYW5hZ2VyPFQgZXh0ZW5kcyBFbnRpdHk+IHtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T57G75Z6LXHJcbiAgICovXHJcbiAgcHVibGljIGVudGl0eVR5cGU6IFR5cGU8RW50aXR5PjtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGVudGl0eUNvbGxlY3Rpb246IEVudGl0eUNvbGxlY3Rpb248RW50aXR5PjtcclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoZW50aXR5Q29sbGVjdGlvbjogRW50aXR5Q29sbGVjdGlvbjxUPikge1xyXG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uID0gZW50aXR5Q29sbGVjdGlvbjtcclxuICAgIHRoaXMuZW50aXR5VHlwZSA9IGVudGl0eUNvbGxlY3Rpb24uZW50aXR5VHlwZTtcclxuICB9XHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOWIm+W7uuWunuS9k+ebuOWFs+aWueazlVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7rlrp7kvZNcclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlRW50aXR5KGVudGl0eURhdGE6IGFueSk6IFQge1xyXG4gICAgY29uc3QgZW50aXR5ID0gY3JlYXRlRW50aXR5PFQ+KHRoaXMuZW50aXR5VHlwZSwgZW50aXR5RGF0YSk7XHJcbiAgICByZXR1cm4gZW50aXR5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yib5bu65a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZUVudGl0aWVzKGVudGl0eUxpc3REYXRhOiBhbnlbXSwgZW50aXR5VHlwZTogYW55KTogVFtdIHtcclxuICAgIGNvbnN0IGVudGl0aWVzOiBUW10gPSBjcmVhdGVFbnRpdGllczxUPih0aGlzLmVudGl0eVR5cGUsIGVudGl0eUxpc3REYXRhKTtcclxuICAgIHJldHVybiBlbnRpdGllcztcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5om56YeP5Yib5bu65LiL57qn5a6e5L2TXHJcbiAgICogQHBhcmFtIGZQYXRoIGZwYXRoXHJcbiAgICogQHBhcmFtIGVudGl0eUxpc3REYXRhIOWunuS9k+aVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGVFbnRpdGllc0J5UGF0aChmUGF0aDogc3RyaW5nLCBlbnRpdHlMaXN0RGF0YTogYW55W10pIHtcclxuICAgIGNvbnN0IHN1YlBhdGhzID0gZlBhdGguc3BsaXQoJy8nKTtcclxuICAgIGlmIChzdWJQYXRocy5sZW5ndGggPCAzKSB7XHJcbiAgICAgIHRocm93IEVycm9yKGDmoLnmja5wYXRo5Yig6Zmk5a6e5L2T5pWw5o2u5Ye66ZSZ5LqG44CC5Lyg5YWl55qEcGF0aFske2ZQYXRofV3moLzlvI/kuI3lr7lgKTtcclxuICAgIH1cclxuICAgIGlmIChlbnRpdHlMaXN0RGF0YS5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGxldCBjaGlsZEVudGl0eUxpc3Q6IEVudGl0eUxpc3Q8YW55PjtcclxuICAgIGxldCBwcm9wSW5mbzogeyBwcm9wVHlwZTogc3RyaW5nLCBwcm9wRW50aXR5VHlwZTogYW55IH07XHJcbiAgICBsZXQgcHJvcE5hbWU6IHN0cmluZztcclxuICAgIGZvciAobGV0IGkgPSAyOyBpIDwgc3ViUGF0aHMubGVuZ3RoOyBpID0gaSArIDIpIHtcclxuICAgICAgY29uc3QgZmlkID0gc3ViUGF0aHNbaSAtIDFdO1xyXG4gICAgICBwcm9wTmFtZSA9IHN1YlBhdGhzW2ldO1xyXG4gICAgICBjb25zdCBwYXJlbnRFbnRpdHkgPSBjaGlsZEVudGl0eUxpc3QgPyBjaGlsZEVudGl0eUxpc3QuZ2V0KGZpZCkgOiB0aGlzLmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChmaWQpO1xyXG4gICAgICBjaGlsZEVudGl0eUxpc3QgPSBwYXJlbnRFbnRpdHlbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gcHJvcEluZm8gPyBwcm9wSW5mby5wcm9wRW50aXR5VHlwZSA6IHRoaXMuZW50aXR5VHlwZTtcclxuICAgICAgcHJvcEluZm8gPSBFbnRpdHlVdGlsLmdldFByb3BJbmZvKGVudGl0eVR5cGUsIHByb3BOYW1lKTtcclxuICAgICAgaWYgKCFjaGlsZEVudGl0eUxpc3QpIHtcclxuICAgICAgICB0aHJvdyBFcnJvcihgZnBhdGjlj4LmlbDplJnor6/vvIzml6Dms5Xmib7liLAke3Byb3BOYW1lfeWvueW6lOeahOWtkOihqOOAgmZwYXRo5Li677yaJHtmUGF0aH1gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgZW50aXRpZXMgPSBlbnRpdHlMaXN0RGF0YS5tYXAoZW50aXR5RGF0YSA9PiB7XHJcbiAgICAgIHJldHVybiBjcmVhdGVFbnRpdHk8RW50aXR5Pihwcm9wSW5mby5wcm9wRW50aXR5VHlwZSwgZW50aXR5RGF0YSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBlbnRpdGllcztcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDojrflj5blrp7kvZPjgIHlrp7kvZPmlbDnu4Tnm7jlhbPmlrnms5VcclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WcGF0aOWvueW6lOeahOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRFbnRpdHlCeVBhdGgocGF0aDogc3RyaW5nW10pOiBFbnRpdHkge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5nZXRFbnRpdHlOb2RlQnlQYXRoKHBhdGgpIGFzIEVudGl0eTtcclxuICAgIHJldHVybiBlbnRpdHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU55qE5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGdldEVudGl0aWVzQnlQYXRoKHBhdGg6IHN0cmluZ1tdKTogRW50aXR5W10ge1xyXG4gICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbk9yTGlzdCA9IHRoaXMuZ2V0RW50aXR5Tm9kZUJ5UGF0aChwYXRoKSBhcyBFbnRpdHlDb2xsZWN0aW9uPEVudGl0eT4gfCBFbnRpdHlMaXN0PEVudGl0eT47XHJcbiAgICBsZXQgZW50aXRpZXM6IEVudGl0eVtdO1xyXG4gICAgaWYgKGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgaW5zdGFuY2VvZiBFbnRpdHlDb2xsZWN0aW9uID09PSB0cnVlKSB7XHJcbiAgICAgIGVudGl0aWVzID0gKGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5Q29sbGVjdGlvbjxFbnRpdHk+KS50b0FycmF5KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBlbnRpdGllcyA9IChlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGFzIEVudGl0eUxpc3Q8RW50aXR5PikudG9BcnJheSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVudGl0aWVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5a6e5L2T6IqC54K5XHJcbiAgICogQHBhcmFtIHBhdGgg6IqC54K56Lev5b6EXHJcbiAgICovXHJcbiAgcHVibGljIGdldEVudGl0eU5vZGVCeVBhdGgocGF0aDogc3RyaW5nW10pOiBFbnRpdHlDb2xsZWN0aW9uPEVudGl0eT4gfCBFbnRpdHlMaXN0PEVudGl0eT4gfCBFbnRpdHkge1xyXG4gICAgY29uc3QgZGF0YVBhdGggPSBEYXRhUGF0aENyZWF0b3IuY3JlYXRlQnlMb25nUGF0aEZyb21Sb290KHBhdGgsIHRoaXMpO1xyXG4gICAgbGV0IGVudGl0eU5vZGU6IGFueSA9IHRoaXMuZW50aXR5Q29sbGVjdGlvbjtcclxuICAgIGxldCBwYXRoTm9kZSA9IGRhdGFQYXRoLmhlYWQubmV4dDtcclxuICAgIHdoaWxlIChwYXRoTm9kZSkge1xyXG4gICAgICBpZiAocGF0aE5vZGUudHlwZSA9PT0gRGF0YVBhdGhOb2RlVHlwZS5EYXRhSWQpIHtcclxuICAgICAgICBpZiAoZW50aXR5Tm9kZSBpbnN0YW5jZW9mIEVudGl0eUNvbGxlY3Rpb24gPT09IHRydWUpIHtcclxuICAgICAgICAgIGVudGl0eU5vZGUgPSAoZW50aXR5Tm9kZSBhcyBFbnRpdHlDb2xsZWN0aW9uPEVudGl0eT4pLmdldEVudGl0eUJ5SWQocGF0aE5vZGUudmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBlbnRpdHlOb2RlID0gKGVudGl0eU5vZGUgYXMgRW50aXR5TGlzdDxFbnRpdHk+KS5nZXQocGF0aE5vZGUudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBlbnRpdHlOb2RlID0gZW50aXR5Tm9kZVtwYXRoTm9kZS52YWx1ZV07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFlbnRpdHlOb2RlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDmib7kuI3liLAke3BhdGhOb2RlLnZhbHVlfeWvueW6lOeahOaVsOaNruiKgueCuWApO1xyXG4gICAgICB9XHJcbiAgICAgIHBhdGhOb2RlID0gcGF0aE5vZGUubmV4dDtcclxuICAgIH1cclxuICAgIHJldHVybiBlbnRpdHlOb2RlO1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOiOt+WPluOAgeiuvue9ruWxnuaAp+WAvFxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU55qE5a6e5L2T5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHVibGljIGdldFByb3BWYWx1ZUJ5UGF0aChwYXRoOiBzdHJpbmdbXSk6IGFueSB7XHJcbiAgICBjb25zdCBwcm9wTmFtZSA9IHBhdGgucG9wKCk7XHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmdldEVudGl0eUJ5UGF0aChwYXRoKTtcclxuICAgIHJldHVybiBlbnRpdHlbcHJvcE5hbWVdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572ucGF0aOWvueW6lOWunuS9k+eahOWxnuaAp+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRQcm9wVmFsdWVCeVBhdGgocGF0aDogc3RyaW5nW10sIHByb3BWYWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBwcm9wTmFtZSA9IHBhdGgucG9wKCk7XHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLmdldEVudGl0eUJ5UGF0aChwYXRoKTtcclxuICAgIGVudGl0eVtwcm9wTmFtZV0gPSBwcm9wVmFsdWU7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOaPkuWFpeWunuS9k1xyXG5cclxuICAvKipcclxuICAgKiDlnKhwYXRo5a+55bqU5a6e5L2T5YmN5o+S5YWl5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydEVudGl0eUJlZm9yZUJ5UGF0aChmcGF0aDogc3RyaW5nW10pIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignTm90IEltcGxlbWVudGVkJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlnKhwYXRo5a+55bqU5a6e5L2T5YmN5om56YeP5o+S5YWl5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydEVudGl0aWVzQmVmb3JlQnlQYXRoKCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50ZWQnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWcqHBhdGjlr7nlupTlrp7kvZPliY3mj5LlhaXlrp7kvZNcclxuICAgKi9cclxuICBwdWJsaWMgaW5zZXJ0RW50aXR5QWZ0ZXJCeVBhdGgoKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBJbXBsZW1lbnRlZCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZyocGF0aOWvueW6lOWunuS9k+WJjeaJuemHj+aPkuWFpeWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpbnNlcnRFbnRpdGllc0FmdGVyQnlQYXRoKCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50ZWQnKTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24g6L+95Yqg5a6e5L2TXHJcblxyXG4gIC8qKlxyXG4gICAqIOWcqHBhdGjlr7nlupTnmoTlrp7kvZPpm4blkIjkuK3ov73liqAx5Liq5a6e5L2TXHJcbiAgICovXHJcbiAgLy8gcHVibGljIGFwcGVuZEVudGl0eUJ5UGF0aChmcGF0aDogc3RyaW5nW10sIGVudGl0eTogRW50aXR5KTogdm9pZCB7XHJcbiAgLy8gICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uT3JMaXN0ID0gdGhpcy5nZXRFbnRpdHlOb2RlQnlQYXRoKGZwYXRoKTtcclxuICAvLyAgIGlmIChlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGluc3RhbmNlb2YgRW50aXR5Q29sbGVjdGlvbiA9PT0gdHJ1ZSkge1xyXG4gIC8vICAgICBjb25zdCBlbnRpdHlDb2xsZWN0aW9uID0gZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlDb2xsZWN0aW9uPEVudGl0eT47XHJcbiAgLy8gICAgIGVudGl0eUNvbGxlY3Rpb24uYWRkRW50aXR5KGVudGl0eSk7XHJcbiAgLy8gICB9IGVsc2Uge1xyXG4gIC8vICAgICBjb25zdCBlbnRpdHlMaXN0ID0gKGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5TGlzdDxFbnRpdHk+KTtcclxuICAvLyAgICAgZW50aXR5TGlzdC5hcHBlbmRFbnRpdHkoZW50aXR5KTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrnBhdGjojrflj5blrp7kvZPpm4blkIhcclxuICAgKiBAcGFyYW0gZnBhdGgg6Lev5b6EIC9pZC9jaGlsZHNOb2RlL2lkL3h4eFxyXG4gICAqIEBwYXJhbSBlbnRpdHlEYXRhIOWunuS9k+aVsOaNrlxyXG4gICAqIEBwYXJhbSBpbml0aWFsRGF0YVvlj6/pgIldIOm7mOiupOWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmRFbnRpdHlCeVBhdGgoZnBhdGg6IHN0cmluZywgZW50aXR5RGF0YTogYW55LCBpbml0aWFsRGF0YT86IGFueSwgaXNDbG9uZWQ6IGJvb2xlYW4gPSBmYWxzZSk6IEVudGl0eSB7XHJcbiAgICBjb25zdCBzdWJQYXRocyA9IGZwYXRoLnNwbGl0KCcvJyk7XHJcbiAgICBpZiAoc3ViUGF0aHMubGVuZ3RoIDwgMykge1xyXG4gICAgICB0aHJvdyBFcnJvcihg5qC55o2ucGF0aOWIoOmZpOWunuS9k+aVsOaNruWHuumUmeS6huOAguS8oOWFpeeahHBhdGhbJHtmcGF0aH1d5qC85byP5LiN5a+5YCk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGNoaWxkRW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+O1xyXG4gICAgbGV0IHByb3BJbmZvOiB7IHByb3BUeXBlOiBzdHJpbmcsIHByb3BFbnRpdHlUeXBlOiBhbnkgfTtcclxuICAgIGxldCBwcm9wTmFtZTogc3RyaW5nO1xyXG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCBzdWJQYXRocy5sZW5ndGg7IGkgPSBpICsgMikge1xyXG4gICAgICBjb25zdCBmaWQgPSBzdWJQYXRoc1tpIC0gMV07XHJcbiAgICAgIHByb3BOYW1lID0gc3ViUGF0aHNbaV07XHJcblxyXG4gICAgICAvLyB0b2RvOiBFbnRpdHlDb2xsZWN0aW9u6YeN5p6E5LmL5ZCO6L+Z6YeM5peg6ZyA5beu5byC5aSE55CGXHJcbiAgICAgIGNvbnN0IHBhcmVudEVudGl0eSA9IGNoaWxkRW50aXR5TGlzdCA/IGNoaWxkRW50aXR5TGlzdC5nZXQoZmlkKSA6IHRoaXMuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGZpZCk7XHJcbiAgICAgIGNoaWxkRW50aXR5TGlzdCA9IHBhcmVudEVudGl0eVtwcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSBwcm9wSW5mbyA/IHByb3BJbmZvLnByb3BFbnRpdHlUeXBlIDogdGhpcy5lbnRpdHlUeXBlO1xyXG4gICAgICBwcm9wSW5mbyA9IEVudGl0eVV0aWwuZ2V0UHJvcEluZm8oZW50aXR5VHlwZSwgcHJvcE5hbWUpO1xyXG4gICAgICBpZiAoIWNoaWxkRW50aXR5TGlzdCkge1xyXG4gICAgICAgIHRocm93IEVycm9yKGBmcGF0aOWPguaVsOmUmeivr++8jOaXoOazleaJvuWIsCR7cHJvcE5hbWV95a+55bqU55qE5a2Q6KGo44CCZnBhdGjkuLrvvJoke2ZwYXRofWApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY29uc3QgcHJvcEluZm8gPSBFbnRpdHlVdGlsLmdldFByb3BJbmZvKHRoaXMuZW50aXR5VHlwZSwgcHJvcE5hbWUpO1xyXG4gICAgY29uc3QgY2hpbGRFbnRpdHkgPSBjcmVhdGVFbnRpdHk8RW50aXR5Pihwcm9wSW5mby5wcm9wRW50aXR5VHlwZSwgZW50aXR5RGF0YSk7XHJcbiAgICAvLyDlnKjlrp7kvZPnmoTlrp7kvovkuIrlop7liqDpu5jorqTlgLzlsZ7mgKfvvIzku6Xkvr/lnKhjcmVhdGVCaW5kaW5nT2JqZWN05pe25a2Y5pS+6buY6K6k5YC8XHJcbiAgICAvLyBpZiAoaW5pdGlhbERhdGEpIHtcclxuICAgIC8vICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShjaGlsZEVudGl0eSwgaW5pdGlhbERhdGEpO1xyXG4gICAgLy8gfVxyXG4gICAgY2hpbGRFbnRpdHlMaXN0LmFwcGVuZE5ldyhjaGlsZEVudGl0eSwgaXNDbG9uZWQpO1xyXG5cclxuICAgIHJldHVybiBjaGlsZEVudGl0eTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Zyo5oyH5a6a5L2N572u5o+S5YWl5a6e5L2TXHJcbiAgICogQHBhcmFtIGZwYXRoIOeItui3r+W+hFxyXG4gICAqIEBwYXJhbSBlbnRpdHlEYXRhIOWunuS9k+aVsOaNrlxyXG4gICAqIEBwYXJhbSBpbml0aWFsRGF0YSDliJ3lp4vmlbDmja5cclxuICAgKiBAcGFyYW0gcG9zaXRpb24g5o+S5YWl5L2N572uXHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydEVudGl0eUJ5UGF0aChmcGF0aDogc3RyaW5nLCBlbnRpdHlEYXRhOiBhbnksIGluaXRpYWxEYXRhPzogYW55LCBwb3NpdGlvbj86IDEgfCAtMSkge1xyXG4gICAgY29uc3Qgc3ViUGF0aHMgPSBmcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgaWYgKHN1YlBhdGhzLmxlbmd0aCA8IDMpIHtcclxuICAgICAgdGhyb3cgRXJyb3IoYOagueaNrnBhdGjliKDpmaTlrp7kvZPmlbDmja7lh7rplJnkuobjgILkvKDlhaXnmoRwYXRoWyR7ZnBhdGh9XeagvOW8j+S4jeWvuWApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBjaGlsZEVudGl0eUxpc3Q6IEVudGl0eUxpc3Q8YW55PjtcclxuICAgIGxldCBwcm9wSW5mbzogeyBwcm9wVHlwZTogc3RyaW5nLCBwcm9wRW50aXR5VHlwZTogYW55IH07XHJcbiAgICBsZXQgcHJvcE5hbWU6IHN0cmluZztcclxuICAgIGZvciAobGV0IGkgPSAyOyBpIDwgc3ViUGF0aHMubGVuZ3RoOyBpID0gaSArIDIpIHtcclxuICAgICAgY29uc3QgZmlkID0gc3ViUGF0aHNbaSAtIDFdO1xyXG4gICAgICBwcm9wTmFtZSA9IHN1YlBhdGhzW2ldO1xyXG5cclxuICAgICAgLy8gdG9kbzogRW50aXR5Q29sbGVjdGlvbumHjeaehOS5i+WQjui/memHjOaXoOmcgOW3ruW8guWkhOeQhlxyXG4gICAgICBjb25zdCBwYXJlbnRFbnRpdHkgPSBjaGlsZEVudGl0eUxpc3QgPyBjaGlsZEVudGl0eUxpc3QuZ2V0KGZpZCkgOiB0aGlzLmVudGl0eUNvbGxlY3Rpb24uZ2V0RW50aXR5QnlJZChmaWQpO1xyXG4gICAgICBjaGlsZEVudGl0eUxpc3QgPSBwYXJlbnRFbnRpdHlbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBlbnRpdHlUeXBlID0gcHJvcEluZm8gPyBwcm9wSW5mby5wcm9wRW50aXR5VHlwZSA6IHRoaXMuZW50aXR5VHlwZTtcclxuICAgICAgcHJvcEluZm8gPSBFbnRpdHlVdGlsLmdldFByb3BJbmZvKGVudGl0eVR5cGUsIHByb3BOYW1lKTtcclxuICAgICAgaWYgKCFjaGlsZEVudGl0eUxpc3QpIHtcclxuICAgICAgICB0aHJvdyBFcnJvcihgZnBhdGjlj4LmlbDplJnor6/vvIzml6Dms5Xmib7liLAke3Byb3BOYW1lfeWvueW6lOeahOWtkOihqOOAgmZwYXRo5Li677yaJHtmcGF0aH1gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGNvbnN0IHByb3BJbmZvID0gRW50aXR5VXRpbC5nZXRQcm9wSW5mbyh0aGlzLmVudGl0eVR5cGUsIHByb3BOYW1lKTtcclxuICAgIGNvbnN0IGNoaWxkRW50aXR5ID0gY3JlYXRlRW50aXR5PEVudGl0eT4ocHJvcEluZm8ucHJvcEVudGl0eVR5cGUsIGVudGl0eURhdGEpO1xyXG4gICAgLy8g5Zyo5a6e5L2T55qE5a6e5L6L5LiK5aKe5Yqg6buY6K6k5YC85bGe5oCn77yM5Lul5L6/5ZyoY3JlYXRlQmluZGluZ09iamVjdOaXtuWtmOaUvum7mOiupOWAvFxyXG4gICAgLy8gaWYgKGluaXRpYWxEYXRhKSB7XHJcbiAgICAvLyAgIEVudGl0eVV0aWwuYXBwZW5kSW5pdGlhbERhdGEoY2hpbGRFbnRpdHksIGluaXRpYWxEYXRhKTtcclxuICAgIC8vIH1cclxuICAgIGNoaWxkRW50aXR5TGlzdC5pbnNlcnQoY2hpbGRFbnRpdHksIHBvc2l0aW9uKTtcclxuICAgIHJldHVybiBjaGlsZEVudGl0eTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZyocGF0aOWvueW6lOeahOWunuS9k+mbhuWQiOS4rei/veWKoOWkmuS4quWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmRFbnRpdGllc0J5UGF0aChmcGF0aDogc3RyaW5nW10sIGVudGl0aWVzOiBFbnRpdHlbXSkge1xyXG4gICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbk9yTGlzdCA9IHRoaXMuZ2V0RW50aXR5Tm9kZUJ5UGF0aChmcGF0aCk7XHJcbiAgICBpZiAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBpbnN0YW5jZW9mIEVudGl0eUNvbGxlY3Rpb24gPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbiA9IGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5Q29sbGVjdGlvbjxFbnRpdHk+O1xyXG4gICAgICBlbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGVudGl0eUxpc3QgPSAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlMaXN0PEVudGl0eT4pO1xyXG4gICAgICBlbnRpdHlMaXN0LmFwcGVuZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24g5Yig6Zmk5a6e5L2TXHJcblxyXG4gIC8qKlxyXG4gICAqIOS7jmZhcHRo5a+55bqU55qE5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkaWTlr7nlupTnmoTlrp7kvZNcclxuICAgKi9cclxuICAvLyBwdWJsaWMgcmVtb3ZlRW50aXR5QnlQYXRoKGZwYXRoOiBzdHJpbmdbXSwgaWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gIC8vICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbk9yTGlzdCA9IHRoaXMuZ2V0RW50aXR5Tm9kZUJ5UGF0aChmcGF0aCk7XHJcbiAgLy8gICBpZiAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBpbnN0YW5jZW9mIEVudGl0eUNvbGxlY3Rpb24gPT09IHRydWUpIHtcclxuICAvLyAgICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbiA9IGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5Q29sbGVjdGlvbjxFbnRpdHk+O1xyXG4gIC8vICAgICBlbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0eUJ5SWQoaWQpO1xyXG4gIC8vICAgfSBlbHNlIHtcclxuICAvLyAgICAgY29uc3QgZW50aXR5TGlzdCA9IChlbnRpdHlDb2xsZWN0aW9uT3JMaXN0IGFzIEVudGl0eUxpc3Q8RW50aXR5Pik7XHJcbiAgLy8gICAgIGVudGl0eUxpc3QucmVtb3ZlKGlkKTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNrnBhdGjojrflj5blrp7kvZPpm4blkIhcclxuICAgKiBAcGFyYW0gZnBhdGggcGF0aFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVFbnRpdHlCeVBhdGgoZnBhdGg6IHN0cmluZywgaWQ6IHN0cmluZykge1xyXG4gICAgY29uc3Qgc3ViUGF0aHMgPSBmcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgaWYgKHN1YlBhdGhzLmxlbmd0aCA8IDMpIHtcclxuICAgICAgdGhyb3cgRXJyb3IoYOagueaNrnBhdGjliKDpmaTlrp7kvZPmlbDmja7lh7rplJnkuobjgILkvKDlhaXnmoRwYXRoWyR7ZnBhdGh9XeagvOW8j+S4jeWvuWApO1xyXG4gICAgfVxyXG4gICAgbGV0IGNoaWxkRW50aXR5TGlzdDogRW50aXR5TGlzdDxhbnk+O1xyXG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCBzdWJQYXRocy5sZW5ndGg7IGkgPSBpICsgMikge1xyXG4gICAgICBjb25zdCBmaWQgPSBzdWJQYXRoc1tpIC0gMV07XHJcbiAgICAgIGNvbnN0IHByb3BOYW1lID0gc3ViUGF0aHNbaV07XHJcbiAgICAgIGNvbnN0IHBhcmVudEVudGl0eSA9IGNoaWxkRW50aXR5TGlzdCA/IGNoaWxkRW50aXR5TGlzdC5nZXQoZmlkKSA6IHRoaXMuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGZpZCk7XHJcbiAgICAgIGNoaWxkRW50aXR5TGlzdCA9IHBhcmVudEVudGl0eVtwcm9wTmFtZV07XHJcbiAgICAgIGlmICghY2hpbGRFbnRpdHlMaXN0KSB7XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoYGZwYXRo5Y+C5pWw6ZSZ6K+v77yM5peg5rOV5om+5YiwJHtwcm9wTmFtZX3lr7nlupTnmoTlrZDooajjgIJmcGF0aOS4uu+8miR7ZnBhdGh9YCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjaGlsZEVudGl0eUxpc3QucmVtb3ZlKGlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS7jmZhcHRo5a+55bqU55qE5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkaWRz5a+55bqU55qE5a6e5L2TXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUVudGl0aWVzQnlQYXRoKGZwYXRoOiBzdHJpbmdbXSwgaWRzOiBzdHJpbmdbXSk6IHZvaWQge1xyXG4gICAgLy8gY29uc3QgZW50aXR5Q29sbGVjdGlvbk9yTGlzdCA9IHRoaXMuZ2V0RW50aXR5Tm9kZUJ5UGF0aChmcGF0aCk7XHJcbiAgICAvLyBpZiAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBpbnN0YW5jZW9mIEVudGl0eUNvbGxlY3Rpb24gPT09IHRydWUpIHtcclxuICAgIC8vICAgY29uc3QgZW50aXR5Q29sbGVjdGlvbiA9IGVudGl0eUNvbGxlY3Rpb25Pckxpc3QgYXMgRW50aXR5Q29sbGVjdGlvbjxFbnRpdHk+O1xyXG4gICAgLy8gICBlbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0aWVzQnlJZHMoaWRzKTtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgIGNvbnN0IGVudGl0eUxpc3QgPSAoZW50aXR5Q29sbGVjdGlvbk9yTGlzdCBhcyBFbnRpdHlMaXN0PEVudGl0eT4pO1xyXG4gICAgLy8gICBlbnRpdHlMaXN0LnJlbW92ZShpZHMpO1xyXG4gICAgLy8gfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgSW1wbGVtZW50ZWQnKTtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDmuIXnqbrlj5jmm7Tpm4bnm7jlhbPmlrnms5VcclxuXHJcbiAgLyoqXHJcbiAgICog5riF56m65omA5pyJ5a6e5L2T55qE5Y+Y5pu06ZuGXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyQWxsRW50aXR5Q2hhbmdlcygpIHtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKTtcclxuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGVudGl0eS5jaGFuZ2VzLnNwbGljZSgwLCBlbnRpdHkuY2hhbmdlcy5sZW5ndGgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmuIXnqbppZOaMh+WumueahOWunuS9k+WPmOabtOmbhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhckVudGl0eUNoYW5nZXNCeUlkKGlkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcclxuICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGVudGl0eS5jaGFuZ2VzLnNwbGljZSgwLCBlbnRpdHkuY2hhbmdlcy5sZW5ndGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5riF56m6aWRz5pWw57uE5Lit5oyH5a6a55qE5a6e5L2T55qE5Y+Y5pu06ZuGXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyRW50aXR5Q2hhbmdlc0J5SWRzKGlkczogc3RyaW5nW10pOiB2b2lkIHtcclxuICAgIGlmICghaWRzIHx8IGlkcy5sZW5ndGggPCAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZHMuZm9yRWFjaCgoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICB0aGlzLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWQoaWQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOWPmOabtOmbhuajgOafpeebuOWFs+aWueazlVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6XmiYDmnInnmoTlrp7kvZPvvIzmmK/lkKbmnInmnKrmj5DkuqTnmoTlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgY2hlY2tBbGxFbnRpdHlDaGFuZ2VzKCk6IGJvb2xlYW4ge1xyXG5cclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKTtcclxuICAgIGNvbnN0IGhhc0NoYW5nZXMgPSBlbnRpdGllcy5zb21lKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICBpZiAoZW50aXR5LmNoYW5nZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaGFzQ2hhbmdlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpWlk5a+55bqU55qE5a6e5L2T77yM5piv5ZCm5pyJ5pyq5o+Q5Lqk55qE5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIGNoZWNrRW50aXR5Q2hhbmdlc0J5SWQoaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZW50aXR5ID0gdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVudGl0eS5jaGFuZ2VzLmxlbmd0aCA+IDA7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOS4jeinhOiMg+aWueazle+8jOW+heW6n+W8g1xyXG5cclxuICAvKipcclxuICAgKiDlvoXlup/lvINcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhckVudGl0eUNoYW5nZXNCeUFycmF5KGlkQXJyYXk6IHN0cmluZ1tdKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsZWFyRW50aXR5Q2hhbmdlc0J5SWRzKGlkQXJyYXkpO1xyXG4gIH1cclxuXHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgRW50aXR5TWFuYWdlciB9O1xyXG4iXX0=
import { ANNOTATIONS, PROP_METADATA } from './decorator';
//import { Cacheable, DefaultCacheProvider } from '../../cache';
/**
 * 元数据解析
 * 约束：
 * 1、类型装饰器：在某个类型上，某种类型的装饰器，只使用一次，不重复添加；
 * 2、属性装饰器：在某个属性上，某种类型的装饰器，只使用一次，不重复添加
 */
var MetadataUtil = /** @class */ (function () {
    function MetadataUtil() {
    }
    // ----------------------------------------
    // 类型元数据
    // ----------------------------------------
    /**
     * 获取类元数据
     * 返回结果形如：
     * [
     *   Injectable
     *   NgViewModel
     *   NgViewModel
     * ]
     */
    MetadataUtil.getClassMetadatas = function (constructor) {
        var metadatas = constructor[ANNOTATIONS];
        return metadatas;
    };
    /**
     * 获取某个class上的某种装饰器
     * 返回结果：NgViewModel
     */
    MetadataUtil.getClassMetadataByName = function (constructor, metadataName) {
        var metadata = this.getClassMetadataByNameWithTranslate(constructor, metadataName, null, null);
        return metadata;
    };
    MetadataUtil.getClassMetadataByNameWithTranslate = function (constructor, metadataName, translateService, keysToTranslate) {
        var allClassMetadatas = this.getClassMetadatas(constructor);
        if (!allClassMetadatas) {
            return null;
        }
        var metadata = allClassMetadatas.find(function (classMetadata) {
            return classMetadata.ngMetadataName === metadataName;
        });
        this.translateMetadataByName(metadata, translateService, keysToTranslate);
        return metadata;
    };
    // ----------------------------------------
    // 属性元数据
    // ----------------------------------------
    /**
     * 获取所有属性的所有元数据
     * 返回格式：
     * {
     *   propName1: [ NgDefaultValue, NgMaxLength, NgMinLength],
     *   propName2: [ NgDefaultValue, NgMaxLength, NgMinLength]
     * }
     */
    // @Cacheable({ key: ((context: any, args: any[]) => args[0]), provider: new DefaultCacheProvider() })
    MetadataUtil.getPropsMetadatas = function (constructor) {
        var allPropMetadatas = constructor[PROP_METADATA];
        return allPropMetadatas;
    };
    /**
     * 获取所有属性的某一类型的元数据
     * 如果同一属性
     * 返回结果：
     * {
     *    propName1: NgDefaultValue,
     *    propName2: NgDefaultValue
     * }
     */
    // @Cache({ provider: new MemoryCacheProvider(new MetadataKeyCompare()), key: ((context: any, args: any[]) => { return { constructor: args[0], metadataName: args[1] } }) })
    MetadataUtil.getPropsMetadatasByName = function (constructor, metadataName) {
        var metadatas = this.getPropsMetadatasByNameWithTranslate(constructor, metadataName);
        return metadatas;
    };
    MetadataUtil.getPropsMetadatasByNameWithTranslate = function (constructor, metadataName, translateService, keysToTranslate) {
        var metadatas = {};
        // 读取构造函数中存储的类属性注解。
        var allPropMetadatas = this.getPropsMetadatas(constructor);
        if (!allPropMetadatas) {
            return metadatas;
        }
        // 遍历所有属性提取注解信息。
        Object.keys(allPropMetadatas).forEach(function (propName) {
            // 提取当前属性注解对象
            var propMetadatas = allPropMetadatas[propName];
            // 提取指定类型的注解项
            var metadata = propMetadatas.find(function (propMetadata) {
                return propMetadata.ngMetadataName === metadataName;
            });
            if (metadata) {
                metadatas[propName] = metadata;
            }
        });
        // 翻译指定属性的值
        this.translateMetadatasByName(metadatas, translateService, keysToTranslate);
        return metadatas;
    };
    MetadataUtil.translateMetadatasByName = function (metadatas, translateService, keysToTranslate) {
        var _this = this;
        Object.keys(metadatas).forEach(function (propName) {
            // 提取指定类型的注解项
            _this.translateMetadataByName(metadatas[propName], translateService, keysToTranslate);
        });
        return metadatas;
    };
    MetadataUtil.translateMetadataByName = function (metadata, translateService, keysToTranslate) {
        if (metadata && translateService && keysToTranslate) {
            keysToTranslate.forEach(function (metadataPropKey) {
                var propertyVariable = metadata[metadataPropKey];
                try {
                    if (propertyVariable && propertyVariable.startsWith('{{') && propertyVariable.endsWith('}}')) {
                        var translateKey = propertyVariable.replace('{{', '').replace('}}', '').trim();
                        metadata[metadataPropKey] = translateService.transform(translateKey, null);
                    }
                }
                catch (e) {
                    console.info(e);
                }
            });
        }
        return metadata;
    };
    /**
     * 获取某个属性的所有元数据
     * 返回格式：[ NgDefaultValue, NgMaxLength, NgMinLength]
     */
    MetadataUtil.getPropMetadatasByName = function (constructor, propName) {
        // 暂不实现
        return null;
    };
    /**
     * 获取某个属性的某种元数据
     * 返回格式：NgDefaultValue
     */
    MetadataUtil.getPropMetadataByName = function (constructor, propName, metadataName) {
        // 暂不实现
        return null;
    };
    return MetadataUtil;
}());
export { MetadataUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YWRhdGFfdXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL21ldGFkYXRhL2RlY29yYXRvci9tZXRhZGF0YV91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXpELGdFQUFnRTtBQUVoRTs7Ozs7R0FLRztBQUNIO0lBQUE7SUFzSkEsQ0FBQztJQXBKQywyQ0FBMkM7SUFDM0MsUUFBUTtJQUNSLDJDQUEyQztJQUUzQzs7Ozs7Ozs7T0FRRztJQUNJLDhCQUFpQixHQUF4QixVQUF5QixXQUFnQjtRQUN2QyxJQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDM0MsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLG1DQUFzQixHQUE3QixVQUE4QixXQUFnQixFQUFFLFlBQW9CO1FBQ2xFLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxXQUFXLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqRyxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRU0sZ0RBQW1DLEdBQTFDLFVBQ0UsV0FBZ0IsRUFBRSxZQUFvQixFQUN0QyxnQkFBNEIsRUFBRSxlQUEwQjtRQUN4RCxJQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5RCxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDdEIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELElBQU0sUUFBUSxHQUFHLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFDLGFBQWtCO1lBQ3pELE9BQU8sYUFBYSxDQUFDLGNBQWMsS0FBSyxZQUFZLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsdUJBQXVC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R0FBRyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxDQUFDO3FCQUM1RTtpQkFDQTtnQkFBQyxPQUFPLENBQUMsRUFBRTtvQkFDVixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUNqQjtZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksbUNBQXNCLEdBQTdCLFVBQThCLFdBQWdCLEVBQUUsUUFBZ0I7UUFDOUQsT0FBTztRQUNQLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOzs7T0FHRztJQUNJLGtDQUFxQixHQUE1QixVQUE2QixXQUFnQixFQUFFLFFBQWdCLEVBQUUsWUFBb0I7UUFDbkYsT0FBTztRQUNQLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQU9ILG1CQUFDO0FBQUQsQ0FBQyxBQXRKRCxJQXNKQztBQUVELE9BQU8sRUFBRSxZQUFZLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFOTk9UQVRJT05TLCBQUk9QX01FVEFEQVRBIH0gZnJvbSAnLi9kZWNvcmF0b3InO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGUgfSBmcm9tICcuLi8uLi9pMThuJztcclxuLy9pbXBvcnQgeyBDYWNoZWFibGUsIERlZmF1bHRDYWNoZVByb3ZpZGVyIH0gZnJvbSAnLi4vLi4vY2FjaGUnO1xyXG5cclxuLyoqXHJcbiAqIOWFg+aVsOaNruino+aekFxyXG4gKiDnuqbmnZ/vvJpcclxuICogMeOAgeexu+Wei+ijhemlsOWZqO+8muWcqOafkOS4quexu+Wei+S4iu+8jOafkOenjeexu+Wei+eahOijhemlsOWZqO+8jOWPquS9v+eUqOS4gOasoe+8jOS4jemHjeWkjea3u+WKoO+8m1xyXG4gKiAy44CB5bGe5oCn6KOF6aWw5Zmo77ya5Zyo5p+Q5Liq5bGe5oCn5LiK77yM5p+Q56eN57G75Z6L55qE6KOF6aWw5Zmo77yM5Y+q5L2/55So5LiA5qyh77yM5LiN6YeN5aSN5re75YqgXHJcbiAqL1xyXG5jbGFzcyBNZXRhZGF0YVV0aWwge1xyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgLy8g57G75Z6L5YWD5pWw5o2uXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bnsbvlhYPmlbDmja5cclxuICAgKiDov5Tlm57nu5PmnpzlvaLlpoLvvJpcclxuICAgKiBbXHJcbiAgICogICBJbmplY3RhYmxlXHJcbiAgICogICBOZ1ZpZXdNb2RlbFxyXG4gICAqICAgTmdWaWV3TW9kZWxcclxuICAgKiBdXHJcbiAgICovXHJcbiAgc3RhdGljIGdldENsYXNzTWV0YWRhdGFzKGNvbnN0cnVjdG9yOiBhbnkpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YXMgPSBjb25zdHJ1Y3RvcltBTk5PVEFUSU9OU107XHJcbiAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5p+Q5LiqY2xhc3PkuIrnmoTmn5Dnp43oo4XppbDlmahcclxuICAgKiDov5Tlm57nu5PmnpzvvJpOZ1ZpZXdNb2RlbFxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXRDbGFzc01ldGFkYXRhQnlOYW1lKGNvbnN0cnVjdG9yOiBhbnksIG1ldGFkYXRhTmFtZTogc3RyaW5nKTogYW55IHtcclxuICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5nZXRDbGFzc01ldGFkYXRhQnlOYW1lV2l0aFRyYW5zbGF0ZShjb25zdHJ1Y3RvciwgbWV0YWRhdGFOYW1lLCBudWxsLCBudWxsKTtcclxuICAgIHJldHVybiBtZXRhZGF0YTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXRDbGFzc01ldGFkYXRhQnlOYW1lV2l0aFRyYW5zbGF0ZShcclxuICAgIGNvbnN0cnVjdG9yOiBhbnksIG1ldGFkYXRhTmFtZTogc3RyaW5nLFxyXG4gICAgdHJhbnNsYXRlU2VydmljZT86IFRyYW5zbGF0ZSwga2V5c1RvVHJhbnNsYXRlPzogc3RyaW5nW10pOiBhbnkge1xyXG4gICAgY29uc3QgYWxsQ2xhc3NNZXRhZGF0YXMgPSB0aGlzLmdldENsYXNzTWV0YWRhdGFzKGNvbnN0cnVjdG9yKTtcclxuICAgIGlmICghYWxsQ2xhc3NNZXRhZGF0YXMpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZXRhZGF0YSA9IGFsbENsYXNzTWV0YWRhdGFzLmZpbmQoKGNsYXNzTWV0YWRhdGE6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gY2xhc3NNZXRhZGF0YS5uZ01ldGFkYXRhTmFtZSA9PT0gbWV0YWRhdGFOYW1lO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnRyYW5zbGF0ZU1ldGFkYXRhQnlOYW1lKG1ldGFkYXRhLCB0cmFuc2xhdGVTZXJ2aWNlLCBrZXlzVG9UcmFuc2xhdGUpO1xyXG4gICAgcmV0dXJuIG1ldGFkYXRhO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIOWxnuaAp+WFg+aVsOaNrlxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5omA5pyJ5bGe5oCn55qE5omA5pyJ5YWD5pWw5o2uXHJcbiAgICog6L+U5Zue5qC85byP77yaXHJcbiAgICoge1xyXG4gICAqICAgcHJvcE5hbWUxOiBbIE5nRGVmYXVsdFZhbHVlLCBOZ01heExlbmd0aCwgTmdNaW5MZW5ndGhdLFxyXG4gICAqICAgcHJvcE5hbWUyOiBbIE5nRGVmYXVsdFZhbHVlLCBOZ01heExlbmd0aCwgTmdNaW5MZW5ndGhdXHJcbiAgICogfVxyXG4gICAqL1xyXG4gICAvLyBAQ2FjaGVhYmxlKHsga2V5OiAoKGNvbnRleHQ6IGFueSwgYXJnczogYW55W10pID0+IGFyZ3NbMF0pLCBwcm92aWRlcjogbmV3IERlZmF1bHRDYWNoZVByb3ZpZGVyKCkgfSlcclxuICBzdGF0aWMgZ2V0UHJvcHNNZXRhZGF0YXMoY29uc3RydWN0b3I6IGFueSk6IGFueSB7XHJcbiAgICBjb25zdCBhbGxQcm9wTWV0YWRhdGFzID0gY29uc3RydWN0b3JbUFJPUF9NRVRBREFUQV07XHJcbiAgICByZXR1cm4gYWxsUHJvcE1ldGFkYXRhcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaJgOacieWxnuaAp+eahOafkOS4gOexu+Wei+eahOWFg+aVsOaNrlxyXG4gICAqIOWmguaenOWQjOS4gOWxnuaAp1xyXG4gICAqIOi/lOWbnue7k+aenO+8mlxyXG4gICAqIHtcclxuICAgKiAgICBwcm9wTmFtZTE6IE5nRGVmYXVsdFZhbHVlLFxyXG4gICAqICAgIHByb3BOYW1lMjogTmdEZWZhdWx0VmFsdWVcclxuICAgKiB9XHJcbiAgICovXHJcbiAgLy8gQENhY2hlKHsgcHJvdmlkZXI6IG5ldyBNZW1vcnlDYWNoZVByb3ZpZGVyKG5ldyBNZXRhZGF0YUtleUNvbXBhcmUoKSksIGtleTogKChjb250ZXh0OiBhbnksIGFyZ3M6IGFueVtdKSA9PiB7IHJldHVybiB7IGNvbnN0cnVjdG9yOiBhcmdzWzBdLCBtZXRhZGF0YU5hbWU6IGFyZ3NbMV0gfSB9KSB9KVxyXG4gIHN0YXRpYyBnZXRQcm9wc01ldGFkYXRhc0J5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBtZXRhZGF0YU5hbWU6IHN0cmluZyk6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICBjb25zdCBtZXRhZGF0YXMgPSB0aGlzLmdldFByb3BzTWV0YWRhdGFzQnlOYW1lV2l0aFRyYW5zbGF0ZShjb25zdHJ1Y3RvciwgbWV0YWRhdGFOYW1lKTtcclxuICAgIHJldHVybiBtZXRhZGF0YXM7XHJcbiAgfVxyXG4gIHN0YXRpYyBnZXRQcm9wc01ldGFkYXRhc0J5TmFtZVdpdGhUcmFuc2xhdGUoXHJcbiAgICBjb25zdHJ1Y3RvcjogYW55LCBtZXRhZGF0YU5hbWU6IHN0cmluZyxcclxuICAgIHRyYW5zbGF0ZVNlcnZpY2U/OiBUcmFuc2xhdGUsIGtleXNUb1RyYW5zbGF0ZT86IHN0cmluZ1tdKTogeyBbcHJvcE5hbWU6IHN0cmluZ106IGFueSB9IHtcclxuICAgIGNvbnN0IG1ldGFkYXRhcyA9IHt9O1xyXG4gICAgLy8g6K+75Y+W5p6E6YCg5Ye95pWw5Lit5a2Y5YKo55qE57G75bGe5oCn5rOo6Kej44CCXHJcbiAgICBjb25zdCBhbGxQcm9wTWV0YWRhdGFzID0gdGhpcy5nZXRQcm9wc01ldGFkYXRhcyhjb25zdHJ1Y3Rvcik7XHJcbiAgICBpZiAoIWFsbFByb3BNZXRhZGF0YXMpIHtcclxuICAgICAgcmV0dXJuIG1ldGFkYXRhcztcclxuICAgIH1cclxuICAgIC8vIOmBjeWOhuaJgOacieWxnuaAp+aPkOWPluazqOino+S/oeaBr+OAglxyXG4gICAgT2JqZWN0LmtleXMoYWxsUHJvcE1ldGFkYXRhcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAvLyDmj5Dlj5blvZPliY3lsZ7mgKfms6jop6Plr7nosaFcclxuICAgICAgY29uc3QgcHJvcE1ldGFkYXRhczogYW55W10gPSBhbGxQcm9wTWV0YWRhdGFzW3Byb3BOYW1lXTtcclxuICAgICAgLy8g5o+Q5Y+W5oyH5a6a57G75Z6L55qE5rOo6Kej6aG5XHJcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gcHJvcE1ldGFkYXRhcy5maW5kKChwcm9wTWV0YWRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBwcm9wTWV0YWRhdGEubmdNZXRhZGF0YU5hbWUgPT09IG1ldGFkYXRhTmFtZTtcclxuICAgICAgfSk7XHJcbiAgICAgIGlmIChtZXRhZGF0YSkge1xyXG4gICAgICAgIG1ldGFkYXRhc1twcm9wTmFtZV0gPSBtZXRhZGF0YTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyDnv7vor5HmjIflrprlsZ7mgKfnmoTlgLxcclxuICAgIHRoaXMudHJhbnNsYXRlTWV0YWRhdGFzQnlOYW1lKG1ldGFkYXRhcywgdHJhbnNsYXRlU2VydmljZSwga2V5c1RvVHJhbnNsYXRlKTtcclxuICAgIHJldHVybiBtZXRhZGF0YXM7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgdHJhbnNsYXRlTWV0YWRhdGFzQnlOYW1lKG1ldGFkYXRhczogYW55LCB0cmFuc2xhdGVTZXJ2aWNlPzogVHJhbnNsYXRlLCBrZXlzVG9UcmFuc2xhdGU/OiBzdHJpbmdbXSlcclxuICAgIDogeyBbcHJvcE5hbWU6IHN0cmluZ106IGFueSB9IHtcclxuICAgIE9iamVjdC5rZXlzKG1ldGFkYXRhcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAvLyDmj5Dlj5bmjIflrprnsbvlnovnmoTms6jop6PpoblcclxuICAgICAgdGhpcy50cmFuc2xhdGVNZXRhZGF0YUJ5TmFtZShtZXRhZGF0YXNbcHJvcE5hbWVdLCB0cmFuc2xhdGVTZXJ2aWNlLCBrZXlzVG9UcmFuc2xhdGUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWV0YWRhdGFzO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHRyYW5zbGF0ZU1ldGFkYXRhQnlOYW1lKG1ldGFkYXRhOiBhbnksIHRyYW5zbGF0ZVNlcnZpY2U/OiBUcmFuc2xhdGUsIGtleXNUb1RyYW5zbGF0ZT86IHN0cmluZ1tdKTogYW55IHtcclxuICAgIGlmIChtZXRhZGF0YSAmJiB0cmFuc2xhdGVTZXJ2aWNlICYmIGtleXNUb1RyYW5zbGF0ZSkge1xyXG4gICAgICBrZXlzVG9UcmFuc2xhdGUuZm9yRWFjaCgobWV0YWRhdGFQcm9wS2V5KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlWYXJpYWJsZTogc3RyaW5nID0gbWV0YWRhdGFbbWV0YWRhdGFQcm9wS2V5XTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgIGlmIChwcm9wZXJ0eVZhcmlhYmxlICYmIHByb3BlcnR5VmFyaWFibGUuc3RhcnRzV2l0aCgne3snKSAmJiBwcm9wZXJ0eVZhcmlhYmxlLmVuZHNXaXRoKCd9fScpKSB7XHJcbiAgICAgICAgICBjb25zdCB0cmFuc2xhdGVLZXkgPSBwcm9wZXJ0eVZhcmlhYmxlLnJlcGxhY2UoJ3t7JywgJycpLnJlcGxhY2UoJ319JywgJycpLnRyaW0oKTtcclxuICAgICAgICAgIG1ldGFkYXRhW21ldGFkYXRhUHJvcEtleV0gPSB0cmFuc2xhdGVTZXJ2aWNlLnRyYW5zZm9ybSh0cmFuc2xhdGVLZXksIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmluZm8oZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBtZXRhZGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluafkOS4quWxnuaAp+eahOaJgOacieWFg+aVsOaNrlxyXG4gICAqIOi/lOWbnuagvOW8j++8mlsgTmdEZWZhdWx0VmFsdWUsIE5nTWF4TGVuZ3RoLCBOZ01pbkxlbmd0aF1cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0UHJvcE1ldGFkYXRhc0J5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBwcm9wTmFtZTogc3RyaW5nKTogYW55W10ge1xyXG4gICAgLy8g5pqC5LiN5a6e546wXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluafkOS4quWxnuaAp+eahOafkOenjeWFg+aVsOaNrlxyXG4gICAqIOi/lOWbnuagvOW8j++8mk5nRGVmYXVsdFZhbHVlXHJcbiAgICovXHJcbiAgc3RhdGljIGdldFByb3BNZXRhZGF0YUJ5TmFtZShjb25zdHJ1Y3RvcjogYW55LCBwcm9wTmFtZTogc3RyaW5nLCBtZXRhZGF0YU5hbWU6IHN0cmluZyk6IGFueSB7XHJcbiAgICAvLyDmmoLkuI3lrp7njrBcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvLyDlj4LmlbDlhYPmlbDmja5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBNZXRhZGF0YVV0aWwgfTtcclxuIl19
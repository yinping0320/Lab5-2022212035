import * as tslib_1 from "tslib";
import { Subject } from 'rxjs';
import { ChangeSet } from '../changeset';
import { SchemaEntityField$Type } from '../schema/schema';
import { EntityList } from './entity_list';
import { entityPrototype } from './entity_prototype';
import { NG_FIELD, NG_LIST, NG_OBJECT } from './metadata';
import { PARENT_CLASS, PARENT_PATH } from './types';
import { Validator } from './validator';
import { ValidationUtils } from './validator/validation_utils';
import { UserSettingsService } from '../i18n/user_settings_service';
import { ZonedTime } from '../i18n/zoned_time';
/**
 * 实体类型工厂
 * 用来根据实体Schema描述信息创建实体类型
 */
var EntityTypeFactory = /** @class */ (function () {
    function EntityTypeFactory() {
    }
    /**
     * 由实体Schema结构创建实体类型
     * @param schema 实体Schema结构
     * @returns 实体类型
     */
    EntityTypeFactory.prototype.create = function (schema) {
        // 提取Schema定义中的第一个是实体描述
        var schemaType = schema.entities[0].type;
        // 创建实体类型
        var entityType = this.createClass(schemaType, schema.entities[0]);
        return entityType;
    };
    /**
     * 由实体Schema类型描述创建实体类
     * @param schemaType Schema实体类型描述
     * @returns 实体类型
     */
    EntityTypeFactory.prototype.createClass = function (schemaType, relateSchema) {
        var attachEntityInstanceData = this.createEntityInstanceDataInitializer(schemaType);
        // 创建指定实体类型的初始化函数，用来在实体类型构造函数中为实体实例赋值
        var initialize = function (entityInstance, entityData, entityTypeConstructor) {
            entityInstance.isInitializing = true;
            attachEntityInstanceData(entityInstance, entityData, entityTypeConstructor);
            entityInstance.isInitializing = false;
        };
        // 声明实体类构造函数
        var ConcreteEntity = function (data) {
            var _this = this;
            // 创建实体变更集
            this.changeSet = new ChangeSet();
            // 初始化实体验证状态
            this.isValidating = false;
            // 设置unsubscribe 取消订阅事件
            this.unsubscribe = new Subject();
            // 初始化实体验证信息
            this.validErrors = {};
            // 初始化验证器
            this.validator = new Validator();
            // 初始化实体数据副本
            this.innerData = Object.assign({}, data);
            // 初始化子实体对象集合
            this.innerEntities = {};
            // 初始化实体值变化事件
            this.valueChanged = new Subject();
            this.onValueChanged = this.valueChanged;
            this.validateFromUtilSync = function (propertyName, value, cb, context) {
                this.validErrors = {};
                var result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
                if (result && !result.isValid) {
                    this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
                }
                cb(result);
            };
            // 调用初始化方法，初始化实体数据
            initialize(this, data, ConcreteEntity);
            this.load = function (newData) {
                attachEntityInstanceData(_this, newData, ConcreteEntity);
                _this.data = newData;
            };
        };
        // 在实体类构造函数中记录视图类型名称
        ConcreteEntity.typeName = schemaType.name + "Entity";
        ConcreteEntity.code = relateSchema.code;
        ConcreteEntity.label = relateSchema.label;
        // 在实体类构造函数中记录其下直接引用的子类型
        ConcreteEntity.types = {};
        ConcreteEntity.__prop__metadata__ = {};
        // 构造实体类的原型对象
        var entityTypePrototype = Object.assign({ typeName: 'ConcreteEntityPrototype' }, entityPrototype);
        // 向实体类原型对象中定义预制属性
        this.definePresetProperty(entityTypePrototype, schemaType);
        // 向实体类原型对象中定义字段属性get/set方法
        this.defineFieldsToPrototype(entityTypePrototype, schemaType.fields, schemaType.primary, ConcreteEntity);
        // 向实体类原型对象中定义访问子实体的get/set方法
        this.defineEntitiesToPrototype(entityTypePrototype, schemaType.entities, ConcreteEntity);
        // 将实体类的原型对象指向新构造的原型对象。
        ConcreteEntity.prototype = entityTypePrototype;
        return ConcreteEntity;
    };
    /**
     * 向实体类原型对象中定义预制属性
     * @param prototypeObject 实体类原型对象
     * @param schemaType Schema类型描述
     */
    EntityTypeFactory.prototype.definePresetProperty = function (prototypeObject, schemaType) {
        /**
         * 实体数据
         */
        Object.defineProperty(prototypeObject, 'data', {
            get: function () {
                if (!this.innerData) {
                    this.innerData = {};
                }
                return this.innerData;
            },
            set: function (value) {
                this.innerData = value;
            }
        });
        /**
         * 实体验证信息
         */
        Object.defineProperty(prototypeObject, 'errors', {
            get: function () {
                return this.validErrors;
            },
            set: function (errors) {
                this.validErrors = errors;
            }
        });
        /**
         * 实体变更集
         */
        Object.defineProperty(prototypeObject, 'changes', {
            get: function () {
                return this.changeSet.changes;
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryProperty', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                // return schemaType.primary;
                return prototypeObject.innerPrimaryProperty || { dataField: schemaType.primary };
            }
        });
        /**
         * 实体主键
         */
        Object.defineProperty(prototypeObject, 'primaryKey', {
            // tslint:disable-next-line: only-arrow-functions
            get: function () {
                return schemaType.primary || '';
            }
        });
        /**
         * 实体主键的值
         */
        Object.defineProperty(prototypeObject, 'primaryValue', {
            get: function () {
                if (this.primaryKey) {
                    // return this[this.primaryProperty.property].toString();
                    var primaryValue = this[this.primaryKey];
                    return primaryValue ? primaryValue : '';
                }
                else {
                    return '';
                }
            }
        });
    };
    /**
     * 向实体类定义字段属性
     * @param prototypeObject 实体类原型对象
     * @param fields 字段描述集合
     * @param parentEntityType 父类型
     */
    EntityTypeFactory.prototype.defineFieldsToPrototype = function (prototypeObject, fields, primary, parentEntityType) {
        var _this = this;
        if (fields && fields.length) {
            // 遍历Schema中描述的字段，在实体原型对象上定义字段访问函数
            fields.forEach(function (schemaEntityField) {
                switch (schemaEntityField.$type) {
                    // 定义简单类型字段
                    case SchemaEntityField$Type.SimpleField:
                        _this.defineSimpleFieldToPrototype(prototypeObject, schemaEntityField, primary, parentEntityType);
                        break;
                    // 定义复杂类型字段
                    case SchemaEntityField$Type.ComplexField:
                        _this.defineComplexFieldToPrototype(prototypeObject, schemaEntityField, parentEntityType);
                        break;
                }
            });
        }
    };
    /**
     * 向实体类定义简单类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     */
    EntityTypeFactory.prototype.defineSimpleFieldToPrototype = function (prototypeObject, schemaField, primary, parentEntityType) {
        var propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                return this.getFieldValue(schemaField);
            },
            set: function (newPropValue) {
                // 值相同时不触发变更。
                var oldPropValue = this.getFieldValue(schemaField);
                if (this.isFieldValueChanged(schemaField, newPropValue, oldPropValue) === false) {
                    return;
                }
                this.setFieldValue(schemaField, newPropValue);
                this.emitFieldValueChange(schemaField, newPropValue, oldPropValue);
            }
        });
        var fieldMetadata = {
            /** 字段名称 */
            dataField: this.getDataField(schemaField),
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 原始字段类型 */
            originalDataFieldType: schemaField.type.name,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            primary: schemaField.label === primary,
            enableMultiLangInput: this.getEnableMultiLangInput(schemaField),
            defaultValue: schemaField.defaultValue,
            ngMetadataName: NG_FIELD
        };
        if (schemaField['enableStdTimeFormat'] && fieldMetadata.originalDataFieldType == "DateTime") {
            fieldMetadata["enableTimeZone"] = true;
        }
        if (fieldMetadata.primary) {
            prototypeObject.innerPrimaryProperty = fieldMetadata;
        }
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    };
    EntityTypeFactory.prototype.getDataField = function (schemaField) {
        if (schemaField.multiLanguage) {
            return schemaField.label + "_" + "MULTILANGUAGE";
        }
        return schemaField.label;
    };
    EntityTypeFactory.prototype.getEnableMultiLangInput = function (schemaField) {
        if (schemaField.multiLanguage) {
            return true;
        }
    };
    /**
     * 向实体类定义复杂类型字段
     * @param prototypeObject 实体类原型对象
     * @param schemaField 字段描述
     * @param parentEntityType 父类型
     */
    EntityTypeFactory.prototype.defineComplexFieldToPrototype = function (prototypeObject, schemaField, parentEntityType) {
        var complexFieldType = this.createClass(schemaField.type, schemaField);
        parentEntityType.types[schemaField.type.name] = complexFieldType;
        var propertyName = schemaField.label;
        Object.defineProperty(prototypeObject, propertyName, {
            get: function () {
                var fieldValue = this.getComplexFieldValue(schemaField);
                return fieldValue;
            },
            set: function (value) {
                this.setComplexFieldValue(schemaField, complexFieldType, value);
            }
        });
        var fieldMetadata = {
            /** 映射字段 */
            dataField: schemaField.label,
            /** 原始字段名称 */
            originalDataField: schemaField.code,
            /** 引用实体类型 */
            type: complexFieldType,
            /**
             * 原始字段
             * @description 对应到scheme的path属性
             */
            path: schemaField.path,
            ngMetadataName: NG_OBJECT
        };
        if (!parentEntityType.__prop__metadata__[propertyName]) {
            parentEntityType.__prop__metadata__[propertyName] = [];
        }
        parentEntityType.__prop__metadata__[propertyName].push(fieldMetadata);
    };
    /**
     * 向实体类定义子实体
     * @param prototypeObject 实体类原型对象
     * @param entities 实体描述集合
     * @param parentEntityType 父类型
     */
    EntityTypeFactory.prototype.defineEntitiesToPrototype = function (prototypeObject, entities, parentEntityType) {
        var _this = this;
        if (entities && entities.length) {
            // 遍历Schema中描述的子实体，在实体对象上定义子实体列表
            entities.forEach(function (schemaEntity) {
                var complexFieldType = _this.createClass(schemaEntity.type, schemaEntity);
                parentEntityType.types[schemaEntity.type.name] = complexFieldType;
                // 提取子实体在实体对象上的属性名
                var propertyName = schemaEntity.label;
                Object.defineProperty(prototypeObject, propertyName, {
                    get: function () {
                        var fieldValue = this.getEntities(schemaEntity);
                        return fieldValue;
                    },
                    set: function (value) {
                        this.setEntities(schemaEntity, value);
                    }
                });
                var entitMetadata = {
                    /** 字段名称 */
                    dataField: schemaEntity.label,
                    /** 原始字段名称 */
                    originalDataField: '',
                    /** 实体类型 */
                    type: complexFieldType,
                    ngMetadataName: NG_LIST
                };
                if (!parentEntityType.__prop__metadata__[propertyName]) {
                    parentEntityType.__prop__metadata__[propertyName] = [];
                }
                parentEntityType.__prop__metadata__[propertyName].push(entitMetadata);
            });
        }
    };
    /**
     * 创建初始化实体对象方法
     * @param schemaType 实体类型描述
     * @returns 初始化实体对象方法
     */
    EntityTypeFactory.prototype.createEntityInstanceDataInitializer = function (schemaType) {
        /**
         * 实体初始化函数，用来初始化实体的复杂类型数据和子实体数据
         * @param entityInstance 实体类型实例
         * @param data 实体原始数据
         * @param entityTypeConstructor 实体类型构造函数
         */
        var initializer = function (entityInstance, entityData, entityTypeConstructor) {
            // 初始化复杂类型字段
            schemaType.fields
                // 过滤复杂类型字段
                .filter(function (field) { return field.$type === SchemaEntityField$Type.ComplexField; })
                // 遍历复杂类型字段创建对应实体类型数据
                .forEach(function (field) {
                // 提取字段名
                var fieldName = field.label;
                // 提取实体类型下的所有子实体类型
                var includedEntityTypes = entityTypeConstructor.types;
                // 获取复杂类型字段对应的实体类型
                var ComplexField = includedEntityTypes[field.type.name];
                // 提取复杂类型字段原始数据
                var fieldData = entityData ? entityData[fieldName] : null;
                // 创建复杂类型字段对象路径
                var path = entityInstance.createPath(fieldName);
                var complexFieldValue = entityInstance[fieldName];
                if (complexFieldValue instanceof ComplexField) {
                    complexFieldValue.load(fieldData);
                }
                else {
                    // 创建复杂类型字段实体实例
                    complexFieldValue = new ComplexField(fieldData);
                    complexFieldValue.constructor = ComplexField;
                    complexFieldValue[PARENT_CLASS] = entityInstance;
                    complexFieldValue[PARENT_PATH] = path;
                    complexFieldValue.onValueChanged.subscribe(function (changes) {
                        if (changes) {
                            changes.path = (entityInstance[PARENT_PATH] || []).concat(changes.path);
                            var modification = tslib_1.__assign({}, changes, { fromParent: true });
                            entityInstance.setChanges(modification);
                        }
                    });
                    entityInstance[fieldName] = complexFieldValue;
                }
            });
            // 初始化子实体
            if (schemaType.entities) {
                // 遍历子实体创建对应实体类型的数据
                schemaType.entities.forEach(function (schemaEntity) {
                    // 提取子实体名
                    var subEntityName = schemaEntity.label;
                    // 提取实体类型下的所有子实体类型
                    var includedEntityTypes = entityTypeConstructor.types;
                    // 创建子实体对象路径
                    var path = entityInstance.createPath(subEntityName);
                    // 创建子实体对象集合
                    var entityList = entityInstance[subEntityName];
                    if (!(entityList instanceof EntityList)) {
                        entityList = new EntityList();
                        // 向子实体列表注册子实体变化事件
                        entityList.onListChanged.subscribe(function (value) {
                            if (value) {
                                if (entityList[PARENT_PATH][0] !== value.path[0]) {
                                    value.path = entityList[PARENT_PATH].concat(value.path);
                                }
                                entityInstance.setChanges(value);
                            }
                        });
                        // 向实体类型实例上直接存储子实体对象列表
                        entityInstance[subEntityName] = entityList;
                    }
                    entityList[PARENT_CLASS] = entityTypeConstructor;
                    entityList[PARENT_PATH] = path;
                    // 提取子实体类型名称
                    var schemaEntityTypeName = schemaEntity.type.name;
                    // 获取子实体类型
                    var ConcreteEntity = includedEntityTypes[schemaEntityTypeName];
                    var originalEntityDataArray = entityData ? entityData[subEntityName] : null;
                    // 构造子实体集合
                    if (originalEntityDataArray) {
                        // 遍历子实体原始数据，构造实体对象集合
                        var entities = originalEntityDataArray.map(function (originalEntityData) {
                            var concreteEntityInstance = new ConcreteEntity(originalEntityData);
                            concreteEntityInstance.constructor = ConcreteEntity;
                            return concreteEntityInstance;
                        });
                        // 向子实体列表中添加子实体对象
                        entityList.loadEntities(entities);
                    }
                });
            }
            // 初始化简单字段
            schemaType.fields
                // 过滤复杂类型字段
                .filter(function (field) { return field.$type === SchemaEntityField$Type.SimpleField; })
                // 遍历复杂类型字段创建对应实体类型数据
                .forEach(function (field) {
                // 提取字段名
                var fieldName = field.label;
                var propValue = entityData ? entityData[fieldName] : null;
                if (field['enableTimeZone'] === true) {
                    var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                    if (timeZoneOffset !== null && propValue) {
                        propValue = ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(propValue, timeZoneOffset);
                    }
                }
                entityInstance[fieldName] = propValue;
            });
        };
        return initializer;
    };
    return EntityTypeFactory;
}());
export { EntityTypeFactory };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5X3R5cGVfZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS9lbnRpdHlfdHlwZV9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxTQUFTLEVBQWdCLE1BQU0sY0FBYyxDQUFDO0FBQ3ZELE9BQU8sRUFBMkMsc0JBQXNCLEVBQWMsTUFBTSxrQkFBa0IsQ0FBQztBQUUvRyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQWEsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDckUsT0FBTyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDL0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBUS9DOzs7R0FHRztBQUNIO0lBRUU7SUFBZ0IsQ0FBQztJQUNqQjs7OztPQUlHO0lBQ0ksa0NBQU0sR0FBYixVQUFjLE1BQWM7UUFDMUIsdUJBQXVCO1FBQ3ZCLElBQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzNDLFNBQVM7UUFDVCxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENB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QUMsS0FBSyxJQUFJLEVBQUU7b0JBQ3BDLElBQU0sY0FBYyxHQUFHLG1CQUFtQixDQUFDLGlCQUFpQixFQUFFLENBQUM7b0JBQy9ELElBQUksY0FBYyxLQUFLLElBQUksSUFBSSxTQUFTLEVBQUU7d0JBQ3hDLFNBQVMsR0FBRyxTQUFTLENBQUMsMENBQTBDLENBQUMsU0FBUyxFQUFFLGNBQWMsQ0FBQyxDQUFDO3FCQUM3RjtpQkFDRjtnQkFDRCxjQUFjLENBQUMsU0FBUyxDQUFDLEdBQUcsU0FBUyxDQUFDO1lBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDO1FBQ0YsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUNILHdCQUFDO0FBQUQsQ0FBQyxBQWhjRCxJQWdjQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQ2hhbmdlU2V0LCBNb2RpZmljYXRpb24gfSBmcm9tICcuLi9jaGFuZ2VzZXQnO1xyXG5pbXBvcnQgeyBTY2hlbWEsIFNjaGVtYUVudGl0eSwgU2NoZW1hRW50aXR5RmllbGQsIFNjaGVtYUVudGl0eUZpZWxkJFR5cGUsIFNjaGVtYVR5cGUgfSBmcm9tICcuLi9zY2hlbWEvc2NoZW1hJztcclxuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi9lbnRpdHknO1xyXG5pbXBvcnQgeyBFbnRpdHlMaXN0IH0gZnJvbSAnLi9lbnRpdHlfbGlzdCc7XHJcbmltcG9ydCB7IGVudGl0eVByb3RvdHlwZSB9IGZyb20gJy4vZW50aXR5X3Byb3RvdHlwZSc7XHJcbmltcG9ydCB7IE5HX0VOVElUWSwgTkdfRklFTEQsIE5HX0xJU1QsIE5HX09CSkVDVCB9IGZyb20gJy4vbWV0YWRhdGEnO1xyXG5pbXBvcnQgeyBQQVJFTlRfQ0xBU1MsIFBBUkVOVF9QQVRIIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IFZhbGlkYXRvciB9IGZyb20gJy4vdmFsaWRhdG9yJztcclxuaW1wb3J0IHsgVmFsaWRhdGlvblV0aWxzIH0gZnJvbSAnLi92YWxpZGF0b3IvdmFsaWRhdGlvbl91dGlscyc7XHJcbmltcG9ydCB7IFVzZXJTZXR0aW5nc1NlcnZpY2UgfSBmcm9tICcuLi9pMThuL3VzZXJfc2V0dGluZ3Nfc2VydmljZSc7XHJcbmltcG9ydCB7IFpvbmVkVGltZSB9IGZyb20gJy4uL2kxOG4vem9uZWRfdGltZSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFic3RyYWN0RW50aXR5VHlwZSB7XHJcbiAgdHlwZU5hbWU6IHN0cmluZztcclxuICB0eXBlczogYW55O1xyXG4gIF9fcHJvcF9fbWV0YWRhdGFfXzogYW55O1xyXG59XHJcblxyXG4vKipcclxuICog5a6e5L2T57G75Z6L5bel5Y6CXHJcbiAqIOeUqOadpeagueaNruWunuS9k1NjaGVtYeaPj+i/sOS/oeaBr+WIm+W7uuWunuS9k+exu+Wei1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEVudGl0eVR5cGVGYWN0b3J5IHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuICAvKipcclxuICAgKiDnlLHlrp7kvZNTY2hlbWHnu5PmnoTliJvlu7rlrp7kvZPnsbvlnotcclxuICAgKiBAcGFyYW0gc2NoZW1hIOWunuS9k1NjaGVtYee7k+aehFxyXG4gICAqIEByZXR1cm5zIOWunuS9k+exu+Wei1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGUoc2NoZW1hOiBTY2hlbWEpIHtcclxuICAgIC8vIOaPkOWPllNjaGVtYeWumuS5ieS4reeahOesrOS4gOS4quaYr+WunuS9k+aPj+i/sFxyXG4gICAgY29uc3Qgc2NoZW1hVHlwZSA9IHNjaGVtYS5lbnRpdGllc1swXS50eXBlO1xyXG4gICAgLy8g5Yib5bu65a6e5L2T57G75Z6LXHJcbiAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5jcmVhdGVDbGFzcyhzY2hlbWFUeXBlLCBzY2hlbWEuZW50aXRpZXNbMF0pO1xyXG4gICAgcmV0dXJuIGVudGl0eVR5cGU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOeUseWunuS9k1NjaGVtYeexu+Wei+aPj+i/sOWIm+W7uuWunuS9k+exu1xyXG4gICAqIEBwYXJhbSBzY2hlbWFUeXBlIFNjaGVtYeWunuS9k+exu+Wei+aPj+i/sFxyXG4gICAqIEByZXR1cm5zIOWunuS9k+exu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlQ2xhc3Moc2NoZW1hVHlwZTogU2NoZW1hVHlwZSwgcmVsYXRlU2NoZW1hOiBhbnkpIHtcclxuICAgIGNvbnN0IGF0dGFjaEVudGl0eUluc3RhbmNlRGF0YSA9IHRoaXMuY3JlYXRlRW50aXR5SW5zdGFuY2VEYXRhSW5pdGlhbGl6ZXIoc2NoZW1hVHlwZSk7XHJcbiAgICAvLyDliJvlu7rmjIflrprlrp7kvZPnsbvlnovnmoTliJ3lp4vljJblh73mlbDvvIznlKjmnaXlnKjlrp7kvZPnsbvlnovmnoTpgKDlh73mlbDkuK3kuLrlrp7kvZPlrp7kvovotYvlgLxcclxuICAgIGNvbnN0IGluaXRpYWxpemUgPSAoZW50aXR5SW5zdGFuY2U6IGFueSwgZW50aXR5RGF0YTogYW55LCBlbnRpdHlUeXBlQ29uc3RydWN0b3I6IGFueSkgPT4ge1xyXG4gICAgICBlbnRpdHlJbnN0YW5jZS5pc0luaXRpYWxpemluZyA9IHRydWU7XHJcbiAgICAgIGF0dGFjaEVudGl0eUluc3RhbmNlRGF0YShlbnRpdHlJbnN0YW5jZSwgZW50aXR5RGF0YSwgZW50aXR5VHlwZUNvbnN0cnVjdG9yKTtcclxuICAgICAgZW50aXR5SW5zdGFuY2UuaXNJbml0aWFsaXppbmcgPSBmYWxzZTtcclxuICAgIH07XHJcbiAgICAvLyDlo7DmmI7lrp7kvZPnsbvmnoTpgKDlh73mlbBcclxuICAgIGNvbnN0IENvbmNyZXRlRW50aXR5ID0gZnVuY3Rpb24gKGRhdGE6IGFueSkge1xyXG4gICAgICAvLyDliJvlu7rlrp7kvZPlj5jmm7Tpm4ZcclxuICAgICAgdGhpcy5jaGFuZ2VTZXQgPSBuZXcgQ2hhbmdlU2V0KCk7XHJcbiAgICAgIC8vIOWIneWni+WMluWunuS9k+mqjOivgeeKtuaAgVxyXG4gICAgICB0aGlzLmlzVmFsaWRhdGluZyA9IGZhbHNlO1xyXG4gICAgICAvLyDorr7nva51bnN1YnNjcmliZSDlj5bmtojorqLpmIXkuovku7ZcclxuICAgICAgdGhpcy51bnN1YnNjcmliZSA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICAgIC8vIOWIneWni+WMluWunuS9k+mqjOivgeS/oeaBr1xyXG4gICAgICB0aGlzLnZhbGlkRXJyb3JzID0ge307XHJcbiAgICAgIC8vIOWIneWni+WMlumqjOivgeWZqFxyXG4gICAgICB0aGlzLnZhbGlkYXRvciA9IG5ldyBWYWxpZGF0b3IoKTtcclxuICAgICAgLy8g5Yid5aeL5YyW5a6e5L2T5pWw5o2u5Ymv5pysXHJcbiAgICAgIHRoaXMuaW5uZXJEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgICAgIC8vIOWIneWni+WMluWtkOWunuS9k+WvueixoembhuWQiFxyXG4gICAgICB0aGlzLmlubmVyRW50aXRpZXMgPSB7fTtcclxuICAgICAgLy8g5Yid5aeL5YyW5a6e5L2T5YC85Y+Y5YyW5LqL5Lu2XHJcbiAgICAgIHRoaXMudmFsdWVDaGFuZ2VkID0gbmV3IFN1YmplY3Q8TW9kaWZpY2F0aW9uPigpO1xyXG4gICAgICB0aGlzLm9uVmFsdWVDaGFuZ2VkID0gdGhpcy52YWx1ZUNoYW5nZWQ7XHJcbiAgICAgIHRoaXMudmFsaWRhdGVGcm9tVXRpbFN5bmMgPSBmdW5jdGlvbiAocHJvcGVydHlOYW1lLCB2YWx1ZSwgY2IsIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLnZhbGlkRXJyb3JzID0ge307XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy52YWxpZGF0b3IudmVyaWZ5KHRoaXMsIHByb3BlcnR5TmFtZSwgdmFsdWUsIG51bGwsIHVuZGVmaW5lZCwgY29udGV4dCAmJiBjb250ZXh0LmZyYW1lQ29udGV4dCB8fCBudWxsLCB0cnVlKTtcclxuICAgICAgICBpZiAocmVzdWx0ICYmICFyZXN1bHQuaXNWYWxpZCkge1xyXG4gICAgICAgICAgdGhpcy52YWxpZEVycm9ycyA9IFZhbGlkYXRpb25VdGlscy5jb252ZXJ0RXJyb3JzVG9Ob3JtYWxPYmplY3QocmVzdWx0LmVycm9ycywge30pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYihyZXN1bHQpO1xyXG4gICAgICB9O1xyXG4gICAgICAvLyDosIPnlKjliJ3lp4vljJbmlrnms5XvvIzliJ3lp4vljJblrp7kvZPmlbDmja5cclxuICAgICAgaW5pdGlhbGl6ZSh0aGlzLCBkYXRhLCBDb25jcmV0ZUVudGl0eSk7XHJcbiAgICAgIHRoaXMubG9hZCA9IChuZXdEYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBhdHRhY2hFbnRpdHlJbnN0YW5jZURhdGEodGhpcywgbmV3RGF0YSwgQ29uY3JldGVFbnRpdHkpO1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IG5ld0RhdGE7XHJcbiAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLyDlnKjlrp7kvZPnsbvmnoTpgKDlh73mlbDkuK3orrDlvZXop4blm77nsbvlnovlkI3np7BcclxuICAgIENvbmNyZXRlRW50aXR5LnR5cGVOYW1lID0gYCR7c2NoZW1hVHlwZS5uYW1lfUVudGl0eWA7XHJcbiAgICBDb25jcmV0ZUVudGl0eS5jb2RlID0gcmVsYXRlU2NoZW1hLmNvZGU7XHJcbiAgICBDb25jcmV0ZUVudGl0eS5sYWJlbCA9IHJlbGF0ZVNjaGVtYS5sYWJlbDtcclxuICAgIC8vIOWcqOWunuS9k+exu+aehOmAoOWHveaVsOS4reiusOW9leWFtuS4i+ebtOaOpeW8leeUqOeahOWtkOexu+Wei1xyXG4gICAgQ29uY3JldGVFbnRpdHkudHlwZXMgPSB7fTtcclxuICAgIENvbmNyZXRlRW50aXR5Ll9fcHJvcF9fbWV0YWRhdGFfXyA9IHtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIOaehOmAoOWunuS9k+exu+eahOWOn+Wei+WvueixoVxyXG4gICAgY29uc3QgZW50aXR5VHlwZVByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oeyB0eXBlTmFtZTogJ0NvbmNyZXRlRW50aXR5UHJvdG90eXBlJyB9LCBlbnRpdHlQcm90b3R5cGUpO1xyXG4gICAgLy8g5ZCR5a6e5L2T57G75Y6f5Z6L5a+56LGh5Lit5a6a5LmJ6aKE5Yi25bGe5oCnXHJcbiAgICB0aGlzLmRlZmluZVByZXNldFByb3BlcnR5KGVudGl0eVR5cGVQcm90b3R5cGUsIHNjaGVtYVR5cGUpO1xyXG4gICAgLy8g5ZCR5a6e5L2T57G75Y6f5Z6L5a+56LGh5Lit5a6a5LmJ5a2X5q615bGe5oCnZ2V0L3NldOaWueazlVxyXG4gICAgdGhpcy5kZWZpbmVGaWVsZHNUb1Byb3RvdHlwZShlbnRpdHlUeXBlUHJvdG90eXBlLCBzY2hlbWFUeXBlLmZpZWxkcywgc2NoZW1hVHlwZS5wcmltYXJ5LCBDb25jcmV0ZUVudGl0eSk7XHJcbiAgICAvLyDlkJHlrp7kvZPnsbvljp/lnovlr7nosaHkuK3lrprkuYnorr/pl67lrZDlrp7kvZPnmoRnZXQvc2V05pa55rOVXHJcbiAgICB0aGlzLmRlZmluZUVudGl0aWVzVG9Qcm90b3R5cGUoZW50aXR5VHlwZVByb3RvdHlwZSwgc2NoZW1hVHlwZS5lbnRpdGllcywgQ29uY3JldGVFbnRpdHkpO1xyXG4gICAgLy8g5bCG5a6e5L2T57G755qE5Y6f5Z6L5a+56LGh5oyH5ZCR5paw5p6E6YCg55qE5Y6f5Z6L5a+56LGh44CCXHJcbiAgICBDb25jcmV0ZUVudGl0eS5wcm90b3R5cGUgPSBlbnRpdHlUeXBlUHJvdG90eXBlO1xyXG5cclxuXHJcbiAgICByZXR1cm4gQ29uY3JldGVFbnRpdHk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WOn+Wei+WvueixoeS4reWumuS5iemihOWItuWxnuaAp1xyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIHNjaGVtYVR5cGUgU2NoZW1h57G75Z6L5o+P6L+wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVQcmVzZXRQcm9wZXJ0eShwcm90b3R5cGVPYmplY3Q6IGFueSwgc2NoZW1hVHlwZTogU2NoZW1hVHlwZSkge1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPmlbDmja5cclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ2RhdGEnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pbm5lckRhdGEpIHtcclxuICAgICAgICAgIHRoaXMuaW5uZXJEYXRhID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmlubmVyRGF0YTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLmlubmVyRGF0YSA9IHZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T6aqM6K+B5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdlcnJvcnMnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZhbGlkRXJyb3JzO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChlcnJvcnM6IGFueSkge1xyXG4gICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSBlcnJvcnM7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlrp7kvZPlj5jmm7Tpm4ZcclxuICAgICAqL1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvdHlwZU9iamVjdCwgJ2NoYW5nZXMnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoYW5nZVNldC5jaGFuZ2VzO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Li76ZSuXHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdwcmltYXJ5UHJvcGVydHknLCB7XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogb25seS1hcnJvdy1mdW5jdGlvbnNcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy8gcmV0dXJuIHNjaGVtYVR5cGUucHJpbWFyeTtcclxuICAgICAgICByZXR1cm4gcHJvdG90eXBlT2JqZWN0LmlubmVyUHJpbWFyeVByb3BlcnR5IHx8IHsgZGF0YUZpZWxkOiBzY2hlbWFUeXBlLnByaW1hcnkgfTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+S4u+mUrlxyXG4gICAgICovXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCAncHJpbWFyeUtleScsIHtcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBvbmx5LWFycm93LWZ1bmN0aW9uc1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gc2NoZW1hVHlwZS5wcmltYXJ5IHx8ICcnO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog5a6e5L2T5Li76ZSu55qE5YC8XHJcbiAgICAgKi9cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsICdwcmltYXJ5VmFsdWUnLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnByaW1hcnlLZXkpIHtcclxuICAgICAgICAgIC8vIHJldHVybiB0aGlzW3RoaXMucHJpbWFyeVByb3BlcnR5LnByb3BlcnR5XS50b1N0cmluZygpO1xyXG4gICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gdGhpc1t0aGlzLnByaW1hcnlLZXldO1xyXG4gICAgICAgICAgcmV0dXJuIHByaW1hcnlWYWx1ZSA/IHByaW1hcnlWYWx1ZSA6ICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75a6a5LmJ5a2X5q615bGe5oCnXHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gZmllbGRzIOWtl+auteaPj+i/sOmbhuWQiFxyXG4gICAqIEBwYXJhbSBwYXJlbnRFbnRpdHlUeXBlIOeItuexu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lRmllbGRzVG9Qcm90b3R5cGUoXHJcbiAgICBwcm90b3R5cGVPYmplY3Q6IGFueSxcclxuICAgIGZpZWxkczogU2NoZW1hRW50aXR5RmllbGRbXSxcclxuICAgIHByaW1hcnk6IHN0cmluZyxcclxuICAgIHBhcmVudEVudGl0eVR5cGU6IEFic3RyYWN0RW50aXR5VHlwZVxyXG4gICk6IHZvaWQge1xyXG4gICAgaWYgKGZpZWxkcyAmJiBmaWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgIC8vIOmBjeWOhlNjaGVtYeS4reaPj+i/sOeahOWtl+aute+8jOWcqOWunuS9k+WOn+Wei+WvueixoeS4iuWumuS5ieWtl+auteiuv+mXruWHveaVsFxyXG4gICAgICBmaWVsZHMuZm9yRWFjaChzY2hlbWFFbnRpdHlGaWVsZCA9PiB7XHJcbiAgICAgICAgc3dpdGNoIChzY2hlbWFFbnRpdHlGaWVsZC4kdHlwZSkge1xyXG4gICAgICAgICAgLy8g5a6a5LmJ566A5Y2V57G75Z6L5a2X5q61XHJcbiAgICAgICAgICBjYXNlIFNjaGVtYUVudGl0eUZpZWxkJFR5cGUuU2ltcGxlRmllbGQ6XHJcbiAgICAgICAgICAgIHRoaXMuZGVmaW5lU2ltcGxlRmllbGRUb1Byb3RvdHlwZShwcm90b3R5cGVPYmplY3QsIHNjaGVtYUVudGl0eUZpZWxkLCBwcmltYXJ5LCBwYXJlbnRFbnRpdHlUeXBlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAvLyDlrprkuYnlpI3mnYLnsbvlnovlrZfmrrVcclxuICAgICAgICAgIGNhc2UgU2NoZW1hRW50aXR5RmllbGQkVHlwZS5Db21wbGV4RmllbGQ6XHJcbiAgICAgICAgICAgIHRoaXMuZGVmaW5lQ29tcGxleEZpZWxkVG9Qcm90b3R5cGUocHJvdG90eXBlT2JqZWN0LCBzY2hlbWFFbnRpdHlGaWVsZCwgcGFyZW50RW50aXR5VHlwZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WumuS5ieeugOWNleexu+Wei+Wtl+autVxyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIHNjaGVtYUZpZWxkIOWtl+auteaPj+i/sFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lU2ltcGxlRmllbGRUb1Byb3RvdHlwZShcclxuICAgIHByb3RvdHlwZU9iamVjdDogYW55LFxyXG4gICAgc2NoZW1hRmllbGQ6IFNjaGVtYUVudGl0eUZpZWxkLFxyXG4gICAgcHJpbWFyeTogc3RyaW5nLFxyXG4gICAgcGFyZW50RW50aXR5VHlwZTogQWJzdHJhY3RFbnRpdHlUeXBlXHJcbiAgKSB7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBzY2hlbWFGaWVsZC5sYWJlbDtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGVPYmplY3QsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZFZhbHVlKHNjaGVtYUZpZWxkKTtcclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbiAobmV3UHJvcFZhbHVlKSB7XHJcbiAgICAgICAgLy8g5YC855u45ZCM5pe25LiN6Kem5Y+R5Y+Y5pu044CCXHJcbiAgICAgICAgY29uc3Qgb2xkUHJvcFZhbHVlID0gdGhpcy5nZXRGaWVsZFZhbHVlKHNjaGVtYUZpZWxkKTtcclxuICAgICAgICBpZiAodGhpcy5pc0ZpZWxkVmFsdWVDaGFuZ2VkKHNjaGVtYUZpZWxkLCBuZXdQcm9wVmFsdWUsIG9sZFByb3BWYWx1ZSkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0RmllbGRWYWx1ZShzY2hlbWFGaWVsZCwgbmV3UHJvcFZhbHVlKTtcclxuICAgICAgICB0aGlzLmVtaXRGaWVsZFZhbHVlQ2hhbmdlKHNjaGVtYUZpZWxkLCBuZXdQcm9wVmFsdWUsIG9sZFByb3BWYWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IHtcclxuICAgICAgLyoqIOWtl+auteWQjeensCAqL1xyXG4gICAgICBkYXRhRmllbGQ6IHRoaXMuZ2V0RGF0YUZpZWxkKHNjaGVtYUZpZWxkKSxcclxuICAgICAgLyoqIOWOn+Wni+Wtl+auteWQjeensCAqL1xyXG4gICAgICBvcmlnaW5hbERhdGFGaWVsZDogc2NoZW1hRmllbGQuY29kZSxcclxuICAgICAgLyoqIOWOn+Wni+Wtl+auteexu+WeiyAqL1xyXG4gICAgICBvcmlnaW5hbERhdGFGaWVsZFR5cGU6IHNjaGVtYUZpZWxkLnR5cGUubmFtZSxcclxuICAgICAgLyoqXHJcbiAgICAgICAqIOWOn+Wni+Wtl+autVxyXG4gICAgICAgKiBAZGVzY3JpcHRpb24g5a+55bqU5Yiwc2NoZW1l55qEcGF0aOWxnuaAp1xyXG4gICAgICAgKi9cclxuICAgICAgcGF0aDogc2NoZW1hRmllbGQucGF0aCxcclxuICAgICAgcHJpbWFyeTogc2NoZW1hRmllbGQubGFiZWwgPT09IHByaW1hcnksXHJcbiAgICAgIGVuYWJsZU11bHRpTGFuZ0lucHV0OiB0aGlzLmdldEVuYWJsZU11bHRpTGFuZ0lucHV0KHNjaGVtYUZpZWxkKSxcclxuICAgICAgZGVmYXVsdFZhbHVlOiBzY2hlbWFGaWVsZC5kZWZhdWx0VmFsdWUsXHJcbiAgICAgIG5nTWV0YWRhdGFOYW1lOiBOR19GSUVMRFxyXG4gICAgfTtcclxuICAgIGlmIChzY2hlbWFGaWVsZFsnZW5hYmxlU3RkVGltZUZvcm1hdCddICYmIGZpZWxkTWV0YWRhdGEub3JpZ2luYWxEYXRhRmllbGRUeXBlID09IFwiRGF0ZVRpbWVcIikge1xyXG4gICAgICBmaWVsZE1ldGFkYXRhW1wiZW5hYmxlVGltZVpvbmVcIl0gPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKGZpZWxkTWV0YWRhdGEucHJpbWFyeSkge1xyXG4gICAgICBwcm90b3R5cGVPYmplY3QuaW5uZXJQcmltYXJ5UHJvcGVydHkgPSBmaWVsZE1ldGFkYXRhO1xyXG4gICAgfVxyXG4gICAgaWYgKCFwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0gPSBbXTtcclxuICAgIH1cclxuICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0ucHVzaChmaWVsZE1ldGFkYXRhKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RGF0YUZpZWxkKHNjaGVtYUZpZWxkOiBTY2hlbWFFbnRpdHlGaWVsZCkge1xyXG4gICAgaWYgKHNjaGVtYUZpZWxkLm11bHRpTGFuZ3VhZ2UpIHtcclxuICAgICAgcmV0dXJuIHNjaGVtYUZpZWxkLmxhYmVsICsgXCJfXCIgKyBcIk1VTFRJTEFOR1VBR0VcIjtcclxuICAgIH1cclxuICAgIHJldHVybiBzY2hlbWFGaWVsZC5sYWJlbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RW5hYmxlTXVsdGlMYW5nSW5wdXQoc2NoZW1hRmllbGQ6IFNjaGVtYUVudGl0eUZpZWxkKSB7XHJcbiAgICBpZiAoc2NoZW1hRmllbGQubXVsdGlMYW5ndWFnZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWQkeWunuS9k+exu+WumuS5ieWkjeadguexu+Wei+Wtl+autVxyXG4gICAqIEBwYXJhbSBwcm90b3R5cGVPYmplY3Qg5a6e5L2T57G75Y6f5Z6L5a+56LGhXHJcbiAgICogQHBhcmFtIHNjaGVtYUZpZWxkIOWtl+auteaPj+i/sFxyXG4gICAqIEBwYXJhbSBwYXJlbnRFbnRpdHlUeXBlIOeItuexu+Wei1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGVmaW5lQ29tcGxleEZpZWxkVG9Qcm90b3R5cGUocHJvdG90eXBlT2JqZWN0OiBhbnksIHNjaGVtYUZpZWxkOiBTY2hlbWFFbnRpdHlGaWVsZCwgcGFyZW50RW50aXR5VHlwZTogQWJzdHJhY3RFbnRpdHlUeXBlKSB7XHJcbiAgICBjb25zdCBjb21wbGV4RmllbGRUeXBlID0gdGhpcy5jcmVhdGVDbGFzcyhzY2hlbWFGaWVsZC50eXBlLCBzY2hlbWFGaWVsZCk7XHJcbiAgICBwYXJlbnRFbnRpdHlUeXBlLnR5cGVzW3NjaGVtYUZpZWxkLnR5cGUubmFtZV0gPSBjb21wbGV4RmllbGRUeXBlO1xyXG4gICAgY29uc3QgcHJvcGVydHlOYW1lID0gc2NoZW1hRmllbGQubGFiZWw7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgZmllbGRWYWx1ZSA9IHRoaXMuZ2V0Q29tcGxleEZpZWxkVmFsdWUoc2NoZW1hRmllbGQpO1xyXG4gICAgICAgIHJldHVybiBmaWVsZFZhbHVlO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5zZXRDb21wbGV4RmllbGRWYWx1ZShzY2hlbWFGaWVsZCwgY29tcGxleEZpZWxkVHlwZSwgdmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGZpZWxkTWV0YWRhdGEgPSB7XHJcbiAgICAgIC8qKiDmmKDlsITlrZfmrrUgKi9cclxuICAgICAgZGF0YUZpZWxkOiBzY2hlbWFGaWVsZC5sYWJlbCxcclxuICAgICAgLyoqIOWOn+Wni+Wtl+auteWQjeensCAqL1xyXG4gICAgICBvcmlnaW5hbERhdGFGaWVsZDogc2NoZW1hRmllbGQuY29kZSxcclxuICAgICAgLyoqIOW8leeUqOWunuS9k+exu+WeiyAqL1xyXG4gICAgICB0eXBlOiBjb21wbGV4RmllbGRUeXBlLFxyXG4gICAgICAvKipcclxuICAgICAgICog5Y6f5aeL5a2X5q61XHJcbiAgICAgICAqIEBkZXNjcmlwdGlvbiDlr7nlupTliLBzY2hlbWXnmoRwYXRo5bGe5oCnXHJcbiAgICAgICAqL1xyXG4gICAgICBwYXRoOiBzY2hlbWFGaWVsZC5wYXRoLFxyXG4gICAgICBuZ01ldGFkYXRhTmFtZTogTkdfT0JKRUNUXHJcbiAgICB9O1xyXG4gICAgaWYgKCFwYXJlbnRFbnRpdHlUeXBlLl9fcHJvcF9fbWV0YWRhdGFfX1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0gPSBbXTtcclxuICAgIH1cclxuICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0ucHVzaChmaWVsZE1ldGFkYXRhKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5ZCR5a6e5L2T57G75a6a5LmJ5a2Q5a6e5L2TXHJcbiAgICogQHBhcmFtIHByb3RvdHlwZU9iamVjdCDlrp7kvZPnsbvljp/lnovlr7nosaFcclxuICAgKiBAcGFyYW0gZW50aXRpZXMg5a6e5L2T5o+P6L+w6ZuG5ZCIXHJcbiAgICogQHBhcmFtIHBhcmVudEVudGl0eVR5cGUg54i257G75Z6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZWZpbmVFbnRpdGllc1RvUHJvdG90eXBlKHByb3RvdHlwZU9iamVjdDogYW55LCBlbnRpdGllczogU2NoZW1hRW50aXR5W10sIHBhcmVudEVudGl0eVR5cGU6IEFic3RyYWN0RW50aXR5VHlwZSkge1xyXG4gICAgaWYgKGVudGl0aWVzICYmIGVudGl0aWVzLmxlbmd0aCkge1xyXG4gICAgICAvLyDpgY3ljoZTY2hlbWHkuK3mj4/ov7DnmoTlrZDlrp7kvZPvvIzlnKjlrp7kvZPlr7nosaHkuIrlrprkuYnlrZDlrp7kvZPliJfooahcclxuICAgICAgZW50aXRpZXMuZm9yRWFjaChzY2hlbWFFbnRpdHkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNvbXBsZXhGaWVsZFR5cGUgPSB0aGlzLmNyZWF0ZUNsYXNzKHNjaGVtYUVudGl0eS50eXBlLCBzY2hlbWFFbnRpdHkpO1xyXG4gICAgICAgIHBhcmVudEVudGl0eVR5cGUudHlwZXNbc2NoZW1hRW50aXR5LnR5cGUubmFtZV0gPSBjb21wbGV4RmllbGRUeXBlO1xyXG4gICAgICAgIC8vIOaPkOWPluWtkOWunuS9k+WcqOWunuS9k+WvueixoeS4iueahOWxnuaAp+WQjVxyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHNjaGVtYUVudGl0eS5sYWJlbDtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlT2JqZWN0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zdCBmaWVsZFZhbHVlID0gdGhpcy5nZXRFbnRpdGllcyhzY2hlbWFFbnRpdHkpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmllbGRWYWx1ZTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RW50aXRpZXMoc2NoZW1hRW50aXR5LCB2YWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZW50aXRNZXRhZGF0YSA9IHtcclxuICAgICAgICAgIC8qKiDlrZfmrrXlkI3np7AgKi9cclxuICAgICAgICAgIGRhdGFGaWVsZDogc2NoZW1hRW50aXR5LmxhYmVsLFxyXG4gICAgICAgICAgLyoqIOWOn+Wni+Wtl+auteWQjeensCAqL1xyXG4gICAgICAgICAgb3JpZ2luYWxEYXRhRmllbGQ6ICcnLFxyXG4gICAgICAgICAgLyoqIOWunuS9k+exu+WeiyAqL1xyXG4gICAgICAgICAgdHlwZTogY29tcGxleEZpZWxkVHlwZSxcclxuICAgICAgICAgIG5nTWV0YWRhdGFOYW1lOiBOR19MSVNUXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoIXBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0pIHtcclxuICAgICAgICAgIHBhcmVudEVudGl0eVR5cGUuX19wcm9wX19tZXRhZGF0YV9fW3Byb3BlcnR5TmFtZV0gPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGFyZW50RW50aXR5VHlwZS5fX3Byb3BfX21ldGFkYXRhX19bcHJvcGVydHlOYW1lXS5wdXNoKGVudGl0TWV0YWRhdGEpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yib5bu65Yid5aeL5YyW5a6e5L2T5a+56LGh5pa55rOVXHJcbiAgICogQHBhcmFtIHNjaGVtYVR5cGUg5a6e5L2T57G75Z6L5o+P6L+wXHJcbiAgICogQHJldHVybnMg5Yid5aeL5YyW5a6e5L2T5a+56LGh5pa55rOVXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVFbnRpdHlJbnN0YW5jZURhdGFJbml0aWFsaXplcihzY2hlbWFUeXBlOiBTY2hlbWFUeXBlKSB7XHJcbiAgICAvKipcclxuICAgICAqIOWunuS9k+WIneWni+WMluWHveaVsO+8jOeUqOadpeWIneWni+WMluWunuS9k+eahOWkjeadguexu+Wei+aVsOaNruWSjOWtkOWunuS9k+aVsOaNrlxyXG4gICAgICogQHBhcmFtIGVudGl0eUluc3RhbmNlIOWunuS9k+exu+Wei+WunuS+i1xyXG4gICAgICogQHBhcmFtIGRhdGEg5a6e5L2T5Y6f5aeL5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0gZW50aXR5VHlwZUNvbnN0cnVjdG9yIOWunuS9k+exu+Wei+aehOmAoOWHveaVsFxyXG4gICAgICovXHJcbiAgICBjb25zdCBpbml0aWFsaXplciA9IChlbnRpdHlJbnN0YW5jZTogYW55LCBlbnRpdHlEYXRhOiBhbnksIGVudGl0eVR5cGVDb25zdHJ1Y3RvcjogYW55KSA9PiB7XHJcbiAgICAgIC8vIOWIneWni+WMluWkjeadguexu+Wei+Wtl+autVxyXG4gICAgICBzY2hlbWFUeXBlLmZpZWxkc1xyXG4gICAgICAgIC8vIOi/h+a7pOWkjeadguexu+Wei+Wtl+autVxyXG4gICAgICAgIC5maWx0ZXIoZmllbGQgPT4gZmllbGQuJHR5cGUgPT09IFNjaGVtYUVudGl0eUZpZWxkJFR5cGUuQ29tcGxleEZpZWxkKVxyXG4gICAgICAgIC8vIOmBjeWOhuWkjeadguexu+Wei+Wtl+auteWIm+W7uuWvueW6lOWunuS9k+exu+Wei+aVsOaNrlxyXG4gICAgICAgIC5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgIC8vIOaPkOWPluWtl+auteWQjVxyXG4gICAgICAgICAgY29uc3QgZmllbGROYW1lID0gZmllbGQubGFiZWw7XHJcbiAgICAgICAgICAvLyDmj5Dlj5blrp7kvZPnsbvlnovkuIvnmoTmiYDmnInlrZDlrp7kvZPnsbvlnotcclxuICAgICAgICAgIGNvbnN0IGluY2x1ZGVkRW50aXR5VHlwZXMgPSBlbnRpdHlUeXBlQ29uc3RydWN0b3IudHlwZXM7XHJcbiAgICAgICAgICAvLyDojrflj5blpI3mnYLnsbvlnovlrZfmrrXlr7nlupTnmoTlrp7kvZPnsbvlnotcclxuICAgICAgICAgIGNvbnN0IENvbXBsZXhGaWVsZCA9IGluY2x1ZGVkRW50aXR5VHlwZXNbZmllbGQudHlwZS5uYW1lXTtcclxuICAgICAgICAgIC8vIOaPkOWPluWkjeadguexu+Wei+Wtl+auteWOn+Wni+aVsOaNrlxyXG4gICAgICAgICAgY29uc3QgZmllbGREYXRhID0gZW50aXR5RGF0YSA/IGVudGl0eURhdGFbZmllbGROYW1lXSA6IG51bGw7XHJcbiAgICAgICAgICAvLyDliJvlu7rlpI3mnYLnsbvlnovlrZfmrrXlr7nosaHot6/lvoRcclxuICAgICAgICAgIGNvbnN0IHBhdGggPSBlbnRpdHlJbnN0YW5jZS5jcmVhdGVQYXRoKGZpZWxkTmFtZSk7XHJcbiAgICAgICAgICBsZXQgY29tcGxleEZpZWxkVmFsdWUgPSBlbnRpdHlJbnN0YW5jZVtmaWVsZE5hbWVdO1xyXG4gICAgICAgICAgaWYgKGNvbXBsZXhGaWVsZFZhbHVlIGluc3RhbmNlb2YgQ29tcGxleEZpZWxkKSB7XHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlLmxvYWQoZmllbGREYXRhKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOWIm+W7uuWkjeadguexu+Wei+Wtl+auteWunuS9k+WunuS+i1xyXG4gICAgICAgICAgICBjb21wbGV4RmllbGRWYWx1ZSA9IG5ldyBDb21wbGV4RmllbGQoZmllbGREYXRhKTtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUuY29uc3RydWN0b3IgPSBDb21wbGV4RmllbGQ7XHJcbiAgICAgICAgICAgIGNvbXBsZXhGaWVsZFZhbHVlW1BBUkVOVF9DTEFTU10gPSBlbnRpdHlJbnN0YW5jZTtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWVbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuICAgICAgICAgICAgY29tcGxleEZpZWxkVmFsdWUub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKGNoYW5nZXMgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAoZW50aXR5SW5zdGFuY2VbUEFSRU5UX1BBVEhdIHx8IFtdKS5jb25jYXQoY2hhbmdlcy5wYXRoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1vZGlmaWNhdGlvbiA9IHsgLi4uY2hhbmdlcywgZnJvbVBhcmVudDogdHJ1ZSB9O1xyXG4gICAgICAgICAgICAgICAgZW50aXR5SW5zdGFuY2Uuc2V0Q2hhbmdlcyhtb2RpZmljYXRpb24pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGVudGl0eUluc3RhbmNlW2ZpZWxkTmFtZV0gPSBjb21wbGV4RmllbGRWYWx1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgLy8g5Yid5aeL5YyW5a2Q5a6e5L2TXHJcbiAgICAgIGlmIChzY2hlbWFUeXBlLmVudGl0aWVzKSB7XHJcbiAgICAgICAgLy8g6YGN5Y6G5a2Q5a6e5L2T5Yib5bu65a+55bqU5a6e5L2T57G75Z6L55qE5pWw5o2uXHJcbiAgICAgICAgc2NoZW1hVHlwZS5lbnRpdGllcy5mb3JFYWNoKHNjaGVtYUVudGl0eSA9PiB7XHJcbiAgICAgICAgICAvLyDmj5Dlj5blrZDlrp7kvZPlkI1cclxuICAgICAgICAgIGNvbnN0IHN1YkVudGl0eU5hbWUgPSBzY2hlbWFFbnRpdHkubGFiZWw7XHJcbiAgICAgICAgICAvLyDmj5Dlj5blrp7kvZPnsbvlnovkuIvnmoTmiYDmnInlrZDlrp7kvZPnsbvlnotcclxuICAgICAgICAgIGNvbnN0IGluY2x1ZGVkRW50aXR5VHlwZXMgPSBlbnRpdHlUeXBlQ29uc3RydWN0b3IudHlwZXM7XHJcbiAgICAgICAgICAvLyDliJvlu7rlrZDlrp7kvZPlr7nosaHot6/lvoRcclxuICAgICAgICAgIGNvbnN0IHBhdGggPSBlbnRpdHlJbnN0YW5jZS5jcmVhdGVQYXRoKHN1YkVudGl0eU5hbWUpO1xyXG4gICAgICAgICAgLy8g5Yib5bu65a2Q5a6e5L2T5a+56LGh6ZuG5ZCIXHJcbiAgICAgICAgICBsZXQgZW50aXR5TGlzdCA9IGVudGl0eUluc3RhbmNlW3N1YkVudGl0eU5hbWVdO1xyXG4gICAgICAgICAgaWYgKCEoZW50aXR5TGlzdCBpbnN0YW5jZW9mIEVudGl0eUxpc3QpKSB7XHJcbiAgICAgICAgICAgIGVudGl0eUxpc3QgPSBuZXcgRW50aXR5TGlzdDxFbnRpdHk+KCk7XHJcbiAgICAgICAgICAgIC8vIOWQkeWtkOWunuS9k+WIl+ihqOazqOWGjOWtkOWunuS9k+WPmOWMluS6i+S7tlxyXG4gICAgICAgICAgICBlbnRpdHlMaXN0Lm9uTGlzdENoYW5nZWQuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlbnRpdHlMaXN0W1BBUkVOVF9QQVRIXVswXSAhPT0gdmFsdWUucGF0aFswXSkge1xyXG4gICAgICAgICAgICAgICAgICB2YWx1ZS5wYXRoID0gZW50aXR5TGlzdFtQQVJFTlRfUEFUSF0uY29uY2F0KHZhbHVlLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZW50aXR5SW5zdGFuY2Uuc2V0Q2hhbmdlcyh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g5ZCR5a6e5L2T57G75Z6L5a6e5L6L5LiK55u05o6l5a2Y5YKo5a2Q5a6e5L2T5a+56LGh5YiX6KGoXHJcbiAgICAgICAgICAgIGVudGl0eUluc3RhbmNlW3N1YkVudGl0eU5hbWVdID0gZW50aXR5TGlzdDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVudGl0eUxpc3RbUEFSRU5UX0NMQVNTXSA9IGVudGl0eVR5cGVDb25zdHJ1Y3RvcjtcclxuICAgICAgICAgIGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuICAgICAgICAgIC8vIOaPkOWPluWtkOWunuS9k+exu+Wei+WQjeensFxyXG4gICAgICAgICAgY29uc3Qgc2NoZW1hRW50aXR5VHlwZU5hbWUgPSBzY2hlbWFFbnRpdHkudHlwZS5uYW1lO1xyXG4gICAgICAgICAgLy8g6I635Y+W5a2Q5a6e5L2T57G75Z6LXHJcbiAgICAgICAgICBjb25zdCBDb25jcmV0ZUVudGl0eSA9IGluY2x1ZGVkRW50aXR5VHlwZXNbc2NoZW1hRW50aXR5VHlwZU5hbWVdO1xyXG4gICAgICAgICAgY29uc3Qgb3JpZ2luYWxFbnRpdHlEYXRhQXJyYXkgPSBlbnRpdHlEYXRhID8gZW50aXR5RGF0YVtzdWJFbnRpdHlOYW1lXSA6IG51bGw7XHJcbiAgICAgICAgICAvLyDmnoTpgKDlrZDlrp7kvZPpm4blkIhcclxuICAgICAgICAgIGlmIChvcmlnaW5hbEVudGl0eURhdGFBcnJheSkge1xyXG4gICAgICAgICAgICAvLyDpgY3ljoblrZDlrp7kvZPljp/lp4vmlbDmja7vvIzmnoTpgKDlrp7kvZPlr7nosaHpm4blkIhcclxuICAgICAgICAgICAgY29uc3QgZW50aXRpZXMgPSBvcmlnaW5hbEVudGl0eURhdGFBcnJheS5tYXAoKG9yaWdpbmFsRW50aXR5RGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY29uY3JldGVFbnRpdHlJbnN0YW5jZSA9IG5ldyBDb25jcmV0ZUVudGl0eShvcmlnaW5hbEVudGl0eURhdGEpO1xyXG4gICAgICAgICAgICAgIGNvbmNyZXRlRW50aXR5SW5zdGFuY2UuY29uc3RydWN0b3IgPSBDb25jcmV0ZUVudGl0eTtcclxuICAgICAgICAgICAgICByZXR1cm4gY29uY3JldGVFbnRpdHlJbnN0YW5jZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOWQkeWtkOWunuS9k+WIl+ihqOS4rea3u+WKoOWtkOWunuS9k+WvueixoVxyXG4gICAgICAgICAgICBlbnRpdHlMaXN0LmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5Yid5aeL5YyW566A5Y2V5a2X5q61XHJcbiAgICAgIHNjaGVtYVR5cGUuZmllbGRzXHJcbiAgICAgICAgLy8g6L+H5ruk5aSN5p2C57G75Z6L5a2X5q61XHJcbiAgICAgICAgLmZpbHRlcihmaWVsZCA9PiBmaWVsZC4kdHlwZSA9PT0gU2NoZW1hRW50aXR5RmllbGQkVHlwZS5TaW1wbGVGaWVsZClcclxuICAgICAgICAvLyDpgY3ljoblpI3mnYLnsbvlnovlrZfmrrXliJvlu7rlr7nlupTlrp7kvZPnsbvlnovmlbDmja5cclxuICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHtcclxuICAgICAgICAgIC8vIOaPkOWPluWtl+auteWQjVxyXG4gICAgICAgICAgY29uc3QgZmllbGROYW1lID0gZmllbGQubGFiZWw7XHJcbiAgICAgICAgICBsZXQgcHJvcFZhbHVlID0gZW50aXR5RGF0YSA/IGVudGl0eURhdGFbZmllbGROYW1lXSA6IG51bGw7XHJcbiAgICAgICAgICBpZiAoZmllbGRbJ2VuYWJsZVRpbWVab25lJ10gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZVpvbmVPZmZzZXQgPSBVc2VyU2V0dGluZ3NTZXJ2aWNlLmdldFRpbWVab25lT2Zmc2V0KCk7XHJcbiAgICAgICAgICAgIGlmICh0aW1lWm9uZU9mZnNldCAhPT0gbnVsbCAmJiBwcm9wVmFsdWUpIHtcclxuICAgICAgICAgICAgICBwcm9wVmFsdWUgPSBab25lZFRpbWUuem9uZWRUaW1lVG9TcGVjaWFsVGltZVpvbmVPZmZzZXRUaW1lU3RyaW5nKHByb3BWYWx1ZSwgdGltZVpvbmVPZmZzZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbnRpdHlJbnN0YW5jZVtmaWVsZE5hbWVdID0gcHJvcFZhbHVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBpbml0aWFsaXplcjtcclxuICB9XHJcbn1cclxuIl19
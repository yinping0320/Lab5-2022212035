/**
 * 数据验证帮助类，提供一些公共的操作方法函数
 */
var ValidationUtils = /** @class */ (function () {
    function ValidationUtils() {
    }
    /**
     * 将错误信息集合转变为可读性高的文本数组
     * @param errors 验证失败错误集合
     * @param messages 返回的错误信息文本集合
     * @param parentPath 验证属性上级路径
     */
    ValidationUtils.createDetailedErrorMessage = function (errors, messages, parentPath) {
        if (messages === void 0) { messages = []; }
        if (parentPath === void 0) { parentPath = ''; }
        errors.forEach(function (error) {
            var targetName = error.target ? error.target.constructor.name : '';
            var property = error.propertyName;
            var propConstraintFailed = function (propertyName) {
                return "   - \u5C5E\u6027 " + parentPath + propertyName + " \u9A8C\u8BC1\u5931\u8D25\u7684\u89C4\u5219:  \n" +
                    ("" + Object.keys(error.constraints)
                        .map(function (ruleName) {
                        return "        #" + ruleName + ": " + error.constraints[ruleName] + "\n";
                    })
                        .join(''));
            };
            if (!parentPath) {
                messages.push("\u7C7B\u578B\u4E3A " + targetName + " \u7684\u5B9E\u4F8B\u5BF9\u8C61\u6570\u636E\u9A8C\u8BC1\u5931\u8D25\uFF0C\u8BE6\u7EC6\u4FE1\u606F\uFF1A\n");
                if (error.constraints) {
                    messages.push(propConstraintFailed(property));
                }
                if (error.children.length) {
                    ValidationUtils.createDetailedErrorMessage(error.children, messages, property);
                }
            }
            else {
                var formattedProperty = Number.isInteger(+error.index)
                    ? "[" + error.index + "]." + property
                    : "" + (parentPath ? "." : "") + property;
                if (error.constraints) {
                    messages.push(propConstraintFailed(formattedProperty));
                }
                if (error.children.length) {
                    ValidationUtils.createDetailedErrorMessage(error.children, messages, "" + parentPath + formattedProperty);
                }
            }
        });
        return messages;
    };
    /**
     * 错误信息集合转换为简单对象格式
     * @param errors 错误信息集合
     * @param errObj 返回简单对象。如:
     * ```
     * { name: { required: '必填', max: '最大值99' },
     *   list: {
     *      0: { name:{required: '必填'},
     *           age: { min: '最小值 20' }
     *         },
     *      2: { ... }
     *   }
     * }
     *
     * ```
     */
    ValidationUtils.convertErrorsToNormalObject = function (errors, errObj) {
        errors.forEach(function (err) {
            var property = err.propertyName;
            var buildArray = function (childErrors) {
                var itemErr = {};
                childErrors.forEach(function (childErr) {
                    var _a, _b;
                    if (childErr.children.length) {
                        itemErr[childErr.index] = ValidationUtils.convertErrorsToNormalObject(childErr.children, childErr);
                    }
                    else {
                        if (itemErr[childErr.index]) {
                            itemErr[childErr.index] = Object.assign({}, itemErr[childErr.index], (_a = {},
                                _a[childErr.propertyName] = childErr.constraints,
                                _a));
                        }
                        else {
                            itemErr[childErr.index] = (_b = {}, _b[childErr.propertyName] = childErr.constraints, _b);
                        }
                    }
                });
                return itemErr;
            };
            if (!err.isArray) {
                if (!err.children.length) {
                    errObj[property] = err.constraints;
                }
                else {
                    errObj[property] = ValidationUtils.convertErrorsToNormalObject(err.children, errObj);
                }
            }
            else {
                errObj[property] = buildArray(err.children);
            }
        });
        return errObj;
    };
    return ValidationUtils;
}());
export { ValidationUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbl91dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2VudGl0eS92YWxpZGF0b3IvdmFsaWRhdGlvbl91dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQTs7R0FFRztBQUNIO0lBQUE7SUF1R0EsQ0FBQztJQXJHQzs7Ozs7T0FLRztJQUNJLDBDQUEwQixHQUFqQyxVQUNFLE1BQXlCLEVBQ3pCLFFBQXVCLEVBQ3ZCLFVBQXVCO1FBRHZCLHlCQUFBLEVBQUEsYUFBdUI7UUFDdkIsMkJBQUEsRUFBQSxlQUF1QjtRQUV2QixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQUEsS0FBSztZQUNsQixJQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNyRSxJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDO1lBRXBDLElBQU0sb0JBQW9CLEdBQUcsVUFBQyxZQUFvQjtnQkFDaEQsT0FBQSx1QkFBVyxVQUFVLEdBQUcsWUFBWSxxREFBZTtxQkFDbkQsS0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7eUJBQzlCLEdBQUcsQ0FBQyxVQUFBLFFBQVE7d0JBQ1gsT0FBTyxjQUFZLFFBQVEsVUFBSyxLQUFLLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxPQUFJLENBQUM7b0JBQ2xFLENBQUMsQ0FBQzt5QkFDRCxJQUFJLENBQUMsRUFBRSxDQUFHLENBQUE7WUFMYixDQUthLENBQUM7WUFFaEIsSUFBSSxDQUFDLFVBQVUsRUFBRTtnQkFDZixRQUFRLENBQUMsSUFBSSxDQUFDLHdCQUFPLFVBQVUsOEdBQXNCLENBQUMsQ0FBQztnQkFFdkQsSUFBSSxLQUFLLENBQUMsV0FBVyxFQUFFO29CQUNyQixRQUFRLENBQUMs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RUgsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUNILHNCQUFDO0FBQUQsQ0FBQyxBQXZHRCxJQXVHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkYXRpb25FcnJvciB9IGZyb20gJy4vdmFsaWRhdGlvbl9lcnJvcic7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuL3R5cGVzJztcclxuLyoqXHJcbiAqIOaVsOaNrumqjOivgeW4ruWKqeexu++8jOaPkOS+m+S4gOS6m+WFrOWFseeahOaTjeS9nOaWueazleWHveaVsFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25VdGlscyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhumUmeivr+S/oeaBr+mbhuWQiOi9rOWPmOS4uuWPr+ivu+aAp+mrmOeahOaWh+acrOaVsOe7hFxyXG4gICAqIEBwYXJhbSBlcnJvcnMg6aqM6K+B5aSx6LSl6ZSZ6K+v6ZuG5ZCIXHJcbiAgICogQHBhcmFtIG1lc3NhZ2VzIOi/lOWbnueahOmUmeivr+S/oeaBr+aWh+acrOmbhuWQiFxyXG4gICAqIEBwYXJhbSBwYXJlbnRQYXRoIOmqjOivgeWxnuaAp+S4iue6p+i3r+W+hFxyXG4gICAqL1xyXG4gIHN0YXRpYyBjcmVhdGVEZXRhaWxlZEVycm9yTWVzc2FnZShcclxuICAgIGVycm9yczogVmFsaWRhdGlvbkVycm9yW10sXHJcbiAgICBtZXNzYWdlczogc3RyaW5nW10gPSBbXSxcclxuICAgIHBhcmVudFBhdGg6IHN0cmluZyA9ICcnXHJcbiAgKTogc3RyaW5nW10ge1xyXG4gICAgZXJyb3JzLmZvckVhY2goZXJyb3IgPT4ge1xyXG4gICAgICBjb25zdCB0YXJnZXROYW1lID0gZXJyb3IudGFyZ2V0ID8gZXJyb3IudGFyZ2V0LmNvbnN0cnVjdG9yLm5hbWUgOiAnJztcclxuICAgICAgY29uc3QgcHJvcGVydHkgPSBlcnJvci5wcm9wZXJ0eU5hbWU7XHJcblxyXG4gICAgICBjb25zdCBwcm9wQ29uc3RyYWludEZhaWxlZCA9IChwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHN0cmluZyA9PlxyXG4gICAgICAgIGAgICAtIOWxnuaApyAke3BhcmVudFBhdGh9JHtwcm9wZXJ0eU5hbWV9IOmqjOivgeWksei0peeahOinhOWImTogIFxcbmAgK1xyXG4gICAgICAgIGAke09iamVjdC5rZXlzKGVycm9yLmNvbnN0cmFpbnRzKVxyXG4gICAgICAgICAgLm1hcChydWxlTmFtZSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBgICAgICAgICAjJHtydWxlTmFtZX06ICR7ZXJyb3IuY29uc3RyYWludHNbcnVsZU5hbWVdfVxcbmA7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmpvaW4oJycpfWA7XHJcblxyXG4gICAgICBpZiAoIXBhcmVudFBhdGgpIHtcclxuICAgICAgICBtZXNzYWdlcy5wdXNoKGDnsbvlnovkuLogJHt0YXJnZXROYW1lfSDnmoTlrp7kvovlr7nosaHmlbDmja7pqozor4HlpLHotKXvvIzor6bnu4bkv6Hmga/vvJpcXG5gKTtcclxuXHJcbiAgICAgICAgaWYgKGVycm9yLmNvbnN0cmFpbnRzKSB7XHJcbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKHByb3BDb25zdHJhaW50RmFpbGVkKHByb3BlcnR5KSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXJyb3IuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICBWYWxpZGF0aW9uVXRpbHMuY3JlYXRlRGV0YWlsZWRFcnJvck1lc3NhZ2UoZXJyb3IuY2hpbGRyZW4sIG1lc3NhZ2VzLCBwcm9wZXJ0eSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFByb3BlcnR5ID0gTnVtYmVyLmlzSW50ZWdlcigrZXJyb3IuaW5kZXgpXHJcbiAgICAgICAgICA/IGBbJHtlcnJvci5pbmRleH1dLiR7cHJvcGVydHl9YFxyXG4gICAgICAgICAgOiBgJHtwYXJlbnRQYXRoID8gYC5gIDogYGB9JHtwcm9wZXJ0eX1gO1xyXG4gICAgICAgIGlmIChlcnJvci5jb25zdHJhaW50cykge1xyXG4gICAgICAgICAgbWVzc2FnZXMucHVzaChwcm9wQ29uc3RyYWludEZhaWxlZChmb3JtYXR0ZWRQcm9wZXJ0eSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZXJyb3IuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICBWYWxpZGF0aW9uVXRpbHMuY3JlYXRlRGV0YWlsZWRFcnJvck1lc3NhZ2UoZXJyb3IuY2hpbGRyZW4sIG1lc3NhZ2VzLCBgJHtwYXJlbnRQYXRofSR7Zm9ybWF0dGVkUHJvcGVydHl9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gbWVzc2FnZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDplJnor6/kv6Hmga/pm4blkIjovazmjaLkuLrnroDljZXlr7nosaHmoLzlvI9cclxuICAgKiBAcGFyYW0gZXJyb3JzIOmUmeivr+S/oeaBr+mbhuWQiFxyXG4gICAqIEBwYXJhbSBlcnJPYmog6L+U5Zue566A5Y2V5a+56LGh44CC5aaCOlxyXG4gICAqIGBgYFxyXG4gICAqIHsgbmFtZTogeyByZXF1aXJlZDogJ+W/heWhqycsIG1heDogJ+acgOWkp+WAvDk5JyB9LFxyXG4gICAqICAgbGlzdDoge1xyXG4gICAqICAgICAgMDogeyBuYW1lOntyZXF1aXJlZDogJ+W/heWhqyd9LFxyXG4gICAqICAgICAgICAgICBhZ2U6IHsgbWluOiAn5pyA5bCP5YC8IDIwJyB9XHJcbiAgICogICAgICAgICB9LFxyXG4gICAqICAgICAgMjogeyAuLi4gfVxyXG4gICAqICAgfVxyXG4gICAqIH1cclxuICAgKlxyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHN0YXRpYyBjb252ZXJ0RXJyb3JzVG9Ob3JtYWxPYmplY3QoZXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSwgZXJyT2JqOiB7fSk6IHt9IHtcclxuICAgIGVycm9ycy5mb3JFYWNoKGVyciA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BlcnR5ID0gZXJyLnByb3BlcnR5TmFtZTtcclxuXHJcbiAgICAgIGNvbnN0IGJ1aWxkQXJyYXkgPSAoY2hpbGRFcnJvcnM6IFZhbGlkYXRpb25FcnJvcltdKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXRlbUVyciA9IHt9O1xyXG4gICAgICAgIGNoaWxkRXJyb3JzLmZvckVhY2goKGNoaWxkRXJyOiBWYWxpZGF0aW9uRXJyb3IpID0+IHtcclxuICAgICAgICAgIGlmIChjaGlsZEVyci5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgaXRlbUVycltjaGlsZEVyci5pbmRleF0gPSBWYWxpZGF0aW9uVXRpbHMuY29udmVydEVycm9yc1RvTm9ybWFsT2JqZWN0KGNoaWxkRXJyLmNoaWxkcmVuLCBjaGlsZEVycik7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoaXRlbUVycltjaGlsZEVyci5pbmRleF0pIHtcclxuICAgICAgICAgICAgICBpdGVtRXJyW2NoaWxkRXJyLmluZGV4XSA9IE9iamVjdC5hc3NpZ24oe30sIGl0ZW1FcnJbY2hpbGRFcnIuaW5kZXhdLCB7XHJcbiAgICAgICAgICAgICAgICBbY2hpbGRFcnIucHJvcGVydHlOYW1lXTogY2hpbGRFcnIuY29uc3RyYWludHNcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBpdGVtRXJyW2NoaWxkRXJyLmluZGV4XSA9IHsgW2NoaWxkRXJyLnByb3BlcnR5TmFtZV06IGNoaWxkRXJyLmNvbnN0cmFpbnRzIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1FcnI7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAoIWVyci5pc0FycmF5KSB7XHJcbiAgICAgICAgaWYgKCFlcnIuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICBlcnJPYmpbcHJvcGVydHldID0gZXJyLmNvbnN0cmFpbnRzO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBlcnJPYmpbcHJvcGVydHldID0gVmFsaWRhdGlvblV0aWxzLmNvbnZlcnRFcnJvcnNUb05vcm1hbE9iamVjdChlcnIuY2hpbGRyZW4sIGVyck9iaik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGVyck9ialtwcm9wZXJ0eV0gPSBidWlsZEFycmF5KGVyci5jaGlsZHJlbik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBlcnJPYmo7XHJcbiAgfVxyXG59XHJcbiJdfQ==
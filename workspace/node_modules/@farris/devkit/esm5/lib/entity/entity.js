import { Subject, from } from 'rxjs';
import { tap } from 'rxjs/operators';
import { FieldMetadataUtil } from './metadata/index';
import { ModifyType, ChangeSet } from '../changeset/index';
import { PARENT_PATH, PARENT_CLASS } from './types';
import { EntityList } from './entity_list';
import { EntityFactory } from './entity_factory';
import { Validator } from './validator/index';
import { ValidationUtils } from './validator/validation_utils';
import { BigNumberType, RunMode } from '../core/types';
import { UserSettingsService } from '../i18n/user_settings_service';
import { ZonedTime } from '../i18n/zoned_time';
import { RunModeService } from '../misc';
/**
 * @author Lucas Huang
 * 实体抽象基类，所有实体必须扩展自Entity
 *
 * ### 使用示例
 * ```
 * export class UserEntity extends Entity {
 *    userId: string;
 *    userName: string;
 *
 *    constructor(data: any){
 *        super(data);
 *    }
 * }
 * ```
 */
var Entity = /** @class */ (function () {
    // #endregion
    /**
     * @param data JSON数据
     */
    function Entity(data) {
        // #region 私有、保护属性
        /**
         * 验证错误集合
         */
        this.validErrors = {};
        this.primaryFieldMetadata = null;
        this.originalData = undefined;
        /**
         * 增量变更集合
         */
        this.changeSet = new ChangeSet();
        /**
         * 是否正在验证
         */
        this.isValidating = false;
        /**
         * 新数据
         */
        this.newData = undefined;
        /**
         * 销毁流
         */
        this.unsubscribe = new Subject();
        // #endregion
        // #region 公有属性
        /**
         * 变更流
         */
        this.valueChanged = new Subject();
        /**
         * 属性值改变时触发
         *
         * ### 使用示例
         * ```
         *  const entity = new UserEntity(data);
         *  entity.onValueChanged.subscribe((data: Modification) => {
         *      console.log(data);
         *  })
         *
         * ```
         *
         * @event
         */
        this.onValueChanged = this.valueChanged.asObservable();
        this.onUpdate = new Subject();
        this.validator = new Validator();
        this.newData = Object.assign({}, data);
        this.originalData = Object.assign({}, data);
        this.onValueChanged = this.valueChanged;
        // this.onValueChanged = this.valueChanged.pipe(
        //     scan((x: Modification, curr: Modification) => {
        //         if (x) {
        //             if (isEqual(x.path, curr.path) && x.type === curr.type) {
        //                 return Object.assign(x, curr);
        //             }
        //             return curr;
        //         }
        //         return curr;
        //     })
        // );
        if (RunModeService.getRunMode() === RunMode.compatible) {
            this.initialize();
        }
        // this.validate();
    }
    Object.defineProperty(Entity.prototype, "data", {
        /**
         * 返回JSON格式的数据
         */
        get: function () {
            return this.newData;
        },
        set: function (value) {
            this.newData = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "errors", {
        /**
         * 验证错误集合
         */
        get: function () {
            return this.validErrors;
        },
        set: function (errors) {
            this.validErrors = errors;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "changeSetPolicy", {
        get: function () {
            return this._changeSetPolicy;
        },
        set: function (policy) {
            this._changeSetPolicy = policy;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "changes", {
        /**
         * 实体变更集
         */
        get: function () {
            return this.changeSet.changes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryProperty", {
        /**
         * 实体主键元数据
         */
        get: function () {
            if (!this.primaryFieldMetadata) {
                this.primaryFieldMetadata = FieldMetadataUtil.getPrimaryFieldMetadata(this.constructor);
            }
            return this.primaryFieldMetadata;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryKey", {
        /**
         * 主键
         * @todo
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryProperty) {
                return this.primaryProperty.property;
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Entity.prototype, "primaryValue", {
        /**
         * 实体主键值
         * 1、没有主键时返回''不合理，应该返回undefined
         */
        get: function () {
            if (this.primaryKey) {
                // return this[this.primaryProperty.property].toString();
                var primaryValue = this[this.primaryProperty.property];
                return primaryValue ? primaryValue : '';
            }
            else {
                return '';
            }
        },
        enumerable: true,
        configurable: true
    });
    // #region 公有方法
    /**
     * 将变更记录保存至变更集中
     * @param value 变更记录
     */
    Entity.prototype.setChanges = function (value) {
        var propertyName = value.path[value.path.length - 1];
        // @todo：事件会从下级向上冒泡，change可能是下级的，不能和当前Entity的newData合并。
        // this.newData = Object.assign(this.newData, { [propertyName]: value.value });
        this.valueChanged.next(value);
        if (!(this.validErrors && Object.keys(this.validErrors).includes(propertyName) && this.changeSetPolicy === 'valid')) {
            if (value && value.changeSetValue !== undefined) {
                value = JSON.parse(JSON.stringify(value));
                value.value = value.changeSetValue;
            }
            this.changeSet.append(value);
        }
    };
    /**
     * 校验实体各属性的值
     * @param propertyName 属性名称，如果为空，则验证实体中所有设置了验证规则的属性
     * @returns Observable<ValidationResult>
     * ### 示例
     * ```
     *  const entity = new UserEntity(data);
     *  entity.validate().subscribe(result =>{
     *      if(result.isValid){
     *          ...
     *      } else {
     *          console.log(result.message);
     *      }
     *  })
     *
     * ```
     */
    // tslint:disable-next-line: max-line-length
    Entity.prototype.validate = function (propertyName, value, externalRules, index, frameContext) {
        var _this = this;
        return from(this.validator.validate(this, propertyName, value, externalRules, index, frameContext)).pipe(tap(function (result) {
            if (!result.isValid) {
                _this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
            }
            else {
                _this.validErrors = {};
            }
        }));
    };
    Entity.prototype.validateAll = function (validateContext) {
    };
    // 用于在entity_util中调用，如果有错误，会将验证结果传入回调cb
    Entity.prototype.validateFromUtil = function (propertyName, value, cb, context) {
        var _this = this;
        this.validErrors = {};
        from(this.validator.validate(this, propertyName, value, null, undefined, context && context.frameContext || null)).subscribe(function (result) {
            if (!result.isValid) {
                _this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
            }
            // 不应重新赋值，这里仅是实体校验通过
            /*else {
              // 如果BindingObject上的属性值和Entity上对应属性值一样，则不再设置
              if (this[propertyName] === value) {
                return;
              }
              this[propertyName] = value;
            }*/
            cb(result);
        });
    };
    /**
     * 同步校验
     * @param propertyName
     * @param value
     * @param cb
     */
    Entity.prototype.validateFromUtilSync = function (propertyName, value, cb, context) {
        this.validErrors = {};
        var result = this.validator.verify(this, propertyName, value, null, undefined, context && context.frameContext || null, true);
        if (result && !result.isValid) {
            this.validErrors = ValidationUtils.convertErrorsToNormalObject(result.errors, {});
        }
        cb(result);
    };
    Entity.prototype.getPaths = function () {
        var pathObj = {
            path: [],
            isUdt: false,
            isGrid: false
        };
        var handleParent = function (item) {
            var parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                var prop = parentPaths[parentPaths.length - 1];
                // 父级所在实体包含的ngObject，存在当前实体字段，则判断为UDt字段
                if (Object.keys(FieldMetadataUtil.getNgObjects(item[PARENT_CLASS].constructor)).indexOf(prop) > -1) {
                    pathObj.isUdt = true;
                }
                // 存在类型为ngList，则判断为grid
                if (item instanceof EntityList === true) {
                    pathObj.isGrid = true;
                }
                else {
                    pathObj.path.push(prop);
                }
            }
            if (item[PARENT_CLASS]) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        pathObj.path = pathObj.path.reverse();
        return pathObj;
    };
    Entity.prototype.getEntityListPath = function () {
        var paths = [];
        var handleParent = function (item) {
            var parentPaths = item[PARENT_PATH];
            if (parentPaths) {
                if (item instanceof EntityList === true) {
                    var path = parentPaths.concat([]).reverse();
                    Array.prototype.push.apply(paths, path);
                }
            }
            if (item[PARENT_CLASS]) {
                handleParent(item[PARENT_CLASS]);
            }
        };
        handleParent(this);
        return paths.reverse();
    };
    Entity.prototype.getMainEntityPrimaryValue = function () {
        var item = this;
        while (item[PARENT_CLASS]) {
            item = item[PARENT_CLASS];
        }
        return item.primaryValue;
    };
    /**
     * 加载数据
     * @param data 新数据
     */
    Entity.prototype.load = function (data, options) {
        if (options === void 0) { options = {}; }
        if (!data) {
            data = {};
        }
        this.loadFields(data);
        if (!options || (options && options.loadChild !== false)) {
            this.loadLists(data);
        }
        this.loadObjects(data);
        this.loadDynamicObjects(data);
        this.newData = Object.assign({}, data);
        this.originalData = Object.assign({}, data);
    };
    /**
     * 转换为JSON
     * @param buildChanges 是否构造变更集
     * @param includeMultiLanguageField 是否包含多语字段
     */
    Entity.prototype.toJSON = function (buildChanges) {
        var _this = this;
        var result = {};
        // 简单属性
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            if (buildChanges === true && ngField.enableTimeZone === true) {
                result[dataField] = _this.data[propName];
            }
            else {
                result[dataField] = _this[propName];
            }
        });
        // 对象属性
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON(buildChanges) : {};
        });
        // 动态属性
        var ngDynamics = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamics).forEach(function (propName) {
            var ngDynamic = ngDynamics[propName];
            var dataField = ngDynamic.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON(buildChanges) : {};
        });
        // 列表属性
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            result[dataField] = _this[propName] ? _this[propName].toJSON(buildChanges) : {};
        });
        return result;
    };
    // #endregion
    //#region 实体初始化相关private方法
    /**
     * 初始化实体
     */
    Entity.prototype.initialize = function () {
        var constructor = this.constructor;
        var ngFields = FieldMetadataUtil.getNgFields(constructor);
        var ngObjects = FieldMetadataUtil.getNgObjects(constructor);
        var ngLists = FieldMetadataUtil.getNgList(constructor);
        var ngDynamic = FieldMetadataUtil.getNgDynamic(constructor);
        this.initializeNormalField(ngFields);
        this.initializeList(ngLists);
        this.initializeObject(ngObjects);
        this.initializeDynamic(ngDynamic);
    };
    /**
     * 创建path
     * @param propertyName 属性名称
     */
    Entity.prototype.createPath = function (propertyName) {
        var primaryFieldMetadata = this.primaryProperty;
        if (primaryFieldMetadata) {
            var primaryDataField = primaryFieldMetadata.dataField;
            return [primaryDataField + ':' + this.primaryValue, propertyName];
        }
        else {
            return [':', propertyName];
        }
    };
    /**
     * 属性字段初始化
     * @param ngFields 属性字段元数据
     */
    Entity.prototype.initializeNormalField = function (ngFields) {
        var _this = this;
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            if (delete _this[propName]) {
                Object.defineProperty(_this, propName, {
                    get: function () {
                        var value = this.getPropValue(propName, ngField);
                        return value;
                    },
                    set: function (newPropValue) {
                        // 值相同时不触发变更。
                        var oldPropValue = this.getPropValue(propName, ngField);
                        if (this.isPropValueChanged(propName, ngField, newPropValue, oldPropValue) === false) {
                            return;
                        }
                        this.setPropValue(propName, ngField, newPropValue);
                        var changeSetValue = this.preparePropValue(propName, ngField, newPropValue);
                        this.emitValueChange(propName, ngField, newPropValue, oldPropValue, changeSetValue);
                    }
                });
            }
        });
    };
    /**
     * 初始化列表类型的元数据
     * @param ngListMetadata 列表类型元数据
     */
    Entity.prototype.initializeList = function (ngListMetadata) {
        var _this = this;
        Object.keys(ngListMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngListMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var val = _this.data[dataField];
            var entityList = new EntityList();
            entityList[PARENT_CLASS] = _this;
            entityList[PARENT_PATH] = path;
            if (val) {
                var entities = val.map(function (v) { return EntityFactory(fieldMetadata.type, v); });
                entityList.loadEntities(entities);
            }
            entityList.onListChanged.subscribe(function (value) {
                if (value) {
                    if (entityList[PARENT_PATH][0] !== value.path[0]) {
                        value.path = entityList[PARENT_PATH].concat(value.path);
                    }
                    _this.setChanges(value);
                }
            });
            _this[propertyName] = entityList;
        });
    };
    /**
     * 初始化子对象
     * @param ngObjectMetadata 子对象元数据
     */
    Entity.prototype.initializeObject = function (ngObjectMetadata) {
        var _this = this;
        Object.keys(ngObjectMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngObjectMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            // val不存在时，用空对象代替
            var val = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            // 如果没有值用一个空对象代替
            var childEntity = createEntityFromJsonData(val);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return childEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: childEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        childEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    }
                });
            }
        });
    };
    Entity.prototype.initializeDynamic = function (ngDynamicMetadata) {
        var _this = this;
        Object.keys(ngDynamicMetadata).forEach(function (propertyName) {
            var fieldMetadata = ngDynamicMetadata[propertyName];
            var path = _this.createPath(propertyName);
            var dataField = fieldMetadata.dataField || propertyName;
            var originalData = _this.data[dataField] || {};
            var createEntityFromJsonData = function (value) {
                var instance;
                if (value instanceof fieldMetadata.type) {
                    instance = value;
                }
                else {
                    instance = EntityFactory(fieldMetadata.type, value);
                }
                instance[PARENT_CLASS] = _this;
                instance[PARENT_PATH] = path;
                instance.onValueChanged.subscribe(function (changes) {
                    if (changes) {
                        changes.path = (_this[PARENT_PATH] || []).concat(changes.path);
                        _this.setChanges(changes);
                    }
                });
                return instance;
            };
            var dynamicEntity = createEntityFromJsonData(originalData);
            if (delete _this[propertyName]) {
                Object.defineProperty(_this, propertyName, {
                    get: function () {
                        return dynamicEntity;
                    },
                    set: function (value) {
                        var modifyInfo = {
                            path: dynamicEntity[PARENT_PATH],
                            value: value.data,
                            preValue: this[propertyName].data,
                            type: ModifyType.ValueChange
                        };
                        dynamicEntity = createEntityFromJsonData(value);
                        this.setChanges(modifyInfo);
                    }
                });
            }
        });
    };
    //#endregion
    // #region 加载实体数据相关private、projected方法
    /**
     * 加载简单字段值
     * @todo 临时用修改的方式模拟
     */
    Entity.prototype.loadFields = function (data) {
        var _this = this;
        var ngFields = FieldMetadataUtil.getNgFields(this.constructor);
        Object.keys(ngFields).forEach(function (propName) {
            var ngField = ngFields[propName];
            var dataField = ngField.dataField || propName;
            // if (ngField.primary === false) {
            //   this[propName] = data[dataField];
            // }
            var propValue = data[dataField];
            if (ngField.enableTimeZone === true) {
                var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                if (timeZoneOffset !== null && propValue) {
                    propValue = ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(propValue, timeZoneOffset);
                }
            }
            _this[propName] = propValue;
        });
    };
    /**
     * 加载子列表数据
     * @param data 数据
     */
    Entity.prototype.loadLists = function (data) {
        var _this = this;
        var ngLists = FieldMetadataUtil.getNgList(this.constructor);
        Object.keys(ngLists).forEach(function (propName) {
            var ngList = ngLists[propName];
            var dataField = ngList.dataField || propName;
            var entityType = ngList.type;
            // 创建实体
            var listData = data[dataField];
            if (listData) {
                var entities = listData.map(function (entityData) {
                    return EntityFactory(entityType, entityData);
                });
                _this[propName].loadEntities(entities);
            }
            else {
                _this[propName].loadEntities([]);
            }
        });
    };
    Entity.prototype.loadObjects = function (data) {
        var _this = this;
        var ngObjects = FieldMetadataUtil.getNgObjects(this.constructor);
        Object.keys(ngObjects).forEach(function (propName) {
            var ngObject = ngObjects[propName];
            var dataField = ngObject.dataField || propName;
            var objectData = data[dataField];
            var entity = _this[propName];
            if (!entity || !objectData) {
                return;
            }
            entity.load(objectData);
        });
    };
    Entity.prototype.loadDynamicObjects = function (data) {
        var _this = this;
        var ngDynamicObjects = FieldMetadataUtil.getNgDynamic(this.constructor);
        Object.keys(ngDynamicObjects).forEach(function (propName) {
            var ngDynamicObject = ngDynamicObjects[propName];
            var dataField = ngDynamicObject.dataField || propName;
            var dynamicData = data[dataField] || {};
            var dynamicEntity = _this[propName];
            if (!dynamicEntity) {
                return;
            }
            dynamicEntity.loadDynamicData(dynamicData);
        });
    };
    // #endregion
    // #region 私有工具方法
    /**
     * 发送值变更
     */
    Entity.prototype.emitValueChange = function (propName, propMetadata, newPropValue, oldPropValue, changeSetValue) {
        if (changeSetValue === void 0) { changeSetValue = undefined; }
        var change = {
            path: this.createPath(propName),
            value: newPropValue,
            changeSetValue: changeSetValue,
            preValue: oldPropValue,
            type: ModifyType.ValueChange
        };
        if (this[PARENT_PATH]) {
            change.path = this[PARENT_PATH].concat(change.path);
        }
        this.setChanges(change);
    };
    /**
     * 准备提交给后端的属性值
     * @param propName 属性
     * @param propMetadata 属性描述
     * @param propValue 属性值
     */
    Entity.prototype.preparePropValue = function (propName, propMetadata, propValue) {
        var value = undefined;
        // 只要启用时区，传给后端的时间就必须带时区，因此当获取用户时区失败的时候，获取浏览器当前时区
        if (propMetadata.enableTimeZone === true) {
            var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
            if (timeZoneOffset !== null && propValue) {
                value = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);
            }
        }
        return value;
    };
    /**
     * 获取属性值
     */
    Entity.prototype.getPropValue = function (propName, propMetadata) {
        var _a;
        var dataField = propMetadata.dataField || propName;
        var value = this.data[dataField];
        // 对多语录入字段，query不返回问题进行兼容
        if (propMetadata.enableMultiLangInput === true && !value) {
            var langCode = window.localStorage.getItem('languageCode') || 'zh-CHS';
            var originDataField = dataField.replace('_MULTILANGUAGE', '');
            return _a = {},
                _a[langCode] = this.data[originDataField],
                _a;
        }
        // 启用时区
        if (propMetadata.enableTimeZone === true) {
            var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
            if (timeZoneOffset !== null && value) {
                return ZonedTime.zonedTimeToSpecialTimeZoneOffsetTimeString(value, timeZoneOffset);
            }
        }
        if (propMetadata.originalDataFieldType === BigNumberType) {
            value = value !== null && value !== undefined && value.toString() || null;
        }
        return value;
    };
    /**
     * 设置属性值
     */
    Entity.prototype.setPropValue = function (propName, propMetadata, propValue) {
        var dataField = propMetadata.dataField || propName;
        if (propMetadata.originalDataFieldType === BigNumberType) {
            this.data[dataField] = propValue === null ? null : propValue && propValue.toString() || '';
        }
        else {
            if (propMetadata.enableTimeZone === true) {
                var timeZoneOffset = UserSettingsService.getTimeZoneOffset();
                if (timeZoneOffset !== null && propValue) {
                    propValue = ZonedTime.timeZoneOffsetTimeToUtcTimeString(propValue, timeZoneOffset);
                }
            }
            this.data[dataField] = propValue;
        }
    };
    /**
     * 检查属性值是否发生变化
     */
    Entity.prototype.isPropValueChanged = function (propName, propMetadata, newPropValue, oldPropValue) {
        if (propMetadata.enableMultiLangInput === true) {
            if (this.isEmptyMultiLangPropValue(newPropValue) === true && this.isEmptyMultiLangPropValue(oldPropValue) === true) {
                return false;
            }
            return JSON.stringify(newPropValue) !== JSON.stringify(oldPropValue);
        }
        else if (propMetadata.originalDataFieldType === BigNumberType) {
            if (typeof newPropValue !== 'string' && newPropValue !== null && newPropValue !== undefined) {
                newPropValue = newPropValue.toString();
            }
            return newPropValue !== oldPropValue;
        }
        else {
            return newPropValue !== oldPropValue;
        }
    };
    /**
     * 多语录入字段的值是否为空
     */
    Entity.prototype.isEmptyMultiLangPropValue = function (value) {
        if (!value) {
            return true;
        }
        var keys = Object.keys(value);
        if (keys.length === 0) {
            return true;
        }
        // 值全部为空，视为空
        var vals = Object.values(value);
        var allEmptyVal = vals.every(function (val) {
            return !val;
        });
        if (allEmptyVal === true) {
            return true;
        }
        return false;
    };
    return Entity;
}());
export { Entity };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9kZXZraXQvIiwic291cmNlcyI6WyJsaWIvZW50aXR5L2VudGl0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUF3RSxpQkFBaUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNILE9BQU8sRUFBZ0IsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFXLE1BQU0sU0FBUyxDQUFDO0FBQzdELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxTQUFTLEVBQWtDLE1BQU0sbUJBQW1CLENBQUM7QUFDOUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQW1CLE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUN6Qzs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFDSDtJQW1JRSxhQUFhO0lBR2I7O09BRUc7SUFDSCxnQkFBWSxJQUFTO1FBeElyQixrQkFBa0I7UUFFbEI7O1dBRUc7UUFDSyxnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUNqQix5QkFBb0IsR0FBb0IsSUFBSSxDQUFDO1FBQzdDLGlCQUFZLEdBQUcsU0FBUyxDQUFDO1FB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WixJQUFNLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xDLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO1lBQ2pDLE9BQU8sQ0FBQyxHQUFHLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksV0FBVyxLQUFLLElBQUksRUFBRTtZQUN4QixPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUgsYUFBQztBQUFELENBQUMsQUExd0JELElBMHdCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBOZ0ZpZWxkUHJvcGVydHksIE5nTGlzdFByb3BlcnR5LCBOZ09iamVjdFByb3BlcnR5LCBOZ0R5bmFtaWNQcm9wZXJ0eSwgRmllbGRNZXRhZGF0YVV0aWwgfSBmcm9tICcuL21ldGFkYXRhL2luZGV4JztcclxuaW1wb3J0IHsgTW9kaWZpY2F0aW9uLCBNb2RpZnlUeXBlLCBDaGFuZ2VTZXQgfSBmcm9tICcuLi9jaGFuZ2VzZXQvaW5kZXgnO1xyXG5pbXBvcnQgeyBQQVJFTlRfUEFUSCwgUEFSRU5UX0NMQVNTLCBEeW5hbWljIH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IEVudGl0eUxpc3QgfSBmcm9tICcuL2VudGl0eV9saXN0JztcclxuaW1wb3J0IHsgRW50aXR5RmFjdG9yeSB9IGZyb20gJy4vZW50aXR5X2ZhY3RvcnknO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3IsIFZhbGlkYXRpb25SZXN1bHQsIFZhbGlkYXRlUnVsZSB9IGZyb20gJy4vdmFsaWRhdG9yL2luZGV4JztcclxuaW1wb3J0IHsgVmFsaWRhdGlvblV0aWxzIH0gZnJvbSAnLi92YWxpZGF0b3IvdmFsaWRhdGlvbl91dGlscyc7XHJcbmltcG9ydCB7IEJpZ051bWJlclR5cGUsIENoYW5nZVNldFBvbGljeSwgUnVuTW9kZSB9IGZyb20gJy4uL2NvcmUvdHlwZXMnO1xyXG5pbXBvcnQgeyBVc2VyU2V0dGluZ3NTZXJ2aWNlIH0gZnJvbSAnLi4vaTE4bi91c2VyX3NldHRpbmdzX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBab25lZFRpbWUgfSBmcm9tICcuLi9pMThuL3pvbmVkX3RpbWUnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICcuLi9mcmFtZS9pbmRleCc7XHJcbmltcG9ydCB7IFJ1bk1vZGVTZXJ2aWNlIH0gZnJvbSAnLi4vbWlzYyc7XHJcbi8qKlxyXG4gKiBAYXV0aG9yIEx1Y2FzIEh1YW5nXHJcbiAqIOWunuS9k+aKveixoeWfuuexu++8jOaJgOacieWunuS9k+W/hemhu+aJqeWxleiHqkVudGl0eVxyXG4gKlxyXG4gKiAjIyMg5L2/55So56S65L6LXHJcbiAqIGBgYFxyXG4gKiBleHBvcnQgY2xhc3MgVXNlckVudGl0eSBleHRlbmRzIEVudGl0eSB7XHJcbiAqICAgIHVzZXJJZDogc3RyaW5nO1xyXG4gKiAgICB1c2VyTmFtZTogc3RyaW5nO1xyXG4gKlxyXG4gKiAgICBjb25zdHJ1Y3RvcihkYXRhOiBhbnkpe1xyXG4gKiAgICAgICAgc3VwZXIoZGF0YSk7XHJcbiAqICAgIH1cclxuICogfVxyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFbnRpdHkge1xyXG4gIC8vICNyZWdpb24g56eB5pyJ44CB5L+d5oqk5bGe5oCnXHJcblxyXG4gIC8qKlxyXG4gICAqIOmqjOivgemUmeivr+mbhuWQiFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdmFsaWRFcnJvcnMgPSB7fTtcclxuICBwcml2YXRlIHByaW1hcnlGaWVsZE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHkgPSBudWxsO1xyXG4gIHByaXZhdGUgb3JpZ2luYWxEYXRhID0gdW5kZWZpbmVkO1xyXG4gIC8qKlxyXG4gICAqIOmqjOivgeWZqFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdmFsaWRhdG9yOiBWYWxpZGF0b3I8YW55PjtcclxuXHJcbiAgLyoqXHJcbiAgICog5aKe6YeP5Y+Y5pu06ZuG5ZCIXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGNoYW5nZVNldCA9IG5ldyBDaGFuZ2VTZXQoKTtcclxuXHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5q2j5Zyo6aqM6K+BXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGlzVmFsaWRhdGluZyA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiDmlrDmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgbmV3RGF0YSA9IHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiDplIDmr4HmtYFcclxuICAgKi9cclxuICBwdWJsaWMgdW5zdWJzY3JpYmU6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu05o+Q5Lqk562W55WlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY2hhbmdlU2V0UG9saWN5OiBDaGFuZ2VTZXRQb2xpY3k7XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDlhazmnInlsZ7mgKdcclxuXHJcbiAgLyoqXHJcbiAgICog5Y+Y5pu05rWBXHJcbiAgICovXHJcbiAgcHVibGljIHZhbHVlQ2hhbmdlZCA9IG5ldyBTdWJqZWN0PE1vZGlmaWNhdGlvbj4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICog5bGe5oCn5YC85pS55Y+Y5pe26Kem5Y+RXHJcbiAgICpcclxuICAgKiAjIyMg5L2/55So56S65L6LXHJcbiAgICogYGBgXHJcbiAgICogIGNvbnN0IGVudGl0eSA9IG5ldyBVc2VyRW50aXR5KGRhdGEpO1xyXG4gICAqICBlbnRpdHkub25WYWx1ZUNoYW5nZWQuc3Vic2NyaWJlKChkYXRhOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgKiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAqICB9KVxyXG4gICAqXHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiBAZXZlbnRcclxuICAgKi9cclxuICBwdWJsaWMgb25WYWx1ZUNoYW5nZWQgPSB0aGlzLnZhbHVlQ2hhbmdlZC5hc09ic2VydmFibGUoKTtcclxuICBwdWJsaWMgb25VcGRhdGUgPSBuZXcgU3ViamVjdDxNb2RpZmljYXRpb24+KCk7XHJcbiAgLyoqXHJcbiAgICog6L+U5ZueSlNPTuagvOW8j+eahOaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgZGF0YSgpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMubmV3RGF0YTtcclxuICB9XHJcbiAgcHVibGljIHNldCBkYXRhKHZhbHVlOiBhbnkpIHtcclxuICAgIHRoaXMubmV3RGF0YSA9IHZhbHVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpqozor4HplJnor6/pm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGVycm9ycygpIHtcclxuICAgIHJldHVybiB0aGlzLnZhbGlkRXJyb3JzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBlcnJvcnMoZXJyb3JzOiBhbnkpIHtcclxuICAgIHRoaXMudmFsaWRFcnJvcnMgPSBlcnJvcnM7XHJcbiAgfVxyXG4gIHB1YmxpYyBzZXQgY2hhbmdlU2V0UG9saWN5KHBvbGljeTogQ2hhbmdlU2V0UG9saWN5KSB7XHJcbiAgICB0aGlzLl9jaGFuZ2VTZXRQb2xpY3kgPSBwb2xpY3k7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXQgY2hhbmdlU2V0UG9saWN5KCk6IENoYW5nZVNldFBvbGljeSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY2hhbmdlU2V0UG9saWN5O1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlrp7kvZPlj5jmm7Tpm4ZcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGNoYW5nZXMoKTogTW9kaWZpY2F0aW9uW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuY2hhbmdlU2V0LmNoYW5nZXM7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S4u+mUruWFg+aVsOaNrlxyXG4gICAqL1xyXG5cclxuICBwdWJsaWMgZ2V0IHByaW1hcnlQcm9wZXJ0eSgpOiBOZ0ZpZWxkUHJvcGVydHkge1xyXG4gICAgaWYgKCF0aGlzLnByaW1hcnlGaWVsZE1ldGFkYXRhKSB7XHJcbiAgICAgIHRoaXMucHJpbWFyeUZpZWxkTWV0YWRhdGEgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXRQcmltYXJ5RmllbGRNZXRhZGF0YSh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnByaW1hcnlGaWVsZE1ldGFkYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Li76ZSuXHJcbiAgICogQHRvZG9cclxuICAgKiAx44CB5rKh5pyJ5Li76ZSu5pe26L+U5ZueJyfkuI3lkIjnkIbvvIzlupTor6Xov5Tlm551bmRlZmluZWRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IHByaW1hcnlLZXkoKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLnByaW1hcnlQcm9wZXJ0eSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5wcmltYXJ5UHJvcGVydHkucHJvcGVydHk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrp7kvZPkuLvplK7lgLxcclxuICAgKiAx44CB5rKh5pyJ5Li76ZSu5pe26L+U5ZueJyfkuI3lkIjnkIbvvIzlupTor6Xov5Tlm551bmRlZmluZWRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IHByaW1hcnlWYWx1ZSgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMucHJpbWFyeUtleSkge1xyXG4gICAgICAvLyByZXR1cm4gdGhpc1t0aGlzLnByaW1hcnlQcm9wZXJ0eS5wcm9wZXJ0eV0udG9TdHJpbmcoKTtcclxuICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gdGhpc1t0aGlzLnByaW1hcnlQcm9wZXJ0eS5wcm9wZXJ0eV07XHJcbiAgICAgIHJldHVybiBwcmltYXJ5VmFsdWUgPyBwcmltYXJ5VmFsdWUgOiAnJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBkYXRhIEpTT07mlbDmja5cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihkYXRhOiBhbnkpIHtcclxuICAgIHRoaXMudmFsaWRhdG9yID0gbmV3IFZhbGlkYXRvcigpO1xyXG4gICAgdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xyXG4gICAgdGhpcy5vblZhbHVlQ2hhbmdlZCA9IHRoaXMudmFsdWVDaGFuZ2VkO1xyXG4gICAgLy8gdGhpcy5vblZhbHVlQ2hhbmdlZCA9IHRoaXMudmFsdWVDaGFuZ2VkLnBpcGUoXHJcbiAgICAvLyAgICAgc2NhbigoeDogTW9kaWZpY2F0aW9uLCBjdXJyOiBNb2RpZmljYXRpb24pID0+IHtcclxuICAgIC8vICAgICAgICAgaWYgKHgpIHtcclxuICAgIC8vICAgICAgICAgICAgIGlmIChpc0VxdWFsKHgucGF0aCwgY3Vyci5wYXRoKSAmJiB4LnR5cGUgPT09IGN1cnIudHlwZSkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHgsIGN1cnIpO1xyXG4gICAgLy8gICAgICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICAgICAgcmV0dXJuIGN1cnI7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgcmV0dXJuIGN1cnI7XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICk7XHJcbiAgICBpZiAoUnVuTW9kZVNlcnZpY2UuZ2V0UnVuTW9kZSgpID09PSBSdW5Nb2RlLmNvbXBhdGlibGUpIHtcclxuICAgICAgdGhpcy5pbml0aWFsaXplKCk7XHJcbiAgICB9XHJcbiAgICAvLyB0aGlzLnZhbGlkYXRlKCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8gI3JlZ2lvbiDlhazmnInmlrnms5VcclxuXHJcbiAgLyoqXHJcbiAgICog5bCG5Y+Y5pu06K6w5b2V5L+d5a2Y6Iez5Y+Y5pu06ZuG5LitXHJcbiAgICogQHBhcmFtIHZhbHVlIOWPmOabtOiusOW9lVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDaGFuZ2VzKHZhbHVlOiBNb2RpZmljYXRpb24pOiB2b2lkIHtcclxuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHZhbHVlLnBhdGhbdmFsdWUucGF0aC5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAvLyBAdG9kb++8muS6i+S7tuS8muS7juS4i+e6p+WQkeS4iuWGkuazoe+8jGNoYW5nZeWPr+iDveaYr+S4i+e6p+eahO+8jOS4jeiDveWSjOW9k+WJjUVudGl0eeeahG5ld0RhdGHlkIjlubbjgIJcclxuICAgIC8vIHRoaXMubmV3RGF0YSA9IE9iamVjdC5hc3NpZ24odGhpcy5uZXdEYXRhLCB7IFtwcm9wZXJ0eU5hbWVdOiB2YWx1ZS52YWx1ZSB9KTtcclxuXHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlZC5uZXh0KHZhbHVlKTtcclxuICAgIGlmICghKHRoaXMudmFsaWRFcnJvcnMgJiYgT2JqZWN0LmtleXModGhpcy52YWxpZEVycm9ycykuaW5jbHVkZXMocHJvcGVydHlOYW1lKSAmJiB0aGlzLmNoYW5nZVNldFBvbGljeSA9PT0gJ3ZhbGlkJykpIHtcclxuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLmNoYW5nZVNldFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB2YWx1ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcclxuICAgICAgICB2YWx1ZS52YWx1ZSA9IHZhbHVlLmNoYW5nZVNldFZhbHVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuY2hhbmdlU2V0LmFwcGVuZCh2YWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoKHpqozlrp7kvZPlkITlsZ7mgKfnmoTlgLxcclxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIOWxnuaAp+WQjeensO+8jOWmguaenOS4uuepuu+8jOWImemqjOivgeWunuS9k+S4reaJgOacieiuvue9ruS6humqjOivgeinhOWImeeahOWxnuaAp1xyXG4gICAqIEByZXR1cm5zIE9ic2VydmFibGU8VmFsaWRhdGlvblJlc3VsdD5cclxuICAgKiAjIyMg56S65L6LXHJcbiAgICogYGBgXHJcbiAgICogIGNvbnN0IGVudGl0eSA9IG5ldyBVc2VyRW50aXR5KGRhdGEpO1xyXG4gICAqICBlbnRpdHkudmFsaWRhdGUoKS5zdWJzY3JpYmUocmVzdWx0ID0+e1xyXG4gICAqICAgICAgaWYocmVzdWx0LmlzVmFsaWQpe1xyXG4gICAqICAgICAgICAgIC4uLlxyXG4gICAqICAgICAgfSBlbHNlIHtcclxuICAgKiAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQubWVzc2FnZSk7XHJcbiAgICogICAgICB9XHJcbiAgICogIH0pXHJcbiAgICpcclxuICAgKiBgYGBcclxuICAgKi9cclxuXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBtYXgtbGluZS1sZW5ndGhcclxuICBwdWJsaWMgdmFsaWRhdGUocHJvcGVydHlOYW1lPzogc3RyaW5nLCB2YWx1ZT8sIGV4dGVybmFsUnVsZXM/OiBNYXA8c3RyaW5nLCBWYWxpZGF0ZVJ1bGVbXT4sIGluZGV4PzogbnVtYmVyLCBmcmFtZUNvbnRleHQ/OiBGcmFtZUNvbnRleHQpOiBPYnNlcnZhYmxlPFZhbGlkYXRpb25SZXN1bHQ+IHtcclxuICAgIHJldHVybiBmcm9tKHRoaXMudmFsaWRhdG9yLnZhbGlkYXRlKHRoaXMsIHByb3BlcnR5TmFtZSwgdmFsdWUsIGV4dGVybmFsUnVsZXMsIGluZGV4LCBmcmFtZUNvbnRleHQpKS5waXBlKFxyXG4gICAgICB0YXAocmVzdWx0ID0+IHtcclxuICAgICAgICBpZiAoIXJlc3VsdC5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICB0aGlzLnZhbGlkRXJyb3JzID0gVmFsaWRhdGlvblV0aWxzLmNvbnZlcnRFcnJvcnNUb05vcm1hbE9iamVjdChyZXN1bHQuZXJyb3JzLCB7fSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMudmFsaWRFcnJvcnMgPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHZhbGlkYXRlQWxsKHZhbGlkYXRlQ29udGV4dD86IE1hcDxzdHJpbmcsIFZhbGlkYXRlUnVsZVtdPikge1xyXG5cclxuICB9XHJcblxyXG4gIC8vIOeUqOS6juWcqGVudGl0eV91dGls5Lit6LCD55So77yM5aaC5p6c5pyJ6ZSZ6K+v77yM5Lya5bCG6aqM6K+B57uT5p6c5Lyg5YWl5Zue6LCDY2JcclxuICBwdWJsaWMgdmFsaWRhdGVGcm9tVXRpbChwcm9wZXJ0eU5hbWU6IHN0cmluZywgdmFsdWUsIGNiLCBjb250ZXh0PzogYW55KSB7XHJcbiAgICB0aGlzLnZhbGlkRXJyb3JzID0ge307XHJcbiAgICBmcm9tKHRoaXMudmFsaWRhdG9yLnZhbGlkYXRlKHRoaXMsIHByb3BlcnR5TmFtZSwgdmFsdWUsIG51bGwsIHVuZGVmaW5lZCwgY29udGV4dCAmJiBjb250ZXh0LmZyYW1lQ29udGV4dCB8fCBudWxsKSkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgIGlmICghcmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICB0aGlzLnZhbGlkRXJyb3JzID0gVmFsaWRhdGlvblV0aWxzLmNvbnZlcnRFcnJvcnNUb05vcm1hbE9iamVjdChyZXN1bHQuZXJyb3JzLCB7fSk7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5LiN5bqU6YeN5paw6LWL5YC877yM6L+Z6YeM5LuF5piv5a6e5L2T5qCh6aqM6YCa6L+HXHJcbiAgICAgIC8qZWxzZSB7XHJcbiAgICAgICAgLy8g5aaC5p6cQmluZGluZ09iamVjdOS4iueahOWxnuaAp+WAvOWSjEVudGl0eeS4iuWvueW6lOWxnuaAp+WAvOS4gOagt++8jOWImeS4jeWGjeiuvue9rlxyXG4gICAgICAgIGlmICh0aGlzW3Byb3BlcnR5TmFtZV0gPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXNbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICB9Ki9cclxuICAgICAgY2IocmVzdWx0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlkIzmraXmoKHpqoxcclxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIFxyXG4gICAqIEBwYXJhbSB2YWx1ZSBcclxuICAgKiBAcGFyYW0gY2IgXHJcbiAgICovXHJcbiAgcHVibGljIHZhbGlkYXRlRnJvbVV0aWxTeW5jKHByb3BlcnR5TmFtZTogc3RyaW5nLCB2YWx1ZTogYW55LCBjYjogYW55LCBjb250ZXh0PzogYW55KSB7XHJcbiAgICB0aGlzLnZhbGlkRXJyb3JzID0ge307XHJcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IHRoaXMudmFsaWRhdG9yLnZlcmlmeSh0aGlzLCBwcm9wZXJ0eU5hbWUsIHZhbHVlLCBudWxsLCB1bmRlZmluZWQsIGNvbnRleHQgJiYgY29udGV4dC5mcmFtZUNvbnRleHQgfHwgbnVsbCwgdHJ1ZSk7XHJcbiAgICBpZiAocmVzdWx0ICYmICFyZXN1bHQuaXNWYWxpZCkge1xyXG4gICAgICB0aGlzLnZhbGlkRXJyb3JzID0gVmFsaWRhdGlvblV0aWxzLmNvbnZlcnRFcnJvcnNUb05vcm1hbE9iamVjdChyZXN1bHQuZXJyb3JzLCB7fSk7XHJcbiAgICB9XHJcbiAgICBjYihyZXN1bHQpO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0UGF0aHMoKSB7XHJcbiAgICBjb25zdCBwYXRoT2JqID0ge1xyXG4gICAgICBwYXRoOiBbXSxcclxuICAgICAgaXNVZHQ6IGZhbHNlLFxyXG4gICAgICBpc0dyaWQ6IGZhbHNlXHJcbiAgICB9O1xyXG4gICAgY29uc3QgaGFuZGxlUGFyZW50ID0gaXRlbSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcmVudFBhdGhzID0gaXRlbVtQQVJFTlRfUEFUSF07XHJcbiAgICAgIGlmIChwYXJlbnRQYXRocykge1xyXG4gICAgICAgIGNvbnN0IHByb3AgPSBwYXJlbnRQYXRoc1twYXJlbnRQYXRocy5sZW5ndGggLSAxXTtcclxuICAgICAgICAvLyDniLbnuqfmiYDlnKjlrp7kvZPljIXlkKvnmoRuZ09iamVjdO+8jOWtmOWcqOW9k+WJjeWunuS9k+Wtl+aute+8jOWImeWIpOaWreS4ulVEdOWtl+autVxyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoaXRlbVtQQVJFTlRfQ0xBU1NdLmNvbnN0cnVjdG9yKSkuaW5kZXhPZihwcm9wKSA+IC0xKSB7XHJcbiAgICAgICAgICBwYXRoT2JqLmlzVWR0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5a2Y5Zyo57G75Z6L5Li6bmdMaXN077yM5YiZ5Yik5pat5Li6Z3JpZFxyXG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgRW50aXR5TGlzdCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgcGF0aE9iai5pc0dyaWQgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBwYXRoT2JqLnBhdGgucHVzaChwcm9wKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9XHJcbiAgICAgIGlmIChpdGVtW1BBUkVOVF9DTEFTU10pIHtcclxuICAgICAgICBoYW5kbGVQYXJlbnQoaXRlbVtQQVJFTlRfQ0xBU1NdKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGhhbmRsZVBhcmVudCh0aGlzKTtcclxuICAgIHBhdGhPYmoucGF0aCA9IHBhdGhPYmoucGF0aC5yZXZlcnNlKCk7XHJcbiAgICByZXR1cm4gcGF0aE9iajtcclxuICB9XHJcbiAgcHVibGljIGdldEVudGl0eUxpc3RQYXRoKCkge1xyXG4gICAgbGV0IHBhdGhzID0gW107XHJcbiAgICBjb25zdCBoYW5kbGVQYXJlbnQgPSAoaXRlbTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcmVudFBhdGhzID0gaXRlbVtQQVJFTlRfUEFUSF07XHJcbiAgICAgIGlmIChwYXJlbnRQYXRocykge1xyXG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgRW50aXR5TGlzdCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgY29uc3QgcGF0aCA9IHBhcmVudFBhdGhzLmNvbmNhdChbXSkucmV2ZXJzZSgpO1xyXG4gICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocGF0aHMsIHBhdGgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAoaXRlbVtQQVJFTlRfQ0xBU1NdKSB7XHJcbiAgICAgICAgaGFuZGxlUGFyZW50KGl0ZW1bUEFSRU5UX0NMQVNTXSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBoYW5kbGVQYXJlbnQodGhpcyk7XHJcbiAgICByZXR1cm4gcGF0aHMucmV2ZXJzZSgpO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0TWFpbkVudGl0eVByaW1hcnlWYWx1ZSgpIHtcclxuICAgIGxldCBpdGVtID0gdGhpcztcclxuICAgIHdoaWxlIChpdGVtW1BBUkVOVF9DTEFTU10pIHtcclxuICAgICAgaXRlbSA9IGl0ZW1bUEFSRU5UX0NMQVNTXTtcclxuICAgIH1cclxuICAgIHJldHVybiBpdGVtLnByaW1hcnlWYWx1ZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yqg6L295pWw5o2uXHJcbiAgICogQHBhcmFtIGRhdGEg5paw5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWQoZGF0YTogYW55LCBvcHRpb25zOiBhbnkgPSB7fSkge1xyXG4gICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgIGRhdGEgPSB7fTtcclxuICAgIH1cclxuICAgIHRoaXMubG9hZEZpZWxkcyhkYXRhKTtcclxuICAgIGlmICghb3B0aW9ucyB8fCAob3B0aW9ucyAmJiBvcHRpb25zLmxvYWRDaGlsZCAhPT0gZmFsc2UpKSB7XHJcbiAgICAgIHRoaXMubG9hZExpc3RzKGRhdGEpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5sb2FkT2JqZWN0cyhkYXRhKTtcclxuICAgIHRoaXMubG9hZER5bmFtaWNPYmplY3RzKGRhdGEpO1xyXG4gICAgdGhpcy5uZXdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XHJcbiAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGRhdGEpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDovazmjaLkuLpKU09OXHJcbiAgICogQHBhcmFtIGJ1aWxkQ2hhbmdlcyDmmK/lkKbmnoTpgKDlj5jmm7Tpm4ZcclxuICAgKiBAcGFyYW0gaW5jbHVkZU11bHRpTGFuZ3VhZ2VGaWVsZCDmmK/lkKbljIXlkKvlpJror63lrZfmrrVcclxuICAgKi9cclxuICBwdWJsaWMgdG9KU09OKGJ1aWxkQ2hhbmdlcz86IGJvb2xlYW4pIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xyXG5cclxuICAgIC8vIOeugOWNleWxnuaAp1xyXG4gICAgY29uc3QgbmdGaWVsZHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0ZpZWxkcyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRmllbGRzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRmllbGQgPSBuZ0ZpZWxkc1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nRmllbGQuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICBpZiAoYnVpbGRDaGFuZ2VzID09PSB0cnVlICYmIG5nRmllbGQuZW5hYmxlVGltZVpvbmUgPT09IHRydWUpIHtcclxuICAgICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXMuZGF0YVtwcm9wTmFtZV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzW3Byb3BOYW1lXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5a+56LGh5bGe5oCnXHJcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ09iamVjdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdPYmplY3QgPSBuZ09iamVjdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ09iamVjdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIHJlc3VsdFtkYXRhRmllbGRdID0gdGhpc1twcm9wTmFtZV0gPyB0aGlzW3Byb3BOYW1lXS50b0pTT04oYnVpbGRDaGFuZ2VzKSA6IHt9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5Yqo5oCB5bGe5oCnXHJcbiAgICBjb25zdCBuZ0R5bmFtaWNzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdEeW5hbWljKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdEeW5hbWljcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0R5bmFtaWMgPSBuZ0R5bmFtaWNzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdEeW5hbWljLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgcmVzdWx0W2RhdGFGaWVsZF0gPSB0aGlzW3Byb3BOYW1lXSA/IHRoaXNbcHJvcE5hbWVdLnRvSlNPTihidWlsZENoYW5nZXMpIDoge307XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDliJfooajlsZ7mgKdcclxuICAgIGNvbnN0IG5nTGlzdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0xpc3QodGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nTGlzdCA9IG5nTGlzdHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0xpc3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICByZXN1bHRbZGF0YUZpZWxkXSA9IHRoaXNbcHJvcE5hbWVdID8gdGhpc1twcm9wTmFtZV0udG9KU09OKGJ1aWxkQ2hhbmdlcykgOiB7fTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyNyZWdpb24g5a6e5L2T5Yid5aeL5YyW55u45YWzcHJpdmF0ZeaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJblrp7kvZNcclxuICAgKi9cclxuICBwcml2YXRlIGluaXRpYWxpemUoKSB7XHJcbiAgICBjb25zdCBjb25zdHJ1Y3RvciA9IHRoaXMuY29uc3RydWN0b3I7XHJcblxyXG4gICAgY29uc3QgbmdGaWVsZHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0ZpZWxkcyhjb25zdHJ1Y3Rvcik7XHJcbiAgICBjb25zdCBuZ09iamVjdHMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ09iamVjdHMoY29uc3RydWN0b3IpO1xyXG4gICAgY29uc3QgbmdMaXN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdChjb25zdHJ1Y3Rvcik7XHJcbiAgICBjb25zdCBuZ0R5bmFtaWMgPSBGaWVsZE1ldGFkYXRhVXRpbC5nZXROZ0R5bmFtaWMoY29uc3RydWN0b3IpO1xyXG5cclxuICAgIHRoaXMuaW5pdGlhbGl6ZU5vcm1hbEZpZWxkKG5nRmllbGRzKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZUxpc3QobmdMaXN0cyk7XHJcbiAgICB0aGlzLmluaXRpYWxpemVPYmplY3QobmdPYmplY3RzKTtcclxuICAgIHRoaXMuaW5pdGlhbGl6ZUR5bmFtaWMobmdEeW5hbWljKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7unBhdGhcclxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIOWxnuaAp+WQjeensFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjcmVhdGVQYXRoKHByb3BlcnR5TmFtZTogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgY29uc3QgcHJpbWFyeUZpZWxkTWV0YWRhdGEgPSB0aGlzLnByaW1hcnlQcm9wZXJ0eTtcclxuICAgIGlmIChwcmltYXJ5RmllbGRNZXRhZGF0YSkge1xyXG4gICAgICBjb25zdCBwcmltYXJ5RGF0YUZpZWxkID0gcHJpbWFyeUZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkO1xyXG4gICAgICByZXR1cm4gW3ByaW1hcnlEYXRhRmllbGQgKyAnOicgKyB0aGlzLnByaW1hcnlWYWx1ZSwgcHJvcGVydHlOYW1lXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBbJzonLCBwcm9wZXJ0eU5hbWVdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bGe5oCn5a2X5q615Yid5aeL5YyWXHJcbiAgICogQHBhcmFtIG5nRmllbGRzIOWxnuaAp+Wtl+auteWFg+aVsOaNrlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZU5vcm1hbEZpZWxkKG5nRmllbGRzOiB7IFtrZXk6IHN0cmluZ106IE5nRmllbGRQcm9wZXJ0eSB9KTogdm9pZCB7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkcykuZm9yRWFjaChwcm9wTmFtZSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nRmllbGQgPSBuZ0ZpZWxkc1twcm9wTmFtZV0gYXMgTmdGaWVsZFByb3BlcnR5O1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuXHJcbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wTmFtZV0pIHtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcE5hbWUsIHtcclxuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0UHJvcFZhbHVlKHByb3BOYW1lLCBuZ0ZpZWxkKTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKG5ld1Byb3BWYWx1ZSkge1xyXG4gICAgICAgICAgICAvLyDlgLznm7jlkIzml7bkuI3op6blj5Hlj5jmm7TjgIJcclxuICAgICAgICAgICAgY29uc3Qgb2xkUHJvcFZhbHVlID0gdGhpcy5nZXRQcm9wVmFsdWUocHJvcE5hbWUsIG5nRmllbGQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc1Byb3BWYWx1ZUNoYW5nZWQocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSwgb2xkUHJvcFZhbHVlKSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZXRQcm9wVmFsdWUocHJvcE5hbWUsIG5nRmllbGQsIG5ld1Byb3BWYWx1ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZVNldFZhbHVlID0gdGhpcy5wcmVwYXJlUHJvcFZhbHVlKHByb3BOYW1lLCBuZ0ZpZWxkLCBuZXdQcm9wVmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLmVtaXRWYWx1ZUNoYW5nZShwcm9wTmFtZSwgbmdGaWVsZCwgbmV3UHJvcFZhbHVlLCBvbGRQcm9wVmFsdWUsIGNoYW5nZVNldFZhbHVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJ3lp4vljJbliJfooajnsbvlnovnmoTlhYPmlbDmja5cclxuICAgKiBAcGFyYW0gbmdMaXN0TWV0YWRhdGEg5YiX6KGo57G75Z6L5YWD5pWw5o2uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplTGlzdChuZ0xpc3RNZXRhZGF0YTogeyBba2V5OiBzdHJpbmddOiBOZ0xpc3RQcm9wZXJ0eSB9KTogdm9pZCB7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0xpc3RNZXRhZGF0YSkuZm9yRWFjaChwcm9wZXJ0eU5hbWUgPT4ge1xyXG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gbmdMaXN0TWV0YWRhdGFbcHJvcGVydHlOYW1lXSBhcyBOZ0xpc3RQcm9wZXJ0eTtcclxuICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBmaWVsZE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wZXJ0eU5hbWU7XHJcbiAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZGF0YVtkYXRhRmllbGRdO1xyXG5cclxuICAgICAgY29uc3QgZW50aXR5TGlzdCA9IG5ldyBFbnRpdHlMaXN0PHR5cGVvZiBmaWVsZE1ldGFkYXRhLnR5cGU+KCk7XHJcbiAgICAgIGVudGl0eUxpc3RbUEFSRU5UX0NMQVNTXSA9IHRoaXM7XHJcbiAgICAgIGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdID0gcGF0aDtcclxuXHJcbiAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICBjb25zdCBlbnRpdGllcyA9IHZhbC5tYXAodiA9PiBFbnRpdHlGYWN0b3J5PHR5cGVvZiBmaWVsZE1ldGFkYXRhLnR5cGU+KGZpZWxkTWV0YWRhdGEudHlwZSwgdikpO1xyXG4gICAgICAgIGVudGl0eUxpc3QubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZW50aXR5TGlzdC5vbkxpc3RDaGFuZ2VkLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICBpZiAoZW50aXR5TGlzdFtQQVJFTlRfUEFUSF1bMF0gIT09IHZhbHVlLnBhdGhbMF0pIHtcclxuICAgICAgICAgICAgdmFsdWUucGF0aCA9IGVudGl0eUxpc3RbUEFSRU5UX1BBVEhdLmNvbmNhdCh2YWx1ZS5wYXRoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gZW50aXR5TGlzdDtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliJ3lp4vljJblrZDlr7nosaFcclxuICAgKiBAcGFyYW0gbmdPYmplY3RNZXRhZGF0YSDlrZDlr7nosaHlhYPmlbDmja5cclxuICAgKi9cclxuICBwcml2YXRlIGluaXRpYWxpemVPYmplY3QobmdPYmplY3RNZXRhZGF0YTogeyBba2V5OiBzdHJpbmddOiBOZ09iamVjdFByb3BlcnR5IH0pIHtcclxuICAgIE9iamVjdC5rZXlzKG5nT2JqZWN0TWV0YWRhdGEpLmZvckVhY2gocHJvcGVydHlOYW1lID0+IHtcclxuICAgICAgY29uc3QgZmllbGRNZXRhZGF0YSA9IG5nT2JqZWN0TWV0YWRhdGFbcHJvcGVydHlOYW1lXSBhcyBOZ09iamVjdFByb3BlcnR5O1xyXG4gICAgICBjb25zdCBwYXRoID0gdGhpcy5jcmVhdGVQYXRoKHByb3BlcnR5TmFtZSk7XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IGZpZWxkTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BlcnR5TmFtZTtcclxuXHJcbiAgICAgIC8vIHZhbOS4jeWtmOWcqOaXtu+8jOeUqOepuuWvueixoeS7o+abv1xyXG4gICAgICBjb25zdCB2YWwgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXSB8fCB7fTtcclxuXHJcbiAgICAgIGNvbnN0IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSA9ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlO1xyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGZpZWxkTWV0YWRhdGEudHlwZSkge1xyXG4gICAgICAgICAgaW5zdGFuY2UgPSB2YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaW5zdGFuY2UgPSBFbnRpdHlGYWN0b3J5KGZpZWxkTWV0YWRhdGEudHlwZSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfQ0xBU1NdID0gdGhpcztcclxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfUEFUSF0gPSBwYXRoO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoY2hhbmdlcyA9PiB7XHJcbiAgICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAodGhpc1tQQVJFTlRfUEFUSF0gfHwgW10pLmNvbmNhdChjaGFuZ2VzLnBhdGgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIOWmguaenOayoeacieWAvOeUqOS4gOS4quepuuWvueixoeS7o+abv1xyXG4gICAgICBsZXQgY2hpbGRFbnRpdHkgPSBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEodmFsKTtcclxuICAgICAgaWYgKGRlbGV0ZSB0aGlzW3Byb3BlcnR5TmFtZV0pIHtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgcHJvcGVydHlOYW1lLCB7XHJcbiAgICAgICAgICBnZXQ6ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGNoaWxkRW50aXR5O1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICAgICAgY29uc3QgbW9kaWZ5SW5mbyA9IHtcclxuICAgICAgICAgICAgICBwYXRoOiBjaGlsZEVudGl0eVtQQVJFTlRfUEFUSF0sXHJcbiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLmRhdGEsXHJcbiAgICAgICAgICAgICAgcHJlVmFsdWU6IHRoaXNbcHJvcGVydHlOYW1lXS5kYXRhLFxyXG4gICAgICAgICAgICAgIHR5cGU6IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2hpbGRFbnRpdHkgPSBjcmVhdGVFbnRpdHlGcm9tSnNvbkRhdGEodmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMobW9kaWZ5SW5mbyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplRHluYW1pYyhuZ0R5bmFtaWNNZXRhZGF0YTogeyBba2V5OiBzdHJpbmddOiBOZ0R5bmFtaWNQcm9wZXJ0eSB9KSB7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0R5bmFtaWNNZXRhZGF0YSkuZm9yRWFjaChwcm9wZXJ0eU5hbWUgPT4ge1xyXG4gICAgICBjb25zdCBmaWVsZE1ldGFkYXRhID0gbmdEeW5hbWljTWV0YWRhdGFbcHJvcGVydHlOYW1lXSBhcyBOZ0R5bmFtaWNQcm9wZXJ0eTtcclxuICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwcm9wZXJ0eU5hbWUpO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBmaWVsZE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wZXJ0eU5hbWU7XHJcblxyXG4gICAgICBjb25zdCBvcmlnaW5hbERhdGEgPSB0aGlzLmRhdGFbZGF0YUZpZWxkXSB8fCB7fTtcclxuXHJcbiAgICAgIGNvbnN0IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSA9ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlO1xyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIGZpZWxkTWV0YWRhdGEudHlwZSkge1xyXG4gICAgICAgICAgaW5zdGFuY2UgPSB2YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaW5zdGFuY2UgPSBFbnRpdHlGYWN0b3J5KGZpZWxkTWV0YWRhdGEudHlwZSwgdmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfQ0xBU1NdID0gdGhpcztcclxuICAgICAgICBpbnN0YW5jZVtQQVJFTlRfUEFUSF0gPSBwYXRoO1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5vblZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoY2hhbmdlcyA9PiB7XHJcbiAgICAgICAgICBpZiAoY2hhbmdlcykge1xyXG4gICAgICAgICAgICBjaGFuZ2VzLnBhdGggPSAodGhpc1tQQVJFTlRfUEFUSF0gfHwgW10pLmNvbmNhdChjaGFuZ2VzLnBhdGgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldENoYW5nZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGxldCBkeW5hbWljRW50aXR5ID0gY3JlYXRlRW50aXR5RnJvbUpzb25EYXRhKG9yaWdpbmFsRGF0YSk7XHJcbiAgICAgIGlmIChkZWxldGUgdGhpc1twcm9wZXJ0eU5hbWVdKSB7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5TmFtZSwge1xyXG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkeW5hbWljRW50aXR5O1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vZGlmeUluZm8gPSB7XHJcbiAgICAgICAgICAgICAgcGF0aDogZHluYW1pY0VudGl0eVtQQVJFTlRfUEFUSF0sXHJcbiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLmRhdGEsXHJcbiAgICAgICAgICAgICAgcHJlVmFsdWU6IHRoaXNbcHJvcGVydHlOYW1lXS5kYXRhLFxyXG4gICAgICAgICAgICAgIHR5cGU6IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZHluYW1pY0VudGl0eSA9IGNyZWF0ZUVudGl0eUZyb21Kc29uRGF0YSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hhbmdlcyhtb2RpZnlJbmZvKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24g5Yqg6L295a6e5L2T5pWw5o2u55u45YWzcHJpdmF0ZeOAgXByb2plY3RlZOaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDliqDovb3nroDljZXlrZfmrrXlgLxcclxuICAgKiBAdG9kbyDkuLTml7bnlKjkv67mlLnnmoTmlrnlvI/mqKHmi59cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgbG9hZEZpZWxkcyhkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IG5nRmllbGRzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdGaWVsZHModGhpcy5jb25zdHJ1Y3Rvcik7XHJcbiAgICBPYmplY3Qua2V5cyhuZ0ZpZWxkcykuZm9yRWFjaCgocHJvcE5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCBuZ0ZpZWxkID0gbmdGaWVsZHNbcHJvcE5hbWVdO1xyXG4gICAgICBjb25zdCBkYXRhRmllbGQgPSBuZ0ZpZWxkLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgICAgLy8gaWYgKG5nRmllbGQucHJpbWFyeSA9PT0gZmFsc2UpIHtcclxuICAgICAgLy8gICB0aGlzW3Byb3BOYW1lXSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgICAgLy8gfVxyXG4gICAgICBsZXQgcHJvcFZhbHVlID0gZGF0YVtkYXRhRmllbGRdO1xyXG4gICAgICBpZiAobmdGaWVsZC5lbmFibGVUaW1lWm9uZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHRpbWVab25lT2Zmc2V0ID0gVXNlclNldHRpbmdzU2VydmljZS5nZXRUaW1lWm9uZU9mZnNldCgpO1xyXG4gICAgICAgIGlmICh0aW1lWm9uZU9mZnNldCAhPT0gbnVsbCAmJiBwcm9wVmFsdWUpIHtcclxuICAgICAgICAgIHByb3BWYWx1ZSA9IFpvbmVkVGltZS56b25lZFRpbWVUb1NwZWNpYWxUaW1lWm9uZU9mZnNldFRpbWVTdHJpbmcocHJvcFZhbHVlLCB0aW1lWm9uZU9mZnNldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXNbcHJvcE5hbWVdID0gcHJvcFZhbHVlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliqDovb3lrZDliJfooajmlbDmja5cclxuICAgKiBAcGFyYW0gZGF0YSDmlbDmja5cclxuICAgKi9cclxuICBwcm90ZWN0ZWQgbG9hZExpc3RzKGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgbmdMaXN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nTGlzdCh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nTGlzdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdMaXN0ID0gbmdMaXN0c1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nTGlzdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcbiAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSBuZ0xpc3QudHlwZTtcclxuXHJcbiAgICAgIC8vIOWIm+W7uuWunuS9k1xyXG4gICAgICBjb25zdCBsaXN0RGF0YSA9IGRhdGFbZGF0YUZpZWxkXTtcclxuICAgICAgaWYgKGxpc3REYXRhKSB7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXMgPSBsaXN0RGF0YS5tYXAoKGVudGl0eURhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIEVudGl0eUZhY3Rvcnk8dHlwZW9mIGVudGl0eVR5cGU+KGVudGl0eVR5cGUsIGVudGl0eURhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXNbcHJvcE5hbWVdLmxvYWRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpc1twcm9wTmFtZV0ubG9hZEVudGl0aWVzKFtdKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGxvYWRPYmplY3RzKGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgbmdPYmplY3RzID0gRmllbGRNZXRhZGF0YVV0aWwuZ2V0TmdPYmplY3RzKHRoaXMuY29uc3RydWN0b3IpO1xyXG4gICAgT2JqZWN0LmtleXMobmdPYmplY3RzKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5nT2JqZWN0ID0gbmdPYmplY3RzW3Byb3BOYW1lXTtcclxuICAgICAgY29uc3QgZGF0YUZpZWxkID0gbmdPYmplY3QuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgICBjb25zdCBvYmplY3REYXRhID0gZGF0YVtkYXRhRmllbGRdO1xyXG4gICAgICBjb25zdCBlbnRpdHkgPSB0aGlzW3Byb3BOYW1lXSBhcyBFbnRpdHk7XHJcbiAgICAgIGlmICghZW50aXR5IHx8ICFvYmplY3REYXRhKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGVudGl0eS5sb2FkKG9iamVjdERhdGEpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgbG9hZER5bmFtaWNPYmplY3RzKGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgbmdEeW5hbWljT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nRHluYW1pYyh0aGlzLmNvbnN0cnVjdG9yKTtcclxuICAgIE9iamVjdC5rZXlzKG5nRHluYW1pY09iamVjdHMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgbmdEeW5hbWljT2JqZWN0ID0gbmdEeW5hbWljT2JqZWN0c1twcm9wTmFtZV07XHJcbiAgICAgIGNvbnN0IGRhdGFGaWVsZCA9IG5nRHluYW1pY09iamVjdC5kYXRhRmllbGQgfHwgcHJvcE5hbWU7XHJcblxyXG4gICAgICBjb25zdCBkeW5hbWljRGF0YSA9IGRhdGFbZGF0YUZpZWxkXSB8fCB7fTtcclxuICAgICAgY29uc3QgZHluYW1pY0VudGl0eSA9IHRoaXNbcHJvcE5hbWVdIGFzIER5bmFtaWM7XHJcbiAgICAgIGlmICghZHluYW1pY0VudGl0eSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBkeW5hbWljRW50aXR5LmxvYWREeW5hbWljRGF0YShkeW5hbWljRGF0YSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiDnp4HmnInlt6Xlhbfmlrnms5VcclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOWPkemAgeWAvOWPmOabtFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZW1pdFZhbHVlQ2hhbmdlKHByb3BOYW1lOiBzdHJpbmcsIHByb3BNZXRhZGF0YTogTmdGaWVsZFByb3BlcnR5LCBuZXdQcm9wVmFsdWU6IGFueSwgb2xkUHJvcFZhbHVlOiBhbnksIGNoYW5nZVNldFZhbHVlOiBhbnkgPSB1bmRlZmluZWQpOiB2b2lkIHtcclxuICAgIGNvbnN0IGNoYW5nZSA9IHtcclxuICAgICAgcGF0aDogdGhpcy5jcmVhdGVQYXRoKHByb3BOYW1lKSxcclxuICAgICAgdmFsdWU6IG5ld1Byb3BWYWx1ZSxcclxuICAgICAgY2hhbmdlU2V0VmFsdWUsXHJcbiAgICAgIHByZVZhbHVlOiBvbGRQcm9wVmFsdWUsXHJcbiAgICAgIHR5cGU6IE1vZGlmeVR5cGUuVmFsdWVDaGFuZ2VcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHRoaXNbUEFSRU5UX1BBVEhdKSB7XHJcbiAgICAgIGNoYW5nZS5wYXRoID0gdGhpc1tQQVJFTlRfUEFUSF0uY29uY2F0KGNoYW5nZS5wYXRoKTtcclxuICAgIH1cclxuICAgIHRoaXMuc2V0Q2hhbmdlcyhjaGFuZ2UpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlh4blpIfmj5DkuqTnu5nlkI7nq6/nmoTlsZ7mgKflgLxcclxuICAgKiBAcGFyYW0gcHJvcE5hbWUg5bGe5oCnXHJcbiAgICogQHBhcmFtIHByb3BNZXRhZGF0YSDlsZ7mgKfmj4/ov7BcclxuICAgKiBAcGFyYW0gcHJvcFZhbHVlIOWxnuaAp+WAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcHJlcGFyZVByb3BWYWx1ZShwcm9wTmFtZTogc3RyaW5nLCBwcm9wTWV0YWRhdGE6IE5nRmllbGRQcm9wZXJ0eSwgcHJvcFZhbHVlOiBhbnkpIHtcclxuICAgIGxldCB2YWx1ZSA9IHVuZGVmaW5lZDtcclxuICAgIC8vIOWPquimgeWQr+eUqOaXtuWMuu+8jOS8oOe7meWQjuerr+eahOaXtumXtOWwseW/hemhu+W4puaXtuWMuu+8jOWboOatpOW9k+iOt+WPlueUqOaIt+aXtuWMuuWksei0peeahOaXtuWAme+8jOiOt+WPlua1j+iniOWZqOW9k+WJjeaXtuWMulxyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVUaW1lWm9uZSA9PT0gdHJ1ZSkge1xyXG4gICAgICBjb25zdCB0aW1lWm9uZU9mZnNldCA9IFVzZXJTZXR0aW5nc1NlcnZpY2UuZ2V0VGltZVpvbmVPZmZzZXQoKTtcclxuICAgICAgaWYgKHRpbWVab25lT2Zmc2V0ICE9PSBudWxsICYmIHByb3BWYWx1ZSkge1xyXG4gICAgICAgIHZhbHVlID0gWm9uZWRUaW1lLnRpbWVab25lT2Zmc2V0VGltZVRvVXRjVGltZVN0cmluZyhwcm9wVmFsdWUsIHRpbWVab25lT2Zmc2V0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5blsZ7mgKflgLxcclxuICAgKi9cclxuICBwcml2YXRlIGdldFByb3BWYWx1ZShwcm9wTmFtZTogc3RyaW5nLCBwcm9wTWV0YWRhdGE6IE5nRmllbGRQcm9wZXJ0eSkge1xyXG4gICAgY29uc3QgZGF0YUZpZWxkID0gcHJvcE1ldGFkYXRhLmRhdGFGaWVsZCB8fCBwcm9wTmFtZTtcclxuICAgIGxldCB2YWx1ZSA9IHRoaXMuZGF0YVtkYXRhRmllbGRdO1xyXG5cclxuICAgIC8vIOWvueWkmuivreW9leWFpeWtl+aute+8jHF1ZXJ55LiN6L+U5Zue6Zeu6aKY6L+b6KGM5YW85a65XHJcbiAgICBpZiAocHJvcE1ldGFkYXRhLmVuYWJsZU11bHRpTGFuZ0lucHV0ID09PSB0cnVlICYmICF2YWx1ZSkge1xyXG4gICAgICBjb25zdCBsYW5nQ29kZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJykgfHwgJ3poLUNIUyc7XHJcbiAgICAgIGNvbnN0IG9yaWdpbkRhdGFGaWVsZCA9IGRhdGFGaWVsZC5yZXBsYWNlKCdfTVVMVElMQU5HVUFHRScsICcnKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBbbGFuZ0NvZGVdOiB0aGlzLmRhdGFbb3JpZ2luRGF0YUZpZWxkXVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgLy8g5ZCv55So5pe25Yy6XHJcbiAgICBpZiAocHJvcE1ldGFkYXRhLmVuYWJsZVRpbWVab25lID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IHRpbWVab25lT2Zmc2V0ID0gVXNlclNldHRpbmdzU2VydmljZS5nZXRUaW1lWm9uZU9mZnNldCgpO1xyXG4gICAgICBpZiAodGltZVpvbmVPZmZzZXQgIT09IG51bGwgJiYgdmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gWm9uZWRUaW1lLnpvbmVkVGltZVRvU3BlY2lhbFRpbWVab25lT2Zmc2V0VGltZVN0cmluZyh2YWx1ZSwgdGltZVpvbmVPZmZzZXQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAocHJvcE1ldGFkYXRhLm9yaWdpbmFsRGF0YUZpZWxkVHlwZSA9PT0gQmlnTnVtYmVyVHlwZSkge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUudG9TdHJpbmcoKSB8fCBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6+572u5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRQcm9wVmFsdWUocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHksIHByb3BWYWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCBkYXRhRmllbGQgPSBwcm9wTWV0YWRhdGEuZGF0YUZpZWxkIHx8IHByb3BOYW1lO1xyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5vcmlnaW5hbERhdGFGaWVsZFR5cGUgPT09IEJpZ051bWJlclR5cGUpIHtcclxuICAgICAgdGhpcy5kYXRhW2RhdGFGaWVsZF0gPSBwcm9wVmFsdWUgPT09IG51bGwgPyBudWxsIDogcHJvcFZhbHVlICYmIHByb3BWYWx1ZS50b1N0cmluZygpIHx8ICcnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVUaW1lWm9uZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IHRpbWVab25lT2Zmc2V0ID0gVXNlclNldHRpbmdzU2VydmljZS5nZXRUaW1lWm9uZU9mZnNldCgpO1xyXG4gICAgICAgIGlmICh0aW1lWm9uZU9mZnNldCAhPT0gbnVsbCAmJiBwcm9wVmFsdWUpIHtcclxuICAgICAgICAgIHByb3BWYWx1ZSA9IFpvbmVkVGltZS50aW1lWm9uZU9mZnNldFRpbWVUb1V0Y1RpbWVTdHJpbmcocHJvcFZhbHVlLCB0aW1lWm9uZU9mZnNldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZGF0YVtkYXRhRmllbGRdID0gcHJvcFZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qOA5p+l5bGe5oCn5YC85piv5ZCm5Y+R55Sf5Y+Y5YyWXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1Byb3BWYWx1ZUNoYW5nZWQocHJvcE5hbWU6IHN0cmluZywgcHJvcE1ldGFkYXRhOiBOZ0ZpZWxkUHJvcGVydHksIG5ld1Byb3BWYWx1ZTogYW55LCBvbGRQcm9wVmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHByb3BNZXRhZGF0YS5lbmFibGVNdWx0aUxhbmdJbnB1dCA9PT0gdHJ1ZSkge1xyXG4gICAgICBpZiAodGhpcy5pc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKG5ld1Byb3BWYWx1ZSkgPT09IHRydWUgJiYgdGhpcy5pc0VtcHR5TXVsdGlMYW5nUHJvcFZhbHVlKG9sZFByb3BWYWx1ZSkgPT09IHRydWUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5ld1Byb3BWYWx1ZSkgIT09IEpTT04uc3RyaW5naWZ5KG9sZFByb3BWYWx1ZSk7XHJcbiAgICB9IGVsc2UgaWYgKHByb3BNZXRhZGF0YS5vcmlnaW5hbERhdGFGaWVsZFR5cGUgPT09IEJpZ051bWJlclR5cGUpIHtcclxuICAgICAgaWYgKHR5cGVvZiBuZXdQcm9wVmFsdWUgIT09ICdzdHJpbmcnICYmIG5ld1Byb3BWYWx1ZSAhPT0gbnVsbCAmJiBuZXdQcm9wVmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIG5ld1Byb3BWYWx1ZSA9IG5ld1Byb3BWYWx1ZS50b1N0cmluZygpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBuZXdQcm9wVmFsdWUgIT09IG9sZFByb3BWYWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBuZXdQcm9wVmFsdWUgIT09IG9sZFByb3BWYWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkmuivreW9leWFpeWtl+auteeahOWAvOaYr+WQpuS4uuepulxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNFbXB0eU11bHRpTGFuZ1Byb3BWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7XHJcbiAgICBpZiAoa2V5cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5YC85YWo6YOo5Li656m677yM6KeG5Li656m6XHJcbiAgICBjb25zdCB2YWxzID0gT2JqZWN0LnZhbHVlcyh2YWx1ZSk7XHJcbiAgICBjb25zdCBhbGxFbXB0eVZhbCA9IHZhbHMuZXZlcnkoKHZhbCkgPT4ge1xyXG4gICAgICByZXR1cm4gIXZhbDtcclxuICAgIH0pO1xyXG4gICAgaWYgKGFsbEVtcHR5VmFsID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG59XHJcbiJdfQ==
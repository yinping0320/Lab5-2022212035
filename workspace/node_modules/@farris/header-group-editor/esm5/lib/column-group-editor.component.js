/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { BsModalService } from '@farris/ui-modal';
import { HeaderGroupEditorComponent } from './header-group-editor.component';
import { Component, Input, ViewChild, EventEmitter, Output, TemplateRef, ElementRef, Renderer2, Injector, HostBinding } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { flatten } from 'lodash-es';
var ColumnGroupEditorComponent = /** @class */ (function () {
    function ColumnGroupEditorComponent(render, messagerSer, injector, modalSer) {
        this.render = render;
        this.messagerSer = messagerSer;
        this.injector = injector;
        this.modalSer = modalSer;
        this.editorParams = {};
        this.cls = 'f-utils-absolute-all';
        this.closeModal = new EventEmitter();
        // 模态框确定后关闭，并传递参数
        this.submitModal = new EventEmitter();
        this.previewGroupColumns = [];
        this.columnsCode = [];
        this.btnTopActive = true;
        this.btnBottomActive = true;
        this.isOpen = false;
        this.fieldInfo = {};
        this.modalConfig = {
            title: '多表头编辑器',
            width: 700,
            height: 500,
            showButtons: true
        };
    }
    /**
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (!this.fields || !this.fields.length) {
            if (this.editorParams && this.editorParams.fields && this.editorParams.fields.length) {
                this.fields = this.editorParams.fields;
            }
            else {
                console.warn('Pleasy Set Datagrid\'s fields Give it 2 me.');
            }
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.onTreenodeSelect = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.fieldInfo = $event.data;
    };
    /**
     * @private
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.setPreviewColumns = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var treeNodes = this.hge.getAllNodes();
        this.previewGroupColumns = this.hge.convert2Array(treeNodes);
    };
    /**
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.showPreview = /**
     * @return {?}
     */
    function () {
        this.setPreviewColumns();
        if (!this.isOpen) {
            this.isOpen = true;
        }
    };
    /**
     * @param {?=} event
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.closePreview = /**
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        this.isOpen = false;
        if (event) {
            event.stopPropagation();
        }
    };
    /**
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.resetGroupColumns = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.messagerSer.question('表头分组重置后需要重新设置。确定要重置为初始状态吗？', (/**
         * @return {?}
         */
        function () {
            _this.hge.initTreeData();
        }));
    };
    /**
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.cancle = /**
     * @return {?}
     */
    function () {
        this.closeModal.emit();
    };
    /**
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.ok = /**
     * @return {?}
     */
    function () {
        this.setPreviewColumns();
        /** @type {?} */
        var flatgroupcols = flatten(this.previewGroupColumns);
        /** @type {?} */
        var value = this.hge.tt.serializedValue.map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            /** @type {?} */
            var parent = n.parent ? n.parent.data.id : null;
            if (n.node.data.groupHeader || n.node.data.houxunquNode) {
                /** @type {?} */
                var _col = flatgroupcols.find((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.id === n.id; }));
                /** @type {?} */
                var item = tslib_1.__assign({}, n.node.data, { parent: parent, level: n.level });
                if (_col) {
                    return Object.assign(item, { rowspan: _col ? _col.rowspan : 1,
                        colspan: _col ? _col.colspan : 1 });
                }
                return item;
            }
            else {
                return {
                    fieldRef: n.node.data.id,
                    parent: parent,
                    level: n.level
                };
            }
        }));
        this.submitModal.emit({ value: value });
    };
    /**
     * @return {?}
     */
    ColumnGroupEditorComponent.prototype.showCode = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var treeNodes = this.hge.getAllNodes();
        this.columnsCode = this.hge.convert2Array(treeNodes);
        this.modalSer.show(this.codeTemplate, {
            title: '表头分组代码',
            width: 500, height: 400,
            resizable: false,
            showMaxButton: false,
            showButtons: false
        });
    };
    ColumnGroupEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'column-group-editor',
                    template: "\r\n<div class=\"d-flex flex-column\" style=\"height: 100%\">\r\n        <div region=\"north\" class=\"north\" style=\"height: 40px;min-height: 40px;border-bottom: 1px solid #c8c8c8; line-height: 36px;\">\r\n            <button class=\"btn btn-primary mr-1 ml-2\" (click)=\"resetGroupColumns()\">\r\n                <span class=\"f-icon f-icon-reset-sm mr-1\"></span>\u91CD\u7F6E\r\n            </button>\r\n            <button class=\"btn btn-primary mr-1\" (click)=\"showPreview()\">\r\n                <span class=\"f-icon f-icon-preview  mr-1\"></span>\u6548\u679C\u9884\u89C8\r\n            </button>\r\n            <button class=\"btn btn-primary\" (click)=\"showCode()\">\r\n                <span class=\"f-icon f-icon-source-code mr-1\"></span>\u83B7\u53D6\u4EE3\u7801\r\n            </button>\r\n        </div>\r\n        <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;height: 100%;\">\r\n            <div class=\"d-flex flex-row flex-fill\" style=\"height: 100%\" >\r\n                <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;\">\r\n                    <header-group-editor #hge [fields]=\"fields\" [treeData]=\"value\" (selectedNode)=\"onTreenodeSelect($event)\"></header-group-editor>\r\n                </div>\r\n                <div region=\"east\" class=\"east property-column\">\r\n\r\n                    <div style=\"padding: 10px\">\r\n                            <div class=\"farris-group-wrap\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u8868\u5934\u540D\u79F0</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <input type=\"input\" [disabled]=\"!fieldInfo.groupHeader\" class=\"form-control\" [(ngModel)]=\"fieldInfo.caption\">\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"farris-group-wrap\" *ngIf=\"fieldInfo.groupHeader\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u8868\u5934\u5BF9\u9F50\u65B9\u5F0F</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <select class=\"form-control\" [(ngModel)]=\"fieldInfo.halign\">\r\n                                            <option value=\"left\">\u5DE6\u5BF9\u9F50</option>\r\n                                            <option value=\"center\">\u5C45\u4E2D\u5BF9\u9F50</option>\r\n                                            <option value=\"right\">\u53F3\u5BF9\u9F50</option>\r\n                                        </select>\r\n                                        <!-- <select class=\"form-control\" *ngIf=\"!fieldInfo.groupHeader\" [(ngModel)]=\"fieldInfo.hAlign\">\r\n                                            <option value=\"left\">\u5DE6\u5BF9\u9F50</option>\r\n                                            <option value=\"center\">\u5C45\u4E2D\u5BF9\u9F50</option>\r\n                                            <option value=\"right\">\u53F3\u5BF9\u9F50</option>\r\n                                        </select> -->\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                     \r\n                             <!-- <div class=\"farris-group-wrap\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u6570\u636E\u5BF9\u9F50\u65B9\u5F0F</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <select class=\"form-control\" [(ngModel)]=\"fieldInfo.align\">\r\n                                            <option value=\"left\">\u5DE6\u5BF9\u9F50</option>\r\n                                            <option value=\"center\">\u5C45\u4E2D\u5BF9\u9F50</option>\r\n                                            <option value=\"right\">\u53F3\u5BF9\u9F50</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"farris-group-wrap\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u5BBD\u5EA6</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <input type=\"input\" class=\"form-control\" [(ngModel)]=\"fieldInfo.size\">\r\n                                    </div>\r\n                                </div>\r\n                            </div> -->\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n       \r\n        <div region=\"south\" class=\"south\" [class.preview-open]=\"isOpen\" #preview>\r\n\r\n            <div class=\"d-flex flex-column flex-fill\" style=\"height: 100%;\">\r\n                <div region=\"north\" class=\"north preview-title\" (click)=\"isOpen = !isOpen\">\r\n                   <span class=\"text\" >\u6548\u679C\u9884\u89C8</span> \r\n                   <div class=\"close-btn\" (click)=\"closePreview($event)\">\r\n                        <span class=\"f-icon f-icon-close\"></span>\r\n                   </div>\r\n                </div>\r\n                <div region=\"center\" class=\"center flex-fill preview-container\">\r\n                    <table>\r\n\r\n                        <tr  *ngFor=\"let cls of previewGroupColumns\" style=\"height: 36px\">\r\n                            <ng-container *ngFor=\"let c of cls\">\r\n                                <ng-container *ngIf=\"c.colspan > 1\">\r\n                                    <td [attr.colspan]=\"c.colspan\" [attr.align]=\"c.halign || 'left'\">{{ c.title }}</td>\r\n                                </ng-container>\r\n\r\n                                <ng-container *ngIf=\"c.colspan == 1\">\r\n                                    <td [style.width.px]=\"c.width\"  [attr.align]=\"c.halign || 'left'\" [attr.rowspan]=\"c.rowspan || 1\">{{ c.title }}</td>\r\n                                </ng-container>\r\n                            </ng-container>\r\n                        </tr>\r\n                        \r\n\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n       \r\n</div>\r\n\r\n<ng-template #dlgFooter>\r\n    <div class=\"btns\">\r\n        <button  type=\"button\"  class=\"btn btn-primary btn-lg px-3\" (click)=\"ok()\" > \u786E\u5B9A </button>\r\n        &nbsp;&nbsp;\r\n        <button type=\"button\" class=\"btn btn-secondary btn-lg px-3\" (click)=\"cancle()\" > \u53D6\u6D88 </button> \r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template #code>\r\n<textarea name=\"group-columns-code\" class=\"form-control\" rows=17>\r\n{{ columnsCode | json }}\r\n</textarea>\r\n</ng-template>\r\n\r\n\r\n",
                    styles: ["\n        .center::-webkit-scrollbar { width: 5px; height: 5px}\n        .south::-webkit-scrollbar { width: 5px; height: 5px }\n        .south {\n            height: 40px;\n            min-height: 40px;\n            overflow: hidden;\n            border-top: 1px solid #c8c8c8;\n            background: #F3F8FF;\n            transition: height 0.5s;\n            flex-shrink: 0!important;;\n        }\n        .preview-open {\n            height: 300px;\n        }\n        .preview-container {\n            flex-shrink: 0!important;overflow:auto\n        }\n        .preview-title {\n            height:36px;min-height: 36px; background: #F3F8FF; cursor:pointer;\n        }\n        .preview-title .text {\n            line-height: 36px;font-size: 16px;padding-left: 10px;\n        }\n        .preview-title button {\n            float: right;\n            line-height: 40px;\n            margin-right: 10px;\n        }\n        .preview-container table{\n            width: max-content; margin: 5px; background-color: #efefef; border-color: #adadad;\n        }\n        .preview-container table td{border: 1px solid #c2c2c2;}\n\n        .east.property-column {\n            width: 300px; min-width:260px;border-left: 1px solid #c8c8c8;overflow: auto;background:#F3F8FF\n        }\n        .close-btn {\n            display: inline-block;\n            float: right;\n            line-height: 36px;\n            margin-right: 10px;\n            width: 36px;\n            color: #ccc;\n            text-align: center;\n        }\n        .close-btn:hover {\n            color: red;\n        }\n        "]
                }] }
    ];
    /** @nocollapse */
    ColumnGroupEditorComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: MessagerService },
        { type: Injector },
        { type: BsModalService }
    ]; };
    ColumnGroupEditorComponent.propDecorators = {
        editorParams: [{ type: Input }],
        fields: [{ type: Input }],
        value: [{ type: Input }],
        cls: [{ type: HostBinding, args: ['class',] }],
        closeModal: [{ type: Output }],
        submitModal: [{ type: Output }],
        hge: [{ type: ViewChild, args: ['hge',] }],
        modalFooter: [{ type: ViewChild, args: ['dlgFooter',] }],
        previewEl: [{ type: ViewChild, args: ['preview',] }],
        codeTemplate: [{ type: ViewChild, args: ['code',] }]
    };
    return ColumnGroupEditorComponent;
}());
export { ColumnGroupEditorComponent };
if (false) {
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.editorParams;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.fields;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.value;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.cls;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.closeModal;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.submitModal;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.hge;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.modalFooter;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.previewEl;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.codeTemplate;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.previewGroupColumns;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.columnsCode;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.btnTopActive;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.btnBottomActive;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.isOpen;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.fieldInfo;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.modalConfig;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupEditorComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupEditorComponent.prototype.messagerSer;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupEditorComponent.prototype.modalSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLWdyb3VwLWVkaXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2hlYWRlci1ncm91cC1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvY29sdW1uLWdyb3VwLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDN0UsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUMvRCxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFcEM7SUEyRkksb0NBQ1ksTUFBaUIsRUFBVSxXQUE0QixFQUFTLFFBQWtCLEVBQ2xGLFFBQXdCO1FBRHhCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBaUI7UUFBUyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xGLGFBQVEsR0FBUixRQUFRLENBQWdCO1FBbkMzQixpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQUtWLFFBQUcsR0FBRyxzQkFBc0IsQ0FBQztRQUV6QyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQzs7UUFFckMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBT2hELHdCQUFtQixHQUFHLEVBQUUsQ0FBQztRQUN6QixnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUVqQixpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixvQkFBZSxHQUFHLElBQUksQ0FBQztRQUV2QixXQUFNLEdB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LG1rREFpREM7aUJBRVI7Ozs7Z0JBM0QyQixTQUFTO2dCQUM1QixlQUFlO2dCQURlLFFBQVE7Z0JBSHRDLGNBQWM7OzsrQkFpRWxCLEtBQUs7eUJBQ0wsS0FBSzt3QkFDTCxLQUFLO3NCQUdMLFdBQVcsU0FBQyxPQUFPOzZCQUVuQixNQUFNOzhCQUVOLE1BQU07c0JBRU4sU0FBUyxTQUFDLEtBQUs7OEJBQ2YsU0FBUyxTQUFDLFdBQVc7NEJBQ3JCLFNBQVMsU0FBQyxTQUFTOytCQUNuQixTQUFTLFNBQUMsTUFBTTs7SUErR3JCLGlDQUFDO0NBQUEsQUF2TEQsSUF1TEM7U0E5SFksMEJBQTBCOzs7SUFDbkMsa0RBQWdDOztJQUNoQyw0Q0FBdUI7O0lBQ3ZCLDJDQUFzQjs7SUFHdEIseUNBQW1EOztJQUVuRCxnREFBK0M7O0lBRS9DLGlEQUFnRDs7SUFFaEQseUNBQWtEOztJQUNsRCxpREFBc0Q7O0lBQ3RELCtDQUE0Qzs7SUFDNUMsa0RBQWtEOztJQUVsRCx5REFBeUI7O0lBQ3pCLGlEQUFpQjs7SUFFakIsa0RBQW9COztJQUNwQixxREFBdUI7O0lBRXZCLDRDQUFlOztJQUNmLCtDQUFvQjs7SUFHcEIsaURBS0U7Ozs7O0lBR0UsNENBQXlCOzs7OztJQUFFLGlEQUFvQzs7SUFBRSw4Q0FBeUI7Ozs7O0lBQzFGLDhDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IEhlYWRlckdyb3VwRWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi9oZWFkZXItZ3JvdXAtZWRpdG9yLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgVmlld0NoaWxkLCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgVGVtcGxhdGVSZWYsXHJcbiAgICAgICAgICAgICAgICBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIEluamVjdG9yLCBIb3N0QmluZGluZyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgZmxhdHRlbiB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnY29sdW1uLWdyb3VwLWVkaXRvcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ2NvbHVtbi1ncm91cC1lZGl0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYFxyXG4gICAgICAgIC5jZW50ZXI6Oi13ZWJraXQtc2Nyb2xsYmFyIHsgd2lkdGg6IDVweDsgaGVpZ2h0OiA1cHh9XHJcbiAgICAgICAgLnNvdXRoOjotd2Via2l0LXNjcm9sbGJhciB7IHdpZHRoOiA1cHg7IGhlaWdodDogNXB4IH1cclxuICAgICAgICAuc291dGgge1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDQwcHg7XHJcbiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDQwcHg7XHJcbiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XHJcbiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjYzhjOGM4O1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAjRjNGOEZGO1xyXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBoZWlnaHQgMC41cztcclxuICAgICAgICAgICAgZmxleC1zaHJpbms6IDAhaW1wb3J0YW50OztcclxuICAgICAgICB9XHJcbiAgICAgICAgLnByZXZpZXctb3BlbiB7XHJcbiAgICAgICAgICAgIGhlaWdodDogMzAwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5wcmV2aWV3LWNvbnRhaW5lciB7XHJcbiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwIWltcG9ydGFudDtvdmVyZmxvdzphdXRvXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5wcmV2aWV3LXRpdGxlIHtcclxuICAgICAgICAgICAgaGVpZ2h0OjM2cHg7bWluLWhlaWdodDogMzZweDsgYmFja2dyb3VuZDogI0YzRjhGRjsgY3Vyc29yOnBvaW50ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5wcmV2aWV3LXRpdGxlIC50ZXh0IHtcclxuICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDM2cHg7Zm9udC1zaXplOiAxNnB4O3BhZGRpbmctbGVmdDogMTBweDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnByZXZpZXctdGl0bGUgYnV0dG9uIHtcclxuICAgICAgICAgICAgZmxvYXQ6IHJpZ2h0O1xyXG4gICAgICAgICAgICBsaW5lLWhlaWdodDogNDBweDtcclxuICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAxMHB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAucHJldmlldy1jb250YWluZXIgdGFibGV7XHJcbiAgICAgICAgICAgIHdpZHRoOiBtYXgtY29udGVudDsgbWFyZ2luOiA1cHg7IGJhY2tncm91bmQtY29sb3I6ICNlZmVmZWY7IGJvcmRlci1jb2xvcjogI2FkYWRhZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnByZXZpZXctY29udGFpbmVyIHRhYmxlIHRke2JvcmRlcjogMXB4IHNvbGlkICNjMmMyYzI7fVxyXG5cclxuICAgICAgICAuZWFzdC5wcm9wZXJ0eS1jb2x1bW4ge1xyXG4gICAgICAgICAgICB3aWR0aDogMzAwcHg7IG1pbi13aWR0aDoyNjBweDtib3JkZXItbGVmdDogMXB4IHNvbGlkICNjOGM4Yzg7b3ZlcmZsb3c6IGF1dG87YmFja2dyb3VuZDojRjNGOEZGXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5jbG9zZS1idG4ge1xyXG4gICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XHJcbiAgICAgICAgICAgIGZsb2F0OiByaWdodDtcclxuICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDM2cHg7XHJcbiAgICAgICAgICAgIG1hcmdpbi1yaWdodDogMTBweDtcclxuICAgICAgICAgICAgd2lkdGg6IDM2cHg7XHJcbiAgICAgICAgICAgIGNvbG9yOiAjY2NjO1xyXG4gICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5jbG9zZS1idG46aG92ZXIge1xyXG4gICAgICAgICAgICBjb2xvcjogcmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBgXHJcbiAgICBdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgQ29sdW1uR3JvdXBFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgQElucHV0KCkgZWRpdG9yUGFyYW1zOiBhbnkgPSB7fTtcclxuICAgIEBJbnB1dCgpIGZpZWxkczogYW55W107XHJcbiAgICBASW5wdXQoKSB2YWx1ZTogYW55W107XHJcblxyXG5cclxuICAgIEBIb3N0QmluZGluZygnY2xhc3MnKSBjbHMgPSAnZi11dGlscy1hYnNvbHV0ZS1hbGwnO1xyXG5cclxuICAgIEBPdXRwdXQoKSBjbG9zZU1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvLyDmqKHmgIHmoYbnoa7lrprlkI7lhbPpl63vvIzlubbkvKDpgJLlj4LmlbBcclxuICAgIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2hnZScpIGhnZTogSGVhZGVyR3JvdXBFZGl0b3JDb21wb25lbnQ7XHJcbiAgICBAVmlld0NoaWxkKCdkbGdGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ3ByZXZpZXcnKSBwcmV2aWV3RWw6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdjb2RlJykgY29kZVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAgIHByZXZpZXdHcm91cENvbHVtbnMgPSBbXTtcclxuICAgIGNvbHVtbnNDb2RlID0gW107XHJcblxyXG4gICAgYnRuVG9wQWN0aXZlID0gdHJ1ZTtcclxuICAgIGJ0bkJvdHRvbUFjdGl2ZSA9IHRydWU7XHJcblxyXG4gICAgaXNPcGVuID0gZmFsc2U7XHJcbiAgICBmaWVsZEluZm86IGFueSA9IHt9O1xyXG5cclxuXHJcbiAgICBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgICB0aXRsZTogJ+WkmuihqOWktOe8lui+keWZqCcsXHJcbiAgICAgICAgd2lkdGg6IDcwMCxcclxuICAgICAgICBoZWlnaHQ6IDUwMCxcclxuICAgICAgICBzaG93QnV0dG9uczogdHJ1ZVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIG1lc3NhZ2VyU2VyOiBNZXNzYWdlclNlcnZpY2UsIHB1YmxpYyBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBtb2RhbFNlcjogQnNNb2RhbFNlcnZpY2UpIHsgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5maWVsZHMgfHwgIXRoaXMuZmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lZGl0b3JQYXJhbXMgJiYgdGhpcy5lZGl0b3JQYXJhbXMuZmllbGRzICAmJiB0aGlzLmVkaXRvclBhcmFtcy5maWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpZWxkcyA9IHRoaXMuZWRpdG9yUGFyYW1zLmZpZWxkcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignUGxlYXN5IFNldCBEYXRhZ3JpZFxcJ3MgZmllbGRzIEdpdmUgaXQgMiBtZS4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblRyZWVub2RlU2VsZWN0KCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuZmllbGRJbmZvID0gJGV2ZW50LmRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQcmV2aWV3Q29sdW1ucygpIHtcclxuICAgICAgICBjb25zdCB0cmVlTm9kZXMgPSB0aGlzLmhnZS5nZXRBbGxOb2RlcygpO1xyXG4gICAgICAgIHRoaXMucHJldmlld0dyb3VwQ29sdW1ucyA9IHRoaXMuaGdlLmNvbnZlcnQyQXJyYXkodHJlZU5vZGVzKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93UHJldmlldygpIHtcclxuICAgICAgICB0aGlzLnNldFByZXZpZXdDb2x1bW5zKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzT3Blbikge1xyXG4gICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlUHJldmlldyhldmVudD86IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChldmVudCkge1xyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRHcm91cENvbHVtbnMoKSB7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlclNlci5xdWVzdGlvbign6KGo5aS05YiG57uE6YeN572u5ZCO6ZyA6KaB6YeN5paw6K6+572u44CC56Gu5a6a6KaB6YeN572u5Li65Yid5aeL54q25oCB5ZCX77yfJywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhnZS5pbml0VHJlZURhdGEoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjYW5jbGUoKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBvaygpIHtcclxuICAgICAgICB0aGlzLnNldFByZXZpZXdDb2x1bW5zKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZsYXRncm91cGNvbHMgPSBmbGF0dGVuPGFueT4odGhpcy5wcmV2aWV3R3JvdXBDb2x1bW5zKTtcclxuXHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmhnZS50dC5zZXJpYWxpemVkVmFsdWUubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBuLnBhcmVudCA/IG4ucGFyZW50LmRhdGEuaWQgOiBudWxsO1xyXG4gICAgICAgICAgICBpZiAobi5ub2RlLmRhdGEuZ3JvdXBIZWFkZXIgfHwgbi5ub2RlLmRhdGEuaG91eHVucXVOb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfY29sID0gZmxhdGdyb3VwY29scy5maW5kKGMgPT4gYy5pZCA9PT0gbi5pZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLm4ubm9kZS5kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudCxcclxuICAgICAgICAgICAgICAgICAgICBsZXZlbDogbi5sZXZlbFxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoX2NvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGl0ZW0sIHsgcm93c3BhbjogX2NvbCA/IF9jb2wucm93c3BhbiA6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHNwYW46IF9jb2wgPyBfY29sLmNvbHNwYW4gOiAxfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZFJlZjogbi5ub2RlLmRhdGEuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LFxyXG4gICAgICAgICAgICAgICAgICAgIGxldmVsOiBuLmxldmVsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KHsgdmFsdWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd0NvZGUoKSB7XHJcbiAgICAgICAgY29uc3QgdHJlZU5vZGVzID0gdGhpcy5oZ2UuZ2V0QWxsTm9kZXMoKTtcclxuICAgICAgICB0aGlzLmNvbHVtbnNDb2RlID0gdGhpcy5oZ2UuY29udmVydDJBcnJheSh0cmVlTm9kZXMpO1xyXG5cclxuICAgICAgICB0aGlzLm1vZGFsU2VyLnNob3codGhpcy5jb2RlVGVtcGxhdGUsIHtcclxuICAgICAgICAgICAgdGl0bGU6ICfooajlpLTliIbnu4Tku6PnoIEnLFxyXG4gICAgICAgICAgICB3aWR0aDogNTAwLCBoZWlnaHQ6IDQwMCxcclxuICAgICAgICAgICAgcmVzaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
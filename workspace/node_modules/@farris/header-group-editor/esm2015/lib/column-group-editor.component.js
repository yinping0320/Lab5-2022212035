/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BsModalService } from '@farris/ui-modal';
import { HeaderGroupEditorComponent } from './header-group-editor.component';
import { Component, Input, ViewChild, EventEmitter, Output, TemplateRef, ElementRef, Renderer2, Injector, HostBinding } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { flatten } from 'lodash-es';
export class ColumnGroupEditorComponent {
    /**
     * @param {?} render
     * @param {?} messagerSer
     * @param {?} injector
     * @param {?} modalSer
     */
    constructor(render, messagerSer, injector, modalSer) {
        this.render = render;
        this.messagerSer = messagerSer;
        this.injector = injector;
        this.modalSer = modalSer;
        this.editorParams = {};
        this.cls = 'f-utils-absolute-all';
        this.closeModal = new EventEmitter();
        // 模态框确定后关闭，并传递参数
        this.submitModal = new EventEmitter();
        this.previewGroupColumns = [];
        this.columnsCode = [];
        this.btnTopActive = true;
        this.btnBottomActive = true;
        this.isOpen = false;
        this.fieldInfo = {};
        this.modalConfig = {
            title: '多表头编辑器',
            width: 700,
            height: 500,
            showButtons: true
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.fields || !this.fields.length) {
            if (this.editorParams && this.editorParams.fields && this.editorParams.fields.length) {
                this.fields = this.editorParams.fields;
            }
            else {
                console.warn('Pleasy Set Datagrid\'s fields Give it 2 me.');
            }
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onTreenodeSelect($event) {
        this.fieldInfo = $event.data;
    }
    /**
     * @private
     * @return {?}
     */
    setPreviewColumns() {
        /** @type {?} */
        const treeNodes = this.hge.getAllNodes();
        this.previewGroupColumns = this.hge.convert2Array(treeNodes);
    }
    /**
     * @return {?}
     */
    showPreview() {
        this.setPreviewColumns();
        if (!this.isOpen) {
            this.isOpen = true;
        }
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    closePreview(event) {
        this.isOpen = false;
        if (event) {
            event.stopPropagation();
        }
    }
    /**
     * @return {?}
     */
    resetGroupColumns() {
        this.messagerSer.question('表头分组重置后需要重新设置。确定要重置为初始状态吗？', (/**
         * @return {?}
         */
        () => {
            this.hge.initTreeData();
        }));
    }
    /**
     * @return {?}
     */
    cancle() {
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    ok() {
        this.setPreviewColumns();
        /** @type {?} */
        const flatgroupcols = flatten(this.previewGroupColumns);
        /** @type {?} */
        const value = this.hge.tt.serializedValue.map((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            /** @type {?} */
            const parent = n.parent ? n.parent.data.id : null;
            if (n.node.data.groupHeader || n.node.data.houxunquNode) {
                /** @type {?} */
                const _col = flatgroupcols.find((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.id === n.id));
                /** @type {?} */
                const item = Object.assign({}, n.node.data, { parent, level: n.level });
                if (_col) {
                    return Object.assign(item, { rowspan: _col ? _col.rowspan : 1,
                        colspan: _col ? _col.colspan : 1 });
                }
                return item;
            }
            else {
                return {
                    fieldRef: n.node.data.id,
                    parent,
                    level: n.level
                };
            }
        }));
        this.submitModal.emit({ value });
    }
    /**
     * @return {?}
     */
    showCode() {
        /** @type {?} */
        const treeNodes = this.hge.getAllNodes();
        this.columnsCode = this.hge.convert2Array(treeNodes);
        this.modalSer.show(this.codeTemplate, {
            title: '表头分组代码',
            width: 500, height: 400,
            resizable: false,
            showMaxButton: false,
            showButtons: false
        });
    }
}
ColumnGroupEditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'column-group-editor',
                template: "\r\n<div class=\"d-flex flex-column\" style=\"height: 100%\">\r\n        <div region=\"north\" class=\"north\" style=\"height: 40px;min-height: 40px;border-bottom: 1px solid #c8c8c8; line-height: 36px;\">\r\n            <button class=\"btn btn-primary mr-1 ml-2\" (click)=\"resetGroupColumns()\">\r\n                <span class=\"f-icon f-icon-reset-sm mr-1\"></span>\u91CD\u7F6E\r\n            </button>\r\n            <button class=\"btn btn-primary mr-1\" (click)=\"showPreview()\">\r\n                <span class=\"f-icon f-icon-preview  mr-1\"></span>\u6548\u679C\u9884\u89C8\r\n            </button>\r\n            <button class=\"btn btn-primary\" (click)=\"showCode()\">\r\n                <span class=\"f-icon f-icon-source-code mr-1\"></span>\u83B7\u53D6\u4EE3\u7801\r\n            </button>\r\n        </div>\r\n        <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;height: 100%;\">\r\n            <div class=\"d-flex flex-row flex-fill\" style=\"height: 100%\" >\r\n                <div region=\"center\" class=\"center flex-fill\" style=\"overflow:auto;\">\r\n                    <header-group-editor #hge [fields]=\"fields\" [treeData]=\"value\" (selectedNode)=\"onTreenodeSelect($event)\"></header-group-editor>\r\n                </div>\r\n                <div region=\"east\" class=\"east property-column\">\r\n\r\n                    <div style=\"padding: 10px\">\r\n                            <div class=\"farris-group-wrap\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u8868\u5934\u540D\u79F0</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <input type=\"input\" [disabled]=\"!fieldInfo.groupHeader\" class=\"form-control\" [(ngModel)]=\"fieldInfo.caption\">\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"farris-group-wrap\" *ngIf=\"fieldInfo.groupHeader\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u8868\u5934\u5BF9\u9F50\u65B9\u5F0F</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <select class=\"form-control\" [(ngModel)]=\"fieldInfo.halign\">\r\n                                            <option value=\"left\">\u5DE6\u5BF9\u9F50</option>\r\n                                            <option value=\"center\">\u5C45\u4E2D\u5BF9\u9F50</option>\r\n                                            <option value=\"right\">\u53F3\u5BF9\u9F50</option>\r\n                                        </select>\r\n                                        <!-- <select class=\"form-control\" *ngIf=\"!fieldInfo.groupHeader\" [(ngModel)]=\"fieldInfo.hAlign\">\r\n                                            <option value=\"left\">\u5DE6\u5BF9\u9F50</option>\r\n                                            <option value=\"center\">\u5C45\u4E2D\u5BF9\u9F50</option>\r\n                                            <option value=\"right\">\u53F3\u5BF9\u9F50</option>\r\n                                        </select> -->\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                     \r\n                             <!-- <div class=\"farris-group-wrap\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u6570\u636E\u5BF9\u9F50\u65B9\u5F0F</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <select class=\"form-control\" [(ngModel)]=\"fieldInfo.align\">\r\n                                            <option value=\"left\">\u5DE6\u5BF9\u9F50</option>\r\n                                            <option value=\"center\">\u5C45\u4E2D\u5BF9\u9F50</option>\r\n                                            <option value=\"right\">\u53F3\u5BF9\u9F50</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"farris-group-wrap\">\r\n                                <div class=\"form-group farris-form-group\">\r\n                                    <label for=\"hpinput01\" class=\"col-form-label\">\r\n                                        <span class=\"farris-label-text\">\u5BBD\u5EA6</span>\r\n                                    </label>\r\n                                    <div class=\"farris-input-wrap\">\r\n                                        <input type=\"input\" class=\"form-control\" [(ngModel)]=\"fieldInfo.size\">\r\n                                    </div>\r\n                                </div>\r\n                            </div> -->\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n       \r\n        <div region=\"south\" class=\"south\" [class.preview-open]=\"isOpen\" #preview>\r\n\r\n            <div class=\"d-flex flex-column flex-fill\" style=\"height: 100%;\">\r\n                <div region=\"north\" class=\"north preview-title\" (click)=\"isOpen = !isOpen\">\r\n                   <span class=\"text\" >\u6548\u679C\u9884\u89C8</span> \r\n                   <div class=\"close-btn\" (click)=\"closePreview($event)\">\r\n                        <span class=\"f-icon f-icon-close\"></span>\r\n                   </div>\r\n                </div>\r\n                <div region=\"center\" class=\"center flex-fill preview-container\">\r\n                    <table>\r\n\r\n                        <tr  *ngFor=\"let cls of previewGroupColumns\" style=\"height: 36px\">\r\n                            <ng-container *ngFor=\"let c of cls\">\r\n                                <ng-container *ngIf=\"c.colspan > 1\">\r\n                                    <td [attr.colspan]=\"c.colspan\" [attr.align]=\"c.halign || 'left'\">{{ c.title }}</td>\r\n                                </ng-container>\r\n\r\n                                <ng-container *ngIf=\"c.colspan == 1\">\r\n                                    <td [style.width.px]=\"c.width\"  [attr.align]=\"c.halign || 'left'\" [attr.rowspan]=\"c.rowspan || 1\">{{ c.title }}</td>\r\n                                </ng-container>\r\n                            </ng-container>\r\n                        </tr>\r\n                        \r\n\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n       \r\n</div>\r\n\r\n<ng-template #dlgFooter>\r\n    <div class=\"btns\">\r\n        <button  type=\"button\"  class=\"btn btn-primary btn-lg px-3\" (click)=\"ok()\" > \u786E\u5B9A </button>\r\n        &nbsp;&nbsp;\r\n        <button type=\"button\" class=\"btn btn-secondary btn-lg px-3\" (click)=\"cancle()\" > \u53D6\u6D88 </button> \r\n    </div>\r\n</ng-template>\r\n\r\n<ng-template #code>\r\n<textarea name=\"group-columns-code\" class=\"form-control\" rows=17>\r\n{{ columnsCode | json }}\r\n</textarea>\r\n</ng-template>\r\n\r\n\r\n",
                styles: [`
        .center::-webkit-scrollbar { width: 5px; height: 5px}
        .south::-webkit-scrollbar { width: 5px; height: 5px }
        .south {
            height: 40px;
            min-height: 40px;
            overflow: hidden;
            border-top: 1px solid #c8c8c8;
            background: #F3F8FF;
            transition: height 0.5s;
            flex-shrink: 0!important;;
        }
        .preview-open {
            height: 300px;
        }
        .preview-container {
            flex-shrink: 0!important;overflow:auto
        }
        .preview-title {
            height:36px;min-height: 36px; background: #F3F8FF; cursor:pointer;
        }
        .preview-title .text {
            line-height: 36px;font-size: 16px;padding-left: 10px;
        }
        .preview-title button {
            float: right;
            line-height: 40px;
            margin-right: 10px;
        }
        .preview-container table{
            width: max-content; margin: 5px; background-color: #efefef; border-color: #adadad;
        }
        .preview-container table td{border: 1px solid #c2c2c2;}

        .east.property-column {
            width: 300px; min-width:260px;border-left: 1px solid #c8c8c8;overflow: auto;background:#F3F8FF
        }
        .close-btn {
            display: inline-block;
            float: right;
            line-height: 36px;
            margin-right: 10px;
            width: 36px;
            color: #ccc;
            text-align: center;
        }
        .close-btn:hover {
            color: red;
        }
        `]
            }] }
];
/** @nocollapse */
ColumnGroupEditorComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: MessagerService },
    { type: Injector },
    { type: BsModalService }
];
ColumnGroupEditorComponent.propDecorators = {
    editorParams: [{ type: Input }],
    fields: [{ type: Input }],
    value: [{ type: Input }],
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    hge: [{ type: ViewChild, args: ['hge',] }],
    modalFooter: [{ type: ViewChild, args: ['dlgFooter',] }],
    previewEl: [{ type: ViewChild, args: ['preview',] }],
    codeTemplate: [{ type: ViewChild, args: ['code',] }]
};
if (false) {
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.editorParams;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.fields;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.value;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.cls;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.closeModal;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.submitModal;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.hge;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.modalFooter;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.previewEl;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.codeTemplate;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.previewGroupColumns;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.columnsCode;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.btnTopActive;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.btnBottomActive;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.isOpen;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.fieldInfo;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.modalConfig;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupEditorComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupEditorComponent.prototype.messagerSer;
    /** @type {?} */
    ColumnGroupEditorComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ColumnGroupEditorComponent.prototype.modalSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLWdyb3VwLWVkaXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2hlYWRlci1ncm91cC1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvY29sdW1uLWdyb3VwLWVkaXRvci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUM3RSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQy9ELFVBQVUsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQTJEcEMsTUFBTSxPQUFPLDBCQUEwQjs7Ozs7OztJQWtDbkMsWUFDWSxNQUFpQixFQUFVLFdBQTRCLEVBQVMsUUFBa0IsRUFDbEYsUUFBd0I7UUFEeEIsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLGdCQUFXLEdBQVgsV0FBVyxDQUFpQjtRQUFTLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEYsYUFBUSxHQUFSLFFBQVEsQ0FBZ0I7UUFuQzNCLGlCQUFZLEdBQVEsRUFBRSxDQUFDO1FBS1YsUUFBRyxHQUFHLHNCQUFzQixDQUFDO1FBRXpDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDOztRQUVyQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFPaEQsd0JBQW1CLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBRWpCLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLG9CQUFlLEdBQUcsSUFBSSxDQUFDO1FBRXZCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixjQUFTLEdBQVEsRUFBRSxDQUFDO1FBR3BCLGdCQUFXLEdBQUc7WUFDVixLQUFLLEVBQUUsUUFBUTtZQUNmLEtBQUssRUFBRSxHQUFHO1lBQ1YsTUFBTSxFQUFFLEdBQUc7WUFDWCxXQUFXLEVBQUUsSUFBSTtTQUNwQixDQUFDO0lBSXNDLENBQUM7Ozs7SUFFekMsUUFBUTtRQUNKLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7WUFDckMsSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxJQUFLLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtnQkFDbkYsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQzthQUMxQztpQkFBTTtnQkFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxDQUFDLENBQUM7YUFDL0Q7U0FDSjtJQUNMLENBQUM7Ozs7O0lBRUQsZ0JBQWdCLENBQUMsTUFBTTtRQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDakMsQ0FBQzs7Ozs7SUFFTyxpQkFBaUI7O2NBQ2YsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFO1FBQ3hDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqRSxDQUFDOzs7O0lBRUQsV0FBVztRQUNQLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2QsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7U0FDdEI7SUFDTCxDQUFDOzs7OztJQUVELFlBQVksQ0FBQyxLQUFrQjtRQUMzQixJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNwQixJQUFJLEtBQUssRUFBRTtZQUNQLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUMzQjtJQUNMLENBQUM7Ozs7SUFFRCxpQkFBaUI7UUFDYixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyw0QkFBNEI7OztRQUFFLEdBQUcsRUFBRTtZQUN6RCxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzVCLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7OztJQUVELE1BQU07UUFDRixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7SUFFRCxFQUFFO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7O2NBRW5CLGFBQWEsR0FBRyxPQUFPLENBQU0sSUFBSSxDQUFDLG1CQUFtQixDQUFDOztjQUV0RCxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTs7a0JBQ3hDLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUk7WUFDakQsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFOztzQkFDL0MsSUFBSSxHQUFHLGFBQWEsQ0FBQyxJQUFJOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFDOztzQkFDN0MsSUFBSSxxQkFDSCxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksSUFDZCxNQUFNLEVBQ04sS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQ2pCO2dCQUVELElBQUksSUFBSSxFQUFFO29CQUNOLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN6RCxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO2lCQUMxQztnQkFFRCxPQUFPLElBQUksQ0FBQzthQUVmO2lCQUFNO2dCQUNILE9BQU87b0JBQ0gsUUFBUSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQ3hCLE1BQU07b0JBQ04sS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLO2lCQUNqQixDQUFDO2FBQ0w7UUFDTCxDQUFDLEVBQUM7UUFDRixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDckMsQ0FBQzs7OztJQUVELFFBQVE7O2NBQ0UsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFO1FBQ3hDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFckQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNsQyxLQUFLLEVBQUUsUUFBUTtZQUNmLEtBQUssRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEdBQUc7WUFDdkIsU0FBUyxFQUFFLEtBQUs7WUFDaEIsYUFBYSxFQUFFLEtBQUs7WUFDcEIsV0FBVyxFQUFFLEtBQUs7U0FDckIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7O1lBdExKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUscUJBQXFCO2dCQUMvQiw2cVBBQWlEO3lCQUU3Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztTQWlEQzthQUVSOzs7O1lBM0QyQixTQUFTO1lBQzVCLGVBQWU7WUFEZSxRQUFRO1lBSHRDLGNBQWM7OzsyQkFpRWxCLEtBQUs7cUJBQ0wsS0FBSztvQkFDTCxLQUFLO2tCQUdMLFdBQVcsU0FBQyxPQUFPO3lCQUVuQixNQUFNOzBCQUVOLE1BQU07a0JBRU4sU0FBUyxTQUFDLEtBQUs7MEJBQ2YsU0FBUyxTQUFDLFdBQVc7d0JBQ3JCLFNBQVMsU0FBQyxTQUFTOzJCQUNuQixTQUFTLFNBQUMsTUFBTTs7OztJQWRqQixrREFBZ0M7O0lBQ2hDLDRDQUF1Qjs7SUFDdkIsMkNBQXNCOztJQUd0Qix5Q0FBbUQ7O0lBRW5ELGdEQUErQzs7SUFFL0MsaURBQWdEOztJQUVoRCx5Q0FBa0Q7O0lBQ2xELGlEQUFzRDs7SUFDdEQsK0NBQTRDOztJQUM1QyxrREFBa0Q7O0lBRWxELHlEQUF5Qjs7SUFDekIsaURBQWlCOztJQUVqQixrREFBb0I7O0lBQ3BCLHFEQUF1Qjs7SUFFdkIsNENBQWU7O0lBQ2YsK0NBQW9COztJQUdwQixpREFLRTs7Ozs7SUFHRSw0Q0FBeUI7Ozs7O0lBQUUsaURBQW9DOztJQUFFLDhDQUF5Qjs7Ozs7SUFDMUYsOENBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgSGVhZGVyR3JvdXBFZGl0b3JDb21wb25lbnQgfSBmcm9tICcuL2hlYWRlci1ncm91cC1lZGl0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBWaWV3Q2hpbGQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBUZW1wbGF0ZVJlZixcclxuICAgICAgICAgICAgICAgIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgSW5qZWN0b3IsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBmbGF0dGVuIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdjb2x1bW4tZ3JvdXAtZWRpdG9yJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnY29sdW1uLWdyb3VwLWVkaXRvci5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgLmNlbnRlcjo6LXdlYmtpdC1zY3JvbGxiYXIgeyB3aWR0aDogNXB4OyBoZWlnaHQ6IDVweH1cclxuICAgICAgICAuc291dGg6Oi13ZWJraXQtc2Nyb2xsYmFyIHsgd2lkdGg6IDVweDsgaGVpZ2h0OiA1cHggfVxyXG4gICAgICAgIC5zb3V0aCB7XHJcbiAgICAgICAgICAgIGhlaWdodDogNDBweDtcclxuICAgICAgICAgICAgbWluLWhlaWdodDogNDBweDtcclxuICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcclxuICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNjOGM4Yzg7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNGM0Y4RkY7XHJcbiAgICAgICAgICAgIHRyYW5zaXRpb246IGhlaWdodCAwLjVzO1xyXG4gICAgICAgICAgICBmbGV4LXNocmluazogMCFpbXBvcnRhbnQ7O1xyXG4gICAgICAgIH1cclxuICAgICAgICAucHJldmlldy1vcGVuIHtcclxuICAgICAgICAgICAgaGVpZ2h0OiAzMDBweDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnByZXZpZXctY29udGFpbmVyIHtcclxuICAgICAgICAgICAgZmxleC1zaHJpbms6IDAhaW1wb3J0YW50O292ZXJmbG93OmF1dG9cclxuICAgICAgICB9XHJcbiAgICAgICAgLnByZXZpZXctdGl0bGUge1xyXG4gICAgICAgICAgICBoZWlnaHQ6MzZweDttaW4taGVpZ2h0OiAzNnB4OyBiYWNrZ3JvdW5kOiAjRjNGOEZGOyBjdXJzb3I6cG9pbnRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLnByZXZpZXctdGl0bGUgLnRleHQge1xyXG4gICAgICAgICAgICBsaW5lLWhlaWdodDogMzZweDtmb250LXNpemU6IDE2cHg7cGFkZGluZy1sZWZ0OiAxMHB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAucHJldmlldy10aXRsZSBidXR0b24ge1xyXG4gICAgICAgICAgICBmbG9hdDogcmlnaHQ7XHJcbiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiA0MHB4O1xyXG4gICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5wcmV2aWV3LWNvbnRhaW5lciB0YWJsZXtcclxuICAgICAgICAgICAgd2lkdGg6IG1heC1jb250ZW50OyBtYXJnaW46IDVweDsgYmFja2dyb3VuZC1jb2xvcjogI2VmZWZlZjsgYm9yZGVyLWNvbG9yOiAjYWRhZGFkO1xyXG4gICAgICAgIH1cclxuICAgICAgICAucHJldmlldy1jb250YWluZXIgdGFibGUgdGR7Ym9yZGVyOiAxcHggc29saWQgI2MyYzJjMjt9XHJcblxyXG4gICAgICAgIC5lYXN0LnByb3BlcnR5LWNvbHVtbiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiAzMDBweDsgbWluLXdpZHRoOjI2MHB4O2JvcmRlci1sZWZ0OiAxcHggc29saWQgI2M4YzhjODtvdmVyZmxvdzogYXV0bztiYWNrZ3JvdW5kOiNGM0Y4RkZcclxuICAgICAgICB9XHJcbiAgICAgICAgLmNsb3NlLWJ0biB7XHJcbiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcclxuICAgICAgICAgICAgZmxvYXQ6IHJpZ2h0O1xyXG4gICAgICAgICAgICBsaW5lLWhlaWdodDogMzZweDtcclxuICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAxMHB4O1xyXG4gICAgICAgICAgICB3aWR0aDogMzZweDtcclxuICAgICAgICAgICAgY29sb3I6ICNjY2M7XHJcbiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLmNsb3NlLWJ0bjpob3ZlciB7XHJcbiAgICAgICAgICAgIGNvbG9yOiByZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGBcclxuICAgIF1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2x1bW5Hcm91cEVkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IGFueSA9IHt9O1xyXG4gICAgQElucHV0KCkgZmllbGRzOiBhbnlbXTtcclxuICAgIEBJbnB1dCgpIHZhbHVlOiBhbnlbXTtcclxuXHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIGNscyA9ICdmLXV0aWxzLWFic29sdXRlLWFsbCc7XHJcblxyXG4gICAgQE91dHB1dCgpIGNsb3NlTW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIC8vIOaooeaAgeahhuehruWumuWQjuWFs+mXre+8jOW5tuS8oOmAkuWPguaVsFxyXG4gICAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnaGdlJykgaGdlOiBIZWFkZXJHcm91cEVkaXRvckNvbXBvbmVudDtcclxuICAgIEBWaWV3Q2hpbGQoJ2RsZ0Zvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgQFZpZXdDaGlsZCgncHJldmlldycpIHByZXZpZXdFbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2NvZGUnKSBjb2RlVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gICAgcHJldmlld0dyb3VwQ29sdW1ucyA9IFtdO1xyXG4gICAgY29sdW1uc0NvZGUgPSBbXTtcclxuXHJcbiAgICBidG5Ub3BBY3RpdmUgPSB0cnVlO1xyXG4gICAgYnRuQm90dG9tQWN0aXZlID0gdHJ1ZTtcclxuXHJcbiAgICBpc09wZW4gPSBmYWxzZTtcclxuICAgIGZpZWxkSW5mbzogYW55ID0ge307XHJcblxyXG5cclxuICAgIG1vZGFsQ29uZmlnID0ge1xyXG4gICAgICAgIHRpdGxlOiAn5aSa6KGo5aS057yW6L6R5ZmoJyxcclxuICAgICAgICB3aWR0aDogNzAwLFxyXG4gICAgICAgIGhlaWdodDogNTAwLFxyXG4gICAgICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgbWVzc2FnZXJTZXI6IE1lc3NhZ2VyU2VydmljZSwgcHVibGljIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VyOiBCc01vZGFsU2VydmljZSkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmZpZWxkcyB8fCAhdGhpcy5maWVsZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVkaXRvclBhcmFtcyAmJiB0aGlzLmVkaXRvclBhcmFtcy5maWVsZHMgICYmIHRoaXMuZWRpdG9yUGFyYW1zLmZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5lZGl0b3JQYXJhbXMuZmllbGRzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdQbGVhc3kgU2V0IERhdGFncmlkXFwncyBmaWVsZHMgR2l2ZSBpdCAyIG1lLicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uVHJlZW5vZGVTZWxlY3QoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5maWVsZEluZm8gPSAkZXZlbnQuZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFByZXZpZXdDb2x1bW5zKCkge1xyXG4gICAgICAgIGNvbnN0IHRyZWVOb2RlcyA9IHRoaXMuaGdlLmdldEFsbE5vZGVzKCk7XHJcbiAgICAgICAgdGhpcy5wcmV2aWV3R3JvdXBDb2x1bW5zID0gdGhpcy5oZ2UuY29udmVydDJBcnJheSh0cmVlTm9kZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dQcmV2aWV3KCkge1xyXG4gICAgICAgIHRoaXMuc2V0UHJldmlld0NvbHVtbnMoKTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNPcGVuKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VQcmV2aWV3KGV2ZW50PzogTW91c2VFdmVudCkge1xyXG4gICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXNldEdyb3VwQ29sdW1ucygpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VyU2VyLnF1ZXN0aW9uKCfooajlpLTliIbnu4Tph43nva7lkI7pnIDopoHph43mlrDorr7nva7jgILnoa7lrpropoHph43nva7kuLrliJ3lp4vnirbmgIHlkJfvvJ8nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGdlLmluaXRUcmVlRGF0YSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNsZSgpIHtcclxuICAgICAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9rKCkge1xyXG4gICAgICAgIHRoaXMuc2V0UHJldmlld0NvbHVtbnMoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZmxhdGdyb3VwY29scyA9IGZsYXR0ZW48YW55Pih0aGlzLnByZXZpZXdHcm91cENvbHVtbnMpO1xyXG5cclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuaGdlLnR0LnNlcmlhbGl6ZWRWYWx1ZS5tYXAobiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IG4ucGFyZW50ID8gbi5wYXJlbnQuZGF0YS5pZCA6IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChuLm5vZGUuZGF0YS5ncm91cEhlYWRlciB8fCBuLm5vZGUuZGF0YS5ob3V4dW5xdU5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IF9jb2wgPSBmbGF0Z3JvdXBjb2xzLmZpbmQoYyA9PiBjLmlkID09PSBuLmlkKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4ubi5ub2RlLmRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LFxyXG4gICAgICAgICAgICAgICAgICAgIGxldmVsOiBuLmxldmVsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChfY29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oaXRlbSwgeyByb3dzcGFuOiBfY29sID8gX2NvbC5yb3dzcGFuIDogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sc3BhbjogX2NvbCA/IF9jb2wuY29sc3BhbiA6IDF9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkUmVmOiBuLm5vZGUuZGF0YS5pZCxcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IG4ubGV2ZWxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQoeyB2YWx1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93Q29kZSgpIHtcclxuICAgICAgICBjb25zdCB0cmVlTm9kZXMgPSB0aGlzLmhnZS5nZXRBbGxOb2RlcygpO1xyXG4gICAgICAgIHRoaXMuY29sdW1uc0NvZGUgPSB0aGlzLmhnZS5jb252ZXJ0MkFycmF5KHRyZWVOb2Rlcyk7XHJcblxyXG4gICAgICAgIHRoaXMubW9kYWxTZXIuc2hvdyh0aGlzLmNvZGVUZW1wbGF0ZSwge1xyXG4gICAgICAgICAgICB0aXRsZTogJ+ihqOWktOWIhue7hOS7o+eggScsXHJcbiAgICAgICAgICAgIHdpZHRoOiA1MDAsIGhlaWdodDogNDAwLFxyXG4gICAgICAgICAgICByZXNpemFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@farris/ui-notify"),require("rxjs/operators"),require("@farris/ui-messager"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("@farris/oa-command-services",["exports","@farris/ui-notify","rxjs/operators","@farris/ui-messager","@angular/core","rxjs"],e):e((t.farris=t.farris||{},t.farris["oa-command-services"]={}),t.uiNotify,t.rxjs.operators,t.i1,t.ng.core,t.rxjs)}(this,function(t,e,c,r,n,u){"use strict";i.prototype.filterAndRemoveRows=function(t,r){var n,o=this;if(!t||0===t.length)return this.notifySer.error("请选择要删除的数据！"),u.empty();try{n=this.context.frameContext}catch(a){throw new Error("can not find frameContex")}var i=n.bindingData,s=[];return t.forEach(function(t){var e=i.list.findById(t);e&&e.billState&&"Billing"===e.billState.billState&&s.push(t)}),s.length?this.msgService.confirm("确认删除？").pipe(c.concatMap(function(t){if(!t)return u.empty();var e;r=!1!==(r="string"==typeof(r=void 0===r?!0:r)?"false"!==r.toLowerCase():r);try{e=n.repository}catch(a){return u.empty()}t=e.removeByIds(s,r);return t?t.pipe(c.tap(function(){o.notifySer.success("删除成功！")},function(t){o.msgService.error(t)}),c.switchMap(function(){return u.of([])})):u.empty()})):(this.notifySer.error("没有可删除的数据！"),u.empty())},i.decorators=[{type:n.Injectable}],i.ctorParameters=function(){return[{type:r.MessagerService},{type:e.NotifyService}]};var o=i;function i(t,e){this.msgService=t,this.notifySer=e}var s="card",a=(f.prototype.printWebPage=function(t){void 0===t&&(t=s),this.currentTemplate=t,window.navigator.userAgent.includes("AppleWebKit/")?window.print():this.msgSer.prompt("提示","为保证打印效果，推荐使用谷歌浏览器进行打印。是否继续打印？").subscribe(function(t){t&&window.print()})},f.decorators=[{type:n.Injectable}],f.ctorParameters=function(){return[{type:r.MessagerService}]},f);function f(t){var r=this;this.msgSer=t,window.onbeforeprint=function(){var t,e;r.currentTemplate==s&&(t=document.getElementById("root-layout"),e=document.getElementById("main-container"),t&&e?(t.style.display="block",t.style.position="relative",e.style.display="block",t.parentElement.style.position="relative",document.title=""):r.msgSer.error("未找到模板中关键节点，请检查命令传参中模板类型是否正确。"))},window.onafterprint=function(){var t,e;r.currentTemplate==s&&(t=document.getElementById("root-layout"),e=document.getElementById("main-container"),t)&&e&&(e.setAttribute("style",""),t.setAttribute("style",""),t.parentElement.setAttribute("style",""))}}var p="finally",l="progress",d="error",h=(m.prototype.propTask=function(t,e,r,n){var o=this;return this.taskStack.push({funName:n,fun:t,params:e=void 0===e?[]:e,context:r}),this.status||this.actTask().subscribe(function(t){o.taskResult.next(t)}),this.taskResult},m.prototype.actTask=function(){var e=this,r=(this.status=1,new u.Subject),t=this.taskStack[this.actIndex];try{t.fun.apply(t.context||window,t.params||[]).subscribe(function(t){e.resultStack.push(t),r.next({type:e.actIndex==e.taskStack.length-1?p:l,recentResult:t,progressIndex:e.actIndex,resultStack:e.resultStack}),e.actIndex<e.taskStack.length-1?(e.actIndex++,e.actTask()):e.status=0})}catch(n){this.resultStack.push(n),r.next({type:d,recentResult:n,progressIndex:this.actIndex,resultStack:this.resultStack}),this.actIndex<this.taskStack.length-1?(this.actIndex++,this.actTask()):this.status=0}return r},m);function m(){this.actIndex=0,this.resultStack=[],this.status=0,this.taskResult=new u.Subject,this.taskStack=[]}var y="Pass",v="Resubmit",S="Comment",g=(x.prototype.initTaskCenterBridge=function(t){var o,i,s=this,e=window.parent;try{o=this.context.frameContext}catch(r){throw new Error("can not find frameContex")}try{i=this.context.frameContext.viewModel.slienceSave1}catch(r){}e&&(e.taskCenterBeforeLoad=function(n){return new Promise(function(e,t){var r=n.action;"Approving"==o.uiState.UIStateInProcess&&o.uiState.formConfigId?i.call(s).subscribe(function(){e({result:!0})},function(){window.document.body.click(),r.code===y?e({result:!1}):r.code===S?e({result:!0}):s.msgService.confirm("检测到单据保存失败，是否继续？").subscribe(function(t){e({result:t})})}):r.code==v&&i?i.call(s).subscribe(function(){e({result:!0})}):e({result:!0})})})},x.prototype.executeSchedules=function(t){var r,n=this;t=t.split(",");try{r=this.context.frameContext}catch(o){throw new Error("can not find frameContex")}t.forEach(function(t){var e;try{e=r.viewModel[t],n.taskSchdule.propTask(e,[],n,t).subscribe(function(t){console.log(t)})}catch(o){console.log(o)}})},x.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],x.ctorParameters=function(){return[{type:r.MessagerService}]},x.ngInjectableDef=n.defineInjectable({factory:function(){return new x(n.inject(r.MessagerService))},token:x,providedIn:"root"}),x);function x(t){this.msgService=t,this.taskSchdule=new h}k.prototype.switchStatus=function(){var t,e=new u.BehaviorSubject("Cancel");try{t=this.context.frameContext}catch(r){throw new Error("can not find frameContex")}return"Approving"==t.uiState.UIStateInProcess&&t.uiState.formConfigId&&e.next("Edit"),e},k.decorators=[{type:n.Injectable}],k.ctorParameters=function(){return[{type:n.Injector}]};var b=k;function k(t){this.injetor=t}I.decorators=[{type:n.NgModule,args:[{providers:[g,a,b,o],imports:[],exports:[],entryComponents:[]}]}],I.ctorParameters=function(){return[]};var w=I;function I(){}t.OAListDataService=o,t.OACommandServicesModule=w,t.PrintWebPageService=a,t.TaskCenterBridgeService=g,t.TransitApprovalStatus=b,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-oa-command-services.umd.min.js.map
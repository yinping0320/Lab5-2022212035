/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { SyncTaskSchdule } from '../utils/sync-task-shchdule';
import { WFActionType } from './entity';
import * as i0 from "@angular/core";
import * as i1 from "@farris/ui-messager";
var TaskCenterBridgeService = /** @class */ (function () {
    function TaskCenterBridgeService(msgService) {
        this.msgService = msgService;
        this.taskSchdule = new SyncTaskSchdule();
    }
    /**
     * @param {?} customerCmds
     * @return {?}
     */
    TaskCenterBridgeService.prototype.initTaskCenterBridge = /**
     * @param {?} customerCmds
     * @return {?}
     */
    function (customerCmds) {
        var _this = this;
        /** @type {?} */
        var bridgeWin = window.parent;
        /** @type {?} */
        var frameContext;
        try {
            frameContext = this['context'].frameContext;
        }
        catch (error) {
            throw new Error('can not find frameContex');
        }
        /** @type {?} */
        var slienceSaveTask;
        try {
            slienceSaveTask = this['context'].frameContext.viewModel.slienceSave1;
        }
        catch (error) {
            // 不存在静音保存命令
        }
        if (bridgeWin) {
            bridgeWin['taskCenterBeforeLoad'] = function (actionObj) {
                return new Promise(function (resolve, reject) {
                    var action = actionObj.action;
                    if (frameContext.uiState['UIStateInProcess'] == 'Approving' && frameContext.uiState['formConfigId']) {
                        slienceSaveTask.call(_this).subscribe(function () {
                            resolve({
                                result: true
                            });
                        }, function () {
                            window.document.body.click();
                            if (action.code === WFActionType.Pass) { // 除了审评通过外，其它的不需要保存 
                                resolve({
                                    result: false
                                });
                            }
                            else if (action.code === WFActionType.Comment) {
                                resolve({
                                    result: true
                                });
                            }
                            else {
                                _this.msgService.confirm('检测到单据保存失败，是否继续？').subscribe(function (confirm) {
                                    resolve({
                                        result: confirm
                                    });
                                });
                            }
                        });
                    }
                    else if (action.code == WFActionType.Resubmit && slienceSaveTask) {
                        slienceSaveTask.call(_this).subscribe(function () {
                            resolve({
                                result: true
                            });
                        });
                    }
                    else {
                        resolve({
                            result: true
                        });
                    }
                });
            };
        }
    };
    /**
     * @param {?} taskArray
     * @return {?}
     */
    TaskCenterBridgeService.prototype.executeSchedules = /**
     * @param {?} taskArray
     * @return {?}
     */
    function (taskArray) {
        var _this = this;
        // 这里根据 任务名称，从 viewmodel中找到，然后依次执行
        taskArray = taskArray.split(',');
        // 这里需要验证拿到 commandService 
        /** @type {?} */
        var frameContext;
        try {
            frameContext = this['context'].frameContext;
        }
        catch (error) {
            throw new Error('can not find frameContex');
        }
        taskArray.forEach(function (item) {
            /** @type {?} */
            var targetTask;
            try {
                targetTask = frameContext.viewModel[item];
                _this.taskSchdule.propTask(targetTask, [], _this, item).subscribe(function (res) {
                    console.log(res);
                });
            }
            catch (error) {
                // 未找到应该在children中继续查找 未找到
                console.log(error);
            }
        });
    };
    TaskCenterBridgeService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    TaskCenterBridgeService.ctorParameters = function () { return [
        { type: MessagerService }
    ]; };
    /** @nocollapse */ TaskCenterBridgeService.ngInjectableDef = i0.defineInjectable({ factory: function TaskCenterBridgeService_Factory() { return new TaskCenterBridgeService(i0.inject(i1.MessagerService)); }, token: TaskCenterBridgeService, providedIn: "root" });
    return TaskCenterBridgeService;
}());
export { TaskCenterBridgeService };
if (false) {
    /** @type {?} */
    TaskCenterBridgeService.prototype.taskSchdule;
    /** @type {?} */
    TaskCenterBridgeService.prototype.msgService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1jZW50ZXItYnJpZGdlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL29hLWNvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvdGFzay1jZW50ZXItYnJpZGdlL3Rhc2stY2VudGVyLWJyaWRnZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDOUQsT0FBTyxFQUFZLFlBQVksRUFBVSxNQUFNLFVBQVUsQ0FBQzs7O0FBRzFEO0lBUUUsaUNBQ1UsVUFBMkI7UUFBM0IsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFFbkMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLGVBQWUsRUFBRSxDQUFDO0lBQzNDLENBQUM7Ozs7O0lBRU0sc0RBQW9COzs7O0lBQTNCLFVBQTRCLFlBQWdCO1FBQTVDLGlCQThEQzs7WUE3RE8sU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNOztZQUMzQixZQUEwQjtRQUM5QixJQUFJO1lBQ0YsWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxZQUFZLENBQUE7U0FDNUM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztTQUM3Qzs7WUFFRyxlQUFlO1FBRW5CLElBQUk7WUFDRixlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDO1NBQ3ZFO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxZQUFZO1NBQ2I7UUFDRCxJQUFJLFNBQVMsRUFBRTtZQUNiLFNBQVMsQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLFVBQ2xDLFNBR0M7Z0JB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U0FwR1ksdUJBQXVCOzs7SUFHbEMsOENBQTRCOztJQUcxQiw2Q0FBbUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFN5bmNUYXNrU2NoZHVsZSB9IGZyb20gJy4uL3V0aWxzL3N5bmMtdGFzay1zaGNoZHVsZSc7XHJcbmltcG9ydCB7IFdGQWN0aW9uLCBXRkFjdGlvblR5cGUsIFdGVGFzayB9IGZyb20gJy4vZW50aXR5JztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUYXNrQ2VudGVyQnJpZGdlU2VydmljZSB7XHJcblxyXG5cclxuICB0YXNrU2NoZHVsZTogU3luY1Rhc2tTY2hkdWxlXHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBtc2dTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgKSB7XHJcbiAgICB0aGlzLnRhc2tTY2hkdWxlID0gbmV3IFN5bmNUYXNrU2NoZHVsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXRUYXNrQ2VudGVyQnJpZGdlKGN1c3RvbWVyQ21kczoge30pIHtcclxuICAgIGNvbnN0IGJyaWRnZVdpbiA9IHdpbmRvdy5wYXJlbnQ7XHJcbiAgICBsZXQgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQ7XHJcbiAgICB0cnkge1xyXG4gICAgICBmcmFtZUNvbnRleHQgPSB0aGlzWydjb250ZXh0J10uZnJhbWVDb250ZXh0XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhbiBub3QgZmluZCBmcmFtZUNvbnRleCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBzbGllbmNlU2F2ZVRhc2s7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc2xpZW5jZVNhdmVUYXNrID0gdGhpc1snY29udGV4dCddLmZyYW1lQ29udGV4dC52aWV3TW9kZWwuc2xpZW5jZVNhdmUxO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgLy8g5LiN5a2Y5Zyo6Z2Z6Z+z5L+d5a2Y5ZG95LukXHJcbiAgICB9XHJcbiAgICBpZiAoYnJpZGdlV2luKSB7XHJcbiAgICAgIGJyaWRnZVdpblsndGFza0NlbnRlckJlZm9yZUxvYWQnXSA9IChcclxuICAgICAgICBhY3Rpb25PYmo6IHtcclxuICAgICAgICAgIFwidGFza1wiOiBXRlRhc2ssXHJcbiAgICAgICAgICBcImFjdGlvblwiOiBXRkFjdGlvblxyXG4gICAgICAgIH1cclxuICAgICAgKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgIGNvbnN0IHsgYWN0aW9uIH0gPSBhY3Rpb25PYmo7XHJcbiAgICAgICAgICBpZiAoZnJhbWVDb250ZXh0LnVpU3RhdGVbJ1VJU3RhdGVJblByb2Nlc3MnXSA9PSAnQXBwcm92aW5nJyAmJiBmcmFtZUNvbnRleHQudWlTdGF0ZVsnZm9ybUNvbmZpZ0lkJ10pIHtcclxuICAgICAgICAgICAgc2xpZW5jZVNhdmVUYXNrLmNhbGwodGhpcykuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdDogdHJ1ZVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmJvZHkuY2xpY2soKVxyXG4gICAgICAgICAgICAgIGlmIChhY3Rpb24uY29kZSA9PT0gV0ZBY3Rpb25UeXBlLlBhc3MpIHsgLy8g6Zmk5LqG5a6h6K+E6YCa6L+H5aSW77yM5YW25a6D55qE5LiN6ZyA6KaB5L+d5a2YIFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3VsdDogZmFsc2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLmNvZGUgPT09IFdGQWN0aW9uVHlwZS5Db21tZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgcmVzdWx0OiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLmNvbmZpcm0oJ+ajgOa1i+WIsOWNleaNruS/neWtmOWksei0pe+8jOaYr+WQpue7p+e7re+8nycpLnN1YnNjcmliZSgoY29uZmlybSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IGNvbmZpcm1cclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5jb2RlID09IFdGQWN0aW9uVHlwZS5SZXN1Ym1pdCAmJiBzbGllbmNlU2F2ZVRhc2spIHtcclxuICAgICAgICAgICAgc2xpZW5jZVNhdmVUYXNrLmNhbGwodGhpcykuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdDogdHJ1ZVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgcmVzdWx0OiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBleGVjdXRlU2NoZWR1bGVzKHRhc2tBcnJheSkge1xyXG4gICAgLy8g6L+Z6YeM5qC55o2uIOS7u+WKoeWQjeensO+8jOS7jiB2aWV3bW9kZWzkuK3mib7liLDvvIznhLblkI7kvp3mrKHmiafooYxcclxuICAgIHRhc2tBcnJheSA9IHRhc2tBcnJheS5zcGxpdCgnLCcpO1xyXG4gICAgLy8g6L+Z6YeM6ZyA6KaB6aqM6K+B5ou/5YiwIGNvbW1hbmRTZXJ2aWNlIFxyXG4gICAgbGV0IGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0O1xyXG4gICAgdHJ5IHtcclxuICAgICAgZnJhbWVDb250ZXh0ID0gdGhpc1snY29udGV4dCddLmZyYW1lQ29udGV4dFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW4gbm90IGZpbmQgZnJhbWVDb250ZXgnKTtcclxuICAgIH1cclxuICAgIHRhc2tBcnJheS5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIGxldCB0YXJnZXRUYXNrO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHRhcmdldFRhc2sgPSBmcmFtZUNvbnRleHQudmlld01vZGVsW2l0ZW1dO1xyXG4gICAgICAgIHRoaXMudGFza1NjaGR1bGUucHJvcFRhc2sodGFyZ2V0VGFzaywgW10sIHRoaXMsIGl0ZW0pLnN1YnNjcmliZSgocmVzKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIC8vIOacquaJvuWIsOW6lOivpeWcqGNoaWxkcmVu5Lit57un57ut5p+l5om+IOacquaJvuWIsFxyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
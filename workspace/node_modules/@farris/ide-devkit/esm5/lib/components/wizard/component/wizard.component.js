/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, ViewContainerRef, ComponentFactoryResolver, Output, EventEmitter } from '@angular/core';
import { find, findIndex, merge } from 'lodash-es';
var WizardComponent = /** @class */ (function () {
    function WizardComponent(viewContainerRef, componentFactoryResolver) {
        this.viewContainerRef = viewContainerRef;
        this.componentFactoryResolver = componentFactoryResolver;
        this.clickCancelBtn = new EventEmitter();
        this.clickFinishBtn = new EventEmitter();
        this.title = '';
        this.steps = [];
        this.curStepIndex = 0;
    }
    /**
     * @return {?}
     */
    WizardComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.steps && this.steps.length > 0) {
            this.curStep = this.steps[this.curStepIndex];
            this.createStepComponent(this.steps[this.curStepIndex]);
        }
    };
    /**
     * @param {?} step
     * @return {?}
     */
    WizardComponent.prototype.createStepComponent = /**
     * @param {?} step
     * @return {?}
     */
    function (step) {
        var _this = this;
        this.stepContainer.clear();
        /** @type {?} */
        var componentFactory = this.componentFactoryResolver.resolveComponentFactory(step.component);
        this.curComponentRef = this.stepContainer.createComponent(componentFactory);
        this.curComponentRef.instance.data = step.data;
        // 新增步骤
        if (this.curComponentRef.instance.addStep) {
            this.curComponentRef.instance.addStep.subscribe(function (stepList) {
                var _a;
                /** @type {?} */
                var curIndex = findIndex(_this.steps, _this.curStep);
                (_a = _this.steps).splice.apply(_a, tslib_1.__spread([curIndex + 1, 0], stepList));
                _this.curStep.nextStep = stepList[0].stepId;
                _this.curStep.showFinishBtn = false;
                _this.curStep.showNextStepBtn = true;
            });
        }
        // 删除步骤
        if (this.curComponentRef.instance.removeStep) {
            this.curComponentRef.instance.removeStep.subscribe(function (data) {
                merge(_this.curStep, data.curStep);
                data.removeSteps.forEach(function (removeStep) {
                    /** @type {?} */
                    var index = findIndex(_this.steps, removeStep);
                    _this.steps.splice(index, 1);
                });
            });
        }
        // 变更步骤
        if (this.curComponentRef.instance.changeStep) {
            this.curComponentRef.instance.changeStep.subscribe(function (stepList) {
                stepList.forEach(function (changeStep) {
                    /** @type {?} */
                    var oldStep = find(_this.steps, function (s) { return s.stepId === changeStep.stepId; });
                    merge(oldStep, changeStep);
                });
            });
        }
    };
    /**
     * @param {?} nextStep
     * @return {?}
     */
    WizardComponent.prototype.jumpStep = /**
     * @param {?} nextStep
     * @return {?}
     */
    function (nextStep) {
        // 判断跳转方向
        if (nextStep === this.curStep) {
            return;
        }
        /** @type {?} */
        var nextIndex = findIndex(this.steps, function (s) { return s.stepId === nextStep.stepId; });
        if (nextIndex === this.curStepIndex) {
            return;
        }
        if (nextIndex < this.curStepIndex) { // 向前跳
            this.curStep = nextStep;
            this.curStepIndex = nextIndex;
            this.createStepComponent(nextStep);
            return;
        }
        if (nextStep.stepId === this.curStep.nextStep) { // 下一步
            this.nextStep();
            return;
        }
        //  else if (this.finishedSteps.indexOf(nextStep.stepId) > -1) { // 已完成的后续步骤
        //   this.curStep = nextStep;
        //   this.curStepIndex = nextIndex;
        //   this.createStepComponent(nextStep);
        // }
    };
    /**
      * 点击上一步
      */
    /**
     * 点击上一步
     * @return {?}
     */
    WizardComponent.prototype.lastStep = /**
     * 点击上一步
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        this.curStepIndex = findIndex(this.steps, function (s) { return s.nextStep === self.curStep.stepId; });
        this.curStep = this.steps[this.curStepIndex];
        this.createStepComponent(this.curStep);
    };
    /**
     * 点击下一步
     */
    /**
     * 点击下一步
     * @return {?}
     */
    WizardComponent.prototype.nextStep = /**
     * 点击下一步
     * @return {?}
     */
    function () {
        var _this = this;
        // 校验
        /** @type {?} */
        var validationFunc = this.curComponentRef.instance.validation;
        if (validationFunc && typeof (validationFunc) === 'function') {
            /** @type {?} */
            var result = validationFunc();
            if (!result) {
                return;
            }
        }
        // 执行各Component定义的nextStepClick事件
        /** @type {?} */
        var clickNextStep = this.curComponentRef.instance.clickNextStep;
        if (clickNextStep && typeof (clickNextStep) === 'function') {
            /** @type {?} */
            var result = clickNextStep();
            if (typeof (result) === 'boolean') {
                this.moveToNextStep(result);
            }
            else {
                result.subscribe(function (data) {
                    _this.moveToNextStep(data);
                });
            }
        }
        else {
            this.moveToNextStep(true);
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    WizardComponent.prototype.moveToNextStep = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (!data) {
            return;
        }
        /** @type {?} */
        var curStep = this.curStep;
        if (curStep.nextStep === '') {
            return;
        }
        // this.finishedSteps.push(curStep.stepId);
        this.curStepIndex = findIndex(this.steps, function (s) { return s.stepId === curStep.nextStep; });
        if (this.curStepIndex > -1) {
            this.curStep = this.steps[this.curStepIndex];
            this.createStepComponent(this.curStep);
        }
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @return {?}
     */
    WizardComponent.prototype.clickCancel = /**
     * 取消
     * @return {?}
     */
    function () {
        this.clickCancelBtn.emit();
    };
    /**
     * 完成
     */
    /**
     * 完成
     * @return {?}
     */
    WizardComponent.prototype.finishWizard = /**
     * 完成
     * @return {?}
     */
    function () {
        /** @type {?} */
        var validationFunc = this.curComponentRef.instance.validation;
        if (validationFunc && typeof (validationFunc) === 'function') {
            /** @type {?} */
            var result = validationFunc();
            if (!result) {
                return;
            }
        }
        /** @type {?} */
        var beforeFinish = this.curComponentRef.instance.beforeFinish;
        if (beforeFinish && typeof (beforeFinish) === 'function') {
            /** @type {?} */
            var result = beforeFinish();
            if (!result) {
                return;
            }
        }
        this.clickFinishBtn.emit();
    };
    WizardComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-wizard',
                    template: "<div class=\"stepWizard\">\r\n  <div class=\"createNav d-flex flex-wrap\" *ngIf=\"steps.length>1\">\r\n    <div *ngFor=\"let step of steps\" class=\"d-flex step\" [class.active]=\"curStep.stepId===step.stepId\">\r\n      <div class=\"d-flex\" *ngIf=\"step.show\" (click)=\"jumpStep(step)\">\r\n        <div class=\"stepTitle\">{{step.title}}</div>\r\n        <div class=\"triangle_border_right\">\r\n          <span></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"content\">\r\n    <perfect-scrollbar [config]=\"{suppressScrollX: true}\">\r\n      <ng-container #stepContainer></ng-container>\r\n    </perfect-scrollbar>\r\n  </div>\r\n\r\n\r\n\r\n  <div class=\"footBtns\">\r\n    <button type=\"button\" class=\"btn btn-outline-secondary btn-sm px-3 mx-2\" *ngIf=\"curStep.showCancelBtn\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary btn-sm px-3 mx-2\" *ngIf=\"curStep.showLastStepBtn\" (click)=\"lastStep()\"\r\n      type=\"submit\">\u4E0A\u4E00\u6B65</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary btn-sm px-3 mx-2\" *ngIf=\"curStep.showNextStepBtn\" (click)=\"nextStep()\"\r\n      type=\"submit\">\u4E0B\u4E00\u6B65</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary btn-sm px-3 mx-2\" *ngIf=\"curStep.showFinishBtn\" (click)=\"finishWizard()\">\u5B8C\u6210</button>\r\n  </div>\r\n</div>",
                    styles: [":host{position:absolute;top:0;bottom:0;left:0;right:0}.stepWizard{height:100%;display:flex;flex-direction:column}.stepWizard .createNav{background:#e8edf2;height:40px;overflow:hidden}.stepWizard .createNav .stepTitle{padding:0 10px;color:#666;line-height:40px;cursor:pointer;font-size:.875rem}.stepWizard .createNav .step.active .stepTitle{color:#fff;background-color:#346180!important}.stepWizard .createNav .step:not(:first-child).active .stepTitle{margin-left:-17px;padding-left:25px}.stepWizard .createNav .stepTitle.disable{color:#cdcdcf}.stepWizard .createNav .step .triangle_border_right{width:0;height:0;border-width:20px 0 20px 18px;border-style:solid;border-color:transparent transparent transparent #ccc;position:relative}.stepWizard .createNav .step .triangle_border_right span{display:block;width:0;height:0;border-width:20px 0 20px 18px;border-style:solid;border-color:transparent transparent transparent #e8edf2;position:absolute;top:-20px;left:-20px}.stepWizard .createNav .step.active .triangle_border_right{width:0;height:0;border-width:20px 0 20px 20px;border-color:transparent transparent transparent #e8edf2}.stepWizard .createNav .step.active .triangle_border_right span{border-width:20px 0 20px 20px;border-color:transparent transparent transparent #346180!important}.stepWizard .content{flex:1;overflow:auto;font-size:.875rem}.stepWizard .content .ps-content{width:inherit;height:inherit}.stepWizard .footBtns{width:100%;display:flex;align-items:center;justify-content:flex-end;padding:10px 1rem;background:#f4f4f4;border-top:1px solid #ddd}"]
                }] }
    ];
    /** @nocollapse */
    WizardComponent.ctorParameters = function () { return [
        { type: ViewContainerRef },
        { type: ComponentFactoryResolver }
    ]; };
    WizardComponent.propDecorators = {
        clickCancelBtn: [{ type: Output }],
        clickFinishBtn: [{ type: Output }],
        title: [{ type: Input }],
        steps: [{ type: Input }],
        stepContainer: [{ type: ViewChild, args: ['stepContainer', { read: ViewContainerRef },] }]
    };
    return WizardComponent;
}());
export { WizardComponent };
if (false) {
    /** @type {?} */
    WizardComponent.prototype.clickCancelBtn;
    /** @type {?} */
    WizardComponent.prototype.clickFinishBtn;
    /** @type {?} */
    WizardComponent.prototype.title;
    /** @type {?} */
    WizardComponent.prototype.steps;
    /** @type {?} */
    WizardComponent.prototype.curStep;
    /** @type {?} */
    WizardComponent.prototype.curStepIndex;
    /** @type {?} */
    WizardComponent.prototype.curComponentRef;
    /** @type {?} */
    WizardComponent.prototype.stepContainer;
    /**
     * @type {?}
     * @private
     */
    WizardComponent.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    WizardComponent.prototype.componentFactoryResolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3dpemFyZC9jb21wb25lbnQvd2l6YXJkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBZ0IsZ0JBQWdCLEVBQUUsd0JBQXdCLEVBQzdGLE1BQU0sRUFBRSxZQUFZLEVBQ3JCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVuRDtJQWlCRSx5QkFBb0IsZ0JBQWtDLEVBQzVDLHdCQUFrRDtRQUR4QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQzVDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFabEQsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3pDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUUxQyxVQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsVUFBSyxHQUFHLEVBQUUsQ0FBQztRQUVwQixpQkFBWSxHQUFHLENBQUMsQ0FBQztJQU0rQyxDQUFDOzs7O0lBRWpFLGtDQUFROzs7SUFBUjtRQUNFLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM3QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUN6RDtJQUNILENBQUM7Ozs7O0lBQ0QsNkNBQW1COzs7O0lBQW5CLFVBQW9CLElBQUk7UUFBeEIsaUJBdUNDO1FBdENDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7O1lBQ3JCLGdCQUFnQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQzlGLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM1RSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUUvQyxPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUU7WUFDekMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFDLFFBQVE7OztvQkFFakQsUUFBUSxHQUFHLFNBQVMsQ0FBQyxLQUFJLENBQUMsS0FBSyxFQUFFLEtBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ3BELENBQUEsS0FBQSxLQUFJLENBQUMsS0FBSyxDQUFBLENBQUMsTUFBTSw2QkFBQyxRQUFRLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBSyxRQUFRLEdBQUU7Z0JBRWhELEtBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7Z0JBQzNDLEtBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztnQkFDbkMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1lBRXRDLENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUU7WUFDNUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFDLElBQUk7Z0JBQ3RELEtBQUssQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsVUFBQSxVQUFVOzt3QkFDM0IsS0FBSyxHQUFHLFNBQVMsQ0FBQyxLQUFJLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQztvQkFDL0MsS0FBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUU7WUFDNUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFDLFFBQVE7Z0JBQzFELFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBQSxVQUFVOzt3QkFDbkIsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFJLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN6RixLQUFLLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUM3QixDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1NBQ0o7SUFFSCxDQUFDOzs7OztJQUNELGtDQUFROzs7O0lBQVIsVUFBUyxRQUFRO1FBQ2YsU0FBUztRQUNULElBQUksUUFBUSxLQUFLLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDN0IsT0FBTztTQUNSOztZQUNLLFNBQVMsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQyxNQUFNLEtBQUssUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RixJQUFJLFNBQVMsS0FBSyxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ25DLE9BQU87U0FDUjtRQUNELElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsRUFBRSxNQUFNO1lBQ3pDLElBQUksQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDO1lBQzlCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuQyxPQUFPO1NBQ1I7UUFDRCxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxNQUFNO1lBQ3JELElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNoQixPQUFPO1NBQ1I7UUFDRCw0RUFBNEU7UUFDNUUsNkJBQTZCO1FBQzdCLG1DQUFtQztRQUNuQyx3Q0FBd0M7UUFDeEMsSUFBSTtJQUVOLENBQUM7SUFDRDs7UUFFSTs7Ozs7SUFDSixrQ0FBUTs7OztJQUFSOztZQUNRLElBQUksR0FBRyxJQUFJO1FBQ2pCLElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSCxrQ0FBUTs7OztJQUFSO1FBQUEsaUJBcUJDOzs7WUFuQk8sY0FBYyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLFVBQVU7UUFDL0QsSUFBSSxjQUFjLElBQUksT0FBTyxDQUFDLGNBQWMsQ0FBQyxLQUFLLFVBQVUsRUFBRTs7Z0JBQ3RELE1BQU0sR0FBRyxjQUFjLEVBQUU7WUFDL0IsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFBRSxPQUFPO2FBQUU7U0FDekI7OztZQUVLLGFBQWEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxhQUFhO1FBQ2pFLElBQUksYUFBYSxJQUFJLE9BQU8sQ0FBQyxhQUFhLENBQUMsS0FBSyxVQUFVLEVBQUU7O2dCQUNwRCxNQUFNLEdBQUcsYUFBYSxFQUFFO1lBQzlCLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLFNBQVMsRUFBRTtnQkFDakMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUM3QjtpQkFBTTtnQkFDTCxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQUEsSUFBSTtvQkFDbkIsS0FBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDNUIsQ0FBQyxDQUFDLENBQUM7YUFDSjtTQUNGO2FBQU07WUFDTCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzNCO0lBQ0gsQ0FBQzs7Ozs7SUFFRCx3Q0FBYzs7OztJQUFkLFVBQWUsSUFBSTtRQUNqQixJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1QsT0FBTztTQUNSOztZQUNLLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTztRQUM1QixJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssRUFBRSxFQUFFO1lBQzNCLE9BQU87U0FDUjtRQUNELDJDQUEyQztRQUMzQyxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE1BQU0sS0FBSyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEcsSUFBSSxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQzFCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN4QztJQUVILENBQUM7SUFDRDs7T0FFRzs7Ozs7SUFDSCxxQ0FBVzs7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBQ0Q7O09BRUc7Ozs7O0lBQ0gsc0NBQVk7Ozs7SUFBWjs7WUFDUSxjQUFjLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsVUFBVTtRQUMvRCxJQUFJLGNBQWMsSUFBSSxPQUFPLENBQUMsY0FBYyxDQUFDLEtBQUssVUFBVSxFQUFFOztnQkFDdEQsTUFBTSxHQUFHLGNBQWMsRUFBRTtZQUMvQixJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUFFLE9BQU87YUFBRTtTQUN6Qjs7WUFFSyxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsWUFBWTtRQUMvRCxJQUFJLFlBQVksSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLEtBQUssVUFBVSxFQUFFOztnQkFDbEQsTUFBTSxHQUFHLFlBQVksRUFBRTtZQUM3QixJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUFFLE9BQU87YUFBRTtTQUN6QjtRQUNELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDN0IsQ0FBQzs7Z0JBdEtGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsWUFBWTtvQkFDdEIscTdDQUFzQzs7aUJBRXZDOzs7O2dCQVRvRCxnQkFBZ0I7Z0JBQUUsd0JBQXdCOzs7aUNBVzVGLE1BQU07aUNBQ04sTUFBTTt3QkFFTixLQUFLO3dCQUNMLEtBQUs7Z0NBS0wsU0FBUyxTQUFDLGVBQWUsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRTs7SUF3SnhELHNCQUFDO0NBQUEsQUF2S0QsSUF1S0M7U0FsS1ksZUFBZTs7O0lBQzFCLHlDQUFtRDs7SUFDbkQseUNBQW1EOztJQUVuRCxnQ0FBb0I7O0lBQ3BCLGdDQUFvQjs7SUFDcEIsa0NBQVE7O0lBQ1IsdUNBQWlCOztJQUNqQiwwQ0FBbUM7O0lBRW5DLHdDQUF3Rjs7Ozs7SUFFNUUsMkNBQTBDOzs7OztJQUNwRCxtREFBMEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgVmlld0NoaWxkLCBDb21wb25lbnRSZWYsIFZpZXdDb250YWluZXJSZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICBPdXRwdXQsIEV2ZW50RW1pdHRlclxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBmaW5kLCBmaW5kSW5kZXgsIG1lcmdlIH0gZnJvbSAnbG9kYXNoLWVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXBwLXdpemFyZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3dpemFyZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vd2l6YXJkLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgV2l6YXJkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBAT3V0cHV0KCkgY2xpY2tDYW5jZWxCdG4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgY2xpY2tGaW5pc2hCdG4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgQElucHV0KCkgdGl0bGUgPSAnJztcclxuICBASW5wdXQoKSBzdGVwcyA9IFtdO1xyXG4gIGN1clN0ZXA7XHJcbiAgY3VyU3RlcEluZGV4ID0gMDtcclxuICBjdXJDb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxhbnk+O1xyXG4gIC8vIGZpbmlzaGVkU3RlcHMgPSBbXTtcclxuICBAVmlld0NoaWxkKCdzdGVwQ29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIHN0ZXBDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZixcclxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGlmICh0aGlzLnN0ZXBzICYmIHRoaXMuc3RlcHMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmN1clN0ZXAgPSB0aGlzLnN0ZXBzW3RoaXMuY3VyU3RlcEluZGV4XTtcclxuICAgICAgdGhpcy5jcmVhdGVTdGVwQ29tcG9uZW50KHRoaXMuc3RlcHNbdGhpcy5jdXJTdGVwSW5kZXhdKTtcclxuICAgIH1cclxuICB9XHJcbiAgY3JlYXRlU3RlcENvbXBvbmVudChzdGVwKSB7XHJcbiAgICB0aGlzLnN0ZXBDb250YWluZXIuY2xlYXIoKTtcclxuICAgIGNvbnN0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShzdGVwLmNvbXBvbmVudCk7XHJcbiAgICB0aGlzLmN1ckNvbXBvbmVudFJlZiA9IHRoaXMuc3RlcENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XHJcbiAgICB0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS5kYXRhID0gc3RlcC5kYXRhO1xyXG5cclxuICAgIC8vIOaWsOWinuatpemqpFxyXG4gICAgaWYgKHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLmFkZFN0ZXApIHtcclxuICAgICAgdGhpcy5jdXJDb21wb25lbnRSZWYuaW5zdGFuY2UuYWRkU3RlcC5zdWJzY3JpYmUoKHN0ZXBMaXN0KSA9PiB7XHJcblxyXG4gICAgICAgIGNvbnN0IGN1ckluZGV4ID0gZmluZEluZGV4KHRoaXMuc3RlcHMsIHRoaXMuY3VyU3RlcCk7XHJcbiAgICAgICAgdGhpcy5zdGVwcy5zcGxpY2UoY3VySW5kZXggKyAxLCAwLCAuLi5zdGVwTGlzdCk7XHJcblxyXG4gICAgICAgIHRoaXMuY3VyU3RlcC5uZXh0U3RlcCA9IHN0ZXBMaXN0WzBdLnN0ZXBJZDtcclxuICAgICAgICB0aGlzLmN1clN0ZXAuc2hvd0ZpbmlzaEJ0biA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY3VyU3RlcC5zaG93TmV4dFN0ZXBCdG4gPSB0cnVlO1xyXG5cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyDliKDpmaTmraXpqqRcclxuICAgIGlmICh0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS5yZW1vdmVTdGVwKSB7XHJcbiAgICAgIHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLnJlbW92ZVN0ZXAuc3Vic2NyaWJlKChkYXRhKSA9PiB7XHJcbiAgICAgICAgbWVyZ2UodGhpcy5jdXJTdGVwLCBkYXRhLmN1clN0ZXApO1xyXG4gICAgICAgIGRhdGEucmVtb3ZlU3RlcHMuZm9yRWFjaChyZW1vdmVTdGVwID0+IHtcclxuICAgICAgICAgIGNvbnN0IGluZGV4ID0gZmluZEluZGV4KHRoaXMuc3RlcHMsIHJlbW92ZVN0ZXApO1xyXG4gICAgICAgICAgdGhpcy5zdGVwcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIC8vIOWPmOabtOatpemqpFxyXG4gICAgaWYgKHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLmNoYW5nZVN0ZXApIHtcclxuICAgICAgdGhpcy5jdXJDb21wb25lbnRSZWYuaW5zdGFuY2UuY2hhbmdlU3RlcC5zdWJzY3JpYmUoKHN0ZXBMaXN0KSA9PiB7XHJcbiAgICAgICAgc3RlcExpc3QuZm9yRWFjaChjaGFuZ2VTdGVwID0+IHtcclxuICAgICAgICAgIGNvbnN0IG9sZFN0ZXAgPSBmaW5kKHRoaXMuc3RlcHMsIGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLnN0ZXBJZCA9PT0gY2hhbmdlU3RlcC5zdGVwSWQ7IH0pO1xyXG4gICAgICAgICAgbWVyZ2Uob2xkU3RlcCwgY2hhbmdlU3RlcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAganVtcFN0ZXAobmV4dFN0ZXApIHtcclxuICAgIC8vIOWIpOaWrei3s+i9rOaWueWQkVxyXG4gICAgaWYgKG5leHRTdGVwID09PSB0aGlzLmN1clN0ZXApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbmV4dEluZGV4ID0gZmluZEluZGV4KHRoaXMuc3RlcHMsIGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLnN0ZXBJZCA9PT0gbmV4dFN0ZXAuc3RlcElkOyB9KTtcclxuICAgIGlmIChuZXh0SW5kZXggPT09IHRoaXMuY3VyU3RlcEluZGV4KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChuZXh0SW5kZXggPCB0aGlzLmN1clN0ZXBJbmRleCkgeyAvLyDlkJHliY3ot7NcclxuICAgICAgdGhpcy5jdXJTdGVwID0gbmV4dFN0ZXA7XHJcbiAgICAgIHRoaXMuY3VyU3RlcEluZGV4ID0gbmV4dEluZGV4O1xyXG4gICAgICB0aGlzLmNyZWF0ZVN0ZXBDb21wb25lbnQobmV4dFN0ZXApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAobmV4dFN0ZXAuc3RlcElkID09PSB0aGlzLmN1clN0ZXAubmV4dFN0ZXApIHsgLy8g5LiL5LiA5q2lXHJcbiAgICAgIHRoaXMubmV4dFN0ZXAoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gIGVsc2UgaWYgKHRoaXMuZmluaXNoZWRTdGVwcy5pbmRleE9mKG5leHRTdGVwLnN0ZXBJZCkgPiAtMSkgeyAvLyDlt7LlrozmiJDnmoTlkI7nu63mraXpqqRcclxuICAgIC8vICAgdGhpcy5jdXJTdGVwID0gbmV4dFN0ZXA7XHJcbiAgICAvLyAgIHRoaXMuY3VyU3RlcEluZGV4ID0gbmV4dEluZGV4O1xyXG4gICAgLy8gICB0aGlzLmNyZWF0ZVN0ZXBDb21wb25lbnQobmV4dFN0ZXApO1xyXG4gICAgLy8gfVxyXG5cclxuICB9XHJcbiAgLyoqXHJcbiAgICAqIOeCueWHu+S4iuS4gOatpVxyXG4gICAgKi9cclxuICBsYXN0U3RlcCgpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgdGhpcy5jdXJTdGVwSW5kZXggPSBmaW5kSW5kZXgodGhpcy5zdGVwcywgZnVuY3Rpb24gKHMpIHsgcmV0dXJuIHMubmV4dFN0ZXAgPT09IHNlbGYuY3VyU3RlcC5zdGVwSWQ7IH0pO1xyXG4gICAgdGhpcy5jdXJTdGVwID0gdGhpcy5zdGVwc1t0aGlzLmN1clN0ZXBJbmRleF07XHJcbiAgICB0aGlzLmNyZWF0ZVN0ZXBDb21wb25lbnQodGhpcy5jdXJTdGVwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOeCueWHu+S4i+S4gOatpVxyXG4gICAqL1xyXG4gIG5leHRTdGVwKCkge1xyXG4gICAgLy8g5qCh6aqMXHJcbiAgICBjb25zdCB2YWxpZGF0aW9uRnVuYyA9IHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLnZhbGlkYXRpb247XHJcbiAgICBpZiAodmFsaWRhdGlvbkZ1bmMgJiYgdHlwZW9mICh2YWxpZGF0aW9uRnVuYykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGlvbkZ1bmMoKTtcclxuICAgICAgaWYgKCFyZXN1bHQpIHsgcmV0dXJuOyB9XHJcbiAgICB9XHJcbiAgICAvLyDmiafooYzlkIRDb21wb25lbnTlrprkuYnnmoRuZXh0U3RlcENsaWNr5LqL5Lu2XHJcbiAgICBjb25zdCBjbGlja05leHRTdGVwID0gdGhpcy5jdXJDb21wb25lbnRSZWYuaW5zdGFuY2UuY2xpY2tOZXh0U3RlcDtcclxuICAgIGlmIChjbGlja05leHRTdGVwICYmIHR5cGVvZiAoY2xpY2tOZXh0U3RlcCkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gY2xpY2tOZXh0U3RlcCgpOyAvLyDov5Tlm57lgLzmjqXmlLZib29sZWFu5oiWb2JzZXJ2YWJsZeexu+Wei1xyXG4gICAgICBpZiAodHlwZW9mIChyZXN1bHQpID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICB0aGlzLm1vdmVUb05leHRTdGVwKHJlc3VsdCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0LnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgIHRoaXMubW92ZVRvTmV4dFN0ZXAoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubW92ZVRvTmV4dFN0ZXAodHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlVG9OZXh0U3RlcChkYXRhKSB7XHJcbiAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY3VyU3RlcCA9IHRoaXMuY3VyU3RlcDtcclxuICAgIGlmIChjdXJTdGVwLm5leHRTdGVwID09PSAnJykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyB0aGlzLmZpbmlzaGVkU3RlcHMucHVzaChjdXJTdGVwLnN0ZXBJZCk7XHJcbiAgICB0aGlzLmN1clN0ZXBJbmRleCA9IGZpbmRJbmRleCh0aGlzLnN0ZXBzLCBmdW5jdGlvbiAocykgeyByZXR1cm4gcy5zdGVwSWQgPT09IGN1clN0ZXAubmV4dFN0ZXA7IH0pO1xyXG4gICAgaWYgKHRoaXMuY3VyU3RlcEluZGV4ID4gLTEpIHtcclxuICAgICAgdGhpcy5jdXJTdGVwID0gdGhpcy5zdGVwc1t0aGlzLmN1clN0ZXBJbmRleF07XHJcbiAgICAgIHRoaXMuY3JlYXRlU3RlcENvbXBvbmVudCh0aGlzLmN1clN0ZXApO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+W5raIXHJcbiAgICovXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsaWNrQ2FuY2VsQnRuLmVtaXQoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5a6M5oiQXHJcbiAgICovXHJcbiAgZmluaXNoV2l6YXJkKCkge1xyXG4gICAgY29uc3QgdmFsaWRhdGlvbkZ1bmMgPSB0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS52YWxpZGF0aW9uO1xyXG4gICAgaWYgKHZhbGlkYXRpb25GdW5jICYmIHR5cGVvZiAodmFsaWRhdGlvbkZ1bmMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRpb25GdW5jKCk7XHJcbiAgICAgIGlmICghcmVzdWx0KSB7IHJldHVybjsgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGJlZm9yZUZpbmlzaCA9IHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLmJlZm9yZUZpbmlzaDtcclxuICAgIGlmIChiZWZvcmVGaW5pc2ggJiYgdHlwZW9mIChiZWZvcmVGaW5pc2gpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGJlZm9yZUZpbmlzaCgpO1xyXG4gICAgICBpZiAoIXJlc3VsdCkgeyByZXR1cm47IH1cclxuICAgIH1cclxuICAgIHRoaXMuY2xpY2tGaW5pc2hCdG4uZW1pdCgpO1xyXG4gIH1cclxufVxyXG4iXX0=
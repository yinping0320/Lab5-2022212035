/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Injectable } from '@angular/core';
var NavbarState = /** @class */ (function () {
    function NavbarState() {
        this.dropdownInstances = [];
        this.menuItems = [];
        this.subscriptions = [];
        // 当前下拉菜单的子菜单
        this.onItemClick = new EventEmitter();
    }
    /**
     * @param {?} dropdown
     * @return {?}
     */
    NavbarState.prototype.addDropdown = /**
     * @param {?} dropdown
     * @return {?}
     */
    function (dropdown) {
        var _this = this;
        if (!this.dropdownInstances.find(function (item) { return item === dropdown; })) {
            this.dropdownInstances.push(dropdown);
            this.subscribeDropdown(dropdown);
            dropdown.onShown.subscribe(function () { return setTimeout(function () {
                dropdown.childDropdowns.forEach(function (item) { return _this.addDropdown(item); });
            }); });
        }
    };
    /**
     * @param {?} menuItem
     * @return {?}
     */
    NavbarState.prototype.addMenuItem = /**
     * @param {?} menuItem
     * @return {?}
     */
    function (menuItem) {
        if (!this.menuItems.find(function (item) { return item === menuItem; })) {
            this.menuItems.push(menuItem);
            this.subscribeMenuItem(menuItem);
        }
    };
    /**
     * @private
     * @param {?} dropdown
     * @return {?}
     */
    NavbarState.prototype.subscribeDropdown = /**
     * @private
     * @param {?} dropdown
     * @return {?}
     */
    function (dropdown) {
        // 在下拉菜单显示、隐藏时，记录下显示状态。
        // this.subscriptions.push(
        //   dropdown.onShown.subscribe((value) => {
        //     debugger;
        //     if(dropdown.isSubMenu) {
        //
        //     }
        //   })
        // );
        //
        // this.subscriptions.push(
        //   dropdown.onHidden.subscribe((value) => {
        //
        //   })
        // );
        var _this = this;
        this.subscriptions.push(dropdown.state.onClick.subscribe(function (event) {
            if (dropdown.level === 1) {
                if (dropdown.isOpen && _this.level1Dropdown === dropdown) {
                    _this.innerHideL1Dropdown();
                }
                else {
                    _this.innerShowL1Dropdown(dropdown);
                }
            }
            else if (dropdown.level === 2) {
                if (!dropdown.isOpen || _this.level2Dropdown !== dropdown) {
                    _this.innerShowL2Dropdown(dropdown);
                }
            }
            event.stopPropagation();
        }));
        this.subscriptions.push(dropdown.state.onHover.subscribe(function () {
            if (!_this.level1Dropdown) {
                // 菜单没展开，鼠标悬停没有效果
                return;
            }
            _this.show(dropdown);
        }));
    };
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    NavbarState.prototype.subscribeMenuItem = /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    function (menuItem) {
        var _this = this;
        this.subscriptions.push(menuItem.onHover.subscribe(function () {
            if (!_this.level1Dropdown) {
                return;
            }
            if (_this.level1Dropdown.containsItem(menuItem)) {
                _this.innerHideL2Dropdown();
            }
        }));
        this.subscriptions.push(menuItem.onClick.subscribe(function (command) {
            _this.onItemClick.emit(command);
        }));
    };
    /**
     * @return {?}
     */
    NavbarState.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.subscriptions.forEach(function (sub) {
            sub.unsubscribe();
        });
    };
    /**
     * @return {?}
     */
    NavbarState.prototype.hideCurrentDropdown = /**
     * @return {?}
     */
    function () {
        if (this.level2Dropdown) {
            this.innerHideL2Dropdown();
        }
        else {
            this.innerHideL1Dropdown();
        }
    };
    /**
     * @return {?}
     */
    NavbarState.prototype.hideAllDropdown = /**
     * @return {?}
     */
    function () {
        this.innerHideL2Dropdown();
        this.innerHideL1Dropdown();
    };
    /**
     * @param {?} dropdown
     * @return {?}
     */
    NavbarState.prototype.show = /**
     * @param {?} dropdown
     * @return {?}
     */
    function (dropdown) {
        if (dropdown.level === 1) {
            if (dropdown !== this.level1Dropdown) {
                this.innerShowL1Dropdown(dropdown);
            }
            this.innerHideL2Dropdown();
        }
        else if (dropdown.level === 2) {
            if (dropdown !== this.level2Dropdown) {
                this.innerShowL2Dropdown(dropdown);
            }
        }
        ///////////////////////////////
        /*if (this.isMenuShown && this.isSubMenuShown && this.parentDropdown && this.parentDropdown.containsItem(dropdown)) {
          // 要显示的是子菜单，不是当前子菜单
          if (this.currentDropdown && this.currentDropdown !== dropdown) {
            this.currentDropdown.hide();
          }
          dropdown.show();
          this.currentDropdown = dropdown;
          this.isSubMenuShown = true;
        } else if (this.isMenuShown && !this.isSubMenuShown && this.currentDropdown && this.currentDropdown.containsItem(dropdown)) {
    
        } else {
          // 主菜单
          if (this.isSubMenuShown && this.currentDropdown && this.parentDropdown) {
            this.currentDropdown.hide();
            this.currentDropdown = null;
            this.isSubMenuShown = false;
          }
          if (this.isMenuShown && this.currentDropdown && this.currentDropdown !== dropdown) {
            this.currentDropdown.hide();
          }
          dropdown.show();
          this.currentDropdown = dropdown;
          this.isMenuShown = true;
        }*/
    };
    /**
     * @param {?} dropdown
     * @return {?}
     */
    NavbarState.prototype.hide = /**
     * @param {?} dropdown
     * @return {?}
     */
    function (dropdown) {
        // if
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    NavbarState.prototype.innerShowL1Dropdown = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        if (this.level1Dropdown) {
            this.level1Dropdown.hide();
        }
        target.show();
        this.level1Dropdown = target;
    };
    /**
     * @private
     * @return {?}
     */
    NavbarState.prototype.innerHideL1Dropdown = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.level1Dropdown) {
            this.level1Dropdown.hide();
            this.level1Dropdown = null;
        }
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    NavbarState.prototype.innerShowL2Dropdown = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        if (this.level2Dropdown) {
            this.level2Dropdown.hide();
        }
        target.show();
        this.level2Dropdown = target;
    };
    /**
     * @private
     * @return {?}
     */
    NavbarState.prototype.innerHideL2Dropdown = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.level2Dropdown) {
            this.level2Dropdown.hide();
            this.level2Dropdown = null;
        }
    };
    NavbarState.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    NavbarState.ctorParameters = function () { return []; };
    return NavbarState;
}());
export { NavbarState };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.dropdownInstances;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.menuItems;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.level1Dropdown;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.level2Dropdown;
    /** @type {?} */
    NavbarState.prototype.onItemClick;
    /** @type {?} */
    NavbarState.prototype.autoClose;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2YmFyLnN0YXRlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9pZGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbmF2YmFyL25hdmJhci5zdGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFhLFlBQVksRUFBRSxVQUFVLEVBQVksTUFBTSxlQUFlLENBQUM7QUFNOUU7SUFhRTtRQVhRLHNCQUFpQixHQUEwQixFQUFFLENBQUM7UUFDOUMsY0FBUyxHQUE0QixFQUFFLENBQUM7UUFDeEMsa0JBQWEsR0FBbUIsRUFBRSxDQUFDOztRQUszQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7SUFNekMsQ0FBQzs7Ozs7SUFFRCxpQ0FBVzs7OztJQUFYLFVBQVksUUFBNkI7UUFBekMsaUJBUUM7UUFQQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLElBQUksS0FBSyxRQUFRLEVBQWpCLENBQWlCLENBQUMsRUFBRTtZQUM3RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNqQyxRQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxjQUFNLE9BQUEsVUFBVSxDQUFDO2dCQUMxQyxRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQXlCLElBQUssT0FBQSxLQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUF0QixDQUFzQixDQUFDLENBQUM7WUFDekYsQ0FBQyxDQUFDLEVBRitCLENBRS9CLENBQUMsQ0FBQztTQUNMO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxpQ0FBVzs7OztJQUFYLFVBQVksUUFBK0I7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQUMs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YyxHQUFHLElBQUksQ0FBQztTQUM1QjtJQUNILENBQUM7Ozs7OztJQUVPLHlDQUFtQjs7Ozs7SUFBM0IsVUFBNEIsTUFBMkI7UUFDckQsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7U0FDNUI7UUFDRCxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDZCxJQUFJLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQztJQUMvQixDQUFDOzs7OztJQUVPLHlDQUFtQjs7OztJQUEzQjtRQUNFLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN2QixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1NBQzVCO0lBQ0gsQ0FBQzs7Z0JBOUxGLFVBQVU7Ozs7SUErTFgsa0JBQUM7Q0FBQSxBQS9MRCxJQStMQztTQTlMWSxXQUFXOzs7Ozs7SUFDdEIsd0NBQXNEOzs7OztJQUN0RCxnQ0FBZ0Q7Ozs7O0lBQ2hELG9DQUEyQzs7Ozs7SUFFM0MscUNBQTRDOzs7OztJQUM1QyxxQ0FBNEM7O0lBRTVDLGtDQUF5Qzs7SUFFekMsZ0NBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIEluamVjdGFibGUsIE9uRGVzdHJveX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7QnNEcm9wZG93bkRpcmVjdGl2ZX0gZnJvbSAnLi4vZHJvcGRvd24vaW5kZXgnO1xyXG5pbXBvcnQge1N1YnNjcmlwdGlvbn0gZnJvbSAncnhqcy9TdWJzY3JpcHRpb24nO1xyXG5pbXBvcnQge0JzRHJvcGRvd25TdGF0ZX0gZnJvbSAnLi4vZHJvcGRvd24vZHJvcGRvd24uc3RhdGUnO1xyXG5pbXBvcnQge0Ryb3Bkb3duSXRlbURpcmVjdGl2ZX0gZnJvbSAnLi4vZHJvcGRvd24vZHJvcGRvd24taXRlbS5kaXJlY3RpdmUnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTmF2YmFyU3RhdGUgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgZHJvcGRvd25JbnN0YW5jZXM6IEJzRHJvcGRvd25EaXJlY3RpdmVbXSA9IFtdO1xyXG4gIHByaXZhdGUgbWVudUl0ZW1zOiBEcm9wZG93bkl0ZW1EaXJlY3RpdmVbXSA9IFtdO1xyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcclxuXHJcbiAgcHJpdmF0ZSBsZXZlbDFEcm9wZG93bjogQnNEcm9wZG93bkRpcmVjdGl2ZTsgLy8g5b2T5YmN5LiL5ouJ6I+c5Y2V55qE5Li76I+c5Y2V77yMXHJcbiAgcHJpdmF0ZSBsZXZlbDJEcm9wZG93bjogQnNEcm9wZG93bkRpcmVjdGl2ZTsgLy8g5b2T5YmN5LiL5ouJ6I+c5Y2V55qE5a2Q6I+c5Y2VXHJcblxyXG4gIG9uSXRlbUNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIGF1dG9DbG9zZTogYm9vbGVhbjtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gIH1cclxuXHJcbiAgYWRkRHJvcGRvd24oZHJvcGRvd246IEJzRHJvcGRvd25EaXJlY3RpdmUpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5kcm9wZG93bkluc3RhbmNlcy5maW5kKChpdGVtKSA9PiBpdGVtID09PSBkcm9wZG93bikpIHtcclxuICAgICAgdGhpcy5kcm9wZG93bkluc3RhbmNlcy5wdXNoKGRyb3Bkb3duKTtcclxuICAgICAgdGhpcy5zdWJzY3JpYmVEcm9wZG93bihkcm9wZG93bik7XHJcbiAgICAgIGRyb3Bkb3duLm9uU2hvd24uc3Vic2NyaWJlKCgpID0+IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGRyb3Bkb3duLmNoaWxkRHJvcGRvd25zLmZvckVhY2goKGl0ZW06IEJzRHJvcGRvd25EaXJlY3RpdmUpID0+IHRoaXMuYWRkRHJvcGRvd24oaXRlbSkpO1xyXG4gICAgICB9KSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhZGRNZW51SXRlbShtZW51SXRlbTogRHJvcGRvd25JdGVtRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMubWVudUl0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0gPT09IG1lbnVJdGVtKSkge1xyXG4gICAgICB0aGlzLm1lbnVJdGVtcy5wdXNoKG1lbnVJdGVtKTtcclxuICAgICAgdGhpcy5zdWJzY3JpYmVNZW51SXRlbShtZW51SXRlbSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN1YnNjcmliZURyb3Bkb3duKGRyb3Bkb3duOiBCc0Ryb3Bkb3duRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICAvLyDlnKjkuIvmi4noj5zljZXmmL7npLrjgIHpmpDol4/ml7bvvIzorrDlvZXkuIvmmL7npLrnirbmgIHjgIJcclxuICAgIC8vIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFxyXG4gICAgLy8gICBkcm9wZG93bi5vblNob3duLnN1YnNjcmliZSgodmFsdWUpID0+IHtcclxuICAgIC8vICAgICBkZWJ1Z2dlcjtcclxuICAgIC8vICAgICBpZihkcm9wZG93bi5pc1N1Yk1lbnUpIHtcclxuICAgIC8vXHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICB9KVxyXG4gICAgLy8gKTtcclxuICAgIC8vXHJcbiAgICAvLyB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcclxuICAgIC8vICAgZHJvcGRvd24ub25IaWRkZW4uc3Vic2NyaWJlKCh2YWx1ZSkgPT4ge1xyXG4gICAgLy9cclxuICAgIC8vICAgfSlcclxuICAgIC8vICk7XHJcblxyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAgIGRyb3Bkb3duLnN0YXRlLm9uQ2xpY2suc3Vic2NyaWJlKChldmVudDogRXZlbnQpID0+IHtcclxuICAgICAgICBpZiAoZHJvcGRvd24ubGV2ZWwgPT09IDEpIHtcclxuICAgICAgICAgIGlmIChkcm9wZG93bi5pc09wZW4gJiYgdGhpcy5sZXZlbDFEcm9wZG93biA9PT0gZHJvcGRvd24pIHtcclxuICAgICAgICAgICAgdGhpcy5pbm5lckhpZGVMMURyb3Bkb3duKCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmlubmVyU2hvd0wxRHJvcGRvd24oZHJvcGRvd24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoZHJvcGRvd24ubGV2ZWwgPT09IDIpIHtcclxuICAgICAgICAgIGlmICghZHJvcGRvd24uaXNPcGVuIHx8IHRoaXMubGV2ZWwyRHJvcGRvd24gIT09IGRyb3Bkb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5uZXJTaG93TDJEcm9wZG93bihkcm9wZG93bik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcclxuICAgICAgZHJvcGRvd24uc3RhdGUub25Ib3Zlci5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIGlmICghdGhpcy5sZXZlbDFEcm9wZG93bikge1xyXG4gICAgICAgICAgLy8g6I+c5Y2V5rKh5bGV5byA77yM6byg5qCH5oKs5YGc5rKh5pyJ5pWI5p6cXHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2hvdyhkcm9wZG93bik7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdWJzY3JpYmVNZW51SXRlbShtZW51SXRlbTogRHJvcGRvd25JdGVtRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcclxuICAgICAgbWVudUl0ZW0ub25Ib3Zlci5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIGlmICghdGhpcy5sZXZlbDFEcm9wZG93bikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sZXZlbDFEcm9wZG93bi5jb250YWluc0l0ZW0obWVudUl0ZW0pKSB7XHJcbiAgICAgICAgICB0aGlzLmlubmVySGlkZUwyRHJvcGRvd24oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFxyXG4gICAgICBtZW51SXRlbS5vbkNsaWNrLnN1YnNjcmliZSgoY29tbWFuZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgdGhpcy5vbkl0ZW1DbGljay5lbWl0KGNvbW1hbmQpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2goKHN1YikgPT4ge1xyXG4gICAgICBzdWIudW5zdWJzY3JpYmUoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGlkZUN1cnJlbnREcm9wZG93bigpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmxldmVsMkRyb3Bkb3duKSB7XHJcbiAgICAgIHRoaXMuaW5uZXJIaWRlTDJEcm9wZG93bigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pbm5lckhpZGVMMURyb3Bkb3duKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoaWRlQWxsRHJvcGRvd24oKTogdm9pZCB7XHJcbiAgICB0aGlzLmlubmVySGlkZUwyRHJvcGRvd24oKTtcclxuICAgIHRoaXMuaW5uZXJIaWRlTDFEcm9wZG93bigpO1xyXG4gIH1cclxuXHJcbiAgc2hvdyhkcm9wZG93bjogQnNEcm9wZG93bkRpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgaWYgKGRyb3Bkb3duLmxldmVsID09PSAxKSB7XHJcbiAgICAgIGlmIChkcm9wZG93biAhPT0gdGhpcy5sZXZlbDFEcm9wZG93bikge1xyXG4gICAgICAgIHRoaXMuaW5uZXJTaG93TDFEcm9wZG93bihkcm9wZG93bik7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5pbm5lckhpZGVMMkRyb3Bkb3duKCk7XHJcbiAgICB9IGVsc2UgaWYgKGRyb3Bkb3duLmxldmVsID09PSAyKSB7XHJcbiAgICAgIGlmIChkcm9wZG93biAhPT0gdGhpcy5sZXZlbDJEcm9wZG93bikge1xyXG4gICAgICAgIHRoaXMuaW5uZXJTaG93TDJEcm9wZG93bihkcm9wZG93bik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8qaWYgKHRoaXMuaXNNZW51U2hvd24gJiYgdGhpcy5pc1N1Yk1lbnVTaG93biAmJiB0aGlzLnBhcmVudERyb3Bkb3duICYmIHRoaXMucGFyZW50RHJvcGRvd24uY29udGFpbnNJdGVtKGRyb3Bkb3duKSkge1xyXG4gICAgICAvLyDopoHmmL7npLrnmoTmmK/lrZDoj5zljZXvvIzkuI3mmK/lvZPliY3lrZDoj5zljZVcclxuICAgICAgaWYgKHRoaXMuY3VycmVudERyb3Bkb3duICYmIHRoaXMuY3VycmVudERyb3Bkb3duICE9PSBkcm9wZG93bikge1xyXG4gICAgICAgIHRoaXMuY3VycmVudERyb3Bkb3duLmhpZGUoKTtcclxuICAgICAgfVxyXG4gICAgICBkcm9wZG93bi5zaG93KCk7XHJcbiAgICAgIHRoaXMuY3VycmVudERyb3Bkb3duID0gZHJvcGRvd247XHJcbiAgICAgIHRoaXMuaXNTdWJNZW51U2hvd24gPSB0cnVlO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmlzTWVudVNob3duICYmICF0aGlzLmlzU3ViTWVudVNob3duICYmIHRoaXMuY3VycmVudERyb3Bkb3duICYmIHRoaXMuY3VycmVudERyb3Bkb3duLmNvbnRhaW5zSXRlbShkcm9wZG93bikpIHtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDkuLvoj5zljZVcclxuICAgICAgaWYgKHRoaXMuaXNTdWJNZW51U2hvd24gJiYgdGhpcy5jdXJyZW50RHJvcGRvd24gJiYgdGhpcy5wYXJlbnREcm9wZG93bikge1xyXG4gICAgICAgIHRoaXMuY3VycmVudERyb3Bkb3duLmhpZGUoKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnREcm9wZG93biA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pc1N1Yk1lbnVTaG93biA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLmlzTWVudVNob3duICYmIHRoaXMuY3VycmVudERyb3Bkb3duICYmIHRoaXMuY3VycmVudERyb3Bkb3duICE9PSBkcm9wZG93bikge1xyXG4gICAgICAgIHRoaXMuY3VycmVudERyb3Bkb3duLmhpZGUoKTtcclxuICAgICAgfVxyXG4gICAgICBkcm9wZG93bi5zaG93KCk7XHJcbiAgICAgIHRoaXMuY3VycmVudERyb3Bkb3duID0gZHJvcGRvd247XHJcbiAgICAgIHRoaXMuaXNNZW51U2hvd24gPSB0cnVlO1xyXG4gICAgfSovXHJcbiAgfVxyXG5cclxuICBoaWRlKGRyb3Bkb3duOiBCc0Ryb3Bkb3duRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICAvLyBpZlxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbm5lclNob3dMMURyb3Bkb3duKHRhcmdldDogQnNEcm9wZG93bkRpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMubGV2ZWwxRHJvcGRvd24pIHtcclxuICAgICAgdGhpcy5sZXZlbDFEcm9wZG93bi5oaWRlKCk7XHJcbiAgICB9XHJcbiAgICB0YXJnZXQuc2hvdygpO1xyXG4gICAgdGhpcy5sZXZlbDFEcm9wZG93biA9IHRhcmdldDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5uZXJIaWRlTDFEcm9wZG93bigpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmxldmVsMURyb3Bkb3duKSB7XHJcbiAgICAgIHRoaXMubGV2ZWwxRHJvcGRvd24uaGlkZSgpO1xyXG4gICAgICB0aGlzLmxldmVsMURyb3Bkb3duID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5uZXJTaG93TDJEcm9wZG93bih0YXJnZXQ6IEJzRHJvcGRvd25EaXJlY3RpdmUpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmxldmVsMkRyb3Bkb3duKSB7XHJcbiAgICAgIHRoaXMubGV2ZWwyRHJvcGRvd24uaGlkZSgpO1xyXG4gICAgfVxyXG4gICAgdGFyZ2V0LnNob3coKTtcclxuICAgIHRoaXMubGV2ZWwyRHJvcGRvd24gPSB0YXJnZXQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlubmVySGlkZUwyRHJvcGRvd24oKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5sZXZlbDJEcm9wZG93bikge1xyXG4gICAgICB0aGlzLmxldmVsMkRyb3Bkb3duLmhpZGUoKTtcclxuICAgICAgdGhpcy5sZXZlbDJEcm9wZG93biA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { TreeNode } from './tree-node';
import { TreeOptions } from './tree-options';
import { TREE_EVENTS } from '../constants/events';
import { first, last } from 'lodash-es';
var TreeModel = /** @class */ (function () {
    function TreeModel() {
        this.options = new TreeOptions();
        // focused Node may be not actived 
        // actived Node must be focused
        this.focusedNode = null; // be chosen node
        // be chosen node
        this.activeNode = null; // be chosen and actived node
        this.eventNames = Object.keys(TREE_EVENTS);
        this.firstUpdate = true;
        this._dragNode = null;
        this._dropLocation = null;
    }
    /**
     * @param {?} __0
     * @return {?}
     */
    TreeModel.prototype.setData = /**
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var nodes = _a.nodes, options = _a.options, events = _a.events;
        this.options = new TreeOptions(options);
        this.events = events;
        this.update(nodes);
    };
    /**
     * @param {?} nodes
     * @return {?}
     */
    TreeModel.prototype.update = /**
     * @param {?} nodes
     * @return {?}
     */
    function (nodes) {
        // Update the tree:
        var _this = this;
        this.virtualRoot = new TreeNode({ isVirtualRoot: true }, null, this);
        this.roots = nodes && nodes.map(function (child) { return new TreeNode(child, _this.virtualRoot, _this); });
        this.virtualRoot[this.options.childrenField] = this.roots;
        this._loadTreeNodeContentComponent();
        // Fire event:
        if (this.firstUpdate) {
            if (this.roots) {
                this.fireEvent({ eventName: TREE_EVENTS.onInitialized });
                this.firstUpdate = false;
            }
        }
        else {
            this.fireEvent({ eventName: TREE_EVENTS.onUpdateData });
        }
    };
    //Used for code test
    //Used for code test
    /**
     * @return {?}
     */
    TreeModel.prototype.addStaticTreeNode = 
    //Used for code test
    /**
     * @return {?}
     */
    function () {
        this.createAndAddTreeNode({
            id: 1,
            name: 'root1',
            subTitle: 'the root',
            type: 'type1'
        }, this.focusedNode);
    };
    /**
     * @param {?} data
     * @param {?} parentNode
     * @param {?=} index
     * @return {?}
     */
    TreeModel.prototype.createAndAddTreeNode = /**
     * @param {?} data
     * @param {?} parentNode
     * @param {?=} index
     * @return {?}
     */
    function (data, parentNode, index) {
        /** @type {?} */
        var createdNode = this.createTreeNode(data, parentNode);
        this.addTreeNode(createdNode, parentNode, index);
    };
    /**
     * @param {?} data
     * @param {?} parent
     * @return {?}
     */
    TreeModel.prototype.createTreeNode = /**
     * @param {?} data
     * @param {?} parent
     * @return {?}
     */
    function (data, parent) {
        /** @type {?} */
        var createdNode = new TreeNode(data, parent, this);
        return createdNode;
    };
    /**
     * @param {?} addedNode
     * @param {?} parentNode
     * @param {?=} index
     * @return {?}
     */
    TreeModel.prototype.addTreeNode = /**
     * @param {?} addedNode
     * @param {?} parentNode
     * @param {?=} index
     * @return {?}
     */
    function (addedNode, parentNode, index) {
        if (addedNode == null) {
            return;
        }
        if (parentNode == null) { // 增加顶级树节点（没有父节点的树节点）
            this.roots.push(addedNode);
        }
        else {
            if (index === null || index === undefined) {
                parentNode.childrenField.push(addedNode);
            }
            else {
                parentNode.childrenField.splice(index, 0, addedNode);
            }
        }
        this.update(this.roots);
        this.fireEvent({ eventName: TREE_EVENTS.onAddNode, addedNode: addedNode, parentNode: parentNode });
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.removeFocusedTreeNode = /**
     * @return {?}
     */
    function () {
        this.removeTreeNode(this.focusedNode);
    };
    //移除选中的已知节点
    //移除选中的已知节点
    /**
     * @param {?} selectedTreeNode
     * @return {?}
     */
    TreeModel.prototype.removeTreeNode = 
    //移除选中的已知节点
    /**
     * @param {?} selectedTreeNode
     * @return {?}
     */
    function (selectedTreeNode) {
        if (selectedTreeNode == null) {
            return;
        }
        /** @type {?} */
        var parent = selectedTreeNode.parent;
        if (parent == null) { //移除顶级树节点（没有父节点的树节点）
            //移除顶级树节点（没有父节点的树节点）
            /** @type {?} */
            var index = this.roots.indexOf(selectedTreeNode);
            this.roots.splice(index, 1); //移除数组中某一指定节点
        }
        else {
            if (parent.childrenField.length <= 0) {
                console.log("RemoveTreeNode Warning: it is impossible to remove element from an empty array");
                return;
            }
            //移除数组中某一指定节点
            /** @type {?} */
            var index = parent.childrenField.indexOf(selectedTreeNode);
            parent.childrenField.splice(index, 1);
        }
        this.update(this.roots);
        this.fireEvent({ eventName: TREE_EVENTS.onRemoveNode, selectedTreeNode: selectedTreeNode, parent: parent });
    };
    /**
     * 定位指定树节点
     * @param needLocatedNode 待定位节点
     */
    /**
     * 定位指定树节点
     * @param {?} needLocatedNode 待定位节点
     * @return {?}
     */
    TreeModel.prototype.locateTreeNode = /**
     * 定位指定树节点
     * @param {?} needLocatedNode 待定位节点
     * @return {?}
     */
    function (needLocatedNode) {
        if (needLocatedNode == null) {
            return;
        }
        /** @type {?} */
        var parentNode = needLocatedNode.parent;
        while (parentNode != null) {
            parentNode.isExpanded = true;
            parentNode = parentNode.parent;
        }
        needLocatedNode.isActive = false;
        needLocatedNode.toggleActivated();
    };
    /**
     * 通过ID定位树节点
     * @param nodeID 待查找并定位节点的ID
     */
    /**
     * 通过ID定位树节点
     * @param {?} nodeID 待查找并定位节点的ID
     * @return {?}
     */
    TreeModel.prototype.locateNodeByID = /**
     * 通过ID定位树节点
     * @param {?} nodeID 待查找并定位节点的ID
     * @return {?}
     */
    function (nodeID) {
        /** @type {?} */
        var node = this.searchTreeNodeByID(nodeID);
        if (node == null) {
            return false;
        }
        this.locateTreeNode(node);
        return true;
    };
    /**
     * 查找指定树节点
     * @param nodeID 待查找节点ID
     */
    /**
     * 查找指定树节点
     * @param {?} nodeID 待查找节点ID
     * @return {?}
     */
    TreeModel.prototype.searchTreeNodeByID = /**
     * 查找指定树节点
     * @param {?} nodeID 待查找节点ID
     * @return {?}
     */
    function (nodeID) {
        return this.searchTreeNode(this.roots, nodeID);
    };
    /**
     * 在指定集合中，根据ID查找树节点
     * @param nodes 树集合
     * @param nodeID 待查找节点ID
     */
    /**
     * 在指定集合中，根据ID查找树节点
     * @param {?} nodes 树集合
     * @param {?} nodeID 待查找节点ID
     * @return {?}
     */
    TreeModel.prototype.searchTreeNode = /**
     * 在指定集合中，根据ID查找树节点
     * @param {?} nodes 树集合
     * @param {?} nodeID 待查找节点ID
     * @return {?}
     */
    function (nodes, nodeID) {
        var _this = this;
        if (nodes == null || nodes.length <= 0) {
            return null;
        }
        if (nodeID == null || nodeID.length < 0) {
            return null;
        }
        /** @type {?} */
        var searchedTreeNode = null;
        nodes.forEach(function (node) {
            if (node.idField == nodeID) { //回归
                searchedTreeNode = node;
                return;
            }
            if (node.childrenField == null || node.childrenField.length < 0) { //回归
                return;
            }
            /** @type {?} */
            var searchedNodeInChildren = _this.searchTreeNode(node.childrenField, nodeID);
            if (searchedNodeInChildren != null) {
                searchedTreeNode = searchedNodeInChildren;
            }
            return; //回归
        });
        return searchedTreeNode; //返回
    };
    Object.defineProperty(TreeModel.prototype, "treeNodeContentComponent", {
        get: /**
         * @return {?}
         */
        function () { return this._treeNodeContentComponent; },
        enumerable: true,
        configurable: true
    });
    ;
    // if treeNodeTemplate is a component - use it,
    // otherwise - it's a template, so wrap it with an AdHoc component
    // if treeNodeTemplate is a component - use it,
    // otherwise - it's a template, so wrap it with an AdHoc component
    /**
     * @return {?}
     */
    TreeModel.prototype._loadTreeNodeContentComponent = 
    // if treeNodeTemplate is a component - use it,
    // otherwise - it's a template, so wrap it with an AdHoc component
    /**
     * @return {?}
     */
    function () {
        this._treeNodeContentComponent = this.options.treeNodeTemplate;
        if (typeof this._treeNodeContentComponent === 'string') {
            // this._treeNodeContentComponent = this._createAdHocComponent(this._treeNodeContentComponent);
        }
    };
    Object.defineProperty(TreeModel.prototype, "isFocused", {
        // _createAdHocComponent(templateStr) {
        //     @Component({
        //         selector: 'TreeNodeTemplate',
        //         template: templateStr
        //     })
        //     class AdHocTreeNodeTemplateComponent {
        //         @Input() node: TreeNode;
        //     }
        //     return AdHocTreeNodeTemplateComponent;
        // }
        get: 
        // _createAdHocComponent(templateStr) {
        //     @Component({
        //         selector: 'TreeNodeTemplate',
        //         template: templateStr
        //     })
        //     class AdHocTreeNodeTemplateComponent {
        //         @Input() node: TreeNode;
        //     }
        //     return AdHocTreeNodeTemplateComponent;
        // }
        /**
         * @return {?}
         */
        function () {
            return TreeModel.focusedTree === this;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} value
     * @return {?}
     */
    TreeModel.prototype.setFocus = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        TreeModel.focusedTree = value ? this : null;
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.getFirstRoot = /**
     * @return {?}
     */
    function () {
        return first(this.roots);
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.getLastRoot = /**
     * @return {?}
     */
    function () {
        return last(this.roots);
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.focusNextNode = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var previousNode = this.focusedNode;
        /** @type {?} */
        var nextNode = previousNode ? previousNode.findNextNode() : this.getFirstRoot();
        nextNode && nextNode.focus(); // Short-circuit evaluation
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.focusPreviousNode = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var previousNode = this.focusedNode;
        /** @type {?} */
        var nextNode = previousNode ? previousNode.findPreviousNode() : this.getLastRoot();
        nextNode && nextNode.focus();
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.focusDrillUp = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var previousNode = this.focusedNode;
        /** @type {?} */
        var nextNode = previousNode && previousNode.realParent;
        nextNode && nextNode.focus();
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.focusDrillDown = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var previousNode = this.focusedNode;
        /** @type {?} */
        var nextNode = previousNode && previousNode.getFirstChild();
        nextNode && nextNode.focus();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    TreeModel.prototype.fireEvent = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // https://stackoverflow.com/questions/35840576/differencse-between-eventemitter-next-and-eventemitter-emit-in-angular-2
        //  abandon next() function, begin to use emit() function
        // this.events[event.eventName].next(event);
        // this.events[event.eventName].emit(event,alert(event.eventName));//发射事件，并传递事件的对象
        this.events[event.eventName].emit(event);
    };
    /**
     * 判断是否执行移动节点操作，可以移动返回true，否则返回false
     * @param param0 param0.from 待移动节点的原有父节点
     *               param0.to 待移动节点的新父节点
     */
    /**
     * 判断是否执行移动节点操作，可以移动返回true，否则返回false
     * @param {?} __0
     * @return {?}
     */
    TreeModel.prototype.canMoveNode = /**
     * 判断是否执行移动节点操作，可以移动返回true，否则返回false
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var from = _a.from, to = _a.to;
        // same node
        if (from.parentNode === to.parentNode && from.index === to.index) {
            return false;
        }
        /** @type {?} */
        var fromChildren = from.parentNode.children;
        /** @type {?} */
        var fromNode = fromChildren[from.index];
        return !to.parentNode.isDescendantOf(fromNode);
    };
    /**
     * 移动节点
     * @param param0 param0.from 待移动节点的原有父节点
     *               param0.to 待移动节点的新父节点
     */
    /**
     * 移动节点
     * @param {?} __0
     * @return {?}
     */
    TreeModel.prototype.moveNode = /**
     * 移动节点
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var from = _a.from, to = _a.to;
        if (!this.canMoveNode({ from: from, to: to }))
            return;
        /** @type {?} */
        var fromChildren = from.parentNode.childrenField;
        // If node doesn't have children - create children array
        if (!to.parentNode.childrenField) {
            to.parentNode.childrenField = [];
        }
        /** @type {?} */
        var toChildren = to.parentNode.childrenField;
        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/splice
        // The splice() method changes the contents of an array by removing existing elements and/or adding new elements.
        /** @type {?} */
        var node = fromChildren.splice(from.index, 1)[0];
        // Compensate for index if already removed from parent:
        /** @type {?} */
        var toIndex = (from.parentNode === to.parentNode && to.index > from.index) ? to.index - 1 : to.index;
        toChildren.splice(toIndex, 0, node);
        // console.log("toChildren:" + toChildren);
        // console.log("AfterMoveNode:" + this.roots);
        this.update(this.roots); // 实现node moved后，重新刷新这棵树
        this.fireEvent({ eventName: TREE_EVENTS.onMoveNode, node: node, to: to });
    };
    // TODO: move to a different service:
    // TODO: move to a different service:
    /**
     * @param {?} dragNode
     * @return {?}
     */
    TreeModel.prototype.setDragNode = 
    // TODO: move to a different service:
    /**
     * @param {?} dragNode
     * @return {?}
     */
    function (dragNode) {
        this._dragNode = dragNode;
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.getDragNode = /**
     * @return {?}
     */
    function () {
        return this._dragNode || { parentNode: null, index: null };
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.isDragging = /**
     * @return {?}
     */
    function () {
        return this.getDragNode().parentNode;
    };
    /**
     * @param {?} dropLocation
     * @return {?}
     */
    TreeModel.prototype.setDropLocation = /**
     * @param {?} dropLocation
     * @return {?}
     */
    function (dropLocation) {
        this._dropLocation = dropLocation;
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.getDropLocation = /**
     * @return {?}
     */
    function () {
        return this._dropLocation || { component: null, parentNode: null, index: null };
    };
    /**
     * @param {?} component
     * @return {?}
     */
    TreeModel.prototype.isDraggingOver = /**
     * @param {?} component
     * @return {?}
     */
    function (component) {
        return this.getDropLocation().component === component;
    };
    /**
     * @return {?}
     */
    TreeModel.prototype.cancelDrag = /**
     * @return {?}
     */
    function () {
        this.setDropLocation(null);
        this.setDragNode(null);
    };
    TreeModel.focusedTree = null;
    TreeModel.decorators = [
        { type: Injectable }
    ];
    return TreeModel;
}());
export { TreeModel };
if (false) {
    /** @type {?} */
    TreeModel.focusedTree;
    /** @type {?} */
    TreeModel.prototype.roots;
    /** @type {?} */
    TreeModel.prototype.options;
    /** @type {?} */
    TreeModel.prototype.focusedNode;
    /** @type {?} */
    TreeModel.prototype.activeNode;
    /**
     * @type {?}
     * @private
     */
    TreeModel.prototype.events;
    /** @type {?} */
    TreeModel.prototype.eventNames;
    /** @type {?} */
    TreeModel.prototype.firstUpdate;
    /** @type {?} */
    TreeModel.prototype._dragNode;
    /** @type {?} */
    TreeModel.prototype._dropLocation;
    /** @type {?} */
    TreeModel.prototype.virtualRoot;
    /**
     * @type {?}
     * @private
     */
    TreeModel.prototype._treeNodeContentComponent;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25nMnRyZWUtY29tbW9uL21vZGVscy90cmVlLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDdkMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBOEIsTUFBTSxXQUFXLENBQUM7QUFFcEU7SUFBQTtRQUdJLFlBQU8sR0FBZ0IsSUFBSSxXQUFXLEVBQUUsQ0FBQzs7O1FBSXpDLGdCQUFXLEdBQWEsSUFBSSxDQUFDLENBQUEsaUJBQWlCOztRQUM5QyxlQUFVLEdBQWEsSUFBSSxDQUFDLENBQUEsNkJBQTZCO1FBRXpELGVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXRDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ25CLGNBQVMsR0FBNEMsSUFBSSxDQUFDO1FBQzFELGtCQUFhLEdBQTJELElBQUksQ0FBQztJQXdVakYsQ0FBQzs7Ozs7SUF0VUcsMkJBQU87Ozs7SUFBUCxVQUFRLEVBQXdCO1lBQXZCLGdCQUFLLEVBQUUsb0JBQU8sRUFBRSxrQkFBTTtRQUUzQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBRXJCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkIsQ0FBQzs7Ozs7SUFHRCwwQkFBTTs7OztJQUFOLFVBQU8s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SUFFRCxtQ0FBZTs7O0lBQWY7UUFDSSxPQUFPLElBQUksQ0FBQyxhQUFhLElBQUksRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBQyxDQUFDO0lBQ2xGLENBQUM7Ozs7O0lBRUQsa0NBQWM7Ozs7SUFBZCxVQUFlLFNBQVM7UUFDcEIsT0FBTyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQztJQUMxRCxDQUFDOzs7O0lBRUQsOEJBQVU7OztJQUFWO1FBQ0ksSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFqVk0scUJBQVcsR0FBRyxJQUFJLENBQUM7O2dCQUo3QixVQUFVOztJQXNWWCxnQkFBQztDQUFBLEFBdFZELElBc1ZDO1NBclZZLFNBQVM7OztJQUdsQixzQkFBMEI7O0lBRjFCLDBCQUFrQjs7SUFDbEIsNEJBQXlDOztJQUl6QyxnQ0FBNkI7O0lBQzdCLCtCQUE0Qjs7Ozs7SUFDNUIsMkJBQW1COztJQUNuQiwrQkFBc0M7O0lBRXRDLGdDQUFtQjs7SUFDbkIsOEJBQTBEOztJQUMxRCxrQ0FBNkU7O0lBVTdFLGdDQUFzQjs7Ozs7SUEwS3RCLDhDQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHJlZU5vZGUgfSBmcm9tICcuL3RyZWUtbm9kZSc7XHJcbmltcG9ydCB7IFRyZWVPcHRpb25zIH0gZnJvbSAnLi90cmVlLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBUUkVFX0VWRU5UUyB9IGZyb20gJy4uL2NvbnN0YW50cy9ldmVudHMnO1xyXG5pbXBvcnQgeyBmaXJzdCwgbGFzdCwgaW5kZXhPZiwgZmluZEluZGV4LCBzb3J0QnkgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgVHJlZU1vZGVsIHtcclxuICAgIHJvb3RzOiBUcmVlTm9kZVtdO1xyXG4gICAgb3B0aW9uczogVHJlZU9wdGlvbnMgPSBuZXcgVHJlZU9wdGlvbnMoKTtcclxuICAgIHN0YXRpYyBmb2N1c2VkVHJlZSA9IG51bGw7XHJcbiAgICAvLyBmb2N1c2VkIE5vZGUgbWF5IGJlIG5vdCBhY3RpdmVkIFxyXG4gICAgLy8gYWN0aXZlZCBOb2RlIG11c3QgYmUgZm9jdXNlZFxyXG4gICAgZm9jdXNlZE5vZGU6IFRyZWVOb2RlID0gbnVsbDsvLyBiZSBjaG9zZW4gbm9kZVxyXG4gICAgYWN0aXZlTm9kZTogVHJlZU5vZGUgPSBudWxsOy8vIGJlIGNob3NlbiBhbmQgYWN0aXZlZCBub2RlXHJcbiAgICBwcml2YXRlIGV2ZW50czphbnk7XHJcbiAgICBldmVudE5hbWVzID0gT2JqZWN0LmtleXMoVFJFRV9FVkVOVFMpO1xyXG5cclxuICAgIGZpcnN0VXBkYXRlID0gdHJ1ZTtcclxuICAgIF9kcmFnTm9kZTogeyBwYXJlbnROb2RlOiBUcmVlTm9kZSwgaW5kZXg6IG51bWJlciB9ID0gbnVsbDtcclxuICAgIF9kcm9wTG9jYXRpb246eyBjb21wb25lbnQ6IGFueSwgcGFyZW50Tm9kZTogVHJlZU5vZGUsIGluZGV4OiBudW1iZXIgfSA9IG51bGw7XHJcblxyXG4gICAgc2V0RGF0YSh7bm9kZXMsIG9wdGlvbnMsIGV2ZW50c30pe1xyXG5cclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBuZXcgVHJlZU9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5ldmVudHMgPSBldmVudHM7XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlKG5vZGVzKTtcclxuICAgIH1cclxuXHJcbiAgICB2aXJ0dWFsUm9vdDogVHJlZU5vZGU7XHJcbiAgICB1cGRhdGUobm9kZXMpe1xyXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgdHJlZTpcclxuXHJcbiAgICAgICAgdGhpcy52aXJ0dWFsUm9vdCA9IG5ldyBUcmVlTm9kZSh7IGlzVmlydHVhbFJvb3Q6IHRydWUgfSwgbnVsbCx0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5yb290cyA9IG5vZGVzICYmIG5vZGVzLm1hcChjaGlsZCA9PiBuZXcgVHJlZU5vZGUoY2hpbGQsIHRoaXMudmlydHVhbFJvb3QsIHRoaXMpKTtcclxuXHJcbiAgICAgICAgdGhpcy52aXJ0dWFsUm9vdFt0aGlzLm9wdGlvbnMuY2hpbGRyZW5GaWVsZF0gPSB0aGlzLnJvb3RzO1xyXG4gIFxyXG4gICAgICAgIHRoaXMuX2xvYWRUcmVlTm9kZUNvbnRlbnRDb21wb25lbnQoKTtcclxuICAgIFxyXG4gICAgICAgIC8vIEZpcmUgZXZlbnQ6XHJcbiAgICAgICAgaWYgKHRoaXMuZmlyc3RVcGRhdGUpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucm9vdHMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vbkluaXRpYWxpemVkIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maXJzdFVwZGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5maXJlRXZlbnQoeyBldmVudE5hbWU6IFRSRUVfRVZFTlRTLm9uVXBkYXRlRGF0YSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy9Vc2VkIGZvciBjb2RlIHRlc3RcclxuICAgIGFkZFN0YXRpY1RyZWVOb2RlKCl7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVBbmRBZGRUcmVlTm9kZSh7ICAgICAgICBcclxuICAgICAgICAgICAgaWQ6IDEsXHJcbiAgICAgICAgICAgIG5hbWU6ICdyb290MScsXHJcbiAgICAgICAgICAgIHN1YlRpdGxlOiAndGhlIHJvb3QnLFxyXG4gICAgICAgICAgICB0eXBlOiAndHlwZTEnXHJcbiAgICAgICAgfSx0aGlzLmZvY3VzZWROb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVBbmRBZGRUcmVlTm9kZShkYXRhLCBwYXJlbnROb2RlOiBUcmVlTm9kZSwgaW5kZXg/KXtcclxuICAgICAgICBjb25zdCBjcmVhdGVkTm9kZSA9IHRoaXMuY3JlYXRlVHJlZU5vZGUoZGF0YSwgcGFyZW50Tm9kZSk7XHJcbiAgICAgICAgdGhpcy5hZGRUcmVlTm9kZShjcmVhdGVkTm9kZSwgcGFyZW50Tm9kZSwgaW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVRyZWVOb2RlKGRhdGEsIHBhcmVudDogVHJlZU5vZGUpOiBUcmVlTm9kZXtcclxuICAgICAgICBsZXQgY3JlYXRlZE5vZGUgPSAgbmV3IFRyZWVOb2RlKGRhdGEsIHBhcmVudCwgdGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZWROb2RlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBhZGRUcmVlTm9kZShhZGRlZE5vZGU6IFRyZWVOb2RlLCBwYXJlbnROb2RlOiBUcmVlTm9kZSwgaW5kZXg/KXtcclxuICAgICAgICBpZiAoYWRkZWROb2RlID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBhcmVudE5vZGUgPT0gbnVsbCkgey8vIOWinuWKoOmhtue6p+agkeiKgueCue+8iOayoeacieeItuiKgueCueeahOagkeiKgueCue+8iVxyXG4gICAgICAgICAgICB0aGlzLnJvb3RzLnB1c2goYWRkZWROb2RlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IG51bGwgfHwgaW5kZXggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcGFyZW50Tm9kZS5jaGlsZHJlbkZpZWxkLnB1c2goYWRkZWROb2RlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHBhcmVudE5vZGUuY2hpbGRyZW5GaWVsZC5zcGxpY2UoaW5kZXgsIDAsIGFkZGVkTm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlKHRoaXMucm9vdHMpO1xyXG5cclxuICAgICAgICB0aGlzLmZpcmVFdmVudCh7IGV2ZW50TmFtZTogVFJFRV9FVkVOVFMub25BZGROb2RlLCBhZGRlZE5vZGUsIHBhcmVudE5vZGV9KTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVGb2N1c2VkVHJlZU5vZGUoKXtcclxuICAgICAgICB0aGlzLnJlbW92ZVRyZWVOb2RlKHRoaXMuZm9jdXNlZE5vZGUpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvL+enu+mZpOmAieS4reeahOW3suefpeiKgueCuVxyXG4gICAgcmVtb3ZlVHJlZU5vZGUoc2VsZWN0ZWRUcmVlTm9kZTogVHJlZU5vZGUpe1xyXG4gICAgICAgIGlmKHNlbGVjdGVkVHJlZU5vZGUgPT0gbnVsbCl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHNlbGVjdGVkVHJlZU5vZGUucGFyZW50O1xyXG4gICAgICAgIGlmKHBhcmVudCA9PSBudWxsKXsvL+enu+mZpOmhtue6p+agkeiKgueCue+8iOayoeacieeItuiKgueCueeahOagkeiKgueCue+8iVxyXG4gICAgICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnJvb3RzLmluZGV4T2Yoc2VsZWN0ZWRUcmVlTm9kZSk7XHJcbiAgICAgICAgICAgIHRoaXMucm9vdHMuc3BsaWNlKGluZGV4LCAxKTsvL+enu+mZpOaVsOe7hOS4reafkOS4gOaMh+WumuiKgueCuVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBpZihwYXJlbnQuY2hpbGRyZW5GaWVsZC5sZW5ndGggPD0gMCl7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlbW92ZVRyZWVOb2RlIFdhcm5pbmc6IGl0IGlzIGltcG9zc2libGUgdG8gcmVtb3ZlIGVsZW1lbnQgZnJvbSBhbiBlbXB0eSBhcnJheVwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL+enu+mZpOaVsOe7hOS4reafkOS4gOaMh+WumuiKgueCuVxyXG4gICAgICAgICAgICBsZXQgaW5kZXggPSBwYXJlbnQuY2hpbGRyZW5GaWVsZC5pbmRleE9mKHNlbGVjdGVkVHJlZU5vZGUpO1xyXG4gICAgICAgICAgICBwYXJlbnQuY2hpbGRyZW5GaWVsZC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGUodGhpcy5yb290cyk7XHJcblxyXG4gICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vblJlbW92ZU5vZGUsIHNlbGVjdGVkVHJlZU5vZGUsIHBhcmVudH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5a6a5L2N5oyH5a6a5qCR6IqC54K5XHJcbiAgICAgKiBAcGFyYW0gbmVlZExvY2F0ZWROb2RlIOW+heWumuS9jeiKgueCuSBcclxuICAgICAqL1xyXG4gICAgbG9jYXRlVHJlZU5vZGUobmVlZExvY2F0ZWROb2RlOiBUcmVlTm9kZSl7XHJcbiAgICAgICAgaWYobmVlZExvY2F0ZWROb2RlID09IG51bGwpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcGFyZW50Tm9kZSA9IG5lZWRMb2NhdGVkTm9kZS5wYXJlbnQ7XHJcbiAgICAgICAgd2hpbGUoIHBhcmVudE5vZGUgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgIHBhcmVudE5vZGUuaXNFeHBhbmRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLnBhcmVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgbmVlZExvY2F0ZWROb2RlLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgbmVlZExvY2F0ZWROb2RlLnRvZ2dsZUFjdGl2YXRlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCa6L+HSUTlrprkvY3moJHoioLngrlcclxuICAgICAqIEBwYXJhbSBub2RlSUQg5b6F5p+l5om+5bm25a6a5L2N6IqC54K555qESURcclxuICAgICAqL1xyXG4gICAgbG9jYXRlTm9kZUJ5SUQobm9kZUlEOiBzdHJpbmcpOiBib29sZWFue1xyXG4gICAgICAgIGxldCBub2RlID0gdGhpcy5zZWFyY2hUcmVlTm9kZUJ5SUQobm9kZUlEKTtcclxuICAgICAgICBpZihub2RlID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvY2F0ZVRyZWVOb2RlKG5vZGUpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIOafpeaJvuaMh+WumuagkeiKgueCuVxyXG4gICAgICogQHBhcmFtIG5vZGVJRCDlvoXmn6Xmib7oioLngrlJRFxyXG4gICAgICovXHJcbiAgICBzZWFyY2hUcmVlTm9kZUJ5SUQobm9kZUlEOiBzdHJpbmcpOiBUcmVlTm9kZXtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2hUcmVlTm9kZSh0aGlzLnJvb3RzLCBub2RlSUQpO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiDlnKjmjIflrprpm4blkIjkuK3vvIzmoLnmja5JROafpeaJvuagkeiKgueCuVxyXG4gICAgICogQHBhcmFtIG5vZGVzIOagkembhuWQiFxyXG4gICAgICogQHBhcmFtIG5vZGVJRCDlvoXmn6Xmib7oioLngrlJRFxyXG4gICAgICovXHJcbiAgICBzZWFyY2hUcmVlTm9kZShub2RlczogVHJlZU5vZGVbXSwgbm9kZUlEOiBzdHJpbmcpOiBUcmVlTm9kZXtcclxuXHJcbiAgICAgICAgaWYobm9kZXMgPT0gbnVsbCB8fCBub2Rlcy5sZW5ndGggPD0gMCl7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYobm9kZUlEID09IG51bGwgfHwgbm9kZUlELmxlbmd0aCA8IDApe1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBzZWFyY2hlZFRyZWVOb2RlOiBUcmVlTm9kZSA9IG51bGw7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbm9kZXMuZm9yRWFjaChub2RlID0+IHtcclxuICAgICAgICAgICAgaWYobm9kZS5pZEZpZWxkID09IG5vZGVJRCl7IC8v5Zue5b2SXHJcbiAgICAgICAgICAgICAgICBzZWFyY2hlZFRyZWVOb2RlID0gbm9kZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYobm9kZS5jaGlsZHJlbkZpZWxkID09IG51bGwgfHwgbm9kZS5jaGlsZHJlbkZpZWxkLmxlbmd0aCA8IDApeyAvL+WbnuW9klxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzZWFyY2hlZE5vZGVJbkNoaWxkcmVuID0gdGhpcy5zZWFyY2hUcmVlTm9kZShub2RlLmNoaWxkcmVuRmllbGQsIG5vZGVJRCk7Ly/pgJLmjqhcclxuICAgICAgICAgICAgaWYoc2VhcmNoZWROb2RlSW5DaGlsZHJlbiAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgIHNlYXJjaGVkVHJlZU5vZGUgPSBzZWFyY2hlZE5vZGVJbkNoaWxkcmVuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjsvL+WbnuW9klxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VhcmNoZWRUcmVlTm9kZTsgLy/ov5Tlm55cclxuICAgIH1cclxuICAgIFxyXG4gICAgcHJpdmF0ZSBfdHJlZU5vZGVDb250ZW50Q29tcG9uZW50OmFueTtcclxuICAgIGdldCB0cmVlTm9kZUNvbnRlbnRDb21wb25lbnQoKSB7IHJldHVybiB0aGlzLl90cmVlTm9kZUNvbnRlbnRDb21wb25lbnQgfTtcclxuICAgIC8vIGlmIHRyZWVOb2RlVGVtcGxhdGUgaXMgYSBjb21wb25lbnQgLSB1c2UgaXQsXHJcbiAgICAvLyBvdGhlcndpc2UgLSBpdCdzIGEgdGVtcGxhdGUsIHNvIHdyYXAgaXQgd2l0aCBhbiBBZEhvYyBjb21wb25lbnRcclxuICAgIF9sb2FkVHJlZU5vZGVDb250ZW50Q29tcG9uZW50KCkge1xyXG4gICAgICAgIHRoaXMuX3RyZWVOb2RlQ29udGVudENvbXBvbmVudCA9IHRoaXMub3B0aW9ucy50cmVlTm9kZVRlbXBsYXRlO1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5fdHJlZU5vZGVDb250ZW50Q29tcG9uZW50ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIC8vIHRoaXMuX3RyZWVOb2RlQ29udGVudENvbXBvbmVudCA9IHRoaXMuX2NyZWF0ZUFkSG9jQ29tcG9uZW50KHRoaXMuX3RyZWVOb2RlQ29udGVudENvbXBvbmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIF9jcmVhdGVBZEhvY0NvbXBvbmVudCh0ZW1wbGF0ZVN0cikge1xyXG4gICAgLy8gICAgIEBDb21wb25lbnQoe1xyXG4gICAgLy8gICAgICAgICBzZWxlY3RvcjogJ1RyZWVOb2RlVGVtcGxhdGUnLFxyXG4gICAgLy8gICAgICAgICB0ZW1wbGF0ZTogdGVtcGxhdGVTdHJcclxuICAgIC8vICAgICB9KVxyXG4gICAgLy8gICAgIGNsYXNzIEFkSG9jVHJlZU5vZGVUZW1wbGF0ZUNvbXBvbmVudCB7XHJcbiAgICAvLyAgICAgICAgIEBJbnB1dCgpIG5vZGU6IFRyZWVOb2RlO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICByZXR1cm4gQWRIb2NUcmVlTm9kZVRlbXBsYXRlQ29tcG9uZW50O1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGdldCBpc0ZvY3VzZWQoKVxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiBUcmVlTW9kZWwuZm9jdXNlZFRyZWUgPT09IHRoaXM7XHJcbiAgICB9XHJcbiAgICBzZXRGb2N1cyh2YWx1ZSl7XHJcbiAgICAgICAgVHJlZU1vZGVsLmZvY3VzZWRUcmVlID0gdmFsdWUgPyB0aGlzIDogbnVsbDtcclxuICAgIH1cclxuICAgIGdldEZpcnN0Um9vdCgpe1xyXG4gICAgICAgIHJldHVybiBmaXJzdCh0aGlzLnJvb3RzKTtcclxuICAgIH1cclxuICAgIGdldExhc3RSb290KCl7XHJcbiAgICAgICAgcmV0dXJuIGxhc3QodGhpcy5yb290cyk7XHJcbiAgICB9XHJcbiAgICBmb2N1c05leHROb2RlKCkge1xyXG4gICAgICAgIGxldCBwcmV2aW91c05vZGUgPSB0aGlzLmZvY3VzZWROb2RlO1xyXG4gICAgICAgIGxldCBuZXh0Tm9kZSA9IHByZXZpb3VzTm9kZSA/IHByZXZpb3VzTm9kZS5maW5kTmV4dE5vZGUoKSA6IHRoaXMuZ2V0Rmlyc3RSb290KCk7XHJcbiAgICAgICAgbmV4dE5vZGUgJiYgbmV4dE5vZGUuZm9jdXMoKSAvLyBTaG9ydC1jaXJjdWl0IGV2YWx1YXRpb25cclxuICAgIH1cclxuXHJcbiAgICBmb2N1c1ByZXZpb3VzTm9kZSgpIHtcclxuICAgICAgICBsZXQgcHJldmlvdXNOb2RlID0gdGhpcy5mb2N1c2VkTm9kZTtcclxuICAgICAgICBsZXQgbmV4dE5vZGUgPSBwcmV2aW91c05vZGUgPyBwcmV2aW91c05vZGUuZmluZFByZXZpb3VzTm9kZSgpIDogdGhpcy5nZXRMYXN0Um9vdCgpO1xyXG4gICAgICAgIG5leHROb2RlICYmIG5leHROb2RlLmZvY3VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9jdXNEcmlsbFVwKCl7XHJcbiAgICAgICAgbGV0IHByZXZpb3VzTm9kZSA9IHRoaXMuZm9jdXNlZE5vZGU7XHJcbiAgICAgICAgbGV0IG5leHROb2RlID0gcHJldmlvdXNOb2RlICYmIHByZXZpb3VzTm9kZS5yZWFsUGFyZW50O1xyXG4gICAgICAgIG5leHROb2RlICYmIG5leHROb2RlLmZvY3VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9jdXNEcmlsbERvd24oKSB7XHJcbiAgICAgICAgbGV0IHByZXZpb3VzTm9kZSA9IHRoaXMuZm9jdXNlZE5vZGU7XHJcbiAgICAgICAgbGV0IG5leHROb2RlID0gcHJldmlvdXNOb2RlICYmIHByZXZpb3VzTm9kZS5nZXRGaXJzdENoaWxkKCk7XHJcbiAgICAgICAgbmV4dE5vZGUgJiYgbmV4dE5vZGUuZm9jdXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBmaXJlRXZlbnQoZXZlbnQpIHtcclxuICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zNTg0MDU3Ni9kaWZmZXJlbmNzZS1iZXR3ZWVuLWV2ZW50ZW1pdHRlci1uZXh0LWFuZC1ldmVudGVtaXR0ZXItZW1pdC1pbi1hbmd1bGFyLTJcclxuICAgICAgICAvLyAgYWJhbmRvbiBuZXh0KCkgZnVuY3Rpb24sIGJlZ2luIHRvIHVzZSBlbWl0KCkgZnVuY3Rpb25cclxuICAgICAgICAvLyB0aGlzLmV2ZW50c1tldmVudC5ldmVudE5hbWVdLm5leHQoZXZlbnQpO1xyXG4gICAgICAgIC8vIHRoaXMuZXZlbnRzW2V2ZW50LmV2ZW50TmFtZV0uZW1pdChldmVudCxhbGVydChldmVudC5ldmVudE5hbWUpKTsvL+WPkeWwhOS6i+S7tu+8jOW5tuS8oOmAkuS6i+S7tueahOWvueixoVxyXG4gICAgICAgIHRoaXMuZXZlbnRzW2V2ZW50LmV2ZW50TmFtZV0uZW1pdChldmVudCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yik5pat5piv5ZCm5omn6KGM56e75Yqo6IqC54K55pON5L2c77yM5Y+v5Lul56e75Yqo6L+U5ZuedHJ1Ze+8jOWQpuWImei/lOWbnmZhbHNlXHJcbiAgICAgKiBAcGFyYW0gcGFyYW0wIHBhcmFtMC5mcm9tIOW+heenu+WKqOiKgueCueeahOWOn+acieeItuiKgueCuVxyXG4gICAgICogICAgICAgICAgICAgICBwYXJhbTAudG8g5b6F56e75Yqo6IqC54K555qE5paw54i26IqC54K5XHJcbiAgICAgKi9cclxuICAgIGNhbk1vdmVOb2RlKHsgZnJvbSwgdG8gfSkge1xyXG4gICAgICAgIC8vIHNhbWUgbm9kZVxyXG4gICAgICAgIGlmIChmcm9tLnBhcmVudE5vZGUgPT09IHRvLnBhcmVudE5vZGUgJiYgZnJvbS5pbmRleCA9PT0gdG8uaW5kZXgpIHtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBjb25zdCBmcm9tQ2hpbGRyZW4gPSBmcm9tLnBhcmVudE5vZGUuY2hpbGRyZW47XHJcbiAgICAgICAgY29uc3QgZnJvbU5vZGUgPSBmcm9tQ2hpbGRyZW5bZnJvbS5pbmRleF07XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuICF0by5wYXJlbnROb2RlLmlzRGVzY2VuZGFudE9mKGZyb21Ob2RlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOenu+WKqOiKgueCuVxyXG4gICAgICogQHBhcmFtIHBhcmFtMCBwYXJhbTAuZnJvbSDlvoXnp7vliqjoioLngrnnmoTljp/mnInniLboioLngrlcclxuICAgICAqICAgICAgICAgICAgICAgcGFyYW0wLnRvIOW+heenu+WKqOiKgueCueeahOaWsOeItuiKgueCuVxyXG4gICAgICovXHJcbiAgICBtb3ZlTm9kZSh7IGZyb20sIHRvIH0pIHtcclxuICAgICAgICBpZiAoIXRoaXMuY2FuTW92ZU5vZGUoeyBmcm9tICwgdG8gfSkpIHJldHVybjtcclxuICAgIFxyXG4gICAgICAgIGNvbnN0IGZyb21DaGlsZHJlbiA9IGZyb20ucGFyZW50Tm9kZS5jaGlsZHJlbkZpZWxkO1xyXG4gICAgXHJcbiAgICAgICAgLy8gSWYgbm9kZSBkb2Vzbid0IGhhdmUgY2hpbGRyZW4gLSBjcmVhdGUgY2hpbGRyZW4gYXJyYXlcclxuICAgICAgICBpZiAoIXRvLnBhcmVudE5vZGUuY2hpbGRyZW5GaWVsZCkge1xyXG4gICAgICAgICAgdG8ucGFyZW50Tm9kZS5jaGlsZHJlbkZpZWxkID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRvQ2hpbGRyZW4gPSB0by5wYXJlbnROb2RlLmNoaWxkcmVuRmllbGQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvc3BsaWNlXHJcbiAgICAgICAgLy8gVGhlIHNwbGljZSgpIG1ldGhvZCBjaGFuZ2VzIHRoZSBjb250ZW50cyBvZiBhbiBhcnJheSBieSByZW1vdmluZyBleGlzdGluZyBlbGVtZW50cyBhbmQvb3IgYWRkaW5nIG5ldyBlbGVtZW50cy5cclxuICAgICAgICBjb25zdCBub2RlID0gZnJvbUNoaWxkcmVuLnNwbGljZShmcm9tLmluZGV4LCAxKVswXTtcclxuICAgIFxyXG4gICAgICAgIC8vIENvbXBlbnNhdGUgZm9yIGluZGV4IGlmIGFscmVhZHkgcmVtb3ZlZCBmcm9tIHBhcmVudDpcclxuICAgICAgICBsZXQgdG9JbmRleCA9IChmcm9tLnBhcmVudE5vZGUgPT09IHRvLnBhcmVudE5vZGUgJiYgdG8uaW5kZXggPiBmcm9tLmluZGV4KSA/IHRvLmluZGV4IC0gMSA6IHRvLmluZGV4O1xyXG4gICAgXHJcbiAgICAgICAgdG9DaGlsZHJlbi5zcGxpY2UodG9JbmRleCwgMCwgbm9kZSk7XHJcblxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwidG9DaGlsZHJlbjpcIiArIHRvQ2hpbGRyZW4pO1xyXG5cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkFmdGVyTW92ZU5vZGU6XCIgKyB0aGlzLnJvb3RzKTtcclxuICAgIFxyXG4gICAgICAgIHRoaXMudXBkYXRlKHRoaXMucm9vdHMpOy8vIOWunueOsG5vZGUgbW92ZWTlkI7vvIzph43mlrDliLfmlrDov5nmo7XmoJFcclxuICAgIFxyXG4gICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vbk1vdmVOb2RlLCBub2RlLCB0byB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVE9ETzogbW92ZSB0byBhIGRpZmZlcmVudCBzZXJ2aWNlOlxyXG4gICAgc2V0RHJhZ05vZGUoZHJhZ05vZGU6eyBwYXJlbnROb2RlOiBUcmVlTm9kZSwgaW5kZXg6IG51bWJlciB9KSB7XHJcbiAgICAgICAgdGhpcy5fZHJhZ05vZGUgPSBkcmFnTm9kZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZ2V0RHJhZ05vZGUoKTp7IHBhcmVudE5vZGU6IFRyZWVOb2RlLCBpbmRleDpudW1iZXIgfSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RyYWdOb2RlIHx8IHsgcGFyZW50Tm9kZTogbnVsbCwgaW5kZXg6IG51bGwgfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaXNEcmFnZ2luZygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXREcmFnTm9kZSgpLnBhcmVudE5vZGU7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHNldERyb3BMb2NhdGlvbihkcm9wTG9jYXRpb246IHsgY29tcG9uZW50OiBhbnksIHBhcmVudE5vZGU6IFRyZWVOb2RlLCBpbmRleDogbnVtYmVyIH0pIHtcclxuICAgICAgICB0aGlzLl9kcm9wTG9jYXRpb24gPSBkcm9wTG9jYXRpb247XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGdldERyb3BMb2NhdGlvbigpOiB7IGNvbXBvbmVudDogYW55LCBwYXJlbnROb2RlOiBUcmVlTm9kZSwgaW5kZXg6IG51bWJlciB9IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZHJvcExvY2F0aW9uIHx8IHtjb21wb25lbnQ6IG51bGwsIHBhcmVudE5vZGU6IG51bGwsIGluZGV4OiBudWxsfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaXNEcmFnZ2luZ092ZXIoY29tcG9uZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RHJvcExvY2F0aW9uKCkuY29tcG9uZW50ID09PSBjb21wb25lbnQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNhbmNlbERyYWcoKSB7XHJcbiAgICAgICAgdGhpcy5zZXREcm9wTG9jYXRpb24obnVsbCk7XHJcbiAgICAgICAgdGhpcy5zZXREcmFnTm9kZShudWxsKTtcclxuICAgIH1cclxufSJdfQ==
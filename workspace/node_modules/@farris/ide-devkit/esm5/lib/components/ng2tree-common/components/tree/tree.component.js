/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, HostListener } from '@angular/core';
import { TreeModel } from '../../models/tree-model';
import { TreeOptions } from '../../models/tree-options';
import { KEYS } from '../../constants/keys';
import { pick, includes } from 'lodash-es'; //将lodash安装到node-modules中，实现按需引入
//约定使用下划线表示lodash，就像用$表示jQuery一样
//1.require关键字不被识别：
// https://stackoverflow.com/questions/31173738/typescript-getting-error-ts2304-cannot-find-name-require
// declare var require: any
// const _ = require('lodash');
//2.安装lodash的es版本：
// (1) $>npm i lodash-es
// (2) $>npm install --save @types/lodash
var TreeComponent = /** @class */ (function () {
    function TreeComponent(treeModel) {
        var _this = this;
        this.treeModel = treeModel;
        treeModel.eventNames.forEach(function (name) { return _this[name] = new EventEmitter(); }); //customEventName -> new EventEmitter()
    }
    Object.defineProperty(TreeComponent.prototype, "nodes", {
        set: /**
         * @param {?} nodes
         * @return {?}
         */
        function (nodes) { },
        enumerable: true,
        configurable: true
    });
    ;
    Object.defineProperty(TreeComponent.prototype, "options", {
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) { },
        enumerable: true,
        configurable: true
    });
    ;
    Object.defineProperty(TreeComponent.prototype, "focused", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.treeModel.setFocus(value);
            // alert('focused on the tree');
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} changes
     * @return {?}
     */
    TreeComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        this.treeModel.setData({
            nodes: changes.nodes && changes.nodes.currentValue,
            options: changes.options && changes.options.currentValue,
            events: pick(this, this.treeModel.eventNames)
        });
    };
    // 优先使用HostListener装饰器绑定事件，而不是使用Directive或Component的host元数据
    // When binding events to Directive or Component, Angular suggests to prefer to HostListener decorator, 
    // rather than host metadata.
    // 优先使用HostListener装饰器绑定事件，而不是使用Directive或Component的host元数据
    // When binding events to Directive or Component, Angular suggests to prefer to HostListener decorator, 
    // rather than host metadata.
    /**
     * @param {?} $event
     * @return {?}
     */
    TreeComponent.prototype.onKeydown = 
    // 优先使用HostListener装饰器绑定事件，而不是使用Directive或Component的host元数据
    // When binding events to Directive or Component, Angular suggests to prefer to HostListener decorator, 
    // rather than host metadata.
    /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // alert('Pressed a key');
        /** @type {?} */
        var focusedNode = this.treeModel.focusedNode;
        if (!this.treeModel.isFocused) {
            return;
        }
        if (includes([KEYS.DOWN, KEYS.UP, KEYS.LEFT,
            KEYS.RIGHT, KEYS.ENTER, KEYS.SPACE], $event.keyCode)) {
            $event.preventDefault(); //取消事件的默认动作，实现仅对includes键响应
        }
        switch ($event.keyCode) {
            case KEYS.DOWN:
                return this.treeModel.focusNextNode();
            case KEYS.UP:
                return this.treeModel.focusPreviousNode();
            case KEYS.LEFT:
                // alert('Focus Drill Up');
                if (focusedNode.isExpanded) {
                    focusedNode.toggle();
                }
                else {
                    this.treeModel.focusDrillUp();
                }
                return;
            case KEYS.RIGHT:
                // alert('Focus Drill Down');
                if (focusedNode.isCollapsed) {
                    focusedNode.toggle();
                }
                else {
                    this.treeModel.focusDrillDown();
                }
                return;
            case KEYS.ENTER:
            case KEYS.SPACE:
                // alert('Enter or Space key.');
                return focusedNode && focusedNode.toggleActivated();
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    TreeComponent.prototype.onMousedown = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        // alert('click');
        /** @type {?} */
        var insideClick = $event.target.closest('ng2tree');
        if (!insideClick) {
            this.treeModel.setFocus(false);
        }
    };
    /**
     * @param {?} elementId
     * @return {?}
     */
    TreeComponent.prototype.searchAndLocationNodeById = /**
     * @param {?} elementId
     * @return {?}
     */
    function (elementId) {
        // console.log('succeeded to search and location Node By Id in treeComponent:', elementId);
        this.treeModel.locateNodeByID(elementId);
    };
    /**
     * @param {?} elementId
     * @return {?}
     */
    TreeComponent.prototype.searchNodeById = /**
     * @param {?} elementId
     * @return {?}
     */
    function (elementId) {
        // console.log('succeeded to search and location Node By Id in treeComponent:', elementId);
        return this.treeModel.searchTreeNodeByID(elementId);
    };
    TreeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng2tree',
                    template: "<div class=\"tree\">\r\n    <!-- <div class=\"localFileTreeOperateTest\">\r\n      <button (click)=\"treeModel.addStaticTreeNode()\">\u65B0\u589E</button>\r\n      <button (click)=\"treeModel.removeFocusedTreeNode()\">\u5220\u9664</button>\r\n    </div> -->\r\n    <ng2tree-node\r\n      (click)=\"treeModel.setFocus(true)\"\r\n      *ngFor=\"let child of treeModel.roots; let i = index\"\r\n      [node]=\"child\"\r\n      [nodeIndex]=\"i\">\r\n    </ng2tree-node>\r\n</div>",
                    providers: [
                        TreeModel
                    ],
                    styles: [".tree-children{padding-left:20px}.tree{display:inline-block;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;-moz-user-select:none;user-select:none}"]
                }] }
    ];
    /** @nocollapse */
    TreeComponent.ctorParameters = function () { return [
        { type: TreeModel }
    ]; };
    TreeComponent.propDecorators = {
        nodes: [{ type: Input }],
        options: [{ type: Input }],
        focused: [{ type: Input }],
        onToggle: [{ type: Output }],
        onActiveChanged: [{ type: Output }],
        onActivate: [{ type: Output }],
        onDeactivate: [{ type: Output }],
        onFocus: [{ type: Output }],
        onBlur: [{ type: Output }],
        onDoubleClick: [{ type: Output }],
        onContextMenu: [{ type: Output }],
        onRightMenuClicked: [{ type: Output }],
        onKeydown: [{ type: HostListener, args: ['body: keydown', ['$event'],] }],
        onMousedown: [{ type: HostListener, args: ['body: mousedown', ['$event'],] }]
    };
    return TreeComponent;
}());
export { TreeComponent };
if (false) {
    /** @type {?} */
    TreeComponent.prototype._nodes;
    /** @type {?} */
    TreeComponent.prototype._options;
    /** @type {?} */
    TreeComponent.prototype.onToggle;
    /** @type {?} */
    TreeComponent.prototype.onActiveChanged;
    /** @type {?} */
    TreeComponent.prototype.onActivate;
    /** @type {?} */
    TreeComponent.prototype.onDeactivate;
    /** @type {?} */
    TreeComponent.prototype.onFocus;
    /** @type {?} */
    TreeComponent.prototype.onBlur;
    /** @type {?} */
    TreeComponent.prototype.onDoubleClick;
    /** @type {?} */
    TreeComponent.prototype.onContextMenu;
    /** @type {?} */
    TreeComponent.prototype.onRightMenuClicked;
    /** @type {?} */
    TreeComponent.prototype.treeModel;
    /* Skipping unhandled member: ;*/
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2lkZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9uZzJ0cmVlLWNvbW1vbi9jb21wb25lbnRzL3RyZWUvdHJlZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWEsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hHLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDeEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sV0FBVyxDQUFDLENBQUEsZ0NBQWdDOzs7Ozs7Ozs7QUFXM0U7SUE4QkksdUJBQW1CLFNBQW1CO1FBQXRDLGlCQUVDO1FBRmtCLGNBQVMsR0FBVCxTQUFTLENBQVU7UUFDcEMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJLElBQUssT0FBQSxLQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxZQUFZLEVBQUUsRUFBL0IsQ0FBK0IsQ0FBQyxDQUFDLENBQUEsdUNBQXVDO0lBQ2pILENBQUM7SUFyQkQsc0JBQWEsZ0NBQUs7Ozs7O1FBQWxCLFVBQW1CLEtBQVcsSUFBSSxDQUFDOzs7T0FBQTtJQUFBLENBQUM7SUFFcEMsc0JBQWEsa0NBQU87Ozs7O1FBQXBCLFVBQXFCLE9BQW1CLElBQUksQ0FBQzs7O09BQUE7SUFBQSxDQUFDO0lBRTlDLHNCQUFhLGtDQUFPOzs7OztRQUFwQixVQUFxQixLQUFhO1lBQ2hDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQy9CLGdD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U0FBQztvQkFDVCxRQUFRLEVBQUUsU0FBUztvQkFDbkIsdWVBQW9DO29CQUVwQyxTQUFTLEVBQUM7d0JBQ1IsU0FBUztxQkFDVjs7aUJBQ0Y7Ozs7Z0JBckJRLFNBQVM7Ozt3QkF5QmIsS0FBSzswQkFFTCxLQUFLOzBCQUVMLEtBQUs7MkJBS0wsTUFBTTtrQ0FDTixNQUFNOzZCQUNOLE1BQU07K0JBQ04sTUFBTTswQkFDTixNQUFNO3lCQUNOLE1BQU07Z0NBQ04sTUFBTTtnQ0FDTixNQUFNO3FDQUNOLE1BQU07NEJBZ0JOLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7OEJBK0N4QyxZQUFZLFNBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBaUIvQyxvQkFBQztDQUFBLEFBNUdELElBNEdDO1NBcEdZLGFBQWE7OztJQUV0QiwrQkFBYTs7SUFFYixpQ0FBcUI7O0lBUXJCLGlDQUFtQjs7SUFDbkIsd0NBQTBCOztJQUMxQixtQ0FBcUI7O0lBQ3JCLHFDQUF1Qjs7SUFDdkIsZ0NBQWtCOztJQUNsQiwrQkFBaUI7O0lBQ2pCLHNDQUF3Qjs7SUFDeEIsc0NBQXdCOztJQUN4QiwyQ0FBNkI7O0lBRWpCLGtDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25DaGFuZ2VzLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEhvc3RMaXN0ZW5lciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmVlTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMvdHJlZS1tb2RlbCc7XHJcbmltcG9ydCB7IFRyZWVPcHRpb25zIH0gZnJvbSAnLi4vLi4vbW9kZWxzL3RyZWUtb3B0aW9ucyc7XHJcbmltcG9ydCB7IEtFWVMgfSBmcm9tICcuLi8uLi9jb25zdGFudHMva2V5cyc7XHJcbmltcG9ydCB7IHBpY2ssIGluY2x1ZGVzIH0gZnJvbSAnbG9kYXNoLWVzJzsvL+WwhmxvZGFzaOWuieijheWIsG5vZGUtbW9kdWxlc+S4re+8jOWunueOsOaMiemcgOW8leWFpVxyXG5pbXBvcnQgeyBUcmVlTm9kZSB9IGZyb20gJy4uLy4uL21vZGVscy90cmVlLW5vZGUnO1xyXG5cclxuLy/nuqblrprkvb/nlKjkuIvliJLnur/ooajnpLpsb2Rhc2jvvIzlsLHlg4/nlKgk6KGo56S6alF1ZXJ55LiA5qC3XHJcbi8vMS5yZXF1aXJl5YWz6ZSu5a2X5LiN6KKr6K+G5Yir77yaXHJcbi8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMxMTczNzM4L3R5cGVzY3JpcHQtZ2V0dGluZy1lcnJvci10czIzMDQtY2Fubm90LWZpbmQtbmFtZS1yZXF1aXJlXHJcbi8vIGRlY2xhcmUgdmFyIHJlcXVpcmU6IGFueVxyXG4vLyBjb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XHJcbi8vMi7lronoo4Vsb2Rhc2jnmoRlc+eJiOacrO+8mlxyXG4vLyAoMSkgJD5ucG0gaSBsb2Rhc2gtZXNcclxuLy8gKDIpICQ+bnBtIGluc3RhbGwgLS1zYXZlIEB0eXBlcy9sb2Rhc2hcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICduZzJ0cmVlJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdHJlZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdHJlZS5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOltcclxuICAgIFRyZWVNb2RlbFxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFRyZWVDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xyXG4gICAgLy8gZGVsZWdhdGluZyB0byBUcmVlTW9kZWwgc2VydmljZTpcclxuICAgIF9ub2RlczphbnlbXTtcclxuICAgIEBJbnB1dCgpIHNldCBub2Rlcyhub2RlczphbnlbXSkgeyB9O1xyXG4gICAgX29wdGlvbnM6VHJlZU9wdGlvbnM7XHJcbiAgICBASW5wdXQoKSBzZXQgb3B0aW9ucyhvcHRpb25zOlRyZWVPcHRpb25zKSB7IH07XHJcbiAgICBcclxuICAgIEBJbnB1dCgpIHNldCBmb2N1c2VkKHZhbHVlOmJvb2xlYW4pIHtcclxuICAgICAgdGhpcy50cmVlTW9kZWwuc2V0Rm9jdXModmFsdWUpO1xyXG4gICAgICAvLyBhbGVydCgnZm9jdXNlZCBvbiB0aGUgdHJlZScpO1xyXG4gICAgfVxyXG5cclxuICAgIEBPdXRwdXQoKSBvblRvZ2dsZTtcclxuICAgIEBPdXRwdXQoKSBvbkFjdGl2ZUNoYW5nZWQ7XHJcbiAgICBAT3V0cHV0KCkgb25BY3RpdmF0ZTtcclxuICAgIEBPdXRwdXQoKSBvbkRlYWN0aXZhdGU7XHJcbiAgICBAT3V0cHV0KCkgb25Gb2N1cztcclxuICAgIEBPdXRwdXQoKSBvbkJsdXI7XHJcbiAgICBAT3V0cHV0KCkgb25Eb3VibGVDbGljaztcclxuICAgIEBPdXRwdXQoKSBvbkNvbnRleHRNZW51O1xyXG4gICAgQE91dHB1dCgpIG9uUmlnaHRNZW51Q2xpY2tlZDtcclxuICBcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyB0cmVlTW9kZWw6VHJlZU1vZGVsKSB7IFxyXG4gICAgICB0cmVlTW9kZWwuZXZlbnROYW1lcy5mb3JFYWNoKChuYW1lKSA9PiB0aGlzW25hbWVdID0gbmV3IEV2ZW50RW1pdHRlcigpKTsvL2N1c3RvbUV2ZW50TmFtZSAtPiBuZXcgRXZlbnRFbWl0dGVyKClcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XHJcbiAgICAgIHRoaXMudHJlZU1vZGVsLnNldERhdGEoe1xyXG4gICAgICAgICAgbm9kZXM6IGNoYW5nZXMubm9kZXMgJiYgY2hhbmdlcy5ub2Rlcy5jdXJyZW50VmFsdWUsXHJcbiAgICAgICAgICBvcHRpb25zOiBjaGFuZ2VzLm9wdGlvbnMgJiYgY2hhbmdlcy5vcHRpb25zLmN1cnJlbnRWYWx1ZSxcclxuICAgICAgICAgIGV2ZW50czogcGljayh0aGlzLCB0aGlzLnRyZWVNb2RlbC5ldmVudE5hbWVzKVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIC8vIOS8mOWFiOS9v+eUqEhvc3RMaXN0ZW5lcuijhemlsOWZqOe7keWumuS6i+S7tu+8jOiAjOS4jeaYr+S9v+eUqERpcmVjdGl2ZeaIlkNvbXBvbmVudOeahGhvc3TlhYPmlbDmja5cclxuICAgIC8vIFdoZW4gYmluZGluZyBldmVudHMgdG8gRGlyZWN0aXZlIG9yIENvbXBvbmVudCwgQW5ndWxhciBzdWdnZXN0cyB0byBwcmVmZXIgdG8gSG9zdExpc3RlbmVyIGRlY29yYXRvciwgXHJcbiAgICAvLyByYXRoZXIgdGhhbiBob3N0IG1ldGFkYXRhLlxyXG4gICAgQEhvc3RMaXN0ZW5lcignYm9keToga2V5ZG93bicsIFsnJGV2ZW50J10pIG9uS2V5ZG93bigkZXZlbnQpIHtcclxuICAgICAgLy8gYWxlcnQoJ1ByZXNzZWQgYSBrZXknKTtcclxuICAgICAgbGV0IGZvY3VzZWROb2RlID0gdGhpcy50cmVlTW9kZWwuZm9jdXNlZE5vZGU7XHJcblxyXG4gICAgICBpZiAoIXRoaXMudHJlZU1vZGVsLmlzRm9jdXNlZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGluY2x1ZGVzKFtLRVlTLkRPV04sIEtFWVMuVVAsIEtFWVMuTEVGVCxcclxuICAgICAgICBLRVlTLlJJR0hULCBLRVlTLkVOVEVSLCBLRVlTLlNQQUNFXSwgJGV2ZW50LmtleUNvZGUpKSB7XHJcbiAgICAgICAgJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7Ly/lj5bmtojkuovku7bnmoTpu5jorqTliqjkvZzvvIzlrp7njrDku4Xlr7lpbmNsdWRlc+mUruWTjeW6lFxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIHN3aXRjaCAoJGV2ZW50LmtleUNvZGUpIHtcclxuICAgICAgICBjYXNlIEtFWVMuRE9XTjpcclxuICAgICAgICAgIHJldHVybiB0aGlzLnRyZWVNb2RlbC5mb2N1c05leHROb2RlKCk7XHJcbiAgXHJcbiAgICAgICAgY2FzZSBLRVlTLlVQOlxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMudHJlZU1vZGVsLmZvY3VzUHJldmlvdXNOb2RlKCk7XHJcbiAgXHJcbiAgICAgICAgY2FzZSBLRVlTLkxFRlQ6XHJcbiAgICAgICAgICAvLyBhbGVydCgnRm9jdXMgRHJpbGwgVXAnKTtcclxuICAgICAgICAgIGlmIChmb2N1c2VkTm9kZS5pc0V4cGFuZGVkKSB7XHJcbiAgICAgICAgICAgIGZvY3VzZWROb2RlLnRvZ2dsZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJlZU1vZGVsLmZvY3VzRHJpbGxVcCgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gIFxyXG4gICAgICAgIGNhc2UgS0VZUy5SSUdIVDpcclxuICAgICAgICAgIC8vIGFsZXJ0KCdGb2N1cyBEcmlsbCBEb3duJyk7XHJcbiAgICAgICAgICBpZiAoZm9jdXNlZE5vZGUuaXNDb2xsYXBzZWQpIHtcclxuICAgICAgICAgICAgZm9jdXNlZE5vZGUudG9nZ2xlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50cmVlTW9kZWwuZm9jdXNEcmlsbERvd24oKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybjtcclxuICBcclxuICAgICAgICBjYXNlIEtFWVMuRU5URVI6XHJcbiAgICAgICAgY2FzZSBLRVlTLlNQQUNFOlxyXG4gICAgICAgICAgLy8gYWxlcnQoJ0VudGVyIG9yIFNwYWNlIGtleS4nKTtcclxuICAgICAgICAgIHJldHVybiBmb2N1c2VkTm9kZSAmJiBmb2N1c2VkTm9kZS50b2dnbGVBY3RpdmF0ZWQoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ2JvZHk6IG1vdXNlZG93bicsIFsnJGV2ZW50J10pICBvbk1vdXNlZG93bigkZXZlbnQpIHtcclxuICAgICAgLy8gYWxlcnQoJ2NsaWNrJyk7XHJcbiAgICAgIGxldCBpbnNpZGVDbGljayA9ICRldmVudC50YXJnZXQuY2xvc2VzdCgnbmcydHJlZScpOy8v5Yik5pat5b2T5YmNZG9t5qCR5LiK5LiL5paH5Lit5piv5ZCm5YyF5ZCr5qCR57uE5Lu2XHJcbiAgICAgIGlmICghaW5zaWRlQ2xpY2spIHtcclxuICAgICAgICB0aGlzLnRyZWVNb2RlbC5zZXRGb2N1cyhmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZWFyY2hBbmRMb2NhdGlvbk5vZGVCeUlkKGVsZW1lbnRJZCkge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZygnc3VjY2VlZGVkIHRvIHNlYXJjaCBhbmQgbG9jYXRpb24gTm9kZSBCeSBJZCBpbiB0cmVlQ29tcG9uZW50OicsIGVsZW1lbnRJZCk7XHJcbiAgICAgIHRoaXMudHJlZU1vZGVsLmxvY2F0ZU5vZGVCeUlEKGVsZW1lbnRJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VhcmNoTm9kZUJ5SWQoZWxlbWVudElkKTogVHJlZU5vZGUge1xyXG4gICAgICAvLyBjb25zb2xlLmxvZygnc3VjY2VlZGVkIHRvIHNlYXJjaCBhbmQgbG9jYXRpb24gTm9kZSBCeSBJZCBpbiB0cmVlQ29tcG9uZW50OicsIGVsZW1lbnRJZCk7XHJcbiAgICAgIHJldHVybiB0aGlzLnRyZWVNb2RlbC5zZWFyY2hUcmVlTm9kZUJ5SUQoZWxlbWVudElkKTtcclxuICAgIH1cclxufSJdfQ==
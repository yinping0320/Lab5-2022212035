/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ContentChildren, ElementRef, Input, QueryList, TemplateRef, ViewChild, ViewChildren, ViewContainerRef, ViewEncapsulation } from '@angular/core';
import { ShContextMenuItemDirective } from './sh-context-menu-item.directive';
import { ShContextMenuService } from './sh-context-menu.service';
var ShContextMenuComponent = /** @class */ (function () {
    function ShContextMenuComponent(ctxService) {
        this.ctxService = ctxService;
        this.contentChildrenItems = new QueryList();
        this.viewChildrenItems = new QueryList();
    }
    Object.defineProperty(ShContextMenuComponent.prototype, "menuItems", {
        get: /**
         * @return {?}
         */
        function () {
            // when using the ShContextMenuComponent as menu, the ContentChildren is the source
            if (this.contentChildrenItems.length) {
                return this.contentChildrenItems;
            }
            // when using a custom component as menu the ViewChildren is the source
            return this.viewChildrenItems;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} $event
     * @param {?} item
     * @param {?} elm
     * @return {?}
     */
    ShContextMenuComponent.prototype.onEnter = /**
     * @param {?} $event
     * @param {?} item
     * @param {?} elm
     * @return {?}
     */
    function ($event, item, elm) {
        this.ctxService.closeSubMenus(this);
        this.setNotActive();
        if (!item.subMenu || !item.visible) {
            return;
        }
        this.setActive(item);
        this.ctxService.openSubMenu({
            data: item.context.$implicit,
            targetElement: new ElementRef(elm),
            menu: item.subMenu,
            mouseEvent: $event,
            parentMenu: this
        });
    };
    /**
     * @private
     * @param {?} item
     * @return {?}
     */
    ShContextMenuComponent.prototype.setActive = /**
     * @private
     * @param {?} item
     * @return {?}
     */
    function (item) {
        item.setActive();
        this.subActive = true;
    };
    /**
     * @param {?} event
     * @param {?} item
     * @return {?}
     */
    ShContextMenuComponent.prototype.onClick = /**
     * @param {?} event
     * @param {?} item
     * @return {?}
     */
    function (event, item) {
        // TODO: move click handling to service
        if (item.divider) {
            return;
        }
        if (!item.subMenu && item.closeOnClick) {
            this.ctxService.destroy();
            item.click.emit({
                data: item.context.$implicit,
                event: event
            });
        }
    };
    /**
     * @private
     * @param {?} fn
     * @param {?} fallbackContext
     * @param {?} data
     * @param {?} event
     * @return {?}
     */
    ShContextMenuComponent.prototype.callWithContext = /**
     * @private
     * @param {?} fn
     * @param {?} fallbackContext
     * @param {?} data
     * @param {?} event
     * @return {?}
     */
    function (fn, fallbackContext, data, event) {
        return fn.call(this.thisContext ? this.thisContext : fallbackContext, { data: data, event: event });
    };
    /**
     * @return {?}
     */
    ShContextMenuComponent.prototype.close = /**
     * @return {?}
     */
    function () {
        this.setNotActive();
        this.menuContainer.detach();
        if (this.overlayRef) {
            this.overlayRef.detach();
        }
    };
    /**
     * @return {?}
     */
    ShContextMenuComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.close();
    };
    /**
     * @return {?}
     */
    ShContextMenuComponent.prototype.setNotActive = /**
     * @return {?}
     */
    function () {
        this.subActive = false;
        this.menuItems.forEach(function (i) { return i.setNotActive(); });
    };
    /**
     * @param {?} item
     * @return {?}
     */
    ShContextMenuComponent.prototype.isVisible = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (!item.visible) {
            return true;
        }
        return this.callWithContext(item.visible, this, item.context.$implicit, null);
    };
    ShContextMenuComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sh-context-menu',
                    encapsulation: ViewEncapsulation.None,
                    template: "\n    <ng-container #menuContainer></ng-container>\n    <ng-template #menuTemplate>\n      <div class=\"sh-context-menu\">\n        <div\n          *ngFor=\"let menuItem of menuItems\"\n          #itemElement\n          [ngClass]=\"{'sh-sub-anchor': menuItem.subMenu && menuItem.visible,\n           'sh-context-menu--item__disable': !menuItem.visible,\n           'sh-context-menu--item__divider': menuItem.divider,\n           'sh-context-menu--item__sub-active': subActive && menuItem.active}\"\n          class=\"sh-context-menu--item\"\n          (mouseenter)=\"onEnter($event, menuItem, itemElement)\"\n          (click)=\"onClick($event, menuItem)\">\n          <ng-container *ngIf=\"!menuItem.divider || !isVisible(menuItem)\">\n            <ng-content *ngTemplateOutlet=\"menuItem.template; context: menuItem.context\"></ng-content>\n          </ng-container>\n        </div>\n      </div>\n    </ng-template>\n  ",
                    styles: [".sh-backdrop{background-color:transparent}.sh-context-menu{background:#fff;min-width:150px;border:1px solid rgba(0,0,0,.2);border-radius:3px;box-shadow:0 0 10px 2px rgba(0,0,0,.1);color:#656565;margin:0}.sh-context-menu--item{padding:7px 10px 7px 15px;transition:.15s}.sh-context-menu--item:hover,.sh-context-menu--item__sub-active{background-color:#ededed;cursor:pointer}.sh-context-menu--item.sh-context-menu--item__divider:hover{background-color:#ececec;color:#000;cursor:default}.sh-context-menu--item__divider{height:1px;padding:0;overflow:hidden;border-bottom:1px solid #d0d0d0}.sh-context-menu--item.sh-sub-anchor{position:relative;min-width:140px}.sh-sub-anchor:after{content:\"\";top:50%;right:6px;-webkit-transform:translateY(-50%);transform:translateY(-50%);position:absolute;border-top:4px solid transparent;border-bottom:4px solid transparent;border-left:5px solid #000}.sh-context-menu--item__disable{color:#a6a2a2}"]
                }] }
    ];
    /** @nocollapse */
    ShContextMenuComponent.ctorParameters = function () { return [
        { type: ShContextMenuService }
    ]; };
    ShContextMenuComponent.propDecorators = {
        thisContext: [{ type: Input, args: ['this',] }],
        contentChildrenItems: [{ type: ContentChildren, args: [ShContextMenuItemDirective, { read: ShContextMenuItemDirective },] }],
        viewChildrenItems: [{ type: ViewChildren, args: [ShContextMenuItemDirective, { read: ShContextMenuItemDirective },] }],
        menuTemplate: [{ type: ViewChild, args: ['menuTemplate', { read: TemplateRef },] }],
        menuContainer: [{ type: ViewChild, args: ['menuContainer', { read: ViewContainerRef },] }]
    };
    return ShContextMenuComponent;
}());
export { ShContextMenuComponent };
if (false) {
    /** @type {?} */
    ShContextMenuComponent.prototype.thisContext;
    /** @type {?} */
    ShContextMenuComponent.prototype.contentChildrenItems;
    /** @type {?} */
    ShContextMenuComponent.prototype.viewChildrenItems;
    /** @type {?} */
    ShContextMenuComponent.prototype.menuTemplate;
    /** @type {?} */
    ShContextMenuComponent.prototype.menuContainer;
    /** @type {?} */
    ShContextMenuComponent.prototype.overlayRef;
    /** @type {?} */
    ShContextMenuComponent.prototype.subActive;
    /**
     * @type {?}
     * @private
     */
    ShContextMenuComponent.prototype.ctxService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY29udGV4dC1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25nMi1yaWdodC1jbGljay1tZW51L3NoLWNvbnRleHQtbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQWEsU0FBUyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUN6RyxnQkFBZ0IsRUFDaEIsaUJBQWlCLEVBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQzVFLE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBRy9EO0lBc0NFLGdDQUFvQixVQUFnQztRQUFoQyxlQUFVLEdBQVYsVUFBVSxDQUFzQjtRQUNsRCxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxTQUFTLEVBQThCLENBQUM7UUFDeEUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksU0FBUyxFQUE4QixDQUFDO0lBQ3ZFLENBQUM7SUFFRCxzQkFBSSw2Q0FBUzs7OztRQUFiO1lBQ0UsbUZBQW1GO1lBQ25GLElBQUksSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRTtnQkFDcEMsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUM7YUFDbEM7WUFFRCx1RUFBdUU7WUFDdkUsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUM7UUFDaEMsQ0FBQzs7O09BQUE7Ozs7Ozs7SUFFRCx3Q0FBTzs7Ozs7O0lBQVAsVUFBUSxNQUFrQixFQUFFLElBQWdDLEVBQUUsR0FBZ0I7UUFDNUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFlBQVks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MEJBQTBCLEVBQUUsRUFBQyxJQUFJLEVBQUUsMEJBQTBCLEVBQUM7b0NBQzlFLFlBQVksU0FBQywwQkFBMEIsRUFBRSxFQUFDLElBQUksRUFBRSwwQkFBMEIsRUFBQzsrQkFFM0UsU0FBUyxTQUFDLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUM7Z0NBQzdDLFNBQVMsU0FBQyxlQUFlLEVBQUUsRUFBQyxJQUFJLEVBQUUsZ0JBQWdCLEVBQUM7O0lBd0Z0RCw2QkFBQztDQUFBLEFBekhELElBeUhDO1NBL0ZZLHNCQUFzQjs7O0lBQ2pDLDZDQUFnQzs7SUFFaEMsc0RBQXNHOztJQUN0RyxtREFBZ0c7O0lBRWhHLDhDQUE2RDs7SUFDN0QsK0NBQW9FOztJQUVwRSw0Q0FBOEI7O0lBQzlCLDJDQUFtQjs7Ozs7SUFFUCw0Q0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBFbGVtZW50UmVmLCBJbnB1dCwgT25EZXN0cm95LCBRdWVyeUxpc3QsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQsIFZpZXdDaGlsZHJlbixcclxuICBWaWV3Q29udGFpbmVyUmVmLFxyXG4gIFZpZXdFbmNhcHN1bGF0aW9uXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7U2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmV9IGZyb20gJy4vc2gtY29udGV4dC1tZW51LWl0ZW0uZGlyZWN0aXZlJztcclxuaW1wb3J0IHtTaENvbnRleHRNZW51U2VydmljZX0gZnJvbSAnLi9zaC1jb250ZXh0LW1lbnUuc2VydmljZSc7XHJcbmltcG9ydCB7T3ZlcmxheVJlZn0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdzaC1jb250ZXh0LW1lbnUnLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgc3R5bGVVcmxzOiBbJ3NoLWNvbnRleHQtbWVudS5jc3MnXSxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICAgPG5nLWNvbnRhaW5lciAjbWVudUNvbnRhaW5lcj48L25nLWNvbnRhaW5lcj5cclxuICAgIDxuZy10ZW1wbGF0ZSAjbWVudVRlbXBsYXRlPlxyXG4gICAgICA8ZGl2IGNsYXNzPVwic2gtY29udGV4dC1tZW51XCI+XHJcbiAgICAgICAgPGRpdlxyXG4gICAgICAgICAgKm5nRm9yPVwibGV0IG1lbnVJdGVtIG9mIG1lbnVJdGVtc1wiXHJcbiAgICAgICAgICAjaXRlbUVsZW1lbnRcclxuICAgICAgICAgIFtuZ0NsYXNzXT1cInsnc2gtc3ViLWFuY2hvcic6IG1lbnVJdGVtLnN1Yk1lbnUgJiYgbWVudUl0ZW0udmlzaWJsZSxcclxuICAgICAgICAgICAnc2gtY29udGV4dC1tZW51LS1pdGVtX19kaXNhYmxlJzogIW1lbnVJdGVtLnZpc2libGUsXHJcbiAgICAgICAgICAgJ3NoLWNvbnRleHQtbWVudS0taXRlbV9fZGl2aWRlcic6IG1lbnVJdGVtLmRpdmlkZXIsXHJcbiAgICAgICAgICAgJ3NoLWNvbnRleHQtbWVudS0taXRlbV9fc3ViLWFjdGl2ZSc6IHN1YkFjdGl2ZSAmJiBtZW51SXRlbS5hY3RpdmV9XCJcclxuICAgICAgICAgIGNsYXNzPVwic2gtY29udGV4dC1tZW51LS1pdGVtXCJcclxuICAgICAgICAgIChtb3VzZWVudGVyKT1cIm9uRW50ZXIoJGV2ZW50LCBtZW51SXRlbSwgaXRlbUVsZW1lbnQpXCJcclxuICAgICAgICAgIChjbGljayk9XCJvbkNsaWNrKCRldmVudCwgbWVudUl0ZW0pXCI+XHJcbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIW1lbnVJdGVtLmRpdmlkZXIgfHwgIWlzVmlzaWJsZShtZW51SXRlbSlcIj5cclxuICAgICAgICAgICAgPG5nLWNvbnRlbnQgKm5nVGVtcGxhdGVPdXRsZXQ9XCJtZW51SXRlbS50ZW1wbGF0ZTsgY29udGV4dDogbWVudUl0ZW0uY29udGV4dFwiPjwvbmctY29udGVudD5cclxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgYFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2hDb250ZXh0TWVudUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XHJcbiAgQElucHV0KCd0aGlzJykgdGhpc0NvbnRleHQ6IGFueTtcclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZSwge3JlYWQ6IFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlfSkgY29udGVudENoaWxkcmVuSXRlbXM7XHJcbiAgQFZpZXdDaGlsZHJlbihTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZSwge3JlYWQ6IFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlfSkgdmlld0NoaWxkcmVuSXRlbXM7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ21lbnVUZW1wbGF0ZScsIHtyZWFkOiBUZW1wbGF0ZVJlZn0pIG1lbnVUZW1wbGF0ZTtcclxuICBAVmlld0NoaWxkKCdtZW51Q29udGFpbmVyJywge3JlYWQ6IFZpZXdDb250YWluZXJSZWZ9KSBtZW51Q29udGFpbmVyO1xyXG5cclxuICBwdWJsaWMgb3ZlcmxheVJlZjogT3ZlcmxheVJlZjtcclxuICBzdWJBY3RpdmU6IGJvb2xlYW47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY3R4U2VydmljZTogU2hDb250ZXh0TWVudVNlcnZpY2UpIHtcclxuICAgIHRoaXMuY29udGVudENoaWxkcmVuSXRlbXMgPSBuZXcgUXVlcnlMaXN0PFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlPigpO1xyXG4gICAgdGhpcy52aWV3Q2hpbGRyZW5JdGVtcyA9IG5ldyBRdWVyeUxpc3Q8U2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmU+KCk7XHJcbiAgfVxyXG5cclxuICBnZXQgbWVudUl0ZW1zKCk6IFF1ZXJ5TGlzdDxTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZT4ge1xyXG4gICAgLy8gd2hlbiB1c2luZyB0aGUgU2hDb250ZXh0TWVudUNvbXBvbmVudCBhcyBtZW51LCB0aGUgQ29udGVudENoaWxkcmVuIGlzIHRoZSBzb3VyY2VcclxuICAgIGlmICh0aGlzLmNvbnRlbnRDaGlsZHJlbkl0ZW1zLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jb250ZW50Q2hpbGRyZW5JdGVtcztcclxuICAgIH1cclxuXHJcbiAgICAvLyB3aGVuIHVzaW5nIGEgY3VzdG9tIGNvbXBvbmVudCBhcyBtZW51IHRoZSBWaWV3Q2hpbGRyZW4gaXMgdGhlIHNvdXJjZVxyXG4gICAgcmV0dXJuIHRoaXMudmlld0NoaWxkcmVuSXRlbXM7XHJcbiAgfVxyXG5cclxuICBvbkVudGVyKCRldmVudDogTW91c2VFdmVudCwgaXRlbTogU2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmUsIGVsbTogSFRNTEVsZW1lbnQpIHtcclxuICAgIHRoaXMuY3R4U2VydmljZS5jbG9zZVN1Yk1lbnVzKHRoaXMpO1xyXG4gICAgdGhpcy5zZXROb3RBY3RpdmUoKTtcclxuXHJcbiAgICBpZiAoIWl0ZW0uc3ViTWVudSB8fCAhaXRlbS52aXNpYmxlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNldEFjdGl2ZShpdGVtKTtcclxuICAgIHRoaXMuY3R4U2VydmljZS5vcGVuU3ViTWVudSh7XHJcbiAgICAgIGRhdGE6IGl0ZW0uY29udGV4dC4kaW1wbGljaXQsXHJcbiAgICAgIHRhcmdldEVsZW1lbnQ6IG5ldyBFbGVtZW50UmVmKGVsbSksXHJcbiAgICAgIG1lbnU6IGl0ZW0uc3ViTWVudSxcclxuICAgICAgbW91c2VFdmVudDogJGV2ZW50LFxyXG4gICAgICBwYXJlbnRNZW51OiB0aGlzXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0QWN0aXZlKGl0ZW06IFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlKSB7XHJcbiAgICBpdGVtLnNldEFjdGl2ZSgpO1xyXG4gICAgdGhpcy5zdWJBY3RpdmUgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgb25DbGljayhldmVudDogTW91c2VFdmVudCwgaXRlbTogU2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmUpIHtcclxuICAgIC8vIFRPRE86IG1vdmUgY2xpY2sgaGFuZGxpbmcgdG8gc2VydmljZVxyXG5cclxuICAgIGlmIChpdGVtLmRpdmlkZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghaXRlbS5zdWJNZW51ICYmIGl0ZW0uY2xvc2VPbkNsaWNrKSB7XHJcbiAgICAgIHRoaXMuY3R4U2VydmljZS5kZXN0cm95KCk7XHJcblxyXG4gICAgICBpdGVtLmNsaWNrLmVtaXQoe1xyXG4gICAgICAgIGRhdGE6IGl0ZW0uY29udGV4dC4kaW1wbGljaXQsXHJcbiAgICAgICAgZXZlbnRcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGxXaXRoQ29udGV4dChmbiwgZmFsbGJhY2tDb250ZXh0LCBkYXRhLCBldmVudCkge1xyXG4gICAgcmV0dXJuIGZuLmNhbGwodGhpcy50aGlzQ29udGV4dCA/IHRoaXMudGhpc0NvbnRleHQgOiBmYWxsYmFja0NvbnRleHQsIHtkYXRhLCBldmVudH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNldE5vdEFjdGl2ZSgpO1xyXG4gICAgdGhpcy5tZW51Q29udGFpbmVyLmRldGFjaCgpO1xyXG4gICAgaWYodGhpcy5vdmVybGF5UmVmKSB7XHJcbiAgICAgICB0aGlzLm92ZXJsYXlSZWYuZGV0YWNoKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuY2xvc2UoKTtcclxuICB9XHJcblxyXG4gIHNldE5vdEFjdGl2ZSgpIHtcclxuICAgIHRoaXMuc3ViQWN0aXZlID0gZmFsc2U7XHJcbiAgICB0aGlzLm1lbnVJdGVtcy5mb3JFYWNoKGkgPT4gaS5zZXROb3RBY3RpdmUoKSk7XHJcbiAgfVxyXG5cclxuICBpc1Zpc2libGUoaXRlbTogU2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmUpIHtcclxuICAgIGlmICghaXRlbS52aXNpYmxlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmNhbGxXaXRoQ29udGV4dChpdGVtLnZpc2libGUsIHRoaXMsIGl0ZW0uY29udGV4dC4kaW1wbGljaXQsIG51bGwpO1xyXG4gIH1cclxufVxyXG4iXX0=
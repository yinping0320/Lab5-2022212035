/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { Overlay } from '@angular/cdk/overlay';
import { TemplatePortal } from '@angular/cdk/portal';
import { fromEvent } from 'rxjs/observable/fromEvent';
var ShContextMenuService = /** @class */ (function () {
    function ShContextMenuService(overlay) {
        this.overlay = overlay;
        this.activeOverlays = [];
    }
    /**
     * @param {?} ctxEvent
     * @return {?}
     */
    ShContextMenuService.prototype.openMenu = /**
     * @param {?} ctxEvent
     * @return {?}
     */
    function (ctxEvent) {
        this.closeCurrentOverlays();
        var menu = ctxEvent.menu, mouseEvent = ctxEvent.mouseEvent, targetElement = ctxEvent.targetElement, data = ctxEvent.data;
        this.activeMenu = menu;
        mouseEvent.preventDefault();
        mouseEvent.stopPropagation();
        this.overrideGetBoundingClientRect(targetElement, mouseEvent);
        /** @type {?} */
        var scrollStrategy = this.buildCloseScrollStrategy();
        /** @type {?} */
        var positionStrategy = this.buildConnectedPositionStrategy(targetElement);
        this.attachContextToItems(menu, data);
        /** @type {?} */
        var overlayRef = this.createAndAttachOverlay(positionStrategy, scrollStrategy, menu, true);
        this.attachOverlayRef(menu, overlayRef);
        this.registerBackdropEvents(overlayRef);
    };
    /**
     * @param {?} ctxEvent
     * @return {?}
     */
    ShContextMenuService.prototype.openSubMenu = /**
     * @param {?} ctxEvent
     * @return {?}
     */
    function (ctxEvent) {
        var menu = ctxEvent.menu, mouseEvent = ctxEvent.mouseEvent, targetElement = ctxEvent.targetElement, data = ctxEvent.data, parentMenu = ctxEvent.parentMenu;
        mouseEvent.preventDefault();
        mouseEvent.stopPropagation();
        /** @type {?} */
        var scrollStrategy = this.buildCloseScrollStrategy();
        /** @type {?} */
        var positionStrategy = this.buildConnectedPositionStrategyForSubMenu(targetElement);
        /** @type {?} */
        var overlayRef = this.createAndAttachOverlay(positionStrategy, scrollStrategy, menu, false);
        this.attachContextToItems(menu, data);
        this.attachThisContext(menu, parentMenu);
        this.attachOverlayRef(menu, overlayRef);
    };
    /**
     * @return {?}
     */
    ShContextMenuService.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this.closeCurrentOverlays();
        this.backDropSub.unsubscribe();
    };
    /**
     * @return {?}
     */
    ShContextMenuService.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy();
    };
    /**
     * @param {?} menu
     * @return {?}
     */
    ShContextMenuService.prototype.closeSubMenus = /**
     * @param {?} menu
     * @return {?}
     */
    function (menu) {
        var _this = this;
        /** @type {?} */
        var itemsWithSubMenus = menu
            .menuItems
            .filter(function (i) { return !!i.subMenu && !!i.subMenu.overlayRef; });
        if (itemsWithSubMenus.length) {
            itemsWithSubMenus.forEach(function (sm) { return _this.closeSubMenus(sm.subMenu); });
            /** @type {?} */
            var overlayRefs = itemsWithSubMenus
                .map(function (i) { return i.subMenu.overlayRef; });
            overlayRefs.forEach(function (r) { return r.dispose(); });
        }
    };
    /**
     * @private
     * @param {?} overlayRef
     * @return {?}
     */
    ShContextMenuService.prototype.registerBackdropEvents = /**
     * @private
     * @param {?} overlayRef
     * @return {?}
     */
    function (overlayRef) {
        /** @type {?} */
        var elm = overlayRef.backdropElement;
        this.backDropSub = fromEvent(elm, 'mousedown')
            .subscribe(this.closeCurrentOverlays.bind(this));
    };
    /**
     * @private
     * @param {?} positionStrategy
     * @param {?} scrollStrategy
     * @param {?} menu
     * @param {?=} hasBackdrop
     * @return {?}
     */
    ShContextMenuService.prototype.createAndAttachOverlay = /**
     * @private
     * @param {?} positionStrategy
     * @param {?} scrollStrategy
     * @param {?} menu
     * @param {?=} hasBackdrop
     * @return {?}
     */
    function (positionStrategy, scrollStrategy, menu, hasBackdrop) {
        if (hasBackdrop === void 0) { hasBackdrop = true; }
        /** @type {?} */
        var overlayRef = this.overlay.create({
            positionStrategy: positionStrategy,
            scrollStrategy: scrollStrategy,
            hasBackdrop: hasBackdrop,
            backdropClass: 'sh-backdrop'
        });
        /*
             TODO: try passing the TemplatePortal context (data)
             and then injecting it to the *ngTemplateOutlet in the component template
            */
        /** @type {?} */
        var menuPortal = new TemplatePortal(menu.menuTemplate, menu.menuContainer);
        overlayRef.attach(menuPortal);
        this.activeOverlays.push(overlayRef);
        return overlayRef;
    };
    /**
     * @private
     * @return {?}
     */
    ShContextMenuService.prototype.buildCloseScrollStrategy = /**
     * @private
     * @return {?}
     */
    function () {
        return this.overlay.scrollStrategies.close();
    };
    /**
     * @private
     * @param {?} elm
     * @return {?}
     */
    ShContextMenuService.prototype.buildConnectedPositionStrategy = /**
     * @private
     * @param {?} elm
     * @return {?}
     */
    function (elm) {
        return this
            .overlay
            .position()
            .connectedTo(elm, { originX: 'start', originY: 'bottom' }, { overlayX: 'start', overlayY: 'top' })
            .withFallbackPosition({ originX: 'start', originY: 'top' }, { overlayX: 'start', overlayY: 'bottom' })
            .withFallbackPosition({ originX: 'end', originY: 'top' }, { overlayX: 'start', overlayY: 'top' })
            .withFallbackPosition({ originX: 'start', originY: 'top' }, { overlayX: 'end', overlayY: 'top' })
            .withFallbackPosition({ originX: 'end', originY: 'center' }, { overlayX: 'start', overlayY: 'center' })
            .withFallbackPosition({ originX: 'start', originY: 'center' }, { overlayX: 'end', overlayY: 'center' });
    };
    /**
     * @private
     * @param {?} elm
     * @return {?}
     */
    ShContextMenuService.prototype.buildConnectedPositionStrategyForSubMenu = /**
     * @private
     * @param {?} elm
     * @return {?}
     */
    function (elm) {
        return this
            .overlay
            .position()
            .connectedTo(elm, { originX: 'end', originY: 'top' }, { overlayX: 'start', overlayY: 'top' })
            .withFallbackPosition({ originX: 'start', originY: 'top' }, { overlayX: 'end', overlayY: 'top' })
            .withFallbackPosition({ originX: 'end', originY: 'bottom' }, { overlayX: 'start', overlayY: 'bottom' })
            .withFallbackPosition({ originX: 'start', originY: 'bottom' }, { overlayX: 'end', overlayY: 'bottom' });
    };
    /*
      we need to override getBoundingClientRect() to return the position of the menu.
      this is done because @angular/cdk use this function internally to determine where the overlay should be positioned
      https://github.com/angular/material2/blob/master/src/cdk/overlay/position/connected-position-strategy.ts#L288
     */
    /*
        we need to override getBoundingClientRect() to return the position of the menu.
        this is done because @angular/cdk use this function internally to determine where the overlay should be positioned
        https://github.com/angular/material2/blob/master/src/cdk/overlay/position/connected-position-strategy.ts#L288
       */
    /**
     * @private
     * @param {?} elm
     * @param {?} event
     * @return {?}
     */
    ShContextMenuService.prototype.overrideGetBoundingClientRect = /*
        we need to override getBoundingClientRect() to return the position of the menu.
        this is done because @angular/cdk use this function internally to determine where the overlay should be positioned
        https://github.com/angular/material2/blob/master/src/cdk/overlay/position/connected-position-strategy.ts#L288
       */
    /**
     * @private
     * @param {?} elm
     * @param {?} event
     * @return {?}
     */
    function (elm, event) {
        var clientX = event.clientX, clientY = event.clientY;
        elm.nativeElement.getBoundingClientRect = function () {
            return {
                bottom: clientY,
                height: 0,
                left: clientX,
                right: clientX,
                top: clientY,
                width: 0
            };
        };
    };
    /**
     * @private
     * @return {?}
     */
    ShContextMenuService.prototype.closeCurrentOverlays = /**
     * @private
     * @return {?}
     */
    function () {
        this.activeOverlays.forEach(function (o) {
            o.detach();
            o.dispose();
        });
        this.activeOverlays = [];
        // TODO: create close subject and emit.
        // subscribe in component
        if (this.activeMenu) {
            this.activeMenu.close();
        }
    };
    /**
     * @private
     * @param {?} menu
     * @param {?} data
     * @return {?}
     */
    ShContextMenuService.prototype.attachContextToItems = /**
     * @private
     * @param {?} menu
     * @param {?} data
     * @return {?}
     */
    function (menu, data) {
        menu.menuItems.forEach(function (i) { return i.context.$implicit = data; });
    };
    /**
     * @private
     * @param {?} menu
     * @param {?} parentMenu
     * @return {?}
     */
    ShContextMenuService.prototype.attachThisContext = /**
     * @private
     * @param {?} menu
     * @param {?} parentMenu
     * @return {?}
     */
    function (menu, parentMenu) {
        menu.thisContext = parentMenu.thisContext;
    };
    /**
     * @private
     * @param {?} menu
     * @param {?} overlayRef
     * @return {?}
     */
    ShContextMenuService.prototype.attachOverlayRef = /**
     * @private
     * @param {?} menu
     * @param {?} overlayRef
     * @return {?}
     */
    function (menu, overlayRef) {
        menu.overlayRef = overlayRef;
    };
    ShContextMenuService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ShContextMenuService.ctorParameters = function () { return [
        { type: Overlay }
    ]; };
    return ShContextMenuService;
}());
export { ShContextMenuService };
if (false) {
    /** @type {?} */
    ShContextMenuService.prototype.activeOverlays;
    /** @type {?} */
    ShContextMenuService.prototype.backDropSub;
    /** @type {?} */
    ShContextMenuService.prototype.activeMenu;
    /**
     * @type {?}
     * @private
     */
    ShContextMenuService.prototype.overlay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY29udGV4dC1tZW51LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2lkZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9uZzItcmlnaHQtY2xpY2stbWVudS9zaC1jb250ZXh0LW1lbnUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFhLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUVoRSxPQUFPLEVBQXNCLE9BQU8sRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2xFLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUluRCxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFHcEQ7SUFPRSw4QkFBb0IsT0FBZ0I7UUFBaEIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUxwQyxtQkFBYyxHQUFpQixFQUFFLENBQUM7SUFNbEMsQ0FBQzs7Ozs7SUFFRCx1Q0FBUTs7OztJQUFSLFVBQVMsUUFBNEI7UUFDbkMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDckIsSUFBQSxvQkFBSSxFQUFFLGdDQUFVLEVBQUUsc0NBQWEsRUFBRSxvQkFBSTtRQUU1QyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUV2QixVQUFVLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDNUIsVUFBVSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRTdCLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxhQUFhLEVBQUUsVUFBVSxDQUFDLENBQUM7O1lBRXhELGNBQWMsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7O1lBQ2hELGdCQUFnQixHQUFHLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxhQUFhLENBQUM7UUFFM0UsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQzs7WUFFaEMsVUFBVSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FB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QkFqTUYsVUFBVTs7OztnQkFSa0IsT0FBTzs7SUEwTXBDLDJCQUFDO0NBQUEsQUFsTUQsSUFrTUM7U0FqTVksb0JBQW9COzs7SUFDL0IsOENBQWtDOztJQUNsQywyQ0FBMEI7O0lBRTFCLDBDQUFtQzs7Ozs7SUFFdkIsdUNBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFbGVtZW50UmVmLCBJbmplY3RhYmxlLCBPbkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1NoQ29udGV4dE1lbnVDb21wb25lbnR9IGZyb20gJy4vc2gtY29udGV4dC1tZW51LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7Q2xvc2VTY3JvbGxTdHJhdGVneSwgT3ZlcmxheX0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xyXG5pbXBvcnQge1RlbXBsYXRlUG9ydGFsfSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcclxuaW1wb3J0IHtDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5fSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheS90eXBpbmdzL3Bvc2l0aW9uL2Nvbm5lY3RlZC1wb3NpdGlvbi1zdHJhdGVneSc7XHJcbmltcG9ydCB7U2hDb250ZXh0TWVudUV2ZW50LCBTaENvbnRleHRTdWJNZW51RXZlbnR9IGZyb20gJy4vc2gtY29udGV4dC1tZW51Lm1vZGVscyc7XHJcbmltcG9ydCB7T3ZlcmxheVJlZn0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xyXG5pbXBvcnQge2Zyb21FdmVudH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL2Zyb21FdmVudCc7XHJcbmltcG9ydCB7U3Vic2NyaXB0aW9ufSBmcm9tICdyeGpzL1N1YnNjcmlwdGlvbic7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBTaENvbnRleHRNZW51U2VydmljZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XHJcbiAgYWN0aXZlT3ZlcmxheXM6IE92ZXJsYXlSZWZbXSA9IFtdO1xyXG4gIGJhY2tEcm9wU3ViOiBTdWJzY3JpcHRpb247XHJcblxyXG4gIGFjdGl2ZU1lbnU6IFNoQ29udGV4dE1lbnVDb21wb25lbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgb3ZlcmxheTogT3ZlcmxheSkge1xyXG4gIH1cclxuXHJcbiAgb3Blbk1lbnUoY3R4RXZlbnQ6IFNoQ29udGV4dE1lbnVFdmVudCkge1xyXG4gICAgdGhpcy5jbG9zZUN1cnJlbnRPdmVybGF5cygpO1xyXG4gICAgY29uc3Qge21lbnUsIG1vdXNlRXZlbnQsIHRhcmdldEVsZW1lbnQsIGRhdGF9ID0gY3R4RXZlbnQ7XHJcblxyXG4gICAgdGhpcy5hY3RpdmVNZW51ID0gbWVudTtcclxuXHJcbiAgICBtb3VzZUV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBtb3VzZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuICAgIHRoaXMub3ZlcnJpZGVHZXRCb3VuZGluZ0NsaWVudFJlY3QodGFyZ2V0RWxlbWVudCwgbW91c2VFdmVudCk7XHJcblxyXG4gICAgY29uc3Qgc2Nyb2xsU3RyYXRlZ3kgPSB0aGlzLmJ1aWxkQ2xvc2VTY3JvbGxTdHJhdGVneSgpO1xyXG4gICAgY29uc3QgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuYnVpbGRDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5KHRhcmdldEVsZW1lbnQpO1xyXG5cclxuICAgIHRoaXMuYXR0YWNoQ29udGV4dFRvSXRlbXMobWVudSwgZGF0YSk7XHJcblxyXG4gICAgY29uc3Qgb3ZlcmxheVJlZiA9IHRoaXMuY3JlYXRlQW5kQXR0YWNoT3ZlcmxheShwb3NpdGlvblN0cmF0ZWd5LCBzY3JvbGxTdHJhdGVneSwgbWVudSwgdHJ1ZSk7XHJcbiAgICB0aGlzLmF0dGFjaE92ZXJsYXlSZWYobWVudSwgb3ZlcmxheVJlZik7XHJcblxyXG4gICAgdGhpcy5yZWdpc3RlckJhY2tkcm9wRXZlbnRzKG92ZXJsYXlSZWYpO1xyXG4gIH1cclxuXHJcbiAgb3BlblN1Yk1lbnUoY3R4RXZlbnQ6IFNoQ29udGV4dFN1Yk1lbnVFdmVudCk6IGFueSB7XHJcbiAgICBjb25zdCB7bWVudSwgbW91c2VFdmVudCwgdGFyZ2V0RWxlbWVudCwgZGF0YSwgcGFyZW50TWVudX0gPSBjdHhFdmVudDtcclxuXHJcbiAgICBtb3VzZUV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBtb3VzZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuICAgIGNvbnN0IHNjcm9sbFN0cmF0ZWd5ID0gdGhpcy5idWlsZENsb3NlU2Nyb2xsU3RyYXRlZ3koKTtcclxuICAgIGNvbnN0IHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLmJ1aWxkQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneUZvclN1Yk1lbnUodGFyZ2V0RWxlbWVudCk7XHJcbiAgICBjb25zdCBvdmVybGF5UmVmID0gdGhpcy5jcmVhdGVBbmRBdHRhY2hPdmVybGF5KHBvc2l0aW9uU3RyYXRlZ3ksIHNjcm9sbFN0cmF0ZWd5LCBtZW51LCBmYWxzZSk7XHJcblxyXG4gICAgdGhpcy5hdHRhY2hDb250ZXh0VG9JdGVtcyhtZW51LCBkYXRhKTtcclxuICAgIHRoaXMuYXR0YWNoVGhpc0NvbnRleHQobWVudSwgcGFyZW50TWVudSk7XHJcbiAgICB0aGlzLmF0dGFjaE92ZXJsYXlSZWYobWVudSwgb3ZlcmxheVJlZik7XHJcbiAgfVxyXG5cclxuICBkZXN0cm95KCkge1xyXG4gICAgdGhpcy5jbG9zZUN1cnJlbnRPdmVybGF5cygpO1xyXG4gICAgdGhpcy5iYWNrRHJvcFN1Yi51bnN1YnNjcmliZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRlc3Ryb3koKTtcclxuICB9XHJcblxyXG4gIGNsb3NlU3ViTWVudXMobWVudTogU2hDb250ZXh0TWVudUNvbXBvbmVudCkge1xyXG4gICAgY29uc3QgaXRlbXNXaXRoU3ViTWVudXMgPSBtZW51XHJcbiAgICAgIC5tZW51SXRlbXNcclxuICAgICAgLmZpbHRlcihpID0+ICEhaS5zdWJNZW51ICYmICEhaS5zdWJNZW51Lm92ZXJsYXlSZWYpO1xyXG5cclxuICAgIGlmIChpdGVtc1dpdGhTdWJNZW51cy5sZW5ndGgpIHtcclxuICAgICAgaXRlbXNXaXRoU3ViTWVudXMuZm9yRWFjaChzbSA9PiB0aGlzLmNsb3NlU3ViTWVudXMoc20uc3ViTWVudSkpO1xyXG5cclxuICAgICAgY29uc3Qgb3ZlcmxheVJlZnMgPSBpdGVtc1dpdGhTdWJNZW51c1xyXG4gICAgICAgIC5tYXAoaSA9PiBpLnN1Yk1lbnUub3ZlcmxheVJlZik7XHJcblxyXG4gICAgICBvdmVybGF5UmVmcy5mb3JFYWNoKHIgPT4gci5kaXNwb3NlKCkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWdpc3RlckJhY2tkcm9wRXZlbnRzKG92ZXJsYXlSZWY6IE92ZXJsYXlSZWYpIHtcclxuICAgIGNvbnN0IGVsbSA9IG92ZXJsYXlSZWYuYmFja2Ryb3BFbGVtZW50O1xyXG5cclxuICAgIHRoaXMuYmFja0Ryb3BTdWIgPSBmcm9tRXZlbnQoZWxtLCAnbW91c2Vkb3duJylcclxuICAgICAgLnN1YnNjcmliZSh0aGlzLmNsb3NlQ3VycmVudE92ZXJsYXlzLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVBbmRBdHRhY2hPdmVybGF5KHBvc2l0aW9uU3RyYXRlZ3k6IENvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3ksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFN0cmF0ZWd5OiBDbG9zZVNjcm9sbFN0cmF0ZWd5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51OiBTaENvbnRleHRNZW51Q29tcG9uZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNCYWNrZHJvcDogYm9vbGVhbiA9IHRydWUpIHtcclxuXHJcbiAgICBjb25zdCBvdmVybGF5UmVmID0gdGhpcy5vdmVybGF5LmNyZWF0ZSh7XHJcbiAgICAgIHBvc2l0aW9uU3RyYXRlZ3ksXHJcbiAgICAgIHNjcm9sbFN0cmF0ZWd5LFxyXG4gICAgICBoYXNCYWNrZHJvcDogaGFzQmFja2Ryb3AsXHJcbiAgICAgIGJhY2tkcm9wQ2xhc3M6ICdzaC1iYWNrZHJvcCdcclxuICAgIH0pO1xyXG5cclxuICAgIC8qXHJcbiAgICAgVE9ETzogdHJ5IHBhc3NpbmcgdGhlIFRlbXBsYXRlUG9ydGFsIGNvbnRleHQgKGRhdGEpXHJcbiAgICAgYW5kIHRoZW4gaW5qZWN0aW5nIGl0IHRvIHRoZSAqbmdUZW1wbGF0ZU91dGxldCBpbiB0aGUgY29tcG9uZW50IHRlbXBsYXRlXHJcbiAgICAqL1xyXG4gICAgY29uc3QgbWVudVBvcnRhbCA9IG5ldyBUZW1wbGF0ZVBvcnRhbChtZW51Lm1lbnVUZW1wbGF0ZSwgbWVudS5tZW51Q29udGFpbmVyKTtcclxuICAgIG92ZXJsYXlSZWYuYXR0YWNoKG1lbnVQb3J0YWwpO1xyXG5cclxuICAgIHRoaXMuYWN0aXZlT3ZlcmxheXMucHVzaChvdmVybGF5UmVmKTtcclxuXHJcbiAgICByZXR1cm4gb3ZlcmxheVJlZjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYnVpbGRDbG9zZVNjcm9sbFN0cmF0ZWd5KCkge1xyXG4gICAgcmV0dXJuIHRoaXMub3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLmNsb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJ1aWxkQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneShlbG06IEVsZW1lbnRSZWYpOiBDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5IHtcclxuICAgIHJldHVybiB0aGlzXHJcbiAgICAgIC5vdmVybGF5XHJcbiAgICAgIC5wb3NpdGlvbigpXHJcbiAgICAgIC5jb25uZWN0ZWRUbyhlbG0sXHJcbiAgICAgICAge29yaWdpblg6ICdzdGFydCcsIG9yaWdpblk6ICdib3R0b20nfSxcclxuICAgICAgICB7b3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAndG9wJ30pXHJcbiAgICAgIC53aXRoRmFsbGJhY2tQb3NpdGlvbihcclxuICAgICAgICB7b3JpZ2luWDogJ3N0YXJ0Jywgb3JpZ2luWTogJ3RvcCd9LFxyXG4gICAgICAgIHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICdib3R0b20nfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ3RvcCd9LFxyXG4gICAgICAgIHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICd0b3AnfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAndG9wJ30sXHJcbiAgICAgICAge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICd0b3AnfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ2NlbnRlcid9LFxyXG4gICAgICAgIHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICdjZW50ZXInfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnY2VudGVyJ30sXHJcbiAgICAgICAge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICdjZW50ZXInfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJ1aWxkQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneUZvclN1Yk1lbnUoZWxtOiBFbGVtZW50UmVmKTogQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneSB7XHJcbiAgICByZXR1cm4gdGhpc1xyXG4gICAgICAub3ZlcmxheVxyXG4gICAgICAucG9zaXRpb24oKVxyXG4gICAgICAuY29ubmVjdGVkVG8oZWxtLFxyXG4gICAgICAgIHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ3RvcCd9LFxyXG4gICAgICAgIHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICd0b3AnfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAndG9wJ30sXHJcbiAgICAgICAge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICd0b3AnfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ2JvdHRvbSd9LFxyXG4gICAgICAgIHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICdib3R0b20nfSlcclxuICAgICAgLndpdGhGYWxsYmFja1Bvc2l0aW9uKFxyXG4gICAgICAgIHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnYm90dG9tJ30sXHJcbiAgICAgICAge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICdib3R0b20nfSk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAgd2UgbmVlZCB0byBvdmVycmlkZSBnZXRCb3VuZGluZ0NsaWVudFJlY3QoKSB0byByZXR1cm4gdGhlIHBvc2l0aW9uIG9mIHRoZSBtZW51LlxyXG4gICAgdGhpcyBpcyBkb25lIGJlY2F1c2UgQGFuZ3VsYXIvY2RrIHVzZSB0aGlzIGZ1bmN0aW9uIGludGVybmFsbHkgdG8gZGV0ZXJtaW5lIHdoZXJlIHRoZSBvdmVybGF5IHNob3VsZCBiZSBwb3NpdGlvbmVkXHJcbiAgICBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9tYXRlcmlhbDIvYmxvYi9tYXN0ZXIvc3JjL2Nkay9vdmVybGF5L3Bvc2l0aW9uL2Nvbm5lY3RlZC1wb3NpdGlvbi1zdHJhdGVneS50cyNMMjg4XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvdmVycmlkZUdldEJvdW5kaW5nQ2xpZW50UmVjdChlbG06IEVsZW1lbnRSZWYsIGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICBjb25zdCB7Y2xpZW50WCwgY2xpZW50WX0gPSBldmVudDtcclxuXHJcbiAgICBlbG0ubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QgPSAoKTogQ2xpZW50UmVjdCA9PiB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgYm90dG9tOiBjbGllbnRZLFxyXG4gICAgICAgIGhlaWdodDogMCxcclxuICAgICAgICBsZWZ0OiBjbGllbnRYLFxyXG4gICAgICAgIHJpZ2h0OiBjbGllbnRYLFxyXG4gICAgICAgIHRvcDogY2xpZW50WSxcclxuICAgICAgICB3aWR0aDogMFxyXG4gICAgICB9O1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xvc2VDdXJyZW50T3ZlcmxheXMoKSB7XHJcbiAgICB0aGlzLmFjdGl2ZU92ZXJsYXlzLmZvckVhY2goKG8pID0+IHtcclxuICAgICAgby5kZXRhY2goKTtcclxuICAgICAgby5kaXNwb3NlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmFjdGl2ZU92ZXJsYXlzID0gW107XHJcblxyXG4gICAgLy8gVE9ETzogY3JlYXRlIGNsb3NlIHN1YmplY3QgYW5kIGVtaXQuXHJcbiAgICAvLyBzdWJzY3JpYmUgaW4gY29tcG9uZW50XHJcbiAgICBpZiAodGhpcy5hY3RpdmVNZW51KSB7XHJcbiAgICAgIHRoaXMuYWN0aXZlTWVudS5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhdHRhY2hDb250ZXh0VG9JdGVtcyhtZW51OiBTaENvbnRleHRNZW51Q29tcG9uZW50LCBkYXRhOiBhbnkpIHtcclxuICAgIG1lbnUubWVudUl0ZW1zLmZvckVhY2goaSA9PiBpLmNvbnRleHQuJGltcGxpY2l0ID0gZGF0YSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGF0dGFjaFRoaXNDb250ZXh0KG1lbnU6IFNoQ29udGV4dE1lbnVDb21wb25lbnQsIHBhcmVudE1lbnU6IFNoQ29udGV4dE1lbnVDb21wb25lbnQpIHtcclxuICAgIG1lbnUudGhpc0NvbnRleHQgPSBwYXJlbnRNZW51LnRoaXNDb250ZXh0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhdHRhY2hPdmVybGF5UmVmKG1lbnU6IFNoQ29udGV4dE1lbnVDb21wb25lbnQsIG92ZXJsYXlSZWY6IE92ZXJsYXlSZWYpIHtcclxuICAgIG1lbnUub3ZlcmxheVJlZiA9IG92ZXJsYXlSZWY7XHJcbiAgfVxyXG59XHJcbiJdfQ==
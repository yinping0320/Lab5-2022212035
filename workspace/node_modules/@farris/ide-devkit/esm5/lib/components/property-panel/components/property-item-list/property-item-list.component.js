/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChildren, ViewEncapsulation } from '@angular/core';
import { ElementPropertyConfig } from '../../entity/property-entity';
import { PropertyItemComponent } from '../property-item/property-item.component';
var PropertyItemListComponent = /** @class */ (function () {
    function PropertyItemListComponent() {
        // 属性值
        this.valueChanged = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.triggerRefreshPanel = new EventEmitter();
    }
    /**
     * @param {?} simpleChanges
     * @return {?}
     */
    PropertyItemListComponent.prototype.ngOnChanges = /**
     * @param {?} simpleChanges
     * @return {?}
     */
    function (simpleChanges) {
        // 若分类下有propertyData，则取分类下的propertyData；否则取整体的propertyData
        if (this.category.propertyData && this.category.enableCascade) {
            this.data = this.category.propertyData;
        }
        else {
            this.data = this.propertyData;
        }
        this.adaptProperties();
    };
    /**
     * 适配属性
     */
    /**
     * 适配属性
     * @private
     * @return {?}
     */
    PropertyItemListComponent.prototype.adaptProperties = /**
     * 适配属性
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.category.properties.forEach(function (propItem) {
            if (propItem.propertyType === 'cascade') {
                _this.cascadeValueStringify(propItem, _this.data[propItem.propertyID]);
                if (Object.keys(propItem).indexOf('visible') < 0) {
                    propItem.visible = true;
                }
            }
        });
    };
    /**
     * @return {?}
     */
    PropertyItemListComponent.prototype.refresh = /**
     * @return {?}
     */
    function () {
        // 若分类下有propertyData，则取分类下的propertyData；否则取整体的propertyData
        if (this.category.propertyData && this.category.enableCascade) {
            this.data = this.category.propertyData;
        }
        else {
            this.data = this.propertyData;
        }
        this.items.forEach(function (item) { return item.refresh(); });
    };
    /**
     * 一般属性变更
     * @param $event
     */
    /**
     * 一般属性变更
     * @param {?} $event
     * @return {?}
     */
    PropertyItemListComponent.prototype._itemChanged = /**
     * 一般属性变更
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var changeObject = $event.changeObject;
        this.data[changeObject.propertyID] = changeObject.propertyValue;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data);
            this.items.forEach(function (item) { return item.refresh(); });
        }
        changeObject.categoryId = this.category.categoryId;
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID;
        }
        this.valueChanged.emit(changeObject);
    };
    /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param $event
     */
    /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param {?} $event
     * @return {?}
     */
    PropertyItemListComponent.prototype._submitModal = /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var changeObject = $event.changeObject, parameters = $event.parameters;
        this.data[changeObject.propertyID] = changeObject.propertyValue;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data, parameters);
            this.items.forEach(function (item) { return item.refresh(); });
        }
        changeObject.categoryId = this.category.categoryId;
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID;
        }
        this.submitModal.emit($event);
    };
    /**
     * 级联属性变更
     */
    /**
     * 级联属性变更
     * @param {?} $event
     * @param {?} propItem
     * @return {?}
     */
    PropertyItemListComponent.prototype._cascadeitemChanged = /**
     * 级联属性变更
     * @param {?} $event
     * @param {?} propItem
     * @return {?}
     */
    function ($event, propItem) {
        /** @type {?} */
        var parentPropertyID = propItem.propertyID;
        if (!parentPropertyID) {
            return;
        }
        var changeObject = $event.changeObject;
        if (!this.data[parentPropertyID]) {
            this.data[parentPropertyID] = {};
        }
        this.data[parentPropertyID][changeObject.propertyID] = changeObject.propertyValue;
        changeObject.categoryId = this.category.categoryId;
        changeObject.parentPropertyID = changeObject.propertyPath = parentPropertyID;
        // 分类启用了级联，并且分类下有级联属性
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID + '.' + changeObject.parentPropertyID;
        }
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data);
            this.items.forEach(function (item) { return item.refresh(); });
        }
        this.cascadeValueStringify(propItem, this.data[parentPropertyID]);
        this.valueChanged.emit(changeObject);
    };
    /**
     * 级联模态框属性变更
     */
    /**
     * 级联模态框属性变更
     * @param {?} $event
     * @param {?} propItem
     * @return {?}
     */
    PropertyItemListComponent.prototype.__cascadeitemSubmitModal = /**
     * 级联模态框属性变更
     * @param {?} $event
     * @param {?} propItem
     * @return {?}
     */
    function ($event, propItem) {
        /** @type {?} */
        var parentPropertyID = propItem.propertyID;
        if (!parentPropertyID) {
            return;
        }
        var changeObject = $event.changeObject, parameters = $event.parameters;
        if (!this.data[parentPropertyID]) {
            this.data[parentPropertyID] = {};
        }
        this.data[parentPropertyID][changeObject.propertyID] = changeObject.propertyValue;
        changeObject.categoryId = this.category.categoryId;
        changeObject.parentPropertyID = changeObject.propertyPath = parentPropertyID;
        // 分类启用了级联，并且分类下有级联属性
        if (this.category.enableCascade) {
            changeObject.propertyPath = this.category.parentPropertyID + '.' + changeObject.parentPropertyID;
        }
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data, parameters);
            this.items.forEach(function (item) { return item.refresh(); });
        }
        this.cascadeValueStringify(propItem, this.data[parentPropertyID]);
        this.submitModal.emit($event);
    };
    /**
     * 级联属性的汇总信息
     * @param propItem
     * @param valueObject
     */
    /**
     * 级联属性的汇总信息
     * @param {?} propItem
     * @param {?} valueObject
     * @return {?}
     */
    PropertyItemListComponent.prototype.cascadeValueStringify = /**
     * 级联属性的汇总信息
     * @param {?} propItem
     * @param {?} valueObject
     * @return {?}
     */
    function (propItem, valueObject) {
        if (!propItem || !propItem.cascadeConfig) {
            return;
        }
        if (!valueObject) {
            propItem.cascadeSummary = '';
            return;
        }
        if (!propItem.cascadeConverter || !propItem.cascadeConverter.convertTo) {
            propItem.cascadeSummary = JSON.stringify(valueObject);
        }
        else {
            propItem.cascadeSummary = propItem.cascadeConverter.convertTo(valueObject, propItem.cascadeConfig);
        }
    };
    /**
     *  已废弃
     */
    /**
     *  已废弃
     * @param {?} propItem
     * @return {?}
     */
    PropertyItemListComponent.prototype._checkCascadeVisible = /**
     *  已废弃
     * @param {?} propItem
     * @return {?}
     */
    function (propItem) {
        if (Object.keys(propItem).indexOf('visible') < 0) {
            return true;
        }
        else {
            return propItem.visible;
        }
    };
    /**
     * @return {?}
     */
    PropertyItemListComponent.prototype.refreshPanel = /**
     * @return {?}
     */
    function () {
        this.triggerRefreshPanel.emit();
    };
    /**
     * @param {?} index
     * @param {?} PropItem
     * @return {?}
     */
    PropertyItemListComponent.prototype.trackByPropId = /**
     * @param {?} index
     * @param {?} PropItem
     * @return {?}
     */
    function (index, PropItem) {
        return PropItem.propertyID;
    };
    PropertyItemListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'webide-property-item-list',
                    template: "<div *ngFor=\"let propItem of category.properties; trackBy:trackByPropId\">\r\n    <div *ngIf=\"propItem.propertyType != 'cascade'\" class=\"px-2\">\r\n        <webide-property-item (valueChanged)=\"_itemChanged($event)\" (submitModal)=\"_submitModal($event)\"\r\n            [elementValue]=\"data[propItem.propertyID]\" [elementConfig]=\"propItem\"\r\n            (triggerRefreshPanel)=\"refreshPanel()\"></webide-property-item>\r\n    </div>\r\n\r\n    <div class=\"farris-panel\" *ngIf=\"propItem.propertyType == 'cascade' && propItem.visible\">\r\n        <div class=\"propertyCascadeItem farris-panel-item card\">\r\n            <div class=\"card-header\" (click)=\"propItem.isExpand=!propItem.isExpand\">\r\n                <div class=\"panel-item-title\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <div class=\"f-section-formgroup-legend\">\r\n                            <div class=\"f-header px-0  col-form-label\" style=\"font-size: inherit;\">\r\n                                <div class=\"f-title f-utils-fill\">{{propItem.propertyName}}</div>\r\n                                <div class=\"f-toolbar\">\r\n                                    <button class=\"btn f-btn-collapse-expand f-btn-mx\"\r\n                                        [class.f-state-expand]=\"propItem.isExpand\"><span></span></button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"farris-input-wrap\" *ngIf=\"!propItem.hideCascadeTitle\">\r\n                            <input type=\"input\" class=\"form-control form-control-sm\" readonly\r\n                                [value]=\"propItem.cascadeSummary\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"card-body\" [style.display]=\"propItem.isExpand?'block':'none'\">\r\n                <div *ngFor=\"let cascadeItem of propItem.cascadeConfig\" class=\"px-2\">\r\n                    <webide-property-item (valueChanged)=\"_cascadeitemChanged($event,propItem)\"\r\n                        (submitModal)=\"__cascadeitemSubmitModal($event, propItem)\"\r\n                        [elementValue]=\"data[propItem.propertyID]?data[propItem.propertyID][cascadeItem.propertyID]:''\"\r\n                        [elementConfig]=\"cascadeItem\" (triggerRefreshPanel)=\"refreshPanel()\">\r\n                    </webide-property-item>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n</div>",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".propertyCascadeItem{background-color:transparent!important;border:none!important}.propertyCascadeItem .card-header{background-color:transparent!important;padding:4px 12px!important;color:inherit!important}.propertyCascadeItem .card-header .panel-item-title{width:100%;position:relative;font-size:inherit!important}.propertyCascadeItem .card-header .panel-item-title .farris-input-wrap{margin-left:-5px;margin-right:-5px}.propertyCascadeItem .f-accordion-collapse,.propertyCascadeItem .f-accordion-expand{right:0;left:auto!important;top:6px;color:#6b94ec!important;position:absolute}.propertyCascadeItem .card-body{padding:3px 12px!important;background:rgba(255,255,255,.8);border-radius:8px;margin:4px 8px}"]
                }] }
    ];
    /** @nocollapse */
    PropertyItemListComponent.ctorParameters = function () { return []; };
    PropertyItemListComponent.propDecorators = {
        category: [{ type: Input }],
        propertyData: [{ type: Input }],
        valueChanged: [{ type: Output }],
        submitModal: [{ type: Output }],
        triggerRefreshPanel: [{ type: Output }],
        items: [{ type: ViewChildren, args: [PropertyItemComponent,] }]
    };
    return PropertyItemListComponent;
}());
export { PropertyItemListComponent };
if (false) {
    /** @type {?} */
    PropertyItemListComponent.prototype.category;
    /** @type {?} */
    PropertyItemListComponent.prototype.propertyData;
    /** @type {?} */
    PropertyItemListComponent.prototype.valueChanged;
    /** @type {?} */
    PropertyItemListComponent.prototype.submitModal;
    /** @type {?} */
    PropertyItemListComponent.prototype.triggerRefreshPanel;
    /** @type {?} */
    PropertyItemListComponent.prototype.items;
    /** @type {?} */
    PropertyItemListComponent.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktaXRlbS1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3Byb3BlcnR5LXBhbmVsL2NvbXBvbmVudHMvcHJvcGVydHktaXRlbS1saXN0L3Byb3BlcnR5LWl0ZW0tbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUE0QixpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsSSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNyRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUVqRjtJQW1CRTs7UUFUVSxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdkMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RDLHdCQUFtQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7SUFPeEMsQ0FBQzs7Ozs7SUFFakIsK0NBQVc7Ozs7SUFBWCxVQUFZLGFBQTRCO1FBQ3RDLDBEQUEwRDtRQUMxRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFO1lBQzdELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUM7U0FDeEM7YUFBTTtZQUNMLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztTQUMvQjtRQUVELElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUV6QixDQUFDO0lBQ0Q7O09BRUc7Ozs7OztJQUNLLG1EQUFlOzs7OztJQUF2QjtRQUFBLGlCQVNDO1FBUkMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFV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REFBb0I7Ozs7O0lBQXBCLFVBQXFCLFFBQVE7UUFDM0IsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDaEQsT0FBTyxJQUFJLENBQUM7U0FDYjthQUFNO1lBQ0wsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQzs7OztJQUdELGdEQUFZOzs7SUFBWjtRQUNFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsQyxDQUFDOzs7Ozs7SUFFRCxpREFBYTs7Ozs7SUFBYixVQUFjLEtBQWEsRUFBRSxRQUFhO1FBQ3hDLE9BQU8sUUFBUSxDQUFDLFVBQVUsQ0FBQztJQUM3QixDQUFDOztnQkF4TUYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSwyQkFBMkI7b0JBQ3JDLHNrRkFBa0Q7b0JBRWxELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztpQkFFdEM7Ozs7OzJCQUVFLEtBQUs7K0JBQ0wsS0FBSzsrQkFDTCxNQUFNOzhCQUNOLE1BQU07c0NBQ04sTUFBTTt3QkFFTixZQUFZLFNBQUMscUJBQXFCOztJQTRMckMsZ0NBQUM7Q0FBQSxBQTFNRCxJQTBNQztTQW5NWSx5QkFBeUI7OztJQUNwQyw2Q0FBeUM7O0lBQ3pDLGlEQUFzQjs7SUFDdEIsaURBQWlEOztJQUNqRCxnREFBZ0Q7O0lBQ2hELHdEQUF3RDs7SUFFeEQsMENBQXlFOztJQUd6RSx5Q0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGRyZW4sIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRWxlbWVudFByb3BlcnR5Q29uZmlnIH0gZnJvbSAnLi4vLi4vZW50aXR5L3Byb3BlcnR5LWVudGl0eSc7XHJcbmltcG9ydCB7IFByb3BlcnR5SXRlbUNvbXBvbmVudCB9IGZyb20gJy4uL3Byb3BlcnR5LWl0ZW0vcHJvcGVydHktaXRlbS5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd3ZWJpZGUtcHJvcGVydHktaXRlbS1saXN0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcHJvcGVydHktaXRlbS1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9wcm9wZXJ0eS1pdGVtLWxpc3QuY29tcG9uZW50LmNzcyddLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxuXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQcm9wZXJ0eUl0ZW1MaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKSBjYXRlZ29yeTogRWxlbWVudFByb3BlcnR5Q29uZmlnOyAvLyDmn5DkuIDliIbnsbvkuIvnmoTlsZ7mgKfphY3nva5cclxuICBASW5wdXQoKSBwcm9wZXJ0eURhdGE7IC8vIOWxnuaAp+WAvFxyXG4gIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgc3VibWl0TW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgdHJpZ2dlclJlZnJlc2hQYW5lbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkcmVuKFByb3BlcnR5SXRlbUNvbXBvbmVudCkgaXRlbXM6IEFycmF5PFByb3BlcnR5SXRlbUNvbXBvbmVudD47XHJcblxyXG4gIC8vIOWunumZheWxnuaAp+WAvFxyXG4gIGRhdGE7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKHNpbXBsZUNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIC8vIOiLpeWIhuexu+S4i+aciXByb3BlcnR5RGF0Ye+8jOWImeWPluWIhuexu+S4i+eahHByb3BlcnR5RGF0Ye+8m+WQpuWImeWPluaVtOS9k+eahHByb3BlcnR5RGF0YVxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkucHJvcGVydHlEYXRhICYmIHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICB0aGlzLmRhdGEgPSB0aGlzLmNhdGVnb3J5LnByb3BlcnR5RGF0YTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGF0YSA9IHRoaXMucHJvcGVydHlEYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYWRhcHRQcm9wZXJ0aWVzKCk7XHJcblxyXG4gIH1cclxuICAvKipcclxuICAgKiDpgILphY3lsZ7mgKdcclxuICAgKi9cclxuICBwcml2YXRlIGFkYXB0UHJvcGVydGllcygpIHtcclxuICAgIHRoaXMuY2F0ZWdvcnkucHJvcGVydGllcy5mb3JFYWNoKHByb3BJdGVtID0+IHtcclxuICAgICAgaWYgKHByb3BJdGVtLnByb3BlcnR5VHlwZSA9PT0gJ2Nhc2NhZGUnKSB7XHJcbiAgICAgICAgdGhpcy5jYXNjYWRlVmFsdWVTdHJpbmdpZnkocHJvcEl0ZW0sIHRoaXMuZGF0YVtwcm9wSXRlbS5wcm9wZXJ0eUlEXSk7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHByb3BJdGVtKS5pbmRleE9mKCd2aXNpYmxlJykgPCAwKSB7XHJcbiAgICAgICAgICBwcm9wSXRlbS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICByZWZyZXNoKCkge1xyXG4gICAgLy8g6Iul5YiG57G75LiL5pyJcHJvcGVydHlEYXRh77yM5YiZ5Y+W5YiG57G75LiL55qEcHJvcGVydHlEYXRh77yb5ZCm5YiZ5Y+W5pW05L2T55qEcHJvcGVydHlEYXRhXHJcbiAgICBpZiAodGhpcy5jYXRlZ29yeS5wcm9wZXJ0eURhdGEgJiYgdGhpcy5jYXRlZ29yeS5lbmFibGVDYXNjYWRlKSB7XHJcbiAgICAgIHRoaXMuZGF0YSA9IHRoaXMuY2F0ZWdvcnkucHJvcGVydHlEYXRhO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kYXRhID0gdGhpcy5wcm9wZXJ0eURhdGE7XHJcbiAgICB9XHJcbiAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbSA9PiBpdGVtLnJlZnJlc2goKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDkuIDoiKzlsZ7mgKflj5jmm7RcclxuICAgKiBAcGFyYW0gJGV2ZW50XHJcbiAgICovXHJcbiAgX2l0ZW1DaGFuZ2VkKCRldmVudCkge1xyXG4gICAgY29uc3QgeyBjaGFuZ2VPYmplY3QgfSA9ICRldmVudDtcclxuICAgIHRoaXMuZGF0YVtjaGFuZ2VPYmplY3QucHJvcGVydHlJRF0gPSBjaGFuZ2VPYmplY3QucHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICBpZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMgJiYgdHlwZW9mICh0aGlzLmNhdGVnb3J5LnNldFByb3BlcnR5UmVsYXRlcykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMoY2hhbmdlT2JqZWN0LCB0aGlzLmRhdGEpO1xyXG4gICAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbSA9PiBpdGVtLnJlZnJlc2goKSk7XHJcbiAgICB9XHJcbiAgICBjaGFuZ2VPYmplY3QuY2F0ZWdvcnlJZCA9IHRoaXMuY2F0ZWdvcnkuY2F0ZWdvcnlJZDtcclxuXHJcbiAgICBpZiAodGhpcy5jYXRlZ29yeS5lbmFibGVDYXNjYWRlKSB7XHJcbiAgICAgIGNoYW5nZU9iamVjdC5wcm9wZXJ0eVBhdGggPSB0aGlzLmNhdGVnb3J5LnBhcmVudFByb3BlcnR5SUQ7XHJcbiAgICB9XHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlZC5lbWl0KGNoYW5nZU9iamVjdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmqKHmgIHmoYbmlbDmja7lj5jmm7TvvIhUT0RPOuW+heS8mOWMlu+8jOWQiOW5tnZhbHVlQ2hhbmdl5LqL5Lu277yJXHJcbiAgICogQHBhcmFtICRldmVudFxyXG4gICAqL1xyXG4gIF9zdWJtaXRNb2RhbCgkZXZlbnQpIHtcclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0LCBwYXJhbWV0ZXJzIH0gPSAkZXZlbnQ7XHJcbiAgICB0aGlzLmRhdGFbY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZU9iamVjdC5jYXRlZ29yeUlkID0gdGhpcy5jYXRlZ29yeS5jYXRlZ29yeUlkO1xyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KCRldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnuqfogZTlsZ7mgKflj5jmm7RcclxuICAgKi9cclxuICBfY2FzY2FkZWl0ZW1DaGFuZ2VkKCRldmVudCwgcHJvcEl0ZW0pIHtcclxuICAgIGNvbnN0IHBhcmVudFByb3BlcnR5SUQgPSBwcm9wSXRlbS5wcm9wZXJ0eUlEO1xyXG4gICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUlEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0IH0gPSAkZXZlbnQ7XHJcbiAgICBpZiAoIXRoaXMuZGF0YVtwYXJlbnRQcm9wZXJ0eUlEXSkge1xyXG4gICAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF1bY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQgPSBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gcGFyZW50UHJvcGVydHlJRDtcclxuICAgIC8vIOWIhuexu+WQr+eUqOS6hue6p+iBlO+8jOW5tuS4lOWIhuexu+S4i+aciee6p+iBlOWxnuaAp1xyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEICsgJy4nICsgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FzY2FkZVZhbHVlU3RyaW5naWZ5KHByb3BJdGVtLCB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0pO1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdChjaGFuZ2VPYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57qn6IGU5qih5oCB5qGG5bGe5oCn5Y+Y5pu0XHJcbiAgICovXHJcbiAgX19jYXNjYWRlaXRlbVN1Ym1pdE1vZGFsKCRldmVudCwgcHJvcEl0ZW0pIHtcclxuICAgIGNvbnN0IHBhcmVudFByb3BlcnR5SUQgPSBwcm9wSXRlbS5wcm9wZXJ0eUlEO1xyXG4gICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUlEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0LCBwYXJhbWV0ZXJzIH0gPSAkZXZlbnQ7XHJcbiAgICBpZiAoIXRoaXMuZGF0YVtwYXJlbnRQcm9wZXJ0eUlEXSkge1xyXG4gICAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF1bY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQgPSBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gcGFyZW50UHJvcGVydHlJRDtcclxuICAgIC8vIOWIhuexu+WQr+eUqOS6hue6p+iBlO+8jOW5tuS4lOWIhuexu+S4i+aciee6p+iBlOWxnuaAp1xyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucHJvcGVydHlQYXRoID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEICsgJy4nICsgY2hhbmdlT2JqZWN0LnBhcmVudFByb3BlcnR5SUQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FzY2FkZVZhbHVlU3RyaW5naWZ5KHByb3BJdGVtLCB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0pO1xyXG5cclxuICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdCgkZXZlbnQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnuqfogZTlsZ7mgKfnmoTmsYfmgLvkv6Hmga9cclxuICAgKiBAcGFyYW0gcHJvcEl0ZW1cclxuICAgKiBAcGFyYW0gdmFsdWVPYmplY3RcclxuICAgKi9cclxuICBjYXNjYWRlVmFsdWVTdHJpbmdpZnkocHJvcEl0ZW0sIHZhbHVlT2JqZWN0KSB7XHJcbiAgICBpZiAoIXByb3BJdGVtIHx8ICFwcm9wSXRlbS5jYXNjYWRlQ29uZmlnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghdmFsdWVPYmplY3QpIHtcclxuICAgICAgcHJvcEl0ZW0uY2FzY2FkZVN1bW1hcnkgPSAnJztcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFwcm9wSXRlbS5jYXNjYWRlQ29udmVydGVyIHx8ICFwcm9wSXRlbS5jYXNjYWRlQ29udmVydGVyLmNvbnZlcnRUbykge1xyXG4gICAgICBwcm9wSXRlbS5jYXNjYWRlU3VtbWFyeSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlT2JqZWN0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHByb3BJdGVtLmNhc2NhZGVTdW1tYXJ5ID0gcHJvcEl0ZW0uY2FzY2FkZUNvbnZlcnRlci5jb252ZXJ0VG8odmFsdWVPYmplY3QsIHByb3BJdGVtLmNhc2NhZGVDb25maWcpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogIOW3suW6n+W8g1xyXG4gICAqL1xyXG4gIF9jaGVja0Nhc2NhZGVWaXNpYmxlKHByb3BJdGVtKSB7XHJcbiAgICBpZiAoT2JqZWN0LmtleXMocHJvcEl0ZW0pLmluZGV4T2YoJ3Zpc2libGUnKSA8IDApIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcHJvcEl0ZW0udmlzaWJsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICByZWZyZXNoUGFuZWwoKSB7XHJcbiAgICB0aGlzLnRyaWdnZXJSZWZyZXNoUGFuZWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgdHJhY2tCeVByb3BJZChpbmRleDogbnVtYmVyLCBQcm9wSXRlbTogYW55KTogc3RyaW5nIHtcclxuICAgIHJldHVybiBQcm9wSXRlbS5wcm9wZXJ0eUlEO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
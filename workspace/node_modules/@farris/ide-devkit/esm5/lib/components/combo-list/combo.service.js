/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { BehaviorSubject, Subject } from 'rxjs';
var ComboService = /** @class */ (function () {
    function ComboService() {
        this.innerData = [];
        this.selected$ = new Subject();
        this.isOpen$ = new BehaviorSubject(false);
        this.data$ = new BehaviorSubject('');
        // initData() {
        //     // this.loadDataTable(this.data || []);
        //     // switch (this.displayType) {
        //     //     case 'TreeList': {
        //     //         this.getData().subscribe(data => this.loadDataTree(data));
        //     //         break;
        //     //     }
        //     //     case 'LIST': {
        //     //         // List
        //     //         this.getData().subscribe(data => this.loadDataTable(data));
        //     //         break;
        //     //     }
        //     //     // case 'LOOKUPLIST': {
        //     //     //     // List
        //     //     //     this.getData().subscribe(data =>
        //     //     //         this.loadLookUpDataTable(data)
        //     //     //     );
        //     //     //     break;
        //     //     // }
        //     //     // case 'LOOKUPTREELIST': {
        //     //     //     // List
        //     //     //     this.getData().subscribe(data => this.loadLookUpDataTree(data));
        //     //     //     break;
        //     //     // }
        //     // }
        // }
        // getData(): Observable<any> {
        //     // if (this.uri) {
        //     //     const params = {};
        //     //     this.showLoading();
        //     //     if (this.comboHttp) {
        //     //         return this.comboHttp.getData(this.uri);
        //     //     } else {
        //     //         return this.http.get(this.uri);
        //     //     }
        //     // } else {
        //         if (this.data) {
        //             return of(this.data);
        //         } else {
        //             return of([]);
        //         }
        //     // }
        // }
        // loadDataTable(data: any) {
        //     if (data instanceof Array) {
        //         this.data = data;
        //     } else {
        //         this.data = data.returnValue;
        //     }
        //     this.loadData(this.data, this.selectedValues, (dataArr, val) => {
        //         // tslint:disable-next-line:triple-equals
        //         return dataArr.find(d => d[this.idField] + '' == val);
        //     });
        //     // this.closeLoading();
        // }
        // loadDataTree(data: any) {
        //     if (data instanceof Array) {
        //         this.data = data;
        //     } else {
        //         this.data = data.returnValue;
        //     }
        //     this.loadData(this.data, this.selectedValues, (dataArr, val) => {
        //         return eachData(dataArr, val, this.idField);
        //         function eachData(paramData, paramVal, idField) {
        //             let rtnData: any = '';
        //             paramData.find(d => {
        //                 // tslint:disable-next-line:triple-equals
        //                 if (d.data[idField] == paramVal) {
        //                     rtnData = d.data;
        //                     return true;
        //                 } else if (d.children && d.children.length) {
        //                     rtnData = eachData(d.children, paramVal, idField);
        //                 } else {
        //                     return false;
        //                 }
        //             });
        //             return rtnData;
        //         }
        //     });
        //     // this.closeLoading();
        // }
        // loadLookUpDataTable(resData: any) {
        //     if (resData.returnValue) {
        //         resData = resData.returnValue;
        //     }
        //     this.columns = resData.columns;
        //     this.pageInfo = resData.pageInfo;
        //     this.data = resData.items;
        //     this.loadData(this.data, this.selectedValues, (dataArr, val) => {
        //         // tslint:disable-next-line: triple-equals
        //         return dataArr.find(d => d[this.idField] + '' == val);
        //     });
        //     this.closeLoading();
        // }
        // loadLookUpDataTree(resData: any) {
        //     if (resData.returnValue) {
        //         resData = resData.returnValue;
        //     }
        //     this.columns = resData.columns;
        //     const treeInfo = resData.treeInfo;
        //     // tslint:disable-next-line: no-string-literal
        //     if (!treeInfo['treeDataIsInit']) {
        //         if (treeInfo.layerType.toLowerCase() === 'pathcode') {
        //             this.data = this.lookupUtils.makeTree(resData.items, treeInfo);
        //         } else {
        //             this.data = this.lookupUtils.makeTreeWithParentID(
        //                 resData.items,
        //                 '',
        //                 `${treeInfo.dataField}.${treeInfo.parentField}`,
        //                 this.idField
        //             );
        //         }
        //     }
        //     this.loadData(this.data, this.selectedValues, (dataArr, val) => {
        //         return eachData(dataArr, val, this.idField);
        //         function eachData(paramData, paramVal, idField) {
        //             let rtnData: any = '';
        //             paramData.find(d => {
        //                 // tslint:disable-next-line:triple-equals
        //                 if (d.data[idField] == paramVal) {
        //                     rtnData = d.data;
        //                     return true;
        //                 } else if (d.children && d.children.length) {
        //                     rtnData = eachData(d.children, paramVal, idField);
        //                 } else {
        //                     return false;
        //                 }
        //             });
        //             return rtnData;
        //         }
        //     });
        //     this.closeLoading();
        // }
        // private showLoading() {
        //     this.loading = this.loadingService.show();
        // }
        // closeLoading() {
        //     if (this.loading) {
        //         this.loading.close();
        //         this.loading = null;
        //     }
        // }
    }
    Object.defineProperty(ComboService.prototype, "data", {
        get: /**
         * @return {?}
         */
        function () {
            return this.innerData;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this.innerData = val;
            this.data$.next(val);
        },
        enumerable: true,
        configurable: true
    });
    // columns: any;
    // injectService() {
    //     if (this.injector && !this.comboHttp) {
    //         this.lookupUtils = this.injector.get(LookupUtils, null);
    //         if (this.displayType.indexOf('LOOKUP') > -1) {
    //             this.comboHttp = this.injector.get(ServerSideToken, null);
    //         } else {
    //             this.comboHttp = this.injector.get(ComboServerSideToken, null);
    //         }
    //     }
    // }
    // columns: any;
    // injectService() {
    //     if (this.injector && !this.comboHttp) {
    //         this.lookupUtils = this.injector.get(LookupUtils, null);
    //         if (this.displayType.indexOf('LOOKUP') > -1) {
    //             this.comboHttp = this.injector.get(ServerSideToken, null);
    //         } else {
    //             this.comboHttp = this.injector.get(ComboServerSideToken, null);
    //         }
    //     }
    // }
    /**
     * @param {?} value
     * @return {?}
     */
    ComboService.prototype.toBoolean = 
    // columns: any;
    // injectService() {
    //     if (this.injector && !this.comboHttp) {
    //         this.lookupUtils = this.injector.get(LookupUtils, null);
    //         if (this.displayType.indexOf('LOOKUP') > -1) {
    //             this.comboHttp = this.injector.get(ServerSideToken, null);
    //         } else {
    //             this.comboHttp = this.injector.get(ComboServerSideToken, null);
    //         }
    //     }
    // }
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        return value != null && "" + value !== 'false';
    };
    /**
     * @param {?} data
     * @param {?=} index
     * @return {?}
     */
    ComboService.prototype.selectItem = /**
     * @param {?} data
     * @param {?=} index
     * @return {?}
     */
    function (data, index) {
        this.isOpen$.next(false);
        this.selectedValue = data;
        this.selected$.next(this.selectedValue);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ComboService.prototype.unSelectItem = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.selectedValue = null;
        this.selected$.next(null);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    ComboService.prototype.isSelect = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return false;
    };
    // loadData(data: any, selectValues: string = '', callback) {
    //     if (data) {
    //         if (selectValues) {
    //             if (selectValues.split) {
    //                 // key 是字符串，可能是拼起来的
    //                 const selectedItems = selectValues.split(',').map(val => {
    //                     return callback(data, val);
    //                 });
    //
    //                 this.selections = selectedItems;
    //             } else {
    //                 // key不可split
    //                 this.selections = [selectValues];
    //             }
    //         } else {
    //             this.selections = [];
    //         }
    //         // this.selections$.next(this.selections);
    //         // const _data = this.initData(data);
    //         // this.updateState({...this._state, data: _data});
    //     } else {
    //         // this.updateState({ data: [], selections: [] });
    //     }
    // }
    // filterData(val: string, filed: any = 'text') {
    //     if (val) {
    //         const data = this.data
    //             ? this.data.filter(item => {
    //                 if (item[filed]) {
    //                     return String(item[filed]).indexOf(val) > -1;
    //                 } else if (item.data && item.data[filed]) {
    //                     return String(item.data[filed]).indexOf(val) > -1;
    //                 }
    //               })
    //             : [];
    //         this.data$.next(data);
    //     }
    // }
    // loadData(data: any, selectValues: string = '', callback) {
    //     if (data) {
    //         if (selectValues) {
    //             if (selectValues.split) {
    //                 // key 是字符串，可能是拼起来的
    //                 const selectedItems = selectValues.split(',').map(val => {
    //                     return callback(data, val);
    //                 });
    //
    //                 this.selections = selectedItems;
    //             } else {
    //                 // key不可split
    //                 this.selections = [selectValues];
    //             }
    //         } else {
    //             this.selections = [];
    //         }
    //         // this.selections$.next(this.selections);
    //         // const _data = this.initData(data);
    //         // this.updateState({...this._state, data: _data});
    //     } else {
    //         // this.updateState({ data: [], selections: [] });
    //     }
    // }
    // filterData(val: string, filed: any = 'text') {
    //     if (val) {
    //         const data = this.data
    //             ? this.data.filter(item => {
    //                 if (item[filed]) {
    //                     return String(item[filed]).indexOf(val) > -1;
    //                 } else if (item.data && item.data[filed]) {
    //                     return String(item.data[filed]).indexOf(val) > -1;
    //                 }
    //               })
    //             : [];
    //         this.data$.next(data);
    //     }
    // }
    /**
     * @return {?}
     */
    ComboService.prototype.getSelected = 
    // loadData(data: any, selectValues: string = '', callback) {
    //     if (data) {
    //         if (selectValues) {
    //             if (selectValues.split) {
    //                 // key 是字符串，可能是拼起来的
    //                 const selectedItems = selectValues.split(',').map(val => {
    //                     return callback(data, val);
    //                 });
    //
    //                 this.selections = selectedItems;
    //             } else {
    //                 // key不可split
    //                 this.selections = [selectValues];
    //             }
    //         } else {
    //             this.selections = [];
    //         }
    //         // this.selections$.next(this.selections);
    //         // const _data = this.initData(data);
    //         // this.updateState({...this._state, data: _data});
    //     } else {
    //         // this.updateState({ data: [], selections: [] });
    //     }
    // }
    // filterData(val: string, filed: any = 'text') {
    //     if (val) {
    //         const data = this.data
    //             ? this.data.filter(item => {
    //                 if (item[filed]) {
    //                     return String(item[filed]).indexOf(val) > -1;
    //                 } else if (item.data && item.data[filed]) {
    //                     return String(item.data[filed]).indexOf(val) > -1;
    //                 }
    //               })
    //             : [];
    //         this.data$.next(data);
    //     }
    // }
    /**
     * @return {?}
     */
    function () {
        return this.selectedValue;
    };
    // filterSelections(displayText: string) {
    //     if (displayText && this.selections) {
    //         const selections = displayText
    //             .split(',')
    //             .map(val => {
    //                 return this.selections.find(d => d[this.textField] === val);
    //             })
    //             .filter(val => !!val);
    //         this.selectedValues = this.getValue(this.valueField, selections);
    //         this.selections = selections;
    //     }
    // }
    // clearSelections() {
    //     this.selections = [];
    // }
    // filterSelections(displayText: string) {
    //     if (displayText && this.selections) {
    //         const selections = displayText
    //             .split(',')
    //             .map(val => {
    //                 return this.selections.find(d => d[this.textField] === val);
    //             })
    //             .filter(val => !!val);
    //         this.selectedValues = this.getValue(this.valueField, selections);
    //         this.selections = selections;
    //     }
    // }
    // clearSelections() {
    //     this.selections = [];
    // }
    /**
     * @param {?} prop
     * @param {?=} selections
     * @return {?}
     */
    ComboService.prototype.getValue = 
    // filterSelections(displayText: string) {
    //     if (displayText && this.selections) {
    //         const selections = displayText
    //             .split(',')
    //             .map(val => {
    //                 return this.selections.find(d => d[this.textField] === val);
    //             })
    //             .filter(val => !!val);
    //         this.selectedValues = this.getValue(this.valueField, selections);
    //         this.selections = selections;
    //     }
    // }
    // clearSelections() {
    //     this.selections = [];
    // }
    /**
     * @param {?} prop
     * @param {?=} selections
     * @return {?}
     */
    function (prop, selections) {
        // selections = selections ? selections : this.selections;
        // if (selections && selections.length) {
        //     // if (this.mapFields) {
        //     //     const helpFields = Object.keys(this.mapFields);
        //     //     helpFields.forEach( (f: any) => {
        //     //         if (this.mapFields[f] === prop) {
        //     //             prop = f;
        //     //             return;
        //     //         }
        //     //     });
        //     // }
        //
        //     // if (selections.length === 1) {
        //     //     return this.getValueByObj(prop, selections[0]);
        //     // }
        //
        //     const tmp = selections
        //         .map(item => {
        //             return this.getValueByObj(prop, item);
        //         })
        //         .join(',');
        //     return tmp;
        // }
        if (this.selectedValue) {
            return this.getValueByObj(prop, this.selectedValue);
        }
        return '';
    };
    /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    ComboService.prototype.getValueByObj = /**
     * @param {?} field
     * @param {?} data
     * @return {?}
     */
    function (field, data) {
        if (!data) {
            return '';
        }
        /** @type {?} */
        var resultVal = '';
        if (field.indexOf('.') === -1) {
            resultVal = data[field];
        }
        else {
            resultVal = field.split('.').reduce(function (obj, key) {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }, data);
        }
        return resultVal;
    };
    ComboService.decorators = [
        { type: Injectable }
    ];
    return ComboService;
}());
export { ComboService };
if (false) {
    /** @type {?} */
    ComboService.prototype.idField;
    /** @type {?} */
    ComboService.prototype.valueField;
    /** @type {?} */
    ComboService.prototype.textField;
    /** @type {?} */
    ComboService.prototype.mapFields;
    /**
     * @type {?}
     * @private
     */
    ComboService.prototype.innerData;
    /** @type {?} */
    ComboService.prototype.selectedValue;
    /** @type {?} */
    ComboService.prototype.selected$;
    /** @type {?} */
    ComboService.prototype.isOpen$;
    /** @type {?} */
    ComboService.prototype.data$;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbWJvLWxpc3QvY29tYm8uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBa0IsTUFBTSxNQUFNLENBQUM7QUFJaEU7SUFBQTtRQU1ZLGNBQVMsR0FBUSxFQUFFLENBQUM7UUFTNUIsY0FBUyxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDL0IsWUFBTyxHQUFHLElBQUksZUFBZSxDQUFVLEtBQUssQ0FBQyxDQUFDO1FBQzlDLFVBQUssR0FBRyxJQUFJLGVBQWUsQ0FBTSxFQUFFLENBQUMsQ0FBQztRQXlJckMsZUFBZTtRQUNmLDhDQUE4QztRQUM5QyxxQ0FBcUM7UUFDckMsZ0NBQWdDO1FBQ2hDLDRFQUE0RTtRQUM1RSx3QkFBd0I7UUFDeEIsZUFBZTtRQUNmLDRCQUE0QjtRQUM1Qix5QkFBeUI7UUFDekIsNkVBQTZFO1FBQzdFLHdCQUF3QjtRQUN4QixlQUFlO1FBQ2YscUNBQXFDO1FBQ3JDLDRCQUE0QjtRQUM1QixxREFBcUQ7UUFDckQsdURBQXVEO1FBQ3ZELHVCQUF1QjtRQUN2QiwyQkFBMkI7UUFDM0Isa0JBQWtCO1FBQ2xCLHlDQUF5QztRQUN6Qyw0QkFBNEI7UUFDNUIscUZBQXFGO1FBQ3JGLDJCQUEyQjtRQUMzQixrQkFBa0I7UUFDbEIsV0FBVztRQUNYLElBQUk7UUFFSiwrQkFBK0I7UUFDL0IseUJBQXlCO1FBQ3pCLGdDQUFnQztRQUNoQyxpQ0FBaUM7UUFDakMsbUNBQW1DO1FBQ25DLDBEQUEwRDtRQUMxRCxzQkFBc0I7UUFDdEIsaURBQWlEO1FBQ2pELGVBQWU7UUFDZixrQkFBa0I7UUFDbEIsMkJBQTJCO1FBQzNCLG9DQUFvQztRQUNw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WUFDM0IsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUMzQjthQUFNO1lBQ0gsU0FBUyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7Z0JBQ3pDLElBQUksR0FBRyxFQUFFO29CQUNMLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNuQjtxQkFBTTtvQkFDSCxPQUFPLElBQUksQ0FBQztpQkFDZjtZQUNMLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNaO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQzs7Z0JBeEpKLFVBQVU7O0lBeVNYLG1CQUFDO0NBQUEsQUF6U0QsSUF5U0M7U0F4U1ksWUFBWTs7O0lBQ3JCLCtCQUFnQjs7SUFDaEIsa0NBQW1COztJQUNuQixpQ0FBa0I7O0lBQ2xCLGlDQUE2Qzs7Ozs7SUFDN0MsaUNBQTRCOztJQVE1QixxQ0FBbUI7O0lBQ25CLGlDQUErQjs7SUFDL0IsK0JBQThDOztJQUM5Qyw2QkFBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIENvbWJvU2VydmljZSB7XHJcbiAgICBpZEZpZWxkOiBzdHJpbmc7XHJcbiAgICB2YWx1ZUZpZWxkOiBzdHJpbmc7XHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIG1hcEZpZWxkczogeyBbc291cmNlRmllbGQ6IHN0cmluZ106IHN0cmluZyB9O1xyXG4gICAgcHJpdmF0ZSBpbm5lckRhdGE6IGFueSA9IFtdO1xyXG4gICAgZ2V0IGRhdGEoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJEYXRhO1xyXG4gICAgfVxyXG4gICAgc2V0IGRhdGEodmFsKSB7XHJcbiAgICAgICAgdGhpcy5pbm5lckRhdGEgPSB2YWw7XHJcbiAgICAgICAgdGhpcy5kYXRhJC5uZXh0KHZhbCk7XHJcbiAgICB9XHJcbiAgICBzZWxlY3RlZFZhbHVlOiBhbnk7XHJcbiAgICBzZWxlY3RlZCQgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICBpc09wZW4kID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XHJcbiAgICBkYXRhJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55PignJyk7XHJcbiAgICAvLyBjb2x1bW5zOiBhbnk7XHJcblxyXG4gICAgLy8gaW5qZWN0U2VydmljZSgpIHtcclxuICAgIC8vICAgICBpZiAodGhpcy5pbmplY3RvciAmJiAhdGhpcy5jb21ib0h0dHApIHtcclxuICAgIC8vICAgICAgICAgdGhpcy5sb29rdXBVdGlscyA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvb2t1cFV0aWxzLCBudWxsKTtcclxuICAgIC8vICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVR5cGUuaW5kZXhPZignTE9PS1VQJykgPiAtMSkge1xyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy5jb21ib0h0dHAgPSB0aGlzLmluamVjdG9yLmdldChTZXJ2ZXJTaWRlVG9rZW4sIG51bGwpO1xyXG4gICAgLy8gICAgICAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy5jb21ib0h0dHAgPSB0aGlzLmluamVjdG9yLmdldChDb21ib1NlcnZlclNpZGVUb2tlbiwgbnVsbCk7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICB9XHJcbiAgICAvLyB9XHJcbiAgICB0b0Jvb2xlYW4odmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIGAke3ZhbHVlfWAgIT09ICdmYWxzZSc7XHJcbiAgICB9XHJcbiAgICBzZWxlY3RJdGVtKGRhdGE6IGFueSwgaW5kZXg/OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiQubmV4dChmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlID0gZGF0YTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkJC5uZXh0KHRoaXMuc2VsZWN0ZWRWYWx1ZSk7XHJcbiAgICB9XHJcbiAgICB1blNlbGVjdEl0ZW0oZGF0YTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkJC5uZXh0KG51bGwpO1xyXG4gICAgfVxyXG4gICAgaXNTZWxlY3QoaWQ6IGFueSkge1xyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbG9hZERhdGEoZGF0YTogYW55LCBzZWxlY3RWYWx1ZXM6IHN0cmluZyA9ICcnLCBjYWxsYmFjaykge1xyXG4gICAgLy8gICAgIGlmIChkYXRhKSB7XHJcbiAgICAvLyAgICAgICAgIGlmIChzZWxlY3RWYWx1ZXMpIHtcclxuICAgIC8vICAgICAgICAgICAgIGlmIChzZWxlY3RWYWx1ZXMuc3BsaXQpIHtcclxuICAgIC8vICAgICAgICAgICAgICAgICAvLyBrZXkg5piv5a2X56ym5Liy77yM5Y+v6IO95piv5ou86LW35p2l55qEXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IHNlbGVjdFZhbHVlcy5zcGxpdCgnLCcpLm1hcCh2YWwgPT4ge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YSwgdmFsKTtcclxuICAgIC8vICAgICAgICAgICAgICAgICB9KTtcclxuICAgIC8vXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25zID0gc2VsZWN0ZWRJdGVtcztcclxuICAgIC8vICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgLy8ga2V55LiN5Y+vc3BsaXRcclxuICAgIC8vICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBbc2VsZWN0VmFsdWVzXTtcclxuICAgIC8vICAgICAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgIC8vIHRoaXMuc2VsZWN0aW9ucyQubmV4dCh0aGlzLnNlbGVjdGlvbnMpO1xyXG4gICAgLy8gICAgICAgICAvLyBjb25zdCBfZGF0YSA9IHRoaXMuaW5pdERhdGEoZGF0YSk7XHJcbiAgICAvLyAgICAgICAgIC8vIHRoaXMudXBkYXRlU3RhdGUoey4uLnRoaXMuX3N0YXRlLCBkYXRhOiBfZGF0YX0pO1xyXG4gICAgLy8gICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgIC8vIHRoaXMudXBkYXRlU3RhdGUoeyBkYXRhOiBbXSwgc2VsZWN0aW9uczogW10gfSk7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG4gICAgLy8gZmlsdGVyRGF0YSh2YWw6IHN0cmluZywgZmlsZWQ6IGFueSA9ICd0ZXh0Jykge1xyXG4gICAgLy8gICAgIGlmICh2YWwpIHtcclxuICAgIC8vICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YVxyXG4gICAgLy8gICAgICAgICAgICAgPyB0aGlzLmRhdGEuZmlsdGVyKGl0ZW0gPT4ge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIGlmIChpdGVtW2ZpbGVkXSkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKGl0ZW1bZmlsZWRdKS5pbmRleE9mKHZhbCkgPiAtMTtcclxuICAgIC8vICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0YSAmJiBpdGVtLmRhdGFbZmlsZWRdKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcoaXRlbS5kYXRhW2ZpbGVkXSkuaW5kZXhPZih2YWwpID4gLTE7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICAgICAgICB9KVxyXG4gICAgLy8gICAgICAgICAgICAgOiBbXTtcclxuICAgIC8vICAgICAgICAgdGhpcy5kYXRhJC5uZXh0KGRhdGEpO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuICAgIGdldFNlbGVjdGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZmlsdGVyU2VsZWN0aW9ucyhkaXNwbGF5VGV4dDogc3RyaW5nKSB7XHJcbiAgICAvLyAgICAgaWYgKGRpc3BsYXlUZXh0ICYmIHRoaXMuc2VsZWN0aW9ucykge1xyXG4gICAgLy8gICAgICAgICBjb25zdCBzZWxlY3Rpb25zID0gZGlzcGxheVRleHRcclxuICAgIC8vICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAvLyAgICAgICAgICAgICAubWFwKHZhbCA9PiB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9ucy5maW5kKGQgPT4gZFt0aGlzLnRleHRGaWVsZF0gPT09IHZhbCk7XHJcbiAgICAvLyAgICAgICAgICAgICB9KVxyXG4gICAgLy8gICAgICAgICAgICAgLmZpbHRlcih2YWwgPT4gISF2YWwpO1xyXG4gICAgLy8gICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gdGhpcy5nZXRWYWx1ZSh0aGlzLnZhbHVlRmllbGQsIHNlbGVjdGlvbnMpO1xyXG4gICAgLy8gICAgICAgICB0aGlzLnNlbGVjdGlvbnMgPSBzZWxlY3Rpb25zO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBjbGVhclNlbGVjdGlvbnMoKSB7XHJcbiAgICAvLyAgICAgdGhpcy5zZWxlY3Rpb25zID0gW107XHJcbiAgICAvLyB9XHJcblxyXG4gICAgZ2V0VmFsdWUocHJvcDogc3RyaW5nLCBzZWxlY3Rpb25zPzogYW55KTogYW55IHtcclxuICAgICAgICAvLyBzZWxlY3Rpb25zID0gc2VsZWN0aW9ucyA/IHNlbGVjdGlvbnMgOiB0aGlzLnNlbGVjdGlvbnM7XHJcbiAgICAgICAgLy8gaWYgKHNlbGVjdGlvbnMgJiYgc2VsZWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAvLyAgICAgLy8gaWYgKHRoaXMubWFwRmllbGRzKSB7XHJcbiAgICAgICAgLy8gICAgIC8vICAgICBjb25zdCBoZWxwRmllbGRzID0gT2JqZWN0LmtleXModGhpcy5tYXBGaWVsZHMpO1xyXG4gICAgICAgIC8vICAgICAvLyAgICAgaGVscEZpZWxkcy5mb3JFYWNoKCAoZjogYW55KSA9PiB7XHJcbiAgICAgICAgLy8gICAgIC8vICAgICAgICAgaWYgKHRoaXMubWFwRmllbGRzW2ZdID09PSBwcm9wKSB7XHJcbiAgICAgICAgLy8gICAgIC8vICAgICAgICAgICAgIHByb3AgPSBmO1xyXG4gICAgICAgIC8vICAgICAvLyAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gICAgIC8vICAgICAgICAgfVxyXG4gICAgICAgIC8vICAgICAvLyAgICAgfSk7XHJcbiAgICAgICAgLy8gICAgIC8vIH1cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vICAgICAvLyBpZiAoc2VsZWN0aW9ucy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAvLyAgICAgLy8gICAgIHJldHVybiB0aGlzLmdldFZhbHVlQnlPYmoocHJvcCwgc2VsZWN0aW9uc1swXSk7XHJcbiAgICAgICAgLy8gICAgIC8vIH1cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vICAgICBjb25zdCB0bXAgPSBzZWxlY3Rpb25zXHJcbiAgICAgICAgLy8gICAgICAgICAubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlQnlPYmoocHJvcCwgaXRlbSk7XHJcbiAgICAgICAgLy8gICAgICAgICB9KVxyXG4gICAgICAgIC8vICAgICAgICAgLmpvaW4oJywnKTtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIHRtcDtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUJ5T2JqKHByb3AsIHRoaXMuc2VsZWN0ZWRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIGdldFZhbHVlQnlPYmooZmllbGQ6IHN0cmluZywgZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHJlc3VsdFZhbCA9ICcnO1xyXG4gICAgICAgIGlmIChmaWVsZC5pbmRleE9mKCcuJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFZhbCA9IGRhdGFbZmllbGRdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3VsdFZhbCA9IGZpZWxkLnNwbGl0KCcuJykucmVkdWNlKChvYmosIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0VmFsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGluaXREYXRhKCkge1xyXG4gICAgLy8gICAgIC8vIHRoaXMubG9hZERhdGFUYWJsZSh0aGlzLmRhdGEgfHwgW10pO1xyXG4gICAgLy8gICAgIC8vIHN3aXRjaCAodGhpcy5kaXNwbGF5VHlwZSkge1xyXG4gICAgLy8gICAgIC8vICAgICBjYXNlICdUcmVlTGlzdCc6IHtcclxuICAgIC8vICAgICAvLyAgICAgICAgIHRoaXMuZ2V0RGF0YSgpLnN1YnNjcmliZShkYXRhID0+IHRoaXMubG9hZERhdGFUcmVlKGRhdGEpKTtcclxuICAgIC8vICAgICAvLyAgICAgICAgIGJyZWFrO1xyXG4gICAgLy8gICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgLy8gICAgIGNhc2UgJ0xJU1QnOiB7XHJcbiAgICAvLyAgICAgLy8gICAgICAgICAvLyBMaXN0XHJcbiAgICAvLyAgICAgLy8gICAgICAgICB0aGlzLmdldERhdGEoKS5zdWJzY3JpYmUoZGF0YSA9PiB0aGlzLmxvYWREYXRhVGFibGUoZGF0YSkpO1xyXG4gICAgLy8gICAgIC8vICAgICAgICAgYnJlYWs7XHJcbiAgICAvLyAgICAgLy8gICAgIH1cclxuICAgIC8vICAgICAvLyAgICAgLy8gY2FzZSAnTE9PS1VQTElTVCc6IHtcclxuICAgIC8vICAgICAvLyAgICAgLy8gICAgIC8vIExpc3RcclxuICAgIC8vICAgICAvLyAgICAgLy8gICAgIHRoaXMuZ2V0RGF0YSgpLnN1YnNjcmliZShkYXRhID0+XHJcbiAgICAvLyAgICAgLy8gICAgIC8vICAgICAgICAgdGhpcy5sb2FkTG9va1VwRGF0YVRhYmxlKGRhdGEpXHJcbiAgICAvLyAgICAgLy8gICAgIC8vICAgICApO1xyXG4gICAgLy8gICAgIC8vICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAvLyAgICAgLy8gICAgIC8vIH1cclxuICAgIC8vICAgICAvLyAgICAgLy8gY2FzZSAnTE9PS1VQVFJFRUxJU1QnOiB7XHJcbiAgICAvLyAgICAgLy8gICAgIC8vICAgICAvLyBMaXN0XHJcbiAgICAvLyAgICAgLy8gICAgIC8vICAgICB0aGlzLmdldERhdGEoKS5zdWJzY3JpYmUoZGF0YSA9PiB0aGlzLmxvYWRMb29rVXBEYXRhVHJlZShkYXRhKSk7XHJcbiAgICAvLyAgICAgLy8gICAgIC8vICAgICBicmVhaztcclxuICAgIC8vICAgICAvLyAgICAgLy8gfVxyXG4gICAgLy8gICAgIC8vIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBnZXREYXRhKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAvLyAgICAgLy8gaWYgKHRoaXMudXJpKSB7XHJcbiAgICAvLyAgICAgLy8gICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xyXG4gICAgLy8gICAgIC8vICAgICB0aGlzLnNob3dMb2FkaW5nKCk7XHJcbiAgICAvLyAgICAgLy8gICAgIGlmICh0aGlzLmNvbWJvSHR0cCkge1xyXG4gICAgLy8gICAgIC8vICAgICAgICAgcmV0dXJuIHRoaXMuY29tYm9IdHRwLmdldERhdGEodGhpcy51cmkpO1xyXG4gICAgLy8gICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgIC8vICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy51cmkpO1xyXG4gICAgLy8gICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgLy8gfSBlbHNlIHtcclxuICAgIC8vICAgICAgICAgaWYgKHRoaXMuZGF0YSkge1xyXG4gICAgLy8gICAgICAgICAgICAgcmV0dXJuIG9mKHRoaXMuZGF0YSk7XHJcbiAgICAvLyAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm4gb2YoW10pO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgLy8gfVxyXG4gICAgLy8gfVxyXG4gICAgLy8gbG9hZERhdGFUYWJsZShkYXRhOiBhbnkpIHtcclxuICAgIC8vICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAvLyAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAvLyAgICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAgICAgdGhpcy5kYXRhID0gZGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgIC8vICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnRyaXBsZS1lcXVhbHNcclxuICAgIC8vICAgICAgICAgcmV0dXJuIGRhdGFBcnIuZmluZChkID0+IGRbdGhpcy5pZEZpZWxkXSArICcnID09IHZhbCk7XHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyAgICAgLy8gdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgIC8vIH1cclxuICAgIC8vIGxvYWREYXRhVHJlZShkYXRhOiBhbnkpIHtcclxuICAgIC8vICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAvLyAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAvLyAgICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAgICAgdGhpcy5kYXRhID0gZGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLmRhdGEsIHRoaXMuc2VsZWN0ZWRWYWx1ZXMsIChkYXRhQXJyLCB2YWwpID0+IHtcclxuICAgIC8vICAgICAgICAgcmV0dXJuIGVhY2hEYXRhKGRhdGFBcnIsIHZhbCwgdGhpcy5pZEZpZWxkKTtcclxuICAgIC8vICAgICAgICAgZnVuY3Rpb24gZWFjaERhdGEocGFyYW1EYXRhLCBwYXJhbVZhbCwgaWRGaWVsZCkge1xyXG4gICAgLy8gICAgICAgICAgICAgbGV0IHJ0bkRhdGE6IGFueSA9ICcnO1xyXG4gICAgLy8gICAgICAgICAgICAgcGFyYW1EYXRhLmZpbmQoZCA9PiB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnRyaXBsZS1lcXVhbHNcclxuICAgIC8vICAgICAgICAgICAgICAgICBpZiAoZC5kYXRhW2lkRmllbGRdID09IHBhcmFtVmFsKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHJ0bkRhdGEgPSBkLmRhdGE7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5jaGlsZHJlbiAmJiBkLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICBydG5EYXRhID0gZWFjaERhdGEoZC5jaGlsZHJlbiwgcGFyYW1WYWwsIGlkRmllbGQpO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIC8vICAgICAgICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgICAgICB9KTtcclxuICAgIC8vICAgICAgICAgICAgIHJldHVybiBydG5EYXRhO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyAgICAgLy8gdGhpcy5jbG9zZUxvYWRpbmcoKTtcclxuICAgIC8vIH1cclxuICAgIC8vIGxvYWRMb29rVXBEYXRhVGFibGUocmVzRGF0YTogYW55KSB7XHJcbiAgICAvLyAgICAgaWYgKHJlc0RhdGEucmV0dXJuVmFsdWUpIHtcclxuICAgIC8vICAgICAgICAgcmVzRGF0YSA9IHJlc0RhdGEucmV0dXJuVmFsdWU7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICAgIHRoaXMuY29sdW1ucyA9IHJlc0RhdGEuY29sdW1ucztcclxuICAgIC8vICAgICB0aGlzLnBhZ2VJbmZvID0gcmVzRGF0YS5wYWdlSW5mbztcclxuICAgIC8vICAgICB0aGlzLmRhdGEgPSByZXNEYXRhLml0ZW1zO1xyXG4gICAgLy8gICAgIHRoaXMubG9hZERhdGEodGhpcy5kYXRhLCB0aGlzLnNlbGVjdGVkVmFsdWVzLCAoZGF0YUFyciwgdmFsKSA9PiB7XHJcbiAgICAvLyAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdHJpcGxlLWVxdWFsc1xyXG4gICAgLy8gICAgICAgICByZXR1cm4gZGF0YUFyci5maW5kKGQgPT4gZFt0aGlzLmlkRmllbGRdICsgJycgPT0gdmFsKTtcclxuICAgIC8vICAgICB9KTtcclxuICAgIC8vICAgICB0aGlzLmNsb3NlTG9hZGluZygpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gbG9hZExvb2tVcERhdGFUcmVlKHJlc0RhdGE6IGFueSkge1xyXG4gICAgLy8gICAgIGlmIChyZXNEYXRhLnJldHVyblZhbHVlKSB7XHJcbiAgICAvLyAgICAgICAgIHJlc0RhdGEgPSByZXNEYXRhLnJldHVyblZhbHVlO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgICB0aGlzLmNvbHVtbnMgPSByZXNEYXRhLmNvbHVtbnM7XHJcbiAgICAvLyAgICAgY29uc3QgdHJlZUluZm8gPSByZXNEYXRhLnRyZWVJbmZvO1xyXG4gICAgLy8gICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tc3RyaW5nLWxpdGVyYWxcclxuICAgIC8vICAgICBpZiAoIXRyZWVJbmZvWyd0cmVlRGF0YUlzSW5pdCddKSB7XHJcbiAgICAvLyAgICAgICAgIGlmICh0cmVlSW5mby5sYXllclR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3BhdGhjb2RlJykge1xyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5sb29rdXBVdGlscy5tYWtlVHJlZShyZXNEYXRhLml0ZW1zLCB0cmVlSW5mbyk7XHJcbiAgICAvLyAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmxvb2t1cFV0aWxzLm1ha2VUcmVlV2l0aFBhcmVudElEKFxyXG4gICAgLy8gICAgICAgICAgICAgICAgIHJlc0RhdGEuaXRlbXMsXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgJycsXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgYCR7dHJlZUluZm8uZGF0YUZpZWxkfS4ke3RyZWVJbmZvLnBhcmVudEZpZWxkfWAsXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgdGhpcy5pZEZpZWxkXHJcbiAgICAvLyAgICAgICAgICAgICApO1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICAgIHRoaXMubG9hZERhdGEodGhpcy5kYXRhLCB0aGlzLnNlbGVjdGVkVmFsdWVzLCAoZGF0YUFyciwgdmFsKSA9PiB7XHJcbiAgICAvLyAgICAgICAgIHJldHVybiBlYWNoRGF0YShkYXRhQXJyLCB2YWwsIHRoaXMuaWRGaWVsZCk7XHJcbiAgICAvLyAgICAgICAgIGZ1bmN0aW9uIGVhY2hEYXRhKHBhcmFtRGF0YSwgcGFyYW1WYWwsIGlkRmllbGQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGxldCBydG5EYXRhOiBhbnkgPSAnJztcclxuICAgIC8vICAgICAgICAgICAgIHBhcmFtRGF0YS5maW5kKGQgPT4ge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0cmlwbGUtZXF1YWxzXHJcbiAgICAvLyAgICAgICAgICAgICAgICAgaWYgKGQuZGF0YVtpZEZpZWxkXSA9PSBwYXJhbVZhbCkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICBydG5EYXRhID0gZC5kYXRhO1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIC8vICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQuY2hpbGRyZW4gJiYgZC5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgcnRuRGF0YSA9IGVhY2hEYXRhKGQuY2hpbGRyZW4sIHBhcmFtVmFsLCBpZEZpZWxkKTtcclxuICAgIC8vICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgfVxyXG4gICAgLy8gICAgICAgICAgICAgfSk7XHJcbiAgICAvLyAgICAgICAgICAgICByZXR1cm4gcnRuRGF0YTtcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gICAgIHRoaXMuY2xvc2VMb2FkaW5nKCk7XHJcbiAgICAvLyB9XHJcbiAgICAvLyBwcml2YXRlIHNob3dMb2FkaW5nKCkge1xyXG4gICAgLy8gICAgIHRoaXMubG9hZGluZyA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gY2xvc2VMb2FkaW5nKCkge1xyXG4gICAgLy8gICAgIGlmICh0aGlzLmxvYWRpbmcpIHtcclxuICAgIC8vICAgICAgICAgdGhpcy5sb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAvLyAgICAgICAgIHRoaXMubG9hZGluZyA9IG51bGw7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG59XHJcbiJdfQ==
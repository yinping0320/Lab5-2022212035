/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
// tslint:disable: forin
import { Emitter, Disposable, CompositeDisposable } from './event-kit';
// import { calculateSpecificity, validateSelector } from 'clear-cut';
// const _ = require('underscore-plus')
/** @type {?} */
var SequenceCount = 0;
// Public: Associates listener functions with commands in a
// context-sensitive way using CSS selectors. You can access a global instance of
// this class via `atom.commands`, and commands registered there will be
// presented in the command palette.
//
// The global command registry facilitates a style of event handling known as
// *event delegation* that was popularized by jQuery. Atom commands are expressed
// as custom DOM events that can be invoked on the currently focused element via
// a key binding or manually via the command palette. Rather than binding
// listeners for command events directly to DOM nodes, you instead register
// command event listeners globally on `atom.commands` and constrain them to
// specific kinds of elements with CSS selectors.
//
// Command names must follow the `namespace:action` pattern, where `namespace`
// will typically be the name of your package, and `action` describes the
// behavior of your command. If either part consists of multiple words, these
// must be separated by hyphens. E.g. `awesome-package:turn-it-up-to-eleven`.
// All words should be lowercased.
//
// As the event bubbles upward through the DOM, all registered event listeners
// with matching selectors are invoked in order of specificity. In the event of a
// specificity tie, the most recently registered listener is invoked first. This
// mirrors the "cascade" semantics of CSS. Event listeners are invoked in the
// context of the current DOM node, meaning `this` always points at
// `event.currentTarget`. As is normally the case with DOM events,
// `stopPropagation` and `stopImmediatePropagation` can be used to terminate the
// bubbling process and prevent invocation of additional listeners.
//
// ## Example
//
// Here is a command that inserts the current date in an editor:
//
// ```coffee
// atom.commands.add 'atom-text-editor',
//   'user:insert-date': (event) ->
//     editor = @getModel()
//     editor.insertText(new Date().toLocaleString())
// ```
var 
// Public: Associates listener functions with commands in a
// context-sensitive way using CSS selectors. You can access a global instance of
// this class via `atom.commands`, and commands registered there will be
// presented in the command palette.
//
// The global command registry facilitates a style of event handling known as
// *event delegation* that was popularized by jQuery. Atom commands are expressed
// as custom DOM events that can be invoked on the currently focused element via
// a key binding or manually via the command palette. Rather than binding
// listeners for command events directly to DOM nodes, you instead register
// command event listeners globally on `atom.commands` and constrain them to
// specific kinds of elements with CSS selectors.
//
// Command names must follow the `namespace:action` pattern, where `namespace`
// will typically be the name of your package, and `action` describes the
// behavior of your command. If either part consists of multiple words, these
// must be separated by hyphens. E.g. `awesome-package:turn-it-up-to-eleven`.
// All words should be lowercased.
//
// As the event bubbles upward through the DOM, all registered event listeners
// with matching selectors are invoked in order of specificity. In the event of a
// specificity tie, the most recently registered listener is invoked first. This
// mirrors the "cascade" semantics of CSS. Event listeners are invoked in the
// context of the current DOM node, meaning `this` always points at
// `event.currentTarget`. As is normally the case with DOM events,
// `stopPropagation` and `stopImmediatePropagation` can be used to terminate the
// bubbling process and prevent invocation of additional listeners.
//
// ## Example
//
// Here is a command that inserts the current date in an editor:
//
// ```coffee
// atom.commands.add 'atom-text-editor',
//   'user:insert-date': (event) ->
//     editor = @getModel()
//     editor.insertText(new Date().toLocaleString())
// ```
CommandRegistry = /** @class */ (function () {
    function CommandRegistry() {
        this.handleCommandEvent = this.handleCommandEvent.bind(this);
        this.rootNode = null;
        this.clear();
    }
    /**
     * @return {?}
     */
    CommandRegistry.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.registeredCommands = {};
        this.selectorBasedListenersByCommandName = {};
        this.inlineListenersByCommandName = {};
        this.emitter = new Emitter();
    };
    /**
     * @param {?} rootNode
     * @return {?}
     */
    CommandRegistry.prototype.attach = /**
     * @param {?} rootNode
     * @return {?}
     */
    function (rootNode) {
        this.rootNode = rootNode;
        for (var command in this.selectorBasedListenersByCommandName) {
            this.commandRegistered(command);
        }
        for (var command in this.inlineListenersByCommandName) {
            this.commandRegistered(command);
        }
    };
    /**
     * @return {?}
     */
    CommandRegistry.prototype.destroy = /**
     * @return {?}
     */
    function () {
        for (var commandName in this.registeredCommands) {
            this.rootNode.removeEventListener(commandName, this.handleCommandEvent, true);
        }
    };
    // Public: Add one or more command listeners associated with a selector.
    //
    // ## Arguments: Registering One Command
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the command will be globally associated with all matching
    //   elements. The `,` combinator is not currently supported. If you pass a
    //   DOM element, the command will be associated with just that element.
    // * `commandName` A {String} containing the name of a command you want to
    //   handle such as `user:insert-date`.
    // * `listener` A listener which handles the event.  Either a {Function} to
    //   call when the given command is invoked on an element matching the
    //   selector, or an {Object} with a `didDispatch` property which is such a
    //   function.
    //
    //   The function (`listener` itself if it is a function, or the `didDispatch`
    //   method if `listener` is an object) will be called with `this` referencing
    //   the matching DOM node and the following argument:
    //     * `event`: A standard DOM event instance. Call `stopPropagation` or
    //       `stopImmediatePropagation` to terminate bubbling early.
    //
    //   Additionally, `listener` may have additional properties which are returned
    //   to those who query using `atom.commands.findCommands`, as well as several
    //   meaningful metadata properties:
    //     * `displayName`: Overrides any generated `displayName` that would
    //       otherwise be generated from the event name.
    //     * `description`: Used by consumers to display detailed information about
    //       the command.
    //     * `hiddenInCommandPalette`: If `true`, this command will not appear in
    //       the bundled command palette by default, but can still be shown with.
    //       the `Command Palette: Show Hidden Commands` command. This is a good
    //       option when you need to register large numbers of commands that don't
    //       make sense to be executed from the command palette. Please use this
    //       option conservatively, as it could reduce the discoverability of your
    //       package's commands.
    //
    // ## Arguments: Registering Multiple Commands
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the commands will be globally associated with all
    //   matching elements. The `,` combinator is not currently supported.
    //   If you pass a DOM element, the command will be associated with just that
    //   element.
    // * `commands` An {Object} mapping command names like `user:insert-date` to
    //   listener {Function}s.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to remove the
    // added command handler(s).
    // Public: Add one or more command listeners associated with a selector.
    //
    // ## Arguments: Registering One Command
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the command will be globally associated with all matching
    //   elements. The `,` combinator is not currently supported. If you pass a
    //   DOM element, the command will be associated with just that element.
    // * `commandName` A {String} containing the name of a command you want to
    //   handle such as `user:insert-date`.
    // * `listener` A listener which handles the event.  Either a {Function} to
    //   call when the given command is invoked on an element matching the
    //   selector, or an {Object} with a `didDispatch` property which is such a
    //   function.
    //
    //   The function (`listener` itself if it is a function, or the `didDispatch`
    //   method if `listener` is an object) will be called with `this` referencing
    //   the matching DOM node and the following argument:
    //     * `event`: A standard DOM event instance. Call `stopPropagation` or
    //       `stopImmediatePropagation` to terminate bubbling early.
    //
    //   Additionally, `listener` may have additional properties which are returned
    //   to those who query using `atom.commands.findCommands`, as well as several
    //   meaningful metadata properties:
    //     * `displayName`: Overrides any generated `displayName` that would
    //       otherwise be generated from the event name.
    //     * `description`: Used by consumers to display detailed information about
    //       the command.
    //     * `hiddenInCommandPalette`: If `true`, this command will not appear in
    //       the bundled command palette by default, but can still be shown with.
    //       the `Command Palette: Show Hidden Commands` command. This is a good
    //       option when you need to register large numbers of commands that don't
    //       make sense to be executed from the command palette. Please use this
    //       option conservatively, as it could reduce the discoverability of your
    //       package's commands.
    //
    // ## Arguments: Registering Multiple Commands
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the commands will be globally associated with all
    //   matching elements. The `,` combinator is not currently supported.
    //   If you pass a DOM element, the command will be associated with just that
    //   element.
    // * `commands` An {Object} mapping command names like `user:insert-date` to
    //   listener {Function}s.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to remove the
    // added command handler(s).
    /**
     * @param {?} target
     * @param {?} commandName
     * @param {?} listener
     * @param {?=} throwOnInvalidSelector
     * @return {?}
     */
    CommandRegistry.prototype.add = 
    // Public: Add one or more command listeners associated with a selector.
    //
    // ## Arguments: Registering One Command
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the command will be globally associated with all matching
    //   elements. The `,` combinator is not currently supported. If you pass a
    //   DOM element, the command will be associated with just that element.
    // * `commandName` A {String} containing the name of a command you want to
    //   handle such as `user:insert-date`.
    // * `listener` A listener which handles the event.  Either a {Function} to
    //   call when the given command is invoked on an element matching the
    //   selector, or an {Object} with a `didDispatch` property which is such a
    //   function.
    //
    //   The function (`listener` itself if it is a function, or the `didDispatch`
    //   method if `listener` is an object) will be called with `this` referencing
    //   the matching DOM node and the following argument:
    //     * `event`: A standard DOM event instance. Call `stopPropagation` or
    //       `stopImmediatePropagation` to terminate bubbling early.
    //
    //   Additionally, `listener` may have additional properties which are returned
    //   to those who query using `atom.commands.findCommands`, as well as several
    //   meaningful metadata properties:
    //     * `displayName`: Overrides any generated `displayName` that would
    //       otherwise be generated from the event name.
    //     * `description`: Used by consumers to display detailed information about
    //       the command.
    //     * `hiddenInCommandPalette`: If `true`, this command will not appear in
    //       the bundled command palette by default, but can still be shown with.
    //       the `Command Palette: Show Hidden Commands` command. This is a good
    //       option when you need to register large numbers of commands that don't
    //       make sense to be executed from the command palette. Please use this
    //       option conservatively, as it could reduce the discoverability of your
    //       package's commands.
    //
    // ## Arguments: Registering Multiple Commands
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the commands will be globally associated with all
    //   matching elements. The `,` combinator is not currently supported.
    //   If you pass a DOM element, the command will be associated with just that
    //   element.
    // * `commands` An {Object} mapping command names like `user:insert-date` to
    //   listener {Function}s.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to remove the
    // added command handler(s).
    /**
     * @param {?} target
     * @param {?} commandName
     * @param {?} listener
     * @param {?=} throwOnInvalidSelector
     * @return {?}
     */
    function (target, commandName, listener, throwOnInvalidSelector) {
        if (throwOnInvalidSelector === void 0) { throwOnInvalidSelector = true; }
        if (typeof commandName === 'object') {
            /** @type {?} */
            var commands = commandName;
            throwOnInvalidSelector = listener;
            /** @type {?} */
            var disposable = new CompositeDisposable();
            for (commandName in commands) {
                listener = commands[commandName];
                disposable.add(this.add(target, commandName, listener, throwOnInvalidSelector));
            }
            return disposable;
        }
        if (listener == null) {
            throw new Error('Cannot register a command with a null listener.');
        }
        // type Listener = ((e: CustomEvent) => void) | {
        //   displayName?: string,
        //   description?: string,
        //   didDispatch(e: CustomEvent): void,
        // }
        if ((typeof listener !== 'function') && (typeof listener.didDispatch !== 'function')) {
            throw new Error('Listener must be a callback function or an object with a didDispatch method.');
        }
        if (typeof target === 'string') {
            if (throwOnInvalidSelector) {
                validateSelector(target);
            }
            return this.addSelectorBasedListener(target, commandName, listener);
        }
        else {
            return this.addInlineListener(target, commandName, listener);
        }
    };
    /**
     * @param {?} selector
     * @param {?} commandName
     * @param {?} listener
     * @return {?}
     */
    CommandRegistry.prototype.addSelectorBasedListener = /**
     * @param {?} selector
     * @param {?} commandName
     * @param {?} listener
     * @return {?}
     */
    function (selector, commandName, listener) {
        var _this = this;
        if (this.selectorBasedListenersByCommandName[commandName] == null) {
            this.selectorBasedListenersByCommandName[commandName] = [];
        }
        /** @type {?} */
        var listenersForCommand = this.selectorBasedListenersByCommandName[commandName];
        /** @type {?} */
        var selectorListener = new SelectorBasedListener(selector, commandName, listener);
        listenersForCommand.push(selectorListener);
        this.commandRegistered(commandName);
        return new Disposable(function () {
            listenersForCommand.splice(listenersForCommand.indexOf(selectorListener), 1);
            if (listenersForCommand.length === 0) {
                delete _this.selectorBasedListenersByCommandName[commandName];
            }
        });
    };
    /**
     * @param {?} element
     * @param {?} commandName
     * @param {?} listener
     * @return {?}
     */
    CommandRegistry.prototype.addInlineListener = /**
     * @param {?} element
     * @param {?} commandName
     * @param {?} listener
     * @return {?}
     */
    function (element, commandName, listener) {
        if (this.inlineListenersByCommandName[commandName] == null) {
            this.inlineListenersByCommandName[commandName] = new WeakMap();
        }
        /** @type {?} */
        var listenersForCommand = this.inlineListenersByCommandName[commandName];
        /** @type {?} */
        var listenersForElement = listenersForCommand.get(element);
        if (!listenersForElement) {
            listenersForElement = [];
            listenersForCommand.set(element, listenersForElement);
        }
        /** @type {?} */
        var inlineListener = new InlineListener(commandName, listener);
        listenersForElement.push(inlineListener);
        this.commandRegistered(commandName);
        return new Disposable(function () {
            listenersForElement.splice(listenersForElement.indexOf(inlineListener), 1);
            if (listenersForElement.length === 0) {
                listenersForCommand.delete(element);
            }
        });
    };
    // Public: Find all registered commands matching a query.
    //
    // * `params` An {Object} containing one or more of the following keys:
    //   * `target` A DOM node that is the hypothetical target of a given command.
    //
    // Returns an {Array} of `CommandDescriptor` {Object}s containing the following keys:
    //  * `name` The name of the command. For example, `user:insert-date`.
    //  * `displayName` The display name of the command. For example,
    //    `User: Insert Date`.
    // Additional metadata may also be present in the returned descriptor:
    //  * `description` a {String} describing the function of the command in more
    //    detail than the title
    //  * `tags` an {Array} of {String}s that describe keywords related to the
    //    command
    //  Any additional nonstandard metadata provided when the command was `add`ed
    //  may also be present in the returned descriptor.
    // Public: Find all registered commands matching a query.
    //
    // * `params` An {Object} containing one or more of the following keys:
    //   * `target` A DOM node that is the hypothetical target of a given command.
    //
    // Returns an {Array} of `CommandDescriptor` {Object}s containing the following keys:
    //  * `name` The name of the command. For example, `user:insert-date`.
    //  * `displayName` The display name of the command. For example,
    //    `User: Insert Date`.
    // Additional metadata may also be present in the returned descriptor:
    //  * `description` a {String} describing the function of the command in more
    //    detail than the title
    //  * `tags` an {Array} of {String}s that describe keywords related to the
    //    command
    //  Any additional nonstandard metadata provided when the command was `add`ed
    //  may also be present in the returned descriptor.
    /**
     * @param {?} __0
     * @return {?}
     */
    CommandRegistry.prototype.findCommands = 
    // Public: Find all registered commands matching a query.
    //
    // * `params` An {Object} containing one or more of the following keys:
    //   * `target` A DOM node that is the hypothetical target of a given command.
    //
    // Returns an {Array} of `CommandDescriptor` {Object}s containing the following keys:
    //  * `name` The name of the command. For example, `user:insert-date`.
    //  * `displayName` The display name of the command. For example,
    //    `User: Insert Date`.
    // Additional metadata may also be present in the returned descriptor:
    //  * `description` a {String} describing the function of the command in more
    //    detail than the title
    //  * `tags` an {Array} of {String}s that describe keywords related to the
    //    command
    //  Any additional nonstandard metadata provided when the command was `add`ed
    //  may also be present in the returned descriptor.
    /**
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var target = _a.target;
        var e_1, _b;
        /** @type {?} */
        var commandNames = new Set();
        /** @type {?} */
        var commands = [];
        /** @type {?} */
        var currentTarget = target;
        while (true) {
            /** @type {?} */
            var listeners = void 0;
            for (var name_1 in this.inlineListenersByCommandName) {
                listeners = this.inlineListenersByCommandName[name_1];
                if (listeners.has(currentTarget) && !commandNames.has(name_1)) {
                    commandNames.add(name_1);
                    /** @type {?} */
                    var targetListeners = listeners.get(currentTarget);
                    commands.push.apply(commands, tslib_1.__spread(targetListeners.map(function (listener) { return listener.descriptor; })));
                }
            }
            for (var commandName in this.selectorBasedListenersByCommandName) {
                listeners = this.selectorBasedListenersByCommandName[commandName];
                try {
                    for (var listeners_1 = tslib_1.__values(listeners), listeners_1_1 = listeners_1.next(); !listeners_1_1.done; listeners_1_1 = listeners_1.next()) {
                        var listener = listeners_1_1.value;
                        if (listener.matchesTarget(currentTarget)) {
                            if (!commandNames.has(commandName)) {
                                commandNames.add(commandName);
                                commands.push(listener.descriptor);
                            }
                        }
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (listeners_1_1 && !listeners_1_1.done && (_b = listeners_1.return)) _b.call(listeners_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
            if (currentTarget === window) {
                break;
            }
            currentTarget = currentTarget.parentNode || window;
        }
        return commands;
    };
    // Public: Simulate the dispatch of a command on a DOM node.
    //
    // This can be useful for testing when you want to simulate the invocation of a
    // command on a detached DOM node. Otherwise, the DOM node in question needs to
    // be attached to the document so the event bubbles up to the root node to be
    // processed.
    //
    // * `target` The DOM node at which to start bubbling the command event.
    // * `commandName` {String} indicating the name of the command to dispatch.
    // Public: Simulate the dispatch of a command on a DOM node.
    //
    // This can be useful for testing when you want to simulate the invocation of a
    // command on a detached DOM node. Otherwise, the DOM node in question needs to
    // be attached to the document so the event bubbles up to the root node to be
    // processed.
    //
    // * `target` The DOM node at which to start bubbling the command event.
    // * `commandName` {String} indicating the name of the command to dispatch.
    /**
     * @param {?} target
     * @param {?} commandName
     * @param {?} detail
     * @return {?}
     */
    CommandRegistry.prototype.dispatch = 
    // Public: Simulate the dispatch of a command on a DOM node.
    //
    // This can be useful for testing when you want to simulate the invocation of a
    // command on a detached DOM node. Otherwise, the DOM node in question needs to
    // be attached to the document so the event bubbles up to the root node to be
    // processed.
    //
    // * `target` The DOM node at which to start bubbling the command event.
    // * `commandName` {String} indicating the name of the command to dispatch.
    /**
     * @param {?} target
     * @param {?} commandName
     * @param {?} detail
     * @return {?}
     */
    function (target, commandName, detail) {
        /** @type {?} */
        var event = new CustomEvent(commandName, { bubbles: true, detail: detail });
        Object.defineProperty(event, 'target', { value: target });
        return this.handleCommandEvent(event);
    };
    // Public: Invoke the given callback before dispatching a command event.
    //
    // * `callback` {Function} to be called before dispatching each command
    //   * `event` The Event that will be dispatched
    // Public: Invoke the given callback before dispatching a command event.
    //
    // * `callback` {Function} to be called before dispatching each command
    //   * `event` The Event that will be dispatched
    /**
     * @param {?} callback
     * @return {?}
     */
    CommandRegistry.prototype.onWillDispatch = 
    // Public: Invoke the given callback before dispatching a command event.
    //
    // * `callback` {Function} to be called before dispatching each command
    //   * `event` The Event that will be dispatched
    /**
     * @param {?} callback
     * @return {?}
     */
    function (callback) {
        return this.emitter.on('will-dispatch', callback);
    };
    // Public: Invoke the given callback after dispatching a command event.
    //
    // * `callback` {Function} to be called after dispatching each command
    //   * `event` The Event that was dispatched
    // Public: Invoke the given callback after dispatching a command event.
    //
    // * `callback` {Function} to be called after dispatching each command
    //   * `event` The Event that was dispatched
    /**
     * @param {?} callback
     * @return {?}
     */
    CommandRegistry.prototype.onDidDispatch = 
    // Public: Invoke the given callback after dispatching a command event.
    //
    // * `callback` {Function} to be called after dispatching each command
    //   * `event` The Event that was dispatched
    /**
     * @param {?} callback
     * @return {?}
     */
    function (callback) {
        return this.emitter.on('did-dispatch', callback);
    };
    /**
     * @return {?}
     */
    CommandRegistry.prototype.getSnapshot = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var snapshot = {};
        for (var commandName in this.selectorBasedListenersByCommandName) {
            /** @type {?} */
            var listeners = this.selectorBasedListenersByCommandName[commandName];
            snapshot[commandName] = listeners.slice();
        }
        return snapshot;
    };
    /**
     * @param {?} snapshot
     * @return {?}
     */
    CommandRegistry.prototype.restoreSnapshot = /**
     * @param {?} snapshot
     * @return {?}
     */
    function (snapshot) {
        this.selectorBasedListenersByCommandName = {};
        for (var commandName in snapshot) {
            /** @type {?} */
            var listeners = snapshot[commandName];
            this.selectorBasedListenersByCommandName[commandName] = listeners.slice();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    CommandRegistry.prototype.handleCommandEvent = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var e_2, _a;
        /** @type {?} */
        var propagationStopped = false;
        /** @type {?} */
        var immediatePropagationStopped = false;
        /** @type {?} */
        var matched = [];
        /** @type {?} */
        var currentTarget = event.target;
        /** @type {?} */
        var dispatchedEvent = new CustomEvent(event.type, {
            bubbles: true,
            detail: event.detail
        });
        Object.defineProperty(dispatchedEvent, 'eventPhase', {
            value: Event.BUBBLING_PHASE
        });
        Object.defineProperty(dispatchedEvent, 'currentTarget', {
            get: /**
             * @return {?}
             */
            function () {
                return currentTarget;
            }
        });
        Object.defineProperty(dispatchedEvent, 'target', { value: currentTarget });
        Object.defineProperty(dispatchedEvent, 'preventDefault', {
            value: /**
             * @return {?}
             */
            function () {
                return event.preventDefault();
            }
        });
        Object.defineProperty(dispatchedEvent, 'stopPropagation', {
            value: /**
             * @return {?}
             */
            function () {
                event.stopPropagation();
                propagationStopped = true;
            }
        });
        Object.defineProperty(dispatchedEvent, 'stopImmediatePropagation', {
            value: /**
             * @return {?}
             */
            function () {
                event.stopImmediatePropagation();
                propagationStopped = true;
                immediatePropagationStopped = true;
            }
        });
        Object.defineProperty(dispatchedEvent, 'abortKeyBinding', {
            value: /**
             * @return {?}
             */
            function () {
                if (typeof event.abortKeyBinding === 'function') {
                    event.abortKeyBinding();
                }
            }
        });
        try {
            for (var _b = tslib_1.__values(Object.keys(event)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var key = _c.value;
                if (!(key in dispatchedEvent)) {
                    dispatchedEvent[key] = event[key];
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        this.emitter.emit('will-dispatch', dispatchedEvent);
        while (true) {
            /** @type {?} */
            var commandInlineListeners = this.inlineListenersByCommandName[event.type]
                ? this.inlineListenersByCommandName[event.type].get(currentTarget)
                : null;
            /** @type {?} */
            var listeners = commandInlineListeners || [];
            if (currentTarget.webkitMatchesSelector != null) {
                /** @type {?} */
                var selectorBasedListeners = (this.selectorBasedListenersByCommandName[event.type] || [])
                    .filter(function (listener) { return listener.matchesTarget(currentTarget); })
                    .sort(function (a, b) { return a.compare(b); });
                listeners = selectorBasedListeners.concat(listeners);
            }
            // Call inline listeners first in reverse registration order,
            // and selector-based listeners by specificity and reverse
            // registration order.
            for (var i = listeners.length - 1; i >= 0; i--) {
                /** @type {?} */
                var listener = listeners[i];
                if (immediatePropagationStopped) {
                    break;
                }
                matched.push(listener.didDispatch.call(currentTarget, dispatchedEvent));
            }
            if (currentTarget === window) {
                break;
            }
            if (propagationStopped) {
                break;
            }
            currentTarget = currentTarget.parentNode || window;
        }
        this.emitter.emit('did-dispatch', dispatchedEvent);
        return (matched.length > 0 ? Promise.all(matched) : null);
    };
    /**
     * @param {?} commandName
     * @return {?}
     */
    CommandRegistry.prototype.commandRegistered = /**
     * @param {?} commandName
     * @return {?}
     */
    function (commandName) {
        if (this.rootNode != null && !this.registeredCommands[commandName]) {
            this.rootNode.addEventListener(commandName, this.handleCommandEvent, true);
            return (this.registeredCommands[commandName] = true);
        }
    };
    return CommandRegistry;
}());
// Public: Associates listener functions with commands in a
// context-sensitive way using CSS selectors. You can access a global instance of
// this class via `atom.commands`, and commands registered there will be
// presented in the command palette.
//
// The global command registry facilitates a style of event handling known as
// *event delegation* that was popularized by jQuery. Atom commands are expressed
// as custom DOM events that can be invoked on the currently focused element via
// a key binding or manually via the command palette. Rather than binding
// listeners for command events directly to DOM nodes, you instead register
// command event listeners globally on `atom.commands` and constrain them to
// specific kinds of elements with CSS selectors.
//
// Command names must follow the `namespace:action` pattern, where `namespace`
// will typically be the name of your package, and `action` describes the
// behavior of your command. If either part consists of multiple words, these
// must be separated by hyphens. E.g. `awesome-package:turn-it-up-to-eleven`.
// All words should be lowercased.
//
// As the event bubbles upward through the DOM, all registered event listeners
// with matching selectors are invoked in order of specificity. In the event of a
// specificity tie, the most recently registered listener is invoked first. This
// mirrors the "cascade" semantics of CSS. Event listeners are invoked in the
// context of the current DOM node, meaning `this` always points at
// `event.currentTarget`. As is normally the case with DOM events,
// `stopPropagation` and `stopImmediatePropagation` can be used to terminate the
// bubbling process and prevent invocation of additional listeners.
//
// ## Example
//
// Here is a command that inserts the current date in an editor:
//
// ```coffee
// atom.commands.add 'atom-text-editor',
//   'user:insert-date': (event) ->
//     editor = @getModel()
//     editor.insertText(new Date().toLocaleString())
// ```
export { CommandRegistry };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.rootNode;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.registeredCommands;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.selectorBasedListenersByCommandName;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.inlineListenersByCommandName;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.emitter;
}
// type Listener = {
//   descriptor: CommandDescriptor,
//   extractDidDispatch: (e: CustomEvent) => void,
// };
var 
// type Listener = {
//   descriptor: CommandDescriptor,
//   extractDidDispatch: (e: CustomEvent) => void,
// };
SelectorBasedListener = /** @class */ (function () {
    function SelectorBasedListener(selector, commandName, listener) {
        this.selector = selector;
        this.didDispatch = extractDidDispatch(listener);
        this.descriptor = extractDescriptor(commandName, listener);
        this.specificity = calculateSpecificity(this.selector);
        this.sequenceNumber = SequenceCount++;
    }
    /**
     * @param {?} other
     * @return {?}
     */
    SelectorBasedListener.prototype.compare = /**
     * @param {?} other
     * @return {?}
     */
    function (other) {
        return (this.specificity - other.specificity ||
            this.sequenceNumber - other.sequenceNumber);
    };
    /**
     * @param {?} target
     * @return {?}
     */
    SelectorBasedListener.prototype.matchesTarget = /**
     * @param {?} target
     * @return {?}
     */
    function (target) {
        return target.webkitMatchesSelector && target.webkitMatchesSelector(this.selector);
    };
    return SelectorBasedListener;
}());
if (false) {
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.selector;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.didDispatch;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.descriptor;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.specificity;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.sequenceNumber;
}
var InlineListener = /** @class */ (function () {
    function InlineListener(commandName, listener) {
        this.didDispatch = extractDidDispatch(listener);
        this.descriptor = extractDescriptor(commandName, listener);
    }
    return InlineListener;
}());
if (false) {
    /**
     * @type {?}
     * @private
     */
    InlineListener.prototype.didDispatch;
    /**
     * @type {?}
     * @private
     */
    InlineListener.prototype.descriptor;
}
// type CommandDescriptor = {
//   name: string,
//   displayName: string,
// };
/**
 * @param {?} name
 * @param {?} listener
 * @return {?}
 */
function extractDescriptor(name, listener) {
    return Object.assign(omit(listener, 'didDispatch'), {
        name: name,
        displayName: listener.displayName ? listener.displayName : humanizeEventName(name)
    });
}
/**
 * @param {?} listener
 * @return {?}
 */
function extractDidDispatch(listener) {
    return typeof listener === 'function' ? listener : listener.didDispatch;
}
/**
 * @param {?} selector
 * @return {?}
 */
function validateSelector(selector) {
    if (!isSelectorValid(selector)) {
        /** @type {?} */
        var error = new SyntaxError(selector + ' is not a valid selector');
        // error.code = 'EBADSELECTOR';
        throw error;
    }
}
/**
 * @param {?} selector
 * @return {?}
 */
function isSelectorValid(selector) {
    /** @type {?} */
    var valid;
    try {
        document.querySelector(selector);
        valid = true;
    }
    catch (error) {
        valid = false;
    }
    return valid;
}
/**
 * @param {?} selector
 * @return {?}
 */
function calculateSpecificity(selector) {
    /** @type {?} */
    var specificity = calculate(selector);
    return specificity;
}
/**
 * @param {?} selector
 * @return {?}
 */
function calculate(selector) {
    /** @type {?} */
    var commaIndex = selector.indexOf(',');
    if (commaIndex !== -1) {
        selector = selector.substring(0, commaIndex);
    }
    /** @type {?} */
    var types = {
        a: 0,
        b: 0,
        c: 0
    };
    // The following regular expressions assume that selectors matching the preceding regular expressions have been removed
    /** @type {?} */
    var attributeRegex = /(\[[^\]]+\])/g;
    /** @type {?} */
    var idRegex = /(#[^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    var classRegex = /(\.[^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    var pseudoElementRegex = /(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/g;
    /** @type {?} */
    var pseudoClassRegex = /(:[^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    var elementRegex = /([^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    var notRegex = /:not\(([^\)]*)\)/g;
    /** @type {?} */
    var ruleRegex = /\{[^]*/gm;
    /** @type {?} */
    var separatorRegex = /[\*\s\+>~]/g;
    /** @type {?} */
    var straysRegex = /[#\.]/g;
    // Remove the negation psuedo-class (:not) but leave its argument because specificity is calculated on its argument
    selector = selector.replace(notRegex, ' $1 ');
    // Remove anything after a left brace in case a user has pasted in a rule, not just a selector
    selector = selector.replace(ruleRegex, ' ');
    // Add attribute selectors to parts collection (type b)
    selector = findMatch(attributeRegex, 'b', types, selector);
    // Add ID selectors to parts collection (type a)
    selector = findMatch(idRegex, 'a', types, selector);
    // Add class selectors to parts collection (type b)
    selector = findMatch(classRegex, 'b', types, selector);
    // Add pseudo-element selectors to parts collection (type c)
    selector = findMatch(pseudoElementRegex, 'c', types, selector);
    // Add pseudo-class selectors to parts collection (type b)
    selector = findMatch(pseudoClassRegex, 'b', types, selector);
    // Remove universal selector and separator characters
    selector = selector.replace(separatorRegex, ' ');
    // Remove any stray dots or hashes which aren't attached to words
    // These may be present if the user is live-editing this selector
    selector = selector.replace(straysRegex, ' ');
    // The only things left should be element selectors (type c)
    findMatch(elementRegex, 'c', types, selector);
    return (types.a * 100) + (types.b * 10) + (types.c * 1);
}
/**
 * @param {?} regex
 * @param {?} type
 * @param {?} types
 * @param {?} selector
 * @return {?}
 */
function findMatch(regex, type, types, selector) {
    var e_3, _a;
    /** @type {?} */
    var matches = selector.match(regex);
    if (matches) {
        try {
            for (var matches_1 = tslib_1.__values(matches), matches_1_1 = matches_1.next(); !matches_1_1.done; matches_1_1 = matches_1.next()) {
                var match = matches_1_1.value;
                types[type]++;
                // Replace this simple selector with whitespace so it won't be counted in further simple selectors
                selector = selector.replace(match, ' ');
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (matches_1_1 && !matches_1_1.done && (_a = matches_1.return)) _a.call(matches_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
    }
    return selector;
}
/**
 * @param {?} obj
 * @param {...?} props
 * @return {?}
 */
function omit(obj) {
    // const iteratee = (value, key) => !props.find(key);
    var props = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        props[_i - 1] = arguments[_i];
    }
    // const iteratee = (value, key) => !props.find(key);
    /** @type {?} */
    var result = {};
    if (!obj) {
        return result;
    }
    Object.keys(obj).forEach(function (key) {
        if (!props.find(function (prop) { return prop === key; })) {
            return;
        }
        result[key] = obj[key];
    });
    return result;
}
/**
 * @param {?} eventName
 * @param {?=} eventDoc
 * @return {?}
 */
function humanizeEventName(eventName, eventDoc) {
    if (eventDoc === void 0) { eventDoc = null; }
    /** @type {?} */
    var ref = eventName.split(':');
    var _a = tslib_1.__read(ref, 2), namespace = _a[0], event = _a[1];
    if (event == null) {
        return undash(namespace);
    }
    /** @type {?} */
    var namespaceDoc = undash(namespace);
    if (eventDoc == null) {
        eventDoc = undash(event);
    }
    return '' + namespaceDoc + ': ' + eventDoc;
}
/**
 * @param {?} str
 * @return {?}
 */
function undash(str) {
    if (str) {
        return str.split('-').join(' ');
    }
    else {
        return '';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC1yZWdpc3RyeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9pZGVmcmFtZXdvcmsvZ3NwL2NvbW1hbmQtcmVnaXN0cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxhQUFhLENBQUM7Ozs7SUFJbkUsYUFBYSxHQUFHLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdDckI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFPRTtRQUNFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNmLENBQUM7Ozs7SUFFRCwrQkFBSzs7O0lBQUw7UUFDRSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxtQ0FBbUMsR0FBRyxFQUFFLENBQUM7UUFDOUMsSUFBSSxDQUFDLDRCQUE0QixHQUFHLEVBQUUsQ0FBQztRQUN2QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7SUFDL0IsQ0FBQzs7Ozs7SUFFRCxnQ0FBTTs7OztJQUFOLFVBQU8sUUFBUTtRQUNiLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLEtBQUssSUFBTSxPQUFPLElBQUksSUFBSSxDQUFDLG1DQUFtQyxFQUFFO1lBQzlELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNqQztRQUVELEtBQUssSUFBTSxPQUFPLElBQUksSUFBSSxDQUFDLDRCQUE0QixFQUFFO1lBQ3ZE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QUFFLENBQUM7S0FDWDtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTogZm9yaW5cclxuaW1wb3J0IHsgRW1pdHRlciwgRGlzcG9zYWJsZSwgQ29tcG9zaXRlRGlzcG9zYWJsZSB9IGZyb20gJy4vZXZlbnQta2l0JztcclxuLy8gaW1wb3J0IHsgY2FsY3VsYXRlU3BlY2lmaWNpdHksIHZhbGlkYXRlU2VsZWN0b3IgfSBmcm9tICdjbGVhci1jdXQnO1xyXG4vLyBjb25zdCBfID0gcmVxdWlyZSgndW5kZXJzY29yZS1wbHVzJylcclxuXHJcbmxldCBTZXF1ZW5jZUNvdW50ID0gMDtcclxuXHJcbi8vIFB1YmxpYzogQXNzb2NpYXRlcyBsaXN0ZW5lciBmdW5jdGlvbnMgd2l0aCBjb21tYW5kcyBpbiBhXHJcbi8vIGNvbnRleHQtc2Vuc2l0aXZlIHdheSB1c2luZyBDU1Mgc2VsZWN0b3JzLiBZb3UgY2FuIGFjY2VzcyBhIGdsb2JhbCBpbnN0YW5jZSBvZlxyXG4vLyB0aGlzIGNsYXNzIHZpYSBgYXRvbS5jb21tYW5kc2AsIGFuZCBjb21tYW5kcyByZWdpc3RlcmVkIHRoZXJlIHdpbGwgYmVcclxuLy8gcHJlc2VudGVkIGluIHRoZSBjb21tYW5kIHBhbGV0dGUuXHJcbi8vXHJcbi8vIFRoZSBnbG9iYWwgY29tbWFuZCByZWdpc3RyeSBmYWNpbGl0YXRlcyBhIHN0eWxlIG9mIGV2ZW50IGhhbmRsaW5nIGtub3duIGFzXHJcbi8vICpldmVudCBkZWxlZ2F0aW9uKiB0aGF0IHdhcyBwb3B1bGFyaXplZCBieSBqUXVlcnkuIEF0b20gY29tbWFuZHMgYXJlIGV4cHJlc3NlZFxyXG4vLyBhcyBjdXN0b20gRE9NIGV2ZW50cyB0aGF0IGNhbiBiZSBpbnZva2VkIG9uIHRoZSBjdXJyZW50bHkgZm9jdXNlZCBlbGVtZW50IHZpYVxyXG4vLyBhIGtleSBiaW5kaW5nIG9yIG1hbnVhbGx5IHZpYSB0aGUgY29tbWFuZCBwYWxldHRlLiBSYXRoZXIgdGhhbiBiaW5kaW5nXHJcbi8vIGxpc3RlbmVycyBmb3IgY29tbWFuZCBldmVudHMgZGlyZWN0bHkgdG8gRE9NIG5vZGVzLCB5b3UgaW5zdGVhZCByZWdpc3RlclxyXG4vLyBjb21tYW5kIGV2ZW50IGxpc3RlbmVycyBnbG9iYWxseSBvbiBgYXRvbS5jb21tYW5kc2AgYW5kIGNvbnN0cmFpbiB0aGVtIHRvXHJcbi8vIHNwZWNpZmljIGtpbmRzIG9mIGVsZW1lbnRzIHdpdGggQ1NTIHNlbGVjdG9ycy5cclxuLy9cclxuLy8gQ29tbWFuZCBuYW1lcyBtdXN0IGZvbGxvdyB0aGUgYG5hbWVzcGFjZTphY3Rpb25gIHBhdHRlcm4sIHdoZXJlIGBuYW1lc3BhY2VgXHJcbi8vIHdpbGwgdHlwaWNhbGx5IGJlIHRoZSBuYW1lIG9mIHlvdXIgcGFja2FnZSwgYW5kIGBhY3Rpb25gIGRlc2NyaWJlcyB0aGVcclxuLy8gYmVoYXZpb3Igb2YgeW91ciBjb21tYW5kLiBJZiBlaXRoZXIgcGFydCBjb25zaXN0cyBvZiBtdWx0aXBsZSB3b3JkcywgdGhlc2VcclxuLy8gbXVzdCBiZSBzZXBhcmF0ZWQgYnkgaHlwaGVucy4gRS5nLiBgYXdlc29tZS1wYWNrYWdlOnR1cm4taXQtdXAtdG8tZWxldmVuYC5cclxuLy8gQWxsIHdvcmRzIHNob3VsZCBiZSBsb3dlcmNhc2VkLlxyXG4vL1xyXG4vLyBBcyB0aGUgZXZlbnQgYnViYmxlcyB1cHdhcmQgdGhyb3VnaCB0aGUgRE9NLCBhbGwgcmVnaXN0ZXJlZCBldmVudCBsaXN0ZW5lcnNcclxuLy8gd2l0aCBtYXRjaGluZyBzZWxlY3RvcnMgYXJlIGludm9rZWQgaW4gb3JkZXIgb2Ygc3BlY2lmaWNpdHkuIEluIHRoZSBldmVudCBvZiBhXHJcbi8vIHNwZWNpZmljaXR5IHRpZSwgdGhlIG1vc3QgcmVjZW50bHkgcmVnaXN0ZXJlZCBsaXN0ZW5lciBpcyBpbnZva2VkIGZpcnN0LiBUaGlzXHJcbi8vIG1pcnJvcnMgdGhlIFwiY2FzY2FkZVwiIHNlbWFudGljcyBvZiBDU1MuIEV2ZW50IGxpc3RlbmVycyBhcmUgaW52b2tlZCBpbiB0aGVcclxuLy8gY29udGV4dCBvZiB0aGUgY3VycmVudCBET00gbm9kZSwgbWVhbmluZyBgdGhpc2AgYWx3YXlzIHBvaW50cyBhdFxyXG4vLyBgZXZlbnQuY3VycmVudFRhcmdldGAuIEFzIGlzIG5vcm1hbGx5IHRoZSBjYXNlIHdpdGggRE9NIGV2ZW50cyxcclxuLy8gYHN0b3BQcm9wYWdhdGlvbmAgYW5kIGBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb25gIGNhbiBiZSB1c2VkIHRvIHRlcm1pbmF0ZSB0aGVcclxuLy8gYnViYmxpbmcgcHJvY2VzcyBhbmQgcHJldmVudCBpbnZvY2F0aW9uIG9mIGFkZGl0aW9uYWwgbGlzdGVuZXJzLlxyXG4vL1xyXG4vLyAjIyBFeGFtcGxlXHJcbi8vXHJcbi8vIEhlcmUgaXMgYSBjb21tYW5kIHRoYXQgaW5zZXJ0cyB0aGUgY3VycmVudCBkYXRlIGluIGFuIGVkaXRvcjpcclxuLy9cclxuLy8gYGBgY29mZmVlXHJcbi8vIGF0b20uY29tbWFuZHMuYWRkICdhdG9tLXRleHQtZWRpdG9yJyxcclxuLy8gICAndXNlcjppbnNlcnQtZGF0ZSc6IChldmVudCkgLT5cclxuLy8gICAgIGVkaXRvciA9IEBnZXRNb2RlbCgpXHJcbi8vICAgICBlZGl0b3IuaW5zZXJ0VGV4dChuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCkpXHJcbi8vIGBgYFxyXG5leHBvcnQgY2xhc3MgQ29tbWFuZFJlZ2lzdHJ5IHtcclxuICBwcml2YXRlIHJvb3ROb2RlOiBhbnk7XHJcbiAgcHJpdmF0ZSByZWdpc3RlcmVkQ29tbWFuZHM6IGFueTtcclxuICBwcml2YXRlIHNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lOiBhbnk7XHJcbiAgcHJpdmF0ZSBpbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lOiBhbnk7XHJcbiAgcHJpdmF0ZSBlbWl0dGVyOiBFbWl0dGVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuaGFuZGxlQ29tbWFuZEV2ZW50ID0gdGhpcy5oYW5kbGVDb21tYW5kRXZlbnQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMucm9vdE5vZGUgPSBudWxsO1xyXG4gICAgdGhpcy5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXIoKSB7XHJcbiAgICB0aGlzLnJlZ2lzdGVyZWRDb21tYW5kcyA9IHt9O1xyXG4gICAgdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZSA9IHt9O1xyXG4gICAgdGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lID0ge307XHJcbiAgICB0aGlzLmVtaXR0ZXIgPSBuZXcgRW1pdHRlcigpO1xyXG4gIH1cclxuXHJcbiAgYXR0YWNoKHJvb3ROb2RlKSB7XHJcbiAgICB0aGlzLnJvb3ROb2RlID0gcm9vdE5vZGU7XHJcbiAgICBmb3IgKGNvbnN0IGNvbW1hbmQgaW4gdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZSkge1xyXG4gICAgICB0aGlzLmNvbW1hbmRSZWdpc3RlcmVkKGNvbW1hbmQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgY29tbWFuZCBpbiB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWUpIHtcclxuICAgICAgdGhpcy5jb21tYW5kUmVnaXN0ZXJlZChjb21tYW5kKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRlc3Ryb3koKSB7XHJcbiAgICBmb3IgKGNvbnN0IGNvbW1hbmROYW1lIGluIHRoaXMucmVnaXN0ZXJlZENvbW1hbmRzKSB7XHJcbiAgICAgIHRoaXMucm9vdE5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICBjb21tYW5kTmFtZSxcclxuICAgICAgICB0aGlzLmhhbmRsZUNvbW1hbmRFdmVudCxcclxuICAgICAgICB0cnVlXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEFkZCBvbmUgb3IgbW9yZSBjb21tYW5kIGxpc3RlbmVycyBhc3NvY2lhdGVkIHdpdGggYSBzZWxlY3Rvci5cclxuICAvL1xyXG4gIC8vICMjIEFyZ3VtZW50czogUmVnaXN0ZXJpbmcgT25lIENvbW1hbmRcclxuICAvL1xyXG4gIC8vICogYHRhcmdldGAgQSB7U3RyaW5nfSBjb250YWluaW5nIGEgQ1NTIHNlbGVjdG9yIG9yIGEgRE9NIGVsZW1lbnQuIElmIHlvdVxyXG4gIC8vICAgcGFzcyBhIHNlbGVjdG9yLCB0aGUgY29tbWFuZCB3aWxsIGJlIGdsb2JhbGx5IGFzc29jaWF0ZWQgd2l0aCBhbGwgbWF0Y2hpbmdcclxuICAvLyAgIGVsZW1lbnRzLiBUaGUgYCxgIGNvbWJpbmF0b3IgaXMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQuIElmIHlvdSBwYXNzIGFcclxuICAvLyAgIERPTSBlbGVtZW50LCB0aGUgY29tbWFuZCB3aWxsIGJlIGFzc29jaWF0ZWQgd2l0aCBqdXN0IHRoYXQgZWxlbWVudC5cclxuICAvLyAqIGBjb21tYW5kTmFtZWAgQSB7U3RyaW5nfSBjb250YWluaW5nIHRoZSBuYW1lIG9mIGEgY29tbWFuZCB5b3Ugd2FudCB0b1xyXG4gIC8vICAgaGFuZGxlIHN1Y2ggYXMgYHVzZXI6aW5zZXJ0LWRhdGVgLlxyXG4gIC8vICogYGxpc3RlbmVyYCBBIGxpc3RlbmVyIHdoaWNoIGhhbmRsZXMgdGhlIGV2ZW50LiAgRWl0aGVyIGEge0Z1bmN0aW9ufSB0b1xyXG4gIC8vICAgY2FsbCB3aGVuIHRoZSBnaXZlbiBjb21tYW5kIGlzIGludm9rZWQgb24gYW4gZWxlbWVudCBtYXRjaGluZyB0aGVcclxuICAvLyAgIHNlbGVjdG9yLCBvciBhbiB7T2JqZWN0fSB3aXRoIGEgYGRpZERpc3BhdGNoYCBwcm9wZXJ0eSB3aGljaCBpcyBzdWNoIGFcclxuICAvLyAgIGZ1bmN0aW9uLlxyXG4gIC8vXHJcbiAgLy8gICBUaGUgZnVuY3Rpb24gKGBsaXN0ZW5lcmAgaXRzZWxmIGlmIGl0IGlzIGEgZnVuY3Rpb24sIG9yIHRoZSBgZGlkRGlzcGF0Y2hgXHJcbiAgLy8gICBtZXRob2QgaWYgYGxpc3RlbmVyYCBpcyBhbiBvYmplY3QpIHdpbGwgYmUgY2FsbGVkIHdpdGggYHRoaXNgIHJlZmVyZW5jaW5nXHJcbiAgLy8gICB0aGUgbWF0Y2hpbmcgRE9NIG5vZGUgYW5kIHRoZSBmb2xsb3dpbmcgYXJndW1lbnQ6XHJcbiAgLy8gICAgICogYGV2ZW50YDogQSBzdGFuZGFyZCBET00gZXZlbnQgaW5zdGFuY2UuIENhbGwgYHN0b3BQcm9wYWdhdGlvbmAgb3JcclxuICAvLyAgICAgICBgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uYCB0byB0ZXJtaW5hdGUgYnViYmxpbmcgZWFybHkuXHJcbiAgLy9cclxuICAvLyAgIEFkZGl0aW9uYWxseSwgYGxpc3RlbmVyYCBtYXkgaGF2ZSBhZGRpdGlvbmFsIHByb3BlcnRpZXMgd2hpY2ggYXJlIHJldHVybmVkXHJcbiAgLy8gICB0byB0aG9zZSB3aG8gcXVlcnkgdXNpbmcgYGF0b20uY29tbWFuZHMuZmluZENvbW1hbmRzYCwgYXMgd2VsbCBhcyBzZXZlcmFsXHJcbiAgLy8gICBtZWFuaW5nZnVsIG1ldGFkYXRhIHByb3BlcnRpZXM6XHJcbiAgLy8gICAgICogYGRpc3BsYXlOYW1lYDogT3ZlcnJpZGVzIGFueSBnZW5lcmF0ZWQgYGRpc3BsYXlOYW1lYCB0aGF0IHdvdWxkXHJcbiAgLy8gICAgICAgb3RoZXJ3aXNlIGJlIGdlbmVyYXRlZCBmcm9tIHRoZSBldmVudCBuYW1lLlxyXG4gIC8vICAgICAqIGBkZXNjcmlwdGlvbmA6IFVzZWQgYnkgY29uc3VtZXJzIHRvIGRpc3BsYXkgZGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXRcclxuICAvLyAgICAgICB0aGUgY29tbWFuZC5cclxuICAvLyAgICAgKiBgaGlkZGVuSW5Db21tYW5kUGFsZXR0ZWA6IElmIGB0cnVlYCwgdGhpcyBjb21tYW5kIHdpbGwgbm90IGFwcGVhciBpblxyXG4gIC8vICAgICAgIHRoZSBidW5kbGVkIGNvbW1hbmQgcGFsZXR0ZSBieSBkZWZhdWx0LCBidXQgY2FuIHN0aWxsIGJlIHNob3duIHdpdGguXHJcbiAgLy8gICAgICAgdGhlIGBDb21tYW5kIFBhbGV0dGU6IFNob3cgSGlkZGVuIENvbW1hbmRzYCBjb21tYW5kLiBUaGlzIGlzIGEgZ29vZFxyXG4gIC8vICAgICAgIG9wdGlvbiB3aGVuIHlvdSBuZWVkIHRvIHJlZ2lzdGVyIGxhcmdlIG51bWJlcnMgb2YgY29tbWFuZHMgdGhhdCBkb24ndFxyXG4gIC8vICAgICAgIG1ha2Ugc2Vuc2UgdG8gYmUgZXhlY3V0ZWQgZnJvbSB0aGUgY29tbWFuZCBwYWxldHRlLiBQbGVhc2UgdXNlIHRoaXNcclxuICAvLyAgICAgICBvcHRpb24gY29uc2VydmF0aXZlbHksIGFzIGl0IGNvdWxkIHJlZHVjZSB0aGUgZGlzY292ZXJhYmlsaXR5IG9mIHlvdXJcclxuICAvLyAgICAgICBwYWNrYWdlJ3MgY29tbWFuZHMuXHJcbiAgLy9cclxuICAvLyAjIyBBcmd1bWVudHM6IFJlZ2lzdGVyaW5nIE11bHRpcGxlIENvbW1hbmRzXHJcbiAgLy9cclxuICAvLyAqIGB0YXJnZXRgIEEge1N0cmluZ30gY29udGFpbmluZyBhIENTUyBzZWxlY3RvciBvciBhIERPTSBlbGVtZW50LiBJZiB5b3VcclxuICAvLyAgIHBhc3MgYSBzZWxlY3RvciwgdGhlIGNvbW1hbmRzIHdpbGwgYmUgZ2xvYmFsbHkgYXNzb2NpYXRlZCB3aXRoIGFsbFxyXG4gIC8vICAgbWF0Y2hpbmcgZWxlbWVudHMuIFRoZSBgLGAgY29tYmluYXRvciBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZC5cclxuICAvLyAgIElmIHlvdSBwYXNzIGEgRE9NIGVsZW1lbnQsIHRoZSBjb21tYW5kIHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoIGp1c3QgdGhhdFxyXG4gIC8vICAgZWxlbWVudC5cclxuICAvLyAqIGBjb21tYW5kc2AgQW4ge09iamVjdH0gbWFwcGluZyBjb21tYW5kIG5hbWVzIGxpa2UgYHVzZXI6aW5zZXJ0LWRhdGVgIHRvXHJcbiAgLy8gICBsaXN0ZW5lciB7RnVuY3Rpb259cy5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7RGlzcG9zYWJsZX0gb24gd2hpY2ggYC5kaXNwb3NlKClgIGNhbiBiZSBjYWxsZWQgdG8gcmVtb3ZlIHRoZVxyXG4gIC8vIGFkZGVkIGNvbW1hbmQgaGFuZGxlcihzKS5cclxuICBhZGQodGFyZ2V0LCBjb21tYW5kTmFtZSwgbGlzdGVuZXIsIHRocm93T25JbnZhbGlkU2VsZWN0b3IgPSB0cnVlKSB7XHJcbiAgICBpZiAodHlwZW9mIGNvbW1hbmROYW1lID09PSAnb2JqZWN0Jykge1xyXG4gICAgICBjb25zdCBjb21tYW5kcyA9IGNvbW1hbmROYW1lO1xyXG4gICAgICB0aHJvd09uSW52YWxpZFNlbGVjdG9yID0gbGlzdGVuZXI7XHJcbiAgICAgIGNvbnN0IGRpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xyXG4gICAgICBmb3IgKGNvbW1hbmROYW1lIGluIGNvbW1hbmRzKSB7XHJcbiAgICAgICAgbGlzdGVuZXIgPSBjb21tYW5kc1tjb21tYW5kTmFtZV07XHJcbiAgICAgICAgZGlzcG9zYWJsZS5hZGQodGhpcy5hZGQodGFyZ2V0LCBjb21tYW5kTmFtZSwgbGlzdGVuZXIsIHRocm93T25JbnZhbGlkU2VsZWN0b3IpKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZGlzcG9zYWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobGlzdGVuZXIgPT0gbnVsbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWdpc3RlciBhIGNvbW1hbmQgd2l0aCBhIG51bGwgbGlzdGVuZXIuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdHlwZSBMaXN0ZW5lciA9ICgoZTogQ3VzdG9tRXZlbnQpID0+IHZvaWQpIHwge1xyXG4gICAgLy8gICBkaXNwbGF5TmFtZT86IHN0cmluZyxcclxuICAgIC8vICAgZGVzY3JpcHRpb24/OiBzdHJpbmcsXHJcbiAgICAvLyAgIGRpZERpc3BhdGNoKGU6IEN1c3RvbUV2ZW50KTogdm9pZCxcclxuICAgIC8vIH1cclxuICAgIGlmICgodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSAmJiAodHlwZW9mIGxpc3RlbmVyLmRpZERpc3BhdGNoICE9PSAnZnVuY3Rpb24nKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xpc3RlbmVyIG11c3QgYmUgYSBjYWxsYmFjayBmdW5jdGlvbiBvciBhbiBvYmplY3Qgd2l0aCBhIGRpZERpc3BhdGNoIG1ldGhvZC4nKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgaWYgKHRocm93T25JbnZhbGlkU2VsZWN0b3IpIHtcclxuICAgICAgICB2YWxpZGF0ZVNlbGVjdG9yKHRhcmdldCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXMuYWRkU2VsZWN0b3JCYXNlZExpc3RlbmVyKHRhcmdldCwgY29tbWFuZE5hbWUsIGxpc3RlbmVyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmFkZElubGluZUxpc3RlbmVyKHRhcmdldCwgY29tbWFuZE5hbWUsIGxpc3RlbmVyKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFkZFNlbGVjdG9yQmFzZWRMaXN0ZW5lcihzZWxlY3RvciwgY29tbWFuZE5hbWUsIGxpc3RlbmVyKSB7XHJcbiAgICBpZiAodGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV0gPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2NvbW1hbmROYW1lXSA9IFtdO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbGlzdGVuZXJzRm9yQ29tbWFuZCA9IHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdO1xyXG4gICAgY29uc3Qgc2VsZWN0b3JMaXN0ZW5lciA9IG5ldyBTZWxlY3RvckJhc2VkTGlzdGVuZXIoc2VsZWN0b3IsIGNvbW1hbmROYW1lLCBsaXN0ZW5lcik7XHJcbiAgICBsaXN0ZW5lcnNGb3JDb21tYW5kLnB1c2goc2VsZWN0b3JMaXN0ZW5lcik7XHJcblxyXG4gICAgdGhpcy5jb21tYW5kUmVnaXN0ZXJlZChjb21tYW5kTmFtZSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBEaXNwb3NhYmxlKCgpID0+IHtcclxuICAgICAgbGlzdGVuZXJzRm9yQ29tbWFuZC5zcGxpY2UobGlzdGVuZXJzRm9yQ29tbWFuZC5pbmRleE9mKHNlbGVjdG9yTGlzdGVuZXIpLCAxKTtcclxuICAgICAgaWYgKGxpc3RlbmVyc0ZvckNvbW1hbmQubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZElubGluZUxpc3RlbmVyKGVsZW1lbnQsIGNvbW1hbmROYW1lLCBsaXN0ZW5lcikge1xyXG4gICAgaWYgKHRoaXMuaW5saW5lTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV0gPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdID0gbmV3IFdlYWtNYXAoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBsaXN0ZW5lcnNGb3JDb21tYW5kID0gdGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2NvbW1hbmROYW1lXTtcclxuICAgIGxldCBsaXN0ZW5lcnNGb3JFbGVtZW50ID0gbGlzdGVuZXJzRm9yQ29tbWFuZC5nZXQoZWxlbWVudCk7XHJcbiAgICBpZiAoIWxpc3RlbmVyc0ZvckVsZW1lbnQpIHtcclxuICAgICAgbGlzdGVuZXJzRm9yRWxlbWVudCA9IFtdO1xyXG4gICAgICBsaXN0ZW5lcnNGb3JDb21tYW5kLnNldChlbGVtZW50LCBsaXN0ZW5lcnNGb3JFbGVtZW50KTtcclxuICAgIH1cclxuICAgIGNvbnN0IGlubGluZUxpc3RlbmVyID0gbmV3IElubGluZUxpc3RlbmVyKGNvbW1hbmROYW1lLCBsaXN0ZW5lcik7XHJcbiAgICBsaXN0ZW5lcnNGb3JFbGVtZW50LnB1c2goaW5saW5lTGlzdGVuZXIpO1xyXG5cclxuICAgIHRoaXMuY29tbWFuZFJlZ2lzdGVyZWQoY29tbWFuZE5hbWUpO1xyXG5cclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XHJcbiAgICAgIGxpc3RlbmVyc0ZvckVsZW1lbnQuc3BsaWNlKGxpc3RlbmVyc0ZvckVsZW1lbnQuaW5kZXhPZihpbmxpbmVMaXN0ZW5lciksIDEpO1xyXG4gICAgICBpZiAobGlzdGVuZXJzRm9yRWxlbWVudC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBsaXN0ZW5lcnNGb3JDb21tYW5kLmRlbGV0ZShlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEZpbmQgYWxsIHJlZ2lzdGVyZWQgY29tbWFuZHMgbWF0Y2hpbmcgYSBxdWVyeS5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgQW4ge09iamVjdH0gY29udGFpbmluZyBvbmUgb3IgbW9yZSBvZiB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAqIGB0YXJnZXRgIEEgRE9NIG5vZGUgdGhhdCBpcyB0aGUgaHlwb3RoZXRpY2FsIHRhcmdldCBvZiBhIGdpdmVuIGNvbW1hbmQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIHtBcnJheX0gb2YgYENvbW1hbmREZXNjcmlwdG9yYCB7T2JqZWN0fXMgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICogYG5hbWVgIFRoZSBuYW1lIG9mIHRoZSBjb21tYW5kLiBGb3IgZXhhbXBsZSwgYHVzZXI6aW5zZXJ0LWRhdGVgLlxyXG4gIC8vICAqIGBkaXNwbGF5TmFtZWAgVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGUgY29tbWFuZC4gRm9yIGV4YW1wbGUsXHJcbiAgLy8gICAgYFVzZXI6IEluc2VydCBEYXRlYC5cclxuICAvLyBBZGRpdGlvbmFsIG1ldGFkYXRhIG1heSBhbHNvIGJlIHByZXNlbnQgaW4gdGhlIHJldHVybmVkIGRlc2NyaXB0b3I6XHJcbiAgLy8gICogYGRlc2NyaXB0aW9uYCBhIHtTdHJpbmd9IGRlc2NyaWJpbmcgdGhlIGZ1bmN0aW9uIG9mIHRoZSBjb21tYW5kIGluIG1vcmVcclxuICAvLyAgICBkZXRhaWwgdGhhbiB0aGUgdGl0bGVcclxuICAvLyAgKiBgdGFnc2AgYW4ge0FycmF5fSBvZiB7U3RyaW5nfXMgdGhhdCBkZXNjcmliZSBrZXl3b3JkcyByZWxhdGVkIHRvIHRoZVxyXG4gIC8vICAgIGNvbW1hbmRcclxuICAvLyAgQW55IGFkZGl0aW9uYWwgbm9uc3RhbmRhcmQgbWV0YWRhdGEgcHJvdmlkZWQgd2hlbiB0aGUgY29tbWFuZCB3YXMgYGFkZGBlZFxyXG4gIC8vICBtYXkgYWxzbyBiZSBwcmVzZW50IGluIHRoZSByZXR1cm5lZCBkZXNjcmlwdG9yLlxyXG4gIGZpbmRDb21tYW5kcyh7IHRhcmdldCB9KSB7XHJcbiAgICBjb25zdCBjb21tYW5kTmFtZXMgPSBuZXcgU2V0KCk7XHJcbiAgICBjb25zdCBjb21tYW5kcyA9IFtdO1xyXG4gICAgbGV0IGN1cnJlbnRUYXJnZXQgPSB0YXJnZXQ7XHJcbiAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICBsZXQgbGlzdGVuZXJzO1xyXG4gICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gdGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lKSB7XHJcbiAgICAgICAgbGlzdGVuZXJzID0gdGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW25hbWVdO1xyXG4gICAgICAgIGlmIChsaXN0ZW5lcnMuaGFzKGN1cnJlbnRUYXJnZXQpICYmICFjb21tYW5kTmFtZXMuaGFzKG5hbWUpKSB7XHJcbiAgICAgICAgICBjb21tYW5kTmFtZXMuYWRkKG5hbWUpO1xyXG4gICAgICAgICAgY29uc3QgdGFyZ2V0TGlzdGVuZXJzID0gbGlzdGVuZXJzLmdldChjdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICAgIGNvbW1hbmRzLnB1c2goXHJcbiAgICAgICAgICAgIC4uLnRhcmdldExpc3RlbmVycy5tYXAobGlzdGVuZXIgPT4gbGlzdGVuZXIuZGVzY3JpcHRvcilcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IGNvbW1hbmROYW1lIGluIHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWUpIHtcclxuICAgICAgICBsaXN0ZW5lcnMgPSB0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2NvbW1hbmROYW1lXTtcclxuICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIGxpc3RlbmVycykge1xyXG4gICAgICAgICAgaWYgKGxpc3RlbmVyLm1hdGNoZXNUYXJnZXQoY3VycmVudFRhcmdldCkpIHtcclxuICAgICAgICAgICAgaWYgKCFjb21tYW5kTmFtZXMuaGFzKGNvbW1hbmROYW1lKSkge1xyXG4gICAgICAgICAgICAgIGNvbW1hbmROYW1lcy5hZGQoY29tbWFuZE5hbWUpO1xyXG4gICAgICAgICAgICAgIGNvbW1hbmRzLnB1c2gobGlzdGVuZXIuZGVzY3JpcHRvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjdXJyZW50VGFyZ2V0ID09PSB3aW5kb3cpIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjdXJyZW50VGFyZ2V0ID0gY3VycmVudFRhcmdldC5wYXJlbnROb2RlIHx8IHdpbmRvdztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY29tbWFuZHM7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNpbXVsYXRlIHRoZSBkaXNwYXRjaCBvZiBhIGNvbW1hbmQgb24gYSBET00gbm9kZS5cclxuICAvL1xyXG4gIC8vIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgdGVzdGluZyB3aGVuIHlvdSB3YW50IHRvIHNpbXVsYXRlIHRoZSBpbnZvY2F0aW9uIG9mIGFcclxuICAvLyBjb21tYW5kIG9uIGEgZGV0YWNoZWQgRE9NIG5vZGUuIE90aGVyd2lzZSwgdGhlIERPTSBub2RlIGluIHF1ZXN0aW9uIG5lZWRzIHRvXHJcbiAgLy8gYmUgYXR0YWNoZWQgdG8gdGhlIGRvY3VtZW50IHNvIHRoZSBldmVudCBidWJibGVzIHVwIHRvIHRoZSByb290IG5vZGUgdG8gYmVcclxuICAvLyBwcm9jZXNzZWQuXHJcbiAgLy9cclxuICAvLyAqIGB0YXJnZXRgIFRoZSBET00gbm9kZSBhdCB3aGljaCB0byBzdGFydCBidWJibGluZyB0aGUgY29tbWFuZCBldmVudC5cclxuICAvLyAqIGBjb21tYW5kTmFtZWAge1N0cmluZ30gaW5kaWNhdGluZyB0aGUgbmFtZSBvZiB0aGUgY29tbWFuZCB0byBkaXNwYXRjaC5cclxuICBkaXNwYXRjaCh0YXJnZXQsIGNvbW1hbmROYW1lLCBkZXRhaWwpIHtcclxuICAgIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGNvbW1hbmROYW1lLCB7IGJ1YmJsZXM6IHRydWUsIGRldGFpbCB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShldmVudCwgJ3RhcmdldCcsIHsgdmFsdWU6IHRhcmdldCB9KTtcclxuICAgIHJldHVybiB0aGlzLmhhbmRsZUNvbW1hbmRFdmVudChldmVudCk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgYmVmb3JlIGRpc3BhdGNoaW5nIGEgY29tbWFuZCBldmVudC5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCBiZWZvcmUgZGlzcGF0Y2hpbmcgZWFjaCBjb21tYW5kXHJcbiAgLy8gICAqIGBldmVudGAgVGhlIEV2ZW50IHRoYXQgd2lsbCBiZSBkaXNwYXRjaGVkXHJcbiAgb25XaWxsRGlzcGF0Y2goY2FsbGJhY2spIHtcclxuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ3dpbGwtZGlzcGF0Y2gnLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgYWZ0ZXIgZGlzcGF0Y2hpbmcgYSBjb21tYW5kIGV2ZW50LlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIGFmdGVyIGRpc3BhdGNoaW5nIGVhY2ggY29tbWFuZFxyXG4gIC8vICAgKiBgZXZlbnRgIFRoZSBFdmVudCB0aGF0IHdhcyBkaXNwYXRjaGVkXHJcbiAgb25EaWREaXNwYXRjaChjYWxsYmFjaykge1xyXG4gICAgcmV0dXJuIHRoaXMuZW1pdHRlci5vbignZGlkLWRpc3BhdGNoJywgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgZ2V0U25hcHNob3QoKSB7XHJcbiAgICBjb25zdCBzbmFwc2hvdCA9IHt9O1xyXG4gICAgZm9yIChjb25zdCBjb21tYW5kTmFtZSBpbiB0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lKSB7XHJcbiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdO1xyXG4gICAgICBzbmFwc2hvdFtjb21tYW5kTmFtZV0gPSBsaXN0ZW5lcnMuc2xpY2UoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzbmFwc2hvdDtcclxuICB9XHJcblxyXG4gIHJlc3RvcmVTbmFwc2hvdChzbmFwc2hvdCkge1xyXG4gICAgdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZSA9IHt9O1xyXG4gICAgZm9yIChjb25zdCBjb21tYW5kTmFtZSBpbiBzbmFwc2hvdCkge1xyXG4gICAgICBjb25zdCBsaXN0ZW5lcnMgPSBzbmFwc2hvdFtjb21tYW5kTmFtZV07XHJcbiAgICAgIHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdID0gbGlzdGVuZXJzLnNsaWNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDb21tYW5kRXZlbnQoZXZlbnQpIHtcclxuICAgIGxldCBwcm9wYWdhdGlvblN0b3BwZWQgPSBmYWxzZTtcclxuICAgIGxldCBpbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQgPSBmYWxzZTtcclxuICAgIGNvbnN0IG1hdGNoZWQgPSBbXTtcclxuICAgIGxldCBjdXJyZW50VGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xyXG5cclxuICAgIGNvbnN0IGRpc3BhdGNoZWRFdmVudCA9IG5ldyBDdXN0b21FdmVudChldmVudC50eXBlLCB7XHJcbiAgICAgIGJ1YmJsZXM6IHRydWUsXHJcbiAgICAgIGRldGFpbDogZXZlbnQuZGV0YWlsXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXNwYXRjaGVkRXZlbnQsICdldmVudFBoYXNlJywge1xyXG4gICAgICB2YWx1ZTogRXZlbnQuQlVCQkxJTkdfUEhBU0VcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpc3BhdGNoZWRFdmVudCwgJ2N1cnJlbnRUYXJnZXQnLCB7XHJcbiAgICAgIGdldCgpIHtcclxuICAgICAgICByZXR1cm4gY3VycmVudFRhcmdldDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlzcGF0Y2hlZEV2ZW50LCAndGFyZ2V0JywgeyB2YWx1ZTogY3VycmVudFRhcmdldCB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXNwYXRjaGVkRXZlbnQsICdwcmV2ZW50RGVmYXVsdCcsIHtcclxuICAgICAgdmFsdWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpc3BhdGNoZWRFdmVudCwgJ3N0b3BQcm9wYWdhdGlvbicsIHtcclxuICAgICAgdmFsdWUoKSB7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgcHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlzcGF0Y2hlZEV2ZW50LCAnc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uJywge1xyXG4gICAgICB2YWx1ZSgpIHtcclxuICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBwcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlO1xyXG4gICAgICAgIGltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpc3BhdGNoZWRFdmVudCwgJ2Fib3J0S2V5QmluZGluZycsIHtcclxuICAgICAgdmFsdWUoKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBldmVudC5hYm9ydEtleUJpbmRpbmcgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIGV2ZW50LmFib3J0S2V5QmluZGluZygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoZXZlbnQpKSB7XHJcbiAgICAgIGlmICghKGtleSBpbiBkaXNwYXRjaGVkRXZlbnQpKSB7XHJcbiAgICAgICAgZGlzcGF0Y2hlZEV2ZW50W2tleV0gPSBldmVudFtrZXldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ3dpbGwtZGlzcGF0Y2gnLCBkaXNwYXRjaGVkRXZlbnQpO1xyXG5cclxuICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmRJbmxpbmVMaXN0ZW5lcnMgPVxyXG4gICAgICAgIHRoaXMuaW5saW5lTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtldmVudC50eXBlXVxyXG4gICAgICAgID8gdGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2V2ZW50LnR5cGVdLmdldChjdXJyZW50VGFyZ2V0KVxyXG4gICAgICAgIDogbnVsbDtcclxuICAgICAgbGV0IGxpc3RlbmVycyA9IGNvbW1hbmRJbmxpbmVMaXN0ZW5lcnMgfHwgW107XHJcbiAgICAgIGlmIChjdXJyZW50VGFyZ2V0LndlYmtpdE1hdGNoZXNTZWxlY3RvciAhPSBudWxsKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0b3JCYXNlZExpc3RlbmVycyA9XHJcbiAgICAgICAgICAodGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtldmVudC50eXBlXSB8fCBbXSlcclxuICAgICAgICAgICAgLmZpbHRlcihsaXN0ZW5lciA9PiBsaXN0ZW5lci5tYXRjaGVzVGFyZ2V0KGN1cnJlbnRUYXJnZXQpKVxyXG4gICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5jb21wYXJlKGIpKTtcclxuICAgICAgICBsaXN0ZW5lcnMgPSBzZWxlY3RvckJhc2VkTGlzdGVuZXJzLmNvbmNhdChsaXN0ZW5lcnMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDYWxsIGlubGluZSBsaXN0ZW5lcnMgZmlyc3QgaW4gcmV2ZXJzZSByZWdpc3RyYXRpb24gb3JkZXIsXHJcbiAgICAgIC8vIGFuZCBzZWxlY3Rvci1iYXNlZCBsaXN0ZW5lcnMgYnkgc3BlY2lmaWNpdHkgYW5kIHJldmVyc2VcclxuICAgICAgLy8gcmVnaXN0cmF0aW9uIG9yZGVyLlxyXG4gICAgICBmb3IgKGxldCBpID0gbGlzdGVuZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07XHJcbiAgICAgICAgaWYgKGltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1hdGNoZWQucHVzaChsaXN0ZW5lci5kaWREaXNwYXRjaC5jYWxsKGN1cnJlbnRUYXJnZXQsIGRpc3BhdGNoZWRFdmVudCkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoY3VycmVudFRhcmdldCA9PT0gd2luZG93KSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHByb3BhZ2F0aW9uU3RvcHBlZCkge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGN1cnJlbnRUYXJnZXQgPSBjdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUgfHwgd2luZG93O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZW1pdHRlci5lbWl0KCdkaWQtZGlzcGF0Y2gnLCBkaXNwYXRjaGVkRXZlbnQpO1xyXG5cclxuICAgIHJldHVybiAobWF0Y2hlZC5sZW5ndGggPiAwID8gUHJvbWlzZS5hbGwobWF0Y2hlZCkgOiBudWxsKTtcclxuICB9XHJcblxyXG4gIGNvbW1hbmRSZWdpc3RlcmVkKGNvbW1hbmROYW1lKSB7XHJcbiAgICBpZiAodGhpcy5yb290Tm9kZSAhPSBudWxsICYmICF0aGlzLnJlZ2lzdGVyZWRDb21tYW5kc1tjb21tYW5kTmFtZV0pIHtcclxuICAgICAgdGhpcy5yb290Tm9kZS5hZGRFdmVudExpc3RlbmVyKGNvbW1hbmROYW1lLCB0aGlzLmhhbmRsZUNvbW1hbmRFdmVudCwgdHJ1ZSk7XHJcbiAgICAgIHJldHVybiAodGhpcy5yZWdpc3RlcmVkQ29tbWFuZHNbY29tbWFuZE5hbWVdID0gdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyB0eXBlIExpc3RlbmVyID0ge1xyXG4vLyAgIGRlc2NyaXB0b3I6IENvbW1hbmREZXNjcmlwdG9yLFxyXG4vLyAgIGV4dHJhY3REaWREaXNwYXRjaDogKGU6IEN1c3RvbUV2ZW50KSA9PiB2b2lkLFxyXG4vLyB9O1xyXG5jbGFzcyBTZWxlY3RvckJhc2VkTGlzdGVuZXIge1xyXG4gIHByaXZhdGUgc2VsZWN0b3I6IHN0cmluZztcclxuICBwcml2YXRlIGRpZERpc3BhdGNoOiBhbnk7XHJcbiAgcHJpdmF0ZSBkZXNjcmlwdG9yOiBhbnk7XHJcbiAgcHJpdmF0ZSBzcGVjaWZpY2l0eTogbnVtYmVyO1xyXG4gIHByaXZhdGUgc2VxdWVuY2VOdW1iZXI6IG51bWJlcjtcclxuXHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3IsIGNvbW1hbmROYW1lLCBsaXN0ZW5lcikge1xyXG4gICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xyXG4gICAgdGhpcy5kaWREaXNwYXRjaCA9IGV4dHJhY3REaWREaXNwYXRjaChsaXN0ZW5lcik7XHJcbiAgICB0aGlzLmRlc2NyaXB0b3IgPSBleHRyYWN0RGVzY3JpcHRvcihjb21tYW5kTmFtZSwgbGlzdGVuZXIpO1xyXG4gICAgdGhpcy5zcGVjaWZpY2l0eSA9IGNhbGN1bGF0ZVNwZWNpZmljaXR5KHRoaXMuc2VsZWN0b3IpO1xyXG4gICAgdGhpcy5zZXF1ZW5jZU51bWJlciA9IFNlcXVlbmNlQ291bnQrKztcclxuICB9XHJcblxyXG4gIGNvbXBhcmUob3RoZXIpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIHRoaXMuc3BlY2lmaWNpdHkgLSBvdGhlci5zcGVjaWZpY2l0eSB8fFxyXG4gICAgICB0aGlzLnNlcXVlbmNlTnVtYmVyIC0gb3RoZXIuc2VxdWVuY2VOdW1iZXJcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBtYXRjaGVzVGFyZ2V0KHRhcmdldCkge1xyXG4gICAgcmV0dXJuIHRhcmdldC53ZWJraXRNYXRjaGVzU2VsZWN0b3IgJiYgdGFyZ2V0LndlYmtpdE1hdGNoZXNTZWxlY3Rvcih0aGlzLnNlbGVjdG9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIElubGluZUxpc3RlbmVyIHtcclxuICBwcml2YXRlIGRpZERpc3BhdGNoOiBhbnk7XHJcbiAgcHJpdmF0ZSBkZXNjcmlwdG9yOiBhbnk7XHJcbiAgY29uc3RydWN0b3IoY29tbWFuZE5hbWUsIGxpc3RlbmVyKSB7XHJcbiAgICB0aGlzLmRpZERpc3BhdGNoID0gZXh0cmFjdERpZERpc3BhdGNoKGxpc3RlbmVyKTtcclxuICAgIHRoaXMuZGVzY3JpcHRvciA9IGV4dHJhY3REZXNjcmlwdG9yKGNvbW1hbmROYW1lLCBsaXN0ZW5lcik7XHJcbiAgfVxyXG59XHJcblxyXG4vLyB0eXBlIENvbW1hbmREZXNjcmlwdG9yID0ge1xyXG4vLyAgIG5hbWU6IHN0cmluZyxcclxuLy8gICBkaXNwbGF5TmFtZTogc3RyaW5nLFxyXG4vLyB9O1xyXG5mdW5jdGlvbiBleHRyYWN0RGVzY3JpcHRvcihuYW1lLCBsaXN0ZW5lcikge1xyXG4gIHJldHVybiBPYmplY3QuYXNzaWduKFxyXG4gICAgb21pdChsaXN0ZW5lciwgJ2RpZERpc3BhdGNoJyksXHJcbiAgICB7XHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIGRpc3BsYXlOYW1lOiBsaXN0ZW5lci5kaXNwbGF5TmFtZSA/IGxpc3RlbmVyLmRpc3BsYXlOYW1lIDogaHVtYW5pemVFdmVudE5hbWUobmFtZSlcclxuICAgIH1cclxuICApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0RGlkRGlzcGF0Y2gobGlzdGVuZXIpIHtcclxuICByZXR1cm4gdHlwZW9mIGxpc3RlbmVyID09PSAnZnVuY3Rpb24nID8gbGlzdGVuZXIgOiBsaXN0ZW5lci5kaWREaXNwYXRjaDtcclxufVxyXG5cclxuZnVuY3Rpb24gdmFsaWRhdGVTZWxlY3RvcihzZWxlY3Rvcjogc3RyaW5nKSB7XHJcbiAgaWYgKCFpc1NlbGVjdG9yVmFsaWQoc2VsZWN0b3IpKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IG5ldyBTeW50YXhFcnJvcihzZWxlY3RvciArICcgaXMgbm90IGEgdmFsaWQgc2VsZWN0b3InKTtcclxuICAgIC8vIGVycm9yLmNvZGUgPSAnRUJBRFNFTEVDVE9SJztcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaXNTZWxlY3RvclZhbGlkKHNlbGVjdG9yOiBzdHJpbmcpIHtcclxuICBsZXQgdmFsaWQ6IGJvb2xlYW47XHJcblxyXG4gIHRyeSB7XHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuICAgIHZhbGlkID0gdHJ1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgdmFsaWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHJldHVybiB2YWxpZDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlU3BlY2lmaWNpdHkoc2VsZWN0b3I6IHN0cmluZykge1xyXG4gIGNvbnN0IHNwZWNpZmljaXR5ID0gY2FsY3VsYXRlKHNlbGVjdG9yKTtcclxuICByZXR1cm4gc3BlY2lmaWNpdHk7XHJcbn1cclxuZnVuY3Rpb24gY2FsY3VsYXRlKHNlbGVjdG9yOiBzdHJpbmcpIHtcclxuICBjb25zdCBjb21tYUluZGV4ID0gc2VsZWN0b3IuaW5kZXhPZignLCcpO1xyXG4gIGlmIChjb21tYUluZGV4ICE9PSAtMSkge1xyXG4gICAgc2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHJpbmcoMCwgY29tbWFJbmRleCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0eXBlcyA9IHtcclxuICAgIGE6IDAsXHJcbiAgICBiOiAwLFxyXG4gICAgYzogMFxyXG4gIH07XHJcblxyXG4gIC8vIFRoZSBmb2xsb3dpbmcgcmVndWxhciBleHByZXNzaW9ucyBhc3N1bWUgdGhhdCBzZWxlY3RvcnMgbWF0Y2hpbmcgdGhlIHByZWNlZGluZyByZWd1bGFyIGV4cHJlc3Npb25zIGhhdmUgYmVlbiByZW1vdmVkXHJcbiAgY29uc3QgYXR0cmlidXRlUmVnZXggPSAvKFxcW1teXFxdXStcXF0pL2c7XHJcbiAgY29uc3QgaWRSZWdleCA9IC8oI1teXFxzXFwrPn5cXC5cXFs6XSspL2c7XHJcbiAgY29uc3QgY2xhc3NSZWdleCA9IC8oXFwuW15cXHNcXCs+flxcLlxcWzpdKykvZztcclxuICBjb25zdCBwc2V1ZG9FbGVtZW50UmVnZXggPSAvKDo6W15cXHNcXCs+flxcLlxcWzpdK3w6Zmlyc3QtbGluZXw6Zmlyc3QtbGV0dGVyfDpiZWZvcmV8OmFmdGVyKS9nO1xyXG4gIGNvbnN0IHBzZXVkb0NsYXNzUmVnZXggPSAvKDpbXlxcc1xcKz5+XFwuXFxbOl0rKS9nO1xyXG4gIGNvbnN0IGVsZW1lbnRSZWdleCA9IC8oW15cXHNcXCs+flxcLlxcWzpdKykvZztcclxuICBjb25zdCBub3RSZWdleCA9IC86bm90XFwoKFteXFwpXSopXFwpL2c7XHJcbiAgY29uc3QgcnVsZVJlZ2V4ID0gL1xce1teXSovZ207XHJcbiAgY29uc3Qgc2VwYXJhdG9yUmVnZXggPSAvW1xcKlxcc1xcKz5+XS9nO1xyXG4gIGNvbnN0IHN0cmF5c1JlZ2V4ID0gL1sjXFwuXS9nO1xyXG5cclxuICAvLyBSZW1vdmUgdGhlIG5lZ2F0aW9uIHBzdWVkby1jbGFzcyAoOm5vdCkgYnV0IGxlYXZlIGl0cyBhcmd1bWVudCBiZWNhdXNlIHNwZWNpZmljaXR5IGlzIGNhbGN1bGF0ZWQgb24gaXRzIGFyZ3VtZW50XHJcbiAgc2VsZWN0b3IgPSBzZWxlY3Rvci5yZXBsYWNlKG5vdFJlZ2V4LCAnICQxICcpO1xyXG5cclxuICAvLyBSZW1vdmUgYW55dGhpbmcgYWZ0ZXIgYSBsZWZ0IGJyYWNlIGluIGNhc2UgYSB1c2VyIGhhcyBwYXN0ZWQgaW4gYSBydWxlLCBub3QganVzdCBhIHNlbGVjdG9yXHJcbiAgc2VsZWN0b3IgPSBzZWxlY3Rvci5yZXBsYWNlKHJ1bGVSZWdleCwgJyAnKTtcclxuXHJcbiAgLy8gQWRkIGF0dHJpYnV0ZSBzZWxlY3RvcnMgdG8gcGFydHMgY29sbGVjdGlvbiAodHlwZSBiKVxyXG4gIHNlbGVjdG9yID0gZmluZE1hdGNoKGF0dHJpYnV0ZVJlZ2V4LCAnYicsIHR5cGVzLCBzZWxlY3Rvcik7XHJcblxyXG4gIC8vIEFkZCBJRCBzZWxlY3RvcnMgdG8gcGFydHMgY29sbGVjdGlvbiAodHlwZSBhKVxyXG4gIHNlbGVjdG9yID0gZmluZE1hdGNoKGlkUmVnZXgsICdhJywgdHlwZXMsIHNlbGVjdG9yKTtcclxuXHJcbiAgLy8gQWRkIGNsYXNzIHNlbGVjdG9ycyB0byBwYXJ0cyBjb2xsZWN0aW9uICh0eXBlIGIpXHJcbiAgc2VsZWN0b3IgPSBmaW5kTWF0Y2goY2xhc3NSZWdleCwgJ2InLCB0eXBlcywgc2VsZWN0b3IpO1xyXG5cclxuICAvLyBBZGQgcHNldWRvLWVsZW1lbnQgc2VsZWN0b3JzIHRvIHBhcnRzIGNvbGxlY3Rpb24gKHR5cGUgYylcclxuICBzZWxlY3RvciA9IGZpbmRNYXRjaChwc2V1ZG9FbGVtZW50UmVnZXgsICdjJywgdHlwZXMsIHNlbGVjdG9yKTtcclxuXHJcbiAgLy8gQWRkIHBzZXVkby1jbGFzcyBzZWxlY3RvcnMgdG8gcGFydHMgY29sbGVjdGlvbiAodHlwZSBiKVxyXG4gIHNlbGVjdG9yID0gZmluZE1hdGNoKHBzZXVkb0NsYXNzUmVnZXgsICdiJywgdHlwZXMsIHNlbGVjdG9yKTtcclxuXHJcbiAgLy8gUmVtb3ZlIHVuaXZlcnNhbCBzZWxlY3RvciBhbmQgc2VwYXJhdG9yIGNoYXJhY3RlcnNcclxuICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2Uoc2VwYXJhdG9yUmVnZXgsICcgJyk7XHJcblxyXG4gIC8vIFJlbW92ZSBhbnkgc3RyYXkgZG90cyBvciBoYXNoZXMgd2hpY2ggYXJlbid0IGF0dGFjaGVkIHRvIHdvcmRzXHJcbiAgLy8gVGhlc2UgbWF5IGJlIHByZXNlbnQgaWYgdGhlIHVzZXIgaXMgbGl2ZS1lZGl0aW5nIHRoaXMgc2VsZWN0b3JcclxuICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2Uoc3RyYXlzUmVnZXgsICcgJyk7XHJcblxyXG4gIC8vIFRoZSBvbmx5IHRoaW5ncyBsZWZ0IHNob3VsZCBiZSBlbGVtZW50IHNlbGVjdG9ycyAodHlwZSBjKVxyXG4gIGZpbmRNYXRjaChlbGVtZW50UmVnZXgsICdjJywgdHlwZXMsIHNlbGVjdG9yKTtcclxuXHJcbiAgcmV0dXJuICh0eXBlcy5hICogMTAwKSArICh0eXBlcy5iICogMTApICsgKHR5cGVzLmMgKiAxKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZmluZE1hdGNoKHJlZ2V4LCB0eXBlLCB0eXBlcywgc2VsZWN0b3IpIHtcclxuICBjb25zdCBtYXRjaGVzID0gc2VsZWN0b3IubWF0Y2gocmVnZXgpO1xyXG4gIGlmIChtYXRjaGVzKSB7XHJcbiAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIG1hdGNoZXMpIHtcclxuICAgICAgdHlwZXNbdHlwZV0rKztcclxuICAgICAgLy8gUmVwbGFjZSB0aGlzIHNpbXBsZSBzZWxlY3RvciB3aXRoIHdoaXRlc3BhY2Ugc28gaXQgd29uJ3QgYmUgY291bnRlZCBpbiBmdXJ0aGVyIHNpbXBsZSBzZWxlY3RvcnNcclxuICAgICAgc2VsZWN0b3IgPSBzZWxlY3Rvci5yZXBsYWNlKG1hdGNoLCAnICcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHNlbGVjdG9yO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvbWl0KG9iajogYW55LCAuLi5wcm9wczogc3RyaW5nW10pIHtcclxuICAvLyBjb25zdCBpdGVyYXRlZSA9ICh2YWx1ZSwga2V5KSA9PiAhcHJvcHMuZmluZChrZXkpO1xyXG5cclxuICBjb25zdCByZXN1bHQgPSB7fTtcclxuICBpZiAoIW9iaikge1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbiAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICBpZiAoIXByb3BzLmZpbmQocHJvcCA9PiBwcm9wID09PSBrZXkpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHJlc3VsdFtrZXldID0gb2JqW2tleV07XHJcbiAgfSk7XHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZnVuY3Rpb24gaHVtYW5pemVFdmVudE5hbWUoZXZlbnROYW1lLCBldmVudERvYyA9IG51bGwpIHtcclxuICBjb25zdCByZWYgPSBldmVudE5hbWUuc3BsaXQoJzonKTtcclxuICBjb25zdCBbbmFtZXNwYWNlLCBldmVudF0gPSByZWY7XHJcbiAgaWYgKGV2ZW50ID09IG51bGwpIHtcclxuICAgIHJldHVybiB1bmRhc2gobmFtZXNwYWNlKTtcclxuICB9XHJcbiAgY29uc3QgbmFtZXNwYWNlRG9jID0gdW5kYXNoKG5hbWVzcGFjZSk7XHJcbiAgaWYgKGV2ZW50RG9jID09IG51bGwpIHtcclxuICAgIGV2ZW50RG9jID0gdW5kYXNoKGV2ZW50KTtcclxuICB9XHJcbiAgcmV0dXJuICcnICsgbmFtZXNwYWNlRG9jICsgJzogJyArIGV2ZW50RG9jO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1bmRhc2goc3RyKSB7XHJcbiAgaWYgKHN0cikge1xyXG4gICAgcmV0dXJuIHN0ci5zcGxpdCgnLScpLmpvaW4oJyAnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxufVxyXG4iXX0=
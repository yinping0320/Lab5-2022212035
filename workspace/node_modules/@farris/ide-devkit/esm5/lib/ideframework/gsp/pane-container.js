/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Pane } from './pane';
import { ItemRegistry } from './item-registry';
/** @type {?} */
var SERIALIZATION_VERSION = 1;
var PaneContainer = /** @class */ (function () {
    function PaneContainer(params) {
        /** @type {?} */
        var applicationDelegate;
        /** @type {?} */
        var deserializerManager;
        /** @type {?} */
        var notificationManager;
        (this.config = params.config, applicationDelegate = params.applicationDelegate, notificationManager = params.notificationManager, deserializerManager = params.deserializerManager, this.viewRegistry = params.viewRegistry, this.location = params.location);
        this.itemRegistry = new ItemRegistry();
        this.alive = true;
        this.setRoot(new Pane({
            container: this,
            config: this.config,
            applicationDelegate: applicationDelegate,
            notificationManager: notificationManager,
            deserializerManager: deserializerManager,
            viewRegistry: this.viewRegistry
        }));
        this.didActivatePane(this.getRoot());
    }
    /**
     * @return {?}
     */
    PaneContainer.prototype.getLocation = /**
     * @return {?}
     */
    function () { return this.location; };
    /**
     * @return {?}
     */
    PaneContainer.prototype.getElement = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.destroy = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        this.alive = false;
        try {
            for (var _b = tslib_1.__values(this.getRoot().getPanes()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var pane = _c.value;
                pane.destroy();
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.isAlive = /**
     * @return {?}
     */
    function () { return this.alive; };
    /**
     * @return {?}
     */
    PaneContainer.prototype.isDestroyed = /**
     * @return {?}
     */
    function () { return !this.isAlive(); };
    /**
     * @param {...?} params
     * @return {?}
     */
    PaneContainer.prototype.serialize = /**
     * @param {...?} params
     * @return {?}
     */
    function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        return {
            deserializer: 'PaneContainer',
            version: SERIALIZATION_VERSION,
            root: this.root ? this.root.serialize() : null,
            activePaneId: this.activePane.id
        };
    };
    /**
     * @param {?} state
     * @param {?} deserializerManager
     * @return {?}
     */
    PaneContainer.prototype.deserialize = /**
     * @param {?} state
     * @param {?} deserializerManager
     * @return {?}
     */
    function (state, deserializerManager) {
        if (state.version !== SERIALIZATION_VERSION) {
            return;
        }
        this.setRoot(deserializerManager.deserialize(state.root));
        this.activePane = this.getRoot().getPanes().find(function (pane) { return pane.id === state.activePaneId; }) || this.getPanes()[0];
        if (this.config && this.config.get && this.config.get('core.destroyEmptyPanes')) {
            this.destroyEmptyPanes();
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidChangeRoot = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.observeRoot = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        fn(this.getRoot());
        return this.onDidChangeRoot(fn);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidAddPane = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.observePanes = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        var e_2, _a;
        try {
            for (var _b = tslib_1.__values(this.getPanes()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var pane = _c.value;
                fn(pane);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return this.onDidAddPane(function (_a) {
            var pane = _a.pane;
            return fn(pane);
        });
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidDestroyPane = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onWillDestroyPane = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidChangeActivePane = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidActivatePane = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.observeActivePane = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        fn(this.getActivePane());
        return this.onDidChangeActivePane(fn);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidAddPaneItem = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.observePaneItems = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        var e_3, _a;
        try {
            for (var _b = tslib_1.__values(this.getPaneItems()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var item = _c.value;
                fn(item);
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return this.onDidAddPaneItem(function (_a) {
            var item = _a.item;
            return fn(item);
        });
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidChangeActivePaneItem = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidStopChangingActivePaneItem = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.observeActivePaneItem = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        fn(this.getActivePaneItem());
        return this.onDidChangeActivePaneItem(fn);
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onWillDestroyPaneItem = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PaneContainer.prototype.onDidDestroyPaneItem = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.getRoot = /**
     * @return {?}
     */
    function () { return this.root; };
    /**
     * @param {?} root
     * @return {?}
     */
    PaneContainer.prototype.setRoot = /**
     * @param {?} root
     * @return {?}
     */
    function (root) {
        this.root = root;
        this.root.setParent(this);
        this.root.setContainer(this);
        if ((this.getActivePane() == null) && this.root instanceof Pane) {
            this.didActivatePane(this.root);
        }
    };
    /**
     * @param {?} oldChild
     * @param {?} newChild
     * @return {?}
     */
    PaneContainer.prototype.replaceChild = /**
     * @param {?} oldChild
     * @param {?} newChild
     * @return {?}
     */
    function (oldChild, newChild) {
        if (oldChild !== this.root) {
            throw new Error('Replacing non-existent child');
        }
        this.setRoot(newChild);
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.getPanes = /**
     * @return {?}
     */
    function () {
        if (this.alive) {
            return this.getRoot().getPanes();
        }
        else {
            return [];
        }
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.getPaneItems = /**
     * @return {?}
     */
    function () {
        return this.getRoot().getItems();
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.getActivePane = /**
     * @return {?}
     */
    function () {
        return this.activePane;
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.getActivePaneItem = /**
     * @return {?}
     */
    function () {
        return this.getActivePane().getActiveItem();
    };
    /**
     * @param {?} uri
     * @return {?}
     */
    PaneContainer.prototype.paneForURI = /**
     * @param {?} uri
     * @return {?}
     */
    function (uri) {
        return this.getPanes().find(function (pane) { return pane.itemForURI(uri) != null; });
    };
    /**
     * @param {?} item
     * @return {?}
     */
    PaneContainer.prototype.paneForItem = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        return this.getPanes().find(function (pane) { return pane.getItems().find(function (it) { return it === item; }); });
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.saveAll = /**
     * @return {?}
     */
    function () {
        var e_4, _a;
        try {
            for (var _b = tslib_1.__values(this.getPanes()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var pane = _c.value;
                pane.saveItems();
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_4) throw e_4.error; }
        }
    };
    /**
     * @param {?} options
     * @return {?}
     */
    PaneContainer.prototype.confirmClose = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var e_5, _a, e_6, _b;
        /** @type {?} */
        var promises = [];
        try {
            for (var _c = tslib_1.__values(this.getPanes()), _d = _c.next(); !_d.done; _d = _c.next()) {
                var pane = _d.value;
                try {
                    for (var _e = tslib_1.__values(pane.getItems()), _f = _e.next(); !_f.done; _f = _e.next()) {
                        var item = _f.value;
                        promises.push(pane.promptToSaveItem(item, options));
                    }
                }
                catch (e_6_1) { e_6 = { error: e_6_1 }; }
                finally {
                    try {
                        if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                    }
                    finally { if (e_6) throw e_6.error; }
                }
            }
        }
        catch (e_5_1) { e_5 = { error: e_5_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_5) throw e_5.error; }
        }
        return Promise.all(promises).then(function (results) { return !results.find(function (item) { return item === false; }); });
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.activateNextPane = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var panes = this.getPanes();
        if (panes.length > 1) {
            /** @type {?} */
            var currentIndex = panes.indexOf(this.activePane);
            /** @type {?} */
            var nextIndex = (currentIndex + 1) % panes.length;
            panes[nextIndex].activate();
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.activatePreviousPane = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var panes = this.getPanes();
        if (panes.length > 1) {
            /** @type {?} */
            var currentIndex = panes.indexOf(this.activePane);
            /** @type {?} */
            var previousIndex = currentIndex - 1;
            if (previousIndex < 0) {
                previousIndex = panes.length - 1;
            }
            panes[previousIndex].activate();
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} destPane
     * @return {?}
     */
    PaneContainer.prototype.moveActiveItemToPane = /**
     * @param {?} destPane
     * @return {?}
     */
    function (destPane) {
        /** @type {?} */
        var item = this.activePane.getActiveItem();
        if (!destPane.isItemAllowed(item)) {
            return;
        }
        this.activePane.moveItemToPane(item, destPane);
        destPane.setActiveItem(item);
    };
    /**
     * @param {?} destPane
     * @return {?}
     */
    PaneContainer.prototype.copyActiveItemToPane = /**
     * @param {?} destPane
     * @return {?}
     */
    function (destPane) {
        /** @type {?} */
        var item = this.activePane.copyActiveItem();
        if (item && destPane.isItemAllowed(item)) {
            destPane.activateItem(item);
        }
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.destroyEmptyPanes = /**
     * @return {?}
     */
    function () {
        var e_7, _a;
        try {
            for (var _b = tslib_1.__values(this.getPanes()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var pane = _c.value;
                if (pane.items.length === 0) {
                    pane.destroy();
                }
            }
        }
        catch (e_7_1) { e_7 = { error: e_7_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_7) throw e_7.error; }
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PaneContainer.prototype.didAddPane = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var items = event.pane.getItems();
        for (var i = 0, length_1 = items.length; i < length_1; i++) {
            /** @type {?} */
            var item = items[i];
            this.didAddPaneItem(item, event.pane, i);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PaneContainer.prototype.willDestroyPane = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PaneContainer.prototype.didDestroyPane = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
    };
    /**
     * @param {?} activePane
     * @return {?}
     */
    PaneContainer.prototype.didActivatePane = /**
     * @param {?} activePane
     * @return {?}
     */
    function (activePane) {
        if (activePane !== this.activePane) {
            if (!this.getPanes().find(function (item) { return item === activePane; })) {
                throw new Error('Setting active pane that is not present in pane container');
            }
            this.activePane = activePane;
            this.didChangeActiveItemOnPane(this.activePane, this.activePane.getActiveItem());
        }
        return this.activePane;
    };
    /**
     * @param {?} item
     * @param {?} pane
     * @param {?} index
     * @return {?}
     */
    PaneContainer.prototype.didAddPaneItem = /**
     * @param {?} item
     * @param {?} pane
     * @param {?} index
     * @return {?}
     */
    function (item, pane, index) {
        this.itemRegistry.addItem(item);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PaneContainer.prototype.willDestroyPaneItem = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PaneContainer.prototype.didDestroyPaneItem = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.itemRegistry.removeItem(event.item);
        // this.emitter.emit('did-destroy-pane-item', event);
    };
    /**
     * @param {?} pane
     * @param {?} activeItem
     * @return {?}
     */
    PaneContainer.prototype.didChangeActiveItemOnPane = /**
     * @param {?} pane
     * @param {?} activeItem
     * @return {?}
     */
    function (pane, activeItem) {
        if (pane === this.getActivePane()) {
            this.cancelStoppedChangingActivePaneItemTimeout();
            // `setTimeout()` isn't available during the snapshotting phase, but that's okay.
        }
    };
    /**
     * @return {?}
     */
    PaneContainer.prototype.cancelStoppedChangingActivePaneItemTimeout = /**
     * @return {?}
     */
    function () {
    };
    return PaneContainer;
}());
export { PaneContainer };
if (false) {
    /** @type {?} */
    PaneContainer.prototype.itemRegistry;
    /** @type {?} */
    PaneContainer.prototype.alive;
    /** @type {?} */
    PaneContainer.prototype.viewRegistry;
    /** @type {?} */
    PaneContainer.prototype.location;
    /** @type {?} */
    PaneContainer.prototype.activePane;
    /** @type {?} */
    PaneContainer.prototype.root;
    /** @type {?} */
    PaneContainer.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZS1jb250YWluZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2lkZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvaWRlZnJhbWV3b3JrL2dzcC9wYW5lLWNvbnRhaW5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDOUIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDOztJQUV6QyxxQkFBcUIsR0FBRyxDQUFDO0FBRS9CO0lBU0UsdUJBQVksTUFBTTs7WUFDWixtQkFBbUI7O1lBQUUsbUJBQW1COztZQUFFLG1CQUFtQjtRQUNqRSxDQUNFLDJCQUFtQixFQUNuQixnREFBbUIsRUFDbkIsZ0RBQW1CLEVBQ25CLGdEQUFtQixFQUNuQix1Q0FBK0IsRUFDL0IsK0JBQXVCLENBQ2QsQ0FBQztRQUVaLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN2QyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUdsQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDO1lBQ3BCLFNBQVMsRUFBRSxJQUFJO1lBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ25CLG1CQUFtQixxQkFBQTtZQUNuQixtQkFBbUIscUJBQUE7WUFDbkIsbUJBQW1CLHFCQUFBO1lBQ25CLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWTtTQUNoQyxDQUFDLENBQUMsQ0FBQztRQUNKLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDdkMsQ0FBQzs7OztJQUVELG1DQUFXOzs7SUFBWCxjQUFnQixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDOzs7O0lBRXZDLGtDQUFVOzs7SUFBVjtJQUNBLENBQUM7Ozs7SUFFRCwrQkFBTzs7O0lBQVA7O1FBQ0UsSUFBSSxDQUFD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SUFBSSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBRWpDLElBQUksQ0FBQywwQ0FBMEMsRUFBRSxDQUFDO1lBQ2xELGlGQUFpRjtTQUVsRjtJQUNILENBQUM7Ozs7SUFFRCxrRUFBMEM7OztJQUExQztJQUVBLENBQUM7SUFDSCxvQkFBQztBQUFELENBQUMsQUF4UkQsSUF3UkM7Ozs7SUF2UkMscUNBQWtCOztJQUNsQiw4QkFBZTs7SUFDZixxQ0FBa0I7O0lBQ2xCLGlDQUFjOztJQUNkLG1DQUFnQjs7SUFDaEIsNkJBQVU7O0lBQ1YsK0JBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYW5lIH0gZnJvbSAnLi9wYW5lJztcclxuaW1wb3J0IHsgSXRlbVJlZ2lzdHJ5IH0gZnJvbSAnLi9pdGVtLXJlZ2lzdHJ5JztcclxuXHJcbmNvbnN0IFNFUklBTElaQVRJT05fVkVSU0lPTiA9IDE7XHJcblxyXG5leHBvcnQgY2xhc3MgUGFuZUNvbnRhaW5lciB7XHJcbiAgaXRlbVJlZ2lzdHJ5OiBhbnk7XHJcbiAgYWxpdmU6IGJvb2xlYW47XHJcbiAgdmlld1JlZ2lzdHJ5OiBhbnk7XHJcbiAgbG9jYXRpb246IGFueTtcclxuICBhY3RpdmVQYW5lOiBhbnk7XHJcbiAgcm9vdDogYW55O1xyXG4gIGNvbmZpZzogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihwYXJhbXMpIHtcclxuICAgIGxldCBhcHBsaWNhdGlvbkRlbGVnYXRlLCBkZXNlcmlhbGl6ZXJNYW5hZ2VyLCBub3RpZmljYXRpb25NYW5hZ2VyO1xyXG4gICAgKHtcclxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZyxcclxuICAgICAgYXBwbGljYXRpb25EZWxlZ2F0ZSxcclxuICAgICAgbm90aWZpY2F0aW9uTWFuYWdlcixcclxuICAgICAgZGVzZXJpYWxpemVyTWFuYWdlcixcclxuICAgICAgdmlld1JlZ2lzdHJ5OiB0aGlzLnZpZXdSZWdpc3RyeSxcclxuICAgICAgbG9jYXRpb246IHRoaXMubG9jYXRpb25cclxuICAgIH0gPSBwYXJhbXMpO1xyXG5cclxuICAgIHRoaXMuaXRlbVJlZ2lzdHJ5ID0gbmV3IEl0ZW1SZWdpc3RyeSgpO1xyXG4gICAgdGhpcy5hbGl2ZSA9IHRydWU7XHJcblxyXG5cclxuICAgIHRoaXMuc2V0Um9vdChuZXcgUGFuZSh7XHJcbiAgICAgIGNvbnRhaW5lcjogdGhpcyxcclxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZyxcclxuICAgICAgYXBwbGljYXRpb25EZWxlZ2F0ZSxcclxuICAgICAgbm90aWZpY2F0aW9uTWFuYWdlcixcclxuICAgICAgZGVzZXJpYWxpemVyTWFuYWdlcixcclxuICAgICAgdmlld1JlZ2lzdHJ5OiB0aGlzLnZpZXdSZWdpc3RyeVxyXG4gICAgfSkpO1xyXG4gICAgdGhpcy5kaWRBY3RpdmF0ZVBhbmUodGhpcy5nZXRSb290KCkpO1xyXG4gIH1cclxuXHJcbiAgZ2V0TG9jYXRpb24oKSB7IHJldHVybiB0aGlzLmxvY2F0aW9uOyB9XHJcblxyXG4gIGdldEVsZW1lbnQoKSB7XHJcbiAgfVxyXG5cclxuICBkZXN0cm95KCkge1xyXG4gICAgdGhpcy5hbGl2ZSA9IGZhbHNlO1xyXG4gICAgZm9yIChjb25zdCBwYW5lIG9mIHRoaXMuZ2V0Um9vdCgpLmdldFBhbmVzKCkpIHsgcGFuZS5kZXN0cm95KCk7IH1cclxuXHJcbiAgfVxyXG5cclxuICBpc0FsaXZlKCkgeyByZXR1cm4gdGhpcy5hbGl2ZTsgfVxyXG5cclxuICBpc0Rlc3Ryb3llZCgpIHsgcmV0dXJuICF0aGlzLmlzQWxpdmUoKTsgfVxyXG5cclxuICBzZXJpYWxpemUoLi4ucGFyYW1zKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBkZXNlcmlhbGl6ZXI6ICdQYW5lQ29udGFpbmVyJyxcclxuICAgICAgdmVyc2lvbjogU0VSSUFMSVpBVElPTl9WRVJTSU9OLFxyXG4gICAgICByb290OiB0aGlzLnJvb3QgPyB0aGlzLnJvb3Quc2VyaWFsaXplKCkgOiBudWxsLFxyXG4gICAgICBhY3RpdmVQYW5lSWQ6IHRoaXMuYWN0aXZlUGFuZS5pZFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGRlc2VyaWFsaXplKHN0YXRlLCBkZXNlcmlhbGl6ZXJNYW5hZ2VyKSB7XHJcbiAgICBpZiAoc3RhdGUudmVyc2lvbiAhPT0gU0VSSUFMSVpBVElPTl9WRVJTSU9OKSB7IHJldHVybjsgfVxyXG4gICAgdGhpcy5zZXRSb290KGRlc2VyaWFsaXplck1hbmFnZXIuZGVzZXJpYWxpemUoc3RhdGUucm9vdCkpO1xyXG4gICAgdGhpcy5hY3RpdmVQYW5lID0gdGhpcy5nZXRSb290KCkuZ2V0UGFuZXMoKS5maW5kKHBhbmUgPT4gcGFuZS5pZCA9PT0gc3RhdGUuYWN0aXZlUGFuZUlkKSB8fCB0aGlzLmdldFBhbmVzKClbMF07XHJcbiAgICBpZiAodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuZ2V0ICYmIHRoaXMuY29uZmlnLmdldCgnY29yZS5kZXN0cm95RW1wdHlQYW5lcycpKSB7XHJcbiAgICAgIHRoaXMuZGVzdHJveUVtcHR5UGFuZXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uRGlkQ2hhbmdlUm9vdChmbikge1xyXG4gIH1cclxuXHJcbiAgb2JzZXJ2ZVJvb3QoZm4pIHtcclxuICAgIGZuKHRoaXMuZ2V0Um9vdCgpKTtcclxuICAgIHJldHVybiB0aGlzLm9uRGlkQ2hhbmdlUm9vdChmbik7XHJcbiAgfVxyXG5cclxuICBvbkRpZEFkZFBhbmUoZm4pIHtcclxuICB9XHJcblxyXG4gIG9ic2VydmVQYW5lcyhmbikge1xyXG4gICAgZm9yIChjb25zdCBwYW5lIG9mIHRoaXMuZ2V0UGFuZXMoKSkgeyBmbihwYW5lKTsgfVxyXG4gICAgcmV0dXJuIHRoaXMub25EaWRBZGRQYW5lKCh7IHBhbmUgfSkgPT4gZm4ocGFuZSkpO1xyXG4gIH1cclxuXHJcbiAgb25EaWREZXN0cm95UGFuZShmbikge1xyXG4gIH1cclxuXHJcbiAgb25XaWxsRGVzdHJveVBhbmUoZm4pIHtcclxuICB9XHJcblxyXG4gIG9uRGlkQ2hhbmdlQWN0aXZlUGFuZShmbikge1xyXG4gIH1cclxuXHJcbiAgb25EaWRBY3RpdmF0ZVBhbmUoZm4pIHtcclxuICB9XHJcblxyXG4gIG9ic2VydmVBY3RpdmVQYW5lKGZuKSB7XHJcbiAgICBmbih0aGlzLmdldEFjdGl2ZVBhbmUoKSk7XHJcbiAgICByZXR1cm4gdGhpcy5vbkRpZENoYW5nZUFjdGl2ZVBhbmUoZm4pO1xyXG4gIH1cclxuXHJcbiAgb25EaWRBZGRQYW5lSXRlbShmbikge1xyXG4gIH1cclxuXHJcbiAgb2JzZXJ2ZVBhbmVJdGVtcyhmbikge1xyXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuZ2V0UGFuZUl0ZW1zKCkpIHsgZm4oaXRlbSk7IH1cclxuICAgIHJldHVybiB0aGlzLm9uRGlkQWRkUGFuZUl0ZW0oKHsgaXRlbSB9KSA9PiBmbihpdGVtKSk7XHJcbiAgfVxyXG5cclxuICBvbkRpZENoYW5nZUFjdGl2ZVBhbmVJdGVtKGZuKSB7XHJcbiAgfVxyXG5cclxuICBvbkRpZFN0b3BDaGFuZ2luZ0FjdGl2ZVBhbmVJdGVtKGZuKSB7XHJcbiAgfVxyXG5cclxuICBvYnNlcnZlQWN0aXZlUGFuZUl0ZW0oZm4pIHtcclxuICAgIGZuKHRoaXMuZ2V0QWN0aXZlUGFuZUl0ZW0oKSk7XHJcbiAgICByZXR1cm4gdGhpcy5vbkRpZENoYW5nZUFjdGl2ZVBhbmVJdGVtKGZuKTtcclxuICB9XHJcblxyXG4gIG9uV2lsbERlc3Ryb3lQYW5lSXRlbShmbikge1xyXG4gIH1cclxuXHJcbiAgb25EaWREZXN0cm95UGFuZUl0ZW0oZm4pIHtcclxuICB9XHJcblxyXG4gIGdldFJvb3QoKSB7IHJldHVybiB0aGlzLnJvb3Q7IH1cclxuXHJcbiAgc2V0Um9vdChyb290KSB7XHJcbiAgICB0aGlzLnJvb3QgPSByb290O1xyXG4gICAgdGhpcy5yb290LnNldFBhcmVudCh0aGlzKTtcclxuICAgIHRoaXMucm9vdC5zZXRDb250YWluZXIodGhpcyk7XHJcbiAgICBpZiAoKHRoaXMuZ2V0QWN0aXZlUGFuZSgpID09IG51bGwpICYmIHRoaXMucm9vdCBpbnN0YW5jZW9mIFBhbmUpIHtcclxuICAgICAgdGhpcy5kaWRBY3RpdmF0ZVBhbmUodGhpcy5yb290KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlcGxhY2VDaGlsZChvbGRDaGlsZCwgbmV3Q2hpbGQpIHtcclxuICAgIGlmIChvbGRDaGlsZCAhPT0gdGhpcy5yb290KSB7IHRocm93IG5ldyBFcnJvcignUmVwbGFjaW5nIG5vbi1leGlzdGVudCBjaGlsZCcpOyB9XHJcbiAgICB0aGlzLnNldFJvb3QobmV3Q2hpbGQpO1xyXG4gIH1cclxuXHJcbiAgZ2V0UGFuZXMoKTogUGFuZVtdIHtcclxuICAgIGlmICh0aGlzLmFsaXZlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdldFJvb3QoKS5nZXRQYW5lcygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0UGFuZUl0ZW1zKCk6IGFueVtdIHtcclxuICAgIHJldHVybiB0aGlzLmdldFJvb3QoKS5nZXRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgZ2V0QWN0aXZlUGFuZSgpOiBQYW5lIHtcclxuICAgIHJldHVybiB0aGlzLmFjdGl2ZVBhbmU7XHJcbiAgfVxyXG5cclxuICBnZXRBY3RpdmVQYW5lSXRlbSgpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QWN0aXZlUGFuZSgpLmdldEFjdGl2ZUl0ZW0oKTtcclxuICB9XHJcblxyXG4gIHBhbmVGb3JVUkkodXJpKTogUGFuZSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRQYW5lcygpLmZpbmQocGFuZSA9PiBwYW5lLml0ZW1Gb3JVUkkodXJpKSAhPSBudWxsKTtcclxuICB9XHJcblxyXG4gIHBhbmVGb3JJdGVtKGl0ZW0pOiBQYW5lIHtcclxuICAgIHJldHVybiB0aGlzLmdldFBhbmVzKCkuZmluZChwYW5lID0+IHBhbmUuZ2V0SXRlbXMoKS5maW5kKGl0ID0+IGl0ID09PSBpdGVtKSk7XHJcbiAgfVxyXG5cclxuICBzYXZlQWxsKCkge1xyXG4gICAgZm9yIChjb25zdCBwYW5lIG9mIHRoaXMuZ2V0UGFuZXMoKSkgeyBwYW5lLnNhdmVJdGVtcygpOyB9XHJcbiAgfVxyXG5cclxuICBjb25maXJtQ2xvc2Uob3B0aW9ucykge1xyXG4gICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcclxuICAgIGZvciAoY29uc3QgcGFuZSBvZiB0aGlzLmdldFBhbmVzKCkpIHtcclxuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHBhbmUuZ2V0SXRlbXMoKSkge1xyXG4gICAgICAgIHByb21pc2VzLnB1c2gocGFuZS5wcm9tcHRUb1NhdmVJdGVtKGl0ZW0sIG9wdGlvbnMpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKChyZXN1bHRzOiBib29sZWFuW10pID0+ICFyZXN1bHRzLmZpbmQoaXRlbSA9PiBpdGVtID09PSBmYWxzZSkpO1xyXG4gIH1cclxuXHJcbiAgYWN0aXZhdGVOZXh0UGFuZSgpIHtcclxuICAgIGNvbnN0IHBhbmVzID0gdGhpcy5nZXRQYW5lcygpO1xyXG4gICAgaWYgKHBhbmVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gcGFuZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVBhbmUpO1xyXG4gICAgICBjb25zdCBuZXh0SW5kZXggPSAoY3VycmVudEluZGV4ICsgMSkgJSBwYW5lcy5sZW5ndGg7XHJcbiAgICAgIHBhbmVzW25leHRJbmRleF0uYWN0aXZhdGUoKTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhY3RpdmF0ZVByZXZpb3VzUGFuZSgpIHtcclxuICAgIGNvbnN0IHBhbmVzID0gdGhpcy5nZXRQYW5lcygpO1xyXG4gICAgaWYgKHBhbmVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gcGFuZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVBhbmUpO1xyXG4gICAgICBsZXQgcHJldmlvdXNJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7XHJcbiAgICAgIGlmIChwcmV2aW91c0luZGV4IDwgMCkgeyBwcmV2aW91c0luZGV4ID0gcGFuZXMubGVuZ3RoIC0gMTsgfVxyXG4gICAgICBwYW5lc1twcmV2aW91c0luZGV4XS5hY3RpdmF0ZSgpO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1vdmVBY3RpdmVJdGVtVG9QYW5lKGRlc3RQYW5lKSB7XHJcbiAgICBjb25zdCBpdGVtID0gdGhpcy5hY3RpdmVQYW5lLmdldEFjdGl2ZUl0ZW0oKTtcclxuXHJcbiAgICBpZiAoIWRlc3RQYW5lLmlzSXRlbUFsbG93ZWQoaXRlbSkpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgdGhpcy5hY3RpdmVQYW5lLm1vdmVJdGVtVG9QYW5lKGl0ZW0sIGRlc3RQYW5lKTtcclxuICAgIGRlc3RQYW5lLnNldEFjdGl2ZUl0ZW0oaXRlbSk7XHJcbiAgfVxyXG5cclxuICBjb3B5QWN0aXZlSXRlbVRvUGFuZShkZXN0UGFuZSkge1xyXG4gICAgY29uc3QgaXRlbSA9IHRoaXMuYWN0aXZlUGFuZS5jb3B5QWN0aXZlSXRlbSgpO1xyXG5cclxuICAgIGlmIChpdGVtICYmIGRlc3RQYW5lLmlzSXRlbUFsbG93ZWQoaXRlbSkpIHtcclxuICAgICAgZGVzdFBhbmUuYWN0aXZhdGVJdGVtKGl0ZW0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVzdHJveUVtcHR5UGFuZXMoKSB7XHJcbiAgICBmb3IgKGNvbnN0IHBhbmUgb2YgdGhpcy5nZXRQYW5lcygpKSB7IGlmIChwYW5lLml0ZW1zLmxlbmd0aCA9PT0gMCkgeyBwYW5lLmRlc3Ryb3koKTsgfSB9XHJcbiAgfVxyXG5cclxuICBkaWRBZGRQYW5lKGV2ZW50KSB7XHJcbiAgICBjb25zdCBpdGVtcyA9IGV2ZW50LnBhbmUuZ2V0SXRlbXMoKTtcclxuICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBpdGVtID0gaXRlbXNbaV07XHJcbiAgICAgIHRoaXMuZGlkQWRkUGFuZUl0ZW0oaXRlbSwgZXZlbnQucGFuZSwgaSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB3aWxsRGVzdHJveVBhbmUoZXZlbnQpIHtcclxuICB9XHJcblxyXG4gIGRpZERlc3Ryb3lQYW5lKGV2ZW50KSB7XHJcbiAgfVxyXG5cclxuICBkaWRBY3RpdmF0ZVBhbmUoYWN0aXZlUGFuZSkge1xyXG4gICAgaWYgKGFjdGl2ZVBhbmUgIT09IHRoaXMuYWN0aXZlUGFuZSkge1xyXG4gICAgICBpZiAoIXRoaXMuZ2V0UGFuZXMoKS5maW5kKGl0ZW0gPT4gaXRlbSA9PT0gYWN0aXZlUGFuZSkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NldHRpbmcgYWN0aXZlIHBhbmUgdGhhdCBpcyBub3QgcHJlc2VudCBpbiBwYW5lIGNvbnRhaW5lcicpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmFjdGl2ZVBhbmUgPSBhY3RpdmVQYW5lO1xyXG4gICAgICB0aGlzLmRpZENoYW5nZUFjdGl2ZUl0ZW1PblBhbmUodGhpcy5hY3RpdmVQYW5lLCB0aGlzLmFjdGl2ZVBhbmUuZ2V0QWN0aXZlSXRlbSgpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmFjdGl2ZVBhbmU7XHJcbiAgfVxyXG5cclxuICBkaWRBZGRQYW5lSXRlbShpdGVtLCBwYW5lLCBpbmRleCkge1xyXG4gICAgdGhpcy5pdGVtUmVnaXN0cnkuYWRkSXRlbShpdGVtKTtcclxuICB9XHJcblxyXG4gIHdpbGxEZXN0cm95UGFuZUl0ZW0oZXZlbnQpIHtcclxuICB9XHJcblxyXG4gIGRpZERlc3Ryb3lQYW5lSXRlbShldmVudCkge1xyXG4gICAgdGhpcy5pdGVtUmVnaXN0cnkucmVtb3ZlSXRlbShldmVudC5pdGVtKTtcclxuICAgIC8vIHRoaXMuZW1pdHRlci5lbWl0KCdkaWQtZGVzdHJveS1wYW5lLWl0ZW0nLCBldmVudCk7XHJcbiAgfVxyXG5cclxuICBkaWRDaGFuZ2VBY3RpdmVJdGVtT25QYW5lKHBhbmUsIGFjdGl2ZUl0ZW0pIHtcclxuICAgIGlmIChwYW5lID09PSB0aGlzLmdldEFjdGl2ZVBhbmUoKSkge1xyXG5cclxuICAgICAgdGhpcy5jYW5jZWxTdG9wcGVkQ2hhbmdpbmdBY3RpdmVQYW5lSXRlbVRpbWVvdXQoKTtcclxuICAgICAgLy8gYHNldFRpbWVvdXQoKWAgaXNuJ3QgYXZhaWxhYmxlIGR1cmluZyB0aGUgc25hcHNob3R0aW5nIHBoYXNlLCBidXQgdGhhdCdzIG9rYXkuXHJcblxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2FuY2VsU3RvcHBlZENoYW5naW5nQWN0aXZlUGFuZUl0ZW1UaW1lb3V0KCkge1xyXG5cclxuICB9XHJcbn1cclxuIl19
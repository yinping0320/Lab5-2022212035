/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Subject } from 'rxjs/Subject';
var EventPipe = /** @class */ (function () {
    function EventPipe(name, tokenValue, emitter, parentEventPipeList) {
        this.name = name;
        this.tokenValue = tokenValue;
        this.emitter = emitter;
        this.parentEventPipeList = parentEventPipeList;
        this.eventSubject = new Subject();
        this.subscriptionMap = new Map();
        this.onceSubscriptionMap = new Map();
        if (this.parentEventPipeList) {
            this.parentEventPipeList.push(this);
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    EventPipe.prototype.post = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.eventSubject.next(data);
    };
    /**
     * @param {?} eventHandler
     * @param {?} caller
     * @return {?}
     */
    EventPipe.prototype.subscribe = /**
     * @param {?} eventHandler
     * @param {?} caller
     * @return {?}
     */
    function (eventHandler, caller) {
        /** @type {?} */
        var subscription = this.eventSubject.subscribe(function (value) { return eventHandler.call(caller, value); });
        this.subscriptionMap.set(caller, subscription);
        return this;
    };
    /**
     * @param {?} eventHandler
     * @param {?} caller
     * @return {?}
     */
    EventPipe.prototype.subscribeOnce = /**
     * @param {?} eventHandler
     * @param {?} caller
     * @return {?}
     */
    function (eventHandler, caller) {
        /** @type {?} */
        var subscription = this.eventSubject.subscribe(function (value) { return eventHandler.call(caller, value); });
        this.onceSubscriptionMap.set(caller, subscription);
        return this;
    };
    /**
     * @param {?} subscriber
     * @return {?}
     */
    EventPipe.prototype.unSubscribe = /**
     * @param {?} subscriber
     * @return {?}
     */
    function (subscriber) {
        /** @type {?} */
        var subscription = this.subscriptionMap.get(subscriber);
        if (subscription) {
            subscription.unsubscribe();
            subscription = null;
            this.subscriptionMap.delete(subscriber);
        }
        else {
            subscription = this.onceSubscriptionMap.get(subscriber);
            if (subscription) {
                subscription.unsubscribe();
                subscription = null;
                this.onceSubscriptionMap.delete(subscriber);
            }
        }
    };
    // 注销使用once方法注册的订阅。
    // 注销使用once方法注册的订阅。
    /**
     * @return {?}
     */
    EventPipe.prototype.unSubscribeForOnce = 
    // 注销使用once方法注册的订阅。
    /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(Array.from(this.onceSubscriptionMap.keys())), _c = _b.next(); !_c.done; _c = _b.next()) {
                var subscriber = _c.value;
                this.unSubscribe(subscriber);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /**
     * @param {?} emitter
     * @param {?} tokenValue
     * @return {?}
     */
    EventPipe.prototype.matchEmitterToken = /**
     * @param {?} emitter
     * @param {?} tokenValue
     * @return {?}
     */
    function (emitter, tokenValue) {
        if (this.emitter && emitter && this.emitter !== emitter) {
            return false;
        }
        if (this.tokenValue && tokenValue && this.tokenValue !== tokenValue) {
            return false;
        }
        return true;
    };
    /**
     * @param {?} target
     * @param {?} tokenValue
     * @return {?}
     */
    EventPipe.prototype.examByTargetToken = /**
     * @param {?} target
     * @param {?} tokenValue
     * @return {?}
     */
    function (target, tokenValue) {
        if (this.emitter !== target) {
            return false;
        }
        if (this.tokenValue !== tokenValue) {
            return false;
        }
        return true;
    };
    /**
     * @param {?} subscriber
     * @return {?}
     */
    EventPipe.prototype.dispose = /**
     * @param {?} subscriber
     * @return {?}
     */
    function (subscriber) {
        var _this = this;
        this.unSubscribe(subscriber);
        if (this.subscriptionMap.size === 0 && this.parentEventPipeList) {
            /** @type {?} */
            var location_1 = this.parentEventPipeList.findIndex(function (item) { return item === _this; });
            if (location_1 !== -1) {
                this.parentEventPipeList.splice(location_1, 1);
            }
        }
    };
    return EventPipe;
}());
export { EventPipe };
if (false) {
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.eventSubject;
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.subscriptionMap;
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.onceSubscriptionMap;
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.name;
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.tokenValue;
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.emitter;
    /**
     * @type {?}
     * @private
     */
    EventPipe.prototype.parentEventPipeList;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQtcGlwZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9pZGVmcmFtZXdvcmsvZXZlbnRidXMvZXZlbnQtcGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFJdkM7SUFNRSxtQkFBb0IsSUFBWSxFQUNYLFVBQWtCLEVBQ2xCLE9BQWUsRUFDZixtQkFBcUM7UUFIdEMsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNYLGVBQVUsR0FBVixVQUFVLENBQVE7UUFDbEIsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUNmLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBa0I7UUFDeEQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxHQUFHLEVBQXdCLENBQUM7UUFDdkQsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksR0FBRyxFQUF3QixDQUFDO1FBQzNELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzVCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDckM7SUFDSCxDQUFDOzs7OztJQUVELHdCQUFJOzs7O0lBQUosVUFBSyxJQUFTO1FBQ1osSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7Ozs7O0lBRUQsNkJBQVM7Ozs7O0lBQVQsVUFBVSxZQUFrQyxFQUFFLE1BQWM7O1lBQ3BELFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxFQUFoQyxDQUFnQyxDQUFDO1FBQzdGLElBQUksQ0FBQyxlQUFlLENBQUMsR0FB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LG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxVQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDOUM7U0FDRjtJQUNILENBQUM7SUFDSCxnQkFBQztBQUFELENBQUMsQUE1RkQsSUE0RkM7Ozs7Ozs7SUExRkMsaUNBQW1DOzs7OztJQUNuQyxvQ0FBbUQ7Ozs7O0lBQ25ELHdDQUF1RDs7Ozs7SUFFM0MseUJBQW9COzs7OztJQUNuQiwrQkFBMEI7Ozs7O0lBQzFCLDRCQUF1Qjs7Ozs7SUFDdkIsd0NBQTZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMvU3ViamVjdCc7XHJcbmltcG9ydCB7SURpc3Bvc2FibGV9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQge1N1YnNjcmlwdGlvbn0gZnJvbSAncnhqcy9TdWJzY3JpcHRpb24nO1xyXG5cclxuZXhwb3J0IGNsYXNzIEV2ZW50UGlwZSBpbXBsZW1lbnRzIElEaXNwb3NhYmxlIHtcclxuXHJcbiAgcHJpdmF0ZSBldmVudFN1YmplY3Q6IFN1YmplY3Q8YW55PjtcclxuICBwcml2YXRlIHN1YnNjcmlwdGlvbk1hcDogTWFwPG9iamVjdCwgU3Vic2NyaXB0aW9uPjtcclxuICBwcml2YXRlIG9uY2VTdWJzY3JpcHRpb25NYXA6IE1hcDxvYmplY3QsIFN1YnNjcmlwdGlvbj47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICBwcml2YXRlIHRva2VuVmFsdWU6IHN0cmluZyxcclxuICAgICAgICAgICAgICAgcHJpdmF0ZSBlbWl0dGVyOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgIHByaXZhdGUgcGFyZW50RXZlbnRQaXBlTGlzdDogQXJyYXk8RXZlbnRQaXBlPikge1xyXG4gICAgdGhpcy5ldmVudFN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbk1hcCA9IG5ldyBNYXA8b2JqZWN0LCBTdWJzY3JpcHRpb24+KCk7XHJcbiAgICB0aGlzLm9uY2VTdWJzY3JpcHRpb25NYXAgPSBuZXcgTWFwPG9iamVjdCwgU3Vic2NyaXB0aW9uPigpO1xyXG4gICAgaWYgKHRoaXMucGFyZW50RXZlbnRQaXBlTGlzdCkge1xyXG4gICAgICB0aGlzLnBhcmVudEV2ZW50UGlwZUxpc3QucHVzaCh0aGlzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHBvc3QoZGF0YTogYW55KSB7XHJcbiAgICB0aGlzLmV2ZW50U3ViamVjdC5uZXh0KGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgc3Vic2NyaWJlKGV2ZW50SGFuZGxlcjogKHZhbHVlOiBhbnkpID0+IHZvaWQsIGNhbGxlcjogb2JqZWN0KTogSURpc3Bvc2FibGUge1xyXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy5ldmVudFN1YmplY3Quc3Vic2NyaWJlKCh2YWx1ZSkgPT4gZXZlbnRIYW5kbGVyLmNhbGwoY2FsbGVyLCB2YWx1ZSkpO1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25NYXAuc2V0KFxyXG4gICAgICBjYWxsZXIsXHJcbiAgICAgIHN1YnNjcmlwdGlvblxyXG4gICAgKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgc3Vic2NyaWJlT25jZShldmVudEhhbmRsZXI6ICh2YWx1ZTogYW55KSA9PiB2b2lkLCBjYWxsZXI6IG9iamVjdCk6IElEaXNwb3NhYmxlIHtcclxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHRoaXMuZXZlbnRTdWJqZWN0LnN1YnNjcmliZSgodmFsdWUpID0+IGV2ZW50SGFuZGxlci5jYWxsKGNhbGxlciwgdmFsdWUpKTtcclxuICAgIHRoaXMub25jZVN1YnNjcmlwdGlvbk1hcC5zZXQoXHJcbiAgICAgIGNhbGxlcixcclxuICAgICAgc3Vic2NyaXB0aW9uXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICB1blN1YnNjcmliZShzdWJzY3JpYmVyOiBvYmplY3QpIHtcclxuICAgIGxldCBzdWJzY3JpcHRpb24gPSB0aGlzLnN1YnNjcmlwdGlvbk1hcC5nZXQoc3Vic2NyaWJlcik7XHJcbiAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICBzdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbk1hcC5kZWxldGUoc3Vic2NyaWJlcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdWJzY3JpcHRpb24gPSB0aGlzLm9uY2VTdWJzY3JpcHRpb25NYXAuZ2V0KHN1YnNjcmliZXIpO1xyXG4gICAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgc3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9uY2VTdWJzY3JpcHRpb25NYXAuZGVsZXRlKHN1YnNjcmliZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyDms6jplIDkvb/nlKhvbmNl5pa55rOV5rOo5YaM55qE6K6i6ZiF44CCXHJcbiAgdW5TdWJzY3JpYmVGb3JPbmNlKCkge1xyXG4gICAgZm9yIChjb25zdCBzdWJzY3JpYmVyIG9mIEFycmF5LmZyb20odGhpcy5vbmNlU3Vic2NyaXB0aW9uTWFwLmtleXMoKSkpIHtcclxuICAgICAgdGhpcy51blN1YnNjcmliZShzdWJzY3JpYmVyKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1hdGNoRW1pdHRlclRva2VuKGVtaXR0ZXI6IHN0cmluZywgdG9rZW5WYWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5lbWl0dGVyICYmIGVtaXR0ZXIgJiYgdGhpcy5lbWl0dGVyICE9PSBlbWl0dGVyKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnRva2VuVmFsdWUgJiYgdG9rZW5WYWx1ZSAmJiB0aGlzLnRva2VuVmFsdWUgIT09IHRva2VuVmFsdWUpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBleGFtQnlUYXJnZXRUb2tlbih0YXJnZXQ6IHN0cmluZywgdG9rZW5WYWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICBpZiAodGhpcy5lbWl0dGVyICE9PSB0YXJnZXQpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudG9rZW5WYWx1ZSAhPT0gdG9rZW5WYWx1ZSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGRpc3Bvc2Uoc3Vic2NyaWJlcjogb2JqZWN0KTogdm9pZCB7XHJcbiAgICB0aGlzLnVuU3Vic2NyaWJlKHN1YnNjcmliZXIpO1xyXG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTWFwLnNpemUgPT09IDAgJiYgdGhpcy5wYXJlbnRFdmVudFBpcGVMaXN0KSB7XHJcbiAgICAgIGNvbnN0IGxvY2F0aW9uID0gdGhpcy5wYXJlbnRFdmVudFBpcGVMaXN0LmZpbmRJbmRleChpdGVtID0+IGl0ZW0gPT09IHRoaXMpO1xyXG4gICAgICBpZiAobG9jYXRpb24gIT09IC0xKSB7XHJcbiAgICAgICAgdGhpcy5wYXJlbnRFdmVudFBpcGVMaXN0LnNwbGljZShsb2NhdGlvbiwgMSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
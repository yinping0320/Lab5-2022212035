/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// tslint:disable: forin
import { Emitter, Disposable, CompositeDisposable } from './event-kit';
// import { calculateSpecificity, validateSelector } from 'clear-cut';
// const _ = require('underscore-plus')
/** @type {?} */
let SequenceCount = 0;
// Public: Associates listener functions with commands in a
// context-sensitive way using CSS selectors. You can access a global instance of
// this class via `atom.commands`, and commands registered there will be
// presented in the command palette.
//
// The global command registry facilitates a style of event handling known as
// *event delegation* that was popularized by jQuery. Atom commands are expressed
// as custom DOM events that can be invoked on the currently focused element via
// a key binding or manually via the command palette. Rather than binding
// listeners for command events directly to DOM nodes, you instead register
// command event listeners globally on `atom.commands` and constrain them to
// specific kinds of elements with CSS selectors.
//
// Command names must follow the `namespace:action` pattern, where `namespace`
// will typically be the name of your package, and `action` describes the
// behavior of your command. If either part consists of multiple words, these
// must be separated by hyphens. E.g. `awesome-package:turn-it-up-to-eleven`.
// All words should be lowercased.
//
// As the event bubbles upward through the DOM, all registered event listeners
// with matching selectors are invoked in order of specificity. In the event of a
// specificity tie, the most recently registered listener is invoked first. This
// mirrors the "cascade" semantics of CSS. Event listeners are invoked in the
// context of the current DOM node, meaning `this` always points at
// `event.currentTarget`. As is normally the case with DOM events,
// `stopPropagation` and `stopImmediatePropagation` can be used to terminate the
// bubbling process and prevent invocation of additional listeners.
//
// ## Example
//
// Here is a command that inserts the current date in an editor:
//
// ```coffee
// atom.commands.add 'atom-text-editor',
//   'user:insert-date': (event) ->
//     editor = @getModel()
//     editor.insertText(new Date().toLocaleString())
// ```
export class CommandRegistry {
    constructor() {
        this.handleCommandEvent = this.handleCommandEvent.bind(this);
        this.rootNode = null;
        this.clear();
    }
    /**
     * @return {?}
     */
    clear() {
        this.registeredCommands = {};
        this.selectorBasedListenersByCommandName = {};
        this.inlineListenersByCommandName = {};
        this.emitter = new Emitter();
    }
    /**
     * @param {?} rootNode
     * @return {?}
     */
    attach(rootNode) {
        this.rootNode = rootNode;
        for (const command in this.selectorBasedListenersByCommandName) {
            this.commandRegistered(command);
        }
        for (const command in this.inlineListenersByCommandName) {
            this.commandRegistered(command);
        }
    }
    /**
     * @return {?}
     */
    destroy() {
        for (const commandName in this.registeredCommands) {
            this.rootNode.removeEventListener(commandName, this.handleCommandEvent, true);
        }
    }
    // Public: Add one or more command listeners associated with a selector.
    //
    // ## Arguments: Registering One Command
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the command will be globally associated with all matching
    //   elements. The `,` combinator is not currently supported. If you pass a
    //   DOM element, the command will be associated with just that element.
    // * `commandName` A {String} containing the name of a command you want to
    //   handle such as `user:insert-date`.
    // * `listener` A listener which handles the event.  Either a {Function} to
    //   call when the given command is invoked on an element matching the
    //   selector, or an {Object} with a `didDispatch` property which is such a
    //   function.
    //
    //   The function (`listener` itself if it is a function, or the `didDispatch`
    //   method if `listener` is an object) will be called with `this` referencing
    //   the matching DOM node and the following argument:
    //     * `event`: A standard DOM event instance. Call `stopPropagation` or
    //       `stopImmediatePropagation` to terminate bubbling early.
    //
    //   Additionally, `listener` may have additional properties which are returned
    //   to those who query using `atom.commands.findCommands`, as well as several
    //   meaningful metadata properties:
    //     * `displayName`: Overrides any generated `displayName` that would
    //       otherwise be generated from the event name.
    //     * `description`: Used by consumers to display detailed information about
    //       the command.
    //     * `hiddenInCommandPalette`: If `true`, this command will not appear in
    //       the bundled command palette by default, but can still be shown with.
    //       the `Command Palette: Show Hidden Commands` command. This is a good
    //       option when you need to register large numbers of commands that don't
    //       make sense to be executed from the command palette. Please use this
    //       option conservatively, as it could reduce the discoverability of your
    //       package's commands.
    //
    // ## Arguments: Registering Multiple Commands
    //
    // * `target` A {String} containing a CSS selector or a DOM element. If you
    //   pass a selector, the commands will be globally associated with all
    //   matching elements. The `,` combinator is not currently supported.
    //   If you pass a DOM element, the command will be associated with just that
    //   element.
    // * `commands` An {Object} mapping command names like `user:insert-date` to
    //   listener {Function}s.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to remove the
    // added command handler(s).
    /**
     * @param {?} target
     * @param {?} commandName
     * @param {?} listener
     * @param {?=} throwOnInvalidSelector
     * @return {?}
     */
    add(target, commandName, listener, throwOnInvalidSelector = true) {
        if (typeof commandName === 'object') {
            /** @type {?} */
            const commands = commandName;
            throwOnInvalidSelector = listener;
            /** @type {?} */
            const disposable = new CompositeDisposable();
            for (commandName in commands) {
                listener = commands[commandName];
                disposable.add(this.add(target, commandName, listener, throwOnInvalidSelector));
            }
            return disposable;
        }
        if (listener == null) {
            throw new Error('Cannot register a command with a null listener.');
        }
        // type Listener = ((e: CustomEvent) => void) | {
        //   displayName?: string,
        //   description?: string,
        //   didDispatch(e: CustomEvent): void,
        // }
        if ((typeof listener !== 'function') && (typeof listener.didDispatch !== 'function')) {
            throw new Error('Listener must be a callback function or an object with a didDispatch method.');
        }
        if (typeof target === 'string') {
            if (throwOnInvalidSelector) {
                validateSelector(target);
            }
            return this.addSelectorBasedListener(target, commandName, listener);
        }
        else {
            return this.addInlineListener(target, commandName, listener);
        }
    }
    /**
     * @param {?} selector
     * @param {?} commandName
     * @param {?} listener
     * @return {?}
     */
    addSelectorBasedListener(selector, commandName, listener) {
        if (this.selectorBasedListenersByCommandName[commandName] == null) {
            this.selectorBasedListenersByCommandName[commandName] = [];
        }
        /** @type {?} */
        const listenersForCommand = this.selectorBasedListenersByCommandName[commandName];
        /** @type {?} */
        const selectorListener = new SelectorBasedListener(selector, commandName, listener);
        listenersForCommand.push(selectorListener);
        this.commandRegistered(commandName);
        return new Disposable(() => {
            listenersForCommand.splice(listenersForCommand.indexOf(selectorListener), 1);
            if (listenersForCommand.length === 0) {
                delete this.selectorBasedListenersByCommandName[commandName];
            }
        });
    }
    /**
     * @param {?} element
     * @param {?} commandName
     * @param {?} listener
     * @return {?}
     */
    addInlineListener(element, commandName, listener) {
        if (this.inlineListenersByCommandName[commandName] == null) {
            this.inlineListenersByCommandName[commandName] = new WeakMap();
        }
        /** @type {?} */
        const listenersForCommand = this.inlineListenersByCommandName[commandName];
        /** @type {?} */
        let listenersForElement = listenersForCommand.get(element);
        if (!listenersForElement) {
            listenersForElement = [];
            listenersForCommand.set(element, listenersForElement);
        }
        /** @type {?} */
        const inlineListener = new InlineListener(commandName, listener);
        listenersForElement.push(inlineListener);
        this.commandRegistered(commandName);
        return new Disposable(() => {
            listenersForElement.splice(listenersForElement.indexOf(inlineListener), 1);
            if (listenersForElement.length === 0) {
                listenersForCommand.delete(element);
            }
        });
    }
    // Public: Find all registered commands matching a query.
    //
    // * `params` An {Object} containing one or more of the following keys:
    //   * `target` A DOM node that is the hypothetical target of a given command.
    //
    // Returns an {Array} of `CommandDescriptor` {Object}s containing the following keys:
    //  * `name` The name of the command. For example, `user:insert-date`.
    //  * `displayName` The display name of the command. For example,
    //    `User: Insert Date`.
    // Additional metadata may also be present in the returned descriptor:
    //  * `description` a {String} describing the function of the command in more
    //    detail than the title
    //  * `tags` an {Array} of {String}s that describe keywords related to the
    //    command
    //  Any additional nonstandard metadata provided when the command was `add`ed
    //  may also be present in the returned descriptor.
    /**
     * @param {?} __0
     * @return {?}
     */
    findCommands({ target }) {
        /** @type {?} */
        const commandNames = new Set();
        /** @type {?} */
        const commands = [];
        /** @type {?} */
        let currentTarget = target;
        while (true) {
            /** @type {?} */
            let listeners;
            for (const name in this.inlineListenersByCommandName) {
                listeners = this.inlineListenersByCommandName[name];
                if (listeners.has(currentTarget) && !commandNames.has(name)) {
                    commandNames.add(name);
                    /** @type {?} */
                    const targetListeners = listeners.get(currentTarget);
                    commands.push(...targetListeners.map(listener => listener.descriptor));
                }
            }
            for (const commandName in this.selectorBasedListenersByCommandName) {
                listeners = this.selectorBasedListenersByCommandName[commandName];
                for (const listener of listeners) {
                    if (listener.matchesTarget(currentTarget)) {
                        if (!commandNames.has(commandName)) {
                            commandNames.add(commandName);
                            commands.push(listener.descriptor);
                        }
                    }
                }
            }
            if (currentTarget === window) {
                break;
            }
            currentTarget = currentTarget.parentNode || window;
        }
        return commands;
    }
    // Public: Simulate the dispatch of a command on a DOM node.
    //
    // This can be useful for testing when you want to simulate the invocation of a
    // command on a detached DOM node. Otherwise, the DOM node in question needs to
    // be attached to the document so the event bubbles up to the root node to be
    // processed.
    //
    // * `target` The DOM node at which to start bubbling the command event.
    // * `commandName` {String} indicating the name of the command to dispatch.
    /**
     * @param {?} target
     * @param {?} commandName
     * @param {?} detail
     * @return {?}
     */
    dispatch(target, commandName, detail) {
        /** @type {?} */
        const event = new CustomEvent(commandName, { bubbles: true, detail });
        Object.defineProperty(event, 'target', { value: target });
        return this.handleCommandEvent(event);
    }
    // Public: Invoke the given callback before dispatching a command event.
    //
    // * `callback` {Function} to be called before dispatching each command
    //   * `event` The Event that will be dispatched
    /**
     * @param {?} callback
     * @return {?}
     */
    onWillDispatch(callback) {
        return this.emitter.on('will-dispatch', callback);
    }
    // Public: Invoke the given callback after dispatching a command event.
    //
    // * `callback` {Function} to be called after dispatching each command
    //   * `event` The Event that was dispatched
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidDispatch(callback) {
        return this.emitter.on('did-dispatch', callback);
    }
    /**
     * @return {?}
     */
    getSnapshot() {
        /** @type {?} */
        const snapshot = {};
        for (const commandName in this.selectorBasedListenersByCommandName) {
            /** @type {?} */
            const listeners = this.selectorBasedListenersByCommandName[commandName];
            snapshot[commandName] = listeners.slice();
        }
        return snapshot;
    }
    /**
     * @param {?} snapshot
     * @return {?}
     */
    restoreSnapshot(snapshot) {
        this.selectorBasedListenersByCommandName = {};
        for (const commandName in snapshot) {
            /** @type {?} */
            const listeners = snapshot[commandName];
            this.selectorBasedListenersByCommandName[commandName] = listeners.slice();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleCommandEvent(event) {
        /** @type {?} */
        let propagationStopped = false;
        /** @type {?} */
        let immediatePropagationStopped = false;
        /** @type {?} */
        const matched = [];
        /** @type {?} */
        let currentTarget = event.target;
        /** @type {?} */
        const dispatchedEvent = new CustomEvent(event.type, {
            bubbles: true,
            detail: event.detail
        });
        Object.defineProperty(dispatchedEvent, 'eventPhase', {
            value: Event.BUBBLING_PHASE
        });
        Object.defineProperty(dispatchedEvent, 'currentTarget', {
            /**
             * @return {?}
             */
            get() {
                return currentTarget;
            }
        });
        Object.defineProperty(dispatchedEvent, 'target', { value: currentTarget });
        Object.defineProperty(dispatchedEvent, 'preventDefault', {
            /**
             * @return {?}
             */
            value() {
                return event.preventDefault();
            }
        });
        Object.defineProperty(dispatchedEvent, 'stopPropagation', {
            /**
             * @return {?}
             */
            value() {
                event.stopPropagation();
                propagationStopped = true;
            }
        });
        Object.defineProperty(dispatchedEvent, 'stopImmediatePropagation', {
            /**
             * @return {?}
             */
            value() {
                event.stopImmediatePropagation();
                propagationStopped = true;
                immediatePropagationStopped = true;
            }
        });
        Object.defineProperty(dispatchedEvent, 'abortKeyBinding', {
            /**
             * @return {?}
             */
            value() {
                if (typeof event.abortKeyBinding === 'function') {
                    event.abortKeyBinding();
                }
            }
        });
        for (const key of Object.keys(event)) {
            if (!(key in dispatchedEvent)) {
                dispatchedEvent[key] = event[key];
            }
        }
        this.emitter.emit('will-dispatch', dispatchedEvent);
        while (true) {
            /** @type {?} */
            const commandInlineListeners = this.inlineListenersByCommandName[event.type]
                ? this.inlineListenersByCommandName[event.type].get(currentTarget)
                : null;
            /** @type {?} */
            let listeners = commandInlineListeners || [];
            if (currentTarget.webkitMatchesSelector != null) {
                /** @type {?} */
                const selectorBasedListeners = (this.selectorBasedListenersByCommandName[event.type] || [])
                    .filter(listener => listener.matchesTarget(currentTarget))
                    .sort((a, b) => a.compare(b));
                listeners = selectorBasedListeners.concat(listeners);
            }
            // Call inline listeners first in reverse registration order,
            // and selector-based listeners by specificity and reverse
            // registration order.
            for (let i = listeners.length - 1; i >= 0; i--) {
                /** @type {?} */
                const listener = listeners[i];
                if (immediatePropagationStopped) {
                    break;
                }
                matched.push(listener.didDispatch.call(currentTarget, dispatchedEvent));
            }
            if (currentTarget === window) {
                break;
            }
            if (propagationStopped) {
                break;
            }
            currentTarget = currentTarget.parentNode || window;
        }
        this.emitter.emit('did-dispatch', dispatchedEvent);
        return (matched.length > 0 ? Promise.all(matched) : null);
    }
    /**
     * @param {?} commandName
     * @return {?}
     */
    commandRegistered(commandName) {
        if (this.rootNode != null && !this.registeredCommands[commandName]) {
            this.rootNode.addEventListener(commandName, this.handleCommandEvent, true);
            return (this.registeredCommands[commandName] = true);
        }
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.rootNode;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.registeredCommands;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.selectorBasedListenersByCommandName;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.inlineListenersByCommandName;
    /**
     * @type {?}
     * @private
     */
    CommandRegistry.prototype.emitter;
}
// type Listener = {
//   descriptor: CommandDescriptor,
//   extractDidDispatch: (e: CustomEvent) => void,
// };
class SelectorBasedListener {
    /**
     * @param {?} selector
     * @param {?} commandName
     * @param {?} listener
     */
    constructor(selector, commandName, listener) {
        this.selector = selector;
        this.didDispatch = extractDidDispatch(listener);
        this.descriptor = extractDescriptor(commandName, listener);
        this.specificity = calculateSpecificity(this.selector);
        this.sequenceNumber = SequenceCount++;
    }
    /**
     * @param {?} other
     * @return {?}
     */
    compare(other) {
        return (this.specificity - other.specificity ||
            this.sequenceNumber - other.sequenceNumber);
    }
    /**
     * @param {?} target
     * @return {?}
     */
    matchesTarget(target) {
        return target.webkitMatchesSelector && target.webkitMatchesSelector(this.selector);
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.selector;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.didDispatch;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.descriptor;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.specificity;
    /**
     * @type {?}
     * @private
     */
    SelectorBasedListener.prototype.sequenceNumber;
}
class InlineListener {
    /**
     * @param {?} commandName
     * @param {?} listener
     */
    constructor(commandName, listener) {
        this.didDispatch = extractDidDispatch(listener);
        this.descriptor = extractDescriptor(commandName, listener);
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    InlineListener.prototype.didDispatch;
    /**
     * @type {?}
     * @private
     */
    InlineListener.prototype.descriptor;
}
// type CommandDescriptor = {
//   name: string,
//   displayName: string,
// };
/**
 * @param {?} name
 * @param {?} listener
 * @return {?}
 */
function extractDescriptor(name, listener) {
    return Object.assign(omit(listener, 'didDispatch'), {
        name,
        displayName: listener.displayName ? listener.displayName : humanizeEventName(name)
    });
}
/**
 * @param {?} listener
 * @return {?}
 */
function extractDidDispatch(listener) {
    return typeof listener === 'function' ? listener : listener.didDispatch;
}
/**
 * @param {?} selector
 * @return {?}
 */
function validateSelector(selector) {
    if (!isSelectorValid(selector)) {
        /** @type {?} */
        const error = new SyntaxError(selector + ' is not a valid selector');
        // error.code = 'EBADSELECTOR';
        throw error;
    }
}
/**
 * @param {?} selector
 * @return {?}
 */
function isSelectorValid(selector) {
    /** @type {?} */
    let valid;
    try {
        document.querySelector(selector);
        valid = true;
    }
    catch (error) {
        valid = false;
    }
    return valid;
}
/**
 * @param {?} selector
 * @return {?}
 */
function calculateSpecificity(selector) {
    /** @type {?} */
    const specificity = calculate(selector);
    return specificity;
}
/**
 * @param {?} selector
 * @return {?}
 */
function calculate(selector) {
    /** @type {?} */
    const commaIndex = selector.indexOf(',');
    if (commaIndex !== -1) {
        selector = selector.substring(0, commaIndex);
    }
    /** @type {?} */
    const types = {
        a: 0,
        b: 0,
        c: 0
    };
    // The following regular expressions assume that selectors matching the preceding regular expressions have been removed
    /** @type {?} */
    const attributeRegex = /(\[[^\]]+\])/g;
    /** @type {?} */
    const idRegex = /(#[^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    const classRegex = /(\.[^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    const pseudoElementRegex = /(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/g;
    /** @type {?} */
    const pseudoClassRegex = /(:[^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    const elementRegex = /([^\s\+>~\.\[:]+)/g;
    /** @type {?} */
    const notRegex = /:not\(([^\)]*)\)/g;
    /** @type {?} */
    const ruleRegex = /\{[^]*/gm;
    /** @type {?} */
    const separatorRegex = /[\*\s\+>~]/g;
    /** @type {?} */
    const straysRegex = /[#\.]/g;
    // Remove the negation psuedo-class (:not) but leave its argument because specificity is calculated on its argument
    selector = selector.replace(notRegex, ' $1 ');
    // Remove anything after a left brace in case a user has pasted in a rule, not just a selector
    selector = selector.replace(ruleRegex, ' ');
    // Add attribute selectors to parts collection (type b)
    selector = findMatch(attributeRegex, 'b', types, selector);
    // Add ID selectors to parts collection (type a)
    selector = findMatch(idRegex, 'a', types, selector);
    // Add class selectors to parts collection (type b)
    selector = findMatch(classRegex, 'b', types, selector);
    // Add pseudo-element selectors to parts collection (type c)
    selector = findMatch(pseudoElementRegex, 'c', types, selector);
    // Add pseudo-class selectors to parts collection (type b)
    selector = findMatch(pseudoClassRegex, 'b', types, selector);
    // Remove universal selector and separator characters
    selector = selector.replace(separatorRegex, ' ');
    // Remove any stray dots or hashes which aren't attached to words
    // These may be present if the user is live-editing this selector
    selector = selector.replace(straysRegex, ' ');
    // The only things left should be element selectors (type c)
    findMatch(elementRegex, 'c', types, selector);
    return (types.a * 100) + (types.b * 10) + (types.c * 1);
}
/**
 * @param {?} regex
 * @param {?} type
 * @param {?} types
 * @param {?} selector
 * @return {?}
 */
function findMatch(regex, type, types, selector) {
    /** @type {?} */
    const matches = selector.match(regex);
    if (matches) {
        for (const match of matches) {
            types[type]++;
            // Replace this simple selector with whitespace so it won't be counted in further simple selectors
            selector = selector.replace(match, ' ');
        }
    }
    return selector;
}
/**
 * @param {?} obj
 * @param {...?} props
 * @return {?}
 */
function omit(obj, ...props) {
    // const iteratee = (value, key) => !props.find(key);
    // const iteratee = (value, key) => !props.find(key);
    /** @type {?} */
    const result = {};
    if (!obj) {
        return result;
    }
    Object.keys(obj).forEach(key => {
        if (!props.find(prop => prop === key)) {
            return;
        }
        result[key] = obj[key];
    });
    return result;
}
/**
 * @param {?} eventName
 * @param {?=} eventDoc
 * @return {?}
 */
function humanizeEventName(eventName, eventDoc = null) {
    /** @type {?} */
    const ref = eventName.split(':');
    const [namespace, event] = ref;
    if (event == null) {
        return undash(namespace);
    }
    /** @type {?} */
    const namespaceDoc = undash(namespace);
    if (eventDoc == null) {
        eventDoc = undash(event);
    }
    return '' + namespaceDoc + ': ' + eventDoc;
}
/**
 * @param {?} str
 * @return {?}
 */
function undash(str) {
    if (str) {
        return str.split('-').join(' ');
    }
    else {
        return '';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC1yZWdpc3RyeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9pZGVmcmFtZXdvcmsvZ3NwL2NvbW1hbmQtcmVnaXN0cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGFBQWEsQ0FBQzs7OztJQUluRSxhQUFhLEdBQUcsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0NyQixNQUFNLE9BQU8sZUFBZTtJQU8xQjtRQUNFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNmLENBQUM7Ozs7SUFFRCxLQUFLO1FBQ0gsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsbUNBQW1DLEdBQUcsRUFBRSxDQUFDO1FBQzlDLElBQUksQ0FBQyw0QkFBNEIsR0FBRyxFQUFFLENBQUM7UUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBQy9CLENBQUM7Ozs7O0lBRUQsTUFBTSxDQUFDLFFBQVE7UUFDYixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixLQUFLLE1BQU0sT0FBTyxJQUFJLElBQUksQ0FBQyxtQ0FBbUMsRUFBRTtZQUM5RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDakM7UUFFRCxLQUFLLE1BQU0sT0FBTyxJQUFJLElBQUksQ0FBQyw0QkFBNEIsRUFBRTtZQUN2RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7U0FD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QUFZLEdBQUcsSUFBSSxHQUFHLFFBQVEsQ0FBQztBQUM3QyxDQUFDOzs7OztBQUVELFNBQVMsTUFBTSxDQUFDLEdBQUc7SUFDakIsSUFBSSxHQUFHLEVBQUU7UUFDUCxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ2pDO1NBQU07UUFDTCxPQUFPLEVBQUUsQ0FBQztLQUNYO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlOiBmb3JpblxyXG5pbXBvcnQgeyBFbWl0dGVyLCBEaXNwb3NhYmxlLCBDb21wb3NpdGVEaXNwb3NhYmxlIH0gZnJvbSAnLi9ldmVudC1raXQnO1xyXG4vLyBpbXBvcnQgeyBjYWxjdWxhdGVTcGVjaWZpY2l0eSwgdmFsaWRhdGVTZWxlY3RvciB9IGZyb20gJ2NsZWFyLWN1dCc7XHJcbi8vIGNvbnN0IF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlLXBsdXMnKVxyXG5cclxubGV0IFNlcXVlbmNlQ291bnQgPSAwO1xyXG5cclxuLy8gUHVibGljOiBBc3NvY2lhdGVzIGxpc3RlbmVyIGZ1bmN0aW9ucyB3aXRoIGNvbW1hbmRzIGluIGFcclxuLy8gY29udGV4dC1zZW5zaXRpdmUgd2F5IHVzaW5nIENTUyBzZWxlY3RvcnMuIFlvdSBjYW4gYWNjZXNzIGEgZ2xvYmFsIGluc3RhbmNlIG9mXHJcbi8vIHRoaXMgY2xhc3MgdmlhIGBhdG9tLmNvbW1hbmRzYCwgYW5kIGNvbW1hbmRzIHJlZ2lzdGVyZWQgdGhlcmUgd2lsbCBiZVxyXG4vLyBwcmVzZW50ZWQgaW4gdGhlIGNvbW1hbmQgcGFsZXR0ZS5cclxuLy9cclxuLy8gVGhlIGdsb2JhbCBjb21tYW5kIHJlZ2lzdHJ5IGZhY2lsaXRhdGVzIGEgc3R5bGUgb2YgZXZlbnQgaGFuZGxpbmcga25vd24gYXNcclxuLy8gKmV2ZW50IGRlbGVnYXRpb24qIHRoYXQgd2FzIHBvcHVsYXJpemVkIGJ5IGpRdWVyeS4gQXRvbSBjb21tYW5kcyBhcmUgZXhwcmVzc2VkXHJcbi8vIGFzIGN1c3RvbSBET00gZXZlbnRzIHRoYXQgY2FuIGJlIGludm9rZWQgb24gdGhlIGN1cnJlbnRseSBmb2N1c2VkIGVsZW1lbnQgdmlhXHJcbi8vIGEga2V5IGJpbmRpbmcgb3IgbWFudWFsbHkgdmlhIHRoZSBjb21tYW5kIHBhbGV0dGUuIFJhdGhlciB0aGFuIGJpbmRpbmdcclxuLy8gbGlzdGVuZXJzIGZvciBjb21tYW5kIGV2ZW50cyBkaXJlY3RseSB0byBET00gbm9kZXMsIHlvdSBpbnN0ZWFkIHJlZ2lzdGVyXHJcbi8vIGNvbW1hbmQgZXZlbnQgbGlzdGVuZXJzIGdsb2JhbGx5IG9uIGBhdG9tLmNvbW1hbmRzYCBhbmQgY29uc3RyYWluIHRoZW0gdG9cclxuLy8gc3BlY2lmaWMga2luZHMgb2YgZWxlbWVudHMgd2l0aCBDU1Mgc2VsZWN0b3JzLlxyXG4vL1xyXG4vLyBDb21tYW5kIG5hbWVzIG11c3QgZm9sbG93IHRoZSBgbmFtZXNwYWNlOmFjdGlvbmAgcGF0dGVybiwgd2hlcmUgYG5hbWVzcGFjZWBcclxuLy8gd2lsbCB0eXBpY2FsbHkgYmUgdGhlIG5hbWUgb2YgeW91ciBwYWNrYWdlLCBhbmQgYGFjdGlvbmAgZGVzY3JpYmVzIHRoZVxyXG4vLyBiZWhhdmlvciBvZiB5b3VyIGNvbW1hbmQuIElmIGVpdGhlciBwYXJ0IGNvbnNpc3RzIG9mIG11bHRpcGxlIHdvcmRzLCB0aGVzZVxyXG4vLyBtdXN0IGJlIHNlcGFyYXRlZCBieSBoeXBoZW5zLiBFLmcuIGBhd2Vzb21lLXBhY2thZ2U6dHVybi1pdC11cC10by1lbGV2ZW5gLlxyXG4vLyBBbGwgd29yZHMgc2hvdWxkIGJlIGxvd2VyY2FzZWQuXHJcbi8vXHJcbi8vIEFzIHRoZSBldmVudCBidWJibGVzIHVwd2FyZCB0aHJvdWdoIHRoZSBET00sIGFsbCByZWdpc3RlcmVkIGV2ZW50IGxpc3RlbmVyc1xyXG4vLyB3aXRoIG1hdGNoaW5nIHNlbGVjdG9ycyBhcmUgaW52b2tlZCBpbiBvcmRlciBvZiBzcGVjaWZpY2l0eS4gSW4gdGhlIGV2ZW50IG9mIGFcclxuLy8gc3BlY2lmaWNpdHkgdGllLCB0aGUgbW9zdCByZWNlbnRseSByZWdpc3RlcmVkIGxpc3RlbmVyIGlzIGludm9rZWQgZmlyc3QuIFRoaXNcclxuLy8gbWlycm9ycyB0aGUgXCJjYXNjYWRlXCIgc2VtYW50aWNzIG9mIENTUy4gRXZlbnQgbGlzdGVuZXJzIGFyZSBpbnZva2VkIGluIHRoZVxyXG4vLyBjb250ZXh0IG9mIHRoZSBjdXJyZW50IERPTSBub2RlLCBtZWFuaW5nIGB0aGlzYCBhbHdheXMgcG9pbnRzIGF0XHJcbi8vIGBldmVudC5jdXJyZW50VGFyZ2V0YC4gQXMgaXMgbm9ybWFsbHkgdGhlIGNhc2Ugd2l0aCBET00gZXZlbnRzLFxyXG4vLyBgc3RvcFByb3BhZ2F0aW9uYCBhbmQgYHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbmAgY2FuIGJlIHVzZWQgdG8gdGVybWluYXRlIHRoZVxyXG4vLyBidWJibGluZyBwcm9jZXNzIGFuZCBwcmV2ZW50IGludm9jYXRpb24gb2YgYWRkaXRpb25hbCBsaXN0ZW5lcnMuXHJcbi8vXHJcbi8vICMjIEV4YW1wbGVcclxuLy9cclxuLy8gSGVyZSBpcyBhIGNvbW1hbmQgdGhhdCBpbnNlcnRzIHRoZSBjdXJyZW50IGRhdGUgaW4gYW4gZWRpdG9yOlxyXG4vL1xyXG4vLyBgYGBjb2ZmZWVcclxuLy8gYXRvbS5jb21tYW5kcy5hZGQgJ2F0b20tdGV4dC1lZGl0b3InLFxyXG4vLyAgICd1c2VyOmluc2VydC1kYXRlJzogKGV2ZW50KSAtPlxyXG4vLyAgICAgZWRpdG9yID0gQGdldE1vZGVsKClcclxuLy8gICAgIGVkaXRvci5pbnNlcnRUZXh0KG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKSlcclxuLy8gYGBgXHJcbmV4cG9ydCBjbGFzcyBDb21tYW5kUmVnaXN0cnkge1xyXG4gIHByaXZhdGUgcm9vdE5vZGU6IGFueTtcclxuICBwcml2YXRlIHJlZ2lzdGVyZWRDb21tYW5kczogYW55O1xyXG4gIHByaXZhdGUgc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWU6IGFueTtcclxuICBwcml2YXRlIGlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWU6IGFueTtcclxuICBwcml2YXRlIGVtaXR0ZXI6IEVtaXR0ZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5oYW5kbGVDb21tYW5kRXZlbnQgPSB0aGlzLmhhbmRsZUNvbW1hbmRFdmVudC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5yb290Tm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLmNsZWFyKCk7XHJcbiAgfVxyXG5cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMucmVnaXN0ZXJlZENvbW1hbmRzID0ge307XHJcbiAgICB0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lID0ge307XHJcbiAgICB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWUgPSB7fTtcclxuICAgIHRoaXMuZW1pdHRlciA9IG5ldyBFbWl0dGVyKCk7XHJcbiAgfVxyXG5cclxuICBhdHRhY2gocm9vdE5vZGUpIHtcclxuICAgIHRoaXMucm9vdE5vZGUgPSByb290Tm9kZTtcclxuICAgIGZvciAoY29uc3QgY29tbWFuZCBpbiB0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lKSB7XHJcbiAgICAgIHRoaXMuY29tbWFuZFJlZ2lzdGVyZWQoY29tbWFuZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCBjb21tYW5kIGluIHRoaXMuaW5saW5lTGlzdGVuZXJzQnlDb21tYW5kTmFtZSkge1xyXG4gICAgICB0aGlzLmNvbW1hbmRSZWdpc3RlcmVkKGNvbW1hbmQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIGZvciAoY29uc3QgY29tbWFuZE5hbWUgaW4gdGhpcy5yZWdpc3RlcmVkQ29tbWFuZHMpIHtcclxuICAgICAgdGhpcy5yb290Tm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKFxyXG4gICAgICAgIGNvbW1hbmROYW1lLFxyXG4gICAgICAgIHRoaXMuaGFuZGxlQ29tbWFuZEV2ZW50LFxyXG4gICAgICAgIHRydWVcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQWRkIG9uZSBvciBtb3JlIGNvbW1hbmQgbGlzdGVuZXJzIGFzc29jaWF0ZWQgd2l0aCBhIHNlbGVjdG9yLlxyXG4gIC8vXHJcbiAgLy8gIyMgQXJndW1lbnRzOiBSZWdpc3RlcmluZyBPbmUgQ29tbWFuZFxyXG4gIC8vXHJcbiAgLy8gKiBgdGFyZ2V0YCBBIHtTdHJpbmd9IGNvbnRhaW5pbmcgYSBDU1Mgc2VsZWN0b3Igb3IgYSBET00gZWxlbWVudC4gSWYgeW91XHJcbiAgLy8gICBwYXNzIGEgc2VsZWN0b3IsIHRoZSBjb21tYW5kIHdpbGwgYmUgZ2xvYmFsbHkgYXNzb2NpYXRlZCB3aXRoIGFsbCBtYXRjaGluZ1xyXG4gIC8vICAgZWxlbWVudHMuIFRoZSBgLGAgY29tYmluYXRvciBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZC4gSWYgeW91IHBhc3MgYVxyXG4gIC8vICAgRE9NIGVsZW1lbnQsIHRoZSBjb21tYW5kIHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoIGp1c3QgdGhhdCBlbGVtZW50LlxyXG4gIC8vICogYGNvbW1hbmROYW1lYCBBIHtTdHJpbmd9IGNvbnRhaW5pbmcgdGhlIG5hbWUgb2YgYSBjb21tYW5kIHlvdSB3YW50IHRvXHJcbiAgLy8gICBoYW5kbGUgc3VjaCBhcyBgdXNlcjppbnNlcnQtZGF0ZWAuXHJcbiAgLy8gKiBgbGlzdGVuZXJgIEEgbGlzdGVuZXIgd2hpY2ggaGFuZGxlcyB0aGUgZXZlbnQuICBFaXRoZXIgYSB7RnVuY3Rpb259IHRvXHJcbiAgLy8gICBjYWxsIHdoZW4gdGhlIGdpdmVuIGNvbW1hbmQgaXMgaW52b2tlZCBvbiBhbiBlbGVtZW50IG1hdGNoaW5nIHRoZVxyXG4gIC8vICAgc2VsZWN0b3IsIG9yIGFuIHtPYmplY3R9IHdpdGggYSBgZGlkRGlzcGF0Y2hgIHByb3BlcnR5IHdoaWNoIGlzIHN1Y2ggYVxyXG4gIC8vICAgZnVuY3Rpb24uXHJcbiAgLy9cclxuICAvLyAgIFRoZSBmdW5jdGlvbiAoYGxpc3RlbmVyYCBpdHNlbGYgaWYgaXQgaXMgYSBmdW5jdGlvbiwgb3IgdGhlIGBkaWREaXNwYXRjaGBcclxuICAvLyAgIG1ldGhvZCBpZiBgbGlzdGVuZXJgIGlzIGFuIG9iamVjdCkgd2lsbCBiZSBjYWxsZWQgd2l0aCBgdGhpc2AgcmVmZXJlbmNpbmdcclxuICAvLyAgIHRoZSBtYXRjaGluZyBET00gbm9kZSBhbmQgdGhlIGZvbGxvd2luZyBhcmd1bWVudDpcclxuICAvLyAgICAgKiBgZXZlbnRgOiBBIHN0YW5kYXJkIERPTSBldmVudCBpbnN0YW5jZS4gQ2FsbCBgc3RvcFByb3BhZ2F0aW9uYCBvclxyXG4gIC8vICAgICAgIGBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb25gIHRvIHRlcm1pbmF0ZSBidWJibGluZyBlYXJseS5cclxuICAvL1xyXG4gIC8vICAgQWRkaXRpb25hbGx5LCBgbGlzdGVuZXJgIG1heSBoYXZlIGFkZGl0aW9uYWwgcHJvcGVydGllcyB3aGljaCBhcmUgcmV0dXJuZWRcclxuICAvLyAgIHRvIHRob3NlIHdobyBxdWVyeSB1c2luZyBgYXRvbS5jb21tYW5kcy5maW5kQ29tbWFuZHNgLCBhcyB3ZWxsIGFzIHNldmVyYWxcclxuICAvLyAgIG1lYW5pbmdmdWwgbWV0YWRhdGEgcHJvcGVydGllczpcclxuICAvLyAgICAgKiBgZGlzcGxheU5hbWVgOiBPdmVycmlkZXMgYW55IGdlbmVyYXRlZCBgZGlzcGxheU5hbWVgIHRoYXQgd291bGRcclxuICAvLyAgICAgICBvdGhlcndpc2UgYmUgZ2VuZXJhdGVkIGZyb20gdGhlIGV2ZW50IG5hbWUuXHJcbiAgLy8gICAgICogYGRlc2NyaXB0aW9uYDogVXNlZCBieSBjb25zdW1lcnMgdG8gZGlzcGxheSBkZXRhaWxlZCBpbmZvcm1hdGlvbiBhYm91dFxyXG4gIC8vICAgICAgIHRoZSBjb21tYW5kLlxyXG4gIC8vICAgICAqIGBoaWRkZW5JbkNvbW1hbmRQYWxldHRlYDogSWYgYHRydWVgLCB0aGlzIGNvbW1hbmQgd2lsbCBub3QgYXBwZWFyIGluXHJcbiAgLy8gICAgICAgdGhlIGJ1bmRsZWQgY29tbWFuZCBwYWxldHRlIGJ5IGRlZmF1bHQsIGJ1dCBjYW4gc3RpbGwgYmUgc2hvd24gd2l0aC5cclxuICAvLyAgICAgICB0aGUgYENvbW1hbmQgUGFsZXR0ZTogU2hvdyBIaWRkZW4gQ29tbWFuZHNgIGNvbW1hbmQuIFRoaXMgaXMgYSBnb29kXHJcbiAgLy8gICAgICAgb3B0aW9uIHdoZW4geW91IG5lZWQgdG8gcmVnaXN0ZXIgbGFyZ2UgbnVtYmVycyBvZiBjb21tYW5kcyB0aGF0IGRvbid0XHJcbiAgLy8gICAgICAgbWFrZSBzZW5zZSB0byBiZSBleGVjdXRlZCBmcm9tIHRoZSBjb21tYW5kIHBhbGV0dGUuIFBsZWFzZSB1c2UgdGhpc1xyXG4gIC8vICAgICAgIG9wdGlvbiBjb25zZXJ2YXRpdmVseSwgYXMgaXQgY291bGQgcmVkdWNlIHRoZSBkaXNjb3ZlcmFiaWxpdHkgb2YgeW91clxyXG4gIC8vICAgICAgIHBhY2thZ2UncyBjb21tYW5kcy5cclxuICAvL1xyXG4gIC8vICMjIEFyZ3VtZW50czogUmVnaXN0ZXJpbmcgTXVsdGlwbGUgQ29tbWFuZHNcclxuICAvL1xyXG4gIC8vICogYHRhcmdldGAgQSB7U3RyaW5nfSBjb250YWluaW5nIGEgQ1NTIHNlbGVjdG9yIG9yIGEgRE9NIGVsZW1lbnQuIElmIHlvdVxyXG4gIC8vICAgcGFzcyBhIHNlbGVjdG9yLCB0aGUgY29tbWFuZHMgd2lsbCBiZSBnbG9iYWxseSBhc3NvY2lhdGVkIHdpdGggYWxsXHJcbiAgLy8gICBtYXRjaGluZyBlbGVtZW50cy4gVGhlIGAsYCBjb21iaW5hdG9yIGlzIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkLlxyXG4gIC8vICAgSWYgeW91IHBhc3MgYSBET00gZWxlbWVudCwgdGhlIGNvbW1hbmQgd2lsbCBiZSBhc3NvY2lhdGVkIHdpdGgganVzdCB0aGF0XHJcbiAgLy8gICBlbGVtZW50LlxyXG4gIC8vICogYGNvbW1hbmRzYCBBbiB7T2JqZWN0fSBtYXBwaW5nIGNvbW1hbmQgbmFtZXMgbGlrZSBgdXNlcjppbnNlcnQtZGF0ZWAgdG9cclxuICAvLyAgIGxpc3RlbmVyIHtGdW5jdGlvbn1zLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byByZW1vdmUgdGhlXHJcbiAgLy8gYWRkZWQgY29tbWFuZCBoYW5kbGVyKHMpLlxyXG4gIGFkZCh0YXJnZXQsIGNvbW1hbmROYW1lLCBsaXN0ZW5lciwgdGhyb3dPbkludmFsaWRTZWxlY3RvciA9IHRydWUpIHtcclxuICAgIGlmICh0eXBlb2YgY29tbWFuZE5hbWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmRzID0gY29tbWFuZE5hbWU7XHJcbiAgICAgIHRocm93T25JbnZhbGlkU2VsZWN0b3IgPSBsaXN0ZW5lcjtcclxuICAgICAgY29uc3QgZGlzcG9zYWJsZSA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XHJcbiAgICAgIGZvciAoY29tbWFuZE5hbWUgaW4gY29tbWFuZHMpIHtcclxuICAgICAgICBsaXN0ZW5lciA9IGNvbW1hbmRzW2NvbW1hbmROYW1lXTtcclxuICAgICAgICBkaXNwb3NhYmxlLmFkZCh0aGlzLmFkZCh0YXJnZXQsIGNvbW1hbmROYW1lLCBsaXN0ZW5lciwgdGhyb3dPbkludmFsaWRTZWxlY3RvcikpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBkaXNwb3NhYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChsaXN0ZW5lciA9PSBudWxsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlZ2lzdGVyIGEgY29tbWFuZCB3aXRoIGEgbnVsbCBsaXN0ZW5lci4nKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB0eXBlIExpc3RlbmVyID0gKChlOiBDdXN0b21FdmVudCkgPT4gdm9pZCkgfCB7XHJcbiAgICAvLyAgIGRpc3BsYXlOYW1lPzogc3RyaW5nLFxyXG4gICAgLy8gICBkZXNjcmlwdGlvbj86IHN0cmluZyxcclxuICAgIC8vICAgZGlkRGlzcGF0Y2goZTogQ3VzdG9tRXZlbnQpOiB2b2lkLFxyXG4gICAgLy8gfVxyXG4gICAgaWYgKCh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpICYmICh0eXBlb2YgbGlzdGVuZXIuZGlkRGlzcGF0Y2ggIT09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignTGlzdGVuZXIgbXVzdCBiZSBhIGNhbGxiYWNrIGZ1bmN0aW9uIG9yIGFuIG9iamVjdCB3aXRoIGEgZGlkRGlzcGF0Y2ggbWV0aG9kLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnc3RyaW5nJykge1xyXG4gICAgICBpZiAodGhyb3dPbkludmFsaWRTZWxlY3Rvcikge1xyXG4gICAgICAgIHZhbGlkYXRlU2VsZWN0b3IodGFyZ2V0KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGhpcy5hZGRTZWxlY3RvckJhc2VkTGlzdGVuZXIodGFyZ2V0LCBjb21tYW5kTmFtZSwgbGlzdGVuZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuYWRkSW5saW5lTGlzdGVuZXIodGFyZ2V0LCBjb21tYW5kTmFtZSwgbGlzdGVuZXIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkU2VsZWN0b3JCYXNlZExpc3RlbmVyKHNlbGVjdG9yLCBjb21tYW5kTmFtZSwgbGlzdGVuZXIpIHtcclxuICAgIGlmICh0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2NvbW1hbmROYW1lXSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdID0gW107XHJcbiAgICB9XHJcbiAgICBjb25zdCBsaXN0ZW5lcnNGb3JDb21tYW5kID0gdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV07XHJcbiAgICBjb25zdCBzZWxlY3Rvckxpc3RlbmVyID0gbmV3IFNlbGVjdG9yQmFzZWRMaXN0ZW5lcihzZWxlY3RvciwgY29tbWFuZE5hbWUsIGxpc3RlbmVyKTtcclxuICAgIGxpc3RlbmVyc0ZvckNvbW1hbmQucHVzaChzZWxlY3Rvckxpc3RlbmVyKTtcclxuXHJcbiAgICB0aGlzLmNvbW1hbmRSZWdpc3RlcmVkKGNvbW1hbmROYW1lKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xyXG4gICAgICBsaXN0ZW5lcnNGb3JDb21tYW5kLnNwbGljZShsaXN0ZW5lcnNGb3JDb21tYW5kLmluZGV4T2Yoc2VsZWN0b3JMaXN0ZW5lciksIDEpO1xyXG4gICAgICBpZiAobGlzdGVuZXJzRm9yQ29tbWFuZC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBkZWxldGUgdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkSW5saW5lTGlzdGVuZXIoZWxlbWVudCwgY29tbWFuZE5hbWUsIGxpc3RlbmVyKSB7XHJcbiAgICBpZiAodGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2NvbW1hbmROYW1lXSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMuaW5saW5lTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV0gPSBuZXcgV2Vha01hcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxpc3RlbmVyc0ZvckNvbW1hbmQgPSB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdO1xyXG4gICAgbGV0IGxpc3RlbmVyc0ZvckVsZW1lbnQgPSBsaXN0ZW5lcnNGb3JDb21tYW5kLmdldChlbGVtZW50KTtcclxuICAgIGlmICghbGlzdGVuZXJzRm9yRWxlbWVudCkge1xyXG4gICAgICBsaXN0ZW5lcnNGb3JFbGVtZW50ID0gW107XHJcbiAgICAgIGxpc3RlbmVyc0ZvckNvbW1hbmQuc2V0KGVsZW1lbnQsIGxpc3RlbmVyc0ZvckVsZW1lbnQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaW5saW5lTGlzdGVuZXIgPSBuZXcgSW5saW5lTGlzdGVuZXIoY29tbWFuZE5hbWUsIGxpc3RlbmVyKTtcclxuICAgIGxpc3RlbmVyc0ZvckVsZW1lbnQucHVzaChpbmxpbmVMaXN0ZW5lcik7XHJcblxyXG4gICAgdGhpcy5jb21tYW5kUmVnaXN0ZXJlZChjb21tYW5kTmFtZSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBEaXNwb3NhYmxlKCgpID0+IHtcclxuICAgICAgbGlzdGVuZXJzRm9yRWxlbWVudC5zcGxpY2UobGlzdGVuZXJzRm9yRWxlbWVudC5pbmRleE9mKGlubGluZUxpc3RlbmVyKSwgMSk7XHJcbiAgICAgIGlmIChsaXN0ZW5lcnNGb3JFbGVtZW50Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGxpc3RlbmVyc0ZvckNvbW1hbmQuZGVsZXRlKGVsZW1lbnQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogRmluZCBhbGwgcmVnaXN0ZXJlZCBjb21tYW5kcyBtYXRjaGluZyBhIHF1ZXJ5LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBBbiB7T2JqZWN0fSBjb250YWluaW5nIG9uZSBvciBtb3JlIG9mIHRoZSBmb2xsb3dpbmcga2V5czpcclxuICAvLyAgICogYHRhcmdldGAgQSBET00gbm9kZSB0aGF0IGlzIHRoZSBoeXBvdGhldGljYWwgdGFyZ2V0IG9mIGEgZ2l2ZW4gY29tbWFuZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYW4ge0FycmF5fSBvZiBgQ29tbWFuZERlc2NyaXB0b3JgIHtPYmplY3R9cyBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcga2V5czpcclxuICAvLyAgKiBgbmFtZWAgVGhlIG5hbWUgb2YgdGhlIGNvbW1hbmQuIEZvciBleGFtcGxlLCBgdXNlcjppbnNlcnQtZGF0ZWAuXHJcbiAgLy8gICogYGRpc3BsYXlOYW1lYCBUaGUgZGlzcGxheSBuYW1lIG9mIHRoZSBjb21tYW5kLiBGb3IgZXhhbXBsZSxcclxuICAvLyAgICBgVXNlcjogSW5zZXJ0IERhdGVgLlxyXG4gIC8vIEFkZGl0aW9uYWwgbWV0YWRhdGEgbWF5IGFsc28gYmUgcHJlc2VudCBpbiB0aGUgcmV0dXJuZWQgZGVzY3JpcHRvcjpcclxuICAvLyAgKiBgZGVzY3JpcHRpb25gIGEge1N0cmluZ30gZGVzY3JpYmluZyB0aGUgZnVuY3Rpb24gb2YgdGhlIGNvbW1hbmQgaW4gbW9yZVxyXG4gIC8vICAgIGRldGFpbCB0aGFuIHRoZSB0aXRsZVxyXG4gIC8vICAqIGB0YWdzYCBhbiB7QXJyYXl9IG9mIHtTdHJpbmd9cyB0aGF0IGRlc2NyaWJlIGtleXdvcmRzIHJlbGF0ZWQgdG8gdGhlXHJcbiAgLy8gICAgY29tbWFuZFxyXG4gIC8vICBBbnkgYWRkaXRpb25hbCBub25zdGFuZGFyZCBtZXRhZGF0YSBwcm92aWRlZCB3aGVuIHRoZSBjb21tYW5kIHdhcyBgYWRkYGVkXHJcbiAgLy8gIG1heSBhbHNvIGJlIHByZXNlbnQgaW4gdGhlIHJldHVybmVkIGRlc2NyaXB0b3IuXHJcbiAgZmluZENvbW1hbmRzKHsgdGFyZ2V0IH0pIHtcclxuICAgIGNvbnN0IGNvbW1hbmROYW1lcyA9IG5ldyBTZXQoKTtcclxuICAgIGNvbnN0IGNvbW1hbmRzID0gW107XHJcbiAgICBsZXQgY3VycmVudFRhcmdldCA9IHRhcmdldDtcclxuICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgIGxldCBsaXN0ZW5lcnM7XHJcbiAgICAgIGZvciAoY29uc3QgbmFtZSBpbiB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWUpIHtcclxuICAgICAgICBsaXN0ZW5lcnMgPSB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWVbbmFtZV07XHJcbiAgICAgICAgaWYgKGxpc3RlbmVycy5oYXMoY3VycmVudFRhcmdldCkgJiYgIWNvbW1hbmROYW1lcy5oYXMobmFtZSkpIHtcclxuICAgICAgICAgIGNvbW1hbmROYW1lcy5hZGQobmFtZSk7XHJcbiAgICAgICAgICBjb25zdCB0YXJnZXRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuZ2V0KGN1cnJlbnRUYXJnZXQpO1xyXG4gICAgICAgICAgY29tbWFuZHMucHVzaChcclxuICAgICAgICAgICAgLi4udGFyZ2V0TGlzdGVuZXJzLm1hcChsaXN0ZW5lciA9PiBsaXN0ZW5lci5kZXNjcmlwdG9yKVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3QgY29tbWFuZE5hbWUgaW4gdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZSkge1xyXG4gICAgICAgIGxpc3RlbmVycyA9IHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWVbY29tbWFuZE5hbWVdO1xyXG4gICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgbGlzdGVuZXJzKSB7XHJcbiAgICAgICAgICBpZiAobGlzdGVuZXIubWF0Y2hlc1RhcmdldChjdXJyZW50VGFyZ2V0KSkge1xyXG4gICAgICAgICAgICBpZiAoIWNvbW1hbmROYW1lcy5oYXMoY29tbWFuZE5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgY29tbWFuZE5hbWVzLmFkZChjb21tYW5kTmFtZSk7XHJcbiAgICAgICAgICAgICAgY29tbWFuZHMucHVzaChsaXN0ZW5lci5kZXNjcmlwdG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGN1cnJlbnRUYXJnZXQgPT09IHdpbmRvdykge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGN1cnJlbnRUYXJnZXQgPSBjdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUgfHwgd2luZG93O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjb21tYW5kcztcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2ltdWxhdGUgdGhlIGRpc3BhdGNoIG9mIGEgY29tbWFuZCBvbiBhIERPTSBub2RlLlxyXG4gIC8vXHJcbiAgLy8gVGhpcyBjYW4gYmUgdXNlZnVsIGZvciB0ZXN0aW5nIHdoZW4geW91IHdhbnQgdG8gc2ltdWxhdGUgdGhlIGludm9jYXRpb24gb2YgYVxyXG4gIC8vIGNvbW1hbmQgb24gYSBkZXRhY2hlZCBET00gbm9kZS4gT3RoZXJ3aXNlLCB0aGUgRE9NIG5vZGUgaW4gcXVlc3Rpb24gbmVlZHMgdG9cclxuICAvLyBiZSBhdHRhY2hlZCB0byB0aGUgZG9jdW1lbnQgc28gdGhlIGV2ZW50IGJ1YmJsZXMgdXAgdG8gdGhlIHJvb3Qgbm9kZSB0byBiZVxyXG4gIC8vIHByb2Nlc3NlZC5cclxuICAvL1xyXG4gIC8vICogYHRhcmdldGAgVGhlIERPTSBub2RlIGF0IHdoaWNoIHRvIHN0YXJ0IGJ1YmJsaW5nIHRoZSBjb21tYW5kIGV2ZW50LlxyXG4gIC8vICogYGNvbW1hbmROYW1lYCB7U3RyaW5nfSBpbmRpY2F0aW5nIHRoZSBuYW1lIG9mIHRoZSBjb21tYW5kIHRvIGRpc3BhdGNoLlxyXG4gIGRpc3BhdGNoKHRhcmdldCwgY29tbWFuZE5hbWUsIGRldGFpbCkge1xyXG4gICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoY29tbWFuZE5hbWUsIHsgYnViYmxlczogdHJ1ZSwgZGV0YWlsIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV2ZW50LCAndGFyZ2V0JywgeyB2YWx1ZTogdGFyZ2V0IH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuaGFuZGxlQ29tbWFuZEV2ZW50KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayBiZWZvcmUgZGlzcGF0Y2hpbmcgYSBjb21tYW5kIGV2ZW50LlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIGJlZm9yZSBkaXNwYXRjaGluZyBlYWNoIGNvbW1hbmRcclxuICAvLyAgICogYGV2ZW50YCBUaGUgRXZlbnQgdGhhdCB3aWxsIGJlIGRpc3BhdGNoZWRcclxuICBvbldpbGxEaXNwYXRjaChjYWxsYmFjaykge1xyXG4gICAgcmV0dXJuIHRoaXMuZW1pdHRlci5vbignd2lsbC1kaXNwYXRjaCcsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayBhZnRlciBkaXNwYXRjaGluZyBhIGNvbW1hbmQgZXZlbnQuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2Age0Z1bmN0aW9ufSB0byBiZSBjYWxsZWQgYWZ0ZXIgZGlzcGF0Y2hpbmcgZWFjaCBjb21tYW5kXHJcbiAgLy8gICAqIGBldmVudGAgVGhlIEV2ZW50IHRoYXQgd2FzIGRpc3BhdGNoZWRcclxuICBvbkRpZERpc3BhdGNoKGNhbGxiYWNrKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCdkaWQtZGlzcGF0Y2gnLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBnZXRTbmFwc2hvdCgpIHtcclxuICAgIGNvbnN0IHNuYXBzaG90ID0ge307XHJcbiAgICBmb3IgKGNvbnN0IGNvbW1hbmROYW1lIGluIHRoaXMuc2VsZWN0b3JCYXNlZExpc3RlbmVyc0J5Q29tbWFuZE5hbWUpIHtcclxuICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV07XHJcbiAgICAgIHNuYXBzaG90W2NvbW1hbmROYW1lXSA9IGxpc3RlbmVycy5zbGljZSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNuYXBzaG90O1xyXG4gIH1cclxuXHJcbiAgcmVzdG9yZVNuYXBzaG90KHNuYXBzaG90KSB7XHJcbiAgICB0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lID0ge307XHJcbiAgICBmb3IgKGNvbnN0IGNvbW1hbmROYW1lIGluIHNuYXBzaG90KSB7XHJcbiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHNuYXBzaG90W2NvbW1hbmROYW1lXTtcclxuICAgICAgdGhpcy5zZWxlY3RvckJhc2VkTGlzdGVuZXJzQnlDb21tYW5kTmFtZVtjb21tYW5kTmFtZV0gPSBsaXN0ZW5lcnMuc2xpY2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZUNvbW1hbmRFdmVudChldmVudCkge1xyXG4gICAgbGV0IHByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlO1xyXG4gICAgbGV0IGltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgbWF0Y2hlZCA9IFtdO1xyXG4gICAgbGV0IGN1cnJlbnRUYXJnZXQgPSBldmVudC50YXJnZXQ7XHJcblxyXG4gICAgY29uc3QgZGlzcGF0Y2hlZEV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGV2ZW50LnR5cGUsIHtcclxuICAgICAgYnViYmxlczogdHJ1ZSxcclxuICAgICAgZGV0YWlsOiBldmVudC5kZXRhaWxcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpc3BhdGNoZWRFdmVudCwgJ2V2ZW50UGhhc2UnLCB7XHJcbiAgICAgIHZhbHVlOiBFdmVudC5CVUJCTElOR19QSEFTRVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlzcGF0Y2hlZEV2ZW50LCAnY3VycmVudFRhcmdldCcsIHtcclxuICAgICAgZ2V0KCkge1xyXG4gICAgICAgIHJldHVybiBjdXJyZW50VGFyZ2V0O1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXNwYXRjaGVkRXZlbnQsICd0YXJnZXQnLCB7IHZhbHVlOiBjdXJyZW50VGFyZ2V0IH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpc3BhdGNoZWRFdmVudCwgJ3ByZXZlbnREZWZhdWx0Jywge1xyXG4gICAgICB2YWx1ZSgpIHtcclxuICAgICAgICByZXR1cm4gZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlzcGF0Y2hlZEV2ZW50LCAnc3RvcFByb3BhZ2F0aW9uJywge1xyXG4gICAgICB2YWx1ZSgpIHtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBwcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXNwYXRjaGVkRXZlbnQsICdzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24nLCB7XHJcbiAgICAgIHZhbHVlKCkge1xyXG4gICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHByb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWU7XHJcbiAgICAgICAgaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlzcGF0Y2hlZEV2ZW50LCAnYWJvcnRLZXlCaW5kaW5nJywge1xyXG4gICAgICB2YWx1ZSgpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGV2ZW50LmFib3J0S2V5QmluZGluZyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgZXZlbnQuYWJvcnRLZXlCaW5kaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhldmVudCkpIHtcclxuICAgICAgaWYgKCEoa2V5IGluIGRpc3BhdGNoZWRFdmVudCkpIHtcclxuICAgICAgICBkaXNwYXRjaGVkRXZlbnRba2V5XSA9IGV2ZW50W2tleV07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmVtaXR0ZXIuZW1pdCgnd2lsbC1kaXNwYXRjaCcsIGRpc3BhdGNoZWRFdmVudCk7XHJcblxyXG4gICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgY29uc3QgY29tbWFuZElubGluZUxpc3RlbmVycyA9XHJcbiAgICAgICAgdGhpcy5pbmxpbmVMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2V2ZW50LnR5cGVdXHJcbiAgICAgICAgPyB0aGlzLmlubGluZUxpc3RlbmVyc0J5Q29tbWFuZE5hbWVbZXZlbnQudHlwZV0uZ2V0KGN1cnJlbnRUYXJnZXQpXHJcbiAgICAgICAgOiBudWxsO1xyXG4gICAgICBsZXQgbGlzdGVuZXJzID0gY29tbWFuZElubGluZUxpc3RlbmVycyB8fCBbXTtcclxuICAgICAgaWYgKGN1cnJlbnRUYXJnZXQud2Via2l0TWF0Y2hlc1NlbGVjdG9yICE9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBzZWxlY3RvckJhc2VkTGlzdGVuZXJzID1cclxuICAgICAgICAgICh0aGlzLnNlbGVjdG9yQmFzZWRMaXN0ZW5lcnNCeUNvbW1hbmROYW1lW2V2ZW50LnR5cGVdIHx8IFtdKVxyXG4gICAgICAgICAgICAuZmlsdGVyKGxpc3RlbmVyID0+IGxpc3RlbmVyLm1hdGNoZXNUYXJnZXQoY3VycmVudFRhcmdldCkpXHJcbiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmNvbXBhcmUoYikpO1xyXG4gICAgICAgIGxpc3RlbmVycyA9IHNlbGVjdG9yQmFzZWRMaXN0ZW5lcnMuY29uY2F0KGxpc3RlbmVycyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENhbGwgaW5saW5lIGxpc3RlbmVycyBmaXJzdCBpbiByZXZlcnNlIHJlZ2lzdHJhdGlvbiBvcmRlcixcclxuICAgICAgLy8gYW5kIHNlbGVjdG9yLWJhc2VkIGxpc3RlbmVycyBieSBzcGVjaWZpY2l0eSBhbmQgcmV2ZXJzZVxyXG4gICAgICAvLyByZWdpc3RyYXRpb24gb3JkZXIuXHJcbiAgICAgIGZvciAobGV0IGkgPSBsaXN0ZW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICBjb25zdCBsaXN0ZW5lciA9IGxpc3RlbmVyc1tpXTtcclxuICAgICAgICBpZiAoaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKSB7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgbWF0Y2hlZC5wdXNoKGxpc3RlbmVyLmRpZERpc3BhdGNoLmNhbGwoY3VycmVudFRhcmdldCwgZGlzcGF0Y2hlZEV2ZW50KSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjdXJyZW50VGFyZ2V0ID09PSB3aW5kb3cpIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBpZiAocHJvcGFnYXRpb25TdG9wcGVkKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgY3VycmVudFRhcmdldCA9IGN1cnJlbnRUYXJnZXQucGFyZW50Tm9kZSB8fCB3aW5kb3c7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1kaXNwYXRjaCcsIGRpc3BhdGNoZWRFdmVudCk7XHJcblxyXG4gICAgcmV0dXJuIChtYXRjaGVkLmxlbmd0aCA+IDAgPyBQcm9taXNlLmFsbChtYXRjaGVkKSA6IG51bGwpO1xyXG4gIH1cclxuXHJcbiAgY29tbWFuZFJlZ2lzdGVyZWQoY29tbWFuZE5hbWUpIHtcclxuICAgIGlmICh0aGlzLnJvb3ROb2RlICE9IG51bGwgJiYgIXRoaXMucmVnaXN0ZXJlZENvbW1hbmRzW2NvbW1hbmROYW1lXSkge1xyXG4gICAgICB0aGlzLnJvb3ROb2RlLmFkZEV2ZW50TGlzdGVuZXIoY29tbWFuZE5hbWUsIHRoaXMuaGFuZGxlQ29tbWFuZEV2ZW50LCB0cnVlKTtcclxuICAgICAgcmV0dXJuICh0aGlzLnJlZ2lzdGVyZWRDb21tYW5kc1tjb21tYW5kTmFtZV0gPSB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIHR5cGUgTGlzdGVuZXIgPSB7XHJcbi8vICAgZGVzY3JpcHRvcjogQ29tbWFuZERlc2NyaXB0b3IsXHJcbi8vICAgZXh0cmFjdERpZERpc3BhdGNoOiAoZTogQ3VzdG9tRXZlbnQpID0+IHZvaWQsXHJcbi8vIH07XHJcbmNsYXNzIFNlbGVjdG9yQmFzZWRMaXN0ZW5lciB7XHJcbiAgcHJpdmF0ZSBzZWxlY3Rvcjogc3RyaW5nO1xyXG4gIHByaXZhdGUgZGlkRGlzcGF0Y2g6IGFueTtcclxuICBwcml2YXRlIGRlc2NyaXB0b3I6IGFueTtcclxuICBwcml2YXRlIHNwZWNpZmljaXR5OiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBzZXF1ZW5jZU51bWJlcjogbnVtYmVyO1xyXG5cclxuICBjb25zdHJ1Y3RvcihzZWxlY3RvciwgY29tbWFuZE5hbWUsIGxpc3RlbmVyKSB7XHJcbiAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7XHJcbiAgICB0aGlzLmRpZERpc3BhdGNoID0gZXh0cmFjdERpZERpc3BhdGNoKGxpc3RlbmVyKTtcclxuICAgIHRoaXMuZGVzY3JpcHRvciA9IGV4dHJhY3REZXNjcmlwdG9yKGNvbW1hbmROYW1lLCBsaXN0ZW5lcik7XHJcbiAgICB0aGlzLnNwZWNpZmljaXR5ID0gY2FsY3VsYXRlU3BlY2lmaWNpdHkodGhpcy5zZWxlY3Rvcik7XHJcbiAgICB0aGlzLnNlcXVlbmNlTnVtYmVyID0gU2VxdWVuY2VDb3VudCsrO1xyXG4gIH1cclxuXHJcbiAgY29tcGFyZShvdGhlcikge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy5zcGVjaWZpY2l0eSAtIG90aGVyLnNwZWNpZmljaXR5IHx8XHJcbiAgICAgIHRoaXMuc2VxdWVuY2VOdW1iZXIgLSBvdGhlci5zZXF1ZW5jZU51bWJlclxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG1hdGNoZXNUYXJnZXQodGFyZ2V0KSB7XHJcbiAgICByZXR1cm4gdGFyZ2V0LndlYmtpdE1hdGNoZXNTZWxlY3RvciAmJiB0YXJnZXQud2Via2l0TWF0Y2hlc1NlbGVjdG9yKHRoaXMuc2VsZWN0b3IpO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgSW5saW5lTGlzdGVuZXIge1xyXG4gIHByaXZhdGUgZGlkRGlzcGF0Y2g6IGFueTtcclxuICBwcml2YXRlIGRlc2NyaXB0b3I6IGFueTtcclxuICBjb25zdHJ1Y3Rvcihjb21tYW5kTmFtZSwgbGlzdGVuZXIpIHtcclxuICAgIHRoaXMuZGlkRGlzcGF0Y2ggPSBleHRyYWN0RGlkRGlzcGF0Y2gobGlzdGVuZXIpO1xyXG4gICAgdGhpcy5kZXNjcmlwdG9yID0gZXh0cmFjdERlc2NyaXB0b3IoY29tbWFuZE5hbWUsIGxpc3RlbmVyKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIHR5cGUgQ29tbWFuZERlc2NyaXB0b3IgPSB7XHJcbi8vICAgbmFtZTogc3RyaW5nLFxyXG4vLyAgIGRpc3BsYXlOYW1lOiBzdHJpbmcsXHJcbi8vIH07XHJcbmZ1bmN0aW9uIGV4dHJhY3REZXNjcmlwdG9yKG5hbWUsIGxpc3RlbmVyKSB7XHJcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXHJcbiAgICBvbWl0KGxpc3RlbmVyLCAnZGlkRGlzcGF0Y2gnKSxcclxuICAgIHtcclxuICAgICAgbmFtZSxcclxuICAgICAgZGlzcGxheU5hbWU6IGxpc3RlbmVyLmRpc3BsYXlOYW1lID8gbGlzdGVuZXIuZGlzcGxheU5hbWUgOiBodW1hbml6ZUV2ZW50TmFtZShuYW1lKVxyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4dHJhY3REaWREaXNwYXRjaChsaXN0ZW5lcikge1xyXG4gIHJldHVybiB0eXBlb2YgbGlzdGVuZXIgPT09ICdmdW5jdGlvbicgPyBsaXN0ZW5lciA6IGxpc3RlbmVyLmRpZERpc3BhdGNoO1xyXG59XHJcblxyXG5mdW5jdGlvbiB2YWxpZGF0ZVNlbGVjdG9yKHNlbGVjdG9yOiBzdHJpbmcpIHtcclxuICBpZiAoIWlzU2VsZWN0b3JWYWxpZChzZWxlY3RvcikpIHtcclxuICAgIGNvbnN0IGVycm9yID0gbmV3IFN5bnRheEVycm9yKHNlbGVjdG9yICsgJyBpcyBub3QgYSB2YWxpZCBzZWxlY3RvcicpO1xyXG4gICAgLy8gZXJyb3IuY29kZSA9ICdFQkFEU0VMRUNUT1InO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpc1NlbGVjdG9yVmFsaWQoc2VsZWN0b3I6IHN0cmluZykge1xyXG4gIGxldCB2YWxpZDogYm9vbGVhbjtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG4gICAgdmFsaWQgPSB0cnVlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICB2YWxpZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHZhbGlkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjYWxjdWxhdGVTcGVjaWZpY2l0eShzZWxlY3Rvcjogc3RyaW5nKSB7XHJcbiAgY29uc3Qgc3BlY2lmaWNpdHkgPSBjYWxjdWxhdGUoc2VsZWN0b3IpO1xyXG4gIHJldHVybiBzcGVjaWZpY2l0eTtcclxufVxyXG5mdW5jdGlvbiBjYWxjdWxhdGUoc2VsZWN0b3I6IHN0cmluZykge1xyXG4gIGNvbnN0IGNvbW1hSW5kZXggPSBzZWxlY3Rvci5pbmRleE9mKCcsJyk7XHJcbiAgaWYgKGNvbW1hSW5kZXggIT09IC0xKSB7XHJcbiAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cmluZygwLCBjb21tYUluZGV4KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHR5cGVzID0ge1xyXG4gICAgYTogMCxcclxuICAgIGI6IDAsXHJcbiAgICBjOiAwXHJcbiAgfTtcclxuXHJcbiAgLy8gVGhlIGZvbGxvd2luZyByZWd1bGFyIGV4cHJlc3Npb25zIGFzc3VtZSB0aGF0IHNlbGVjdG9ycyBtYXRjaGluZyB0aGUgcHJlY2VkaW5nIHJlZ3VsYXIgZXhwcmVzc2lvbnMgaGF2ZSBiZWVuIHJlbW92ZWRcclxuICBjb25zdCBhdHRyaWJ1dGVSZWdleCA9IC8oXFxbW15cXF1dK1xcXSkvZztcclxuICBjb25zdCBpZFJlZ2V4ID0gLygjW15cXHNcXCs+flxcLlxcWzpdKykvZztcclxuICBjb25zdCBjbGFzc1JlZ2V4ID0gLyhcXC5bXlxcc1xcKz5+XFwuXFxbOl0rKS9nO1xyXG4gIGNvbnN0IHBzZXVkb0VsZW1lbnRSZWdleCA9IC8oOjpbXlxcc1xcKz5+XFwuXFxbOl0rfDpmaXJzdC1saW5lfDpmaXJzdC1sZXR0ZXJ8OmJlZm9yZXw6YWZ0ZXIpL2c7XHJcbiAgY29uc3QgcHNldWRvQ2xhc3NSZWdleCA9IC8oOlteXFxzXFwrPn5cXC5cXFs6XSspL2c7XHJcbiAgY29uc3QgZWxlbWVudFJlZ2V4ID0gLyhbXlxcc1xcKz5+XFwuXFxbOl0rKS9nO1xyXG4gIGNvbnN0IG5vdFJlZ2V4ID0gLzpub3RcXCgoW15cXCldKilcXCkvZztcclxuICBjb25zdCBydWxlUmVnZXggPSAvXFx7W15dKi9nbTtcclxuICBjb25zdCBzZXBhcmF0b3JSZWdleCA9IC9bXFwqXFxzXFwrPn5dL2c7XHJcbiAgY29uc3Qgc3RyYXlzUmVnZXggPSAvWyNcXC5dL2c7XHJcblxyXG4gIC8vIFJlbW92ZSB0aGUgbmVnYXRpb24gcHN1ZWRvLWNsYXNzICg6bm90KSBidXQgbGVhdmUgaXRzIGFyZ3VtZW50IGJlY2F1c2Ugc3BlY2lmaWNpdHkgaXMgY2FsY3VsYXRlZCBvbiBpdHMgYXJndW1lbnRcclxuICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2Uobm90UmVnZXgsICcgJDEgJyk7XHJcblxyXG4gIC8vIFJlbW92ZSBhbnl0aGluZyBhZnRlciBhIGxlZnQgYnJhY2UgaW4gY2FzZSBhIHVzZXIgaGFzIHBhc3RlZCBpbiBhIHJ1bGUsIG5vdCBqdXN0IGEgc2VsZWN0b3JcclxuICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2UocnVsZVJlZ2V4LCAnICcpO1xyXG5cclxuICAvLyBBZGQgYXR0cmlidXRlIHNlbGVjdG9ycyB0byBwYXJ0cyBjb2xsZWN0aW9uICh0eXBlIGIpXHJcbiAgc2VsZWN0b3IgPSBmaW5kTWF0Y2goYXR0cmlidXRlUmVnZXgsICdiJywgdHlwZXMsIHNlbGVjdG9yKTtcclxuXHJcbiAgLy8gQWRkIElEIHNlbGVjdG9ycyB0byBwYXJ0cyBjb2xsZWN0aW9uICh0eXBlIGEpXHJcbiAgc2VsZWN0b3IgPSBmaW5kTWF0Y2goaWRSZWdleCwgJ2EnLCB0eXBlcywgc2VsZWN0b3IpO1xyXG5cclxuICAvLyBBZGQgY2xhc3Mgc2VsZWN0b3JzIHRvIHBhcnRzIGNvbGxlY3Rpb24gKHR5cGUgYilcclxuICBzZWxlY3RvciA9IGZpbmRNYXRjaChjbGFzc1JlZ2V4LCAnYicsIHR5cGVzLCBzZWxlY3Rvcik7XHJcblxyXG4gIC8vIEFkZCBwc2V1ZG8tZWxlbWVudCBzZWxlY3RvcnMgdG8gcGFydHMgY29sbGVjdGlvbiAodHlwZSBjKVxyXG4gIHNlbGVjdG9yID0gZmluZE1hdGNoKHBzZXVkb0VsZW1lbnRSZWdleCwgJ2MnLCB0eXBlcywgc2VsZWN0b3IpO1xyXG5cclxuICAvLyBBZGQgcHNldWRvLWNsYXNzIHNlbGVjdG9ycyB0byBwYXJ0cyBjb2xsZWN0aW9uICh0eXBlIGIpXHJcbiAgc2VsZWN0b3IgPSBmaW5kTWF0Y2gocHNldWRvQ2xhc3NSZWdleCwgJ2InLCB0eXBlcywgc2VsZWN0b3IpO1xyXG5cclxuICAvLyBSZW1vdmUgdW5pdmVyc2FsIHNlbGVjdG9yIGFuZCBzZXBhcmF0b3IgY2hhcmFjdGVyc1xyXG4gIHNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZShzZXBhcmF0b3JSZWdleCwgJyAnKTtcclxuXHJcbiAgLy8gUmVtb3ZlIGFueSBzdHJheSBkb3RzIG9yIGhhc2hlcyB3aGljaCBhcmVuJ3QgYXR0YWNoZWQgdG8gd29yZHNcclxuICAvLyBUaGVzZSBtYXkgYmUgcHJlc2VudCBpZiB0aGUgdXNlciBpcyBsaXZlLWVkaXRpbmcgdGhpcyBzZWxlY3RvclxyXG4gIHNlbGVjdG9yID0gc2VsZWN0b3IucmVwbGFjZShzdHJheXNSZWdleCwgJyAnKTtcclxuXHJcbiAgLy8gVGhlIG9ubHkgdGhpbmdzIGxlZnQgc2hvdWxkIGJlIGVsZW1lbnQgc2VsZWN0b3JzICh0eXBlIGMpXHJcbiAgZmluZE1hdGNoKGVsZW1lbnRSZWdleCwgJ2MnLCB0eXBlcywgc2VsZWN0b3IpO1xyXG5cclxuICByZXR1cm4gKHR5cGVzLmEgKiAxMDApICsgKHR5cGVzLmIgKiAxMCkgKyAodHlwZXMuYyAqIDEpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaW5kTWF0Y2gocmVnZXgsIHR5cGUsIHR5cGVzLCBzZWxlY3Rvcikge1xyXG4gIGNvbnN0IG1hdGNoZXMgPSBzZWxlY3Rvci5tYXRjaChyZWdleCk7XHJcbiAgaWYgKG1hdGNoZXMpIHtcclxuICAgIGZvciAoY29uc3QgbWF0Y2ggb2YgbWF0Y2hlcykge1xyXG4gICAgICB0eXBlc1t0eXBlXSsrO1xyXG4gICAgICAvLyBSZXBsYWNlIHRoaXMgc2ltcGxlIHNlbGVjdG9yIHdpdGggd2hpdGVzcGFjZSBzbyBpdCB3b24ndCBiZSBjb3VudGVkIGluIGZ1cnRoZXIgc2ltcGxlIHNlbGVjdG9yc1xyXG4gICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2UobWF0Y2gsICcgJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc2VsZWN0b3I7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9taXQob2JqOiBhbnksIC4uLnByb3BzOiBzdHJpbmdbXSkge1xyXG4gIC8vIGNvbnN0IGl0ZXJhdGVlID0gKHZhbHVlLCBrZXkpID0+ICFwcm9wcy5maW5kKGtleSk7XHJcblxyXG4gIGNvbnN0IHJlc3VsdCA9IHt9O1xyXG4gIGlmICghb2JqKSB7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICBPYmplY3Qua2V5cyhvYmopLmZvckVhY2goa2V5ID0+IHtcclxuICAgIGlmICghcHJvcHMuZmluZChwcm9wID0+IHByb3AgPT09IGtleSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgcmVzdWx0W2tleV0gPSBvYmpba2V5XTtcclxuICB9KTtcclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBodW1hbml6ZUV2ZW50TmFtZShldmVudE5hbWUsIGV2ZW50RG9jID0gbnVsbCkge1xyXG4gIGNvbnN0IHJlZiA9IGV2ZW50TmFtZS5zcGxpdCgnOicpO1xyXG4gIGNvbnN0IFtuYW1lc3BhY2UsIGV2ZW50XSA9IHJlZjtcclxuICBpZiAoZXZlbnQgPT0gbnVsbCkge1xyXG4gICAgcmV0dXJuIHVuZGFzaChuYW1lc3BhY2UpO1xyXG4gIH1cclxuICBjb25zdCBuYW1lc3BhY2VEb2MgPSB1bmRhc2gobmFtZXNwYWNlKTtcclxuICBpZiAoZXZlbnREb2MgPT0gbnVsbCkge1xyXG4gICAgZXZlbnREb2MgPSB1bmRhc2goZXZlbnQpO1xyXG4gIH1cclxuICByZXR1cm4gJycgKyBuYW1lc3BhY2VEb2MgKyAnOiAnICsgZXZlbnREb2M7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVuZGFzaChzdHIpIHtcclxuICBpZiAoc3RyKSB7XHJcbiAgICByZXR1cm4gc3RyLnNwbGl0KCctJykuam9pbignICcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG59XHJcbiJdfQ==
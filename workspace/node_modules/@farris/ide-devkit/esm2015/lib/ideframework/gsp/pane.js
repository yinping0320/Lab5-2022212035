/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { PaneAxis } from './pane-axis';
import { Emitter } from './event-kit';
// const Grim = require('grim')
// const {CompositeDisposable, Emitter} = require('event-kit')
// const PaneAxis = require('./pane-axis')
// const TextEditor = require('./text-editor')
// const PaneElement = require('./pane-element')
/** @type {?} */
let nextInstanceId = 1;
class SaveCancelledError extends Error {
}
// Extended: A container for presenting content in the center of the workspace.
// Panes can contain multiple items, one of which is *active* at a given time.
// The view corresponding to the active item is displayed in the interface. In
// the default configuration, tabs are also displayed for each item.
//
// Each pane may also contain one *pending* item. When a pending item is added
// to a pane, it will replace the currently pending item, if any, instead of
// simply being added. In the default configuration, the text in the tab for
// pending items is shown in italics.
export class Pane {
    /**
     * @param {?} params
     */
    constructor(params) {
        this.alive = true;
        this.subscriptionsPerItem = new WeakMap();
        this.items = [];
        this.itemStack = [];
        this.container = null;
        this.setPendingItem = this.setPendingItem.bind(this);
        this.getPendingItem = this.getPendingItem.bind(this);
        this.clearPendingItem = this.clearPendingItem.bind(this);
        this.onItemDidTerminatePendingState = this.onItemDidTerminatePendingState.bind(this);
        this.saveItem = this.saveItem.bind(this);
        this.saveItemAs = this.saveItemAs.bind(this);
        this.id = params.id;
        if (this.id != null) {
            nextInstanceId = Math.max(nextInstanceId, this.id + 1);
        }
        else {
            this.id = nextInstanceId++;
        }
        this.activeItem = params.activeItem;
        this.focused = params.focused != null ? params.focused : false;
        this.applicationDelegate = params.applicationDelegate;
        this.notificationManager = params.notificationManager;
        this.config = params.config;
        this.deserializerManager = params.deserializerManager;
        this.viewRegistry = params.viewRegistry;
        this.emitter = new Emitter();
        this.alive = true;
        this.subscriptionsPerItem = new WeakMap();
        this.items = [];
        this.itemStack = [];
        this.container = null;
        this.addItems((params.items || []).filter(item => item));
        if (!this.getActiveItem()) {
            this.setActiveItem(this.items[0]);
        }
        this.addItemsToStack(params.itemStackIndices || []);
        this.setFlexScale(params.flexScale || 1);
    }
    /**
     * @param {?} state
     * @param {?} __1
     * @return {?}
     */
    static deserialize(state, { deserializers, applicationDelegate, config, notifications, views }) {
        const { activeItemIndex } = state;
        /** @type {?} */
        const activeItemURI = state.activeItemURI || state.activeItemUri;
        /** @type {?} */
        const items = [];
        for (const itemState of state.items) {
            /** @type {?} */
            const item = deserializers.deserialize(itemState);
            if (item) {
                items.push(item);
            }
        }
        state.items = items;
        state.activeItem = items[activeItemIndex];
        if (!state.activeItem && activeItemURI) {
            state.activeItem = state.items.find((item) => typeof item.getURI === 'function' && item.getURI() === activeItemURI);
        }
        return new Pane(Object.assign(state, {
            deserializerManager: deserializers,
            notificationManager: notifications,
            viewRegistry: views,
            config,
            applicationDelegate
        }));
    }
    /**
     * @return {?}
     */
    inspect() {
        return `Pane ${this.id}`;
    }
    /**
     * @return {?}
     */
    getElement() {
    }
    /**
     * @return {?}
     */
    serialize() {
        /** @type {?} */
        const itemsToBeSerialized = this.items.filter(item => item && typeof item.serialize === 'function');
        /** @type {?} */
        const itemStackIndices = [];
        for (const item of this.itemStack) {
            if (typeof item.serialize === 'function') {
                itemStackIndices.push(itemsToBeSerialized.indexOf(item));
            }
        }
        /** @type {?} */
        const activeItemIndex = itemsToBeSerialized.indexOf(this.activeItem);
        return {
            deserializer: 'Pane',
            id: this.id,
            items: itemsToBeSerialized.map(item => item.serialize()),
            itemStackIndices,
            activeItemIndex,
            focused: this.focused,
            flexScale: this.flexScale
        };
    }
    /**
     * @return {?}
     */
    getParent() { return this.parent; }
    /**
     * @param {?} parent
     * @return {?}
     */
    setParent(parent) {
        this.parent = parent;
    }
    /**
     * @return {?}
     */
    getContainer() { return this.container; }
    /**
     * @param {?} container
     * @return {?}
     */
    setContainer(container) {
        if (container && container !== this.container) {
            this.container = container;
            container.didAddPane({ pane: this });
        }
    }
    // Private: Determine whether the given item is allowed to exist in this pane.
    //
    // * `item` the Item
    //
    // Returns a {Boolean}.
    /**
     * @param {?} item
     * @return {?}
     */
    isItemAllowed(item) {
        if (typeof item.getAllowedLocations !== 'function') {
            return true;
        }
        else {
            return item.getAllowedLocations().includes(this.getContainer().getLocation());
        }
    }
    /**
     * @param {?} flexScale
     * @return {?}
     */
    setFlexScale(flexScale) {
        this.flexScale = flexScale;
        return this.flexScale;
    }
    /**
     * @return {?}
     */
    getFlexScale() { return this.flexScale; }
    /**
     * @return {?}
     */
    increaseSize() { this.setFlexScale(this.getFlexScale() * 1.1); }
    /**
     * @return {?}
     */
    decreaseSize() { this.setFlexScale(this.getFlexScale() / 1.1); }
    /*
      Section: Event Subscription
      */
    // Public: Invoke the given callback when the pane resizes
    //
    // The callback will be invoked when pane's flexScale property changes.
    // Use {::getFlexScale} to get the current value.
    //
    // * `callback` {Function} to be called when the pane is resized
    //   * `flexScale` {Number} representing the panes `flex-grow`; ability for a
    //     flex item to grow if necessary.
    //
    // Returns a {Disposable} on which '.dispose()' can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidChangeFlexScale(callback) {
    }
    // Public: Invoke the given callback with the current and future values of
    // {::getFlexScale}.
    //
    // * `callback` {Function} to be called with the current and future values of
    //   the {::getFlexScale} property.
    //   * `flexScale` {Number} representing the panes `flex-grow`; ability for a
    //     flex item to grow if necessary.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    observeFlexScale(callback) {
        callback(this.flexScale);
        return this.onDidChangeFlexScale(callback);
    }
    // Public: Invoke the given callback when the pane is activated.
    //
    // The given callback will be invoked whenever {::activate} is called on the
    // pane, even if it is already active at the time.
    //
    // * `callback` {Function} to be called when the pane is activated.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidActivate(callback) {
    }
    // Public: Invoke the given callback before the pane is destroyed.
    //
    // * `callback` {Function} to be called before the pane is destroyed.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onWillDestroy(callback) {
    }
    // Public: Invoke the given callback when the pane is destroyed.
    //
    // * `callback` {Function} to be called when the pane is destroyed.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidDestroy(callback) {
    }
    // Public: Invoke the given callback when the value of the {::isActive}
    // property changes.
    //
    // * `callback` {Function} to be called when the value of the {::isActive}
    //   property changes.
    //   * `active` {Boolean} indicating whether the pane is active.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidChangeActive(callback) {
        return this.container.onDidChangeActivePane(activePane => {
            /** @type {?} */
            const isActive = this === activePane;
            callback(isActive);
        });
    }
    // Public: Invoke the given callback with the current and future values of the
    // {::isActive} property.
    //
    // * `callback` {Function} to be called with the current and future values of
    //   the {::isActive} property.
    //   * `active` {Boolean} indicating whether the pane is active.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    observeActive(callback) {
        callback(this.isActive());
        return this.onDidChangeActive(callback);
    }
    // Public: Invoke the given callback when an item is added to the pane.
    //
    // * `callback` {Function} to be called with when items are added.
    //   * `event` {Object} with the following keys:
    //     * `item` The added pane item.
    //     * `index` {Number} indicating where the item is located.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidAddItem(callback) {
        return this.emitter.on('did-add-item', callback);
    }
    // Public: Invoke the given callback when an item is removed from the pane.
    //
    // * `callback` {Function} to be called with when items are removed.
    //   * `event` {Object} with the following keys:
    //     * `item` The removed pane item.
    //     * `index` {Number} indicating where the item was located.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidRemoveItem(callback) {
        return this.emitter.on('did-remove-item', callback);
    }
    // Public: Invoke the given callback before an item is removed from the pane.
    //
    // * `callback` {Function} to be called with when items are removed.
    //   * `event` {Object} with the following keys:
    //     * `item` The pane item to be removed.
    //     * `index` {Number} indicating where the item is located.
    /**
     * @param {?} callback
     * @return {?}
     */
    onWillRemoveItem(callback) {
    }
    // Public: Invoke the given callback when an item is moved within the pane.
    //
    // * `callback` {Function} to be called with when items are moved.
    //   * `event` {Object} with the following keys:
    //     * `item` The removed pane item.
    //     * `oldIndex` {Number} indicating where the item was located.
    //     * `newIndex` {Number} indicating where the item is now located.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidMoveItem(callback) {
    }
    // Public: Invoke the given callback with all current and future items.
    //
    // * `callback` {Function} to be called with current and future items.
    //   * `item` An item that is present in {::getItems} at the time of
    //     subscription or that is added at some later time.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    observeItems(callback) {
        for (const item of this.getItems()) {
            callback(item);
        }
        return this.onDidAddItem(({ item }) => callback(item));
    }
    // 公有方法： 当{::getActiveItem}值变换前调用。
    /**
     * @param {?} callback
     * @return {?}
     */
    onDoingChangeActiveItem(callback) {
        return this.emitter.on('doing-change-active-item', callback);
    }
    // Public: Invoke the given callback when the value of {::getActiveItem}
    // changes.
    //
    // * `callback` {Function} to be called with when the active item changes.
    //   * `activeItem` The current active item.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDidChangeActiveItem(callback) {
        return this.emitter.on('did-change-active-item', callback);
    }
    // Public: Invoke the given callback when {::activateNextRecentlyUsedItem}
    // has been called, either initiating or continuing a forward MRU traversal of
    // pane items.
    //
    // * `callback` {Function} to be called with when the active item changes.
    //   * `nextRecentlyUsedItem` The next MRU item, now being set active
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onChooseNextMRUItem(callback) {
    }
    // Public: Invoke the given callback when {::activatePreviousRecentlyUsedItem}
    // has been called, either initiating or continuing a reverse MRU traversal of
    // pane items.
    //
    // * `callback` {Function} to be called with when the active item changes.
    //   * `previousRecentlyUsedItem` The previous MRU item, now being set active
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onChooseLastMRUItem(callback) {
    }
    // Public: Invoke the given callback when {::moveActiveItemToTopOfStack}
    // has been called, terminating an MRU traversal of pane items and moving the
    // current active item to the top of the stack. Typically bound to a modifier
    // (e.g. CTRL) key up event.
    //
    // * `callback` {Function} to be called with when the MRU traversal is done.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onDoneChoosingMRUItem(callback) {
    }
    // Public: Invoke the given callback with the current and future values of
    // {::getActiveItem}.
    //
    // * `callback` {Function} to be called with the current and future active
    //   items.
    //   * `activeItem` The current active item.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    observeActiveItem(callback) {
        callback(this.getActiveItem());
        return this.onDidChangeActiveItem(callback);
    }
    // Public: Invoke the given callback before items are destroyed.
    //
    // * `callback` {Function} to be called before items are destroyed.
    //   * `event` {Object} with the following keys:
    //     * `item` The item that will be destroyed.
    //     * `index` The location of the item.
    //
    // Returns a {Disposable} on which `.dispose()` can be called to
    // unsubscribe.
    /**
     * @param {?} callback
     * @return {?}
     */
    onWillDestroyItem(callback) {
    }
    // Called by the view layer to indicate that the pane has gained focus.
    /**
     * @return {?}
     */
    focus() {
        this.focused = true;
        return this.activate();
    }
    // Called by the view layer to indicate that the pane has lost focus.
    /**
     * @return {?}
     */
    blur() {
        this.focused = false;
        return true; // if this is called from an event handler, don't cancel it
    }
    /**
     * @return {?}
     */
    isFocused() { return this.focused; }
    /**
     * @return {?}
     */
    getPanes() { return [this]; }
    /**
     * @param {?} item
     * @return {?}
     */
    unsubscribeFromItem(item) {
        /** @type {?} */
        const subscription = this.subscriptionsPerItem.get(item);
        if (subscription) {
            subscription.dispose();
            this.subscriptionsPerItem.delete(item);
        }
    }
    /*
      Section: Items
      */
    // Public: Get the items in this pane.
    //
    // Returns an {Array} of items.
    /**
     * @return {?}
     */
    getItems() {
        return this.items.slice();
    }
    // Public: Get the active pane item in this pane.
    //
    // Returns a pane item.
    /**
     * @return {?}
     */
    getActiveItem() { return this.activeItem; }
    /**
     * @param {?=} activeItem
     * @param {?=} options
     * @return {?}
     */
    setActiveItem(activeItem, options) {
        /** @type {?} */
        const modifyStack = options && options.modifyStack;
        if (activeItem !== this.activeItem) {
            if (modifyStack !== false) {
                this.addItemToStack(activeItem);
            }
            this.emitter.emit('doing-change-active-item', this.activeItem);
            this.activeItem = activeItem;
            this.emitter.emit('did-change-active-item', this.activeItem);
            if (this.container) {
                this.container.didChangeActiveItemOnPane(this, this.activeItem);
            }
        }
        return this.activeItem;
    }
    // Build the itemStack after deserializing
    /**
     * @param {?} itemStackIndices
     * @return {?}
     */
    addItemsToStack(itemStackIndices) {
        if (this.items.length > 0) {
            if (itemStackIndices.length !== this.items.length || itemStackIndices.includes(-1)) {
                itemStackIndices = this.items.map((item, i) => i);
            }
            for (const itemIndex of itemStackIndices) {
                this.addItemToStack(this.items[itemIndex]);
            }
        }
    }
    // Add item (or move item) to the end of the itemStack
    /**
     * @param {?} newItem
     * @return {?}
     */
    addItemToStack(newItem) {
        if (newItem == null) {
            return;
        }
        /** @type {?} */
        const index = this.itemStack.indexOf(newItem);
        if (index !== -1) {
            this.itemStack.splice(index, 1);
        }
        return this.itemStack.push(newItem);
    }
    // Public: Return the item at the given index.
    //
    // * `index` {Number}
    //
    // Returns an item or `null` if no item exists at the given index.
    /**
     * @param {?} index
     * @return {?}
     */
    itemAtIndex(index) {
        return this.items[index];
    }
    // Makes the next item in the itemStack active.
    /**
     * @return {?}
     */
    activateNextRecentlyUsedItem() {
        if (this.items.length > 1) {
            if (this.itemStackIndex == null) {
                this.itemStackIndex = this.itemStack.length - 1;
            }
            if (this.itemStackIndex === 0) {
                this.itemStackIndex = this.itemStack.length;
            }
            this.itemStackIndex--;
            /** @type {?} */
            const nextRecentlyUsedItem = this.itemStack[this.itemStackIndex];
            this.setActiveItem(nextRecentlyUsedItem, { modifyStack: false });
        }
    }
    // Makes the previous item in the itemStack active.
    /**
     * @return {?}
     */
    activatePreviousRecentlyUsedItem() {
        if (this.items.length > 1) {
            if (this.itemStackIndex + 1 === this.itemStack.length || this.itemStackIndex == null) {
                this.itemStackIndex = -1;
            }
            this.itemStackIndex++;
            /** @type {?} */
            const previousRecentlyUsedItem = this.itemStack[this.itemStackIndex];
            this.setActiveItem(previousRecentlyUsedItem, { modifyStack: false });
        }
    }
    // Moves the active item to the end of the itemStack once the ctrl key is lifted
    /**
     * @return {?}
     */
    moveActiveItemToTopOfStack() {
        delete this.itemStackIndex;
        this.addItemToStack(this.activeItem);
    }
    // Public: Makes the next item active.
    /**
     * @return {?}
     */
    activateNextItem() {
        /** @type {?} */
        const index = this.getActiveItemIndex();
        if (index < (this.items.length - 1)) {
            this.activateItemAtIndex(index + 1);
        }
        else {
            this.activateItemAtIndex(0);
        }
    }
    // Public: Makes the previous item active.
    /**
     * @return {?}
     */
    activatePreviousItem() {
        /** @type {?} */
        const index = this.getActiveItemIndex();
        if (index > 0) {
            this.activateItemAtIndex(index - 1);
        }
        else {
            this.activateItemAtIndex(this.items.length - 1);
        }
    }
    /**
     * @return {?}
     */
    activateLastItem() {
        this.activateItemAtIndex(this.items.length - 1);
    }
    // Public: Move the active tab to the right.
    /**
     * @return {?}
     */
    moveItemRight() {
        /** @type {?} */
        const index = this.getActiveItemIndex();
        /** @type {?} */
        const rightItemIndex = index + 1;
        if (rightItemIndex <= this.items.length - 1) {
            this.moveItem(this.getActiveItem(), rightItemIndex);
        }
    }
    // Public: Move the active tab to the left
    /**
     * @return {?}
     */
    moveItemLeft() {
        /** @type {?} */
        const index = this.getActiveItemIndex();
        /** @type {?} */
        const leftItemIndex = index - 1;
        if (leftItemIndex >= 0) {
            return this.moveItem(this.getActiveItem(), leftItemIndex);
        }
    }
    // Public: Get the index of the active item.
    //
    // Returns a {Number}.
    /**
     * @return {?}
     */
    getActiveItemIndex() {
        return this.items.indexOf(this.activeItem);
    }
    // Public: Activate the item at the given index.
    //
    // * `index` {Number}
    /**
     * @param {?} index
     * @return {?}
     */
    activateItemAtIndex(index) {
        /** @type {?} */
        const item = this.itemAtIndex(index) || this.getActiveItem();
        return this.setActiveItem(item);
    }
    // Public: Make the given item *active*, causing it to be displayed by
    // the pane's view.
    //
    // * `item` The item to activate
    // * `options` (optional) {Object}
    //   * `pending` (optional) {Boolean} indicating that the item should be added
    //     in a pending state if it does not yet exist in the pane. Existing pending
    //     items in a pane are replaced with new pending items when they are opened.
    /**
     * @param {?} item
     * @param {?=} options
     * @return {?}
     */
    activateItem(item, options = {}) {
        if (item) {
            /** @type {?} */
            const index = (this.getPendingItem() === this.activeItem)
                ? this.getActiveItemIndex()
                : this.getActiveItemIndex() + 1;
            this.addItem(item, Object.assign({}, options, { index }));
            this.setActiveItem(item);
        }
    }
    // Public: Add the given item to the pane.
    //
    // * `item` The item to add. It can be a model with an associated view or a
    //   view.
    // * `options` (optional) {Object}
    //   * `index` (optional) {Number} indicating the index at which to add the item.
    //     If omitted, the item is added after the current active item.
    //   * `pending` (optional) {Boolean} indicating that the item should be
    //     added in a pending state. Existing pending items in a pane are replaced with
    //     new pending items when they are opened.
    //
    // Returns the added item.
    /**
     * @param {?} item
     * @param {?=} options
     * @return {?}
     */
    addItem(item, options = {}) {
        // Backward compat with old API:
        //   addItem(item, index=@getActiveItemIndex() + 1)
        if (typeof options === 'number') {
            options = { index: options };
        }
        /** @type {?} */
        const index = options.index != null ? options.index : this.getActiveItemIndex() + 1;
        /** @type {?} */
        const moved = options.moved != null ? options.moved : false;
        /** @type {?} */
        const pending = options.pending != null ? options.pending : false;
        if (!item || typeof item !== 'object') {
            throw new Error(`Pane items must be objects. Attempted to add item ${item}.`);
        }
        if (typeof item.isDestroyed === 'function' && item.isDestroyed()) {
            throw new Error(`Adding a pane item with URI
      '${typeof item.getURI === 'function' && item.getURI()}' that has already been destroyed`);
        }
        if (this.items.find(it => it === item)) {
            return;
        }
        if (typeof item.onDidDestroy === 'function') {
        }
        this.items.splice(index, 0, item);
        /** @type {?} */
        const lastPendingItem = this.getPendingItem();
        /** @type {?} */
        const replacingPendingItem = lastPendingItem != null && !moved;
        if (replacingPendingItem) {
            this.pendingItem = null;
        }
        if (pending) {
            this.setPendingItem(item);
        }
        this.emitter.emit('did-add-item', { item, index, moved });
        if (!moved) {
            if (this.container) {
                this.container.didAddPaneItem(item, this, index);
            }
        }
        if (replacingPendingItem) {
            this.destroyItem(lastPendingItem);
        }
        if (!this.getActiveItem()) {
            this.setActiveItem(item);
        }
        return item;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    setPendingItem(item) {
        if (this.pendingItem !== item) {
            /** @type {?} */
            const mostRecentPendingItem = this.pendingItem;
            this.pendingItem = item;
        }
    }
    /**
     * @return {?}
     */
    getPendingItem() {
        return this.pendingItem || null;
    }
    /**
     * @return {?}
     */
    clearPendingItem() {
        this.setPendingItem(null);
    }
    /**
     * @param {?} callback
     * @return {?}
     */
    onItemDidTerminatePendingState(callback) {
    }
    // Public: Add the given items to the pane.
    //
    // * `items` An {Array} of items to add. Items can be views or models with
    //   associated views. Any objects that are already present in the pane's
    //   current items will not be added again.
    // * `index` (optional) {Number} index at which to add the items. If omitted,
    //   the item is #   added after the current active item.
    //
    // Returns an {Array} of added items.
    /**
     * @param {?} items
     * @param {?=} index
     * @return {?}
     */
    addItems(items, index = this.getActiveItemIndex() + 1) {
        items = items.filter(item => !this.items.find(it => it === item));
        for (let i = 0; i < items.length; i++) {
            /** @type {?} */
            const item = items[i];
            this.addItem(item, { index: index + i });
        }
        return items;
    }
    /**
     * @param {?} item
     * @param {?=} moved
     * @return {?}
     */
    removeItem(item, moved = false) {
        /** @type {?} */
        const index = this.items.indexOf(item);
        if (index === -1) {
            return;
        }
        if (this.getPendingItem() === item) {
            this.pendingItem = null;
        }
        this.removeItemFromStack(item);
        // this.emitter.emit('will-remove-item', {item, index, destroyed: !moved, moved});
        this.unsubscribeFromItem(item);
        if (item === this.activeItem) {
            if (this.items.length === 1) {
                this.setActiveItem(undefined);
            }
            else if (index === 0) {
                this.activateNextItem();
            }
            else {
                this.activatePreviousItem();
            }
        }
        this.items.splice(index, 1);
        this.emitter.emit('did-remove-item', { item, index, destroyed: !moved, moved });
        if (!moved && this.container) {
            this.container.didDestroyPaneItem({ item, index, pane: this });
        }
        if (this.items.length === 0 && this.config && this.config.get && this.config.get('core.destroyEmptyPanes')) {
            this.destroy();
        }
    }
    // Remove the given item from the itemStack.
    //
    // * `item` The item to remove.
    // * `index` {Number} indicating the index to which to remove the item from the itemStack.
    /**
     * @param {?} item
     * @return {?}
     */
    removeItemFromStack(item) {
        /** @type {?} */
        const index = this.itemStack.indexOf(item);
        if (index !== -1) {
            this.itemStack.splice(index, 1);
        }
    }
    // Public: Move the given item to the given index.
    //
    // * `item` The item to move.
    // * `index` {Number} indicating the index to which to move the item.
    /**
     * @param {?} item
     * @param {?} newIndex
     * @return {?}
     */
    moveItem(item, newIndex) {
        /** @type {?} */
        const oldIndex = this.items.indexOf(item);
        this.items.splice(oldIndex, 1);
        this.items.splice(newIndex, 0, item);
    }
    // Public: Move the given item to the given index on another pane.
    //
    // * `item` The item to move.
    // * `pane` {Pane} to which to move the item.
    // * `index` {Number} indicating the index to which to move the item in the
    //   given pane.
    /**
     * @param {?=} item
     * @param {?=} pane
     * @param {?=} index
     * @return {?}
     */
    moveItemToPane(item, pane, index) {
        this.removeItem(item, true);
        return pane.addItem(item, { index, moved: true });
    }
    // Public: Destroy the active item and activate the next item.
    //
    // Returns a {Promise} that resolves when the item is destroyed.
    /**
     * @return {?}
     */
    destroyActiveItem() {
        return this.destroyItem(this.activeItem);
    }
    // Public: Destroy the given item.
    //
    // If the item is active, the next item will be activated. If the item is the
    // last item, the pane will be destroyed if the `core.destroyEmptyPanes` config
    // setting is `true`.
    //
    // * `item` Item to destroy
    // * `force` (optional) {Boolean} Destroy the item without prompting to save
    //    it, even if the item's `isPermanentDockItem` method returns true.
    //
    // Returns a {Promise} that resolves with a {Boolean} indicating whether or not
    // the item was destroyed.
    /**
     * @param {?=} item
     * @param {?=} force
     * @return {?}
     */
    destroyItem(item, force) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const index = this.items.indexOf(item);
            if (index === -1) {
                return false;
            }
            if (!force &&
                typeof item.isPermanentDockItem === 'function' && item.isPermanentDockItem() &&
                (!this.container || this.container.getLocation() !== 'center')) {
                return false;
            }
            // In the case where there are no `onWillDestroyPaneItem` listeners, preserve the old behavior
            // where `Pane.destroyItem` and callers such as `Pane.close` take effect synchronously.
            this.removeItem(item, false);
            if (typeof item.destroy === 'function') {
                item.destroy();
            }
            return true;
        });
    }
    // Public: Destroy all items.
    /**
     * @return {?}
     */
    destroyItems() {
        return Promise.all(this.getItems().map(item => this.destroyItem(item)));
    }
    // Public: Destroy all items except for the active item.
    /**
     * @return {?}
     */
    destroyInactiveItems() {
        return Promise.all(this.getItems()
            .filter(item => item !== this.activeItem)
            .map(item => this.destroyItem(item)));
    }
    /**
     * @param {?} item
     * @param {?=} options
     * @return {?}
     */
    promptToSaveItem(item, options = {}) {
        if (typeof item.shouldPromptToSave !== 'function' || !item.shouldPromptToSave(options)) {
            return Promise.resolve(true);
        }
        /** @type {?} */
        let uri;
        if (typeof item.getURI === 'function') {
            uri = item.getURI();
        }
        else if (typeof item.getUri === 'function') {
            uri = item.getUri();
        }
        else {
            return Promise.resolve(true);
        }
        /** @type {?} */
        const title = (typeof item.getTitle === 'function' && item.getTitle()) || uri;
        /** @type {?} */
        const saveDialog = (saveButtonText, saveFn, message) => {
            /** @type {?} */
            const chosen = this.applicationDelegate.confirm({
                message,
                detailedMessage: 'Your changes will be lost if you close this item without saving.',
                buttons: [saveButtonText, 'Cancel', '&Don\'t Save']
            });
            switch (chosen) {
                case 0:
                    return new Promise(resolve => {
                        return saveFn(item, error => {
                            if (error instanceof SaveCancelledError) {
                                resolve(false);
                            }
                            else if (error) {
                                saveDialog('Save as', this.saveItemAs, `'${title}' could not be saved.\nError: ${this.getMessageForErrorCode(error.code)}`).then(resolve);
                            }
                            else {
                                resolve(true);
                            }
                        });
                    });
                case 1:
                    return Promise.resolve(false);
                case 2:
                    return Promise.resolve(true);
            }
        };
        return saveDialog('Save', this.saveItem, `'${title}' has changes, do you want to save them?`);
    }
    // Public: Save the active item.
    /**
     * @param {?=} nextAction
     * @return {?}
     */
    saveActiveItem(nextAction) {
        return this.saveItem(this.getActiveItem(), nextAction);
    }
    // Public: Prompt the user for a location and save the active item with the
    // path they select.
    //
    // * `nextAction` (optional) {Function} which will be called after the item is
    //   successfully saved.
    //
    // Returns a {Promise} that resolves when the save is complete
    /**
     * @param {?=} nextAction
     * @return {?}
     */
    saveActiveItemAs(nextAction) {
        return this.saveItemAs(this.getActiveItem(), nextAction);
    }
    // Public: Save the given item.
    //
    // * `item` The item to save.
    // * `nextAction` (optional) {Function} which will be called with no argument
    //   after the item is successfully saved, or with the error if it failed.
    //   The return value will be that of `nextAction` or `undefined` if it was not
    //   provided
    //
    // Returns a {Promise} that resolves when the save is complete
    /**
     * @param {?} item
     * @param {?} nextAction
     * @return {?}
     */
    saveItem(item, nextAction) {
        if (!item) {
            return Promise.resolve();
        }
        /** @type {?} */
        let itemURI;
        if (typeof item.getURI === 'function') {
            itemURI = item.getURI();
        }
        else if (typeof item.getUri === 'function') {
            itemURI = item.getUri();
        }
        if (itemURI != null) {
            if (typeof item.save === 'function') {
                return promisify(() => item.save())
                    .then(() => {
                    if (nextAction) {
                        nextAction();
                    }
                })
                    .catch(error => {
                    if (nextAction) {
                        nextAction(error);
                    }
                    else {
                        this.handleSaveError(error, item);
                    }
                });
            }
            else if (nextAction) {
                nextAction();
                return Promise.resolve();
            }
        }
        else {
            return this.saveItemAs(item, nextAction);
        }
    }
    // Public: Prompt the user for a location and save the active item with the
    // path they select.
    //
    // * `item` The item to save.
    // * `nextAction` (optional) {Function} which will be called with no argument
    //   after the item is successfully saved, or with the error if it failed.
    //   The return value will be that of `nextAction` or `undefined` if it was not
    //   provided
    /**
     * @param {?} item
     * @param {?} nextAction
     * @return {?}
     */
    saveItemAs(item, nextAction) {
    }
    // Public: Save all items.
    /**
     * @return {?}
     */
    saveItems() {
    }
    // Public: Return the first item that matches the given URI or undefined if
    // none exists.
    //
    // * `uri` {String} containing a URI.
    /**
     * @param {?} uri
     * @return {?}
     */
    itemForURI(uri) {
        return this.items.find(item => {
            if (typeof item.getURI === 'function') {
                return item.getURI() === uri;
            }
            else if (typeof item.getUri === 'function') {
                return item.getUri() === uri;
            }
        });
    }
    // Public: Activate the first item that matches the given URI.
    //
    // * `uri` {String} containing a URI.
    //
    // Returns a {Boolean} indicating whether an item matching the URI was found.
    /**
     * @param {?} uri
     * @return {?}
     */
    activateItemForURI(uri) {
        /** @type {?} */
        const item = this.itemForURI(uri);
        if (item) {
            this.activateItem(item);
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * @return {?}
     */
    copyActiveItem() {
        if (this.activeItem && typeof this.activeItem.copy === 'function') {
            return this.activeItem.copy();
        }
    }
    /*
      Section: Lifecycle
      */
    // Public: Determine whether the pane is active.
    //
    // Returns a {Boolean}.
    /**
     * @return {?}
     */
    isActive() {
        return this.container && this.container.getActivePane() === this;
    }
    // Public: Makes this pane the *active* pane, causing it to gain focus.
    /**
     * @return {?}
     */
    activate() {
    }
    // Public: Close the pane and destroy all its items.
    //
    // If this is the last pane, all the items will be destroyed but the pane
    // itself will not be destroyed.
    /**
     * @return {?}
     */
    destroy() {
    }
    /**
     * @return {?}
     */
    isAlive() { return this.alive; }
    // Public: Determine whether this pane has been destroyed.
    //
    // Returns a {Boolean}.
    /**
     * @return {?}
     */
    isDestroyed() { return !this.isAlive(); }
    /*
      Section: Splitting
      */
    // Public: Create a new pane to the left of this pane.
    //
    // * `params` (optional) {Object} with the following keys:
    //   * `items` (optional) {Array} of items to add to the new pane.
    //   * `copyActiveItem` (optional) {Boolean} true will copy the active item into the new split pane
    //
    // Returns the new {Pane}.
    /**
     * @param {?} params
     * @return {?}
     */
    splitLeft(params) {
        return this.split('horizontal', 'before', params);
    }
    // Public: Create a new pane to the right of this pane.
    //
    // * `params` (optional) {Object} with the following keys:
    //   * `items` (optional) {Array} of items to add to the new pane.
    //   * `copyActiveItem` (optional) {Boolean} true will copy the active item into the new split pane
    //
    // Returns the new {Pane}.
    /**
     * @param {?} params
     * @return {?}
     */
    splitRight(params) {
        return this.split('horizontal', 'after', params);
    }
    // Public: Creates a new pane above the receiver.
    //
    // * `params` (optional) {Object} with the following keys:
    //   * `items` (optional) {Array} of items to add to the new pane.
    //   * `copyActiveItem` (optional) {Boolean} true will copy the active item into the new split pane
    //
    // Returns the new {Pane}.
    /**
     * @param {?} params
     * @return {?}
     */
    splitUp(params) {
        return this.split('vertical', 'before', params);
    }
    // Public: Creates a new pane below the receiver.
    //
    // * `params` (optional) {Object} with the following keys:
    //   * `items` (optional) {Array} of items to add to the new pane.
    //   * `copyActiveItem` (optional) {Boolean} true will copy the active item into the new split pane
    //
    // Returns the new {Pane}.
    /**
     * @param {?} params
     * @return {?}
     */
    splitDown(params) {
        return this.split('vertical', 'after', params);
    }
    /**
     * @param {?} orientation
     * @param {?} side
     * @param {?} params
     * @return {?}
     */
    split(orientation, side, params) {
        if (params && params.copyActiveItem) {
            if (!params.items) {
                params.items = [];
            }
            params.items.push(this.copyActiveItem());
        }
        if (this.parent.orientation !== orientation) {
            this.parent.replaceChild(this, new PaneAxis({
                container: this.container,
                orientation,
                children: [this],
                flexScale: this.flexScale
            }, this.viewRegistry));
            this.setFlexScale(1);
        }
        /** @type {?} */
        const newPane = new Pane(Object.assign({
            applicationDelegate: this.applicationDelegate,
            notificationManager: this.notificationManager,
            deserializerManager: this.deserializerManager,
            config: this.config,
            viewRegistry: this.viewRegistry
        }, params));
        switch (side) {
            case 'before':
                this.parent.insertChildBefore(this, newPane);
                break;
            case 'after':
                this.parent.insertChildAfter(this, newPane);
                break;
        }
        if (params && params.moveActiveItem && this.activeItem) {
            this.moveItemToPane(this.activeItem, newPane);
        }
        newPane.activate();
        return newPane;
    }
    // If the parent is a horizontal axis, returns its first child if it is a pane;
    // otherwise returns this pane.
    /**
     * @return {?}
     */
    findLeftmostSibling() {
        if (this.parent.orientation === 'horizontal') {
            const [leftmostSibling] = this.parent.children;
            if (leftmostSibling instanceof PaneAxis) {
                return this;
            }
            else {
                return leftmostSibling;
            }
        }
        else {
            return this;
        }
    }
    /**
     * @return {?}
     */
    findRightmostSibling() {
        if (this.parent.orientation === 'horizontal') {
            /** @type {?} */
            const rightmostSibling = this.parent.children[this.parent.children.length - 1];
            if (rightmostSibling instanceof PaneAxis) {
                return this;
            }
            else {
                return rightmostSibling;
            }
        }
        else {
            return this;
        }
    }
    // If the parent is a horizontal axis, returns its last child if it is a pane;
    // otherwise returns a new pane created by splitting this pane rightward.
    /**
     * @return {?}
     */
    findOrCreateRightmostSibling() {
        /** @type {?} */
        const rightmostSibling = this.findRightmostSibling();
        if (rightmostSibling === this) {
            return this.splitRight({});
        }
        else {
            return rightmostSibling;
        }
    }
    // If the parent is a vertical axis, returns its first child if it is a pane;
    // otherwise returns this pane.
    /**
     * @return {?}
     */
    findTopmostSibling() {
        if (this.parent.orientation === 'vertical') {
            const [topmostSibling] = this.parent.children;
            if (topmostSibling instanceof PaneAxis) {
                return this;
            }
            else {
                return topmostSibling;
            }
        }
        else {
            return this;
        }
    }
    /**
     * @return {?}
     */
    findBottommostSibling() {
        if (this.parent.orientation === 'vertical') {
            /** @type {?} */
            const bottommostSibling = this.parent.children[this.parent.children.length - 1];
            if (bottommostSibling instanceof PaneAxis) {
                return this;
            }
            else {
                return bottommostSibling;
            }
        }
        else {
            return this;
        }
    }
    // If the parent is a vertical axis, returns its last child if it is a pane;
    // otherwise returns a new pane created by splitting this pane bottomward.
    /**
     * @return {?}
     */
    findOrCreateBottommostSibling() {
        /** @type {?} */
        const bottommostSibling = this.findBottommostSibling();
        if (bottommostSibling === this) {
            return this.splitDown({});
        }
        else {
            return bottommostSibling;
        }
    }
    // Private: Close the pane unless the user cancels the action via a dialog.
    //
    // Returns a {Promise} that resolves once the pane is either closed, or the
    // closing has been cancelled.
    /**
     * @return {?}
     */
    close() {
        return Promise.all(this.getItems().map(item => this.promptToSaveItem(item)))
            .then(results => {
            if (!results.find(item => item === false)) {
                return this.destroy();
            }
        });
    }
    /**
     * @param {?} error
     * @param {?} item
     * @return {?}
     */
    handleSaveError(error, item) {
    }
    /**
     * @param {?} errorCode
     * @return {?}
     */
    getMessageForErrorCode(errorCode) {
        switch (errorCode) {
            case 'EACCES': return 'Permission denied';
            case 'ECONNRESET': return 'Connection reset';
            case 'EINTR': return 'Interrupted system call';
            case 'EIO': return 'I/O error writing file';
            case 'ENOSPC': return 'No space left on device';
            case 'ENOTSUP': return 'Operation not supported on socket';
            case 'ENXIO': return 'No such device or address';
            case 'EROFS': return 'Read-only file system';
            case 'ESPIPE': return 'Invalid seek';
            case 'ETIMEDOUT': return 'Connection timed out';
        }
    }
}
if (false) {
    /** @type {?} */
    Pane.prototype.id;
    /** @type {?} */
    Pane.prototype.activeItem;
    /** @type {?} */
    Pane.prototype.focused;
    /** @type {?} */
    Pane.prototype.applicationDelegate;
    /** @type {?} */
    Pane.prototype.notificationManager;
    /** @type {?} */
    Pane.prototype.config;
    /** @type {?} */
    Pane.prototype.deserializerManager;
    /** @type {?} */
    Pane.prototype.viewRegistry;
    /**
     * @type {?}
     * @private
     */
    Pane.prototype.emitter;
    /** @type {?} */
    Pane.prototype.alive;
    /** @type {?} */
    Pane.prototype.subscriptionsPerItem;
    /** @type {?} */
    Pane.prototype.items;
    /** @type {?} */
    Pane.prototype.itemStack;
    /** @type {?} */
    Pane.prototype.container;
    /** @type {?} */
    Pane.prototype.flexScale;
    /** @type {?} */
    Pane.prototype.parent;
    /** @type {?} */
    Pane.prototype.itemStackIndex;
    /** @type {?} */
    Pane.prototype.pendingItem;
}
/**
 * @param {?} callback
 * @return {?}
 */
function promisify(callback) {
    try {
        return Promise.resolve(callback());
    }
    catch (error) {
        return Promise.reject(error);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9pZGVmcmFtZXdvcmsvZ3NwL3BhbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxPQUFPLEVBQWMsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7SUFROUMsY0FBYyxHQUFHLENBQUM7QUFFdEIsTUFBTSxrQkFBbUIsU0FBUSxLQUFLO0NBQUk7Ozs7Ozs7Ozs7QUFXMUMsTUFBTSxPQUFPLElBQUk7Ozs7SUFxRGYsWUFBWSxNQUFXO1FBMUN2QixVQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2IseUJBQW9CLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUNyQyxVQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLGNBQVMsR0FBRyxJQUFJLENBQUM7UUF1Q2YsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyw4QkFBOEIsR0FBRyxJQUFJLENBQUMsOEJBQThCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JGLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMs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QUMsT0FBTywyQkFBMkIsQ0FBQztZQUNqRCxLQUFLLE9BQU8sQ0FBQyxDQUFDLE9BQU8sdUJBQXVCLENBQUM7WUFDN0MsS0FBSyxRQUFRLENBQUMsQ0FBQyxPQUFPLGNBQWMsQ0FBQztZQUNyQyxLQUFLLFdBQVcsQ0FBQyxDQUFDLE9BQU8sc0JBQXNCLENBQUM7U0FDakQ7SUFDSCxDQUFDO0NBQ0Y7OztJQWpuQ0Msa0JBQVE7O0lBQ1IsMEJBQWdCOztJQUNoQix1QkFBYTs7SUFDYixtQ0FBeUI7O0lBQ3pCLG1DQUF5Qjs7SUFDekIsc0JBQVk7O0lBQ1osbUNBQXlCOztJQUN6Qiw0QkFBa0I7Ozs7O0lBQ2xCLHVCQUF5Qjs7SUFDekIscUJBQWE7O0lBQ2Isb0NBQXFDOztJQUNyQyxxQkFBVzs7SUFDWCx5QkFBZTs7SUFDZix5QkFBaUI7O0lBQ2pCLHlCQUFlOztJQUNmLHNCQUFZOztJQUNaLDhCQUF1Qjs7SUFDdkIsMkJBQWlCOzs7Ozs7QUFrbUNuQixTQUFTLFNBQVMsQ0FBQyxRQUFRO0lBQ3pCLElBQUk7UUFDRixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztLQUNwQztJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQzlCO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhbmVBeGlzIH0gZnJvbSAnLi9wYW5lLWF4aXMnO1xyXG5pbXBvcnQgeyBFbWl0dGVyLCBEaXNwb3NhYmxlIH0gZnJvbSAnLi9ldmVudC1raXQnO1xyXG5cclxuLy8gY29uc3QgR3JpbSA9IHJlcXVpcmUoJ2dyaW0nKVxyXG4vLyBjb25zdCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgRW1pdHRlcn0gPSByZXF1aXJlKCdldmVudC1raXQnKVxyXG4vLyBjb25zdCBQYW5lQXhpcyA9IHJlcXVpcmUoJy4vcGFuZS1heGlzJylcclxuLy8gY29uc3QgVGV4dEVkaXRvciA9IHJlcXVpcmUoJy4vdGV4dC1lZGl0b3InKVxyXG4vLyBjb25zdCBQYW5lRWxlbWVudCA9IHJlcXVpcmUoJy4vcGFuZS1lbGVtZW50JylcclxuXHJcbmxldCBuZXh0SW5zdGFuY2VJZCA9IDE7XHJcblxyXG5jbGFzcyBTYXZlQ2FuY2VsbGVkRXJyb3IgZXh0ZW5kcyBFcnJvciB7IH1cclxuXHJcbi8vIEV4dGVuZGVkOiBBIGNvbnRhaW5lciBmb3IgcHJlc2VudGluZyBjb250ZW50IGluIHRoZSBjZW50ZXIgb2YgdGhlIHdvcmtzcGFjZS5cclxuLy8gUGFuZXMgY2FuIGNvbnRhaW4gbXVsdGlwbGUgaXRlbXMsIG9uZSBvZiB3aGljaCBpcyAqYWN0aXZlKiBhdCBhIGdpdmVuIHRpbWUuXHJcbi8vIFRoZSB2aWV3IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGFjdGl2ZSBpdGVtIGlzIGRpc3BsYXllZCBpbiB0aGUgaW50ZXJmYWNlLiBJblxyXG4vLyB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uLCB0YWJzIGFyZSBhbHNvIGRpc3BsYXllZCBmb3IgZWFjaCBpdGVtLlxyXG4vL1xyXG4vLyBFYWNoIHBhbmUgbWF5IGFsc28gY29udGFpbiBvbmUgKnBlbmRpbmcqIGl0ZW0uIFdoZW4gYSBwZW5kaW5nIGl0ZW0gaXMgYWRkZWRcclxuLy8gdG8gYSBwYW5lLCBpdCB3aWxsIHJlcGxhY2UgdGhlIGN1cnJlbnRseSBwZW5kaW5nIGl0ZW0sIGlmIGFueSwgaW5zdGVhZCBvZlxyXG4vLyBzaW1wbHkgYmVpbmcgYWRkZWQuIEluIHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24sIHRoZSB0ZXh0IGluIHRoZSB0YWIgZm9yXHJcbi8vIHBlbmRpbmcgaXRlbXMgaXMgc2hvd24gaW4gaXRhbGljcy5cclxuZXhwb3J0IGNsYXNzIFBhbmUge1xyXG5cclxuICBpZDogYW55O1xyXG4gIGFjdGl2ZUl0ZW06IGFueTtcclxuICBmb2N1c2VkOiBhbnk7XHJcbiAgYXBwbGljYXRpb25EZWxlZ2F0ZTogYW55O1xyXG4gIG5vdGlmaWNhdGlvbk1hbmFnZXI6IGFueTtcclxuICBjb25maWc6IGFueTtcclxuICBkZXNlcmlhbGl6ZXJNYW5hZ2VyOiBhbnk7XHJcbiAgdmlld1JlZ2lzdHJ5OiBhbnk7XHJcbiAgcHJpdmF0ZSBlbWl0dGVyOiBFbWl0dGVyO1xyXG4gIGFsaXZlID0gdHJ1ZTtcclxuICBzdWJzY3JpcHRpb25zUGVySXRlbSA9IG5ldyBXZWFrTWFwKCk7XHJcbiAgaXRlbXMgPSBbXTtcclxuICBpdGVtU3RhY2sgPSBbXTtcclxuICBjb250YWluZXIgPSBudWxsO1xyXG4gIGZsZXhTY2FsZTogYW55O1xyXG4gIHBhcmVudDogYW55O1xyXG4gIGl0ZW1TdGFja0luZGV4OiBudW1iZXI7XHJcbiAgcGVuZGluZ0l0ZW06IGFueTtcclxuXHJcbiAgc3RhdGljIGRlc2VyaWFsaXplKHN0YXRlLCB7IGRlc2VyaWFsaXplcnMsIGFwcGxpY2F0aW9uRGVsZWdhdGUsIGNvbmZpZywgbm90aWZpY2F0aW9ucywgdmlld3MgfSkge1xyXG4gICAgY29uc3QgeyBhY3RpdmVJdGVtSW5kZXggfSA9IHN0YXRlO1xyXG4gICAgY29uc3QgYWN0aXZlSXRlbVVSSSA9IHN0YXRlLmFjdGl2ZUl0ZW1VUkkgfHwgc3RhdGUuYWN0aXZlSXRlbVVyaTtcclxuXHJcbiAgICBjb25zdCBpdGVtcyA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBpdGVtU3RhdGUgb2Ygc3RhdGUuaXRlbXMpIHtcclxuICAgICAgY29uc3QgaXRlbSA9IGRlc2VyaWFsaXplcnMuZGVzZXJpYWxpemUoaXRlbVN0YXRlKTtcclxuICAgICAgaWYgKGl0ZW0pIHsgaXRlbXMucHVzaChpdGVtKTsgfVxyXG4gICAgfVxyXG4gICAgc3RhdGUuaXRlbXMgPSBpdGVtcztcclxuXHJcbiAgICBzdGF0ZS5hY3RpdmVJdGVtID0gaXRlbXNbYWN0aXZlSXRlbUluZGV4XTtcclxuICAgIGlmICghc3RhdGUuYWN0aXZlSXRlbSAmJiBhY3RpdmVJdGVtVVJJKSB7XHJcbiAgICAgIHN0YXRlLmFjdGl2ZUl0ZW0gPSBzdGF0ZS5pdGVtcy5maW5kKChpdGVtKSA9PlxyXG4gICAgICAgIHR5cGVvZiBpdGVtLmdldFVSSSA9PT0gJ2Z1bmN0aW9uJyAmJiBpdGVtLmdldFVSSSgpID09PSBhY3RpdmVJdGVtVVJJXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQYW5lKE9iamVjdC5hc3NpZ24oc3RhdGUsIHtcclxuICAgICAgZGVzZXJpYWxpemVyTWFuYWdlcjogZGVzZXJpYWxpemVycyxcclxuICAgICAgbm90aWZpY2F0aW9uTWFuYWdlcjogbm90aWZpY2F0aW9ucyxcclxuICAgICAgdmlld1JlZ2lzdHJ5OiB2aWV3cyxcclxuICAgICAgY29uZmlnLFxyXG4gICAgICBhcHBsaWNhdGlvbkRlbGVnYXRlXHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIGluc3BlY3QoKSB7XHJcbiAgICByZXR1cm4gYFBhbmUgJHt0aGlzLmlkfWA7XHJcbiAgfVxyXG4gIGNvbnN0cnVjdG9yKHBhcmFtczogYW55KSB7XHJcbiAgICB0aGlzLnNldFBlbmRpbmdJdGVtID0gdGhpcy5zZXRQZW5kaW5nSXRlbS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nZXRQZW5kaW5nSXRlbSA9IHRoaXMuZ2V0UGVuZGluZ0l0ZW0uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuY2xlYXJQZW5kaW5nSXRlbSA9IHRoaXMuY2xlYXJQZW5kaW5nSXRlbS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbkl0ZW1EaWRUZXJtaW5hdGVQZW5kaW5nU3RhdGUgPSB0aGlzLm9uSXRlbURpZFRlcm1pbmF0ZVBlbmRpbmdTdGF0ZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zYXZlSXRlbSA9IHRoaXMuc2F2ZUl0ZW0uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuc2F2ZUl0ZW1BcyA9IHRoaXMuc2F2ZUl0ZW1Bcy5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuaWQgPSBwYXJhbXMuaWQ7XHJcbiAgICBpZiAodGhpcy5pZCAhPSBudWxsKSB7XHJcbiAgICAgIG5leHRJbnN0YW5jZUlkID0gTWF0aC5tYXgobmV4dEluc3RhbmNlSWQsIHRoaXMuaWQgKyAxKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaWQgPSBuZXh0SW5zdGFuY2VJZCsrO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYWN0aXZlSXRlbSA9IHBhcmFtcy5hY3RpdmVJdGVtO1xyXG4gICAgdGhpcy5mb2N1c2VkID0gcGFyYW1zLmZvY3VzZWQgIT0gbnVsbCA/IHBhcmFtcy5mb2N1c2VkIDogZmFsc2U7XHJcbiAgICB0aGlzLmFwcGxpY2F0aW9uRGVsZWdhdGUgPSBwYXJhbXMuYXBwbGljYXRpb25EZWxlZ2F0ZTtcclxuICAgIHRoaXMubm90aWZpY2F0aW9uTWFuYWdlciA9IHBhcmFtcy5ub3RpZmljYXRpb25NYW5hZ2VyO1xyXG4gICAgdGhpcy5jb25maWcgPSBwYXJhbXMuY29uZmlnO1xyXG4gICAgdGhpcy5kZXNlcmlhbGl6ZXJNYW5hZ2VyID0gcGFyYW1zLmRlc2VyaWFsaXplck1hbmFnZXI7XHJcbiAgICB0aGlzLnZpZXdSZWdpc3RyeSA9IHBhcmFtcy52aWV3UmVnaXN0cnk7XHJcblxyXG4gICAgdGhpcy5lbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcclxuICAgIHRoaXMuYWxpdmUgPSB0cnVlO1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zUGVySXRlbSA9IG5ldyBXZWFrTWFwKCk7XHJcbiAgICB0aGlzLml0ZW1zID0gW107XHJcbiAgICB0aGlzLml0ZW1TdGFjayA9IFtdO1xyXG4gICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xyXG5cclxuICAgIHRoaXMuYWRkSXRlbXMoKHBhcmFtcy5pdGVtcyB8fCBbXSkuZmlsdGVyKGl0ZW0gPT4gaXRlbSkpO1xyXG4gICAgaWYgKCF0aGlzLmdldEFjdGl2ZUl0ZW0oKSkge1xyXG4gICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0odGhpcy5pdGVtc1swXSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmFkZEl0ZW1zVG9TdGFjayhwYXJhbXMuaXRlbVN0YWNrSW5kaWNlcyB8fCBbXSk7XHJcbiAgICB0aGlzLnNldEZsZXhTY2FsZShwYXJhbXMuZmxleFNjYWxlIHx8IDEpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RWxlbWVudCgpIHtcclxuICB9XHJcblxyXG4gIHNlcmlhbGl6ZSgpIHtcclxuICAgIGNvbnN0IGl0ZW1zVG9CZVNlcmlhbGl6ZWQgPSB0aGlzLml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0gJiYgdHlwZW9mIGl0ZW0uc2VyaWFsaXplID09PSAnZnVuY3Rpb24nKTtcclxuXHJcbiAgICBjb25zdCBpdGVtU3RhY2tJbmRpY2VzID0gW107XHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5pdGVtU3RhY2spIHtcclxuICAgICAgaWYgKHR5cGVvZiBpdGVtLnNlcmlhbGl6ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIGl0ZW1TdGFja0luZGljZXMucHVzaChpdGVtc1RvQmVTZXJpYWxpemVkLmluZGV4T2YoaXRlbSkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWN0aXZlSXRlbUluZGV4ID0gaXRlbXNUb0JlU2VyaWFsaXplZC5pbmRleE9mKHRoaXMuYWN0aXZlSXRlbSk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZGVzZXJpYWxpemVyOiAnUGFuZScsXHJcbiAgICAgIGlkOiB0aGlzLmlkLFxyXG4gICAgICBpdGVtczogaXRlbXNUb0JlU2VyaWFsaXplZC5tYXAoaXRlbSA9PiBpdGVtLnNlcmlhbGl6ZSgpKSxcclxuICAgICAgaXRlbVN0YWNrSW5kaWNlcyxcclxuICAgICAgYWN0aXZlSXRlbUluZGV4LFxyXG4gICAgICBmb2N1c2VkOiB0aGlzLmZvY3VzZWQsXHJcbiAgICAgIGZsZXhTY2FsZTogdGhpcy5mbGV4U2NhbGVcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRQYXJlbnQoKSB7IHJldHVybiB0aGlzLnBhcmVudDsgfVxyXG5cclxuICBzZXRQYXJlbnQocGFyZW50KSB7XHJcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICB9XHJcblxyXG4gIGdldENvbnRhaW5lcigpIHsgcmV0dXJuIHRoaXMuY29udGFpbmVyOyB9XHJcblxyXG4gIHNldENvbnRhaW5lcihjb250YWluZXIpIHtcclxuICAgIGlmIChjb250YWluZXIgJiYgY29udGFpbmVyICE9PSB0aGlzLmNvbnRhaW5lcikge1xyXG4gICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgY29udGFpbmVyLmRpZEFkZFBhbmUoeyBwYW5lOiB0aGlzIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHJpdmF0ZTogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGdpdmVuIGl0ZW0gaXMgYWxsb3dlZCB0byBleGlzdCBpbiB0aGlzIHBhbmUuXHJcbiAgLy9cclxuICAvLyAqIGBpdGVtYCB0aGUgSXRlbVxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtCb29sZWFufS5cclxuICBpc0l0ZW1BbGxvd2VkKGl0ZW0pIHtcclxuICAgIGlmICh0eXBlb2YgaXRlbS5nZXRBbGxvd2VkTG9jYXRpb25zICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGl0ZW0uZ2V0QWxsb3dlZExvY2F0aW9ucygpLmluY2x1ZGVzKHRoaXMuZ2V0Q29udGFpbmVyKCkuZ2V0TG9jYXRpb24oKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRGbGV4U2NhbGUoZmxleFNjYWxlKSB7XHJcbiAgICB0aGlzLmZsZXhTY2FsZSA9IGZsZXhTY2FsZTtcclxuICAgIHJldHVybiB0aGlzLmZsZXhTY2FsZTtcclxuICB9XHJcblxyXG4gIGdldEZsZXhTY2FsZSgpIHsgcmV0dXJuIHRoaXMuZmxleFNjYWxlOyB9XHJcblxyXG4gIGluY3JlYXNlU2l6ZSgpIHsgdGhpcy5zZXRGbGV4U2NhbGUodGhpcy5nZXRGbGV4U2NhbGUoKSAqIDEuMSk7IH1cclxuXHJcbiAgZGVjcmVhc2VTaXplKCkgeyB0aGlzLnNldEZsZXhTY2FsZSh0aGlzLmdldEZsZXhTY2FsZSgpIC8gMS4xKTsgfVxyXG5cclxuICAvKlxyXG4gIFNlY3Rpb246IEV2ZW50IFN1YnNjcmlwdGlvblxyXG4gICovXHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayB3aGVuIHRoZSBwYW5lIHJlc2l6ZXNcclxuICAvL1xyXG4gIC8vIFRoZSBjYWxsYmFjayB3aWxsIGJlIGludm9rZWQgd2hlbiBwYW5lJ3MgZmxleFNjYWxlIHByb3BlcnR5IGNoYW5nZXMuXHJcbiAgLy8gVXNlIHs6OmdldEZsZXhTY2FsZX0gdG8gZ2V0IHRoZSBjdXJyZW50IHZhbHVlLlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHBhbmUgaXMgcmVzaXplZFxyXG4gIC8vICAgKiBgZmxleFNjYWxlYCB7TnVtYmVyfSByZXByZXNlbnRpbmcgdGhlIHBhbmVzIGBmbGV4LWdyb3dgOyBhYmlsaXR5IGZvciBhXHJcbiAgLy8gICAgIGZsZXggaXRlbSB0byBncm93IGlmIG5lY2Vzc2FyeS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7RGlzcG9zYWJsZX0gb24gd2hpY2ggJy5kaXNwb3NlKCknIGNhbiBiZSBjYWxsZWQgdG8gdW5zdWJzY3JpYmUuXHJcbiAgb25EaWRDaGFuZ2VGbGV4U2NhbGUoY2FsbGJhY2spIHtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayB3aXRoIHRoZSBjdXJyZW50IGFuZCBmdXR1cmUgdmFsdWVzIG9mXHJcbiAgLy8gezo6Z2V0RmxleFNjYWxlfS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCB3aXRoIHRoZSBjdXJyZW50IGFuZCBmdXR1cmUgdmFsdWVzIG9mXHJcbiAgLy8gICB0aGUgezo6Z2V0RmxleFNjYWxlfSBwcm9wZXJ0eS5cclxuICAvLyAgICogYGZsZXhTY2FsZWAge051bWJlcn0gcmVwcmVzZW50aW5nIHRoZSBwYW5lcyBgZmxleC1ncm93YDsgYWJpbGl0eSBmb3IgYVxyXG4gIC8vICAgICBmbGV4IGl0ZW0gdG8gZ3JvdyBpZiBuZWNlc3NhcnkuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge0Rpc3Bvc2FibGV9IG9uIHdoaWNoIGAuZGlzcG9zZSgpYCBjYW4gYmUgY2FsbGVkIHRvIHVuc3Vic2NyaWJlLlxyXG4gIG9ic2VydmVGbGV4U2NhbGUoY2FsbGJhY2spIHtcclxuICAgIGNhbGxiYWNrKHRoaXMuZmxleFNjYWxlKTtcclxuICAgIHJldHVybiB0aGlzLm9uRGlkQ2hhbmdlRmxleFNjYWxlKGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayB3aGVuIHRoZSBwYW5lIGlzIGFjdGl2YXRlZC5cclxuICAvL1xyXG4gIC8vIFRoZSBnaXZlbiBjYWxsYmFjayB3aWxsIGJlIGludm9rZWQgd2hlbmV2ZXIgezo6YWN0aXZhdGV9IGlzIGNhbGxlZCBvbiB0aGVcclxuICAvLyBwYW5lLCBldmVuIGlmIGl0IGlzIGFscmVhZHkgYWN0aXZlIGF0IHRoZSB0aW1lLlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHBhbmUgaXMgYWN0aXZhdGVkLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbkRpZEFjdGl2YXRlKGNhbGxiYWNrKSB7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgYmVmb3JlIHRoZSBwYW5lIGlzIGRlc3Ryb3llZC5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCBiZWZvcmUgdGhlIHBhbmUgaXMgZGVzdHJveWVkLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbldpbGxEZXN0cm95KGNhbGxiYWNrKSB7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiB0aGUgcGFuZSBpcyBkZXN0cm95ZWQuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2Age0Z1bmN0aW9ufSB0byBiZSBjYWxsZWQgd2hlbiB0aGUgcGFuZSBpcyBkZXN0cm95ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge0Rpc3Bvc2FibGV9IG9uIHdoaWNoIGAuZGlzcG9zZSgpYCBjYW4gYmUgY2FsbGVkIHRvIHVuc3Vic2NyaWJlLlxyXG4gIG9uRGlkRGVzdHJveShjYWxsYmFjaykge1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBJbnZva2UgdGhlIGdpdmVuIGNhbGxiYWNrIHdoZW4gdGhlIHZhbHVlIG9mIHRoZSB7Ojppc0FjdGl2ZX1cclxuICAvLyBwcm9wZXJ0eSBjaGFuZ2VzLlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHZhbHVlIG9mIHRoZSB7Ojppc0FjdGl2ZX1cclxuICAvLyAgIHByb3BlcnR5IGNoYW5nZXMuXHJcbiAgLy8gICAqIGBhY3RpdmVgIHtCb29sZWFufSBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHBhbmUgaXMgYWN0aXZlLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbkRpZENoYW5nZUFjdGl2ZShjYWxsYmFjaykge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLm9uRGlkQ2hhbmdlQWN0aXZlUGFuZShhY3RpdmVQYW5lID0+IHtcclxuICAgICAgY29uc3QgaXNBY3RpdmUgPSB0aGlzID09PSBhY3RpdmVQYW5lO1xyXG4gICAgICBjYWxsYmFjayhpc0FjdGl2ZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayB3aXRoIHRoZSBjdXJyZW50IGFuZCBmdXR1cmUgdmFsdWVzIG9mIHRoZVxyXG4gIC8vIHs6OmlzQWN0aXZlfSBwcm9wZXJ0eS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCB3aXRoIHRoZSBjdXJyZW50IGFuZCBmdXR1cmUgdmFsdWVzIG9mXHJcbiAgLy8gICB0aGUgezo6aXNBY3RpdmV9IHByb3BlcnR5LlxyXG4gIC8vICAgKiBgYWN0aXZlYCB7Qm9vbGVhbn0gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBwYW5lIGlzIGFjdGl2ZS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7RGlzcG9zYWJsZX0gb24gd2hpY2ggYC5kaXNwb3NlKClgIGNhbiBiZSBjYWxsZWQgdG8gdW5zdWJzY3JpYmUuXHJcbiAgb2JzZXJ2ZUFjdGl2ZShjYWxsYmFjaykge1xyXG4gICAgY2FsbGJhY2sodGhpcy5pc0FjdGl2ZSgpKTtcclxuICAgIHJldHVybiB0aGlzLm9uRGlkQ2hhbmdlQWN0aXZlKGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayB3aGVuIGFuIGl0ZW0gaXMgYWRkZWQgdG8gdGhlIHBhbmUuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2Age0Z1bmN0aW9ufSB0byBiZSBjYWxsZWQgd2l0aCB3aGVuIGl0ZW1zIGFyZSBhZGRlZC5cclxuICAvLyAgICogYGV2ZW50YCB7T2JqZWN0fSB3aXRoIHRoZSBmb2xsb3dpbmcga2V5czpcclxuICAvLyAgICAgKiBgaXRlbWAgVGhlIGFkZGVkIHBhbmUgaXRlbS5cclxuICAvLyAgICAgKiBgaW5kZXhgIHtOdW1iZXJ9IGluZGljYXRpbmcgd2hlcmUgdGhlIGl0ZW0gaXMgbG9jYXRlZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7RGlzcG9zYWJsZX0gb24gd2hpY2ggYC5kaXNwb3NlKClgIGNhbiBiZSBjYWxsZWQgdG8gdW5zdWJzY3JpYmUuXHJcbiAgb25EaWRBZGRJdGVtKGNhbGxiYWNrKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCdkaWQtYWRkLWl0ZW0nLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiBhbiBpdGVtIGlzIHJlbW92ZWQgZnJvbSB0aGUgcGFuZS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCB3aXRoIHdoZW4gaXRlbXMgYXJlIHJlbW92ZWQuXHJcbiAgLy8gICAqIGBldmVudGAge09iamVjdH0gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAgICogYGl0ZW1gIFRoZSByZW1vdmVkIHBhbmUgaXRlbS5cclxuICAvLyAgICAgKiBgaW5kZXhgIHtOdW1iZXJ9IGluZGljYXRpbmcgd2hlcmUgdGhlIGl0ZW0gd2FzIGxvY2F0ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge0Rpc3Bvc2FibGV9IG9uIHdoaWNoIGAuZGlzcG9zZSgpYCBjYW4gYmUgY2FsbGVkIHRvIHVuc3Vic2NyaWJlLlxyXG4gIG9uRGlkUmVtb3ZlSXRlbShjYWxsYmFjayk6IERpc3Bvc2FibGUge1xyXG4gICAgcmV0dXJuIHRoaXMuZW1pdHRlci5vbignZGlkLXJlbW92ZS1pdGVtJywgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBJbnZva2UgdGhlIGdpdmVuIGNhbGxiYWNrIGJlZm9yZSBhbiBpdGVtIGlzIHJlbW92ZWQgZnJvbSB0aGUgcGFuZS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCB3aXRoIHdoZW4gaXRlbXMgYXJlIHJlbW92ZWQuXHJcbiAgLy8gICAqIGBldmVudGAge09iamVjdH0gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAgICogYGl0ZW1gIFRoZSBwYW5lIGl0ZW0gdG8gYmUgcmVtb3ZlZC5cclxuICAvLyAgICAgKiBgaW5kZXhgIHtOdW1iZXJ9IGluZGljYXRpbmcgd2hlcmUgdGhlIGl0ZW0gaXMgbG9jYXRlZC5cclxuICBvbldpbGxSZW1vdmVJdGVtKGNhbGxiYWNrKSB7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiBhbiBpdGVtIGlzIG1vdmVkIHdpdGhpbiB0aGUgcGFuZS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCB3aXRoIHdoZW4gaXRlbXMgYXJlIG1vdmVkLlxyXG4gIC8vICAgKiBgZXZlbnRgIHtPYmplY3R9IHdpdGggdGhlIGZvbGxvd2luZyBrZXlzOlxyXG4gIC8vICAgICAqIGBpdGVtYCBUaGUgcmVtb3ZlZCBwYW5lIGl0ZW0uXHJcbiAgLy8gICAgICogYG9sZEluZGV4YCB7TnVtYmVyfSBpbmRpY2F0aW5nIHdoZXJlIHRoZSBpdGVtIHdhcyBsb2NhdGVkLlxyXG4gIC8vICAgICAqIGBuZXdJbmRleGAge051bWJlcn0gaW5kaWNhdGluZyB3aGVyZSB0aGUgaXRlbSBpcyBub3cgbG9jYXRlZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7RGlzcG9zYWJsZX0gb24gd2hpY2ggYC5kaXNwb3NlKClgIGNhbiBiZSBjYWxsZWQgdG8gdW5zdWJzY3JpYmUuXHJcbiAgb25EaWRNb3ZlSXRlbShjYWxsYmFjaykge1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBJbnZva2UgdGhlIGdpdmVuIGNhbGxiYWNrIHdpdGggYWxsIGN1cnJlbnQgYW5kIGZ1dHVyZSBpdGVtcy5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCB7RnVuY3Rpb259IHRvIGJlIGNhbGxlZCB3aXRoIGN1cnJlbnQgYW5kIGZ1dHVyZSBpdGVtcy5cclxuICAvLyAgICogYGl0ZW1gIEFuIGl0ZW0gdGhhdCBpcyBwcmVzZW50IGluIHs6OmdldEl0ZW1zfSBhdCB0aGUgdGltZSBvZlxyXG4gIC8vICAgICBzdWJzY3JpcHRpb24gb3IgdGhhdCBpcyBhZGRlZCBhdCBzb21lIGxhdGVyIHRpbWUuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge0Rpc3Bvc2FibGV9IG9uIHdoaWNoIGAuZGlzcG9zZSgpYCBjYW4gYmUgY2FsbGVkIHRvIHVuc3Vic2NyaWJlLlxyXG4gIG9ic2VydmVJdGVtcyhjYWxsYmFjaykge1xyXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuZ2V0SXRlbXMoKSkge1xyXG4gICAgICBjYWxsYmFjayhpdGVtKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLm9uRGlkQWRkSXRlbSgoeyBpdGVtIH0pID0+IGNhbGxiYWNrKGl0ZW0pKTtcclxuICB9XHJcblxyXG4gIC8vIOWFrOacieaWueazle+8miDlvZN7OjpnZXRBY3RpdmVJdGVtfeWAvOWPmOaNouWJjeiwg+eUqOOAglxyXG4gIG9uRG9pbmdDaGFuZ2VBY3RpdmVJdGVtKGNhbGxiYWNrKTogRGlzcG9zYWJsZSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbWl0dGVyLm9uKCdkb2luZy1jaGFuZ2UtYWN0aXZlLWl0ZW0nLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiB0aGUgdmFsdWUgb2Ygezo6Z2V0QWN0aXZlSXRlbX1cclxuICAvLyBjaGFuZ2VzLlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIHdpdGggd2hlbiB0aGUgYWN0aXZlIGl0ZW0gY2hhbmdlcy5cclxuICAvLyAgICogYGFjdGl2ZUl0ZW1gIFRoZSBjdXJyZW50IGFjdGl2ZSBpdGVtLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbkRpZENoYW5nZUFjdGl2ZUl0ZW0oY2FsbGJhY2spOiBEaXNwb3NhYmxlIHtcclxuICAgIHJldHVybiB0aGlzLmVtaXR0ZXIub24oJ2RpZC1jaGFuZ2UtYWN0aXZlLWl0ZW0nLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiB7OjphY3RpdmF0ZU5leHRSZWNlbnRseVVzZWRJdGVtfVxyXG4gIC8vIGhhcyBiZWVuIGNhbGxlZCwgZWl0aGVyIGluaXRpYXRpbmcgb3IgY29udGludWluZyBhIGZvcndhcmQgTVJVIHRyYXZlcnNhbCBvZlxyXG4gIC8vIHBhbmUgaXRlbXMuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2Age0Z1bmN0aW9ufSB0byBiZSBjYWxsZWQgd2l0aCB3aGVuIHRoZSBhY3RpdmUgaXRlbSBjaGFuZ2VzLlxyXG4gIC8vICAgKiBgbmV4dFJlY2VudGx5VXNlZEl0ZW1gIFRoZSBuZXh0IE1SVSBpdGVtLCBub3cgYmVpbmcgc2V0IGFjdGl2ZVxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbkNob29zZU5leHRNUlVJdGVtKGNhbGxiYWNrKSB7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiB7OjphY3RpdmF0ZVByZXZpb3VzUmVjZW50bHlVc2VkSXRlbX1cclxuICAvLyBoYXMgYmVlbiBjYWxsZWQsIGVpdGhlciBpbml0aWF0aW5nIG9yIGNvbnRpbnVpbmcgYSByZXZlcnNlIE1SVSB0cmF2ZXJzYWwgb2ZcclxuICAvLyBwYW5lIGl0ZW1zLlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIHdpdGggd2hlbiB0aGUgYWN0aXZlIGl0ZW0gY2hhbmdlcy5cclxuICAvLyAgICogYHByZXZpb3VzUmVjZW50bHlVc2VkSXRlbWAgVGhlIHByZXZpb3VzIE1SVSBpdGVtLCBub3cgYmVpbmcgc2V0IGFjdGl2ZVxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbkNob29zZUxhc3RNUlVJdGVtKGNhbGxiYWNrKSB7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgd2hlbiB7Ojptb3ZlQWN0aXZlSXRlbVRvVG9wT2ZTdGFja31cclxuICAvLyBoYXMgYmVlbiBjYWxsZWQsIHRlcm1pbmF0aW5nIGFuIE1SVSB0cmF2ZXJzYWwgb2YgcGFuZSBpdGVtcyBhbmQgbW92aW5nIHRoZVxyXG4gIC8vIGN1cnJlbnQgYWN0aXZlIGl0ZW0gdG8gdGhlIHRvcCBvZiB0aGUgc3RhY2suIFR5cGljYWxseSBib3VuZCB0byBhIG1vZGlmaWVyXHJcbiAgLy8gKGUuZy4gQ1RSTCkga2V5IHVwIGV2ZW50LlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIHtGdW5jdGlvbn0gdG8gYmUgY2FsbGVkIHdpdGggd2hlbiB0aGUgTVJVIHRyYXZlcnNhbCBpcyBkb25lLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtEaXNwb3NhYmxlfSBvbiB3aGljaCBgLmRpc3Bvc2UoKWAgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICBvbkRvbmVDaG9vc2luZ01SVUl0ZW0oY2FsbGJhY2spIHtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogSW52b2tlIHRoZSBnaXZlbiBjYWxsYmFjayB3aXRoIHRoZSBjdXJyZW50IGFuZCBmdXR1cmUgdmFsdWVzIG9mXHJcbiAgLy8gezo6Z2V0QWN0aXZlSXRlbX0uXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2Age0Z1bmN0aW9ufSB0byBiZSBjYWxsZWQgd2l0aCB0aGUgY3VycmVudCBhbmQgZnV0dXJlIGFjdGl2ZVxyXG4gIC8vICAgaXRlbXMuXHJcbiAgLy8gICAqIGBhY3RpdmVJdGVtYCBUaGUgY3VycmVudCBhY3RpdmUgaXRlbS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7RGlzcG9zYWJsZX0gb24gd2hpY2ggYC5kaXNwb3NlKClgIGNhbiBiZSBjYWxsZWQgdG8gdW5zdWJzY3JpYmUuXHJcbiAgb2JzZXJ2ZUFjdGl2ZUl0ZW0oY2FsbGJhY2spOiBEaXNwb3NhYmxlIHtcclxuICAgIGNhbGxiYWNrKHRoaXMuZ2V0QWN0aXZlSXRlbSgpKTtcclxuICAgIHJldHVybiB0aGlzLm9uRGlkQ2hhbmdlQWN0aXZlSXRlbShjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEludm9rZSB0aGUgZ2l2ZW4gY2FsbGJhY2sgYmVmb3JlIGl0ZW1zIGFyZSBkZXN0cm95ZWQuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2Age0Z1bmN0aW9ufSB0byBiZSBjYWxsZWQgYmVmb3JlIGl0ZW1zIGFyZSBkZXN0cm95ZWQuXHJcbiAgLy8gICAqIGBldmVudGAge09iamVjdH0gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAgICogYGl0ZW1gIFRoZSBpdGVtIHRoYXQgd2lsbCBiZSBkZXN0cm95ZWQuXHJcbiAgLy8gICAgICogYGluZGV4YCBUaGUgbG9jYXRpb24gb2YgdGhlIGl0ZW0uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge0Rpc3Bvc2FibGV9IG9uIHdoaWNoIGAuZGlzcG9zZSgpYCBjYW4gYmUgY2FsbGVkIHRvXHJcbiAgLy8gdW5zdWJzY3JpYmUuXHJcbiAgb25XaWxsRGVzdHJveUl0ZW0oY2FsbGJhY2spIHtcclxuICB9XHJcblxyXG4gIC8vIENhbGxlZCBieSB0aGUgdmlldyBsYXllciB0byBpbmRpY2F0ZSB0aGF0IHRoZSBwYW5lIGhhcyBnYWluZWQgZm9jdXMuXHJcbiAgZm9jdXMoKSB7XHJcbiAgICB0aGlzLmZvY3VzZWQgPSB0cnVlO1xyXG4gICAgcmV0dXJuIHRoaXMuYWN0aXZhdGUoKTtcclxuICB9XHJcblxyXG4gIC8vIENhbGxlZCBieSB0aGUgdmlldyBsYXllciB0byBpbmRpY2F0ZSB0aGF0IHRoZSBwYW5lIGhhcyBsb3N0IGZvY3VzLlxyXG4gIGJsdXIoKSB7XHJcbiAgICB0aGlzLmZvY3VzZWQgPSBmYWxzZTtcclxuICAgIHJldHVybiB0cnVlOyAvLyBpZiB0aGlzIGlzIGNhbGxlZCBmcm9tIGFuIGV2ZW50IGhhbmRsZXIsIGRvbid0IGNhbmNlbCBpdFxyXG4gIH1cclxuXHJcbiAgaXNGb2N1c2VkKCkgeyByZXR1cm4gdGhpcy5mb2N1c2VkOyB9XHJcblxyXG4gIGdldFBhbmVzKCkgeyByZXR1cm4gW3RoaXNdOyB9XHJcblxyXG4gIHVuc3Vic2NyaWJlRnJvbUl0ZW0oaXRlbSkge1xyXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy5zdWJzY3JpcHRpb25zUGVySXRlbS5nZXQoaXRlbSk7XHJcbiAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc1Blckl0ZW0uZGVsZXRlKGl0ZW0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICBTZWN0aW9uOiBJdGVtc1xyXG4gICovXHJcblxyXG4gIC8vIFB1YmxpYzogR2V0IHRoZSBpdGVtcyBpbiB0aGlzIHBhbmUuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIHtBcnJheX0gb2YgaXRlbXMuXHJcbiAgZ2V0SXRlbXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pdGVtcy5zbGljZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBHZXQgdGhlIGFjdGl2ZSBwYW5lIGl0ZW0gaW4gdGhpcyBwYW5lLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHBhbmUgaXRlbS5cclxuICBnZXRBY3RpdmVJdGVtKCkgeyByZXR1cm4gdGhpcy5hY3RpdmVJdGVtOyB9XHJcblxyXG4gIHNldEFjdGl2ZUl0ZW0oYWN0aXZlSXRlbT86IGFueSwgb3B0aW9ucz86IGFueSkge1xyXG4gICAgY29uc3QgbW9kaWZ5U3RhY2sgPSBvcHRpb25zICYmIG9wdGlvbnMubW9kaWZ5U3RhY2s7XHJcbiAgICBpZiAoYWN0aXZlSXRlbSAhPT0gdGhpcy5hY3RpdmVJdGVtKSB7XHJcbiAgICAgIGlmIChtb2RpZnlTdGFjayAhPT0gZmFsc2UpIHsgdGhpcy5hZGRJdGVtVG9TdGFjayhhY3RpdmVJdGVtKTsgfVxyXG4gICAgICB0aGlzLmVtaXR0ZXIuZW1pdCgnZG9pbmctY2hhbmdlLWFjdGl2ZS1pdGVtJywgdGhpcy5hY3RpdmVJdGVtKTtcclxuICAgICAgdGhpcy5hY3RpdmVJdGVtID0gYWN0aXZlSXRlbTtcclxuICAgICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1jaGFuZ2UtYWN0aXZlLWl0ZW0nLCB0aGlzLmFjdGl2ZUl0ZW0pO1xyXG4gICAgICBpZiAodGhpcy5jb250YWluZXIpIHsgdGhpcy5jb250YWluZXIuZGlkQ2hhbmdlQWN0aXZlSXRlbU9uUGFuZSh0aGlzLCB0aGlzLmFjdGl2ZUl0ZW0pOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5hY3RpdmVJdGVtO1xyXG4gIH1cclxuXHJcbiAgLy8gQnVpbGQgdGhlIGl0ZW1TdGFjayBhZnRlciBkZXNlcmlhbGl6aW5nXHJcbiAgYWRkSXRlbXNUb1N0YWNrKGl0ZW1TdGFja0luZGljZXMpIHtcclxuICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgaWYgKGl0ZW1TdGFja0luZGljZXMubGVuZ3RoICE9PSB0aGlzLml0ZW1zLmxlbmd0aCB8fCBpdGVtU3RhY2tJbmRpY2VzLmluY2x1ZGVzKC0xKSkge1xyXG4gICAgICAgIGl0ZW1TdGFja0luZGljZXMgPSB0aGlzLml0ZW1zLm1hcCgoaXRlbSwgaSkgPT4gaSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3QgaXRlbUluZGV4IG9mIGl0ZW1TdGFja0luZGljZXMpIHtcclxuICAgICAgICB0aGlzLmFkZEl0ZW1Ub1N0YWNrKHRoaXMuaXRlbXNbaXRlbUluZGV4XSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEFkZCBpdGVtIChvciBtb3ZlIGl0ZW0pIHRvIHRoZSBlbmQgb2YgdGhlIGl0ZW1TdGFja1xyXG4gIGFkZEl0ZW1Ub1N0YWNrKG5ld0l0ZW0pIHtcclxuICAgIGlmIChuZXdJdGVtID09IG51bGwpIHsgcmV0dXJuOyB9XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuaXRlbVN0YWNrLmluZGV4T2YobmV3SXRlbSk7XHJcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7IHRoaXMuaXRlbVN0YWNrLnNwbGljZShpbmRleCwgMSk7IH1cclxuICAgIHJldHVybiB0aGlzLml0ZW1TdGFjay5wdXNoKG5ld0l0ZW0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBSZXR1cm4gdGhlIGl0ZW0gYXQgdGhlIGdpdmVuIGluZGV4LlxyXG4gIC8vXHJcbiAgLy8gKiBgaW5kZXhgIHtOdW1iZXJ9XHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIGl0ZW0gb3IgYG51bGxgIGlmIG5vIGl0ZW0gZXhpc3RzIGF0IHRoZSBnaXZlbiBpbmRleC5cclxuICBpdGVtQXRJbmRleChpbmRleCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXNbaW5kZXhdO1xyXG4gIH1cclxuXHJcbiAgLy8gTWFrZXMgdGhlIG5leHQgaXRlbSBpbiB0aGUgaXRlbVN0YWNrIGFjdGl2ZS5cclxuICBhY3RpdmF0ZU5leHRSZWNlbnRseVVzZWRJdGVtKCkge1xyXG4gICAgaWYgKHRoaXMuaXRlbXMubGVuZ3RoID4gMSkge1xyXG4gICAgICBpZiAodGhpcy5pdGVtU3RhY2tJbmRleCA9PSBudWxsKSB7IHRoaXMuaXRlbVN0YWNrSW5kZXggPSB0aGlzLml0ZW1TdGFjay5sZW5ndGggLSAxOyB9XHJcbiAgICAgIGlmICh0aGlzLml0ZW1TdGFja0luZGV4ID09PSAwKSB7IHRoaXMuaXRlbVN0YWNrSW5kZXggPSB0aGlzLml0ZW1TdGFjay5sZW5ndGg7IH1cclxuICAgICAgdGhpcy5pdGVtU3RhY2tJbmRleC0tO1xyXG4gICAgICBjb25zdCBuZXh0UmVjZW50bHlVc2VkSXRlbSA9IHRoaXMuaXRlbVN0YWNrW3RoaXMuaXRlbVN0YWNrSW5kZXhdO1xyXG4gICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0obmV4dFJlY2VudGx5VXNlZEl0ZW0sIHsgbW9kaWZ5U3RhY2s6IGZhbHNlIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTWFrZXMgdGhlIHByZXZpb3VzIGl0ZW0gaW4gdGhlIGl0ZW1TdGFjayBhY3RpdmUuXHJcbiAgYWN0aXZhdGVQcmV2aW91c1JlY2VudGx5VXNlZEl0ZW0oKSB7XHJcbiAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGlmICh0aGlzLml0ZW1TdGFja0luZGV4ICsgMSA9PT0gdGhpcy5pdGVtU3RhY2subGVuZ3RoIHx8IHRoaXMuaXRlbVN0YWNrSW5kZXggPT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuaXRlbVN0YWNrSW5kZXggPSAtMTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLml0ZW1TdGFja0luZGV4Kys7XHJcbiAgICAgIGNvbnN0IHByZXZpb3VzUmVjZW50bHlVc2VkSXRlbSA9IHRoaXMuaXRlbVN0YWNrW3RoaXMuaXRlbVN0YWNrSW5kZXhdO1xyXG4gICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0ocHJldmlvdXNSZWNlbnRseVVzZWRJdGVtLCB7IG1vZGlmeVN0YWNrOiBmYWxzZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIE1vdmVzIHRoZSBhY3RpdmUgaXRlbSB0byB0aGUgZW5kIG9mIHRoZSBpdGVtU3RhY2sgb25jZSB0aGUgY3RybCBrZXkgaXMgbGlmdGVkXHJcbiAgbW92ZUFjdGl2ZUl0ZW1Ub1RvcE9mU3RhY2soKSB7XHJcbiAgICBkZWxldGUgdGhpcy5pdGVtU3RhY2tJbmRleDtcclxuICAgIHRoaXMuYWRkSXRlbVRvU3RhY2sodGhpcy5hY3RpdmVJdGVtKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogTWFrZXMgdGhlIG5leHQgaXRlbSBhY3RpdmUuXHJcbiAgYWN0aXZhdGVOZXh0SXRlbSgpIHtcclxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5nZXRBY3RpdmVJdGVtSW5kZXgoKTtcclxuICAgIGlmIChpbmRleCA8ICh0aGlzLml0ZW1zLmxlbmd0aCAtIDEpKSB7XHJcbiAgICAgIHRoaXMuYWN0aXZhdGVJdGVtQXRJbmRleChpbmRleCArIDEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5hY3RpdmF0ZUl0ZW1BdEluZGV4KDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBNYWtlcyB0aGUgcHJldmlvdXMgaXRlbSBhY3RpdmUuXHJcbiAgYWN0aXZhdGVQcmV2aW91c0l0ZW0oKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0QWN0aXZlSXRlbUluZGV4KCk7XHJcbiAgICBpZiAoaW5kZXggPiAwKSB7XHJcbiAgICAgIHRoaXMuYWN0aXZhdGVJdGVtQXRJbmRleChpbmRleCAtIDEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5hY3RpdmF0ZUl0ZW1BdEluZGV4KHRoaXMuaXRlbXMubGVuZ3RoIC0gMSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhY3RpdmF0ZUxhc3RJdGVtKCkge1xyXG4gICAgdGhpcy5hY3RpdmF0ZUl0ZW1BdEluZGV4KHRoaXMuaXRlbXMubGVuZ3RoIC0gMSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IE1vdmUgdGhlIGFjdGl2ZSB0YWIgdG8gdGhlIHJpZ2h0LlxyXG4gIG1vdmVJdGVtUmlnaHQoKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0QWN0aXZlSXRlbUluZGV4KCk7XHJcbiAgICBjb25zdCByaWdodEl0ZW1JbmRleCA9IGluZGV4ICsgMTtcclxuICAgIGlmIChyaWdodEl0ZW1JbmRleCA8PSB0aGlzLml0ZW1zLmxlbmd0aCAtIDEpIHsgdGhpcy5tb3ZlSXRlbSh0aGlzLmdldEFjdGl2ZUl0ZW0oKSwgcmlnaHRJdGVtSW5kZXgpOyB9XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IE1vdmUgdGhlIGFjdGl2ZSB0YWIgdG8gdGhlIGxlZnRcclxuICBtb3ZlSXRlbUxlZnQoKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZ2V0QWN0aXZlSXRlbUluZGV4KCk7XHJcbiAgICBjb25zdCBsZWZ0SXRlbUluZGV4ID0gaW5kZXggLSAxO1xyXG4gICAgaWYgKGxlZnRJdGVtSW5kZXggPj0gMCkgeyByZXR1cm4gdGhpcy5tb3ZlSXRlbSh0aGlzLmdldEFjdGl2ZUl0ZW0oKSwgbGVmdEl0ZW1JbmRleCk7IH1cclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogR2V0IHRoZSBpbmRleCBvZiB0aGUgYWN0aXZlIGl0ZW0uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge051bWJlcn0uXHJcbiAgZ2V0QWN0aXZlSXRlbUluZGV4KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuaW5kZXhPZih0aGlzLmFjdGl2ZUl0ZW0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBBY3RpdmF0ZSB0aGUgaXRlbSBhdCB0aGUgZ2l2ZW4gaW5kZXguXHJcbiAgLy9cclxuICAvLyAqIGBpbmRleGAge051bWJlcn1cclxuICBhY3RpdmF0ZUl0ZW1BdEluZGV4KGluZGV4KSB7XHJcbiAgICBjb25zdCBpdGVtID0gdGhpcy5pdGVtQXRJbmRleChpbmRleCkgfHwgdGhpcy5nZXRBY3RpdmVJdGVtKCk7XHJcbiAgICByZXR1cm4gdGhpcy5zZXRBY3RpdmVJdGVtKGl0ZW0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBNYWtlIHRoZSBnaXZlbiBpdGVtICphY3RpdmUqLCBjYXVzaW5nIGl0IHRvIGJlIGRpc3BsYXllZCBieVxyXG4gIC8vIHRoZSBwYW5lJ3Mgdmlldy5cclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIFRoZSBpdGVtIHRvIGFjdGl2YXRlXHJcbiAgLy8gKiBgb3B0aW9uc2AgKG9wdGlvbmFsKSB7T2JqZWN0fVxyXG4gIC8vICAgKiBgcGVuZGluZ2AgKG9wdGlvbmFsKSB7Qm9vbGVhbn0gaW5kaWNhdGluZyB0aGF0IHRoZSBpdGVtIHNob3VsZCBiZSBhZGRlZFxyXG4gIC8vICAgICBpbiBhIHBlbmRpbmcgc3RhdGUgaWYgaXQgZG9lcyBub3QgeWV0IGV4aXN0IGluIHRoZSBwYW5lLiBFeGlzdGluZyBwZW5kaW5nXHJcbiAgLy8gICAgIGl0ZW1zIGluIGEgcGFuZSBhcmUgcmVwbGFjZWQgd2l0aCBuZXcgcGVuZGluZyBpdGVtcyB3aGVuIHRoZXkgYXJlIG9wZW5lZC5cclxuICBhY3RpdmF0ZUl0ZW0oaXRlbSwgb3B0aW9uczogYW55ID0ge30pIHtcclxuICAgIGlmIChpdGVtKSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gKHRoaXMuZ2V0UGVuZGluZ0l0ZW0oKSA9PT0gdGhpcy5hY3RpdmVJdGVtKVxyXG4gICAgICAgID8gdGhpcy5nZXRBY3RpdmVJdGVtSW5kZXgoKVxyXG4gICAgICAgIDogdGhpcy5nZXRBY3RpdmVJdGVtSW5kZXgoKSArIDE7XHJcbiAgICAgIHRoaXMuYWRkSXRlbShpdGVtLCBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7IGluZGV4IH0pKTtcclxuICAgICAgdGhpcy5zZXRBY3RpdmVJdGVtKGl0ZW0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBBZGQgdGhlIGdpdmVuIGl0ZW0gdG8gdGhlIHBhbmUuXHJcbiAgLy9cclxuICAvLyAqIGBpdGVtYCBUaGUgaXRlbSB0byBhZGQuIEl0IGNhbiBiZSBhIG1vZGVsIHdpdGggYW4gYXNzb2NpYXRlZCB2aWV3IG9yIGFcclxuICAvLyAgIHZpZXcuXHJcbiAgLy8gKiBgb3B0aW9uc2AgKG9wdGlvbmFsKSB7T2JqZWN0fVxyXG4gIC8vICAgKiBgaW5kZXhgIChvcHRpb25hbCkge051bWJlcn0gaW5kaWNhdGluZyB0aGUgaW5kZXggYXQgd2hpY2ggdG8gYWRkIHRoZSBpdGVtLlxyXG4gIC8vICAgICBJZiBvbWl0dGVkLCB0aGUgaXRlbSBpcyBhZGRlZCBhZnRlciB0aGUgY3VycmVudCBhY3RpdmUgaXRlbS5cclxuICAvLyAgICogYHBlbmRpbmdgIChvcHRpb25hbCkge0Jvb2xlYW59IGluZGljYXRpbmcgdGhhdCB0aGUgaXRlbSBzaG91bGQgYmVcclxuICAvLyAgICAgYWRkZWQgaW4gYSBwZW5kaW5nIHN0YXRlLiBFeGlzdGluZyBwZW5kaW5nIGl0ZW1zIGluIGEgcGFuZSBhcmUgcmVwbGFjZWQgd2l0aFxyXG4gIC8vICAgICBuZXcgcGVuZGluZyBpdGVtcyB3aGVuIHRoZXkgYXJlIG9wZW5lZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIGFkZGVkIGl0ZW0uXHJcbiAgYWRkSXRlbShpdGVtLCBvcHRpb25zOiBhbnkgPSB7fSkge1xyXG4gICAgLy8gQmFja3dhcmQgY29tcGF0IHdpdGggb2xkIEFQSTpcclxuICAgIC8vICAgYWRkSXRlbShpdGVtLCBpbmRleD1AZ2V0QWN0aXZlSXRlbUluZGV4KCkgKyAxKVxyXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnbnVtYmVyJykge1xyXG4gICAgICBvcHRpb25zID0geyBpbmRleDogb3B0aW9ucyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGluZGV4ID0gb3B0aW9ucy5pbmRleCAhPSBudWxsID8gb3B0aW9ucy5pbmRleCA6IHRoaXMuZ2V0QWN0aXZlSXRlbUluZGV4KCkgKyAxO1xyXG4gICAgY29uc3QgbW92ZWQgPSBvcHRpb25zLm1vdmVkICE9IG51bGwgPyBvcHRpb25zLm1vdmVkIDogZmFsc2U7XHJcbiAgICBjb25zdCBwZW5kaW5nID0gb3B0aW9ucy5wZW5kaW5nICE9IG51bGwgPyBvcHRpb25zLnBlbmRpbmcgOiBmYWxzZTtcclxuXHJcbiAgICBpZiAoIWl0ZW0gfHwgdHlwZW9mIGl0ZW0gIT09ICdvYmplY3QnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUGFuZSBpdGVtcyBtdXN0IGJlIG9iamVjdHMuIEF0dGVtcHRlZCB0byBhZGQgaXRlbSAke2l0ZW19LmApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgaXRlbS5pc0Rlc3Ryb3llZCA9PT0gJ2Z1bmN0aW9uJyAmJiBpdGVtLmlzRGVzdHJveWVkKCkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBZGRpbmcgYSBwYW5lIGl0ZW0gd2l0aCBVUklcclxuICAgICAgJyR7dHlwZW9mIGl0ZW0uZ2V0VVJJID09PSAnZnVuY3Rpb24nICYmIGl0ZW0uZ2V0VVJJKCl9JyB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gZGVzdHJveWVkYCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuaXRlbXMuZmluZChpdCA9PiBpdCA9PT0gaXRlbSkpIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBpdGVtLm9uRGlkRGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluZGV4LCAwLCBpdGVtKTtcclxuICAgIGNvbnN0IGxhc3RQZW5kaW5nSXRlbSA9IHRoaXMuZ2V0UGVuZGluZ0l0ZW0oKTtcclxuICAgIGNvbnN0IHJlcGxhY2luZ1BlbmRpbmdJdGVtID0gbGFzdFBlbmRpbmdJdGVtICE9IG51bGwgJiYgIW1vdmVkO1xyXG4gICAgaWYgKHJlcGxhY2luZ1BlbmRpbmdJdGVtKSB7IHRoaXMucGVuZGluZ0l0ZW0gPSBudWxsOyB9XHJcbiAgICBpZiAocGVuZGluZykgeyB0aGlzLnNldFBlbmRpbmdJdGVtKGl0ZW0pOyB9XHJcblxyXG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1hZGQtaXRlbScsIHsgaXRlbSwgaW5kZXgsIG1vdmVkIH0pO1xyXG4gICAgaWYgKCFtb3ZlZCkge1xyXG4gICAgICBpZiAodGhpcy5jb250YWluZXIpIHsgdGhpcy5jb250YWluZXIuZGlkQWRkUGFuZUl0ZW0oaXRlbSwgdGhpcywgaW5kZXgpOyB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcGxhY2luZ1BlbmRpbmdJdGVtKSB7IHRoaXMuZGVzdHJveUl0ZW0obGFzdFBlbmRpbmdJdGVtKTsgfVxyXG4gICAgaWYgKCF0aGlzLmdldEFjdGl2ZUl0ZW0oKSkgeyB0aGlzLnNldEFjdGl2ZUl0ZW0oaXRlbSk7IH1cclxuICAgIHJldHVybiBpdGVtO1xyXG4gIH1cclxuXHJcbiAgc2V0UGVuZGluZ0l0ZW0oaXRlbSkge1xyXG4gICAgaWYgKHRoaXMucGVuZGluZ0l0ZW0gIT09IGl0ZW0pIHtcclxuICAgICAgY29uc3QgbW9zdFJlY2VudFBlbmRpbmdJdGVtID0gdGhpcy5wZW5kaW5nSXRlbTtcclxuICAgICAgdGhpcy5wZW5kaW5nSXRlbSA9IGl0ZW07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRQZW5kaW5nSXRlbSgpIHtcclxuICAgIHJldHVybiB0aGlzLnBlbmRpbmdJdGVtIHx8IG51bGw7XHJcbiAgfVxyXG5cclxuICBjbGVhclBlbmRpbmdJdGVtKCkge1xyXG4gICAgdGhpcy5zZXRQZW5kaW5nSXRlbShudWxsKTtcclxuICB9XHJcblxyXG4gIG9uSXRlbURpZFRlcm1pbmF0ZVBlbmRpbmdTdGF0ZShjYWxsYmFjaykge1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBBZGQgdGhlIGdpdmVuIGl0ZW1zIHRvIHRoZSBwYW5lLlxyXG4gIC8vXHJcbiAgLy8gKiBgaXRlbXNgIEFuIHtBcnJheX0gb2YgaXRlbXMgdG8gYWRkLiBJdGVtcyBjYW4gYmUgdmlld3Mgb3IgbW9kZWxzIHdpdGhcclxuICAvLyAgIGFzc29jaWF0ZWQgdmlld3MuIEFueSBvYmplY3RzIHRoYXQgYXJlIGFscmVhZHkgcHJlc2VudCBpbiB0aGUgcGFuZSdzXHJcbiAgLy8gICBjdXJyZW50IGl0ZW1zIHdpbGwgbm90IGJlIGFkZGVkIGFnYWluLlxyXG4gIC8vICogYGluZGV4YCAob3B0aW9uYWwpIHtOdW1iZXJ9IGluZGV4IGF0IHdoaWNoIHRvIGFkZCB0aGUgaXRlbXMuIElmIG9taXR0ZWQsXHJcbiAgLy8gICB0aGUgaXRlbSBpcyAjICAgYWRkZWQgYWZ0ZXIgdGhlIGN1cnJlbnQgYWN0aXZlIGl0ZW0uXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGFuIHtBcnJheX0gb2YgYWRkZWQgaXRlbXMuXHJcbiAgYWRkSXRlbXMoaXRlbXM6IGFueVtdLCBpbmRleCA9IHRoaXMuZ2V0QWN0aXZlSXRlbUluZGV4KCkgKyAxKSB7XHJcbiAgICBpdGVtcyA9IGl0ZW1zLmZpbHRlcihpdGVtID0+ICF0aGlzLml0ZW1zLmZpbmQoaXQgPT4gaXQgPT09IGl0ZW0pKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgaXRlbSA9IGl0ZW1zW2ldO1xyXG4gICAgICB0aGlzLmFkZEl0ZW0oaXRlbSwgeyBpbmRleDogaW5kZXggKyBpIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGl0ZW1zO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlSXRlbShpdGVtLCBtb3ZlZCA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuaXRlbXMuaW5kZXhPZihpdGVtKTtcclxuICAgIGlmIChpbmRleCA9PT0gLTEpIHsgcmV0dXJuOyB9XHJcbiAgICBpZiAodGhpcy5nZXRQZW5kaW5nSXRlbSgpID09PSBpdGVtKSB7IHRoaXMucGVuZGluZ0l0ZW0gPSBudWxsOyB9XHJcbiAgICB0aGlzLnJlbW92ZUl0ZW1Gcm9tU3RhY2soaXRlbSk7XHJcbiAgICAvLyB0aGlzLmVtaXR0ZXIuZW1pdCgnd2lsbC1yZW1vdmUtaXRlbScsIHtpdGVtLCBpbmRleCwgZGVzdHJveWVkOiAhbW92ZWQsIG1vdmVkfSk7XHJcbiAgICB0aGlzLnVuc3Vic2NyaWJlRnJvbUl0ZW0oaXRlbSk7XHJcblxyXG4gICAgaWYgKGl0ZW0gPT09IHRoaXMuYWN0aXZlSXRlbSkge1xyXG4gICAgICBpZiAodGhpcy5pdGVtcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0odW5kZWZpbmVkKTtcclxuICAgICAgfSBlbHNlIGlmIChpbmRleCA9PT0gMCkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZhdGVOZXh0SXRlbSgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYWN0aXZhdGVQcmV2aW91c0l0ZW0oKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5pdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgdGhpcy5lbWl0dGVyLmVtaXQoJ2RpZC1yZW1vdmUtaXRlbScsIHsgaXRlbSwgaW5kZXgsIGRlc3Ryb3llZDogIW1vdmVkLCBtb3ZlZCB9KTtcclxuICAgIGlmICghbW92ZWQgJiYgdGhpcy5jb250YWluZXIpIHsgdGhpcy5jb250YWluZXIuZGlkRGVzdHJveVBhbmVJdGVtKHsgaXRlbSwgaW5kZXgsIHBhbmU6IHRoaXMgfSk7IH1cclxuICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA9PT0gMCAmJiB0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZy5nZXQgJiYgdGhpcy5jb25maWcuZ2V0KCdjb3JlLmRlc3Ryb3lFbXB0eVBhbmVzJykpIHtcclxuICAgICAgdGhpcy5kZXN0cm95KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBSZW1vdmUgdGhlIGdpdmVuIGl0ZW0gZnJvbSB0aGUgaXRlbVN0YWNrLlxyXG4gIC8vXHJcbiAgLy8gKiBgaXRlbWAgVGhlIGl0ZW0gdG8gcmVtb3ZlLlxyXG4gIC8vICogYGluZGV4YCB7TnVtYmVyfSBpbmRpY2F0aW5nIHRoZSBpbmRleCB0byB3aGljaCB0byByZW1vdmUgdGhlIGl0ZW0gZnJvbSB0aGUgaXRlbVN0YWNrLlxyXG4gIHJlbW92ZUl0ZW1Gcm9tU3RhY2soaXRlbSkge1xyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLml0ZW1TdGFjay5pbmRleE9mKGl0ZW0pO1xyXG4gICAgaWYgKGluZGV4ICE9PSAtMSkgeyB0aGlzLml0ZW1TdGFjay5zcGxpY2UoaW5kZXgsIDEpOyB9XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IE1vdmUgdGhlIGdpdmVuIGl0ZW0gdG8gdGhlIGdpdmVuIGluZGV4LlxyXG4gIC8vXHJcbiAgLy8gKiBgaXRlbWAgVGhlIGl0ZW0gdG8gbW92ZS5cclxuICAvLyAqIGBpbmRleGAge051bWJlcn0gaW5kaWNhdGluZyB0aGUgaW5kZXggdG8gd2hpY2ggdG8gbW92ZSB0aGUgaXRlbS5cclxuICBtb3ZlSXRlbShpdGVtLCBuZXdJbmRleCkge1xyXG4gICAgY29uc3Qgb2xkSW5kZXggPSB0aGlzLml0ZW1zLmluZGV4T2YoaXRlbSk7XHJcbiAgICB0aGlzLml0ZW1zLnNwbGljZShvbGRJbmRleCwgMSk7XHJcbiAgICB0aGlzLml0ZW1zLnNwbGljZShuZXdJbmRleCwgMCwgaXRlbSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IE1vdmUgdGhlIGdpdmVuIGl0ZW0gdG8gdGhlIGdpdmVuIGluZGV4IG9uIGFub3RoZXIgcGFuZS5cclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIFRoZSBpdGVtIHRvIG1vdmUuXHJcbiAgLy8gKiBgcGFuZWAge1BhbmV9IHRvIHdoaWNoIHRvIG1vdmUgdGhlIGl0ZW0uXHJcbiAgLy8gKiBgaW5kZXhgIHtOdW1iZXJ9IGluZGljYXRpbmcgdGhlIGluZGV4IHRvIHdoaWNoIHRvIG1vdmUgdGhlIGl0ZW0gaW4gdGhlXHJcbiAgLy8gICBnaXZlbiBwYW5lLlxyXG4gIG1vdmVJdGVtVG9QYW5lKGl0ZW0/LCBwYW5lPywgaW5kZXg/KSB7XHJcbiAgICB0aGlzLnJlbW92ZUl0ZW0oaXRlbSwgdHJ1ZSk7XHJcbiAgICByZXR1cm4gcGFuZS5hZGRJdGVtKGl0ZW0sIHsgaW5kZXgsIG1vdmVkOiB0cnVlIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBEZXN0cm95IHRoZSBhY3RpdmUgaXRlbSBhbmQgYWN0aXZhdGUgdGhlIG5leHQgaXRlbS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBpdGVtIGlzIGRlc3Ryb3llZC5cclxuICBkZXN0cm95QWN0aXZlSXRlbSgpIHtcclxuICAgIHJldHVybiB0aGlzLmRlc3Ryb3lJdGVtKHRoaXMuYWN0aXZlSXRlbSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IERlc3Ryb3kgdGhlIGdpdmVuIGl0ZW0uXHJcbiAgLy9cclxuICAvLyBJZiB0aGUgaXRlbSBpcyBhY3RpdmUsIHRoZSBuZXh0IGl0ZW0gd2lsbCBiZSBhY3RpdmF0ZWQuIElmIHRoZSBpdGVtIGlzIHRoZVxyXG4gIC8vIGxhc3QgaXRlbSwgdGhlIHBhbmUgd2lsbCBiZSBkZXN0cm95ZWQgaWYgdGhlIGBjb3JlLmRlc3Ryb3lFbXB0eVBhbmVzYCBjb25maWdcclxuICAvLyBzZXR0aW5nIGlzIGB0cnVlYC5cclxuICAvL1xyXG4gIC8vICogYGl0ZW1gIEl0ZW0gdG8gZGVzdHJveVxyXG4gIC8vICogYGZvcmNlYCAob3B0aW9uYWwpIHtCb29sZWFufSBEZXN0cm95IHRoZSBpdGVtIHdpdGhvdXQgcHJvbXB0aW5nIHRvIHNhdmVcclxuICAvLyAgICBpdCwgZXZlbiBpZiB0aGUgaXRlbSdzIGBpc1Blcm1hbmVudERvY2tJdGVtYCBtZXRob2QgcmV0dXJucyB0cnVlLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSB0aGF0IHJlc29sdmVzIHdpdGggYSB7Qm9vbGVhbn0gaW5kaWNhdGluZyB3aGV0aGVyIG9yIG5vdFxyXG4gIC8vIHRoZSBpdGVtIHdhcyBkZXN0cm95ZWQuXHJcbiAgYXN5bmMgZGVzdHJveUl0ZW0oaXRlbT86IGFueSwgZm9yY2U/KSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuaXRlbXMuaW5kZXhPZihpdGVtKTtcclxuICAgIGlmIChpbmRleCA9PT0gLTEpIHsgcmV0dXJuIGZhbHNlOyB9XHJcblxyXG4gICAgaWYgKCFmb3JjZSAmJlxyXG4gICAgICB0eXBlb2YgaXRlbS5pc1Blcm1hbmVudERvY2tJdGVtID09PSAnZnVuY3Rpb24nICYmIGl0ZW0uaXNQZXJtYW5lbnREb2NrSXRlbSgpICYmXHJcbiAgICAgICghdGhpcy5jb250YWluZXIgfHwgdGhpcy5jb250YWluZXIuZ2V0TG9jYXRpb24oKSAhPT0gJ2NlbnRlcicpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJbiB0aGUgY2FzZSB3aGVyZSB0aGVyZSBhcmUgbm8gYG9uV2lsbERlc3Ryb3lQYW5lSXRlbWAgbGlzdGVuZXJzLCBwcmVzZXJ2ZSB0aGUgb2xkIGJlaGF2aW9yXHJcbiAgICAvLyB3aGVyZSBgUGFuZS5kZXN0cm95SXRlbWAgYW5kIGNhbGxlcnMgc3VjaCBhcyBgUGFuZS5jbG9zZWAgdGFrZSBlZmZlY3Qgc3luY2hyb25vdXNseS5cclxuXHJcblxyXG4gICAgdGhpcy5yZW1vdmVJdGVtKGl0ZW0sIGZhbHNlKTtcclxuICAgIGlmICh0eXBlb2YgaXRlbS5kZXN0cm95ID09PSAnZnVuY3Rpb24nKSB7IGl0ZW0uZGVzdHJveSgpOyB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogRGVzdHJveSBhbGwgaXRlbXMuXHJcbiAgZGVzdHJveUl0ZW1zKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFxyXG4gICAgICB0aGlzLmdldEl0ZW1zKCkubWFwKGl0ZW0gPT4gdGhpcy5kZXN0cm95SXRlbShpdGVtKSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IERlc3Ryb3kgYWxsIGl0ZW1zIGV4Y2VwdCBmb3IgdGhlIGFjdGl2ZSBpdGVtLlxyXG4gIGRlc3Ryb3lJbmFjdGl2ZUl0ZW1zKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFxyXG4gICAgICB0aGlzLmdldEl0ZW1zKClcclxuICAgICAgICAuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gdGhpcy5hY3RpdmVJdGVtKVxyXG4gICAgICAgIC5tYXAoaXRlbSA9PiB0aGlzLmRlc3Ryb3lJdGVtKGl0ZW0pKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByb21wdFRvU2F2ZUl0ZW0oaXRlbSwgb3B0aW9ucyA9IHt9KTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBpZiAodHlwZW9mIGl0ZW0uc2hvdWxkUHJvbXB0VG9TYXZlICE9PSAnZnVuY3Rpb24nIHx8ICFpdGVtLnNob3VsZFByb21wdFRvU2F2ZShvcHRpb25zKSkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB1cmk7XHJcbiAgICBpZiAodHlwZW9mIGl0ZW0uZ2V0VVJJID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHVyaSA9IGl0ZW0uZ2V0VVJJKCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBpdGVtLmdldFVyaSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB1cmkgPSBpdGVtLmdldFVyaSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0aXRsZSA9ICh0eXBlb2YgaXRlbS5nZXRUaXRsZSA9PT0gJ2Z1bmN0aW9uJyAmJiBpdGVtLmdldFRpdGxlKCkpIHx8IHVyaTtcclxuXHJcbiAgICBjb25zdCBzYXZlRGlhbG9nID0gKHNhdmVCdXR0b25UZXh0LCBzYXZlRm4sIG1lc3NhZ2UpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcclxuICAgICAgY29uc3QgY2hvc2VuID0gdGhpcy5hcHBsaWNhdGlvbkRlbGVnYXRlLmNvbmZpcm0oe1xyXG4gICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgZGV0YWlsZWRNZXNzYWdlOiAnWW91ciBjaGFuZ2VzIHdpbGwgYmUgbG9zdCBpZiB5b3UgY2xvc2UgdGhpcyBpdGVtIHdpdGhvdXQgc2F2aW5nLicsXHJcbiAgICAgICAgYnV0dG9uczogW3NhdmVCdXR0b25UZXh0LCAnQ2FuY2VsJywgJyZEb25cXCd0IFNhdmUnXVxyXG4gICAgICB9XHJcbiAgICAgICk7XHJcblxyXG4gICAgICBzd2l0Y2ggKGNob3Nlbikge1xyXG4gICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHNhdmVGbihpdGVtLCBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgU2F2ZUNhbmNlbGxlZEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBzYXZlRGlhbG9nKFxyXG4gICAgICAgICAgICAgICAgICAnU2F2ZSBhcycsXHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUl0ZW1BcyxcclxuICAgICAgICAgICAgICAgICAgYCcke3RpdGxlfScgY291bGQgbm90IGJlIHNhdmVkLlxcbkVycm9yOiAke3RoaXMuZ2V0TWVzc2FnZUZvckVycm9yQ29kZShlcnJvci5jb2RlKX1gXHJcbiAgICAgICAgICAgICAgICApLnRoZW4ocmVzb2x2ZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHNhdmVEaWFsb2coXHJcbiAgICAgICdTYXZlJyxcclxuICAgICAgdGhpcy5zYXZlSXRlbSxcclxuICAgICAgYCcke3RpdGxlfScgaGFzIGNoYW5nZXMsIGRvIHlvdSB3YW50IHRvIHNhdmUgdGhlbT9gXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTYXZlIHRoZSBhY3RpdmUgaXRlbS5cclxuICBzYXZlQWN0aXZlSXRlbShuZXh0QWN0aW9uPzogKCkgPT4gYW55KSB7XHJcbiAgICByZXR1cm4gdGhpcy5zYXZlSXRlbSh0aGlzLmdldEFjdGl2ZUl0ZW0oKSwgbmV4dEFjdGlvbik7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFByb21wdCB0aGUgdXNlciBmb3IgYSBsb2NhdGlvbiBhbmQgc2F2ZSB0aGUgYWN0aXZlIGl0ZW0gd2l0aCB0aGVcclxuICAvLyBwYXRoIHRoZXkgc2VsZWN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgbmV4dEFjdGlvbmAgKG9wdGlvbmFsKSB7RnVuY3Rpb259IHdoaWNoIHdpbGwgYmUgY2FsbGVkIGFmdGVyIHRoZSBpdGVtIGlzXHJcbiAgLy8gICBzdWNjZXNzZnVsbHkgc2F2ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgc2F2ZSBpcyBjb21wbGV0ZVxyXG4gIHNhdmVBY3RpdmVJdGVtQXMobmV4dEFjdGlvbj86ICgpID0+IGFueSkge1xyXG4gICAgcmV0dXJuIHRoaXMuc2F2ZUl0ZW1Bcyh0aGlzLmdldEFjdGl2ZUl0ZW0oKSwgbmV4dEFjdGlvbik7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNhdmUgdGhlIGdpdmVuIGl0ZW0uXHJcbiAgLy9cclxuICAvLyAqIGBpdGVtYCBUaGUgaXRlbSB0byBzYXZlLlxyXG4gIC8vICogYG5leHRBY3Rpb25gIChvcHRpb25hbCkge0Z1bmN0aW9ufSB3aGljaCB3aWxsIGJlIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50XHJcbiAgLy8gICBhZnRlciB0aGUgaXRlbSBpcyBzdWNjZXNzZnVsbHkgc2F2ZWQsIG9yIHdpdGggdGhlIGVycm9yIGlmIGl0IGZhaWxlZC5cclxuICAvLyAgIFRoZSByZXR1cm4gdmFsdWUgd2lsbCBiZSB0aGF0IG9mIGBuZXh0QWN0aW9uYCBvciBgdW5kZWZpbmVkYCBpZiBpdCB3YXMgbm90XHJcbiAgLy8gICBwcm92aWRlZFxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHNhdmUgaXMgY29tcGxldGVcclxuICBzYXZlSXRlbShpdGVtLCBuZXh0QWN0aW9uKSB7XHJcbiAgICBpZiAoIWl0ZW0pIHsgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOyB9XHJcblxyXG4gICAgbGV0IGl0ZW1VUkk7XHJcbiAgICBpZiAodHlwZW9mIGl0ZW0uZ2V0VVJJID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGl0ZW1VUkkgPSBpdGVtLmdldFVSSSgpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgaXRlbS5nZXRVcmkgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgaXRlbVVSSSA9IGl0ZW0uZ2V0VXJpKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGl0ZW1VUkkgIT0gbnVsbCkge1xyXG4gICAgICBpZiAodHlwZW9mIGl0ZW0uc2F2ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnkoKCkgPT4gaXRlbS5zYXZlKCkpXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChuZXh0QWN0aW9uKSB7IG5leHRBY3Rpb24oKTsgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChuZXh0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgbmV4dEFjdGlvbihlcnJvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTYXZlRXJyb3IoZXJyb3IsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmIChuZXh0QWN0aW9uKSB7XHJcbiAgICAgICAgbmV4dEFjdGlvbigpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc2F2ZUl0ZW1BcyhpdGVtLCBuZXh0QWN0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogUHJvbXB0IHRoZSB1c2VyIGZvciBhIGxvY2F0aW9uIGFuZCBzYXZlIHRoZSBhY3RpdmUgaXRlbSB3aXRoIHRoZVxyXG4gIC8vIHBhdGggdGhleSBzZWxlY3QuXHJcbiAgLy9cclxuICAvLyAqIGBpdGVtYCBUaGUgaXRlbSB0byBzYXZlLlxyXG4gIC8vICogYG5leHRBY3Rpb25gIChvcHRpb25hbCkge0Z1bmN0aW9ufSB3aGljaCB3aWxsIGJlIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50XHJcbiAgLy8gICBhZnRlciB0aGUgaXRlbSBpcyBzdWNjZXNzZnVsbHkgc2F2ZWQsIG9yIHdpdGggdGhlIGVycm9yIGlmIGl0IGZhaWxlZC5cclxuICAvLyAgIFRoZSByZXR1cm4gdmFsdWUgd2lsbCBiZSB0aGF0IG9mIGBuZXh0QWN0aW9uYCBvciBgdW5kZWZpbmVkYCBpZiBpdCB3YXMgbm90XHJcbiAgLy8gICBwcm92aWRlZFxyXG4gIHNhdmVJdGVtQXMoaXRlbSwgbmV4dEFjdGlvbikge1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTYXZlIGFsbCBpdGVtcy5cclxuICBzYXZlSXRlbXMoKSB7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFJldHVybiB0aGUgZmlyc3QgaXRlbSB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIFVSSSBvciB1bmRlZmluZWQgaWZcclxuICAvLyBub25lIGV4aXN0cy5cclxuICAvL1xyXG4gIC8vICogYHVyaWAge1N0cmluZ30gY29udGFpbmluZyBhIFVSSS5cclxuICBpdGVtRm9yVVJJKHVyaSkge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmluZChpdGVtID0+IHtcclxuICAgICAgaWYgKHR5cGVvZiBpdGVtLmdldFVSSSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiBpdGVtLmdldFVSSSgpID09PSB1cmk7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGl0ZW0uZ2V0VXJpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0uZ2V0VXJpKCkgPT09IHVyaTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IEFjdGl2YXRlIHRoZSBmaXJzdCBpdGVtIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gVVJJLlxyXG4gIC8vXHJcbiAgLy8gKiBgdXJpYCB7U3RyaW5nfSBjb250YWluaW5nIGEgVVJJLlxyXG4gIC8vXHJcbiAgLy8gUmV0dXJucyBhIHtCb29sZWFufSBpbmRpY2F0aW5nIHdoZXRoZXIgYW4gaXRlbSBtYXRjaGluZyB0aGUgVVJJIHdhcyBmb3VuZC5cclxuICBhY3RpdmF0ZUl0ZW1Gb3JVUkkodXJpKSB7XHJcbiAgICBjb25zdCBpdGVtID0gdGhpcy5pdGVtRm9yVVJJKHVyaSk7XHJcbiAgICBpZiAoaXRlbSkge1xyXG4gICAgICB0aGlzLmFjdGl2YXRlSXRlbShpdGVtKTtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb3B5QWN0aXZlSXRlbSgpIHtcclxuICAgIGlmICh0aGlzLmFjdGl2ZUl0ZW0gJiYgdHlwZW9mIHRoaXMuYWN0aXZlSXRlbS5jb3B5ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUl0ZW0uY29weSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICBTZWN0aW9uOiBMaWZlY3ljbGVcclxuICAqL1xyXG5cclxuICAvLyBQdWJsaWM6IERldGVybWluZSB3aGV0aGVyIHRoZSBwYW5lIGlzIGFjdGl2ZS5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7Qm9vbGVhbn0uXHJcbiAgaXNBY3RpdmUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250YWluZXIgJiYgdGhpcy5jb250YWluZXIuZ2V0QWN0aXZlUGFuZSgpID09PSB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBNYWtlcyB0aGlzIHBhbmUgdGhlICphY3RpdmUqIHBhbmUsIGNhdXNpbmcgaXQgdG8gZ2FpbiBmb2N1cy5cclxuICBhY3RpdmF0ZSgpIHtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ2xvc2UgdGhlIHBhbmUgYW5kIGRlc3Ryb3kgYWxsIGl0cyBpdGVtcy5cclxuICAvL1xyXG4gIC8vIElmIHRoaXMgaXMgdGhlIGxhc3QgcGFuZSwgYWxsIHRoZSBpdGVtcyB3aWxsIGJlIGRlc3Ryb3llZCBidXQgdGhlIHBhbmVcclxuICAvLyBpdHNlbGYgd2lsbCBub3QgYmUgZGVzdHJveWVkLlxyXG4gIGRlc3Ryb3koKSB7XHJcbiAgfVxyXG5cclxuICBpc0FsaXZlKCkgeyByZXR1cm4gdGhpcy5hbGl2ZTsgfVxyXG5cclxuICAvLyBQdWJsaWM6IERldGVybWluZSB3aGV0aGVyIHRoaXMgcGFuZSBoYXMgYmVlbiBkZXN0cm95ZWQuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge0Jvb2xlYW59LlxyXG4gIGlzRGVzdHJveWVkKCkgeyByZXR1cm4gIXRoaXMuaXNBbGl2ZSgpOyB9XHJcblxyXG4gIC8qXHJcbiAgU2VjdGlvbjogU3BsaXR0aW5nXHJcbiAgKi9cclxuXHJcbiAgLy8gUHVibGljOiBDcmVhdGUgYSBuZXcgcGFuZSB0byB0aGUgbGVmdCBvZiB0aGlzIHBhbmUuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIChvcHRpb25hbCkge09iamVjdH0gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAqIGBpdGVtc2AgKG9wdGlvbmFsKSB7QXJyYXl9IG9mIGl0ZW1zIHRvIGFkZCB0byB0aGUgbmV3IHBhbmUuXHJcbiAgLy8gICAqIGBjb3B5QWN0aXZlSXRlbWAgKG9wdGlvbmFsKSB7Qm9vbGVhbn0gdHJ1ZSB3aWxsIGNvcHkgdGhlIGFjdGl2ZSBpdGVtIGludG8gdGhlIG5ldyBzcGxpdCBwYW5lXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIHRoZSBuZXcge1BhbmV9LlxyXG4gIHNwbGl0TGVmdChwYXJhbXMpIHtcclxuICAgIHJldHVybiB0aGlzLnNwbGl0KCdob3Jpem9udGFsJywgJ2JlZm9yZScsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENyZWF0ZSBhIG5ldyBwYW5lIHRvIHRoZSByaWdodCBvZiB0aGlzIHBhbmUuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIChvcHRpb25hbCkge09iamVjdH0gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAqIGBpdGVtc2AgKG9wdGlvbmFsKSB7QXJyYXl9IG9mIGl0ZW1zIHRvIGFkZCB0byB0aGUgbmV3IHBhbmUuXHJcbiAgLy8gICAqIGBjb3B5QWN0aXZlSXRlbWAgKG9wdGlvbmFsKSB7Qm9vbGVhbn0gdHJ1ZSB3aWxsIGNvcHkgdGhlIGFjdGl2ZSBpdGVtIGludG8gdGhlIG5ldyBzcGxpdCBwYW5lXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIHRoZSBuZXcge1BhbmV9LlxyXG4gIHNwbGl0UmlnaHQocGFyYW1zKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zcGxpdCgnaG9yaXpvbnRhbCcsICdhZnRlcicsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENyZWF0ZXMgYSBuZXcgcGFuZSBhYm92ZSB0aGUgcmVjZWl2ZXIuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIChvcHRpb25hbCkge09iamVjdH0gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XHJcbiAgLy8gICAqIGBpdGVtc2AgKG9wdGlvbmFsKSB7QXJyYXl9IG9mIGl0ZW1zIHRvIGFkZCB0byB0aGUgbmV3IHBhbmUuXHJcbiAgLy8gICAqIGBjb3B5QWN0aXZlSXRlbWAgKG9wdGlvbmFsKSB7Qm9vbGVhbn0gdHJ1ZSB3aWxsIGNvcHkgdGhlIGFjdGl2ZSBpdGVtIGludG8gdGhlIG5ldyBzcGxpdCBwYW5lXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIHRoZSBuZXcge1BhbmV9LlxyXG4gIHNwbGl0VXAocGFyYW1zKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zcGxpdCgndmVydGljYWwnLCAnYmVmb3JlJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogQ3JlYXRlcyBhIG5ldyBwYW5lIGJlbG93IHRoZSByZWNlaXZlci5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgKG9wdGlvbmFsKSB7T2JqZWN0fSB3aXRoIHRoZSBmb2xsb3dpbmcga2V5czpcclxuICAvLyAgICogYGl0ZW1zYCAob3B0aW9uYWwpIHtBcnJheX0gb2YgaXRlbXMgdG8gYWRkIHRvIHRoZSBuZXcgcGFuZS5cclxuICAvLyAgICogYGNvcHlBY3RpdmVJdGVtYCAob3B0aW9uYWwpIHtCb29sZWFufSB0cnVlIHdpbGwgY29weSB0aGUgYWN0aXZlIGl0ZW0gaW50byB0aGUgbmV3IHNwbGl0IHBhbmVcclxuICAvL1xyXG4gIC8vIFJldHVybnMgdGhlIG5ldyB7UGFuZX0uXHJcbiAgc3BsaXREb3duKHBhcmFtcykge1xyXG4gICAgcmV0dXJuIHRoaXMuc3BsaXQoJ3ZlcnRpY2FsJywgJ2FmdGVyJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIHNwbGl0KG9yaWVudGF0aW9uLCBzaWRlLCBwYXJhbXMpIHtcclxuICAgIGlmIChwYXJhbXMgJiYgcGFyYW1zLmNvcHlBY3RpdmVJdGVtKSB7XHJcbiAgICAgIGlmICghcGFyYW1zLml0ZW1zKSB7IHBhcmFtcy5pdGVtcyA9IFtdOyB9XHJcbiAgICAgIHBhcmFtcy5pdGVtcy5wdXNoKHRoaXMuY29weUFjdGl2ZUl0ZW0oKSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucGFyZW50Lm9yaWVudGF0aW9uICE9PSBvcmllbnRhdGlvbikge1xyXG4gICAgICB0aGlzLnBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcywgbmV3IFBhbmVBeGlzKHtcclxuICAgICAgICBjb250YWluZXI6IHRoaXMuY29udGFpbmVyLFxyXG4gICAgICAgIG9yaWVudGF0aW9uLFxyXG4gICAgICAgIGNoaWxkcmVuOiBbdGhpc10sXHJcbiAgICAgICAgZmxleFNjYWxlOiB0aGlzLmZsZXhTY2FsZVxyXG4gICAgICB9LFxyXG4gICAgICAgIHRoaXMudmlld1JlZ2lzdHJ5XHJcbiAgICAgICkpO1xyXG4gICAgICB0aGlzLnNldEZsZXhTY2FsZSgxKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBuZXdQYW5lID0gbmV3IFBhbmUoT2JqZWN0LmFzc2lnbih7XHJcbiAgICAgIGFwcGxpY2F0aW9uRGVsZWdhdGU6IHRoaXMuYXBwbGljYXRpb25EZWxlZ2F0ZSxcclxuICAgICAgbm90aWZpY2F0aW9uTWFuYWdlcjogdGhpcy5ub3RpZmljYXRpb25NYW5hZ2VyLFxyXG4gICAgICBkZXNlcmlhbGl6ZXJNYW5hZ2VyOiB0aGlzLmRlc2VyaWFsaXplck1hbmFnZXIsXHJcbiAgICAgIGNvbmZpZzogdGhpcy5jb25maWcsXHJcbiAgICAgIHZpZXdSZWdpc3RyeTogdGhpcy52aWV3UmVnaXN0cnlcclxuICAgIH0sIHBhcmFtcykpO1xyXG5cclxuICAgIHN3aXRjaCAoc2lkZSkge1xyXG4gICAgICBjYXNlICdiZWZvcmUnOiB0aGlzLnBhcmVudC5pbnNlcnRDaGlsZEJlZm9yZSh0aGlzLCBuZXdQYW5lKTsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2FmdGVyJzogdGhpcy5wYXJlbnQuaW5zZXJ0Q2hpbGRBZnRlcih0aGlzLCBuZXdQYW5lKTsgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHBhcmFtcyAmJiBwYXJhbXMubW92ZUFjdGl2ZUl0ZW0gJiYgdGhpcy5hY3RpdmVJdGVtKSB7XHJcbiAgICAgIHRoaXMubW92ZUl0ZW1Ub1BhbmUodGhpcy5hY3RpdmVJdGVtLCBuZXdQYW5lKTtcclxuICAgIH1cclxuXHJcbiAgICBuZXdQYW5lLmFjdGl2YXRlKCk7XHJcbiAgICByZXR1cm4gbmV3UGFuZTtcclxuICB9XHJcblxyXG4gIC8vIElmIHRoZSBwYXJlbnQgaXMgYSBob3Jpem9udGFsIGF4aXMsIHJldHVybnMgaXRzIGZpcnN0IGNoaWxkIGlmIGl0IGlzIGEgcGFuZTtcclxuICAvLyBvdGhlcndpc2UgcmV0dXJucyB0aGlzIHBhbmUuXHJcbiAgZmluZExlZnRtb3N0U2libGluZygpIHtcclxuICAgIGlmICh0aGlzLnBhcmVudC5vcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XHJcbiAgICAgIGNvbnN0IFtsZWZ0bW9zdFNpYmxpbmddID0gdGhpcy5wYXJlbnQuY2hpbGRyZW47XHJcbiAgICAgIGlmIChsZWZ0bW9zdFNpYmxpbmcgaW5zdGFuY2VvZiBQYW5lQXhpcykge1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBsZWZ0bW9zdFNpYmxpbmc7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZmluZFJpZ2h0bW9zdFNpYmxpbmcoKSB7XHJcbiAgICBpZiAodGhpcy5wYXJlbnQub3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJykge1xyXG4gICAgICBjb25zdCByaWdodG1vc3RTaWJsaW5nID0gdGhpcy5wYXJlbnQuY2hpbGRyZW5bdGhpcy5wYXJlbnQuY2hpbGRyZW4ubGVuZ3RoIC0gMV07XHJcbiAgICAgIGlmIChyaWdodG1vc3RTaWJsaW5nIGluc3RhbmNlb2YgUGFuZUF4aXMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gcmlnaHRtb3N0U2libGluZztcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBJZiB0aGUgcGFyZW50IGlzIGEgaG9yaXpvbnRhbCBheGlzLCByZXR1cm5zIGl0cyBsYXN0IGNoaWxkIGlmIGl0IGlzIGEgcGFuZTtcclxuICAvLyBvdGhlcndpc2UgcmV0dXJucyBhIG5ldyBwYW5lIGNyZWF0ZWQgYnkgc3BsaXR0aW5nIHRoaXMgcGFuZSByaWdodHdhcmQuXHJcbiAgZmluZE9yQ3JlYXRlUmlnaHRtb3N0U2libGluZygpIHtcclxuICAgIGNvbnN0IHJpZ2h0bW9zdFNpYmxpbmcgPSB0aGlzLmZpbmRSaWdodG1vc3RTaWJsaW5nKCk7XHJcbiAgICBpZiAocmlnaHRtb3N0U2libGluZyA9PT0gdGhpcykge1xyXG4gICAgICByZXR1cm4gdGhpcy5zcGxpdFJpZ2h0KHt9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiByaWdodG1vc3RTaWJsaW5nO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gSWYgdGhlIHBhcmVudCBpcyBhIHZlcnRpY2FsIGF4aXMsIHJldHVybnMgaXRzIGZpcnN0IGNoaWxkIGlmIGl0IGlzIGEgcGFuZTtcclxuICAvLyBvdGhlcndpc2UgcmV0dXJucyB0aGlzIHBhbmUuXHJcbiAgZmluZFRvcG1vc3RTaWJsaW5nKCkge1xyXG4gICAgaWYgKHRoaXMucGFyZW50Lm9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7XHJcbiAgICAgIGNvbnN0IFt0b3Btb3N0U2libGluZ10gPSB0aGlzLnBhcmVudC5jaGlsZHJlbjtcclxuICAgICAgaWYgKHRvcG1vc3RTaWJsaW5nIGluc3RhbmNlb2YgUGFuZUF4aXMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdG9wbW9zdFNpYmxpbmc7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZmluZEJvdHRvbW1vc3RTaWJsaW5nKCkge1xyXG4gICAgaWYgKHRoaXMucGFyZW50Lm9yaWVudGF0aW9uID09PSAndmVydGljYWwnKSB7XHJcbiAgICAgIGNvbnN0IGJvdHRvbW1vc3RTaWJsaW5nID0gdGhpcy5wYXJlbnQuY2hpbGRyZW5bdGhpcy5wYXJlbnQuY2hpbGRyZW4ubGVuZ3RoIC0gMV07XHJcbiAgICAgIGlmIChib3R0b21tb3N0U2libGluZyBpbnN0YW5jZW9mIFBhbmVBeGlzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGJvdHRvbW1vc3RTaWJsaW5nO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIElmIHRoZSBwYXJlbnQgaXMgYSB2ZXJ0aWNhbCBheGlzLCByZXR1cm5zIGl0cyBsYXN0IGNoaWxkIGlmIGl0IGlzIGEgcGFuZTtcclxuICAvLyBvdGhlcndpc2UgcmV0dXJucyBhIG5ldyBwYW5lIGNyZWF0ZWQgYnkgc3BsaXR0aW5nIHRoaXMgcGFuZSBib3R0b213YXJkLlxyXG4gIGZpbmRPckNyZWF0ZUJvdHRvbW1vc3RTaWJsaW5nKCkge1xyXG4gICAgY29uc3QgYm90dG9tbW9zdFNpYmxpbmcgPSB0aGlzLmZpbmRCb3R0b21tb3N0U2libGluZygpO1xyXG4gICAgaWYgKGJvdHRvbW1vc3RTaWJsaW5nID09PSB0aGlzKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnNwbGl0RG93bih7fSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gYm90dG9tbW9zdFNpYmxpbmc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBQcml2YXRlOiBDbG9zZSB0aGUgcGFuZSB1bmxlc3MgdGhlIHVzZXIgY2FuY2VscyB0aGUgYWN0aW9uIHZpYSBhIGRpYWxvZy5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gdGhhdCByZXNvbHZlcyBvbmNlIHRoZSBwYW5lIGlzIGVpdGhlciBjbG9zZWQsIG9yIHRoZVxyXG4gIC8vIGNsb3NpbmcgaGFzIGJlZW4gY2FuY2VsbGVkLlxyXG4gIGNsb3NlKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHRoaXMuZ2V0SXRlbXMoKS5tYXAoaXRlbSA9PiB0aGlzLnByb21wdFRvU2F2ZUl0ZW0oaXRlbSkpKVxyXG4gICAgICAudGhlbihyZXN1bHRzID0+IHtcclxuICAgICAgICBpZiAoIXJlc3VsdHMuZmluZChpdGVtID0+IGl0ZW0gPT09IGZhbHNlKSkgeyByZXR1cm4gdGhpcy5kZXN0cm95KCk7IH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVTYXZlRXJyb3IoZXJyb3IsIGl0ZW0pIHtcclxuICB9XHJcblxyXG4gIGdldE1lc3NhZ2VGb3JFcnJvckNvZGUoZXJyb3JDb2RlKSB7XHJcbiAgICBzd2l0Y2ggKGVycm9yQ29kZSkge1xyXG4gICAgICBjYXNlICdFQUNDRVMnOiByZXR1cm4gJ1Blcm1pc3Npb24gZGVuaWVkJztcclxuICAgICAgY2FzZSAnRUNPTk5SRVNFVCc6IHJldHVybiAnQ29ubmVjdGlvbiByZXNldCc7XHJcbiAgICAgIGNhc2UgJ0VJTlRSJzogcmV0dXJuICdJbnRlcnJ1cHRlZCBzeXN0ZW0gY2FsbCc7XHJcbiAgICAgIGNhc2UgJ0VJTyc6IHJldHVybiAnSS9PIGVycm9yIHdyaXRpbmcgZmlsZSc7XHJcbiAgICAgIGNhc2UgJ0VOT1NQQyc6IHJldHVybiAnTm8gc3BhY2UgbGVmdCBvbiBkZXZpY2UnO1xyXG4gICAgICBjYXNlICdFTk9UU1VQJzogcmV0dXJuICdPcGVyYXRpb24gbm90IHN1cHBvcnRlZCBvbiBzb2NrZXQnO1xyXG4gICAgICBjYXNlICdFTlhJTyc6IHJldHVybiAnTm8gc3VjaCBkZXZpY2Ugb3IgYWRkcmVzcyc7XHJcbiAgICAgIGNhc2UgJ0VST0ZTJzogcmV0dXJuICdSZWFkLW9ubHkgZmlsZSBzeXN0ZW0nO1xyXG4gICAgICBjYXNlICdFU1BJUEUnOiByZXR1cm4gJ0ludmFsaWQgc2Vlayc7XHJcbiAgICAgIGNhc2UgJ0VUSU1FRE9VVCc6IHJldHVybiAnQ29ubmVjdGlvbiB0aW1lZCBvdXQnO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcHJvbWlzaWZ5KGNhbGxiYWNrKSB7XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgfVxyXG59XHJcbiJdfQ==
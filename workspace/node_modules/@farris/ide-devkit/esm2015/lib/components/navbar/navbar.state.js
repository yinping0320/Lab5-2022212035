/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Injectable } from '@angular/core';
export class NavbarState {
    constructor() {
        this.dropdownInstances = [];
        this.menuItems = [];
        this.subscriptions = [];
        // 当前下拉菜单的子菜单
        this.onItemClick = new EventEmitter();
    }
    /**
     * @param {?} dropdown
     * @return {?}
     */
    addDropdown(dropdown) {
        if (!this.dropdownInstances.find((item) => item === dropdown)) {
            this.dropdownInstances.push(dropdown);
            this.subscribeDropdown(dropdown);
            dropdown.onShown.subscribe(() => setTimeout(() => {
                dropdown.childDropdowns.forEach((item) => this.addDropdown(item));
            }));
        }
    }
    /**
     * @param {?} menuItem
     * @return {?}
     */
    addMenuItem(menuItem) {
        if (!this.menuItems.find((item) => item === menuItem)) {
            this.menuItems.push(menuItem);
            this.subscribeMenuItem(menuItem);
        }
    }
    /**
     * @private
     * @param {?} dropdown
     * @return {?}
     */
    subscribeDropdown(dropdown) {
        // 在下拉菜单显示、隐藏时，记录下显示状态。
        // this.subscriptions.push(
        //   dropdown.onShown.subscribe((value) => {
        //     debugger;
        //     if(dropdown.isSubMenu) {
        //
        //     }
        //   })
        // );
        //
        // this.subscriptions.push(
        //   dropdown.onHidden.subscribe((value) => {
        //
        //   })
        // );
        this.subscriptions.push(dropdown.state.onClick.subscribe((event) => {
            if (dropdown.level === 1) {
                if (dropdown.isOpen && this.level1Dropdown === dropdown) {
                    this.innerHideL1Dropdown();
                }
                else {
                    this.innerShowL1Dropdown(dropdown);
                }
            }
            else if (dropdown.level === 2) {
                if (!dropdown.isOpen || this.level2Dropdown !== dropdown) {
                    this.innerShowL2Dropdown(dropdown);
                }
            }
            event.stopPropagation();
        }));
        this.subscriptions.push(dropdown.state.onHover.subscribe(() => {
            if (!this.level1Dropdown) {
                // 菜单没展开，鼠标悬停没有效果
                return;
            }
            this.show(dropdown);
        }));
    }
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    subscribeMenuItem(menuItem) {
        this.subscriptions.push(menuItem.onHover.subscribe(() => {
            if (!this.level1Dropdown) {
                return;
            }
            if (this.level1Dropdown.containsItem(menuItem)) {
                this.innerHideL2Dropdown();
            }
        }));
        this.subscriptions.push(menuItem.onClick.subscribe((command) => {
            this.onItemClick.emit(command);
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscriptions.forEach((sub) => {
            sub.unsubscribe();
        });
    }
    /**
     * @return {?}
     */
    hideCurrentDropdown() {
        if (this.level2Dropdown) {
            this.innerHideL2Dropdown();
        }
        else {
            this.innerHideL1Dropdown();
        }
    }
    /**
     * @return {?}
     */
    hideAllDropdown() {
        this.innerHideL2Dropdown();
        this.innerHideL1Dropdown();
    }
    /**
     * @param {?} dropdown
     * @return {?}
     */
    show(dropdown) {
        if (dropdown.level === 1) {
            if (dropdown !== this.level1Dropdown) {
                this.innerShowL1Dropdown(dropdown);
            }
            this.innerHideL2Dropdown();
        }
        else if (dropdown.level === 2) {
            if (dropdown !== this.level2Dropdown) {
                this.innerShowL2Dropdown(dropdown);
            }
        }
        ///////////////////////////////
        /*if (this.isMenuShown && this.isSubMenuShown && this.parentDropdown && this.parentDropdown.containsItem(dropdown)) {
          // 要显示的是子菜单，不是当前子菜单
          if (this.currentDropdown && this.currentDropdown !== dropdown) {
            this.currentDropdown.hide();
          }
          dropdown.show();
          this.currentDropdown = dropdown;
          this.isSubMenuShown = true;
        } else if (this.isMenuShown && !this.isSubMenuShown && this.currentDropdown && this.currentDropdown.containsItem(dropdown)) {
    
        } else {
          // 主菜单
          if (this.isSubMenuShown && this.currentDropdown && this.parentDropdown) {
            this.currentDropdown.hide();
            this.currentDropdown = null;
            this.isSubMenuShown = false;
          }
          if (this.isMenuShown && this.currentDropdown && this.currentDropdown !== dropdown) {
            this.currentDropdown.hide();
          }
          dropdown.show();
          this.currentDropdown = dropdown;
          this.isMenuShown = true;
        }*/
    }
    /**
     * @param {?} dropdown
     * @return {?}
     */
    hide(dropdown) {
        // if
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    innerShowL1Dropdown(target) {
        if (this.level1Dropdown) {
            this.level1Dropdown.hide();
        }
        target.show();
        this.level1Dropdown = target;
    }
    /**
     * @private
     * @return {?}
     */
    innerHideL1Dropdown() {
        if (this.level1Dropdown) {
            this.level1Dropdown.hide();
            this.level1Dropdown = null;
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    innerShowL2Dropdown(target) {
        if (this.level2Dropdown) {
            this.level2Dropdown.hide();
        }
        target.show();
        this.level2Dropdown = target;
    }
    /**
     * @private
     * @return {?}
     */
    innerHideL2Dropdown() {
        if (this.level2Dropdown) {
            this.level2Dropdown.hide();
            this.level2Dropdown = null;
        }
    }
}
NavbarState.decorators = [
    { type: Injectable }
];
/** @nocollapse */
NavbarState.ctorParameters = () => [];
if (false) {
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.dropdownInstances;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.menuItems;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.level1Dropdown;
    /**
     * @type {?}
     * @private
     */
    NavbarState.prototype.level2Dropdown;
    /** @type {?} */
    NavbarState.prototype.onItemClick;
    /** @type {?} */
    NavbarState.prototype.autoClose;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2YmFyLnN0YXRlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9pZGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbmF2YmFyL25hdmJhci5zdGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFhLFlBQVksRUFBRSxVQUFVLEVBQVksTUFBTSxlQUFlLENBQUM7QUFPOUUsTUFBTSxPQUFPLFdBQVc7SUFZdEI7UUFYUSxzQkFBaUIsR0FBMEIsRUFBRSxDQUFDO1FBQzlDLGNBQVMsR0FBNEIsRUFBRSxDQUFDO1FBQ3hDLGtCQUFhLEdBQW1CLEVBQUUsQ0FBQzs7UUFLM0MsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO0lBTXpDLENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFDLFFBQTZCO1FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDLEVBQUU7WUFDN0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDakMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDL0MsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUF5QixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDekYsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNMO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxXQUFXLENBQUMsUUFBK0I7UUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJ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QUU7WUFDdkIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUM1QjtRQUNELE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDO0lBQy9CLENBQUM7Ozs7O0lBRU8sbUJBQW1CO1FBQ3pCLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN2QixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1NBQzVCO0lBQ0gsQ0FBQzs7O1lBOUxGLFVBQVU7Ozs7Ozs7OztJQUVULHdDQUFzRDs7Ozs7SUFDdEQsZ0NBQWdEOzs7OztJQUNoRCxvQ0FBMkM7Ozs7O0lBRTNDLHFDQUE0Qzs7Ozs7SUFDNUMscUNBQTRDOztJQUU1QyxrQ0FBeUM7O0lBRXpDLGdDQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbmplY3RhYmxlLCBPbkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0JzRHJvcGRvd25EaXJlY3RpdmV9IGZyb20gJy4uL2Ryb3Bkb3duL2luZGV4JztcclxuaW1wb3J0IHtTdWJzY3JpcHRpb259IGZyb20gJ3J4anMvU3Vic2NyaXB0aW9uJztcclxuaW1wb3J0IHtCc0Ryb3Bkb3duU3RhdGV9IGZyb20gJy4uL2Ryb3Bkb3duL2Ryb3Bkb3duLnN0YXRlJztcclxuaW1wb3J0IHtEcm9wZG93bkl0ZW1EaXJlY3RpdmV9IGZyb20gJy4uL2Ryb3Bkb3duL2Ryb3Bkb3duLWl0ZW0uZGlyZWN0aXZlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIE5hdmJhclN0YXRlIGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuICBwcml2YXRlIGRyb3Bkb3duSW5zdGFuY2VzOiBCc0Ryb3Bkb3duRGlyZWN0aXZlW10gPSBbXTtcclxuICBwcml2YXRlIG1lbnVJdGVtczogRHJvcGRvd25JdGVtRGlyZWN0aXZlW10gPSBbXTtcclxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XHJcblxyXG4gIHByaXZhdGUgbGV2ZWwxRHJvcGRvd246IEJzRHJvcGRvd25EaXJlY3RpdmU7IC8vIOW9k+WJjeS4i+aLieiPnOWNleeahOS4u+iPnOWNle+8jFxyXG4gIHByaXZhdGUgbGV2ZWwyRHJvcGRvd246IEJzRHJvcGRvd25EaXJlY3RpdmU7IC8vIOW9k+WJjeS4i+aLieiPnOWNleeahOWtkOiPnOWNlVxyXG5cclxuICBvbkl0ZW1DbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG5cclxuICBhdXRvQ2xvc2U6IGJvb2xlYW47XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICB9XHJcblxyXG4gIGFkZERyb3Bkb3duKGRyb3Bkb3duOiBCc0Ryb3Bkb3duRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuZHJvcGRvd25JbnN0YW5jZXMuZmluZCgoaXRlbSkgPT4gaXRlbSA9PT0gZHJvcGRvd24pKSB7XHJcbiAgICAgIHRoaXMuZHJvcGRvd25JbnN0YW5jZXMucHVzaChkcm9wZG93bik7XHJcbiAgICAgIHRoaXMuc3Vic2NyaWJlRHJvcGRvd24oZHJvcGRvd24pO1xyXG4gICAgICBkcm9wZG93bi5vblNob3duLnN1YnNjcmliZSgoKSA9PiBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBkcm9wZG93bi5jaGlsZERyb3Bkb3ducy5mb3JFYWNoKChpdGVtOiBCc0Ryb3Bkb3duRGlyZWN0aXZlKSA9PiB0aGlzLmFkZERyb3Bkb3duKGl0ZW0pKTtcclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkTWVudUl0ZW0obWVudUl0ZW06IERyb3Bkb3duSXRlbURpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLm1lbnVJdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtID09PSBtZW51SXRlbSkpIHtcclxuICAgICAgdGhpcy5tZW51SXRlbXMucHVzaChtZW51SXRlbSk7XHJcbiAgICAgIHRoaXMuc3Vic2NyaWJlTWVudUl0ZW0obWVudUl0ZW0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdWJzY3JpYmVEcm9wZG93bihkcm9wZG93bjogQnNEcm9wZG93bkRpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgLy8g5Zyo5LiL5ouJ6I+c5Y2V5pi+56S644CB6ZqQ6JeP5pe277yM6K6w5b2V5LiL5pi+56S654q25oCB44CCXHJcbiAgICAvLyB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcclxuICAgIC8vICAgZHJvcGRvd24ub25TaG93bi5zdWJzY3JpYmUoKHZhbHVlKSA9PiB7XHJcbiAgICAvLyAgICAgZGVidWdnZXI7XHJcbiAgICAvLyAgICAgaWYoZHJvcGRvd24uaXNTdWJNZW51KSB7XHJcbiAgICAvL1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vICAgfSlcclxuICAgIC8vICk7XHJcbiAgICAvL1xyXG4gICAgLy8gdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAvLyAgIGRyb3Bkb3duLm9uSGlkZGVuLnN1YnNjcmliZSgodmFsdWUpID0+IHtcclxuICAgIC8vXHJcbiAgICAvLyAgIH0pXHJcbiAgICAvLyApO1xyXG5cclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFxyXG4gICAgICBkcm9wZG93bi5zdGF0ZS5vbkNsaWNrLnN1YnNjcmliZSgoZXZlbnQ6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKGRyb3Bkb3duLmxldmVsID09PSAxKSB7XHJcbiAgICAgICAgICBpZiAoZHJvcGRvd24uaXNPcGVuICYmIHRoaXMubGV2ZWwxRHJvcGRvd24gPT09IGRyb3Bkb3duKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5uZXJIaWRlTDFEcm9wZG93bigpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pbm5lclNob3dMMURyb3Bkb3duKGRyb3Bkb3duKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGRyb3Bkb3duLmxldmVsID09PSAyKSB7XHJcbiAgICAgICAgICBpZiAoIWRyb3Bkb3duLmlzT3BlbiB8fCB0aGlzLmxldmVsMkRyb3Bkb3duICE9PSBkcm9wZG93bikge1xyXG4gICAgICAgICAgICB0aGlzLmlubmVyU2hvd0wyRHJvcGRvd24oZHJvcGRvd24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAgIGRyb3Bkb3duLnN0YXRlLm9uSG92ZXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMubGV2ZWwxRHJvcGRvd24pIHtcclxuICAgICAgICAgIC8vIOiPnOWNleayoeWxleW8gO+8jOm8oOagh+aCrOWBnOayoeacieaViOaenFxyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNob3coZHJvcGRvd24pO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3Vic2NyaWJlTWVudUl0ZW0obWVudUl0ZW06IERyb3Bkb3duSXRlbURpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAgIG1lbnVJdGVtLm9uSG92ZXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMubGV2ZWwxRHJvcGRvd24pIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubGV2ZWwxRHJvcGRvd24uY29udGFpbnNJdGVtKG1lbnVJdGVtKSkge1xyXG4gICAgICAgICAgdGhpcy5pbm5lckhpZGVMMkRyb3Bkb3duKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcclxuICAgICAgbWVudUl0ZW0ub25DbGljay5zdWJzY3JpYmUoKGNvbW1hbmQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRoaXMub25JdGVtQ2xpY2suZW1pdChjb21tYW5kKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKChzdWIpID0+IHtcclxuICAgICAgc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGhpZGVDdXJyZW50RHJvcGRvd24oKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5sZXZlbDJEcm9wZG93bikge1xyXG4gICAgICB0aGlzLmlubmVySGlkZUwyRHJvcGRvd24oKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaW5uZXJIaWRlTDFEcm9wZG93bigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGlkZUFsbERyb3Bkb3duKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pbm5lckhpZGVMMkRyb3Bkb3duKCk7XHJcbiAgICB0aGlzLmlubmVySGlkZUwxRHJvcGRvd24oKTtcclxuICB9XHJcblxyXG4gIHNob3coZHJvcGRvd246IEJzRHJvcGRvd25EaXJlY3RpdmUpOiB2b2lkIHtcclxuICAgIGlmIChkcm9wZG93bi5sZXZlbCA9PT0gMSkge1xyXG4gICAgICBpZiAoZHJvcGRvd24gIT09IHRoaXMubGV2ZWwxRHJvcGRvd24pIHtcclxuICAgICAgICB0aGlzLmlubmVyU2hvd0wxRHJvcGRvd24oZHJvcGRvd24pO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuaW5uZXJIaWRlTDJEcm9wZG93bigpO1xyXG4gICAgfSBlbHNlIGlmIChkcm9wZG93bi5sZXZlbCA9PT0gMikge1xyXG4gICAgICBpZiAoZHJvcGRvd24gIT09IHRoaXMubGV2ZWwyRHJvcGRvd24pIHtcclxuICAgICAgICB0aGlzLmlubmVyU2hvd0wyRHJvcGRvd24oZHJvcGRvd24pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICAvKmlmICh0aGlzLmlzTWVudVNob3duICYmIHRoaXMuaXNTdWJNZW51U2hvd24gJiYgdGhpcy5wYXJlbnREcm9wZG93biAmJiB0aGlzLnBhcmVudERyb3Bkb3duLmNvbnRhaW5zSXRlbShkcm9wZG93bikpIHtcclxuICAgICAgLy8g6KaB5pi+56S655qE5piv5a2Q6I+c5Y2V77yM5LiN5piv5b2T5YmN5a2Q6I+c5Y2VXHJcbiAgICAgIGlmICh0aGlzLmN1cnJlbnREcm9wZG93biAmJiB0aGlzLmN1cnJlbnREcm9wZG93biAhPT0gZHJvcGRvd24pIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnREcm9wZG93bi5oaWRlKCk7XHJcbiAgICAgIH1cclxuICAgICAgZHJvcGRvd24uc2hvdygpO1xyXG4gICAgICB0aGlzLmN1cnJlbnREcm9wZG93biA9IGRyb3Bkb3duO1xyXG4gICAgICB0aGlzLmlzU3ViTWVudVNob3duID0gdHJ1ZTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5pc01lbnVTaG93biAmJiAhdGhpcy5pc1N1Yk1lbnVTaG93biAmJiB0aGlzLmN1cnJlbnREcm9wZG93biAmJiB0aGlzLmN1cnJlbnREcm9wZG93bi5jb250YWluc0l0ZW0oZHJvcGRvd24pKSB7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5Li76I+c5Y2VXHJcbiAgICAgIGlmICh0aGlzLmlzU3ViTWVudVNob3duICYmIHRoaXMuY3VycmVudERyb3Bkb3duICYmIHRoaXMucGFyZW50RHJvcGRvd24pIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnREcm9wZG93bi5oaWRlKCk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RHJvcGRvd24gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNTdWJNZW51U2hvd24gPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5pc01lbnVTaG93biAmJiB0aGlzLmN1cnJlbnREcm9wZG93biAmJiB0aGlzLmN1cnJlbnREcm9wZG93biAhPT0gZHJvcGRvd24pIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnREcm9wZG93bi5oaWRlKCk7XHJcbiAgICAgIH1cclxuICAgICAgZHJvcGRvd24uc2hvdygpO1xyXG4gICAgICB0aGlzLmN1cnJlbnREcm9wZG93biA9IGRyb3Bkb3duO1xyXG4gICAgICB0aGlzLmlzTWVudVNob3duID0gdHJ1ZTtcclxuICAgIH0qL1xyXG4gIH1cclxuXHJcbiAgaGlkZShkcm9wZG93bjogQnNEcm9wZG93bkRpcmVjdGl2ZSk6IHZvaWQge1xyXG4gICAgLy8gaWZcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5uZXJTaG93TDFEcm9wZG93bih0YXJnZXQ6IEJzRHJvcGRvd25EaXJlY3RpdmUpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmxldmVsMURyb3Bkb3duKSB7XHJcbiAgICAgIHRoaXMubGV2ZWwxRHJvcGRvd24uaGlkZSgpO1xyXG4gICAgfVxyXG4gICAgdGFyZ2V0LnNob3coKTtcclxuICAgIHRoaXMubGV2ZWwxRHJvcGRvd24gPSB0YXJnZXQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlubmVySGlkZUwxRHJvcGRvd24oKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5sZXZlbDFEcm9wZG93bikge1xyXG4gICAgICB0aGlzLmxldmVsMURyb3Bkb3duLmhpZGUoKTtcclxuICAgICAgdGhpcy5sZXZlbDFEcm9wZG93biA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlubmVyU2hvd0wyRHJvcGRvd24odGFyZ2V0OiBCc0Ryb3Bkb3duRGlyZWN0aXZlKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5sZXZlbDJEcm9wZG93bikge1xyXG4gICAgICB0aGlzLmxldmVsMkRyb3Bkb3duLmhpZGUoKTtcclxuICAgIH1cclxuICAgIHRhcmdldC5zaG93KCk7XHJcbiAgICB0aGlzLmxldmVsMkRyb3Bkb3duID0gdGFyZ2V0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbm5lckhpZGVMMkRyb3Bkb3duKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMubGV2ZWwyRHJvcGRvd24pIHtcclxuICAgICAgdGhpcy5sZXZlbDJEcm9wZG93bi5oaWRlKCk7XHJcbiAgICAgIHRoaXMubGV2ZWwyRHJvcGRvd24gPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
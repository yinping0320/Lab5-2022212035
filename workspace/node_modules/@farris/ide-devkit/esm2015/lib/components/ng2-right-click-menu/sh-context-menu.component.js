/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ContentChildren, ElementRef, Input, QueryList, TemplateRef, ViewChild, ViewChildren, ViewContainerRef, ViewEncapsulation } from '@angular/core';
import { ShContextMenuItemDirective } from './sh-context-menu-item.directive';
import { ShContextMenuService } from './sh-context-menu.service';
export class ShContextMenuComponent {
    /**
     * @param {?} ctxService
     */
    constructor(ctxService) {
        this.ctxService = ctxService;
        this.contentChildrenItems = new QueryList();
        this.viewChildrenItems = new QueryList();
    }
    /**
     * @return {?}
     */
    get menuItems() {
        // when using the ShContextMenuComponent as menu, the ContentChildren is the source
        if (this.contentChildrenItems.length) {
            return this.contentChildrenItems;
        }
        // when using a custom component as menu the ViewChildren is the source
        return this.viewChildrenItems;
    }
    /**
     * @param {?} $event
     * @param {?} item
     * @param {?} elm
     * @return {?}
     */
    onEnter($event, item, elm) {
        this.ctxService.closeSubMenus(this);
        this.setNotActive();
        if (!item.subMenu || !item.visible) {
            return;
        }
        this.setActive(item);
        this.ctxService.openSubMenu({
            data: item.context.$implicit,
            targetElement: new ElementRef(elm),
            menu: item.subMenu,
            mouseEvent: $event,
            parentMenu: this
        });
    }
    /**
     * @private
     * @param {?} item
     * @return {?}
     */
    setActive(item) {
        item.setActive();
        this.subActive = true;
    }
    /**
     * @param {?} event
     * @param {?} item
     * @return {?}
     */
    onClick(event, item) {
        // TODO: move click handling to service
        if (item.divider) {
            return;
        }
        if (!item.subMenu && item.closeOnClick) {
            this.ctxService.destroy();
            item.click.emit({
                data: item.context.$implicit,
                event
            });
        }
    }
    /**
     * @private
     * @param {?} fn
     * @param {?} fallbackContext
     * @param {?} data
     * @param {?} event
     * @return {?}
     */
    callWithContext(fn, fallbackContext, data, event) {
        return fn.call(this.thisContext ? this.thisContext : fallbackContext, { data, event });
    }
    /**
     * @return {?}
     */
    close() {
        this.setNotActive();
        this.menuContainer.detach();
        if (this.overlayRef) {
            this.overlayRef.detach();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.close();
    }
    /**
     * @return {?}
     */
    setNotActive() {
        this.subActive = false;
        this.menuItems.forEach(i => i.setNotActive());
    }
    /**
     * @param {?} item
     * @return {?}
     */
    isVisible(item) {
        if (!item.visible) {
            return true;
        }
        return this.callWithContext(item.visible, this, item.context.$implicit, null);
    }
}
ShContextMenuComponent.decorators = [
    { type: Component, args: [{
                selector: 'sh-context-menu',
                encapsulation: ViewEncapsulation.None,
                template: `
    <ng-container #menuContainer></ng-container>
    <ng-template #menuTemplate>
      <div class="sh-context-menu">
        <div
          *ngFor="let menuItem of menuItems"
          #itemElement
          [ngClass]="{'sh-sub-anchor': menuItem.subMenu && menuItem.visible,
           'sh-context-menu--item__disable': !menuItem.visible,
           'sh-context-menu--item__divider': menuItem.divider,
           'sh-context-menu--item__sub-active': subActive && menuItem.active}"
          class="sh-context-menu--item"
          (mouseenter)="onEnter($event, menuItem, itemElement)"
          (click)="onClick($event, menuItem)">
          <ng-container *ngIf="!menuItem.divider || !isVisible(menuItem)">
            <ng-content *ngTemplateOutlet="menuItem.template; context: menuItem.context"></ng-content>
          </ng-container>
        </div>
      </div>
    </ng-template>
  `,
                styles: [".sh-backdrop{background-color:transparent}.sh-context-menu{background:#fff;min-width:150px;border:1px solid rgba(0,0,0,.2);border-radius:3px;box-shadow:0 0 10px 2px rgba(0,0,0,.1);color:#656565;margin:0}.sh-context-menu--item{padding:7px 10px 7px 15px;transition:.15s}.sh-context-menu--item:hover,.sh-context-menu--item__sub-active{background-color:#ededed;cursor:pointer}.sh-context-menu--item.sh-context-menu--item__divider:hover{background-color:#ececec;color:#000;cursor:default}.sh-context-menu--item__divider{height:1px;padding:0;overflow:hidden;border-bottom:1px solid #d0d0d0}.sh-context-menu--item.sh-sub-anchor{position:relative;min-width:140px}.sh-sub-anchor:after{content:\"\";top:50%;right:6px;-webkit-transform:translateY(-50%);transform:translateY(-50%);position:absolute;border-top:4px solid transparent;border-bottom:4px solid transparent;border-left:5px solid #000}.sh-context-menu--item__disable{color:#a6a2a2}"]
            }] }
];
/** @nocollapse */
ShContextMenuComponent.ctorParameters = () => [
    { type: ShContextMenuService }
];
ShContextMenuComponent.propDecorators = {
    thisContext: [{ type: Input, args: ['this',] }],
    contentChildrenItems: [{ type: ContentChildren, args: [ShContextMenuItemDirective, { read: ShContextMenuItemDirective },] }],
    viewChildrenItems: [{ type: ViewChildren, args: [ShContextMenuItemDirective, { read: ShContextMenuItemDirective },] }],
    menuTemplate: [{ type: ViewChild, args: ['menuTemplate', { read: TemplateRef },] }],
    menuContainer: [{ type: ViewChild, args: ['menuContainer', { read: ViewContainerRef },] }]
};
if (false) {
    /** @type {?} */
    ShContextMenuComponent.prototype.thisContext;
    /** @type {?} */
    ShContextMenuComponent.prototype.contentChildrenItems;
    /** @type {?} */
    ShContextMenuComponent.prototype.viewChildrenItems;
    /** @type {?} */
    ShContextMenuComponent.prototype.menuTemplate;
    /** @type {?} */
    ShContextMenuComponent.prototype.menuContainer;
    /** @type {?} */
    ShContextMenuComponent.prototype.overlayRef;
    /** @type {?} */
    ShContextMenuComponent.prototype.subActive;
    /**
     * @type {?}
     * @private
     */
    ShContextMenuComponent.prototype.ctxService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY29udGV4dC1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL25nMi1yaWdodC1jbGljay1tZW51L3NoLWNvbnRleHQtbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQWEsU0FBUyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUN6RyxnQkFBZ0IsRUFDaEIsaUJBQWlCLEVBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQywwQkFBMEIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQzVFLE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBNkIvRCxNQUFNLE9BQU8sc0JBQXNCOzs7O0lBWWpDLFlBQW9CLFVBQWdDO1FBQWhDLGVBQVUsR0FBVixVQUFVLENBQXNCO1FBQ2xELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLFNBQVMsRUFBOEIsQ0FBQztRQUN4RSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxTQUFTLEVBQThCLENBQUM7SUFDdkUsQ0FBQzs7OztJQUVELElBQUksU0FBUztRQUNYLG1GQUFtRjtRQUNuRixJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUU7WUFDcEMsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUM7U0FDbEM7UUFFRCx1RUFBdUU7UUFDdkUsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDaEMsQ0FBQzs7Ozs7OztJQUVELE9BQU8sQ0FBQyxNQUFrQixFQUFFLElBQWdDLEVBQUUsR0FBZ0I7UUFDNUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFlBQVksRUFBRSxD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QixFQUFDOzJCQUUzRSxTQUFTLFNBQUMsY0FBYyxFQUFFLEVBQUMsSUFBSSxFQUFFLFdBQVcsRUFBQzs0QkFDN0MsU0FBUyxTQUFDLGVBQWUsRUFBRSxFQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBQzs7OztJQU5wRCw2Q0FBZ0M7O0lBRWhDLHNEQUFzRzs7SUFDdEcsbURBQWdHOztJQUVoRyw4Q0FBNkQ7O0lBQzdELCtDQUFvRTs7SUFFcEUsNENBQThCOztJQUM5QiwyQ0FBbUI7Ozs7O0lBRVAsNENBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsIENvbnRlbnRDaGlsZHJlbiwgRWxlbWVudFJlZiwgSW5wdXQsIE9uRGVzdHJveSwgUXVlcnlMaXN0LCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkLCBWaWV3Q2hpbGRyZW4sXHJcbiAgVmlld0NvbnRhaW5lclJlZixcclxuICBWaWV3RW5jYXBzdWxhdGlvblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1NoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlfSBmcm9tICcuL3NoLWNvbnRleHQtbWVudS1pdGVtLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7U2hDb250ZXh0TWVudVNlcnZpY2V9IGZyb20gJy4vc2gtY29udGV4dC1tZW51LnNlcnZpY2UnO1xyXG5pbXBvcnQge092ZXJsYXlSZWZ9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc2gtY29udGV4dC1tZW51JyxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIHN0eWxlVXJsczogWydzaC1jb250ZXh0LW1lbnUuY3NzJ10sXHJcbiAgdGVtcGxhdGU6IGBcclxuICAgIDxuZy1jb250YWluZXIgI21lbnVDb250YWluZXI+PC9uZy1jb250YWluZXI+XHJcbiAgICA8bmctdGVtcGxhdGUgI21lbnVUZW1wbGF0ZT5cclxuICAgICAgPGRpdiBjbGFzcz1cInNoLWNvbnRleHQtbWVudVwiPlxyXG4gICAgICAgIDxkaXZcclxuICAgICAgICAgICpuZ0Zvcj1cImxldCBtZW51SXRlbSBvZiBtZW51SXRlbXNcIlxyXG4gICAgICAgICAgI2l0ZW1FbGVtZW50XHJcbiAgICAgICAgICBbbmdDbGFzc109XCJ7J3NoLXN1Yi1hbmNob3InOiBtZW51SXRlbS5zdWJNZW51ICYmIG1lbnVJdGVtLnZpc2libGUsXHJcbiAgICAgICAgICAgJ3NoLWNvbnRleHQtbWVudS0taXRlbV9fZGlzYWJsZSc6ICFtZW51SXRlbS52aXNpYmxlLFxyXG4gICAgICAgICAgICdzaC1jb250ZXh0LW1lbnUtLWl0ZW1fX2RpdmlkZXInOiBtZW51SXRlbS5kaXZpZGVyLFxyXG4gICAgICAgICAgICdzaC1jb250ZXh0LW1lbnUtLWl0ZW1fX3N1Yi1hY3RpdmUnOiBzdWJBY3RpdmUgJiYgbWVudUl0ZW0uYWN0aXZlfVwiXHJcbiAgICAgICAgICBjbGFzcz1cInNoLWNvbnRleHQtbWVudS0taXRlbVwiXHJcbiAgICAgICAgICAobW91c2VlbnRlcik9XCJvbkVudGVyKCRldmVudCwgbWVudUl0ZW0sIGl0ZW1FbGVtZW50KVwiXHJcbiAgICAgICAgICAoY2xpY2spPVwib25DbGljaygkZXZlbnQsIG1lbnVJdGVtKVwiPlxyXG4gICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFtZW51SXRlbS5kaXZpZGVyIHx8ICFpc1Zpc2libGUobWVudUl0ZW0pXCI+XHJcbiAgICAgICAgICAgIDxuZy1jb250ZW50ICpuZ1RlbXBsYXRlT3V0bGV0PVwibWVudUl0ZW0udGVtcGxhdGU7IGNvbnRleHQ6IG1lbnVJdGVtLmNvbnRleHRcIj48L25nLWNvbnRlbnQ+XHJcbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L25nLXRlbXBsYXRlPlxyXG4gIGBcclxufSlcclxuZXhwb3J0IGNsYXNzIFNoQ29udGV4dE1lbnVDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gIEBJbnB1dCgndGhpcycpIHRoaXNDb250ZXh0OiBhbnk7XHJcblxyXG4gIEBDb250ZW50Q2hpbGRyZW4oU2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmUsIHtyZWFkOiBTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZX0pIGNvbnRlbnRDaGlsZHJlbkl0ZW1zO1xyXG4gIEBWaWV3Q2hpbGRyZW4oU2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmUsIHtyZWFkOiBTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZX0pIHZpZXdDaGlsZHJlbkl0ZW1zO1xyXG5cclxuICBAVmlld0NoaWxkKCdtZW51VGVtcGxhdGUnLCB7cmVhZDogVGVtcGxhdGVSZWZ9KSBtZW51VGVtcGxhdGU7XHJcbiAgQFZpZXdDaGlsZCgnbWVudUNvbnRhaW5lcicsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmfSkgbWVudUNvbnRhaW5lcjtcclxuXHJcbiAgcHVibGljIG92ZXJsYXlSZWY6IE92ZXJsYXlSZWY7XHJcbiAgc3ViQWN0aXZlOiBib29sZWFuO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGN0eFNlcnZpY2U6IFNoQ29udGV4dE1lbnVTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLmNvbnRlbnRDaGlsZHJlbkl0ZW1zID0gbmV3IFF1ZXJ5TGlzdDxTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZT4oKTtcclxuICAgIHRoaXMudmlld0NoaWxkcmVuSXRlbXMgPSBuZXcgUXVlcnlMaXN0PFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlPigpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG1lbnVJdGVtcygpOiBRdWVyeUxpc3Q8U2hDb250ZXh0TWVudUl0ZW1EaXJlY3RpdmU+IHtcclxuICAgIC8vIHdoZW4gdXNpbmcgdGhlIFNoQ29udGV4dE1lbnVDb21wb25lbnQgYXMgbWVudSwgdGhlIENvbnRlbnRDaGlsZHJlbiBpcyB0aGUgc291cmNlXHJcbiAgICBpZiAodGhpcy5jb250ZW50Q2hpbGRyZW5JdGVtcy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY29udGVudENoaWxkcmVuSXRlbXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gd2hlbiB1c2luZyBhIGN1c3RvbSBjb21wb25lbnQgYXMgbWVudSB0aGUgVmlld0NoaWxkcmVuIGlzIHRoZSBzb3VyY2VcclxuICAgIHJldHVybiB0aGlzLnZpZXdDaGlsZHJlbkl0ZW1zO1xyXG4gIH1cclxuXHJcbiAgb25FbnRlcigkZXZlbnQ6IE1vdXNlRXZlbnQsIGl0ZW06IFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlLCBlbG06IEhUTUxFbGVtZW50KSB7XHJcbiAgICB0aGlzLmN0eFNlcnZpY2UuY2xvc2VTdWJNZW51cyh0aGlzKTtcclxuICAgIHRoaXMuc2V0Tm90QWN0aXZlKCk7XHJcblxyXG4gICAgaWYgKCFpdGVtLnN1Yk1lbnUgfHwgIWl0ZW0udmlzaWJsZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZXRBY3RpdmUoaXRlbSk7XHJcbiAgICB0aGlzLmN0eFNlcnZpY2Uub3BlblN1Yk1lbnUoe1xyXG4gICAgICBkYXRhOiBpdGVtLmNvbnRleHQuJGltcGxpY2l0LFxyXG4gICAgICB0YXJnZXRFbGVtZW50OiBuZXcgRWxlbWVudFJlZihlbG0pLFxyXG4gICAgICBtZW51OiBpdGVtLnN1Yk1lbnUsXHJcbiAgICAgIG1vdXNlRXZlbnQ6ICRldmVudCxcclxuICAgICAgcGFyZW50TWVudTogdGhpc1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldEFjdGl2ZShpdGVtOiBTaENvbnRleHRNZW51SXRlbURpcmVjdGl2ZSkge1xyXG4gICAgaXRlbS5zZXRBY3RpdmUoKTtcclxuICAgIHRoaXMuc3ViQWN0aXZlID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIG9uQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQsIGl0ZW06IFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlKSB7XHJcbiAgICAvLyBUT0RPOiBtb3ZlIGNsaWNrIGhhbmRsaW5nIHRvIHNlcnZpY2VcclxuXHJcbiAgICBpZiAoaXRlbS5kaXZpZGVyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWl0ZW0uc3ViTWVudSAmJiBpdGVtLmNsb3NlT25DbGljaykge1xyXG4gICAgICB0aGlzLmN0eFNlcnZpY2UuZGVzdHJveSgpO1xyXG5cclxuICAgICAgaXRlbS5jbGljay5lbWl0KHtcclxuICAgICAgICBkYXRhOiBpdGVtLmNvbnRleHQuJGltcGxpY2l0LFxyXG4gICAgICAgIGV2ZW50XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxsV2l0aENvbnRleHQoZm4sIGZhbGxiYWNrQ29udGV4dCwgZGF0YSwgZXZlbnQpIHtcclxuICAgIHJldHVybiBmbi5jYWxsKHRoaXMudGhpc0NvbnRleHQgPyB0aGlzLnRoaXNDb250ZXh0IDogZmFsbGJhY2tDb250ZXh0LCB7ZGF0YSwgZXZlbnR9KTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5zZXROb3RBY3RpdmUoKTtcclxuICAgIHRoaXMubWVudUNvbnRhaW5lci5kZXRhY2goKTtcclxuICAgIGlmKHRoaXMub3ZlcmxheVJlZikge1xyXG4gICAgICAgdGhpcy5vdmVybGF5UmVmLmRldGFjaCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsb3NlKCk7XHJcbiAgfVxyXG5cclxuICBzZXROb3RBY3RpdmUoKSB7XHJcbiAgICB0aGlzLnN1YkFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5tZW51SXRlbXMuZm9yRWFjaChpID0+IGkuc2V0Tm90QWN0aXZlKCkpO1xyXG4gIH1cclxuXHJcbiAgaXNWaXNpYmxlKGl0ZW06IFNoQ29udGV4dE1lbnVJdGVtRGlyZWN0aXZlKSB7XHJcbiAgICBpZiAoIWl0ZW0udmlzaWJsZSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5jYWxsV2l0aENvbnRleHQoaXRlbS52aXNpYmxlLCB0aGlzLCBpdGVtLmNvbnRleHQuJGltcGxpY2l0LCBudWxsKTtcclxuICB9XHJcbn1cclxuIl19
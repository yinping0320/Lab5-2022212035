/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ViewContainerRef, ComponentFactoryResolver, Output, EventEmitter } from '@angular/core';
import { find, findIndex, merge } from 'lodash-es';
export class WizardComponent {
    /**
     * @param {?} viewContainerRef
     * @param {?} componentFactoryResolver
     */
    constructor(viewContainerRef, componentFactoryResolver) {
        this.viewContainerRef = viewContainerRef;
        this.componentFactoryResolver = componentFactoryResolver;
        this.clickCancelBtn = new EventEmitter();
        this.clickFinishBtn = new EventEmitter();
        this.title = '';
        this.steps = [];
        this.curStepIndex = 0;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.steps && this.steps.length > 0) {
            this.curStep = this.steps[this.curStepIndex];
            this.createStepComponent(this.steps[this.curStepIndex]);
        }
    }
    /**
     * @param {?} step
     * @return {?}
     */
    createStepComponent(step) {
        this.stepContainer.clear();
        /** @type {?} */
        const componentFactory = this.componentFactoryResolver.resolveComponentFactory(step.component);
        this.curComponentRef = this.stepContainer.createComponent(componentFactory);
        this.curComponentRef.instance.data = step.data;
        // 新增步骤
        if (this.curComponentRef.instance.addStep) {
            this.curComponentRef.instance.addStep.subscribe((stepList) => {
                /** @type {?} */
                const curIndex = findIndex(this.steps, this.curStep);
                this.steps.splice(curIndex + 1, 0, ...stepList);
                this.curStep.nextStep = stepList[0].stepId;
                this.curStep.showFinishBtn = false;
                this.curStep.showNextStepBtn = true;
            });
        }
        // 删除步骤
        if (this.curComponentRef.instance.removeStep) {
            this.curComponentRef.instance.removeStep.subscribe((data) => {
                merge(this.curStep, data.curStep);
                data.removeSteps.forEach(removeStep => {
                    /** @type {?} */
                    const index = findIndex(this.steps, removeStep);
                    this.steps.splice(index, 1);
                });
            });
        }
        // 变更步骤
        if (this.curComponentRef.instance.changeStep) {
            this.curComponentRef.instance.changeStep.subscribe((stepList) => {
                stepList.forEach(changeStep => {
                    /** @type {?} */
                    const oldStep = find(this.steps, function (s) { return s.stepId === changeStep.stepId; });
                    merge(oldStep, changeStep);
                });
            });
        }
    }
    /**
     * @param {?} nextStep
     * @return {?}
     */
    jumpStep(nextStep) {
        // 判断跳转方向
        if (nextStep === this.curStep) {
            return;
        }
        /** @type {?} */
        const nextIndex = findIndex(this.steps, function (s) { return s.stepId === nextStep.stepId; });
        if (nextIndex === this.curStepIndex) {
            return;
        }
        if (nextIndex < this.curStepIndex) { // 向前跳
            this.curStep = nextStep;
            this.curStepIndex = nextIndex;
            this.createStepComponent(nextStep);
            return;
        }
        if (nextStep.stepId === this.curStep.nextStep) { // 下一步
            this.nextStep();
            return;
        }
        //  else if (this.finishedSteps.indexOf(nextStep.stepId) > -1) { // 已完成的后续步骤
        //   this.curStep = nextStep;
        //   this.curStepIndex = nextIndex;
        //   this.createStepComponent(nextStep);
        // }
    }
    /**
     * 点击上一步
     * @return {?}
     */
    lastStep() {
        /** @type {?} */
        const self = this;
        this.curStepIndex = findIndex(this.steps, function (s) { return s.nextStep === self.curStep.stepId; });
        this.curStep = this.steps[this.curStepIndex];
        this.createStepComponent(this.curStep);
    }
    /**
     * 点击下一步
     * @return {?}
     */
    nextStep() {
        // 校验
        /** @type {?} */
        const validationFunc = this.curComponentRef.instance.validation;
        if (validationFunc && typeof (validationFunc) === 'function') {
            /** @type {?} */
            const result = validationFunc();
            if (!result) {
                return;
            }
        }
        // 执行各Component定义的nextStepClick事件
        /** @type {?} */
        const clickNextStep = this.curComponentRef.instance.clickNextStep;
        if (clickNextStep && typeof (clickNextStep) === 'function') {
            /** @type {?} */
            const result = clickNextStep();
            if (typeof (result) === 'boolean') {
                this.moveToNextStep(result);
            }
            else {
                result.subscribe(data => {
                    this.moveToNextStep(data);
                });
            }
        }
        else {
            this.moveToNextStep(true);
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    moveToNextStep(data) {
        if (!data) {
            return;
        }
        /** @type {?} */
        const curStep = this.curStep;
        if (curStep.nextStep === '') {
            return;
        }
        // this.finishedSteps.push(curStep.stepId);
        this.curStepIndex = findIndex(this.steps, function (s) { return s.stepId === curStep.nextStep; });
        if (this.curStepIndex > -1) {
            this.curStep = this.steps[this.curStepIndex];
            this.createStepComponent(this.curStep);
        }
    }
    /**
     * 取消
     * @return {?}
     */
    clickCancel() {
        this.clickCancelBtn.emit();
    }
    /**
     * 完成
     * @return {?}
     */
    finishWizard() {
        /** @type {?} */
        const validationFunc = this.curComponentRef.instance.validation;
        if (validationFunc && typeof (validationFunc) === 'function') {
            /** @type {?} */
            const result = validationFunc();
            if (!result) {
                return;
            }
        }
        /** @type {?} */
        const beforeFinish = this.curComponentRef.instance.beforeFinish;
        if (beforeFinish && typeof (beforeFinish) === 'function') {
            /** @type {?} */
            const result = beforeFinish();
            if (!result) {
                return;
            }
        }
        this.clickFinishBtn.emit();
    }
}
WizardComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-wizard',
                template: "<div class=\"stepWizard\">\r\n  <div class=\"createNav d-flex flex-wrap\" *ngIf=\"steps.length>1\">\r\n    <div *ngFor=\"let step of steps\" class=\"d-flex step\" [class.active]=\"curStep.stepId===step.stepId\">\r\n      <div class=\"d-flex\" *ngIf=\"step.show\" (click)=\"jumpStep(step)\">\r\n        <div class=\"stepTitle\">{{step.title}}</div>\r\n        <div class=\"triangle_border_right\">\r\n          <span></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"content\">\r\n    <perfect-scrollbar [config]=\"{suppressScrollX: true}\">\r\n      <ng-container #stepContainer></ng-container>\r\n    </perfect-scrollbar>\r\n  </div>\r\n\r\n\r\n\r\n  <div class=\"footBtns\">\r\n    <button type=\"button\" class=\"btn btn-outline-secondary btn-sm px-3 mx-2\" *ngIf=\"curStep.showCancelBtn\" (click)=\"clickCancel()\">\u53D6\u6D88</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary btn-sm px-3 mx-2\" *ngIf=\"curStep.showLastStepBtn\" (click)=\"lastStep()\"\r\n      type=\"submit\">\u4E0A\u4E00\u6B65</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary btn-sm px-3 mx-2\" *ngIf=\"curStep.showNextStepBtn\" (click)=\"nextStep()\"\r\n      type=\"submit\">\u4E0B\u4E00\u6B65</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary btn-sm px-3 mx-2\" *ngIf=\"curStep.showFinishBtn\" (click)=\"finishWizard()\">\u5B8C\u6210</button>\r\n  </div>\r\n</div>",
                styles: [":host{position:absolute;top:0;bottom:0;left:0;right:0}.stepWizard{height:100%;display:flex;flex-direction:column}.stepWizard .createNav{background:#e8edf2;height:40px;overflow:hidden}.stepWizard .createNav .stepTitle{padding:0 10px;color:#666;line-height:40px;cursor:pointer;font-size:.875rem}.stepWizard .createNav .step.active .stepTitle{color:#fff;background-color:#346180!important}.stepWizard .createNav .step:not(:first-child).active .stepTitle{margin-left:-17px;padding-left:25px}.stepWizard .createNav .stepTitle.disable{color:#cdcdcf}.stepWizard .createNav .step .triangle_border_right{width:0;height:0;border-width:20px 0 20px 18px;border-style:solid;border-color:transparent transparent transparent #ccc;position:relative}.stepWizard .createNav .step .triangle_border_right span{display:block;width:0;height:0;border-width:20px 0 20px 18px;border-style:solid;border-color:transparent transparent transparent #e8edf2;position:absolute;top:-20px;left:-20px}.stepWizard .createNav .step.active .triangle_border_right{width:0;height:0;border-width:20px 0 20px 20px;border-color:transparent transparent transparent #e8edf2}.stepWizard .createNav .step.active .triangle_border_right span{border-width:20px 0 20px 20px;border-color:transparent transparent transparent #346180!important}.stepWizard .content{flex:1;overflow:auto;font-size:.875rem}.stepWizard .content .ps-content{width:inherit;height:inherit}.stepWizard .footBtns{width:100%;display:flex;align-items:center;justify-content:flex-end;padding:10px 1rem;background:#f4f4f4;border-top:1px solid #ddd}"]
            }] }
];
/** @nocollapse */
WizardComponent.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: ComponentFactoryResolver }
];
WizardComponent.propDecorators = {
    clickCancelBtn: [{ type: Output }],
    clickFinishBtn: [{ type: Output }],
    title: [{ type: Input }],
    steps: [{ type: Input }],
    stepContainer: [{ type: ViewChild, args: ['stepContainer', { read: ViewContainerRef },] }]
};
if (false) {
    /** @type {?} */
    WizardComponent.prototype.clickCancelBtn;
    /** @type {?} */
    WizardComponent.prototype.clickFinishBtn;
    /** @type {?} */
    WizardComponent.prototype.title;
    /** @type {?} */
    WizardComponent.prototype.steps;
    /** @type {?} */
    WizardComponent.prototype.curStep;
    /** @type {?} */
    WizardComponent.prototype.curStepIndex;
    /** @type {?} */
    WizardComponent.prototype.curComponentRef;
    /** @type {?} */
    WizardComponent.prototype.stepContainer;
    /**
     * @type {?}
     * @private
     */
    WizardComponent.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    WizardComponent.prototype.componentFactoryResolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvaWRlLWRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3dpemFyZC9jb21wb25lbnQvd2l6YXJkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBVSxLQUFLLEVBQUUsU0FBUyxFQUFnQixnQkFBZ0IsRUFBRSx3QkFBd0IsRUFDN0YsTUFBTSxFQUFFLFlBQVksRUFDckIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBT25ELE1BQU0sT0FBTyxlQUFlOzs7OztJQVkxQixZQUFvQixnQkFBa0MsRUFDNUMsd0JBQWtEO1FBRHhDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDNUMsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQVpsRCxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekMsbUJBQWMsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBRTFDLFVBQUssR0FBRyxFQUFFLENBQUM7UUFDWCxVQUFLLEdBQUcsRUFBRSxDQUFDO1FBRXBCLGlCQUFZLEdBQUcsQ0FBQyxDQUFDO0lBTStDLENBQUM7Ozs7SUFFakUsUUFBUTtRQUNOLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM3QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUN6RDtJQUNILENBQUM7Ozs7O0lBQ0QsbUJBQW1CLENBQUMsSUFB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ZXdDaGlsZCwgQ29tcG9uZW50UmVmLCBWaWV3Q29udGFpbmVyUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgT3V0cHV0LCBFdmVudEVtaXR0ZXJcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgZmluZCwgZmluZEluZGV4LCBtZXJnZSB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC13aXphcmQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi93aXphcmQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3dpemFyZC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFdpemFyZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQE91dHB1dCgpIGNsaWNrQ2FuY2VsQnRuID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIGNsaWNrRmluaXNoQnRuID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBJbnB1dCgpIHRpdGxlID0gJyc7XHJcbiAgQElucHV0KCkgc3RlcHMgPSBbXTtcclxuICBjdXJTdGVwO1xyXG4gIGN1clN0ZXBJbmRleCA9IDA7XHJcbiAgY3VyQ29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8YW55PjtcclxuICAvLyBmaW5pc2hlZFN0ZXBzID0gW107XHJcbiAgQFZpZXdDaGlsZCgnc3RlcENvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSBzdGVwQ29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXHJcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBpZiAodGhpcy5zdGVwcyAmJiB0aGlzLnN0ZXBzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5jdXJTdGVwID0gdGhpcy5zdGVwc1t0aGlzLmN1clN0ZXBJbmRleF07XHJcbiAgICAgIHRoaXMuY3JlYXRlU3RlcENvbXBvbmVudCh0aGlzLnN0ZXBzW3RoaXMuY3VyU3RlcEluZGV4XSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNyZWF0ZVN0ZXBDb21wb25lbnQoc3RlcCkge1xyXG4gICAgdGhpcy5zdGVwQ29udGFpbmVyLmNsZWFyKCk7XHJcbiAgICBjb25zdCBjb21wb25lbnRGYWN0b3J5ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3Rvcnkoc3RlcC5jb21wb25lbnQpO1xyXG4gICAgdGhpcy5jdXJDb21wb25lbnRSZWYgPSB0aGlzLnN0ZXBDb250YWluZXIuY3JlYXRlQ29tcG9uZW50KGNvbXBvbmVudEZhY3RvcnkpO1xyXG4gICAgdGhpcy5jdXJDb21wb25lbnRSZWYuaW5zdGFuY2UuZGF0YSA9IHN0ZXAuZGF0YTtcclxuXHJcbiAgICAvLyDmlrDlop7mraXpqqRcclxuICAgIGlmICh0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS5hZGRTdGVwKSB7XHJcbiAgICAgIHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLmFkZFN0ZXAuc3Vic2NyaWJlKChzdGVwTGlzdCkgPT4ge1xyXG5cclxuICAgICAgICBjb25zdCBjdXJJbmRleCA9IGZpbmRJbmRleCh0aGlzLnN0ZXBzLCB0aGlzLmN1clN0ZXApO1xyXG4gICAgICAgIHRoaXMuc3RlcHMuc3BsaWNlKGN1ckluZGV4ICsgMSwgMCwgLi4uc3RlcExpc3QpO1xyXG5cclxuICAgICAgICB0aGlzLmN1clN0ZXAubmV4dFN0ZXAgPSBzdGVwTGlzdFswXS5zdGVwSWQ7XHJcbiAgICAgICAgdGhpcy5jdXJTdGVwLnNob3dGaW5pc2hCdG4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmN1clN0ZXAuc2hvd05leHRTdGVwQnRuID0gdHJ1ZTtcclxuXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8g5Yig6Zmk5q2l6aqkXHJcbiAgICBpZiAodGhpcy5jdXJDb21wb25lbnRSZWYuaW5zdGFuY2UucmVtb3ZlU3RlcCkge1xyXG4gICAgICB0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS5yZW1vdmVTdGVwLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgIG1lcmdlKHRoaXMuY3VyU3RlcCwgZGF0YS5jdXJTdGVwKTtcclxuICAgICAgICBkYXRhLnJlbW92ZVN0ZXBzLmZvckVhY2gocmVtb3ZlU3RlcCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGZpbmRJbmRleCh0aGlzLnN0ZXBzLCByZW1vdmVTdGVwKTtcclxuICAgICAgICAgIHRoaXMuc3RlcHMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyDlj5jmm7TmraXpqqRcclxuICAgIGlmICh0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS5jaGFuZ2VTdGVwKSB7XHJcbiAgICAgIHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLmNoYW5nZVN0ZXAuc3Vic2NyaWJlKChzdGVwTGlzdCkgPT4ge1xyXG4gICAgICAgIHN0ZXBMaXN0LmZvckVhY2goY2hhbmdlU3RlcCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBvbGRTdGVwID0gZmluZCh0aGlzLnN0ZXBzLCBmdW5jdGlvbiAocykgeyByZXR1cm4gcy5zdGVwSWQgPT09IGNoYW5nZVN0ZXAuc3RlcElkOyB9KTtcclxuICAgICAgICAgIG1lcmdlKG9sZFN0ZXAsIGNoYW5nZVN0ZXApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIGp1bXBTdGVwKG5leHRTdGVwKSB7XHJcbiAgICAvLyDliKTmlq3ot7PovazmlrnlkJFcclxuICAgIGlmIChuZXh0U3RlcCA9PT0gdGhpcy5jdXJTdGVwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IG5leHRJbmRleCA9IGZpbmRJbmRleCh0aGlzLnN0ZXBzLCBmdW5jdGlvbiAocykgeyByZXR1cm4gcy5zdGVwSWQgPT09IG5leHRTdGVwLnN0ZXBJZDsgfSk7XHJcbiAgICBpZiAobmV4dEluZGV4ID09PSB0aGlzLmN1clN0ZXBJbmRleCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAobmV4dEluZGV4IDwgdGhpcy5jdXJTdGVwSW5kZXgpIHsgLy8g5ZCR5YmN6LezXHJcbiAgICAgIHRoaXMuY3VyU3RlcCA9IG5leHRTdGVwO1xyXG4gICAgICB0aGlzLmN1clN0ZXBJbmRleCA9IG5leHRJbmRleDtcclxuICAgICAgdGhpcy5jcmVhdGVTdGVwQ29tcG9uZW50KG5leHRTdGVwKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKG5leHRTdGVwLnN0ZXBJZCA9PT0gdGhpcy5jdXJTdGVwLm5leHRTdGVwKSB7IC8vIOS4i+S4gOatpVxyXG4gICAgICB0aGlzLm5leHRTdGVwKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vICBlbHNlIGlmICh0aGlzLmZpbmlzaGVkU3RlcHMuaW5kZXhPZihuZXh0U3RlcC5zdGVwSWQpID4gLTEpIHsgLy8g5bey5a6M5oiQ55qE5ZCO57ut5q2l6aqkXHJcbiAgICAvLyAgIHRoaXMuY3VyU3RlcCA9IG5leHRTdGVwO1xyXG4gICAgLy8gICB0aGlzLmN1clN0ZXBJbmRleCA9IG5leHRJbmRleDtcclxuICAgIC8vICAgdGhpcy5jcmVhdGVTdGVwQ29tcG9uZW50KG5leHRTdGVwKTtcclxuICAgIC8vIH1cclxuXHJcbiAgfVxyXG4gIC8qKlxyXG4gICAgKiDngrnlh7vkuIrkuIDmraVcclxuICAgICovXHJcbiAgbGFzdFN0ZXAoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHRoaXMuY3VyU3RlcEluZGV4ID0gZmluZEluZGV4KHRoaXMuc3RlcHMsIGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLm5leHRTdGVwID09PSBzZWxmLmN1clN0ZXAuc3RlcElkOyB9KTtcclxuICAgIHRoaXMuY3VyU3RlcCA9IHRoaXMuc3RlcHNbdGhpcy5jdXJTdGVwSW5kZXhdO1xyXG4gICAgdGhpcy5jcmVhdGVTdGVwQ29tcG9uZW50KHRoaXMuY3VyU3RlcCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDngrnlh7vkuIvkuIDmraVcclxuICAgKi9cclxuICBuZXh0U3RlcCgpIHtcclxuICAgIC8vIOagoemqjFxyXG4gICAgY29uc3QgdmFsaWRhdGlvbkZ1bmMgPSB0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS52YWxpZGF0aW9uO1xyXG4gICAgaWYgKHZhbGlkYXRpb25GdW5jICYmIHR5cGVvZiAodmFsaWRhdGlvbkZ1bmMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRpb25GdW5jKCk7XHJcbiAgICAgIGlmICghcmVzdWx0KSB7IHJldHVybjsgfVxyXG4gICAgfVxyXG4gICAgLy8g5omn6KGM5ZCEQ29tcG9uZW505a6a5LmJ55qEbmV4dFN0ZXBDbGlja+S6i+S7tlxyXG4gICAgY29uc3QgY2xpY2tOZXh0U3RlcCA9IHRoaXMuY3VyQ29tcG9uZW50UmVmLmluc3RhbmNlLmNsaWNrTmV4dFN0ZXA7XHJcbiAgICBpZiAoY2xpY2tOZXh0U3RlcCAmJiB0eXBlb2YgKGNsaWNrTmV4dFN0ZXApID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNsaWNrTmV4dFN0ZXAoKTsgLy8g6L+U5Zue5YC85o6l5pS2Ym9vbGVhbuaIlm9ic2VydmFibGXnsbvlnotcclxuICAgICAgaWYgKHR5cGVvZiAocmVzdWx0KSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgdGhpcy5tb3ZlVG9OZXh0U3RlcChyZXN1bHQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm1vdmVUb05leHRTdGVwKGRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1vdmVUb05leHRTdGVwKHRydWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbW92ZVRvTmV4dFN0ZXAoZGF0YSkge1xyXG4gICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGN1clN0ZXAgPSB0aGlzLmN1clN0ZXA7XHJcbiAgICBpZiAoY3VyU3RlcC5uZXh0U3RlcCA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gdGhpcy5maW5pc2hlZFN0ZXBzLnB1c2goY3VyU3RlcC5zdGVwSWQpO1xyXG4gICAgdGhpcy5jdXJTdGVwSW5kZXggPSBmaW5kSW5kZXgodGhpcy5zdGVwcywgZnVuY3Rpb24gKHMpIHsgcmV0dXJuIHMuc3RlcElkID09PSBjdXJTdGVwLm5leHRTdGVwOyB9KTtcclxuICAgIGlmICh0aGlzLmN1clN0ZXBJbmRleCA+IC0xKSB7XHJcbiAgICAgIHRoaXMuY3VyU3RlcCA9IHRoaXMuc3RlcHNbdGhpcy5jdXJTdGVwSW5kZXhdO1xyXG4gICAgICB0aGlzLmNyZWF0ZVN0ZXBDb21wb25lbnQodGhpcy5jdXJTdGVwKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWPlua2iFxyXG4gICAqL1xyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbGlja0NhbmNlbEJ0bi5lbWl0KCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWujOaIkFxyXG4gICAqL1xyXG4gIGZpbmlzaFdpemFyZCgpIHtcclxuICAgIGNvbnN0IHZhbGlkYXRpb25GdW5jID0gdGhpcy5jdXJDb21wb25lbnRSZWYuaW5zdGFuY2UudmFsaWRhdGlvbjtcclxuICAgIGlmICh2YWxpZGF0aW9uRnVuYyAmJiB0eXBlb2YgKHZhbGlkYXRpb25GdW5jKSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0aW9uRnVuYygpO1xyXG4gICAgICBpZiAoIXJlc3VsdCkgeyByZXR1cm47IH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBiZWZvcmVGaW5pc2ggPSB0aGlzLmN1ckNvbXBvbmVudFJlZi5pbnN0YW5jZS5iZWZvcmVGaW5pc2g7XHJcbiAgICBpZiAoYmVmb3JlRmluaXNoICYmIHR5cGVvZiAoYmVmb3JlRmluaXNoKSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBiZWZvcmVGaW5pc2goKTtcclxuICAgICAgaWYgKCFyZXN1bHQpIHsgcmV0dXJuOyB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmNsaWNrRmluaXNoQnRuLmVtaXQoKTtcclxuICB9XHJcbn1cclxuIl19
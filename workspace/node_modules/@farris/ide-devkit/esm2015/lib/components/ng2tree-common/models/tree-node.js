/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter } from '@angular/core';
import { TREE_EVENTS } from '../constants/events';
export class TreeNode {
    /**
     * @param {?} data
     * @param {?=} parent
     * @param {?=} treeModel
     */
    constructor(data, parent = null, treeModel) {
        this.data = data;
        this.isVirtualRoot = false;
        this._isActive = false;
        // 变更树节点展示字段，由外部触发
        this.changeDisplayField = new EventEmitter();
        Object.assign(this, data, { parent, treeModel });
        this.treeModel = treeModel;
        this.parent = parent;
        this.level = this.parent ? this.parent.level + 1 : 0;
        if (this.isExpandedField) {
            this.isExpanded = true;
        }
        // 验证字段添加
        // console.log(this.idField);
        // console.log(this.typeField);
        this.childrenField = this.childrenField.map(child => new TreeNode(child, this, treeModel));
        // bug修复：TreeModel.canMoveNode使用parentNode，会出现undefined。这里做兼容
        this.parentNode = this.parent;
    }
    /**
     * @return {?}
     */
    get isExpanded() { return this._isExpanded; }
    /**
     * @param {?} value
     * @return {?}
     */
    set isExpanded(value) { this._isExpanded = value; }
    /**
     * @return {?}
     */
    get isCollapsed() { return !this._isExpanded; }
    /**
     * @return {?}
     */
    get isActive() {
        return this._isActive;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set isActive(value) {
        this._isActive = value;
    }
    // Proxy of treeModel
    /**
     * @return {?}
     */
    get options() {
        return this.treeModel.options;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    fireEvent(event) {
        this.treeModel.fireEvent(event);
    }
    // 表现的更像一个字段，将其封装成属性，并根据开放的读写权限，设置get/set
    /**
     * @return {?}
     */
    get idField() {
        return this[this.options.idField];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set idField(value) {
        this[this.options.idField] = value;
    }
    /**
     * @return {?}
     */
    get childrenField() {
        return this[this.options.childrenField] || [];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set childrenField(value) {
        this[this.options.childrenField] = value;
    }
    /**
     * @return {?}
     */
    get displayField() {
        return this[this.options.displayField];
    }
    /**
     * @return {?}
     */
    get typeField() {
        return this[this.options.typeField];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set typeField(value) {
        this[this.options.typeField] = value;
    }
    /**
     * @return {?}
     */
    get isExpandedField() {
        return this[this.options.isExpandedField];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set isExpandedField(value) {
        this[this.options.isExpandedField] = value;
    }
    /**
     * @return {?}
     */
    allowDrag() {
        return this.options.allowDrag;
    }
    /**
     * @return {?}
     */
    enableCustomContextMenu() {
        return this.options.enableCustomContextMenu;
    }
    /**
     * @return {?}
     */
    get isRoot() { return this.parent.isVirtualRoot; } // 父节点为空，表示这个一个根节点
    // 父节点为空，表示这个一个根节点
    /**
     * @return {?}
     */
    get realParent() { return this.isRoot ? null : this.parent; }
    /**
     * @return {?}
     */
    get isLeaf() { return !this.childrenField.length; }
    /**
     * @return {?}
     */
    get hasChildren() { return !this.isLeaf; }
    /**
     * @return {?}
     */
    get isFocused() { return this.treeModel.focusedNode == this; }
    /**
     * @return {?}
     */
    getFirstChild() {
        return this.childrenField && this.childrenField[0];
    }
    /**
     * @return {?}
     */
    getLastChild() {
        return this.childrenField && this.childrenField[this.childrenField.length - 1];
    }
    /**
     * @private
     * @return {?}
     */
    _getIndexInParent() {
        return this.parent && this.parent.childrenField.indexOf(this);
    }
    /**
     * @param {?} steps
     * @return {?}
     */
    findAdjacentSibling(steps) {
        /** @type {?} */
        const index = this._getIndexInParent();
        return this.parent && this.parent.childrenField[index + steps];
    }
    /**
     * @return {?}
     */
    findNextSibling() {
        return this.findAdjacentSibling(+1);
    }
    /**
     * @return {?}
     */
    findPreviousSibling() {
        return this.findAdjacentSibling(-1);
    }
    /**
     * @param {?=} goInside
     * @return {?}
     */
    findNextNode(goInside = true) {
        return goInside && this.isExpanded && this.getFirstChild() ||
            this.findNextSibling() ||
            this.parent && this.parent.findNextNode(false);
    }
    /**
     * @return {?}
     */
    findPreviousNode() {
        /** @type {?} */
        const previousSibling = this.findPreviousSibling();
        if (!previousSibling) {
            return this.realParent;
        }
        return previousSibling.isCollapsed
            ? previousSibling
            : previousSibling.getLastChild();
    }
    /**
     * @param {?} node
     * @return {?}
     */
    isDescendantOf(node) {
        if (this === node) {
            return true;
        }
        else {
            return this.parent && this.parent.isDescendantOf(node);
        }
    }
    // 切换方法
    // 切换节点的折叠（Collapsed）与扩展（Expanded）状态
    /**
     * @return {?}
     */
    toggle() {
        this.isExpanded = !this.isExpanded;
        this.fireEvent({ eventName: TREE_EVENTS.onToggle, node: this, isExpanded: this.isExpanded });
    }
    /**
     * @private
     * @return {?}
     */
    _activate() {
        this._isActive = true;
        this.fireEvent({ eventName: TREE_EVENTS.onActivate, node: this });
        this.focus();
    }
    /**
     * @private
     * @return {?}
     */
    _deactivate() {
        this._isActive = false;
        this.fireEvent({ eventName: TREE_EVENTS.onDeactivate, node: this });
    }
    /**
     * @return {?}
     */
    toggleActivated() {
        if (this.isActive) {
            this._deactivate();
            this.treeModel.activeNode = null;
        }
        else {
            if (this.treeModel.activeNode) {
                this.treeModel.activeNode._deactivate();
            }
            this._activate();
            this.treeModel.activeNode = this;
        }
        this.fireEvent({ eventName: TREE_EVENTS.onActiveChanged, node: this, isActive: this.isActive });
    }
    /**
     * @return {?}
     */
    focus() {
        /** @type {?} */
        const previousNode = this.treeModel.focusedNode;
        this.treeModel.focusedNode = this;
        if (previousNode) {
            this.fireEvent({ eventName: TREE_EVENTS.onBlur, node: previousNode });
        }
        this.fireEvent({ eventName: TREE_EVENTS.onFocus, node: this });
    }
    /**
     * @return {?}
     */
    blur() {
        /** @type {?} */
        const previousNode = this.treeModel.focusedNode;
        this.treeModel.focusedNode = null;
        if (previousNode) {
            this.fireEvent({ eventName: TREE_EVENTS.onBlur, node: this });
        }
    }
    // 双击事件
    /**
     * @param {?} rawEvent
     * @return {?}
     */
    doublClick(rawEvent) {
        this.fireEvent({ eventName: TREE_EVENTS.onDoubleClick, node: this, rawEvent });
    }
    // 右键快捷菜单
    /**
     * @param {?} rawEvent
     * @return {?}
     */
    contextMenu(rawEvent) {
        if (this.enableCustomContextMenu()) { // 启用右键菜单功能后，禁用默认的右键菜单
            rawEvent.preventDefault();
        }
        this.fireEvent({ eventName: TREE_EVENTS.onContextMenu, node: this, rawEvent });
    }
    /**
     * @param {?} $event
     * @param {?=} data
     * @return {?}
     */
    dropMouseAction($event, data = null) {
        // 1.设置focus
        this.treeModel.setFocus(true);
        // 2.执行事件处理器
        this._dropEventHandler(this.treeModel, this, $event, data);
        // 3.完成drop操作后，重置drag状态
        this.treeModel.cancelDrag();
    }
    /**
     * @private
     * @param {?} tree
     * @param {?} node
     * @param {?} $event
     * @param {?} to
     * @return {?}
     */
    _dropEventHandler(tree, node, $event, to) {
        tree.moveNode({ from: tree.getDragNode(), to });
        // console.log("dropEventHandler:"+tree.roots);
    }
    // 点击右键菜单项
    /**
     * @param {?} event
     * @return {?}
     */
    rightMenuClicked(event) {
        this.fireEvent({ eventName: TREE_EVENTS.onRightMenuClicked, node: this, rawEvent: event });
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreeNode.prototype._isExpanded;
    /** @type {?} */
    TreeNode.prototype.treeModel;
    /** @type {?} */
    TreeNode.prototype.parent;
    /** @type {?} */
    TreeNode.prototype.level;
    /** @type {?} */
    TreeNode.prototype.isVirtualRoot;
    /** @type {?} */
    TreeNode.prototype.elementRef;
    /** @type {?} */
    TreeNode.prototype.parentNode;
    /** @type {?} */
    TreeNode.prototype._isActive;
    /** @type {?} */
    TreeNode.prototype.changeDisplayField;
    /** @type {?} */
    TreeNode.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1ub2RlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9pZGUtZGV2a2l0LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbmcydHJlZS1jb21tb24vbW9kZWxzL3RyZWUtbm9kZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFjLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV6RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHbEQsTUFBTSxPQUFPLFFBQVE7Ozs7OztJQXdCakIsWUFBbUIsSUFBSSxFQUFFLFNBQW1CLElBQUksRUFBRSxTQUFvQjtRQUFuRCxTQUFJLEdBQUosSUFBSSxDQUFBO1FBZnZCLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBSXRCLGNBQVMsR0FBRyxLQUFLLENBQUM7O1FBU2xCLHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFJekMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUMsTUFBTSxFQUFFLFNBQVMsRUFBQyxDQUFFLENBQUM7UUFFakQsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRCxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7U0FDMUI7UUFFRCxTQUFTO1FBQ1QsNkJBQTZCO1FBQzdCLCtCQUErQjtRQUUvQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxRQUFR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LEVBQTBDO1FBQ2hFLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDaEQsK0NBQStDO0lBQ25ELENBQUM7Ozs7OztJQUdELGdCQUFnQixDQUFFLEtBQUs7UUFDbkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUMvRixDQUFDO0NBQ0o7Ozs7OztJQXhPRywrQkFBNkI7O0lBSzdCLDZCQUFxQjs7SUFDckIsMEJBQWlCOztJQUNqQix5QkFBYzs7SUFDZCxpQ0FBc0I7O0lBQ3RCLDhCQUF1Qjs7SUFDdkIsOEJBQXFCOztJQUVyQiw2QkFBa0I7O0lBU2xCLHNDQUE2Qzs7SUFFakMsd0JBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHJlZU1vZGVsIH0gZnJvbSAnLi90cmVlLW1vZGVsJztcclxuaW1wb3J0IHsgVFJFRV9FVkVOVFMgfSBmcm9tICcuLi9jb25zdGFudHMvZXZlbnRzJztcclxuaW1wb3J0IHsgVHJlZU9wdGlvbnMgfSBmcm9tICcuL3RyZWUtb3B0aW9ucyc7XHJcblxyXG5leHBvcnQgY2xhc3MgVHJlZU5vZGUge1xyXG4gICAgcHJpdmF0ZSBfaXNFeHBhbmRlZDogYm9vbGVhbjtcclxuICAgIGdldCBpc0V4cGFuZGVkKCkge3JldHVybiB0aGlzLl9pc0V4cGFuZGVkOyB9XHJcbiAgICBzZXQgaXNFeHBhbmRlZCh2YWx1ZSkge3RoaXMuX2lzRXhwYW5kZWQgPSB2YWx1ZTsgfVxyXG4gICAgZ2V0IGlzQ29sbGFwc2VkKCkge3JldHVybiAhdGhpcy5faXNFeHBhbmRlZDsgfVxyXG5cclxuICAgIHRyZWVNb2RlbDogVHJlZU1vZGVsO1xyXG4gICAgcGFyZW50OiBUcmVlTm9kZTtcclxuICAgIGxldmVsOiBudW1iZXI7XHJcbiAgICBpc1ZpcnR1YWxSb290ID0gZmFsc2U7XHJcbiAgICBlbGVtZW50UmVmOiBFbGVtZW50UmVmO1xyXG4gICAgcGFyZW50Tm9kZTogVHJlZU5vZGU7XHJcblxyXG4gICAgX2lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICBnZXQgaXNBY3RpdmUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQWN0aXZlO1xyXG4gICAgfVxyXG4gICAgc2V0IGlzQWN0aXZlKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlj5jmm7TmoJHoioLngrnlsZXnpLrlrZfmrrXvvIznlLHlpJbpg6jop6blj5FcclxuICAgIGNoYW5nZURpc3BsYXlGaWVsZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkYXRhLCBwYXJlbnQ6IFRyZWVOb2RlID0gbnVsbCwgdHJlZU1vZGVsOiBUcmVlTW9kZWwpIHtcclxuXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbiggdGhpcywgZGF0YSwge3BhcmVudCwgdHJlZU1vZGVsfSApO1xyXG5cclxuICAgICAgICB0aGlzLnRyZWVNb2RlbCA9IHRyZWVNb2RlbDtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLmxldmVsID0gdGhpcy5wYXJlbnQgPyB0aGlzLnBhcmVudC5sZXZlbCArIDEgOiAwO1xyXG4gICAgICAgIGlmICh0aGlzLmlzRXhwYW5kZWRGaWVsZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzRXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g6aqM6K+B5a2X5q615re75YqgXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5pZEZpZWxkKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnR5cGVGaWVsZCk7XHJcblxyXG4gICAgICAgIHRoaXMuY2hpbGRyZW5GaWVsZCA9IHRoaXMuY2hpbGRyZW5GaWVsZC5tYXAoY2hpbGQgPT4gbmV3IFRyZWVOb2RlKGNoaWxkLCB0aGlzLCB0cmVlTW9kZWwpICk7XHJcblxyXG4gICAgICAgIC8vIGJ1Z+S/ruWkje+8mlRyZWVNb2RlbC5jYW5Nb3ZlTm9kZeS9v+eUqHBhcmVudE5vZGXvvIzkvJrlh7rnjrB1bmRlZmluZWTjgILov5nph4zlgZrlhbzlrrlcclxuICAgICAgICB0aGlzLnBhcmVudE5vZGUgPSB0aGlzLnBhcmVudDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcm94eSBvZiB0cmVlTW9kZWxcclxuICAgIGdldCBvcHRpb25zKCk6IFRyZWVPcHRpb25zIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50cmVlTW9kZWwub3B0aW9ucztcclxuICAgIH1cclxuICAgIGZpcmVFdmVudChldmVudCkge1xyXG4gICAgICAgIHRoaXMudHJlZU1vZGVsLmZpcmVFdmVudChldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6KGo546w55qE5pu05YOP5LiA5Liq5a2X5q6177yM5bCG5YW25bCB6KOF5oiQ5bGe5oCn77yM5bm25qC55o2u5byA5pS+55qE6K+75YaZ5p2D6ZmQ77yM6K6+572uZ2V0L3NldFxyXG4gICAgZ2V0IGlkRmllbGQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNbdGhpcy5vcHRpb25zLmlkRmllbGRdO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBpZEZpZWxkKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpc1t0aGlzLm9wdGlvbnMuaWRGaWVsZF0gPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY2hpbGRyZW5GaWVsZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpc1t0aGlzLm9wdGlvbnMuY2hpbGRyZW5GaWVsZF0gfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGNoaWxkcmVuRmllbGQodmFsdWUpIHtcclxuICAgICAgICB0aGlzW3RoaXMub3B0aW9ucy5jaGlsZHJlbkZpZWxkXSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkaXNwbGF5RmllbGQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNbdGhpcy5vcHRpb25zLmRpc3BsYXlGaWVsZF07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHR5cGVGaWVsZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpc1t0aGlzLm9wdGlvbnMudHlwZUZpZWxkXTtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgdHlwZUZpZWxkKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpc1t0aGlzLm9wdGlvbnMudHlwZUZpZWxkXSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc0V4cGFuZGVkRmllbGQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNbdGhpcy5vcHRpb25zLmlzRXhwYW5kZWRGaWVsZF07XHJcbiAgICB9XHJcbiAgICBzZXQgaXNFeHBhbmRlZEZpZWxkKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpc1t0aGlzLm9wdGlvbnMuaXNFeHBhbmRlZEZpZWxkXSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGFsbG93RHJhZygpIHsvLyDooajnjrDnmoTmm7Tlg4/kuIDkuKrliqjkvZzvvIzlsIblhbblsIHoo4XmiJDmlrnms5VcclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFsbG93RHJhZztcclxuICAgIH1cclxuXHJcbiAgICBlbmFibGVDdXN0b21Db250ZXh0TWVudSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmVuYWJsZUN1c3RvbUNvbnRleHRNZW51O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpc1Jvb3QoKSB7IHJldHVybiB0aGlzLnBhcmVudC5pc1ZpcnR1YWxSb290OyB9Ly8g54i26IqC54K55Li656m677yM6KGo56S66L+Z5Liq5LiA5Liq5qC56IqC54K5XHJcbiAgICBnZXQgcmVhbFBhcmVudCgpIHsgcmV0dXJuIHRoaXMuaXNSb290ID8gbnVsbCA6IHRoaXMucGFyZW50OyB9XHJcbiAgICBnZXQgaXNMZWFmKCkgeyByZXR1cm4gIXRoaXMuY2hpbGRyZW5GaWVsZC5sZW5ndGg7IH1cclxuICAgIGdldCBoYXNDaGlsZHJlbigpIHsgcmV0dXJuICF0aGlzLmlzTGVhZjsgfVxyXG4gICAgZ2V0IGlzRm9jdXNlZCgpIHtyZXR1cm4gdGhpcy50cmVlTW9kZWwuZm9jdXNlZE5vZGUgPT0gdGhpczsgfVxyXG5cclxuICAgIGdldEZpcnN0Q2hpbGQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5GaWVsZCAmJiB0aGlzLmNoaWxkcmVuRmllbGRbMF07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TGFzdENoaWxkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuRmllbGQgJiYgdGhpcy5jaGlsZHJlbkZpZWxkW3RoaXMuY2hpbGRyZW5GaWVsZC5sZW5ndGggLSAxXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9nZXRJbmRleEluUGFyZW50KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5jaGlsZHJlbkZpZWxkLmluZGV4T2YodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZEFkamFjZW50U2libGluZyhzdGVwcykge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fZ2V0SW5kZXhJblBhcmVudCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5jaGlsZHJlbkZpZWxkW2luZGV4ICsgc3RlcHNdO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmROZXh0U2libGluZygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5maW5kQWRqYWNlbnRTaWJsaW5nKCsxKTtcclxuICAgIH1cclxuICAgIGZpbmRQcmV2aW91c1NpYmxpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmluZEFkamFjZW50U2libGluZygtMSk7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZE5leHROb2RlKGdvSW5zaWRlID0gdHJ1ZSkgey8vIOafpeaJvk5leHQgTm9kZeaXtu+8jOm7mOiupOi/m+ihjOWGhemDqOafpeaJvlxyXG4gICAgICAgIHJldHVybiBnb0luc2lkZSAmJiB0aGlzLmlzRXhwYW5kZWQgJiYgdGhpcy5nZXRGaXJzdENoaWxkKCkgfHxcclxuICAgICAgICAgICAgICAgdGhpcy5maW5kTmV4dFNpYmxpbmcoKSB8fFxyXG4gICAgICAgICAgICAgICB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5maW5kTmV4dE5vZGUoZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRQcmV2aW91c05vZGUoKSB7XHJcbiAgICAgICAgY29uc3QgcHJldmlvdXNTaWJsaW5nID0gdGhpcy5maW5kUHJldmlvdXNTaWJsaW5nKCk7XHJcbiAgICAgICAgaWYgKCFwcmV2aW91c1NpYmxpbmcpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLnJlYWxQYXJlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcmV2aW91c1NpYmxpbmcuaXNDb2xsYXBzZWRcclxuICAgICAgICAgID8gcHJldmlvdXNTaWJsaW5nXHJcbiAgICAgICAgICA6IHByZXZpb3VzU2libGluZy5nZXRMYXN0Q2hpbGQoKTtcclxuICAgIH1cclxuXHJcbiAgICBpc0Rlc2NlbmRhbnRPZihub2RlOiBUcmVlTm9kZSkge1xyXG4gICAgICAgIGlmICh0aGlzID09PSBub2RlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5pc0Rlc2NlbmRhbnRPZihub2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5YiH5o2i5pa55rOVXHJcbiAgICAvLyDliIfmjaLoioLngrnnmoTmipjlj6DvvIhDb2xsYXBzZWTvvInkuI7mianlsZXvvIhFeHBhbmRlZO+8ieeKtuaAgVxyXG4gICAgdG9nZ2xlKCkge1xyXG4gICAgICAgIHRoaXMuaXNFeHBhbmRlZCA9ICF0aGlzLmlzRXhwYW5kZWQ7XHJcbiAgICAgICAgdGhpcy5maXJlRXZlbnQoeyBldmVudE5hbWU6IFRSRUVfRVZFTlRTLm9uVG9nZ2xlLCBub2RlOiB0aGlzLCBpc0V4cGFuZGVkOiB0aGlzLmlzRXhwYW5kZWQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vbkFjdGl2YXRlLCBub2RlOiB0aGlzIH0pO1xyXG4gICAgICAgIHRoaXMuZm9jdXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9kZWFjdGl2YXRlKCkge1xyXG4gICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5maXJlRXZlbnQoeyBldmVudE5hbWU6IFRSRUVfRVZFTlRTLm9uRGVhY3RpdmF0ZSwgbm9kZTogdGhpcyB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVBY3RpdmF0ZWQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGVhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVNb2RlbC5hY3RpdmVOb2RlID0gbnVsbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50cmVlTW9kZWwuYWN0aXZlTm9kZSkge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVNb2RlbC5hY3RpdmVOb2RlLl9kZWFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgdGhpcy50cmVlTW9kZWwuYWN0aXZlTm9kZSA9IHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vbkFjdGl2ZUNoYW5nZWQsIG5vZGU6IHRoaXMsIGlzQWN0aXZlOiB0aGlzLmlzQWN0aXZlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZvY3VzKCkge1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzTm9kZSA9IHRoaXMudHJlZU1vZGVsLmZvY3VzZWROb2RlO1xyXG4gICAgICAgIHRoaXMudHJlZU1vZGVsLmZvY3VzZWROb2RlID0gdGhpcztcclxuICAgICAgICBpZiAocHJldmlvdXNOb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vbkJsdXIsIG5vZGU6IHByZXZpb3VzTm9kZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5maXJlRXZlbnQoeyBldmVudE5hbWU6IFRSRUVfRVZFTlRTLm9uRm9jdXMsIG5vZGU6IHRoaXMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYmx1cigpIHtcclxuICAgICAgICBjb25zdCBwcmV2aW91c05vZGUgPSB0aGlzLnRyZWVNb2RlbC5mb2N1c2VkTm9kZTtcclxuICAgICAgICB0aGlzLnRyZWVNb2RlbC5mb2N1c2VkTm9kZSA9IG51bGw7XHJcbiAgICAgICAgaWYgKHByZXZpb3VzTm9kZSkge1xyXG4gICAgICAgICAgICB0aGlzLmZpcmVFdmVudCh7IGV2ZW50TmFtZTogVFJFRV9FVkVOVFMub25CbHVyLCBub2RlOiB0aGlzIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDlj4zlh7vkuovku7ZcclxuICAgIGRvdWJsQ2xpY2socmF3RXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICB0aGlzLmZpcmVFdmVudCh7IGV2ZW50TmFtZTogVFJFRV9FVkVOVFMub25Eb3VibGVDbGljaywgbm9kZTogdGhpcywgcmF3RXZlbnQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5Y+z6ZSu5b+r5o236I+c5Y2VXHJcbiAgICBjb250ZXh0TWVudShyYXdFdmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZUN1c3RvbUNvbnRleHRNZW51KCkpIHsvLyDlkK/nlKjlj7PplK7oj5zljZXlip/og73lkI7vvIznpoHnlKjpu5jorqTnmoTlj7PplK7oj5zljZVcclxuICAgICAgICAgICAgcmF3RXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZmlyZUV2ZW50KHsgZXZlbnROYW1lOiBUUkVFX0VWRU5UUy5vbkNvbnRleHRNZW51LCBub2RlOiB0aGlzLCByYXdFdmVudCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBkcm9wTW91c2VBY3Rpb24oJGV2ZW50LCBkYXRhOiBhbnkgPSBudWxsKSB7XHJcbiAgICAgICAgLy8gMS7orr7nva5mb2N1c1xyXG4gICAgICAgIHRoaXMudHJlZU1vZGVsLnNldEZvY3VzKHRydWUpO1xyXG4gICAgICAgIC8vIDIu5omn6KGM5LqL5Lu25aSE55CG5ZmoXHJcbiAgICAgICAgdGhpcy5fZHJvcEV2ZW50SGFuZGxlcih0aGlzLnRyZWVNb2RlbCwgdGhpcywgJGV2ZW50LCBkYXRhKTtcclxuICAgICAgICAvLyAzLuWujOaIkGRyb3Dmk43kvZzlkI7vvIzph43nva5kcmFn54q25oCBXHJcbiAgICAgICAgdGhpcy50cmVlTW9kZWwuY2FuY2VsRHJhZygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2Ryb3BFdmVudEhhbmRsZXIodHJlZTogVHJlZU1vZGVsLCBub2RlOiBUcmVlTm9kZSwgJGV2ZW50OiBhbnkgLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogeyBwYXJlbnROb2RlOiBUcmVlTm9kZSwgaW5kZXg6IG51bWJlcn0pIHtcclxuICAgICAgICB0cmVlLm1vdmVOb2RlKHsgZnJvbTogdHJlZS5nZXREcmFnTm9kZSgpLCB0byB9KTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImRyb3BFdmVudEhhbmRsZXI6XCIrdHJlZS5yb290cyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g54K55Ye75Y+z6ZSu6I+c5Y2V6aG5XHJcbiAgICByaWdodE1lbnVDbGlja2VkKCBldmVudCApIHtcclxuICAgICAgICB0aGlzLmZpcmVFdmVudCh7IGV2ZW50TmFtZTogVFJFRV9FVkVOVFMub25SaWdodE1lbnVDbGlja2VkLCBub2RlOiB0aGlzLCByYXdFdmVudDogZXZlbnQgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
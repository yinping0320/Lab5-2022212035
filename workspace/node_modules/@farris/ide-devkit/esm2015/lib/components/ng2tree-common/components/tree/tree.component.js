/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, HostListener } from '@angular/core';
import { TreeModel } from '../../models/tree-model';
import { TreeOptions } from '../../models/tree-options';
import { KEYS } from '../../constants/keys';
import { pick, includes } from 'lodash-es'; //将lodash安装到node-modules中，实现按需引入
//约定使用下划线表示lodash，就像用$表示jQuery一样
//1.require关键字不被识别：
// https://stackoverflow.com/questions/31173738/typescript-getting-error-ts2304-cannot-find-name-require
// declare var require: any
// const _ = require('lodash');
//2.安装lodash的es版本：
// (1) $>npm i lodash-es
// (2) $>npm install --save @types/lodash
export class TreeComponent {
    /**
     * @param {?} treeModel
     */
    constructor(treeModel) {
        this.treeModel = treeModel;
        treeModel.eventNames.forEach((name) => this[name] = new EventEmitter()); //customEventName -> new EventEmitter()
    }
    /**
     * @param {?} nodes
     * @return {?}
     */
    set nodes(nodes) { }
    ;
    /**
     * @param {?} options
     * @return {?}
     */
    set options(options) { }
    ;
    /**
     * @param {?} value
     * @return {?}
     */
    set focused(value) {
        this.treeModel.setFocus(value);
        // alert('focused on the tree');
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.treeModel.setData({
            nodes: changes.nodes && changes.nodes.currentValue,
            options: changes.options && changes.options.currentValue,
            events: pick(this, this.treeModel.eventNames)
        });
    }
    // 优先使用HostListener装饰器绑定事件，而不是使用Directive或Component的host元数据
    // When binding events to Directive or Component, Angular suggests to prefer to HostListener decorator, 
    // rather than host metadata.
    /**
     * @param {?} $event
     * @return {?}
     */
    onKeydown($event) {
        // alert('Pressed a key');
        /** @type {?} */
        let focusedNode = this.treeModel.focusedNode;
        if (!this.treeModel.isFocused) {
            return;
        }
        if (includes([KEYS.DOWN, KEYS.UP, KEYS.LEFT,
            KEYS.RIGHT, KEYS.ENTER, KEYS.SPACE], $event.keyCode)) {
            $event.preventDefault(); //取消事件的默认动作，实现仅对includes键响应
        }
        switch ($event.keyCode) {
            case KEYS.DOWN:
                return this.treeModel.focusNextNode();
            case KEYS.UP:
                return this.treeModel.focusPreviousNode();
            case KEYS.LEFT:
                // alert('Focus Drill Up');
                if (focusedNode.isExpanded) {
                    focusedNode.toggle();
                }
                else {
                    this.treeModel.focusDrillUp();
                }
                return;
            case KEYS.RIGHT:
                // alert('Focus Drill Down');
                if (focusedNode.isCollapsed) {
                    focusedNode.toggle();
                }
                else {
                    this.treeModel.focusDrillDown();
                }
                return;
            case KEYS.ENTER:
            case KEYS.SPACE:
                // alert('Enter or Space key.');
                return focusedNode && focusedNode.toggleActivated();
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMousedown($event) {
        // alert('click');
        /** @type {?} */
        let insideClick = $event.target.closest('ng2tree');
        if (!insideClick) {
            this.treeModel.setFocus(false);
        }
    }
    /**
     * @param {?} elementId
     * @return {?}
     */
    searchAndLocationNodeById(elementId) {
        // console.log('succeeded to search and location Node By Id in treeComponent:', elementId);
        this.treeModel.locateNodeByID(elementId);
    }
    /**
     * @param {?} elementId
     * @return {?}
     */
    searchNodeById(elementId) {
        // console.log('succeeded to search and location Node By Id in treeComponent:', elementId);
        return this.treeModel.searchTreeNodeByID(elementId);
    }
}
TreeComponent.decorators = [
    { type: Component, args: [{
                selector: 'ng2tree',
                template: "<div class=\"tree\">\r\n    <!-- <div class=\"localFileTreeOperateTest\">\r\n      <button (click)=\"treeModel.addStaticTreeNode()\">\u65B0\u589E</button>\r\n      <button (click)=\"treeModel.removeFocusedTreeNode()\">\u5220\u9664</button>\r\n    </div> -->\r\n    <ng2tree-node\r\n      (click)=\"treeModel.setFocus(true)\"\r\n      *ngFor=\"let child of treeModel.roots; let i = index\"\r\n      [node]=\"child\"\r\n      [nodeIndex]=\"i\">\r\n    </ng2tree-node>\r\n</div>",
                providers: [
                    TreeModel
                ],
                styles: [".tree-children{padding-left:20px}.tree{display:inline-block;cursor:pointer;-webkit-user-select:none;-ms-user-select:none;-moz-user-select:none;user-select:none}"]
            }] }
];
/** @nocollapse */
TreeComponent.ctorParameters = () => [
    { type: TreeModel }
];
TreeComponent.propDecorators = {
    nodes: [{ type: Input }],
    options: [{ type: Input }],
    focused: [{ type: Input }],
    onToggle: [{ type: Output }],
    onActiveChanged: [{ type: Output }],
    onActivate: [{ type: Output }],
    onDeactivate: [{ type: Output }],
    onFocus: [{ type: Output }],
    onBlur: [{ type: Output }],
    onDoubleClick: [{ type: Output }],
    onContextMenu: [{ type: Output }],
    onRightMenuClicked: [{ type: Output }],
    onKeydown: [{ type: HostListener, args: ['body: keydown', ['$event'],] }],
    onMousedown: [{ type: HostListener, args: ['body: mousedown', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    TreeComponent.prototype._nodes;
    /** @type {?} */
    TreeComponent.prototype._options;
    /** @type {?} */
    TreeComponent.prototype.onToggle;
    /** @type {?} */
    TreeComponent.prototype.onActiveChanged;
    /** @type {?} */
    TreeComponent.prototype.onActivate;
    /** @type {?} */
    TreeComponent.prototype.onDeactivate;
    /** @type {?} */
    TreeComponent.prototype.onFocus;
    /** @type {?} */
    TreeComponent.prototype.onBlur;
    /** @type {?} */
    TreeComponent.prototype.onDoubleClick;
    /** @type {?} */
    TreeComponent.prototype.onContextMenu;
    /** @type {?} */
    TreeComponent.prototype.onRightMenuClicked;
    /** @type {?} */
    TreeComponent.prototype.treeModel;
    /* Skipping unhandled member: ;*/
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2lkZS1kZXZraXQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9uZzJ0cmVlLWNvbW1vbi9jb21wb25lbnRzL3RyZWUvdHJlZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWEsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hHLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDeEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sV0FBVyxDQUFDLENBQUEsZ0NBQWdDOzs7Ozs7Ozs7QUFtQjNFLE1BQU0sT0FBTyxhQUFhOzs7O0lBc0J0QixZQUFtQixTQUFtQjtRQUFuQixjQUFTLEdBQVQsU0FBUyxDQUFVO1FBQ3BDLFNBQVMsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUEsdUNBQXVDO0lBQ2pILENBQUM7Ozs7O0lBckJELElBQWEsS0FBSyxDQUFDLEtBQVcsSUFBSSxDQUFDO0lBQUEsQ0FBQzs7Ozs7SUFFcEMsSUFBYSxPQUFPLENBQUMsT0FBbUIsSUFBSSxDQUFDO0lBQUEsQ0FBQzs7Ozs7SUFFOUMsSUFBYSxPQUFPLENBQUMsS0FBYTtRQUNoQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixnQ0FBZ0M7SUFDbEMsQ0FBQzs7Ozs7SUFnQkQsV0FBVyxDQUFDLE9BQU87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TTs4QkFDTixNQUFNO3lCQUNOLE1BQU07MkJBQ04sTUFBTTtzQkFDTixNQUFNO3FCQUNOLE1BQU07NEJBQ04sTUFBTTs0QkFDTixNQUFNO2lDQUNOLE1BQU07d0JBZ0JOLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7MEJBK0N4QyxZQUFZLFNBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUM7Ozs7SUFqRjNDLCtCQUFhOztJQUViLGlDQUFxQjs7SUFRckIsaUNBQW1COztJQUNuQix3Q0FBMEI7O0lBQzFCLG1DQUFxQjs7SUFDckIscUNBQXVCOztJQUN2QixnQ0FBa0I7O0lBQ2xCLCtCQUFpQjs7SUFDakIsc0NBQXdCOztJQUN4QixzQ0FBd0I7O0lBQ3hCLDJDQUE2Qjs7SUFFakIsa0NBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkNoYW5nZXMsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyZWVNb2RlbCB9IGZyb20gJy4uLy4uL21vZGVscy90cmVlLW1vZGVsJztcclxuaW1wb3J0IHsgVHJlZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9tb2RlbHMvdHJlZS1vcHRpb25zJztcclxuaW1wb3J0IHsgS0VZUyB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy9rZXlzJztcclxuaW1wb3J0IHsgcGljaywgaW5jbHVkZXMgfSBmcm9tICdsb2Rhc2gtZXMnOy8v5bCGbG9kYXNo5a6J6KOF5Yiwbm9kZS1tb2R1bGVz5Lit77yM5a6e546w5oyJ6ZyA5byV5YWlXHJcbmltcG9ydCB7IFRyZWVOb2RlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL3RyZWUtbm9kZSc7XHJcblxyXG4vL+e6puWumuS9v+eUqOS4i+WIkue6v+ihqOekumxvZGFzaO+8jOWwseWDj+eUqCTooajnpLpqUXVlcnnkuIDmoLdcclxuLy8xLnJlcXVpcmXlhbPplK7lrZfkuI3ooqvor4bliKvvvJpcclxuLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzExNzM3MzgvdHlwZXNjcmlwdC1nZXR0aW5nLWVycm9yLXRzMjMwNC1jYW5ub3QtZmluZC1uYW1lLXJlcXVpcmVcclxuLy8gZGVjbGFyZSB2YXIgcmVxdWlyZTogYW55XHJcbi8vIGNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcclxuLy8yLuWuieijhWxvZGFzaOeahGVz54mI5pys77yaXHJcbi8vICgxKSAkPm5wbSBpIGxvZGFzaC1lc1xyXG4vLyAoMikgJD5ucG0gaW5zdGFsbCAtLXNhdmUgQHR5cGVzL2xvZGFzaFxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ25nMnRyZWUnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi90cmVlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi90cmVlLmNvbXBvbmVudC5jc3MnXSxcclxuICBwcm92aWRlcnM6W1xyXG4gICAgVHJlZU1vZGVsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVHJlZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XHJcbiAgICAvLyBkZWxlZ2F0aW5nIHRvIFRyZWVNb2RlbCBzZXJ2aWNlOlxyXG4gICAgX25vZGVzOmFueVtdO1xyXG4gICAgQElucHV0KCkgc2V0IG5vZGVzKG5vZGVzOmFueVtdKSB7IH07XHJcbiAgICBfb3B0aW9uczpUcmVlT3B0aW9ucztcclxuICAgIEBJbnB1dCgpIHNldCBvcHRpb25zKG9wdGlvbnM6VHJlZU9wdGlvbnMpIHsgfTtcclxuICAgIFxyXG4gICAgQElucHV0KCkgc2V0IGZvY3VzZWQodmFsdWU6Ym9vbGVhbikge1xyXG4gICAgICB0aGlzLnRyZWVNb2RlbC5zZXRGb2N1cyh2YWx1ZSk7XHJcbiAgICAgIC8vIGFsZXJ0KCdmb2N1c2VkIG9uIHRoZSB0cmVlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgQE91dHB1dCgpIG9uVG9nZ2xlO1xyXG4gICAgQE91dHB1dCgpIG9uQWN0aXZlQ2hhbmdlZDtcclxuICAgIEBPdXRwdXQoKSBvbkFjdGl2YXRlO1xyXG4gICAgQE91dHB1dCgpIG9uRGVhY3RpdmF0ZTtcclxuICAgIEBPdXRwdXQoKSBvbkZvY3VzO1xyXG4gICAgQE91dHB1dCgpIG9uQmx1cjtcclxuICAgIEBPdXRwdXQoKSBvbkRvdWJsZUNsaWNrO1xyXG4gICAgQE91dHB1dCgpIG9uQ29udGV4dE1lbnU7XHJcbiAgICBAT3V0cHV0KCkgb25SaWdodE1lbnVDbGlja2VkO1xyXG4gIFxyXG4gICAgY29uc3RydWN0b3IocHVibGljIHRyZWVNb2RlbDpUcmVlTW9kZWwpIHsgXHJcbiAgICAgIHRyZWVNb2RlbC5ldmVudE5hbWVzLmZvckVhY2goKG5hbWUpID0+IHRoaXNbbmFtZV0gPSBuZXcgRXZlbnRFbWl0dGVyKCkpOy8vY3VzdG9tRXZlbnROYW1lIC0+IG5ldyBFdmVudEVtaXR0ZXIoKVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcclxuICAgICAgdGhpcy50cmVlTW9kZWwuc2V0RGF0YSh7XHJcbiAgICAgICAgICBub2RlczogY2hhbmdlcy5ub2RlcyAmJiBjaGFuZ2VzLm5vZGVzLmN1cnJlbnRWYWx1ZSxcclxuICAgICAgICAgIG9wdGlvbnM6IGNoYW5nZXMub3B0aW9ucyAmJiBjaGFuZ2VzLm9wdGlvbnMuY3VycmVudFZhbHVlLFxyXG4gICAgICAgICAgZXZlbnRzOiBwaWNrKHRoaXMsIHRoaXMudHJlZU1vZGVsLmV2ZW50TmFtZXMpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8g5LyY5YWI5L2/55SoSG9zdExpc3RlbmVy6KOF6aWw5Zmo57uR5a6a5LqL5Lu277yM6ICM5LiN5piv5L2/55SoRGlyZWN0aXZl5oiWQ29tcG9uZW5055qEaG9zdOWFg+aVsOaNrlxyXG4gICAgLy8gV2hlbiBiaW5kaW5nIGV2ZW50cyB0byBEaXJlY3RpdmUgb3IgQ29tcG9uZW50LCBBbmd1bGFyIHN1Z2dlc3RzIHRvIHByZWZlciB0byBIb3N0TGlzdGVuZXIgZGVjb3JhdG9yLCBcclxuICAgIC8vIHJhdGhlciB0aGFuIGhvc3QgbWV0YWRhdGEuXHJcbiAgICBASG9zdExpc3RlbmVyKCdib2R5OiBrZXlkb3duJywgWyckZXZlbnQnXSkgb25LZXlkb3duKCRldmVudCkge1xyXG4gICAgICAvLyBhbGVydCgnUHJlc3NlZCBhIGtleScpO1xyXG4gICAgICBsZXQgZm9jdXNlZE5vZGUgPSB0aGlzLnRyZWVNb2RlbC5mb2N1c2VkTm9kZTtcclxuXHJcbiAgICAgIGlmICghdGhpcy50cmVlTW9kZWwuaXNGb2N1c2VkKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoaW5jbHVkZXMoW0tFWVMuRE9XTiwgS0VZUy5VUCwgS0VZUy5MRUZULFxyXG4gICAgICAgIEtFWVMuUklHSFQsIEtFWVMuRU5URVIsIEtFWVMuU1BBQ0VdLCAkZXZlbnQua2V5Q29kZSkpIHtcclxuICAgICAgICAkZXZlbnQucHJldmVudERlZmF1bHQoKTsvL+WPlua2iOS6i+S7tueahOm7mOiupOWKqOS9nO+8jOWunueOsOS7heWvuWluY2x1ZGVz6ZSu5ZON5bqUXHJcbiAgICAgIH1cclxuICBcclxuICAgICAgc3dpdGNoICgkZXZlbnQua2V5Q29kZSkge1xyXG4gICAgICAgIGNhc2UgS0VZUy5ET1dOOlxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMudHJlZU1vZGVsLmZvY3VzTmV4dE5vZGUoKTtcclxuICBcclxuICAgICAgICBjYXNlIEtFWVMuVVA6XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy50cmVlTW9kZWwuZm9jdXNQcmV2aW91c05vZGUoKTtcclxuICBcclxuICAgICAgICBjYXNlIEtFWVMuTEVGVDpcclxuICAgICAgICAgIC8vIGFsZXJ0KCdGb2N1cyBEcmlsbCBVcCcpO1xyXG4gICAgICAgICAgaWYgKGZvY3VzZWROb2RlLmlzRXhwYW5kZWQpIHtcclxuICAgICAgICAgICAgZm9jdXNlZE5vZGUudG9nZ2xlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50cmVlTW9kZWwuZm9jdXNEcmlsbFVwKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgXHJcbiAgICAgICAgY2FzZSBLRVlTLlJJR0hUOlxyXG4gICAgICAgICAgLy8gYWxlcnQoJ0ZvY3VzIERyaWxsIERvd24nKTtcclxuICAgICAgICAgIGlmIChmb2N1c2VkTm9kZS5pc0NvbGxhcHNlZCkge1xyXG4gICAgICAgICAgICBmb2N1c2VkTm9kZS50b2dnbGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVNb2RlbC5mb2N1c0RyaWxsRG93bigpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gIFxyXG4gICAgICAgIGNhc2UgS0VZUy5FTlRFUjpcclxuICAgICAgICBjYXNlIEtFWVMuU1BBQ0U6XHJcbiAgICAgICAgICAvLyBhbGVydCgnRW50ZXIgb3IgU3BhY2Uga2V5LicpO1xyXG4gICAgICAgICAgcmV0dXJuIGZvY3VzZWROb2RlICYmIGZvY3VzZWROb2RlLnRvZ2dsZUFjdGl2YXRlZCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQEhvc3RMaXN0ZW5lcignYm9keTogbW91c2Vkb3duJywgWyckZXZlbnQnXSkgIG9uTW91c2Vkb3duKCRldmVudCkge1xyXG4gICAgICAvLyBhbGVydCgnY2xpY2snKTtcclxuICAgICAgbGV0IGluc2lkZUNsaWNrID0gJGV2ZW50LnRhcmdldC5jbG9zZXN0KCduZzJ0cmVlJyk7Ly/liKTmlq3lvZPliY1kb23moJHkuIrkuIvmlofkuK3mmK/lkKbljIXlkKvmoJHnu4Tku7ZcclxuICAgICAgaWYgKCFpbnNpZGVDbGljaykge1xyXG4gICAgICAgIHRoaXMudHJlZU1vZGVsLnNldEZvY3VzKGZhbHNlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlYXJjaEFuZExvY2F0aW9uTm9kZUJ5SWQoZWxlbWVudElkKSB7XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdzdWNjZWVkZWQgdG8gc2VhcmNoIGFuZCBsb2NhdGlvbiBOb2RlIEJ5IElkIGluIHRyZWVDb21wb25lbnQ6JywgZWxlbWVudElkKTtcclxuICAgICAgdGhpcy50cmVlTW9kZWwubG9jYXRlTm9kZUJ5SUQoZWxlbWVudElkKTtcclxuICAgIH1cclxuXHJcbiAgICBzZWFyY2hOb2RlQnlJZChlbGVtZW50SWQpOiBUcmVlTm9kZSB7XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdzdWNjZWVkZWQgdG8gc2VhcmNoIGFuZCBsb2NhdGlvbiBOb2RlIEJ5IElkIGluIHRyZWVDb21wb25lbnQ6JywgZWxlbWVudElkKTtcclxuICAgICAgcmV0dXJuIHRoaXMudHJlZU1vZGVsLnNlYXJjaFRyZWVOb2RlQnlJRChlbGVtZW50SWQpO1xyXG4gICAgfVxyXG59Il19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
* @Author: 疯狂秀才(Lucas Huang)
* @LastEditors: 疯狂秀才(Lucas Huang)
* @Company: Inspur
* @Version: v0.1.8
* @Date: 2018-09-18 16:04:05
* @LastEditTime: 2019-10-17 13:42:45
*/
import { Component, ElementRef, ViewChild, Renderer2, Output, EventEmitter, Input } from '@angular/core';
import { LOADING_STYLES } from './loading.styles';
import { delay, filter, takeUntil } from 'rxjs/operators';
import { Subject, BehaviorSubject } from 'rxjs';
import { CommonUtils, DebugService } from '@farris/ui-common';
export class LoadingComponent {
    /**
     * @param {?} render
     * @param {?} el
     */
    constructor(render, el) {
        this.render = render;
        this.el = el;
        this.showMessage = true;
        this.loadingStyleDom = LOADING_STYLES;
        this._isActive = false;
        this.activeSubject = new BehaviorSubject(false);
        this.message = '';
        this.width = 30;
        /**
         * loading 样式
         */
        this.type = 0;
        this.delay = 300;
        this.closed = new EventEmitter();
        this.activedSubscrition = null;
        this.parentContainer = null;
        this.destroy$ = new Subject();
        this.debugSer = null;
        this.commonUtils = null;
        if (!this.debugSer) {
            this.debugSer = new DebugService();
        }
        if (this.debugSer.useDebugMode) {
            this.debugSer.useDebugMode();
        }
    }
    /**
     * @return {?}
     */
    get isActive() {
        return this._isActive;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set isActive(val) {
        this._isActive = val;
        if (this.activeSubject) {
            this.activeSubject.next(val);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.activedSubscrition = this.activeSubject.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            return n;
        })), delay(this.delay)).subscribe((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (v && this.isActive) {
                // this.render.setStyle(this.loadingContainerEl.nativeElement, 'display', 'block');
                this.render.setStyle(this.loadingBackdrop.nativeElement, 'display', 'block');
                this.render.setStyle(this.loadingContainerEl.nativeElement, 'left', 0);
                this.setPosition();
                this.render.removeStyle(this.loadingContainerEl.nativeElement, 'visibility');
                this.render.removeStyle(this.loadingContainerEl.nativeElement, 'left');
            }
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
        this.commonUtils = null;
    }
    /**
     * @return {?}
     */
    close() {
        if (this.loadingBackdrop) {
            this.loadingBackdrop.nativeElement.remove();
        }
        this.isActive = false;
        this.render.removeAttribute(this.el.nativeElement, 'class');
        // this.animate('f-component-loading fadeOut animated animated-0.5');
        this.closed.emit(this.isActive);
    }
    /**
     * @private
     * @return {?}
     */
    setPosition() {
        if (!this.commonUtils) {
            this.commonUtils = new CommonUtils();
        }
        /** @type {?} */
        const containerWidth = this.loadingContainerEl.nativeElement.clientWidth;
        /** @type {?} */
        const containerHeight = this.loadingContainerEl.nativeElement.clientHeight;
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginTop', -containerHeight / 2 + 'px');
        /** @type {?} */
        let ml = -containerWidth / 2 + 'px';
        if (this.parentContainer) {
            if (this.parentContainer.clientWidth <= 200) {
                ml = '-100px';
            }
        }
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'marginLeft', ml);
        /** @type {?} */
        const zindex = this.commonUtils.getFloatingLayerIndex();
        this.render.setStyle(this.loadingBackdrop.nativeElement, 'zIndex', zindex);
        this.render.setStyle(this.loadingContainerEl.nativeElement, 'zIndex', zindex + 1);
    }
    /**
     * @private
     * @param {?} animateCls
     * @return {?}
     */
    animate(animateCls) {
        this.addAnimationEndEvent('webkitAnimationEnd', 'mozAnimationEnd', 'MSAnimationEnd', 'oanimationend', 'animationend');
        this.render.setAttribute(this.el.nativeElement, 'class', animateCls);
    }
    /**
     * @private
     * @param {...?} events
     * @return {?}
     */
    addAnimationEndEvent(...events) {
        /** @type {?} */
        const _this = this;
        events.forEach((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            _this.el.nativeElement.addEventListener(e, (/**
             * @return {?}
             */
            function handler() {
                _this.el.nativeElement.removeEventListener(e, handler);
                // _this.render.removeAttribute(_this.el.nativeElement, 'class');
                ['fadeIn', 'fadeOut', 'animated', 'animated-0.5'].forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    _this.render.removeClass(_this.el.nativeElement, n);
                }));
                _this.closed.emit(_this.isActive);
            }));
        }));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    closeWhenClick5($event) {
        $event.stopPropagation();
        if (this.debugSer.isDebug) {
            this.commonUtils.clickContinuity((/**
             * @return {?}
             */
            () => {
                this.close();
            }));
        }
    }
}
LoadingComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-loading',
                template: `
        <div #loadingBackdrop class="farris-loading-backdrop loading-wait" (click)="closeWhenClick5($event)"></div>
        <div #loadingContainerEl class="farris-loading" style="visibility: hidden">
            <div class="ng-busy-default-wrapper">
                <div class="ng-busy-default-sign" >
                    <div [style.width]="width+ 'px'" [style.height]="width+'px'" style="display: inline-block;margin:4px;"
                                [innerHTML]="loadingStyleDom[type] | safe: 'html'"></div>
                    <div class="ng-busy-default-text" style="margin-left:0;"
                                 *ngIf="showMessage" [innerHTML]="'loading.message' | locale: '' :message | safe: 'html'"></div>
                </div>
            </div>
        </div>
    `,
                styles: [`.loading-wait {
            cursor: wait
        }
        .animated-0.5 {
            -webkit-animation-duration: 0s;
            animation-duration: 0s;
        }
        `]
            }] }
];
/** @nocollapse */
LoadingComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
LoadingComponent.propDecorators = {
    showMessage: [{ type: Input }],
    loadingContainerEl: [{ type: ViewChild, args: ['loadingContainerEl',] }],
    loadingBackdrop: [{ type: ViewChild, args: ['loadingBackdrop',] }],
    closed: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LoadingComponent.prototype.showMessage;
    /** @type {?} */
    LoadingComponent.prototype.loadingStyleDom;
    /** @type {?} */
    LoadingComponent.prototype.id;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype._isActive;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.activeSubject;
    /** @type {?} */
    LoadingComponent.prototype.message;
    /** @type {?} */
    LoadingComponent.prototype.width;
    /**
     * loading 样式
     * @type {?}
     */
    LoadingComponent.prototype.type;
    /** @type {?} */
    LoadingComponent.prototype.delay;
    /** @type {?} */
    LoadingComponent.prototype.loadingContainerEl;
    /** @type {?} */
    LoadingComponent.prototype.loadingBackdrop;
    /** @type {?} */
    LoadingComponent.prototype.closed;
    /** @type {?} */
    LoadingComponent.prototype.activedSubscrition;
    /** @type {?} */
    LoadingComponent.prototype.parentContainer;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.debugSer;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    LoadingComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWxvYWRpbmcvIiwic291cmNlcyI6WyJsaWIvbG9hZGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBU0EsT0FBTyxFQUFFLFNBQVMsRUFBVSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBaUIsTUFBTSxFQUFFLFlBQVksRUFBYSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0ksT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFELE9BQU8sRUFBRSxPQUFPLEVBQWdCLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5RCxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBNEI5RCxNQUFNLE9BQU8sZ0JBQWdCOzs7OztJQW9DekIsWUFBb0IsTUFBaUIsRUFBVSxFQUFjO1FBQXpDLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBbkNwRCxnQkFBVyxHQUFHLElBQUksQ0FBQztRQUM1QixvQkFBZSxHQUFHLGNBQWMsQ0FBQztRQUV6QixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLGtCQUFhLEdBQUcsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkQsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLFVBQUssR0FBRyxFQUFFLENBQUM7Ozs7UUFFWCxTQUFJLEdBQUcsQ0FBQyxDQUFDO1FBRVQsVUFBSyxHQUFHLEdBQUcsQ0FBQztRQWVGLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzNDLHVCQUFrQixHQUFpQixJQUFJLENBQUM7UUFFeEMsb0JBQWUsR0FBRyxJQUFJLENBQUM7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O0tBWVQ7eUJBRUc7Ozs7Ozs7U0FPQzthQUVSOzs7O1lBL0JrRCxTQUFTO1lBQWhDLFVBQVU7OzswQkFpQ2pDLEtBQUs7aUNBdUJMLFNBQVMsU0FBQyxvQkFBb0I7OEJBQzlCLFNBQVMsU0FBQyxpQkFBaUI7cUJBQzNCLE1BQU07Ozs7SUF6QlAsdUNBQTRCOztJQUM1QiwyQ0FBaUM7O0lBQ2pDLDhCQUFXOzs7OztJQUNYLHFDQUEwQjs7Ozs7SUFDMUIseUNBQW1EOztJQUNuRCxtQ0FBYTs7SUFDYixpQ0FBVzs7Ozs7SUFFWCxnQ0FBUzs7SUFFVCxpQ0FBWTs7SUFhWiw4Q0FBZ0U7O0lBQ2hFLDJDQUEwRDs7SUFDMUQsa0NBQTJDOztJQUMzQyw4Q0FBd0M7O0lBRXhDLDJDQUF1Qjs7Ozs7SUFFdkIsb0NBQWlDOzs7OztJQUVqQyxvQ0FBc0M7Ozs7O0lBQ3RDLHVDQUF3Qzs7Ozs7SUFFNUIsa0NBQXlCOzs7OztJQUFFLDhCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4qIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4qIEBDb21wYW55OiBJbnNwdXJcclxuKiBAVmVyc2lvbjogdjAuMS44XHJcbiogQERhdGU6IDIwMTgtMDktMTggMTY6MDQ6MDVcclxuKiBATGFzdEVkaXRUaW1lOiAyMDE5LTEwLTE3IDEzOjQyOjQ1XHJcbiovXHJcblxyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBSZW5kZXJlcjIsIEFmdGVyVmlld0luaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkRlc3Ryb3ksIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExPQURJTkdfU1RZTEVTIH0gZnJvbSAnLi9sb2FkaW5nLnN0eWxlcyc7XHJcbmltcG9ydCB7IGRlbGF5LCBmaWx0ZXIsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uLCBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIERlYnVnU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmYXJyaXMtbG9hZGluZycsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDxkaXYgI2xvYWRpbmdCYWNrZHJvcCBjbGFzcz1cImZhcnJpcy1sb2FkaW5nLWJhY2tkcm9wIGxvYWRpbmctd2FpdFwiIChjbGljayk9XCJjbG9zZVdoZW5DbGljazUoJGV2ZW50KVwiPjwvZGl2PlxyXG4gICAgICAgIDxkaXYgI2xvYWRpbmdDb250YWluZXJFbCBjbGFzcz1cImZhcnJpcy1sb2FkaW5nXCIgc3R5bGU9XCJ2aXNpYmlsaXR5OiBoaWRkZW5cIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWJ1c3ktZGVmYXVsdC13cmFwcGVyXCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibmctYnVzeS1kZWZhdWx0LXNpZ25cIiA+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBbc3R5bGUud2lkdGhdPVwid2lkdGgrICdweCdcIiBbc3R5bGUuaGVpZ2h0XT1cIndpZHRoKydweCdcIiBzdHlsZT1cImRpc3BsYXk6IGlubGluZS1ibG9jazttYXJnaW46NHB4O1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lubmVySFRNTF09XCJsb2FkaW5nU3R5bGVEb21bdHlwZV0gfCBzYWZlOiAnaHRtbCdcIj48L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibmctYnVzeS1kZWZhdWx0LXRleHRcIiBzdHlsZT1cIm1hcmdpbi1sZWZ0OjA7XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCJzaG93TWVzc2FnZVwiIFtpbm5lckhUTUxdPVwiJ2xvYWRpbmcubWVzc2FnZScgfCBsb2NhbGU6ICcnIDptZXNzYWdlIHwgc2FmZTogJ2h0bWwnXCI+PC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICBgLFxyXG4gICAgc3R5bGVzOiBbXHJcbiAgICAgICAgYC5sb2FkaW5nLXdhaXQge1xyXG4gICAgICAgICAgICBjdXJzb3I6IHdhaXRcclxuICAgICAgICB9XHJcbiAgICAgICAgLmFuaW1hdGVkLTAuNSB7XHJcbiAgICAgICAgICAgIC13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uOiAwcztcclxuICAgICAgICAgICAgYW5pbWF0aW9uLWR1cmF0aW9uOiAwcztcclxuICAgICAgICB9XHJcbiAgICAgICAgYFxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTG9hZGluZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgpIHNob3dNZXNzYWdlID0gdHJ1ZTtcclxuICAgIGxvYWRpbmdTdHlsZURvbSA9IExPQURJTkdfU1RZTEVTO1xyXG4gICAgaWQ6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX2lzQWN0aXZlID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGFjdGl2ZVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGZhbHNlKTtcclxuICAgIG1lc3NhZ2UgPSAnJztcclxuICAgIHdpZHRoID0gMzA7XHJcbiAgICAvKiogbG9hZGluZyDmoLflvI8gKi9cclxuICAgIHR5cGUgPSAwO1xyXG5cclxuICAgIGRlbGF5ID0gMzAwO1xyXG5cclxuICAgIGdldCBpc0FjdGl2ZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXNBY3RpdmU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGlzQWN0aXZlKHZhbDogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuX2lzQWN0aXZlID0gdmFsO1xyXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZVN1YmplY3QpIHtcclxuICAgICAgICAgICAgdGhpcy5hY3RpdmVTdWJqZWN0Lm5leHQodmFsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnbG9hZGluZ0NvbnRhaW5lckVsJykgbG9hZGluZ0NvbnRhaW5lckVsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnbG9hZGluZ0JhY2tkcm9wJykgbG9hZGluZ0JhY2tkcm9wOiBFbGVtZW50UmVmO1xyXG4gICAgQE91dHB1dCgpIGNsb3NlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgYWN0aXZlZFN1YnNjcml0aW9uOiBTdWJzY3JpcHRpb24gPSBudWxsO1xyXG5cclxuICAgIHBhcmVudENvbnRhaW5lciA9IG51bGw7XHJcblxyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBkZWJ1Z1NlcjogRGVidWdTZXJ2aWNlID0gbnVsbDtcclxuICAgIHByaXZhdGUgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIGVsOiBFbGVtZW50UmVmKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRlYnVnU2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVidWdTZXIgPSBuZXcgRGVidWdTZXJ2aWNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZWJ1Z1Nlci51c2VEZWJ1Z01vZGUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWJ1Z1Nlci51c2VEZWJ1Z01vZGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVkU3Vic2NyaXRpb24gPSB0aGlzLmFjdGl2ZVN1YmplY3QucGlwZShcclxuICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpXHJcbiAgICAgICAgKS5waXBlKFxyXG4gICAgICAgICAgICBmaWx0ZXIoKG46IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgZGVsYXkodGhpcy5kZWxheSlcclxuICAgICAgICApLnN1YnNjcmliZSh2ID0+IHtcclxuICAgICAgICAgICAgaWYgKHYgJiYgdGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5sb2FkaW5nQ29udGFpbmVyRWwubmF0aXZlRWxlbWVudCwgJ2Rpc3BsYXknLCAnYmxvY2snKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMubG9hZGluZ0JhY2tkcm9wLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnbGVmdCcsIDApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlU3R5bGUodGhpcy5sb2FkaW5nQ29udGFpbmVyRWwubmF0aXZlRWxlbWVudCwgJ3Zpc2liaWxpdHknKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHRoaXMubG9hZGluZ0NvbnRhaW5lckVsLm5hdGl2ZUVsZW1lbnQsICdsZWZ0Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2FkaW5nQmFja2Ryb3ApIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nQmFja2Ryb3AubmF0aXZlRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdjbGFzcycpO1xyXG4gICAgICAgIC8vIHRoaXMuYW5pbWF0ZSgnZi1jb21wb25lbnQtbG9hZGluZyBmYWRlT3V0IGFuaW1hdGVkIGFuaW1hdGVkLTAuNScpO1xyXG4gICAgICAgIHRoaXMuY2xvc2VkLmVtaXQodGhpcy5pc0FjdGl2ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQb3NpdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuY29tbW9uVXRpbHMpIHtcclxuICAgICAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IG5ldyBDb21tb25VdGlscygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IHRoaXMubG9hZGluZ0NvbnRhaW5lckVsLm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0O1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnbWFyZ2luVG9wJywgLWNvbnRhaW5lckhlaWdodCAvIDIgKyAncHgnKTtcclxuXHJcbiAgICAgICAgbGV0IG1sID0gLWNvbnRhaW5lcldpZHRoIC8gMiArICdweCdcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50Q29udGFpbmVyLmNsaWVudFdpZHRoIDw9IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgbWwgPSAnLTEwMHB4JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnbWFyZ2luTGVmdCcsIG1sKTtcclxuXHJcbiAgICAgICAgY29uc3QgemluZGV4ID0gdGhpcy5jb21tb25VdGlscy5nZXRGbG9hdGluZ0xheWVySW5kZXgoKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdCYWNrZHJvcC5uYXRpdmVFbGVtZW50LCAnekluZGV4JywgemluZGV4KTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmxvYWRpbmdDb250YWluZXJFbC5uYXRpdmVFbGVtZW50LCAnekluZGV4JywgemluZGV4ICsgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhbmltYXRlKGFuaW1hdGVDbHM6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuYWRkQW5pbWF0aW9uRW5kRXZlbnQoJ3dlYmtpdEFuaW1hdGlvbkVuZCcsICdtb3pBbmltYXRpb25FbmQnLCAnTVNBbmltYXRpb25FbmQnLCAnb2FuaW1hdGlvbmVuZCcsICdhbmltYXRpb25lbmQnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRBdHRyaWJ1dGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnY2xhc3MnLCBhbmltYXRlQ2xzKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFkZEFuaW1hdGlvbkVuZEV2ZW50KC4uLmV2ZW50czogc3RyaW5nW10pIHtcclxuICAgICAgICBjb25zdCBfdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICBfdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgZnVuY3Rpb24gaGFuZGxlcigpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBoYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgIC8vIF90aGlzLnJlbmRlci5yZW1vdmVBdHRyaWJ1dGUoX3RoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsYXNzJyk7XHJcbiAgICAgICAgICAgICAgICBbJ2ZhZGVJbicsICdmYWRlT3V0JywgJ2FuaW1hdGVkJywgJ2FuaW1hdGVkLTAuNSddLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVuZGVyLnJlbW92ZUNsYXNzKF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIG4pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jbG9zZWQuZW1pdChfdGhpcy5pc0FjdGl2ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlV2hlbkNsaWNrNSgkZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVidWdTZXIuaXNEZWJ1Zykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1vblV0aWxzLmNsaWNrQ29udGludWl0eSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
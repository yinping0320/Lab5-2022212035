/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { CommonUtils } from '@farris/ui-common';
/*
 * @Author: Lucas.Huang（疯狂秀才）
 * @Date: 2018-10-13 11:11:50
 * @Last Modified by:   Lucas.Huang（疯狂秀才）
 * @Last Modified time: 2018-10-13 11:11:50
 */
import { ElementRef, Component, Input, Injector, HostBinding, ViewChild, Renderer2 } from '@angular/core';
export class MessagerComponent {
    /**
     * @param {?} injector
     */
    constructor(injector) {
        this.injector = injector;
        this.showFontSize = false;
        this._message = '';
        this.msg = '';
        this.cls = 'farris-messager';
        this.okText = '';
        this.cancelText = '';
        this.showOkButton = true;
        this.showCancelButton = true;
        this.readonly = false;
        this.enableWordCount = false;
        this.countType = 'length';
        this.exception = null;
        this.showLines = 4;
        this.fontSize = '18';
        this.inputType = 'textarea';
        this.placeholder = '';
        this.buttons = [];
        this.expand = false;
        this.needShowExpand = false;
        this.wordsTotal = '';
        this.wrodsTotalTips = '';
        this.utils = this.injector.get(CommonUtils);
        this.localeService = this.injector.get(LocaleService);
        this.render = this.injector.get(Renderer2);
    }
    /**
     * @return {?}
     */
    get message() {
        return this._message;
    }
    /**
     * @param {?} str
     * @return {?}
     */
    set message(str) {
        this._message = (str === undefined || str === null) ? '' : '' + str;
        if (this.type === 'prompt' && this.utils) {
            this._message = this.utils.unescapeHtml(this._message);
        }
    }
    /**
     * @return {?}
     */
    get fontsizeName() {
        return this.localeService.getValue('messager.prompt.fontSize.name');
    }
    /**
     * @return {?}
     */
    get fontSmall() {
        return this.localeService.getValue('messager.prompt.fontSize.small');
    }
    /**
     * @return {?}
     */
    get fontMiddle() {
        return this.localeService.getValue('messager.prompt.fontSize.middle');
    }
    /**
     * @return {?}
     */
    get fontBig() {
        return this.localeService.getValue('messager.prompt.fontSize.big');
    }
    /**
     * @return {?}
     */
    get fontLarge() {
        return this.localeService.getValue('messager.prompt.fontSize.large');
    }
    /**
     * @return {?}
     */
    get fontHuge() {
        return this.localeService.getValue('messager.prompt.fontSize.huge');
    }
    /**
     * @return {?}
     */
    get expandText() {
        return this.localeService.getValue('messager.exception.expand');
    }
    /**
     * @return {?}
     */
    get collapseText() {
        return this.localeService.getValue('messager.exception.collapse');
    }
    /**
     * @return {?}
     */
    get happend() {
        return this.localeService.getValue('messager.exception.happend');
    }
    /**
     * @return {?}
     */
    get detail() {
        return this.localeService.getValue('messager.exception.detail');
    }
    /**
     * @return {?}
     */
    get exceptionMsgMaxHeight() {
        return window.innerHeight - 10 - 10 - 100 - 100 - 16;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.enableWordCount && this.promptText) {
                this.onTextChange(null);
            }
        }));
        this.type = this.type === 'exception' ? 'error' : this.type;
    }
    /**
     * @return {?}
     */
    get icon() {
        return 'f-icon-' + (this.type === 'exception' ? 'error' : this.type);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.exception && this.exception['message']) {
                /** @type {?} */
                const realWidth = this.excepMsgEl.nativeElement.getBoundingClientRect().width.toFixed(2) + 'px';
                this.render.setStyle(this.allexcepEl.nativeElement, 'width', realWidth);
                this.needShowExpand = this.allexcepEl.nativeElement.offsetHeight > this.excepMsgEl.nativeElement.offsetHeight;
            }
            else {
                this.needShowExpand = false;
            }
        }), 10);
    }
    /**
     * @param {?} val
     * @param {?} textAreaEl
     * @return {?}
     */
    onFontSizeChange(val, textAreaEl) {
        // this.promptText.nativeElement
        // textAreaEl.nativeElement.style['font-size'] = val;
    }
    /**
     * @private
     * @return {?}
     */
    getWordsTotal() {
        /** @type {?} */
        const c = this.countType === 'length' ? this.promptText.nativeElement.value.length
            : this.maxLength - this.promptText.nativeElement.value.length;
        return c;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onTextChange($event) {
        this.wordsTotal = this.getWordsTotal();
        this.wrodsTotalTips = this.localeService.getValue('messager.prompt.tips.' + this.countType).replace('{0}', this.wordsTotal);
    }
    /**
     * @param {?} t
     * @param {?} $event
     * @return {?}
     */
    expandMsg(t, $event) {
        $event.stopPropagation();
        if (t) {
            this.render.setStyle(this.excepMsgEl.nativeElement, 'overflow', 'auto');
            this.render.removeStyle(this.excepMsgEl.nativeElement, '-webkit-line-clamp');
        }
        else {
            this.render.setStyle(this.excepMsgEl.nativeElement, 'overflow', 'hidden');
            this.render.setStyle(this.excepMsgEl.nativeElement, '-webkit-line-clamp', this.showLines);
        }
        this.expand = t;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onCopyClick($event) {
        $event.stopPropagation();
        if (this.exception && this.exception.copyButton) {
            this.exception.copyButton.onClick({ event: $event, cmpRef: this });
        }
    }
    /**
     * @param {?} msg
     * @param {?=} timeout
     * @return {?}
     */
    showMiniNotify(msg, timeout = 700) {
        if (this.miniNotifyEl) {
            this.miniNotifyEl.nativeElement.innerText = msg;
            this.render.setStyle(this.miniNotifyEl.nativeElement, 'display', '');
            this.render.setStyle(this.miniNotifyEl.nativeElement, 'opacity', 0.8);
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.render.setStyle(this.miniNotifyEl.nativeElement, 'opacity', 0);
                this.render.setStyle(this.miniNotifyEl.nativeElement, 'display', 'none');
            }), timeout);
        }
    }
}
MessagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'farris-messager',
                template: "<!-- <section class=\"modal-tips d-flex flex-row\" *ngIf=\"type!=='prompt'\">\r\n    <div class=\"modal-tips-iconwrap\">\r\n        <span class=\"f-icon\" [ngClass]=\"icon\"></span>\r\n    </div>\r\n    <div class=\"modal-tips-content flex-fill fixdiv\">\r\n        <p class=\"toast-msg\" [innerHTML]=\"message\"></p>\r\n    </div>\r\n</section> -->\r\n\r\n<section class=\"modal-tips d-flex flex-row\" *ngIf=\"type!=='prompt'\" [ngClass]=\"'messager-type-'+type\">\r\n    <div class=\"float-left modal-tips-iconwrap\">\r\n        <span class=\"f-icon\" [ngClass]=\" icon\"></span>\r\n    </div>\r\n    <div class=\"modal-tips-content\">\r\n        <p class=\"toast-msg-title\" [innerHTML]=\"message | safe: 'html'\"></p>\r\n        <p class=\"toast-msg-detail\" [innerHTML]=\"msg | safe: 'html'\" *ngIf=\"msg !=='' && !exception\"></p>\r\n        <div class=\"toast-msg-detail\" *ngIf=\"exception\">\r\n            <div *ngIf=\"exception?.date\">{{happend}}: {{exception?.date}}</div>\r\n            <div id=\"exception_error_msg\" #excepMsg *ngIf=\"exception?.message\"\r\n                style=\"overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;\"\r\n                [style.-webkit-line-clamp]=\"showLines\" [style.max-height.px]=\"exceptionMsgMaxHeight\">\r\n                {{detail}}: <span [innerHTML]=\"exception?.message | safe: 'html'\"></span>\r\n            </div>\r\n            <span style=\"display: block; text-align: right;color:#2A87FF;\" *ngIf=\"needShowExpand\">\r\n                <span (click)=\"expandMsg(true, $event)\" style=\"cursor: pointer;\" *ngIf=\"!expand\">{{expandText}}</span>\r\n                <span (click)=\"expandMsg(false,  $event)\" style=\"cursor: pointer;\" *ngIf=\"expand\">{{collapseText}}</span>\r\n            </span>\r\n        </div>\r\n    </div>\r\n</section>\r\n<section class=\"modal-tips d-flex flex-row\"  *ngIf=\"type==='prompt'\">\r\n    <div class=\"flex-fill fixdiv mb-1 mr-3\" *ngIf=\"inputType === 'textarea'\">\r\n        <textarea #promptText name=\"promptMessage\" class=\"form-control\" [style.fontSize.px]=\"fontSize\"  style=\"height: 100%;resize: none\"\r\n            id=\"exampleFormControlTextarea1\" rows=\"4\" [attr.maxLength]=\"maxLength\" (input)=\"onTextChange($event)\" \r\n            >{{ message }}</textarea>\r\n        \r\n    </div>\r\n    <div class=\"flex-fill fixdiv mr-4 d-flex\" style=\"align-items: center;\" *ngIf=\"inputType !== 'textarea'\">\r\n        <input #promptText type=\"text\" class=\"form-control\" [attr.maxLength]=\"maxLength\"  (input)=\"onTextChange($event)\" [value]=\"message\"\r\n        placeholder=\"{{ placeholder }}\">\r\n    </div>\r\n\r\n</section>\r\n<span #wordCount class=\"textarea-wordcount\" *ngIf=\"enableWordCount && maxLength && maxLength > 0\" [attr.title]=\"wrodsTotalTips\"\r\n    style=\"position: relative;bottom: 10px;right: 20px;cursor: pointer;text-align: right;\">\r\n    {{ wordsTotal  + ' / ' + maxLength }}\r\n</span>\r\n\r\n<div class=\"modal-footer\" *ngIf=\"!(buttons && buttons.length) && (okText || cancelText)\">\r\n    <div class=\"d-flex flex-fill textarea-font-size\" style=\"text-align: left\" *ngIf=\"type==='prompt' && showFontSize\">\r\n        <span style=\"width:75px\">{{fontsizeName}}</span>\r\n        <select #fontSizeEl class=\"form-control\" style=\"max-width:100px\" [(ngModel)]=\"fontSize\" (change)=\"onFontSizeChange($event.target.value, promptText)\">\r\n            <option value=\"14\">{{fontSmall}}</option>\r\n            <option value=\"18\">{{fontMiddle}}</option>\r\n            <option value=\"24\">{{fontBig}}</option>\r\n            <option value=\"36\">{{fontLarge}}</option>\r\n            <option value=\"48\">{{fontHuge}}</option>\r\n        </select>\r\n    </div>\r\n\r\n    <button *ngIf=\"cancelText && showCancelButton\" type=\"button\" class=\"btn btn-secondary  btn-lg\" (click)=\"cancelHandle()\">{{ cancelText }}</button>\r\n    <button #btnOkEl *ngIf=\"okText && showOkButton\" type=\"button\" class=\"btn btn-primary btn-lg\" (click)=\"okHandle()\">{{ okText }}</button>\r\n</div>\r\n    \r\n    \r\n<div class=\"modal-footer\" *ngIf=\"buttons && buttons.length\">\r\n    <span *ngIf=\"exception && exception.copyButton && exception.copyButton.text\" style=\"width: 100%;color: #2A87FF;padding-left: 37px;\">\r\n        <span (click)=\"onCopyClick($event)\" style=\"cursor: pointer;\">{{exception.copyButton.text}}</span></span>\r\n    <button type=\"button\"  *ngFor=\"let btn of buttons\"  (click)=\"btn.handle()\" [farris-default-focus]=\"btn\" [class]=\"btn.cls\"><span [class]=\"btn.iconCls\" *ngIf=\"btn.iconCls\"></span>{{ btn.text}}</button>\r\n</div>\r\n\r\n\r\n<div style=\"position: absolute;left: -21990px;top: -20000px; word-break: break-all;\r\ncolor: #747B8B;font-size: .875rem;\" *ngIf=\"exception\" #allexcep>\r\n{{detail}}: <span [innerHTML]=\"exception?.message | safe: 'html'\"></span>\r\n</div>\r\n\r\n<div style=\"position: absolute;\r\nleft: 50%;\r\ntop: 50%;\r\nwidth: 100px;\r\nheight: 40px;\r\nbackground: #303C53;\r\nline-height: 40px;\r\ntext-align: center;\r\nmargin-left: -30px;\r\nmargin-top: -50px;\r\nborder-radius: 10px;\r\nbox-shadow: 0px 2px 8px 0px;\r\nopacity: 0;\r\ncolor: #fff;\r\ntransition: all .3s ease; display: none\" #miniNotify>\r\n\r\n</div>\r\n\r\n"
            }] }
];
/** @nocollapse */
MessagerComponent.ctorParameters = () => [
    { type: Injector }
];
MessagerComponent.propDecorators = {
    type: [{ type: Input }],
    showFontSize: [{ type: Input }],
    message: [{ type: Input }],
    msg: [{ type: Input }],
    cls: [{ type: HostBinding, args: ['class',] }],
    okText: [{ type: Input }],
    cancelText: [{ type: Input }],
    showOkButton: [{ type: Input }],
    showCancelButton: [{ type: Input }],
    readonly: [{ type: Input }],
    okHandle: [{ type: Input }],
    cancelHandle: [{ type: Input }],
    enableWordCount: [{ type: Input }],
    countType: [{ type: Input }],
    maxLength: [{ type: Input }],
    exception: [{ type: Input }],
    showLines: [{ type: Input }],
    promptText: [{ type: ViewChild, args: ['promptText',] }],
    fontSizeEl: [{ type: ViewChild, args: ['fontSizeEl',] }],
    wordCountEl: [{ type: ViewChild, args: ['wordCount',] }],
    excepMsgEl: [{ type: ViewChild, args: ['excepMsg',] }],
    allexcepEl: [{ type: ViewChild, args: ['allexcep',] }],
    miniNotifyEl: [{ type: ViewChild, args: ['miniNotify',] }],
    btnOkEl: [{ type: ViewChild, args: ['btnOkEl',] }],
    fontSize: [{ type: Input }],
    inputType: [{ type: Input }],
    placeholder: [{ type: Input }],
    buttons: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    MessagerComponent.prototype.type;
    /** @type {?} */
    MessagerComponent.prototype.showFontSize;
    /**
     * @type {?}
     * @private
     */
    MessagerComponent.prototype._message;
    /** @type {?} */
    MessagerComponent.prototype.msg;
    /** @type {?} */
    MessagerComponent.prototype.utils;
    /** @type {?} */
    MessagerComponent.prototype.localeService;
    /** @type {?} */
    MessagerComponent.prototype.render;
    /** @type {?} */
    MessagerComponent.prototype.cls;
    /** @type {?} */
    MessagerComponent.prototype.okText;
    /** @type {?} */
    MessagerComponent.prototype.cancelText;
    /** @type {?} */
    MessagerComponent.prototype.showOkButton;
    /** @type {?} */
    MessagerComponent.prototype.showCancelButton;
    /** @type {?} */
    MessagerComponent.prototype.readonly;
    /** @type {?} */
    MessagerComponent.prototype.okHandle;
    /** @type {?} */
    MessagerComponent.prototype.cancelHandle;
    /** @type {?} */
    MessagerComponent.prototype.enableWordCount;
    /** @type {?} */
    MessagerComponent.prototype.countType;
    /** @type {?} */
    MessagerComponent.prototype.maxLength;
    /** @type {?} */
    MessagerComponent.prototype.exception;
    /** @type {?} */
    MessagerComponent.prototype.showLines;
    /** @type {?} */
    MessagerComponent.prototype.promptText;
    /** @type {?} */
    MessagerComponent.prototype.fontSizeEl;
    /** @type {?} */
    MessagerComponent.prototype.wordCountEl;
    /** @type {?} */
    MessagerComponent.prototype.excepMsgEl;
    /** @type {?} */
    MessagerComponent.prototype.allexcepEl;
    /** @type {?} */
    MessagerComponent.prototype.miniNotifyEl;
    /** @type {?} */
    MessagerComponent.prototype.btnOkEl;
    /** @type {?} */
    MessagerComponent.prototype.fontSize;
    /** @type {?} */
    MessagerComponent.prototype.inputType;
    /** @type {?} */
    MessagerComponent.prototype.placeholder;
    /** @type {?} */
    MessagerComponent.prototype.buttons;
    /** @type {?} */
    MessagerComponent.prototype.expand;
    /** @type {?} */
    MessagerComponent.prototype.needShowExpand;
    /** @type {?} */
    MessagerComponent.prototype.wordsTotal;
    /** @type {?} */
    MessagerComponent.prototype.wrodsTotalTips;
    /**
     * @type {?}
     * @private
     */
    MessagerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1tZXNzYWdlci8iLCJzb3VyY2VzIjpbImxpYi9tZXNzYWdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7Ozs7QUFPaEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFpQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFPakksTUFBTSxPQUFPLGlCQUFpQjs7OztJQW9CMUIsWUFBb0IsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWxCN0IsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFFdEIsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQVliLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFVSSxRQUFHLEdBQUcsaUJBQWlCLENBQUM7UUFFckMsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDaEIsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBRXhCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFNakIsb0JBQWUsR0FBRyxLQUFLLENBQUM7UUFDeEIsY0FBUyxHQUFHLFFBQVEsQ0FBQztRQUdyQixjQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFVZCxhQUFRLEdBQUcsSUFBSSxDQUFDO1FBRWhCLGNBQVMsR0FBRyxVQUFVLENBQUM7UUFDdkIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFFakIsWUFBTyxHQUFtQixFQUFFLENBQUM7UUEwQ3RDLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixtQkFB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ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IENvbW1vblV0aWxzIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG4vKlxyXG4gKiBAQXV0aG9yOiBMdWNhcy5IdWFuZ++8iOeWr+eLguengOaJje+8iVxyXG4gKiBARGF0ZTogMjAxOC0xMC0xMyAxMToxMTo1MFxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogICBMdWNhcy5IdWFuZ++8iOeWr+eLguengOaJje+8iVxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE4LTEwLTEzIDExOjExOjUwXHJcbiAqL1xyXG5pbXBvcnQgeyBFbGVtZW50UmVmLCBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEluamVjdG9yLCBIb3N0QmluZGluZywgVmlld0NoaWxkLCBBZnRlclZpZXdJbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGlhbG9nQnV0dG9uIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmFycmlzLW1lc3NhZ2VyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9tZXNzYWdlci5jb21wb25lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIE1lc3NhZ2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgpIHR5cGU6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHNob3dGb250U2l6ZSA9IGZhbHNlO1xyXG5cclxuICAgIHByaXZhdGUgX21lc3NhZ2UgPSAnJztcclxuICAgIGdldCBtZXNzYWdlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9tZXNzYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIHNldCBtZXNzYWdlKHN0cikge1xyXG4gICAgICAgIHRoaXMuX21lc3NhZ2UgPSAoc3RyID09PSB1bmRlZmluZWQgfHwgc3RyID09PSBudWxsKSA/ICcnIDogJycgKyBzdHI7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ3Byb21wdCcgJiYgdGhpcy51dGlscykge1xyXG4gICAgICAgICAgICB0aGlzLl9tZXNzYWdlID0gdGhpcy51dGlscy51bmVzY2FwZUh0bWwodGhpcy5fbWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIG1zZyA9ICcnO1xyXG4gICAgdXRpbHM6IENvbW1vblV0aWxzO1xyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZTtcclxuICAgIHJlbmRlcjogUmVuZGVyZXIyO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICB0aGlzLnV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMpO1xyXG4gICAgICAgIHRoaXMubG9jYWxlU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsZVNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyID0gdGhpcy5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcclxuICAgIH1cclxuXHJcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzJykgY2xzID0gJ2ZhcnJpcy1tZXNzYWdlcic7XHJcblxyXG4gICAgQElucHV0KCkgb2tUZXh0ID0gJyc7XHJcbiAgICBASW5wdXQoKSBjYW5jZWxUZXh0ID0gJyc7XHJcbiAgICBASW5wdXQoKSBzaG93T2tCdXR0b24gPSB0cnVlO1xyXG4gICAgQElucHV0KCkgc2hvd0NhbmNlbEJ1dHRvbiA9IHRydWU7XHJcblxyXG4gICAgQElucHV0KCkgcmVhZG9ubHkgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBva0hhbmRsZTogKCkgPT4ge307XHJcbiAgICBASW5wdXQoKSBjYW5jZWxIYW5kbGU6ICgpID0+IHt9O1xyXG5cclxuXHJcbiAgICBASW5wdXQoKSBlbmFibGVXb3JkQ291bnQgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGNvdW50VHlwZSA9ICdsZW5ndGgnO1xyXG4gICAgQElucHV0KCkgbWF4TGVuZ3RoOiBudW1iZXI7XHJcblxyXG4gICAgQElucHV0KCkgZXhjZXB0aW9uID0gbnVsbDtcclxuICAgIEBJbnB1dCgpIHNob3dMaW5lcyA9IDQ7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgncHJvbXB0VGV4dCcpIHByb21wdFRleHQ6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmb250U2l6ZUVsJykgZm9udFNpemVFbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3dvcmRDb3VudCcpIHdvcmRDb3VudEVsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZXhjZXBNc2cnKSBleGNlcE1zZ0VsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnYWxsZXhjZXAnKSBhbGxleGNlcEVsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnbWluaU5vdGlmeScpIG1pbmlOb3RpZnlFbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2J0bk9rRWwnKSBidG5Pa0VsOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIEBJbnB1dCgpIGZvbnRTaXplID0gJzE4JztcclxuXHJcbiAgICBASW5wdXQoKSBpbnB1dFR5cGUgPSAndGV4dGFyZWEnO1xyXG4gICAgQElucHV0KCkgcGxhY2Vob2xkZXIgPSAnJztcclxuXHJcbiAgICBASW5wdXQoKSBidXR0b25zOiBEaWFsb2dCdXR0b25bXSA9IFtdO1xyXG5cclxuICAgIGdldCBmb250c2l6ZU5hbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIucHJvbXB0LmZvbnRTaXplLm5hbWUnKTtcclxuICAgIH1cclxuICAgIGdldCBmb250U21hbGwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIucHJvbXB0LmZvbnRTaXplLnNtYWxsJyk7XHJcbiAgICB9XHJcbiAgICBnZXQgZm9udE1pZGRsZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5wcm9tcHQuZm9udFNpemUubWlkZGxlJyk7XHJcbiAgICB9XHJcbiAgICBnZXQgZm9udEJpZygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdtZXNzYWdlci5wcm9tcHQuZm9udFNpemUuYmlnJyk7XHJcbiAgICB9XHJcbiAgICBnZXQgZm9udExhcmdlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLnByb21wdC5mb250U2l6ZS5sYXJnZScpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGZvbnRIdWdlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLnByb21wdC5mb250U2l6ZS5odWdlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGV4cGFuZFRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXhjZXB0aW9uLmV4cGFuZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBjb2xsYXBzZVRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXhjZXB0aW9uLmNvbGxhcHNlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGhhcHBlbmQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnbWVzc2FnZXIuZXhjZXB0aW9uLmhhcHBlbmQnKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGV0YWlsKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLmV4Y2VwdGlvbi5kZXRhaWwnKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZXhjZXB0aW9uTXNnTWF4SGVpZ2h0ICgpIHtcclxuICAgICAgICByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0IC0xMCAtMTAgLSAxMDAgLTEwMCAtMTY7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGV4cGFuZCA9IGZhbHNlO1xyXG4gICAgbmVlZFNob3dFeHBhbmQgPSBmYWxzZTtcclxuXHJcbiAgICB3b3Jkc1RvdGFsID0gJyc7XHJcbiAgICB3cm9kc1RvdGFsVGlwcyA9ICcnO1xyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lbmFibGVXb3JkQ291bnQgJiYgdGhpcy5wcm9tcHRUZXh0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uVGV4dENoYW5nZShudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnR5cGUgPSB0aGlzLnR5cGUgPT09ICdleGNlcHRpb24nID8gJ2Vycm9yJyA6IHRoaXMudHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaWNvbigpIHtcclxuICAgICAgICByZXR1cm4gJ2YtaWNvbi0nICsgKHRoaXMudHlwZSA9PT0gJ2V4Y2VwdGlvbicgPyAnZXJyb3InIDogdGhpcy50eXBlKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmV4Y2VwdGlvbiAmJiB0aGlzLmV4Y2VwdGlvblsnbWVzc2FnZSddKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWFsV2lkdGggPSB0aGlzLmV4Y2VwTXNnRWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aC50b0ZpeGVkKDIpICsgJ3B4JztcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuYWxsZXhjZXBFbC5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCByZWFsV2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZWVkU2hvd0V4cGFuZCA9IHRoaXMuYWxsZXhjZXBFbC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodCA+IHRoaXMuZXhjZXBNc2dFbC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmVlZFNob3dFeHBhbmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIDEwKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkZvbnRTaXplQ2hhbmdlKHZhbCwgdGV4dEFyZWFFbCkge1xyXG4gICAgICAgIC8vIHRoaXMucHJvbXB0VGV4dC5uYXRpdmVFbGVtZW50XHJcbiAgICAgICAgLy8gdGV4dEFyZWFFbC5uYXRpdmVFbGVtZW50LnN0eWxlWydmb250LXNpemUnXSA9IHZhbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFdvcmRzVG90YWwoKSB7XHJcbiAgICAgICAgY29uc3QgYyA9IHRoaXMuY291bnRUeXBlID09PSAnbGVuZ3RoJyA/IHRoaXMucHJvbXB0VGV4dC5uYXRpdmVFbGVtZW50LnZhbHVlLmxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5tYXhMZW5ndGggLSB0aGlzLnByb21wdFRleHQubmF0aXZlRWxlbWVudC52YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgcmV0dXJuIGM7XHJcbiAgICB9XHJcblxyXG4gICAgb25UZXh0Q2hhbmdlKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMud29yZHNUb3RhbCA9IHRoaXMuZ2V0V29yZHNUb3RhbCgpO1xyXG4gICAgICAgIHRoaXMud3JvZHNUb3RhbFRpcHMgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ21lc3NhZ2VyLnByb21wdC50aXBzLicgKyB0aGlzLmNvdW50VHlwZSkucmVwbGFjZSgnezB9JywgdGhpcy53b3Jkc1RvdGFsKTtcclxuICAgIH1cclxuXHJcbiAgICBleHBhbmRNc2codDogYm9vbGVhbiwgJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGlmICh0KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZXhjZXBNc2dFbC5uYXRpdmVFbGVtZW50LCAnb3ZlcmZsb3cnLCAnYXV0bycpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVTdHlsZSh0aGlzLmV4Y2VwTXNnRWwubmF0aXZlRWxlbWVudCwgJy13ZWJraXQtbGluZS1jbGFtcCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZXhjZXBNc2dFbC5uYXRpdmVFbGVtZW50LCAnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZXhjZXBNc2dFbC5uYXRpdmVFbGVtZW50LCAnLXdlYmtpdC1saW5lLWNsYW1wJywgdGhpcy5zaG93TGluZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5leHBhbmQgPSB0O1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBvbkNvcHlDbGljaygkZXZlbnQpIHtcclxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZXhjZXB0aW9uICYmIHRoaXMuZXhjZXB0aW9uLmNvcHlCdXR0b24pIHtcclxuICAgICAgICAgICAgdGhpcy5leGNlcHRpb24uY29weUJ1dHRvbi5vbkNsaWNrKHsgZXZlbnQ6ICRldmVudCwgY21wUmVmOiB0aGlzIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzaG93TWluaU5vdGlmeShtc2csIHRpbWVvdXQgPSA3MDApIHtcclxuICAgICAgICBpZiAodGhpcy5taW5pTm90aWZ5RWwpIHtcclxuICAgICAgICAgICAgdGhpcy5taW5pTm90aWZ5RWwubmF0aXZlRWxlbWVudC5pbm5lclRleHQgPSBtc2c7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMubWluaU5vdGlmeUVsLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgJycpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLm1pbmlOb3RpZnlFbC5uYXRpdmVFbGVtZW50LCAnb3BhY2l0eScsIDAuOCk7XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMubWluaU5vdGlmeUVsLm5hdGl2ZUVsZW1lbnQsICdvcGFjaXR5JywgMCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLm1pbmlOb3RpZnlFbC5uYXRpdmVFbGVtZW50LCAnZGlzcGxheScsICdub25lJyk7XHJcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("@farris/ui-datagrid"),require("@angular/forms"),require("@farris/ui-locale"),require("rxjs/operators"),require("resize-observer-polyfill"),require("@farris/ui-common"),require("@angular/common"),require("@farris/ui-time-picker"),require("@farris/ui-datepicker"),require("@farris/ui-number-spinner"),require("@farris/ui-datalist"),require("@farris/ui-forms"),require("lodash-es")):"function"==typeof define&&define.amd?define("@farris/ui-datagrid-filter",["exports","@angular/core","rxjs","@farris/ui-datagrid","@angular/forms","@farris/ui-locale","rxjs/operators","resize-observer-polyfill","@farris/ui-common","@angular/common","@farris/ui-time-picker","@farris/ui-datepicker","@farris/ui-number-spinner","@farris/ui-datalist","@farris/ui-forms","lodash-es"],e):e(((t=t||self).farris=t.farris||{},t.farris["ui-datagrid-filter"]={}),t.ng.core,t.rxjs,t.uiDatagrid,t.ng.forms,t.uiLocale,t.rxjs.operators,t.ResizeObserver,t.uiCommon,t.ng.common,t.uiTimePicker,t.uiDatepicker,t.uiNumberSpinner,t.uiDatalist,t.uiForms,t.lodashEs)}(this,function(t,e,n,i,o,r,l,a,s,c,d,u,p,f,h,m){"use strict";a=a&&a.hasOwnProperty("default")?a["default"]:a;var g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function y(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var v,b=function(){return(b=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},C={Equal:0,NotEqual:1,Greater:2,GreaterOrEqual:3,Less:4,LessOrEqual:5,Contains:6,NotContains:9,In:14,NotIn:15,Empty:1001,NotEmpty:1002,Null:1003,NotNull:1004};C[C.Equal]="Equal",C[C.NotEqual]="NotEqual",C[C.Greater]="Greater",C[C.GreaterOrEqual]="GreaterOrEqual",C[C.Less]="Less",C[C.LessOrEqual]="LessOrEqual",C[C.Contains]="Contains",C[C.NotContains]="NotContains",C[C.In]="In",C[C.NotIn]="NotIn",C[C.Empty]="Empty",C[C.NotEmpty]="NotEmpty",C[C.Null]="Null",C[C.NotNull]="NotNull";var x={All:"",Empty:"null"},F=((v={})[C.Equal]="等于",v[C.NotEqual]="不等于",v[C.Greater]="大于",v[C.GreaterOrEqual]="大于等于",v[C.Less]="小于",v[C.LessOrEqual]="小于等于",v[C.Contains]="包含",v[C.NotContains]="不包含",v[C.NotEmpty]="不为空",v[C.Empty]="空",v),E=[{code:C.Empty,label:F[C.Empty],isDefault:!1},{code:C.NotEmpty,label:F[C.NotEmpty],isDefault:!1},{code:C.Equal,label:F[C.Equal],isDefault:!1},{code:C.NotEqual,label:F[C.NotEqual],isDefault:!1},{code:C.Contains,label:F[C.Contains],isDefault:!0},{code:C.NotContains,label:F[C.NotContains],isDefault:!1}],k=[{code:C.Empty,label:F[C.Empty],isDefault:!1},{code:C.NotEmpty,label:F[C.NotEmpty],isDefault:!1},{code:C.Equal,label:F[C.Equal],isDefault:!1},{code:C.NotEqual,label:F[C.NotEqual],isDefault:!1},{code:C.Greater,label:F[C.Greater],isDefault:!1},{code:C.GreaterOrEqual,label:F[C.GreaterOrEqual],isDefault:!1},{code:C.Less,label:F[C.Less],isDefault:!1},{code:C.LessOrEqual,label:F[C.LessOrEqual],isDefault:!1}],w=function(){function t(){this.columnConditionSubject=new n.Subject,this.filterRowConditions$=this.columnConditionSubject.asObservable(),this.columnConditions={},this.filterTextboxChanged=new e.EventEmitter,this.removeField=new e.EventEmitter}return t.prototype.setFilterPanel=function(t){this.currentFilterPanel=t},t.prototype.hasFilterPanel=function(){return!!this.currentFilterPanel},t.prototype.closeFilterPanel=function(){this.hasFilterPanel()&&(this.currentFilterPanel.instance.documentClickHandle&&this.currentFilterPanel.instance.documentClickHandle(),document.body.removeChild(this.currentFilterPanel.location.nativeElement),this.currentFilterPanel.destroy(),this.currentFilterPanel=null)},t.prototype.clear=function(t){void 0===t&&(t=!0),this.columnConditions={},t&&this.columnConditionSubject.next({})},t.prototype.removeFilterField=function(t,e){this.columnConditions&&(delete this.columnConditions[t],this.removeField.emit(t),(!e||e&&e.emitEvent)&&this.emitColumnConditionChanged(this.columnConditions,t))},t.prototype._updateColumnConditions=function(t,e){var n,i,o=this,r=this.columnConditions[t];r?JSON.stringify(r)!==JSON.stringify(e)&&(this.columnConditions=Object.assign(this.columnConditions,((i={})[t]=e,i))):this.columnConditions=Object.assign(this.columnConditions,((n={})[t]=e,n)),Object.keys(this.columnConditions).forEach(function(t){o.columnConditions[t]||(o.columnConditions[t]=null)})},t.prototype.updateColumnConditions=function(t,e){this._updateColumnConditions(t,e),this.emitColumnConditionChanged(this.columnConditions)},t.prototype.emitColumnConditionChanged=function(t,e){this.columnConditionSubject.next({conditions:t,removedFields:e})},t.prototype.condition2string=function(t,e){if(!e||"string"==typeof e)return"";var n=this.gridInstance.localeService.getValue("datagrid.filter.and"),o=this.gridInstance.localeService.getValue("datagrid.filter.or"),r=function(t){return"and"===t?n:"or"===t?o:""},l="";if(t.filter.type===i.ColumnFilterType.fromdata)l="("+e.value1.length+")",e.value1&&(l+=" "+e.value1.join(","));else if(t.filter.type===i.ColumnFilterType["enum"]){var a=this.getEnumOptions(t),s=a.valueField,c=a.textField,d=a.data;l="("+e.value1.length+")",e.value1&&(l+=" "+e.value1.map(function(t){return d.find(function(e){return e[s]==t})[c]}).join(","))}else if(e){var u=this.getOperatorLabel(e.operator1);if(this.isEmpty(e.value1)){var p=parseInt(""+e.operator1,10);p!==C.Empty&&p!==C.NotEmpty||(l=""+u)}else{l=u+" "+e.value1;var f=this.getOperatorLabel(e.operator2);if(this.isEmpty(e.value2)){if(e.operator2!==undefined){var h=parseInt(""+e.operator2,10);h!==C.Empty&&h!==C.NotEmpty||(l+=" "+r(e.relation)+" "+f)}}else l+=" "+r(e.relation)+" "+f+" "+e.value2}}return l},t.prototype.isEmpty=function(t){return""===t||t===undefined||null===t},t.prototype.getEnumOptions=function(t){var e=t.filter,n=null;if(e.type===i.ColumnFilterType["enum"]){var o=t.formatter;o?n=o.options:e.options&&(n=e.options)}else{var r=this.gridInstance.dfs.getData(!0).map(function(e){return i.DatagridUtils.getValue(t.field,e)});n={valueField:"value",textField:"label",data:Array.from(new Set(r)).map(function(t){return{value:t,label:t}}),idField:"value"}}return n},t.prototype.getOperatorLabel=function(t){var e=C[t];if(e){var n="datagrid.filter.operators."+(e[0].toLowerCase()+e.substr(1));return this.gridInstance.localeService.getValue(n)}return""},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),I=function(){function t(t,n,o,r,l){this.ngzone=t,this.el=n,this.render=o,this.dfrs=r,this.inject=l,this.width=240,this.height=250,this.datatype=i.ColumnFilterType.string,this.conditionChange=new e.EventEmitter,this.panelHeightChange=new e.EventEmitter,this.gridInstance=null,this.enumSetting={},this.condition={operator1:1,value1:"",relation:"",operator2:1,value2:""},this.documentClickHandle=null,this.ro=null,this.zone=null,this.zone=this.inject.get(e.NgZone),this.commonUtils=this.inject.get(s.CommonUtils,new s.CommonUtils),this.overlaySer=this.inject.get(s.OverLayHiddenService,new s.OverLayHiddenService)}return t.prototype.ngOnInit=function(){var t=this;this.ngzone.runOutsideAngular(function(){t.render.listen(t.el.nativeElement,"click",function(t){return t.stopPropagation(),!1})}),this.initEnumSetting(),this.overlaySer.registerMouseEvent(this.el.nativeElement,function(e){var n=e.target;n&&n.closest(".overlay-container")||document.body.className.indexOf("modal-open")>-1||t.el.nativeElement.contains(e.target)||t.close(e)})},t.prototype.ngAfterViewInit=function(){if(this.target){this.resetPanelPosition();var t=this.el.nativeElement.querySelector("div");t.style.transition="top 0.2s ease 0.05s";var e=this.commonUtils.getFloatingLayerIndex();t.style.zIndex=e;var n=this.el.nativeElement.querySelector(".filter-panel-overlay");n&&(n.style.zIndex=e,t.style.zIndex=e+1)}},t.prototype.ngOnDestroy=function(){this.overlaySer&&this.overlaySer.destory(this.el.nativeElement)},t.prototype.resetPanelPosition=function(){var t=this.el.nativeElement.querySelector("div"),e=t.querySelector(".panel-content").clientHeight+36,n=this.target.target.parentElement.getBoundingClientRect();if(window.innerHeight-n.top<e){var i=window.innerHeight-e-10;t.style.top=i+"px"}else t.style.top=n.top+"px"},t.prototype.onPanelHeightChanged=function(){this.resetPanelPosition(),this.panelHeightChange.emit()},t.prototype.close=function(t){t.stopPropagation(),this.dfrs.closeFilterPanel()},t.prototype.onValueChange=function(t){this.conditionChange.emit(t)},t.prototype.initEnumSetting=function(){if(this.datatype>5){this.enumSetting=this.dfrs.getEnumOptions(this.column);var t=this.dfrs.columnConditions[this.column.field];t&&t.value1&&(this.selectedValues=t.value1.join(","))}},t.decorators=[{type:e.Component,args:[{selector:"filter-row-panel",template:'<div class="f-datagrid-filter-panel d-flex flex-column" style="position: fixed;" [style.width.px]="width"  (click)="$event.stopPropagation()">\r\n    <div class="panel-header">\r\n        <div (click)="close($event)" class="panel-icon" style="text-align: center; cursor: pointer;">\r\n            <span class="f-icon f-icon-filter-sm"></span>\r\n        </div> \r\n    </div>\r\n    <div class="panel-content flex-fill">\r\n        <condition-editor *ngIf="datatype < 6"\r\n            [datatype]="datatype"\r\n            [condition]="condition"\r\n            [operators]="operators"\r\n            [filterOptions]="column.filter.options"\r\n            (conditionChange)="onValueChange($event)"\r\n            (panelHeightChange)="onPanelHeightChanged()"></condition-editor>\r\n            \r\n\r\n        <filter-datalist *ngIf="datatype === 6 || datatype === 7" \r\n            [data]="enumSetting?.data" [valueField]="enumSetting?.valueField"\r\n            [textField]="enumSetting?.textField" [idField]="enumSetting?.valueField"\r\n            [selectedValues]="selectedValues"\r\n            (valueChange)="onValueChange($event)"></filter-datalist>\r\n    </div>\r\n</div>\r\n\r\n<div class="filter-panel-overlay" style="position: absolute;\r\nposition: absolute;\r\nwidth: 100%;\r\ntop: 0;\r\nheight: 100%;\r\nbackground: rgb(255, 255, 255);\r\nopacity: 0;" (click)="close($event)"></div>\r\n'}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.ElementRef},{type:e.Renderer2},{type:w},{type:e.Injector}]},t.propDecorators={width:[{type:e.Input}],height:[{type:e.Input}],column:[{type:e.Input}],operators:[{type:e.Input}],datatype:[{type:e.Input}],conditionChange:[{type:e.Output}],panelHeightChange:[{type:e.Output}]},t}(),S=function(){function t(){this.id=""}return t.prototype.ngOnInit=function(){this.id="filter-row_"+this.column.field},t.prototype.clearValue=function(){},t.decorators=[{type:e.Component,args:[{selector:"filter-editor",template:""}]}],t.ctorParameters=function(){return[]},t.propDecorators={column:[{type:e.Input}]},t}(),O=function(t){function n(n,o,r,a,s,c,d){var u=t.call(this)||this;return u.cfr=n,u.injector=o,u.app=r,u.dfrs=a,u.render=s,u.cd=c,u.localSer=d,u.disabled=!1,u.delay=300,u.filterStr="",u.filterPanelSubscription=null,u.ro=null,u.zone=null,u.el=null,u.zone=u.injector.get(e.NgZone),u.el=u.injector.get(e.ElementRef),u.dfrs.filterTextboxChanged.pipe(l.filter(function(t){return t[u.column.field]!==undefined}),l.delay(u.delay)).subscribe(function(t){var e=t[u.column.field];if(""!==e){var n={operator1:C.Contains,value1:e};u.column.filter.type===i.ColumnFilterType.number&&(n.operator1=C.Equal),u.dfrs.updateColumnConditions(u.column.field,n)}else u.dfrs.updateColumnConditions(u.column.field,x.All)}),u.dfrs.removeField.subscribe(function(t){t===u.column.field&&u.clearValue()}),u}return y(n,t),Object.defineProperty(n.prototype,"inputType",{get:function(){return this.column.filter.type===i.ColumnFilterType.number?"number":"text"},enumerable:!0,configurable:!0}),n.prototype.ngOnDestroy=function(){this.ro&&(this.ro.disconnect(),this.ro=null)},n.prototype.show=function(t){var e=this;this.close(),t.stopPropagation();var n=t.target.closest(".f-datagrid");n&&n.addEventListener("click",function(t){e.close()}),this.dfrs.gridInstance||(this.dfrs.gridInstance=this.gridInstance);var o=this.cfr.resolveComponentFactory(I);this.filterPanelRef=o.create(this.injector),this.app.attachView(this.filterPanelRef.hostView),this.filterPanelRef.instance.column=this.column,this.filterPanelRef.instance.gridInstance=this.gridInstance,this.initOperators(this.filterPanelRef.instance),!1!==this.column.filter&&this.column.filter!==undefined&&(this.filterPanelRef.instance.datatype=this.column.filter.type,this.column.filter.type!==i.ColumnFilterType["enum"]&&this.column.filter.type!==i.ColumnFilterType.fromdata||(this.filterPanelRef.instance.height=300));var r=this.dfrs.columnConditions[this.column.field];this.filterPanelRef.instance.condition=r||{operator1:0,value1:"",relation:"",operator2:0,value2:""},this.filterPanelSubscription=this.filterPanelRef.instance.conditionChange.subscribe(function(t){t?(e.dfrs.updateColumnConditions(e.column.field,t),e.filterStr=e.dfrs.condition2string(e.column,t),e.column.filter.type<2&&(e.disabled=!!e.filterStr),e.cd.detectChanges()):(e.clearValue(),e.dfrs.updateColumnConditions(e.column.field,x.All))}),document.body.appendChild(this.filterPanelRef.location.nativeElement),this.updateFilterPanelPosition(t.target),this.dfrs.setFilterPanel(this.filterPanelRef);var l=n.getBoundingClientRect(),s=l.width,c=l.height;this.DG_CONTAINER_SIZE={width:s,height:c},this.filterPanelRef.instance.panelHeightChange.subscribe(function(){var t=n.getBoundingClientRect(),i=t.width,o=t.height;e.DG_CONTAINER_SIZE={width:i,height:o}}),this.zone.runOutsideAngular(function(){e.ro||(e.ro=new a(function(t,n){e.resize_timer_001&&clearTimeout(e.resize_timer_001),e.resize_timer_001=setTimeout(function(){var n=t[0].target.getBoundingClientRect(),i=n.width,o=n.height,r=e.DG_CONTAINER_SIZE,l=r.width,a=r.height;(!e.gridInstance.autoHeight||l!=i&&l-i!=7&&l-i!=-7)&&(i===l&&o===a||e.close())},30)}),setTimeout(function(){e.ro.observe(n)}))}),this.filterPanelRef.instance.target=t,this.filterPanelRef.changeDetectorRef.markForCheck(),this.filterPanelRef.changeDetectorRef.detectChanges()},n.prototype.close=function(){this.dfrs.closeFilterPanel(),this.filterPanelSubscription&&(this.filterPanelSubscription.unsubscribe(),this.filterPanelSubscription=null)},n.prototype.initOperators=function(t){var e=this;this.column.filter.type===i.ColumnFilterType.string?(t.operators=E,t.condition.operator1=C.Contains,t.condition.operator2=C.Contains):this.column.filter.type!==i.ColumnFilterType.number&&this.column.filter.type!==i.ColumnFilterType.datetime&&this.column.filter.type!==i.ColumnFilterType.date&&this.column.filter.type!==i.ColumnFilterType.time||(t.operators=k,t.condition.operator1=C.Equal,t.condition.operator2=C.Equal),t.operators&&t.operators.forEach(function(t){t.label=e.dfrs.getOperatorLabel(t.code)})},n.prototype.updateFilterPanelPosition=function(t){if(t){var e=t.parentElement;if(e){var n=e.getBoundingClientRect(),i=(t.closest("tr"),t.closest("td")),o=t.closest(".f-datagrid-header").getBoundingClientRect(),r=this.filterPanelRef.instance.width,l=n.left;o.width+o.x<n.x+r&&(l=i.getBoundingClientRect().left+i.offsetWidth-r,this.filterPanelRef.location.nativeElement.querySelector(".panel-icon").style.left=r-40+"px");var a=this.filterPanelRef.location.nativeElement.querySelector("div");a&&(this.render.setStyle(a,"top",n.top+"px"),this.render.setStyle(a,"left",l+"px"))}}},n.prototype.onTextValueChange=function(t){var e,n=t.target.value;this.dfrs.filterTextboxChanged.emit(((e={})[this.column.field]=n,e))},n.prototype.clearValue=function(){this.filterStr="",this.input&&(this.input.nativeElement.value=""),this.column.filter.type<2&&(this.disabled=!1),this.cd.detectChanges()},n.prototype.initFilter=function(t){this.filterStr=this.dfrs.condition2string(this.column,t),this.disabled=!!this.filterStr,this.dfrs._updateColumnConditions(this.column.field,t),this.cd.detectChanges()},n.decorators=[{type:e.Component,args:[{selector:"filter-textbox",template:'\n    <div class="f-datagrid-header-cell-content f-datagrid-filter-cell d-flex" style="padding-right: 5px">\n        <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill">\n            <input *ngIf="!disabled" class="form-control" [attr.type]="inputType" [value]="filterStr"\n                (input)="onTextValueChange($event)" #input [class.no-number-button]="inputType == \'number\'">\n            <input *ngIf="disabled" class="form-control" type="text" [value]="filterStr"\n            [attr.title]="filterStr" [disabled]="disabled" [class.filter-editor-disabled]="disabled" >\n        </div>\n        <div style="min-width: 26px; text-align: center; align-items: center;\n            display: flex; justify-content: center;" *ngIf="column.filter.enableOperator">\n            <span style="cursor: pointer;" class="f-icon f-icon-filter-sm" (click)="show($event)"></span>\n        </div>\n    </div>\n    ',styles:["\n        .no-number-button{-moz-appearance: textfield;}\n        .no-number-button::-webkit-outer-spin-button, .no-number-button::-webkit-inner-spin-button {\n              -webkit-appearance: none!important;\n        }"]}]}],n.ctorParameters=function(){return[{type:e.ComponentFactoryResolver},{type:e.Injector},{type:e.ApplicationRef},{type:w},{type:e.Renderer2},{type:e.ChangeDetectorRef},{type:r.LocaleService}]},n.propDecorators={column:[{type:e.Input}],disabled:[{type:e.Input}],delay:[{type:e.Input}],input:[{type:e.ViewChild,args:["input"]}]},n}(S),R=function(t){function n(e,n,i){var o=t.call(this)||this;return o.dfrs=e,o.cd=n,o.inject=i,o.i=0,o.checked=!1,o.dfrs.removeField.subscribe(function(t){t===o.column.field&&o.clearValue()}),o}return y(n,t),n.prototype.ngOnInit=function(){t.prototype.ngOnInit.call(this),this.chk.nativeElement.indeterminate=!0},n.prototype.checkedChange=function(t){if(this.dfrs.closeFilterPanel(),this.i>0&&(this.checked=!this.checked),this.i+=1,this.i>2?(this.i=0,this.chk.nativeElement.indeterminate=!0):this.chk.nativeElement.indeterminate=!1,0===this.i)this.dfrs.updateColumnConditions(this.column.field,x.All),this.checked=!1;else{var e={operator1:C.Equal,value1:this.checked};this.dfrs.updateColumnConditions(this.column.field,e)}this.cd.detectChanges(),t.stopPropagation()},n.prototype.clearValue=function(){this.checked=!1,this.chk.nativeElement.indeterminate=!0,this.cd.detectChanges()},n.prototype.initFilter=function(t){t&&Object.keys(t).length?(this.checked=t.value1,this.chk.nativeElement.indeterminate=!1,this.i=this.checked?2:1):(this.checked=!1,this.chk.nativeElement.indeterminate=!0,this.i=0),this.dfrs._updateColumnConditions(this.column.field,t),this.cd.detectChanges()},n.decorators=[{type:e.Component,args:[{selector:"filter-checkbox",template:'\n    <div class="custom-control custom-checkbox f-checkradio-single">\n        <input [name]="column.field" [checked]="checked" type="checkbox" #chk class="custom-control-input">\n        <label class="custom-control-label" (click)="checkedChange($event)"></label>\n    </div>\n    '}]}],n.ctorParameters=function(){return[{type:w},{type:e.ChangeDetectorRef},{type:e.Injector}]},n.propDecorators={chk:[{type:e.ViewChild,args:["chk"]}]},n}(S),P=function(){function t(t,e,n,i){this.injector=t,this.resolver=e,this.container=n,this.render=i,this.delay=300}return t.prototype.ngOnInit=function(){this.createFilterEditor()},t.prototype.createFilterEditor=function(){var t=this;if(this.column.filter){var e=this.column.filter;e.type=e.type||i.ColumnFilterType.string;var n=O;switch(e.type){case i.ColumnFilterType.boolean:n=R}var o=this.resolver.resolveComponentFactory(n);this.componentRef=this.container.createComponent(o),this.componentRef.instance.column=this.column,this.componentRef.instance.group=this.group,this.componentRef.instance.gridInstance=this.gridInstance,this.componentRef.instance.disabled=e.type>=3,this.componentRef.instance.delay=this.delay,this.gridInstance.conditions&&Object.keys(this.gridInstance.conditions).length&&setTimeout(function(){t.componentRef.instance.initFilter(t.gridInstance.conditions[t.column.field])},100)}},t.prototype.clearValue=function(){this.componentRef&&this.componentRef.instance.clearValue()},t.decorators=[{type:e.Directive,args:[{selector:"[filter-cell-editor]"}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef},{type:e.Renderer2}]},t.propDecorators={column:[{type:e.Input}],group:[{type:e.Input}],gridInstance:[{type:e.Input}],delay:[{type:e.Input}]},t}(),N=function(){function t(t,n,i,r,l,a,s){var c=this;this.fb=t,this.el=n,this.ngzone=i,this.cd=r,this.dfrs=l,this.render=a,this.inject=s,this.fixedLeft=!1,this.fixedRight=!1,this.delay=300,this.conditionChange=new e.EventEmitter,this.form=new o.FormGroup({}),this.filterRowConditionsScribe=this.dfrs.filterRowConditions$.subscribe(function(t){c.conditionChange.emit(t)})}return t.prototype.ngOnInit=function(){var t=this;this.form=this.createControl(),this.ngzone.runOutsideAngular(function(){t.render.listen("document","click",function(){t.dfrs.closeFilterPanel()})})},t.prototype.ngAfterViewInit=function(){var t=this,e=this.el.nativeElement;this.tr=e.parentElement,e.querySelectorAll("td").forEach(function(e){t.tr.append(e)}),e.style.display="none",this.dfrs.gridInstance=this.gridInstance},t.prototype.ngOnDestroy=function(){var t=this;if(this.filterRowConditionsScribe&&(this.filterRowConditionsScribe.unsubscribe(),this.filterRowConditionsScribe=null),this.tr){var e=this.tr.querySelectorAll("td");e&&e.length&&e.forEach(function(e){e.classList.contains("f-datagrid-header-checkbox")||e.classList.contains("f-datagrid-cell-rownumber")||t.tr.removeChild(e)})}},t.prototype.createControl=function(){var t=this,e=this.fb.group({});return this.columns.forEach(function(n){if(!n.colspan){var i=t.fb.control("");e.addControl(n.field,i)}}),e},t.prototype.clearFilterValue=function(t){void 0===t&&(t=!0),this.editors.forEach(function(t){t.clearValue()}),this.dfrs.clear(t)},t.prototype.removeField=function(t,e){this.dfrs.removeFilterField(t,e)},t.decorators=[{type:e.Component,args:[{selector:"[filter-row]",template:'\r\n\x3c!-- <td *ngIf="gridInstance.showCheckbox  && fixedLeft && gridInstance.enableDragColumn"></td>\r\n<td *ngIf="gridInstance.showLineNumber && fixedLeft && gridInstance.enableDragColumn"></td> --\x3e\r\n<td *ngFor="let col of columns" class="f-datagrid-header-cell f-datagrid-filter-td" \r\n    style="text-align: center;" [attr.id]="\'filter-row_\' + col.field ">\r\n    <ng-container filter-cell-editor [delay]="delay" [gridInstance]="gridInstance" [column]="col" [group]="form"></ng-container>\r\n</td>\r\n\r\n',providers:[w],encapsulation:e.ViewEncapsulation.None,styles:[".filter-condition .list-group-item{padding:10px;background:#f8f8f8}.filter-condition .datalist{min-height:100px;max-height:200px;overflow:auto}.filter-condition .datalist::-webkit-scrollbar{width:15px;height:15px}.filter-condition .datalist::-webkit-scrollbar-thumb{background-color:#c2c2c2;border-radius:10px;background-clip:content-box}.filter-condition .datalist::-webkit-scrollbar-thumb:hover{background-color:#7d7d7d;border-radius:10px;background-clip:content-box}.filter-condition .datalist::-webkit-scrollbar-thumb:vertical,.filter-condition .datalist::-webkit-scrollbar-thumb:vertical:hover{border:3px solid transparent;border-left-width:4px}.filter-condition .datalist::-webkit-scrollbar-thumb:horizontal,.filter-condition .datalist::-webkit-scrollbar-thumb:horizontal:hover{border:3px solid transparent;border-top:4px solid transparent}.filter-condition .datalist::-webkit-scrollbar-track{background-color:#fafafa}.filter-condition .datalist::-webkit-scrollbar-track:vertical{border-left:1px solid #e8e8e8}.filter-condition .datalist::-webkit-scrollbar-track:horizontal{border-top:1px solid #e8e8e8}.filter-condition .datalist::-webkit-scrollbar-corner{background-color:#fafafa}.filter-condition farris-datalist .card{border:0}.filter-condition .card .list-group-item{padding-left:0;padding-right:0}.filter-condition .list-group-item.border-b1{border-bottom:1px solid #dde2eb!important;margin-bottom:0}.f-datagrid-filter-panel{background:#f8f8f8;position:absolute;z-index:999;box-shadow:0 1px 4px 1px rgba(186,191,199,.4);top:140px;left:1257px;width:200px;border-radius:3px;border:1px solid #babfc7}.f-datagrid-filter-panel .panel-header{height:36px;min-height:36px;border-bottom:1px solid #2196f3;text-align:center;line-height:36px;color:#2196f3}.f-datagrid-filter-td .filter-editor-disabled{color:rgba(24,29,31,.5);background-color:#f1f2f4;border-color:rgba(186,191,199,.3)}.f-datagrid-filter-td .filter-editor-disabled:hover{background-color:#f1f2f4}.f-datagrid-filter-td:hover{background-color:transparent}"]}]}],t.ctorParameters=function(){return[{type:o.FormBuilder},{type:e.ElementRef},{type:e.NgZone},{type:e.ChangeDetectorRef},{type:w},{type:e.Renderer2},{type:e.Injector}]},t.propDecorators={fixedLeft:[{type:e.Input}],fixedRight:[{type:e.Input}],columns:[{type:e.Input}],gridInstance:[{type:e.Input}],delay:[{type:e.Input}],conditionChange:[{type:e.Output}],editors:[{type:e.ViewChildren,args:[P]}]},t}(),D=function(){function t(t,n,r){this.inject=t,this.cd=n,this.fb=r,this.datatype=i.ColumnFilterType.string,this.condition={operator1:0,value1:"",relation:"",operator2:0,value2:""},this.filterOptions={},this.conditionChange=new e.EventEmitter,this.panelHeightChange=new e.EventEmitter,this.emptyCondition=b({},this.condition),this.formValueChangesSubscription=null,this.originalCondition={},this.form=this.fb.group({operator1:new o.FormControl(0),value1:new o.FormControl(""),relation:new o.FormControl(""),operator2:new o.FormControl(0),value2:new o.FormControl("")}),this.emptyConditonString=JSON.stringify(this.emptyCondition)}return t.prototype.ngOnInit=function(){this.originalCondition=Object.assign({},this.condition),this.form.patchValue(this.condition)},t.prototype.ngOnDestroy=function(){this.formValueChangesSubscription&&(this.formValueChangesSubscription.unsubscribe(),this.formValueChangesSubscription=null)},t.prototype.ngOnChanges=function(t){},t.prototype.emitConditionChange=function(t){this.condition=t;var e=this.checkFilterOperator();this.conditionChange.emit(e)},t.prototype.ngAfterViewInit=function(){var t=this;this.form.valueChanges.subscribe(function(e){if(t.condition=Object.assign(t.emptyCondition,t.condition),e.operator1>1e3)t.emitConditionChange(e);else{var n=JSON.stringify(e);t.emptyConditonString===n?t.emitConditionChange(e):JSON.stringify(t.condition)!==n?(t.emitConditionChange(e),""==e.value2&&t.emitPanelHeightChanged()):t.condition.operator1==e.operator1&&t.condition.relation==e.relation&&t.condition.operator2==e.operator2||t.emitConditionChange(e)}})},t.prototype.checkFilterOperator=function(){var t=b({},this.condition),e=parseInt(""+t.operator1,10),n={operator1:t.operator1,value1:t.value1};if(e!==C.Empty&&e!==C.NotEmpty||(t.value1="",n.value1=""),(""===t.value1||null===t.value1)&&e!==C.Empty&&e!==C.NotEmpty)return"";if(!t.relation)return n;var i=parseInt(""+t.operator2,10);return i===C.Empty||i===C.NotEmpty?(t.value2="",t):null==t.value2||t.value2==undefined||""===t.value2?n:t},t.prototype.chooseRelation=function(t,e){e.stopPropagation();var n=!this.form.get("relation").value;this.form.get("relation").setValue(t),this.condition.relation=t,this.condition.operator2===undefined&&(this.condition.operator2=0),n&&this.emitPanelHeightChanged(),this.cd.detectChanges()},t.prototype.resetFilters=function(t){this.emptyConditonString!==JSON.stringify(this.condition)&&(this.condition=JSON.parse(this.emptyConditonString),this.form.reset(this.condition),this.emitPanelHeightChanged())},t.prototype.emitPanelHeightChanged=function(){var t=this;this.panelHeightChangedTimer&&clearTimeout(this.panelHeightChangedTimer),this.panelHeightChangedTimer=setTimeout(function(){t.panelHeightChange.emit()},20)},t.decorators=[{type:e.Component,args:[{selector:"condition-editor",template:'<form [formGroup]="form">\r\n<ul class="list-group filter-condition">\r\n    <li class="list-group-item border-0">\r\n        <select class="form-control form-control-sm" formControlName="operator1" single-select [panelRef]="selectpanel">\r\n            \x3c!-- <option *ngFor="let o of operators" [selected]="o.isDefault" [value]="o.code">{{ o.label }}</option> --\x3e\r\n        </select>\r\n        <div #selectpanel class="single-select-panel f-area-hide">\r\n            <ul class="dropdown-menu show">\r\n                <li class="dropdown-item" *ngFor="let col of operators" [attr.value]="col.code" [class.active]="condition.operator1 === col.code">{{ col.label }}</li>\r\n            </ul>\r\n        </div>\r\n    </li>\r\n    <li class="list-group-item border-0" [ngSwitch]="datatype" *ngIf="condition.operator1 < 1000">\r\n        \x3c!-- <farris-time-picker #timepicker formControlName="value1" [readonly]= "false" [editable]= "true"\r\n        [hourStep] = "1" [minuteStep] = "1"  *ngSwitchCase="\'4\'" [format]="filterOptions?.format" [secondStep] = "1"></farris-time-picker> --\x3e\r\n\r\n        <farris-datepicker formControlName="value1" [dateFormat]="filterOptions?.dateFormat" [returnFormat]="filterOptions?.returnFormat" [useDefault]="false" [showTime]="false" *ngSwitchCase="\'3\'" ></farris-datepicker>\r\n        <farris-datepicker formControlName="value1" [dateFormat]="filterOptions?.dateFormat" [returnFormat]="filterOptions?.returnFormat" [useDefault]="false" [showTime]="true" *ngSwitchCase="\'5\'" ></farris-datepicker>\r\n        \x3c!-- <farris-number-spinner  name="value1" [(ngModel)]="condition.value1" *ngSwitchCase="\'1\'"></farris-number-spinner> --\x3e\r\n        <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill"  *ngSwitchCase="\'1\'">\r\n            <input formControlName="value1" class="form-control no-number-button" type="number" >\r\n        </div>\r\n        <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill"  *ngSwitchCase="\'4\'">\r\n            <input formControlName="value1" class="form-control" type="time" >\r\n        </div>\r\n\r\n        <input class="form-control form-control-sm" formControlName="value1" *ngSwitchDefault type="text" >\r\n    </li>\r\n\r\n    <ng-container *ngIf="condition.value1 !== \'\' && condition.value1 !== null && condition.value1 !== undefined">\r\n        \r\n        <li class="list-group-item border-0">\r\n            <div class="custom-control custom-radio custom-control-inline" style="margin-right: 0;">\r\n                <input type="radio" id="customRadioInline1" formControlName="relation" value="and" class="custom-control-input">\r\n                <label class="custom-control-label" for="customRadioInline1" (click)="chooseRelation(\'and\', $event)">{{ \'datagrid.filter.and\' | locale }}</label>\r\n            </div>\r\n            <div class="custom-control custom-radio custom-control-inline">\r\n                <input type="radio" id="customRadioInline2" formControlName="relation" value="or" class="custom-control-input">\r\n                <label class="custom-control-label" for="customRadioInline2"  (click)="chooseRelation(\'or\', $event)">{{ \'datagrid.filter.or\' | locale }}</label>\r\n            </div>\r\n        </li>\r\n        <ng-container *ngIf="condition.relation">\r\n            \r\n            <li class="list-group-item border-0">\r\n                \x3c!-- <select class="form-control form-control-sm" formControlName="operator2" >\r\n                    <option *ngFor="let o of operators" [selected]="o.isDefault" [value]="o.code">{{ o.label }}</option>\r\n                </select> --\x3e\r\n\r\n                <select class="form-control form-control-sm" formControlName="operator2" single-select [panelRef]="selectpanel2">\r\n                </select>\r\n                <div #selectpanel2 class="single-select-panel f-area-hide">\r\n                    <ul class="dropdown-menu show">\r\n                        <li class="dropdown-item" *ngFor="let col of operators" [attr.value]="col.code" [class.active]="condition.operator2 === col.code">{{ col.label }}</li>\r\n                    </ul>\r\n                </div>\r\n\r\n\r\n\r\n            </li>\r\n            <li class="list-group-item border-0" [ngSwitch]="datatype" *ngIf="condition.operator2 < 1000">\r\n                \x3c!-- <farris-time-picker #timepicker formControlName="value2" [readonly]= "false" [editable]= "false"\r\n                [hourStep] = "1" [minuteStep] = "1"  *ngSwitchCase="\'4\'" [format]="filterOptions?.format"[secondStep] = "1"></farris-time-picker> --\x3e\r\n                <farris-datepicker formControlName="value2" [dateFormat]="filterOptions?.dateFormat" [useDefault]="false" [showTime]="false" *ngSwitchCase="\'3\'" ></farris-datepicker>\r\n                <farris-datepicker formControlName="value2" [dateFormat]="filterOptions?.dateFormat" [useDefault]="false" [showTime]="true"  *ngSwitchCase="\'5\'" ></farris-datepicker>\r\n                \x3c!-- <farris-number-spinner  name="value2" [(ngModel)]="condition.value2" *ngSwitchCase="\'1\'"></farris-number-spinner> --\x3e\r\n                <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill"  *ngSwitchCase="\'1\'">\r\n                    <input formControlName="value2" class="form-control no-number-button" type="number" >\r\n                </div>\r\n                <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill"  *ngSwitchCase="\'4\'">\r\n                    <input formControlName="value2" class="form-control" type="time" >\r\n                </div>\r\n                <input class="form-control form-control-sm" formControlName="value2" *ngSwitchDefault type="text" >\r\n            </li>\r\n        </ng-container>\r\n    </ng-container>\r\n    \r\n    <li class="list-group-item border-0">\r\n        <div class="d-flex">\r\n            \x3c!-- <div class="p-2 "><button type="button" class="btn btn-light">高级</button></div> --\x3e\r\n            <div class="ml-auto">\r\n                <button type="button" style="position: unset;" (click)="resetFilters($event)" class="btn btn-primary">{{ \'datagrid.filter.clear\' | locale }}</button>\r\n            </div>\r\n        </div>\r\n   </li>\r\n</ul>\r\n</form>',styles:["\n        .no-number-button{-moz-appearance: textfield;}\n        .no-number-button::-webkit-outer-spin-button, .no-number-button::-webkit-inner-spin-button {\n              -webkit-appearance: none!important;\n        }"]}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ChangeDetectorRef},{type:o.FormBuilder}]},t.propDecorators={operators:[{type:e.Input}],datatype:[{type:e.Input}],condition:[{type:e.Input}],filterOptions:[{type:e.Input}],conditionChange:[{type:e.Output}],panelHeightChange:[{type:e.Output}]},t}(),V=function(){function t(t,n,i){this.inject=t,this.cd=n,this.dfrs=i,this.data=[],this.showFilter=!1,this.filterKeyWord="",this.valueChange=new e.EventEmitter,this.checked=!1,this.originalData=[]}return t.prototype.ngOnInit=function(){this.originalData=m.cloneDeep(this.data)},t.prototype.ngAfterViewInit=function(){var t=this;this.selectedValues===undefined&&setTimeout(function(){t.checkAll(!0,!1),t.checked=!0,t.cd.detectChanges()}),this.updateCheckboxState()},t.prototype.checkAll=function(t,e){var n=this;void 0===t&&(t=!0),void 0===e&&(e=!0),t?(this.dataListInstance.selectAll(),this.selectedValues=this.originalData.map(function(t){return t[n.valueField]}).join(",")):(this.dataListInstance.unSelectAll(),this.selectedValues=""),e&&this.buildCondition()},t.prototype.checkAllHandler=function(t){this.checked=t,this.chkall.nativeElement.indeterminate=!1,this.checkAll(this.checked),this.cd.detectChanges()},t.prototype.onSelect=function(t){this.updateSelectedValues(t),this.updateCheckboxState(),this.buildCondition()},t.prototype.updateCheckboxState=function(){this.selectedValues!==undefined&&(this.selectedValues.split(",").length===this.originalData.length?(this.checked=!0,this.chkall.nativeElement.indeterminate=!1):(this.checked=!1,this.chkall.nativeElement.indeterminate=!0))},t.prototype.onUnSelected=function(t){this.updateSelectedValues(t,!1),this.checked=!1,this.chkall.nativeElement.indeterminate=!!this.selectedValues,this.buildCondition()},t.prototype.buildCondition=function(){var t=this.selectedValues.split(",");if(this.selectedValues){if(t.length===this.originalData.length)return void this.valueChange.emit(x.All);var e={operator1:C.In,value1:t};this.valueChange.emit(e)}else this.valueChange.emit(x.All)},t.prototype.updateSelectedValues=function(t,e){if(void 0===e&&(e=!0),t){var n=t.data[this.valueField],i=this.selectedValues?this.selectedValues.split(","):[];e?-1===i.findIndex(function(t){return t==n})&&i.push(n):i=i.filter(function(t){return t!=n}),this.selectedValues=i.join(","),this.cd.detectChanges()}},t.prototype.onTextChange=function(t){var e=t.target[this.valueField];this.filterKeyWord=e,this.changeDataSource()},t.prototype.changeDataSource=function(){var t=this;this.filterKeyWord?this.data=this.originalData.filter(function(e){return e[t.textField].indexOf(t.filterKeyWord)>-1}):this.data=m.cloneDeep(this.originalData)},t.prototype.restFilter=function(){this.filterKeyWord="",this.changeDataSource(),this.checkAll(),this.checked=!0,this.chkall.nativeElement.indeterminate=!1,this.cd.detectChanges()},t.decorators=[{type:e.Component,args:[{selector:"filter-datalist",template:'\n    <ul class="list-group filter-condition">\n        <li class="list-group-item border-0 border-b1" *ngIf="showFilter">\n            <input class="form-control form-control-sm" [ngModel]="filterKeyWord"\n                (input)="onTextChange($event)" type="text" >\n        </li>\n        <li class="list-group-item datalist border-0 border-b1">\n            <farris-datalist\n                #dl\n                [data]="data"\n                [idField]="idField"\n                [height]="\'auto\'"\n                [fit]="false"\n                [multiSelect]="true"\n                [selectedValues]="selectedValues"\n                [valueField]="valueField"\n                [textField]="textField"\n                (selected)="onSelect($event)"\n                (unSelected)="onUnSelected($event)">\n            </farris-datalist>\n        </li>\n        <li class="list-group-item border-0" style="border-bottom: 1px solid #dde2eb;">\n            <div class="d-flex">\n                <div class="custom-control custom-checkbox" style="padding-left: 3px;">\n                    <input id="filter-datalist-checkall" #chkall type="checkbox" class="custom-control-input" [ngModel]="checked" (ngModelChange)="checkAllHandler($event)">\n                    <label class="custom-control-label" for="filter-datalist-checkall" >{{ \'datagrid.filter.checkAll\' | locale }}</label>\n                </div>\n                <div class="ml-auto"><button type="button" class="btn btn-outline-primary" (click)="restFilter()">\n                {{ \'datagrid.filter.reset\' | locale }}</button></div>\n            </div>\n        </li>\n    </ul>\n    ',encapsulation:e.ViewEncapsulation.None}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ChangeDetectorRef},{type:w}]},t.propDecorators={valueField:[{type:e.Input}],textField:[{type:e.Input}],idField:[{type:e.Input}],selectedValues:[{type:e.Input}],data:[{type:e.Input}],showFilter:[{type:e.Input}],filterKeyWord:[{type:e.Input}],chkall:[{type:e.ViewChild,args:["chkall"]}],dataListInstance:[{type:e.ViewChild,args:["dl"]}],valueChange:[{type:e.Output}]},t}(),q=function(){function t(){}return t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Component,args:[{selector:"filter-select",template:'\n    <select class="form-control form-control-sm">\n        <option>Small select</option>\n    </select>\n    '}]}],t.ctorParameters=function(){return[]},t}(),j={provide:i.GRID_FILTER_ROW,useValue:N},T=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:i.GRID_FILTER_ROW,useValue:N}]}},t.decorators=[{type:e.NgModule,args:[{declarations:[N,P,O,R,I,V,S,q,D],imports:[c.CommonModule,o.FormsModule,o.ReactiveFormsModule,i.DatagridModule,u.FarrisDatePickerModule,p.NumberSpinnerModule,f.DatalistModule,d.TimePickerModule,r.LocaleModule.forRoot(),h.FarrisFormsModule,s.FarrisCommonModule],entryComponents:[N,O,R,D,V,I,S,q],exports:[N]}]}],t}();t.AllFilterOperator=F,t.ConditionEditorComponent=D,t.DatagridFilterRowModule=T,t.DatagridFilterRowService=w,t.FilterCellEditorDirective=P,t.FilterCheckboxComponent=R,t.FilterConditionValue=x,t.FilterDatalistComponent=V,t.FilterOperator=C,t.FilterRowComponent=N,t.FilterRowEditorComponent=S,t.FilterRowPanelComponent=I,t.FilterRowProvider=j,t.FilterSelectComponent=q,t.FilterTextboxComponent=O,t.NumberOrDateFilterOperators=k,t.TextFilterOperators=E,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-datagrid-filter.umd.min.js.map
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, NgZone, ElementRef, Renderer2, Output, EventEmitter, Injector } from '@angular/core';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
import { CommonUtils, OverLayHiddenService } from '@farris/ui-common';
export class FilterRowPanelComponent {
    /**
     * @param {?} ngzone
     * @param {?} el
     * @param {?} render
     * @param {?} dfrs
     * @param {?} inject
     */
    constructor(ngzone, el, render, dfrs, inject) {
        this.ngzone = ngzone;
        this.el = el;
        this.render = render;
        this.dfrs = dfrs;
        this.inject = inject;
        this.width = 240;
        this.height = 250;
        this.datatype = ColumnFilterType.string;
        this.conditionChange = new EventEmitter();
        this.panelHeightChange = new EventEmitter();
        this.gridInstance = null;
        this.enumSetting = {};
        this.condition = {
            operator1: 1,
            value1: '',
            relation: '',
            operator2: 1,
            value2: ''
        };
        this.documentClickHandle = null;
        this.ro = null;
        this.zone = null;
        this.zone = this.inject.get(NgZone);
        this.commonUtils = this.inject.get(CommonUtils, new CommonUtils());
        this.overlaySer = this.inject.get(OverLayHiddenService, new OverLayHiddenService());
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.render.listen(this.el.nativeElement, 'click', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                e.stopPropagation();
                return false;
            }));
        }));
        this.initEnumSetting();
        // this.documentClickHandle = this.render.listen(document, 'click', (event) => {
        //     this.close(event);
        // });
        this.overlaySer.registerMouseEvent(this.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            /** @type {?} */
            const tar = (/** @type {?} */ (e.target));
            if (tar && tar.closest('.overlay-container')) {
                return;
            }
            if (document.body.className.indexOf('modal-open') > -1) {
                return;
            }
            if (this.el.nativeElement.contains(e.target)) {
                return;
            }
            this.close(e);
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.target) {
            this.resetPanelPosition();
            /** @type {?} */
            const panelDiv = this.el.nativeElement.querySelector('div');
            panelDiv.style.transition = 'top 0.2s ease 0.05s';
            /** @type {?} */
            const zindex = this.commonUtils.getFloatingLayerIndex();
            panelDiv.style.zIndex = zindex;
            /** @type {?} */
            const overlayEl = this.el.nativeElement.querySelector('.filter-panel-overlay');
            if (overlayEl) {
                overlayEl.style.zIndex = zindex;
                panelDiv.style.zIndex = zindex + 1;
            }
            // this.el.nativeElement.style.position = 'fixed';
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.overlaySer) {
            this.overlaySer.destory(this.el.nativeElement);
        }
    }
    /**
     * @private
     * @return {?}
     */
    resetPanelPosition() {
        /** @type {?} */
        const panelDiv = this.el.nativeElement.querySelector('div');
        /** @type {?} */
        const h = panelDiv.querySelector('.panel-content').clientHeight + 36;
        /** @type {?} */
        const rect = this.target.target.parentElement.getBoundingClientRect();
        /** @type {?} */
        const downAreaHeight = window['innerHeight'] - rect.top;
        if (downAreaHeight < h) {
            /** @type {?} */
            const top = window['innerHeight'] - h - 10;
            panelDiv.style.top = top + 'px';
        }
        else {
            panelDiv.style.top = rect.top + 'px';
        }
    }
    /**
     * @return {?}
     */
    onPanelHeightChanged() {
        this.resetPanelPosition();
        this.panelHeightChange.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    close(event) {
        event.stopPropagation();
        this.dfrs.closeFilterPanel();
    }
    /**
     * @param {?} condition
     * @return {?}
     */
    onValueChange(condition) {
        this.conditionChange.emit(condition);
    }
    /**
     * @private
     * @return {?}
     */
    initEnumSetting() {
        if (this.datatype > 5) {
            this.enumSetting = this.dfrs.getEnumOptions(this.column);
            /** @type {?} */
            const currentColumnCondition = (/** @type {?} */ (this.dfrs.columnConditions[this.column.field]));
            if (currentColumnCondition && currentColumnCondition.value1) {
                this.selectedValues = currentColumnCondition.value1.join(',');
            }
        }
    }
}
FilterRowPanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-row-panel',
                template: "<div class=\"f-datagrid-filter-panel d-flex flex-column\" style=\"position: fixed;\" [style.width.px]=\"width\"  (click)=\"$event.stopPropagation()\">\r\n    <div class=\"panel-header\">\r\n        <div (click)=\"close($event)\" class=\"panel-icon\" style=\"text-align: center; cursor: pointer;\">\r\n            <span class=\"f-icon f-icon-filter-sm\"></span>\r\n        </div> \r\n    </div>\r\n    <div class=\"panel-content flex-fill\">\r\n        <condition-editor *ngIf=\"datatype < 6\"\r\n            [datatype]=\"datatype\"\r\n            [condition]=\"condition\"\r\n            [operators]=\"operators\"\r\n            [filterOptions]=\"column.filter.options\"\r\n            (conditionChange)=\"onValueChange($event)\"\r\n            (panelHeightChange)=\"onPanelHeightChanged()\"></condition-editor>\r\n            \r\n\r\n        <filter-datalist *ngIf=\"datatype === 6 || datatype === 7\" \r\n            [data]=\"enumSetting?.data\" [valueField]=\"enumSetting?.valueField\"\r\n            [textField]=\"enumSetting?.textField\" [idField]=\"enumSetting?.valueField\"\r\n            [selectedValues]=\"selectedValues\"\r\n            (valueChange)=\"onValueChange($event)\"></filter-datalist>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"filter-panel-overlay\" style=\"position: absolute;\r\nposition: absolute;\r\nwidth: 100%;\r\ntop: 0;\r\nheight: 100%;\r\nbackground: rgb(255, 255, 255);\r\nopacity: 0;\" (click)=\"close($event)\"></div>\r\n"
            }] }
];
/** @nocollapse */
FilterRowPanelComponent.ctorParameters = () => [
    { type: NgZone },
    { type: ElementRef },
    { type: Renderer2 },
    { type: DatagridFilterRowService },
    { type: Injector }
];
FilterRowPanelComponent.propDecorators = {
    width: [{ type: Input }],
    height: [{ type: Input }],
    column: [{ type: Input }],
    operators: [{ type: Input }],
    datatype: [{ type: Input }],
    conditionChange: [{ type: Output }],
    panelHeightChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    FilterRowPanelComponent.prototype.width;
    /** @type {?} */
    FilterRowPanelComponent.prototype.height;
    /** @type {?} */
    FilterRowPanelComponent.prototype.column;
    /** @type {?} */
    FilterRowPanelComponent.prototype.operators;
    /** @type {?} */
    FilterRowPanelComponent.prototype.datatype;
    /** @type {?} */
    FilterRowPanelComponent.prototype.conditionChange;
    /** @type {?} */
    FilterRowPanelComponent.prototype.panelHeightChange;
    /** @type {?} */
    FilterRowPanelComponent.prototype.gridInstance;
    /** @type {?} */
    FilterRowPanelComponent.prototype.enumSetting;
    /** @type {?} */
    FilterRowPanelComponent.prototype.selectedValues;
    /** @type {?} */
    FilterRowPanelComponent.prototype.condition;
    /** @type {?} */
    FilterRowPanelComponent.prototype.documentClickHandle;
    /** @type {?} */
    FilterRowPanelComponent.prototype.target;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.overlaySer;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.render;
    /** @type {?} */
    FilterRowPanelComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterRowPanelComponent.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy1wYW5lbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLWZpbHRlci8iLCJzb3VyY2VzIjpbImxpYi9maWx0ZXItZWRpdG9ycy9maWx0ZXItcm93LXBhbmVsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFVLFVBQVUsRUFDekMsU0FBUyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQWMsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUUxRSxPQUFPLEVBQUUsV0FBVyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFNdEUsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7Ozs7SUFpQ2hDLFlBQ1ksTUFBYyxFQUFVLEVBQWMsRUFDdEMsTUFBaUIsRUFBUyxJQUE4QixFQUN4RCxNQUFnQjtRQUZoQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUN0QyxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBMEI7UUFDeEQsV0FBTSxHQUFOLE1BQU0sQ0FBVTtRQW5DbkIsVUFBSyxHQUFHLEdBQUcsQ0FBQztRQUNaLFdBQU0sR0FBRyxHQUFHLENBQUM7UUFLYixhQUFRLEdBQUcsZ0JBQWdCLENBQUMsTUFBTSxDQUFDO1FBRWxDLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVyQyxzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRWpELGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLGdCQUFXLEdBQXNCLEVBQUUsQ0FBQztRQUdwQyxjQUFTLEdB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LHlDQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE5nWm9uZSwgT25Jbml0LCBFbGVtZW50UmVmLFxyXG4gICAgICAgICAgICBSZW5kZXJlcjIsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdyZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwnO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uLCBDb2x1bW5GaWx0ZXJUeXBlIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcblxyXG5pbXBvcnQgeyBEYXRhZ3JpZEZpbHRlclJvd1NlcnZpY2UgfSBmcm9tICcuLi9kYXRhZ3JpZC1maWx0ZXItcm93LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGaWx0ZXJFbnVtU2V0dGluZywgRmlsdGVyQ29uZGl0aW9uLCBGaWx0ZXJSb3dPcGVyYXRvciB9IGZyb20gJy4uL29wZXJhdGlvbnMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMsIE92ZXJMYXlIaWRkZW5TZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24nO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZpbHRlci1yb3ctcGFuZWwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZpbHRlci1yb3ctcGFuZWwuY29tcG9lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbHRlclJvd1BhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCkgd2lkdGggPSAyNDA7XHJcbiAgICBASW5wdXQoKSBoZWlnaHQgPSAyNTA7XHJcblxyXG4gICAgQElucHV0KCkgY29sdW1uOiBEYXRhQ29sdW1uO1xyXG4gICAgQElucHV0KCkgb3BlcmF0b3JzOiBGaWx0ZXJSb3dPcGVyYXRvcltdO1xyXG5cclxuICAgIEBJbnB1dCgpIGRhdGF0eXBlID0gQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmc7XHJcblxyXG4gICAgQE91dHB1dCgpIGNvbmRpdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBAT3V0cHV0KCkgcGFuZWxIZWlnaHRDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgZ3JpZEluc3RhbmNlID0gbnVsbDtcclxuICAgIGVudW1TZXR0aW5nOiBGaWx0ZXJFbnVtU2V0dGluZyA9IHt9O1xyXG4gICAgc2VsZWN0ZWRWYWx1ZXM6IHN0cmluZztcclxuXHJcbiAgICBjb25kaXRpb246IEZpbHRlckNvbmRpdGlvbiA9IHtcclxuICAgICAgICBvcGVyYXRvcjE6IDEsXHJcbiAgICAgICAgdmFsdWUxOiAnJyxcclxuICAgICAgICByZWxhdGlvbjogJycsXHJcbiAgICAgICAgb3BlcmF0b3IyOiAxLFxyXG4gICAgICAgIHZhbHVlMjogJydcclxuICAgIH07XHJcblxyXG4gICAgZG9jdW1lbnRDbGlja0hhbmRsZSA9IG51bGw7XHJcblxyXG4gICAgdGFyZ2V0OiBhbnk7XHJcblxyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcclxuICAgIHByaXZhdGUgem9uZTogTmdab25lID0gbnVsbDtcclxuICAgIHByaXZhdGUgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzO1xyXG4gICAgcHJpdmF0ZSBvdmVybGF5U2VyOiBPdmVyTGF5SGlkZGVuU2VydmljZTtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgbmd6b25lOiBOZ1pvbmUsIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHVibGljIGRmcnM6IERhdGFncmlkRmlsdGVyUm93U2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGluamVjdDogSW5qZWN0b3IpIHtcclxuICAgICAgICB0aGlzLnpvbmUgPSB0aGlzLmluamVjdC5nZXQoTmdab25lKTtcclxuICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3QuZ2V0KENvbW1vblV0aWxzLCBuZXcgQ29tbW9uVXRpbHMoKSk7XHJcbiAgICAgICAgdGhpcy5vdmVybGF5U2VyID0gIHRoaXMuaW5qZWN0LmdldChPdmVyTGF5SGlkZGVuU2VydmljZSwgbmV3IE92ZXJMYXlIaWRkZW5TZXJ2aWNlKCkpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLm5nem9uZS5ydW5PdXRzaWRlQW5ndWxhciggKCkgPT4gIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIubGlzdGVuKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2NsaWNrJywgIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0RW51bVNldHRpbmcoKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy5kb2N1bWVudENsaWNrSGFuZGxlID0gdGhpcy5yZW5kZXIubGlzdGVuKGRvY3VtZW50LCAnY2xpY2snLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAvLyAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgIHRoaXMub3ZlcmxheVNlci5yZWdpc3Rlck1vdXNlRXZlbnQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0YXIgPSBlLnRhcmdldCBhcyBhbnk7XHJcbiAgICAgICAgICAgIGlmKHRhciAmJiB0YXIuY2xvc2VzdCgnLm92ZXJsYXktY29udGFpbmVyJykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lLmluZGV4T2YoJ21vZGFsLW9wZW4nKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jbG9zZShlKVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy50YXJnZXQpIHtcclxuICAgICAgICAgICAgdGhpcy5yZXNldFBhbmVsUG9zaXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBhbmVsRGl2ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xyXG4gICAgICAgICAgICBwYW5lbERpdi5zdHlsZS50cmFuc2l0aW9uID0gICd0b3AgMC4ycyBlYXNlIDAuMDVzJztcclxuXHJcblxyXG4gICAgICAgICAgICBjb25zdCB6aW5kZXggPSB0aGlzLmNvbW1vblV0aWxzLmdldEZsb2F0aW5nTGF5ZXJJbmRleCgpO1xyXG4gICAgICAgICAgICBwYW5lbERpdi5zdHlsZS56SW5kZXggPSB6aW5kZXg7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBvdmVybGF5RWwgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmZpbHRlci1wYW5lbC1vdmVybGF5Jyk7XHJcbiAgICAgICAgICAgIGlmIChvdmVybGF5RWwpIHtcclxuICAgICAgICAgICAgICAgIG92ZXJsYXlFbC5zdHlsZS56SW5kZXggPSB6aW5kZXg7XHJcbiAgICAgICAgICAgICAgICBwYW5lbERpdi5zdHlsZS56SW5kZXggPSB6aW5kZXggKyAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5vdmVybGF5U2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3ZlcmxheVNlci5kZXN0b3J5KHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVzZXRQYW5lbFBvc2l0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHBhbmVsRGl2ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xyXG4gICAgICAgIGNvbnN0IGggPSBwYW5lbERpdi5xdWVyeVNlbGVjdG9yKCcucGFuZWwtY29udGVudCcpLmNsaWVudEhlaWdodCArIDM2O1xyXG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLnRhcmdldC50YXJnZXQucGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgICAgY29uc3QgZG93bkFyZWFIZWlnaHQgPSB3aW5kb3dbJ2lubmVySGVpZ2h0J10gLSByZWN0LnRvcDtcclxuXHJcbiAgICAgICAgaWYgKGRvd25BcmVhSGVpZ2h0IDwgaCkge1xyXG4gICAgICAgICAgICBjb25zdCB0b3AgPSB3aW5kb3dbJ2lubmVySGVpZ2h0J10gLSBoIC0gMTA7XHJcbiAgICAgICAgICAgIHBhbmVsRGl2LnN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGFuZWxEaXYuc3R5bGUudG9wID0gcmVjdC50b3AgKyAncHgnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvblBhbmVsSGVpZ2h0Q2hhbmdlZCgpIHtcclxuICAgICAgICB0aGlzLnJlc2V0UGFuZWxQb3NpdGlvbigpO1xyXG4gICAgICAgIHRoaXMucGFuZWxIZWlnaHRDaGFuZ2UuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjbG9zZShldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuZGZycy5jbG9zZUZpbHRlclBhbmVsKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG9uVmFsdWVDaGFuZ2UoY29uZGl0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25DaGFuZ2UuZW1pdChjb25kaXRpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdEVudW1TZXR0aW5nKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGF0eXBlID4gNSkge1xyXG4gICAgICAgICAgICB0aGlzLmVudW1TZXR0aW5nID0gdGhpcy5kZnJzLmdldEVudW1PcHRpb25zKHRoaXMuY29sdW1uKTtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudENvbHVtbkNvbmRpdGlvbiA9IHRoaXMuZGZycy5jb2x1bW5Db25kaXRpb25zW3RoaXMuY29sdW1uLmZpZWxkXSBhcyBGaWx0ZXJDb25kaXRpb247XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q29sdW1uQ29uZGl0aW9uICYmIGN1cnJlbnRDb2x1bW5Db25kaXRpb24udmFsdWUxKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gY3VycmVudENvbHVtbkNvbmRpdGlvbi52YWx1ZTEuam9pbignLCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
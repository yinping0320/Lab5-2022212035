/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { LocaleService } from '@farris/ui-locale';
import { Component, Input, ComponentFactoryResolver, Injector, ApplicationRef, Renderer2, ViewChild, ElementRef, ChangeDetectorRef, NgZone } from '@angular/core';
import { delay, filter } from 'rxjs/operators';
import ResizeObserver from 'resize-observer-polyfill';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { FilterOperator, TextFilterOperators, NumberOrDateFilterOperators, FilterConditionValue, } from './../operations/operators';
import { FilterRowPanelComponent } from './filter-row-panel.component';
import { DatagridFilterRowService } from '../datagrid-filter-row.service';
import { FilterRowEditorComponent } from './filter-row-editor.component';
export class FilterTextboxComponent extends FilterRowEditorComponent {
    /**
     * @param {?} cfr
     * @param {?} injector
     * @param {?} app
     * @param {?} dfrs
     * @param {?} render
     * @param {?} cd
     * @param {?} localSer
     */
    constructor(cfr, injector, app, dfrs, render, cd, localSer) {
        super();
        this.cfr = cfr;
        this.injector = injector;
        this.app = app;
        this.dfrs = dfrs;
        this.render = render;
        this.cd = cd;
        this.localSer = localSer;
        this.disabled = false;
        this.delay = 300;
        this.filterStr = '';
        this.filterPanelSubscription = null;
        this.ro = null;
        this.zone = null;
        this.el = null;
        this.zone = this.injector.get(NgZone);
        this.el = this.injector.get(ElementRef);
        this.dfrs.filterTextboxChanged.pipe(filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v[this.column.field] !== undefined)), delay(this.delay)).subscribe((/**
         * @param {?} obj
         * @return {?}
         */
        (obj) => {
            /** @type {?} */
            const val = obj[this.column.field];
            if (val !== '') {
                /** @type {?} */
                const _condition = { operator1: FilterOperator.Contains, value1: val };
                if (this.column.filter.type === ColumnFilterType.number) {
                    _condition.operator1 = FilterOperator.Equal;
                }
                this.dfrs.updateColumnConditions(this.column.field, _condition);
            }
            else {
                this.dfrs.updateColumnConditions(this.column.field, FilterConditionValue.All);
            }
        }));
        this.dfrs.removeField.subscribe((/**
         * @param {?} f
         * @return {?}
         */
        f => {
            if (f === this.column.field) {
                this.clearValue();
            }
        }));
    }
    /**
     * @return {?}
     */
    get inputType() {
        if (this.column.filter.type === ColumnFilterType.number) {
            return 'number';
        }
        return 'text';
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.ro) {
            this.ro.disconnect();
            this.ro = null;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    show(event) {
        this.close();
        event.stopPropagation();
        /** @type {?} */
        const dgContainerEle = ((/** @type {?} */ (event.target))).closest('.f-datagrid');
        if (dgContainerEle) {
            dgContainerEle.addEventListener('click', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.close();
            }));
        }
        if (!this.dfrs.gridInstance) {
            this.dfrs.gridInstance = this.gridInstance;
        }
        /** @type {?} */
        const cf = this.cfr.resolveComponentFactory(FilterRowPanelComponent);
        this.filterPanelRef = cf.create(this.injector);
        this.app.attachView(this.filterPanelRef.hostView);
        this.filterPanelRef.instance.column = this.column;
        this.filterPanelRef.instance.gridInstance = this.gridInstance;
        this.initOperators(this.filterPanelRef.instance);
        if (this.column.filter !== false && this.column.filter !== undefined) {
            this.filterPanelRef.instance.datatype = this.column.filter.type;
            if (this.column.filter.type === ColumnFilterType.enum ||
                this.column.filter.type === ColumnFilterType.fromdata) {
                this.filterPanelRef.instance.height = 300;
            }
        }
        /** @type {?} */
        const currentColumnCondition = this.dfrs.columnConditions[this.column.field];
        if (currentColumnCondition) {
            this.filterPanelRef.instance.condition = (/** @type {?} */ (currentColumnCondition));
        }
        else {
            this.filterPanelRef.instance.condition = {
                operator1: 0,
                value1: '',
                relation: '',
                operator2: 0,
                value2: ''
            };
            // this.initOperators(this.filterPanelRef.instance);
        }
        this.filterPanelSubscription = this.filterPanelRef.instance.conditionChange.subscribe((/**
         * @param {?} condition
         * @return {?}
         */
        (condition) => {
            if (condition) {
                this.dfrs.updateColumnConditions(this.column.field, condition);
                this.filterStr = this.dfrs.condition2string(this.column, condition);
                if (this.column.filter.type < 2) {
                    this.disabled = !!this.filterStr;
                }
                this.cd.detectChanges();
            }
            else {
                this.clearValue();
                this.dfrs.updateColumnConditions(this.column.field, FilterConditionValue.All);
            }
        }));
        // document.body.style.overflow = 'hidden';
        document.body.appendChild(this.filterPanelRef.location.nativeElement);
        this.updateFilterPanelPosition(event.target);
        this.dfrs.setFilterPanel(this.filterPanelRef);
        let { width: dgwidth, height: dgHeight } = dgContainerEle.getBoundingClientRect();
        this['DG_CONTAINER_SIZE'] = { width: dgwidth, height: dgHeight };
        this.filterPanelRef.instance.panelHeightChange.subscribe((/**
         * @return {?}
         */
        () => {
            let { width, height } = dgContainerEle.getBoundingClientRect();
            this['DG_CONTAINER_SIZE'] = { width, height };
        }));
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            if (!this.ro) {
                this.ro = new ResizeObserver((/**
                 * @param {?} entries
                 * @param {?} observer
                 * @return {?}
                 */
                (entries, observer) => {
                    if (this['resize_timer_001']) {
                        clearTimeout(this['resize_timer_001']);
                    }
                    this['resize_timer_001'] = setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        let { width, height } = entries[0].target.getBoundingClientRect();
                        const { width: dgWidth, height: dgHeight } = this['DG_CONTAINER_SIZE'];
                        if (this.gridInstance.autoHeight) {
                            if (dgWidth == width || dgWidth - width === 7 || dgWidth - width === -7) {
                                return;
                            }
                        }
                        if (width !== dgWidth || height !== dgHeight) {
                            this.close();
                        }
                    }), 30);
                }));
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.ro.observe(dgContainerEle);
                }));
            }
        }));
        this.filterPanelRef.instance.target = event;
        this.filterPanelRef.changeDetectorRef.markForCheck();
        this.filterPanelRef.changeDetectorRef.detectChanges();
    }
    /**
     * @return {?}
     */
    close() {
        this.dfrs.closeFilterPanel();
        if (this.filterPanelSubscription) {
            this.filterPanelSubscription.unsubscribe();
            this.filterPanelSubscription = null;
        }
    }
    /**
     * @private
     * @param {?} ins
     * @return {?}
     */
    initOperators(ins) {
        if (this.column.filter.type === ColumnFilterType.string) {
            ins.operators = TextFilterOperators;
            ins.condition.operator1 = FilterOperator.Contains;
            ins.condition.operator2 = FilterOperator.Contains;
        }
        else if (this.column.filter.type === ColumnFilterType.number || this.column.filter.type === ColumnFilterType.datetime
            || this.column.filter.type === ColumnFilterType.date || this.column.filter.type === ColumnFilterType.time) {
            ins.operators = NumberOrDateFilterOperators;
            ins.condition.operator1 = FilterOperator.Equal;
            ins.condition.operator2 = FilterOperator.Equal;
        }
        if (ins.operators) {
            ins.operators.forEach((/**
             * @param {?} o
             * @return {?}
             */
            o => {
                o.label = this.dfrs.getOperatorLabel(o.code);
            }));
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    updateFilterPanelPosition(target) {
        if (target) {
            /** @type {?} */
            const filterIconParent = target.parentElement;
            if (filterIconParent) {
                /** @type {?} */
                const pos = filterIconParent.getBoundingClientRect();
                /** @type {?} */
                const tr = target.closest('tr');
                /** @type {?} */
                const td = target.closest('td');
                /** @type {?} */
                const headerPos = target.closest('.f-datagrid-header').getBoundingClientRect();
                /** @type {?} */
                const panelWidth = this.filterPanelRef.instance.width;
                /** @type {?} */
                let left = pos.left;
                if (headerPos.width + headerPos.x < pos.x + panelWidth) { // this.column.filter.type === ColumnFilterType.enum
                    left = td.getBoundingClientRect().left + td.offsetWidth - panelWidth;
                    this.filterPanelRef.location.nativeElement.querySelector('.panel-icon').style.left = `${panelWidth - 40}px`;
                }
                // const top = pos.top
                /** @type {?} */
                const panel = this.filterPanelRef.location.nativeElement.querySelector('div');
                if (panel) {
                    this.render.setStyle(panel, 'top', `${pos.top}px`);
                    this.render.setStyle(panel, 'left', `${left}px`);
                }
            }
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onTextValueChange($event) {
        /** @type {?} */
        const value = $event.target.value;
        this.dfrs.filterTextboxChanged.emit({ [this.column.field]: value });
    }
    /**
     * @return {?}
     */
    clearValue() {
        this.filterStr = '';
        if (this.input) {
            this.input.nativeElement.value = '';
        }
        if (this.column.filter.type < 2) {
            this.disabled = false;
        }
        this.cd.detectChanges();
    }
    /**
     * @param {?} condition
     * @return {?}
     */
    initFilter(condition) {
        this.filterStr = this.dfrs.condition2string(this.column, condition);
        this.disabled = !!this.filterStr;
        this.dfrs._updateColumnConditions(this.column.field, condition);
        this.cd.detectChanges();
    }
}
FilterTextboxComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-textbox',
                template: `
    <div class="f-datagrid-header-cell-content f-datagrid-filter-cell d-flex" style="padding-right: 5px">
        <div class="f-datagrid-cell-formgroup farris-group-auto flex-fill">
            <input *ngIf="!disabled" class="form-control" [attr.type]="inputType" [value]="filterStr"
                (input)="onTextValueChange($event)" #input [class.no-number-button]="inputType == 'number'">
            <input *ngIf="disabled" class="form-control" type="text" [value]="filterStr"
            [attr.title]="filterStr" [disabled]="disabled" [class.filter-editor-disabled]="disabled" >
        </div>
        <div style="min-width: 26px; text-align: center; align-items: center;
            display: flex; justify-content: center;" *ngIf="column.filter.enableOperator">
            <span style="cursor: pointer;" class="f-icon f-icon-filter-sm" (click)="show($event)"></span>
        </div>
    </div>
    `,
                styles: [`
        .no-number-button{-moz-appearance: textfield;}
        .no-number-button::-webkit-outer-spin-button, .no-number-button::-webkit-inner-spin-button {
              -webkit-appearance: none!important;
        }`]
            }] }
];
/** @nocollapse */
FilterTextboxComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: ApplicationRef },
    { type: DatagridFilterRowService },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: LocaleService }
];
FilterTextboxComponent.propDecorators = {
    column: [{ type: Input }],
    disabled: [{ type: Input }],
    delay: [{ type: Input }],
    input: [{ type: ViewChild, args: ['input',] }]
};
if (false) {
    /** @type {?} */
    FilterTextboxComponent.prototype.column;
    /** @type {?} */
    FilterTextboxComponent.prototype.disabled;
    /** @type {?} */
    FilterTextboxComponent.prototype.delay;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterStr;
    /** @type {?} */
    FilterTextboxComponent.prototype.gridInstance;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelRef;
    /** @type {?} */
    FilterTextboxComponent.prototype.filterPanelSubscription;
    /** @type {?} */
    FilterTextboxComponent.prototype.input;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.app;
    /** @type {?} */
    FilterTextboxComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterTextboxComponent.prototype.localSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXJvdy10ZXh0Ym94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1lZGl0b3JzL2ZpbHRlci1yb3ctdGV4dGJveC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSx3QkFBd0IsRUFBRSxRQUFRLEVBQWdCLGNBQWMsRUFDdkYsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBRWxHLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFnQixNQUFNLGdCQUFnQixDQUFDO0FBRTdELE9BQU8sY0FBYyxNQUFNLDBCQUEwQixDQUFDO0FBRXRELE9BQU8sRUFBRSxnQkFBZ0IsRUFBcUIsTUFBTSxxQkFBcUIsQ0FBQztBQUUxRSxPQUFPLEVBQUUsY0FBYyxFQUNmLG1CQUFtQixFQUFFLDJCQUEyQixFQUFFLG9CQUFvQixHQUFHLE1BQU0sMkJBQTJCLENBQUM7QUFDbkgsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDMUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUEwQnpFLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSx3QkFBd0I7Ozs7Ozs7Ozs7SUF5QmhFLFlBQ1ksR0FBNkIsRUFBVSxRQUFrQixFQUFVLEdBQW1CLEVBQ3ZGLElBQThCLEVBQVUsTUFBaUIsRUFBVSxFQUFxQixFQUN2RixRQUF1QjtRQUUvQixLQUFLLEVBQUUsQ0FBQztRQUpBLFFBQUcsR0FBSCxHQUFHLENBQTBCO1FB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R0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDcEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDNUIsQ0FBQzs7O1lBN1FKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsZ0JBQWdCO2dCQUMxQixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7S0FhVDt5QkFFRzs7OztVQUlFO2FBRVQ7Ozs7WUF0QzBCLHdCQUF3QjtZQUFFLFFBQVE7WUFBZ0IsY0FBYztZQVlsRix3QkFBd0I7WUFYN0IsU0FBUztZQUF5QixpQkFBaUI7WUFGOUMsYUFBYTs7O3FCQXlDakIsS0FBSzt1QkFDTCxLQUFLO29CQUNMLEtBQUs7b0JBZ0JMLFNBQVMsU0FBQyxPQUFPOzs7O0lBbEJsQix3Q0FBcUI7O0lBQ3JCLDBDQUEwQjs7SUFDMUIsdUNBQXFCOztJQUNyQiwyQ0FBZTs7SUFTZiw4Q0FBZ0M7O0lBRWhDLGdEQUFzRDs7SUFFdEQseURBQTZDOztJQUU3Qyx1Q0FBc0M7Ozs7O0lBRXRDLG9DQUF5Qzs7Ozs7SUFDekMsc0NBQTRCOzs7OztJQUM1QixvQ0FBOEI7Ozs7O0lBRzFCLHFDQUFxQzs7Ozs7SUFBRSwwQ0FBMEI7Ozs7O0lBQUUscUNBQTJCOztJQUM5RixzQ0FBcUM7Ozs7O0lBQUUsd0NBQXlCOzs7OztJQUFFLG9DQUE2Qjs7Ozs7SUFDL0YsMENBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciwgQ29tcG9uZW50UmVmLCBBcHBsaWNhdGlvblJlZixcclxuICAgIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgTmdab25lLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlbGF5LCBmaWx0ZXIsIGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdyZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwnO1xyXG5cclxuaW1wb3J0IHsgQ29sdW1uRmlsdGVyVHlwZSwgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuXHJcbmltcG9ydCB7IEZpbHRlck9wZXJhdG9yLCBGaWx0ZXJDb25kaXRpb24sXHJcbiAgICAgICAgVGV4dEZpbHRlck9wZXJhdG9ycywgTnVtYmVyT3JEYXRlRmlsdGVyT3BlcmF0b3JzLCBGaWx0ZXJDb25kaXRpb25WYWx1ZSwgfSBmcm9tICcuLy4uL29wZXJhdGlvbnMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRmlsdGVyUm93UGFuZWxDb21wb25lbnQgfSBmcm9tICcuL2ZpbHRlci1yb3ctcGFuZWwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRGaWx0ZXJSb3dTZXJ2aWNlIH0gZnJvbSAnLi4vZGF0YWdyaWQtZmlsdGVyLXJvdy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRmlsdGVyUm93RWRpdG9yQ29tcG9uZW50IH0gZnJvbSAnLi9maWx0ZXItcm93LWVkaXRvci5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZpbHRlci10ZXh0Ym94JyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1oZWFkZXItY2VsbC1jb250ZW50IGYtZGF0YWdyaWQtZmlsdGVyLWNlbGwgZC1mbGV4XCIgc3R5bGU9XCJwYWRkaW5nLXJpZ2h0OiA1cHhcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1jZWxsLWZvcm1ncm91cCBmYXJyaXMtZ3JvdXAtYXV0byBmbGV4LWZpbGxcIj5cclxuICAgICAgICAgICAgPGlucHV0ICpuZ0lmPVwiIWRpc2FibGVkXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBbYXR0ci50eXBlXT1cImlucHV0VHlwZVwiIFt2YWx1ZV09XCJmaWx0ZXJTdHJcIlxyXG4gICAgICAgICAgICAgICAgKGlucHV0KT1cIm9uVGV4dFZhbHVlQ2hhbmdlKCRldmVudClcIiAjaW5wdXQgW2NsYXNzLm5vLW51bWJlci1idXR0b25dPVwiaW5wdXRUeXBlID09ICdudW1iZXInXCI+XHJcbiAgICAgICAgICAgIDxpbnB1dCAqbmdJZj1cImRpc2FibGVkXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiB0eXBlPVwidGV4dFwiIFt2YWx1ZV09XCJmaWx0ZXJTdHJcIlxyXG4gICAgICAgICAgICBbYXR0ci50aXRsZV09XCJmaWx0ZXJTdHJcIiBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIiBbY2xhc3MuZmlsdGVyLWVkaXRvci1kaXNhYmxlZF09XCJkaXNhYmxlZFwiID5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IHN0eWxlPVwibWluLXdpZHRoOiAyNnB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyO1wiICpuZ0lmPVwiY29sdW1uLmZpbHRlci5lbmFibGVPcGVyYXRvclwiPlxyXG4gICAgICAgICAgICA8c3BhbiBzdHlsZT1cImN1cnNvcjogcG9pbnRlcjtcIiBjbGFzcz1cImYtaWNvbiBmLWljb24tZmlsdGVyLXNtXCIgKGNsaWNrKT1cInNob3coJGV2ZW50KVwiPjwvc3Bhbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gICAgYCxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAubm8tbnVtYmVyLWJ1dHRvbnstbW96LWFwcGVhcmFuY2U6IHRleHRmaWVsZDt9XHJcbiAgICAgICAgLm5vLW51bWJlci1idXR0b246Oi13ZWJraXQtb3V0ZXItc3Bpbi1idXR0b24sIC5uby1udW1iZXItYnV0dG9uOjotd2Via2l0LWlubmVyLXNwaW4tYnV0dG9uIHtcclxuICAgICAgICAgICAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmUhaW1wb3J0YW50O1xyXG4gICAgICAgIH1gXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGaWx0ZXJUZXh0Ym94Q29tcG9uZW50IGV4dGVuZHMgRmlsdGVyUm93RWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgpIGNvbHVtbjogYW55O1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGRlbGF5ID0gMzAwO1xyXG4gICAgZmlsdGVyU3RyID0gJyc7XHJcblxyXG4gICAgZ2V0IGlucHV0VHlwZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUubnVtYmVyICkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ251bWJlcic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAndGV4dCc7XHJcbiAgICB9XHJcblxyXG4gICAgZ3JpZEluc3RhbmNlOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuXHJcbiAgICBmaWx0ZXJQYW5lbFJlZjogQ29tcG9uZW50UmVmPEZpbHRlclJvd1BhbmVsQ29tcG9uZW50PjtcclxuXHJcbiAgICBmaWx0ZXJQYW5lbFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdpbnB1dCcpIGlucHV0OiBFbGVtZW50UmVmO1xyXG5cclxuICAgIHByaXZhdGUgcm86IFJlc2l6ZU9ic2VydmVyIHwgbnVsbCA9IG51bGw7XHJcbiAgICBwcml2YXRlIHpvbmU6IE5nWm9uZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSBhcHA6IEFwcGxpY2F0aW9uUmVmLFxyXG4gICAgICAgIHB1YmxpYyBkZnJzOiBEYXRhZ3JpZEZpbHRlclJvd1NlcnZpY2UsIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHByaXZhdGUgbG9jYWxTZXI6IExvY2FsZVNlcnZpY2VcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIHRoaXMuem9uZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nWm9uZSk7XHJcbiAgICAgICAgdGhpcy5lbCA9IHRoaXMuaW5qZWN0b3IuZ2V0KEVsZW1lbnRSZWYpO1xyXG5cclxuICAgICAgICB0aGlzLmRmcnMuZmlsdGVyVGV4dGJveENoYW5nZWQucGlwZShcclxuICAgICAgICAgICAgZmlsdGVyKHYgPT4gdlt0aGlzLmNvbHVtbi5maWVsZF0gIT09IHVuZGVmaW5lZCksXHJcbiAgICAgICAgICAgIGRlbGF5KHRoaXMuZGVsYXkpXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKG9iajogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IG9ialt0aGlzLmNvbHVtbi5maWVsZF07XHJcbiAgICAgICAgICAgIGlmICh2YWwgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfY29uZGl0aW9uID0geyBvcGVyYXRvcjE6IEZpbHRlck9wZXJhdG9yLkNvbnRhaW5zLCB2YWx1ZTE6IHZhbCB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLm51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9jb25kaXRpb24ub3BlcmF0b3IxID0gRmlsdGVyT3BlcmF0b3IuRXF1YWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnJzLnVwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIF9jb25kaXRpb24gKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGZycy51cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBGaWx0ZXJDb25kaXRpb25WYWx1ZS5BbGwgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmRmcnMucmVtb3ZlRmllbGQuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZiA9PT0gdGhpcy5jb2x1bW4uZmllbGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMucm8pIHtcclxuICAgICAgICAgICAgdGhpcy5yby5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgICAgIHRoaXMucm8gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzaG93KGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuICAgICAgICBjb25zdCBkZ0NvbnRhaW5lckVsZSA9IChldmVudC50YXJnZXQgYXMgYW55KS5jbG9zZXN0KCcuZi1kYXRhZ3JpZCcpO1xyXG4gICAgICAgIGlmIChkZ0NvbnRhaW5lckVsZSkge1xyXG4gICAgICAgICAgICBkZ0NvbnRhaW5lckVsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRmcnMuZ3JpZEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGZycy5ncmlkSW5zdGFuY2UgPSB0aGlzLmdyaWRJbnN0YW5jZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNmID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRmlsdGVyUm93UGFuZWxDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYgPSBjZi5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgdGhpcy5hcHAuYXR0YWNoVmlldyh0aGlzLmZpbHRlclBhbmVsUmVmLmhvc3RWaWV3KTtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmNvbHVtbiA9IHRoaXMuY29sdW1uO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UuZ3JpZEluc3RhbmNlID0gdGhpcy5ncmlkSW5zdGFuY2U7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdE9wZXJhdG9ycyh0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlciAhPT0gZmFsc2UgJiYgdGhpcy5jb2x1bW4uZmlsdGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5kYXRhdHlwZSA9IHRoaXMuY29sdW1uLmZpbHRlci50eXBlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmVudW0gfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmZyb21kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmhlaWdodCA9ICAzMDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2x1bW5Db25kaXRpb24gPSB0aGlzLmRmcnMuY29sdW1uQ29uZGl0aW9uc1t0aGlzLmNvbHVtbi5maWVsZF07XHJcbiAgICAgICAgaWYgKGN1cnJlbnRDb2x1bW5Db25kaXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5pbnN0YW5jZS5jb25kaXRpb24gPSBjdXJyZW50Q29sdW1uQ29uZGl0aW9uIGFzIEZpbHRlckNvbmRpdGlvbjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmNvbmRpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgIG9wZXJhdG9yMTogMCxcclxuICAgICAgICAgICAgICAgIHZhbHVlMTogJycsXHJcbiAgICAgICAgICAgICAgICByZWxhdGlvbjogJycsXHJcbiAgICAgICAgICAgICAgICBvcGVyYXRvcjI6IDAsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTI6ICcnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIHRoaXMuaW5pdE9wZXJhdG9ycyh0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxTdWJzY3JpcHRpb24gPSB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLmNvbmRpdGlvbkNoYW5nZS5zdWJzY3JpYmUoKGNvbmRpdGlvbjogRmlsdGVyQ29uZGl0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjb25kaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGZycy51cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBjb25kaXRpb24gKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyU3RyID0gdGhpcy5kZnJzLmNvbmRpdGlvbjJzdHJpbmcodGhpcy5jb2x1bW4sIGNvbmRpdGlvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPCAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9ICEhdGhpcy5maWx0ZXJTdHI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnJzLnVwZGF0ZUNvbHVtbkNvbmRpdGlvbnModGhpcy5jb2x1bW4uZmllbGQsIEZpbHRlckNvbmRpdGlvblZhbHVlLkFsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5maWx0ZXJQYW5lbFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50KTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVGaWx0ZXJQYW5lbFBvc2l0aW9uKGV2ZW50LnRhcmdldCk7XHJcbiAgICAgICAgdGhpcy5kZnJzLnNldEZpbHRlclBhbmVsKHRoaXMuZmlsdGVyUGFuZWxSZWYpO1xyXG4gICAgICAgIGxldCB7IHdpZHRoOiBkZ3dpZHRoLCBoZWlnaHQ6IGRnSGVpZ2h0IH0gPSBkZ0NvbnRhaW5lckVsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICB0aGlzWydER19DT05UQUlORVJfU0laRSddID0geyB3aWR0aDogZGd3aWR0aCwgaGVpZ2h0OiBkZ0hlaWdodCB9O1xyXG5cclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLnBhbmVsSGVpZ2h0Q2hhbmdlLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQgfSA9IGRnQ29udGFpbmVyRWxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICB0aGlzWydER19DT05UQUlORVJfU0laRSddID0geyB3aWR0aCAsIGhlaWdodCB9O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMucm8pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJpZXMsIG9ic2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbJ3Jlc2l6ZV90aW1lcl8wMDEnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpc1sncmVzaXplX3RpbWVyXzAwMSddKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1sncmVzaXplX3RpbWVyXzAwMSddID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQgfSA9IGVudHJpZXNbMF0udGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoOiBkZ1dpZHRoLCBoZWlnaHQ6IGRnSGVpZ2h0IH0gPSB0aGlzWydER19DT05UQUlORVJfU0laRSddO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZEluc3RhbmNlLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZ1dpZHRoID09IHdpZHRoIHx8IGRnV2lkdGggLSB3aWR0aCA9PT0gNyB8fCBkZ1dpZHRoIC0gd2lkdGggPT09IC03KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkdGggIT09IGRnV2lkdGggfHwgaGVpZ2h0ICE9PSBkZ0hlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yby5vYnNlcnZlKGRnQ29udGFpbmVyRWxlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYuaW5zdGFuY2UudGFyZ2V0ID0gZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB0aGlzLmZpbHRlclBhbmVsUmVmLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLmRmcnMuY2xvc2VGaWx0ZXJQYW5lbCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmZpbHRlclBhbmVsU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJQYW5lbFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdE9wZXJhdG9ycyhpbnM6IEZpbHRlclJvd1BhbmVsQ29tcG9uZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLnN0cmluZykge1xyXG4gICAgICAgICAgICBpbnMub3BlcmF0b3JzID0gVGV4dEZpbHRlck9wZXJhdG9ycztcclxuICAgICAgICAgICAgaW5zLmNvbmRpdGlvbi5vcGVyYXRvcjEgPSBGaWx0ZXJPcGVyYXRvci5Db250YWlucztcclxuICAgICAgICAgICAgaW5zLmNvbmRpdGlvbi5vcGVyYXRvcjIgPSBGaWx0ZXJPcGVyYXRvci5Db250YWlucztcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLm51bWJlciB8fCB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5kYXRldGltZVxyXG4gICAgICAgICAgICB8fCB0aGlzLmNvbHVtbi5maWx0ZXIudHlwZSA9PT0gQ29sdW1uRmlsdGVyVHlwZS5kYXRlIHx8IHRoaXMuY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLnRpbWUpIHtcclxuICAgICAgICAgICAgaW5zLm9wZXJhdG9ycyA9IE51bWJlck9yRGF0ZUZpbHRlck9wZXJhdG9ycztcclxuICAgICAgICAgICAgaW5zLmNvbmRpdGlvbi5vcGVyYXRvcjEgPSBGaWx0ZXJPcGVyYXRvci5FcXVhbDtcclxuICAgICAgICAgICAgaW5zLmNvbmRpdGlvbi5vcGVyYXRvcjIgPSBGaWx0ZXJPcGVyYXRvci5FcXVhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChpbnMub3BlcmF0b3JzKSB7XHJcbiAgICAgICAgICAgIGlucy5vcGVyYXRvcnMuZm9yRWFjaChvID0+IHtcclxuICAgICAgICAgICAgICAgIG8ubGFiZWwgPSB0aGlzLmRmcnMuZ2V0T3BlcmF0b3JMYWJlbChvLmNvZGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVGaWx0ZXJQYW5lbFBvc2l0aW9uKHRhcmdldCkge1xyXG4gICAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVySWNvblBhcmVudCA9IHRhcmdldC5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgICAgICBpZiAoZmlsdGVySWNvblBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gZmlsdGVySWNvblBhcmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gdGFyZ2V0LmNsb3Nlc3QoJ3RyJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZCA9IHRhcmdldC5jbG9zZXN0KCd0ZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlclBvcyA9IHRhcmdldC5jbG9zZXN0KCcuZi1kYXRhZ3JpZC1oZWFkZXInKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhbmVsV2lkdGggPSB0aGlzLmZpbHRlclBhbmVsUmVmLmluc3RhbmNlLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgbGV0IGxlZnQgPSBwb3MubGVmdDtcclxuICAgICAgICAgICAgICAgIGlmIChoZWFkZXJQb3Mud2lkdGggKyBoZWFkZXJQb3MueCA8IHBvcy54ICsgcGFuZWxXaWR0aCApIHsgLy8gdGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPT09IENvbHVtbkZpbHRlclR5cGUuZW51bVxyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQgPSB0ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0ICsgdGQub2Zmc2V0V2lkdGggLSBwYW5lbFdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyUGFuZWxSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucGFuZWwtaWNvbicpLnN0eWxlLmxlZnQgPSBgJHtwYW5lbFdpZHRoIC0gNDB9cHhgO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgdG9wID0gcG9zLnRvcFxyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFuZWwgPSB0aGlzLmZpbHRlclBhbmVsUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFuZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShwYW5lbCwgJ3RvcCcsIGAke3Bvcy50b3B9cHhgKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZShwYW5lbCwgJ2xlZnQnLCBgJHtsZWZ0fXB4YCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25UZXh0VmFsdWVDaGFuZ2UoJGV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSAkZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgIHRoaXMuZGZycy5maWx0ZXJUZXh0Ym94Q2hhbmdlZC5lbWl0KHsgW3RoaXMuY29sdW1uLmZpZWxkXTogdmFsdWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJWYWx1ZSgpIHtcclxuICAgICAgICB0aGlzLmZpbHRlclN0ciA9ICcnO1xyXG4gICAgICAgIGlmICh0aGlzLmlucHV0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4uZmlsdGVyLnR5cGUgPCAyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEZpbHRlcihjb25kaXRpb246IGFueSkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyU3RyID0gdGhpcy5kZnJzLmNvbmRpdGlvbjJzdHJpbmcodGhpcy5jb2x1bW4sIGNvbmRpdGlvbik7XHJcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9ICEhdGhpcy5maWx0ZXJTdHI7XHJcbiAgICAgICAgdGhpcy5kZnJzLl91cGRhdGVDb2x1bW5Db25kaXRpb25zKHRoaXMuY29sdW1uLmZpZWxkLCBjb25kaXRpb24pO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { FormControl, FormBuilder } from '@angular/forms';
import { ColumnFilterType } from '@farris/ui-datagrid';
import { Component, Input, Output, EventEmitter, Injector, ChangeDetectorRef } from '@angular/core';
import { FilterOperator } from '../operations/operators';
var ConditionEditorComponent = /** @class */ (function () {
    function ConditionEditorComponent(inject, cd, fb) {
        this.inject = inject;
        this.cd = cd;
        this.fb = fb;
        this.datatype = ColumnFilterType.string;
        this.condition = {
            operator1: 0,
            value1: '',
            relation: '',
            operator2: 0,
            value2: ''
        };
        this.filterOptions = {};
        this.conditionChange = new EventEmitter();
        this.panelHeightChange = new EventEmitter();
        this.emptyCondition = tslib_1.__assign({}, this.condition);
        this.formValueChangesSubscription = null;
        this.originalCondition = {};
        this.form = this.fb.group({
            operator1: new FormControl(0),
            value1: new FormControl(''),
            relation: new FormControl(''),
            operator2: new FormControl(0),
            value2: new FormControl(''),
        });
        this.emptyConditonString = JSON.stringify(this.emptyCondition);
    }
    /**
     * @return {?}
     */
    ConditionEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.originalCondition = Object.assign({}, this.condition);
        this.form.patchValue(this.condition);
    };
    /**
     * @return {?}
     */
    ConditionEditorComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.formValueChangesSubscription) {
            this.formValueChangesSubscription.unsubscribe();
            this.formValueChangesSubscription = null;
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ConditionEditorComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @private
     * @param {?} v
     * @return {?}
     */
    ConditionEditorComponent.prototype.emitConditionChange = /**
     * @private
     * @param {?} v
     * @return {?}
     */
    function (v) {
        this.condition = v;
        /** @type {?} */
        var filter = this.checkFilterOperator();
        this.conditionChange.emit(filter);
    };
    /**
     * @return {?}
     */
    ConditionEditorComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.form.valueChanges.subscribe((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            _this.condition = Object.assign(_this.emptyCondition, _this.condition);
            if (v.operator1 > 1000) {
                _this.emitConditionChange(v);
                return;
            }
            /** @type {?} */
            var currentFilterJSON = JSON.stringify(v);
            if (_this.emptyConditonString === currentFilterJSON) {
                _this.emitConditionChange(v);
            }
            else {
                // if (this.condition.value1 != v.value1 || (this.condition.value2 !== undefined && this.condition.value2 != v.value2)) {
                if (JSON.stringify(_this.condition) !== currentFilterJSON) {
                    _this.emitConditionChange(v);
                    if (v.value2 == '') {
                        _this.emitPanelHeightChanged();
                    }
                }
                else {
                    if ((_this.condition.operator1 != v.operator1) ||
                        (_this.condition.relation != v.relation || _this.condition.operator2 != v.operator2)) {
                        _this.emitConditionChange(v);
                    }
                }
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    ConditionEditorComponent.prototype.checkFilterOperator = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var filter = tslib_1.__assign({}, this.condition);
        /** @type {?} */
        var op1 = parseInt('' + filter.operator1, 10);
        /** @type {?} */
        var f1 = { operator1: filter.operator1, value1: filter.value1 };
        if (op1 === FilterOperator.Empty || op1 === FilterOperator.NotEmpty) {
            filter.value1 = '';
            f1.value1 = '';
        }
        if ((filter.value1 === '' || filter.value1 === null) && op1 !== FilterOperator.Empty && op1 !== FilterOperator.NotEmpty) {
            return '';
        }
        if (!filter.relation) {
            return f1;
        }
        else {
            /** @type {?} */
            var op2 = parseInt('' + filter.operator2, 10);
            if (op2 === FilterOperator.Empty || op2 === FilterOperator.NotEmpty) {
                filter.value2 = '';
                return filter;
            }
            else {
                if (filter.value2 == null || filter.value2 == undefined || filter.value2 === '') {
                    return f1;
                }
            }
        }
        return filter;
    };
    /**
     * @param {?} relation
     * @param {?} $event
     * @return {?}
     */
    ConditionEditorComponent.prototype.chooseRelation = /**
     * @param {?} relation
     * @param {?} $event
     * @return {?}
     */
    function (relation, $event) {
        $event.stopPropagation();
        /** @type {?} */
        var emit = !this.form.get('relation').value;
        this.form.get('relation').setValue(relation);
        this.condition.relation = relation;
        if (this.condition.operator2 === undefined) {
            this.condition.operator2 = 0;
        }
        if (emit) {
            this.emitPanelHeightChanged();
        }
        this.cd.detectChanges();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ConditionEditorComponent.prototype.resetFilters = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.emptyConditonString !== JSON.stringify(this.condition)) {
            this.condition = JSON.parse(this.emptyConditonString);
            this.form.reset(this.condition);
            this.emitPanelHeightChanged();
        }
    };
    /**
     * @private
     * @return {?}
     */
    ConditionEditorComponent.prototype.emitPanelHeightChanged = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this['panelHeightChangedTimer']) {
            clearTimeout(this['panelHeightChangedTimer']);
        }
        this['panelHeightChangedTimer'] = setTimeout((/**
         * @return {?}
         */
        function () {
            _this.panelHeightChange.emit();
        }), 20);
    };
    ConditionEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'condition-editor',
                    template: "<form [formGroup]=\"form\">\r\n<ul class=\"list-group filter-condition\">\r\n    <li class=\"list-group-item border-0\">\r\n        <select class=\"form-control form-control-sm\" formControlName=\"operator1\" single-select [panelRef]=\"selectpanel\">\r\n            <!-- <option *ngFor=\"let o of operators\" [selected]=\"o.isDefault\" [value]=\"o.code\">{{ o.label }}</option> -->\r\n        </select>\r\n        <div #selectpanel class=\"single-select-panel f-area-hide\">\r\n            <ul class=\"dropdown-menu show\">\r\n                <li class=\"dropdown-item\" *ngFor=\"let col of operators\" [attr.value]=\"col.code\" [class.active]=\"condition.operator1 === col.code\">{{ col.label }}</li>\r\n            </ul>\r\n        </div>\r\n    </li>\r\n    <li class=\"list-group-item border-0\" [ngSwitch]=\"datatype\" *ngIf=\"condition.operator1 < 1000\">\r\n        <!-- <farris-time-picker #timepicker formControlName=\"value1\" [readonly]= \"false\" [editable]= \"true\"\r\n        [hourStep] = \"1\" [minuteStep] = \"1\"  *ngSwitchCase=\"'4'\" [format]=\"filterOptions?.format\" [secondStep] = \"1\"></farris-time-picker> -->\r\n\r\n        <farris-datepicker formControlName=\"value1\" [dateFormat]=\"filterOptions?.dateFormat\" [returnFormat]=\"filterOptions?.returnFormat\" [useDefault]=\"false\" [showTime]=\"false\" *ngSwitchCase=\"'3'\" ></farris-datepicker>\r\n        <farris-datepicker formControlName=\"value1\" [dateFormat]=\"filterOptions?.dateFormat\" [returnFormat]=\"filterOptions?.returnFormat\" [useDefault]=\"false\" [showTime]=\"true\" *ngSwitchCase=\"'5'\" ></farris-datepicker>\r\n        <!-- <farris-number-spinner  name=\"value1\" [(ngModel)]=\"condition.value1\" *ngSwitchCase=\"'1'\"></farris-number-spinner> -->\r\n        <div class=\"f-datagrid-cell-formgroup farris-group-auto flex-fill\"  *ngSwitchCase=\"'1'\">\r\n            <input formControlName=\"value1\" class=\"form-control no-number-button\" type=\"number\" >\r\n        </div>\r\n        <div class=\"f-datagrid-cell-formgroup farris-group-auto flex-fill\"  *ngSwitchCase=\"'4'\">\r\n            <input formControlName=\"value1\" class=\"form-control\" type=\"time\" >\r\n        </div>\r\n\r\n        <input class=\"form-control form-control-sm\" formControlName=\"value1\" *ngSwitchDefault type=\"text\" >\r\n    </li>\r\n\r\n    <ng-container *ngIf=\"condition.value1 !== '' && condition.value1 !== null && condition.value1 !== undefined\">\r\n        \r\n        <li class=\"list-group-item border-0\">\r\n            <div class=\"custom-control custom-radio custom-control-inline\" style=\"margin-right: 0;\">\r\n                <input type=\"radio\" id=\"customRadioInline1\" formControlName=\"relation\" value=\"and\" class=\"custom-control-input\">\r\n                <label class=\"custom-control-label\" for=\"customRadioInline1\" (click)=\"chooseRelation('and', $event)\">{{ 'datagrid.filter.and' | locale }}</label>\r\n            </div>\r\n            <div class=\"custom-control custom-radio custom-control-inline\">\r\n                <input type=\"radio\" id=\"customRadioInline2\" formControlName=\"relation\" value=\"or\" class=\"custom-control-input\">\r\n                <label class=\"custom-control-label\" for=\"customRadioInline2\"  (click)=\"chooseRelation('or', $event)\">{{ 'datagrid.filter.or' | locale }}</label>\r\n            </div>\r\n        </li>\r\n        <ng-container *ngIf=\"condition.relation\">\r\n            \r\n            <li class=\"list-group-item border-0\">\r\n                <!-- <select class=\"form-control form-control-sm\" formControlName=\"operator2\" >\r\n                    <option *ngFor=\"let o of operators\" [selected]=\"o.isDefault\" [value]=\"o.code\">{{ o.label }}</option>\r\n                </select> -->\r\n\r\n                <select class=\"form-control form-control-sm\" formControlName=\"operator2\" single-select [panelRef]=\"selectpanel2\">\r\n                </select>\r\n                <div #selectpanel2 class=\"single-select-panel f-area-hide\">\r\n                    <ul class=\"dropdown-menu show\">\r\n                        <li class=\"dropdown-item\" *ngFor=\"let col of operators\" [attr.value]=\"col.code\" [class.active]=\"condition.operator2 === col.code\">{{ col.label }}</li>\r\n                    </ul>\r\n                </div>\r\n\r\n\r\n\r\n            </li>\r\n            <li class=\"list-group-item border-0\" [ngSwitch]=\"datatype\" *ngIf=\"condition.operator2 < 1000\">\r\n                <!-- <farris-time-picker #timepicker formControlName=\"value2\" [readonly]= \"false\" [editable]= \"false\"\r\n                [hourStep] = \"1\" [minuteStep] = \"1\"  *ngSwitchCase=\"'4'\" [format]=\"filterOptions?.format\"[secondStep] = \"1\"></farris-time-picker> -->\r\n                <farris-datepicker formControlName=\"value2\" [dateFormat]=\"filterOptions?.dateFormat\" [useDefault]=\"false\" [showTime]=\"false\" *ngSwitchCase=\"'3'\" ></farris-datepicker>\r\n                <farris-datepicker formControlName=\"value2\" [dateFormat]=\"filterOptions?.dateFormat\" [useDefault]=\"false\" [showTime]=\"true\"  *ngSwitchCase=\"'5'\" ></farris-datepicker>\r\n                <!-- <farris-number-spinner  name=\"value2\" [(ngModel)]=\"condition.value2\" *ngSwitchCase=\"'1'\"></farris-number-spinner> -->\r\n                <div class=\"f-datagrid-cell-formgroup farris-group-auto flex-fill\"  *ngSwitchCase=\"'1'\">\r\n                    <input formControlName=\"value2\" class=\"form-control no-number-button\" type=\"number\" >\r\n                </div>\r\n                <div class=\"f-datagrid-cell-formgroup farris-group-auto flex-fill\"  *ngSwitchCase=\"'4'\">\r\n                    <input formControlName=\"value2\" class=\"form-control\" type=\"time\" >\r\n                </div>\r\n                <input class=\"form-control form-control-sm\" formControlName=\"value2\" *ngSwitchDefault type=\"text\" >\r\n            </li>\r\n        </ng-container>\r\n    </ng-container>\r\n    \r\n    <li class=\"list-group-item border-0\">\r\n        <div class=\"d-flex\">\r\n            <!-- <div class=\"p-2 \"><button type=\"button\" class=\"btn btn-light\">\u9AD8\u7EA7</button></div> -->\r\n            <div class=\"ml-auto\">\r\n                <button type=\"button\" style=\"position: unset;\" (click)=\"resetFilters($event)\" class=\"btn btn-primary\">{{ 'datagrid.filter.clear' | locale }}</button>\r\n            </div>\r\n        </div>\r\n   </li>\r\n</ul>\r\n</form>",
                    styles: ["\n        .no-number-button{-moz-appearance: textfield;}\n        .no-number-button::-webkit-outer-spin-button, .no-number-button::-webkit-inner-spin-button {\n              -webkit-appearance: none!important;\n        }"]
                }] }
    ];
    /** @nocollapse */
    ConditionEditorComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ChangeDetectorRef },
        { type: FormBuilder }
    ]; };
    ConditionEditorComponent.propDecorators = {
        operators: [{ type: Input }],
        datatype: [{ type: Input }],
        condition: [{ type: Input }],
        filterOptions: [{ type: Input }],
        conditionChange: [{ type: Output }],
        panelHeightChange: [{ type: Output }]
    };
    return ConditionEditorComponent;
}());
export { ConditionEditorComponent };
if (false) {
    /** @type {?} */
    ConditionEditorComponent.prototype.operators;
    /** @type {?} */
    ConditionEditorComponent.prototype.datatype;
    /** @type {?} */
    ConditionEditorComponent.prototype.condition;
    /** @type {?} */
    ConditionEditorComponent.prototype.filterOptions;
    /** @type {?} */
    ConditionEditorComponent.prototype.conditionChange;
    /** @type {?} */
    ConditionEditorComponent.prototype.panelHeightChange;
    /** @type {?} */
    ConditionEditorComponent.prototype.emptyCondition;
    /** @type {?} */
    ConditionEditorComponent.prototype.formValueChangesSubscription;
    /** @type {?} */
    ConditionEditorComponent.prototype.originalCondition;
    /** @type {?} */
    ConditionEditorComponent.prototype.form;
    /**
     * @type {?}
     * @private
     */
    ConditionEditorComponent.prototype.emptyConditonString;
    /**
     * @type {?}
     * @private
     */
    ConditionEditorComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    ConditionEditorComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    ConditionEditorComponent.prototype.fb;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uLWVkaXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLWZpbHRlci8iLCJzb3VyY2VzIjpbImxpYi9maWx0ZXItZWRpdG9ycy9jb25kaXRpb24tZWRpdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBVSxXQUFXLEVBQUUsV0FBVyxFQUFhLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0UsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdkQsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQzdCLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFhLGlCQUFpQixFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQXVDLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRzlGO0lBNENJLGtDQUFvQixNQUFnQixFQUFVLEVBQXFCLEVBQVUsRUFBZTtRQUF4RSxXQUFNLEdBQU4sTUFBTSxDQUFVO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFhO1FBL0JuRixhQUFRLEdBQXFCLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztRQUVyRCxjQUFTLEdBQW9CO1lBQ2xDLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEVBQUU7WUFDVixRQUFRLEVBQUUsRUFBRTtZQUNaLFNBQVMsRUFBRSxDQUFDO1lBQ1osTUFBTSxFQUFFLEVBQUU7U0FDYixDQUFDO1FBRU8sa0JBQWEsR0FBUSxFQUFFLENBQUM7UUFFdkIsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXJDLHNCQUFpQixHQUFJLElBQUksWUFBWSxFQUFFLENBQUM7UUFFbEQsbUJBQWMsd0JBQVEsSUFBSSxDQUFDLFNBQVMsRUFBRTtRQUV0QyxpQ0FBNEIsR0FBaUIsSUFBSSxDQUFDO1FBQ2xELHNCQUFpQixH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O0lBQTlCO1FBQUEsaUJBT0M7UUFORyxJQUFJLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFO1lBQ2pDLFlBQVksQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDO1NBQ2pEO1FBQ0QsSUFBSSxDQUFDLHlCQUF5QixDQUFDLEdBQUcsVUFBVTs7O1FBQUM7WUFDekMsS0FBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2xDLENBQUMsR0FBRSxFQUFFLENBQUMsQ0FBQztJQUNYLENBQUM7O2dCQWhLSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtvQkFDNUIsKzFNQUFnRDs2QkFFNUMsOE5BSUU7aUJBRVQ7Ozs7Z0JBZHlCLFFBQVE7Z0JBQWEsaUJBQWlCO2dCQUxsQyxXQUFXOzs7NEJBcUJwQyxLQUFLOzJCQUNMLEtBQUs7NEJBRUwsS0FBSztnQ0FRTCxLQUFLO2tDQUVMLE1BQU07b0NBRU4sTUFBTTs7SUF1SVgsK0JBQUM7Q0FBQSxBQWxLRCxJQWtLQztTQXZKWSx3QkFBd0I7OztJQUNqQyw2Q0FBd0M7O0lBQ3hDLDRDQUE4RDs7SUFFOUQsNkNBTUU7O0lBRUYsaURBQWlDOztJQUVqQyxtREFBK0M7O0lBRS9DLHFEQUFrRDs7SUFFbEQsa0RBQXNDOztJQUV0QyxnRUFBa0Q7O0lBQ2xELHFEQUF3Qzs7SUFFeEMsd0NBTUc7Ozs7O0lBRUgsdURBQWtFOzs7OztJQUV0RCwwQ0FBd0I7Ozs7O0lBQUUsc0NBQTZCOzs7OztJQUFFLHNDQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nRm9ybSwgRm9ybUNvbnRyb2wsIEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IENvbHVtbkZpbHRlclR5cGUgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBvZiwgbWVyZ2UgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsXHJcbiAgICBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5qZWN0b3IsIE9uRGVzdHJveSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRmlsdGVyUm93T3BlcmF0b3IsICBGaWx0ZXJDb25kaXRpb24sIEZpbHRlck9wZXJhdG9yIH0gZnJvbSAnLi4vb3BlcmF0aW9ucy9vcGVyYXRvcnMnO1xyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdjb25kaXRpb24tZWRpdG9yJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jb25kaXRpb24tZWRpdG9yLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAubm8tbnVtYmVyLWJ1dHRvbnstbW96LWFwcGVhcmFuY2U6IHRleHRmaWVsZDt9XHJcbiAgICAgICAgLm5vLW51bWJlci1idXR0b246Oi13ZWJraXQtb3V0ZXItc3Bpbi1idXR0b24sIC5uby1udW1iZXItYnV0dG9uOjotd2Via2l0LWlubmVyLXNwaW4tYnV0dG9uIHtcclxuICAgICAgICAgICAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmUhaW1wb3J0YW50O1xyXG4gICAgICAgIH1gXHJcbiAgICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb25kaXRpb25FZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgpIG9wZXJhdG9yczogRmlsdGVyUm93T3BlcmF0b3JbXTtcclxuICAgIEBJbnB1dCgpIGRhdGF0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlID0gQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgY29uZGl0aW9uOiBGaWx0ZXJDb25kaXRpb24gPSB7XHJcbiAgICAgICAgb3BlcmF0b3IxOiAwLFxyXG4gICAgICAgIHZhbHVlMTogJycsXHJcbiAgICAgICAgcmVsYXRpb246ICcnLFxyXG4gICAgICAgIG9wZXJhdG9yMjogMCxcclxuICAgICAgICB2YWx1ZTI6ICcnXHJcbiAgICB9O1xyXG5cclxuICAgIEBJbnB1dCgpIGZpbHRlck9wdGlvbnM6IGFueSA9IHt9O1xyXG5cclxuICAgIEBPdXRwdXQoKSBjb25kaXRpb25DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgQE91dHB1dCgpIHBhbmVsSGVpZ2h0Q2hhbmdlID0gIG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBlbXB0eUNvbmRpdGlvbiA9ICB7Li4udGhpcy5jb25kaXRpb259O1xyXG5cclxuICAgIGZvcm1WYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBvcmlnaW5hbENvbmRpdGlvbjogRmlsdGVyQ29uZGl0aW9uID0ge307XHJcblxyXG4gICAgZm9ybTogRm9ybUdyb3VwID0gdGhpcy5mYi5ncm91cCh7XHJcbiAgICAgICAgb3BlcmF0b3IxOiBuZXcgRm9ybUNvbnRyb2woMCksXHJcbiAgICAgICAgdmFsdWUxOiBuZXcgRm9ybUNvbnRyb2woJycpLFxyXG4gICAgICAgIHJlbGF0aW9uOiBuZXcgRm9ybUNvbnRyb2woJycpLFxyXG4gICAgICAgIG9wZXJhdG9yMjogbmV3IEZvcm1Db250cm9sKDApLFxyXG4gICAgICAgIHZhbHVlMjogbmV3IEZvcm1Db250cm9sKCcnKSxcclxuICAgIH0pO1xyXG5cclxuICAgIHByaXZhdGUgZW1wdHlDb25kaXRvblN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZW1wdHlDb25kaXRpb24pO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0OiBJbmplY3RvciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9yaWdpbmFsQ29uZGl0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jb25kaXRpb24pO1xyXG4gICAgICAgIHRoaXMuZm9ybS5wYXRjaFZhbHVlKHRoaXMuY29uZGl0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtVmFsdWVDaGFuZ2VzU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybVZhbHVlQ2hhbmdlc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1WYWx1ZUNoYW5nZXNTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZW1pdENvbmRpdGlvbkNoYW5nZSh2OiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbiA9IHY7XHJcbiAgICAgICAgY29uc3QgZmlsdGVyID0gdGhpcy5jaGVja0ZpbHRlck9wZXJhdG9yKCk7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25DaGFuZ2UuZW1pdChmaWx0ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmZvcm0udmFsdWVDaGFuZ2VzLnN1YnNjcmliZSgodjogRmlsdGVyQ29uZGl0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9uID0gT2JqZWN0LmFzc2lnbih0aGlzLmVtcHR5Q29uZGl0aW9uLCB0aGlzLmNvbmRpdGlvbik7XHJcblxyXG4gICAgICAgICAgICBpZiAodi5vcGVyYXRvcjEgPiAxMDAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRDb25kaXRpb25DaGFuZ2Uodik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGaWx0ZXJKU09OID0gSlNPTi5zdHJpbmdpZnkodik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5Q29uZGl0b25TdHJpbmcgPT09IGN1cnJlbnRGaWx0ZXJKU09OKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVtaXRDb25kaXRpb25DaGFuZ2Uodik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiAodGhpcy5jb25kaXRpb24udmFsdWUxICE9IHYudmFsdWUxIHx8ICh0aGlzLmNvbmRpdGlvbi52YWx1ZTIgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmNvbmRpdGlvbi52YWx1ZTIgIT0gdi52YWx1ZTIpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5jb25kaXRpb24pICE9PSBjdXJyZW50RmlsdGVySlNPTikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdENvbmRpdGlvbkNoYW5nZSh2KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodi52YWx1ZTIgPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0UGFuZWxIZWlnaHRDaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuY29uZGl0aW9uLm9wZXJhdG9yMSAhPSB2Lm9wZXJhdG9yMSkgfHwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmNvbmRpdGlvbi5yZWxhdGlvbiAhPSB2LnJlbGF0aW9uICB8fCB0aGlzLmNvbmRpdGlvbi5vcGVyYXRvcjIgIT0gdi5vcGVyYXRvcjIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdENvbmRpdGlvbkNoYW5nZSh2KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrRmlsdGVyT3BlcmF0b3IoKSB7XHJcbiAgICAgICAgY29uc3QgZmlsdGVyID0gey4uLnRoaXMuY29uZGl0aW9ufTtcclxuICAgICAgICBjb25zdCBvcDEgPSBwYXJzZUludCgnJyArIGZpbHRlci5vcGVyYXRvcjEsIDEwKTtcclxuICAgICAgICBjb25zdCBmMSA9IHtvcGVyYXRvcjE6IGZpbHRlci5vcGVyYXRvcjEsIHZhbHVlMTogZmlsdGVyLnZhbHVlMX07XHJcblxyXG4gICAgICAgIGlmIChvcDEgPT09IEZpbHRlck9wZXJhdG9yLkVtcHR5IHx8IG9wMSA9PT0gRmlsdGVyT3BlcmF0b3IuTm90RW1wdHkpIHtcclxuICAgICAgICAgICAgZmlsdGVyLnZhbHVlMSA9ICcnO1xyXG4gICAgICAgICAgICBmMS52YWx1ZTEgPSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgoZmlsdGVyLnZhbHVlMSA9PT0gJycgfHwgZmlsdGVyLnZhbHVlMSA9PT0gbnVsbCkgJiYgb3AxICE9PSBGaWx0ZXJPcGVyYXRvci5FbXB0eSAmJiBvcDEgIT09IEZpbHRlck9wZXJhdG9yLk5vdEVtcHR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghZmlsdGVyLnJlbGF0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBvcDIgPSBwYXJzZUludCgnJyArIGZpbHRlci5vcGVyYXRvcjIsIDEwKTtcclxuICAgICAgICAgICAgaWYgKG9wMiA9PT0gRmlsdGVyT3BlcmF0b3IuRW1wdHkgfHwgb3AyID09PSBGaWx0ZXJPcGVyYXRvci5Ob3RFbXB0eSkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnZhbHVlMiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIudmFsdWUyID09IG51bGwgfHwgZmlsdGVyLnZhbHVlMiA9PSB1bmRlZmluZWQgfHwgZmlsdGVyLnZhbHVlMiA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgY2hvb3NlUmVsYXRpb24ocmVsYXRpb246ICdhbmQnIHwgJ29yJywgJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIGNvbnN0IGVtaXQgPSAhdGhpcy5mb3JtLmdldCgncmVsYXRpb24nKS52YWx1ZTtcclxuICAgICAgICB0aGlzLmZvcm0uZ2V0KCdyZWxhdGlvbicpLnNldFZhbHVlKHJlbGF0aW9uKTtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbi5yZWxhdGlvbiA9IHJlbGF0aW9uO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbmRpdGlvbi5vcGVyYXRvcjIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbi5vcGVyYXRvcjIgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGVtaXQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbWl0UGFuZWxIZWlnaHRDaGFuZ2VkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0RmlsdGVycygkZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5lbXB0eUNvbmRpdG9uU3RyaW5nICE9PSBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbmRpdGlvbikpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb24gPSBKU09OLnBhcnNlKHRoaXMuZW1wdHlDb25kaXRvblN0cmluZyk7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybS5yZXNldCh0aGlzLmNvbmRpdGlvbik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmVtaXRQYW5lbEhlaWdodENoYW5nZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0UGFuZWxIZWlnaHRDaGFuZ2VkKCkge1xyXG4gICAgICAgIGlmICh0aGlzWydwYW5lbEhlaWdodENoYW5nZWRUaW1lciddKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzWydwYW5lbEhlaWdodENoYW5nZWRUaW1lciddKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpc1sncGFuZWxIZWlnaHRDaGFuZ2VkVGltZXInXSA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnBhbmVsSGVpZ2h0Q2hhbmdlLmVtaXQoKTtcclxuICAgICAgICB9LCAyMCk7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
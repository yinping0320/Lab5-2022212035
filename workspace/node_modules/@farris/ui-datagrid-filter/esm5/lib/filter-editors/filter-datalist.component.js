/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ElementRef, Output, EventEmitter, Injector, ViewEncapsulation, ChangeDetectorRef } from '@angular/core';
import { cloneDeep } from 'lodash-es';
import { DatalistComponent } from '@farris/ui-datalist';
import { FilterOperator, FilterConditionValue } from './../operations/operators';
import { DatagridFilterRowService } from './../datagrid-filter-row.service';
var FilterDatalistComponent = /** @class */ (function () {
    function FilterDatalistComponent(inject, cd, dfrs) {
        this.inject = inject;
        this.cd = cd;
        this.dfrs = dfrs;
        this.data = [];
        this.showFilter = false;
        this.filterKeyWord = '';
        this.valueChange = new EventEmitter();
        this.checked = false;
        this.originalData = [];
    }
    /**
     * @return {?}
     */
    FilterDatalistComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.originalData = cloneDeep(this.data);
    };
    /**
     * @return {?}
     */
    FilterDatalistComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.selectedValues === undefined) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.checkAll(true, false);
                _this.checked = true;
                _this.cd.detectChanges();
            }));
        }
        this.updateCheckboxState();
    };
    /**
     * @private
     * @param {?=} checked
     * @param {?=} emit
     * @return {?}
     */
    FilterDatalistComponent.prototype.checkAll = /**
     * @private
     * @param {?=} checked
     * @param {?=} emit
     * @return {?}
     */
    function (checked, emit) {
        var _this = this;
        if (checked === void 0) { checked = true; }
        if (emit === void 0) { emit = true; }
        if (checked) {
            this.dataListInstance.selectAll();
            this.selectedValues = this.originalData.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n[_this.valueField]; })).join(',');
        }
        else {
            this.dataListInstance.unSelectAll();
            this.selectedValues = '';
        }
        if (emit) {
            this.buildCondition();
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterDatalistComponent.prototype.checkAllHandler = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.checked = $event;
        this.chkall.nativeElement.indeterminate = false;
        this.checkAll(this.checked);
        this.cd.detectChanges();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterDatalistComponent.prototype.onSelect = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.updateSelectedValues($event);
        this.updateCheckboxState();
        this.buildCondition();
    };
    /**
     * @private
     * @return {?}
     */
    FilterDatalistComponent.prototype.updateCheckboxState = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.selectedValues === undefined) {
            return;
        }
        if (this.selectedValues.split(',').length === this.originalData.length) {
            this.checked = true;
            this.chkall.nativeElement.indeterminate = false;
        }
        else {
            this.checked = false;
            this.chkall.nativeElement.indeterminate = true;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterDatalistComponent.prototype.onUnSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.updateSelectedValues($event, false);
        this.checked = false;
        this.chkall.nativeElement.indeterminate = !!this.selectedValues;
        this.buildCondition();
    };
    /**
     * @private
     * @return {?}
     */
    FilterDatalistComponent.prototype.buildCondition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var values = this.selectedValues.split(',');
        if (this.selectedValues) {
            if (values.length === this.originalData.length) {
                this.valueChange.emit(FilterConditionValue.All);
                return;
            }
            /** @type {?} */
            var condition = {
                operator1: FilterOperator.In,
                value1: values
            };
            this.valueChange.emit(condition);
        }
        else {
            // this.valueChange.emit({ operator1: FilterOperator.Equal, value1: [] });
            // 没有选择相当于此条件无效
            this.valueChange.emit(FilterConditionValue.All);
        }
    };
    /**
     * @param {?} $event
     * @param {?=} selected
     * @return {?}
     */
    FilterDatalistComponent.prototype.updateSelectedValues = /**
     * @param {?} $event
     * @param {?=} selected
     * @return {?}
     */
    function ($event, selected) {
        if (selected === void 0) { selected = true; }
        if ($event) {
            /** @type {?} */
            var val_1 = $event.data[this.valueField];
            /** @type {?} */
            var valArr = this.selectedValues ? this.selectedValues.split(',') : [];
            if (selected) {
                if (valArr.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n == val_1; })) === -1) {
                    valArr.push(val_1);
                }
            }
            else {
                valArr = valArr.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n != val_1; }));
            }
            this.selectedValues = valArr.join(',');
            this.cd.detectChanges();
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FilterDatalistComponent.prototype.onTextChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var val = $event.target[this.valueField];
        this.filterKeyWord = val;
        this.changeDataSource();
    };
    /**
     * @private
     * @return {?}
     */
    FilterDatalistComponent.prototype.changeDataSource = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.filterKeyWord) {
            this.data = this.originalData.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return n[_this.textField].indexOf(_this.filterKeyWord) > -1;
            }));
        }
        else {
            this.data = cloneDeep(this.originalData);
        }
    };
    /**
     * @return {?}
     */
    FilterDatalistComponent.prototype.restFilter = /**
     * @return {?}
     */
    function () {
        this.filterKeyWord = '';
        this.changeDataSource();
        this.checkAll();
        this.checked = true;
        this.chkall.nativeElement.indeterminate = false;
        this.cd.detectChanges();
    };
    FilterDatalistComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-datalist',
                    template: "\n    <ul class=\"list-group filter-condition\">\n        <li class=\"list-group-item border-0 border-b1\" *ngIf=\"showFilter\">\n            <input class=\"form-control form-control-sm\" [ngModel]=\"filterKeyWord\"\n                (input)=\"onTextChange($event)\" type=\"text\" >\n        </li>\n        <li class=\"list-group-item datalist border-0 border-b1\">\n            <farris-datalist\n                #dl\n                [data]=\"data\"\n                [idField]=\"idField\"\n                [height]=\"'auto'\"\n                [fit]=\"false\"\n                [multiSelect]=\"true\"\n                [selectedValues]=\"selectedValues\"\n                [valueField]=\"valueField\"\n                [textField]=\"textField\"\n                (selected)=\"onSelect($event)\"\n                (unSelected)=\"onUnSelected($event)\">\n            </farris-datalist>\n        </li>\n        <li class=\"list-group-item border-0\" style=\"border-bottom: 1px solid #dde2eb;\">\n            <div class=\"d-flex\">\n                <div class=\"custom-control custom-checkbox\" style=\"padding-left: 3px;\">\n                    <input id=\"filter-datalist-checkall\" #chkall type=\"checkbox\" class=\"custom-control-input\" [ngModel]=\"checked\" (ngModelChange)=\"checkAllHandler($event)\">\n                    <label class=\"custom-control-label\" for=\"filter-datalist-checkall\" >{{ 'datagrid.filter.checkAll' | locale }}</label>\n                </div>\n                <div class=\"ml-auto\"><button type=\"button\" class=\"btn btn-outline-primary\" (click)=\"restFilter()\">\n                {{ 'datagrid.filter.reset' | locale }}</button></div>\n            </div>\n        </li>\n    </ul>\n    ",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    FilterDatalistComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ChangeDetectorRef },
        { type: DatagridFilterRowService }
    ]; };
    FilterDatalistComponent.propDecorators = {
        valueField: [{ type: Input }],
        textField: [{ type: Input }],
        idField: [{ type: Input }],
        selectedValues: [{ type: Input }],
        data: [{ type: Input }],
        showFilter: [{ type: Input }],
        filterKeyWord: [{ type: Input }],
        chkall: [{ type: ViewChild, args: ['chkall',] }],
        dataListInstance: [{ type: ViewChild, args: ['dl',] }],
        valueChange: [{ type: Output }]
    };
    return FilterDatalistComponent;
}());
export { FilterDatalistComponent };
if (false) {
    /** @type {?} */
    FilterDatalistComponent.prototype.valueField;
    /** @type {?} */
    FilterDatalistComponent.prototype.textField;
    /** @type {?} */
    FilterDatalistComponent.prototype.idField;
    /** @type {?} */
    FilterDatalistComponent.prototype.selectedValues;
    /** @type {?} */
    FilterDatalistComponent.prototype.data;
    /** @type {?} */
    FilterDatalistComponent.prototype.showFilter;
    /** @type {?} */
    FilterDatalistComponent.prototype.filterKeyWord;
    /** @type {?} */
    FilterDatalistComponent.prototype.chkall;
    /** @type {?} */
    FilterDatalistComponent.prototype.dataListInstance;
    /** @type {?} */
    FilterDatalistComponent.prototype.valueChange;
    /** @type {?} */
    FilterDatalistComponent.prototype.checked;
    /**
     * @type {?}
     * @private
     */
    FilterDatalistComponent.prototype.originalData;
    /**
     * @type {?}
     * @private
     */
    FilterDatalistComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    FilterDatalistComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    FilterDatalistComponent.prototype.dfrs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWRhdGFsaXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQtZmlsdGVyLyIsInNvdXJjZXMiOlsibGliL2ZpbHRlci1lZGl0b3JzL2ZpbHRlci1kYXRhbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFDM0QsUUFBUSxFQUFFLGlCQUFpQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFtQixjQUFjLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUU1RTtJQXNESSxpQ0FBb0IsTUFBZ0IsRUFBVSxFQUFxQixFQUFVLElBQThCO1FBQXZGLFdBQU0sR0FBTixNQUFNLENBQVU7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLFNBQUksR0FBSixJQUFJLENBQTBCO1FBWmxHLFNBQUksR0FBRyxFQUFFLENBQUM7UUFDVixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBS2xCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUzQyxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ1IsaUJBQVksR0FBRyxFQUFFLENBQUM7SUFFcUYsQ0FBQzs7OztJQUVoSCwwQ0FBUTs7O0lBQVI7UUFDSSxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQzs7OztJ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Q0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7UUFDaEQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM1QixDQUFDOztnQkFsTEosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxpQkFBaUI7b0JBQzNCLFFBQVEsRUFBRSxnckRBZ0NUO29CQUNELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2lCQUN4Qzs7OztnQkExQ2tCLFFBQVE7Z0JBQXFCLGlCQUFpQjtnQkFJeEQsd0JBQXdCOzs7NkJBd0M1QixLQUFLOzRCQUNMLEtBQUs7MEJBQ0wsS0FBSztpQ0FDTCxLQUFLO3VCQUNMLEtBQUs7NkJBQ0wsS0FBSztnQ0FDTCxLQUFLO3lCQUVMLFNBQVMsU0FBQyxRQUFRO21DQUNsQixTQUFTLFNBQUMsSUFBSTs4QkFFZCxNQUFNOztJQWtJWCw4QkFBQztDQUFBLEFBbkxELElBbUxDO1NBOUlZLHVCQUF1Qjs7O0lBQ2hDLDZDQUE0Qjs7SUFDNUIsNENBQTJCOztJQUMzQiwwQ0FBeUI7O0lBQ3pCLGlEQUFnQzs7SUFDaEMsdUNBQW1COztJQUNuQiw2Q0FBNEI7O0lBQzVCLGdEQUE0Qjs7SUFFNUIseUNBQXdDOztJQUN4QyxtREFBcUQ7O0lBRXJELDhDQUEyQzs7SUFFM0MsMENBQWdCOzs7OztJQUNoQiwrQ0FBMEI7Ozs7O0lBRWQseUNBQXdCOzs7OztJQUFFLHFDQUE2Qjs7Ozs7SUFBRSx1Q0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsXHJcbiAgICBBZnRlclZpZXdJbml0LCBJbmplY3RvciwgVmlld0VuY2Fwc3VsYXRpb24sIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGNsb25lRGVlcCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IERhdGFsaXN0Q29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhbGlzdCc7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvbiwgRmlsdGVyT3BlcmF0b3IsIEZpbHRlckNvbmRpdGlvblZhbHVlIH0gZnJvbSAnLi8uLi9vcGVyYXRpb25zL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyUm93U2VydmljZSB9IGZyb20gJy4vLi4vZGF0YWdyaWQtZmlsdGVyLXJvdy5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdmaWx0ZXItZGF0YWxpc3QnLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgIDx1bCBjbGFzcz1cImxpc3QtZ3JvdXAgZmlsdGVyLWNvbmRpdGlvblwiPlxyXG4gICAgICAgIDxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbSBib3JkZXItMCBib3JkZXItYjFcIiAqbmdJZj1cInNob3dGaWx0ZXJcIj5cclxuICAgICAgICAgICAgPGlucHV0IGNsYXNzPVwiZm9ybS1jb250cm9sIGZvcm0tY29udHJvbC1zbVwiIFtuZ01vZGVsXT1cImZpbHRlcktleVdvcmRcIlxyXG4gICAgICAgICAgICAgICAgKGlucHV0KT1cIm9uVGV4dENoYW5nZSgkZXZlbnQpXCIgdHlwZT1cInRleHRcIiA+XHJcbiAgICAgICAgPC9saT5cclxuICAgICAgICA8bGkgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0gZGF0YWxpc3QgYm9yZGVyLTAgYm9yZGVyLWIxXCI+XHJcbiAgICAgICAgICAgIDxmYXJyaXMtZGF0YWxpc3RcclxuICAgICAgICAgICAgICAgICNkbFxyXG4gICAgICAgICAgICAgICAgW2RhdGFdPVwiZGF0YVwiXHJcbiAgICAgICAgICAgICAgICBbaWRGaWVsZF09XCJpZEZpZWxkXCJcclxuICAgICAgICAgICAgICAgIFtoZWlnaHRdPVwiJ2F1dG8nXCJcclxuICAgICAgICAgICAgICAgIFtmaXRdPVwiZmFsc2VcIlxyXG4gICAgICAgICAgICAgICAgW211bHRpU2VsZWN0XT1cInRydWVcIlxyXG4gICAgICAgICAgICAgICAgW3NlbGVjdGVkVmFsdWVzXT1cInNlbGVjdGVkVmFsdWVzXCJcclxuICAgICAgICAgICAgICAgIFt2YWx1ZUZpZWxkXT1cInZhbHVlRmllbGRcIlxyXG4gICAgICAgICAgICAgICAgW3RleHRGaWVsZF09XCJ0ZXh0RmllbGRcIlxyXG4gICAgICAgICAgICAgICAgKHNlbGVjdGVkKT1cIm9uU2VsZWN0KCRldmVudClcIlxyXG4gICAgICAgICAgICAgICAgKHVuU2VsZWN0ZWQpPVwib25VblNlbGVjdGVkKCRldmVudClcIj5cclxuICAgICAgICAgICAgPC9mYXJyaXMtZGF0YWxpc3Q+XHJcbiAgICAgICAgPC9saT5cclxuICAgICAgICA8bGkgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0gYm9yZGVyLTBcIiBzdHlsZT1cImJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRlMmViO1wiPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3VzdG9tLWNvbnRyb2wgY3VzdG9tLWNoZWNrYm94XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDNweDtcIj5cclxuICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9XCJmaWx0ZXItZGF0YWxpc3QtY2hlY2thbGxcIiAjY2hrYWxsIHR5cGU9XCJjaGVja2JveFwiIGNsYXNzPVwiY3VzdG9tLWNvbnRyb2wtaW5wdXRcIiBbbmdNb2RlbF09XCJjaGVja2VkXCIgKG5nTW9kZWxDaGFuZ2UpPVwiY2hlY2tBbGxIYW5kbGVyKCRldmVudClcIj5cclxuICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJjdXN0b20tY29udHJvbC1sYWJlbFwiIGZvcj1cImZpbHRlci1kYXRhbGlzdC1jaGVja2FsbFwiID57eyAnZGF0YWdyaWQuZmlsdGVyLmNoZWNrQWxsJyB8IGxvY2FsZSB9fTwvbGFiZWw+XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtbC1hdXRvXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtcHJpbWFyeVwiIChjbGljayk9XCJyZXN0RmlsdGVyKClcIj5cclxuICAgICAgICAgICAgICAgIHt7ICdkYXRhZ3JpZC5maWx0ZXIucmVzZXQnIHwgbG9jYWxlIH19PC9idXR0b24+PC9kaXY+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvbGk+XHJcbiAgICA8L3VsPlxyXG4gICAgYCxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbHRlckRhdGFsaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgpIHZhbHVlRmllbGQ6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHRleHRGaWVsZDogc3RyaW5nO1xyXG4gICAgQElucHV0KCkgaWRGaWVsZDogc3RyaW5nO1xyXG4gICAgQElucHV0KCkgc2VsZWN0ZWRWYWx1ZXM6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGRhdGEgPSBbXTtcclxuICAgIEBJbnB1dCgpIHNob3dGaWx0ZXIgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGZpbHRlcktleVdvcmQgPSAnJztcclxuXHJcbiAgICBAVmlld0NoaWxkKCdjaGthbGwnKSBjaGthbGw6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdkbCcpIGRhdGFMaXN0SW5zdGFuY2U6IERhdGFsaXN0Q29tcG9uZW50O1xyXG5cclxuICAgIEBPdXRwdXQoKSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBjaGVja2VkID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIG9yaWdpbmFsRGF0YSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0OiBJbmplY3RvciwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsIHByaXZhdGUgZGZyczogRGF0YWdyaWRGaWx0ZXJSb3dTZXJ2aWNlKSB7IH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLm9yaWdpbmFsRGF0YSA9IGNsb25lRGVlcCh0aGlzLmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFZhbHVlcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja0FsbCh0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVDaGVja2JveFN0YXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0FsbChjaGVja2VkID0gdHJ1ZSwgZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoY2hlY2tlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFMaXN0SW5zdGFuY2Uuc2VsZWN0QWxsKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSB0aGlzLm9yaWdpbmFsRGF0YS5tYXAobiA9PiBuW3RoaXMudmFsdWVGaWVsZF0pLmpvaW4oJywnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFMaXN0SW5zdGFuY2UudW5TZWxlY3RBbGwoKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW1pdCkge1xyXG4gICAgICAgICAgICB0aGlzLmJ1aWxkQ29uZGl0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrQWxsSGFuZGxlcigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmNoZWNrZWQgPSAkZXZlbnQ7XHJcbiAgICAgICAgdGhpcy5jaGthbGwubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jaGVja0FsbCh0aGlzLmNoZWNrZWQpO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uU2VsZWN0KCRldmVudCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRWYWx1ZXMoJGV2ZW50KTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUNoZWNrYm94U3RhdGUoKTtcclxuICAgICAgICB0aGlzLmJ1aWxkQ29uZGl0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVDaGVja2JveFN0YXRlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVmFsdWVzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc3BsaXQoJywnKS5sZW5ndGggPT09IHRoaXMub3JpZ2luYWxEYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNoa2FsbC5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5jaGthbGwubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25VblNlbGVjdGVkKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRWYWx1ZXMoJGV2ZW50LCBmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jaGthbGwubmF0aXZlRWxlbWVudC5pbmRldGVybWluYXRlID0gISF0aGlzLnNlbGVjdGVkVmFsdWVzO1xyXG4gICAgICAgIHRoaXMuYnVpbGRDb25kaXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJ1aWxkQ29uZGl0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc3BsaXQoJywnKTtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFZhbHVlcykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gdGhpcy5vcmlnaW5hbERhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoRmlsdGVyQ29uZGl0aW9uVmFsdWUuQWxsKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBjb25kaXRpb246IEZpbHRlckNvbmRpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgIG9wZXJhdG9yMTogRmlsdGVyT3BlcmF0b3IuSW4sXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTE6IHZhbHVlc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoY29uZGl0aW9uKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoeyBvcGVyYXRvcjE6IEZpbHRlck9wZXJhdG9yLkVxdWFsLCB2YWx1ZTE6IFtdIH0pO1xyXG4gICAgICAgICAgICAvLyDmsqHmnInpgInmi6nnm7jlvZPkuo7mraTmnaHku7bml6DmlYhcclxuICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KEZpbHRlckNvbmRpdGlvblZhbHVlLkFsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVNlbGVjdGVkVmFsdWVzKCRldmVudCwgc2VsZWN0ZWQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICBjb25zdCB2YWwgPSAkZXZlbnQuZGF0YVt0aGlzLnZhbHVlRmllbGRdO1xyXG4gICAgICAgICAgICBsZXQgdmFsQXJyID0gdGhpcy5zZWxlY3RlZFZhbHVlcyA/IHRoaXMuc2VsZWN0ZWRWYWx1ZXMuc3BsaXQoJywnKSA6IFtdO1xyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWxBcnIuZmluZEluZGV4KCBuID0+IG4gPT0gdmFsKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxBcnIucHVzaCh2YWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFsQXJyID0gdmFsQXJyLmZpbHRlcihuID0+IG4gIT0gdmFsKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcyA9IHZhbEFyci5qb2luKCcsJyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25UZXh0Q2hhbmdlKCRldmVudCkge1xyXG4gICAgICAgIGNvbnN0IHZhbCA9ICRldmVudC50YXJnZXRbdGhpcy52YWx1ZUZpZWxkXTtcclxuICAgICAgICB0aGlzLmZpbHRlcktleVdvcmQgPSB2YWw7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VEYXRhU291cmNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VEYXRhU291cmNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmZpbHRlcktleVdvcmQpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5vcmlnaW5hbERhdGEuZmlsdGVyKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5bdGhpcy50ZXh0RmllbGRdLmluZGV4T2YodGhpcy5maWx0ZXJLZXlXb3JkKSA+IC0xO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBjbG9uZURlZXAodGhpcy5vcmlnaW5hbERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXN0RmlsdGVyKCkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyS2V5V29yZCA9ICcnO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlRGF0YVNvdXJjZSgpO1xyXG4gICAgICAgIHRoaXMuY2hlY2tBbGwoKTtcclxuICAgICAgICB0aGlzLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuY2hrYWxsLm5hdGl2ZUVsZW1lbnQuaW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
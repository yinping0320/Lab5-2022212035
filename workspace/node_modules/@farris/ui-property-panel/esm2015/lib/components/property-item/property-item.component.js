/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ComponentFactoryResolver, Injector, ElementRef } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { NotifyService } from '@farris/ui-notify';
import { PropertyEntity } from '../../entity/property-entity';
export class PropertyItemComponent {
    /**
     * @param {?} resolver
     * @param {?} modalService
     * @param {?} injector
     * @param {?} notifyServ
     * @param {?} el
     */
    constructor(resolver, modalService, injector, notifyServ, el) {
        this.resolver = resolver;
        this.modalService = modalService;
        this.injector = injector;
        this.notifyServ = notifyServ;
        this.el = el;
        this.valueChanged = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.triggerRefreshPanel = new EventEmitter(); // 向上触发整体面板刷新
        // 模态框类型的属性:属性框的展示值
        this.selectOptions = [];
        this.itemType = 'string';
        this.show = true;
        this.numberRestriction = {
            format: 'n2',
            min: '',
            max: ''
        };
        this.showClearButton = false;
        this.showDefaultValue = false;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.refresh();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.refresh();
    }
    /**
     * @return {?}
     */
    refresh() {
        // 是否显示，visible默认true
        if (Object.keys(this.elementConfig).indexOf('visible') < 0) {
            this.show = true;
        }
        else {
            this.show = this.elementConfig.visible;
        }
        // 显示格式
        /** @type {?} */
        const propertyType = this.itemType = this.elementConfig.propertyType;
        switch (propertyType) {
            case 'boolean': {
                this.itemType = 'select';
                this.selectOptions = [{ key: true, value: true }, { key: false, value: false }];
                break;
            }
            case 'select': {
                this.selectOptions = this.elementConfig.iterator;
                break;
            }
            case 'modal': {
                this._convertModalShowValue(this.elementValue);
                break;
            }
            case 'number': {
                // precision待优化为'n2'的格式，与kendo保持一致
                /** @type {?} */
                const precision = this.elementConfig.precision;
                if (precision !== undefined && precision > -1) {
                    this.numberRestriction.format = 'n' + precision;
                }
                // 支持传入kendo Numeric format格式 ：'n3' / 'p'
                if (this.elementConfig.numberFormat) {
                    this.numberRestriction.format = this.elementConfig.numberFormat;
                }
                // 设置最大、最小值
                this.numberRestriction.min = this.elementConfig.min;
                this.numberRestriction.max = this.elementConfig.max;
                break;
            }
            case 'string': {
                if (this.elementConfig.readonly) {
                    this._convertModalShowValue(this.elementValue);
                }
                break;
            }
            case 'boolOrExp': {
                this.selectOptions = [{ key: true, value: 'true' }, { key: false, value: 'false' }];
                break;
            }
        }
        // 默认值
        if (Object.keys(this.elementConfig).indexOf('defaultValue') > -1) {
            if (this.elementValue === undefined || this.elementValue === null) {
                this.elementValue = this.elementConfig.defaultValue;
            }
            this.showDefaultValue = true;
        }
    }
    /**
     * 鼠标移入
     * @return {?}
     */
    onmouseover() {
        if (!this.elementConfig.showClearButton) {
            return;
        }
        if (!this.showClearButton) {
            this.showClearButton = true;
        }
    }
    /**
     * 鼠标离开
     * @return {?}
     */
    onmouseleave() {
        if (!this.elementConfig.showClearButton) {
            return;
        }
        this.showClearButton = false;
    }
    /**
     * 清除模态框内容
     * @return {?}
     */
    modalClear() {
        // 数据转换
        this._convertModalShowValue(null);
        // 若有清除后事件，先执行方法
        if (Object.keys(this.elementConfig).indexOf('afterClickClearButton') > -1 &&
            typeof (this.elementConfig.afterClickClearButton) === 'function') {
            this.elementConfig.afterClickClearButton(this.elementValue);
        }
        /** @type {?} */
        const changeObject = {
            propertyID: this.elementConfig.propertyID,
            propertyValue: null
        };
        this.submitModal.emit({ changeObject, parameters: null });
    }
    /**
     * 变更属性值
     * @return {?}
     */
    changeValue() {
        /** @type {?} */
        let value = this.elementValue;
        if (this.itemType === 'multiSelect' && this.elementConfig.multiSelectDataType === 'array') {
            value = this.elementValue ? this.elementValue.split(',') : '';
        }
        /** @type {?} */
        const changeObject = {
            propertyID: this.elementConfig.propertyID,
            propertyValue: value
        };
        this.valueChanged.emit({ changeObject });
        if (this.elementConfig.refreshPanelAfterChanged) {
            this.triggerRefreshPanel.emit();
        }
    }
    /**
     * 自定义编辑器使用模态框打开
     * @return {?}
     */
    openModal() {
        if (this.elementConfig.readonly) {
            return;
        }
        if (Object.keys(this.elementConfig).indexOf('beforeOpenModal') > -1 && typeof (this.elementConfig.beforeOpenModal) === 'function') {
            /** @type {?} */
            const result = this.elementConfig.beforeOpenModal();
            if (result && !result.result) {
                this.notifyServ.warning((/** @type {?} */ ({
                    title: '系统提示', msg: result.message, timeout: 3000
                })));
                return;
            }
        }
        this.createEditorComponent();
    }
    /**
     * 创建自定义编辑器
     * @private
     * @return {?}
     */
    createEditorComponent() {
        /** @type {?} */
        const editor = this.elementConfig.editor;
        if (!editor) {
            return;
        }
        // 创建模态框组件
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(editor);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.value = this.elementValue;
        if (this.elementConfig.editorParams && compRef.instance.editorParams) { // 编辑器需要的额外参数
            compRef.instance.editorParams = this.elementConfig.editorParams;
        }
        /** @type {?} */
        let modalConfig = compRef.instance.modalConfig;
        if (!modalConfig) {
            modalConfig = {
                title: '属性配置',
                width: 800,
                height: 400,
                showButtons: false
            };
        }
        else if (modalConfig.showButtons) {
            modalConfig.buttons = compRef.instance.modalFooter;
        }
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        // 监听关闭模态框
        if (compRef.instance.closeModal && compRef.instance.closeModal instanceof EventEmitter) {
            compRef.instance.closeModal.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                // 数据转换
                if (data) {
                    this._convertModalShowValue(data);
                    /** @type {?} */
                    const changeObject = {
                        propertyID: this.elementConfig.propertyID,
                        propertyValue: data
                    };
                    this.valueChanged.emit({ changeObject });
                }
                dialog.close();
            }));
        }
        // 弹出框关闭事件，带参数，格式为{ value, parameters }
        if (compRef.instance.submitModal && compRef.instance.submitModal instanceof EventEmitter) {
            compRef.instance.submitModal.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                if (!data) {
                    dialog.close();
                    return;
                }
                const { value, parameters } = data;
                // 数据转换
                this._convertModalShowValue(value);
                /** @type {?} */
                const changeObject = {
                    propertyID: this.elementConfig.propertyID,
                    propertyValue: value
                };
                this.submitModal.emit({ changeObject, parameters });
                dialog.close();
            }));
        }
    }
    /**
     * 模态框场景下将属性值转换为输入框中显示的值
     * @private
     * @param {?} value
     * @return {?}
     */
    _convertModalShowValue(value) {
        if (this.elementConfig.converter) {
            this.elementShowValue = this.elementConfig.converter.convertTo(value);
            return;
        }
        if (value && value instanceof Object) {
            this.elementShowValue = JSON.stringify(value);
            return;
        }
        this.elementShowValue = value;
    }
}
PropertyItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'webide-property-item',
                template: "<div class=\"farris-group-wrap property-item\" [style.display]=\"show?'block':'none'\">\r\n  <div class=\"form-group farris-form-group\">\r\n    <label class=\"col-form-label\" farrisPopover [popover]=\"popTemplate\" [popoverTitle]=\"elementConfig.propertyName\"\r\n      container=\"body\" [triggers]=\"'hover'\">\r\n      <span class=\"farris-label-text\">{{elementConfig.propertyName}}</span>\r\n    </label>\r\n    <!-- <label class=\"col-form-label\"> \r\n    <span class=\"farris-label-text\">{{elementConfig.propertyName}}</span>\r\n    </label>-->\r\n    <div class=\"farris-input-wrap\" *ngIf=\"itemType=='string'\">\r\n      <input type=\"input\" class=\"form-control form-control-sm\" [(ngModel)]=\"elementValue\" (blur)=\"changeValue()\"\r\n        [readonly]=\"elementConfig.readonly?'readonly':''\">\r\n    </div>\r\n    <div class=\"farris-input-wrap\" *ngIf=\"itemType=='number'\">\r\n      <kendo-numerictextbox class=\"form-control form-control-sm\" [(ngModel)]=\"elementValue\"\r\n        [format]=\"numberRestriction.format\" [min]=\"numberRestriction.min\" [max]=\"numberRestriction.max\"\r\n        [readonly]=\"elementConfig.readonly?true:false\" [autoCorrect]=\"true\" [decimals]=\"elementConfig.decimals\"\r\n        (blur)=\"changeValue()\">\r\n      </kendo-numerictextbox>\r\n    </div>\r\n    <div class=\"farris-input-wrap\" *ngIf=\"itemType=='select'\">\r\n      <kendo-dropdownlist class=\"form-control form-control-sm\" [data]=\"selectOptions\" textField=\"value\" valueField=\"key\"\r\n        [valuePrimitive]=\"true\" [(ngModel)]=\"elementValue\" (valueChange)=\"changeValue()\"\r\n        [readonly]=\"elementConfig.readonly?true:false\">\r\n      </kendo-dropdownlist>\r\n    </div>\r\n    <div class=\"farris-input-wrap\" *ngIf=\"itemType=='date'\">\r\n      <kendo-datepicker class=\"form-control form-control-sm\" [(ngModel)]=\"elementValue\"\r\n        [readonly]=\"elementConfig.readonly?true:false\" [format]=\"'yyyy-MM-dd'\" (valueChange)=\"changeValue()\">\r\n      </kendo-datepicker>\r\n    </div>\r\n    <div class=\"farris-input-wrap\" *ngIf=\"itemType=='datetime'\">\r\n      <kendo-dateinput class=\"form-control form-control-sm\" [(ngModel)]=\"elementValue\"\r\n        [readonly]=\"elementConfig.readonly?true:false\" [format]=\"elementConfig.format||'yyyy-MM-dd HH:mm:ss'\"\r\n        (valueChange)=\"changeValue()\"></kendo-dateinput>\r\n    </div>\r\n    <div class=\"farris-input-wrap modalIcon\" *ngIf=\"itemType=='modal'\" (mouseover)=\"onmouseover()\"\r\n      (mouseleave)=\"onmouseleave()\">\r\n      <input type=\"input\" class=\"form-control form-control-sm\" [(ngModel)]=\"elementShowValue\" readonly>\r\n      <span *ngIf=\"showClearButton && !elementConfig.readonly\" class=\" \" (click)=\"modalClear()\">\r\n        <!-- <i class=\"f-icon modal_close\"></i> -->\r\n        <i class=\"material-icons clearIcon\">close</i>\r\n      </span>\r\n      <!-- <i class=\"fa fa-clone\" (click)=\"openModal()\"></i> -->\r\n      <i class=\"material-icons moreIcon\" (click)=\"openModal()\">filter_none</i>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<ng-template #popTemplate>\r\n  <div *ngIf=\"elementConfig.propertyID\">\r\n    <span>\u5C5E\u6027\u7F16\u53F7\uFF1A </span> {{elementConfig.propertyID}}</div>\r\n  <div *ngIf=\"elementConfig.propertyName\">\r\n    <span>\u5C5E\u6027\u540D\u79F0\uFF1A </span> {{elementConfig.propertyName}}</div>\r\n  <div *ngIf=\"elementConfig.description\">\r\n    <span>\u63CF\u8FF0\uFF1A </span> {{elementConfig.description}}</div>\r\n  <div *ngIf=\"showDefaultValue\">\r\n    <span>\u9ED8\u8BA4\u503C\uFF1A </span> {{elementConfig.defaultValue}}</div>\r\n</ng-template>",
                styles: [".property-item .form-group{margin-bottom:2px}.property-item .modalIcon input{padding-right:30px}.property-item .modalIcon .moreIcon{position:absolute;top:6px;right:6px;cursor:pointer;font-size:16px;color:#758a96}.property-item .modalIcon .clearIcon{position:absolute;top:5px;right:30px;cursor:pointer;font-size:19px;color:#758a96}.property-item .form-control[readonly]{background-color:#fff}.property-item .form-control:disabled,.property-item .form-control[readonly]{color:#4b4c4c}"]
            }] }
];
/** @nocollapse */
PropertyItemComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: BsModalService },
    { type: Injector },
    { type: NotifyService },
    { type: ElementRef }
];
PropertyItemComponent.propDecorators = {
    elementConfig: [{ type: Input }],
    elementValue: [{ type: Input }],
    valueChanged: [{ type: Output }],
    submitModal: [{ type: Output }],
    triggerRefreshPanel: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    PropertyItemComponent.prototype.elementConfig;
    /** @type {?} */
    PropertyItemComponent.prototype.elementValue;
    /** @type {?} */
    PropertyItemComponent.prototype.valueChanged;
    /** @type {?} */
    PropertyItemComponent.prototype.submitModal;
    /** @type {?} */
    PropertyItemComponent.prototype.triggerRefreshPanel;
    /** @type {?} */
    PropertyItemComponent.prototype.elementShowValue;
    /** @type {?} */
    PropertyItemComponent.prototype.selectOptions;
    /** @type {?} */
    PropertyItemComponent.prototype.itemType;
    /** @type {?} */
    PropertyItemComponent.prototype.show;
    /** @type {?} */
    PropertyItemComponent.prototype.numberRestriction;
    /** @type {?} */
    PropertyItemComponent.prototype.showClearButton;
    /** @type {?} */
    PropertyItemComponent.prototype.showDefaultValue;
    /**
     * @type {?}
     * @private
     */
    PropertyItemComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    PropertyItemComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    PropertyItemComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    PropertyItemComponent.prototype.notifyServ;
    /** @type {?} */
    PropertyItemComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktaXRlbS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXByb3BlcnR5LXBhbmVsLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcHJvcGVydHktaXRlbS9wcm9wZXJ0eS1pdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUNoQyxZQUFZLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFDN0QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxhQUFhLEVBQWlCLE1BQU0sbUJBQW1CLENBQUM7QUFFakUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBTzlELE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7O0lBb0JoQyxZQUNVLFFBQWtDLEVBQ2xDLFlBQTRCLEVBQzVCLFFBQWtCLEVBQVUsVUFBeUIsRUFBUyxFQUFjO1FBRjVFLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGlCQUFZLEdBQVosWUFBWSxDQUFnQjtRQUM1QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBZTtRQUFTLE9BQUUsR0FBRixFQUFFLENBQVk7UUFwQjVFLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdEMsd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQyxDQUFDLGFBQWE7O1FBR3RFLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ25CLGFBQVEsR0FBRyxRQUFRLENBQUM7UUFDcEIsU0FBSSxHQUFHLElBQUksQ0FBQztRQUVaLHNCQUFpQixHQUFHO1lBQ2xCLE1BQU0sRUFBRSxJQUFJO1lBQ1osR0FB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NkNBQW9DOzs7OztJQUNwQyx5Q0FBMEI7Ozs7O0lBQUUsMkNBQWlDOztJQUFFLG1DQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyxcclxuICBFdmVudEVtaXR0ZXIsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIEVsZW1lbnRSZWZcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSwgTm90aWZ5T3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuXHJcbmltcG9ydCB7IFByb3BlcnR5RW50aXR5IH0gZnJvbSAnLi4vLi4vZW50aXR5L3Byb3BlcnR5LWVudGl0eSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dlYmlkZS1wcm9wZXJ0eS1pdGVtJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcHJvcGVydHktaXRlbS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcHJvcGVydHktaXRlbS5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFByb3BlcnR5SXRlbUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKSBlbGVtZW50Q29uZmlnOiBQcm9wZXJ0eUVudGl0eTtcclxuICBASW5wdXQoKSBlbGVtZW50VmFsdWU6IGFueTtcclxuICBAT3V0cHV0KCkgdmFsdWVDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHRyaWdnZXJSZWZyZXNoUGFuZWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTsgLy8g5ZCR5LiK6Kem5Y+R5pW05L2T6Z2i5p2/5Yi35pawXHJcblxyXG4gIGVsZW1lbnRTaG93VmFsdWU6IGFueTsgLy8g5qih5oCB5qGG57G75Z6L55qE5bGe5oCnOuWxnuaAp+ahhueahOWxleekuuWAvFxyXG4gIHNlbGVjdE9wdGlvbnMgPSBbXTtcclxuICBpdGVtVHlwZSA9ICdzdHJpbmcnO1xyXG4gIHNob3cgPSB0cnVlO1xyXG5cclxuICBudW1iZXJSZXN0cmljdGlvbiA9IHtcclxuICAgIGZvcm1hdDogJ24yJyxcclxuICAgIG1pbjogJycsXHJcbiAgICBtYXg6ICcnXHJcbiAgfTtcclxuICBzaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuICBzaG93RGVmYXVsdFZhbHVlID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgbm90aWZ5U2VydjogTm90aWZ5U2VydmljZSwgcHVibGljIGVsOiBFbGVtZW50UmVmKSB7IH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgdGhpcy5yZWZyZXNoKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gIH1cclxuXHJcbiAgcmVmcmVzaCgpIHtcclxuICAgIC8vIOaYr+WQpuaYvuekuu+8jHZpc2libGXpu5jorqR0cnVlXHJcbiAgICBpZiAoT2JqZWN0LmtleXModGhpcy5lbGVtZW50Q29uZmlnKS5pbmRleE9mKCd2aXNpYmxlJykgPCAwKSB7XHJcbiAgICAgIHRoaXMuc2hvdyA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNob3cgPSB0aGlzLmVsZW1lbnRDb25maWcudmlzaWJsZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8g5pi+56S65qC85byPXHJcbiAgICBjb25zdCBwcm9wZXJ0eVR5cGUgPSB0aGlzLml0ZW1UeXBlID0gdGhpcy5lbGVtZW50Q29uZmlnLnByb3BlcnR5VHlwZTtcclxuICAgIHN3aXRjaCAocHJvcGVydHlUeXBlKSB7XHJcbiAgICAgIGNhc2UgJ2Jvb2xlYW4nOiB7XHJcbiAgICAgICAgdGhpcy5pdGVtVHlwZSA9ICdzZWxlY3QnO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0T3B0aW9ucyA9IFt7IGtleTogdHJ1ZSwgdmFsdWU6IHRydWUgfSwgeyBrZXk6IGZhbHNlLCB2YWx1ZTogZmFsc2UgfV07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgY2FzZSAnc2VsZWN0Jzoge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0T3B0aW9ucyA9IHRoaXMuZWxlbWVudENvbmZpZy5pdGVyYXRvcjtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlICdtb2RhbCc6IHtcclxuICAgICAgICB0aGlzLl9jb252ZXJ0TW9kYWxTaG93VmFsdWUodGhpcy5lbGVtZW50VmFsdWUpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgJ251bWJlcic6IHtcclxuICAgICAgICAvLyBwcmVjaXNpb27lvoXkvJjljJbkuLonbjIn55qE5qC85byP77yM5LiOa2VuZG/kv53mjIHkuIDoh7RcclxuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLmVsZW1lbnRDb25maWcucHJlY2lzaW9uO1xyXG4gICAgICAgIGlmIChwcmVjaXNpb24gIT09IHVuZGVmaW5lZCAmJiBwcmVjaXNpb24gPiAtMSkge1xyXG4gICAgICAgICAgdGhpcy5udW1iZXJSZXN0cmljdGlvbi5mb3JtYXQgPSAnbicgKyBwcmVjaXNpb247XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDmlK/mjIHkvKDlhaVrZW5kbyBOdW1lcmljIGZvcm1hdOagvOW8jyDvvJonbjMnIC8gJ3AnXHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudENvbmZpZy5udW1iZXJGb3JtYXQpIHtcclxuICAgICAgICAgIHRoaXMubnVtYmVyUmVzdHJpY3Rpb24uZm9ybWF0ID0gdGhpcy5lbGVtZW50Q29uZmlnLm51bWJlckZvcm1hdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOiuvue9ruacgOWkp+OAgeacgOWwj+WAvFxyXG4gICAgICAgIHRoaXMubnVtYmVyUmVzdHJpY3Rpb24ubWluID0gdGhpcy5lbGVtZW50Q29uZmlnLm1pbjtcclxuICAgICAgICB0aGlzLm51bWJlclJlc3RyaWN0aW9uLm1heCA9IHRoaXMuZWxlbWVudENvbmZpZy5tYXg7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgY2FzZSAnc3RyaW5nJzoge1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRDb25maWcucmVhZG9ubHkpIHtcclxuICAgICAgICAgIHRoaXMuX2NvbnZlcnRNb2RhbFNob3dWYWx1ZSh0aGlzLmVsZW1lbnRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGNhc2UgJ2Jvb2xPckV4cCc6IHtcclxuICAgICAgICB0aGlzLnNlbGVjdE9wdGlvbnMgPSBbeyBrZXk6IHRydWUsIHZhbHVlOiAndHJ1ZScgfSwgeyBrZXk6IGZhbHNlLCB2YWx1ZTogJ2ZhbHNlJyB9XTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOm7mOiupOWAvFxyXG4gICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuZWxlbWVudENvbmZpZykuaW5kZXhPZignZGVmYXVsdFZhbHVlJykgPiAtMSkge1xyXG4gICAgICBpZiAodGhpcy5lbGVtZW50VmFsdWUgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmVsZW1lbnRWYWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudFZhbHVlID0gdGhpcy5lbGVtZW50Q29uZmlnLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNob3dEZWZhdWx0VmFsdWUgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOm8oOagh+enu+WFpVxyXG4gICAqL1xyXG4gIG9ubW91c2VvdmVyKCkge1xyXG4gICAgaWYgKCF0aGlzLmVsZW1lbnRDb25maWcuc2hvd0NsZWFyQnV0dG9uKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5zaG93Q2xlYXJCdXR0b24pIHtcclxuICAgICAgdGhpcy5zaG93Q2xlYXJCdXR0b24gPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6byg5qCH56a75byAXHJcbiAgICovXHJcbiAgb25tb3VzZWxlYXZlKCkge1xyXG4gICAgaWYgKCF0aGlzLmVsZW1lbnRDb25maWcuc2hvd0NsZWFyQnV0dG9uKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5riF6Zmk5qih5oCB5qGG5YaF5a65XHJcbiAgICovXHJcbiAgbW9kYWxDbGVhcigpIHtcclxuICAgIC8vIOaVsOaNrui9rOaNolxyXG4gICAgdGhpcy5fY29udmVydE1vZGFsU2hvd1ZhbHVlKG51bGwpO1xyXG5cclxuICAgIC8vIOiLpeaciea4hemZpOWQjuS6i+S7tu+8jOWFiOaJp+ihjOaWueazlVxyXG4gICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuZWxlbWVudENvbmZpZykuaW5kZXhPZignYWZ0ZXJDbGlja0NsZWFyQnV0dG9uJykgPiAtMSAmJlxyXG4gICAgICB0eXBlb2YgKHRoaXMuZWxlbWVudENvbmZpZy5hZnRlckNsaWNrQ2xlYXJCdXR0b24pID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuZWxlbWVudENvbmZpZy5hZnRlckNsaWNrQ2xlYXJCdXR0b24odGhpcy5lbGVtZW50VmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYW5nZU9iamVjdCA9IHtcclxuICAgICAgcHJvcGVydHlJRDogdGhpcy5lbGVtZW50Q29uZmlnLnByb3BlcnR5SUQsXHJcbiAgICAgIHByb3BlcnR5VmFsdWU6IG51bGxcclxuICAgIH07XHJcbiAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQoeyBjaGFuZ2VPYmplY3QsIHBhcmFtZXRlcnM6IG51bGwgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5jmm7TlsZ7mgKflgLxcclxuICAgKi9cclxuICBjaGFuZ2VWYWx1ZSgpIHtcclxuICAgIGxldCB2YWx1ZSA9IHRoaXMuZWxlbWVudFZhbHVlO1xyXG4gICAgaWYgKHRoaXMuaXRlbVR5cGUgPT09ICdtdWx0aVNlbGVjdCcgJiYgdGhpcy5lbGVtZW50Q29uZmlnLm11bHRpU2VsZWN0RGF0YVR5cGUgPT09ICdhcnJheScpIHtcclxuICAgICAgdmFsdWUgPSB0aGlzLmVsZW1lbnRWYWx1ZSA/IHRoaXMuZWxlbWVudFZhbHVlLnNwbGl0KCcsJykgOiAnJztcclxuICAgIH1cclxuICAgIGNvbnN0IGNoYW5nZU9iamVjdCA9IHtcclxuICAgICAgcHJvcGVydHlJRDogdGhpcy5lbGVtZW50Q29uZmlnLnByb3BlcnR5SUQsXHJcbiAgICAgIHByb3BlcnR5VmFsdWU6IHZhbHVlXHJcbiAgICB9O1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdCh7IGNoYW5nZU9iamVjdCB9KTtcclxuICAgIGlmICh0aGlzLmVsZW1lbnRDb25maWcucmVmcmVzaFBhbmVsQWZ0ZXJDaGFuZ2VkKSB7XHJcbiAgICAgIHRoaXMudHJpZ2dlclJlZnJlc2hQYW5lbC5lbWl0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDoh6rlrprkuYnnvJbovpHlmajkvb/nlKjmqKHmgIHmoYbmiZPlvIBcclxuICAgKi9cclxuICBvcGVuTW9kYWwoKSB7XHJcbiAgICBpZiAodGhpcy5lbGVtZW50Q29uZmlnLnJlYWRvbmx5KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmVsZW1lbnRDb25maWcpLmluZGV4T2YoJ2JlZm9yZU9wZW5Nb2RhbCcpID4gLTEgJiYgdHlwZW9mICh0aGlzLmVsZW1lbnRDb25maWcuYmVmb3JlT3Blbk1vZGFsKSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmVsZW1lbnRDb25maWcuYmVmb3JlT3Blbk1vZGFsKCk7XHJcbiAgICAgIGlmIChyZXN1bHQgJiYgIXJlc3VsdC5yZXN1bHQpIHtcclxuICAgICAgICB0aGlzLm5vdGlmeVNlcnYud2FybmluZyg8Tm90aWZ5T3B0aW9ucz57XHJcbiAgICAgICAgICB0aXRsZTogJ+ezu+e7n+aPkOekuicsIG1zZzogcmVzdWx0Lm1lc3NhZ2UsIHRpbWVvdXQ6IDMwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuY3JlYXRlRWRpdG9yQ29tcG9uZW50KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliJvlu7roh6rlrprkuYnnvJbovpHlmahcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZUVkaXRvckNvbXBvbmVudCgpIHtcclxuICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWxlbWVudENvbmZpZy5lZGl0b3I7XHJcbiAgICBpZiAoIWVkaXRvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyDliJvlu7rmqKHmgIHmoYbnu4Tku7ZcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShlZGl0b3IpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UudmFsdWUgPSB0aGlzLmVsZW1lbnRWYWx1ZTtcclxuICAgIGlmICh0aGlzLmVsZW1lbnRDb25maWcuZWRpdG9yUGFyYW1zICYmIGNvbXBSZWYuaW5zdGFuY2UuZWRpdG9yUGFyYW1zKSB7ICAvLyDnvJbovpHlmajpnIDopoHnmoTpop3lpJblj4LmlbBcclxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5lZGl0b3JQYXJhbXMgPSB0aGlzLmVsZW1lbnRDb25maWcuZWRpdG9yUGFyYW1zO1xyXG4gICAgfVxyXG4gICAgbGV0IG1vZGFsQ29uZmlnID0gY29tcFJlZi5pbnN0YW5jZS5tb2RhbENvbmZpZztcclxuICAgIGlmICghbW9kYWxDb25maWcpIHtcclxuICAgICAgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgICAgdGl0bGU6ICflsZ7mgKfphY3nva4nLFxyXG4gICAgICAgIHdpZHRoOiA4MDAsXHJcbiAgICAgICAgaGVpZ2h0OiA0MDAsXHJcbiAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlXHJcbiAgICAgIH07XHJcbiAgICB9IGVsc2UgaWYgKG1vZGFsQ29uZmlnLnNob3dCdXR0b25zKSB7XHJcbiAgICAgIG1vZGFsQ29uZmlnLmJ1dHRvbnMgPSBjb21wUmVmLmluc3RhbmNlLm1vZGFsRm9vdGVyO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG5cclxuICAgIC8vIOebkeWQrOWFs+mXreaooeaAgeahhlxyXG4gICAgaWYgKGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VNb2RhbCAmJiBjb21wUmVmLmluc3RhbmNlLmNsb3NlTW9kYWwgaW5zdGFuY2VvZiBFdmVudEVtaXR0ZXIpIHtcclxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgIC8vIOaVsOaNrui9rOaNolxyXG4gICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICB0aGlzLl9jb252ZXJ0TW9kYWxTaG93VmFsdWUoZGF0YSk7XHJcblxyXG4gICAgICAgICAgY29uc3QgY2hhbmdlT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUlEOiB0aGlzLmVsZW1lbnRDb25maWcucHJvcGVydHlJRCxcclxuICAgICAgICAgICAgcHJvcGVydHlWYWx1ZTogZGF0YVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHRoaXMudmFsdWVDaGFuZ2VkLmVtaXQoeyBjaGFuZ2VPYmplY3QgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgLy8g5by55Ye65qGG5YWz6Zet5LqL5Lu277yM5bim5Y+C5pWw77yM5qC85byP5Li6eyB2YWx1ZSwgcGFyYW1ldGVycyB9XHJcbiAgICBpZiAoY29tcFJlZi5pbnN0YW5jZS5zdWJtaXRNb2RhbCAmJiBjb21wUmVmLmluc3RhbmNlLnN1Ym1pdE1vZGFsIGluc3RhbmNlb2YgRXZlbnRFbWl0dGVyKSB7XHJcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2Uuc3VibWl0TW9kYWwuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIHBhcmFtZXRlcnMgfSA9IGRhdGE7XHJcbiAgICAgICAgLy8g5pWw5o2u6L2s5o2iXHJcbiAgICAgICAgdGhpcy5fY29udmVydE1vZGFsU2hvd1ZhbHVlKHZhbHVlKTtcclxuXHJcbiAgICAgICAgY29uc3QgY2hhbmdlT2JqZWN0ID0ge1xyXG4gICAgICAgICAgcHJvcGVydHlJRDogdGhpcy5lbGVtZW50Q29uZmlnLnByb3BlcnR5SUQsXHJcbiAgICAgICAgICBwcm9wZXJ0eVZhbHVlOiB2YWx1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KHsgY2hhbmdlT2JqZWN0LCBwYXJhbWV0ZXJzIH0pO1xyXG5cclxuICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qih5oCB5qGG5Zy65pmv5LiL5bCG5bGe5oCn5YC86L2s5o2i5Li66L6T5YWl5qGG5Lit5pi+56S655qE5YC8XHJcbiAgICogQHBhcmFtIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY29udmVydE1vZGFsU2hvd1ZhbHVlKHZhbHVlKSB7XHJcbiAgICBpZiAodGhpcy5lbGVtZW50Q29uZmlnLmNvbnZlcnRlcikge1xyXG4gICAgICB0aGlzLmVsZW1lbnRTaG93VmFsdWUgPSB0aGlzLmVsZW1lbnRDb25maWcuY29udmVydGVyLmNvbnZlcnRUbyh2YWx1ZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG4gICAgICB0aGlzLmVsZW1lbnRTaG93VmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuZWxlbWVudFNob3dWYWx1ZSA9IHZhbHVlO1xyXG4gIH1cclxufVxyXG4iXX0=
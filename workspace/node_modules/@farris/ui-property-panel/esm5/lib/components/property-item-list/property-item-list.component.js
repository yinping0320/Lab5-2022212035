/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChildren, ViewEncapsulation } from '@angular/core';
import { ElementPropertyConfig } from '../../entity/property-entity';
import { PropertyItemComponent } from '../property-item/property-item.component';
var PropertyItemListComponent = /** @class */ (function () {
    function PropertyItemListComponent() {
        // 属性值
        this.valueChanged = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.triggerRefreshPanel = new EventEmitter();
    }
    /**
     * @param {?} simpleChanges
     * @return {?}
     */
    PropertyItemListComponent.prototype.ngOnChanges = /**
     * @param {?} simpleChanges
     * @return {?}
     */
    function (simpleChanges) {
        // 若分类下有propertyData，则取分类下的propertyData；否则取整体的propertyData
        if (this.category.propertyData && this.category.enableCascade) {
            this.data = this.category.propertyData;
        }
        else {
            this.data = this.propertyData;
        }
    };
    /**
     * @return {?}
     */
    PropertyItemListComponent.prototype.refresh = /**
     * @return {?}
     */
    function () {
        // 若分类下有propertyData，则取分类下的propertyData；否则取整体的propertyData
        if (this.category.propertyData && this.category.enableCascade) {
            this.data = this.category.propertyData;
        }
        else {
            this.data = this.propertyData;
        }
        this.items.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.refresh(); }));
    };
    /**
     * 一般属性变更
     * @param $event
     */
    /**
     * 一般属性变更
     * @param {?} $event
     * @return {?}
     */
    PropertyItemListComponent.prototype._itemChanged = /**
     * 一般属性变更
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var changeObject = $event.changeObject;
        this.data[changeObject.propertyID] = changeObject.propertyValue;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.refresh(); }));
        }
        changeObject.categoryId = this.category.categoryId;
        if (this.category.enableCascade) {
            changeObject.parentPropertyID = this.category.parentPropertyID;
        }
        this.valueChanged.emit(changeObject);
    };
    /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param $event
     */
    /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param {?} $event
     * @return {?}
     */
    PropertyItemListComponent.prototype._submitModal = /**
     * 模态框数据变更（TODO:待优化，合并valueChange事件）
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var changeObject = $event.changeObject, parameters = $event.parameters;
        this.data[changeObject.propertyID] = changeObject.propertyValue;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data, parameters);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.refresh(); }));
        }
        changeObject.categoryId = this.category.categoryId;
        if (this.category.enableCascade) {
            changeObject.parentPropertyID = this.category.parentPropertyID;
        }
        this.submitModal.emit($event);
    };
    /**
     * 级联属性变更
     * @param $event
     * @param parentPropertyID
     */
    /**
     * 级联属性变更
     * @param {?} $event
     * @param {?} parentPropertyID
     * @return {?}
     */
    PropertyItemListComponent.prototype._cascadeitemChanged = /**
     * 级联属性变更
     * @param {?} $event
     * @param {?} parentPropertyID
     * @return {?}
     */
    function ($event, parentPropertyID) {
        if (!parentPropertyID) {
            return;
        }
        var changeObject = $event.changeObject;
        if (!this.data[parentPropertyID]) {
            this.data[parentPropertyID] = {};
        }
        this.data[parentPropertyID][changeObject.propertyID] = changeObject.propertyValue;
        changeObject.categoryId = this.category.categoryId;
        changeObject.parentPropertyID = parentPropertyID;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.refresh(); }));
        }
        this.valueChanged.emit(changeObject);
    };
    /**
     * 级联模态框属性变更
     * @param $event
     * @param parentPropertyID
     */
    /**
     * 级联模态框属性变更
     * @param {?} $event
     * @param {?} parentPropertyID
     * @return {?}
     */
    PropertyItemListComponent.prototype.__cascadeitemSubmitModal = /**
     * 级联模态框属性变更
     * @param {?} $event
     * @param {?} parentPropertyID
     * @return {?}
     */
    function ($event, parentPropertyID) {
        if (!parentPropertyID) {
            return;
        }
        var changeObject = $event.changeObject, parameters = $event.parameters;
        if (!this.data[parentPropertyID]) {
            this.data[parentPropertyID] = {};
        }
        this.data[parentPropertyID][changeObject.propertyID] = changeObject.propertyValue;
        changeObject.categoryId = this.category.categoryId;
        changeObject.parentPropertyID = parentPropertyID;
        if (this.category.setPropertyRelates && typeof (this.category.setPropertyRelates) === 'function') {
            this.category.setPropertyRelates(changeObject, this.data, parameters);
            this.items.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.refresh(); }));
        }
        this.submitModal.emit($event);
    };
    /**
     * 级联属性的汇总信息
     * @param propItem
     * @param valueObject
     */
    /**
     * 级联属性的汇总信息
     * @param {?} propItem
     * @param {?} valueObject
     * @return {?}
     */
    PropertyItemListComponent.prototype._valueStringify = /**
     * 级联属性的汇总信息
     * @param {?} propItem
     * @param {?} valueObject
     * @return {?}
     */
    function (propItem, valueObject) {
        if (!propItem || !propItem.cascadeConfig || !valueObject) {
            return '';
        }
        if (!propItem.cascadeConverter || !propItem.cascadeConverter.convertTo) {
            return JSON.stringify(valueObject);
        }
        return propItem.cascadeConverter.convertTo(valueObject, propItem.cascadeConfig);
    };
    /**
     * @param {?} propItem
     * @return {?}
     */
    PropertyItemListComponent.prototype._checkCascadeVisible = /**
     * @param {?} propItem
     * @return {?}
     */
    function (propItem) {
        if (Object.keys(propItem).indexOf('visible') < 0) {
            return true;
        }
        else {
            return propItem.visible;
        }
    };
    /**
     * @return {?}
     */
    PropertyItemListComponent.prototype.refreshPanel = /**
     * @return {?}
     */
    function () {
        this.triggerRefreshPanel.emit();
    };
    PropertyItemListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'webide-property-item-list',
                    template: "<div *ngFor=\"let propItem of category.properties\">\r\n    <div *ngIf=\"propItem.propertyType != 'cascade'\" class=\"px-2\">\r\n        <webide-property-item (valueChanged)=\"_itemChanged($event)\" (submitModal)=\"_submitModal($event)\"\r\n            [elementValue]=\"data[propItem.propertyID]\" [elementConfig]=\"propItem\"></webide-property-item>\r\n    </div>\r\n\r\n    <farris-panel *ngIf=\"propItem.propertyType == 'cascade' && _checkCascadeVisible(propItem)\"\r\n        [defaultExpand]=\"propItem.isExpand\">\r\n        <farris-panel-item class=\"propertyCascadeItem\" [value]=\"propItem.propertyID\">\r\n            <ng-template #headTempl>\r\n                <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label pl-2\">\r\n                        <span class=\"farris-label-text\">{{propItem.propertyName}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\" *ngIf=\"!propItem.hideCascadeTitle\">\r\n                        <input type=\"input\" class=\"form-control form-control-sm\" readonly\r\n                            [value]=\"_valueStringify(propItem,data[propItem.propertyID])\">\r\n                    </div>\r\n                </div>\r\n            </ng-template>\r\n            <ng-template #contentTempl>\r\n                <div *ngFor=\"let cascadeItem of propItem.cascadeConfig\" class=\"px-2\">\r\n                    <webide-property-item (valueChanged)=\"_cascadeitemChanged($event,propItem.propertyID)\"\r\n                        (submitModal)=\"__cascadeitemSubmitModal($event, propItem.propertyID)\"\r\n                        [elementValue]=\"data[propItem.propertyID]?data[propItem.propertyID][cascadeItem.propertyID]:''\"\r\n                        [elementConfig]=\"cascadeItem\" (triggerRefreshPanel)=\"refreshPanel()\"></webide-property-item>\r\n                </div>\r\n\r\n            </ng-template>\r\n        </farris-panel-item>\r\n    </farris-panel>\r\n\r\n\r\n</div>",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".propertyCascadeItem{background-color:transparent!important;border:none!important}.propertyCascadeItem .card-header{background-color:transparent!important;padding:4px 12px!important;color:inherit!important}.propertyCascadeItem .card-header .panel-item-title{width:100%;position:relative;font-size:inherit!important}.propertyCascadeItem .card-header .panel-item-title .farris-input-wrap{margin-left:-5px;margin-right:-5px}.propertyCascadeItem .f-accordion-collapse,.propertyCascadeItem .f-accordion-expand{right:0;left:auto!important;top:6px;color:#6b94ec!important;position:absolute}.propertyCascadeItem .card-body{padding:3px 12px!important;background:rgba(255,255,255,.8);border-radius:8px;margin:4px 8px}"]
                }] }
    ];
    /** @nocollapse */
    PropertyItemListComponent.ctorParameters = function () { return []; };
    PropertyItemListComponent.propDecorators = {
        category: [{ type: Input }],
        propertyData: [{ type: Input }],
        valueChanged: [{ type: Output }],
        submitModal: [{ type: Output }],
        triggerRefreshPanel: [{ type: Output }],
        items: [{ type: ViewChildren, args: [PropertyItemComponent,] }]
    };
    return PropertyItemListComponent;
}());
export { PropertyItemListComponent };
if (false) {
    /** @type {?} */
    PropertyItemListComponent.prototype.category;
    /** @type {?} */
    PropertyItemListComponent.prototype.propertyData;
    /** @type {?} */
    PropertyItemListComponent.prototype.valueChanged;
    /** @type {?} */
    PropertyItemListComponent.prototype.submitModal;
    /** @type {?} */
    PropertyItemListComponent.prototype.triggerRefreshPanel;
    /** @type {?} */
    PropertyItemListComponent.prototype.items;
    /** @type {?} */
    PropertyItemListComponent.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktaXRlbS1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktcHJvcGVydHktcGFuZWwvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wcm9wZXJ0eS1pdGVtLWxpc3QvcHJvcGVydHktaXRlbS1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQTRCLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFJLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBRWpGO0lBaUJFOztRQVBVLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN2QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFDdEMsd0JBQW1CLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQUt4QyxDQUFDOzs7OztJQUVqQiwrQ0FBVzs7OztJQUFYLFVBQVksYUFBNEI7UUFDdEMsMERBQTBEO1FBQzFELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUU7WUFDN0QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQztTQUN4QzthQUFNO1lBQ0wsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQzs7OztJQUNELDJDQUFPOzs7SUFBUDtRQUNFLDBEQUEwRDtRQUMxRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFO1lBQzdELElBQUksQ0FBQyxJQUFJLEdB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R0QsZ0RBQVk7OztJQUFaO1FBQ0UsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2xDLENBQUM7O2dCQTdKRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLDJCQUEyQjtvQkFDckMsZytEQUFrRDtvQkFFbEQsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7O2lCQUV0Qzs7Ozs7MkJBRUUsS0FBSzsrQkFDTCxLQUFLOytCQUNMLE1BQU07OEJBQ04sTUFBTTtzQ0FDTixNQUFNO3dCQUVOLFlBQVksU0FBQyxxQkFBcUI7O0lBZ0pyQyxnQ0FBQztDQUFBLEFBOUpELElBOEpDO1NBdkpZLHlCQUF5Qjs7O0lBQ3BDLDZDQUF5Qzs7SUFDekMsaURBQXNCOztJQUN0QixpREFBaUQ7O0lBQ2pELGdEQUFnRDs7SUFDaEQsd0RBQXdEOztJQUV4RCwwQ0FBeUU7O0lBRXpFLHlDQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkcmVuLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZyB9IGZyb20gJy4uLy4uL2VudGl0eS9wcm9wZXJ0eS1lbnRpdHknO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUl0ZW1Db21wb25lbnQgfSBmcm9tICcuLi9wcm9wZXJ0eS1pdGVtL3Byb3BlcnR5LWl0ZW0uY29tcG9uZW50JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnd2ViaWRlLXByb3BlcnR5LWl0ZW0tbGlzdCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3Byb3BlcnR5LWl0ZW0tbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcHJvcGVydHktaXRlbS1saXN0LmNvbXBvbmVudC5jc3MnXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcblxyXG59KVxyXG5leHBvcnQgY2xhc3MgUHJvcGVydHlJdGVtTGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XHJcbiAgQElucHV0KCkgY2F0ZWdvcnk6IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZzsgLy8g5p+Q5LiA5YiG57G75LiL55qE5bGe5oCn6YWN572uXHJcbiAgQElucHV0KCkgcHJvcGVydHlEYXRhOyAvLyDlsZ7mgKflgLxcclxuICBAT3V0cHV0KCkgdmFsdWVDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHRyaWdnZXJSZWZyZXNoUGFuZWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgQFZpZXdDaGlsZHJlbihQcm9wZXJ0eUl0ZW1Db21wb25lbnQpIGl0ZW1zOiBBcnJheTxQcm9wZXJ0eUl0ZW1Db21wb25lbnQ+O1xyXG5cclxuICBkYXRhOyAvLyDlrp7pmYXlsZ7mgKflgLxcclxuICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhzaW1wbGVDaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAvLyDoi6XliIbnsbvkuIvmnIlwcm9wZXJ0eURhdGHvvIzliJnlj5bliIbnsbvkuIvnmoRwcm9wZXJ0eURhdGHvvJvlkKbliJnlj5bmlbTkvZPnmoRwcm9wZXJ0eURhdGFcclxuICAgIGlmICh0aGlzLmNhdGVnb3J5LnByb3BlcnR5RGF0YSAmJiB0aGlzLmNhdGVnb3J5LmVuYWJsZUNhc2NhZGUpIHtcclxuICAgICAgdGhpcy5kYXRhID0gdGhpcy5jYXRlZ29yeS5wcm9wZXJ0eURhdGE7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRhdGEgPSB0aGlzLnByb3BlcnR5RGF0YTtcclxuICAgIH1cclxuICB9XHJcbiAgcmVmcmVzaCgpIHtcclxuICAgIC8vIOiLpeWIhuexu+S4i+aciXByb3BlcnR5RGF0Ye+8jOWImeWPluWIhuexu+S4i+eahHByb3BlcnR5RGF0Ye+8m+WQpuWImeWPluaVtOS9k+eahHByb3BlcnR5RGF0YVxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkucHJvcGVydHlEYXRhICYmIHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICB0aGlzLmRhdGEgPSB0aGlzLmNhdGVnb3J5LnByb3BlcnR5RGF0YTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZGF0YSA9IHRoaXMucHJvcGVydHlEYXRhO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5LiA6Iis5bGe5oCn5Y+Y5pu0XHJcbiAgICogQHBhcmFtICRldmVudFxyXG4gICAqL1xyXG4gIF9pdGVtQ2hhbmdlZCgkZXZlbnQpIHtcclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0IH0gPSAkZXZlbnQ7XHJcbiAgICB0aGlzLmRhdGFbY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuZW5hYmxlQ2FzY2FkZSkge1xyXG4gICAgICBjaGFuZ2VPYmplY3QucGFyZW50UHJvcGVydHlJRCA9IHRoaXMuY2F0ZWdvcnkucGFyZW50UHJvcGVydHlJRDtcclxuICAgIH1cclxuICAgIHRoaXMudmFsdWVDaGFuZ2VkLmVtaXQoY2hhbmdlT2JqZWN0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaooeaAgeahhuaVsOaNruWPmOabtO+8iFRPRE865b6F5LyY5YyW77yM5ZCI5bm2dmFsdWVDaGFuZ2Xkuovku7bvvIlcclxuICAgKiBAcGFyYW0gJGV2ZW50XHJcbiAgICovXHJcbiAgX3N1Ym1pdE1vZGFsKCRldmVudCkge1xyXG4gICAgY29uc3QgeyBjaGFuZ2VPYmplY3QsIHBhcmFtZXRlcnMgfSA9ICRldmVudDtcclxuICAgIHRoaXMuZGF0YVtjaGFuZ2VPYmplY3QucHJvcGVydHlJRF0gPSBjaGFuZ2VPYmplY3QucHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICBpZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMgJiYgdHlwZW9mICh0aGlzLmNhdGVnb3J5LnNldFByb3BlcnR5UmVsYXRlcykgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMoY2hhbmdlT2JqZWN0LCB0aGlzLmRhdGEsIHBhcmFtZXRlcnMpO1xyXG4gICAgICB0aGlzLml0ZW1zLmZvckVhY2goaXRlbSA9PiBpdGVtLnJlZnJlc2goKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcbiAgICBpZiAodGhpcy5jYXRlZ29yeS5lbmFibGVDYXNjYWRlKSB7XHJcbiAgICAgIGNoYW5nZU9iamVjdC5wYXJlbnRQcm9wZXJ0eUlEID0gdGhpcy5jYXRlZ29yeS5wYXJlbnRQcm9wZXJ0eUlEO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KCRldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnuqfogZTlsZ7mgKflj5jmm7RcclxuICAgKiBAcGFyYW0gJGV2ZW50XHJcbiAgICogQHBhcmFtIHBhcmVudFByb3BlcnR5SURcclxuICAgKi9cclxuICBfY2FzY2FkZWl0ZW1DaGFuZ2VkKCRldmVudCwgcGFyZW50UHJvcGVydHlJRCkge1xyXG4gICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUlEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0IH0gPSAkZXZlbnQ7XHJcbiAgICBpZiAoIXRoaXMuZGF0YVtwYXJlbnRQcm9wZXJ0eUlEXSkge1xyXG4gICAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF1bY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcbiAgICBjaGFuZ2VPYmplY3QucGFyZW50UHJvcGVydHlJRCA9IHBhcmVudFByb3BlcnR5SUQ7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdChjaGFuZ2VPYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57qn6IGU5qih5oCB5qGG5bGe5oCn5Y+Y5pu0XHJcbiAgICogQHBhcmFtICRldmVudFxyXG4gICAqIEBwYXJhbSBwYXJlbnRQcm9wZXJ0eUlEXHJcbiAgICovXHJcbiAgX19jYXNjYWRlaXRlbVN1Ym1pdE1vZGFsKCRldmVudCwgcGFyZW50UHJvcGVydHlJRCkge1xyXG4gICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUlEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgY2hhbmdlT2JqZWN0LCBwYXJhbWV0ZXJzIH0gPSAkZXZlbnQ7XHJcbiAgICBpZiAoIXRoaXMuZGF0YVtwYXJlbnRQcm9wZXJ0eUlEXSkge1xyXG4gICAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF0gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGFbcGFyZW50UHJvcGVydHlJRF1bY2hhbmdlT2JqZWN0LnByb3BlcnR5SURdID0gY2hhbmdlT2JqZWN0LnByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgY2hhbmdlT2JqZWN0LmNhdGVnb3J5SWQgPSB0aGlzLmNhdGVnb3J5LmNhdGVnb3J5SWQ7XHJcbiAgICBjaGFuZ2VPYmplY3QucGFyZW50UHJvcGVydHlJRCA9IHBhcmVudFByb3BlcnR5SUQ7XHJcblxyXG4gICAgaWYgKHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzICYmIHR5cGVvZiAodGhpcy5jYXRlZ29yeS5zZXRQcm9wZXJ0eVJlbGF0ZXMpID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuY2F0ZWdvcnkuc2V0UHJvcGVydHlSZWxhdGVzKGNoYW5nZU9iamVjdCwgdGhpcy5kYXRhLCBwYXJhbWV0ZXJzKTtcclxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5yZWZyZXNoKCkpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KCRldmVudCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOe6p+iBlOWxnuaAp+eahOaxh+aAu+S/oeaBr1xyXG4gICAqIEBwYXJhbSBwcm9wSXRlbVxyXG4gICAqIEBwYXJhbSB2YWx1ZU9iamVjdFxyXG4gICAqL1xyXG4gIF92YWx1ZVN0cmluZ2lmeShwcm9wSXRlbSwgdmFsdWVPYmplY3QpIHtcclxuICAgIGlmICghcHJvcEl0ZW0gfHwgIXByb3BJdGVtLmNhc2NhZGVDb25maWcgfHwgIXZhbHVlT2JqZWN0KSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIGlmICghcHJvcEl0ZW0uY2FzY2FkZUNvbnZlcnRlciB8fCAhcHJvcEl0ZW0uY2FzY2FkZUNvbnZlcnRlci5jb252ZXJ0VG8pIHtcclxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlT2JqZWN0KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcHJvcEl0ZW0uY2FzY2FkZUNvbnZlcnRlci5jb252ZXJ0VG8odmFsdWVPYmplY3QsIHByb3BJdGVtLmNhc2NhZGVDb25maWcpO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuICBfY2hlY2tDYXNjYWRlVmlzaWJsZShwcm9wSXRlbSkge1xyXG4gICAgaWYgKE9iamVjdC5rZXlzKHByb3BJdGVtKS5pbmRleE9mKCd2aXNpYmxlJykgPCAwKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHByb3BJdGVtLnZpc2libGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgcmVmcmVzaFBhbmVsKCkge1xyXG4gICAgdGhpcy50cmlnZ2VyUmVmcmVzaFBhbmVsLmVtaXQoKTtcclxuICB9XHJcbn1cclxuIl19
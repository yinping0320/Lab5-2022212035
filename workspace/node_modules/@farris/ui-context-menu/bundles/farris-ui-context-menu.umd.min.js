!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/core"),require("@farris/ui-common"),require("@angular/common")):"function"==typeof define&&define.amd?define("@farris/ui-context-menu",["exports","rxjs","@angular/core","@farris/ui-common","@angular/common"],t):t(((e=e||self).farris=e.farris||{},e.farris["ui-context-menu"]={}),e.rxjs,e.ng.core,e.uiCommon,e.ng.common)}(this,function(e,t,n,i,o){"use strict";var r=function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};var s=function(){function e(e,n){this.cfr=e,this.injector=n,this.overlayEle=null,this.contextMenuDom=null,this.contextMenuRefs={},this.activeDom=null,this.showContextMenu=new t.Subject,this.overlayHideSer=this.injector.get(i.OverLayHiddenService,null),this.overlayHideSer||(this.overlayHideSer=new i.OverLayHiddenService)}return e.prototype.createOverlay=function(e,t){var n=this,i=document.querySelector(".f-context-menu-overlay");return i||((i=document.createElement("div")).classList.add("f-context-menu-overlay",e),i.style.pointerEvents="none",document.body.appendChild(i),t.highlight&&(this.activeDom=document.createElement("div"),this.activeDom.classList.add("f-context-target-focus"),i.appendChild(this.activeDom)),i.addEventListener("click",function(e){e.target.className.indexOf("f-context-menu-overlay")>-1&&n.hide()}),i.addEventListener("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),n.hide()})),i},e.prototype.show=function(e){var t=this,n=e.menuItems,i=e.event,o=e.id,r=e.activeDom,s=e.context,c=e.menuClass,l=e.target,u=e.activeWidth,p=null;if(this.contextMenuRefs||(this.contextMenuRefs={}),this.contextMenuRefs[o])p=this.contextMenuRefs[o];else{var h=this.cfr.resolveComponentFactory(a);(p=h.create(this.injector)).instance.menuItems=n,p.instance.id=o,p.instance.left=i.pageX,p.instance.top=i.pageY,this.contextMenuDom=r,this.contextMenuRefs[p.instance.id]=p}if(p.instance.context=s,this.overlayEle=this.createOverlay(c,e),this.overlayEle.appendChild(p.location.nativeElement),this.overlayHideSer.registerMouseEvent(this.overlayEle,function(e){p.location.nativeElement.contains(e.target)||t.hide()}),this.activeDom){var f=u||this.contextMenuDom.offsetWidth;this.activeDom.style.width=f+"px",this.activeDom.style.height=this.contextMenuDom.offsetHeight+"px",this.activeDom.style.left=l.getBoundingClientRect().left+"px",this.activeDom.style.top=this.contextMenuDom.getBoundingClientRect().top+"px",this.activeDom.style.display="block"}p.changeDetectorRef.detectChanges();var m=p.instance.menuPanel.nativeElement,d=m.offsetHeight;window.innerHeight-i.pageY<d&&(p.instance.top=i.pageY-d),window.innerWidth-i.pageX<m.offsetWidth&&(p.instance.left=i.pageX-m.offsetWidth),p.changeDetectorRef.detectChanges()},e.prototype.hide=function(){var e,t;if(this.overlayEle){if(this.overlayEle.style.display="none",this.contextMenuRefs){try{for(var n=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(Object.keys(this.contextMenuRefs)),i=n.next();!i.done;i=n.next()){var o=i.value;this.contextMenuRefs[o].hostView.destroy()}}catch(r){e={error:r}}finally{try{i&&!i.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.contextMenuRefs=null}this.contextMenuDom&&(this.contextMenuDom.className=this.contextMenuDom.className.replace("f-context-menu-active","")),this.overlayHideSer.destory(this.overlayEle),this.overlayEle.remove()}this.activeDom=null,this.overlayEle=null},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:n.ComponentFactoryResolver},{type:n.Injector}]},e}(),a=function(){function e(e,t,n,i,o,r){this.injector=e,this.ngzone=t,this.render=n,this.ctxMenuSer=i,this.elRef=o,this.cd=r}return e.prototype.ngOnInit=function(){},e.prototype.ngOnChanges=function(e){},e.prototype.onMenuItemClick=function(e,t){e.stopPropagation(),t.disable||t.children&&t.children.length||(this.ctxMenuSer.hide(),t.handle&&t.handle(r({},this.context||{},{instance:this,menu:t})))},e.prototype.onMouseEnter=function(e,t){if(t.children&&t.children.length){var n=this.subMenus.find(function(e){return e.elRef.nativeElement.id===t.id+"_submenu"});if(n){n.parent=this;var i=n.menuPanel.nativeElement,o=this.menuPanel.nativeElement,r=window.innerWidth-o.offsetLeft-o.offsetWidth;if(i.offsetWidth>r){var s=-o.offsetWidth;i.style.left=s+"px"}if(window.innerHeight-i.getBoundingClientRect().top<i.offsetHeight){var a=window.innerHeight-o.offsetTop-i.offsetHeight-10;i.style.top=a+"px"}}}},e.decorators=[{type:n.Component,args:[{selector:"farris-menus",template:'\r\n<div class="f-context-menu-panel" tabindex="0" [style.left.px]="left" [style.top.px]="top" #menuPanel style="pointer-events: auto">\r\n\r\n    <ul class="menu-list">\r\n        <li class="menu-item d-flex" *ngFor="let item of menuItems; index as i;last as islast;first as isfirst" (click)="onMenuItemClick($event, item)" \r\n        [class.menu-sep]="item === \'-\'" (mouseenter)="onMouseEnter($event, item)"\r\n        [class.disabled]="item.disable" #menuitemli>\r\n            <ng-container *ngIf="item !== \'-\' ">\r\n                <div class="menu-item-icon">\r\n                    <span class="f-icon {{ item.icon }}" *ngIf="item.icon"></span>\r\n                </div>\r\n                <div class="menu-item-text f-utils-fill d-flex">\r\n                    <span style="display: block" class="f-utils-fill">{{ item.title }}</span>\r\n                    <span class="arrow-right" *ngIf="item.children && item.children.length">\r\n                        <span class="f-icon f-icon-arrow-e"></span>\r\n                    </span>\r\n                </div>\r\n                <farris-menus #childMenu [context]="context" [attr.id]="item.id+ \'_submenu\'" *ngIf="item.children && item.children.length" [menuItems]="item.children"\r\n                    [top]="menuitemli.offsetTop - 3" [left]="menuPanel.offsetWidth - 5"\r\n                ></farris-menus>\r\n            </ng-container>\r\n        </li>\r\n    </ul>\r\n\r\n</div>\r\n',encapsulation:n.ViewEncapsulation.None,exportAs:"contextMenuRef",styles:["\n    .f-context-menu-overlay {\n        position: fixed;\n        z-index: 9999;\n        top: 0;\n        left: 0;\n        height: 100%;\n        width: 100%;\n    }\n    .f-context-menu-panel {\n        position: absolute;\n        top: 200px;\n        left: 300px;\n        background: #fff;\n        border: 1px solid #c6c6c6;\n        border-radius: 5px;\n        box-shadow: 3px 3px 5px #b8b4b4;\n        padding: 3px 0px;\n        min-width: 180px;\n        max-width: 290px;\n    }\n\n    .f-context-menu-panel .menu-list {\n        list-style: none;\n    }\n\n    .f-context-menu-panel .menu-item {\n        height: 28px;\n        line-height: 28px;\n        cursor: pointer;\n    }\n\n    .f-context-menu-panel .menu-item.disabled {\n        opacity: 0.4;\n        cursor: default;\n    }\n\n    .f-context-menu-panel .menu-item.menu-sep{\n        height: 6px;\n        border-top: 1px solid #ccc;\n        border-bottom: 1px solid #fff;\n        margin-top: 5px;\n    }\n\n    .f-context-menu-panel .menu-item.active,\n    .f-context-menu-panel .menu-item:hover:not(.menu-sep) {\n        background: #e4e7ef;\n    }\n    .f-context-menu-panel .menu-item .f-context-menu-panel  {\n        display: none;\n    }\n\n    .f-context-menu-panel .menu-item:hover  .f-context-menu-panel {\n        display: block;\n    }\n\n    .f-context-menu-panel .menu-item-icon {\n        width: 40px;\n        text-align: center;\n        font-size: 18px;\n    }\n\n    .f-context-target-focus {\n        position: relative;\n        top: 100px;\n        left: 0;\n        border: 1px dashed;\n        height: 29px;\n        display: none;\n        background: #a1c8fb;\n        opacity: 0.2;\n    }\n\n    .f-context-menu-panel .menu-item-text .arrow-right {\n        width: 32px; height: 100%;display:block; text-align: center;\n    }\n        "]}]}],e.ctorParameters=function(){return[{type:n.Injector},{type:n.NgZone},{type:n.Renderer2},{type:s,decorators:[{type:n.Optional}]},{type:n.ElementRef},{type:n.ChangeDetectorRef}]},e.propDecorators={menuItems:[{type:n.Input}],left:[{type:n.Input}],top:[{type:n.Input}],context:[{type:n.Input}],menuPanel:[{type:n.ViewChild,args:["menuPanel"]}],subMenus:[{type:n.ViewChildren,args:[e]}]},e}(),c=function(){function e(e,t,n,i){this.ctxMenuSer=e,this.injector=t,this.elRef=n,this.render=i,this.disabled=!1,this.highlight=!0}return e.prototype.ngOnInit=function(){this.id=this.contextMenuId(),this.beforeShowContextMenu||(this.beforeShowContextMenu=function(){return t.of(!0)})},e.prototype.onContextMenu=function(e){var t=this;if(!this.disabled){var n=null;if(this.activeDomName){if(!(n=e.target.closest(this.activeDomName)))return;this.render.addClass(n,"f-context-menu-active")}var i=this.beforeShowContextMenu({event:e,contextMenuDom:n});i&&i.subscribe&&i.subscribe(function(i){var o=t.getContextData(i);t.removeSurplusMenus(),o.show&&(document.body.click(),t.ctxMenuSer.show({menuItems:t.getViewMenuItems(o.data),event:e,id:t.id,activeDom:n,context:o.data,menuClass:t.menuClass,target:t.elRef.nativeElement,activeWidth:i.focusTargetWidth,highlight:t.highlight}),e.preventDefault(),e.stopPropagation())})}},e.prototype.removeSurplusMenus=function(){this.menuItems&&this.menuItems.length&&this.menuItems.forEach(function(e){"-"!==e&&e.children&&e.children.length&&e.children.forEach(function(e){"-"!==e&&(e.children=[])})})},e.prototype.contextMenuId=function(){var e=this.elRef.nativeElement.id;return e?e+"-context-menu":"context-menu_"+(new Date).getTime()},e.prototype.getContextData=function(e){return"boolean"==typeof e?{show:e,data:null}:e},e.prototype.getViewMenuItems=function(e){return this.menuItems&&this.menuItems.length?this.checkMenuItems(this.menuItems,e):[]},e.prototype.checkMenuItems=function(e,t){var n=this,i=e.map(function(e){if("string"==typeof e)return e;var i=n.checkVisibleAndDisable(e,t);return i.children&&(i.children=n.checkMenuItems(i.children,t)),i}).filter(function(e){return"-"===e||e.visible});return i&&i.length&&("-"===i[0]&&i.shift(0),"-"===i[i.length-1]&&i.pop(0)),i},e.prototype.checkVisibleAndDisable=function(e,t){var n=r({},e);return n.hasOwnProperty("visible")?"function"==typeof n.visible&&(n.visible=n.visible(t)):n.visible=!0,n.hasOwnProperty("disable")?"function"==typeof n.disable&&(n.disable=n.disable(t)):n.disable=!1,n},e.decorators=[{type:n.Directive,args:[{selector:"[farris-context-menus]"}]}],e.ctorParameters=function(){return[{type:s,decorators:[{type:n.Optional}]},{type:n.Injector},{type:n.ElementRef},{type:n.Renderer2}]},e.propDecorators={menuItems:[{type:n.Input,args:["farris-context-menus"]}],menuClass:[{type:n.Input}],disabled:[{type:n.Input}],context:[{type:n.Input}],beforeShowContextMenu:[{type:n.Input}],activeDomName:[{type:n.Input}],highlight:[{type:n.Input}],onContextMenu:[{type:n.HostListener,args:["contextmenu",["$event"]]}]},e}(),l=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{declarations:[a,c],imports:[o.CommonModule,i.FarrisCommonModule],exports:[a,c],entryComponents:[a],providers:[s]}]}],e}();e.FarrisContextMenuComponent=a,e.FarrisContextMenuDirective=c,e.FarrisContextMenuModule=l,e.FarrisContextMenuService=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-context-menu.umd.min.js.map
/**
 * @fileoverview added by tsickle
 * Generated from: lib/session/bef_session_storage_strategy.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: Witt
 * @Date: 2018-10-11 20:32:02
 * @Last Modified by: Witt
 * @Last Modified time: 2020-03-03 16:46:39
 */
/**
 * BeSession缓存
 * @record
 */
function BeSessionStorageStrategy() { }
if (false) {
    /**
     * @param {?} beSessionKey
     * @return {?}
     */
    BeSessionStorageStrategy.prototype.getItem = function (beSessionKey) { };
    /**
     * @param {?} beSessionKey
     * @param {?} beSessionid
     * @return {?}
     */
    BeSessionStorageStrategy.prototype.setItem = function (beSessionKey, beSessionid) { };
    /**
     * @param {?} beSessionKey
     * @return {?}
     */
    BeSessionStorageStrategy.prototype.removeItem = function (beSessionKey) { };
    /**
     * @param {?} frmSessionId
     * @param {?} beSessionKey
     * @return {?}
     */
    BeSessionStorageStrategy.prototype.clear = function (frmSessionId, beSessionKey) { };
}
/**
 * 基于浏览器SessionStorage的BeSession缓存
 * \@summary
 * 1、SeparatedSession模式下：
 *  {
 *    BE_SESSION_ID: {
 *      frmSessionId1_beSessionUri1: beSessionId-1,
 *      frmSessionId2_beSessionUri2: beSessionId-2,
 *    }
 *  }
 * 2、UnifiedSession模式下（在Debug状态，同模式1）：
 * {
 *    BE_SESSION_ID: {
 *      frmSessionId1: beSessionId-1,
 *      frmSessionId2: beSessionId-2,
 *    }
 *  }
 */
class SessionStorageBeSessionStorageStrategy {
    constructor() {
        /**
         * 缓存Token
         */
        this.sessionStorageKey = 'BE_SESSION_ID';
    }
    /**
     * 获取值
     * @param {?} beSessionKey
     * @return {?}
     */
    getItem(beSessionKey) {
        /** @type {?} */
        const beSessions = this.getAllBeSessions();
        return beSessions[beSessionKey];
    }
    /**
     * 设置值
     * @param {?} beSessionKey
     * @param {?} beSessionId
     * @return {?}
     */
    setItem(beSessionKey, beSessionId) {
        /** @type {?} */
        const beSessions = this.getAllBeSessions();
        beSessions[beSessionKey] = beSessionId;
        this.setAllBeSessions(beSessions);
    }
    /**
     * 删除值
     * @param {?} beSessionKey
     * @return {?}
     */
    removeItem(beSessionKey) {
        /** @type {?} */
        const beSessions = this.getAllBeSessions();
        if (beSessions[beSessionKey]) {
            delete beSessions[beSessionKey];
        }
        this.setAllBeSessions(beSessions);
    }
    /**
     * 清空同一个父Session下所有的缓存
     * \@summary
     * 框架内：清空功能菜单token下的所有BeSession缓存；
     * 框架外：只清空当前beSessionUri的，框架外，用的是用户Sessionid，无法统一清理。
     * @param {?} frmSessionId
     * @param {?} beSessionUri
     * @return {?}
     */
    clear(frmSessionId, beSessionUri) {
        /** @type {?} */
        const isInFramework = this.isInFramework();
        if (isInFramework === true) {
            this.removeItemsByFrmSessionId(frmSessionId);
        }
        else {
            this.removeItem(beSessionUri);
        }
    }
    /**
     * 清空frmSessionId对应的所有子BeSessionId
     * @private
     * @param {?} frmSessionId
     * @return {?}
     */
    removeItemsByFrmSessionId(frmSessionId) {
        /** @type {?} */
        const beSessions = this.getAllBeSessions();
        Object.keys(beSessions).forEach((/**
         * @param {?} beSessionKey
         * @return {?}
         */
        (beSessionKey) => {
            if (beSessionKey.startsWith(frmSessionId) === true) {
                delete beSessions[beSessionKey];
            }
        }));
        this.setAllBeSessions(beSessions);
    }
    /**
     * 从SessionStorage中获取全部BeSessions
     * @private
     * @return {?}
     */
    getAllBeSessions() {
        /** @type {?} */
        const beSessionsJson = window.sessionStorage.getItem(this.sessionStorageKey);
        if (!beSessionsJson) {
            return {};
        }
        return JSON.parse(beSessionsJson);
    }
    /**
     * 设置全部BeSessions到SessionStorage
     * @param {?} beSessions
     * @return {?}
     */
    setAllBeSessions(beSessions) {
        /** @type {?} */
        const beSessionsString = JSON.stringify(beSessions);
        window.sessionStorage.setItem(this.sessionStorageKey, beSessionsString);
    }
    /**
     * 是否在框架内
     * @private
     * @return {?}
     */
    isInFramework() {
        /** @type {?} */
        const hashString = window.location.hash;
        if (!hashString) {
            return false;
        }
        // todo: 不能直接依赖url中的参数，运行框架已经提供相关的获取参数的方法，应该通过运行框架服务获取
        return hashString.indexOf('tabId=') !== -1;
    }
}
if (false) {
    /**
     * 缓存Token
     * @type {?}
     * @private
     */
    SessionStorageBeSessionStorageStrategy.prototype.sessionStorageKey;
}
export { SessionStorageBeSessionStorageStrategy };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX3Nlc3Npb25fc3RvcmFnZV9zdHJhdGVneS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvYmVmLyIsInNvdXJjZXMiOlsibGliL3Nlc3Npb24vYmVmX3Nlc3Npb25fc3RvcmFnZV9zdHJhdGVneS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFVQSx1Q0FLQzs7Ozs7O0lBSkMseUVBQXNDOzs7Ozs7SUFDdEMsc0ZBQXlEOzs7OztJQUN6RCw0RUFBdUM7Ozs7OztJQUN2QyxxRkFBd0Q7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUIxRCxNQUFNLHNDQUFzQztJQUE1Qzs7OztRQUtVLHNCQUFpQixHQUFHLGVBQWUsQ0FBQztJQXNGOUMsQ0FBQzs7Ozs7O0lBakZRLE9BQU8sQ0FBQyxZQUFvQjs7Y0FDM0IsVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtRQUMxQyxPQUFPLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNsQyxDQUFDOzs7Ozs7O0lBS00sT0FBTyxDQUFDLFlBQW9CLEVBQUUsV0FBbUI7O2NBQ2hELFVBQVUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7UUFDMUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxHQUFHLFdBQVcsQ0FBQztRQUN2QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEMsQ0FBQzs7Ozs7O0lBS00sVUFBVSxDQUFDLFlBQW9COztjQUM5QixVQUFVLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1FBQzFDLElBQUksVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQzVCLE9BQU8sVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ2pDO1FBQ0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Ozs7Ozs7Ozs7SUFPTSxLQUFLLENBQUMsWUFBb0IsRUFBRSxZQUFvQjs7Y0FDL0MsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUU7UUFDMUMsSUFBSSxhQUFhLEtBQUssSUFBSSxFQUFFO1lBQzFCLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUM5QzthQUFNO1lBQ0wsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUMvQjtJQUNILENBQUM7Ozs7Ozs7SUFLTyx5QkFBeUIsQ0FBQyxZQUFvQjs7Y0FDOUMsVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtRQUMxQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLFlBQW9CLEVBQUUsRUFBRTtZQUN2RCxJQUFJLFlBQVksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLEtBQUssSUFBSSxFQUFFO2dCQUNsRCxPQUFPLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUNqQztRQUNILENBQUMsRUFBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Ozs7OztJQUlPLGdCQUFnQjs7Y0FDaEIsY0FBYyxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztRQUM1RSxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ25CLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFDRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDcEMsQ0FBQzs7Ozs7O0lBS0QsZ0JBQWdCLENBQUMsVUFBZTs7Y0FDeEIsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7UUFDbkQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDMUUsQ0FBQzs7Ozs7O0lBSU8sYUFBYTs7Y0FDYixVQUFVLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJO1FBQ3ZDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDZixPQUFPLEtBQUssQ0FBQztTQUNkO1FBQ0Qsc0RBQXNEO1FBQ3RELE9BQU8sVUFBVSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0NBRUY7Ozs7Ozs7SUF0RkMsbUVBQTRDOztBQXdGOUMsT0FBTyxFQUE0QixzQ0FBc0MsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogV2l0dFxyXG4gKiBARGF0ZTogMjAxOC0xMC0xMSAyMDozMjowMlxyXG4gKiBATGFzdCBNb2RpZmllZCBieTogV2l0dFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDIwLTAzLTAzIDE2OjQ2OjM5XHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIEJlU2Vzc2lvbue8k+WtmFxyXG4gKi9cclxuaW50ZXJmYWNlIEJlU2Vzc2lvblN0b3JhZ2VTdHJhdGVneSB7XHJcbiAgZ2V0SXRlbShiZVNlc3Npb25LZXk6IHN0cmluZyk6IHN0cmluZztcclxuICBzZXRJdGVtKGJlU2Vzc2lvbktleTogc3RyaW5nLCBiZVNlc3Npb25pZDogc3RyaW5nKTogdm9pZDtcclxuICByZW1vdmVJdGVtKGJlU2Vzc2lvbktleTogc3RyaW5nKTogdm9pZDtcclxuICBjbGVhcihmcm1TZXNzaW9uSWQ6IHN0cmluZywgYmVTZXNzaW9uS2V5OiBzdHJpbmcpOiB2b2lkO1xyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqO5rWP6KeI5ZmoU2Vzc2lvblN0b3JhZ2XnmoRCZVNlc3Npb27nvJPlrZhcclxuICogQHN1bW1hcnlcclxuICogMeOAgVNlcGFyYXRlZFNlc3Npb27mqKHlvI/kuIvvvJpcclxuICogIHtcclxuICogICAgQkVfU0VTU0lPTl9JRDoge1xyXG4gKiAgICAgIGZybVNlc3Npb25JZDFfYmVTZXNzaW9uVXJpMTogYmVTZXNzaW9uSWQtMSxcclxuICogICAgICBmcm1TZXNzaW9uSWQyX2JlU2Vzc2lvblVyaTI6IGJlU2Vzc2lvbklkLTIsXHJcbiAqICAgIH1cclxuICogIH1cclxuICogMuOAgVVuaWZpZWRTZXNzaW9u5qih5byP5LiL77yI5ZyoRGVidWfnirbmgIHvvIzlkIzmqKHlvI8x77yJ77yaXHJcbiAqIHtcclxuICogICAgQkVfU0VTU0lPTl9JRDoge1xyXG4gKiAgICAgIGZybVNlc3Npb25JZDE6IGJlU2Vzc2lvbklkLTEsXHJcbiAqICAgICAgZnJtU2Vzc2lvbklkMjogYmVTZXNzaW9uSWQtMixcclxuICogICAgfVxyXG4gKiAgfVxyXG4gKi9cclxuY2xhc3MgU2Vzc2lvblN0b3JhZ2VCZVNlc3Npb25TdG9yYWdlU3RyYXRlZ3kgaW1wbGVtZW50cyBCZVNlc3Npb25TdG9yYWdlU3RyYXRlZ3kge1xyXG5cclxuICAvKipcclxuICAgKiDnvJPlrZhUb2tlblxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2Vzc2lvblN0b3JhZ2VLZXkgPSAnQkVfU0VTU0lPTl9JRCc7XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRJdGVtKGJlU2Vzc2lvbktleTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGJlU2Vzc2lvbnMgPSB0aGlzLmdldEFsbEJlU2Vzc2lvbnMoKTtcclxuICAgIHJldHVybiBiZVNlc3Npb25zW2JlU2Vzc2lvbktleV07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7lgLxcclxuICAgKi9cclxuICBwdWJsaWMgc2V0SXRlbShiZVNlc3Npb25LZXk6IHN0cmluZywgYmVTZXNzaW9uSWQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgYmVTZXNzaW9ucyA9IHRoaXMuZ2V0QWxsQmVTZXNzaW9ucygpO1xyXG4gICAgYmVTZXNzaW9uc1tiZVNlc3Npb25LZXldID0gYmVTZXNzaW9uSWQ7XHJcbiAgICB0aGlzLnNldEFsbEJlU2Vzc2lvbnMoYmVTZXNzaW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTlgLxcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlSXRlbShiZVNlc3Npb25LZXk6IHN0cmluZykge1xyXG4gICAgY29uc3QgYmVTZXNzaW9ucyA9IHRoaXMuZ2V0QWxsQmVTZXNzaW9ucygpO1xyXG4gICAgaWYgKGJlU2Vzc2lvbnNbYmVTZXNzaW9uS2V5XSkge1xyXG4gICAgICBkZWxldGUgYmVTZXNzaW9uc1tiZVNlc3Npb25LZXldO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRBbGxCZVNlc3Npb25zKGJlU2Vzc2lvbnMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmuIXnqbrlkIzkuIDkuKrniLZTZXNzaW9u5LiL5omA5pyJ55qE57yT5a2YXHJcbiAgICogQHN1bW1hcnlcclxuICAgKiDmoYbmnrblhoXvvJrmuIXnqbrlip/og73oj5zljZV0b2tlbuS4i+eahOaJgOaciUJlU2Vzc2lvbue8k+WtmO+8m1xyXG4gICAqIOahhuaetuWklu+8muWPqua4heepuuW9k+WJjWJlU2Vzc2lvblVyaeeahO+8jOahhuaetuWklu+8jOeUqOeahOaYr+eUqOaIt1Nlc3Npb25pZO+8jOaXoOazlee7n+S4gOa4heeQhuOAglxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhcihmcm1TZXNzaW9uSWQ6IHN0cmluZywgYmVTZXNzaW9uVXJpOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IGlzSW5GcmFtZXdvcmsgPSB0aGlzLmlzSW5GcmFtZXdvcmsoKTtcclxuICAgIGlmIChpc0luRnJhbWV3b3JrID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMucmVtb3ZlSXRlbXNCeUZybVNlc3Npb25JZChmcm1TZXNzaW9uSWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZW1vdmVJdGVtKGJlU2Vzc2lvblVyaSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmuIXnqbpmcm1TZXNzaW9uSWTlr7nlupTnmoTmiYDmnInlrZBCZVNlc3Npb25JZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVtb3ZlSXRlbXNCeUZybVNlc3Npb25JZChmcm1TZXNzaW9uSWQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgYmVTZXNzaW9ucyA9IHRoaXMuZ2V0QWxsQmVTZXNzaW9ucygpO1xyXG4gICAgT2JqZWN0LmtleXMoYmVTZXNzaW9ucykuZm9yRWFjaCgoYmVTZXNzaW9uS2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKGJlU2Vzc2lvbktleS5zdGFydHNXaXRoKGZybVNlc3Npb25JZCkgPT09IHRydWUpIHtcclxuICAgICAgICBkZWxldGUgYmVTZXNzaW9uc1tiZVNlc3Npb25LZXldO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc2V0QWxsQmVTZXNzaW9ucyhiZVNlc3Npb25zKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuOU2Vzc2lvblN0b3JhZ2XkuK3ojrflj5blhajpg6hCZVNlc3Npb25zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRBbGxCZVNlc3Npb25zKCk6IGFueSB7XHJcbiAgICBjb25zdCBiZVNlc3Npb25zSnNvbiA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHRoaXMuc2Vzc2lvblN0b3JhZ2VLZXkpO1xyXG4gICAgaWYgKCFiZVNlc3Npb25zSnNvbikge1xyXG4gICAgICByZXR1cm4ge307XHJcbiAgICB9XHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShiZVNlc3Npb25zSnNvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7lhajpg6hCZVNlc3Npb25z5YiwU2Vzc2lvblN0b3JhZ2VcclxuICAgKi9cclxuICBzZXRBbGxCZVNlc3Npb25zKGJlU2Vzc2lvbnM6IGFueSk6IHZvaWQge1xyXG4gICAgY29uc3QgYmVTZXNzaW9uc1N0cmluZyA9IEpTT04uc3RyaW5naWZ5KGJlU2Vzc2lvbnMpO1xyXG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0odGhpcy5zZXNzaW9uU3RvcmFnZUtleSwgYmVTZXNzaW9uc1N0cmluZyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWcqOahhuaetuWGhVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNJbkZyYW1ld29yaygpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGhhc2hTdHJpbmcgPSB3aW5kb3cubG9jYXRpb24uaGFzaDtcclxuICAgIGlmICghaGFzaFN0cmluZykge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvLyB0b2RvOiDkuI3og73nm7TmjqXkvp3otZZ1cmzkuK3nmoTlj4LmlbDvvIzov5DooYzmoYbmnrblt7Lnu4/mj5Dkvpvnm7jlhbPnmoTojrflj5blj4LmlbDnmoTmlrnms5XvvIzlupTor6XpgJrov4fov5DooYzmoYbmnrbmnI3liqHojrflj5ZcclxuICAgIHJldHVybiBoYXNoU3RyaW5nLmluZGV4T2YoJ3RhYklkPScpICE9PSAtMTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBCZVNlc3Npb25TdG9yYWdlU3RyYXRlZ3ksIFNlc3Npb25TdG9yYWdlQmVTZXNzaW9uU3RvcmFnZVN0cmF0ZWd5IH07XHJcblxyXG4iXX0=
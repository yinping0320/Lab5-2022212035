/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_data_path_util.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BindingPropertyType, PropertyUtil, BindingPathConverter } from '@farris/devkit';
/**
 * Bef数据中各种Path的转换
 */
class BefDataPathUtil {
    /**
     * 转换成路径数组
     * 返回结果：
     * 主表（/）：[ parentId ]
     * 从表（/childCodes）：[ parentId, childCodes, childId ]
     * 从从表（/childCodes/grandCodes）： [ parentId, childCode, childId, grandCode, grandId ]
     * @param {?} bindingPath
     * @param {?} bindingData
     * @return {?}
     */
    static convertToPathArray(bindingPath, bindingData) {
        /** @type {?} */
        const bindingPathArray = BindingPathConverter.toBindingPathArray(bindingPath);
        /** @type {?} */
        const pathArray = [];
        /** @type {?} */
        let currentBindingObject = bindingData.list.currentItem;
        pathArray.push(currentBindingObject.primaryKeyValue);
        bindingPathArray.forEach((/**
         * @param {?} propName
         * @return {?}
         */
        (propName) => {
            /** @type {?} */
            const propInfo = PropertyUtil.getPropertyByName(currentBindingObject.properties, propName);
            if (propInfo.type !== BindingPropertyType.List) {
                throw new Error(`${propInfo.name}不是子表对应的属性`);
            }
            /** @type {?} */
            const currentBindingList = currentBindingObject[propName];
            currentBindingObject = currentBindingList.currentItem;
            pathArray.push(this.trimTrailingS(propName));
            pathArray.push(currentBindingObject.primaryKeyValue);
        }));
        return pathArray;
    }
    /**
     * 转换为RestUrl里的路径
     *
     * 返回结果：
     * 主表（/）：/
     * 从表（/jiwtEdus）：/xxx/jiwtEdu
     * 从从表（/jiwtEdus/jiwtGrades）： /xxx/jiwtEdu/xxx/jiwtGrade
     * @param {?} bindingPath
     * @param {?} bindingData
     * @return {?}
     */
    static convertToPathUrl(bindingPath, bindingData) {
        /** @type {?} */
        const pathArray = this.convertToPathArray(bindingPath, bindingData);
        pathArray.pop();
        return '/' + pathArray.join('/');
    }
    /**
     * 转换为表名数组
     * 返回结果：
     * 主表（/）：[]
     * 从表（/childCodes）：[ childCodes ]
     * 从从表（/childCodes/grandCodes [childCode ,grandCode]
     * @param {?} bindingPath
     * @param {?} bindingData
     * @return {?}
     */
    static convertToObjectCodes(bindingPath, bindingData) {
        /** @type {?} */
        const pathArray = this.convertToPathArray(bindingPath, bindingData);
        /** @type {?} */
        const pathLen = pathArray.length;
        /** @type {?} */
        const objectCodes = [];
        for (let i = 1; i < pathLen; i = i + 2) {
            objectCodes.push(pathArray[i]);
        }
        return objectCodes;
    }
    /**
     * 转换为id数组，包含最后一级的主键
     * 主表（/）：[ parentId ]
     * 从表（/childCodes）：[ parentId, childId ]
     * 从从表（/childCodes/grandCodes）： [ parentId, childId, grandId]
     * @param {?} bindingPath
     * @param {?} bindingData
     * @return {?}
     */
    static convertToDataIdsForUpdate(bindingPath, bindingData) {
        /** @type {?} */
        const pathArray = this.convertToPathArray(bindingPath, bindingData);
        /** @type {?} */
        const pathLen = pathArray.length;
        /** @type {?} */
        const dataIds = [];
        for (let i = 0; i < pathLen; i = i + 2) {
            dataIds.push(pathArray[i]);
        }
        return dataIds;
    }
    /**
     * 转换为id数组，不包含最后一级的主键
     * 主表（/）：[ ]
     * 从表（/childCodes）：[ parentId ]
     * 从从表（/childCodes/grandCodes）： [ parentId, childId]
     * @param {?} bindingPath
     * @param {?} bindingData
     * @return {?}
     */
    static convertToDataIdsForAdd(bindingPath, bindingData) {
        /** @type {?} */
        const dataIds = this.convertToDataIdsForUpdate(bindingPath, bindingData);
        dataIds.pop();
        return dataIds;
    }
    /**
     * 将EntityPathString转换为Url
     * @deprecated
     * @param {?} path
     * @return {?}
     */
    static convertPathToUrl(path) {
        /** @type {?} */
        const subPaths = path.split('/');
        for (let i = subPaths.length - 1; i > 0; i--) {
            if (subPaths[i] && subPaths[i].endsWith('s')) {
                subPaths[i] = subPaths[i].substr(0, subPaths[i].length - 1).toLowerCase();
            }
        }
        // url不再转小写，兼容主键有大写字母的情况
        return subPaths.join('/'); // .toLowerCase();
    }
    /**
     * 去除最后的s
     * @private
     * @param {?} str
     * @return {?}
     */
    static trimTrailingS(str) {
        return str.substr(0, str.length - 1);
    }
    /**
     * 转换通用路径为仅有表名的数组
     *
     * 1.['id:xxx','child1s','id:xx','prop'] => ['child1s','prop']
     * 2.['prop1','prop2','prop3'] => ['prop1','prop2','prop3']
     * 3.['prop1','id:xxx','prop2'] => ['prop1','prop2']
     * @param {?} paths 内置路径，格式:['id:xxx','child1s','id:xx','prop']
     * @return {?}
     */
    static convertPathsToNodeCodes(paths) {
        /** @type {?} */
        const result = [];
        if (!paths || paths.length < 1) {
            return result;
        }
        paths.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => !!item && item.indexOf(':') === -1)).forEach((/**
         * @param {?} node
         * @return {?}
         */
        node => {
            result.push(node);
        }));
        return result;
    }
    /**
     * 转换通用路径为仅有实体主键值的数组
     * @param {?} paths 通用路径，格式:['id:xxx','child1s','id:xx','prop'] => ['xxx','xx']
     * @return {?}
     */
    static convertPathsToIds(paths) {
        /** @type {?} */
        const result = [];
        if (!paths || paths.length < 1) {
            return result;
        }
        paths.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => !!item && item.indexOf(':') !== -1)).forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            result.push(id.split(':')[1]);
        }));
        return result;
    }
}
export { BefDataPathUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2RhdGFfcGF0aF91dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9iZWYvIiwic291cmNlcyI6WyJsaWIvYmVmX2RhdGFfcGF0aF91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNRLG1CQUFtQixFQUFFLFlBQVksRUFBRSxvQkFBb0IsRUFDckUsTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUt4QixNQUFNLGVBQWU7Ozs7Ozs7Ozs7O0lBU1osTUFBTSxDQUFDLGtCQUFrQixDQUFDLFdBQThCLEVBQUUsV0FBd0I7O2NBQ2pGLGdCQUFnQixHQUFhLG9CQUFvQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQzs7Y0FDakYsU0FBUyxHQUFhLEVBQUU7O1lBRTFCLG9CQUFvQixHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsV0FBVztRQUN2RCxTQUFTLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBRXJELGdCQUFnQixDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLFFBQWdCLEVBQUUsRUFBRTs7a0JBQ3RDLFFBQVEsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsb0JBQW9CLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQztZQUMxRixJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssbUJBQW1CLENBQUMsSUFBSSxFQUFFO2dCQUM5QyxNQUFNLElBQUksS0FBSyxDQUFDLEdBQUcsUUFBUSxDQUFDLElBQUksV0FBVyxDQUFDLENBQUM7YUFDOUM7O2tCQUNLLGtCQUFrQixHQUFHLG9CQUFvQixDQUFDLFFBQVEsQ0FBQztZQUN6RCxvQkFBb0IsR0FBRyxrQkFBa0IsQ0FBQyxXQUFXLENBQUM7WUFDdEQsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDN0MsU0FBUyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxlQUFlLENBQUMsQ0FB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QU0sR0FBRyxFQUFFO1FBQ2pCLElBQUksQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDOUIsT0FBTyxNQUFNLENBQUM7U0FDZjtRQUNELEtBQUssQ0FBQyxNQUFNOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUMsQ0FBQyxPQUFPOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdEUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Ozs7OztJQUtNLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxLQUFlOztjQUN2QyxNQUFNLEdBQUcsRUFBRTtRQUNqQixJQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzlCLE9BQU8sTUFBTSxDQUFDO1NBQ2Y7UUFDRCxLQUFLLENBQUMsTUFBTTs7OztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFDLENBQUMsT0FBTzs7OztRQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3BFLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLENBQUMsRUFBQyxDQUFDO1FBQ0gsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztDQUNGO0FBRUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBCaW5kaW5nRGF0YSwgQmluZGluZ1Byb3BlcnR5VHlwZSwgUHJvcGVydHlVdGlsLCBCaW5kaW5nUGF0aENvbnZlcnRlclxyXG59IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuXHJcbi8qKlxyXG4gKiBCZWbmlbDmja7kuK3lkITnp41QYXRo55qE6L2s5o2iXHJcbiAqL1xyXG5jbGFzcyBCZWZEYXRhUGF0aFV0aWwge1xyXG5cclxuICAvKipcclxuICAgKiDovazmjaLmiJDot6/lvoTmlbDnu4RcclxuICAgKiDov5Tlm57nu5PmnpzvvJpcclxuICAgKiDkuLvooajvvIgv77yJ77yaWyBwYXJlbnRJZCBdXHJcbiAgICog5LuO6KGo77yIL2NoaWxkQ29kZXPvvInvvJpbIHBhcmVudElkLCBjaGlsZENvZGVzLCBjaGlsZElkIF1cclxuICAgKiDku47ku47ooajvvIgvY2hpbGRDb2Rlcy9ncmFuZENvZGVz77yJ77yaIFsgcGFyZW50SWQsIGNoaWxkQ29kZSwgY2hpbGRJZCwgZ3JhbmRDb2RlLCBncmFuZElkIF1cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNvbnZlcnRUb1BhdGhBcnJheShiaW5kaW5nUGF0aDogc3RyaW5nIHwgc3RyaW5nW10sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoQXJyYXk6IHN0cmluZ1tdID0gQmluZGluZ1BhdGhDb252ZXJ0ZXIudG9CaW5kaW5nUGF0aEFycmF5KGJpbmRpbmdQYXRoKTtcclxuICAgIGNvbnN0IHBhdGhBcnJheTogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICBsZXQgY3VycmVudEJpbmRpbmdPYmplY3QgPSBiaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgcGF0aEFycmF5LnB1c2goY3VycmVudEJpbmRpbmdPYmplY3QucHJpbWFyeUtleVZhbHVlKTtcclxuXHJcbiAgICBiaW5kaW5nUGF0aEFycmF5LmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc3QgcHJvcEluZm8gPSBQcm9wZXJ0eVV0aWwuZ2V0UHJvcGVydHlCeU5hbWUoY3VycmVudEJpbmRpbmdPYmplY3QucHJvcGVydGllcywgcHJvcE5hbWUpO1xyXG4gICAgICBpZiAocHJvcEluZm8udHlwZSAhPT0gQmluZGluZ1Byb3BlcnR5VHlwZS5MaXN0KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3Byb3BJbmZvLm5hbWV95LiN5piv5a2Q6KGo5a+55bqU55qE5bGe5oCnYCk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY3VycmVudEJpbmRpbmdMaXN0ID0gY3VycmVudEJpbmRpbmdPYmplY3RbcHJvcE5hbWVdO1xyXG4gICAgICBjdXJyZW50QmluZGluZ09iamVjdCA9IGN1cnJlbnRCaW5kaW5nTGlzdC5jdXJyZW50SXRlbTtcclxuICAgICAgcGF0aEFycmF5LnB1c2godGhpcy50cmltVHJhaWxpbmdTKHByb3BOYW1lKSk7XHJcbiAgICAgIHBhdGhBcnJheS5wdXNoKGN1cnJlbnRCaW5kaW5nT2JqZWN0LnByaW1hcnlLZXlWYWx1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcGF0aEFycmF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6UmVzdFVybOmHjOeahOi3r+W+hFxyXG4gICAqXHJcbiAgICog6L+U5Zue57uT5p6c77yaXHJcbiAgICog5Li76KGo77yIL++8ie+8mi9cclxuICAgKiDku47ooajvvIgvaml3dEVkdXPvvInvvJoveHh4L2ppd3RFZHVcclxuICAgKiDku47ku47ooajvvIgvaml3dEVkdXMvaml3dEdyYWRlc++8ie+8miAveHh4L2ppd3RFZHUveHh4L2ppd3RHcmFkZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY29udmVydFRvUGF0aFVybChiaW5kaW5nUGF0aDogc3RyaW5nIHwgc3RyaW5nW10sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBwYXRoQXJyYXkgPSB0aGlzLmNvbnZlcnRUb1BhdGhBcnJheShiaW5kaW5nUGF0aCwgYmluZGluZ0RhdGEpO1xyXG4gICAgcGF0aEFycmF5LnBvcCgpO1xyXG4gICAgcmV0dXJuICcvJyArIHBhdGhBcnJheS5qb2luKCcvJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDovazmjaLkuLrooajlkI3mlbDnu4RcclxuICAgKiDov5Tlm57nu5PmnpzvvJpcclxuICAgKiDkuLvooajvvIgv77yJ77yaW11cclxuICAgKiDku47ooajvvIgvY2hpbGRDb2Rlc++8ie+8mlsgY2hpbGRDb2RlcyBdXHJcbiAgICog5LuO5LuO6KGo77yIL2NoaWxkQ29kZXMvZ3JhbmRDb2RlcyBbY2hpbGRDb2RlICxncmFuZENvZGVdXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjb252ZXJ0VG9PYmplY3RDb2RlcyhiaW5kaW5nUGF0aDogc3RyaW5nIHwgc3RyaW5nW10sIGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSkge1xyXG4gICAgY29uc3QgcGF0aEFycmF5ID0gdGhpcy5jb252ZXJ0VG9QYXRoQXJyYXkoYmluZGluZ1BhdGgsIGJpbmRpbmdEYXRhKTtcclxuICAgIGNvbnN0IHBhdGhMZW4gPSBwYXRoQXJyYXkubGVuZ3RoO1xyXG5cclxuICAgIGNvbnN0IG9iamVjdENvZGVzID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhdGhMZW47IGkgPSBpICsgMikge1xyXG4gICAgICBvYmplY3RDb2Rlcy5wdXNoKHBhdGhBcnJheVtpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9iamVjdENvZGVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6L2s5o2i5Li6aWTmlbDnu4TvvIzljIXlkKvmnIDlkI7kuIDnuqfnmoTkuLvplK5cclxuICAgKiDkuLvooajvvIgv77yJ77yaWyBwYXJlbnRJZCBdXHJcbiAgICog5LuO6KGo77yIL2NoaWxkQ29kZXPvvInvvJpbIHBhcmVudElkLCBjaGlsZElkIF1cclxuICAgKiDku47ku47ooajvvIgvY2hpbGRDb2Rlcy9ncmFuZENvZGVz77yJ77yaIFsgcGFyZW50SWQsIGNoaWxkSWQsIGdyYW5kSWRdXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjb252ZXJ0VG9EYXRhSWRzRm9yVXBkYXRlKGJpbmRpbmdQYXRoOiBzdHJpbmcgfCBzdHJpbmdbXSwgYmluZGluZ0RhdGE6IEJpbmRpbmdEYXRhKSB7XHJcbiAgICBjb25zdCBwYXRoQXJyYXkgPSB0aGlzLmNvbnZlcnRUb1BhdGhBcnJheShiaW5kaW5nUGF0aCwgYmluZGluZ0RhdGEpO1xyXG4gICAgY29uc3QgcGF0aExlbiA9IHBhdGhBcnJheS5sZW5ndGg7XHJcblxyXG4gICAgY29uc3QgZGF0YUlkcyA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXRoTGVuOyBpID0gaSArIDIpIHtcclxuICAgICAgZGF0YUlkcy5wdXNoKHBhdGhBcnJheVtpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRhdGFJZHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDovazmjaLkuLppZOaVsOe7hO+8jOS4jeWMheWQq+acgOWQjuS4gOe6p+eahOS4u+mUrlxyXG4gICAqIOS4u+ihqO+8iC/vvInvvJpbIF1cclxuICAgKiDku47ooajvvIgvY2hpbGRDb2Rlc++8ie+8mlsgcGFyZW50SWQgXVxyXG4gICAqIOS7juS7juihqO+8iC9jaGlsZENvZGVzL2dyYW5kQ29kZXPvvInvvJogWyBwYXJlbnRJZCwgY2hpbGRJZF1cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNvbnZlcnRUb0RhdGFJZHNGb3JBZGQoYmluZGluZ1BhdGg6IHN0cmluZyB8IHN0cmluZ1tdLCBiaW5kaW5nRGF0YTogQmluZGluZ0RhdGEpIHtcclxuICAgIGNvbnN0IGRhdGFJZHMgPSB0aGlzLmNvbnZlcnRUb0RhdGFJZHNGb3JVcGRhdGUoYmluZGluZ1BhdGgsIGJpbmRpbmdEYXRhKTtcclxuICAgIGRhdGFJZHMucG9wKCk7XHJcbiAgICByZXR1cm4gZGF0YUlkcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhkVudGl0eVBhdGhTdHJpbmfovazmjaLkuLpVcmxcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY29udmVydFBhdGhUb1VybChwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3Qgc3ViUGF0aHMgPSBwYXRoLnNwbGl0KCcvJyk7XHJcbiAgICBmb3IgKGxldCBpID0gc3ViUGF0aHMubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkge1xyXG4gICAgICBpZiAoc3ViUGF0aHNbaV0gJiYgc3ViUGF0aHNbaV0uZW5kc1dpdGgoJ3MnKSkge1xyXG4gICAgICAgIHN1YlBhdGhzW2ldID0gc3ViUGF0aHNbaV0uc3Vic3RyKDAsIHN1YlBhdGhzW2ldLmxlbmd0aCAtIDEpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIHVybOS4jeWGjei9rOWwj+WGme+8jOWFvOWuueS4u+mUruacieWkp+WGmeWtl+avjeeahOaDheWGtVxyXG4gICAgcmV0dXJuIHN1YlBhdGhzLmpvaW4oJy8nKTsgLy8gLnRvTG93ZXJDYXNlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDljrvpmaTmnIDlkI7nmoRzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgdHJpbVRyYWlsaW5nUyhzdHI6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHN0ci5zdWJzdHIoMCwgc3RyLmxlbmd0aCAtIDEpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDovazmjaLpgJrnlKjot6/lvoTkuLrku4XmnInooajlkI3nmoTmlbDnu4RcclxuICAgKlxyXG4gICAqIDEuWydpZDp4eHgnLCdjaGlsZDFzJywnaWQ6eHgnLCdwcm9wJ10gPT4gWydjaGlsZDFzJywncHJvcCddICBcclxuICAgKiAyLlsncHJvcDEnLCdwcm9wMicsJ3Byb3AzJ10gPT4gWydwcm9wMScsJ3Byb3AyJywncHJvcDMnXSAgXHJcbiAgICogMy5bJ3Byb3AxJywnaWQ6eHh4JywncHJvcDInXSA9PiBbJ3Byb3AxJywncHJvcDInXSAgXHJcbiAgICogQHBhcmFtIHBhdGhzIOWGhee9rui3r+W+hO+8jOagvOW8jzpbJ2lkOnh4eCcsJ2NoaWxkMXMnLCdpZDp4eCcsJ3Byb3AnXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY29udmVydFBhdGhzVG9Ob2RlQ29kZXMocGF0aHM6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgIGlmICghcGF0aHMgfHwgcGF0aHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgcGF0aHMuZmlsdGVyKGl0ZW0gPT4gISFpdGVtICYmIGl0ZW0uaW5kZXhPZignOicpID09PSAtMSkuZm9yRWFjaChub2RlID0+IHtcclxuICAgICAgcmVzdWx0LnB1c2gobm9kZSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOi9rOaNoumAmueUqOi3r+W+hOS4uuS7heacieWunuS9k+S4u+mUruWAvOeahOaVsOe7hFxyXG4gICAqIEBwYXJhbSBwYXRocyDpgJrnlKjot6/lvoTvvIzmoLzlvI86WydpZDp4eHgnLCdjaGlsZDFzJywnaWQ6eHgnLCdwcm9wJ10gPT4gWyd4eHgnLCd4eCddXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjb252ZXJ0UGF0aHNUb0lkcyhwYXRoczogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG4gICAgaWYgKCFwYXRocyB8fCBwYXRocy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICBwYXRocy5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0gJiYgaXRlbS5pbmRleE9mKCc6JykgIT09IC0xKS5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgcmVzdWx0LnB1c2goaWQuc3BsaXQoJzonKVsxXSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBCZWZEYXRhUGF0aFV0aWwgfTtcclxuIl19
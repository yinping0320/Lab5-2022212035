/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_lookup_default.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { of } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { Repository } from '@farris/devkit';
import { map } from 'rxjs/operators/map';
import { HttpHeaders } from '@angular/common/http';
import { FrameworkSessionService } from './framework_session_service';
/**
 * 帮助Rest取数服务
 */
export class BefLookupDefaultService {
    /**
     * @param {?} repository
     * @param {?} sessionService
     */
    constructor(repository, sessionService) {
        this.sessionService = sessionService;
        this.befRepository = (/** @type {?} */ (repository));
    }
    /**
     * @param {?} url
     * @return {?}
     */
    createSession(url) {
        /** @type {?} */
        const userSessionID = this.sessionService.getUserSessionId();
        if (userSessionID) {
            return this.befRepository.restService.invoke(url, 'POST', null, {
                headers: new HttpHeaders({ 'SessionId': userSessionID }),
                responseType: 'text'
            }, false).pipe(switchMap((/**
             * @param {?} str
             * @return {?}
             */
            (str) => {
                return of({ status: true, payload: str });
            })));
        }
        else {
            return of({ status: false, payload: '用户登录信息已过期，请重新登录' });
        }
    }
    /**
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    getData(url, params) {
        /** @type {?} */
        let entityFilter = {};
        if (params.condition) {
            entityFilter = params.condition;
        }
        if (url[url.length - 1] === '/') {
            url = url.substr(0, url.length - 1);
        }
        /** @type {?} */
        let queryUrl = `${url}/extension/query`;
        /** @type {?} */
        let createSessionUrl = `${url}/service/createsession`;
        if (entityFilter) {
            /** @type {?} */
            const entityFilterJson = JSON.stringify(entityFilter);
            queryUrl = `${queryUrl}?entityFilter=${entityFilterJson}`;
        }
        return this.createSession(createSessionUrl).pipe(switchMap((/**
         * @param {?} usrSess
         * @return {?}
         */
        (usrSess) => {
            if (usrSess.status) {
                /** @type {?} */
                const sessionId = usrSess.payload;
                /** @type {?} */
                const options = {};
                // if (options.headers) {
                //     options.headers = options.headers.append('SessionId', usrSess.payload);
                // } else {
                // options.headers = new HttpHeaders({ SessionId: sessionId });
                // }
                // const token = this.befRepository.restService.sessionService.token;
                // options.headers = options.headers.append('X-CAF-Runtime-CommonVariable', token);
                // options.headers = options.headers.append('X-CAF-Runtime-Context', sessionId);
                return this.befRepository.restService.invoke(queryUrl, 'PUT', null, options, false);
            }
            else {
                // @todo: ng7
                // return new ErrorObservable(usrSess.payload);
                throw new Error(usrSess.payload);
            }
        })), map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            const val = res.returnValue;
            /** @type {?} */
            const data = { items: val.result };
            if (val.pagination) {
                return Object.assign({}, data, {
                    total: val.pagination.totalCount,
                    pageInfo: {
                        pageSize: val.pagination.pageSize,
                        pageIndex: val.pagination.pageIndex,
                        enablePager: true
                    }
                });
            }
            return data;
        })));
    }
}
BefLookupDefaultService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BefLookupDefaultService.ctorParameters = () => [
    { type: Repository },
    { type: FrameworkSessionService }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    BefLookupDefaultService.prototype.befRepository;
    /**
     * @type {?}
     * @private
     */
    BefLookupDefaultService.prototype.sessionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2xvb2t1cF9kZWZhdWx0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2JlZi8iLCJzb3VyY2VzIjpbImxpYi9iZWZfbG9va3VwX2RlZmF1bHQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTVDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUN6QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbkQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7QUFPdEUsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7SUFHaEMsWUFBWSxVQUEyQixFQUFVLGNBQXVDO1FBQXZDLG1CQUFjLEdBQWQsY0FBYyxDQUF5QjtRQUNwRixJQUFJLENBQUMsYUFBYSxHQUFHLG1CQUFvQixVQUFVLEVBQUEsQ0FBQztJQUN4RCxDQUFDOzs7OztJQUVELGFBQWEsQ0FBQyxHQUFXOztjQUNmLGFBQWEsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLGdCQUFnQixFQUFFO1FBQzVELElBQUksYUFBYSxFQUFFO1lBQ2YsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQzVELE9BQU8sRUFBRSxJQUFJLFdBQVcsQ0FBQyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsQ0FBQztnQkFDeEQsWUFBWSxFQUFFLE1BQU07YUFDdkIsRUFBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQ1YsU0FB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JztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBJTG9va3VwSHR0cFNlcnZpY2UsIFJlbW90ZVBhcmFtcywgTG9va3VwR3JpZFJlc3VsdCB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSB9IGZyb20gJy4vYmVmX3JlcG9zaXRvcnknO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycy9tYXAnO1xyXG5pbXBvcnQgeyBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgRnJhbWV3b3JrU2Vzc2lvblNlcnZpY2UgfSBmcm9tICcuL2ZyYW1ld29ya19zZXNzaW9uX3NlcnZpY2UnO1xyXG5cclxuXHJcbi8qKlxyXG4gKiDluK7liqlSZXN05Y+W5pWw5pyN5YqhXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBCZWZMb29rdXBEZWZhdWx0U2VydmljZSBpbXBsZW1lbnRzIElMb29rdXBIdHRwU2VydmljZSB7XHJcbiAgICBwcml2YXRlIGJlZlJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8YW55PjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihyZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IEZyYW1ld29ya1Nlc3Npb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5iZWZSZXBvc2l0b3J5ID0gPEJlZlJlcG9zaXRvcnk8YW55Pj5yZXBvc2l0b3J5O1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVNlc3Npb24odXJsOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCB1c2VyU2Vzc2lvbklEID0gdGhpcy5zZXNzaW9uU2VydmljZS5nZXRVc2VyU2Vzc2lvbklkKCk7XHJcbiAgICAgICAgaWYgKHVzZXJTZXNzaW9uSUQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5pbnZva2UodXJsLCAnUE9TVCcsIG51bGwsIHtcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7ICdTZXNzaW9uSWQnOiB1c2VyU2Vzc2lvbklEIH0pLFxyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiAndGV4dCdcclxuICAgICAgICAgICAgfSwgZmFsc2UpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHN0cjogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHsgc3RhdHVzOiB0cnVlLCBwYXlsb2FkOiBzdHIgfSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih7IHN0YXR1czogZmFsc2UsIHBheWxvYWQ6ICfnlKjmiLfnmbvlvZXkv6Hmga/lt7Lov4fmnJ/vvIzor7fph43mlrDnmbvlvZUnIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXREYXRhKHVybDogc3RyaW5nLCBwYXJhbXM/OiBSZW1vdGVQYXJhbXMpOiBPYnNlcnZhYmxlPExvb2t1cEdyaWRSZXN1bHQ+IHtcclxuXHJcbiAgICAgICAgbGV0IGVudGl0eUZpbHRlciA9IHt9O1xyXG4gICAgICAgIGlmIChwYXJhbXMuY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIGVudGl0eUZpbHRlciA9IHBhcmFtcy5jb25kaXRpb247XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodXJsW3VybC5sZW5ndGggLSAxXSA9PT0gJy8nKSB7XHJcbiAgICAgICAgICAgIHVybCA9IHVybC5zdWJzdHIoMCwgdXJsLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHF1ZXJ5VXJsID0gYCR7dXJsfS9leHRlbnNpb24vcXVlcnlgLCBjcmVhdGVTZXNzaW9uVXJsID0gYCR7dXJsfS9zZXJ2aWNlL2NyZWF0ZXNlc3Npb25gO1xyXG5cclxuICAgICAgICBpZiAoZW50aXR5RmlsdGVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudGl0eUZpbHRlckpzb24gPSBKU09OLnN0cmluZ2lmeShlbnRpdHlGaWx0ZXIpO1xyXG4gICAgICAgICAgICBxdWVyeVVybCA9IGAke3F1ZXJ5VXJsfT9lbnRpdHlGaWx0ZXI9JHtlbnRpdHlGaWx0ZXJKc29ufWA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2Vzc2lvbihjcmVhdGVTZXNzaW9uVXJsKS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKHVzclNlc3M6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzclNlc3Muc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gdXNyU2Vzcy5wYXlsb2FkO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnM6IGFueSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIChvcHRpb25zLmhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgb3B0aW9ucy5oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzLmFwcGVuZCgnU2Vzc2lvbklkJywgdXNyU2Vzcy5wYXlsb2FkKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbnMuaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7IFNlc3Npb25JZDogc2Vzc2lvbklkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zdCB0b2tlbiA9IHRoaXMuYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5zZXNzaW9uU2VydmljZS50b2tlbjtcclxuICAgICAgICAgICAgICAgICAgICAvLyBvcHRpb25zLmhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnMuYXBwZW5kKCdYLUNBRi1SdW50aW1lLUNvbW1vblZhcmlhYmxlJywgdG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG9wdGlvbnMuaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycy5hcHBlbmQoJ1gtQ0FGLVJ1bnRpbWUtQ29udGV4dCcsIHNlc3Npb25JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5pbnZva2UocXVlcnlVcmwsICdQVVQnLCBudWxsLCBvcHRpb25zLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEB0b2RvOiBuZzdcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gbmV3IEVycm9yT2JzZXJ2YWJsZSh1c3JTZXNzLnBheWxvYWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcih1c3JTZXNzLnBheWxvYWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcmVzLnJldHVyblZhbHVlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHsgaXRlbXM6IHZhbC5yZXN1bHQgfTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWwucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBkYXRhLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB2YWwucGFnaW5hdGlvbi50b3RhbENvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHZhbC5wYWdpbmF0aW9uLnBhZ2VTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4OiB2YWwucGFnaW5hdGlvbi5wYWdlSW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVQYWdlcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
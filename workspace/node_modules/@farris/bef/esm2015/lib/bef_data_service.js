/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_data_service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { of, zip } from 'rxjs';
import { tap, map, switchMap } from 'rxjs/operators';
import { EventBus, AppContext, DataChangeType, DataTypeInfoUtil, ViewModel, ExpressionUtil } from '@farris/devkit';
import { FrameworkSessionService } from './framework_session_service';
import { BefRestService } from './bef_rest_service';
import { BE_SERVER_URI_TOKEN } from './tokens';
import { BefProxyUtil } from './bef_proxy_util';
import { EntityUtil } from './entity_util';
import { BefDataPathUtil } from './bef_data_path_util';
/**
 * Bef数据访问服务
 * \@todo：
 * 1、临时将BefRepository相关代码转移到该类中；
 * 2、进一步明确职责，调整结构
 * @template T
 */
// tslint:disable: no-string-literal
class BefDataService {
    /**
     * 构造函数
     * @param {?} injector
     * @param {?} repository
     */
    constructor(injector, repository) {
        this.injector = injector;
        this.repository = repository;
        /** @type {?} */
        const frmSessionService = injector.get(FrameworkSessionService);
        /** @type {?} */
        const httpClient = injector.get(HttpClient);
        /** @type {?} */
        const serverUri = injector.get(BE_SERVER_URI_TOKEN);
        // 创建BefRestService实例
        /** @type {?} */
        const restBaseUri = `${serverUri}/${this.repository.apiUri}`;
        /** @type {?} */
        const eventBus = injector.get(EventBus);
        this.restService = new BefRestService(httpClient, restBaseUri, frmSessionService, this.repository, eventBus);
        this.appContext = injector.get(AppContext);
    }
    /**
     * BefRest代理
     * @return {?}
     */
    get restProxy() {
        return this.repository.restService.proxy;
    }
    /**
     * 获取实体集合
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    getList(filter, sort, pageSize, pageIndex) {
        if (pageSize !== 0) {
            pageSize = pageSize || this.repository.entityCollection.pageSize;
            pageIndex = pageIndex || this.repository.entityCollection.pageIndex;
        }
        /** @type {?} */
        const entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const filter$ = this.restProxy.extendQuery(entityFilter, requestInfo);
        return filter$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const queryResult = (/** @type {?} */ (responseInfo.returnValue));
            /** @type {?} */
            const listData = queryResult.result;
            /** @type {?} */
            const entities = [];
            listData.forEach((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                /** @type {?} */
                const entity = this.repository.buildEntity(data);
                EntityUtil.appendInitialData(entity, data);
                entities.push(entity);
            }));
            // BindingList r95，分页变更集取消，导致设置分页信息后不会触发变更事件，所以将加载数据放到后面
            /** @type {?} */
            const serverPaginationInfo = (/** @type {?} */ (queryResult.pagination));
            if (!!serverPaginationInfo && Object.keys(serverPaginationInfo).length > 0) {
                const { pageSize, pageIndex, totalCount } = serverPaginationInfo;
                // 处理主表分页信息
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex, pageSize, totalCount });
            }
            else {
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: 1, pageSize: 0, totalCount: entities.length });
            }
            this.repository.entityCollection.loadEntities(entities);
            return entities;
        })));
    }
    /**
     * 过滤数据
     * @param {?} filter 过滤条件
     * @param {?} sort 排序条件
     * @param {?} pageSize 分页大小
     * @param {?} pageIndex 当前分页
     * @return {?}
     */
    filter(filter, sort, pageSize, pageIndex) {
        if (pageSize !== 0) {
            pageSize = pageSize || this.repository.entityCollection.pageSize;
            pageIndex = pageIndex || this.repository.entityCollection.pageIndex;
        }
        /** @type {?} */
        const entityFilter = this.buildEntityFilter(filter, sort, pageSize, pageIndex);
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const filter$ = this.restProxy.filter(entityFilter, requestInfo);
        return filter$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const queryResult = (/** @type {?} */ (responseInfo.returnValue));
            /** @type {?} */
            const listData = queryResult.result;
            /** @type {?} */
            const entities = [];
            listData.forEach((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                /** @type {?} */
                const entity = this.repository.buildEntity(data);
                EntityUtil.appendInitialData(entity, data);
                entities.push(entity);
            }));
            // BindingList r95，分页变更集取消，导致设置分页信息后不会触发变更事件，所以将加载数据放到后面
            /** @type {?} */
            const serverPaginationInfo = (/** @type {?} */ (queryResult.pagination));
            if (!!serverPaginationInfo && Object.keys(serverPaginationInfo).length > 0) {
                const { pageSize, pageIndex, totalCount } = serverPaginationInfo;
                // 处理主表分页信息
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex, pageSize, totalCount });
            }
            else {
                this.repository.entityCollection.updatePaginationInfoByPath('/', { pageIndex: 1, pageSize: 0, totalCount: entities.length });
            }
            this.repository.entityCollection.loadEntities(entities);
            return entities;
        })));
    }
    /**
     * 构造EntityFilter
     * @private
     * @param {?} filter
     * @param {?} sort
     * @param {?} pageSize
     * @param {?} pageIndex
     * @return {?}
     */
    buildEntityFilter(filter, sort, pageSize, pageIndex) {
        // @todo：临时兼容老代码，降低改动带来的风险
        if (!filter && !sort && !pageSize && !pageIndex) {
            return null;
        }
        // 纠正最后一个过滤条件的Relation
        if (filter && filter.length > 0) {
            filter[filter.length - 1].relation = 0;
        }
        /** @type {?} */
        const entityFilter = {
            FilterConditions: filter,
            SortConditions: sort,
            IsUsePagination: pageSize === 0 ? false : true,
            Pagination: {
                PageIndex: pageIndex,
                PageSize: pageSize,
                PageCount: 0,
                TotalCount: 0
            }
        };
        return entityFilter;
    }
    /**
     * 获取单个实体
     * @param {?} id id
     * @return {?}
     */
    getById(id) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        if (retrieveParam) {
            return this.getEntityById(id);
        }
        /** @type {?} */
        const retrieve$ = this.restService.extendRetrieve(id, requestInfo, retrieveParam);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const entityData = responseInfo.returnValue;
            /** @type {?} */
            const entity = this.repository.buildEntity(entityData);
            this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getEntityById(id) {
        // 获取所有分页信息
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        // 构造分页信息
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        /** @type {?} */
        const retrieve$ = this.restService.serviceRetrieve(id, retrieveParam, requestInfo);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const returnValue = responseInfo.returnValue || {};
            /** @type {?} */
            const entityData = returnValue.result;
            /** @type {?} */
            const serverPaginationInfo = returnValue.pagination;
            this.updatePagination(serverPaginationInfo);
            /** @type {?} */
            const entity = this.repository.buildEntity(entityData);
            this.repository.entityCollection.loadEntities([entity]);
            return entity;
        })));
        return result$;
    }
    /**
     * ['id:xxx', 'chil1s', 'id:xxx', 'grand1s']
     * 分页查询从表/从从表数据
     * 绑定路径格式为['主表主键:主表主键值','child1s','id:从表主键值']
     * @param {?} paths 通用路径
     * @param {?} pageIndex 页码
     * @param {?} pageSize 分页大小
     * @param {?=} filter 过滤条件
     * @param {?=} sort 排序
     * @return {?}
     */
    queryChild(paths, pageIndex, pageSize, filter, sort) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        let nodeCodes = BefDataPathUtil.convertPathsToNodeCodes(paths);
        /** @type {?} */
        const entityCodes = nodeCodes.map((/**
         * @param {?} node
         * @return {?}
         */
        node => node.substring(0, node.length - 1)));
        /** @type {?} */
        let entityName = entityCodes[entityCodes.length - 1];
        // 查询对象可能为从表或从从表
        /** @type {?} */
        const pagination = this.repository.entityCollection.getPaginationConfigByPath(`/${entityName}`);
        const { pageSize: ps = 0 } = pagination || {};
        /** @type {?} */
        const viewModel = this.injector.get(ViewModel, null);
        /** @type {?} */
        let forceQueryChild = false;
        if (viewModel) {
            forceQueryChild = viewModel.frameContext.appContext.params.get('forceQueryChild') || false;
        }
        if (ps == 0 && !forceQueryChild) {
            return of(null);
        }
        /** @type {?} */
        const ids = BefDataPathUtil.convertPathsToIds(paths);
        /** @type {?} */
        const parentId = ids[ids.length - 1];
        /** @type {?} */
        const params = {
            nodeCodes: entityCodes,
            ids,
            pagination: {
                pageIndex,
                pageSize
            },
            requestInfo
        };
        /** @type {?} */
        const request$ = this.restService.queryChild(params);
        return request$.pipe(map((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            /** @type {?} */
            const returnValue = response.returnValue;
            if (!returnValue) {
                return null;
            }
            const { result = [], pagination = {} } = returnValue;
            /** @type {?} */
            const commonPaths = paths.map((/**
             * @param {?} path
             * @param {?} index
             * @return {?}
             */
            (path, index) => {
                if (path.includes(':') && index % 2 === 0) {
                    return path.split(':')[1];
                }
                return path;
            }));
            /** @type {?} */
            const entities = this.repository.entityManager.createEntitiesByPath(`/${commonPaths.join('/')}`, result);
            this.repository.entityCollection.resetEntities(paths, entities);
            // 更新分页信息
            this.repository.entityCollection.setPaginationConfigByPath(`/${entityName}`, { pageIndex: pagination.pageIndex, pageSize: pagination.pageSize });
            this.repository.entityCollection.setPaginationConfigByPath(`/${entityName}_${parentId}`, pagination);
        })));
    }
    /**
     * 构造子表分页信息
     * @private
     * @return {?}
     */
    buildChildrenPagination() {
        /** @type {?} */
        const paginationInfo = this.repository.entityCollection.getPaginationConfigByPath('/');
        /** @type {?} */
        const childPaginationInfo = {};
        /** @type {?} */
        const childrenEntityCodes = [];
        DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo, childrenEntityCodes);
        // 实体无子表
        if (!childrenEntityCodes || childrenEntityCodes.length < 1) {
            return null;
        }
        Object.keys(paginationInfo).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            /** @type {?} */
            const value = paginationInfo[key];
            if (typeof value === 'object') {
                /** @type {?} */
                const entityCode = key && key.includes('_') && key.split('_')[0] || null;
                if (!(entityCode && childrenEntityCodes.includes(`${entityCode}s`))) {
                    childPaginationInfo[key] = value;
                }
            }
        }));
        return childPaginationInfo;
    }
    /**
     * 更新分页配置信息
     * @private
     * @param {?} paginationInfo 服务器分页信息
     * @return {?}
     */
    updatePagination(paginationInfo) {
        if (!paginationInfo) {
            return;
        }
        /** @type {?} */
        let childrenEntityCodes = [];
        DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo, childrenEntityCodes);
        childrenEntityCodes = childrenEntityCodes.map((/**
         * @param {?} item
         * @return {?}
         */
        item => item.substr(0, item.length - 1)));
        // retrieve之后没有子表数据
        if (!paginationInfo || Object.keys(paginationInfo).length < 1) {
            if (childrenEntityCodes && childrenEntityCodes.length > 0) {
                childrenEntityCodes.forEach((/**
                 * @param {?} nodeCode
                 * @return {?}
                 */
                (nodeCode) => {
                    /** @type {?} */
                    const original = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`);
                    if (original) {
                        //original.pageIndex = 1;
                        //original.total = 0;
                        // 重置当前子表公共分页信息
                        //this.repository.entityCollection.setPaginationConfigByPath(`/${nodeCode}`, original);
                        // 删除当前数据下级表分页信息
                        /** @type {?} */
                        const localPagination = this.repository.entityCollection.getPaginationConfigByPath('/');
                        /** @type {?} */
                        const keys = Object.keys(localPagination).filter((/**
                         * @param {?} item
                         * @return {?}
                         */
                        item => item.startsWith(`${nodeCode}_`)));
                        if (keys && keys.length > 0) {
                            keys.forEach((/**
                             * @param {?} key
                             * @return {?}
                             */
                            key => {
                                this.repository.entityCollection.setPaginationConfigByPath(`/${key}`, { pageIndex: 1, total: 0, pageSize: original.pageSize });
                            }));
                        }
                    }
                }));
            }
            return;
        }
        Object.keys(paginationInfo).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            // const entityName = childrenEntityCodes.find(item => key.startsWith(`${item}_`));
            this.repository.entityCollection.setPaginationConfigByPath(`/${key}`, paginationInfo[key]);
        }));
    }
    /**
     * 构造retrieve分页信息
     * \@description 该请求不需要携带parentIds参数，只有切换从从表时才需要使用添加parentIds参数
     * @private
     * @return {?}
     */
    buildRetrieveParam() {
        /** @type {?} */
        const childPaginationInfo = this.buildChildrenPagination();
        if (!childPaginationInfo || Object.keys(childPaginationInfo).length < 1) {
            return null;
        }
        /** @type {?} */
        const retrieveParam = { filters: {}, parentIds: {} };
        /** @type {?} */
        let childrenEntityCodes = [];
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        Object.keys(childPaginationInfo).forEach((/**
         * @param {?} typeName
         * @return {?}
         */
        typeName => {
            /** @type {?} */
            const entity = childPaginationInfo[typeName];
            /** @type {?} */
            const pageIndex = entity.pageIndex || 1;
            retrieveParam.filters[typeName] = { pagination: { pageSize: entity.pageSize || 0, pageIndex: pageIndex } };
            // if (this.isChildrenTable(typeName)) {
            //   retrieveParam.parentIds[typeName] = this.getId(typeName, pageIndex);
            // }
        }));
        return retrieveParam;
    }
    /*
      private getId(nodeCode: string, pageIndex: number): string {
        const viewModel = this.injector.get<ViewModel>(ViewModel, null);
        const { pageIndex: originalPageIndex = 1 } = this.repository.entityCollection.getPaginationConfigByPath(`/${nodeCode}`) || {};
        if (pageIndex !== originalPageIndex) {
          return null;
        }
        if (viewModel) {
          const bindingList = viewModel.bindingData.getValue([`${nodeCode}s`]) as BindingList;
          if (bindingList && bindingList.currentId) {
            return bindingList.currentId;
          }
        }
        return null;
      }
      private isChildrenTable(nodeCode: string) {
        let childrenEntityCodes: any[] = [];
        nodeCode += 's';
        ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo, childrenEntityCodes);
        if (childrenEntityCodes && childrenEntityCodes.length > 0) {
          const index = childrenEntityCodes.findIndex((paths: string[]) => paths.length === 1 && paths[0] === nodeCode);
          return index !== -1;
        }
        return false;
      }*/
    /**
     * 更新并对实体加锁
     * @param {?} id 实体id
     * @return {?}
     */
    editById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        const requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        const retrieve$ = this.restProxy.edit(id, requestInfo);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const entityData = responseInfo.returnValue.data;
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            if (entityToUpdate && entityData) {
                this.reloadEntityData(entityToUpdate, entityData);
            }
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    updateById(id) {
        // 如果要更新的实体不存在，返回一个null流；
        // @todo：返回empty()还是null流，为了不影响现有行为，临时返回null流。
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        if (!entity) {
            return of(null);
        }
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        if (retrieveParam) {
            return this.updateEntityById(id);
        }
        /** @type {?} */
        const retrieve$ = this.restService.extendRetrieve(id, requestInfo, retrieveParam);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const entityData = responseInfo.returnValue;
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 根据id更新实体
     * @param {?} id 实体id
     * @return {?}
     */
    updateEntityById(id) {
        // 获取所有分页信息
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        // 构造分页信息
        /** @type {?} */
        const retrieveParam = this.buildRetrieveParam();
        /** @type {?} */
        const retrieve$ = this.restService.serviceRetrieve(id, retrieveParam, requestInfo);
        /** @type {?} */
        const result$ = retrieve$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const returnValue = responseInfo.returnValue || {};
            /** @type {?} */
            const entityData = returnValue.result;
            /** @type {?} */
            const serverPaginationInfo = returnValue.pagination;
            this.updatePagination(serverPaginationInfo);
            /** @type {?} */
            const entityToUpdate = this.repository.entityCollection.getEntityById(id);
            this.reloadEntityData(entityToUpdate, entityData);
            return entityToUpdate;
        })));
        return result$;
    }
    /**
     * 重新加载实体数据
     * \@todo：
     * 1、根本上应该在重新load数据的时候，只发送根节点的一次Load变更；
     * 2、考虑到稳定性和改动量，暂时采取此过渡方案，重构Entity时彻底解决。
     * @private
     * @param {?} entity
     * @param {?} entityData 要重载的数据
     * @return {?}
     */
    reloadEntityData(entity, entityData) {
        if (!entity) {
            return;
        }
        // 关闭变更检测
        this.appContext.changeDetectionController.detach();
        // retrieve之后已经是最新数据，移除变更
        // entity.load(entityData);
        this.repository.entityCollection.updateEntity(entity, entityData);
        // 重新加载数据不应该产生变更
        entity.changes.splice(0, entity.changes.length);
        // 重新打开变更检测
        this.appContext.changeDetectionController.reattach();
    }
    /**
     * 创建新实体，并加载
     * @param {?=} defaultValue
     * @return {?}
     */
    create(defaultValue) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const result$ = this.restService.create(defaultValue, requestInfo);
        return result$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newData);
            EntityUtil.appendInitialData(newEntity, newData);
            this.repository.entityCollection.loadEntities([newEntity], true);
            // this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    }
    /**
     * 追加实体
     * @param {?=} defaultValue
     * @return {?}
     */
    append(defaultValue) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restService.create(defaultValue, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newData);
            this.repository.entityCollection.addEntity(newEntity);
            // this.repository.dataChangeHistory.addChange({ dataId: newEntity.primaryValue, changeType: DataChangeType.Add });
            return newEntity;
        })));
    }
    /**
     * 插入数据
     * @param {?} position 数据插入位置
     * @param {?=} defaultValue 默认值
     * @return {?}
     */
    insert(position, defaultValue) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const insert$ = this.restProxy.create(defaultValue, requestInfo);
        return insert$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.buildEntity(newData);
            this.repository.entityCollection.insertEntity(newEntity, position);
            return newEntity;
        })));
    }
    /**
     * 创建子实体，并追加
     * @param {?} fpath 父路径，格式形如：/1/edus（从表）或/1/edus/2/grades（从从表）
     * @return {?}
     */
    appendByPath(fpath) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restService.createByPath(fpath, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.entityManager.appendEntityByPath(fpath, newData, newData);
            return newEntity;
        })));
    }
    /**
     * 创建子实体并插入到指定位置
     * @param {?} fpath 父路径
     * @param {?} position 数据插入位置
     * @return {?}
     */
    insertByPath(fpath, position) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const insert$ = this.restProxy.createByPath(fpath, requestInfo);
        return insert$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const newData = responseInfo.returnValue;
            /** @type {?} */
            const newEntity = this.repository.entityManager.insertEntityByPath(fpath, newData, newData, position);
            return newEntity;
        })));
    }
    /**
     * 根据id删除实体
     * @param {?} id 内码
     * @param {?=} ifSave
     * @return {?}
     */
    removeById(id, ifSave) {
        ifSave = (ifSave === undefined) ? true : ifSave;
        /** @type {?} */
        const requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        let delete$;
        if (ifSave) {
            delete$ = this.restProxy.deleteAndSave(id, requestInfo);
            return delete$.pipe(switchMap((/**
             * @return {?}
             */
            () => {
                this.repository.entityCollection.removeEntityById(id);
                return of(true);
            })));
        }
        else {
            delete$ = this.restService.extendDelete(id, requestInfo);
            return delete$.pipe(switchMap((/**
             * @return {?}
             */
            () => {
                this.repository.entityCollection.removeEntityById(id);
                this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
                return of(true);
            })));
        }
    }
    /**
     * 删除并保存
     * @param {?} id 要删除的实体id
     * @return {?}
     */
    removeAndSaveById(id) {
        /** @type {?} */
        const requestInfo = BefProxyUtil.buildRequestInfo(this.repository);
        /** @type {?} */
        const delete$ = this.restProxy.deleteAndSave(id, requestInfo);
        /** @type {?} */
        const result$ = delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            this.repository.entityCollection.removeEntityById(id);
            // this.repository.dataChangeHistory.addChange({ dataId: id, changeType: DataChangeType.Delete });
            return of(true);
        })));
        return result$;
    }
    /**
     * 批量删除
     * @param {?} ids
     * @param {?=} ifSave 是否保存
     * @return {?}
     */
    removeByIds(ids, ifSave) {
        ifSave = (ifSave === undefined) ? true : ifSave;
        // 服务器端删除
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.extendBatchDelete(ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            if (ifSave) {
                // 执行保存
                return this.applyChangesByIdArray(ids).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result) {
                        // 从实体集合中删除
                        this.repository.entityCollection.removeEntities((/**
                         * @param {?} value
                         * @return {?}
                         */
                        (value) => {
                            return this.checkEntityValueExists(value, ids);
                        }));
                    }
                })));
            }
            else {
                // 从实体集合中删除
                this.repository.entityCollection.removeEntities((/**
                 * @param {?} value
                 * @return {?}
                 */
                (value) => {
                    return this.checkEntityValueExists(value, ids);
                }));
                if (ids && ids.length > 0) {
                    /** @type {?} */
                    const changes = [];
                    ids.forEach((/**
                     * @param {?} id
                     * @return {?}
                     */
                    id => {
                        changes.push({ dataId: id, changeType: DataChangeType.Delete });
                    }));
                    this.repository.dataChangeHistory.addChanges(changes);
                }
                return of(true);
            }
        })));
    }
    /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} ifSave 是否保存
     * @return {?}
     */
    batchRemove(ids, ifSave) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.extendBatchDeletion(ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(switchMap((/**
         * @return {?}
         */
        () => {
            if (ifSave) {
                // 执行保存
                return this.applyChangesByIdArray(ids).pipe(tap((/**
                 * @param {?} result
                 * @return {?}
                 */
                result => {
                    if (result) {
                        // 从实体集合中删除
                        this.removeEntities(ids);
                    }
                })));
            }
            else {
                // 从实体集合中删除
                this.removeEntities(ids);
                this.addBatchRemoveHistory(ids);
                return of(true);
            }
        })));
    }
    /**
     * 添加批量删除记录到变更记录中
     * @private
     * @param {?} ids ids
     * @return {?}
     */
    addBatchRemoveHistory(ids) {
        if (ids && ids.length > 0) {
            /** @type {?} */
            const changes = [];
            ids.forEach((/**
             * @param {?} id
             * @return {?}
             */
            id => {
                changes.push({ dataId: id, changeType: DataChangeType.Delete });
            }));
            this.repository.dataChangeHistory.addChanges(changes);
        }
    }
    /**
     * 从实体仓库中批量移除指定id的数据
     * @private
     * @param {?} ids
     * @return {?}
     */
    removeEntities(ids) {
        this.repository.entityCollection.removeEntities((/**
         * @param {?} value
         * @return {?}
         */
        (value) => {
            return this.checkEntityValueExists(value, ids);
        }));
    }
    /**
     * 检测实体的主键值是否存在于数组中，如果存在返回true
     * @private
     * @param {?} entity
     * @param {?} primaryValueArray
     * @return {?}
     */
    checkEntityValueExists(entity, primaryValueArray) {
        /** @type {?} */
        let isExistInTargetArray = false;
        for (let i = 0; i < primaryValueArray.length; i++) {
            if (entity.primaryValue === primaryValueArray[i]) {
                isExistInTargetArray = true;
                break;
            }
        }
        return isExistInTargetArray;
    }
    /**
     * 删除子级
     * @param {?} fpath
     * @param {?} id   内码
     * @return {?}
     */
    removeByPath(fpath, id) {
        // 服务器端删除
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.extendDeletByPath(fpath, id, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.removeEntityByPath(fpath, id);
            this.repository.dataChangeHistory.addChange({ fpath, dataId: id, changeType: DataChangeType.Delete });
            return true;
        })));
    }
    /**
     * 批量删除子级
     * @param {?} fPath 路径
     * @param {?} ids  子级id集合
     * @return {?}
     */
    batchRemoveByPath(fPath, ids) {
        // 服务器端删除
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const delete$ = this.restService.batchDeleteByPath(fPath, ids, requestInfo);
        // 从本地实体集合中移除
        return delete$.pipe(map((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const idArray = ids.split(',');
            if (idArray.length > 0) {
                idArray.forEach((/**
                 * @param {?} id
                 * @return {?}
                 */
                (id) => {
                    this.repository.entityManager.removeEntityByPath(fPath, id);
                    this.repository.dataChangeHistory.addChange({ fpath: fPath, dataId: id, changeType: DataChangeType.Delete });
                }));
            }
            return true;
        })));
    }
    /**
     * 将id对应的实体的变更提交的服务器端
     * @param {?} id
     * @return {?}
     */
    updateChangesById(id) {
        /** @type {?} */
        const entity = this.repository.entityCollection.getEntityById(id);
        // 变更集不存在
        if (!entity.changes) {
            return of(true);
        }
        // 变更集为空
        if (entity.changes.length === 0) {
            return of(true);
        }
        /** @type {?} */
        const changeDetail = this.repository.entityManager.buildEntityChangeDetailById(id);
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const update$ = this.restService.update(changeDetail, requestInfo);
        /** @type {?} */
        const result$ = update$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesById(id);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 提交path对应实体的变更
     * @param {?} path
     * @param {?} id
     * @return {?}
     */
    updateChangesByPath(path, id) {
        throw new Error('Not Implement');
    }
    /**
     * 提交所有变更
     * @return {?}
     */
    updateAllChanges() {
        // 遍历实体，提交变更
        /** @type {?} */
        const updateResults = [];
        /** @type {?} */
        const entities = this.repository.entityCollection.toArray();
        if (entities.length === 0) {
            return of(true);
        }
        entities.forEach((/**
         * @param {?} entity
         * @return {?}
         */
        (entity) => {
            /** @type {?} */
            const updateResult$ = this.updateChangesById(entity.primaryValue);
            updateResults.push(updateResult$);
        }));
        // 串联流
        /** @type {?} */
        const result$ = zip(...updateResults).pipe(map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用变更
     * @return {?}
     */
    applyChanges() {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const save$ = this.restService.save(requestInfo);
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearAllEntityChanges();
            this.repository.clearAllVariableChanges(requestInfo.variableChange);
            this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用idArray对应数据的变更
     * @param {?} idArray
     * @return {?}
     */
    applyChangesByIdArray(idArray) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const save$ = this.restService.save(requestInfo);
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesByArray(idArray);
            this.repository.dataChangeHistory.clearByIds(idArray);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 应用id对应数据的变更
     * @param {?} id
     * @return {?}
     */
    applyChangesById(id) {
        /** @type {?} */
        const requestInfo = this.restService.buildRequestInfo();
        /** @type {?} */
        const save$ = this.restService.save(requestInfo);
        /** @type {?} */
        const result$ = save$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearEntityChangesById(id);
            this.repository.dataChangeHistory.clearByIds([id]);
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 取消变更
     * @param {?=} options
     * @return {?}
     */
    cancelChanges(options) {
        /** @type {?} */
        const cancel$ = this.restService.cancel(options);
        /** @type {?} */
        const result$ = cancel$.pipe(tap((/**
         * @return {?}
         */
        () => {
            this.repository.entityManager.clearAllEntityChanges();
            this.repository.dataChangeHistory.clear();
        })), map((/**
         * @return {?}
         */
        () => {
            return true;
        })));
        return result$;
    }
    /**
     * 批量新增从表/从从表数据
     * @param {?} path 实体绑定路径，like 1/childs or 1/childs/11/childchilds
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    batchAppendByPath(path, defaultValues) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restProxy.batchAppendByPath(path, defaultValues, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const list = responseInfo.returnValue;
            /** @type {?} */
            const entities = this.repository.entityManager.createEntitiesByPath(path, list);
            /** @type {?} */
            const paths = path.split('/').filter((/**
             * @param {?} p
             * @return {?}
             */
            p => p));
            this.repository.entityManager.appendEntitiesByPath(paths, entities);
            return entities;
        })));
    }
    /**
     * 批量新增主表数据
     * @param {?} defaultValues 默认实体数据数组
     * @return {?}
     */
    batchAppend(defaultValues) {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        /** @type {?} */
        const append$ = this.restProxy.batchAppend(defaultValues, requestInfo);
        return append$.pipe(map((/**
         * @param {?} responseInfo
         * @return {?}
         */
        (responseInfo) => {
            /** @type {?} */
            const list = responseInfo.returnValue;
            /** @type {?} */
            const entities = this.repository.buildEntities(list);
            this.repository.entityCollection.addEntities(entities);
            return entities;
        })));
    }
    /**
     * 检查当前业务上下文内是否存在未保存的变更
     * @return {?}
     */
    hasChanges() {
        /** @type {?} */
        const requestInfo = this.buildRequestInfo();
        return this.restService.hasChanges(requestInfo);
    }
    /**
     * 构造变更集
     * @return {?}
     */
    buildRequestInfo() {
        /** @type {?} */
        const requestInfo = {
            dataChange: this.repository.entityManager.buildAllEntityChangeDetails(),
            variableChange: this.repository.variableManager.buildChangeDetail()
        };
        return requestInfo;
    }
}
if (false) {
    /**
     * 全局上下文
     * @type {?}
     * @private
     */
    BefDataService.prototype.appContext;
    /**
     * 实体仓库
     * @type {?}
     * @private
     */
    BefDataService.prototype.repository;
    /**
     * RestService实例(请使用restProxy代替)
     * @deprecated
     * @type {?}
     */
    BefDataService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    BefDataService.prototype.injector;
}
export { BefDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX2RhdGFfc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvYmVmLyIsInNvdXJjZXMiOlsibGliL2JlZl9kYXRhX3NlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFPQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFjLEVBQUUsRUFBRSxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckQsT0FBTyxFQUFVLFFBQVEsRUFBYyxVQUFVLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFpQixTQUFTLEVBQUUsY0FBYyxFQUFlLE1BQU0sZ0JBQWdCLENBQUM7QUFHbkssT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUcvQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7Ozs7Ozs7OztBQVF2RCxNQUFNLGNBQWM7Ozs7OztJQTRCbEIsWUFBb0IsUUFBa0IsRUFBRSxVQUE0QjtRQUFoRCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ3BDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDOztjQUV2QixpQkFBaUIsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUEwQix1QkFBdUIsQ0FBQzs7Y0FDbEYsVUFBVSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQWEsVUFBVSxDQUFDOztjQUNqRCxTQUFTLEdBQUcsUUFBUSxDQUFDLEdB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QUFXLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2xELENBQUM7Ozs7O0lBSU0sZ0JBQWdCOztjQUNmLFdBQVcsR0FBZ0I7WUFDL0IsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLDJCQUEyQixFQUFFO1lBQ3ZFLGNBQWMsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRTtTQUNwRTtRQUNELE9BQU8sV0FBVyxDQUFDO0lBQ3JCLENBQUM7Q0FDRjs7Ozs7OztJQXo2QkMsb0NBQStCOzs7Ozs7SUFLL0Isb0NBQXFDOzs7Ozs7SUFhckMscUNBQW1DOzs7OztJQUt2QixrQ0FBMEI7O0FBbzVCeEMsT0FBTyxFQUFFLGNBQWMsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjogV2l0dFxyXG4gKiBARGF0ZTogMjAxOS0wMy0wNyAxNjo1NTozM1xyXG4gKiBATGFzdCBNb2RpZmllZCBieTogYWFsaXp6d2VsbFxyXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE5LTEwLTA5IDE2OjQ0OjU4XHJcbiAqL1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgemlwIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRhcCwgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQgeyBFbnRpdHksIEV2ZW50QnVzLCBNb2RpZnlUeXBlLCBBcHBDb250ZXh0LCBEYXRhQ2hhbmdlVHlwZSwgRGF0YVR5cGVJbmZvVXRpbCwgRGF0YVByb3BHcm91cCwgVmlld01vZGVsLCBFeHByZXNzaW9uVXRpbCwgQmluZGluZ0xpc3QgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcblxyXG5pbXBvcnQgeyBSZXNwb25zZUluZm8sIFF1ZXJ5UmVzdWx0LCBQYWdpbmF0aW9uLCBSZXF1ZXN0SW5mbywgUmV0cmlldmVQYXJhbSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtTZXNzaW9uU2VydmljZSB9IGZyb20gJy4vZnJhbWV3b3JrX3Nlc3Npb25fc2VydmljZSc7XHJcbmltcG9ydCB7IEJlZlJlc3RTZXJ2aWNlIH0gZnJvbSAnLi9iZWZfcmVzdF9zZXJ2aWNlJztcclxuaW1wb3J0IHsgQkVfU0VSVkVSX1VSSV9UT0tFTiB9IGZyb20gJy4vdG9rZW5zJztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSB9IGZyb20gJy4vYmVmX3JlcG9zaXRvcnknO1xyXG5pbXBvcnQgeyBCZWZQcm94eSB9IGZyb20gJy4vYmVmX3Byb3h5JztcclxuaW1wb3J0IHsgQmVmUHJveHlVdGlsIH0gZnJvbSAnLi9iZWZfcHJveHlfdXRpbCc7XHJcbmltcG9ydCB7IEVudGl0eVV0aWwgfSBmcm9tICcuL2VudGl0eV91dGlsJztcclxuaW1wb3J0IHsgQmVmRGF0YVBhdGhVdGlsIH0gZnJvbSAnLi9iZWZfZGF0YV9wYXRoX3V0aWwnO1xyXG4vKipcclxuICogQmVm5pWw5o2u6K6/6Zeu5pyN5YqhXHJcbiAqIEB0b2Rv77yaXHJcbiAqIDHjgIHkuLTml7blsIZCZWZSZXBvc2l0b3J555u45YWz5Luj56CB6L2s56e75Yiw6K+l57G75Lit77ybXHJcbiAqIDLjgIHov5vkuIDmraXmmI7noa7ogYzotKPvvIzosIPmlbTnu5PmnoRcclxuICovXHJcbi8vIHRzbGludDpkaXNhYmxlOiBuby1zdHJpbmctbGl0ZXJhbFxyXG5jbGFzcyBCZWZEYXRhU2VydmljZTxUIGV4dGVuZHMgRW50aXR5PiB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWFqOWxgOS4iuS4i+aWh1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYXBwQ29udGV4dDogQXBwQ29udGV4dDtcclxuXHJcbiAgLyoqXHJcbiAgICog5a6e5L2T5LuT5bqTXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PFQ+O1xyXG5cclxuICAvKipcclxuICAgKiBCZWZSZXN05Luj55CGXHJcbiAgICovXHJcbiAgcHVibGljIGdldCByZXN0UHJveHkoKTogQmVmUHJveHkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5yZXN0U2VydmljZS5wcm94eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RTZXJ2aWNl5a6e5L6LKOivt+S9v+eUqHJlc3RQcm94eeS7o+abvylcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXN0U2VydmljZTogQmVmUmVzdFNlcnZpY2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWHveaVsFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCByZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PFQ+KSB7XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkgPSByZXBvc2l0b3J5O1xyXG5cclxuICAgIGNvbnN0IGZybVNlc3Npb25TZXJ2aWNlID0gaW5qZWN0b3IuZ2V0PEZyYW1ld29ya1Nlc3Npb25TZXJ2aWNlPihGcmFtZXdvcmtTZXNzaW9uU2VydmljZSk7XHJcbiAgICBjb25zdCBodHRwQ2xpZW50ID0gaW5qZWN0b3IuZ2V0PEh0dHBDbGllbnQ+KEh0dHBDbGllbnQpO1xyXG4gICAgY29uc3Qgc2VydmVyVXJpID0gaW5qZWN0b3IuZ2V0PHN0cmluZz4oQkVfU0VSVkVSX1VSSV9UT0tFTik7XHJcblxyXG4gICAgLy8g5Yib5bu6QmVmUmVzdFNlcnZpY2Xlrp7kvotcclxuICAgIGNvbnN0IHJlc3RCYXNlVXJpID0gYCR7c2VydmVyVXJpfS8ke3RoaXMucmVwb3NpdG9yeS5hcGlVcml9YDtcclxuXHJcbiAgICBjb25zdCBldmVudEJ1czogRXZlbnRCdXMgPSBpbmplY3Rvci5nZXQ8RXZlbnRCdXM+KEV2ZW50QnVzKTtcclxuICAgIHRoaXMucmVzdFNlcnZpY2UgPSBuZXcgQmVmUmVzdFNlcnZpY2UoaHR0cENsaWVudCwgcmVzdEJhc2VVcmksIGZybVNlc3Npb25TZXJ2aWNlLCB0aGlzLnJlcG9zaXRvcnksIGV2ZW50QnVzKTtcclxuXHJcbiAgICB0aGlzLmFwcENvbnRleHQgPSBpbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blrp7kvZPpm4blkIhcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TGlzdChmaWx0ZXI6IGFueVtdLCBzb3J0OiBhbnlbXSwgcGFnZVNpemU6IG51bWJlciB8IG51bGwsIHBhZ2VJbmRleDogbnVtYmVyIHwgbnVsbCk6IE9ic2VydmFibGU8VFtdPiB7XHJcbiAgICBpZiAocGFnZVNpemUgIT09IDApIHtcclxuICAgICAgcGFnZVNpemUgPSBwYWdlU2l6ZSB8fCB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlU2l6ZTtcclxuICAgICAgcGFnZUluZGV4ID0gcGFnZUluZGV4IHx8IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnBhZ2VJbmRleDtcclxuICAgIH1cclxuICAgIGNvbnN0IGVudGl0eUZpbHRlciA9IHRoaXMuYnVpbGRFbnRpdHlGaWx0ZXIoZmlsdGVyLCBzb3J0LCBwYWdlU2l6ZSwgcGFnZUluZGV4KTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBmaWx0ZXIkID0gdGhpcy5yZXN0UHJveHkuZXh0ZW5kUXVlcnkoZW50aXR5RmlsdGVyLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gZmlsdGVyJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcXVlcnlSZXN1bHQgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgYXMgUXVlcnlSZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgbGlzdERhdGEgPSBxdWVyeVJlc3VsdC5yZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXM6IFRbXSA9IFtdO1xyXG4gICAgICAgIGxpc3REYXRhLmZvckVhY2goKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KGRhdGEpO1xyXG4gICAgICAgICAgRW50aXR5VXRpbC5hcHBlbmRJbml0aWFsRGF0YShlbnRpdHksIGRhdGEpO1xyXG4gICAgICAgICAgZW50aXRpZXMucHVzaChlbnRpdHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIEJpbmRpbmdMaXN0IHI5Ne+8jOWIhumhteWPmOabtOmbhuWPlua2iO+8jOWvvOiHtOiuvue9ruWIhumhteS/oeaBr+WQjuS4jeS8muinpuWPkeWPmOabtOS6i+S7tu+8jOaJgOS7peWwhuWKoOi9veaVsOaNruaUvuWIsOWQjumdolxyXG4gICAgICAgIGNvbnN0IHNlcnZlclBhZ2luYXRpb25JbmZvID0gcXVlcnlSZXN1bHQucGFnaW5hdGlvbiBhcyBQYWdpbmF0aW9uO1xyXG4gICAgICAgIGlmICghIXNlcnZlclBhZ2luYXRpb25JbmZvICYmIE9iamVjdC5rZXlzKHNlcnZlclBhZ2luYXRpb25JbmZvKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjb25zdCB7IHBhZ2VTaXplLCBwYWdlSW5kZXgsIHRvdGFsQ291bnQgfSA9IHNlcnZlclBhZ2luYXRpb25JbmZvO1xyXG4gICAgICAgICAgLy8g5aSE55CG5Li76KGo5YiG6aG15L+h5oGvXHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi51cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aCgnLycsIHsgcGFnZUluZGV4LCBwYWdlU2l6ZSwgdG90YWxDb3VudCB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udXBkYXRlUGFnaW5hdGlvbkluZm9CeVBhdGgoJy8nLCB7IHBhZ2VJbmRleDogMSwgcGFnZVNpemU6IDAsIHRvdGFsQ291bnQ6IGVudGl0aWVzLmxlbmd0aCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKGVudGl0aWVzKTtcclxuICAgICAgICByZXR1cm4gZW50aXRpZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDov4fmu6TmlbDmja5cclxuICAgKiBAcGFyYW0gZmlsdGVyIOi/h+a7pOadoeS7tlxyXG4gICAqIEBwYXJhbSBzb3J0IOaOkuW6j+adoeS7tlxyXG4gICAqIEBwYXJhbSBwYWdlU2l6ZSDliIbpobXlpKflsI9cclxuICAgKiBAcGFyYW0gcGFnZUluZGV4IOW9k+WJjeWIhumhtVxyXG4gICAqL1xyXG4gIHB1YmxpYyBmaWx0ZXIoZmlsdGVyOiBhbnlbXSwgc29ydDogYW55W10sIHBhZ2VTaXplOiBudW1iZXIgfCBudWxsLCBwYWdlSW5kZXg6IG51bWJlciB8IG51bGwpOiBPYnNlcnZhYmxlPFRbXT4ge1xyXG4gICAgaWYgKHBhZ2VTaXplICE9PSAwKSB7XHJcbiAgICAgIHBhZ2VTaXplID0gcGFnZVNpemUgfHwgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucGFnZVNpemU7XHJcbiAgICAgIHBhZ2VJbmRleCA9IHBhZ2VJbmRleCB8fCB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlSW5kZXg7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbnRpdHlGaWx0ZXIgPSB0aGlzLmJ1aWxkRW50aXR5RmlsdGVyKGZpbHRlciwgc29ydCwgcGFnZVNpemUsIHBhZ2VJbmRleCk7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgZmlsdGVyJCA9IHRoaXMucmVzdFByb3h5LmZpbHRlcihlbnRpdHlGaWx0ZXIsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBmaWx0ZXIkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBxdWVyeVJlc3VsdCA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZSBhcyBRdWVyeVJlc3VsdDtcclxuICAgICAgICBjb25zdCBsaXN0RGF0YSA9IHF1ZXJ5UmVzdWx0LnJlc3VsdDtcclxuICAgICAgICBjb25zdCBlbnRpdGllczogVFtdID0gW107XHJcbiAgICAgICAgbGlzdERhdGEuZm9yRWFjaCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoZGF0YSk7XHJcbiAgICAgICAgICBFbnRpdHlVdGlsLmFwcGVuZEluaXRpYWxEYXRhKGVudGl0eSwgZGF0YSk7XHJcbiAgICAgICAgICBlbnRpdGllcy5wdXNoKGVudGl0eSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gQmluZGluZ0xpc3Qgcjk177yM5YiG6aG15Y+Y5pu06ZuG5Y+W5raI77yM5a+86Ie06K6+572u5YiG6aG15L+h5oGv5ZCO5LiN5Lya6Kem5Y+R5Y+Y5pu05LqL5Lu277yM5omA5Lul5bCG5Yqg6L295pWw5o2u5pS+5Yiw5ZCO6Z2iXHJcbiAgICAgICAgY29uc3Qgc2VydmVyUGFnaW5hdGlvbkluZm8gPSBxdWVyeVJlc3VsdC5wYWdpbmF0aW9uIGFzIFBhZ2luYXRpb247XHJcbiAgICAgICAgaWYgKCEhc2VydmVyUGFnaW5hdGlvbkluZm8gJiYgT2JqZWN0LmtleXMoc2VydmVyUGFnaW5hdGlvbkluZm8pLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IHsgcGFnZVNpemUsIHBhZ2VJbmRleCwgdG90YWxDb3VudCB9ID0gc2VydmVyUGFnaW5hdGlvbkluZm87XHJcbiAgICAgICAgICAvLyDlpITnkIbkuLvooajliIbpobXkv6Hmga9cclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnVwZGF0ZVBhZ2luYXRpb25JbmZvQnlQYXRoKCcvJywgeyBwYWdlSW5kZXgsIHBhZ2VTaXplLCB0b3RhbENvdW50IH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi51cGRhdGVQYWdpbmF0aW9uSW5mb0J5UGF0aCgnLycsIHsgcGFnZUluZGV4OiAxLCBwYWdlU2l6ZTogMCwgdG90YWxDb3VudDogZW50aXRpZXMubGVuZ3RoIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoZW50aXRpZXMpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdGllcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoEVudGl0eUZpbHRlclxyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRFbnRpdHlGaWx0ZXIoZmlsdGVyOiBhbnlbXSwgc29ydDogYW55W10sIHBhZ2VTaXplOiBudW1iZXIsIHBhZ2VJbmRleDogbnVtYmVyKSB7XHJcbiAgICAvLyBAdG9kb++8muS4tOaXtuWFvOWuueiAgeS7o+egge+8jOmZjeS9juaUueWKqOW4puadpeeahOmjjumZqVxyXG4gICAgaWYgKCFmaWx0ZXIgJiYgIXNvcnQgJiYgIXBhZ2VTaXplICYmICFwYWdlSW5kZXgpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g57qg5q2j5pyA5ZCO5LiA5Liq6L+H5ruk5p2h5Lu255qEUmVsYXRpb25cclxuICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyLmxlbmd0aCA+IDApIHtcclxuICAgICAgZmlsdGVyW2ZpbHRlci5sZW5ndGggLSAxXS5yZWxhdGlvbiA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZW50aXR5RmlsdGVyID0ge1xyXG4gICAgICBGaWx0ZXJDb25kaXRpb25zOiBmaWx0ZXIsXHJcbiAgICAgIFNvcnRDb25kaXRpb25zOiBzb3J0LFxyXG4gICAgICBJc1VzZVBhZ2luYXRpb246IHBhZ2VTaXplID09PSAwID8gZmFsc2UgOiB0cnVlLFxyXG4gICAgICBQYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgUGFnZUluZGV4OiBwYWdlSW5kZXgsXHJcbiAgICAgICAgUGFnZVNpemU6IHBhZ2VTaXplLFxyXG4gICAgICAgIFBhZ2VDb3VudDogMCxcclxuICAgICAgICBUb3RhbENvdW50OiAwXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gZW50aXR5RmlsdGVyO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bljZXkuKrlrp7kvZNcclxuICAgKiBAcGFyYW0gaWQgaWRcclxuICAgKiBAcGFyYW0gZW5hYmxlQ2hpbGRyZW5QYWdpbmF0aW9uIGVuXHJcbiAgICovXHJcbiAgcHVibGljIGdldEJ5SWQoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IHJldHJpZXZlUGFyYW0gPSB0aGlzLmJ1aWxkUmV0cmlldmVQYXJhbSgpO1xyXG4gICAgaWYgKHJldHJpZXZlUGFyYW0pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RW50aXR5QnlJZChpZCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmV4dGVuZFJldHJpZXZlKGlkLCByZXF1ZXN0SW5mbywgcmV0cmlldmVQYXJhbSk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gcmV0cmlldmUkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBlbnRpdHlEYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShlbnRpdHlEYXRhKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoW2VudGl0eV0pO1xyXG4gICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIHB1YmxpYyBnZXRFbnRpdHlCeUlkKGlkOiBzdHJpbmcpIHtcclxuICAgIC8vIOiOt+WPluaJgOacieWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIC8vIOaehOmAoOWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmV0cmlldmVQYXJhbSA9IHRoaXMuYnVpbGRSZXRyaWV2ZVBhcmFtKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNlcnZpY2VSZXRyaWV2ZShpZCwgcmV0cmlldmVQYXJhbSwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgfHwge307XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJldHVyblZhbHVlLnJlc3VsdDtcclxuICAgICAgICBjb25zdCBzZXJ2ZXJQYWdpbmF0aW9uSW5mbyA9IHJldHVyblZhbHVlLnBhZ2luYXRpb247XHJcbiAgICAgICAgdGhpcy51cGRhdGVQYWdpbmF0aW9uKHNlcnZlclBhZ2luYXRpb25JbmZvKTtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkoZW50aXR5RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ubG9hZEVudGl0aWVzKFtlbnRpdHldKTtcclxuICAgICAgICByZXR1cm4gZW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBbJ2lkOnh4eCcsICdjaGlsMXMnLCAnaWQ6eHh4JywgJ2dyYW5kMXMnXVxyXG4gICAqIOWIhumhteafpeivouS7juihqC/ku47ku47ooajmlbDmja5cclxuICAgKiDnu5Hlrprot6/lvoTmoLzlvI/kuLpbJ+S4u+ihqOS4u+mUrjrkuLvooajkuLvplK7lgLwnLCdjaGlsZDFzJywnaWQ65LuO6KGo5Li76ZSu5YC8J11cclxuICAgKiBAcGFyYW0gcGF0aHMg6YCa55So6Lev5b6EXHJcbiAgICogQHBhcmFtIHBhZ2VJbmRleCDpobXnoIFcclxuICAgKiBAcGFyYW0gcGFnZVNpemUg5YiG6aG15aSn5bCPXHJcbiAgICogQHBhcmFtIGZpbHRlciDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gc29ydCDmjpLluo9cclxuICAgKi9cclxuICBwdWJsaWMgcXVlcnlDaGlsZChwYXRoczogc3RyaW5nW10sIHBhZ2VJbmRleDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyLCBmaWx0ZXI/OiBzdHJpbmcsIHNvcnQ/OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBsZXQgbm9kZUNvZGVzID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoc1RvTm9kZUNvZGVzKHBhdGhzKTtcclxuICAgIGNvbnN0IGVudGl0eUNvZGVzID0gbm9kZUNvZGVzLm1hcChub2RlID0+IG5vZGUuc3Vic3RyaW5nKDAsIG5vZGUubGVuZ3RoIC0gMSkpO1xyXG4gICAgbGV0IGVudGl0eU5hbWUgPSBlbnRpdHlDb2Rlc1tlbnRpdHlDb2Rlcy5sZW5ndGggLSAxXTtcclxuICAgIC8vIOafpeivouWvueixoeWPr+iDveS4uuS7juihqOaIluS7juS7juihqFxyXG4gICAgY29uc3QgcGFnaW5hdGlvbiA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke2VudGl0eU5hbWV9YCk7XHJcbiAgICBjb25zdCB7IHBhZ2VTaXplOiBwcyA9IDAgfSA9IHBhZ2luYXRpb24gfHwge307XHJcbiAgICBjb25zdCB2aWV3TW9kZWwgPSB0aGlzLmluamVjdG9yLmdldDxWaWV3TW9kZWw+KFZpZXdNb2RlbCwgbnVsbCk7XHJcbiAgICBsZXQgZm9yY2VRdWVyeUNoaWxkID0gZmFsc2U7XHJcbiAgICBpZiAodmlld01vZGVsKSB7XHJcbiAgICAgIGZvcmNlUXVlcnlDaGlsZCA9IHZpZXdNb2RlbC5mcmFtZUNvbnRleHQuYXBwQ29udGV4dC5wYXJhbXMuZ2V0KCdmb3JjZVF1ZXJ5Q2hpbGQnKSB8fCBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmIChwcyA9PSAwICYmICFmb3JjZVF1ZXJ5Q2hpbGQpIHtcclxuICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaWRzID0gQmVmRGF0YVBhdGhVdGlsLmNvbnZlcnRQYXRoc1RvSWRzKHBhdGhzKTtcclxuICAgIGNvbnN0IHBhcmVudElkID0gaWRzW2lkcy5sZW5ndGggLSAxXTtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgbm9kZUNvZGVzOiBlbnRpdHlDb2RlcyxcclxuICAgICAgaWRzLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgcGFnZUluZGV4LFxyXG4gICAgICAgIHBhZ2VTaXplXHJcbiAgICAgIH0sXHJcbiAgICAgIHJlcXVlc3RJbmZvXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlcXVlc3QkID0gdGhpcy5yZXN0U2VydmljZS5xdWVyeUNoaWxkKHBhcmFtcyk7XHJcbiAgICByZXR1cm4gcmVxdWVzdCQucGlwZShcclxuICAgICAgbWFwKHJlc3BvbnNlID0+IHtcclxuICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IHJlc3BvbnNlLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGlmICghcmV0dXJuVmFsdWUpIHtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IHJlc3VsdCA9IFtdLCBwYWdpbmF0aW9uID0ge30gfSA9IHJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGNvbW1vblBhdGhzID0gcGF0aHMubWFwKChwYXRoLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHBhdGguaW5jbHVkZXMoJzonKSAmJiBpbmRleCAlIDIgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBhdGguc3BsaXQoJzonKVsxXTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY3JlYXRlRW50aXRpZXNCeVBhdGgoYC8ke2NvbW1vblBhdGhzLmpvaW4oJy8nKX1gLCByZXN1bHQpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlc2V0RW50aXRpZXMocGF0aHMsIGVudGl0aWVzKTtcclxuICAgICAgICAvLyDmm7TmlrDliIbpobXkv6Hmga9cclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5zZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGAvJHtlbnRpdHlOYW1lfWAsIHsgcGFnZUluZGV4OiBwYWdpbmF0aW9uLnBhZ2VJbmRleCwgcGFnZVNpemU6IHBhZ2luYXRpb24ucGFnZVNpemUgfSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uc2V0UGFnaW5hdGlvbkNvbmZpZ0J5UGF0aChgLyR7ZW50aXR5TmFtZX1fJHtwYXJlbnRJZH1gLCBwYWdpbmF0aW9uKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWtkOihqOWIhumhteS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRDaGlsZHJlblBhZ2luYXRpb24oKSB7XHJcbiAgICBjb25zdCBwYWdpbmF0aW9uSW5mbyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoJy8nKTtcclxuICAgIGNvbnN0IGNoaWxkUGFnaW5hdGlvbkluZm8gPSB7fTtcclxuICAgIGNvbnN0IGNoaWxkcmVuRW50aXR5Q29kZXMgPSBbXTtcclxuICAgIERhdGFUeXBlSW5mb1V0aWwuZ2V0Q2hpbGRyZW5Ob2RlQ29kZXModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvLCBjaGlsZHJlbkVudGl0eUNvZGVzKTtcclxuICAgIC8vIOWunuS9k+aXoOWtkOihqFxyXG4gICAgaWYgKCFjaGlsZHJlbkVudGl0eUNvZGVzIHx8IGNoaWxkcmVuRW50aXR5Q29kZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gcGFnaW5hdGlvbkluZm9ba2V5XTtcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlDb2RlID0ga2V5ICYmIGtleS5pbmNsdWRlcygnXycpICYmIGtleS5zcGxpdCgnXycpWzBdIHx8IG51bGw7XHJcbiAgICAgICAgaWYgKCEoZW50aXR5Q29kZSAmJiBjaGlsZHJlbkVudGl0eUNvZGVzLmluY2x1ZGVzKGAke2VudGl0eUNvZGV9c2ApKSkge1xyXG4gICAgICAgICAgY2hpbGRQYWdpbmF0aW9uSW5mb1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjaGlsZFBhZ2luYXRpb25JbmZvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmm7TmlrDliIbpobXphY3nva7kv6Hmga9cclxuICAgKiBAcGFyYW0gcGFnaW5hdGlvbkluZm8g5pyN5Yqh5Zmo5YiG6aG15L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVQYWdpbmF0aW9uKHBhZ2luYXRpb25JbmZvOiBhbnkpIHtcclxuICAgIGlmICghcGFnaW5hdGlvbkluZm8pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGNoaWxkcmVuRW50aXR5Q29kZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBEYXRhVHlwZUluZm9VdGlsLmdldENoaWxkcmVuTm9kZUNvZGVzKHRoaXMucmVwb3NpdG9yeS5lbnRpdHlUeXBlSW5mbywgY2hpbGRyZW5FbnRpdHlDb2Rlcyk7XHJcbiAgICBjaGlsZHJlbkVudGl0eUNvZGVzID0gY2hpbGRyZW5FbnRpdHlDb2Rlcy5tYXAoaXRlbSA9PiBpdGVtLnN1YnN0cigwLCBpdGVtLmxlbmd0aCAtIDEpKTtcclxuICAgIC8vIHJldHJpZXZl5LmL5ZCO5rKh5pyJ5a2Q6KGo5pWw5o2uXHJcbiAgICBpZiAoIXBhZ2luYXRpb25JbmZvIHx8IE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKS5sZW5ndGggPCAxKSB7XHJcbiAgICAgIGlmIChjaGlsZHJlbkVudGl0eUNvZGVzICYmIGNoaWxkcmVuRW50aXR5Q29kZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNoaWxkcmVuRW50aXR5Q29kZXMuZm9yRWFjaCgobm9kZUNvZGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGAvJHtub2RlQ29kZX1gKTtcclxuICAgICAgICAgIGlmIChvcmlnaW5hbCkge1xyXG4gICAgICAgICAgICAvL29yaWdpbmFsLnBhZ2VJbmRleCA9IDE7XHJcbiAgICAgICAgICAgIC8vb3JpZ2luYWwudG90YWwgPSAwO1xyXG4gICAgICAgICAgICAvLyDph43nva7lvZPliY3lrZDooajlhazlhbHliIbpobXkv6Hmga9cclxuICAgICAgICAgICAgLy90aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5zZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKGAvJHtub2RlQ29kZX1gLCBvcmlnaW5hbCk7XHJcbiAgICAgICAgICAgIC8vIOWIoOmZpOW9k+WJjeaVsOaNruS4i+e6p+ihqOWIhumhteS/oeaBr1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhbFBhZ2luYXRpb24gPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRQYWdpbmF0aW9uQ29uZmlnQnlQYXRoKCcvJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFBhZ2luYXRpb24pLmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aChgJHtub2RlQ29kZX1fYCkpO1xyXG4gICAgICAgICAgICBpZiAoa2V5cyAmJiBrZXlzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnNldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke2tleX1gLCB7IHBhZ2VJbmRleDogMSwgdG90YWw6IDAsIHBhZ2VTaXplOiBvcmlnaW5hbC5wYWdlU2l6ZSB9KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIE9iamVjdC5rZXlzKHBhZ2luYXRpb25JbmZvKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIC8vIGNvbnN0IGVudGl0eU5hbWUgPSBjaGlsZHJlbkVudGl0eUNvZGVzLmZpbmQoaXRlbSA9PiBrZXkuc3RhcnRzV2l0aChgJHtpdGVtfV9gKSk7XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnNldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke2tleX1gLCBwYWdpbmF0aW9uSW5mb1trZXldKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKByZXRyaWV2ZeWIhumhteS/oeaBr1xyXG4gICAqIEBkZXNjcmlwdGlvbiDor6Xor7fmsYLkuI3pnIDopoHmkLrluKZwYXJlbnRJZHPlj4LmlbDvvIzlj6rmnInliIfmjaLku47ku47ooajml7bmiY3pnIDopoHkvb/nlKjmt7vliqBwYXJlbnRJZHPlj4LmlbBcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkUmV0cmlldmVQYXJhbSgpIHtcclxuICAgIGNvbnN0IGNoaWxkUGFnaW5hdGlvbkluZm8gPSB0aGlzLmJ1aWxkQ2hpbGRyZW5QYWdpbmF0aW9uKCk7XHJcbiAgICBpZiAoIWNoaWxkUGFnaW5hdGlvbkluZm8gfHwgT2JqZWN0LmtleXMoY2hpbGRQYWdpbmF0aW9uSW5mbykubGVuZ3RoIDwgMSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJldHJpZXZlUGFyYW06IFJldHJpZXZlUGFyYW0gPSB7IGZpbHRlcnM6IHt9LCBwYXJlbnRJZHM6IHt9IH07XHJcbiAgICBsZXQgY2hpbGRyZW5FbnRpdHlDb2RlczogYW55W10gPSBbXTtcclxuICAgIEV4cHJlc3Npb25VdGlsLmdldENoaWxkcmVuRW50aXR5UGF0aHModGhpcy5yZXBvc2l0b3J5LmVudGl0eVR5cGVJbmZvLCBjaGlsZHJlbkVudGl0eUNvZGVzKTtcclxuICAgIE9iamVjdC5rZXlzKGNoaWxkUGFnaW5hdGlvbkluZm8pLmZvckVhY2godHlwZU5hbWUgPT4ge1xyXG4gICAgICBjb25zdCBlbnRpdHk6IGFueSA9IGNoaWxkUGFnaW5hdGlvbkluZm9bdHlwZU5hbWVdO1xyXG4gICAgICBjb25zdCBwYWdlSW5kZXggPSBlbnRpdHkucGFnZUluZGV4IHx8IDE7XHJcbiAgICAgIHJldHJpZXZlUGFyYW0uZmlsdGVyc1t0eXBlTmFtZV0gPSB7IHBhZ2luYXRpb246IHsgcGFnZVNpemU6IGVudGl0eS5wYWdlU2l6ZSB8fCAwLCBwYWdlSW5kZXg6IHBhZ2VJbmRleCB9IH07XHJcbiAgICAgIC8vIGlmICh0aGlzLmlzQ2hpbGRyZW5UYWJsZSh0eXBlTmFtZSkpIHtcclxuICAgICAgLy8gICByZXRyaWV2ZVBhcmFtLnBhcmVudElkc1t0eXBlTmFtZV0gPSB0aGlzLmdldElkKHR5cGVOYW1lLCBwYWdlSW5kZXgpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmV0cmlldmVQYXJhbTtcclxuICB9XHJcbiAgLypcclxuICBwcml2YXRlIGdldElkKG5vZGVDb2RlOiBzdHJpbmcsIHBhZ2VJbmRleDogbnVtYmVyKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHZpZXdNb2RlbCA9IHRoaXMuaW5qZWN0b3IuZ2V0PFZpZXdNb2RlbD4oVmlld01vZGVsLCBudWxsKTtcclxuICAgIGNvbnN0IHsgcGFnZUluZGV4OiBvcmlnaW5hbFBhZ2VJbmRleCA9IDEgfSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldFBhZ2luYXRpb25Db25maWdCeVBhdGgoYC8ke25vZGVDb2RlfWApIHx8IHt9O1xyXG4gICAgaWYgKHBhZ2VJbmRleCAhPT0gb3JpZ2luYWxQYWdlSW5kZXgpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAodmlld01vZGVsKSB7XHJcbiAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gdmlld01vZGVsLmJpbmRpbmdEYXRhLmdldFZhbHVlKFtgJHtub2RlQ29kZX1zYF0pIGFzIEJpbmRpbmdMaXN0O1xyXG4gICAgICBpZiAoYmluZGluZ0xpc3QgJiYgYmluZGluZ0xpc3QuY3VycmVudElkKSB7XHJcbiAgICAgICAgcmV0dXJuIGJpbmRpbmdMaXN0LmN1cnJlbnRJZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIHByaXZhdGUgaXNDaGlsZHJlblRhYmxlKG5vZGVDb2RlOiBzdHJpbmcpIHtcclxuICAgIGxldCBjaGlsZHJlbkVudGl0eUNvZGVzOiBhbnlbXSA9IFtdO1xyXG4gICAgbm9kZUNvZGUgKz0gJ3MnO1xyXG4gICAgRXhwcmVzc2lvblV0aWwuZ2V0Q2hpbGRyZW5FbnRpdHlQYXRocyh0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZUluZm8sIGNoaWxkcmVuRW50aXR5Q29kZXMpO1xyXG4gICAgaWYgKGNoaWxkcmVuRW50aXR5Q29kZXMgJiYgY2hpbGRyZW5FbnRpdHlDb2Rlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gY2hpbGRyZW5FbnRpdHlDb2Rlcy5maW5kSW5kZXgoKHBhdGhzOiBzdHJpbmdbXSkgPT4gcGF0aHMubGVuZ3RoID09PSAxICYmIHBhdGhzWzBdID09PSBub2RlQ29kZSk7XHJcbiAgICAgIHJldHVybiBpbmRleCAhPT0gLTE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSovXHJcbiAgLyoqXHJcbiAgICog5pu05paw5bm25a+55a6e5L2T5Yqg6ZSBXHJcbiAgICogQHBhcmFtIGlkIOWunuS9k2lkXHJcbiAgICovXHJcbiAgcHVibGljIGVkaXRCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGNvbnN0IGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gQmVmUHJveHlVdGlsLmJ1aWxkUmVxdWVzdEluZm8odGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIGNvbnN0IHJldHJpZXZlJCA9IHRoaXMucmVzdFByb3h5LmVkaXQoaWQsIHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZXRyaWV2ZSQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eURhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUuZGF0YTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIGlmIChlbnRpdHlUb1VwZGF0ZSAmJiBlbnRpdHlEYXRhKSB7XHJcbiAgICAgICAgICB0aGlzLnJlbG9hZEVudGl0eURhdGEoZW50aXR5VG9VcGRhdGUsIGVudGl0eURhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZW50aXR5VG9VcGRhdGU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5pZOabtOaWsOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVCeUlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIC8vIOWmguaenOimgeabtOaWsOeahOWunuS9k+S4jeWtmOWcqO+8jOi/lOWbnuS4gOS4qm51bGzmtYHvvJtcclxuICAgIC8vIEB0b2Rv77ya6L+U5ZueZW1wdHkoKei/mOaYr251bGzmtYHvvIzkuLrkuobkuI3lvbHlk43njrDmnInooYzkuLrvvIzkuLTml7bov5Tlm55udWxs5rWB44CCXHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcclxuICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZVBhcmFtID0gdGhpcy5idWlsZFJldHJpZXZlUGFyYW0oKTtcclxuICAgIGlmIChyZXRyaWV2ZVBhcmFtKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZUVudGl0eUJ5SWQoaWQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmV0cmlldmUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRSZXRyaWV2ZShpZCwgcmVxdWVzdEluZm8sIHJldHJpZXZlUGFyYW0pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIHRoaXMucmVsb2FkRW50aXR5RGF0YShlbnRpdHlUb1VwZGF0ZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVRvVXBkYXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja5pZOabtOaWsOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVFbnRpdHlCeUlkKGlkOiBzdHJpbmcpIHtcclxuICAgIC8vIOiOt+WPluaJgOacieWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIC8vIOaehOmAoOWIhumhteS/oeaBr1xyXG4gICAgY29uc3QgcmV0cmlldmVQYXJhbSA9IHRoaXMuYnVpbGRSZXRyaWV2ZVBhcmFtKCk7XHJcbiAgICBjb25zdCByZXRyaWV2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNlcnZpY2VSZXRyaWV2ZShpZCwgcmV0cmlldmVQYXJhbSwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHJldHJpZXZlJC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWUgfHwge307XHJcbiAgICAgICAgY29uc3QgZW50aXR5RGF0YSA9IHJldHVyblZhbHVlLnJlc3VsdDtcclxuICAgICAgICBjb25zdCBzZXJ2ZXJQYWdpbmF0aW9uSW5mbyA9IHJldHVyblZhbHVlLnBhZ2luYXRpb247XHJcbiAgICAgICAgdGhpcy51cGRhdGVQYWdpbmF0aW9uKHNlcnZlclBhZ2luYXRpb25JbmZvKTtcclxuICAgICAgICBjb25zdCBlbnRpdHlUb1VwZGF0ZSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgIHRoaXMucmVsb2FkRW50aXR5RGF0YShlbnRpdHlUb1VwZGF0ZSwgZW50aXR5RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eVRvVXBkYXRlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDph43mlrDliqDovb3lrp7kvZPmlbDmja5cclxuICAgKiBAcGFyYW0gaWQg6KaB6YeN6L2955qE5a6e5L2TaWRcclxuICAgKiBAcGFyYW0gZW50aXR5RGF0YSDopoHph43ovb3nmoTmlbDmja5cclxuICAgKiBAdG9kb++8mlxyXG4gICAqIDHjgIHmoLnmnKzkuIrlupTor6XlnKjph43mlrBsb2Fk5pWw5o2u55qE5pe25YCZ77yM5Y+q5Y+R6YCB5qC56IqC54K555qE5LiA5qyhTG9hZOWPmOabtO+8m1xyXG4gICAqIDLjgIHogIPomZHliLDnqLPlrprmgKflkozmlLnliqjph4/vvIzmmoLml7bph4flj5bmraTov4fmuKHmlrnmoYjvvIzph43mnoRFbnRpdHnml7blvbvlupXop6PlhrPjgIJcclxuICAgKi9cclxuICBwcml2YXRlIHJlbG9hZEVudGl0eURhdGEoZW50aXR5OiBFbnRpdHksIGVudGl0eURhdGE6IGFueSk6IHZvaWQge1xyXG4gICAgaWYgKCFlbnRpdHkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5YWz6Zet5Y+Y5pu05qOA5rWLXHJcbiAgICB0aGlzLmFwcENvbnRleHQuY2hhbmdlRGV0ZWN0aW9uQ29udHJvbGxlci5kZXRhY2goKTtcclxuICAgIC8vIHJldHJpZXZl5LmL5ZCO5bey57uP5piv5pyA5paw5pWw5o2u77yM56e76Zmk5Y+Y5pu0XHJcbiAgICAvLyBlbnRpdHkubG9hZChlbnRpdHlEYXRhKTtcclxuICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnVwZGF0ZUVudGl0eShlbnRpdHksIGVudGl0eURhdGEpO1xyXG4gICAgLy8g6YeN5paw5Yqg6L295pWw5o2u5LiN5bqU6K+l5Lqn55Sf5Y+Y5pu0XHJcbiAgICBlbnRpdHkuY2hhbmdlcy5zcGxpY2UoMCwgZW50aXR5LmNoYW5nZXMubGVuZ3RoKTtcclxuICAgIC8vIOmHjeaWsOaJk+W8gOWPmOabtOajgOa1i1xyXG4gICAgdGhpcy5hcHBDb250ZXh0LmNoYW5nZURldGVjdGlvbkNvbnRyb2xsZXIucmVhdHRhY2goKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuaWsOWunuS9k++8jOW5tuWKoOi9vVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGUoZGVmYXVsdFZhbHVlPzogYW55KSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuY3JlYXRlKGRlZmF1bHRWYWx1ZSwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KG5ld0RhdGEpO1xyXG4gICAgICAgIEVudGl0eVV0aWwuYXBwZW5kSW5pdGlhbERhdGEobmV3RW50aXR5LCBuZXdEYXRhKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5sb2FkRW50aXRpZXMoW25ld0VudGl0eV0sIHRydWUpO1xyXG4gICAgICAgIC8vIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IG5ld0VudGl0eS5wcmltYXJ5VmFsdWUsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkFkZCB9KTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOi/veWKoOWunuS9k1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBlbmQoZGVmYXVsdFZhbHVlPzogYW55KTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgYXBwZW5kJCA9IHRoaXMucmVzdFNlcnZpY2UuY3JlYXRlKGRlZmF1bHRWYWx1ZSwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGFwcGVuZCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KG5ld0RhdGEpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0eShuZXdFbnRpdHkpO1xyXG4gICAgICAgIC8vIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBkYXRhSWQ6IG5ld0VudGl0eS5wcmltYXJ5VmFsdWUsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkFkZCB9KTtcclxuICAgICAgICByZXR1cm4gbmV3RW50aXR5O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5o+S5YWl5pWw5o2uXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uIOaVsOaNruaPkuWFpeS9jee9rlxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWUg6buY6K6k5YC8XHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydChwb3NpdGlvbjogMSB8IC0xLCBkZWZhdWx0VmFsdWU/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGluc2VydCQgPSB0aGlzLnJlc3RQcm94eS5jcmVhdGUoZGVmYXVsdFZhbHVlLCByZXF1ZXN0SW5mbyk7XHJcbiAgICByZXR1cm4gaW5zZXJ0JC5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3RGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBuZXdFbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkobmV3RGF0YSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uaW5zZXJ0RW50aXR5KG5ld0VudGl0eSwgcG9zaXRpb24pO1xyXG4gICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yib5bu65a2Q5a6e5L2T77yM5bm26L+95YqgXHJcbiAgICogQHBhcmFtIGZwYXRoIOeItui3r+W+hO+8jOagvOW8j+W9ouWmgu+8mi8xL2VkdXPvvIjku47ooajvvInmiJYvMS9lZHVzLzIvZ3JhZGVz77yI5LuO5LuO6KGo77yJXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGVuZEJ5UGF0aChmcGF0aDogc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBhcHBlbmQkID0gdGhpcy5yZXN0U2VydmljZS5jcmVhdGVCeVBhdGgoZnBhdGgsIHJlcXVlc3RJbmZvKTtcclxuICAgIHJldHVybiBhcHBlbmQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCBuZXdEYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmFwcGVuZEVudGl0eUJ5UGF0aChmcGF0aCwgbmV3RGF0YSwgbmV3RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIm+W7uuWtkOWunuS9k+W5tuaPkuWFpeWIsOaMh+WumuS9jee9rlxyXG4gICAqIEBwYXJhbSBmcGF0aCDniLbot6/lvoRcclxuICAgKiBAcGFyYW0gcG9zaXRpb24g5pWw5o2u5o+S5YWl5L2N572uXHJcbiAgICovXHJcbiAgcHVibGljIGluc2VydEJ5UGF0aChmcGF0aDogc3RyaW5nLCBwb3NpdGlvbjogMSB8IC0xKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgaW5zZXJ0JCA9IHRoaXMucmVzdFByb3h5LmNyZWF0ZUJ5UGF0aChmcGF0aCwgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGluc2VydCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0RhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuaW5zZXJ0RW50aXR5QnlQYXRoKGZwYXRoLCBuZXdEYXRhLCBuZXdEYXRhLCBwb3NpdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIG5ld0VudGl0eTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja5pZOWIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZCDlhoXnoIFcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZChpZDogc3RyaW5nLCBpZlNhdmU/OiBib29sZWFuKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBpZlNhdmUgPSAoaWZTYXZlID09PSB1bmRlZmluZWQpID8gdHJ1ZSA6IGlmU2F2ZTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gQmVmUHJveHlVdGlsLmJ1aWxkUmVxdWVzdEluZm8odGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIGxldCBkZWxldGUkO1xyXG4gICAgaWYgKGlmU2F2ZSkge1xyXG4gICAgICBkZWxldGUkID0gdGhpcy5yZXN0UHJveHkuZGVsZXRlQW5kU2F2ZShpZCwgcmVxdWVzdEluZm8pO1xyXG4gICAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVsZXRlJCA9IHRoaXMucmVzdFNlcnZpY2UuZXh0ZW5kRGVsZXRlKGlkLCByZXF1ZXN0SW5mbyk7XHJcbiAgICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0eUJ5SWQoaWQpO1xyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmFkZENoYW5nZSh7IGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOW5tuS/neWtmFxyXG4gICAqIEBwYXJhbSBpZCDopoHliKDpmaTnmoTlrp7kvZNpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVBbmRTYXZlQnlJZChpZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IEJlZlByb3h5VXRpbC5idWlsZFJlcXVlc3RJbmZvKHRoaXMucmVwb3NpdG9yeSk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0UHJveHkuZGVsZXRlQW5kU2F2ZShpZCwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IGRlbGV0ZSQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGlkKTtcclxuICAgICAgICAvLyB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuYWRkQ2hhbmdlKHsgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/liKDpmaRcclxuICAgKiBAcGFyYW0gaWQg5YaF56CBXHJcbiAgICogQHBhcmFtIGlmU2F2ZSDmmK/lkKbkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQnlJZHMoaWRzOiBzdHJpbmdbXSwgaWZTYXZlPzogYm9vbGVhbik6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgaWZTYXZlID0gKGlmU2F2ZSA9PT0gdW5kZWZpbmVkKSA/IHRydWUgOiBpZlNhdmU7XHJcbiAgICAvLyDmnI3liqHlmajnq6/liKDpmaRcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRCYXRjaERlbGV0ZShpZHMsIHJlcXVlc3RJbmZvKTtcclxuXHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKGlmU2F2ZSkge1xyXG4gICAgICAgICAgLy8g5omn6KGM5L+d5a2YXHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5hcHBseUNoYW5nZXNCeUlkQXJyYXkoaWRzKS5waXBlKFxyXG4gICAgICAgICAgICB0YXAocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyDku47lrp7kvZPpm4blkIjkuK3liKDpmaRcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnJlbW92ZUVudGl0aWVzKFxyXG4gICAgICAgICAgICAgICAgICAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja0VudGl0eVZhbHVlRXhpc3RzKHZhbHVlLCBpZHMpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIOS7juWunuS9k+mbhuWQiOS4reWIoOmZpFxyXG4gICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXRpZXMoXHJcbiAgICAgICAgICAgICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrRW50aXR5VmFsdWVFeGlzdHModmFsdWUsIGlkcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoaWRzICYmIGlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZXMgPSBbXTtcclxuICAgICAgICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICAgIGNoYW5nZXMucHVzaCh7IGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2VzKGNoYW5nZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrmlkc+aJuemHj+WIoOmZpOWunuS9k1xyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICogQHBhcmFtIGlmU2F2ZSDmmK/lkKbkv53lrZhcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hSZW1vdmUoaWRzOiBzdHJpbmdbXSwgaWZTYXZlOiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBkZWxldGUkID0gdGhpcy5yZXN0U2VydmljZS5leHRlbmRCYXRjaERlbGV0aW9uKGlkcywgcmVxdWVzdEluZm8pO1xyXG4gICAgLy8g5LuO5pys5Zyw5a6e5L2T6ZuG5ZCI5Lit56e76ZmkXHJcbiAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIGlmIChpZlNhdmUpIHtcclxuICAgICAgICAgIC8vIOaJp+ihjOS/neWtmFxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuYXBwbHlDaGFuZ2VzQnlJZEFycmF5KGlkcykucGlwZShcclxuICAgICAgICAgICAgdGFwKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUVudGl0aWVzKGlkcyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5LuO5a6e5L2T6ZuG5ZCI5Lit5Yig6ZmkXHJcbiAgICAgICAgICB0aGlzLnJlbW92ZUVudGl0aWVzKGlkcyk7XHJcbiAgICAgICAgICB0aGlzLmFkZEJhdGNoUmVtb3ZlSGlzdG9yeShpZHMpO1xyXG4gICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOa3u+WKoOaJuemHj+WIoOmZpOiusOW9leWIsOWPmOabtOiusOW9leS4rVxyXG4gICAqIEBwYXJhbSBpZHMgaWRzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhZGRCYXRjaFJlbW92ZUhpc3RvcnkoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKGlkcyAmJiBpZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBjaGFuZ2VzID0gW107XHJcbiAgICAgIGlkcy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICBjaGFuZ2VzLnB1c2goeyBkYXRhSWQ6IGlkLCBjaGFuZ2VUeXBlOiBEYXRhQ2hhbmdlVHlwZS5EZWxldGUgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuYWRkQ2hhbmdlcyhjaGFuZ2VzKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5LuO5a6e5L2T5LuT5bqT5Lit5om56YeP56e76Zmk5oyH5a6aaWTnmoTmlbDmja5cclxuICAgKiBAcGFyYW0gaWRzIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVtb3ZlRW50aXRpZXMoaWRzOiBzdHJpbmdbXSkge1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24ucmVtb3ZlRW50aXRpZXMoXHJcbiAgICAgICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrRW50aXR5VmFsdWVFeGlzdHModmFsdWUsIGlkcyk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOajgOa1i+WunuS9k+eahOS4u+mUruWAvOaYr+WQpuWtmOWcqOS6juaVsOe7hOS4re+8jOWmguaenOWtmOWcqOi/lOWbnnRydWVcclxuICAgKiBAcGFyYW0gYXJyYXkg5b6F6YGN5Y6G5pWw57uEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjaGVja0VudGl0eVZhbHVlRXhpc3RzKGVudGl0eTogRW50aXR5LCBwcmltYXJ5VmFsdWVBcnJheTogYW55W10pOiBib29sZWFuIHtcclxuICAgIGxldCBpc0V4aXN0SW5UYXJnZXRBcnJheSA9IGZhbHNlO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJpbWFyeVZhbHVlQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgaWYgKGVudGl0eS5wcmltYXJ5VmFsdWUgPT09IHByaW1hcnlWYWx1ZUFycmF5W2ldKSB7XHJcbiAgICAgICAgaXNFeGlzdEluVGFyZ2V0QXJyYXkgPSB0cnVlO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzRXhpc3RJblRhcmdldEFycmF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5a2Q57qnXHJcbiAgICogQHBhcmFtIHBhdGgg6Lev5b6EXHJcbiAgICogQHBhcmFtIGlkICAg5YaF56CBXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUJ5UGF0aChmcGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcblxyXG4gICAgLy8g5pyN5Yqh5Zmo56uv5Yig6ZmkXHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgZGVsZXRlJCA9IHRoaXMucmVzdFNlcnZpY2UuZXh0ZW5kRGVsZXRCeVBhdGgoZnBhdGgsIGlkLCByZXF1ZXN0SW5mbyk7XHJcblxyXG4gICAgLy8g5LuO5pys5Zyw5a6e5L2T6ZuG5ZCI5Lit56e76ZmkXHJcbiAgICByZXR1cm4gZGVsZXRlJC5waXBlKFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLnJlbW92ZUVudGl0eUJ5UGF0aChmcGF0aCwgaWQpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBmcGF0aCwgZGF0YUlkOiBpZCwgY2hhbmdlVHlwZTogRGF0YUNoYW5nZVR5cGUuRGVsZXRlIH0pO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WIoOmZpOWtkOe6p1xyXG4gICAqIEBwYXJhbSBmUGF0aCDot6/lvoRcclxuICAgKiBAcGFyYW0gaWRzICDlrZDnuqdpZOmbhuWQiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiYXRjaFJlbW92ZUJ5UGF0aChmUGF0aDogc3RyaW5nLCBpZHM6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG5cclxuICAgIC8vIOacjeWKoeWZqOerr+WIoOmZpFxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGRlbGV0ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLmJhdGNoRGVsZXRlQnlQYXRoKGZQYXRoLCBpZHMsIHJlcXVlc3RJbmZvKTtcclxuXHJcbiAgICAvLyDku47mnKzlnLDlrp7kvZPpm4blkIjkuK3np7vpmaRcclxuICAgIHJldHVybiBkZWxldGUkLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaWRBcnJheSA9IGlkcy5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGlmIChpZEFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGlkQXJyYXkuZm9yRWFjaCgoaWQpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIucmVtb3ZlRW50aXR5QnlQYXRoKGZQYXRoLCBpZCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5kYXRhQ2hhbmdlSGlzdG9yeS5hZGRDaGFuZ2UoeyBmcGF0aDogZlBhdGgsIGRhdGFJZDogaWQsIGNoYW5nZVR5cGU6IERhdGFDaGFuZ2VUeXBlLkRlbGV0ZSB9KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlsIZpZOWvueW6lOeahOWunuS9k+eahOWPmOabtOaPkOS6pOeahOacjeWKoeWZqOerr1xyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVDaGFuZ2VzQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKTtcclxuXHJcbiAgICAvLyDlj5jmm7Tpm4bkuI3lrZjlnKhcclxuICAgIGlmICghZW50aXR5LmNoYW5nZXMpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWPmOabtOmbhuS4uuepulxyXG4gICAgaWYgKGVudGl0eS5jaGFuZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2hhbmdlRGV0YWlsID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuYnVpbGRFbnRpdHlDaGFuZ2VEZXRhaWxCeUlkKGlkKTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlJCA9IHRoaXMucmVzdFNlcnZpY2UudXBkYXRlKGNoYW5nZURldGFpbCwgcmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHVwZGF0ZSQucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jbGVhckVudGl0eUNoYW5nZXNCeUlkKGlkKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqRwYXRo5a+55bqU5a6e5L2T55qE5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUNoYW5nZXNCeVBhdGgocGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHRocm93IG5ldyBFcnJvcignTm90IEltcGxlbWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o+Q5Lqk5omA5pyJ5Y+Y5pu0XHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUFsbENoYW5nZXMoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcblxyXG4gICAgLy8g6YGN5Y6G5a6e5L2T77yM5o+Q5Lqk5Y+Y5pu0XHJcbiAgICBjb25zdCB1cGRhdGVSZXN1bHRzOiBPYnNlcnZhYmxlPGJvb2xlYW4+W10gPSBbXTtcclxuICAgIGNvbnN0IGVudGl0aWVzOiBFbnRpdHlbXSA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLnRvQXJyYXkoKTtcclxuICAgIGlmIChlbnRpdGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGVudGl0aWVzLmZvckVhY2goKGVudGl0eTogRW50aXR5KSA9PiB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCQgPSB0aGlzLnVwZGF0ZUNoYW5nZXNCeUlkKGVudGl0eS5wcmltYXJ5VmFsdWUpO1xyXG4gICAgICB1cGRhdGVSZXN1bHRzLnB1c2godXBkYXRlUmVzdWx0JCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDkuLLogZTmtYFcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB6aXAoLi4udXBkYXRlUmVzdWx0cykucGlwZShcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlupTnlKjlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgYXBwbHlDaGFuZ2VzKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB0aGlzLnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IHNhdmUkID0gdGhpcy5yZXN0U2VydmljZS5zYXZlKHJlcXVlc3RJbmZvKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSBzYXZlJC5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmNsZWFyQWxsRW50aXR5Q2hhbmdlcygpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5jbGVhckFsbFZhcmlhYmxlQ2hhbmdlcyhyZXF1ZXN0SW5mby52YXJpYWJsZUNoYW5nZSk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmNsZWFyKCk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW6lOeUqGlkQXJyYXnlr7nlupTmlbDmja7nmoTlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgYXBwbHlDaGFuZ2VzQnlJZEFycmF5KGlkQXJyYXk6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3Qgc2F2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNhdmUocmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHNhdmUkLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY2xlYXJFbnRpdHlDaGFuZ2VzQnlBcnJheShpZEFycmF5KTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZGF0YUNoYW5nZUhpc3RvcnkuY2xlYXJCeUlkcyhpZEFycmF5KTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bqU55SoaWTlr7nlupTmlbDmja7nmoTlj5jmm7RcclxuICAgKi9cclxuICBwdWJsaWMgYXBwbHlDaGFuZ2VzQnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IHRoaXMucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3Qgc2F2ZSQgPSB0aGlzLnJlc3RTZXJ2aWNlLnNhdmUocmVxdWVzdEluZm8pO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHNhdmUkLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY2xlYXJFbnRpdHlDaGFuZ2VzQnlJZChpZCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmNsZWFyQnlJZHMoW2lkXSk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0JDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWxDaGFuZ2VzKG9wdGlvbnM/OiBhbnkpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IGNhbmNlbCQgPSB0aGlzLnJlc3RTZXJ2aWNlLmNhbmNlbChvcHRpb25zKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSBjYW5jZWwkLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuY2xlYXJBbGxFbnRpdHlDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmRhdGFDaGFuZ2VIaXN0b3J5LmNsZWFyKCk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBtYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5paw5aKe5LuO6KGoL+S7juS7juihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBwYXRoIOWunuS9k+e7keWumui3r+W+hO+8jGxpa2UgMS9jaGlsZHMgb3IgMS9jaGlsZHMvMTEvY2hpbGRjaGlsZHNcclxuICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlcyDpu5jorqTlrp7kvZPmlbDmja7mlbDnu4RcclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hBcHBlbmRCeVBhdGgocGF0aDogc3RyaW5nLCBkZWZhdWx0VmFsdWVzOiBBcnJheTxhbnk+KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBhcHBlbmQkID0gdGhpcy5yZXN0UHJveHkuYmF0Y2hBcHBlbmRCeVBhdGgocGF0aCwgZGVmYXVsdFZhbHVlcywgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGFwcGVuZCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5jcmVhdGVFbnRpdGllc0J5UGF0aChwYXRoLCBsaXN0KTtcclxuICAgICAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdGllc0J5UGF0aChwYXRocywgZW50aXRpZXMpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdGllcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aWsOWinuS4u+ihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBkZWZhdWx0VmFsdWVzIOm7mOiupOWunuS9k+aVsOaNruaVsOe7hFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiYXRjaEFwcGVuZChkZWZhdWx0VmFsdWVzOiBBcnJheTxhbnk+KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBhcHBlbmQkID0gdGhpcy5yZXN0UHJveHkuYmF0Y2hBcHBlbmQoZGVmYXVsdFZhbHVlcywgcmVxdWVzdEluZm8pO1xyXG4gICAgcmV0dXJuIGFwcGVuZCQucGlwZShcclxuICAgICAgbWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdGllcyhsaXN0KTtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdGllcyhlbnRpdGllcyk7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0aWVzO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qOA5p+l5b2T5YmN5Lia5Yqh5LiK5LiL5paH5YaF5piv5ZCm5a2Y5Zyo5pyq5L+d5a2Y55qE5Y+Y5pu0XHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHVibGljIGhhc0NoYW5nZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gdGhpcy5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICByZXR1cm4gdGhpcy5yZXN0U2VydmljZS5oYXNDaGFuZ2VzKHJlcXVlc3RJbmZvKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Y+Y5pu06ZuGXHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkUmVxdWVzdEluZm8oKTogUmVxdWVzdEluZm8ge1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm86IFJlcXVlc3RJbmZvID0ge1xyXG4gICAgICBkYXRhQ2hhbmdlOiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5idWlsZEFsbEVudGl0eUNoYW5nZURldGFpbHMoKSxcclxuICAgICAgdmFyaWFibGVDaGFuZ2U6IHRoaXMucmVwb3NpdG9yeS52YXJpYWJsZU1hbmFnZXIuYnVpbGRDaGFuZ2VEZXRhaWwoKVxyXG4gICAgfTtcclxuICAgIHJldHVybiByZXF1ZXN0SW5mbztcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEJlZkRhdGFTZXJ2aWNlIH07XHJcbiJdfQ==
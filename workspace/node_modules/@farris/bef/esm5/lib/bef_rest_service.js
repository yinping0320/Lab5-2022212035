/**
 * @fileoverview added by tsickle
 * Generated from: lib/bef_rest_service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
 * @Author: Witt
 * @Date: 2019-02-23 13:57:47
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2019-09-24 14:10:40
 */
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { throwError, of, EMPTY } from 'rxjs';
import { switchMap, map, catchError, tap } from 'rxjs/operators';
import { EventBus } from '@farris/devkit';
import { HttpHeaderUtil, HttpParamUtil, RequestInfoUtil, ResponseInfoUtil } from './utils/index';
import { BefRepository } from './bef_repository';
import { FrameworkSessionService } from './framework_session_service';
import { BefSessionService } from './session/index';
import { BefProxy } from './bef_proxy';
import { UriService } from './uri_service';
import { BefProxyExtend } from './bef_proxy_extend';
import { HttpService } from './http_service';
import { BackEndMessageUtil } from './utils/back_end_message.util';
import { BefSessionManager } from './session/bef_session_manager';
import { LoadingService } from '@farris/ui-loading';
/** @type {?} */
var GET = 'GET';
/** @type {?} */
var DELETE = 'DELETE';
/** @type {?} */
var PUT = 'PUT';
/** @type {?} */
var POST = 'POST';
/** @type {?} */
var PATCH = 'PATCH';
/**
 * BEF取数服务
 * 该服务由BefRepository实例化，不做注入，每个BefRepository拥有一个BefRestService实例。
 */
var BefRestService = /** @class */ (function () {
    /**
     * 构造函数
     * @param httpClient http服务
     * @param serverUri 应用服务器地址
     * @param beUri BE API地址
     */
    function BefRestService(httpClient, baseUri, frmSessionService, repository, eventBus) {
        this.httpClient = httpClient;
        this.httpService = new HttpService(this.httpClient);
        this.baseUri = baseUri;
        /** @type {?} */
        var injector = repository.getInjector();
        this.sessionService = new BefSessionService(httpClient, baseUri, frmSessionService, injector);
        this.repository = repository;
        this.eventBus = eventBus;
        if (injector) {
            this.loadingService = injector.get(LoadingService, null);
        }
    }
    Object.defineProperty(BefRestService.prototype, "proxy", {
        // #region 代理相关
        /**
         * 获取Bef代理
         */
        get: 
        // #region 代理相关
        /**
         * 获取Bef代理
         * @return {?}
         */
        function () {
            if (!!this.repository.proxy) {
                return this.repository.proxy;
            }
            else {
                return this.createBefProxy();
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 创建Bef代理
     */
    /**
     * 创建Bef代理
     * @private
     * @return {?}
     */
    BefRestService.prototype.createBefProxy = /**
     * 创建Bef代理
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var serverUri = this.repository.serverUri;
        /** @type {?} */
        var uriService = new UriService(serverUri);
        /** @type {?} */
        var defaultProxy = new BefProxy(this.httpClient, uriService);
        defaultProxy.setBaseUri(this.baseUri);
        /** @type {?} */
        var extend = new BefProxyExtend(this.repository);
        defaultProxy.setProxyExtend(extend);
        return defaultProxy;
    };
    // #endregion
    // #region 基本CRUD方法
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    // #endregion
    // #region 基本CRUD方法
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} entityFilter
     * @return {?}
     */
    BefRestService.prototype.query = 
    // #endregion
    // #region 基本CRUD方法
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} entityFilter
     * @return {?}
     */
    function (entityFilter) {
        return this.proxy.query(entityFilter);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} entityFilter
     * @param {?} requestInfo
     * @return {?}
     */
    BefRestService.prototype.extendQuery = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} entityFilter
     * @param {?} requestInfo
     * @return {?}
     */
    function (entityFilter, requestInfo) {
        return this.proxy.extendQuery(entityFilter, requestInfo);
    };
    /**
     * 分页查询各从表数据
     * @param id 主表id
     * @param retrieveParam 参数
     */
    /**
     * 分页查询各从表数据
     * @param {?} id 主表id
     * @param {?} retrieveParam 参数
     * @param {?} requestInfo
     * @return {?}
     */
    BefRestService.prototype.serviceRetrieve = /**
     * 分页查询各从表数据
     * @param {?} id 主表id
     * @param {?} retrieveParam 参数
     * @param {?} requestInfo
     * @return {?}
     */
    function (id, retrieveParam, requestInfo) {
        return this.proxy.serviceRetrieve(id, retrieveParam, requestInfo);
    };
    /**
     * 分页查询从表/从从表数据
     * @param params 查询参数
     */
    /**
     * 分页查询从表/从从表数据
     * @param {?} params 查询参数
     * @return {?}
     */
    BefRestService.prototype.queryChild = /**
     * 分页查询从表/从从表数据
     * @param {?} params 查询参数
     * @return {?}
     */
    function (params) {
        return this.proxy.queryChild(params);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @return {?}
     */
    BefRestService.prototype.retrieve = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.proxy.retrieve(id);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @param {?} requestInfo
     * @param {?=} retrieveParam
     * @return {?}
     */
    BefRestService.prototype.extendRetrieve = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @param {?} requestInfo
     * @param {?=} retrieveParam
     * @return {?}
     */
    function (id, requestInfo, retrieveParam) {
        return this.proxy.extendRetrieve(id, requestInfo, retrieveParam);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} defaultValue
     * @param {?=} requestInfo
     * @return {?}
     */
    BefRestService.prototype.create = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} defaultValue
     * @param {?=} requestInfo
     * @return {?}
     */
    function (defaultValue, requestInfo) {
        return this.proxy.create(defaultValue, requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} fpath
     * @param {?=} requestInfo
     * @return {?}
     */
    BefRestService.prototype.createByPath = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} fpath
     * @param {?=} requestInfo
     * @return {?}
     */
    function (fpath, requestInfo) {
        return this.proxy.createByPath(fpath, requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} changeDetail
     * @param {?=} requestInfo
     * @return {?}
     */
    BefRestService.prototype.update = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} changeDetail
     * @param {?=} requestInfo
     * @return {?}
     */
    function (changeDetail, requestInfo) {
        return this.proxy.update(changeDetail, requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} requestInfo
     * @return {?}
     */
    BefRestService.prototype.save = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} requestInfo
     * @return {?}
     */
    function (requestInfo) {
        return this.proxy.save(requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @return {?}
     */
    BefRestService.prototype.delete = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.proxy.delete(id);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    BefRestService.prototype.extendDelete = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    function (id, requestInfo) {
        return this.proxy.extendDelete(id, requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} fpath
     * @param {?} id
     * @return {?}
     */
    BefRestService.prototype.deletByPath = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} fpath
     * @param {?} id
     * @return {?}
     */
    function (fpath, id) {
        return this.proxy.deletByPath(fpath, id);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} fpath
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    BefRestService.prototype.extendDeletByPath = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} fpath
     * @param {?} id
     * @param {?} requestInfo
     * @return {?}
     */
    function (fpath, id, requestInfo) {
        return this.proxy.extendDeletByPath(fpath, id, requestInfo);
    };
    /**
     * @param {?} fPath
     * @param {?} ids
     * @param {?} requestInfo
     * @return {?}
     */
    BefRestService.prototype.batchDeleteByPath = /**
     * @param {?} fPath
     * @param {?} ids
     * @param {?} requestInfo
     * @return {?}
     */
    function (fPath, ids, requestInfo) {
        return this.proxy.batchDeleteByPath(fPath, ids, requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} ids
     * @return {?}
     */
    BefRestService.prototype.batchDelete = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} ids
     * @return {?}
     */
    function (ids) {
        return this.proxy.batchDelete(ids);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} ids
     * @param {?} requestInfo
     * @return {?}
     */
    BefRestService.prototype.extendBatchDelete = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} ids
     * @param {?} requestInfo
     * @return {?}
     */
    function (ids, requestInfo) {
        return this.proxy.extendBatchDelete(ids, requestInfo);
    };
    /**
     * 根据ids批量删除实体
     * @param ids ids
     * @param requestInfo requestInfo
     */
    /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} requestInfo requestInfo
     * @return {?}
     */
    BefRestService.prototype.extendBatchDeletion = /**
     * 根据ids批量删除实体
     * @param {?} ids ids
     * @param {?} requestInfo requestInfo
     * @return {?}
     */
    function (ids, requestInfo) {
        return this.proxy.extendBatchDeletion(ids, requestInfo);
    };
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} options
     * @return {?}
     */
    BefRestService.prototype.cancel = /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        return this.proxy.cancel(options);
    };
    /**
     * 检查当前业务上下文内是否存在未保存的变更
     * @param requestInfo requestInfo
     * @returns
     */
    /**
     * 检查当前业务上下文内是否存在未保存的变更
     * @param {?} requestInfo requestInfo
     * @return {?}
     */
    BefRestService.prototype.hasChanges = /**
     * 检查当前业务上下文内是否存在未保存的变更
     * @param {?} requestInfo requestInfo
     * @return {?}
     */
    function (requestInfo) {
        return this.proxy.hasChanges(requestInfo);
    };
    // #endregion
    // #region request方法
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     */
    // #endregion
    // #region request方法
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} url
     * @param {?} method
     * @param {?=} params
     * @param {?=} options
     * @param {?=} selfHandError
     * @param {?=} ignoreError
     * @param {?=} ignoreChanges
     * @return {?}
     */
    BefRestService.prototype.request = 
    // #endregion
    // #region request方法
    /**
     * 已废弃，请使用repository.proxy对应方法代替
     * @deprecated
     * @param {?} url
     * @param {?} method
     * @param {?=} params
     * @param {?=} options
     * @param {?=} selfHandError
     * @param {?=} ignoreError
     * @param {?=} ignoreChanges
     * @return {?}
     */
    function (url, method, params, options, selfHandError, ignoreError, ignoreChanges) {
        return this.innerRequest(url, method, params, options, selfHandError, ignoreError, ignoreChanges, false);
    };
    // tslint:disable: align
    /**
     * 调用后端方法
     * @param url url
     * @param method method
     * @param params params
     * @param options options
     * @param selfHandError 自己处理异常
     * @param ignoreError 忽略错误
     * @param ignoreChanges 忽略变更
     */
    // tslint:disable: align
    /**
     * 调用后端方法
     * @param {?} url url
     * @param {?} method method
     * @param {?=} params params
     * @param {?=} options options
     * @param {?=} selfHandError 自己处理异常
     * @param {?=} ignoreError 忽略错误
     * @param {?=} ignoreChanges 忽略变更
     * @return {?}
     */
    BefRestService.prototype.invoke = 
    // tslint:disable: align
    /**
     * 调用后端方法
     * @param {?} url url
     * @param {?} method method
     * @param {?=} params params
     * @param {?=} options options
     * @param {?=} selfHandError 自己处理异常
     * @param {?=} ignoreError 忽略错误
     * @param {?=} ignoreChanges 忽略变更
     * @return {?}
     */
    function (url, method, params, options, selfHandError, ignoreError, ignoreChanges) {
        if (options && options.body && options.body.RequestInfo) {
            throw new Error('请使用requestInfo提交变更');
        }
        return this.innerRequest(url, method, params, options, selfHandError, ignoreError, ignoreChanges, true);
    };
    /**
     * 内部的request方法
     */
    /**
     * 内部的request方法
     * @private
     * @param {?} url
     * @param {?} method
     * @param {?=} params
     * @param {?=} options
     * @param {?=} selfHandError
     * @param {?=} ignoreError
     * @param {?=} ignoreChanges
     * @param {?=} useCorrectRequestInfoCheckMethod
     * @return {?}
     */
    BefRestService.prototype.innerRequest = /**
     * 内部的request方法
     * @private
     * @param {?} url
     * @param {?} method
     * @param {?=} params
     * @param {?=} options
     * @param {?=} selfHandError
     * @param {?=} ignoreError
     * @param {?=} ignoreChanges
     * @param {?=} useCorrectRequestInfoCheckMethod
     * @return {?}
     */
    function (url, method, params, options, selfHandError, ignoreError, ignoreChanges, useCorrectRequestInfoCheckMethod) {
        var _this = this;
        options = options || {};
        /** @type {?} */
        var befSessionIdKey = 'BEFSessionID';
        // 是否自己处理异常
        if (typeof (selfHandError) === 'undefined' || typeof (selfHandError) !== 'boolean') {
            selfHandError = false;
        }
        // 是否忽略异常继续执行
        if (typeof (ignoreError) === 'undefined' || typeof (ignoreError) !== 'boolean') {
            ignoreError = false;
        }
        // 选择检查RequestInfo的方法
        if (typeof (useCorrectRequestInfoCheckMethod) === 'undefined' || typeof (useCorrectRequestInfoCheckMethod) !== 'boolean') {
            useCorrectRequestInfoCheckMethod = false;
        }
        /** @type {?} */
        var checkRequestInfoMethod = useCorrectRequestInfoCheckMethod ? this.existRequestInfo : this.hasRequestInfo;
        // params
        if (params) {
            // const httpParams = this.buildParams(params);
            options.params = params;
        }
        // 带有requestInfo的请求，请求成功后清空变更集
        /** @type {?} */
        var hasRequestInfo = checkRequestInfoMethod(options);
        /** @type {?} */
        var headers = HttpHeaderUtil.convertToHeaders(options.headers);
        // 串联session流和http流
        /** @type {?} */
        var formAppContext = this.repository.appContext.getFormAppContext();
        return BefSessionManager.getSessionId(formAppContext, this.sessionService).pipe(switchMap((/**
         * @param {?} sessionId
         * @return {?}
         */
        function (sessionId) {
            headers = _this.sessionService.extendRequestHeaders(headers);
            options.headers = HttpHeaderUtil.toJson(headers);
            options.observe = 'response';
            return _this.httpService.request(method, url, options);
        })), tap((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response.headers && response.headers.has(befSessionIdKey)) {
                _this.sessionService.setBeSessionId(response.headers.get(befSessionIdKey));
            }
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return response.body; })), map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var messages = ResponseInfoUtil.parseBackEndMessage(result);
            BackEndMessageUtil.handleMessage(messages, _this.repository.getInjector());
            return _this.handleReponseInfo(result, hasRequestInfo, ignoreChanges, options);
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            return _this.handleErrors(error, selfHandError, ignoreError);
        })));
    };
    /**
     * 处理返回结果
     */
    /**
     * 处理返回结果
     * @param {?} result
     * @param {?} hasRequestInfo
     * @param {?} ignoreChanges
     * @param {?} options
     * @return {?}
     */
    BefRestService.prototype.handleReponseInfo = /**
     * 处理返回结果
     * @param {?} result
     * @param {?} hasRequestInfo
     * @param {?} ignoreChanges
     * @param {?} options
     * @return {?}
     */
    function (result, hasRequestInfo, ignoreChanges, options) {
        if (hasRequestInfo) {
            // 如果有带有RequestInfo，则按新结构处理
            // 1、应用服务器端返回的变更；
            // 2、清空本地变更集；
            // 3、返回新结构
            if (result && result.innerDataChange && ignoreChanges !== true) {
                this.repository.handleDataChangeDetails(result.innerDataChange);
            }
            if (result && result.innerVariableChange) {
                this.repository.handleVariableChangeDetail(result.innerVariableChange);
            }
            this.repository.clearAllEntityChanges();
            /** @type {?} */
            var requestInfo = RequestInfoUtil.getRequestInfo(options);
            /** @type {?} */
            var variableChange = requestInfo && requestInfo.variableChange;
            this.repository.clearAllVariableChanges(variableChange);
            return result;
        }
        else {
            // 如果有没有RequestInfo，则按老的方式处理
            // 1、不处理服务器端返回的变更：跟老的行为一样；
            // 2、不清理本地变更：因为变更没有提交；
            // 3、返回老的结构：兼容老的代码
            return this.unWrapResponseInfo(result);
        }
    };
    /**
     * 错误处理
     */
    /**
     * 错误处理
     * @param {?} error
     * @param {?} selfHandError
     * @param {?} ignoreError
     * @return {?}
     */
    BefRestService.prototype.handleErrors = /**
     * 错误处理
     * @param {?} error
     * @param {?} selfHandError
     * @param {?} ignoreError
     * @return {?}
     */
    function (error, selfHandError, ignoreError) {
        this.clearLoading();
        if (!!selfHandError) {
            return throwError(error);
        }
        else {
            /** @type {?} */
            var formAppContext = this.repository.appContext.getFormAppContext();
            /** @type {?} */
            var applicationId = formAppContext.ApplicationId;
            /** @type {?} */
            var applicationContext = window[applicationId] || {};
            /** @type {?} */
            var messages = ResponseInfoUtil.parseBackEndError(error);
            /** @type {?} */
            var bizMessages = BackEndMessageUtil.getFormlessMessages(messages);
            /** @type {?} */
            var isExceptionHandlerExist = !!applicationContext.isExceptionHandlerExist;
            /** @type {?} */
            var isExistFormlessMessage = bizMessages && bizMessages.length > 0 || false;
            /** @type {?} */
            var needThrowException = !(error && error.error && error.error.extensionMessage && BackEndMessageUtil.isBackEndMessageHandlerExist(this.repository.getInjector()) && !isExistFormlessMessage);
            /** @type {?} */
            var willThrowException = !!this.eventBus && isExceptionHandlerExist && needThrowException;
            BackEndMessageUtil.handleMessage(messages, this.repository.getInjector(), { hasThrowError: willThrowException, isException: true, eventBus: this.eventBus, error: error, formAppContext: formAppContext });
            if (!!this.eventBus && isExceptionHandlerExist) {
                if (ResponseInfoUtil.isReported401Error(error)) {
                    return throwError(error);
                }
                if (needThrowException) {
                    this.eventBus.post('Exception', '', 'onException', error, formAppContext);
                }
                if (ignoreError) {
                    return of(null);
                }
                else {
                    return EMPTY;
                }
            }
            else {
                return throwError(error);
            }
        }
    };
    // #endregion
    // #region 工具方法
    /**
     * 清空Loading
     */
    // #endregion
    // #region 工具方法
    /**
     * 清空Loading
     * @private
     * @return {?}
     */
    BefRestService.prototype.clearLoading = 
    // #endregion
    // #region 工具方法
    /**
     * 清空Loading
     * @private
     * @return {?}
     */
    function () {
        var e_1, _a;
        /** @type {?} */
        var ifLoadingExists = window['DEVKIT_LOADING_SERVICE'] &&
            window['DEVKIT_LOADING_SERVICE'] instanceof Array &&
            window['DEVKIT_LOADING_SERVICE'].length > 0 || false;
        if (ifLoadingExists === false) {
            this.clearAllLoading();
            return;
        }
        /** @type {?} */
        var loadingServices = window['DEVKIT_LOADING_SERVICE'];
        try {
            for (var loadingServices_1 = tslib_1.__values(loadingServices), loadingServices_1_1 = loadingServices_1.next(); !loadingServices_1_1.done; loadingServices_1_1 = loadingServices_1.next()) {
                var service = loadingServices_1_1.value;
                if (typeof (service.destroy) === 'function') {
                    service.destroy();
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (loadingServices_1_1 && !loadingServices_1_1.done && (_a = loadingServices_1.return)) _a.call(loadingServices_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.clearAllLoading();
    };
    /**
     * @private
     * @return {?}
     */
    BefRestService.prototype.clearAllLoading = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.loadingService) {
            window.setTimeout((/**
             * @return {?}
             */
            function () {
                _this.loadingService.clearAll();
            }), 350);
        }
    };
    /**
     * 处理返回值，兼容老版本
     */
    /**
     * 处理返回值，兼容老版本
     * @private
     * @param {?} result
     * @return {?}
     */
    BefRestService.prototype.unWrapResponseInfo = /**
     * 处理返回值，兼容老版本
     * @private
     * @param {?} result
     * @return {?}
     */
    function (result) {
        return ResponseInfoUtil.unWrapResponseInfo(result);
    };
    /**
     * 是否带有RequestInfo
     */
    /**
     * 是否带有RequestInfo
     * @private
     * @param {?} options
     * @return {?}
     */
    BefRestService.prototype.hasRequestInfo = /**
     * 是否带有RequestInfo
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return RequestInfoUtil.hasRequestInfoWithR(options);
    };
    /**
     * 是否带有requestInfo
     */
    /**
     * 是否带有requestInfo
     * @private
     * @param {?} options
     * @return {?}
     */
    BefRestService.prototype.existRequestInfo = /**
     * 是否带有requestInfo
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        return RequestInfoUtil.hasRequestInfo(options);
    };
    /**
     * 构造HttpParams对象
     * @param params 请求参数
     */
    /**
     * 构造HttpParams对象
     * @private
     * @param {?} params 请求参数
     * @return {?}
     */
    BefRestService.prototype.buildParams = /**
     * 构造HttpParams对象
     * @private
     * @param {?} params 请求参数
     * @return {?}
     */
    function (params) {
        return HttpParamUtil.buildParams(params);
    };
    /**
     * 构造带RequestInfo的Body（适用于多个参数的情况，如果只有一个RequestInfo参数，body=RequestInfo）
     * @body 未携带RequestInfo的body，格式形如: {key1: value1, key2: value2}
     */
    /**
     * 构造带RequestInfo的Body（适用于多个参数的情况，如果只有一个RequestInfo参数，body=RequestInfo）
     * \@body 未携带RequestInfo的body，格式形如: {key1: value1, key2: value2}
     * @param {?} body
     * @return {?}
     */
    BefRestService.prototype.buildBodyWithRequestInfo = /**
     * 构造带RequestInfo的Body（适用于多个参数的情况，如果只有一个RequestInfo参数，body=RequestInfo）
     * \@body 未携带RequestInfo的body，格式形如: {key1: value1, key2: value2}
     * @param {?} body
     * @return {?}
     */
    function (body) {
        return RequestInfoUtil.buildBodyWithRequestInfo(body, this.repository);
    };
    /**
     * 构造RequestInfo
     */
    /**
     * 构造RequestInfo
     * @return {?}
     */
    BefRestService.prototype.buildRequestInfo = /**
     * 构造RequestInfo
     * @return {?}
     */
    function () {
        return RequestInfoUtil.buildRequestInfo(this.repository);
    };
    BefRestService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BefRestService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: String },
        { type: FrameworkSessionService },
        { type: BefRepository },
        { type: EventBus }
    ]; };
    return BefRestService;
}());
if (false) {
    /**
     * @type {?}
     * @private
     */
    BefRestService.prototype.repository;
    /**
     * @type {?}
     * @private
     */
    BefRestService.prototype.loadingService;
    /**
     * httpClient
     * @type {?}
     * @private
     */
    BefRestService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    BefRestService.prototype.httpService;
    /**
     * 会话服务
     * @type {?}
     */
    BefRestService.prototype.sessionService;
    /**
     * 接口根Uri
     * @type {?}
     */
    BefRestService.prototype.baseUri;
    /**
     * 事件总线
     * @type {?}
     */
    BefRestService.prototype.eventBus;
}
export { BefRestService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVmX3Jlc3Rfc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvYmVmLyIsInNvdXJjZXMiOlsibGliL2JlZl9yZXN0X3NlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBT0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUEyQixNQUFNLHNCQUFzQixDQUFDO0FBQzNFLE9BQU8sRUFBYyxVQUFVLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN6RCxPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakUsT0FBTyxFQUFVLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFcEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN2QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxN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OztJQUEvQixVQUFnQyxJQUFTO1FBQ3ZDLE9BQU8sZUFBZSxDQUFDLHdCQUF3QixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUVEOztPQUVHOzs7OztJQUNJLHlDQUFnQjs7OztJQUF2QjtRQUNFLE9BQU8sZUFBZSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUMzRCxDQUFDOztnQkF6ZEYsVUFBVTs7OztnQkEzQkYsVUFBVTs7Z0JBTVYsdUJBQXVCO2dCQUR2QixhQUFhO2dCQUZMLFFBQVE7O0lBcWZ6QixxQkFBQztDQUFBLEFBN2RELElBNmRDOzs7Ozs7SUExZEMsb0NBQTBDOzs7OztJQUMxQyx3Q0FBdUM7Ozs7OztJQUl2QyxvQ0FBK0I7Ozs7O0lBQy9CLHFDQUFpQzs7Ozs7SUFLakMsd0NBQXlDOzs7OztJQUt6QyxpQ0FBdUI7Ozs7O0lBS3ZCLGtDQUEwQjs7QUF1YzVCLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAqIEBBdXRob3I6IFdpdHRcclxuICogQERhdGU6IDIwMTktMDItMjMgMTM6NTc6NDdcclxuICogQExhc3QgTW9kaWZpZWQgYnk6IGFhbGl6endlbGxcclxuICogQExhc3QgTW9kaWZpZWQgdGltZTogMjAxOS0wOS0yNCAxNDoxMDo0MFxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIHRocm93RXJyb3IsIG9mLCBFTVBUWSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAsIG1hcCwgY2F0Y2hFcnJvciwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBFbnRpdHksIEV2ZW50QnVzIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBIdHRwSGVhZGVyVXRpbCwgSHR0cFBhcmFtVXRpbCwgUmVxdWVzdEluZm9VdGlsLCBSZXNwb25zZUluZm9VdGlsIH0gZnJvbSAnLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnkgfSBmcm9tICcuL2JlZl9yZXBvc2l0b3J5JztcclxuaW1wb3J0IHsgRnJhbWV3b3JrU2Vzc2lvblNlcnZpY2UgfSBmcm9tICcuL2ZyYW1ld29ya19zZXNzaW9uX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBCZWZTZXNzaW9uU2VydmljZSB9IGZyb20gJy4vc2Vzc2lvbi9pbmRleCc7XHJcbmltcG9ydCB7IENoYW5nZURldGFpbCwgUmVxdWVzdEluZm8sIFJlc3BvbnNlSW5mbywgUmV0cmlldmVQYXJhbSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBCZWZQcm94eSB9IGZyb20gJy4vYmVmX3Byb3h5JztcclxuaW1wb3J0IHsgVXJpU2VydmljZSB9IGZyb20gJy4vdXJpX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBCZWZQcm94eUV4dGVuZCB9IGZyb20gJy4vYmVmX3Byb3h5X2V4dGVuZCc7XHJcbmltcG9ydCB7IEh0dHBTZXJ2aWNlIH0gZnJvbSAnLi9odHRwX3NlcnZpY2UnO1xyXG5pbXBvcnQgeyBCYWNrRW5kTWVzc2FnZVV0aWwgfSBmcm9tICcuL3V0aWxzL2JhY2tfZW5kX21lc3NhZ2UudXRpbCc7XHJcbmltcG9ydCB7IEJlZlNlc3Npb25NYW5hZ2VyIH0gZnJvbSAnLi9zZXNzaW9uL2JlZl9zZXNzaW9uX21hbmFnZXInO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcblxyXG5jb25zdCBHRVQgPSAnR0VUJztcclxuY29uc3QgREVMRVRFID0gJ0RFTEVURSc7XHJcbmNvbnN0IFBVVCA9ICdQVVQnO1xyXG5jb25zdCBQT1NUID0gJ1BPU1QnO1xyXG5jb25zdCBQQVRDSCA9ICdQQVRDSCc7XHJcblxyXG4vKipcclxuICogQkVG5Y+W5pWw5pyN5YqhXHJcbiAqIOivpeacjeWKoeeUsUJlZlJlcG9zaXRvcnnlrp7kvovljJbvvIzkuI3lgZrms6jlhaXvvIzmr4/kuKpCZWZSZXBvc2l0b3J55oul5pyJ5LiA5LiqQmVmUmVzdFNlcnZpY2Xlrp7kvovjgIJcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgQmVmUmVzdFNlcnZpY2Uge1xyXG5cclxuICBwcml2YXRlIHJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8RW50aXR5PjtcclxuICBwcml2YXRlIGxvYWRpbmdTZXJ2aWNlOiBMb2FkaW5nU2VydmljZTtcclxuICAvKipcclxuICAgKiBodHRwQ2xpZW50XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50O1xyXG4gIHByaXZhdGUgaHR0cFNlcnZpY2U6IEh0dHBTZXJ2aWNlO1xyXG5cclxuICAvKipcclxuICAgKiDkvJror53mnI3liqFcclxuICAgKi9cclxuICBwdWJsaWMgc2Vzc2lvblNlcnZpY2U6IEJlZlNlc3Npb25TZXJ2aWNlO1xyXG5cclxuICAvKipcclxuICAgKiDmjqXlj6PmoLlVcmlcclxuICAgKi9cclxuICBwdWJsaWMgYmFzZVVyaTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiDkuovku7bmgLvnur9cclxuICAgKi9cclxuICBwdWJsaWMgZXZlbnRCdXM6IEV2ZW50QnVzO1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKiBAcGFyYW0gaHR0cENsaWVudCBodHRw5pyN5YqhXHJcbiAgICogQHBhcmFtIHNlcnZlclVyaSDlupTnlKjmnI3liqHlmajlnLDlnYBcclxuICAgKiBAcGFyYW0gYmVVcmkgQkUgQVBJ5Zyw5Z2AXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBodHRwQ2xpZW50OiBIdHRwQ2xpZW50LCBiYXNlVXJpOiBzdHJpbmcsXHJcbiAgICBmcm1TZXNzaW9uU2VydmljZTogRnJhbWV3b3JrU2Vzc2lvblNlcnZpY2UsXHJcbiAgICByZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PEVudGl0eT4sXHJcbiAgICBldmVudEJ1cz86IEV2ZW50QnVzXHJcbiAgKSB7XHJcbiAgICB0aGlzLmh0dHBDbGllbnQgPSBodHRwQ2xpZW50O1xyXG4gICAgdGhpcy5odHRwU2VydmljZSA9IG5ldyBIdHRwU2VydmljZSh0aGlzLmh0dHBDbGllbnQpO1xyXG4gICAgdGhpcy5iYXNlVXJpID0gYmFzZVVyaTtcclxuICAgIGNvbnN0IGluamVjdG9yID0gcmVwb3NpdG9yeS5nZXRJbmplY3RvcigpO1xyXG4gICAgdGhpcy5zZXNzaW9uU2VydmljZSA9IG5ldyBCZWZTZXNzaW9uU2VydmljZShodHRwQ2xpZW50LCBiYXNlVXJpLCBmcm1TZXNzaW9uU2VydmljZSwgaW5qZWN0b3IpO1xyXG4gICAgdGhpcy5yZXBvc2l0b3J5ID0gcmVwb3NpdG9yeTtcclxuICAgIHRoaXMuZXZlbnRCdXMgPSBldmVudEJ1cztcclxuICAgIGlmIChpbmplY3Rvcikge1xyXG4gICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlID0gaW5qZWN0b3IuZ2V0KExvYWRpbmdTZXJ2aWNlLCBudWxsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOS7o+eQhuebuOWFs1xyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZCZWbku6PnkIZcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IHByb3h5KCk6IEJlZlByb3h5IHtcclxuICAgIGlmICghIXRoaXMucmVwb3NpdG9yeS5wcm94eSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LnByb3h5O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQmVmUHJveHkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIm+W7ukJlZuS7o+eQhlxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlQmVmUHJveHkoKSB7XHJcbiAgICBjb25zdCBzZXJ2ZXJVcmkgPSB0aGlzLnJlcG9zaXRvcnkuc2VydmVyVXJpO1xyXG4gICAgY29uc3QgdXJpU2VydmljZSA9IG5ldyBVcmlTZXJ2aWNlKHNlcnZlclVyaSk7XHJcbiAgICBjb25zdCBkZWZhdWx0UHJveHkgPSBuZXcgQmVmUHJveHkodGhpcy5odHRwQ2xpZW50LCB1cmlTZXJ2aWNlKTtcclxuICAgIGRlZmF1bHRQcm94eS5zZXRCYXNlVXJpKHRoaXMuYmFzZVVyaSk7XHJcbiAgICBjb25zdCBleHRlbmQgPSBuZXcgQmVmUHJveHlFeHRlbmQodGhpcy5yZXBvc2l0b3J5KTtcclxuICAgIGRlZmF1bHRQcm94eS5zZXRQcm94eUV4dGVuZChleHRlbmQpO1xyXG4gICAgcmV0dXJuIGRlZmF1bHRQcm94eTtcclxuICB9XHJcblxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24g5Z+65pysQ1JVROaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgcXVlcnkoZW50aXR5RmlsdGVyPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LnF1ZXJ5KGVudGl0eUZpbHRlcik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kUXVlcnkoZW50aXR5RmlsdGVyOiBhbnksIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS5leHRlbmRRdWVyeShlbnRpdHlGaWx0ZXIsIHJlcXVlc3RJbmZvKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5YiG6aG15p+l6K+i5ZCE5LuO6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGlkIOS4u+ihqGlkXHJcbiAgICogQHBhcmFtIHJldHJpZXZlUGFyYW0g5Y+C5pWwXHJcbiAgICovXHJcbiAgcHVibGljIHNlcnZpY2VSZXRyaWV2ZShpZDogc3RyaW5nLCByZXRyaWV2ZVBhcmFtOiBhbnksIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS5zZXJ2aWNlUmV0cmlldmUoaWQsIHJldHJpZXZlUGFyYW0sIHJlcXVlc3RJbmZvKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5YiG6aG15p+l6K+i5LuO6KGoL+S7juS7juihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBwYXJhbXMg5p+l6K+i5Y+C5pWwXHJcbiAgICovXHJcbiAgcHVibGljIHF1ZXJ5Q2hpbGQocGFyYW1zOiBhbnkpIHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LnF1ZXJ5Q2hpbGQocGFyYW1zKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77yM6K+35L2/55SocmVwb3NpdG9yeS5wcm94eeWvueW6lOaWueazleS7o+abv1xyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIHJldHJpZXZlKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMucHJveHkucmV0cmlldmUoaWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77yM6K+35L2/55SocmVwb3NpdG9yeS5wcm94eeWvueW6lOaWueazleS7o+abv1xyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIGV4dGVuZFJldHJpZXZlKGlkOiBzdHJpbmcsIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbywgcmV0cmlldmVQYXJhbT86IFJldHJpZXZlUGFyYW0pOiBPYnNlcnZhYmxlPFJlc3BvbnNlSW5mbz4ge1xyXG4gICAgcmV0dXJuIHRoaXMucHJveHkuZXh0ZW5kUmV0cmlldmUoaWQsIHJlcXVlc3RJbmZvLCByZXRyaWV2ZVBhcmFtKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8jOivt+S9v+eUqHJlcG9zaXRvcnkucHJveHnlr7nlupTmlrnms5Xku6Pmm79cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGUoZGVmYXVsdFZhbHVlPzogYW55LCByZXF1ZXN0SW5mbz86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmNyZWF0ZShkZWZhdWx0VmFsdWUsIHJlcXVlc3RJbmZvKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8jOivt+S9v+eUqHJlcG9zaXRvcnkucHJveHnlr7nlupTmlrnms5Xku6Pmm79cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGVCeVBhdGgoZnBhdGg6IHN0cmluZywgcmVxdWVzdEluZm8/OiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS5jcmVhdGVCeVBhdGgoZnBhdGgsIHJlcXVlc3RJbmZvKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8jOivt+S9v+eUqHJlcG9zaXRvcnkucHJveHnlr7nlupTmlrnms5Xku6Pmm79cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHVwZGF0ZShjaGFuZ2VEZXRhaWw6IENoYW5nZURldGFpbCwgcmVxdWVzdEluZm8/OiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS51cGRhdGUoY2hhbmdlRGV0YWlsLCByZXF1ZXN0SW5mbyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgc2F2ZShyZXF1ZXN0SW5mbz86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LnNhdmUocmVxdWVzdEluZm8pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77yM6K+35L2/55SocmVwb3NpdG9yeS5wcm94eeWvueW6lOaWueazleS7o+abv1xyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIGRlbGV0ZShpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmRlbGV0ZShpZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kRGVsZXRlKGlkOiBzdHJpbmcsIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS5leHRlbmREZWxldGUoaWQsIHJlcXVlc3RJbmZvKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8jOivt+S9v+eUqHJlcG9zaXRvcnkucHJveHnlr7nlupTmlrnms5Xku6Pmm79cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZWxldEJ5UGF0aChmcGF0aDogc3RyaW5nLCBpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmRlbGV0QnlQYXRoKGZwYXRoLCBpZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kRGVsZXRCeVBhdGgoZnBhdGg6IHN0cmluZywgaWQ6IHN0cmluZywgcmVxdWVzdEluZm86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxSZXNwb25zZUluZm8+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmV4dGVuZERlbGV0QnlQYXRoKGZwYXRoLCBpZCwgcmVxdWVzdEluZm8pO1xyXG4gIH1cclxuICBwdWJsaWMgYmF0Y2hEZWxldGVCeVBhdGgoZlBhdGg6IHN0cmluZywgaWRzOiBzdHJpbmcsIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8UmVzcG9uc2VJbmZvPiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS5iYXRjaERlbGV0ZUJ5UGF0aChmUGF0aCwgaWRzLCByZXF1ZXN0SW5mbyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOW3suW6n+W8g++8jOivt+S9v+eUqHJlcG9zaXRvcnkucHJveHnlr7nlupTmlrnms5Xku6Pmm79cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBiYXRjaERlbGV0ZShpZHM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmJhdGNoRGVsZXRlKGlkcyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgZXh0ZW5kQmF0Y2hEZWxldGUoaWRzOiBzdHJpbmdbXSwgcmVxdWVzdEluZm86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxSZXNwb25zZUluZm8+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmV4dGVuZEJhdGNoRGVsZXRlKGlkcywgcmVxdWVzdEluZm8pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmoLnmja5pZHPmibnph4/liKDpmaTlrp7kvZNcclxuICAgKiBAcGFyYW0gaWRzIGlkc1xyXG4gICAqIEBwYXJhbSByZXF1ZXN0SW5mbyByZXF1ZXN0SW5mb1xyXG4gICAqL1xyXG4gIHB1YmxpYyBleHRlbmRCYXRjaERlbGV0aW9uKGlkczogc3RyaW5nW10sIHJlcXVlc3RJbmZvOiBSZXF1ZXN0SW5mbyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm94eS5leHRlbmRCYXRjaERlbGV0aW9uKGlkcywgcmVxdWVzdEluZm8pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bey5bqf5byD77yM6K+35L2/55SocmVwb3NpdG9yeS5wcm94eeWvueW6lOaWueazleS7o+abv1xyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICovXHJcbiAgcHVibGljIGNhbmNlbChvcHRpb25zPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnByb3h5LmNhbmNlbChvcHRpb25zKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qOA5p+l5b2T5YmN5Lia5Yqh5LiK5LiL5paH5YaF5piv5ZCm5a2Y5Zyo5pyq5L+d5a2Y55qE5Y+Y5pu0XHJcbiAgICogQHBhcmFtIHJlcXVlc3RJbmZvIHJlcXVlc3RJbmZvXHJcbiAgICogQHJldHVybnMgXHJcbiAgICovXHJcbiAgcHVibGljIGhhc0NoYW5nZXMocmVxdWVzdEluZm86IFJlcXVlc3RJbmZvKTogT2JzZXJ2YWJsZTxhbnk+e1xyXG4gICAgcmV0dXJuIHRoaXMucHJveHkuaGFzQ2hhbmdlcyhyZXF1ZXN0SW5mbyk7XHJcbiAgfVxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcblxyXG4gIC8vICNyZWdpb24gcmVxdWVzdOaWueazlVxyXG5cclxuICAvKipcclxuICAgKiDlt7Llup/lvIPvvIzor7fkvb/nlKhyZXBvc2l0b3J5LnByb3h55a+55bqU5pa55rOV5Luj5pu/XHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKi9cclxuICBwdWJsaWMgcmVxdWVzdChcclxuICAgIHVybDogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGFyYW1zPzogYW55LCBvcHRpb25zPzogYW55LFxyXG4gICAgc2VsZkhhbmRFcnJvcj86IGJvb2xlYW4sIGlnbm9yZUVycm9yPzogYm9vbGVhbiwgaWdub3JlQ2hhbmdlcz86IGJvb2xlYW5cclxuICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5uZXJSZXF1ZXN0KHVybCwgbWV0aG9kLCBwYXJhbXMsIG9wdGlvbnMsIHNlbGZIYW5kRXJyb3IsIGlnbm9yZUVycm9yLCBpZ25vcmVDaGFuZ2VzLCBmYWxzZSk7XHJcbiAgfVxyXG4gIC8vIHRzbGludDpkaXNhYmxlOiBhbGlnblxyXG5cclxuICAvKipcclxuICAgKiDosIPnlKjlkI7nq6/mlrnms5VcclxuICAgKiBAcGFyYW0gdXJsIHVybFxyXG4gICAqIEBwYXJhbSBtZXRob2QgbWV0aG9kXHJcbiAgICogQHBhcmFtIHBhcmFtcyBwYXJhbXNcclxuICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zXHJcbiAgICogQHBhcmFtIHNlbGZIYW5kRXJyb3Ig6Ieq5bex5aSE55CG5byC5bi4XHJcbiAgICogQHBhcmFtIGlnbm9yZUVycm9yIOW/veeVpemUmeivr1xyXG4gICAqIEBwYXJhbSBpZ25vcmVDaGFuZ2VzIOW/veeVpeWPmOabtFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbnZva2UodXJsOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXJhbXM/OiBhbnksIG9wdGlvbnM/OiBhbnksXHJcbiAgICBzZWxmSGFuZEVycm9yPzogYm9vbGVhbiwgaWdub3JlRXJyb3I/OiBib29sZWFuLCBpZ25vcmVDaGFuZ2VzPzogYm9vbGVhbikge1xyXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5ib2R5ICYmIG9wdGlvbnMuYm9keS5SZXF1ZXN0SW5mbykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+ivt+S9v+eUqHJlcXVlc3RJbmZv5o+Q5Lqk5Y+Y5pu0Jyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5pbm5lclJlcXVlc3QodXJsLCBtZXRob2QsIHBhcmFtcywgb3B0aW9ucywgc2VsZkhhbmRFcnJvciwgaWdub3JlRXJyb3IsIGlnbm9yZUNoYW5nZXMsIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YaF6YOo55qEcmVxdWVzdOaWueazlVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5uZXJSZXF1ZXN0KFxyXG4gICAgdXJsOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXJhbXM/OiBhbnksIG9wdGlvbnM/OiBhbnksXHJcbiAgICBzZWxmSGFuZEVycm9yPzogYm9vbGVhbiwgaWdub3JlRXJyb3I/OiBib29sZWFuLCBpZ25vcmVDaGFuZ2VzPzogYm9vbGVhbixcclxuICAgIHVzZUNvcnJlY3RSZXF1ZXN0SW5mb0NoZWNrTWV0aG9kPzogYm9vbGVhblxyXG4gICkge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICBjb25zdCBiZWZTZXNzaW9uSWRLZXkgPSAnQkVGU2Vzc2lvbklEJztcclxuXHJcbiAgICAvLyDmmK/lkKboh6rlt7HlpITnkIblvILluLhcclxuICAgIGlmICh0eXBlb2YgKHNlbGZIYW5kRXJyb3IpID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgKHNlbGZIYW5kRXJyb3IpICE9PSAnYm9vbGVhbicpIHtcclxuICAgICAgc2VsZkhhbmRFcnJvciA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaYr+WQpuW/veeVpeW8guW4uOe7p+e7reaJp+ihjFxyXG4gICAgaWYgKHR5cGVvZiAoaWdub3JlRXJyb3IpID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgKGlnbm9yZUVycm9yKSAhPT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgIGlnbm9yZUVycm9yID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6YCJ5oup5qOA5p+lUmVxdWVzdEluZm/nmoTmlrnms5VcclxuICAgIGlmICh0eXBlb2YgKHVzZUNvcnJlY3RSZXF1ZXN0SW5mb0NoZWNrTWV0aG9kKSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mICh1c2VDb3JyZWN0UmVxdWVzdEluZm9DaGVja01ldGhvZCkgIT09ICdib29sZWFuJykge1xyXG4gICAgICB1c2VDb3JyZWN0UmVxdWVzdEluZm9DaGVja01ldGhvZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY2hlY2tSZXF1ZXN0SW5mb01ldGhvZCA9IHVzZUNvcnJlY3RSZXF1ZXN0SW5mb0NoZWNrTWV0aG9kID8gdGhpcy5leGlzdFJlcXVlc3RJbmZvIDogdGhpcy5oYXNSZXF1ZXN0SW5mbztcclxuXHJcbiAgICAvLyBwYXJhbXNcclxuICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgLy8gY29uc3QgaHR0cFBhcmFtcyA9IHRoaXMuYnVpbGRQYXJhbXMocGFyYW1zKTtcclxuICAgICAgb3B0aW9ucy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5bim5pyJcmVxdWVzdEluZm/nmoTor7fmsYLvvIzor7fmsYLmiJDlip/lkI7muIXnqbrlj5jmm7Tpm4ZcclxuICAgIGNvbnN0IGhhc1JlcXVlc3RJbmZvID0gY2hlY2tSZXF1ZXN0SW5mb01ldGhvZChvcHRpb25zKTtcclxuICAgIGxldCBoZWFkZXJzID0gSHR0cEhlYWRlclV0aWwuY29udmVydFRvSGVhZGVycyhvcHRpb25zLmhlYWRlcnMpO1xyXG5cclxuICAgIC8vIOS4suiBlHNlc3Npb27mtYHlkoxodHRw5rWBXHJcbiAgICBjb25zdCBmb3JtQXBwQ29udGV4dCA9IHRoaXMucmVwb3NpdG9yeS5hcHBDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICByZXR1cm4gQmVmU2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbklkKGZvcm1BcHBDb250ZXh0LCB0aGlzLnNlc3Npb25TZXJ2aWNlKS5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKHNlc3Npb25JZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaGVhZGVycyA9IHRoaXMuc2Vzc2lvblNlcnZpY2UuZXh0ZW5kUmVxdWVzdEhlYWRlcnMoaGVhZGVycyk7XHJcbiAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gSHR0cEhlYWRlclV0aWwudG9Kc29uKGhlYWRlcnMpO1xyXG4gICAgICAgIG9wdGlvbnMub2JzZXJ2ZSA9ICdyZXNwb25zZSc7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFNlcnZpY2UucmVxdWVzdChtZXRob2QsIHVybCwgb3B0aW9ucyk7XHJcbiAgICAgIH0pLFxyXG4gICAgICB0YXAoKHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVycyAmJiByZXNwb25zZS5oZWFkZXJzLmhhcyhiZWZTZXNzaW9uSWRLZXkpKSB7XHJcbiAgICAgICAgICB0aGlzLnNlc3Npb25TZXJ2aWNlLnNldEJlU2Vzc2lvbklkKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KGJlZlNlc3Npb25JZEtleSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgocmVzcG9uc2U6IGFueSkgPT4gcmVzcG9uc2UuYm9keSksXHJcbiAgICAgIG1hcCgocmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IFJlc3BvbnNlSW5mb1V0aWwucGFyc2VCYWNrRW5kTWVzc2FnZShyZXN1bHQpO1xyXG4gICAgICAgIEJhY2tFbmRNZXNzYWdlVXRpbC5oYW5kbGVNZXNzYWdlKG1lc3NhZ2VzLCB0aGlzLnJlcG9zaXRvcnkuZ2V0SW5qZWN0b3IoKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVJlcG9uc2VJbmZvKHJlc3VsdCwgaGFzUmVxdWVzdEluZm8sIGlnbm9yZUNoYW5nZXMsIG9wdGlvbnMpO1xyXG4gICAgICB9KSxcclxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcnMoZXJyb3IsIHNlbGZIYW5kRXJyb3IsIGlnbm9yZUVycm9yKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbov5Tlm57nu5PmnpxcclxuICAgKi9cclxuICBwdWJsaWMgaGFuZGxlUmVwb25zZUluZm8ocmVzdWx0OiBhbnksIGhhc1JlcXVlc3RJbmZvOiBib29sZWFuLCBpZ25vcmVDaGFuZ2VzOiBib29sZWFuLCBvcHRpb25zOiBhbnkpOiBhbnkge1xyXG4gICAgaWYgKGhhc1JlcXVlc3RJbmZvKSB7XHJcbiAgICAgIC8vIOWmguaenOacieW4puaciVJlcXVlc3RJbmZv77yM5YiZ5oyJ5paw57uT5p6E5aSE55CGXHJcbiAgICAgIC8vIDHjgIHlupTnlKjmnI3liqHlmajnq6/ov5Tlm57nmoTlj5jmm7TvvJtcclxuICAgICAgLy8gMuOAgea4heepuuacrOWcsOWPmOabtOmbhu+8m1xyXG4gICAgICAvLyAz44CB6L+U5Zue5paw57uT5p6EXHJcbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmlubmVyRGF0YUNoYW5nZSAmJiBpZ25vcmVDaGFuZ2VzICE9PSB0cnVlKSB7XHJcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5LmhhbmRsZURhdGFDaGFuZ2VEZXRhaWxzKHJlc3VsdC5pbm5lckRhdGFDaGFuZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmlubmVyVmFyaWFibGVDaGFuZ2UpIHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnkuaGFuZGxlVmFyaWFibGVDaGFuZ2VEZXRhaWwocmVzdWx0LmlubmVyVmFyaWFibGVDaGFuZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeS5jbGVhckFsbEVudGl0eUNoYW5nZXMoKTtcclxuICAgICAgY29uc3QgcmVxdWVzdEluZm8gPSBSZXF1ZXN0SW5mb1V0aWwuZ2V0UmVxdWVzdEluZm8ob3B0aW9ucyk7XHJcbiAgICAgIGNvbnN0IHZhcmlhYmxlQ2hhbmdlID0gcmVxdWVzdEluZm8gJiYgcmVxdWVzdEluZm8udmFyaWFibGVDaGFuZ2U7XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeS5jbGVhckFsbFZhcmlhYmxlQ2hhbmdlcyh2YXJpYWJsZUNoYW5nZSk7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyDlpoLmnpzmnInmsqHmnIlSZXF1ZXN0SW5mb++8jOWImeaMieiAgeeahOaWueW8j+WkhOeQhlxyXG4gICAgICAvLyAx44CB5LiN5aSE55CG5pyN5Yqh5Zmo56uv6L+U5Zue55qE5Y+Y5pu077ya6Lef6ICB55qE6KGM5Li65LiA5qC377ybXHJcbiAgICAgIC8vIDLjgIHkuI3muIXnkIbmnKzlnLDlj5jmm7TvvJrlm6DkuLrlj5jmm7TmsqHmnInmj5DkuqTvvJtcclxuICAgICAgLy8gM+OAgei/lOWbnuiAgeeahOe7k+aehO+8muWFvOWuueiAgeeahOS7o+eggVxyXG4gICAgICByZXR1cm4gdGhpcy51bldyYXBSZXNwb25zZUluZm8ocmVzdWx0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmUmeivr+WkhOeQhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYW5kbGVFcnJvcnMoZXJyb3I6IGFueSwgc2VsZkhhbmRFcnJvcjogYm9vbGVhbiwgaWdub3JlRXJyb3I6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy5jbGVhckxvYWRpbmcoKTtcclxuXHJcbiAgICBpZiAoISFzZWxmSGFuZEVycm9yKSB7XHJcbiAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGZvcm1BcHBDb250ZXh0ID0gdGhpcy5yZXBvc2l0b3J5LmFwcENvbnRleHQuZ2V0Rm9ybUFwcENvbnRleHQoKTtcclxuICAgICAgY29uc3QgYXBwbGljYXRpb25JZCA9IGZvcm1BcHBDb250ZXh0LkFwcGxpY2F0aW9uSWQ7XHJcbiAgICAgIGNvbnN0IGFwcGxpY2F0aW9uQ29udGV4dDogYW55ID0gd2luZG93W2FwcGxpY2F0aW9uSWRdIHx8IHt9O1xyXG4gICAgICBjb25zdCBtZXNzYWdlcyA9IFJlc3BvbnNlSW5mb1V0aWwucGFyc2VCYWNrRW5kRXJyb3IoZXJyb3IpO1xyXG4gICAgICBjb25zdCBiaXpNZXNzYWdlcyA9IEJhY2tFbmRNZXNzYWdlVXRpbC5nZXRGb3JtbGVzc01lc3NhZ2VzKG1lc3NhZ2VzKTtcclxuICAgICAgY29uc3QgaXNFeGNlcHRpb25IYW5kbGVyRXhpc3QgPSAhIWFwcGxpY2F0aW9uQ29udGV4dC5pc0V4Y2VwdGlvbkhhbmRsZXJFeGlzdDtcclxuICAgICAgY29uc3QgaXNFeGlzdEZvcm1sZXNzTWVzc2FnZSA9IGJpek1lc3NhZ2VzICYmIGJpek1lc3NhZ2VzLmxlbmd0aCA+IDAgfHwgZmFsc2U7XHJcbiAgICAgIGNvbnN0IG5lZWRUaHJvd0V4Y2VwdGlvbiA9ICEoZXJyb3IgJiYgZXJyb3IuZXJyb3IgJiYgZXJyb3IuZXJyb3IuZXh0ZW5zaW9uTWVzc2FnZSAmJiBCYWNrRW5kTWVzc2FnZVV0aWwuaXNCYWNrRW5kTWVzc2FnZUhhbmRsZXJFeGlzdCh0aGlzLnJlcG9zaXRvcnkuZ2V0SW5qZWN0b3IoKSkgJiYgIWlzRXhpc3RGb3JtbGVzc01lc3NhZ2UpO1xyXG4gICAgICBjb25zdCB3aWxsVGhyb3dFeGNlcHRpb24gPSAhIXRoaXMuZXZlbnRCdXMgJiYgaXNFeGNlcHRpb25IYW5kbGVyRXhpc3QgJiYgbmVlZFRocm93RXhjZXB0aW9uO1xyXG4gICAgICBCYWNrRW5kTWVzc2FnZVV0aWwuaGFuZGxlTWVzc2FnZShtZXNzYWdlcywgdGhpcy5yZXBvc2l0b3J5LmdldEluamVjdG9yKCksIHsgaGFzVGhyb3dFcnJvcjogd2lsbFRocm93RXhjZXB0aW9uLCBpc0V4Y2VwdGlvbjogdHJ1ZSwgZXZlbnRCdXM6IHRoaXMuZXZlbnRCdXMsIGVycm9yLCBmb3JtQXBwQ29udGV4dCB9KTtcclxuICAgICAgaWYgKCEhdGhpcy5ldmVudEJ1cyAmJiBpc0V4Y2VwdGlvbkhhbmRsZXJFeGlzdCkge1xyXG4gICAgICAgIGlmIChSZXNwb25zZUluZm9VdGlsLmlzUmVwb3J0ZWQ0MDFFcnJvcihlcnJvcikpIHtcclxuICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5lZWRUaHJvd0V4Y2VwdGlvbikge1xyXG4gICAgICAgICAgdGhpcy5ldmVudEJ1cy5wb3N0KCdFeGNlcHRpb24nLCAnJywgJ29uRXhjZXB0aW9uJywgZXJyb3IsIGZvcm1BcHBDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlnbm9yZUVycm9yKSB7XHJcbiAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBFTVBUWTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG5cclxuICAvLyAjcmVnaW9uIOW3peWFt+aWueazlVxyXG5cclxuICAvKipcclxuICAgKiDmuIXnqbpMb2FkaW5nXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjbGVhckxvYWRpbmcoKTogdm9pZCB7XHJcbiAgICBjb25zdCBpZkxvYWRpbmdFeGlzdHMgPSB3aW5kb3dbJ0RFVktJVF9MT0FESU5HX1NFUlZJQ0UnXSAmJlxyXG4gICAgICB3aW5kb3dbJ0RFVktJVF9MT0FESU5HX1NFUlZJQ0UnXSBpbnN0YW5jZW9mIEFycmF5ICYmXHJcbiAgICAgIHdpbmRvd1snREVWS0lUX0xPQURJTkdfU0VSVklDRSddLmxlbmd0aCA+IDAgfHwgZmFsc2U7XHJcblxyXG4gICAgaWYgKGlmTG9hZGluZ0V4aXN0cyA9PT0gZmFsc2UpIHtcclxuICAgICAgdGhpcy5jbGVhckFsbExvYWRpbmcoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxvYWRpbmdTZXJ2aWNlczogYW55W10gPSB3aW5kb3dbJ0RFVktJVF9MT0FESU5HX1NFUlZJQ0UnXTtcclxuICAgIGZvciAoY29uc3Qgc2VydmljZSBvZiBsb2FkaW5nU2VydmljZXMpIHtcclxuICAgICAgaWYgKHR5cGVvZiAoc2VydmljZS5kZXN0cm95KSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHNlcnZpY2UuZGVzdHJveSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmNsZWFyQWxsTG9hZGluZygpO1xyXG4gIH1cclxuICBwcml2YXRlIGNsZWFyQWxsTG9hZGluZygpIHtcclxuICAgIGlmICh0aGlzLmxvYWRpbmdTZXJ2aWNlKSB7XHJcbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmNsZWFyQWxsKCk7XHJcbiAgICAgIH0sIDM1MCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhui/lOWbnuWAvO+8jOWFvOWuueiAgeeJiOacrFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdW5XcmFwUmVzcG9uc2VJbmZvKHJlc3VsdDogYW55KTogYW55IHtcclxuICAgIHJldHVybiBSZXNwb25zZUluZm9VdGlsLnVuV3JhcFJlc3BvbnNlSW5mbyhyZXN1bHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5piv5ZCm5bim5pyJUmVxdWVzdEluZm9cclxuICAgKi9cclxuICBwcml2YXRlIGhhc1JlcXVlc3RJbmZvKG9wdGlvbnM6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIFJlcXVlc3RJbmZvVXRpbC5oYXNSZXF1ZXN0SW5mb1dpdGhSKG9wdGlvbnMpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmmK/lkKbluKbmnIlyZXF1ZXN0SW5mb1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZXhpc3RSZXF1ZXN0SW5mbyhvcHRpb25zOiBhbnkpIHtcclxuICAgIHJldHVybiBSZXF1ZXN0SW5mb1V0aWwuaGFzUmVxdWVzdEluZm8ob3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKBIdHRwUGFyYW1z5a+56LGhXHJcbiAgICogQHBhcmFtIHBhcmFtcyDor7fmsYLlj4LmlbBcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkUGFyYW1zKHBhcmFtczogYW55KTogSHR0cFBhcmFtcyB7XHJcbiAgICByZXR1cm4gSHR0cFBhcmFtVXRpbC5idWlsZFBhcmFtcyhwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5bimUmVxdWVzdEluZm/nmoRCb2R577yI6YCC55So5LqO5aSa5Liq5Y+C5pWw55qE5oOF5Ya177yM5aaC5p6c5Y+q5pyJ5LiA5LiqUmVxdWVzdEluZm/lj4LmlbDvvIxib2R5PVJlcXVlc3RJbmZv77yJXHJcbiAgICogQGJvZHkg5pyq5pC65bimUmVxdWVzdEluZm/nmoRib2R577yM5qC85byP5b2i5aaCOiB7a2V5MTogdmFsdWUxLCBrZXkyOiB2YWx1ZTJ9XHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkQm9keVdpdGhSZXF1ZXN0SW5mbyhib2R5OiBhbnkpOiBhbnkge1xyXG4gICAgcmV0dXJuIFJlcXVlc3RJbmZvVXRpbC5idWlsZEJvZHlXaXRoUmVxdWVzdEluZm8oYm9keSwgdGhpcy5yZXBvc2l0b3J5KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaehOmAoFJlcXVlc3RJbmZvXHJcbiAgICovXHJcbiAgcHVibGljIGJ1aWxkUmVxdWVzdEluZm8oKTogUmVxdWVzdEluZm8ge1xyXG4gICAgcmV0dXJuIFJlcXVlc3RJbmZvVXRpbC5idWlsZFJlcXVlc3RJbmZvKHRoaXMucmVwb3NpdG9yeSk7XHJcbiAgfVxyXG5cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBCZWZSZXN0U2VydmljZSB9O1xyXG5cclxuIl19
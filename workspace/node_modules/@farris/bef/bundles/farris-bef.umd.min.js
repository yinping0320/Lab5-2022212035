!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ecp-caf/caf-common"),require("date-fns"),require("@farris/ui-loading"),require("rxjs"),require("rxjs/operators"),require("rxjs/operators/map"),require("@angular/core"),require("@angular/common/http"),require("@farris/devkit")):"function"==typeof define&&define.amd?define("@farris/bef",["exports","@ecp-caf/caf-common","date-fns","@farris/ui-loading","rxjs","rxjs/operators","rxjs/operators/map","@angular/core","@angular/common/http","@farris/devkit"],t):t((e.farris=e.farris||{},e.farris.bef={}),e.cafCommon,e.dateFns,e.uiLoading,e.rxjs,e.rxjs.operators,e.rxjs["operators/map"],e.ng.core,e.ng.common.http,e.devkit)}(this,function(e,t,r,a,b,g,s,o,h,I){"use strict";var C=(n.Added="Added",n.Modify="Modify",n.Deleted="Deleted",n);function n(){}var l=new o.InjectionToken("@farris/be BE_SERVER_URL"),p=new o.InjectionToken("@farris/be BE_SESSION_HANDLING_STRATEGY_TOKEN"),S=(i.getPropInfo=function(e,t){var n,r,i,o=I.FieldMetadataUtil.getNgFields(e);Object.keys(o).forEach(function(e){e===t&&(n="NgField",r=null,i=o[e])});var a=I.FieldMetadataUtil.getNgObjects(e);Object.keys(a).forEach(function(e){e===t&&(n="NgObject",r=a[e].type,i=a[e])});var s=I.FieldMetadataUtil.getNgList(e);Object.keys(s).forEach(function(e){e===t&&(n="NgList",r=s[e].type,i=s[e])});var p=I.FieldMetadataUtil.getNgDynamic(e);return Object.keys(p).forEach(function(e){e===t&&(n="NgDynamic",r=p[e].type,i=p[e])}),{propType:n,propEntityType:r,propMetadata:i}},i.getPrimaryKey=function(e){var t=I.FieldMetadataUtil.getPrimaryFieldMetadata(e);return t?t.dataField:""},i.isObjectProp=function(e,t){var n=!1,r=I.FieldMetadataUtil.getNgObjects(e);return Object.keys(r).forEach(function(e){e===t&&(n=!0)}),n},i.isDynamicProp=function(e,t){var n=!1,r=I.FieldMetadataUtil.getNgDynamic(e);return Object.keys(r).forEach(function(e){e===t&&(n=!0)}),n},i.appendInitialData=function(e,t){var n=Object.assign({},t);delete n.id,delete n.parentID,e.initialData=n},i);function i(){}var u=(c.prototype.build=function(e){var t=this;return this.changeDetail={ChangeType:C.Modify,ChangeInfo:{DataId:""}},e.forEach(function(e){t.buildChangeDetail(e)}),this.changeDetail},c.prototype.buildChangeDetail=function(y){var d=y.path.concat();this.changeDetail.ChangeInfo.DataId||(this.changeDetail.ChangeInfo.DataId=d[0].split(":")[1]);for(var f=this.changeDetail,g=this.entityType,e=function(e){var t=v.getChangeInfo(f),n=d[e],r=S.getPropInfo(g,n),i=r.propType,o=r.propEntityType,a=r.propMetadata.dataField||n;if("NgField"===i){if(n===S.getPrimaryKey(g))return"continue";if(y.type!==I.ModifyType.ValueChange)throw Error("简单类型的属性上不支持ValueChange类型之外的变更");t[a]=y.value,f=null}else if("NgObject"===i)if(d[e+1].split(":")[1],d[e+1].split(":")[0]){var s=t[a],p=d.slice(0,e+1);s=(l=v.entityCollection.getEntityByPath(p))?l.toJSON(!0):{},t[a]=s,g=f=null}else c=(c=t[a])||{ChangeType:C.Modify,ChangeInfo:{}},t[a]=c,f=c,g=o;else if("NgList"===i){f.ChangeInfo[a]||(f.ChangeInfo[a]=[]);var u=f.ChangeInfo[a];if(e!==d.length-1){var c,h=d[e+1].split(":")[1];return(c=u.find(function(e){return e.ChangeInfo.DataId===h}))||(c=v.createEmptyChangeDetail(C.Modify,h),u.push(c)),f=c,g=o,"continue"}y.type===I.ModifyType.Add||y.type===I.ModifyType.Insert||(y.type,I.ModifyType.Remove),g=f=null}else if("NgDynamic"===i){p=d.slice(0,e+1);var l=v.entityCollection.getEntityByPath(p);t[a]={ChangeType:C.Modify,ChangeInfo:l?l.toJSON(!0):{}},g=f=null}},v=this,t=1;t<d.length&&f;t+=2)e(t)},c.prototype.getChangeInfo=function(e){return e.hasOwnProperty("ChangeInfo")?e.ChangeInfo:e},c.prototype.createEmptyChangeDetail=function(e,t){return{ChangeType:e,ChangeInfo:{DataId:t}}},c);function c(e,t){this.entityType=e,this.entityCollection=t}var y=(d.prototype.handle=function(e,t,n){this.handleChangeDetails(e,t,n)},d.prototype.handleChangeDetails=function(r,i,e){var o=this;e&&e.forEach(function(e){var t=e.ChangeInfo.dataId||e.ChangeInfo.DataId,n=o.getEntityById(i,t);n&&o.handleChangeDetail(r,n,e)})},d.prototype.handleChangeDetail=function(u,c,e){var h=this;if(e&&c&&e.ChangeType===C.Modify){var l=e.ChangeInfo;Object.keys(l).forEach(function(e){var t=S.getPropInfo(u,e),n=t.propType,r=t.propEntityType;if("NgField"===n)c[e]=l[e];else if("NgObject"===n){var i=c[e];if(i.primaryKey){var o=l[e];i.load(o)}else{var a=l[e];h.handleChangeDetail(r,i,a)}}else if("NgList"===n){var s=c[e],p=l[e];h.handleChangeDetails(r,s,p)}})}},d.prototype.getEntityById=function(e,t){return(e instanceof I.EntityCollection?e.getEntityById(t):e.get(t))||null},d);function d(){}var f=(v.prototype.getUserSessionId=function(){return this.sessionService.getUserSessionId()},v.prototype.getCurrentSessionId=function(e){var t,n=this.getRuntimeSessionId();if(n)return n;if(this.sessionService)if(e&&e.hasOwnProperty("tabId")){var r=e.tabId;t=this.sessionService.getCurrentSeesionId(r)}else t=this.sessionService.getCurrentSeesionId();return t=t||this.getUserSessionId()},v.prototype.getRuntimeSessionId=function(){var e=window.location.hash,t=this.parse(e);return t&&t.rsi||null},v.prototype.parse=function(e){return e?e.slice(e.indexOf("?")+1).split("&").reduce(function(e,t){var n,r=t.indexOf("="),i=t.slice(0,r),o=t.slice(r+1);return Object.assign(e,((n={})[i]=decodeURIComponent(o),n))},{}):{}},v.decorators=[{type:o.Injectable}],v.ctorParameters=function(){return[{type:t.SessionService,decorators:[{type:o.Optional}]}]},v);function v(e){this.sessionService=e}var m=(E.prototype.getItem=function(e){return this.getAllBeSessions()[e]},E.prototype.setItem=function(e,t){var n=this.getAllBeSessions();n[e]=t,this.setAllBeSessions(n)},E.prototype.removeItem=function(e){var t=this.getAllBeSessions();t[e]&&delete t[e],this.setAllBeSessions(t)},E.prototype.clear=function(e,t){!0===this.isInFramework()?this.removeItemsByFrmSessionId(e):this.removeItem(t)},E.prototype.removeItemsByFrmSessionId=function(t){var n=this.getAllBeSessions();Object.keys(n).forEach(function(e){!0===e.startsWith(t)&&delete n[e]}),this.setAllBeSessions(n)},E.prototype.getAllBeSessions=function(){var e=window.sessionStorage.getItem(this.sessionStorageKey);return e?JSON.parse(e):{}},E.prototype.setAllBeSessions=function(e){var t=JSON.stringify(e);window.sessionStorage.setItem(this.sessionStorageKey,t)},E.prototype.isInFramework=function(){var e=window.location.hash;return!!e&&-1!==e.indexOf("tabId=")},E);function E(){this.sessionStorageKey="BE_SESSION_ID"}var x=function(e,t){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function B(e,t){function n(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var P=function(){return(P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function R(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function D(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a}function q(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(D(arguments[t]));return e}var w=(T.convertToHeaders=function(t){if(1==(t=t||new h.HttpHeaders)instanceof h.HttpHeaders)return t;if(0<Object.keys(t).length){var n=new h.HttpHeaders;Object.keys(t).forEach(function(e){n=n.append(e,t[e])}),t=n}else t=new h.HttpHeaders;return t},T.appendSessionId=function(e,t){return e.append("SessionId",t)},T.appendCafRuntimeCommonVariable=function(e,t){return e.append("X-CAF-Runtime-CommonVariable",t)},T.appendCafRuntimeContext=function(e,t){return e.append("X-CAF-Runtime-Context",t)},T.appendContextType=function(e,t){return t=t||"application/json",e.append("Content-Type",t)},T.appendRequireMessage=function(e,t){return void 0===t&&(t=!0),e.append("Bff-Require-Message",t.toString())},T.appendFuncInstId=function(e,t){return e.append("Func-Inst-Id",t)},T.toJson=function(n){if(!(n instanceof h.HttpHeaders))return null;var r={};return n.keys().forEach(function(e){var t=n.getAll(e);1<t.length?r[e]=t:r[e]=t[0]||""}),r},T);function T(){}var O=(M.buildParams=function(e){var t=new h.HttpParams;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n].toString();t=t.append(n,r)}return t},M);function M(){}var j=(A.hasRequestInfo=function(e){if(!e||!e.body)return!1;var t=e.body;return!(!t.requestInfo||!t.requestInfo.dataChange)||!!t.dataChange},A.hasRequestInfoWithR=function(e){if(!e||!e.body)return!1;var t=e.body;return!(!t.RequestInfo||!t.RequestInfo.dataChange)||!!t.dataChange},A.buildRequestInfo=function(e){return{dataChange:e.entityManager.buildAllEntityChangeDetails(),variableChange:e.variableManager.buildChangeDetail()}},A.buildBodyWithRequestInfo=function(e,t){if(e.RequestInfo||e.requestInfo)return e;var n=this.buildRequestInfo(t);return Object.assign({},e,{requestInfo:n})},A.getRequestInfo=function(e){if(!e||!e.body)return null;var t=e.body;return t.requestInfo?t.requestInfo:t.dataChange||t.variableChange?t:null},A);function A(){}var U=(V.unWrapResponseInfo=function(e){if(!e)return e;if(!1===e.hasOwnProperty("returnValue"))return e.hasOwnProperty("result")&&e.hasOwnProperty("pagination")?e.result:e;var t=e.returnValue;return t&&t.hasOwnProperty("result")&&t.hasOwnProperty("pagination")?t.result:e.returnValue},V.isReported401Error=function(e){return 401===e.status},V.parseBackEndMessage=function(e){return e&&e.message&&Array.isArray(e.message)&&0<e.message.length?e.message:null},V.parseBackEndError=function(e){var t=e&&e.error;return t&&t.hasOwnProperty("extensionMessage")&&t.extensionMessage&&t.extensionMessage.hasOwnProperty("UIMsg")&&t.extensionMessage.UIMsg&&0<t.extensionMessage.UIMsg.length?JSON.parse(t.extensionMessage.UIMsg):null},V);function V(){}var H=(k.prototype.getService=function(){for(var e=window;!e.gspframeworkService&&e!==window.top&&this.isSameOrigin(e);)e=window.parent;return e.gspframeworkService&&e.gspframeworkService.rtf||{}},k.prototype.isSameOrigin=function(e){var t=window.location.host;try{if(e&&e.location&&"undefined"!=typeof e.location.host)return e.location.host===t}catch(n){return!1}return!1},Object.defineProperty(k.prototype,"params",{get:function(){return this.rtf&&this.rtf.hasOwnProperty("session")&&"function"==typeof this.rtf.session.getCommonVariable?this.rtf.session.getCommonVariable():null},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"httpService",{get:function(){return this.rtf&&this.rtf.hasOwnProperty("http")&&"function"==typeof this.rtf.http.request?this.rtf.http:null},enumerable:!0,configurable:!0}),k.prototype.request=function(e,t,n){return void 0===n&&(n={}),this.defaultHttpClient.request(e,t,n)},k.decorators=[{type:o.Injectable}],k.ctorParameters=function(){return[{type:h.HttpClient}]},k);function k(e){this.defaultHttpClient=e,this.httpClient=e,this.rtf=this.getService()}var F=(N.prototype.getFrmSessionId=function(e){return this.frmSessionService.getCurrentSessionId(e)},Object.defineProperty(N.prototype,"frmSessionId",{get:function(){return this.frmSessionService.getCurrentSessionId()},enumerable:!0,configurable:!0}),N.prototype.getFrameworkSessionId=function(e){return this.getFrmSessionId(e)},N.prototype.getSessionIdFromStorage=function(e){var t=this.getSessionStorageKey(e);return this.storageStrategy.getItem(t)},N);function N(e,t){this.storageStrategy=e,this.frmSessionService=t}var _,L=(B(K,_=F),K.prototype.getSessionId=function(){var e=this.getSessionIdFromStorage();return e?b.of(e):this.createSession()},K.prototype.setSessionId=function(e){var t=this.getSessionStorageKey();this.storageStrategy.setItem(t,e)},K.prototype.clearSessionId=function(){var e=this.getSessionStorageKey();this.storageStrategy.clear(this.frmSessionId,e)},K.prototype.extendRequestHeaders=function(e,t){var n=this.getFrameworkSessionId(t),r=this.getSessionIdFromStorage(t);return e=w.appendCafRuntimeCommonVariable(e,n),r&&(e=w.appendCafRuntimeContext(e,r),e=w.appendSessionId(e,r)),e=w.appendFuncInstId(e,this.beSessionUri)},K.prototype.handleReponseHeaders=function(e){},K.prototype.createSession=function(){var t=this,e={responseType:"text"};return this.frmSessionId&&(this.injector.get(I.AppContext,null),e.headers=new h.HttpHeaders({SessionId:this.frmSessionId}),e.headers=e.headers.append("X-CAF-Runtime-CommonVariable",this.frmSessionId),e.headers=e.headers.append("Func-Inst-Id",this.beSessionUri),e.headers=w.toJson(e.headers)),this.httpService.request("POST",this.beSessionUri,e).pipe(g.tap(function(e){t.setSessionId(e)}))},K.prototype.extendHttpHeader=function(){},K.prototype.getSessionStorageKey=function(e){return(e?this.getFrameworkSessionId(e):this.frmSessionId)+"_"+this.beSessionUri},K);function K(e,t,n,r,i){var o=_.call(this,e,t)||this;return o.beSessionUri=r,o.httpClient=n,o.httpService=new H(o.httpClient),o.injector=i,o}var z,G=(B(J,z=F),J.prototype.getSessionId=function(){var e=this.getSessionStorageKey(),t=this.storageStrategy.getItem(e);return b.of(t)},J.prototype.setSessionId=function(e){var t=this.getSessionStorageKey();this.storageStrategy.setItem(t,e)},J.prototype.clearSessionId=function(){var e=this.getSessionStorageKey();this.storageStrategy.removeItem(e)},J.prototype.extendRequestHeaders=function(e,t){var n=this.getFrameworkSessionId(t),r=this.getSessionIdFromStorage(t),i=this.injector.get(I.AppContext,null);if(i){var o=i.Token;e=w.appendFuncInstId(e,o)}return e=w.appendCafRuntimeCommonVariable(e,n),r&&(e=w.appendCafRuntimeContext(e,r)),e},J.prototype.handleReponseHeaders=function(e){},J.prototype.getSessionStorageKey=function(e){return(e?this.getFrameworkSessionId(e):this.frmSessionId)+"_"+this.beSessionUri},J);function J(e,t,n,r){var i=z.call(this,e,t)||this;return i.beSessionUri=n,i.injector=r,i}var W=(Q.prototype.create=function(e,t,n,r,i){var o=this.createStorageStrategy(),a=this.createBeSessionUri(n);return"UnifiedSession"===e?new G(o,t,a,i):new L(o,t,r,a,i)},Q.prototype.createStorageStrategy=function(){return new m},Q.prototype.createBeSessionUri=function(e){return e+"/service/createsession"},Q.decorators=[{type:o.Injectable}],Q);function Q(){}var Y=(Object.defineProperty(X.prototype,"token",{get:function(){return this.handlingStrategy.getFrameworkSessionId()},enumerable:!0,configurable:!0}),X.prototype.getBeSessionId=function(){return this.handlingStrategy.getSessionId()},X.prototype.setBeSessionId=function(e){this.handlingStrategy.setSessionId(e),this.setSessionId(e)},X.prototype.clearBeSessionId=function(){this.handlingStrategy.clearSessionId()},X.prototype.extendRequestHeaders=function(e,t){return this.handlingStrategy.extendRequestHeaders(e,t)},X.prototype.handleResponseHeaders=function(e){return this.handlingStrategy.handleReponseHeaders(e)},X.prototype.createBeSession=function(){return this.handlingStrategy.createSession()},X.prototype.setSessionId=function(e){var t=this.injector.get(I.AppContext,null,o.InjectFlags.Optional);t&&e&&t.params.set("sessionId",e)},X.prototype.createHandlingStrategy=function(e,t,n,r){var i;return i=(i=e?e.get(p,null,o.InjectFlags.Optional):"SeparatedSession")||"SeparatedSession",(new W).create(i,n,r,t,e)},X.decorators=[{type:o.Injectable}],X.ctorParameters=function(){return[{type:h.HttpClient},{type:String},{type:f},{type:o.Injector}]},X);function X(e,t,n,r){this.beBaseUri=t,this.injector=r,this.handlingStrategy=this.createHandlingStrategy(r,e,n,t)}var Z,$="@farris/bef NG_VARIABLE",ee=I.makePropDecorator($,function(e){return e}),te=(B(ne,Z=I.Repository),Object.defineProperty(ne.prototype,"restService",{get:function(){return this.dataService.restService},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"changeBuilder",{get:function(){return this.entityManager.changeBuilder},enumerable:!0,configurable:!0}),Object.defineProperty(ne.prototype,"changeHandler",{get:function(){return this.entityManager.changeHandler},enumerable:!0,configurable:!0}),ne.prototype.getList=function(){return this.dataService.getList(null,null,null,null)},ne.prototype.getById=function(e){return this.dataService.getById(e)},ne.prototype.updateById=function(e){return this.dataService.updateById(e)},ne.prototype.create=function(e){return this.dataService.create(e)},ne.prototype.append=function(e){return this.dataService.append(e)},ne.prototype.appendByPath=function(e){return this.dataService.appendByPath(e)},ne.prototype.removeById=function(e,t){return this.dataService.removeById(e,t)},ne.prototype.removeByIds=function(e,t){return this.dataService.removeByIds(e,t)},ne.prototype.removeByPath=function(e,t){return this.dataService.removeByPath(e,t)},ne.prototype.updateChangesById=function(e){return this.dataService.updateChangesById(e)},ne.prototype.updateChangesByPath=function(e,t){throw new Error("Not Implement")},ne.prototype.updateAllChanges=function(){return this.dataService.updateAllChanges()},ne.prototype.applyChanges=function(){return this.dataService.applyChanges()},ne.prototype.updateDataAndVariableChanges=function(){var e={FilterConditions:[],SortConditions:[],IsUsePagination:!0,Pagination:{PageIndex:1,PageSize:1,PageCount:0,TotalCount:0}},t=JSON.stringify(e),n=this.restService.buildRequestInfo();if(this.isEmptyRequestInfo(n))return b.of(null);var r=this.restService.baseUri+"/extension/query?entityFilter="+t,i={body:n};return this.restService.invoke(r,"PUT",null,i,!1,!0,!0)},ne.prototype.applyChangesById=function(e){return this.dataService.applyChangesById(e)},ne.prototype.cancelChanges=function(e){return this.dataService.cancelChanges(e)},ne.prototype.clearAllEntityChanges=function(){return this.entityManager.clearAllEntityChanges()},ne.prototype.getDataChangeDetails=function(){return this.entityManager.buildAllEntityChangeDetails()},ne.prototype.handleDataChangeDetails=function(e){return this.entityManager.handleDataChangeDetails(e)},ne.prototype.getVariableChangeDetail=function(){return this.variableManager.buildChangeDetail()},ne.prototype.handleVariableChangeDetail=function(e){this.variableManager.handleChangeDetail(e)},ne.prototype.isEmptyRequestInfo=function(e){return!e||(!e.dataChange||e.dataChange.length<1)&&(!e.variableChange||Object.keys(e.variableChange).length<1)},ne.decorators=[{type:o.Injectable}],ne.ctorParameters=function(){return[]},ne);function ne(){return Z.call(this)||this}var re,ie=(B(oe,re=I.EntityManager),oe.prototype.buildAllEntityChangeDetails=function(){var n=this,r=[];return this.entityCollection.getAllEntities().forEach(function(e){if(0!==e.changes.length){var t=n.changeBuilder.build(e.changes);t&&t.ChangeInfo&&t.ChangeInfo.DataId&&r.push(t)}}),r},oe.prototype.buildEntityChangeDetailById=function(e){var t=this.entityCollection.getEntityById(e);return 0===t.changes.length?null:this.changeBuilder.build(t.changes)},oe.prototype.handleDataChangeDetails=function(e){this.changeHandler.handle(this.entityType,this.entityCollection,e)},oe.prototype.reset=function(){this.entityCollection.clear()},oe);function oe(e){var t=re.call(this,e)||this;return t.changeBuilder=new u(t.entityCollection.entityType,t.entityCollection),t.changeHandler=new y,t}var ae=(se.createEmpty=function(e,t){var n={ChangeType:e,ChangeInfo:{}};return t&&(n.ChangeInfo.DataId=t),n},se.getChangeInfo=function(e){return!0===this.isChangeDetail(e)?e.ChangeInfo:e},se.isChangeDetail=function(e){var t=Object.keys(e);return 2===t.length&&-1<t.indexOf("ChangeType")&&-1<t.indexOf("ChangeInfo")},se);function se(){}var pe=(ue.prototype.handleChangeDetail=function(e){var i=this,o=e.ChangeInfo;Object.keys(o).forEach(function(e){var t=i.ngVariableMap.get(e);if(t){var n=t.mapping,r=o[e];i.getValueFromUIState(n)!==r&&(i.setValueToUIState(n,r),i.innerValueMap.set(e,r))}})},ue.prototype.buildChangeDetail=function(){var o=this,a=ae.createEmpty(C.Modify);return this.ngVariableMap.forEach(function(e,t){var n=e.mapping,r=o.getValueFromUIState(n),i=o.innerValueMap.get(t);!1===o.isValueEqual(r,i)&&o.appendToChangeInfo(a,t,r)}),0===Object.keys(a.ChangeInfo).length?null:a},ue.prototype.reset=function(){this.innerValueMap.clear()},ue.prototype.clearChanges=function(){var o=this;this.ngVariableMap.forEach(function(e,t){var n=e.mapping,r=o.getValueFromUIState(n),i=o.innerValueMap.get(t);!1===o.isValueEqual(r,i)&&o.innerValueMap.set(t,r)})},ue.prototype.clearChangeDetail=function(e){var i=this;e&&0!==Object.keys(e.ChangeInfo).length&&Object.keys(e.ChangeInfo).forEach(function(e){var t=i.ngVariableMap.get(e);if(t){var n=t.mapping,r=i.getValueFromUIState(n);i.innerValueMap.set(e,r)}})},ue.prototype.appendToChangeInfo=function(e,t,n){if(!0===this.isUdtVariable(n)){var r=ae.createEmpty(C.Modify);r.ChangeInfo=n,e.ChangeInfo[t]=r}else e.ChangeInfo[t]=n},ue.prototype.getValueFromUIState=function(e){var t=this.getRootUIState(),n=e.split(".").reduce(function(e,t){return e?e[t]:null},t);return n instanceof Date?r.format(n,"yyyy-MM-dd HH:mm:ss"):n},ue.prototype.getRootUIState=function(){var e=this.appContext.frameContextManager.getRootFrameContext();if(this.injector){var t=this.injector.get(I.FrameContext,null);t&&(e=t.getVirtualRootFrameContext()||e)}if(e)return e.uiState},ue.prototype.isValueEqual=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},ue.prototype.isUdtVariable=function(e){return e&&e.constructor&&"[object Object]"===e.toString()&&e.constructor.prototype.hasOwnProperty("isPrototypeOf")},ue.prototype.setValueToUIState=function(e,t){this.getRootUIState()[e]=t},ue.ctorParameters=function(){return[{type:I.AppContext},{type:undefined},{type:o.Injector,decorators:[{type:o.Optional}]}]},ue);function ue(e,t,n){var r=this;this.appContext=e,this.ngVariables=t,this.injector=n,this.ngVariableMap=new Map,this.innerValueMap=new Map,Object.keys(t).forEach(function(e){r.ngVariableMap.set(e,t[e])})}var ce=(he.buildRequestInfo=function(e){return{dataChange:e.entityManager.buildAllEntityChangeDetails(),variableChange:e.variableManager.buildChangeDetail()}},he);function he(){}var le=(ye.convertToPathArray=function(e,t){var r=this,n=I.BindingPathConverter.toBindingPathArray(e),i=[],o=t.list.currentItem;return i.push(o.primaryKeyValue),n.forEach(function(e){var t=I.PropertyUtil.getPropertyByName(o.properties,e);if(t.type!==I.BindingPropertyType.List)throw new Error(t.name+"不是子表对应的属性");var n=o[e];o=n.currentItem,i.push(r.trimTrailingS(e)),i.push(o.primaryKeyValue)}),i},ye.convertToPathUrl=function(e,t){var n=this.convertToPathArray(e,t);return n.pop(),"/"+n.join("/")},ye.convertToObjectCodes=function(e,t){for(var n=this.convertToPathArray(e,t),r=n.length,i=[],o=1;o<r;o+=2)i.push(n[o]);return i},ye.convertToDataIdsForUpdate=function(e,t){for(var n=this.convertToPathArray(e,t),r=n.length,i=[],o=0;o<r;o+=2)i.push(n[o]);return i},ye.convertToDataIdsForAdd=function(e,t){var n=this.convertToDataIdsForUpdate(e,t);return n.pop(),n},ye.convertPathToUrl=function(e){for(var t=e.split("/"),n=t.length-1;0<n;n--)t[n]&&t[n].endsWith("s")&&(t[n]=t[n].substr(0,t[n].length-1).toLowerCase());return t.join("/")},ye.trimTrailingS=function(e){return e.substr(0,e.length-1)},ye.convertPathsToNodeCodes=function(e){var t=[];return!e||e.length<1||e.filter(function(e){return!!e&&-1===e.indexOf(":")}).forEach(function(e){t.push(e)}),t},ye.convertPathsToIds=function(e){var t=[];return!e||e.length<1||e.filter(function(e){return!!e&&-1!==e.indexOf(":")}).forEach(function(e){t.push(e.split(":")[1])}),t},ye);function ye(){}var de=(Object.defineProperty(fe.prototype,"restProxy",{get:function(){return this.repository.restService.proxy},enumerable:!0,configurable:!0}),fe.prototype.getList=function(e,t,n,r){var p=this;0!==n&&(n=n||this.repository.entityCollection.pageSize,r=r||this.repository.entityCollection.pageIndex);var i=this.buildEntityFilter(e,t,n,r),o=this.restService.buildRequestInfo();return this.restProxy.extendQuery(i,o).pipe(g.map(function(e){var t=e.returnValue,n=t.result,r=[];n.forEach(function(e){var t=p.repository.buildEntity(e);S.appendInitialData(t,e),r.push(t)});var i=t.pagination;if(i&&0<Object.keys(i).length){var o=i.pageSize,a=i.pageIndex,s=i.totalCount;p.repository.entityCollection.updatePaginationInfoByPath("/",{pageIndex:a,pageSize:o,totalCount:s})}else p.repository.entityCollection.updatePaginationInfoByPath("/",{pageIndex:1,pageSize:0,totalCount:r.length});return p.repository.entityCollection.loadEntities(r),r}))},fe.prototype.filter=function(e,t,n,r){var p=this;0!==n&&(n=n||this.repository.entityCollection.pageSize,r=r||this.repository.entityCollection.pageIndex);var i=this.buildEntityFilter(e,t,n,r),o=this.restService.buildRequestInfo();return this.restProxy.filter(i,o).pipe(g.map(function(e){var t=e.returnValue,n=t.result,r=[];n.forEach(function(e){var t=p.repository.buildEntity(e);S.appendInitialData(t,e),r.push(t)});var i=t.pagination;if(i&&0<Object.keys(i).length){var o=i.pageSize,a=i.pageIndex,s=i.totalCount;p.repository.entityCollection.updatePaginationInfoByPath("/",{pageIndex:a,pageSize:o,totalCount:s})}else p.repository.entityCollection.updatePaginationInfoByPath("/",{pageIndex:1,pageSize:0,totalCount:r.length});return p.repository.entityCollection.loadEntities(r),r}))},fe.prototype.buildEntityFilter=function(e,t,n,r){return e||t||n||r?(e&&0<e.length&&(e[e.length-1].relation=0),{FilterConditions:e,SortConditions:t,IsUsePagination:0!==n,Pagination:{PageIndex:r,PageSize:n,PageCount:0,TotalCount:0}}):null},fe.prototype.getById=function(e){var r=this,t=this.restService.buildRequestInfo(),n=this.buildRetrieveParam();return n?this.getEntityById(e):this.restService.extendRetrieve(e,t,n).pipe(g.map(function(e){var t=e.returnValue,n=r.repository.buildEntity(t);return r.repository.entityCollection.loadEntities([n]),n}))},fe.prototype.getEntityById=function(e){var o=this,t=this.restService.buildRequestInfo(),n=this.buildRetrieveParam();return this.restService.serviceRetrieve(e,n,t).pipe(g.map(function(e){var t=e.returnValue||{},n=t.result,r=t.pagination;o.updatePagination(r);var i=o.repository.buildEntity(n);return o.repository.entityCollection.loadEntities([i]),i}))},fe.prototype.queryChild=function(p,e,t,n,r){var u=this,i=this.restService.buildRequestInfo(),o=le.convertPathsToNodeCodes(p).map(function(e){return e.substring(0,e.length-1)}),c=o[o.length-1],a=(this.repository.entityCollection.getPaginationConfigByPath("/"+c)||{}).pageSize,s=void 0===a?0:a,h=this.injector.get(I.ViewModel,null),l=!1;if(h&&(l=h.frameContext.appContext.params.get("forceQueryChild")||!1),0==s&&!l)return b.of(null);var y=le.convertPathsToIds(p),d=y[y.length-1],f={nodeCodes:o,ids:y,pagination:{pageIndex:e,pageSize:t},requestInfo:i};return this.restService.queryChild(f).pipe(g.map(function(e){var t=e.returnValue;if(!t)return null;var n=t.result,r=void 0===n?[]:n,i=t.pagination,o=void 0===i?{}:i,a=p.map(function(e,t){return e.includes(":")&&t%2==0?e.split(":")[1]:e}),s=u.repository.entityManager.createEntitiesByPath("/"+a.join("/"),r);u.repository.entityCollection.resetEntities(p,s),u.repository.entityCollection.setPaginationConfigByPath("/"+c,{pageIndex:o.pageIndex,pageSize:o.pageSize}),u.repository.entityCollection.setPaginationConfigByPath("/"+c+"_"+d,o)}))},fe.prototype.buildChildrenPagination=function(){var r=this.repository.entityCollection.getPaginationConfigByPath("/"),i={},o=[];return I.DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo,o),!o||o.length<1?null:(Object.keys(r).forEach(function(e){var t=r[e];if("object"==typeof t){var n=e&&e.includes("_")&&e.split("_")[0]||null;n&&o.includes(n+"s")||(i[e]=t)}}),i)},fe.prototype.updatePagination=function(t){var i=this;if(t){var e=[];I.DataTypeInfoUtil.getChildrenNodeCodes(this.repository.entityTypeInfo,e),e=e.map(function(e){return e.substr(0,e.length-1)}),!t||Object.keys(t).length<1?e&&0<e.length&&e.forEach(function(t){var n=i.repository.entityCollection.getPaginationConfigByPath("/"+t);if(n){var e=i.repository.entityCollection.getPaginationConfigByPath("/"),r=Object.keys(e).filter(function(e){return e.startsWith(t+"_")});r&&0<r.length&&r.forEach(function(e){i.repository.entityCollection.setPaginationConfigByPath("/"+e,{pageIndex:1,total:0,pageSize:n.pageSize})})}}):Object.keys(t).forEach(function(e){i.repository.entityCollection.setPaginationConfigByPath("/"+e,t[e])})}},fe.prototype.buildRetrieveParam=function(){var r=this.buildChildrenPagination();if(!r||Object.keys(r).length<1)return null;var i={filters:{},parentIds:{}};return I.ExpressionUtil.getChildrenEntityPaths(this.repository.entityTypeInfo,[]),Object.keys(r).forEach(function(e){var t=r[e],n=t.pageIndex||1;i.filters[e]={pagination:{pageSize:t.pageSize||0,pageIndex:n}}}),i},fe.prototype.editById=function(r){var i=this;if(!this.repository.entityCollection.getEntityById(r))return b.of(null);var e=ce.buildRequestInfo(this.repository);return this.restProxy.edit(r,e).pipe(g.map(function(e){var t=e.returnValue.data,n=i.repository.entityCollection.getEntityById(r);return n&&t&&i.reloadEntityData(n,t),n}))},fe.prototype.updateById=function(r){var i=this;if(!this.repository.entityCollection.getEntityById(r))return b.of(null);var e=this.restService.buildRequestInfo(),t=this.buildRetrieveParam();return t?this.updateEntityById(r):this.restService.extendRetrieve(r,e,t).pipe(g.map(function(e){var t=e.returnValue,n=i.repository.entityCollection.getEntityById(r);return i.reloadEntityData(n,t),n}))},fe.prototype.updateEntityById=function(o){var a=this,e=this.restService.buildRequestInfo(),t=this.buildRetrieveParam();return this.restService.serviceRetrieve(o,t,e).pipe(g.map(function(e){var t=e.returnValue||{},n=t.result,r=t.pagination;a.updatePagination(r);var i=a.repository.entityCollection.getEntityById(o);return a.reloadEntityData(i,n),i}))},fe.prototype.reloadEntityData=function(e,t){e&&(this.appContext.changeDetectionController.detach(),this.repository.entityCollection.updateEntity(e,t),e.changes.splice(0,e.changes.length),this.appContext.changeDetectionController.reattach())},fe.prototype.create=function(e){var r=this,t=this.restService.buildRequestInfo();return this.restService.create(e,t).pipe(g.map(function(e){var t=e.returnValue,n=r.repository.buildEntity(t);return S.appendInitialData(n,t),r.repository.entityCollection.loadEntities([n],!0),n}))},fe.prototype.append=function(e){var r=this,t=this.restService.buildRequestInfo();return this.restService.create(e,t).pipe(g.map(function(e){var t=e.returnValue,n=r.repository.buildEntity(t);return r.repository.entityCollection.addEntity(n),n}))},fe.prototype.insert=function(r,e){var i=this,t=this.buildRequestInfo();return this.restProxy.create(e,t).pipe(g.map(function(e){var t=e.returnValue,n=i.repository.buildEntity(t);return i.repository.entityCollection.insertEntity(n,r),n}))},fe.prototype.appendByPath=function(n){var r=this,e=this.restService.buildRequestInfo();return this.restService.createByPath(n,e).pipe(g.map(function(e){var t=e.returnValue;return r.repository.entityManager.appendEntityByPath(n,t,t)}))},fe.prototype.insertByPath=function(n,r){var i=this,e=this.buildRequestInfo();return this.restProxy.createByPath(n,e).pipe(g.map(function(e){var t=e.returnValue;return i.repository.entityManager.insertEntityByPath(n,t,t,r)}))},fe.prototype.removeById=function(e,t){var n=this;t=t===undefined||t;var r=ce.buildRequestInfo(this.repository);return t?this.restProxy.deleteAndSave(e,r).pipe(g.switchMap(function(){return n.repository.entityCollection.removeEntityById(e),b.of(!0)})):this.restService.extendDelete(e,r).pipe(g.switchMap(function(){return n.repository.entityCollection.removeEntityById(e),n.repository.dataChangeHistory.addChange({dataId:e,changeType:I.DataChangeType.Delete}),b.of(!0)}))},fe.prototype.removeAndSaveById=function(e){var t=this,n=ce.buildRequestInfo(this.repository);return this.restProxy.deleteAndSave(e,n).pipe(g.switchMap(function(){return t.repository.entityCollection.removeEntityById(e),b.of(!0)}))},fe.prototype.removeByIds=function(n,e){var r=this;e=e===undefined||e;var t=this.restService.buildRequestInfo();return this.restService.extendBatchDelete(n,t).pipe(g.switchMap(function(){if(e)return r.applyChangesByIdArray(n).pipe(g.tap(function(e){e&&r.repository.entityCollection.removeEntities(function(e){return r.checkEntityValueExists(e,n)})}));if(r.repository.entityCollection.removeEntities(function(e){return r.checkEntityValueExists(e,n)}),n&&0<n.length){var t=[];n.forEach(function(e){t.push({dataId:e,changeType:I.DataChangeType.Delete})}),r.repository.dataChangeHistory.addChanges(t)}return b.of(!0)}))},fe.prototype.batchRemove=function(t,e){var n=this,r=this.restService.buildRequestInfo();return this.restService.extendBatchDeletion(t,r).pipe(g.switchMap(function(){return e?n.applyChangesByIdArray(t).pipe(g.tap(function(e){e&&n.removeEntities(t)})):(n.removeEntities(t),n.addBatchRemoveHistory(t),b.of(!0))}))},fe.prototype.addBatchRemoveHistory=function(e){if(e&&0<e.length){var t=[];e.forEach(function(e){t.push({dataId:e,changeType:I.DataChangeType.Delete})}),this.repository.dataChangeHistory.addChanges(t)}},fe.prototype.removeEntities=function(t){var n=this;this.repository.entityCollection.removeEntities(function(e){return n.checkEntityValueExists(e,t)})},fe.prototype.checkEntityValueExists=function(e,t){for(var n=!1,r=0;r<t.length;r++)if(e.primaryValue===t[r]){n=!0;break}return n},fe.prototype.removeByPath=function(e,t){var n=this,r=this.restService.buildRequestInfo();return this.restService.extendDeletByPath(e,t,r).pipe(g.map(function(){return n.repository.entityManager.removeEntityByPath(e,t),n.repository.dataChangeHistory.addChange({fpath:e,dataId:t,changeType:I.DataChangeType.Delete}),!0}))},fe.prototype.batchRemoveByPath=function(t,n){var r=this,e=this.restService.buildRequestInfo();return this.restService.batchDeleteByPath(t,n,e).pipe(g.map(function(){var e=n.split(",");return 0<e.length&&e.forEach(function(e){r.repository.entityManager.removeEntityByPath(t,e),r.repository.dataChangeHistory.addChange({fpath:t,dataId:e,changeType:I.DataChangeType.Delete})}),!0}))},fe.prototype.updateChangesById=function(e){var t=this,n=this.repository.entityCollection.getEntityById(e);if(!n.changes)return b.of(!0);if(0===n.changes.length)return b.of(!0);var r=this.repository.entityManager.buildEntityChangeDetailById(e),i=this.restService.buildRequestInfo();return this.restService.update(r,i).pipe(g.tap(function(){t.repository.entityManager.clearEntityChangesById(e)}),g.map(function(){return!0}))},fe.prototype.updateChangesByPath=function(e,t){throw new Error("Not Implement")},fe.prototype.updateAllChanges=function(){var n=this,r=[],e=this.repository.entityCollection.toArray();return 0===e.length?b.of(!0):(e.forEach(function(e){var t=n.updateChangesById(e.primaryValue);r.push(t)}),b.zip.apply(void 0,q(r)).pipe(g.map(function(){return!0})))},fe.prototype.applyChanges=function(){var e=this,t=this.restService.buildRequestInfo();return this.restService.save(t).pipe(g.tap(function(){e.repository.entityManager.clearAllEntityChanges(),e.repository.clearAllVariableChanges(t.variableChange),e.repository.dataChangeHistory.clear()}),g.map(function(){return!0}))},fe.prototype.applyChangesByIdArray=function(e){var t=this,n=this.restService.buildRequestInfo();return this.restService.save(n).pipe(g.tap(function(){t.repository.entityManager.clearEntityChangesByArray(e),t.repository.dataChangeHistory.clearByIds(e)}),g.map(function(){return!0}))},fe.prototype.applyChangesById=function(e){var t=this,n=this.restService.buildRequestInfo();return this.restService.save(n).pipe(g.tap(function(){t.repository.entityManager.clearEntityChangesById(e),t.repository.dataChangeHistory.clearByIds([e])}),g.map(function(){return!0}))},fe.prototype.cancelChanges=function(e){var t=this;return this.restService.cancel(e).pipe(g.tap(function(){t.repository.entityManager.clearAllEntityChanges(),t.repository.dataChangeHistory.clear()}),g.map(function(){return!0}))},fe.prototype.batchAppendByPath=function(i,e){var o=this,t=this.buildRequestInfo();return this.restProxy.batchAppendByPath(i,e,t).pipe(g.map(function(e){var t=e.returnValue,n=o.repository.entityManager.createEntitiesByPath(i,t),r=i.split("/").filter(function(e){return e});return o.repository.entityManager.appendEntitiesByPath(r,n),n}))},fe.prototype.batchAppend=function(e){var r=this,t=this.buildRequestInfo();return this.restProxy.batchAppend(e,t).pipe(g.map(function(e){var t=e.returnValue,n=r.repository.buildEntities(t);return r.repository.entityCollection.addEntities(n),n}))},fe.prototype.hasChanges=function(){var e=this.buildRequestInfo();return this.restService.hasChanges(e)},fe.prototype.buildRequestInfo=function(){return{dataChange:this.repository.entityManager.buildAllEntityChangeDetails(),variableChange:this.repository.variableManager.buildChangeDetail()}},fe);function fe(e,t){this.injector=e,this.repository=t;var n=e.get(f),r=e.get(h.HttpClient),i=e.get(l)+"/"+this.repository.apiUri,o=e.get(I.EventBus);this.restService=new Oe(r,i,n,this.repository,o),this.appContext=e.get(I.AppContext)}var ge=(ve.handleMessage=function(e,t,n){var r={ns:t.get(I.NAMESPACE,null),appContext:t.get(I.AppContext,null)},i=this.buildBackEndMessages(e),o=new I.BackEndMessage.Message(i,r),a=t.get(I.BACK_END_MESSAGE_HANDLER_TOKEN,null);a&&a.handle(o,n)},ve.isBackEndMessageHandlerExist=function(e){return!!e.get(I.BACK_END_MESSAGE_HANDLER_TOKEN,null)},ve.getFormlessMessages=function(e){return(this.buildBackEndMessages(e)||[]).filter(function(e){return!e.location||!e.location.columns||e.location.columns.length<1||!e.location.nodeCode})},ve.buildBackEndMessages=function(e){if(!e||e.length<1||!Array.isArray(e))return null;var n=[];return e.forEach(function(e){var t={level:e.level,message:e.message};e.hasOwnProperty("location")&&e.location&&(t.location={nodeCode:e.location.nodeCode,rows:e.location.dataIds,columns:e.location.columnNames}),n.push(t)}),n},ve);function ve(){}var Ie=(Ce.getSessionId=function(e,t){var n=e.ApplicationId+"_"+t.beBaseUri;return this.createSessionHistory.includes(n)?b.of(null):(this.createSessionHistory.push(n),t.getBeSessionId())},Ce.createSessionHistory=[],Ce.decorators=[{type:o.Injectable}],Ce);function Ce(){}var Se=(be.prototype.onResponse=function(e,t,n){e&&e.innerDataChange&&!0!==t&&this.context.handleDataChangeDetails(e.innerDataChange),e&&e.innerVariableChange&&this.context.handleVariableChangeDetail(e.innerVariableChange);var r=U.parseBackEndMessage(e);ge.handleMessage(r,this.context.getInjector()),this.context.clearAllEntityChanges();var i=j.getRequestInfo(n),o=i&&i.variableChange;return this.context.clearAllVariableChanges(o),e&&e.hasOwnProperty("returnValue")?e.returnValue:e},be.prototype.onError=function(e,t,n){var r,i,o=this,a=this.context.appContext.getFormAppContext(),s=a.ApplicationId,p=window.DEVKIT_LOADING_SERVICE,u=U.parseBackEndError(e);if(ge.handleMessage(u,this.context.getInjector()),this.loadingService&&window.setTimeout(function(){o.loadingService.clearAll()},350),p&&p instanceof Array&&0<p.length)try{for(var c=R(p),h=c.next();!h.done;h=c.next()){var l=h.value;"function"==typeof l.destroy&&l.destroy()}}catch(S){r={error:S}}finally{try{h&&!h.done&&(i=c["return"])&&i.call(c)}finally{if(r)throw r.error}}if(t)return b.throwError(e);var y=this.context.restService.eventBus,d=!!(window[s]||{}).isExceptionHandlerExist,f=U.parseBackEndError(e),g=ge.getFormlessMessages(f),v=g&&0<g.length||!1,I=!(e&&e.error&&e.error.extensionMessage&&ge.isBackEndMessageHandlerExist(this.context.getInjector())&&!v),C=!!y&&d&&I;return ge.handleMessage(f,this.context.getInjector(),{hasThrowError:C,isException:!0,eventBus:y,error:e,formAppContext:a}),y&&d&&!U.isReported401Error(e)?(I&&y.post("Exception","","onException",e,a),n?b.of(null):b.EMPTY):b.throwError(e)},be.prototype.extendHeaders=function(t,n){var r=this,e=this.context.appContext.getFormAppContext();return Ie.getSessionId(e,this.context.restService.sessionService).pipe(g.switchMap(function(e){return t=r.context.restService.sessionService.extendRequestHeaders(t,n),b.of(t)}))},be.prototype.extendUrl=function(e,t){if(!t)return e;for(var n in t)if(t.hasOwnProperty(n)){var r=JSON.stringify(t[n]);e=-1===e.indexOf("?")?e+"?"+n+"="+r:e+"&"+n+"="+r}return e},be.prototype.extendBody=function(t){var n=this;return!t||"object"!=typeof t||Object.keys(t).length<1||(Object.keys(t).forEach(function(e){"requestInfo"===e&&(t.requestInfo=n.context.restService.buildRequestInfo())}),1===Object.keys(t).length&&(t=Object.values(t)[0])),t},be.prototype.parseHeaders=function(e){var t="BEFSessionID";e.headers&&e.headers.has(t)&&this.context.restService.sessionService.setBeSessionId(e.headers.get(t))},be);function be(e){this.context=e;var t=this.context.getInjector();t&&(this.loadingService=t.get(a.LoadingService,null))}var me,Ee=(B(xe,me=te),Object.defineProperty(xe.prototype,"proxy",{get:function(){return this.befProxy},set:function(e){this.befProxy=e,this.befProxy.setProxyExtend(new Se(this))},enumerable:!0,configurable:!0}),xe.prototype.getEntities=function(e,t,n,r){return this.dataService.getList(e,t,n,r)},xe.prototype.filter=function(e,t,n,r){return void 0===e&&(e=[]),void 0===t&&(t=[]),this.dataService.filter(e,t,n,r)},xe.prototype.queryChild=function(e,t,n,r,i){return this.dataService.queryChild(e,t,n,r,i)},xe.prototype.getEntityById=function(e){return this.dataService.getById(e)},xe.prototype.updateEntityById=function(e){return this.dataService.updateById(e)},xe.prototype.editEntityById=function(e){return this.dataService.editById(e)},xe.prototype.createEntity=function(e){return this.dataService.create(e)},xe.prototype.appendEntity=function(e){return this.dataService.append(e)},xe.prototype.insert=function(e,t){return this.dataService.insert(e,t)},xe.prototype.insertByPath=function(e,t){return this.dataService.insertByPath(e,t)},xe.prototype.appendEntityByPath=function(e){return this.dataService.appendByPath(e)},xe.prototype.removeEntityById=function(e,t){return this.dataService.removeById(e,t)},xe.prototype.removeEntityAndSaveById=function(e){return this.dataService.removeAndSaveById(e)},xe.prototype.removeEntityByPath=function(e,t){return this.dataService.removeByPath(e,t)},xe.prototype.batchRemove=function(e,t){return void 0===t&&(t=!1),this.dataService.batchRemove(e,t)},xe.prototype.batchRemoveByPath=function(e,t){return this.dataService.batchRemoveByPath(e,t)},xe.prototype.saveEntityById=function(e){return this.dataService.applyChangesById(e)},xe.prototype.saveEntities=function(){return this.dataService.applyChanges()},xe.prototype.cancelEntityChanges=function(){return this.dataService.cancelChanges()},xe.prototype.batchAppendByPath=function(e,t){return this.dataService.batchAppendByPath(e,t)},xe.prototype.batchAppend=function(e){return this.dataService.batchAppend(e)},xe.prototype.reset=function(){this.entityManager.reset(),this.variableManager.reset(),this.restService.sessionService.clearBeSessionId()},xe.prototype.getInjector=function(){return this.injector},xe.prototype.clearAllVariableChanges=function(e){this.variableManager.clearChangeDetail(e)},xe.prototype.hasChanges=function(){return this.dataService.hasChanges()},xe.decorators=[{type:o.Injectable}],xe.ctorParameters=function(){return[{type:o.Injector}]},xe);function xe(e){var t=me.call(this)||this;t.injector=e,t.entityCollection&&(t.entityManager=new ie(t.entityCollection)),t.appContext=t.injector.get(I.AppContext);var n=I.MetadataUtil.getPropsMetadatasByName(t.constructor,$);return t.variableManager=new pe(t.appContext,n,t.injector),t.dataService=new de(t.injector,t),t.serverUri=e.get(l),t}var Be=(Pe.prototype.extendUri=function(e){return this.serverUri+"/"+e},Pe.decorators=[{type:o.Injectable}],Pe.ctorParameters=function(){return[{type:String,decorators:[{type:o.Inject,args:[l]}]}]},Pe);function Pe(e){this.serverUri=e}var Re="DELETE",De="PUT",qe="POST",we=(Te.prototype.setBaseUri=function(e){this.baseUri=e},Te.prototype.setProxyExtend=function(e){this.proxyExtend=e},Te.prototype.query=function(e){var t=this.baseUri;return e&&(t=t+"?entityFilter="+JSON.stringify(e)),this.request(t,"GET")},Te.prototype.extendQuery=function(e,t){var n=this.baseUri+"/extension/query";if(e){var r=JSON.stringify(e);n=n+"?entityFilter="+(r=I.encodeUrl(r))}var i=t,o=this.addBodyToOptions({},i);return this.request(n,De,null,o,!1)},Te.prototype.filter=function(e,t){var n=this.baseUri+"/extension/filter",r={requestInfo:t};e&&(r={entityFilter:e,requestInfo:t});var i=this.addBodyToOptions({},r);return this.request(n,qe,null,i,!1)},Te.prototype.retrieve=function(e){var t=this.baseUri+"/"+e;return this.request(t,"GET")},Te.prototype.serviceRetrieve=function(e,t,n){var r=this.baseUri+"/service/retrieve/"+e,i={body:{retrieveParam:t,requestInfo:n}};return this.request(r,De,null,i)},Te.prototype.queryChild=function(e){var t=this.baseUri+"/service/querychild",n={body:e};return this.request(t,De,null,n)},Te.prototype.extendRetrieve=function(e,t,n){var r=this.baseUri+"/extension/retrieve/"+e,i=t;n&&(i={retrieveParam:n,requestInfo:t});var o=this.addBodyToOptions({},i);return this.request(r,De,null,o)},Te.prototype.edit=function(e,t){var n=this.baseUri+"/service/edit/"+e,r=t,i=this.addBodyToOptions({},r);return this.request(n,De,null,i)},Te.prototype.create=function(e,t){var n={defaultValue:e,requestInfo:t},r=this.addBodyToOptions({},n);return this.request(this.baseUri,qe,null,r)},Te.prototype.createByPath=function(e,t){var n=le.convertPathToUrl(e),r=""+this.baseUri+n,i=t,o=this.addBodyToOptions({},i);return this.request(r,qe,null,o)},Te.prototype.update=function(e,t){var n={changeDetail:e,requestInfo:t},r=this.addBodyToOptions({},n);return this.request(this.baseUri,"PATCH",null,r)},Te.prototype.save=function(e){var t=e,n=this.addBodyToOptions({},t);return this.request(this.baseUri,De,null,n)},Te.prototype["delete"]=function(e){var t=this.baseUri+"/"+e;return this.request(t,Re)},Te.prototype.deleteAndSave=function(e,t){var n=this.baseUri+"/service/delete/"+e,r=t,i=this.addBodyToOptions({},r);return this.request(n,De,null,i)},Te.prototype.extendDelete=function(e,t){var n=this.baseUri+"/extension/delete/"+e,r=t,i=this.addBodyToOptions({},r);return this.request(n,De,null,i)},Te.prototype.deletByPath=function(e,t){var n=le.convertPathToUrl(e),r=""+this.baseUri+n+"/"+t;return this.request(r,Re)},Te.prototype.extendDeletByPath=function(e,t,n){var r=le.convertPathToUrl(e),i=this.baseUri+"/extension"+r+"/"+t,o=n,a=this.addBodyToOptions({},o);return this.request(i,De,null,a)},Te.prototype.batchDeleteByPath=function(e,t,n){var r=le.convertPathToUrl(e);if(r.split("/").length<3)throw Error("根据path删除实体数据出错了。传入的path["+e+"]格式不对");var i=this.baseUri+"/extension"+r+"/batch",o={ids:t.split(","),requestInfo:n},a=this.addBodyToOptions({},o);return this.request(i,De,null,a)},Te.prototype.batchDelete=function(e){var t={ids:e.join(",")};return this.request(this.baseUri,Re,t)},Te.prototype.extendBatchDeletion=function(e,t){var n=this.baseUri+"/extension/batchdeletion",r={ids:e,requestInfo:t},i=this.addBodyToOptions({},r);return this.request(n,De,null,i)},Te.prototype.extendBatchDelete=function(e,t){var n=this.baseUri+"/extension/batchdelete",r={ids:e.join(",")},i=t,o=this.addBodyToOptions({},i);return this.request(n,De,r,o)},Te.prototype.cancel=function(e){var t=this.baseUri+"/service/cancel";return this.request(t,qe,null,null,!1,!1,!1,e)},Te.prototype.batchAppendByPath=function(e,t,n){var r=le.convertPathToUrl(e),i=""+this.baseUri+r+"/batch",o={requestInfo:n,retrieveDefaultParam:{defaultValues:t}},a=this.addBodyToOptions({},o);return this.request(i,qe,null,a)},Te.prototype.batchAppend=function(e,t){var n=this.baseUri+"/batch",r={requestInfo:t,retrieveDefaultParam:{defaultValues:e}},i=this.addBodyToOptions({},r);return this.request(n,qe,null,i)},Te.prototype.hasChanges=function(e){var t=this.baseUri+"/haschanges",n=P({},e),r=this.addBodyToOptions({},n);return this.request(t,De,null,r)},Te.prototype.request=function(t,n,e,r,i,o,a,s){var p=this;r=r||{},void 0!==i&&"boolean"==typeof i||(i=!1),void 0!==o&&"boolean"==typeof o||(o=!1),e&&(r.params=e),r.headers=w.convertToHeaders(r.headers);var u=this.hasRequestInfo(r);return r&&r.body&&r.body.hasOwnProperty("RequestInfo")&&(r.body.requestInfo=r.body.RequestInfo,delete r.body.RequestInfo),this.proxyExtend.extendHeaders(r.headers,s).pipe(g.switchMap(function(e){return r.headers=w.toJson(e),r.observe="response",p.httpService.request(n,t,r)}),g.tap(function(e){return p.proxyExtend.parseHeaders(e)}),g.map(function(e){return e.body}),g.map(function(e){return u?(p.proxyExtend.onResponse(e,a,r),e):p.unWrapResponseInfo(e)}),g.catchError(function(e){return p.proxyExtend.onError(e,i,o)}))},Te.prototype.invoke=function(t,n,r){var i=this;return r.params&&(t=this.proxyExtend.extendUrl(t,r.params),r.params=null),r.body&&(r.body=this.proxyExtend.extendBody(r.body)),r.headers=w.convertToHeaders(r.headers),this.proxyExtend.extendHeaders(r.headers).pipe(g.switchMap(function(e){return r.headers=w.toJson(e),r.observe="response",i.httpService.request(n,t,r).pipe(g.tap(function(e){return i.proxyExtend.parseHeaders(e)}),g.map(function(e){return e.body}),g.map(function(e){return i.proxyExtend.onResponse(e,!1,r)}),g.catchError(function(e){return i.proxyExtend.onError(e,!1,!1)}))}))},Te.prototype.addBodyToOptions=function(e,t){return e=e||{},Object.assign(e,{body:t})},Te.prototype.buildParams=function(e){return O.buildParams(e)},Te.prototype.hasRequestInfo=function(e){return j.hasRequestInfo(e)||j.hasRequestInfoWithR(e)},Te.prototype.unWrapResponseInfo=function(e){return U.unWrapResponseInfo(e)},Te.decorators=[{type:o.Injectable}],Te.ctorParameters=function(){return[{type:h.HttpClient},{type:Be}]},Te);function Te(e,t){this.httpClient=e,this.uriService=t,this.httpService=new H(this.httpClient)}var Oe=(Object.defineProperty(Me.prototype,"proxy",{get:function(){return this.repository.proxy?this.repository.proxy:this.createBefProxy()},enumerable:!0,configurable:!0}),Me.prototype.createBefProxy=function(){var e=this.repository.serverUri,t=new Be(e),n=new we(this.httpClient,t);n.setBaseUri(this.baseUri);var r=new Se(this.repository);return n.setProxyExtend(r),n},Me.prototype.query=function(e){return this.proxy.query(e)},Me.prototype.extendQuery=function(e,t){return this.proxy.extendQuery(e,t)},Me.prototype.serviceRetrieve=function(e,t,n){return this.proxy.serviceRetrieve(e,t,n)},Me.prototype.queryChild=function(e){return this.proxy.queryChild(e)},Me.prototype.retrieve=function(e){return this.proxy.retrieve(e)},Me.prototype.extendRetrieve=function(e,t,n){return this.proxy.extendRetrieve(e,t,n)},Me.prototype.create=function(e,t){return this.proxy.create(e,t)},Me.prototype.createByPath=function(e,t){return this.proxy.createByPath(e,t)},Me.prototype.update=function(e,t){return this.proxy.update(e,t)},Me.prototype.save=function(e){return this.proxy.save(e)},Me.prototype["delete"]=function(e){return this.proxy["delete"](e)},Me.prototype.extendDelete=function(e,t){return this.proxy.extendDelete(e,t)},Me.prototype.deletByPath=function(e,t){return this.proxy.deletByPath(e,t)},Me.prototype.extendDeletByPath=function(e,t,n){return this.proxy.extendDeletByPath(e,t,n)},Me.prototype.batchDeleteByPath=function(e,t,n){return this.proxy.batchDeleteByPath(e,t,n)},Me.prototype.batchDelete=function(e){return this.proxy.batchDelete(e)},Me.prototype.extendBatchDelete=function(e,t){return this.proxy.extendBatchDelete(e,t)},Me.prototype.extendBatchDeletion=function(e,t){return this.proxy.extendBatchDeletion(e,t)},Me.prototype.cancel=function(e){return this.proxy.cancel(e)},Me.prototype.hasChanges=function(e){return this.proxy.hasChanges(e)},Me.prototype.request=function(e,t,n,r,i,o,a){return this.innerRequest(e,t,n,r,i,o,a,!1)},Me.prototype.invoke=function(e,t,n,r,i,o,a){if(r&&r.body&&r.body.RequestInfo)throw new Error("请使用requestInfo提交变更");return this.innerRequest(e,t,n,r,i,o,a,!0)},Me.prototype.innerRequest=function(t,n,e,r,i,o,a,s){var p=this;r=r||{};var u="BEFSessionID";void 0!==i&&"boolean"==typeof i||(i=!1),void 0!==o&&"boolean"==typeof o||(o=!1),void 0!==s&&"boolean"==typeof s||(s=!1);var c=s?this.existRequestInfo:this.hasRequestInfo;e&&(r.params=e);var h=c(r),l=w.convertToHeaders(r.headers),y=this.repository.appContext.getFormAppContext();return Ie.getSessionId(y,this.sessionService).pipe(g.switchMap(function(e){return l=p.sessionService.extendRequestHeaders(l),r.headers=w.toJson(l),r.observe="response",p.httpService.request(n,t,r)}),g.tap(function(e){e.headers&&e.headers.has(u)&&p.sessionService.setBeSessionId(e.headers.get(u))}),g.map(function(e){return e.body}),g.map(function(e){var t=U.parseBackEndMessage(e);return ge.handleMessage(t,p.repository.getInjector()),p.handleReponseInfo(e,h,a,r)}),g.catchError(function(e){return p.handleErrors(e,i,o)}))},Me.prototype.handleReponseInfo=function(e,t,n,r){if(t){e&&e.innerDataChange&&!0!==n&&this.repository.handleDataChangeDetails(e.innerDataChange),e&&e.innerVariableChange&&this.repository.handleVariableChangeDetail(e.innerVariableChange),this.repository.clearAllEntityChanges();var i=j.getRequestInfo(r),o=i&&i.variableChange;return this.repository.clearAllVariableChanges(o),e}return this.unWrapResponseInfo(e)},Me.prototype.handleErrors=function(e,t,n){if(this.clearLoading(),t)return b.throwError(e);var r=this.repository.appContext.getFormAppContext(),i=r.ApplicationId,o=window[i]||{},a=U.parseBackEndError(e),s=ge.getFormlessMessages(a),p=!!o.isExceptionHandlerExist,u=s&&0<s.length||!1,c=!(e&&e.error&&e.error.extensionMessage&&ge.isBackEndMessageHandlerExist(this.repository.getInjector())&&!u),h=!!this.eventBus&&p&&c;return ge.handleMessage(a,this.repository.getInjector(),{hasThrowError:h,isException:!0,eventBus:this.eventBus,error:e,formAppContext:r}),this.eventBus&&p&&!U.isReported401Error(e)?(c&&this.eventBus.post("Exception","","onException",e,r),n?b.of(null):b.EMPTY):b.throwError(e)},Me.prototype.clearLoading=function(){var e,t;if(!1!==(window.DEVKIT_LOADING_SERVICE&&window.DEVKIT_LOADING_SERVICE instanceof Array&&0<window.DEVKIT_LOADING_SERVICE.length||!1)){var n=window.DEVKIT_LOADING_SERVICE;try{for(var r=R(n),i=r.next();!i.done;i=r.next()){var o=i.value;"function"==typeof o.destroy&&o.destroy()}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}this.clearAllLoading()}else this.clearAllLoading()},Me.prototype.clearAllLoading=function(){var e=this;this.loadingService&&window.setTimeout(function(){e.loadingService.clearAll()},350)},Me.prototype.unWrapResponseInfo=function(e){return U.unWrapResponseInfo(e)},Me.prototype.hasRequestInfo=function(e){return j.hasRequestInfoWithR(e)},Me.prototype.existRequestInfo=function(e){return j.hasRequestInfo(e)},Me.prototype.buildParams=function(e){return O.buildParams(e)},Me.prototype.buildBodyWithRequestInfo=function(e){return j.buildBodyWithRequestInfo(e,this.repository)},Me.prototype.buildRequestInfo=function(){return j.buildRequestInfo(this.repository)},Me.decorators=[{type:o.Injectable}],Me.ctorParameters=function(){return[{type:h.HttpClient},{type:String},{type:f},{type:Ee},{type:I.EventBus}]},Me);function Me(e,t,n,r,i){this.httpClient=e,this.httpService=new H(this.httpClient),this.baseUri=t;var o=r.getInjector();this.sessionService=new Y(e,t,n,o),this.repository=r,this.eventBus=i,o&&(this.loadingService=o.get(a.LoadingService,null))}var je=(Ae.prototype.registerDestroyEvent=function(){var e=this;this.frameContext&&this.frameContext.destorySignal&&this.frameContext.destorySignal.subscribe(function(){e.frameContext=null,e.befRepository=null})},Ae.prototype.getData=function(e,t){var n=e.split(".")[0],r=e.split(".")[1];if(t=t||{},this.frameContext){var i=this.frameContext.bindingData.list.currentId;t.currentForm={id:i}}return!0===this.ifEnableExtendLoadMethod(e)?this.extendGetHelpData(r,n,t):this.getHelpData(r,n,t)},Ae.prototype.saveUserSettings=function(e){var n=this;return this.befRepository.restService.invoke("/api/runtime/bcc/v1.0/datagrid/settings","POST",null,{body:e},!1).pipe(g.catchError(function(e){n.clearLoading();var t=n.befRepository.appContext.getFormAppContext();return n.befRepository.restService.eventBus.post("Exception","","onException",e,t),b.EMPTY}))},Ae.prototype.getUserSettings=function(e){var n=this,t="/api/runtime/bcc/v1.0/datagrid/settings/"+e;return this.befRepository.restService.invoke(t,"GET",null,null,!1).pipe(g.catchError(function(e){n.clearLoading();var t=n.befRepository.appContext.getFormAppContext();return n.befRepository.restService.eventBus.post("Exception","","onException",e,t),b.EMPTY}))},Ae.prototype.ifEnableExtendLoadMethod=function(e){if(this.context&&this.context.hasOwnProperty("enableExtendLoadMethod"))return this.context.enableExtendLoadMethod;var t=!1;if(this.frameContext){var n=e+"@"+this.frameContext.repository.apiUri;t=this.frameContext.getParam(n)}return t},Ae.prototype.getHelpData=function(e,t,n){var r=this,i=this.befRepository.restService.baseUri+"/elementhelps/"+e;return this.befRepository.updateDataAndVariableChanges().pipe(g.switchMap(function(){return r.extendQueryParam(n),r.befRepository.restService.invoke(i,"GET",{nodeCode:t,queryParam:JSON.stringify(n)},null,!1).pipe(g.catchError(function(e){r.clearLoading();var t=r.befRepository.appContext.getFormAppContext();return r.befRepository.restService.eventBus.post("Exception","","onException",e,t),b.EMPTY}))}))},Ae.prototype.extendGetHelpData=function(e,t,n){var r=this,i=this.befRepository.restService.baseUri+"/extension/elementhelps";this.extendQueryParam(n);var o={body:{labelId:e,nodeCode:t,queryParam:n,requestInfo:this.befRepository.restService.buildRequestInfo()}};return this.befRepository.restService.invoke(i,"PUT",null,o,!1,!0).pipe(g.map(function(e){return e&&e.returnValue||null}),g.catchError(function(e){r.clearLoading();var t=r.befRepository.appContext.getFormAppContext();return r.befRepository.restService.eventBus.post("Exception","","onException",e,t),b.EMPTY}))},Ae.prototype.clearLoading=function(){this.loadingService&&this.loadingService.clearAll()},Ae.prototype.convert2TreeDataWithPathCode=function(r,t,n){var i=this;void 0===t&&(t=1),void 0===n&&(n="01");var e=r.filter(function(e){return e.layer===t&&e.pathcode===n});if(1<t&&(e=r.filter(function(e){return e.layer===t&&e.pathcode.substr(0,2*(t-1))===n})),e.length){var o=e.map(function(e){return{data:e,children:[]}});return o.forEach(function(e){var t,n=i.convert2TreeDataWithPathCode(r,e.data.layer+1,e.data.pathcode);(t=e.children).push.apply(t,q(n))}),o}},Ae.prototype.extendQueryParam=function(e){if(e&&"object"==typeof e){var t=this.getPath();e.relationFilterFieldInfo=t}},Ae.prototype.getPath=function(){var e=this.frameContext.viewModel.bindingPath,t=this.frameContext.viewModel.bindingData.list.currentId,n=e.split("/").filter(function(e){return e});if(0<n.length)for(var r=this.frameContext.viewModel.bindingData,i=0;i<n.length;i++){var o=n[i];if(!(r=r[o])||!r.currentId)throw Error("获取子表完整路径出错，找不到"+r+"对应的子表，或对应子表没有当前行。");t+="/"+o.substring(0,o.length-1)+"/"+r.currentId}return t},Ae.decorators=[{type:o.Injectable}],Ae.ctorParameters=function(){return[{type:I.Repository},{type:I.FrameContext,decorators:[{type:o.Optional}]}]},Ae);function Ae(e,t){this.frameContext=t,this.befRepository=e,this.registerDestroyEvent(),this.loadingService=this.frameContext&&this.frameContext.injector.get(a.LoadingService,null)}var Ue=(Ve.prototype.createSession=function(e){var t=this.sessionService.getUserSessionId();return t?this.befRepository.restService.invoke(e,"POST",null,{headers:new h.HttpHeaders({SessionId:t}),responseType:"text"},!1).pipe(g.switchMap(function(e){return b.of({status:!0,payload:e})})):b.of({status:!1,payload:"用户登录信息已过期，请重新登录"})},Ve.prototype.getData=function(e,t){var n=this,r={};t.condition&&(r=t.condition),"/"===e[e.length-1]&&(e=e.substr(0,e.length-1));var i=e+"/extension/query",o=e+"/service/createsession";if(r){var a=JSON.stringify(r);i=i+"?entityFilter="+a}return this.createSession(o).pipe(g.switchMap(function(e){if(e.status)return e.payload,n.befRepository.restService.invoke(i,"PUT",null,{},!1);throw new Error(e.payload)}),s.map(function(e){var t=e.returnValue,n={items:t.result};return t.pagination?Object.assign({},n,{total:t.pagination.totalCount,pageInfo:{pageSize:t.pagination.pageSize,pageIndex:t.pagination.pageIndex,enablePager:!0}}):n}))},Ve.decorators=[{type:o.Injectable}],Ve.ctorParameters=function(){return[{type:I.Repository},{type:f}]},Ve);function Ve(e,t){this.sessionService=t,this.befRepository=e}var He=(ke.isExistUnsaveData=function(e){var t=!1;if(!e||!e.entityCollection)throw"Current Object is null or it's entityCollection is null.";var n=e.entityCollection.toArray();if(e.dataChangeHistory.isChanged())return!0;for(var r=0;r<n.length;r++)if(0<n[r].changes.length){t=!0;break}return t},ke);function ke(){}var Fe=(Ne.prototype.toString=function(){return this.url},Ne);function Ne(e,t){void 0===t&&(t=null);var n=this;this.url=e,this.paths=t,this.paths&&Object.keys(t).forEach(function(e){-1!==n.url.indexOf("{"+e+"}")&&(n.url=n.url.replace("{"+e+"}",""+t[e]))})}var _e=(Le.prototype.getData=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n="GET");var r=new h.HttpHeaders({"content-type":"application/json"});return"get"!==n.toLowerCase()?this.befRest.restService.invoke(e,n,null,{headers:r,body:t}):this.befRest.restService.invoke(e,n,t,{headers:r})},Le.decorators=[{type:o.Injectable}],Le.ctorParameters=function(){return[{type:I.Repository}]},Le);function Le(e){this.befRest=e}var Ke=(ze.prototype.getData=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n="GET");var r=new h.HttpHeaders({"content-type":"application/json"});return this.befRest.restService.invoke(e,n,t,{headers:r})},ze.decorators=[{type:o.Injectable}],ze.ctorParameters=function(){return[{type:I.Repository}]},ze);function ze(e){this.befRest=e}var Ge,Je=(B(We,Ge=Ee),We.prototype.batchAppend=function(e){throw new Error("Method not implemented.")},We);function We(e,t,n,r,i){var o=Ge.call(this,e)||this;o.name=t,o.entityType=n,o.serverUri=r,o.apiUri=i,o.apiUri=i;var a={};a[n.typeName]={pageSize:20},o.paginationInfo=a,o.name=t,o.entityTypeInfo=new I.DataTypeInfo(o.entityType),o.entityCollection=new I.EntityCollection(o.entityType),o.entityManager=new ie(o.entityCollection);var s=e.get(h.HttpClient),p=new Be(r),u=new we(s,p),c=p.extendUri(i);return u.setBaseUri(c),o.proxy=u,o.dataService=new de(e,o),o.serverUri=e.get(l),o}var Qe,Ye=(B(Xe,Qe=Ee),Xe.prototype.batchAppend=function(e){throw new Error("Method not implemented.")},Xe);function Xe(e,t){var n=Qe.call(this,e)||this;n.schema=t;var r=new I.EntityTypeFactory;return n.entityType=r.create(t),n.entityTypeInfo=new I.DataTypeInfo(n.entityType),n.entityCollection=new I.EntityCollection(n.entityType),n.entityManager=new ie(n.entityCollection),n}e.VERSION="ver.",e.ChangeDetailType=C,e.BE_SERVER_URI_TOKEN=l,e.BE_SESSION_HANDLING_STRATEGY_TOKEN=p,e.BefChangeBuilder=u,e.BefChangeHandler=y,e.BefSessionService=Y,e.BefRestService=Oe,e.BefProxy=we,e.BefLookupRestService=je,e.BefLookupDefaultService=Ue,e.BefRepository=Ee,e.FrameworkSessionService=f,e.NG_VARIABLE=$,e.NgVariable=ee,e.BefRepositoryUtil=He,e.BefDataPathUtil=le,e.UriService=Be,e.Uri=Fe,e.DefaultComboHttpService=_e,e.DefaultDynamiControlGroupHttpService=Ke,e.BefEntityManager=ie,e.DynamicBefRepository=Je,e.PresetBefRepository=Ye,e.BefVariableManager=pe,e.ɵa=te,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-bef.umd.min.js.map
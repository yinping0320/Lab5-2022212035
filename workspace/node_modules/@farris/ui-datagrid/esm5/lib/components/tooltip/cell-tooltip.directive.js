/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from './../../datagrid.component';
import { Utils } from './../../utils/utils';
import { Input, ElementRef, Directive, Injector, NgZone, Renderer2 } from '@angular/core';
import { CommonUtils } from '@farris/ui-common';
import { DomHandler } from '../../services/domhandler';
var DatagridCellTooltipDirective = /** @class */ (function () {
    function DatagridCellTooltipDirective(el, injector) {
        this.el = el;
        this.injector = injector;
        this.position = 'top-left';
        this.delay = 1000;
        this.cls = '';
        this.type = 'info';
        this.tipMode = 'auto';
        this.showTipTimer = null;
        this._mouseenter = null;
        this._mouseleave = null;
        this._mouseclick = null;
        this.ngZone = null;
        this.render = null;
        if (this.injector) {
            this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
            this.ngZone = this.injector.get(NgZone);
            this.render = this.injector.get(Renderer2);
            this.dg = this.injector.get(DatagridComponent);
        }
        else {
            this.commonUtils = new CommonUtils();
        }
    }
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.ngZone && this.enable) {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            function () {
                _this._mouseenter = Utils.on(_this.el.nativeElement, 'mouseenter', _this.onMouseEnter.bind(_this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                _this._mouseleave = Utils.on(_this.el.nativeElement, 'mouseleave', _this.onMouseLeave.bind(_this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                _this._mouseclick = Utils.on(_this.el.nativeElement, 'mousedown', _this.onClick.bind(_this));
            }));
        }
    };
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.hide();
        if (this._mouseenter) {
            this._mouseenter();
        }
        if (this._mouseleave) {
            this._mouseleave();
        }
        if (this._mouseclick) {
            this._mouseclick();
        }
        // this.dg = null;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.onMouseEnter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        if (!this.enable) {
            return;
        }
        if ($event.fromElement) {
            if (!$event.fromElement.closest('.f-datagrid')) {
                return;
            }
        }
        /** @type {?} */
        var cellTiptimer = this.dg ? this.dg.cellTipTimer : 1000;
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        this.showTipTimer = setTimeout((/**
         * @return {?}
         */
        function () {
            _this.show($event);
        }), cellTiptimer);
    };
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.onMouseLeave = /**
     * @return {?}
     */
    function () {
        this.hide();
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.onClick = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        // e.stopPropagation();
        this.hide();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getTextContainer = /**
     * @private
     * @return {?}
     */
    function () {
        return DomHandler.findSingle(this.container, '.f-tooltip-text');
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.donotShowTips = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        /** @type {?} */
        var tdWidth = target.offsetWidth;
        /** @type {?} */
        var tagetSty = window.getComputedStyle(target);
        /** @type {?} */
        var txtWidth = this.commonUtils.getTextWidth(this.message, tagetSty.font);
        var paddingLeft = tagetSty.paddingLeft, paddingRight = tagetSty.paddingRight;
        /** @type {?} */
        var _width = tdWidth - (Number(paddingLeft.replace('px', '')) || 0) - (Number(paddingRight.replace('px', '')) || 0);
        /** @type {?} */
        var tr = target.closest('tr');
        if (tr) {
            /** @type {?} */
            var trId = tr.id;
            // tr = document.querySelector('#'+ trId);
            tr = Utils.getTrDomById(trId, document);
        }
        if (this.tipMode === 'auto') {
            if (tr) {
                return _width && _width > txtWidth;
            }
            return true;
        }
        else {
            return tr ? false : true;
        }
    };
    /**
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.hide = /**
     * @return {?}
     */
    function () {
        if (!this.enable) {
            return;
        }
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        if (this.container && this.container.parentElement) {
            document.body.removeChild(this.container);
        }
        this.container = null;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.show = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var cellEl = (/** @type {?} */ ($event.target));
        // this.enable = cellEl.getAttribute('cell-tooltip') === 'true';
        this.message = cellEl.getAttribute('message');
        this.tipMode = cellEl.getAttribute('tipMode') || 'auto';
        if (!this.enable || !this.message) {
            return;
        }
        /** @type {?} */
        var tipWidth = cellEl.getAttribute('tipWidth');
        /** @type {?} */
        var tipHeight = cellEl.getAttribute('tipHeight');
        this.position = cellEl.getAttribute('position') || 'top-left';
        // 检查下内容宽度是否超出列宽
        if (this.donotShowTips($event.target) && cellEl.innerText === this.message) {
            return;
        }
        // const boxEl = this.el.nativeElement;
        /** @type {?} */
        var boxEl = $event.target;
        /** @type {?} */
        var elSize = this.getBoxSizeObj(boxEl);
        /** 如果存在则不新建，只需要修改里面的内容 */
        if (!this.container) {
            this.create(elSize);
        }
        else {
            DomHandler.findSingle(this.container, '.f-tooltip-text').innerHTML = this.message;
        }
        this.container.style.maxWidth = window.innerWidth - 30 + "px";
        this.container.style.minWidth = '35px';
        if (tipWidth) {
            this.container.style.width = tipWidth;
        }
        if (tipHeight) {
            this.container.style.height = tipHeight;
        }
        /** @type {?} */
        var offset = DomHandler.getOffset(boxEl);
        /** @type {?} */
        var targetTop = offset.top;
        /** @type {?} */
        var targetLeft = offset.left;
        /** @type {?} */
        var left;
        /** @type {?} */
        var top;
        this.container.style.display = 'block';
        this.changeTooltipPosition(boxEl);
        /** @type {?} */
        var arrow = DomHandler.findSingle(this.container, '.f-tooltip-arrow');
        /** @type {?} */
        var tooltipSize = this.getTooltipSize();
        // 检查内容高度
        if (window.innerHeight - 10 < tooltipSize.height) {
            this.container.style.height = window.innerHeight - 20 + "px";
            tooltipSize.height = window.innerHeight - 25;
            /** @type {?} */
            var textContainer = this.getTextContainer();
            textContainer.style.height = tooltipSize.height + "px";
            textContainer.style.overflow = 'hidden';
        }
        /** @type {?} */
        var n = this.updateArrowPosition(arrow, offset, $event);
        switch (this.position) {
            case 'right':
                left = targetLeft + elSize.width;
                top = n;
                break;
            case 'left':
                left = targetLeft - tooltipSize.width;
                top = n;
                break;
            case 'top-left':
                top = targetTop - tooltipSize.height - 7;
                left = n;
                break;
        }
        if (left) {
            this.container.style.left = left + 'px';
        }
        this.container.style.top = top + 'px';
        this.container.style.zIndex = 999999;
    };
    /**
     * @private
     * @param {?} arrow
     * @param {?} elOffset
     * @param {?} $event
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.updateArrowPosition = /**
     * @private
     * @param {?} arrow
     * @param {?} elOffset
     * @param {?} $event
     * @return {?}
     */
    function (arrow, elOffset, $event) {
        /** @type {?} */
        var tooltipSize = this.getTooltipSize();
        if (this.position === 'left' || this.position === 'right') {
            /** @type {?} */
            var targetTop = elOffset.top;
            /** @type {?} */
            var halfHeight = tooltipSize.height / 2;
            /** @type {?} */
            var top_1 = 10;
            if (targetTop > halfHeight && window.innerHeight - targetTop > halfHeight) {
                top_1 = targetTop - tooltipSize.height / 2;
            }
            // 调整箭头的位置
            if (arrow) {
                arrow.style.top = targetTop - top_1 + "px";
            }
            return top_1;
        }
        else if (this.position === 'top-left') {
            /** @type {?} */
            var left = $event.pageX - tooltipSize.width / 2;
            if (left < 10) {
                left = elOffset.left;
            }
            if (left + tooltipSize.width > window.innerWidth) {
                left = window.innerWidth - tooltipSize.width - 20;
            }
            // 调整箭头的位置
            if (arrow) {
                if ($event.pageX - left > 28) {
                    if ($event.pageX - left + 28 > tooltipSize.width) {
                        arrow.style.left = tooltipSize.width - 28 + "px";
                    }
                    else {
                        arrow.style.left = $event.pageX - left + "px";
                    }
                }
            }
            return left;
        }
    };
    /**
     * @param {?} elSize
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.create = /**
     * @param {?} elSize
     * @return {?}
     */
    function (elSize) {
        /** @type {?} */
        var styleClass = this.tooltipCls();
        this.container = document.createElement('div');
        if (this.tooltipStyleClass) {
            styleClass += ' ' + this.tooltipStyleClass;
        }
        this.container.className = styleClass;
        /** @type {?} */
        var tooltipArrow = document.createElement('div');
        tooltipArrow.className = 'f-tooltip-arrow ';
        this.container.appendChild(tooltipArrow);
        /** @type {?} */
        var tooltipText = document.createElement('div');
        tooltipText.className = 'f-tooltip-text ';
        tooltipText.innerHTML = this.message;
        /** @type {?} */
        var maxWidth = window.innerWidth - 50;
        tooltipText.style.maxWidth = maxWidth + "px";
        tooltipText.style.wordBreak = 'break-all';
        this.container.style.textAlign = 'center';
        if (this.positionStyle) {
            this.container.style.position = this.positionStyle;
        }
        this.container.appendChild(tooltipText);
        document.body.appendChild(this.container);
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.tooltipCls = /**
     * @private
     * @return {?}
     */
    function () {
        return 'datagrid-cell-tooltip f-tooltip ' + this.getThemeCls() + ' f-tooltip-' + this.position + ' ' + this.cls;
    };
    /**
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getThemeCls = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.type) {
            return 'f-tooltip-' + this.type;
        }
        return '';
    };
    /** 获取宿主尺寸 */
    /**
     * 获取宿主尺寸
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getBoxSizeObj = /**
     * 获取宿主尺寸
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    function (boxEl) {
        /** @type {?} */
        var p = boxEl.getBoundingClientRect();
        return {
            width: DomHandler.getOuterWidth(boxEl),
            height: DomHandler.getOuterHeight(boxEl),
            left: p.left,
            right: p.right,
            top: p.top,
            bottom: p.bottom
        };
    };
    /** 获取tooltip 容器尺寸 */
    /**
     * 获取tooltip 容器尺寸
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getTooltipSize = /**
     * 获取tooltip 容器尺寸
     * @private
     * @return {?}
     */
    function () {
        return {
            width: DomHandler.getOuterWidth(this.container),
            height: DomHandler.getOuterHeight(this.container)
        };
    };
    /** 获取窗口尺寸 */
    /**
     * 获取窗口尺寸
     * @private
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.getWindowSize = /**
     * 获取窗口尺寸
     * @private
     * @return {?}
     */
    function () {
        return {
            width: window.innerWidth,
            height: window.innerHeight
        };
    };
    /** 根据内容的多少，自动更改tooltip 的位置 */
    /**
     * 根据内容的多少，自动更改tooltip 的位置
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    DatagridCellTooltipDirective.prototype.changeTooltipPosition = /**
     * 根据内容的多少，自动更改tooltip 的位置
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    function (boxEl) {
        /** @type {?} */
        var boxSize = this.getBoxSizeObj(boxEl);
        /** @type {?} */
        var tooltip = this.getTooltipSize();
        /** @type {?} */
        var winSize = this.getWindowSize();
        this.container.className = this.tooltipCls();
        if (tooltip.width < winSize.width && tooltip.height < boxSize.top) {
            // this.position = 'top-left';
            return;
        }
        else {
            /** @type {?} */
            var elOffset = DomHandler.getOffset(boxEl);
            /** @type {?} */
            var elLeft = elOffset.left;
            /** @type {?} */
            var elRight = winSize.width - elLeft - boxSize.width;
            if (elLeft > elRight) {
                this.position = 'left';
            }
            else {
                this.position = 'right';
            }
            /** @type {?} */
            var toolTipTextWidth = elLeft > elRight ? elLeft : elRight;
            /** @type {?} */
            var textEl = this.getTextContainer();
            textEl.style.maxWidth = toolTipTextWidth - 30 + "px";
            this.container.style.maxWidth = toolTipTextWidth + "px";
        }
    };
    DatagridCellTooltipDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[cell-tooltip]',
                    exportAs: 'cellTooltip'
                },] }
    ];
    /** @nocollapse */
    DatagridCellTooltipDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Injector }
    ]; };
    DatagridCellTooltipDirective.propDecorators = {
        enable: [{ type: Input, args: ['cell-tooltip',] }],
        position: [{ type: Input }],
        positionStyle: [{ type: Input }],
        tooltipStyleClass: [{ type: Input }],
        message: [{ type: Input }],
        delay: [{ type: Input }],
        cls: [{ type: Input }],
        type: [{ type: Input }],
        tipMode: [{ type: Input }]
    };
    return DatagridCellTooltipDirective;
}());
export { DatagridCellTooltipDirective };
if (false) {
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.enable;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.position;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.positionStyle;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tooltipStyleClass;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.message;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.delay;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.cls;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.type;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tipMode;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.container;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.showTipTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseenter;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseleave;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC10b29sdGlwLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90b29sdGlwL2NlbGwtdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQWEsS0FBSyxFQUFnQixVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFdkQ7SUE2Qkksc0NBQW9CLEVBQWMsRUFBVSxRQUFrQjtRQUExQyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZCckQsYUFBUSxHQUFrRixVQUFVLENBQUM7UUFJckcsVUFBSyxHQUFHLElBQUksQ0FBQztRQUViLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFDVCxTQUFJLEdBQThDLE1BQU0sQ0FBQztRQUN6RCxZQUFPLEdBQXVCLE1BQU0sQ0FBQztRQU10QyxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUdwQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBYyxJQUFJLENBQUM7UUFHN0IsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdB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S0FBSzswQkFDTCxLQUFLOztJQTJXVixtQ0FBQztDQUFBLEFBelhELElBeVhDO1NBclhZLDRCQUE0Qjs7O0lBQ3JDLDhDQUF1Qzs7SUFDdkMsZ0RBQThHOztJQUM5RyxxREFBK0I7O0lBQy9CLHlEQUFtQzs7SUFDbkMsK0NBQXlCOztJQUN6Qiw2Q0FBc0I7O0lBRXRCLDJDQUFrQjs7SUFDbEIsNENBQWtFOztJQUNsRSwrQ0FBOEM7O0lBSTlDLGlEQUFlOzs7OztJQUNmLG1EQUFpQzs7Ozs7SUFDakMsb0RBQTRCOzs7OztJQUc1QixtREFBMkI7Ozs7O0lBQzNCLG1EQUEyQjs7Ozs7SUFDM0IsbURBQTJCOzs7OztJQUMzQiw4Q0FBOEI7Ozs7O0lBQzlCLDhDQUFpQzs7Ozs7SUFDakMsMENBQThCOzs7OztJQUNsQiwwQ0FBc0I7Ozs7O0lBQUUsZ0RBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi8uLi8uLi91dGlscy91dGlscyc7XHJcbmltcG9ydCB7IE9uRGVzdHJveSwgSW5wdXQsIEhvc3RMaXN0ZW5lciwgRWxlbWVudFJlZiwgRGlyZWN0aXZlLCBJbmplY3RvciwgT25Jbml0LCBOZ1pvbmUsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlscyB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uJztcclxuaW1wb3J0IHsgRG9tSGFuZGxlciB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RvbWhhbmRsZXInO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tjZWxsLXRvb2x0aXBdJyxcclxuICAgIGV4cG9ydEFzOiAnY2VsbFRvb2x0aXAnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZENlbGxUb29sdGlwRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCdjZWxsLXRvb2x0aXAnKSBlbmFibGU6IGJvb2xlYW47XHJcbiAgICBASW5wdXQoKSBwb3NpdGlvbjogJ3RvcCcgfCAnYm90dG9tJyB8ICdsZWZ0JyB8ICdyaWdodCcgfCAndG9wLWxlZnQnIHwgJ3RvcC1jZW50ZXInIHwgJ3RvcC1yaWdodCcgPSAndG9wLWxlZnQnO1xyXG4gICAgQElucHV0KCkgcG9zaXRpb25TdHlsZTogc3RyaW5nO1xyXG4gICAgQElucHV0KCkgdG9vbHRpcFN0eWxlQ2xhc3M6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIG1lc3NhZ2U6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIGRlbGF5ID0gMTAwMDtcclxuXHJcbiAgICBASW5wdXQoKSBjbHMgPSAnJztcclxuICAgIEBJbnB1dCgpIHR5cGU6ICdkYW5nZXInIHwgJ3N1Y2Nlc3MnIHwgJ2luZm8nIHwgJ3dhcm5pbmcnID0gJ2luZm8nO1xyXG4gICAgQElucHV0KCkgdGlwTW9kZTogJ2FsbHdheXMnIHwgJ2F1dG8nID0gJ2F1dG8nO1xyXG5cclxuICAgIC8vIEBIb3N0QmluZGluZygnc3R5bGUud2lkdGgnKSBjbXBXaWR0aCA9ICcxMDAlJztcclxuXHJcbiAgICBjb250YWluZXI6IGFueTtcclxuICAgIHByaXZhdGUgY29tbW9uVXRpbHM6IENvbW1vblV0aWxzO1xyXG4gICAgcHJpdmF0ZSBzaG93VGlwVGltZXIgPSBudWxsO1xyXG5cclxuXHJcbiAgICBwcml2YXRlIF9tb3VzZWVudGVyID0gbnVsbDtcclxuICAgIHByaXZhdGUgX21vdXNlbGVhdmUgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfbW91c2VjbGljayA9IG51bGw7XHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lID0gbnVsbDtcclxuICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIGlmICh0aGlzLmluamVjdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbHMgPSB0aGlzLmluamVjdG9yLmdldChDb21tb25VdGlscywgbmV3IENvbW1vblV0aWxzKCkpO1xyXG4gICAgICAgICAgICB0aGlzLm5nWm9uZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nWm9uZSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyID0gdGhpcy5pbmplY3Rvci5nZXQoUmVuZGVyZXIyKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGcgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZENvbXBvbmVudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb21tb25VdGlscyA9IG5ldyBDb21tb25VdGlscygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubmdab25lICYmIHRoaXMuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlZW50ZXIgPSBVdGlscy5vbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgdGhpcy5vbk1vdXNlRW50ZXIuYmluZCh0aGlzKSwgeyB0YXJnZXQ6ICcuZi1kYXRhZ3JpZC1jZWxsLWNvbnRlbnQnLCBvcHRpb25zOiB7IGNhcHR1cmU6IHRydWUgfX0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2VsZWF2ZSA9IFV0aWxzLm9uKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnLCB0aGlzLm9uTW91c2VMZWF2ZS5iaW5kKHRoaXMpLCB7IHRhcmdldDogJy5mLWRhdGFncmlkLWNlbGwtY29udGVudCcsIG9wdGlvbnM6IHsgY2FwdHVyZTogdHJ1ZSB9fSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZWNsaWNrID0gVXRpbHMub24odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgdGhpcy5vbkNsaWNrLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlZW50ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VlbnRlcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlbGVhdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VsZWF2ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlY2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VjbGljaygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdGhpcy5kZyA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3VzZUVudGVyKCRldmVudDogYW55KSB7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICgkZXZlbnQuZnJvbUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKCEkZXZlbnQuZnJvbUVsZW1lbnQuY2xvc2VzdCgnLmYtZGF0YWdyaWQnKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgY29uc3QgY2VsbFRpcHRpbWVyID0gdGhpcy5kZyA/IHRoaXMuZGcuY2VsbFRpcFRpbWVyIDogMTAwMDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd1RpcFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNob3dUaXBUaW1lcik7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1RpcFRpbWVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaG93VGlwVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zaG93KCRldmVudCk7XHJcbiAgICAgICAgfSwgY2VsbFRpcHRpbWVyKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk1vdXNlTGVhdmUoKSB7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGljayhlOiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgLy8gZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFRleHRDb250YWluZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIERvbUhhbmRsZXIuZmluZFNpbmdsZSh0aGlzLmNvbnRhaW5lciwgJy5mLXRvb2x0aXAtdGV4dCcpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZG9ub3RTaG93VGlwcyh0YXJnZXQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHRkV2lkdGggPSB0YXJnZXQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgY29uc3QgdGFnZXRTdHkgPSAgd2luZG93LmdldENvbXB1dGVkU3R5bGUodGFyZ2V0KTtcclxuICAgICAgICBjb25zdCB0eHRXaWR0aCA9IHRoaXMuY29tbW9uVXRpbHMuZ2V0VGV4dFdpZHRoKHRoaXMubWVzc2FnZSwgdGFnZXRTdHkuZm9udCk7XHJcbiAgICAgICAgY29uc3QgeyBwYWRkaW5nTGVmdCwgcGFkZGluZ1JpZ2h0IH0gPSB0YWdldFN0eTtcclxuICAgICAgICBjb25zdCBfd2lkdGggPSB0ZFdpZHRoIC0gKE51bWJlcihwYWRkaW5nTGVmdC5yZXBsYWNlKCdweCcsICcnKSkgfHwgMCkgLSAoTnVtYmVyKHBhZGRpbmdSaWdodC5yZXBsYWNlKCdweCcsICcnKSkgfHwgMCk7XHJcblxyXG4gICAgICAgIGxldCB0ciA9IHRhcmdldC5jbG9zZXN0KCd0cicpO1xyXG4gICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICBjb25zdCB0cklkID0gdHIuaWQ7XHJcbiAgICAgICAgICAgIC8vIHRyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycrIHRySWQpO1xyXG4gICAgICAgICAgICB0ciA9IFV0aWxzLmdldFRyRG9tQnlJZCh0cklkLCBkb2N1bWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy50aXBNb2RlID09PSAnYXV0bycpIHtcclxuICAgICAgICAgICAgaWYgKHRyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3dpZHRoICYmIF93aWR0aCA+IHR4dFdpZHRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ciA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZSgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNob3dUaXBUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zaG93VGlwVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dUaXBUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jb250YWluZXIgJiYgdGhpcy5jb250YWluZXIucGFyZW50RWxlbWVudCkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3coJGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgY2VsbEVsID0gJGV2ZW50LnRhcmdldCBhcyBhbnk7XHJcbiAgICAgICAgLy8gdGhpcy5lbmFibGUgPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCdjZWxsLXRvb2x0aXAnKSA9PT0gJ3RydWUnO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZSA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ21lc3NhZ2UnKTtcclxuICAgICAgICB0aGlzLnRpcE1vZGUgPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCd0aXBNb2RlJykgfHwgJ2F1dG8nO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlIHx8ICF0aGlzLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdGlwV2lkdGggPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCd0aXBXaWR0aCcpO1xyXG4gICAgICAgIGNvbnN0IHRpcEhlaWdodCA9IGNlbGxFbC5nZXRBdHRyaWJ1dGUoJ3RpcEhlaWdodCcpO1xyXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCdwb3NpdGlvbicpIHx8ICd0b3AtbGVmdCc7XHJcblxyXG4gICAgICAgIC8vIOajgOafpeS4i+WGheWuueWuveW6puaYr+WQpui2heWHuuWIl+WuvVxyXG4gICAgICAgIGlmICh0aGlzLmRvbm90U2hvd1RpcHMoJGV2ZW50LnRhcmdldCkgJiYgY2VsbEVsLmlubmVyVGV4dCA9PT0gdGhpcy5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvbnN0IGJveEVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIGNvbnN0IGJveEVsID0gJGV2ZW50LnRhcmdldDtcclxuICAgICAgICBjb25zdCBlbFNpemUgPSB0aGlzLmdldEJveFNpemVPYmooYm94RWwpO1xyXG5cclxuXHJcbiAgICAgICAgLyoqIOWmguaenOWtmOWcqOWImeS4jeaWsOW7uu+8jOWPqumcgOimgeS/ruaUuemHjOmdoueahOWGheWuuSAqL1xyXG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGUoZWxTaXplKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBEb21IYW5kbGVyLmZpbmRTaW5nbGUodGhpcy5jb250YWluZXIsICcuZi10b29sdGlwLXRleHQnKS5pbm5lckhUTUwgPSB0aGlzLm1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5tYXhXaWR0aCA9IGAke3dpbmRvdy5pbm5lcldpZHRoIC0gMzB9cHhgO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLm1pbldpZHRoID0gJzM1cHgnO1xyXG5cclxuICAgICAgICBpZiAodGlwV2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUud2lkdGggPSB0aXBXaWR0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aXBIZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gdGlwSGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IERvbUhhbmRsZXIuZ2V0T2Zmc2V0KGJveEVsKTtcclxuICAgICAgICBjb25zdCB0YXJnZXRUb3AgPSBvZmZzZXQudG9wO1xyXG4gICAgICAgIGNvbnN0IHRhcmdldExlZnQgPSBvZmZzZXQubGVmdDtcclxuICAgICAgICBsZXQgbGVmdDogbnVtYmVyO1xyXG4gICAgICAgIGxldCB0b3A6IG51bWJlcjtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VUb29sdGlwUG9zaXRpb24oYm94RWwpO1xyXG4gICAgICAgIGNvbnN0IGFycm93ID0gRG9tSGFuZGxlci5maW5kU2luZ2xlKHRoaXMuY29udGFpbmVyLCAnLmYtdG9vbHRpcC1hcnJvdycpO1xyXG4gICAgICAgIGNvbnN0IHRvb2x0aXBTaXplID0gdGhpcy5nZXRUb29sdGlwU2l6ZSgpO1xyXG5cclxuICAgICAgICAvLyDmo4Dmn6XlhoXlrrnpq5jluqZcclxuICAgICAgICBpZiAod2luZG93LmlubmVySGVpZ2h0IC0gMTAgPCB0b29sdGlwU2l6ZS5oZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7d2luZG93LmlubmVySGVpZ2h0IC0gMjB9cHhgO1xyXG5cclxuICAgICAgICAgICAgdG9vbHRpcFNpemUuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gMjU7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHRDb250YWluZXIgPSB0aGlzLmdldFRleHRDb250YWluZXIoKTtcclxuICAgICAgICAgICAgdGV4dENvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBgJHt0b29sdGlwU2l6ZS5oZWlnaHR9cHhgO1xyXG4gICAgICAgICAgICB0ZXh0Q29udGFpbmVyLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgY29uc3QgbiA9IHRoaXMudXBkYXRlQXJyb3dQb3NpdGlvbihhcnJvdywgb2Zmc2V0LCAkZXZlbnQpO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5wb3NpdGlvbikge1xyXG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gdGFyZ2V0TGVmdCArIGVsU2l6ZS53aWR0aDtcclxuICAgICAgICAgICAgICAgIHRvcCA9IG47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gdGFyZ2V0TGVmdCAtIHRvb2x0aXBTaXplLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdG9wID0gbjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgICAgICAgICB0b3AgPSB0YXJnZXRUb3AgLSB0b29sdGlwU2l6ZS5oZWlnaHQgLSA3O1xyXG4gICAgICAgICAgICAgICAgbGVmdCA9IG47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChsZWZ0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuekluZGV4ID0gOTk5OTk5O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlQXJyb3dQb3NpdGlvbihhcnJvdzogYW55LCBlbE9mZnNldDogeyB0b3AsIGxlZnQgfSwgJGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0b29sdGlwU2l6ZSA9IHRoaXMuZ2V0VG9vbHRpcFNpemUoKTtcclxuICAgICAgICBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ2xlZnQnIHx8IHRoaXMucG9zaXRpb24gPT09ICdyaWdodCcpIHtcclxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0VG9wID0gZWxPZmZzZXQudG9wO1xyXG4gICAgICAgICAgICBjb25zdCBoYWxmSGVpZ2h0ID0gdG9vbHRpcFNpemUuaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgbGV0IHRvcCA9IDEwO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0VG9wID4gaGFsZkhlaWdodCAmJiB3aW5kb3cuaW5uZXJIZWlnaHQgLSB0YXJnZXRUb3AgPiBoYWxmSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0b3AgPSB0YXJnZXRUb3AgLSB0b29sdGlwU2l6ZS5oZWlnaHQgLyAyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDosIPmlbTnrq3lpLTnmoTkvY3nva5cclxuICAgICAgICAgICAgaWYgKGFycm93KSB7XHJcbiAgICAgICAgICAgICAgICBhcnJvdy5zdHlsZS50b3AgPSBgJHt0YXJnZXRUb3AgLSB0b3B9cHhgO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdG9wO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ3RvcC1sZWZ0Jykge1xyXG4gICAgICAgICAgICBsZXQgbGVmdCA9ICRldmVudC5wYWdlWCAtIHRvb2x0aXBTaXplLndpZHRoIC8gMjtcclxuXHJcbiAgICAgICAgICAgIGlmIChsZWZ0IDwgMTApIHtcclxuICAgICAgICAgICAgICAgIGxlZnQgPSBlbE9mZnNldC5sZWZ0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobGVmdCArIHRvb2x0aXBTaXplLndpZHRoID4gd2luZG93LmlubmVyV2lkdGgpIHtcclxuICAgICAgICAgICAgICAgIGxlZnQgPSB3aW5kb3cuaW5uZXJXaWR0aCAtIHRvb2x0aXBTaXplLndpZHRoIC0gMjA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g6LCD5pW0566t5aS055qE5L2N572uXHJcbiAgICAgICAgICAgIGlmIChhcnJvdykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRldmVudC5wYWdlWCAtIGxlZnQgPiAyOCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkZXZlbnQucGFnZVggLSBsZWZ0ICsgMjggPiB0b29sdGlwU2l6ZS53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJvdy5zdHlsZS5sZWZ0ID0gYCR7dG9vbHRpcFNpemUud2lkdGggLSAyOCB9cHhgO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFycm93LnN0eWxlLmxlZnQgPSBgJHskZXZlbnQucGFnZVggLSBsZWZ0IH1weGA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGVmdDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlKGVsU2l6ZTogYW55KSB7XHJcbiAgICAgICAgbGV0IHN0eWxlQ2xhc3MgPSB0aGlzLnRvb2x0aXBDbHMoKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGlmICh0aGlzLnRvb2x0aXBTdHlsZUNsYXNzKSB7XHJcbiAgICAgICAgICAgIHN0eWxlQ2xhc3MgKz0gJyAnICsgdGhpcy50b29sdGlwU3R5bGVDbGFzcztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gc3R5bGVDbGFzcztcclxuXHJcbiAgICAgICAgY29uc3QgdG9vbHRpcEFycm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdG9vbHRpcEFycm93LmNsYXNzTmFtZSA9ICdmLXRvb2x0aXAtYXJyb3cgJztcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0b29sdGlwQXJyb3cpO1xyXG5cclxuICAgICAgICBjb25zdCB0b29sdGlwVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRvb2x0aXBUZXh0LmNsYXNzTmFtZSA9ICdmLXRvb2x0aXAtdGV4dCAnO1xyXG4gICAgICAgIHRvb2x0aXBUZXh0LmlubmVySFRNTCA9IHRoaXMubWVzc2FnZTtcclxuXHJcbiAgICAgICAgY29uc3QgbWF4V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAtIDUwO1xyXG4gICAgICAgIHRvb2x0aXBUZXh0LnN0eWxlLm1heFdpZHRoID0gYCR7bWF4V2lkdGh9cHhgO1xyXG5cclxuICAgICAgICB0b29sdGlwVGV4dC5zdHlsZS53b3JkQnJlYWsgPSAnYnJlYWstYWxsJztcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS50ZXh0QWxpZ24gPSAnY2VudGVyJztcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucG9zaXRpb25TdHlsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IHRoaXMucG9zaXRpb25TdHlsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRvb2x0aXBUZXh0KTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHRvb2x0aXBDbHMoKSB7XHJcbiAgICAgICAgcmV0dXJuICdkYXRhZ3JpZC1jZWxsLXRvb2x0aXAgZi10b29sdGlwICcgKyB0aGlzLmdldFRoZW1lQ2xzKCkgKyAnIGYtdG9vbHRpcC0nICsgdGhpcy5wb3NpdGlvbiArICcgJyArIHRoaXMuY2xzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VGhlbWVDbHMoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2YtdG9vbHRpcC0nICsgdGhpcy50eXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiOt+WPluWuv+S4u+WwuuWvuCAqL1xyXG4gICAgcHJpdmF0ZSBnZXRCb3hTaXplT2JqKGJveEVsKSB7XHJcbiAgICAgICAgY29uc3QgcCA9IGJveEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiBEb21IYW5kbGVyLmdldE91dGVyV2lkdGgoYm94RWwpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IERvbUhhbmRsZXIuZ2V0T3V0ZXJIZWlnaHQoYm94RWwpLFxyXG4gICAgICAgICAgICBsZWZ0OiBwLmxlZnQsXHJcbiAgICAgICAgICAgIHJpZ2h0OiBwLnJpZ2h0LFxyXG4gICAgICAgICAgICB0b3A6IHAudG9wLFxyXG4gICAgICAgICAgICBib3R0b206IHAuYm90dG9tXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+WdG9vbHRpcCDlrrnlmajlsLrlr7ggKi9cclxuICAgIHByaXZhdGUgZ2V0VG9vbHRpcFNpemUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IERvbUhhbmRsZXIuZ2V0T3V0ZXJXaWR0aCh0aGlzLmNvbnRhaW5lciksXHJcbiAgICAgICAgICAgIGhlaWdodDogRG9tSGFuZGxlci5nZXRPdXRlckhlaWdodCh0aGlzLmNvbnRhaW5lcilcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDojrflj5bnqpflj6PlsLrlr7ggKi9cclxuICAgIHByaXZhdGUgZ2V0V2luZG93U2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDogd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5qC55o2u5YaF5a6555qE5aSa5bCR77yM6Ieq5Yqo5pu05pS5dG9vbHRpcCDnmoTkvY3nva4gKi9cclxuICAgIHByaXZhdGUgY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGJveEVsOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBib3hTaXplID0gdGhpcy5nZXRCb3hTaXplT2JqKGJveEVsKTtcclxuICAgICAgICBjb25zdCB0b29sdGlwID0gdGhpcy5nZXRUb29sdGlwU2l6ZSgpO1xyXG4gICAgICAgIGNvbnN0IHdpblNpemUgPSB0aGlzLmdldFdpbmRvd1NpemUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gdGhpcy50b29sdGlwQ2xzKCk7XHJcblxyXG4gICAgICAgIGlmICh0b29sdGlwLndpZHRoIDwgd2luU2l6ZS53aWR0aCAmJiB0b29sdGlwLmhlaWdodCA8IGJveFNpemUudG9wKSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMucG9zaXRpb24gPSAndG9wLWxlZnQnO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgZWxPZmZzZXQgPSBEb21IYW5kbGVyLmdldE9mZnNldChib3hFbCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsTGVmdCA9IGVsT2Zmc2V0LmxlZnQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsUmlnaHQgPSB3aW5TaXplLndpZHRoIC0gZWxMZWZ0IC0gYm94U2l6ZS53aWR0aDtcclxuXHJcbiAgICAgICAgICAgIGlmIChlbExlZnQgPiBlbFJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gJ2xlZnQnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9ICdyaWdodCc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRvb2xUaXBUZXh0V2lkdGggPSBlbExlZnQgPiBlbFJpZ2h0ID8gZWxMZWZ0IDogZWxSaWdodDtcclxuICAgICAgICAgICAgY29uc3QgdGV4dEVsID0gdGhpcy5nZXRUZXh0Q29udGFpbmVyKCk7XHJcbiAgICAgICAgICAgIHRleHRFbC5zdHlsZS5tYXhXaWR0aCA9IGAke3Rvb2xUaXBUZXh0V2lkdGggLSAzMH1weGA7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLm1heFdpZHRoID0gYCR7dG9vbFRpcFRleHRXaWR0aH1weGA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuIl19
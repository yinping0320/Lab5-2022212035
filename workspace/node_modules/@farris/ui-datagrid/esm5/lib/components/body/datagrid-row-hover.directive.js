/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-09-26 17:17:32
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, NgZone, Renderer2, ElementRef, Inject, forwardRef, ChangeDetectorRef } from '@angular/core';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridComponent } from './../../datagrid.component';
import { Utils } from './../../utils/utils';
var DatagridRowHoverDirective = /** @class */ (function () {
    function DatagridRowHoverDirective(dg, dgb, cd, el, zone, render) {
        this.dg = dg;
        this.dgb = dgb;
        this.cd = cd;
        this.el = el;
        this.zone = zone;
        this.render = render;
        this._mouseenter = null;
        this._mouseleave = null;
    }
    /**
     * @return {?}
     */
    DatagridRowHoverDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.dg.rowHover && !this.dg.fast) {
            this.zone.runOutsideAngular((/**
             * @return {?}
             */
            function () {
                _this._mouseenter = Utils.on(_this.el.nativeElement, 'mouseenter', _this.onmouseenter.bind(_this), { target: '.f-datagrid-body-row', options: { capture: true } });
                _this._mouseleave = Utils.on(_this.el.nativeElement, 'mouseleave', _this.onmouseleave.bind(_this), { target: '.f-datagrid-body-row', options: { capture: true } });
            }));
        }
    };
    /**
     * @return {?}
     */
    DatagridRowHoverDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this._mouseenter) {
            this._mouseenter();
        }
        if (this._mouseleave) {
            this._mouseleave();
        }
    };
    // @HostListener('mouseenter')
    // @HostListener('mouseenter')
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridRowHoverDirective.prototype.onmouseenter = 
    // @HostListener('mouseenter')
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.setRowHoverCls(event);
    };
    // @HostListener('mouseleave')
    // @HostListener('mouseleave')
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridRowHoverDirective.prototype.onmouseleave = 
    // @HostListener('mouseleave')
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.setRowHoverCls(event, false);
    };
    /**
     * @param {?} event
     * @param {?=} hover
     * @return {?}
     */
    DatagridRowHoverDirective.prototype.setRowHoverCls = /**
     * @param {?} event
     * @param {?=} hover
     * @return {?}
     */
    function (event, hover) {
        if (hover === void 0) { hover = true; }
        if (!this.dg.rowHover) {
            return;
        }
        if (!event.target.matches('.f-datagrid-body-row')) {
            return;
        }
        this.rowIndex = event.target.getAttribute('index');
        /** @type {?} */
        var leftTableCls = 'f-datagrid-body-fixed-left';
        /** @type {?} */
        var rightTableCls = 'f-datagrid-body-fixed-right';
        /** @type {?} */
        var centerTableCls = 'f-datagrid-body-center';
        /** @type {?} */
        var body = this.dg.el.nativeElement.querySelector('.f-datagrid-body');
        if (!body) {
            return;
        }
        /** @type {?} */
        var leftTableDom = body.querySelector("." + leftTableCls);
        /** @type {?} */
        var rightTableDom = body.querySelector("." + rightTableCls);
        /** @type {?} */
        var centerTableDom = body.querySelector("." + centerTableCls);
        /** @type {?} */
        var method = hover ? 'addClass' : 'removeClass';
        /** @type {?} */
        var trSelector = "tr[index=\"" + this.rowIndex + "\"]";
        /** @type {?} */
        var dom = this.el.nativeElement.closest('div');
        if (dom && dom.className) {
            /** @type {?} */
            var trDom = centerTableDom.querySelector(trSelector);
            if (!trDom) {
                return;
            }
            if (trDom.className.indexOf('f-datagrid-disable-row') > -1) {
                return;
            }
            /** @type {?} */
            var ltr = null;
            /** @type {?} */
            var rtr = null;
            if (rightTableDom) {
                rtr = rightTableDom.querySelector(trSelector);
            }
            if (leftTableDom) {
                ltr = leftTableDom.querySelector(trSelector);
            }
            if (leftTableDom && ltr) {
                this.render[method](ltr, this.dg.hoverRowCls);
            }
            if (rightTableDom && rtr) {
                this.render[method](rtr, this.dg.hoverRowCls);
            }
            this.render[method](trDom, this.dg.hoverRowCls);
        }
    };
    DatagridRowHoverDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[row-hover]',
                    exportAs: 'rowHover'
                },] }
    ];
    /** @nocollapse */
    DatagridRowHoverDirective.ctorParameters = function () { return [
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: DatagridBodyComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridBodyComponent; })),] }] },
        { type: ChangeDetectorRef },
        { type: ElementRef },
        { type: NgZone },
        { type: Renderer2 }
    ]; };
    DatagridRowHoverDirective.propDecorators = {
        rowIndex: [{ type: Input }],
        rowData: [{ type: Input, args: ['row-hover',] }]
    };
    return DatagridRowHoverDirective;
}());
export { DatagridRowHoverDirective };
if (false) {
    /** @type {?} */
    DatagridRowHoverDirective.prototype.rowIndex;
    /** @type {?} */
    DatagridRowHoverDirective.prototype.rowData;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype._mouseenter;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype._mouseleave;
    /** @type {?} */
    DatagridRowHoverDirective.prototype.dg;
    /** @type {?} */
    DatagridRowHoverDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    DatagridRowHoverDirective.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtcm93LWhvdmVyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9ib2R5L2RhdGFncmlkLXJvdy1ob3Zlci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBU0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQWEsTUFBTSxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBZ0IsTUFBTSxlQUFlLENBQUM7QUFDeEosT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzVDO0lBWUksbUNBQ3dELEVBQXFCLEVBQ2pCLEdBQTBCLEVBQzFFLEVBQXFCLEVBQ3JCLEVBQWMsRUFBVSxJQUFZLEVBQVUsTUFBaUI7UUFIbkIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDakIsUUFBRyxHQUFILEdBQUcsQ0FBdUI7UUFDMUUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDckIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLFNBQUksR0FBSixJQUFJLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBUG5FLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ25CLGdCQUFXLEdBQUcsSUFBSSxDQUFDO0lBTzNCLENBQUM7Ozs7SUFFRCw0Q0FBUTs7O0lBQVI7UUFBQSxpQkFPQztRQU5HLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRTtZQUNuQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQjs7O1lBQUU7Z0JBQ3pCLEtBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxZQUFZLEVBQUUsS0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsc0JBQXNCLEVBQUUsT0FBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxFQUFDLENBQUMsQ0FBQztnQkFDOUosS0FBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLFlBQVksRUFBRSxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxzQkFBc0IsRUFBRSxPQUFPLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEVBQUMsQ0FBQyxDQUFDO1lBQ2xLLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7O0lBRUQsK0NBQVc7OztJQUFYO1FBQ0ksSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2xCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUN0QjtRQUVELElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNsQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDdEI7SUFDTCxDQUFDO0lBRUQsOEJBQThCOzs7Ozs7SUFDOUIsZ0RBQVk7Ozs7OztJQUFaLFVBQWEsS0FBSztRQUNkLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELDhCQUE4Qjs7Ozs7O0lBQzlCLGdEQUFZOzs7Ozs7SUFBWixVQUFhLEtBQUs7UUFDZCxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN0QyxDQUFDOzs7Ozs7SUFFRCxrREFBYzs7Ozs7SUFBZCxVQUFlLEtBQUssRUFBRSxLQUFZO1FBQVosc0JBQUEsRUFBQSxZQUFZO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRTtZQUNuQixPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsc0JBQXNCLENBQUMsRUFBRTtZQUMvQyxPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDOztZQUU3QyxZQUFZLEdBQUcsNEJBQTRCOztZQUMzQyxhQUFhLEdBQUcsNkJBQTZCOztZQUM3QyxjQUFjLEdBQUcsd0JBQXdCOztZQUV6QyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQztRQUV2RSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsT0FBTztTQUNWOztZQUVLLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQUksWUFBYyxDQUFDOztZQUNyRCxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFJLGFBQWUsQ0FBQzs7WUFDdkQsY0FBYyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBSSxjQUFnQixDQUFDOztZQUV6RCxNQUFNLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLGFBQWE7O1lBQzNDLFVBQVUsR0FBRyxnQkFBYSxJQUFJLENBQUMsUUFBUSxRQUFJOztZQUMzQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztRQUNoRCxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsU0FBUyxFQUFFOztnQkFDaEIsS0FBSyxHQUFHLGNBQWMsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1lBRXRELElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ1IsT0FBTzthQUNWO1lBRUQsSUFBSSxLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUN4RCxPQUFPO2FBQ1Y7O2dCQUNHLEdBQUcsR0FBRyxJQUFJOztnQkFDVixHQUFHLEdBQUcsSUFBSTtZQUNkLElBQUksYUFBYSxFQUFFO2dCQUNmLEdBQUcsR0FBRyxhQUFhLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2FBQ2pEO1lBQ0QsSUFBSSxZQUFZLEVBQUU7Z0JBQ2QsR0FBRyxHQUFHLFlBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDaEQ7WUFFRCxJQUFJLFlBQVksSUFBSSxHQUFHLEVBQUU7Z0JBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDakQ7WUFDRCxJQUFJLGFBQWEsSUFBSSxHQUFHLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDakQ7WUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBRW5EO0lBQ0wsQ0FBQzs7Z0JBekdKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsYUFBYTtvQkFDdkIsUUFBUSxFQUFFLFVBQVU7aUJBQ3ZCOzs7O2dCQUxRLGlCQUFpQix1QkFlakIsTUFBTSxTQUFDLFVBQVU7Ozt3QkFBQyxjQUFNLE9BQUEsaUJBQWlCLEVBQWpCLENBQWlCLEVBQUM7Z0JBaEIxQyxxQkFBcUIsdUJBaUJyQixNQUFNLFNBQUMsVUFBVTs7O3dCQUFDLGNBQU0sT0FBQSxxQkFBcUIsRUFBckIsQ0FBcUIsRUFBQztnQkFsQjBDLGlCQUFpQjtnQkFBNUQsVUFBVTtnQkFBckMsTUFBTTtnQkFBVSxTQUFTOzs7MkJBVS9DLEtBQUs7MEJBQ0wsS0FBSyxTQUFDLFdBQVc7O0lBb0d0QixnQ0FBQztDQUFBLEFBM0dELElBMkdDO1NBdkdZLHlCQUF5Qjs7O0lBRWxDLDZDQUEwQjs7SUFDMUIsNENBQWlDOzs7OztJQUVqQyxnREFBMkI7Ozs7O0lBQzNCLGdEQUEyQjs7SUFHdkIsdUNBQXlFOztJQUN6RSx3Q0FBa0Y7Ozs7O0lBQ2xGLHVDQUE2Qjs7Ozs7SUFDN0IsdUNBQXNCOzs7OztJQUFFLHlDQUFvQjs7Ozs7SUFBRSwyQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0MzowN1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0wOS0yNiAxNzoxNzozMlxyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgTmdab25lLCBPbkluaXQsIFJlbmRlcmVyMiwgRWxlbWVudFJlZiwgT25EZXN0cm95LCBJbmplY3QsIGZvcndhcmRSZWYsIENoYW5nZURldGVjdG9yUmVmLCBIb3N0TGlzdGVuZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4vLi4vLi4vdXRpbHMvdXRpbHMnO1xyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW3Jvdy1ob3Zlcl0nLFxyXG4gICAgZXhwb3J0QXM6ICdyb3dIb3ZlcidcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkUm93SG92ZXJEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcblxyXG4gICAgQElucHV0KCkgcm93SW5kZXg6IG51bWJlcjtcclxuICAgIEBJbnB1dCgncm93LWhvdmVyJykgcm93RGF0YTogYW55O1xyXG5cclxuICAgIHByaXZhdGUgX21vdXNlZW50ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfbW91c2VsZWF2ZSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IERhdGFncmlkQ29tcG9uZW50KSkgcHVibGljIGRnOiBEYXRhZ3JpZENvbXBvbmVudCxcclxuICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRCb2R5Q29tcG9uZW50KSkgcHVibGljIGRnYjogRGF0YWdyaWRCb2R5Q29tcG9uZW50LFxyXG4gICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgem9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcucm93SG92ZXIgJiYgIXRoaXMuZGcuZmFzdCkge1xyXG4gICAgICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlZW50ZXIgPSBVdGlscy5vbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgdGhpcy5vbm1vdXNlZW50ZXIuYmluZCh0aGlzKSwgeyB0YXJnZXQ6ICcuZi1kYXRhZ3JpZC1ib2R5LXJvdycsIG9wdGlvbnM6IHsgY2FwdHVyZTogdHJ1ZSB9fSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZWxlYXZlID0gVXRpbHMub24odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2VsZWF2ZScsIHRoaXMub25tb3VzZWxlYXZlLmJpbmQodGhpcyksIHsgdGFyZ2V0OiAnLmYtZGF0YWdyaWQtYm9keS1yb3cnLCBvcHRpb25zOiB7IGNhcHR1cmU6IHRydWUgfX0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlZW50ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VlbnRlcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlbGVhdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5fbW91c2VsZWF2ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBASG9zdExpc3RlbmVyKCdtb3VzZWVudGVyJylcclxuICAgIG9ubW91c2VlbnRlcihldmVudCkge1xyXG4gICAgICAgIHRoaXMuc2V0Um93SG92ZXJDbHMoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKVxyXG4gICAgb25tb3VzZWxlYXZlKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5zZXRSb3dIb3ZlckNscyhldmVudCwgZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFJvd0hvdmVyQ2xzKGV2ZW50LCBob3ZlciA9IHRydWUpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcucm93SG92ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFldmVudC50YXJnZXQubWF0Y2hlcygnLmYtZGF0YWdyaWQtYm9keS1yb3cnKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJvd0luZGV4ID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnaW5kZXgnKTtcclxuXHJcbiAgICAgICAgY29uc3QgbGVmdFRhYmxlQ2xzID0gJ2YtZGF0YWdyaWQtYm9keS1maXhlZC1sZWZ0JztcclxuICAgICAgICBjb25zdCByaWdodFRhYmxlQ2xzID0gJ2YtZGF0YWdyaWQtYm9keS1maXhlZC1yaWdodCc7XHJcbiAgICAgICAgY29uc3QgY2VudGVyVGFibGVDbHMgPSAnZi1kYXRhZ3JpZC1ib2R5LWNlbnRlcic7XHJcblxyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmYtZGF0YWdyaWQtYm9keScpO1xyXG5cclxuICAgICAgICBpZiAoIWJvZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbGVmdFRhYmxlRG9tID0gYm9keS5xdWVyeVNlbGVjdG9yKGAuJHtsZWZ0VGFibGVDbHN9YCk7XHJcbiAgICAgICAgY29uc3QgcmlnaHRUYWJsZURvbSA9IGJvZHkucXVlcnlTZWxlY3RvcihgLiR7cmlnaHRUYWJsZUNsc31gKTtcclxuICAgICAgICBjb25zdCBjZW50ZXJUYWJsZURvbSA9IGJvZHkucXVlcnlTZWxlY3RvcihgLiR7Y2VudGVyVGFibGVDbHN9YCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IGhvdmVyID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyc7XHJcbiAgICAgICAgY29uc3QgdHJTZWxlY3RvciA9IGB0cltpbmRleD1cIiR7dGhpcy5yb3dJbmRleH1cIl1gO1xyXG4gICAgICAgIGNvbnN0IGRvbSA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbG9zZXN0KCdkaXYnKTtcclxuICAgICAgICBpZiAoZG9tICYmIGRvbS5jbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJEb20gPSBjZW50ZXJUYWJsZURvbS5xdWVyeVNlbGVjdG9yKHRyU2VsZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0ckRvbSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHJEb20uY2xhc3NOYW1lLmluZGV4T2YoJ2YtZGF0YWdyaWQtZGlzYWJsZS1yb3cnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGx0ciA9IG51bGw7XHJcbiAgICAgICAgICAgIGxldCBydHIgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAocmlnaHRUYWJsZURvbSkge1xyXG4gICAgICAgICAgICAgICAgcnRyID0gcmlnaHRUYWJsZURvbS5xdWVyeVNlbGVjdG9yKHRyU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChsZWZ0VGFibGVEb20pIHtcclxuICAgICAgICAgICAgICAgIGx0ciA9IGxlZnRUYWJsZURvbS5xdWVyeVNlbGVjdG9yKHRyU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobGVmdFRhYmxlRG9tICYmIGx0cikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJbbWV0aG9kXShsdHIsIHRoaXMuZGcuaG92ZXJSb3dDbHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyaWdodFRhYmxlRG9tICYmIHJ0cikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJbbWV0aG9kXShydHIsIHRoaXMuZGcuaG92ZXJSb3dDbHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclttZXRob2RdKHRyRG9tLCB0aGlzLmRnLmhvdmVyUm93Q2xzKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { filter, takeUntil } from 'rxjs/operators';
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2019-08-12 07:47:12
* @LastEditors: 疯狂秀才(Lucas Huang)
* @LastEditTime: 2019-11-27 13:31:43
* @QQ: 1055818239
* @Version: v0.0.1
*/
import { Renderer2, Self, NgZone, ChangeDetectorRef, Optional, ContentChildren, QueryList } from '@angular/core';
import { Validators, FormBuilder, FormGroup } from '@angular/forms';
import { Subject } from 'rxjs';
import { Directive, Input, Output, EventEmitter, ElementRef, Injector, Inject, forwardRef } from '@angular/core';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridRowHoverDirective } from './datagrid-row-hover.directive';
import { Utils } from '../../utils/utils';
import { DatagridBodyComponent } from './datagrid-body.component';
import { ALLOW_EDIT_CELL_HIGHLIGHT_CLS, CUSTOM_ROW_CLS } from '../../types/constant';
var DatagridRowDirective = /** @class */ (function () {
    function DatagridRowDirective(dg, injector, fb, el, render, drHover) {
        this.dg = dg;
        this.injector = injector;
        this.fb = fb;
        this.el = el;
        this.render = render;
        this.drHover = drHover;
        this.editable = false;
        this.clickHandler = new EventEmitter();
        this.rowUpdated = new EventEmitter();
        this.form = new FormGroup({});
        this.documentRowDblclickEvent = null;
        this.columnsChangedSubscription = null;
        this.datasourceChangedSubscription = null;
        this.subscriptions = [];
        this.destroy$ = new Subject();
        this.dfs = this.injector.get(DatagridFacadeService);
        this.ngZone = this.injector.get(NgZone);
        this.cd = this.injector.get(ChangeDetectorRef);
        this.dgb = this.injector.get(DatagridBodyComponent);
    }
    Object.defineProperty(DatagridRowDirective.prototype, "rowId", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.rowData) {
                return this.dfs.primaryId(this.rowData);
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridRowDirective.prototype, "disabled", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.dg.disableRow) {
                return this.dg.disableRow(this.rowData, this.rowIndex);
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.datasourceChangedSubscription = this.dg.dgs.onDataSourceChange.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.renderCustomStyle();
        }));
        this.columnsChangedSubscription = this.dg.dgs.columnsChanged.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.createControl();
        }));
        /** @type {?} */
        var s$ = this.dg.dfs.rowUpdate$.pipe(takeUntil(this.destroy$), filter((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            return row.keyID === _this.rowId;
        }))).subscribe((/**
         * @param {?} row
         * @return {?}
         */
        function (row) {
            if (row && row.data) {
                // this.rowData = cloneDeep(row.data);
                if (_this.dfs.primaryId(row.data) === _this.rowId) {
                    _this.renderCustomStyle(row.data);
                }
                // 此处会导至rowData 与数据源的引用不一致
                // this.rowData = {...row.data};
                // 更新当前数据
                Object.assign(_this.rowData, row.data);
                _this.updateCellEmptyStyle();
                _this.rowUpdated.emit(_this.rowData);
                _this.cd.detectChanges();
            }
        }));
        this.subscriptions.push(s$);
        /** @type {?} */
        var s1$ = this.dg.dgs.updateEmptyStyle$.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.updateCellEmptyStyle();
        }));
        this.subscriptions.push(s1$);
        /** @type {?} */
        var s2$ = this.dg.dfs.selectRow$.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} r
         * @return {?}
         */
        function (r) {
            return r.id === _this.rowId;
        }))).subscribe((/**
         * @return {?}
         */
        function () {
            if (_this.dg.selectedRow && !_this.dg.selectedRow.dr) {
                /** @type {?} */
                var p = _this.getRowPosition();
                if (p === 'left') {
                    _this.dg.selectedRow.drl = _this;
                }
                else if (p === 'right') {
                    _this.dg.selectedRow.drr = _this;
                }
                else {
                    _this.dg.selectedRow.dr = _this;
                }
            }
        }));
        this.subscriptions.push(s2$);
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy$.next();
        this.destroy$.complete();
        if (this.columnsChangedSubscription) {
            this.columnsChangedSubscription.unsubscribe();
            this.columnsChangedSubscription = null;
        }
        if (this.datasourceChangedSubscription) {
            this.datasourceChangedSubscription.unsubscribe();
            this.datasourceChangedSubscription = null;
        }
        if (this.subscriptions && this.subscriptions.length) {
            this.subscriptions.forEach((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.unsubscribe(); }));
            this.subscriptions = [];
        }
        if (this.form) {
            this.form = null;
        }
        this.cells = null;
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridRowDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.updateCellEmptyStyle();
        }
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.renderCustomStyle();
        this.updateCellEmptyStyle();
    };
    /**
     * @private
     * @return {?}
     */
    DatagridRowDirective.prototype.getRowPosition = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var id = this.el.nativeElement.id;
        if (id.indexOf('fixedleft') > -1) {
            return 'left';
        }
        else if (id.indexOf('fixedright') > -1) {
            return 'right';
        }
        else {
            return 'center';
        }
    };
    /**
     * @param {?=} rowData
     * @return {?}
     */
    DatagridRowDirective.prototype.renderCustomStyle = /**
     * @param {?=} rowData
     * @return {?}
     */
    function (rowData) {
        if (rowData === void 0) { rowData = null; }
        if (this.dg.rowStyler) {
            /** @type {?} */
            var _rd = rowData || this.rowData;
            /** @type {?} */
            var trStyle = this.dg.rowStyler(_rd, this.rowIndex);
            /** @type {?} */
            var tr = this.el.nativeElement;
            /** @type {?} */
            var _cls = Array.from(tr.classList).find((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.indexOf(CUSTOM_ROW_CLS) > -1; }));
            if (_cls) {
                tr.classList.remove(_cls);
            }
            if (trStyle && Object.keys(trStyle).length) {
                /** @type {?} */
                var str = CUSTOM_ROW_CLS + this.dg.idService.encrypt(JSON.stringify(trStyle));
                this.dg.renderCustomStyle2(trStyle, this.el.nativeElement, 'f-datagrid-body .' + str);
                this.render.addClass(this.el.nativeElement, str);
            }
        }
    };
    // @HostListener('click', ['$event'])
    // @HostListener('click', ['$event'])
    /**
     * @param {?} event
     * @return {?}
     */
    DatagridRowDirective.prototype.onRowClick = 
    // @HostListener('click', ['$event'])
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /*
                if (event.target['className'] && event.target['className'].indexOf('checkbox-column') > -1) {
                    return;
                }
        
                if (!this.dg.enableSelectRow) {
                    return;
                }
        
                if (this.dg.disabled) {
                    return;
                }
        
                if (this.dg.currentCell && this.dg.currentCell.isEditing && this.rowId !== this.dg.currentCell.rowId ) {
                    return;
                }
        
        
                if (this.dg.disableRow) {
                    if (this.dg.disableRow(this.rowData, this.rowIndex)) {
                        event.stopPropagation();
                        return false;
                    }
                }
        
                // if (!this.dg.editable) {
                //     event.stopPropagation();
                // }
        
                const rowId = this.dfs.primaryId(this.rowData);
        
                if (!rowId) {
                    this.dg.writeConsole(`在第 ${this.rowIndex + 1} 行，主键字段[${this.dg.idField}]的值为 空，请检查相关数据。`);
                }
        
                const beforEventParam = {
                    rowIndex: this.rowIndex,
                    rowData: this.rowData,
                    gridInstance: this.dg
                };
        
                if (!event.shiftKey) {
                    this.dg.dgs.focusRowChanged.emit({
                        rowIndex: this.rowIndex,
                        rowData: this.rowData
                    });
                }
                const useNewSelectionMode = this.dg.sms.beforRowClick({ ...beforEventParam, e: event, id: rowId, dr: this });
                if (useNewSelectionMode) {
                    return;
                }
        
                if (!this.dfs.isRowSelected(rowId)) {
                    const canendedit = this.dg.endRowEdit();
        
                    if (!canendedit || canendedit.canEnd) {
                        this.dg.beforeSelect(beforEventParam).pipe( takeUntil(this.destroy$)).pipe(
                            delay(200)
                        ).subscribe((canSelect: boolean) => {
                            if (canSelect) {
                                this.dg.removeCellSelectedCls();
                                this.dfs.selectRow(this.rowIndex, this.rowData, {instance: this.dg});
                                if (this.dg.selectedRow) {
                                    this.dg.selectedRow.dr = this;
                                }
                                const trCLS = this.el.nativeElement.className;
                                if (trCLS.indexOf('f-datagrid-row-selected') === -1) {
                                    this.el.nativeElement.className = trCLS + ' f-datagrid-row-selected';
                                }
                                // this.drHover.setRowHoverCls(false);
                                // this.dg.selectChanged.emit(this.dg.selectedRow);
                                this.clickHandler.emit();
                            }
                            this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                            this.dg.dgs.setSelecedRow.emit({ selected: true, id: this.dfs.primaryId(this.rowData) });
                        });
                    }
                } else {
                    if (this.dg.selectedRow && !this.dg.selectedRow.dr) {
                        this.dg.selectedRow.dr = this;
                    }
        
                    if (!this.dg.keepSelect) {
                        this.dg.beforeUnselect(beforEventParam).pipe(
                            takeUntil(this.destroy$),
                        ).subscribe((canUnselect: boolean) => {
                            if (canUnselect) {
                                // this.dg.unSelect.emit(this.dg.selectedRow);
                                this.dfs.unSelectRow(this.rowIndex, this.rowData, {instance: this.dg});
        
                                const trCLS = this.el.nativeElement.className;
                                if (trCLS.indexOf('f-datagrid-row-selected') > -1) {
                                    this.el.nativeElement.className = trCLS.replace('f-datagrid-row-selected', '');
                                }
                            }
                            this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                            this.dg.dgs.setSelecedRow.emit();
                        });
                    } else {
                        this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                    }
                }
                    */
        // this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.initFormControl = /**
     * @return {?}
     */
    function () {
        this.form = this.fb.group({});
        this.createControl();
        this.form['bindingData'] = this.rowData;
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.createControl = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.dg && this.dg.flatColumns) {
            this.dg.flatColumns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            function (col) {
                if (!col.editor && !col.editorTemplate) {
                    return;
                }
                if (!_this.form.controls[col.field]) {
                    /** @type {?} */
                    var control = _this.createFormControl(col);
                    _this.form.addControl(col.field, control);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} col
     * @return {?}
     */
    DatagridRowDirective.prototype.createFormControl = /**
     * @private
     * @param {?} col
     * @return {?}
     */
    function (col) {
        return this.fb.control(Utils.getValue(col.field, this.rowData), {
            validators: col.editor ? this.bindValidations(col.editor.validators) : null
        });
    };
    /**
     * @private
     * @param {?} validators
     * @return {?}
     */
    DatagridRowDirective.prototype.bindValidations = /**
     * @private
     * @param {?} validators
     * @return {?}
     */
    function (validators) {
        var _this = this;
        /** @type {?} */
        var validations = [];
        if (validators && validators.length) {
            validators.forEach((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                /** @type {?} */
                var validation = null;
                switch (v.type) {
                    case 'required':
                        validation = Validators.required;
                        break;
                    case 'min':
                        validation = Validators.min(v.value);
                        break;
                    case 'max':
                        validation = Validators.max(v.value);
                        break;
                    case 'minLength':
                        validation = Validators.minLength(v.value);
                        break;
                    case 'maxLength':
                        validation = Validators.maxLength(v.value);
                        break;
                    case 'email':
                        validation = Validators.email;
                        break;
                    case 'requiredTrue':
                        validation = Validators.requiredTrue;
                        break;
                    case 'pattern':
                        validation = Validators.pattern(v.value);
                        break;
                }
                if (validation) {
                    validations.push(validation);
                }
                else {
                    if (_this.dg.validators && _this.dg.validators.length) {
                        /** @type {?} */
                        var vfn = _this.dg.validators.find((/**
                         * @param {?} vr
                         * @return {?}
                         */
                        function (vr) { return vr.name === v.type; }));
                        if (vfn) {
                            validation = vfn.value(_this.rowData);
                            validations.push(validation);
                        }
                    }
                }
            }));
        }
        return validations;
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.refresh = /**
     * @return {?}
     */
    function () {
        this.updateRowHeight();
        this.updateCellEmptyStyle();
    };
    /**
     * @return {?}
     */
    DatagridRowDirective.prototype.updateRowHeight = /**
     * @return {?}
     */
    function () {
        if (!this.dg.nowrap) {
            /** @type {?} */
            var centerTr = this.dgb.mainArea.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
            centerTr.style.height = 'auto';
            /** @type {?} */
            var trHeight = centerTr.offsetHeight;
            /** @type {?} */
            var leftTrDom = null;
            /** @type {?} */
            var rightTrDom = null;
            /** @type {?} */
            var heightSizeList = [trHeight];
            if (this.dgb) {
                if (this.dgb.fixedLeftEl) {
                    leftTrDom = this.dgb.fixedLeftEl.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
                    if (leftTrDom) {
                        leftTrDom.style.height = 'auto';
                        heightSizeList.push(leftTrDom.offsetHeight);
                    }
                }
                if (this.dgb.fixedRightEl) {
                    rightTrDom = this.dgb.fixedRightEl.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
                    if (rightTrDom) {
                        rightTrDom.style.height = 'auto';
                        heightSizeList.push(rightTrDom.offsetHeight);
                    }
                }
                /** @type {?} */
                var maxHeight = Math.max.apply(Math, tslib_1.__spread(heightSizeList));
                centerTr.style.height = maxHeight + "px";
                if (leftTrDom) {
                    leftTrDom.style.height = maxHeight + "px";
                }
                if (rightTrDom) {
                    rightTrDom.style.height = maxHeight + "px";
                }
                this.cd.markForCheck();
                this.dgb.updateCanvasHeight();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridRowDirective.prototype.updateCellEmptyStyle = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        var rowIsDisabled = false;
        if (this.dg.disableRow) {
            rowIsDisabled = this.dg.disableRow(this.rowData, this.rowIndex);
        }
        /** @type {?} */
        var updateCellEmptyText = (/**
         * @param {?} cells
         * @return {?}
         */
        function (cells) {
            if (cells.length) {
                for (var k = 0; k < cells.length; k++) {
                    /** @type {?} */
                    var field = cells[k].getAttribute('field');
                    if (field) {
                        /** @type {?} */
                        var col = _this.dfs.getColumn(field);
                        if (col) {
                            if (!col.editor) {
                                continue;
                            }
                            /** @type {?} */
                            var cls = col.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
                            /** @type {?} */
                            var emptyicon_cls = ALLOW_EDIT_CELL_HIGHLIGHT_CLS[col.editor.type];
                            /** @type {?} */
                            var span = cells[k].querySelector('.cell-text-box');
                            /** @type {?} */
                            var colVal = Utils.getValue(field, _this.rowData);
                            /** @type {?} */
                            var fmtVal = _this.dg.colFormatSer.format(colVal, _this.rowData, col.formatter);
                            if (!_this.dg.editable || rowIsDisabled || _this.dg.cellIsReadOnly(col, _this.rowData)) {
                                cells[k].className = cells[k].className.replace(cls, '');
                                cells[k].className = cells[k].className.replace(emptyicon_cls, '');
                                if (span) {
                                    if (span.className.indexOf('cell-empty') > -1) {
                                        span.className = span.className.replace('cell-empty', '');
                                    }
                                    if (colVal === '' || colVal === null || colVal === undefined) {
                                        span.innerHTML = '';
                                    }
                                    else {
                                        span.innerHTML = fmtVal;
                                    }
                                }
                            }
                            else {
                                if (span) {
                                    if (colVal === '' || colVal === null || colVal === undefined) {
                                        if (span.className.indexOf('cell-empty') === -1) {
                                            span.className = span.className + ' cell-empty';
                                        }
                                        span.innerHTML = Utils.getWhenEmptyText(col, _this.dg.localeService.localeId);
                                    }
                                    else {
                                        span.innerHTML = fmtVal;
                                    }
                                }
                                if (cells[k].className.indexOf('cell-readonly') > -1) {
                                    cells[k].className = cells[k].className.replace('cell-readonly', '');
                                }
                                if (cells[k].className.indexOf(cls) === -1) {
                                    _this.render.addClass(cells[k], cls);
                                }
                                if (cells[k].className.indexOf(emptyicon_cls) === -1) {
                                    _this.render.addClass(cells[k], emptyicon_cls);
                                }
                            }
                        }
                    }
                }
            }
        });
        // if (this.dgb.fixedLeftEl) {
        //     const leftTrDom = this.dgb.fixedLeftEl.nativeElement.querySelector('tr[index="' + this.rowIndex + '"]');
        //     if (leftTrDom) {
        //         updateCellEmptyText(leftTrDom.querySelectorAll('td[field]'));
        //     }
        // }
        /** @type {?} */
        var cells = this.el.nativeElement.querySelectorAll('td[field]:not([field="_datagrid-setting-control_"])');
        updateCellEmptyText(cells);
    };
    DatagridRowDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[grid-row]',
                    exportAs: 'gridRow'
                },] }
    ];
    /** @nocollapse */
    DatagridRowDirective.ctorParameters = function () { return [
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] },
        { type: Injector },
        { type: FormBuilder },
        { type: ElementRef },
        { type: Renderer2 },
        { type: DatagridRowHoverDirective, decorators: [{ type: Optional }, { type: Self }] }
    ]; };
    DatagridRowDirective.propDecorators = {
        editable: [{ type: Input }],
        rowData: [{ type: Input, args: ['grid-row',] }],
        rowIndex: [{ type: Input }],
        clickHandler: [{ type: Output }],
        rowUpdated: [{ type: Output }],
        cells: [{ type: ContentChildren, args: [forwardRef((/**
                     * @return {?}
                     */
                    function () { return DatagridCellComponent; })), { descendants: true },] }]
    };
    return DatagridRowDirective;
}());
export { DatagridRowDirective };
if (false) {
    /** @type {?} */
    DatagridRowDirective.prototype.editable;
    /** @type {?} */
    DatagridRowDirective.prototype.rowData;
    /** @type {?} */
    DatagridRowDirective.prototype.rowIndex;
    /** @type {?} */
    DatagridRowDirective.prototype.clickHandler;
    /** @type {?} */
    DatagridRowDirective.prototype.rowUpdated;
    /** @type {?} */
    DatagridRowDirective.prototype.cells;
    /** @type {?} */
    DatagridRowDirective.prototype.form;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.documentRowDblclickEvent;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.dgb;
    /** @type {?} */
    DatagridRowDirective.prototype.cd;
    /** @type {?} */
    DatagridRowDirective.prototype.columnsChangedSubscription;
    /** @type {?} */
    DatagridRowDirective.prototype.datasourceChangedSubscription;
    /** @type {?} */
    DatagridRowDirective.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.destroy$;
    /** @type {?} */
    DatagridRowDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.fb;
    /** @type {?} */
    DatagridRowDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridRowDirective.prototype.render;
    /** @type {?} */
    DatagridRowDirective.prototype.drHover;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtcm93LmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9ib2R5L2RhdGFncmlkLXJvdy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQVMsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7QUFVMUQsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUE0QixpQkFBaUIsRUFBYSxRQUFRLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxlQUFlLENBQUM7QUFDcEssT0FBTyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEUsT0FBTyxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUNILFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFDOUIsVUFBVSxFQUFpQixRQUFRLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFDbEUsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFHbEUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDM0UsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRWxFLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxjQUFjLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUdyRjtJQXdDSSw4QkFDd0QsRUFBcUIsRUFDakUsUUFBa0IsRUFBVSxFQUFlLEVBQVMsRUFBYyxFQUNsRSxNQUFpQixFQUE2QixPQUFrQztRQUZwQyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNqRSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQUFTLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDbEUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUE2QixZQUFPLEdBQVAsT0FBTyxDQUEyQjtRQXRDbkYsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUdoQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDbEMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFvQjFDLFNBQUksR0FBYyxJQUFJLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1Qiw2QkFBd0IsR0FBUSxJQUFJLENBQUM7UUFLN0MsK0JBQTBCLEdBQWlCLElBQUksQ0FBQztRQUNoRCxrQ0FBNkIsR0FBaUIsSUFBSSxDQUFDO1FBQ25ELGtCQUFhLEdBQW1CLEVBQUUsQ0FBQztRQUMzQixhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUs3QixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFsQ0Qsc0JBQUksdUNBQUs7Ozs7UUFBVDtZQUNJLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDZCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUMzQztZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksMENBQVE7Ozs7UUFBWjtZQUNJLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BCLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDMUQ7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDOzs7T0FBQTs7OztJQXdCRCx1Q0FBUTs7O0lBQVI7UUFBQSxpQkErREM7UUE5REcsSUFBSSxDQUFDLDZCQUE2QixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FDcEUsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FDM0IsQ0FBQyxTQUFTOzs7UUFBQztZQUNSLEtBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQzdCLENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQzdELFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQzNCLENBQUMsU0FBUzs7O1FBQUM7WUFDUixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDekIsQ0FBQyxFQUFDLENBQUM7O1lBRUcsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQ2xDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQ3hCLE1BQU07Ozs7UUFBQyxVQUFDLEdBQVE7WUFDWixPQUFPLEdBQUcsQ0FBQyxLQUFLLEtBQUssS0FBSSxDQUFDLEtBQUssQ0FBQztRQUNwQyxDQUFDLEVBQUMsQ0FDTCxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFDLEdBQWlDO1lBQzFDLElBQUksR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLHNDQUFzQztnQkFDdEMsSUFBSSxLQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSSxDQUFDLEtBQUssRUFBRTtvQkFDN0MsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDcEM7Z0JBRUQsMEJBQTBCO2dCQUMxQixnQ0FBZ0M7Z0JBRWhDLFNBQVM7Z0JBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFdEMsS0FBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7Z0JBQzVCLEtBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDbkMsS0FBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQzthQUMzQjtRQUNMLENBQUMsRUFBQztRQUNGLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDOztZQUV0QixHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUMxQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUMzQixDQUFDLFNBQVM7OztRQUFDO1lBQ1IsS0FBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDaEMsQ0FBQyxFQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7O1lBRXZCLEdBQUcsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQ2xFLE1BQU07Ozs7UUFBQyxVQUFDLENBQU07WUFDVixPQUFPLENBQUMsQ0FBQyxFQUFFLEtBQUssS0FBSSxDQUFDLEtBQUssQ0FBQztRQUMvQixDQUFDLEVBQUMsQ0FDTCxDQUFDLFNBQVM7OztRQUFDO1lBQ1IsSUFBSSxLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsSUFBSSxDQUFDLEtBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBRTs7b0JBQzFDLENBQUMsR0FBRyxLQUFJLENBQUMsY0FBYyxFQUFFO2dCQUMvQixJQUFJLENBQUMsS0FBSyxNQUFNLEVBQUU7b0JBQ2QsS0FBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxHQUFHLEtBQUksQ0FBQztpQkFDbEM7cUJBQU0sSUFBSSxDQUFDLEtBQUssT0FBTyxFQUFFO29CQUN0QixLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEdBQUcsS0FBSSxDQUFDO2lCQUNsQztxQkFBTTtvQkFDSCxLQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEdBQUcsS0FBSSxDQUFDO2lCQUNqQzthQUNKO1FBQ0wsQ0FBQyxFQUFDO1FBRUYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQzs7OztJQUVELDBDQUFXOzs7SUFBWDtRQUNJLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN6QixJQUFJLElBQUksQ0FBQywwQkFBMEIsRUFBRTtZQUNqQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDOUMsSUFBSSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQztTQUMxQztRQUVELElBQUksSUFBSSxDQUFDLDZCQUE2QixFQUFFO1lBQ3BDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNqRCxJQUFJLENBQUMsNkJBQTZCLEdBQUcsSUFBSSxDQUFDO1NBQzdDO1FBRUQsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFO1lBQ2pELElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTzs7OztZQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFmLENBQWUsRUFBQyxDQUFDO1lBQ2pELElBQUksQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDO1NBQzNCO1FBRUQsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1gsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7U0FDcEI7UUFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztJQUN0QixDQUFDOzs7OztJQUVELDBDQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtRQUM5QixJQUFJLE9BQU8sQ0FBQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ3JELElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1NBQy9CO0lBQ0wsQ0FBQzs7OztJQUVELDhDQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO0lBQ2hDLENBQUM7Ozs7O0lBRU8sNkNBQWM7Ozs7SUFBdEI7O1lBQ1UsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUU7UUFDbkMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQzlCLE9BQU8sTUFBTSxDQUFDO1NBQ2pCO2FBQU0sSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ3RDLE9BQU8sT0FBTyxDQUFDO1NBQ2xCO2FBQU07WUFDSCxPQUFPLFFBQVEsQ0FBQztTQUNuQjtJQUNMLENBQUM7Ozs7O0lBR0QsZ0RBQWlCOzs7O0lBQWpCLFVBQWtCLE9BQWM7UUFBZCx3QkFBQSxFQUFBLGNBQWM7UUFDNUIsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRTs7Z0JBQ2IsR0FBRyxHQUFHLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTzs7Z0JBQzdCLE9BQU8sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQzs7Z0JBQy9DLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWE7O2dCQUUxQixJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSTs7OztZQUFDLFVBQUMsQ0FBUyxJQUFLLE9BQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBOUIsQ0FBOEIsRUFBQztZQUN6RixJQUFJLElBQUksRUFBRTtnQkFDTixFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM3QjtZQUVELElBQUksT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFOztvQkFDbEMsR0FBRyxHQUFHLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDL0UsSUFBSSxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsbUJBQW1CLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ3RGLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQ3BEO1NBQ0o7SUFDTCxDQUFDO0lBRUQscUNBQXFDOzs7Ozs7SUFDckMseUNBQVU7Ozs7OztJQUFWLFVBQVcsS0FBaUI7UUFDaEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztzQkFzR2M7UUFDTixpRkFBaUY7SUFDckYsQ0FBQzs7OztJQUVELDhDQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUM1QyxDQUFDOzs7O0lBRUQsNENBQWE7OztJQUFiO1FBQUEsaUJBVUM7UUFURyxJQUFJLElBQUksQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDaEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsT0FBTzs7OztZQUFDLFVBQUEsR0FBRztnQkFDM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFO29CQUFFLE9BQU87aUJBQUU7Z0JBQ25ELElBQUksQ0FBQyxLQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7O3dCQUMxQixPQUFPLEdBQUcsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQztvQkFDM0MsS0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztpQkFDNUM7WUFDTCxDQUFDLEVBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQzs7Ozs7O0lBRU8sZ0RBQWlCOzs7OztJQUF6QixVQUEwQixHQUFHO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQ2xCLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQ3ZDO1lBQ0ksVUFBVSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSTtTQUM5RSxDQUNKLENBQUM7SUFDTixDQUFDOzs7Ozs7SUFFTyw4Q0FBZTs7Ozs7SUFBdkIsVUFBd0IsVUFBK0I7UUFBdkQsaUJBOENDOztZQTdDUyxXQUFXLEdBQUcsRUFBRTtRQUN0QixJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsTUFBTSxFQUFFO1lBRWpDLFVBQVUsQ0FBQyxPQUFPOzs7O1lBQUMsVUFBQyxDQUFvQjs7b0JBQ2hDLFVBQVUsR0FBRyxJQUFJO2dCQUNyQixRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUU7b0JBQ1osS0FBSyxVQUFVO3dCQUNYLFVBQVUsR0FBRyxVQUFVLENBQUMsUUFBUSxDQUFDO3dCQUNqQyxNQUFNO29CQUNWLEtBQUssS0FBSzt3QkFDTixVQUFVLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQ3JDLE1BQU07b0JBQ1YsS0FBSyxLQUFLO3dCQUNOLFVBQVUsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQzt3QkFDckMsTUFBTTtvQkFDVixLQUFLLFdBQVc7d0JBQ1osVUFBVSxHQUFHLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUMzQyxNQUFNO29CQUNWLEtBQUssV0FBVzt3QkFDWixVQUFVLEdBQUcsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQzNDLE1BQU07b0JBQ1YsS0FBSyxPQUFPO3dCQUNSLFVBQVUsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDO3dCQUM5QixNQUFNO29CQUNWLEtBQUssY0FBYzt3QkFDZixVQUFVLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQzt3QkFDckMsTUFBTTtvQkFDVixLQUFLLFNBQVM7d0JBQ1YsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUN6QyxNQUFNO2lCQUNiO2dCQUNELElBQUksVUFBVSxFQUFFO29CQUNaLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQ2hDO3FCQUFNO29CQUNILElBQUksS0FBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLElBQUksS0FBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFOzs0QkFDM0MsR0FBRyxHQUFHLEtBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUk7Ozs7d0JBQUMsVUFBQSxFQUFFLElBQUksT0FBQSxFQUFFLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxJQUFJLEVBQWxCLENBQWtCLEVBQUM7d0JBQzdELElBQUksR0FBRyxFQUFFOzRCQUNMLFVBQVUsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs0QkFDckMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQzt5QkFDaEM7cUJBQ0o7aUJBQ0o7WUFDTCxDQUFDLEVBQUMsQ0FBQztTQUNOO1FBQ0QsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQzs7OztJQUdELHNDQUFPOzs7SUFBUDtRQUNJLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztJQUNoQyxDQUFDOzs7O0lBRUQsOENBQWU7OztJQUFmO1FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFOztnQkFDWCxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7WUFDbkcsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDOztnQkFDekIsUUFBUSxHQUFHLFFBQVEsQ0FBQyxZQUFZOztnQkFDbEMsU0FBUyxHQUFHLElBQUk7O2dCQUNoQixVQUFVLEdBQUcsSUFBSTs7Z0JBQ2YsY0FBYyxHQUFHLENBQUMsUUFBUSxDQUFDO1lBQ2pDLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDVixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFO29CQUN0QixTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsQ0FBQztvQkFDbEcsSUFBSSxTQUFTLEVBQUU7d0JBQ1gsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO3dCQUNoQyxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztxQkFDL0M7aUJBQ0o7Z0JBQ0QsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRTtvQkFDdkIsVUFBVSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUM7b0JBQ3BHLElBQUksVUFBVSxFQUFFO3dCQUNaLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQzt3QkFDakMsY0FBYyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7cUJBQ2hEO2lCQUNKOztvQkFFSyxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsT0FBUixJQUFJLG1CQUFRLGNBQWMsRUFBQztnQkFFN0MsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQU0sU0FBUyxPQUFJLENBQUM7Z0JBQ3pDLElBQUksU0FBUyxFQUFFO29CQUNYLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFNLFNBQVMsT0FBSSxDQUFDO2lCQUM3QztnQkFFRCxJQUFJLFVBQVUsRUFBRTtvQkFDWixVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBTSxTQUFTLE9BQUksQ0FBQztpQkFDOUM7Z0JBRUQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2FBQ2pDO1NBQ0o7SUFDTCxDQUFDOzs7OztJQUVPLG1EQUFvQjs7OztJQUE1QjtRQUFBLGlCQW1GQztRQWpGRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRTtZQUM5QixPQUFPO1NBQ1Y7O1lBRUcsYUFBYSxHQUFHLEtBQUs7UUFDekIsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRTtZQUNwQixhQUFhLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDbkU7O1lBRUssbUJBQW1COzs7O1FBQUcsVUFBQyxLQUFLO1lBQzlCLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRTtnQkFFZCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7d0JBQzdCLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQztvQkFDNUMsSUFBSSxLQUFLLEVBQUU7OzRCQUNELEdBQUcsR0FBRyxLQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7d0JBQ3JDLElBQUksR0FBRyxFQUFFOzRCQUVMLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFO2dDQUNiLFNBQVM7NkJBQ1o7O2dDQUNLLEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQjs7Z0NBQ3hFLGFBQWEsR0FBRyw2QkFBNkIsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQzs7Z0NBQzlELElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDOztnQ0FDL0MsTUFBTSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEtBQUksQ0FBQyxPQUFPLENBQUM7O2dDQUM1QyxNQUFNLEdBQUcsS0FBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxLQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxTQUFTLENBQUM7NEJBQy9FLElBQUksQ0FBQyxLQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxhQUFhLElBQUksS0FBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxPQUFPLENBQUMsRUFBRTtnQ0FDakYsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0NBQ3pELEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dDQUNuRSxJQUFJLElBQUksRUFBRTtvQ0FDTixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO3dDQUMzQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztxQ0FDN0Q7b0NBRUQsSUFBSSxNQUFNLEtBQUssRUFBRSxJQUFJLE1BQU0sS0FBSyxJQUFJLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTt3Q0FDMUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7cUNBQ3ZCO3lDQUFNO3dDQUNILElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO3FDQUMzQjtpQ0FDSjs2QkFDSjtpQ0FBTTtnQ0FDSCxJQUFJLElBQUksRUFBRTtvQ0FDTixJQUFJLE1BQU0sS0FBSyxFQUFFLElBQUksTUFBTSxLQUFLLElBQUksSUFBSSxNQUFNLEtBQUssU0FBUyxFQUFFO3dDQUMxRCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFOzRDQUM3QyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDO3lDQUNuRDt3Q0FFRCxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsS0FBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7cUNBQ2hGO3lDQUFNO3dDQUNILElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO3FDQUMzQjtpQ0FDSjtnQ0FFRCxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO29DQUNsRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxFQUFFLENBQUMsQ0FBQztpQ0FDeEU7Z0NBRUQsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtvQ0FDeEMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2lDQUN2QztnQ0FFRCxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO29DQUNsRCxLQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLENBQUM7aUNBQ2pEOzZCQUNKO3lCQUNKO3FCQUNKO2lCQUNKO2FBQ0o7UUFDTCxDQUFDLENBQUE7Ozs7Ozs7O1lBVUssS0FBSyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLHFEQUFxRCxDQUFDO1FBQzNHLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQy9CLENBQUM7O2dCQS9lSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLFlBQVk7b0JBQ3RCLFFBQVEsRUFBRSxTQUFTO2lCQUN0Qjs7OztnQkFkUSxpQkFBaUIsdUJBb0RqQixNQUFNLFNBQUMsVUFBVTs7O3dCQUFDLGNBQU0sT0FBQSxpQkFBaUIsRUFBakIsQ0FBaUIsRUFBQztnQkF2RFosUUFBUTtnQkFKMUIsV0FBVztnQkFJcEIsVUFBVTtnQkFMYixTQUFTO2dCQVlULHlCQUF5Qix1QkFrREUsUUFBUSxZQUFJLElBQUk7OzsyQkF0Qy9DLEtBQUs7MEJBQ0wsS0FBSyxTQUFDLFVBQVU7MkJBQ2hCLEtBQUs7K0JBQ0wsTUFBTTs2QkFDTixNQUFNO3dCQUVOLGVBQWUsU0FBQyxVQUFVOzs7b0JBQUMsY0FBTSxPQUFBLHFCQUFxQixFQUFyQixDQUFxQixFQUFDLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFOztJQXFlbkYsMkJBQUM7Q0FBQSxBQWhmRCxJQWdmQztTQTVlWSxvQkFBb0I7OztJQUM3Qix3Q0FBMEI7O0lBQzFCLHVDQUFnQzs7SUFDaEMsd0NBQTBCOztJQUMxQiw0Q0FBNEM7O0lBQzVDLDBDQUEwQzs7SUFFMUMscUNBQXlIOztJQWtCekgsb0NBQW9DOzs7OztJQUNwQyxtQ0FBbUM7Ozs7O0lBQ25DLHdEQUE2Qzs7Ozs7SUFDN0Msc0NBQXVCOzs7OztJQUN2QixtQ0FBbUM7O0lBQ25DLGtDQUFzQjs7SUFFdEIsMERBQWdEOztJQUNoRCw2REFBbUQ7O0lBQ25ELDZDQUFtQzs7Ozs7SUFDbkMsd0NBQWlDOztJQUU3QixrQ0FBeUU7Ozs7O0lBQ3pFLHdDQUEwQjs7Ozs7SUFBRSxrQ0FBdUI7O0lBQUUsa0NBQXFCOzs7OztJQUMxRSxzQ0FBeUI7O0lBQUUsdUNBQTZEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVsYXksIGZpbHRlciwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuLypcclxuKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiogQERhdGU6IDIwMTktMDgtMTIgMDc6NDc6MTJcclxuKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuKiBATGFzdEVkaXRUaW1lOiAyMDE5LTExLTI3IDEzOjMxOjQzXHJcbiogQFFROiAxMDU1ODE4MjM5XHJcbiogQFZlcnNpb246IHYwLjAuMVxyXG4qL1xyXG5pbXBvcnQgeyBSZW5kZXJlcjIsIFNlbGYsIE5nWm9uZSwgU2ltcGxlQ2hhbmdlcywgT25DaGFuZ2VzLCBDaGFuZ2VEZXRlY3RvclJlZiwgT25EZXN0cm95LCBPcHRpb25hbCwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIFZpZXdDaGlsZHJlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3JzLCBGb3JtQnVpbGRlciwgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtcclxuICAgIERpcmVjdGl2ZSwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsXHJcbiAgICBPbkluaXQsIEVsZW1lbnRSZWYsIEFmdGVyVmlld0luaXQsIEluamVjdG9yLCBJbmplY3QsIGZvcndhcmRSZWZcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRGYWNhZGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmFjYWRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ2VsbENvbXBvbmVudCB9IGZyb20gJy4vZGF0YWdyaWQtY2VsbC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFJvdyB9IGZyb20gJy4uLy4uL3R5cGVzL2RhdGFncmlkLXJvdyc7XHJcbmltcG9ydCB7IERhdGFncmlkVmFsaWRhdG9yIH0gZnJvbSAnLi4vLi4vdHlwZXMvZGF0YWdyaWQtdmFsaWRhdG9yJztcclxuaW1wb3J0IHsgRGF0YWdyaWRSb3dIb3ZlckRpcmVjdGl2ZSB9IGZyb20gJy4vZGF0YWdyaWQtcm93LWhvdmVyLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEJvZHlDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLWJvZHkuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRm9ybWF0Q2VsbERhdGFQaXBlIH0gZnJvbSAnLi4vLi4vdXRpbHMvZm9ybWF0LWNlbGwtZGF0YS5waXBlJztcclxuaW1wb3J0IHsgQUxMT1dfRURJVF9DRUxMX0hJR0hMSUdIVF9DTFMsIENVU1RPTV9ST1dfQ0xTIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbZ3JpZC1yb3ddJyxcclxuICAgIGV4cG9ydEFzOiAnZ3JpZFJvdydcclxufSlcclxuZXhwb3J0IGNsYXNzIERhdGFncmlkUm93RGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBEYXRhZ3JpZFJvdywgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG4gICAgQElucHV0KCkgZWRpdGFibGUgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgnZ3JpZC1yb3cnKSByb3dEYXRhOiBhbnk7XHJcbiAgICBASW5wdXQoKSByb3dJbmRleDogbnVtYmVyO1xyXG4gICAgQE91dHB1dCgpIGNsaWNrSGFuZGxlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIEBPdXRwdXQoKSByb3dVcGRhdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8g55So5LqO5pW06KGM57yW6L6R77yM5Yu/5Yqo77yB77yB77yBXHJcbiAgICBAQ29udGVudENoaWxkcmVuKGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRDZWxsQ29tcG9uZW50KSwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KSBjZWxsczogUXVlcnlMaXN0PERhdGFncmlkQ2VsbENvbXBvbmVudD47XHJcblxyXG5cclxuICAgIGdldCByb3dJZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5yb3dEYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRmcy5wcmltYXJ5SWQodGhpcy5yb3dEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGRpc2FibGVkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGcuZGlzYWJsZVJvdyh0aGlzLnJvd0RhdGEsIHRoaXMucm93SW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZvcm06IEZvcm1Hcm91cCA9IG5ldyBGb3JtR3JvdXAoe30pO1xyXG4gICAgcHJpdmF0ZSBkZnM6IERhdGFncmlkRmFjYWRlU2VydmljZTtcclxuICAgIHByaXZhdGUgZG9jdW1lbnRSb3dEYmxjbGlja0V2ZW50OiBhbnkgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZTtcclxuICAgIHByaXZhdGUgZGdiOiBEYXRhZ3JpZEJvZHlDb21wb25lbnQ7XHJcbiAgICBjZDogQ2hhbmdlRGV0ZWN0b3JSZWY7XHJcblxyXG4gICAgY29sdW1uc0NoYW5nZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICBkYXRhc291cmNlQ2hhbmdlZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XHJcbiAgICBwcml2YXRlIGRlc3Ryb3kkID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBEYXRhZ3JpZENvbXBvbmVudCkpIHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLCBwdWJsaWMgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgQE9wdGlvbmFsKCkgQFNlbGYoKSBwdWJsaWMgZHJIb3ZlcjogRGF0YWdyaWRSb3dIb3ZlckRpcmVjdGl2ZSkge1xyXG4gICAgICAgIHRoaXMuZGZzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRGYWNhZGVTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLm5nWm9uZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE5nWm9uZSk7XHJcbiAgICAgICAgdGhpcy5jZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKTtcclxuICAgICAgICB0aGlzLmRnYiA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkQm9keUNvbXBvbmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhc291cmNlQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IHRoaXMuZGcuZGdzLm9uRGF0YVNvdXJjZUNoYW5nZS5waXBlKFxyXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQ3VzdG9tU3R5bGUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5jb2x1bW5zQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IHRoaXMuZGcuZGdzLmNvbHVtbnNDaGFuZ2VkLnBpcGUoXHJcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVDb250cm9sKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHMkID0gdGhpcy5kZy5kZnMucm93VXBkYXRlJC5waXBlKFxyXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JCksXHJcbiAgICAgICAgICAgIGZpbHRlcigocm93OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByb3cua2V5SUQgPT09IHRoaXMucm93SWQ7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKHJvdzogeyBpbmRleDogbnVtYmVyLCBkYXRhOiBhbnkgfSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocm93ICYmIHJvdy5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnJvd0RhdGEgPSBjbG9uZURlZXAocm93LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGZzLnByaW1hcnlJZChyb3cuZGF0YSkgPT09IHRoaXMucm93SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckN1c3RvbVN0eWxlKHJvdy5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyDmraTlpITkvJrlr7zoh7Nyb3dEYXRhIOS4juaVsOaNrua6kOeahOW8leeUqOS4jeS4gOiHtFxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5yb3dEYXRhID0gey4uLnJvdy5kYXRhfTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw5b2T5YmN5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMucm93RGF0YSwgcm93LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNlbGxFbXB0eVN0eWxlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvd1VwZGF0ZWQuZW1pdCh0aGlzLnJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzJCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHMxJCA9IHRoaXMuZGcuZGdzLnVwZGF0ZUVtcHR5U3R5bGUkLnBpcGUoXHJcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVDZWxsRW1wdHlTdHlsZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMxJCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHMyJCA9IHRoaXMuZGcuZGZzLnNlbGVjdFJvdyQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnBpcGUoXHJcbiAgICAgICAgICAgIGZpbHRlcigocjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci5pZCA9PT0gdGhpcy5yb3dJZDtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ICYmICF0aGlzLmRnLnNlbGVjdGVkUm93LmRyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5nZXRSb3dQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHAgPT09ICdsZWZ0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHJsID0gdGhpcztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocCA9PT0gJ3JpZ2h0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHJyID0gdGhpcztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5kciA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goczIkKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uc0NoYW5nZWRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jb2x1bW5zQ2hhbmdlZFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbnNDaGFuZ2VkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRhdGFzb3VyY2VDaGFuZ2VkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YXNvdXJjZUNoYW5nZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhc291cmNlQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25zICYmIHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2gobiA9PiBuLnVuc3Vic2NyaWJlKCkpO1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZvcm0pIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2VsbHMgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5yb3dEYXRhICYmICFjaGFuZ2VzLnJvd0RhdGEuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ2VsbEVtcHR5U3R5bGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyQ3VzdG9tU3R5bGUoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUNlbGxFbXB0eVN0eWxlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSb3dQb3NpdGlvbigpIHtcclxuICAgICAgICBjb25zdCBpZCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5pZDtcclxuICAgICAgICBpZiAoaWQuaW5kZXhPZignZml4ZWRsZWZ0JykgPiAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2xlZnQnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaWQuaW5kZXhPZignZml4ZWRyaWdodCcpID4gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdyaWdodCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICdjZW50ZXInO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcmVuZGVyQ3VzdG9tU3R5bGUocm93RGF0YSA9IG51bGwpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5yb3dTdHlsZXIpIHtcclxuICAgICAgICAgICAgY29uc3QgX3JkID0gcm93RGF0YSB8fCB0aGlzLnJvd0RhdGE7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyU3R5bGUgPSB0aGlzLmRnLnJvd1N0eWxlcihfcmQsIHRoaXMucm93SW5kZXgpO1xyXG4gICAgICAgICAgICBjb25zdCB0ciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IF9jbHMgPSBBcnJheS5mcm9tKHRyLmNsYXNzTGlzdCkuZmluZCgobjogc3RyaW5nKSA9PiBuLmluZGV4T2YoQ1VTVE9NX1JPV19DTFMpID4gLTEpO1xyXG4gICAgICAgICAgICBpZiAoX2Nscykge1xyXG4gICAgICAgICAgICAgICAgdHIuY2xhc3NMaXN0LnJlbW92ZShfY2xzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRyU3R5bGUgJiYgT2JqZWN0LmtleXModHJTdHlsZSkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSBDVVNUT01fUk9XX0NMUyArIHRoaXMuZGcuaWRTZXJ2aWNlLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkodHJTdHlsZSkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5yZW5kZXJDdXN0b21TdHlsZTIodHJTdHlsZSwgdGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC1ib2R5IC4nICsgc3RyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgc3RyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXHJcbiAgICBvblJvd0NsaWNrKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbi8qXHJcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldFsnY2xhc3NOYW1lJ10gJiYgZXZlbnQudGFyZ2V0WydjbGFzc05hbWUnXS5pbmRleE9mKCdjaGVja2JveC1jb2x1bW4nKSA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5lbmFibGVTZWxlY3RSb3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwgJiYgdGhpcy5kZy5jdXJyZW50Q2VsbC5pc0VkaXRpbmcgJiYgdGhpcy5yb3dJZCAhPT0gdGhpcy5kZy5jdXJyZW50Q2VsbC5yb3dJZCApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZVJvdyh0aGlzLnJvd0RhdGEsIHRoaXMucm93SW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLmRnLmVkaXRhYmxlKSB7XHJcbiAgICAgICAgLy8gICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgY29uc3Qgcm93SWQgPSB0aGlzLmRmcy5wcmltYXJ5SWQodGhpcy5yb3dEYXRhKTtcclxuXHJcbiAgICAgICAgaWYgKCFyb3dJZCkge1xyXG4gICAgICAgICAgICB0aGlzLmRnLndyaXRlQ29uc29sZShg5Zyo56ysICR7dGhpcy5yb3dJbmRleCArIDF9IOihjO+8jOS4u+mUruWtl+autVske3RoaXMuZGcuaWRGaWVsZH1d55qE5YC85Li6IOepuu+8jOivt+ajgOafpeebuOWFs+aVsOaNruOAgmApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYmVmb3JFdmVudFBhcmFtID0ge1xyXG4gICAgICAgICAgICByb3dJbmRleDogdGhpcy5yb3dJbmRleCxcclxuICAgICAgICAgICAgcm93RGF0YTogdGhpcy5yb3dEYXRhLFxyXG4gICAgICAgICAgICBncmlkSW5zdGFuY2U6IHRoaXMuZGdcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoIWV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuZGdzLmZvY3VzUm93Q2hhbmdlZC5lbWl0KHtcclxuICAgICAgICAgICAgICAgIHJvd0luZGV4OiB0aGlzLnJvd0luZGV4LFxyXG4gICAgICAgICAgICAgICAgcm93RGF0YTogdGhpcy5yb3dEYXRhXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB1c2VOZXdTZWxlY3Rpb25Nb2RlID0gdGhpcy5kZy5zbXMuYmVmb3JSb3dDbGljayh7IC4uLmJlZm9yRXZlbnRQYXJhbSwgZTogZXZlbnQsIGlkOiByb3dJZCwgZHI6IHRoaXMgfSk7XHJcbiAgICAgICAgaWYgKHVzZU5ld1NlbGVjdGlvbk1vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRmcy5pc1Jvd1NlbGVjdGVkKHJvd0lkKSkge1xyXG4gICAgICAgICAgICBjb25zdCBjYW5lbmRlZGl0ID0gdGhpcy5kZy5lbmRSb3dFZGl0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWNhbmVuZGVkaXQgfHwgY2FuZW5kZWRpdC5jYW5FbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuYmVmb3JlU2VsZWN0KGJlZm9yRXZlbnRQYXJhbSkucGlwZSggdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5KDIwMClcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKChjYW5TZWxlY3Q6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FuU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucmVtb3ZlQ2VsbFNlbGVjdGVkQ2xzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGZzLnNlbGVjdFJvdyh0aGlzLnJvd0luZGV4LCB0aGlzLnJvd0RhdGEsIHtpbnN0YW5jZTogdGhpcy5kZ30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RlZFJvdy5kciA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJDTFMgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xhc3NOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJDTFMuaW5kZXhPZignZi1kYXRhZ3JpZC1yb3ctc2VsZWN0ZWQnKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc05hbWUgPSB0ckNMUyArICcgZi1kYXRhZ3JpZC1yb3ctc2VsZWN0ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZHJIb3Zlci5zZXRSb3dIb3ZlckNscyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGcuc2VsZWN0Q2hhbmdlZC5lbWl0KHRoaXMuZGcuc2VsZWN0ZWRSb3cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrSGFuZGxlci5lbWl0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucm93Q2xpY2suZW1pdCh7IGRhdGE6IHRoaXMucm93RGF0YSwgZ3JpZDogdGhpcy5kZywgZGJsY2xpY2s6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZGdzLnNldFNlbGVjZWRSb3cuZW1pdCh7IHNlbGVjdGVkOiB0cnVlLCBpZDogdGhpcy5kZnMucHJpbWFyeUlkKHRoaXMucm93RGF0YSkgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ICYmICF0aGlzLmRnLnNlbGVjdGVkUm93LmRyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmRyID0gdGhpcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmtlZXBTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuYmVmb3JlVW5zZWxlY3QoYmVmb3JFdmVudFBhcmFtKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSxcclxuICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKChjYW5VbnNlbGVjdDogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYW5VbnNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmRnLnVuU2VsZWN0LmVtaXQodGhpcy5kZy5zZWxlY3RlZFJvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGZzLnVuU2VsZWN0Um93KHRoaXMucm93SW5kZXgsIHRoaXMucm93RGF0YSwge2luc3RhbmNlOiB0aGlzLmRnfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ckNMUyA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc05hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ckNMUy5pbmRleE9mKCdmLWRhdGFncmlkLXJvdy1zZWxlY3RlZCcpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc05hbWUgPSB0ckNMUy5yZXBsYWNlKCdmLWRhdGFncmlkLXJvdy1zZWxlY3RlZCcsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnJvd0NsaWNrLmVtaXQoeyBkYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWQ6IHRoaXMuZGcsIGRibGNsaWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmRncy5zZXRTZWxlY2VkUm93LmVtaXQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5yb3dDbGljay5lbWl0KHsgZGF0YTogdGhpcy5yb3dEYXRhLCBncmlkOiB0aGlzLmRnLCBkYmxjbGljazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgICAgICovXHJcbiAgICAgICAgLy8gdGhpcy5kZy5yb3dDbGljay5lbWl0KHsgZGF0YTogdGhpcy5yb3dEYXRhLCBncmlkOiB0aGlzLmRnLCBkYmxjbGljazogZmFsc2UgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEZvcm1Db250cm9sKCkge1xyXG4gICAgICAgIHRoaXMuZm9ybSA9IHRoaXMuZmIuZ3JvdXAoe30pO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlQ29udHJvbCgpO1xyXG4gICAgICAgIHRoaXMuZm9ybVsnYmluZGluZ0RhdGEnXSA9IHRoaXMucm93RGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDb250cm9sKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnICYmIHRoaXMuZGcuZmxhdENvbHVtbnMpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5mbGF0Q29sdW1ucy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvbC5lZGl0b3IgJiYgIWNvbC5lZGl0b3JUZW1wbGF0ZSkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5mb3JtLmNvbnRyb2xzW2NvbC5maWVsZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250cm9sID0gdGhpcy5jcmVhdGVGb3JtQ29udHJvbChjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5hZGRDb250cm9sKGNvbC5maWVsZCwgY29udHJvbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUZvcm1Db250cm9sKGNvbCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZiLmNvbnRyb2woXHJcbiAgICAgICAgICAgIFV0aWxzLmdldFZhbHVlKGNvbC5maWVsZCwgdGhpcy5yb3dEYXRhKSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yczogY29sLmVkaXRvciA/IHRoaXMuYmluZFZhbGlkYXRpb25zKGNvbC5lZGl0b3IudmFsaWRhdG9ycykgOiBudWxsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZFZhbGlkYXRpb25zKHZhbGlkYXRvcnM6IERhdGFncmlkVmFsaWRhdG9yW10pIHtcclxuICAgICAgICBjb25zdCB2YWxpZGF0aW9ucyA9IFtdO1xyXG4gICAgICAgIGlmICh2YWxpZGF0b3JzICYmIHZhbGlkYXRvcnMubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICB2YWxpZGF0b3JzLmZvckVhY2goKHY6IERhdGFncmlkVmFsaWRhdG9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsaWRhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHYudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlcXVpcmVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9IFZhbGlkYXRvcnMucmVxdWlyZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ21pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb24gPSBWYWxpZGF0b3JzLm1pbih2LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWF4JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9IFZhbGlkYXRvcnMubWF4KHYudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdtaW5MZW5ndGgnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gVmFsaWRhdG9ycy5taW5MZW5ndGgodi52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ21heExlbmd0aCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb24gPSBWYWxpZGF0b3JzLm1heExlbmd0aCh2LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW1haWwnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gVmFsaWRhdG9ycy5lbWFpbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVxdWlyZWRUcnVlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9IFZhbGlkYXRvcnMucmVxdWlyZWRUcnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwYXR0ZXJuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9IFZhbGlkYXRvcnMucGF0dGVybih2LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25zLnB1c2godmFsaWRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnZhbGlkYXRvcnMgJiYgdGhpcy5kZy52YWxpZGF0b3JzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2Zm4gPSB0aGlzLmRnLnZhbGlkYXRvcnMuZmluZCh2ciA9PiB2ci5uYW1lID09PSB2LnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmZuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uID0gdmZuLnZhbHVlKHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9ucy5wdXNoKHZhbGlkYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25zO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICByZWZyZXNoKCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlUm93SGVpZ2h0KCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDZWxsRW1wdHlTdHlsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVJvd0hlaWdodCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcubm93cmFwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbnRlclRyID0gdGhpcy5kZ2IubWFpbkFyZWEubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0cltpbmRleD1cIicgKyB0aGlzLnJvd0luZGV4ICsgJ1wiXScpO1xyXG4gICAgICAgICAgICBjZW50ZXJUci5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgICAgIGNvbnN0IHRySGVpZ2h0ID0gY2VudGVyVHIub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgICAgICBsZXQgbGVmdFRyRG9tID0gbnVsbDtcclxuICAgICAgICAgICAgbGV0IHJpZ2h0VHJEb20gPSBudWxsO1xyXG4gICAgICAgICAgICBjb25zdCBoZWlnaHRTaXplTGlzdCA9IFt0ckhlaWdodF07XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnYikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGdiLmZpeGVkTGVmdEVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdFRyRG9tID0gdGhpcy5kZ2IuZml4ZWRMZWZ0RWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0cltpbmRleD1cIicgKyB0aGlzLnJvd0luZGV4ICsgJ1wiXScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsZWZ0VHJEb20pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdFRyRG9tLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0U2l6ZUxpc3QucHVzaChsZWZ0VHJEb20ub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZ2IuZml4ZWRSaWdodEVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRUckRvbSA9IHRoaXMuZGdiLmZpeGVkUmlnaHRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RyW2luZGV4PVwiJyArIHRoaXMucm93SW5kZXggKyAnXCJdJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJpZ2h0VHJEb20pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRUckRvbS5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodFNpemVMaXN0LnB1c2gocmlnaHRUckRvbS5vZmZzZXRIZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXhIZWlnaHQgPSBNYXRoLm1heCguLi5oZWlnaHRTaXplTGlzdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2VudGVyVHIuc3R5bGUuaGVpZ2h0ID0gYCR7bWF4SGVpZ2h0fXB4YDtcclxuICAgICAgICAgICAgICAgIGlmIChsZWZ0VHJEb20pIHtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0VHJEb20uc3R5bGUuaGVpZ2h0ID0gYCR7bWF4SGVpZ2h0fXB4YDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmlnaHRUckRvbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0VHJEb20uc3R5bGUuaGVpZ2h0ID0gYCR7bWF4SGVpZ2h0fXB4YDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ2IudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVDZWxsRW1wdHlTdHlsZSgpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLmVuYWJsZUVkaXRDZWxsU3R5bGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHJvd0lzRGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlUm93KSB7XHJcbiAgICAgICAgICAgIHJvd0lzRGlzYWJsZWQgPSB0aGlzLmRnLmRpc2FibGVSb3codGhpcy5yb3dEYXRhLCB0aGlzLnJvd0luZGV4KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHVwZGF0ZUNlbGxFbXB0eVRleHQgPSAoY2VsbHMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGNlbGxzLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgY2VsbHMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGNlbGxzW2tdLmdldEF0dHJpYnV0ZSgnZmllbGQnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sID0gdGhpcy5kZnMuZ2V0Q29sdW1uKGZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29sLmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xzID0gY29sLmFsaWduID09PSAncmlnaHQnID8gJ2FsbG93LWVkaXQtY2VsbC1sZWZ0JyA6ICdhbGxvdy1lZGl0LWNlbGwnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW1wdHlpY29uX2NscyA9IEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTW2NvbC5lZGl0b3IudHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGFuID0gY2VsbHNba10ucXVlcnlTZWxlY3RvcignLmNlbGwtdGV4dC1ib3gnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbFZhbCA9IFV0aWxzLmdldFZhbHVlKGZpZWxkLCB0aGlzLnJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZm10VmFsID0gdGhpcy5kZy5jb2xGb3JtYXRTZXIuZm9ybWF0KGNvbFZhbCwgdGhpcy5yb3dEYXRhLCBjb2wuZm9ybWF0dGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5lZGl0YWJsZSB8fCByb3dJc0Rpc2FibGVkIHx8IHRoaXMuZGcuY2VsbElzUmVhZE9ubHkoY29sLCB0aGlzLnJvd0RhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbHNba10uY2xhc3NOYW1lID0gY2VsbHNba10uY2xhc3NOYW1lLnJlcGxhY2UoY2xzLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbHNba10uY2xhc3NOYW1lID0gY2VsbHNba10uY2xhc3NOYW1lLnJlcGxhY2UoZW1wdHlpY29uX2NscywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcGFuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcGFuLmNsYXNzTmFtZS5pbmRleE9mKCdjZWxsLWVtcHR5JykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5jbGFzc05hbWUgPSBzcGFuLmNsYXNzTmFtZS5yZXBsYWNlKCdjZWxsLWVtcHR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sVmFsID09PSAnJyB8fCBjb2xWYWwgPT09IG51bGwgfHwgY29sVmFsID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLmlubmVySFRNTCA9IGZtdFZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwYW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbFZhbCA9PT0gJycgfHwgY29sVmFsID09PSBudWxsIHx8IGNvbFZhbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3Bhbi5jbGFzc05hbWUuaW5kZXhPZignY2VsbC1lbXB0eScpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uY2xhc3NOYW1lID0gc3Bhbi5jbGFzc05hbWUgKyAnIGNlbGwtZW1wdHknO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4uaW5uZXJIVE1MID0gVXRpbHMuZ2V0V2hlbkVtcHR5VGV4dChjb2wsIHRoaXMuZGcubG9jYWxlU2VydmljZS5sb2NhbGVJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLmlubmVySFRNTCA9IGZtdFZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGxzW2tdLmNsYXNzTmFtZS5pbmRleE9mKCdjZWxsLXJlYWRvbmx5JykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsc1trXS5jbGFzc05hbWUgPSBjZWxsc1trXS5jbGFzc05hbWUucmVwbGFjZSgnY2VsbC1yZWFkb25seScsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZWxsc1trXS5jbGFzc05hbWUuaW5kZXhPZihjbHMpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhjZWxsc1trXSwgY2xzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZWxsc1trXS5jbGFzc05hbWUuaW5kZXhPZihlbXB0eWljb25fY2xzKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3MoY2VsbHNba10sIGVtcHR5aWNvbl9jbHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAvLyBpZiAodGhpcy5kZ2IuZml4ZWRMZWZ0RWwpIHtcclxuICAgICAgICAvLyAgICAgY29uc3QgbGVmdFRyRG9tID0gdGhpcy5kZ2IuZml4ZWRMZWZ0RWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0cltpbmRleD1cIicgKyB0aGlzLnJvd0luZGV4ICsgJ1wiXScpO1xyXG4gICAgICAgIC8vICAgICBpZiAobGVmdFRyRG9tKSB7XHJcbiAgICAgICAgLy8gICAgICAgICB1cGRhdGVDZWxsRW1wdHlUZXh0KGxlZnRUckRvbS5xdWVyeVNlbGVjdG9yQWxsKCd0ZFtmaWVsZF0nKSk7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNlbGxzID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkW2ZpZWxkXTpub3QoW2ZpZWxkPVwiX2RhdGFncmlkLXNldHRpbmctY29udHJvbF9cIl0pJyk7XHJcbiAgICAgICAgdXBkYXRlQ2VsbEVtcHR5VGV4dChjZWxscyk7XHJcbiAgICB9XHJcbn1cclxuIl19
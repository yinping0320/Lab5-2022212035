/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from '../../datagrid.component';
import { Directive, Injector, Input, ElementRef } from '@angular/core';
import { DatagridBodyComponent } from '../body';
var AutoHeightDirective = /** @class */ (function () {
    function AutoHeightDirective(dg, inject, el) {
        this.dg = dg;
        this.inject = inject;
        this.el = el;
        this.autoHeight = false;
        this._timer = null;
        this._dgb = null;
        this._dgb = this.inject.get(DatagridBodyComponent);
    }
    /**
     * @return {?}
     */
    AutoHeightDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // this.updateDatagridHeight(this.wheelHeight);
    };
    /**
     * @return {?}
     */
    AutoHeightDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this._updateDatagridHeight(this.wheelHeight);
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    AutoHeightDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.wheelHeight) {
            this._updateDatagridHeight(this.wheelHeight);
        }
    };
    /**
     * @return {?}
     */
    AutoHeightDirective.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        // this.checkScrollbarPosition();
    };
    /**
     * @private
     * @param {?} wheelHeight
     * @return {?}
     */
    AutoHeightDirective.prototype.updateDatagridHeight = /**
     * @private
     * @param {?} wheelHeight
     * @return {?}
     */
    function (wheelHeight) {
        if (this.el && this.el.nativeElement && this.el.nativeElement.parentElement) {
            if (this.autoHeight) {
                if (!wheelHeight) {
                    wheelHeight = 240;
                    if (!this.dg.ds || !this.dg.ds.rows || !this.dg.ds.rows.length) {
                        wheelHeight = (!this.dg.emptyDataHeight || this.dg.emptyDataHeight < 0) ? 240 : this.dg.emptyDataHeight;
                    }
                }
                /** @type {?} */
                var h = parseInt(wheelHeight, 10);
                if (this.dg.showHeader) {
                    if (!this.dg.realHeaderHeight) {
                        h += this.dg.setHeaderHeight();
                    }
                    else {
                        h += this.dg.realHeaderHeight;
                    }
                }
                if (this.dg.showFooter) {
                    h += this.dg.footerHeight;
                }
                if (this.dg.pagination) {
                    /** @type {?} */
                    var ph = this.dg.pagerHeight || 40;
                    h += ph;
                }
                if (this.dg.showFilterBar) {
                    h += this.dg.filterBarHeight;
                }
                if (this.dg.showRowGroupPanel) {
                    h += this.dg.rowGroupPanelHeight;
                }
                /** @type {?} */
                var wh = wheelHeight + "px";
                if (this.dg.maxHeight && h > this.dg.maxHeight) {
                    wh = this._dgb.getViewPortHeight();
                }
                this.el.nativeElement.parentElement.style.height = wh;
                this.el.nativeElement.parentElement.parentElement.style.height = wh;
                if (this.dg.dgContainer) {
                    if (this.dg.maxHeight && h > this.dg.maxHeight) {
                        h = this.dg.maxHeight;
                    }
                    /** @type {?} */
                    var dgHeight = h + "px";
                    // 更新grid 最外层的高度
                    this.dg.dgContainer.nativeElement.style.height = dgHeight;
                    // farris-datagrid 增加高度
                    this.dg.el.nativeElement.style.height = dgHeight;
                    this.dg.height = h;
                    if (this.dg.maxHeight) {
                        if (this.dg.maxHeight && this.dg.maxHeight < 55) {
                            this.dg.maxHeight = 60;
                        }
                        /** @type {?} */
                        var gridContainerEl = this.dg.el.nativeElement.parentElement;
                        gridContainerEl.style.height = 'unset';
                        gridContainerEl.style.maxHeight = this.dg.maxHeight + 'px';
                        gridContainerEl.style.minHeight = h + 'px';
                    }
                }
                else {
                    this.dg.el.nativeElement.querySelector('.f-datagrid').style.height = h + "px";
                }
            }
        }
    };
    /**
     * @private
     * @param {?} wheelHeight
     * @return {?}
     */
    AutoHeightDirective.prototype._updateDatagridHeight = /**
     * @private
     * @param {?} wheelHeight
     * @return {?}
     */
    function (wheelHeight) {
        var _this = this;
        if (this.dg.autoHeight) {
            if (this.dg.el.nativeElement.parentElement.className.indexOf('f-utils-fill') > -1) {
                this.dg.el.nativeElement.parentElement.className = this.dg.el.nativeElement.parentElement.className.replace('f-utils-fill', '');
            }
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.updateDatagridHeight(wheelHeight);
            }), 50);
        }
    };
    AutoHeightDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[auto-height]',
                },] }
    ];
    /** @nocollapse */
    AutoHeightDirective.ctorParameters = function () { return [
        { type: DatagridComponent },
        { type: Injector },
        { type: ElementRef }
    ]; };
    AutoHeightDirective.propDecorators = {
        autoHeight: [{ type: Input, args: ['auto-height',] }],
        wheelHeight: [{ type: Input }]
    };
    return AutoHeightDirective;
}());
export { AutoHeightDirective };
if (false) {
    /** @type {?} */
    AutoHeightDirective.prototype.autoHeight;
    /**
     * 数据列表总高度
     * @type {?}
     */
    AutoHeightDirective.prototype.wheelHeight;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype._timer;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype._dgb;
    /** @type {?} */
    AutoHeightDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1oZWlnaHQuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2F1dG8taGVpZ2h0L2F1dG8taGVpZ2h0LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFhLFNBQVMsRUFBVSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBb0QsTUFBTSxlQUFlLENBQUM7QUFDNUksT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRWhEO0lBWUksNkJBQW1CLEVBQXFCLEVBQVUsTUFBZ0IsRUFBVSxFQUFjO1FBQXZFLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFQcEUsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUlqQyxXQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsU0FBSSxHQUFHLElBQUksQ0FBQztRQUdoQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDdkQsQ0FBQzs7OztJQUVELHNDQUFROzs7SUFBUjtRQUNJLCtDQUErQztJQUNuRCxDQUFDOzs7O0lBRUQsNkNBQWU7OztJQUFmO1FBQ0ksSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNqRCxDQUFDOzs7OztJQUVELHlDQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtRQUM5QixJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUU7WUFDckIsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUNoRDtJQUNMLENBQUM7Ozs7SUFFRCx1Q0FBUzs7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QUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO2dCQUMvRSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2FBQ25JO1lBQ0QsVUFBVTs7O1lBQUM7Z0JBQ1AsS0FBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzNDLENBQUMsR0FBRSxFQUFFLENBQUMsQ0FBQztTQUNWO0lBQ0wsQ0FBQzs7Z0JBekhKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsZUFBZTtpQkFDNUI7Ozs7Z0JBTlEsaUJBQWlCO2dCQUNhLFFBQVE7Z0JBQVMsVUFBVTs7OzZCQVE3RCxLQUFLLFNBQUMsYUFBYTs4QkFFbkIsS0FBSzs7SUFvSFYsMEJBQUM7Q0FBQSxBQTNIRCxJQTJIQztTQXhIWSxtQkFBbUI7OztJQUU1Qix5Q0FBeUM7Ozs7O0lBRXpDLDBDQUE2Qjs7Ozs7SUFFN0IscUNBQXNCOzs7OztJQUN0QixtQ0FBb0I7O0lBRVIsaUNBQTRCOzs7OztJQUFFLHFDQUF3Qjs7Ozs7SUFBRSxpQ0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgRGlyZWN0aXZlLCBPbkluaXQsIEluamVjdG9yLCBJbnB1dCwgRWxlbWVudFJlZiwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBEb0NoZWNrIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQm9keUNvbXBvbmVudCB9IGZyb20gJy4uL2JvZHknO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1thdXRvLWhlaWdodF0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXV0b0hlaWdodERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBEb0NoZWNrIHtcclxuXHJcbiAgICBASW5wdXQoJ2F1dG8taGVpZ2h0JykgYXV0b0hlaWdodCA9IGZhbHNlO1xyXG4gICAgLyoqIOaVsOaNruWIl+ihqOaAu+mrmOW6piAqL1xyXG4gICAgQElucHV0KCkgd2hlZWxIZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIF90aW1lciA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9kZ2IgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsIHByaXZhdGUgaW5qZWN0OiBJbmplY3RvciwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZikge1xyXG4gICAgICAgIHRoaXMuX2RnYiA9IHRoaXMuaW5qZWN0LmdldChEYXRhZ3JpZEJvZHlDb21wb25lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIC8vIHRoaXMudXBkYXRlRGF0YWdyaWRIZWlnaHQodGhpcy53aGVlbEhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZURhdGFncmlkSGVpZ2h0KHRoaXMud2hlZWxIZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy53aGVlbEhlaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVEYXRhZ3JpZEhlaWdodCh0aGlzLndoZWVsSGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdEb0NoZWNrKCkge1xyXG4gICAgICAgIC8vIHRoaXMuY2hlY2tTY3JvbGxiYXJQb3NpdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlRGF0YWdyaWRIZWlnaHQod2hlZWxIZWlnaHQpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZWwgJiYgdGhpcy5lbC5uYXRpdmVFbGVtZW50ICYmIHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghd2hlZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGVlbEhlaWdodCA9IDI0MDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmRzIHx8ICF0aGlzLmRnLmRzLnJvd3MgfHwgIXRoaXMuZGcuZHMucm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hlZWxIZWlnaHQgPSAoIXRoaXMuZGcuZW1wdHlEYXRhSGVpZ2h0IHx8IHRoaXMuZGcuZW1wdHlEYXRhSGVpZ2h0IDwgMCApID8gMjQwIDogdGhpcy5kZy5lbXB0eURhdGFIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IGggPSAgcGFyc2VJbnQod2hlZWxIZWlnaHQsIDEwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zaG93SGVhZGVyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5yZWFsSGVhZGVySGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGggKz0gdGhpcy5kZy5zZXRIZWFkZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoICs9IHRoaXMuZGcucmVhbEhlYWRlckhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0Zvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGggKz0gdGhpcy5kZy5mb290ZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBoID0gdGhpcy5kZy5wYWdlckhlaWdodCB8fCA0MDtcclxuICAgICAgICAgICAgICAgICAgICBoICs9IHBoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNob3dGaWx0ZXJCYXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBoICs9IHRoaXMuZGcuZmlsdGVyQmFySGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNob3dSb3dHcm91cFBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaCArPSB0aGlzLmRnLnJvd0dyb3VwUGFuZWxIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHdoID0gIGAke3doZWVsSGVpZ2h0fXB4YDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5tYXhIZWlnaHQgJiYgaCA+IHRoaXMuZGcubWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2ggPSB0aGlzLl9kZ2IuZ2V0Vmlld1BvcnRIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9IHdoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSB3aDsgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuZGdDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5tYXhIZWlnaHQgJiYgaCA+IHRoaXMuZGcubWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0aGlzLmRnLm1heEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRnSGVpZ2h0ID0gYCR7aH1weGA7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pu05pawZ3JpZCDmnIDlpJblsYLnmoTpq5jluqZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmRnQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gZGdIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZmFycmlzLWRhdGFncmlkIOWinuWKoOmrmOW6plxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBkZ0hlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5oZWlnaHQgPSBoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5tYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcubWF4SGVpZ2h0ICYmIHRoaXMuZGcubWF4SGVpZ2h0IDwgNTUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcubWF4SGVpZ2h0ID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBncmlkQ29udGFpbmVyRWwgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZENvbnRhaW5lckVsLnN0eWxlLmhlaWdodCA9ICd1bnNldCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRDb250YWluZXJFbC5zdHlsZS5tYXhIZWlnaHQgPSB0aGlzLmRnLm1heEhlaWdodCArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRDb250YWluZXJFbC5zdHlsZS5taW5IZWlnaHQgPSBoICsgJ3B4JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmYtZGF0YWdyaWQnKS5zdHlsZS5oZWlnaHQgPSBgJHtofXB4YDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF91cGRhdGVEYXRhZ3JpZEhlaWdodCh3aGVlbEhlaWdodCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKCdmLXV0aWxzLWZpbGwnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc05hbWUgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgnZi11dGlscy1maWxsJywgJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEYXRhZ3JpZEhlaWdodCh3aGVlbEhlaWdodCk7XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { takeUntil } from 'rxjs/operators';
import { LocaleService } from '@farris/ui-locale';
import { Subject } from 'rxjs';
import { Component, ViewEncapsulation, Injector, ChangeDetectorRef, ElementRef, ViewChild, Renderer2, Input, NgZone } from '@angular/core';
import { DatagridService } from './../../services/datagrid.service';
import ResizeObserver from 'resize-observer-polyfill';
import { DatagridComponent } from '../../datagrid.component';
var DatagridFilterToolbarComponent = /** @class */ (function () {
    function DatagridFilterToolbarComponent(inject, el, cd, dgs, render, ngZone, localeSer) {
        this.inject = inject;
        this.el = el;
        this.cd = cd;
        this.dgs = dgs;
        this.render = render;
        this.ngZone = ngZone;
        this.localeSer = localeSer;
        this.empty = '[ æ—  ]';
        this.filterText = this.empty;
        this.openFilterPanel = false;
        this.showExpand = false;
        this.enableFilterSetting = false;
        this.windowResizeHandler = null;
        this.ro = null;
        this.destory$ = new Subject();
        this.empty = this.localeSer.getValue('datagrid.filter.nofilter');
        this.filterText = this.empty;
    }
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "toolbarWidth", {
        get: /**
         * @return {?}
         */
        function () {
            return this.filterToolbarRef.nativeElement.offsetWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "filterTextContainerWidth", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var actionW = 52;
            if (this.enableFilterSetting) {
                actionW = 65;
            }
            return this.toolbarWidth - 85 - actionW;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFilterToolbarComponent.prototype, "filterTextRealWidth", {
        get: /**
         * @return {?}
         */
        function () {
            this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'nowrap');
            /** @type {?} */
            var w = this.filterPanelTextRef.nativeElement.scrollWidth;
            this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'normal');
            return w;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dg = this.inject.get(DatagridComponent);
        this.dfrs = this.dg.clientFilterService;
        this.dgs.clearFilter.pipe(takeUntil(this.destory$)).subscribe((/**
         * @return {?}
         */
        function () {
            _this.filterText = _this.empty;
            _this.openFilterPanel = false;
            _this.dgs.onFilterTextChange(_this.filterText);
            _this.cd.detectChanges();
        }));
        this.filterChangeSubscription = this.dgs.onFilterChanged.pipe(takeUntil(this.destory$)).subscribe((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            _this.filterText = _this.dfrs.convertFilterCondition2String(n);
            if (!_this.filterText) {
                _this.filterText = _this.empty;
            }
            _this.updateExpandState();
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.bindEvent();
            }), 100);
            if (!_this.showExpand) {
                _this.openFilterPanel = false;
            }
            _this.cd.detectChanges();
            _this.dgs.onFilterTextChange(_this.filterText);
        }));
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.ro = new ResizeObserver((/**
             * @return {?}
             */
            function () {
                if (_this['_CONTAINER_SIZE_CHANGED_TIMER_']) {
                    clearTimeout(_this['_CONTAINER_SIZE_CHANGED_TIMER_']);
                }
                _this['_CONTAINER_SIZE_CHANGED_TIMER_'] = setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.updateExpandState();
                    _this.cd.detectChanges();
                }), 100);
            }));
            _this.ro.observe(_this.el.nativeElement.closest('div.f-datagrid'));
        }));
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destory$.next();
        this.destory$.complete();
        this.ro.disconnect();
        if (this.filterChangeSubscription) {
            this.filterChangeSubscription.unsubscribe();
            this.filterChangeSubscription = null;
        }
        if (this.windowResizeHandler) {
            this.windowResizeHandler();
            this.windowResizeHandler = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.bindEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var filterFields = _this.filterToolbarRef.nativeElement.querySelectorAll('.filter-field');
            _this.bindFilterFieldHandler(filterFields);
            /** @type {?} */
            var dropdownFilterFields = _this.filterPanelTextRef.nativeElement.querySelectorAll('.filter-field');
            _this.bindFilterFieldHandler(dropdownFilterFields, false);
        }));
    };
    /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.bindFilterFieldHandler = /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    function (filterFields, hidePanel) {
        var _this = this;
        if (hidePanel === void 0) { hidePanel = true; }
        if (filterFields && filterFields.length) {
            filterFields.forEach((/**
             * @param {?} ff
             * @return {?}
             */
            function (ff) {
                _this.render.listen(ff, 'click', (/**
                 * @return {?}
                 */
                function () {
                    _this.removeFilterField(ff, hidePanel);
                }));
            }));
        }
    };
    /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.removeFilterField = /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    function (ff, hidePanel) {
        if (hidePanel === void 0) { hidePanel = true; }
        /** @type {?} */
        var field = ff.classList[1].replace('filter-column-', '');
        // delete this.dg.conditions[field];
        ff.remove();
        if (hidePanel) {
            this.openFilterPanel = false;
            this.updateExpandState();
        }
        this.dfrs.removeFilterField(field);
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.updateExpandState = /**
     * @private
     * @return {?}
     */
    function () {
        this.showExpand = this.isShowExpand();
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.isShowExpand = /**
     * @return {?}
     */
    function () {
        if (this.filterTextContainerWidth > this.filterTextRealWidth) {
            return false;
        }
        else if (this.filterTextRealWidth > this.filterTextContainerWidth) {
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.clearFilter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.filterText = this.empty;
        this.dgs.onClearFilter();
        this.dgs.onFilterChanged.emit({});
        return false;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.refreshFilter = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.dg.filterData();
        return false;
    };
    /**
     * @return {?}
     */
    DatagridFilterToolbarComponent.prototype.showFilterTextPanel = /**
     * @return {?}
     */
    function () {
        this.openFilterPanel = !this.openFilterPanel;
        this.cd.detectChanges();
    };
    DatagridFilterToolbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'filter-toolbar',
                    template: "\n        <div class=\"f-datagrid-filter-toolbar-panel\" #filterPanel [class.show]=\"openFilterPanel\" style=\"width: auto\">\n            <span class=\"filter-text\" #filterPanelText [innerHTML]=\"filterText\"></span>\n        </div>\n        <div class=\"f-datagrid-filter-toolbar\" #filterToolbar>\n            <span class=\"title\">{{'datagrid.filter.title'| locale}}\uFF1A</span>\n            <span #filterbarTxt class=\"filter-text\" [innerHTML]=\"filterText\"> </span>\n            <span class=\"filter-action\" *ngIf=\"filterText !== empty \">\n                <span *ngIf=\"showExpand\" class=\"f-icon filter-action-item\"\n                    [class.f-icon-arrow-chevron-up]=\"openFilterPanel\"\n                    [class.f-icon-arrow-chevron-down]=\"!openFilterPanel\"\n                (click)=\"showFilterTextPanel()\" title=\"{{'datagrid.filter.more'|locale}}\"></span>\n                <span title=\"{{'datagrid.filter.clearAll'|locale}}\" class=\"f-icon f-icon-x filter-action-item filter-clear\" (click)=\"clearFilter($event)\"></span>\n                <span title=\"refresh\" class=\"f-icon f-icon-reload-sm filter-action-item filter-refresh\" style=\"color: #388fff\" (click)=\"refreshFilter($event)\"></span>\n                <span *ngIf=\"enableFilterSetting\" class=\"f-icon f-icon-cog filter-action-item\" title=\"{{'datagrid.filter.setting'|locale}}\"></span>\n            </span>\n        </div>\n    ",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    DatagridFilterToolbarComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: DatagridService },
        { type: Renderer2 },
        { type: NgZone },
        { type: LocaleService }
    ]; };
    DatagridFilterToolbarComponent.propDecorators = {
        enableFilterSetting: [{ type: Input }],
        filterPanelRef: [{ type: ViewChild, args: ['filterPanel',] }],
        filterPanelTextRef: [{ type: ViewChild, args: ['filterPanelText',] }],
        filterTextRef: [{ type: ViewChild, args: ['filterbarTxt',] }],
        filterToolbarRef: [{ type: ViewChild, args: ['filterToolbar',] }]
    };
    return DatagridFilterToolbarComponent;
}());
export { DatagridFilterToolbarComponent };
if (false) {
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.empty;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterText;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.openFilterPanel;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.showExpand;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.enableFilterSetting;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterToolbarRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterChangeSubscription;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.windowResizeHandler;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.destory$;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.localeSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbHRlci10b29sYmFyL2ZpbHRlci10b29sYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsT0FBTyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFVLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUE2QixNQUFNLGVBQWUsQ0FBQztBQUM5SyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHcEUsT0FBTyxjQUFjLE1BQU0sMEJBQTBCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHN0Q7SUE2REksd0NBQ1ksTUFBZ0IsRUFDaEIsRUFBYyxFQUNkLEVBQXFCLEVBQ3JCLEdBQW9CLEVBQ3BCLE1BQWlCLEVBQ2pCLE1BQWMsRUFDZCxTQUF3QjtRQU54QixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFpQjtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBN0NwQyxVQUFLLEdBQUcsT0FBTyxDQUFDO1FBQ2hCLGVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFD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Ozs7O0lBRUQsNERBQW1COzs7SUFBbkI7UUFDSSxJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUM3QyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzVCLENBQUM7O2dCQWpNSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLG81Q0FpQlQ7b0JBQ0QsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7aUJBQ3hDOzs7O2dCQTdCOEMsUUFBUTtnQkFBcUIsVUFBVTtnQkFBN0IsaUJBQWlCO2dCQUNqRSxlQUFlO2dCQUQyRSxTQUFTO2dCQUFTLE1BQU07Z0JBRmxILGFBQWE7OztzQ0F1Q2pCLEtBQUs7aUNBRUwsU0FBUyxTQUFDLGFBQWE7cUNBQ3ZCLFNBQVMsU0FBQyxpQkFBaUI7Z0NBQzNCLFNBQVMsU0FBQyxjQUFjO21DQUN4QixTQUFTLFNBQUMsZUFBZTs7SUFnSzlCLHFDQUFDO0NBQUEsQUFsTUQsSUFrTUM7U0E1S1ksOEJBQThCOzs7SUFDdkMsK0NBQWdCOztJQUNoQixvREFBd0I7O0lBRXhCLHlEQUF3Qjs7SUFDeEIsb0RBQW1COztJQUVuQiw2REFBcUM7O0lBRXJDLHdEQUFxRDs7SUFDckQsNERBQTZEOztJQUM3RCx1REFBcUQ7O0lBQ3JELDBEQUF5RDs7SUFxQnpELGtFQUF1Qzs7SUFDdkMsNkRBQTJCOztJQUMzQiw0Q0FBMEI7Ozs7O0lBQzFCLGtEQUFpQzs7Ozs7SUFDakMsOENBQW9DOzs7OztJQUNwQyw0Q0FBOEI7Ozs7O0lBRTFCLGdEQUF3Qjs7Ozs7SUFDeEIsNENBQXNCOzs7OztJQUN0Qiw0Q0FBNkI7Ozs7O0lBQzdCLDZDQUE0Qjs7Ozs7SUFDNUIsZ0RBQXlCOzs7OztJQUN6QixnREFBc0I7Ozs7O0lBQ3RCLG1EQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3RW5jYXBzdWxhdGlvbiwgSW5qZWN0b3IsIENoYW5nZURldGVjdG9yUmVmLCBFbGVtZW50UmVmLCBWaWV3Q2hpbGQsIFJlbmRlcmVyMiwgSW5wdXQsIE5nWm9uZSwgT25EZXN0cm95LCBPcHRpb25hbCwgSG9zdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEZpbHRlclNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZpbHRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgIH0gZnJvbSAnLi8uLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdyZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZpbHRlci10b29sYmFyJyxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtZmlsdGVyLXRvb2xiYXItcGFuZWxcIiAjZmlsdGVyUGFuZWwgW2NsYXNzLnNob3ddPVwib3BlbkZpbHRlclBhbmVsXCIgc3R5bGU9XCJ3aWR0aDogYXV0b1wiPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZpbHRlci10ZXh0XCIgI2ZpbHRlclBhbmVsVGV4dCBbaW5uZXJIVE1MXT1cImZpbHRlclRleHRcIj48L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImYtZGF0YWdyaWQtZmlsdGVyLXRvb2xiYXJcIiAjZmlsdGVyVG9vbGJhcj5cclxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0aXRsZVwiPnt7J2RhdGFncmlkLmZpbHRlci50aXRsZSd8IGxvY2FsZX1977yaPC9zcGFuPlxyXG4gICAgICAgICAgICA8c3BhbiAjZmlsdGVyYmFyVHh0IGNsYXNzPVwiZmlsdGVyLXRleHRcIiBbaW5uZXJIVE1MXT1cImZpbHRlclRleHRcIj4gPC9zcGFuPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZpbHRlci1hY3Rpb25cIiAqbmdJZj1cImZpbHRlclRleHQgIT09IGVtcHR5IFwiPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJzaG93RXhwYW5kXCIgY2xhc3M9XCJmLWljb24gZmlsdGVyLWFjdGlvbi1pdGVtXCJcclxuICAgICAgICAgICAgICAgICAgICBbY2xhc3MuZi1pY29uLWFycm93LWNoZXZyb24tdXBdPVwib3BlbkZpbHRlclBhbmVsXCJcclxuICAgICAgICAgICAgICAgICAgICBbY2xhc3MuZi1pY29uLWFycm93LWNoZXZyb24tZG93bl09XCIhb3BlbkZpbHRlclBhbmVsXCJcclxuICAgICAgICAgICAgICAgIChjbGljayk9XCJzaG93RmlsdGVyVGV4dFBhbmVsKClcIiB0aXRsZT1cInt7J2RhdGFncmlkLmZpbHRlci5tb3JlJ3xsb2NhbGV9fVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIHRpdGxlPVwie3snZGF0YWdyaWQuZmlsdGVyLmNsZWFyQWxsJ3xsb2NhbGV9fVwiIGNsYXNzPVwiZi1pY29uIGYtaWNvbi14IGZpbHRlci1hY3Rpb24taXRlbSBmaWx0ZXItY2xlYXJcIiAoY2xpY2spPVwiY2xlYXJGaWx0ZXIoJGV2ZW50KVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuIHRpdGxlPVwicmVmcmVzaFwiIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1yZWxvYWQtc20gZmlsdGVyLWFjdGlvbi1pdGVtIGZpbHRlci1yZWZyZXNoXCIgc3R5bGU9XCJjb2xvcjogIzM4OGZmZlwiIChjbGljayk9XCJyZWZyZXNoRmlsdGVyKCRldmVudClcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cImVuYWJsZUZpbHRlclNldHRpbmdcIiBjbGFzcz1cImYtaWNvbiBmLWljb24tY29nIGZpbHRlci1hY3Rpb24taXRlbVwiIHRpdGxlPVwie3snZGF0YWdyaWQuZmlsdGVyLnNldHRpbmcnfGxvY2FsZX19XCI+PC9zcGFuPlxyXG4gICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICBgLFxyXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRGaWx0ZXJUb29sYmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgZW1wdHkgPSAnWyDml6AgXSc7XHJcbiAgICBmaWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuXHJcbiAgICBvcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgIHNob3dFeHBhbmQgPSBmYWxzZTtcclxuXHJcbiAgICBASW5wdXQoKSBlbmFibGVGaWx0ZXJTZXR0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyUGFuZWwnKSBmaWx0ZXJQYW5lbFJlZjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclBhbmVsVGV4dCcpIGZpbHRlclBhbmVsVGV4dFJlZjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlcmJhclR4dCcpIGZpbHRlclRleHRSZWY6IEVsZW1lbnRSZWY7XHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJUb29sYmFyJykgZmlsdGVyVG9vbGJhclJlZjogRWxlbWVudFJlZjtcclxuXHJcbiAgICBnZXQgdG9vbGJhcldpZHRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlclRvb2xiYXJSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmlsdGVyVGV4dENvbnRhaW5lcldpZHRoKCkge1xyXG4gICAgICAgIGxldCBhY3Rpb25XID0gNTI7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRmlsdGVyU2V0dGluZykge1xyXG4gICAgICAgICAgICBhY3Rpb25XID0gNjU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRvb2xiYXJXaWR0aCAtIDg1IC0gYWN0aW9uVztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZmlsdGVyVGV4dFJlYWxXaWR0aCgpIHtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmZpbHRlclBhbmVsVGV4dFJlZi5uYXRpdmVFbGVtZW50LCAnd2hpdGUtc3BhY2UnLCAnbm93cmFwJyk7XHJcbiAgICAgICAgY29uc3QgdyA9IHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGg7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudCwgJ3doaXRlLXNwYWNlJywgJ25vcm1hbCcpO1xyXG4gICAgICAgIHJldHVybiB3O1xyXG4gICAgfVxyXG5cclxuICAgIGZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgd2luZG93UmVzaXplSGFuZGxlciA9IG51bGw7XHJcbiAgICBybzogUmVzaXplT2JzZXJ2ZXIgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZXN0b3J5JCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIGRmcnM6IERhdGFncmlkRmlsdGVyU2VydmljZTtcclxuICAgIHByaXZhdGUgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICAgICAgcHJpdmF0ZSBkZ3M6IERhdGFncmlkU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXHJcbiAgICAgICAgcHJpdmF0ZSBsb2NhbGVTZXI6IExvY2FsZVNlcnZpY2UsXHJcbiAgICAgICkge1xyXG4gICAgICAgICAgICB0aGlzLmVtcHR5ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5ub2ZpbHRlcicpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmRnID0gdGhpcy5pbmplY3QuZ2V0PERhdGFncmlkQ29tcG9uZW50PihEYXRhZ3JpZENvbXBvbmVudCk7XHJcbiAgICAgICAgdGhpcy5kZnJzID0gdGhpcy5kZy5jbGllbnRGaWx0ZXJTZXJ2aWNlO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5jbGVhckZpbHRlci5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3RvcnkkKSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuICAgICAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJUZXh0Q2hhbmdlKHRoaXMuZmlsdGVyVGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbiA9IHRoaXMuZGdzLm9uRmlsdGVyQ2hhbmdlZC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3RvcnkkKSkuc3Vic2NyaWJlKChuKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZGZycy5jb252ZXJ0RmlsdGVyQ29uZGl0aW9uMlN0cmluZyhuKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmZpbHRlclRleHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwYW5kU3RhdGUoKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2hvd0V4cGFuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJUZXh0Q2hhbmdlKHRoaXMuZmlsdGVyVGV4dCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucm8gPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXNbJ19DT05UQUlORVJfU0laRV9DSEFOR0VEX1RJTUVSXyddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXNbJ19DT05UQUlORVJfU0laRV9DSEFOR0VEX1RJTUVSXyddKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXNbJ19DT05UQUlORVJfU0laRV9DSEFOR0VEX1RJTUVSXyddID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeHBhbmRTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJvLm9ic2VydmUodGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsb3Nlc3QoJ2Rpdi5mLWRhdGFncmlkJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuZGVzdG9yeSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdG9yeSQuY29tcGxldGUoKTtcclxuICAgICAgICB0aGlzLnJvLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICBpZiAodGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy53aW5kb3dSZXNpemVIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMud2luZG93UmVzaXplSGFuZGxlcigpO1xyXG4gICAgICAgICAgICB0aGlzLndpbmRvd1Jlc2l6ZUhhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJpbmRFdmVudCgpIHtcclxuICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlckZpZWxkcyA9IHRoaXMuZmlsdGVyVG9vbGJhclJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItZmllbGQnKTtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRmlsdGVyRmllbGRIYW5kbGVyKGZpbHRlckZpZWxkcyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkcm9wZG93bkZpbHRlckZpZWxkcyA9IHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlci1maWVsZCcpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRGaWx0ZXJGaWVsZEhhbmRsZXIoZHJvcGRvd25GaWx0ZXJGaWVsZHMsIGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJpbmRGaWx0ZXJGaWVsZEhhbmRsZXIoZmlsdGVyRmllbGRzOiBhbnksIGhpZGVQYW5lbCA9IHRydWUpIHtcclxuICAgICAgICBpZiAoZmlsdGVyRmllbGRzICYmIGZpbHRlckZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgZmlsdGVyRmllbGRzLmZvckVhY2goZmYgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIubGlzdGVuKGZmLCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVGaWx0ZXJGaWVsZChmZiwgaGlkZVBhbmVsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVGaWx0ZXJGaWVsZChmZjogYW55LCBoaWRlUGFuZWwgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgZmllbGQgPSBmZi5jbGFzc0xpc3RbMV0ucmVwbGFjZSgnZmlsdGVyLWNvbHVtbi0nLCAnJyk7XHJcbiAgICAgICAgLy8gZGVsZXRlIHRoaXMuZGcuY29uZGl0aW9uc1tmaWVsZF07XHJcbiAgICAgICAgZmYucmVtb3ZlKCk7XHJcbiAgICAgICAgaWYgKGhpZGVQYW5lbCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWx0ZXJQYW5lbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUV4cGFuZFN0YXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGZycy5yZW1vdmVGaWx0ZXJGaWVsZChmaWVsZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVFeHBhbmRTdGF0ZSgpIHtcclxuICAgICAgICB0aGlzLnNob3dFeHBhbmQgPSB0aGlzLmlzU2hvd0V4cGFuZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzU2hvd0V4cGFuZCgpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZmlsdGVyVGV4dENvbnRhaW5lcldpZHRoID4gdGhpcy5maWx0ZXJUZXh0UmVhbFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsdGVyVGV4dFJlYWxXaWR0aCA+IHRoaXMuZmlsdGVyVGV4dENvbnRhaW5lcldpZHRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJGaWx0ZXIoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuICAgICAgICB0aGlzLmRncy5vbkNsZWFyRmlsdGVyKCk7XHJcbiAgICAgICAgdGhpcy5kZ3Mub25GaWx0ZXJDaGFuZ2VkLmVtaXQoe30pO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICByZWZyZXNoRmlsdGVyKCRldmVudCkge1xyXG4gICAgICAgIHRoaXMuZGcuZmlsdGVyRGF0YSgpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93RmlsdGVyVGV4dFBhbmVsKCkge1xyXG4gICAgICAgIHRoaXMub3BlbkZpbHRlclBhbmVsID0gIXRoaXMub3BlbkZpbHRlclBhbmVsO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
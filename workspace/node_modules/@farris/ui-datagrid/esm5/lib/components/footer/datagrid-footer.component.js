/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { takeUntil } from 'rxjs/operators';
import { DatagridComponent } from './../../datagrid.component';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-12 15:01:21
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-09 15:24:45
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, ElementRef, Renderer2, ViewChild, Injector, Inject, forwardRef, ChangeDetectorRef } from '@angular/core';
import { DatagridService } from '../../services/datagrid.service';
import { FIXED_LEFT_SHADOW_CLS, FIXED_RIGHT_SHADOW_CLS, SCROLL_X_ACTION, SCROLL_X_REACH_END_ACTION, SCROLL_X_REACH_START_ACTION } from '../../types/constant';
import { Subject } from 'rxjs';
var DatagridFooterComponent = /** @class */ (function () {
    function DatagridFooterComponent(render, injector, dg) {
        this.render = render;
        this.injector = injector;
        this.dg = dg;
        this._footerData = [];
        /**
         * 显示位置，默认为 底部
         */
        this.position = 'bottom';
        /**
         * 是否有左侧固定列
         */
        this.hasFixedColumns = false;
        this.fast = false;
        this.scrollX = 0;
        this.showShadowCls = false;
        this.rightFixedColumnWidth = 0;
        this.cdRef = null;
        this.destroy$ = new Subject();
        this.dg = this.injector.get(DatagridComponent);
        this.dgs = this.injector.get(DatagridService);
        this.cdRef = this.injector.get(ChangeDetectorRef);
    }
    Object.defineProperty(DatagridFooterComponent.prototype, "data", {
        get: /**
         * @return {?}
         */
        function () {
            return this._footerData;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._footerData = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DatagridFooterComponent.prototype, "fr", {
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val) {
                this.fixedRight = val;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    DatagridFooterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.scrollEvents();
        this.renderFooterStyle();
        this.setFooterPosition(false);
        this.rightFixedColumnWidth = this.getRightFixedColWidth();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    DatagridFooterComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.position) {
            this.setFooterPosition(true);
        }
        if (changes.columnsGroup && !changes.columnsGroup.isFirstChange()) {
            this.rightFixedColumnWidth = this.getRightFixedColWidth();
        }
    };
    /**
     * @return {?}
     */
    DatagridFooterComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy$.next();
        this.destroy$.complete();
        if (this.scrollXSubscription) {
            this.scrollXSubscription.unsubscribe();
            this.scrollXSubscription = null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFooterComponent.prototype.scrollEvents = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.dgs.showGridHeader.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} hh
         * @return {?}
         */
        function (hh) {
            _this.setFooterPosition(false);
        }));
        this.scrollXSubscription = this.dgs.scorll$.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            _this.scrollX = d.x;
            if (_this.fast) {
                if (d.type === SCROLL_X_ACTION && _this.footerBody2) {
                    _this.footerBody2.nativeElement.scrollLeft = d.x;
                }
            }
            else {
                if (d.type === SCROLL_X_ACTION || d.type === SCROLL_X_REACH_END_ACTION || d.type === SCROLL_X_REACH_START_ACTION) {
                    if (!_this.dg.footerTemplate) {
                        _this.render.setStyle(_this.footerBody.nativeElement, 'transform', "translate3d(-" + d.x + "px, 0px, 0px)");
                        if (_this.fixedLeft) {
                            if (d.x) {
                                _this.render.addClass(_this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                            }
                            else {
                                _this.render.removeClass(_this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                            }
                        }
                    }
                }
                if (d.type === SCROLL_X_REACH_START_ACTION) {
                    if (_this.fixedLeft) {
                        _this.render.removeClass(_this.fixedLeft.nativeElement, FIXED_LEFT_SHADOW_CLS);
                    }
                }
            }
        }));
        if (!this.fast) {
            this.dgs.showFixedShadow.pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                if (_this.fixedRight) {
                    _this.setFixedColumnPosition(e.showRightShadow, e.x);
                }
            }));
            this.dgs.scrollbarUpdate.pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} ps
             * @return {?}
             */
            function (ps) {
                // const rw = ps.rightWidth || 0;
                // if (!rw) {
                //     this.rightFixedColumnWidth = this.getRightFixedColWidth(ps.scrollbarRef);
                // } else {
                //     this.rightFixedColumnWidth = rw;
                // }
                _this.rightFixedColumnWidth = _this.getRightFixedColWidth(ps.scrollbarRef);
                if (_this.fixedRight) {
                    _this.setFixedColumnPosition(ps.showRightShadow, 0);
                }
                if (_this.cdRef) {
                    _this.cdRef.detectChanges();
                }
            }));
        }
    };
    /**
     * @private
     * @param {?=} ps
     * @return {?}
     */
    DatagridFooterComponent.prototype.getRightFixedColWidth = /**
     * @private
     * @param {?=} ps
     * @return {?}
     */
    function (ps) {
        if (ps === void 0) { ps = null; }
        if (!this.columnsGroup) {
            return 0;
        }
        /** @type {?} */
        var w = this.columnsGroup.rightFixedWidth;
        ps = this.dg.scrollInstance ? this.dg.scrollInstance.instance : null;
        if (ps && ps.scrollbarYActive && this.dg.scrollBarShowMode === 'allways') {
            return w += 18;
        }
        return w;
    };
    /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    DatagridFooterComponent.prototype.setFooterPosition = /**
     * @private
     * @param {?=} emit
     * @return {?}
     */
    function (emit) {
        if (emit === void 0) { emit = true; }
        if (this.position === 'bottom') {
            /** @type {?} */
            var positionBottom = 0;
            if (this.dg.pagination) {
                positionBottom = this.dg.pagerHeight || 40;
            }
            this.render.removeStyle(this.footerContainer.nativeElement, 'top');
            this.render.setStyle(this.footerContainer.nativeElement, 'bottom', positionBottom + "px");
        }
        if (this.position === 'top') {
            /** @type {?} */
            var positionTop = 0;
            if (this.dg.showHeader) {
                positionTop = this.dg.realHeaderHeight || 35;
            }
            if (this.dg.showRowGroupPanel) {
                positionTop += this.dg.rowGroupPanelHeight;
            }
            if (this.dg.showFilterBar) {
                positionTop += this.dg.filterBarHeight;
            }
            this.render.removeStyle(this.footerContainer.nativeElement, 'bottom');
            this.render.setStyle(this.footerContainer.nativeElement, 'top', positionTop + "px");
        }
        if (emit) {
            this.dgs.footerPositionChanged.emit();
        }
    };
    /**
     * @private
     * @return {?}
     */
    DatagridFooterComponent.prototype.renderFooterStyle = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.dg.footerStyler) {
            /** @type {?} */
            var trStyleAndCls = this.dgs.getCustomStyle(this.dg.footerStyler, null);
            /** @type {?} */
            var cssRuleID = this.dg.customStyleKey() + " .f-datagrid-footer";
            /** @type {?} */
            var cssRuleId2 = this.dg.customStyleKey() + " .f-datagrid-footer .f-datagrid-body-fixed-left," + this.dg.customStyleKey() + " .f-datagrid-footer .f-datagrid-body-fixed-right";
            /** @type {?} */
            var cssRuleId3 = this.dg.customStyleKey() + ".f-datagrid-fast .f-datagrid-cell.f-datagrid-fast__fixed-left," + this.dg.customStyleKey() + ".f-datagrid-fast .f-datagrid-cell.f-datagrid-fast__fixed-right";
            if (trStyleAndCls && Object.keys(trStyleAndCls).length) {
                /** @type {?} */
                var cssRule = [];
                if (trStyleAndCls.style) {
                    cssRule.push(cssRuleID + " " + JSON.stringify(trStyleAndCls.style));
                    cssRule.push(cssRuleId2 + " " + JSON.stringify(trStyleAndCls.style));
                    if (this.fast) {
                        cssRule.push(cssRuleId3 + " " + JSON.stringify(trStyleAndCls.style));
                    }
                }
                this.dgs.appendCssRules(cssRule);
                // this.dg.renderCustomStyle(trStyleAndCls, this.footerContainer.nativeElement, cssRule);
            }
            else {
                this.dgs.removeCssRule([cssRuleID, cssRuleId2]);
            }
        }
    };
    /**
     * @param {?} isShow
     * @param {?} scrollLeft
     * @return {?}
     */
    DatagridFooterComponent.prototype.setFixedColumnPosition = /**
     * @param {?} isShow
     * @param {?} scrollLeft
     * @return {?}
     */
    function (isShow, scrollLeft) {
        this.showShadowCls = isShow;
        /** @type {?} */
        var method = isShow ? 'addClass' : 'removeClass';
        this.render[method](this.fixedRight.nativeElement, FIXED_RIGHT_SHADOW_CLS);
        /** @type {?} */
        var realWidth = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth + this.rightFixedColumnWidth;
        /** @type {?} */
        var gridWidth = this.dg.width;
        /** @type {?} */
        var l = this.dg.width - (this.dg.showBorder ? 2 : 0) - this.rightFixedColumnWidth;
        if (gridWidth > realWidth) {
            l = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth;
            // if (this.dg.showBorder) {
            //     l-= 2;
            // }
        }
        this.render.setStyle(this.fixedRight.nativeElement, 'left', l + 'px');
    };
    DatagridFooterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'datagrid-footer',
                    template: "<!--\r\n * @Author: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @Date: 2019-08-12 15:02:10\r\n * @LastEditors: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @LastEditTime: 2019-10-31 14:50:47\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n -->\r\n\r\n <ng-template #footer_content_template_fast let-columns let-left=\"fixedLeft\" let-right=\"fixedRight\">\r\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border:0;\" class=\"f-datagrid-rows\" [style.width.px]=\"columnsGroup?.normalWidth\" >\r\n        <colgroup>\r\n            <col [style.width.px]=\"dg.checkboxColumnWidth || 36\" *ngIf=\"dg.showCheckbox\"/>\r\n            <col [width]=\"dg.lineNumberWidth + 'px'\" *ngIf=\"dg.showLineNumber\"/>\r\n            <col *ngFor=\"let col of columns\" [width]=\"col.width + 'px'\"/>\r\n        </colgroup>\r\n        <tbody>\r\n            <tr #tr class=\"f-datagrid-body-row f-datagrid-footer-row\"\r\n                *ngFor=\"let row of data;let rowIndex = index;trackBy: dg.trackByRows\" \r\n                [attr.index]=\"rowIndex\">\r\n\r\n                <td *ngIf=\"dg.showCheckbox\" class=\"f-datagrid-cell f-datagrid-cell-checkbox\" style=\"text-align: center; left: 0\"\r\n                [class.f-datagrid-fast__fixed-left]=\"dg.fast\" [class.l-shadow-col]=\"!dg.showLineNumber && !hasFixedColumns\"></td>\r\n                <td *ngIf=\"dg.showLineNumber\" class=\"f-datagrid-cell f-datagrid-cell-rownumber\" \r\n                [class.f-datagrid-fast__fixed-left]=\"dg.fast\"  [style.left.px]=\"dg.showCheckbox ? 36: 0\" [class.l-shadow-col]=\"!hasFixedColumns\"></td>\r\n\r\n                <td class=\"f-datagrid-cell {{ 'footer-td-'+ col.field }}\"\r\n                    [style.width.px]=\"col.width\"\r\n                    [attr.colspan]=\"col.footer?.colspan || 1\"\r\n                    [style.display]=\"col.footer?.visible === false ? 'none': ''\"\r\n                    [attr.field]=\"col.field\" [attr.align]=\"col.footer?.align || col.align\"\r\n                    *ngFor=\"let col of columns; let ci = index;\"\r\n                    footer-cell-styler [column]=\"col\" [rowData]=\"row\" [rowIndex]=\"rowIndex\"\r\n                    [class.f-datagrid-fast__fixed-left]=\" col.fixed && col.fixed === 'left'\"\r\n                    [class.f-datagrid-fast__fixed-right]=\" col.fixed && col.fixed === 'right'\"\r\n                    [class.r-shadow-col]=\"col.rightShadowCol\"\r\n                    [class.l-shadow-col]=\"col.leftShadowCol\">\r\n                    <div class=\"f-datagrid-cell-content\" style=\"width: 100%\">\r\n                        <span *ngIf=\"col.footer && col.footer.formatter\" [innerHtml]=\"col | formatCellData: row : false: true | safe: 'html'\"></span>\r\n                        <span *ngIf=\"!col.footer || !col.footer.formatter\">{{ col | formatCellData: row : false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</ng-template>\r\n<ng-template #footer_content_template let-columns let-left=\"fixedLeft\" let-right=\"fixedRight\">\r\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border:0;height: 100%;\" class=\"f-datagrid-rows\" [style.width.px]=\"right? columnsGroup?.rightFixedWidth: left? columnsGroup?.leftFixedWidth: columnsGroup?.normalWidth\">\r\n        <colgroup>\r\n            <col [style.width.px]=\"dg.checkboxColumnWidth || 36\" *ngIf=\"dg.showCheckbox && left\"/>\r\n            <col [width]=\"dg.lineNumberWidth + 'px'\" *ngIf=\"dg.showLineNumber && left\"/>\r\n            <col *ngFor=\"let col of columns\" [width]=\"col.width + 'px'\"/>\r\n        </colgroup>\r\n        <tbody>\r\n            <tr #tr class=\"f-datagrid-body-row f-datagrid-footer-row\"\r\n                *ngFor=\"let row of data;let rowIndex = index;trackBy: dg.trackByRows\" \r\n                [attr.index]=\"rowIndex\">\r\n\r\n                <td *ngIf=\"dg.showCheckbox && left\" class=\"f-datagrid-cell f-datagrid-cell-checkbox\" style=\"text-align: center\"></td>\r\n                <td *ngIf=\"dg.showLineNumber  && left\" class=\"f-datagrid-cell f-datagrid-cell-rownumber\" ></td>\r\n\r\n                <td class=\"f-datagrid-cell {{ 'footer-td-'+ col.field }}\"\r\n                    [style.width.px]=\"col.width\"\r\n                    [attr.colspan]=\"col.footer?.colspan || 1\"\r\n                    [style.display]=\"col.footer?.visible === false ? 'none': ''\"\r\n                    [attr.field]=\"col.field\" [attr.align]=\"col.footer?.align || col.align\"\r\n                    *ngFor=\"let col of columns; let ci = index;\"\r\n                    footer-cell-styler [column]=\"col\" [rowData]=\"row\" [rowIndex]=\"rowIndex\">\r\n                    <div class=\"f-datagrid-cell-content\" style=\"width: 100%\">\r\n                        <span class=\"f-datagrid-footer-cell\" *ngIf=\"col.footer && col.footer.formatter\" [innerHtml]=\"col | formatCellData: row : false: true | safe: 'html'\"></span>\r\n                        <span class=\"f-datagrid-footer-cell\" *ngIf=\"!col.footer || !col.footer.formatter\">{{ col | formatCellData: row : false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</ng-template>\r\n\r\n<div #footerContainer class=\"f-datagrid-footer\" [style.height.px]=\"height\" style=\"overflow: hidden;\"\r\n    [style.width.px]=\"dg.width\"\r\n    [class.f-datagrid-footer-top]=\"position === 'top'\" [class.f-datagrid-footer-bottom]=\"position === 'bottom'\"\r\n    component-template [ctx]=\"{ footerData: data }\" [cmpRef]=\"dg.footerComponentType\"\r\n    [style.border-radius]=\"position === 'top'? '0': '0 0 7px 7px'\">\r\n    <ng-container *ngIf=\"!dg.footerTemplate && !dg.footerComponentType\">\r\n        \r\n        <div #fixedLeft class=\"f-datagrid-body-fixed-left\" \r\n            [style.width.px]=\"columnsGroup?.leftFixedWidth\" style=\"height: 100%;\"\r\n            *ngIf=\"!fast && (columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox) \">\r\n\r\n            <ng-container *ngTemplateOutlet=\"footer_content_template; context: {$implicit: columnsGroup?.leftFixed, fixedLeft: true}\"></ng-container>\r\n            \r\n        </div>\r\n\r\n        <div #fixedRight class=\"f-datagrid-body-fixed-right\" style=\"position: absolute;border: 0;height: 100%;\"\r\n            [style.width.px]=\"dg.showBorder?  rightFixedColumnWidth : rightFixedColumnWidth + 1\" \r\n            *ngIf=\"!fast && columnsGroup?.rightFixed && columnsGroup?.rightFixed.length\">\r\n\r\n            <ng-container *ngTemplateOutlet=\"footer_content_template; context: {$implicit: columnsGroup?.rightFixed, fixedRight: true}\"></ng-container>\r\n            \r\n        </div>\r\n\r\n        <div #footerBody class=\"f-datagrid-footer-rows\" style=\"position: absolute; height: 100%;\" *ngIf=\"!fast\"\r\n            [style.left.px]=\"columnsGroup?.leftFixedWidth\" [style.width.px]=\"columnsGroup?.normalWidth\" >\r\n            <ng-container *ngTemplateOutlet=\"footer_content_template; context: {$implicit: columnsGroup?.normalColumns}\"></ng-container>\r\n        </div>\r\n\r\n\r\n        <div #footerBody2 class=\"f-datagrid-footer-rows\" style=\"position: absolute;width: 100%\" *ngIf=\"fast\">\r\n            <ng-container *ngTemplateOutlet=\"footer_content_template_fast; context: {$implicit: columnsGroup?.columns}\"></ng-container>\r\n        </div>\r\n\r\n\r\n    </ng-container>\r\n\r\n\r\n    <ng-container *ngIf=\"dg.footerTemplate && !dg.footerComponentType\" [ngTemplateOutlet]=\"dg.footerTemplate\" [ngTemplateOutletContext]=\"{footerData: data }\" ></ng-container>\r\n    \r\n</div>"
                }] }
    ];
    /** @nocollapse */
    DatagridFooterComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: Injector },
        { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return DatagridComponent; })),] }] }
    ]; };
    DatagridFooterComponent.propDecorators = {
        data: [{ type: Input }],
        height: [{ type: Input }],
        width: [{ type: Input }],
        columns: [{ type: Input }],
        columnsGroup: [{ type: Input }],
        position: [{ type: Input }],
        hasFixedColumns: [{ type: Input }],
        fast: [{ type: Input }],
        footerContainer: [{ type: ViewChild, args: ['footerContainer',] }],
        footerBody: [{ type: ViewChild, args: ['footerBody',] }],
        footerBody2: [{ type: ViewChild, args: ['footerBody2',] }],
        fixedLeft: [{ type: ViewChild, args: ['fixedLeft',] }],
        fr: [{ type: ViewChild, args: ['fixedRight',] }]
    };
    return DatagridFooterComponent;
}());
export { DatagridFooterComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype._footerData;
    /** @type {?} */
    DatagridFooterComponent.prototype.height;
    /** @type {?} */
    DatagridFooterComponent.prototype.width;
    /** @type {?} */
    DatagridFooterComponent.prototype.columns;
    /** @type {?} */
    DatagridFooterComponent.prototype.columnsGroup;
    /**
     * 显示位置，默认为 底部
     * @type {?}
     */
    DatagridFooterComponent.prototype.position;
    /**
     * 是否有左侧固定列
     * @type {?}
     */
    DatagridFooterComponent.prototype.hasFixedColumns;
    /** @type {?} */
    DatagridFooterComponent.prototype.fast;
    /** @type {?} */
    DatagridFooterComponent.prototype.footerContainer;
    /** @type {?} */
    DatagridFooterComponent.prototype.footerBody;
    /** @type {?} */
    DatagridFooterComponent.prototype.footerBody2;
    /** @type {?} */
    DatagridFooterComponent.prototype.fixedLeft;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.fixedRight;
    /** @type {?} */
    DatagridFooterComponent.prototype.scrollXSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.scrollX;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.showShadowCls;
    /** @type {?} */
    DatagridFooterComponent.prototype.rightFixedColumnWidth;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.cdRef;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridFooterComponent.prototype.injector;
    /** @type {?} */
    DatagridFooterComponent.prototype.dg;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZm9vdGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9mb290ZXIvZGF0YWdyaWQtZm9vdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDOzs7Ozs7Ozs7QUFTL0QsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQWEsUUFBUSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQTRCLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2pMLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsc0JBQXNCLEVBQUUsZUFBZSxFQUFFLHlCQUF5QixFQUFFLDJCQUEyQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUosT0FBTyxFQUFnQixPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFN0M7SUEwQ0ksaUNBQ1ksTUFBaUIsRUFBVSxRQUFrQixFQUNELEVBQXFCO1FBRGpFLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ0QsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUF2Q3JFLGdCQUFXLEdBQUcsRUFBRSxDQUFDOzs7O1FBY2hCLGFBQVEsR0FBcUIsUUFBUSxDQUFDOzs7O1FBRXRDLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLFNBQUksR0FBRyxLQUFLLENBQUM7UUFlZCxZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ1osa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFDOUIsMEJBQXFCLEdBQUcsQ0FBQyxDQUFDO1FBQ2xC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QzFCLHdDQUF3Qzs7Ozs7SUFDeEMsMkNBQWlDOzs7OztJQUU3Qix5Q0FBeUI7Ozs7O0lBQUUsMkNBQTBCOztJQUNyRCxxQ0FBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG4vKlxyXG4gKiBAQXV0aG9yOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBEYXRlOiAyMDE5LTA4LTEyIDE1OjAxOjIxXHJcbiAqIEBMYXN0RWRpdG9yczog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBATGFzdEVkaXRUaW1lOiAyMDE5LTExLTA5IDE1OjI0OjQ1XHJcbiAqIEBRUTogMTA1NTgxODIzOVxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBPbkRlc3Ryb3ksIEluamVjdG9yLCBJbmplY3QsIGZvcndhcmRSZWYsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgQ2hhbmdlRGV0ZWN0b3JSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvZGF0YWdyaWQuc2VydmljZSc7XHJcbmltcG9ydCB7IEZJWEVEX0xFRlRfU0hBRE9XX0NMUywgRklYRURfUklHSFRfU0hBRE9XX0NMUywgU0NST0xMX1hfQUNUSU9OLCBTQ1JPTExfWF9SRUFDSF9FTkRfQUNUSU9OLCBTQ1JPTExfWF9SRUFDSF9TVEFSVF9BQ1RJT04gfSBmcm9tICcuLi8uLi90eXBlcy9jb25zdGFudCc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2RhdGFncmlkLWZvb3RlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZGF0YWdyaWQtZm9vdGVyLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRGb290ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuICAgIHByaXZhdGUgX2Zvb3RlckRhdGEgPSBbXTtcclxuICAgIEBJbnB1dCgpIGdldCBkYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9mb290ZXJEYXRhO1xyXG4gICAgfVxyXG4gICAgc2V0IGRhdGEodmFsOiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMuX2Zvb3RlckRhdGEgPSB2YWw7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCkgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICBASW5wdXQoKSB3aWR0aDogbnVtYmVyO1xyXG4gICAgQElucHV0KCkgY29sdW1uczogYW55W107XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zR3JvdXA6IGFueTtcclxuXHJcbiAgICAvKiog5pi+56S65L2N572u77yM6buY6K6k5Li6IOW6lemDqCAqL1xyXG4gICAgQElucHV0KCkgcG9zaXRpb246ICd0b3AnIHwgJ2JvdHRvbScgPSAnYm90dG9tJztcclxuICAgIC8qKiDmmK/lkKbmnInlt6bkvqflm7rlrprliJcgKi9cclxuICAgIEBJbnB1dCgpIGhhc0ZpeGVkQ29sdW1ucyA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZmFzdCA9IGZhbHNlO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2Zvb3RlckNvbnRhaW5lcicpIGZvb3RlckNvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2Zvb3RlckJvZHknKSBmb290ZXJCb2R5OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZm9vdGVyQm9keTInKSBmb290ZXJCb2R5MjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpeGVkTGVmdCcpIGZpeGVkTGVmdDogRWxlbWVudFJlZjtcclxuICAgIHByaXZhdGUgZml4ZWRSaWdodDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpeGVkUmlnaHQnKSBzZXQgZnIodmFsKSB7XHJcbiAgICAgICAgaWYgKHZhbCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpeGVkUmlnaHQgPSB2YWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2Nyb2xsWFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIHByaXZhdGUgZGdzOiBEYXRhZ3JpZFNlcnZpY2U7XHJcbiAgICBwcml2YXRlIHNjcm9sbFggPSAwO1xyXG4gICAgcHJpdmF0ZSBzaG93U2hhZG93Q2xzID0gZmFsc2U7XHJcbiAgICByaWdodEZpeGVkQ29sdW1uV2lkdGggPSAwO1xyXG4gICAgcHJpdmF0ZSBjZFJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRDb21wb25lbnQpKSBwdWJsaWMgZGc6IERhdGFncmlkQ29tcG9uZW50XHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmRnID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRDb21wb25lbnQpO1xyXG4gICAgICAgIHRoaXMuZGdzID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmNkUmVmID0gdGhpcy5pbmplY3Rvci5nZXQoQ2hhbmdlRGV0ZWN0b3JSZWYpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNjcm9sbEV2ZW50cygpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyRm9vdGVyU3R5bGUoKTtcclxuICAgICAgICB0aGlzLnNldEZvb3RlclBvc2l0aW9uKGZhbHNlKTtcclxuXHJcbiAgICAgICAgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGggPSB0aGlzLmdldFJpZ2h0Rml4ZWRDb2xXaWR0aCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5wb3NpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnNldEZvb3RlclBvc2l0aW9uKHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMuY29sdW1uc0dyb3VwICYmICFjaGFuZ2VzLmNvbHVtbnNHcm91cC5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGggPSB0aGlzLmdldFJpZ2h0Rml4ZWRDb2xXaWR0aCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNjcm9sbFhTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxYU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsWFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2Nyb2xsRXZlbnRzKCkge1xyXG4gICAgICAgIHRoaXMuZGdzLnNob3dHcmlkSGVhZGVyLnBpcGUoXHJcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKGhoID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRGb290ZXJQb3NpdGlvbihmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2Nyb2xsWFN1YnNjcmlwdGlvbiA9IHRoaXMuZGdzLnNjb3JsbCQucGlwZShcclxuICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKGQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFggPSBkLng7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5mYXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZC50eXBlID09PSBTQ1JPTExfWF9BQ1RJT04gJiYgdGhpcy5mb290ZXJCb2R5Mikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZm9vdGVyQm9keTIubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0ID0gZC54O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgIHtcclxuICAgICAgICAgICAgICAgIGlmIChkLnR5cGUgPT09IFNDUk9MTF9YX0FDVElPTiB8fCBkLnR5cGUgPT09IFNDUk9MTF9YX1JFQUNIX0VORF9BQ1RJT04gfHwgZC50eXBlID09PSBTQ1JPTExfWF9SRUFDSF9TVEFSVF9BQ1RJT04pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGcuZm9vdGVyVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5mb290ZXJCb2R5Lm5hdGl2ZUVsZW1lbnQsICAndHJhbnNmb3JtJywgYHRyYW5zbGF0ZTNkKC0ke2QueH1weCwgMHB4LCAwcHgpYCApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZml4ZWRMZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC54KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5maXhlZExlZnQubmF0aXZlRWxlbWVudCwgRklYRURfTEVGVF9TSEFET1dfQ0xTKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5maXhlZExlZnQubmF0aXZlRWxlbWVudCwgRklYRURfTEVGVF9TSEFET1dfQ0xTKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZC50eXBlID09PSBTQ1JPTExfWF9SRUFDSF9TVEFSVF9BQ1RJT04pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5maXhlZExlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5maXhlZExlZnQubmF0aXZlRWxlbWVudCwgRklYRURfTEVGVF9TSEFET1dfQ0xTKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5mYXN0KSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRncy5zaG93Rml4ZWRTaGFkb3cucGlwZShcclxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRGaXhlZENvbHVtblBvc2l0aW9uKGUuc2hvd1JpZ2h0U2hhZG93LCBlLngpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICB0aGlzLmRncy5zY3JvbGxiYXJVcGRhdGUucGlwZShcclxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgocHM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc3QgcncgPSBwcy5yaWdodFdpZHRoIHx8IDA7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiAoIXJ3KSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGggPSB0aGlzLmdldFJpZ2h0Rml4ZWRDb2xXaWR0aChwcy5zY3JvbGxiYXJSZWYpO1xyXG4gICAgICAgICAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnJpZ2h0Rml4ZWRDb2x1bW5XaWR0aCA9IHJ3O1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkQ29sdW1uV2lkdGggPSB0aGlzLmdldFJpZ2h0Rml4ZWRDb2xXaWR0aChwcy5zY3JvbGxiYXJSZWYpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZml4ZWRSaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Rml4ZWRDb2x1bW5Qb3NpdGlvbihwcy5zaG93UmlnaHRTaGFkb3csIDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2RSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmlnaHRGaXhlZENvbFdpZHRoKHBzID0gbnVsbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jb2x1bW5zR3JvdXApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgdyA9IHRoaXMuY29sdW1uc0dyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuICAgICAgICBwcyA9IHRoaXMuZGcuc2Nyb2xsSW5zdGFuY2U/IHRoaXMuZGcuc2Nyb2xsSW5zdGFuY2UuaW5zdGFuY2UgOiBudWxsO1xyXG5cclxuICAgICAgICBpZiAocHMgJiYgcHMuc2Nyb2xsYmFyWUFjdGl2ZSAmJiB0aGlzLmRnLnNjcm9sbEJhclNob3dNb2RlID09PSAnYWxsd2F5cycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHcgKz0gMTg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB3O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Rm9vdGVyUG9zaXRpb24oZW1pdCA9IHRydWUpIHtcclxuICAgICAgICBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ2JvdHRvbScpIHtcclxuICAgICAgICAgICAgbGV0IHBvc2l0aW9uQm90dG9tID0gMDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb25Cb3R0b20gPSB0aGlzLmRnLnBhZ2VySGVpZ2h0IHx8IDQwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHRoaXMuZm9vdGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICd0b3AnKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5mb290ZXJDb250YWluZXIubmF0aXZlRWxlbWVudCwgJ2JvdHRvbScsIGAke3Bvc2l0aW9uQm90dG9tfXB4YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBvc2l0aW9uID09PSAndG9wJykge1xyXG4gICAgICAgICAgICBsZXQgcG9zaXRpb25Ub3AgPSAwO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zaG93SGVhZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvblRvcCA9IHRoaXMuZGcucmVhbEhlYWRlckhlaWdodCB8fCAzNTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2hvd1Jvd0dyb3VwUGFuZWwpIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uVG9wICs9IHRoaXMuZGcucm93R3JvdXBQYW5lbEhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0ZpbHRlckJhcikge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb25Ub3AgKz0gdGhpcy5kZy5maWx0ZXJCYXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZVN0eWxlKHRoaXMuZm9vdGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQsICdib3R0b20nKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUodGhpcy5mb290ZXJDb250YWluZXIubmF0aXZlRWxlbWVudCwgJ3RvcCcsIGAke3Bvc2l0aW9uVG9wfXB4YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbWl0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLmZvb3RlclBvc2l0aW9uQ2hhbmdlZC5lbWl0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVuZGVyRm9vdGVyU3R5bGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZm9vdGVyU3R5bGVyKSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0clN0eWxlQW5kQ2xzID0gdGhpcy5kZ3MuZ2V0Q3VzdG9tU3R5bGUodGhpcy5kZy5mb290ZXJTdHlsZXIsIG51bGwpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY3NzUnVsZUlEID0gYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1mb290ZXJgO1xyXG4gICAgICAgICAgICBjb25zdCBjc3NSdWxlSWQyID0gYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1mb290ZXIgLmYtZGF0YWdyaWQtYm9keS1maXhlZC1sZWZ0LCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuZi1kYXRhZ3JpZC1mb290ZXIgLmYtZGF0YWdyaWQtYm9keS1maXhlZC1yaWdodGA7XHJcbiAgICAgICAgICAgIGNvbnN0IGNzc1J1bGVJZDMgPSBgJHt0aGlzLmRnLmN1c3RvbVN0eWxlS2V5KCl9LmYtZGF0YWdyaWQtZmFzdCAuZi1kYXRhZ3JpZC1jZWxsLmYtZGF0YWdyaWQtZmFzdF9fZml4ZWQtbGVmdCwke3RoaXMuZGcuY3VzdG9tU3R5bGVLZXkoKX0uZi1kYXRhZ3JpZC1mYXN0IC5mLWRhdGFncmlkLWNlbGwuZi1kYXRhZ3JpZC1mYXN0X19maXhlZC1yaWdodGA7XHJcblxyXG4gICAgICAgICAgICBpZiAodHJTdHlsZUFuZENscyAmJiBPYmplY3Qua2V5cyh0clN0eWxlQW5kQ2xzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNzc1J1bGUgPSBbXTtcclxuICAgICAgICAgICAgICAgIGlmICh0clN0eWxlQW5kQ2xzLnN0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3NzUnVsZS5wdXNoKGAke2Nzc1J1bGVJRH0gJHtKU09OLnN0cmluZ2lmeSh0clN0eWxlQW5kQ2xzLnN0eWxlKX1gKTtcclxuICAgICAgICAgICAgICAgICAgICBjc3NSdWxlLnB1c2goYCR7Y3NzUnVsZUlkMn0gJHtKU09OLnN0cmluZ2lmeSh0clN0eWxlQW5kQ2xzLnN0eWxlKX1gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmFzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3NSdWxlLnB1c2goYCR7Y3NzUnVsZUlkM30gJHtKU09OLnN0cmluZ2lmeSh0clN0eWxlQW5kQ2xzLnN0eWxlKX1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZ3MuYXBwZW5kQ3NzUnVsZXMoY3NzUnVsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5kZy5yZW5kZXJDdXN0b21TdHlsZSh0clN0eWxlQW5kQ2xzLCB0aGlzLmZvb3RlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LCBjc3NSdWxlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLnJlbW92ZUNzc1J1bGUoW2Nzc1J1bGVJRCwgY3NzUnVsZUlkMl0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBzZXRGaXhlZENvbHVtblBvc2l0aW9uKGlzU2hvdywgc2Nyb2xsTGVmdCkge1xyXG4gICAgICAgIHRoaXMuc2hvd1NoYWRvd0NscyA9IGlzU2hvdztcclxuICAgICAgICBjb25zdCBtZXRob2QgPSBpc1Nob3cgPyAnYWRkQ2xhc3MnIDogJ3JlbW92ZUNsYXNzJztcclxuICAgICAgICB0aGlzLnJlbmRlclttZXRob2RdKHRoaXMuZml4ZWRSaWdodC5uYXRpdmVFbGVtZW50LCBGSVhFRF9SSUdIVF9TSEFET1dfQ0xTKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVhbFdpZHRoID0gdGhpcy5jb2x1bW5zR3JvdXAubGVmdEZpeGVkV2lkdGggKyB0aGlzLmNvbHVtbnNHcm91cC5ub3JtYWxXaWR0aCArIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoO1xyXG4gICAgICAgIGNvbnN0IGdyaWRXaWR0aCA9IHRoaXMuZGcud2lkdGg7XHJcbiAgICAgICAgbGV0IGwgPSB0aGlzLmRnLndpZHRoIC0gKHRoaXMuZGcuc2hvd0JvcmRlciA/IDIgOiAwKSAtIHRoaXMucmlnaHRGaXhlZENvbHVtbldpZHRoO1xyXG4gICAgICAgIGlmIChncmlkV2lkdGggPiByZWFsV2lkdGgpIHtcclxuICAgICAgICAgICAgbCA9IHRoaXMuY29sdW1uc0dyb3VwLmxlZnRGaXhlZFdpZHRoICsgdGhpcy5jb2x1bW5zR3JvdXAubm9ybWFsV2lkdGg7XHJcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLmRnLnNob3dCb3JkZXIpIHtcclxuICAgICAgICAgICAgLy8gICAgIGwtPSAyO1xyXG4gICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmZpeGVkUmlnaHQubmF0aXZlRWxlbWVudCwgJ2xlZnQnLCBsICsgJ3B4Jyk7XHJcbiAgICB9XHJcbn1cclxuIl19
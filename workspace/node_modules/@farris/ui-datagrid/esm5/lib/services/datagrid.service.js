/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*
* @Author: 疯狂秀才(Lucas Huang)
* @Date: 2019-08-06 07:43:53
* @LastEditors: 疯狂秀才(Lucas Huang)
* @LastEditTime: 2019-11-09 20:44:54
* @QQ: 1055818239
* @Version: v0.0.1
*/
import { EventEmitter } from '@angular/core';
import { Subject, BehaviorSubject } from 'rxjs';
import { filter, map, debounceTime } from 'rxjs/operators';
import { IdService } from '@farris/ui-common';
import { Utils } from './../utils/utils';
import { CUSTOM_CELL_CLS, CUSTOM_GROUP_ROW_CLS, CUSTOM_ROW_CLS } from '../types/constant';
var DatagridService = /** @class */ (function () {
    function DatagridService() {
        this.scorllSubject = new Subject();
        this.scrollX = new BehaviorSubject(0);
        this.rowHoverSubject = new Subject();
        this.rowSelectSubject = new Subject();
        this.dataSourceChangedSubject = new Subject();
        /**
         * 编辑单元格
         */
        this.editCellSubject = new Subject();
        /**
         * 选中单元格
         */
        this.selectCellSubject = new Subject();
        /**
         * 结束单元编辑
         */
        this.endCellEdit = new Subject();
        this.changeCheckedRows = new Subject();
        /**
         * 结束行编辑
         */
        // private endRowEdit = new BehaviorSubject(true);
        this.scorll$ = this.scorllSubject.asObservable();
        this.scrollX$ = this.scorll$.pipe(filter((/**
         * @param {?} p
         * @return {?}
         */
        function (p) { return p.type === 'psScrollX'; })), map((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.x; })), debounceTime(50));
        this.scrollY$ = this.scorll$.pipe(filter((/**
         * @param {?} p
         * @return {?}
         */
        function (p) { return p.type === 'psScrollY'; })), map((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.x; })), debounceTime(50));
        this.rowHover$ = this.rowHoverSubject.asObservable();
        this.rowClick$ = this.rowSelectSubject.asObservable();
        this.onDataSourceChange = this.dataSourceChangedSubject.asObservable();
        this.cellEdit$ = this.editCellSubject.asObservable();
        this.endCellEdit$ = this.endCellEdit.asObservable();
        this.checkedRowsTotalChanged$ = this.changeCheckedRows.asObservable();
        this.updateEmptyStyle$ = new EventEmitter();
        this.showGridHeader = new EventEmitter();
        // 取消全选
        this.uncheckAll = new EventEmitter();
        // 全部选中
        this.checkAll = new EventEmitter();
        this.columnResized = new EventEmitter();
        this.rowHeightChanged = new EventEmitter();
        this.loadVirtualData = new EventEmitter();
        /**
         * 显示固定列隐影
         */
        this.showFixedShadow = new EventEmitter();
        // public endRowEdit$ = this.endRowEdit.asObservable();
        this.setSelecedRow = new EventEmitter();
        this.setCheckedRows = new EventEmitter();
        this.scrollToCurrentRow = new EventEmitter();
        this.columnsChanged = new EventEmitter();
        this.cellContentWrapChanged = new EventEmitter();
        this.onFilterChanged = new EventEmitter();
        this.clearFilter = new EventEmitter();
        this.filterTextChange = new EventEmitter();
        this.toggleFilterRow = new EventEmitter();
        this.closeFilterPanel = new EventEmitter();
        this.refreshFooterData = new EventEmitter();
        this.disableHeader = new EventEmitter();
        /**
         * 更新全选复选框状态
         */
        this.changeCheckAllStatus = new EventEmitter();
        this.setScrollbarPosition = new EventEmitter();
        this.smartFilterBarExpand = new EventEmitter();
        this.smartFilterDataChange = new EventEmitter();
        this.scrollbarUpdate = new EventEmitter();
        this.footerPositionChanged = new EventEmitter();
        this.styleElement = null;
        this.commonUtils = null;
        this.idService = null;
        // 单元格编辑器创建完成
        this.cellEditorCreated = new EventEmitter();
        // 单元格编辑器销毁
        this.cellEditorDestory = new EventEmitter();
        // 焦点行切换
        this.focusRowChanged = new EventEmitter();
        this.dataloaded = new EventEmitter();
        this.toggleGroupRow$ = new EventEmitter();
        this.toggleAllGroupRows$ = new EventEmitter();
        // CSS 文本缓存
        this.cssTextCache = [];
        this.groupBy = (/**
         * @param {?} arr
         * @param {?} fn
         * @return {?}
         */
        function (arr, fn) { return arr.map(typeof fn === 'function' ? fn : (/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return Utils.getValue(fn, val); })).reduce((/**
         * @param {?} acc
         * @param {?} val
         * @param {?} i
         * @return {?}
         */
        function (acc, val, i) {
            acc[val] = (acc[val] || []).concat(arr[i]);
            return acc;
        }), {}); });
    }
    /**
     * @param {?} x
     * @param {?} action
     * @return {?}
     */
    DatagridService.prototype.onScrollMove = /**
     * @param {?} x
     * @param {?} action
     * @return {?}
     */
    function (x, action) {
        this.scorllSubject.next({ x: x, type: action });
    };
    /**
     * @return {?}
     */
    DatagridService.prototype.dataSourceChanged = /**
     * @return {?}
     */
    function () {
        this.dataSourceChangedSubject.next();
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?} mouseEnter
     * @return {?}
     */
    DatagridService.prototype.onRowHover = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @param {?} mouseEnter
     * @return {?}
     */
    function (rowIndex, rowData, mouseEnter) {
        this.rowHoverSubject.next({ index: rowIndex, data: rowData, mouseenter: mouseEnter });
    };
    /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    DatagridService.prototype.onRowClick = /**
     * @param {?} rowIndex
     * @param {?} rowData
     * @return {?}
     */
    function (rowIndex, rowData) {
        this.rowSelectSubject.next({ index: rowIndex, data: rowData });
    };
    /**
     * @param {?} tdElement
     * @return {?}
     */
    DatagridService.prototype.onCellEdit = /**
     * @param {?} tdElement
     * @return {?}
     */
    function (tdElement) {
        this.editCellSubject.next(tdElement);
    };
    /**
     * @param {?} cell
     * @return {?}
     */
    DatagridService.prototype.onEndCellEdit = /**
     * @param {?} cell
     * @return {?}
     */
    function (cell) {
        this.endCellEdit.next(cell);
    };
    /**
     * @param {?} cell
     * @return {?}
     */
    DatagridService.prototype.onSelectCell = /**
     * @param {?} cell
     * @return {?}
     */
    function (cell) {
        this.selectCellSubject.next(cell);
    };
    /**
     * @return {?}
     */
    DatagridService.prototype.onCheckedRowsCountChange = /**
     * @return {?}
     */
    function () {
        this.changeCheckedRows.next();
    };
    /**
     * @param {?} rowHeight
     * @return {?}
     */
    DatagridService.prototype.onRowHeightChange = /**
     * @param {?} rowHeight
     * @return {?}
     */
    function (rowHeight) {
        this.rowHeightChanged.emit(rowHeight);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    DatagridService.prototype.onLoadVirtualData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.loadVirtualData.emit({ data: data });
    };
    /**
     * @return {?}
     */
    DatagridService.prototype.onClearFilter = /**
     * @return {?}
     */
    function () {
        this.clearFilter.emit();
        this.filterTextChange.emit('');
    };
    /**
     * @param {?} txt
     * @return {?}
     */
    DatagridService.prototype.onFilterTextChange = /**
     * @param {?} txt
     * @return {?}
     */
    function (txt) {
        this.filterTextChange.emit(txt);
    };
    /**
     * @return {?}
     */
    DatagridService.prototype.restoreScrollbarPosition = /**
     * @return {?}
     */
    function () {
        this.setScrollbarPosition.emit();
    };
    /**
     * @return {?}
     */
    DatagridService.prototype.updateEmptyStyle = /**
     * @return {?}
     */
    function () {
        this.updateEmptyStyle$.emit();
    };
    /**
     * @param {?} data
     * @param {?} mergeFields
     * @return {?}
     */
    DatagridService.prototype.getMergeCellInfo = /**
     * @param {?} data
     * @param {?} mergeFields
     * @return {?}
     */
    function (data, mergeFields) {
        /** @type {?} */
        var result = {};
        /** @type {?} */
        var firstVal = null;
        /** @type {?} */
        var currVal;
        mergeFields.forEach((/**
         * @param {?} f
         * @param {?} i
         * @return {?}
         */
        function (f, i) {
            if (i === 0) {
                data.forEach((/**
                 * @param {?} d
                 * @param {?} j
                 * @return {?}
                 */
                function (d, j) {
                    var _a;
                    /** @type {?} */
                    var item = (_a = {}, _a[f] = { show: true, rowspan: 1 }, _a);
                    if (!result[j]) {
                        result[j] = item;
                    }
                    else {
                        if (!result[j][f]) {
                            result[j] = Object.assign(result[j], item);
                        }
                    }
                    /** @type {?} */
                    var _item = result[j];
                    currVal = d[f];
                    if (firstVal === null || firstVal !== currVal) {
                        firstVal = currVal;
                        _item[f].show = true;
                        _item[f].startIndex = j;
                    }
                    else {
                        /** @type {?} */
                        var strIndex = result[j - 1][f].startIndex;
                        _item[f].startIndex = strIndex;
                        _item[f].show = false;
                        result[strIndex][f].rowspan++;
                    }
                }));
            }
        }));
        return result;
    };
    /**
     * @param {?} data
     * @param {?} field
     * @return {?}
     */
    DatagridService.prototype.getMergeCellInfo0 = /**
     * @param {?} data
     * @param {?} field
     * @return {?}
     */
    function (data, field) {
        /** @type {?} */
        var result = {};
        /** @type {?} */
        var firstVal;
        /** @type {?} */
        var currVal;
        data.forEach((/**
         * @param {?} d
         * @param {?} j
         * @return {?}
         */
        function (d, j) {
            var _a;
            /** @type {?} */
            var item = (_a = {}, _a[field] = { show: true, rowspan: 1, value: '' }, _a);
            if (!result[j]) {
                result[j] = item;
            }
            /** @type {?} */
            var _item = result[j];
            currVal = Utils.getValue(field, d);
            _item[field].value = currVal;
            if (firstVal === undefined || firstVal !== currVal) {
                firstVal = currVal;
                _item[field].show = true;
                _item[field].startIndex = j;
            }
            else {
                /** @type {?} */
                var strIndex = result[j - 1][field].startIndex;
                _item[field].startIndex = strIndex;
                _item[field].show = false;
                result[strIndex][field].rowspan++;
            }
        }));
        return result;
    };
    /**
     * @param {?} data
     * @param {?} mergeFields
     * @return {?}
     */
    DatagridService.prototype.getMergeCellInfo2 = /**
     * @param {?} data
     * @param {?} mergeFields
     * @return {?}
     */
    function (data, mergeFields) {
        /** @type {?} */
        var result = {};
        /** @type {?} */
        var firstVal = null;
        result = this.getMergeCellInfo0(data, mergeFields.splice(0, 1)[0]);
        /** @type {?} */
        var groupData = this.groupBy(data, mergeFields[0]);
        /** @type {?} */
        var groupKeys = Object.keys(groupData);
        /** @type {?} */
        var startRowIndex = 0;
        mergeFields.forEach((/**
         * @param {?} f
         * @param {?} i
         * @return {?}
         */
        function (f, i) {
            groupKeys.forEach((/**
             * @param {?} k
             * @param {?} j
             * @return {?}
             */
            function (k, j) {
                /** @type {?} */
                var currVal;
                groupData[k].forEach((/**
                 * @param {?} d
                 * @param {?} n
                 * @return {?}
                 */
                function (d, n) {
                    var _a;
                    if (result[startRowIndex] && !result[startRowIndex][f]) {
                        result[startRowIndex] = Object.assign(result[startRowIndex], (_a = {}, _a[f] = { show: true, rowspan: 1, value: '' }, _a));
                    }
                    /** @type {?} */
                    var _item = result[startRowIndex];
                    currVal = Utils.getValue(f, d);
                    _item[f].value = currVal;
                    if (firstVal === null || firstVal !== currVal) {
                        firstVal = currVal;
                        _item[f].show = true;
                        _item[f].startIndex = startRowIndex;
                    }
                    else {
                        /** @type {?} */
                        var strIndex = result[startRowIndex - 1][f].startIndex;
                        _item[f].startIndex = strIndex;
                        _item[f].show = false;
                        result[strIndex][f].rowspan++;
                    }
                    startRowIndex++;
                }));
            }));
        }));
        return result;
    };
    /**
     * @param {?} data
     * @param {?} mergeFields
     * @return {?}
     */
    DatagridService.prototype.getMergeCellInfo3 = /**
     * @param {?} data
     * @param {?} mergeFields
     * @return {?}
     */
    function (data, mergeFields) {
        /** @type {?} */
        var result = {};
        /** @type {?} */
        var firstField = mergeFields.splice(0, 1)[0];
        result = this.getMergeCellInfo0(data, firstField);
        /** @type {?} */
        var prevGroupField = firstField;
        // const groupData = this.groupBy(data, firstField);
        // const groupKeys = Object.keys(groupData);
        mergeFields.forEach((/**
         * @param {?} f
         * @param {?} i
         * @return {?}
         */
        function (f, i) {
            /** @type {?} */
            var startRowIndex = 0;
            /** @type {?} */
            var firstVal;
            /** @type {?} */
            var currVal;
            if (i > 0) {
                prevGroupField = mergeFields[i - 1];
            }
            data.forEach((/**
             * @param {?} d
             * @param {?} n
             * @return {?}
             */
            function (d, n) {
                var _a;
                if (result[startRowIndex] && !result[startRowIndex][f]) {
                    result[startRowIndex] = Object.assign(result[startRowIndex], (_a = {}, _a[f] = { show: true, rowspan: 1, value: '' }, _a));
                }
                /** @type {?} */
                var _item = result[startRowIndex];
                currVal = Utils.getValue(f, d);
                _item[f].value = currVal;
                if (startRowIndex > 0) {
                    /** @type {?} */
                    var prevItem_1 = result[startRowIndex - 1];
                    /** @type {?} */
                    var _c = Object.keys(_item).map((/**
                     * @param {?} c
                     * @return {?}
                     */
                    function (c) { return '' + _item[c].value; })).join(',');
                    /** @type {?} */
                    var _p = Object.keys(prevItem_1).map((/**
                     * @param {?} p
                     * @return {?}
                     */
                    function (p) { return '' + prevItem_1[p].value; })).join(',');
                    if (_c !== _p) {
                        firstVal = undefined;
                    }
                }
                if ((firstVal === undefined || firstVal !== currVal)) {
                    firstVal = currVal;
                    _item[f].show = true;
                    _item[f].startIndex = startRowIndex;
                }
                else {
                    /** @type {?} */
                    var startIndex = result[startRowIndex - 1][f].startIndex;
                    _item[f].startIndex = startIndex;
                    _item[f].show = false;
                    result[startIndex][f].rowspan++;
                }
                if (data.length - 1 > startRowIndex) {
                    startRowIndex++;
                }
            }));
        }));
        return result;
    };
    /**
     * @param {?} rowIndex
     * @param {?} field
     * @param {?} mergeCellInfo
     * @return {?}
     */
    DatagridService.prototype.getMergeInfo = /**
     * @param {?} rowIndex
     * @param {?} field
     * @param {?} mergeCellInfo
     * @return {?}
     */
    function (rowIndex, field, mergeCellInfo) {
        if (field && mergeCellInfo && mergeCellInfo[rowIndex] && mergeCellInfo[rowIndex][field]) {
            return mergeCellInfo[rowIndex][field];
        }
        return null;
    };
    /**
     * @return {?}
     */
    DatagridService.prototype.removeStyleSheet = /**
     * @return {?}
     */
    function () {
        if (this.styleElement) {
            this.styleElement.remove();
            this.styleElement = null;
            // 清空缓存
            this.cssTextCache = [];
        }
    };
    /**
     * @param {?} styleSheetId
     * @return {?}
     */
    DatagridService.prototype.createStyleElement = /**
     * @param {?} styleSheetId
     * @return {?}
     */
    function (styleSheetId) {
        this.styleElement = this._createStyleSheet(styleSheetId);
    };
    /**
     * @param {?} rules
     * @return {?}
     */
    DatagridService.prototype.appendCssRules = /**
     * @param {?} rules
     * @return {?}
     */
    function (rules) {
        if (this.styleElement) {
            this._appendCssRules(rules, this.styleElement.sheet);
        }
    };
    /**
     * @param {?} ruleName
     * @return {?}
     */
    DatagridService.prototype.removeCssRule = /**
     * @param {?} ruleName
     * @return {?}
     */
    function (ruleName) {
        var _this = this;
        if (this.styleElement) {
            if (typeof ruleName === 'string') {
                this._removeCssRule(ruleName, this.styleElement.sheet);
                this.cssTextCache = this.cssTextCache.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.indexOf(ruleName) == -1; }));
            }
            else {
                if (Array.isArray(ruleName)) {
                    ruleName.forEach((/**
                     * @param {?} n
                     * @return {?}
                     */
                    function (n) {
                        _this._removeCssRule(n, _this.styleElement.sheet);
                        _this.cssTextCache = _this.cssTextCache.filter((/**
                         * @param {?} n
                         * @return {?}
                         */
                        function (n) { return n.indexOf(n) == -1; }));
                    }));
                }
            }
        }
    };
    /**
     * @private
     * @param {?} styleSheetId
     * @return {?}
     */
    DatagridService.prototype._createStyleSheet = /**
     * @private
     * @param {?} styleSheetId
     * @return {?}
     */
    function (styleSheetId) {
        /** @type {?} */
        var htmlHead = document.querySelector('head');
        /** @type {?} */
        var styleEleId = styleSheetId;
        /** @type {?} */
        var styleElement = null;
        if (document.querySelector('#' + styleEleId)) {
            styleElement = document.querySelector('#' + styleEleId);
            styleElement.innerText = '';
        }
        else {
            styleElement = document.createElement('style');
            styleElement.id = styleEleId;
            styleElement.type = 'text/css';
            htmlHead.appendChild(styleElement);
        }
        return styleElement;
    };
    /**
     * @private
     * @param {?} rules
     * @param {?} styleSheet
     * @return {?}
     */
    DatagridService.prototype._appendCssRules = /**
     * @private
     * @param {?} rules
     * @param {?} styleSheet
     * @return {?}
     */
    function (rules, styleSheet) {
        var e_1, _a;
        /** @type {?} */
        var allCssText = '';
        try {
            for (var rules_1 = tslib_1.__values(rules), rules_1_1 = rules_1.next(); !rules_1_1.done; rules_1_1 = rules_1.next()) {
                var rule = rules_1_1.value;
                /** @type {?} */
                var ruleName = rule.slice(0, rule.indexOf('{')).trim();
                // const removedCssRule = this._removeCssRule(ruleName, styleSheet);
                /** @type {?} */
                var removedCssRule = this._getCssTextBySelector(ruleName, styleSheet);
                /** @type {?} */
                var cssText = '';
                if (removedCssRule && ruleName.indexOf(CUSTOM_CELL_CLS) == -1 && ruleName.indexOf(CUSTOM_GROUP_ROW_CLS) == -1 && ruleName.indexOf(CUSTOM_ROW_CLS) == -1) {
                    cssText += removedCssRule.cssText.slice(removedCssRule.cssText.indexOf('{') + 1, removedCssRule.cssText.indexOf('}'));
                }
                cssText += rule.slice(rule.indexOf('{') + 1, rule.indexOf('}')).replace(/"/g, '').replace(/,/g, ';') + ';';
                /** @type {?} */
                var _newRule = ruleName + "{ " + cssText + " }";
                allCssText += _newRule;
                if (!this.cssTextCache.includes(_newRule)) {
                    // 将合并后CSS文本添加到缓存
                    this.cssTextCache.push(_newRule);
                    if (styleSheet.addRule) {
                        styleSheet.addRule(ruleName, cssText, 0);
                    }
                    else {
                        styleSheet.insertRule(_newRule, 0);
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (rules_1_1 && !rules_1_1.done && (_a = rules_1.return)) _a.call(rules_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return allCssText;
    };
    /**
     * @private
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    DatagridService.prototype._removeCssRule = /**
     * @private
     * @param {?} ruleName
     * @param {?} styleSheet
     * @return {?}
     */
    function (ruleName, styleSheet) {
        if (!styleSheet) {
            return;
        }
        /** @type {?} */
        var cssRules = (/** @type {?} */ ((styleSheet.cssRules || styleSheet.rules)));
        /** @type {?} */
        var ii = 0;
        /** @type {?} */
        var cssRule = false;
        do {
            cssRule = cssRules[ii];
            if (cssRule) {
                if (cssRule.selectorText.toLowerCase() == ruleName.toLowerCase()) {
                    if (styleSheet.cssRules) {
                        styleSheet.deleteRule(ii);
                    }
                    else {
                        styleSheet.removeRule(ii);
                    }
                    return cssRule;
                }
            }
            ii++;
        } while (cssRule);
    };
    /**
     * @param {?} gridID
     * @return {?}
     */
    DatagridService.prototype.createConfigKey = /**
     * @param {?} gridID
     * @return {?}
     */
    function (gridID) {
        var host = location.host, hash = location.hash, href = location.href, pathname = location.pathname;
        /** @type {?} */
        var formCode = '';
        /** @type {?} */
        var menuId = '';
        if (hash) {
            /** @type {?} */
            var _searchArr = hash.split('?');
            formCode = _searchArr[0];
            /** @type {?} */
            var searchObj_1 = {};
            if (_searchArr[1]) {
                _searchArr[1].split('&').map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) {
                    searchObj_1[n.split('=')[0]] = n.split('=')[1];
                }));
            }
            /** @type {?} */
            var catchFuncIdKEY = "" + pathname;
            if (searchObj_1 && Object.keys(searchObj_1).length) {
                menuId = searchObj_1.funcId || '';
                if (menuId) {
                    localStorage.setItem(catchFuncIdKEY, menuId);
                }
            }
            if (!menuId) {
                menuId = localStorage.getItem(catchFuncIdKEY);
            }
        }
        /** @type {?} */
        var key = formCode + '_' + menuId + '_' + gridID;
        if (!this.idService) {
            this.idService = new IdService();
        }
        return this.idService.encrypt(key);
    };
    /**
     * @param {?} styler
     * @param {?} args
     * @return {?}
     */
    DatagridService.prototype.getCustomStyle = /**
     * @param {?} styler
     * @param {?} args
     * @return {?}
     */
    function (styler, args) {
        if (typeof styler === 'object') {
            return styler;
        }
        else {
            if (typeof styler === 'function') {
                /** @type {?} */
                var p = args || [];
                return styler.apply(void 0, tslib_1.__spread(p));
            }
        }
    };
    /**
     * @param {?} nextTr
     * @param {?} dir
     * @return {?}
     */
    DatagridService.prototype.findNextTr = /**
     * @param {?} nextTr
     * @param {?} dir
     * @return {?}
     */
    function (nextTr, dir) {
        /** @type {?} */
        var getNextElement = (/**
         * @param {?} target
         * @return {?}
         */
        function (target) {
            if (target && target.className.indexOf('f-datagrid-disable-row') == -1) {
                return target;
            }
            return false;
        });
        /** @type {?} */
        var m = dir === 'down' ? 'nextElementSibling' : 'previousElementSibling';
        /** @type {?} */
        var getEle = (/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            /** @type {?} */
            var n = null;
            /** @type {?} */
            var next = true;
            while (next) {
                n = getNextElement(t);
                if (n) {
                    next = false;
                }
                else {
                    if (t && t[m]) {
                        n = getNextElement(t[m]);
                        if (n) {
                            break;
                        }
                    }
                    else {
                        next = false;
                    }
                }
            }
            return n;
        });
        return getEle(nextTr);
    };
    /**
     * @private
     * @param {?} selector
     * @param {?} styleSheet
     * @return {?}
     */
    DatagridService.prototype._getCssTextBySelector = /**
     * @private
     * @param {?} selector
     * @param {?} styleSheet
     * @return {?}
     */
    function (selector, styleSheet) {
        if (!styleSheet) {
            return;
        }
        /** @type {?} */
        var cssRules = (/** @type {?} */ ((styleSheet.cssRules || styleSheet.rules)));
        /** @type {?} */
        var ii = 0;
        /** @type {?} */
        var cssRule = false;
        do {
            cssRule = cssRules[ii];
            if (cssRule) {
                if (cssRule.selectorText.toLowerCase() == selector.toLowerCase()) {
                    return cssRule;
                }
            }
            ii++;
        } while (cssRule);
    };
    return DatagridService;
}());
export { DatagridService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.scorllSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.scrollX;
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.rowHoverSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.rowSelectSubject;
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.dataSourceChangedSubject;
    /**
     * 编辑单元格
     * @type {?}
     * @private
     */
    DatagridService.prototype.editCellSubject;
    /**
     * 选中单元格
     * @type {?}
     * @private
     */
    DatagridService.prototype.selectCellSubject;
    /**
     * 结束单元编辑
     * @type {?}
     * @private
     */
    DatagridService.prototype.endCellEdit;
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.changeCheckedRows;
    /**
     * 结束行编辑
     * @type {?}
     */
    DatagridService.prototype.scorll$;
    /** @type {?} */
    DatagridService.prototype.scrollX$;
    /** @type {?} */
    DatagridService.prototype.scrollY$;
    /** @type {?} */
    DatagridService.prototype.rowHover$;
    /** @type {?} */
    DatagridService.prototype.rowClick$;
    /** @type {?} */
    DatagridService.prototype.onDataSourceChange;
    /** @type {?} */
    DatagridService.prototype.cellEdit$;
    /** @type {?} */
    DatagridService.prototype.endCellEdit$;
    /** @type {?} */
    DatagridService.prototype.checkedRowsTotalChanged$;
    /** @type {?} */
    DatagridService.prototype.updateEmptyStyle$;
    /** @type {?} */
    DatagridService.prototype.showGridHeader;
    /** @type {?} */
    DatagridService.prototype.uncheckAll;
    /** @type {?} */
    DatagridService.prototype.checkAll;
    /** @type {?} */
    DatagridService.prototype.columnResized;
    /** @type {?} */
    DatagridService.prototype.rowHeightChanged;
    /** @type {?} */
    DatagridService.prototype.loadVirtualData;
    /**
     * 显示固定列隐影
     * @type {?}
     */
    DatagridService.prototype.showFixedShadow;
    /** @type {?} */
    DatagridService.prototype.setSelecedRow;
    /** @type {?} */
    DatagridService.prototype.setCheckedRows;
    /** @type {?} */
    DatagridService.prototype.scrollToCurrentRow;
    /** @type {?} */
    DatagridService.prototype.columnsChanged;
    /** @type {?} */
    DatagridService.prototype.cellContentWrapChanged;
    /** @type {?} */
    DatagridService.prototype.onFilterChanged;
    /** @type {?} */
    DatagridService.prototype.clearFilter;
    /** @type {?} */
    DatagridService.prototype.filterTextChange;
    /** @type {?} */
    DatagridService.prototype.toggleFilterRow;
    /** @type {?} */
    DatagridService.prototype.closeFilterPanel;
    /** @type {?} */
    DatagridService.prototype.refreshFooterData;
    /** @type {?} */
    DatagridService.prototype.disableHeader;
    /**
     * 更新全选复选框状态
     * @type {?}
     */
    DatagridService.prototype.changeCheckAllStatus;
    /** @type {?} */
    DatagridService.prototype.setScrollbarPosition;
    /** @type {?} */
    DatagridService.prototype.smartFilterBarExpand;
    /** @type {?} */
    DatagridService.prototype.smartFilterDataChange;
    /** @type {?} */
    DatagridService.prototype.scrollbarUpdate;
    /** @type {?} */
    DatagridService.prototype.footerPositionChanged;
    /** @type {?} */
    DatagridService.prototype.styleElement;
    /** @type {?} */
    DatagridService.prototype.commonUtils;
    /** @type {?} */
    DatagridService.prototype.idService;
    /** @type {?} */
    DatagridService.prototype.cellEditorCreated;
    /** @type {?} */
    DatagridService.prototype.cellEditorDestory;
    /** @type {?} */
    DatagridService.prototype.focusRowChanged;
    /** @type {?} */
    DatagridService.prototype.dataloaded;
    /** @type {?} */
    DatagridService.prototype.toggleGroupRow$;
    /** @type {?} */
    DatagridService.prototype.toggleAllGroupRows$;
    /**
     * @type {?}
     * @private
     */
    DatagridService.prototype.cssTextCache;
    /** @type {?} */
    DatagridService.prototype.groupBy;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZGF0YWdyaWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBUUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU3QyxPQUFPLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRCxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzRCxPQUFPLEVBQWUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHM0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxlQUFlLEVBQUUsb0JBQW9CLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFjMUY7SUFzR0k7UUFyR1Esa0JBQWEsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzlCLFlBQU8sR0FBRyxJQUFJLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVqQyxvQkFBZSxHQUFHLElBQUksT0FBTyxFQUFzQixDQUFDO1FBQ3BELHFCQUFnQixHQUFHLElBQUksT0FBTyxFQUErQixDQUFDO1FBRTlELDZCQUF3QixHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7Ozs7UUFFekMsb0JBQWUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDOzs7O1FBRWhDLHNCQUFpQixHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7Ozs7UUFFbEMsZ0JBQVcsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzVCLHNCQUFpQixHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7Ozs7O1FBSW5DLFlBQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzVD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OUMseUNBQTJDOztJQUUzQyxxQ0FBdUM7O0lBRXZDLG1DQUFxQzs7SUFFckMsd0NBQTBDOztJQUUxQywyQ0FBNkM7O0lBRTdDLDBDQUE0Qzs7Ozs7SUFFNUMsMENBQTRDOztJQUc1Qyx3Q0FBMEM7O0lBQzFDLHlDQUEyQzs7SUFFM0MsNkNBQStDOztJQUUvQyx5Q0FBMkM7O0lBRTNDLGlEQUFtRDs7SUFFbkQsMENBQTRDOztJQUM1QyxzQ0FBd0M7O0lBQ3hDLDJDQUE2Qzs7SUFDN0MsMENBQTRDOztJQUU1QywyQ0FBNkM7O0lBRTdDLDRDQUE4Qzs7SUFFOUMsd0NBQTBDOzs7OztJQUUxQywrQ0FBaUQ7O0lBRWpELCtDQUFpRDs7SUFFakQsK0NBQWlEOztJQUNqRCxnREFBa0Q7O0lBRWxELDBDQUE0Qzs7SUFFNUMsZ0RBQTJDOztJQUUzQyx1Q0FBc0M7O0lBQ3RDLHNDQUFnQzs7SUFFaEMsb0NBQTRCOztJQUc1Qiw0Q0FBdUM7O0lBRXZDLDRDQUF1Qzs7SUFFdkMsMENBQXFDOztJQUNyQyxxQ0FBZ0M7O0lBRWhDLDBDQUFpRjs7SUFDakYsOENBQTZEOzs7OztJQUc3RCx1Q0FBeUM7O0lBNkR6QyxrQ0FHTSIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4qIEBEYXRlOiAyMDE5LTA4LTA2IDA3OjQzOjUzXHJcbiogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiogQExhc3RFZGl0VGltZTogMjAxOS0xMS0wOSAyMDo0NDo1NFxyXG4qIEBRUTogMTA1NTgxODIzOVxyXG4qIEBWZXJzaW9uOiB2MC4wLjFcclxuKi9cclxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCwgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENvbW1vblV0aWxzLCBJZFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IFJvd0V2ZW50UGFyYW0sIFJvd0hvdmVyRXZlbnRQYXJhbSB9IGZyb20gJy4uL3R5cGVzL2V2ZW50LXBhcmFtcyc7XHJcbmltcG9ydCB7IENlbGxJbmZvIH0gZnJvbSAnLi9zdGF0ZSc7XHJcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi8uLi91dGlscy91dGlscyc7XHJcbmltcG9ydCB7IENVU1RPTV9DRUxMX0NMUywgQ1VTVE9NX0dST1VQX1JPV19DTFMsIENVU1RPTV9ST1dfQ0xTIH0gZnJvbSAnLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5cclxuZXhwb3J0IHR5cGUgU2Nyb2xsQWN0aW9uID1cclxuICAgIHwgJ3BzU2Nyb2xsWSdcclxuICAgIHwgJ3BzU2Nyb2xsWCdcclxuICAgIHwgJ3BzU2Nyb2xsVXAnXHJcbiAgICB8ICdwc1Njcm9sbERvd24nXHJcbiAgICB8ICdwc1Njcm9sbExlZnQnXHJcbiAgICB8ICdwc1Njcm9sbFJpZ2h0J1xyXG4gICAgfCAncHNZUmVhY2hFbmQnXHJcbiAgICB8ICdwc1lSZWFjaFN0YXJ0J1xyXG4gICAgfCAncHNYUmVhY2hFbmQnXHJcbiAgICB8ICdwc1hSZWFjaFN0YXJ0JztcclxuXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZFNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBzY29ybGxTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgc2Nyb2xsWCA9IG5ldyBCZWhhdmlvclN1YmplY3QoMCk7XHJcblxyXG4gICAgcHJpdmF0ZSByb3dIb3ZlclN1YmplY3QgPSBuZXcgU3ViamVjdDxSb3dIb3ZlckV2ZW50UGFyYW0+KCk7XHJcbiAgICBwcml2YXRlIHJvd1NlbGVjdFN1YmplY3QgPSBuZXcgU3ViamVjdDxQYXJ0aWFsPFJvd0hvdmVyRXZlbnRQYXJhbT4+KCk7XHJcblxyXG4gICAgcHJpdmF0ZSBkYXRhU291cmNlQ2hhbmdlZFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLyoqIOe8lui+keWNleWFg+agvCAqL1xyXG4gICAgcHJpdmF0ZSBlZGl0Q2VsbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLyoqIOmAieS4reWNleWFg+agvCAqL1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RDZWxsU3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICAvKiog57uT5p2f5Y2V5YWD57yW6L6RICovXHJcbiAgICBwcml2YXRlIGVuZENlbGxFZGl0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgY2hhbmdlQ2hlY2tlZFJvd3MgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgLyoqIOe7k+adn+ihjOe8lui+kSAqL1xyXG4gICAgLy8gcHJpdmF0ZSBlbmRSb3dFZGl0ID0gbmV3IEJlaGF2aW9yU3ViamVjdCh0cnVlKTtcclxuXHJcbiAgICBwdWJsaWMgc2NvcmxsJCA9IHRoaXMuc2NvcmxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHB1YmxpYyBzY3JvbGxYJCA9IHRoaXMuc2NvcmxsJC5waXBlKFxyXG4gICAgICAgIGZpbHRlcigocDogYW55KSA9PiBwLnR5cGUgPT09ICdwc1Njcm9sbFgnKSxcclxuICAgICAgICBtYXAodCA9PiB0LngpLFxyXG4gICAgICAgIGRlYm91bmNlVGltZSg1MClcclxuICAgICk7XHJcbiAgICBwdWJsaWMgc2Nyb2xsWSQgPSB0aGlzLnNjb3JsbCQucGlwZShcclxuICAgICAgICBmaWx0ZXIoKHA6IGFueSkgPT4gcC50eXBlID09PSAncHNTY3JvbGxZJyksXHJcbiAgICAgICAgbWFwKHQgPT4gdC54KSxcclxuICAgICAgICBkZWJvdW5jZVRpbWUoNTApXHJcbiAgICApO1xyXG4gICAgcHVibGljIHJvd0hvdmVyJCA9IHRoaXMucm93SG92ZXJTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgcHVibGljIHJvd0NsaWNrJCA9IHRoaXMucm93U2VsZWN0U3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHB1YmxpYyBvbkRhdGFTb3VyY2VDaGFuZ2UgPSB0aGlzLmRhdGFTb3VyY2VDaGFuZ2VkU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHB1YmxpYyBjZWxsRWRpdCQgPSB0aGlzLmVkaXRDZWxsU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICAgIHB1YmxpYyBlbmRDZWxsRWRpdCQgPSB0aGlzLmVuZENlbGxFZGl0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgcHVibGljIGNoZWNrZWRSb3dzVG90YWxDaGFuZ2VkJCA9IHRoaXMuY2hhbmdlQ2hlY2tlZFJvd3MuYXNPYnNlcnZhYmxlKCk7XHJcbiAgICBwdWJsaWMgdXBkYXRlRW1wdHlTdHlsZSQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcHVibGljIHNob3dHcmlkSGVhZGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8g5Y+W5raI5YWo6YCJXHJcbiAgICBwdWJsaWMgdW5jaGVja0FsbCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8vIOWFqOmDqOmAieS4rVxyXG4gICAgcHVibGljIGNoZWNrQWxsID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBjb2x1bW5SZXNpemVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyByb3dIZWlnaHRDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBsb2FkVmlydHVhbERhdGEgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAvKiog5pi+56S65Zu65a6a5YiX6ZqQ5b2xICovXHJcbiAgICBwdWJsaWMgc2hvd0ZpeGVkU2hhZG93ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8gcHVibGljIGVuZFJvd0VkaXQkID0gdGhpcy5lbmRSb3dFZGl0LmFzT2JzZXJ2YWJsZSgpO1xyXG5cclxuICAgIHB1YmxpYyBzZXRTZWxlY2VkUm93ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgcHVibGljIHNldENoZWNrZWRSb3dzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBzY3JvbGxUb0N1cnJlbnRSb3cgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcHVibGljIGNvbHVtbnNDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBjZWxsQ29udGVudFdyYXBDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBvbkZpbHRlckNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwdWJsaWMgY2xlYXJGaWx0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwdWJsaWMgZmlsdGVyVGV4dENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIHB1YmxpYyB0b2dnbGVGaWx0ZXJSb3cgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcHVibGljIGNsb3NlRmlsdGVyUGFuZWwgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgcHVibGljIHJlZnJlc2hGb290ZXJEYXRhID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBkaXNhYmxlSGVhZGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLyoqIOabtOaWsOWFqOmAieWkjemAieahhueKtuaAgSAqL1xyXG4gICAgcHVibGljIGNoYW5nZUNoZWNrQWxsU3RhdHVzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBzZXRTY3JvbGxiYXJQb3NpdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICBwdWJsaWMgc21hcnRGaWx0ZXJCYXJFeHBhbmQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgICBwdWJsaWMgc21hcnRGaWx0ZXJEYXRhQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHB1YmxpYyBzY3JvbGxiYXJVcGRhdGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgZm9vdGVyUG9zaXRpb25DaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIHN0eWxlRWxlbWVudDogSFRNTFN0eWxlRWxlbWVudCA9IG51bGw7XHJcbiAgICBjb21tb25VdGlsczogQ29tbW9uVXRpbHMgPSBudWxsO1xyXG5cclxuICAgIGlkU2VydmljZTogSWRTZXJ2aWNlID0gbnVsbDtcclxuXHJcbiAgICAvLyDljZXlhYPmoLznvJbovpHlmajliJvlu7rlrozmiJBcclxuICAgIGNlbGxFZGl0b3JDcmVhdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgLy8g5Y2V5YWD5qC857yW6L6R5Zmo6ZSA5q+BXHJcbiAgICBjZWxsRWRpdG9yRGVzdG9yeSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAgIC8vIOeEpueCueihjOWIh+aNolxyXG4gICAgZm9jdXNSb3dDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gICAgZGF0YWxvYWRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgICB0b2dnbGVHcm91cFJvdyQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZ3JvdXBSb3dJbmRleDogbnVtYmVyLCBleHBhbmQ6IGJvb2xlYW4gfT4oKTtcclxuICAgIHRvZ2dsZUFsbEdyb3VwUm93cyQgPSBuZXcgRXZlbnRFbWl0dGVyPHtleHBhbmQ6IGJvb2xlYW4gfT4oKTtcclxuICAgIFxyXG4gICAgLy8gQ1NTIOaWh+acrOe8k+WtmFxyXG4gICAgcHJpdmF0ZSBjc3NUZXh0Q2FjaGU6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICAgIG9uU2Nyb2xsTW92ZSh4OiBudW1iZXIsIGFjdGlvbjogU2Nyb2xsQWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5zY29ybGxTdWJqZWN0Lm5leHQoeyB4LCB0eXBlOiBhY3Rpb24gfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZGF0YVNvdXJjZUNoYW5nZWQoKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhU291cmNlQ2hhbmdlZFN1YmplY3QubmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUm93SG92ZXIocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55LCBtb3VzZUVudGVyOiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy5yb3dIb3ZlclN1YmplY3QubmV4dCh7IGluZGV4OiByb3dJbmRleCwgZGF0YTogcm93RGF0YSwgbW91c2VlbnRlcjogbW91c2VFbnRlciB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvblJvd0NsaWNrKHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMucm93U2VsZWN0U3ViamVjdC5uZXh0KHsgaW5kZXg6IHJvd0luZGV4LCBkYXRhOiByb3dEYXRhIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2VsbEVkaXQodGRFbGVtZW50OiBhbnkpIHtcclxuICAgICAgICB0aGlzLmVkaXRDZWxsU3ViamVjdC5uZXh0KHRkRWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25FbmRDZWxsRWRpdChjZWxsOiBDZWxsSW5mbykge1xyXG4gICAgICAgIHRoaXMuZW5kQ2VsbEVkaXQubmV4dChjZWxsKTtcclxuICAgIH1cclxuXHJcbiAgICBvblNlbGVjdENlbGwoY2VsbDogQ2VsbEluZm8pIHtcclxuICAgICAgICB0aGlzLnNlbGVjdENlbGxTdWJqZWN0Lm5leHQoY2VsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DaGVja2VkUm93c0NvdW50Q2hhbmdlKCkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlQ2hlY2tlZFJvd3MubmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUm93SGVpZ2h0Q2hhbmdlKHJvd0hlaWdodDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5yb3dIZWlnaHRDaGFuZ2VkLmVtaXQocm93SGVpZ2h0KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkxvYWRWaXJ0dWFsRGF0YShkYXRhOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmxvYWRWaXJ0dWFsRGF0YS5lbWl0KHsgZGF0YSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvbkNsZWFyRmlsdGVyKCkge1xyXG4gICAgICAgIHRoaXMuY2xlYXJGaWx0ZXIuZW1pdCgpO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyVGV4dENoYW5nZS5lbWl0KCcnKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkZpbHRlclRleHRDaGFuZ2UodHh0OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmZpbHRlclRleHRDaGFuZ2UuZW1pdCh0eHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc3RvcmVTY3JvbGxiYXJQb3NpdGlvbigpIHtcclxuICAgICAgICB0aGlzLnNldFNjcm9sbGJhclBvc2l0aW9uLmVtaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVFbXB0eVN0eWxlKCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlRW1wdHlTdHlsZSQuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdyb3VwQnkgPSAoYXJyLCBmbikgPT4gYXJyLm1hcCh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicgPyBmbiA6IHZhbCA9PiBVdGlscy5nZXRWYWx1ZShmbiwgdmFsKSkucmVkdWNlKChhY2MsIHZhbCwgaSkgPT4ge1xyXG4gICAgICAgIGFjY1t2YWxdID0gKGFjY1t2YWxdIHx8IFtdKS5jb25jYXQoYXJyW2ldKTtcclxuICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgfSwge30pXHJcblxyXG4gICAgZ2V0TWVyZ2VDZWxsSW5mbyhkYXRhLCBtZXJnZUZpZWxkcykge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xyXG4gICAgICAgIGxldCBmaXJzdFZhbCA9IG51bGw7XHJcbiAgICAgICAgbGV0IGN1cnJWYWw7XHJcblxyXG4gICAgICAgIG1lcmdlRmllbGRzLmZvckVhY2goKGYsIGkpID0+IHtcclxuICAgICAgICAgICAgaWYgKGkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoZCwgaikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7IFtmXTogeyBzaG93OiB0cnVlLCByb3dzcGFuOiAxIH0gfTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdFtqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbal0gPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0W2pdW2ZdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbal0gPSBPYmplY3QuYXNzaWduKHJlc3VsdFtqXSwgaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9pdGVtID0gcmVzdWx0W2pdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjdXJyVmFsID0gZFtmXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RWYWwgPT09IG51bGwgfHwgZmlyc3RWYWwgIT09IGN1cnJWYWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RWYWwgPSBjdXJyVmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfaXRlbVtmXS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc3RhcnRJbmRleCA9IGo7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RySW5kZXggPSByZXN1bHRbaiAtIDFdW2ZdLnN0YXJ0SW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtW2ZdLnN0YXJ0SW5kZXggPSBzdHJJbmRleDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbc3RySW5kZXhdW2ZdLnJvd3NwYW4rKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldE1lcmdlQ2VsbEluZm8wKGRhdGEsIGZpZWxkKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0ge307XHJcbiAgICAgICAgbGV0IGZpcnN0VmFsO1xyXG4gICAgICAgIGxldCBjdXJyVmFsO1xyXG4gICAgICAgIGRhdGEuZm9yRWFjaCgoZCwgaikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtID0geyBbZmllbGRdOiB7IHNob3c6IHRydWUsIHJvd3NwYW46IDEsIHZhbHVlOiAnJyB9IH07XHJcbiAgICAgICAgICAgIGlmICghcmVzdWx0W2pdKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHRbal0gPSBpdGVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBfaXRlbSA9IHJlc3VsdFtqXTtcclxuICAgICAgICAgICAgY3VyclZhbCA9IFV0aWxzLmdldFZhbHVlKGZpZWxkLCBkKTtcclxuICAgICAgICAgICAgX2l0ZW1bZmllbGRdLnZhbHVlID0gY3VyclZhbDtcclxuICAgICAgICAgICAgaWYgKGZpcnN0VmFsID09PSB1bmRlZmluZWQgfHwgZmlyc3RWYWwgIT09IGN1cnJWYWwpIHtcclxuICAgICAgICAgICAgICAgIGZpcnN0VmFsID0gY3VyclZhbDtcclxuICAgICAgICAgICAgICAgIF9pdGVtW2ZpZWxkXS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9pdGVtW2ZpZWxkXS5zdGFydEluZGV4ID0gajtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0ckluZGV4ID0gcmVzdWx0W2ogLSAxXVtmaWVsZF0uc3RhcnRJbmRleDtcclxuICAgICAgICAgICAgICAgIF9pdGVtW2ZpZWxkXS5zdGFydEluZGV4ID0gc3RySW5kZXg7XHJcbiAgICAgICAgICAgICAgICBfaXRlbVtmaWVsZF0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0W3N0ckluZGV4XVtmaWVsZF0ucm93c3BhbisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRNZXJnZUNlbGxJbmZvMihkYXRhLCBtZXJnZUZpZWxkcykge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSB7fTtcclxuICAgICAgICBsZXQgZmlyc3RWYWwgPSBudWxsO1xyXG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0TWVyZ2VDZWxsSW5mbzAoZGF0YSwgbWVyZ2VGaWVsZHMuc3BsaWNlKDAsIDEpWzBdKTtcclxuXHJcbiAgICAgICAgY29uc3QgZ3JvdXBEYXRhID0gdGhpcy5ncm91cEJ5KGRhdGEsIG1lcmdlRmllbGRzWzBdKTtcclxuICAgICAgICBjb25zdCBncm91cEtleXMgPSBPYmplY3Qua2V5cyhncm91cERhdGEpO1xyXG4gICAgICAgIGxldCBzdGFydFJvd0luZGV4ID0gMDtcclxuICAgICAgICBtZXJnZUZpZWxkcy5mb3JFYWNoKChmLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIGdyb3VwS2V5cy5mb3JFYWNoKChrLCBqKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3VyclZhbDtcclxuICAgICAgICAgICAgICAgIGdyb3VwRGF0YVtrXS5mb3JFYWNoKChkLCBuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdFtzdGFydFJvd0luZGV4XSAmJiAhcmVzdWx0W3N0YXJ0Um93SW5kZXhdW2ZdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtzdGFydFJvd0luZGV4XSA9IE9iamVjdC5hc3NpZ24ocmVzdWx0W3N0YXJ0Um93SW5kZXhdLCB7IFtmXTogeyBzaG93OiB0cnVlLCByb3dzcGFuOiAxLCB2YWx1ZTogJycgfSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9pdGVtID0gcmVzdWx0W3N0YXJ0Um93SW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJWYWwgPSBVdGlscy5nZXRWYWx1ZShmLCBkKTtcclxuICAgICAgICAgICAgICAgICAgICBfaXRlbVtmXS52YWx1ZSA9IGN1cnJWYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0VmFsID09PSBudWxsIHx8IGZpcnN0VmFsICE9PSBjdXJyVmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VmFsID0gY3VyclZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtW2ZdLnN0YXJ0SW5kZXggPSBzdGFydFJvd0luZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0ckluZGV4ID0gcmVzdWx0W3N0YXJ0Um93SW5kZXggLSAxXVtmXS5zdGFydEluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfaXRlbVtmXS5zdGFydEluZGV4ID0gc3RySW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9pdGVtW2ZdLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3N0ckluZGV4XVtmXS5yb3dzcGFuKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdGFydFJvd0luZGV4Kys7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0TWVyZ2VDZWxsSW5mbzMoZGF0YSwgbWVyZ2VGaWVsZHMpIHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0ge307XHJcbiAgICAgICAgY29uc3QgZmlyc3RGaWVsZCA9IG1lcmdlRmllbGRzLnNwbGljZSgwLCAxKVswXTtcclxuICAgICAgICByZXN1bHQgPSB0aGlzLmdldE1lcmdlQ2VsbEluZm8wKGRhdGEsIGZpcnN0RmllbGQpO1xyXG4gICAgICAgIGxldCBwcmV2R3JvdXBGaWVsZCA9IGZpcnN0RmllbGQ7XHJcbiAgICAgICAgLy8gY29uc3QgZ3JvdXBEYXRhID0gdGhpcy5ncm91cEJ5KGRhdGEsIGZpcnN0RmllbGQpO1xyXG4gICAgICAgIC8vIGNvbnN0IGdyb3VwS2V5cyA9IE9iamVjdC5rZXlzKGdyb3VwRGF0YSk7XHJcbiAgICAgICAgbWVyZ2VGaWVsZHMuZm9yRWFjaCgoZiwgaSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgc3RhcnRSb3dJbmRleCA9IDA7XHJcblxyXG4gICAgICAgICAgICBsZXQgZmlyc3RWYWw7XHJcbiAgICAgICAgICAgIGxldCBjdXJyVmFsO1xyXG5cclxuICAgICAgICAgICAgaWYgKGkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBwcmV2R3JvdXBGaWVsZCA9IG1lcmdlRmllbGRzW2kgLSAxXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChkLCBuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0W3N0YXJ0Um93SW5kZXhdICYmICFyZXN1bHRbc3RhcnRSb3dJbmRleF1bZl0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRbc3RhcnRSb3dJbmRleF0gPSBPYmplY3QuYXNzaWduKHJlc3VsdFtzdGFydFJvd0luZGV4XSwgeyBbZl06IHsgc2hvdzogdHJ1ZSwgcm93c3BhbjogMSwgdmFsdWU6ICcnIH0gfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgX2l0ZW0gPSByZXN1bHRbc3RhcnRSb3dJbmRleF07XHJcbiAgICAgICAgICAgICAgICBjdXJyVmFsID0gVXRpbHMuZ2V0VmFsdWUoZiwgZCk7XHJcbiAgICAgICAgICAgICAgICBfaXRlbVtmXS52YWx1ZSA9IGN1cnJWYWw7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0Um93SW5kZXggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldkl0ZW0gPSByZXN1bHRbc3RhcnRSb3dJbmRleCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9jID0gT2JqZWN0LmtleXMoX2l0ZW0pLm1hcChjID0+ICcnICsgX2l0ZW1bY10udmFsdWUpLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBfcCA9IE9iamVjdC5rZXlzKHByZXZJdGVtKS5tYXAocCA9PiAnJyArIHByZXZJdGVtW3BdLnZhbHVlKS5qb2luKCcsJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfYyAhPT0gX3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RWYWwgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgoZmlyc3RWYWwgPT09IHVuZGVmaW5lZCB8fCBmaXJzdFZhbCAhPT0gY3VyclZhbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaXJzdFZhbCA9IGN1cnJWYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc3RhcnRJbmRleCA9IHN0YXJ0Um93SW5kZXg7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSByZXN1bHRbc3RhcnRSb3dJbmRleCAtIDFdW2ZdLnN0YXJ0SW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc3RhcnRJbmRleCA9IHN0YXJ0SW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgX2l0ZW1bZl0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtzdGFydEluZGV4XVtmXS5yb3dzcGFuKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoIC0gMSA+IHN0YXJ0Um93SW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFJvd0luZGV4Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldE1lcmdlSW5mbyhyb3dJbmRleDogbnVtYmVyLCBmaWVsZDogc3RyaW5nLCBtZXJnZUNlbGxJbmZvOiBhbnkpIHtcclxuICAgICAgICBpZiAoZmllbGQgJiYgbWVyZ2VDZWxsSW5mbyAmJiBtZXJnZUNlbGxJbmZvW3Jvd0luZGV4XSAmJiBtZXJnZUNlbGxJbmZvW3Jvd0luZGV4XVtmaWVsZF0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1lcmdlQ2VsbEluZm9bcm93SW5kZXhdW2ZpZWxkXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlU3R5bGVTaGVldCgpIHtcclxuICAgICAgICBpZiAodGhpcy5zdHlsZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5zdHlsZUVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGVFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgLy8g5riF56m657yT5a2YXHJcbiAgICAgICAgICAgIHRoaXMuY3NzVGV4dENhY2hlID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVN0eWxlRWxlbWVudChzdHlsZVNoZWV0SWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuc3R5bGVFbGVtZW50ID0gdGhpcy5fY3JlYXRlU3R5bGVTaGVldChzdHlsZVNoZWV0SWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGFwcGVuZENzc1J1bGVzKHJ1bGVzOiBzdHJpbmdbXSkge1xyXG4gICAgICAgIGlmICh0aGlzLnN0eWxlRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9hcHBlbmRDc3NSdWxlcyhydWxlcywgdGhpcy5zdHlsZUVsZW1lbnQuc2hlZXQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVDc3NSdWxlKHJ1bGVOYW1lOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3R5bGVFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcnVsZU5hbWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDc3NSdWxlKHJ1bGVOYW1lLCB0aGlzLnN0eWxlRWxlbWVudC5zaGVldCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNzc1RleHRDYWNoZSA9IHRoaXMuY3NzVGV4dENhY2hlLmZpbHRlcihuID0+IG4uaW5kZXhPZihydWxlTmFtZSkgPT0gLTEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocnVsZU5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVsZU5hbWUuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3NzUnVsZShuLCB0aGlzLnN0eWxlRWxlbWVudC5zaGVldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3NzVGV4dENhY2hlID0gdGhpcy5jc3NUZXh0Q2FjaGUuZmlsdGVyKG4gPT4gbi5pbmRleE9mKG4pID09IC0xKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfY3JlYXRlU3R5bGVTaGVldChzdHlsZVNoZWV0SWQ6IHN0cmluZyk6IEhUTUxTdHlsZUVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IGh0bWxIZWFkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpO1xyXG5cclxuICAgICAgICBjb25zdCBzdHlsZUVsZUlkID0gc3R5bGVTaGVldElkO1xyXG4gICAgICAgIGxldCBzdHlsZUVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjJyArIHN0eWxlRWxlSWQpKSB7XHJcbiAgICAgICAgICAgIHN0eWxlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyMnICsgc3R5bGVFbGVJZCk7XHJcbiAgICAgICAgICAgIHN0eWxlRWxlbWVudC5pbm5lclRleHQgPSAnJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xyXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQuaWQgPSBzdHlsZUVsZUlkO1xyXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQudHlwZSA9ICd0ZXh0L2Nzcyc7XHJcbiAgICAgICAgICAgIGh0bWxIZWFkLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3R5bGVFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2FwcGVuZENzc1J1bGVzKHJ1bGVzOiBzdHJpbmdbXSwgc3R5bGVTaGVldCkge1xyXG4gICAgICAgIGxldCBhbGxDc3NUZXh0ID0gJyc7XHJcbiAgICAgICAgZm9yIChjb25zdCBydWxlIG9mIHJ1bGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZS5zbGljZSgwLCBydWxlLmluZGV4T2YoJ3snKSkudHJpbSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uc3QgcmVtb3ZlZENzc1J1bGUgPSB0aGlzLl9yZW1vdmVDc3NSdWxlKHJ1bGVOYW1lLCBzdHlsZVNoZWV0KTtcclxuICAgICAgICAgICAgY29uc3QgcmVtb3ZlZENzc1J1bGUgPSB0aGlzLl9nZXRDc3NUZXh0QnlTZWxlY3RvcihydWxlTmFtZSwgc3R5bGVTaGVldCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsZXQgY3NzVGV4dCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAocmVtb3ZlZENzc1J1bGUgJiYgcnVsZU5hbWUuaW5kZXhPZihDVVNUT01fQ0VMTF9DTFMpID09IC0xICYmIHJ1bGVOYW1lLmluZGV4T2YoQ1VTVE9NX0dST1VQX1JPV19DTFMpID09IC0xICAmJiBydWxlTmFtZS5pbmRleE9mKENVU1RPTV9ST1dfQ0xTKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgY3NzVGV4dCArPSByZW1vdmVkQ3NzUnVsZS5jc3NUZXh0LnNsaWNlKHJlbW92ZWRDc3NSdWxlLmNzc1RleHQuaW5kZXhPZigneycpICsgMSwgcmVtb3ZlZENzc1J1bGUuY3NzVGV4dC5pbmRleE9mKCd9JykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNzc1RleHQgKz0gcnVsZS5zbGljZShydWxlLmluZGV4T2YoJ3snKSArIDEsIHJ1bGUuaW5kZXhPZignfScpKS5yZXBsYWNlKC9cIi9nLCAnJykucmVwbGFjZSgvLC9nLCAnOycpICsgJzsnO1xyXG4gICAgICAgICAgICBjb25zdCBfbmV3UnVsZSA9ICBgJHtydWxlTmFtZX17ICR7Y3NzVGV4dH0gfWA7XHJcbiAgICAgICAgICAgIGFsbENzc1RleHQgKz0gX25ld1J1bGU7XHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmNzc1RleHRDYWNoZS5pbmNsdWRlcyhfbmV3UnVsZSkpIHtcclxuICAgICAgICAgICAgICAgIC8vIOWwhuWQiOW5tuWQjkNTU+aWh+acrOa3u+WKoOWIsOe8k+WtmFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jc3NUZXh0Q2FjaGUucHVzaChfbmV3UnVsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHN0eWxlU2hlZXQuYWRkUnVsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuYWRkUnVsZShydWxlTmFtZSwgY3NzVGV4dCwgMCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuaW5zZXJ0UnVsZShfbmV3UnVsZSwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGFsbENzc1RleHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfcmVtb3ZlQ3NzUnVsZShydWxlTmFtZTogc3RyaW5nLCBzdHlsZVNoZWV0KSB7XHJcblxyXG4gICAgICAgIGlmICghc3R5bGVTaGVldCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjc3NSdWxlcyA9IChzdHlsZVNoZWV0LmNzc1J1bGVzIHx8IHN0eWxlU2hlZXQucnVsZXMpIGFzIGFueTtcclxuICAgICAgICBsZXQgaWkgPSAwO1xyXG4gICAgICAgIGxldCBjc3NSdWxlOiBhbnkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBjc3NSdWxlID0gY3NzUnVsZXNbaWldO1xyXG4gICAgICAgICAgICBpZiAoY3NzUnVsZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNzc1J1bGUuc2VsZWN0b3JUZXh0LnRvTG93ZXJDYXNlKCkgPT0gcnVsZU5hbWUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZVNoZWV0LmNzc1J1bGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlU2hlZXQuZGVsZXRlUnVsZShpaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVTaGVldC5yZW1vdmVSdWxlKGlpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjc3NSdWxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlpKys7XHJcbiAgICAgICAgfSB3aGlsZSAoY3NzUnVsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ29uZmlnS2V5KGdyaWRJRDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgeyBob3N0LCBoYXNoLCBocmVmLCBwYXRobmFtZSB9ID0gbG9jYXRpb247XHJcbiAgICAgICAgbGV0IGZvcm1Db2RlID0gJyc7XHJcbiAgICAgICAgbGV0IG1lbnVJZCA9ICcnO1xyXG4gICAgICAgIGlmIChoYXNoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9zZWFyY2hBcnIgPSBoYXNoLnNwbGl0KCc/Jyk7XHJcbiAgICAgICAgICAgIGZvcm1Db2RlID0gX3NlYXJjaEFyclswXTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaE9iajogYW55ID0ge307XHJcbiAgICAgICAgICAgIGlmIChfc2VhcmNoQXJyWzFdKSB7XHJcbiAgICAgICAgICAgICAgICBfc2VhcmNoQXJyWzFdLnNwbGl0KCcmJykubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaE9ialtuLnNwbGl0KCc9JylbMF1dID0gbi5zcGxpdCgnPScpWzFdO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhdGNoRnVuY0lkS0VZID0gYCR7cGF0aG5hbWV9YDtcclxuICAgICAgICAgICAgaWYgKHNlYXJjaE9iaiAmJiBPYmplY3Qua2V5cyhzZWFyY2hPYmopLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgbWVudUlkID0gc2VhcmNoT2JqLmZ1bmNJZCB8fCAnJztcclxuICAgICAgICAgICAgICAgIGlmIChtZW51SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjYXRjaEZ1bmNJZEtFWSwgbWVudUlkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFtZW51SWQpIHtcclxuICAgICAgICAgICAgICAgIG1lbnVJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNhdGNoRnVuY0lkS0VZKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBrZXkgPSBmb3JtQ29kZSArICdfJyArIG1lbnVJZCArICdfJyArIGdyaWRJRDtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlkU2VydmljZSkge1xyXG4gICAgICAgICAgICB0aGlzLmlkU2VydmljZSA9IG5ldyBJZFNlcnZpY2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmlkU2VydmljZS5lbmNyeXB0KGtleSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldEN1c3RvbVN0eWxlKHN0eWxlcjogYW55LCBhcmdzOiBhbnkpOiB7IGNscz86IGFueSwgc3R5bGU/OiBhbnkgfSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzdHlsZXIgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdHlsZXI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzdHlsZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBhcmdzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlciguLi5wKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgZmluZE5leHRUcihuZXh0VHIsIGRpcikge1xyXG4gICAgICAgIGNvbnN0IGdldE5leHRFbGVtZW50ID0gKHRhcmdldCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0ICYmIHRhcmdldC5jbGFzc05hbWUuaW5kZXhPZignZi1kYXRhZ3JpZC1kaXNhYmxlLXJvdycpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBtID0gZGlyID09PSAnZG93bicgPyAnbmV4dEVsZW1lbnRTaWJsaW5nJyA6ICdwcmV2aW91c0VsZW1lbnRTaWJsaW5nJztcclxuXHJcbiAgICAgICAgY29uc3QgZ2V0RWxlID0gKHQpID0+IHtcclxuICAgICAgICAgICAgbGV0IG4gPSBudWxsO1xyXG4gICAgICAgICAgICBsZXQgbmV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgIHdoaWxlIChuZXh0KSB7XHJcbiAgICAgICAgICAgICAgICBuID0gZ2V0TmV4dEVsZW1lbnQodCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgdFttXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuID0gZ2V0TmV4dEVsZW1lbnQodFttXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGdldEVsZShuZXh0VHIpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2dldENzc1RleHRCeVNlbGVjdG9yKHNlbGVjdG9yOiBzdHJpbmcsIHN0eWxlU2hlZXQpIHtcclxuICAgICAgICBpZiAoIXN0eWxlU2hlZXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY3NzUnVsZXMgPSAoc3R5bGVTaGVldC5jc3NSdWxlcyB8fCBzdHlsZVNoZWV0LnJ1bGVzKSBhcyBhbnk7XHJcbiAgICAgICAgbGV0IGlpID0gMDtcclxuICAgICAgICBsZXQgY3NzUnVsZTogYW55ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGRvIHtcclxuICAgICAgICAgICAgY3NzUnVsZSA9IGNzc1J1bGVzW2lpXTtcclxuICAgICAgICAgICAgaWYgKGNzc1J1bGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjc3NSdWxlLnNlbGVjdG9yVGV4dC50b0xvd2VyQ2FzZSgpID09IHNlbGVjdG9yLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3NzUnVsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpaSsrO1xyXG4gICAgICAgIH0gd2hpbGUgKGNzc1J1bGUpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
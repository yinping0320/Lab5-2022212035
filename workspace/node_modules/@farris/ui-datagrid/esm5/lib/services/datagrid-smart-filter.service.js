/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { ColumnFilterType } from '../types/data-column';
import { BooleanFilterControl, DateFilterControl, EnumFilterControl, NumberFilterControl, TextFilterControl } from '../plugins/smart-filter/controlData/filter-control.options';
var DatagridSmartFilterService = /** @class */ (function () {
    function DatagridSmartFilterService() {
        this.conditions = [];
        this.controlData = [];
        this.filterChanged = new Subject();
        this.removeFilter = new Subject();
        this.clearAllFilter = new Subject();
    }
    /**
     * @param {?} col
     * @return {?}
     */
    DatagridSmartFilterService.prototype.getColumnFilterData = /**
     * @param {?} col
     * @return {?}
     */
    function (col) {
        /** @type {?} */
        var filterControlData = {
            controltype: 'text',
        };
        if (col.filter !== undefined) {
            if (typeof col.filter === 'boolean') {
                if (col.formatter) {
                    if (typeof col.formatter === 'object' && Object.keys(col.formatter).length) {
                        /** @type {?} */
                        var options = col.formatter['options'];
                        switch (col.formatter['type']) {
                            case 'number':
                                return NumberFilterControl(col);
                            case 'enum':
                                return EnumFilterControl(col, options);
                            case 'boolean':
                                return BooleanFilterControl(col);
                            case 'datetime':
                                /** @type {?} */
                                var tye = 'datetime';
                                /** @type {?} */
                                var fmt = 'yyyy-MM-dd';
                                /** @type {?} */
                                var returnFmt = 'yyyy-MM-dd';
                                if (options && options.format) {
                                    fmt = options.format;
                                    if (fmt.indexOf('HH:') == -1) {
                                        tye = 'date';
                                    }
                                    else {
                                        returnFmt += ' HH:mm';
                                        if (fmt.indexOf('ss') > -1) {
                                            returnFmt += ':ss';
                                        }
                                    }
                                }
                                else {
                                    tye = 'date';
                                }
                                filterControlData = {
                                    controltype: 'flexibleDate',
                                    dateFormat: fmt,
                                    single: false,
                                    showType: 3,
                                    showTime: tye === 'datetime'
                                };
                                break;
                            default:
                                return TextFilterControl(col);
                        }
                    }
                }
                return filterControlData;
            }
            else {
                switch (col.filter.type) {
                    case ColumnFilterType.enum:
                        return EnumFilterControl(col, col.filter.options);
                    case ColumnFilterType.date:
                    case ColumnFilterType.datetime:
                        return DateFilterControl(col, col.filter.options);
                    case ColumnFilterType.number:
                        return NumberFilterControl(col);
                    case ColumnFilterType.boolean:
                        return BooleanFilterControl(col);
                }
            }
        }
        return filterControlData;
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatagridSmartFilterService.prototype.filterConditionChanged = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _a, _b;
        /** @type {?} */
        var items = e.conditions;
        if (!this.conditions || !this.conditions.length) {
            (_a = this.conditions).push.apply(_a, tslib_1.__spread(items));
            this.controlData.push(tslib_1.__assign({}, e.controlData));
        }
        else {
            /// TODO, CONTROLDATA 的索引与conditions 的索引很可能不是1个
            if (e.from === 'toolbar') {
                this.conditions = tslib_1.__spread(items);
            }
            else {
                this.conditions = this.conditions.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.FilterField !== items[0].FilterField; }));
                if (items.length === 1) {
                    this.conditions.push(tslib_1.__assign({}, items[0]));
                }
                else {
                    (_b = this.conditions).push.apply(_b, tslib_1.__spread(items));
                }
            }
            if (e.controlData) {
                /** @type {?} */
                var ctrlIdx = this.controlData.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.labelCode === e.controlData.labelCode; }));
                if (ctrlIdx > -1) {
                    this.controlData[ctrlIdx] = tslib_1.__assign({}, e.controlData);
                }
                else {
                    this.controlData.push(tslib_1.__assign({}, e.controlData));
                }
            }
        }
        this.filterChanged.next({ conditions: tslib_1.__spread(this.conditions), controlData: tslib_1.__spread(this.controlData) });
    };
    /**
     * @param {?} e
     * @param {?=} emitRemove
     * @return {?}
     */
    DatagridSmartFilterService.prototype.removeCondition = /**
     * @param {?} e
     * @param {?=} emitRemove
     * @return {?}
     */
    function (e, emitRemove) {
        if (emitRemove === void 0) { emitRemove = false; }
        if (this.conditions && this.conditions.length) {
            this.conditions = this.conditions.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.FilterField !== e.labelCode; }));
            this.controlData = this.controlData.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.labelCode !== e.labelCode; }));
        }
        this.filterChanged.next({ conditions: tslib_1.__spread(this.conditions), controlData: tslib_1.__spread(this.controlData) });
        if (emitRemove) {
            this.removeFilter.next(e);
        }
    };
    /**
     * @return {?}
     */
    DatagridSmartFilterService.prototype.clearAll = /**
     * @return {?}
     */
    function () {
        this.conditions = [];
        this.controlData = [];
        this.clearAllFilter.next(null);
    };
    DatagridSmartFilterService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridSmartFilterService.ctorParameters = function () { return []; };
    return DatagridSmartFilterService;
}());
export { DatagridSmartFilterService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridSmartFilterService.prototype.conditions;
    /** @type {?} */
    DatagridSmartFilterService.prototype.controlData;
    /** @type {?} */
    DatagridSmartFilterService.prototype.filterChanged;
    /** @type {?} */
    DatagridSmartFilterService.prototype.removeFilter;
    /** @type {?} */
    DatagridSmartFilterService.prototype.clearAllFilter;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtc21hcnQtZmlsdGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLXNtYXJ0LWZpbHRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXhELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxpQkFBaUIsRUFBRSxpQkFBaUIsRUFDM0QsbUJBQW1CLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw0REFBNEQsQ0FBQztBQUVuSDtJQVVJO1FBUlEsZUFBVSxHQUFVLEVBQUUsQ0FBQztRQUMvQixnQkFBVyxHQUFRLEVBQUUsQ0FBQztRQUV0QixrQkFBYSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFFOUIsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzdCLG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUVmLENBQUM7Ozs7O0lBR2pCLHdEQUFtQjs7OztJQUFuQixVQUFvQixHQUFROztZQUNwQixpQkFBaUIsR0FBUTtZQUN6QixXQUFXLEVBQUUsTUFBTTtTQUN0QjtRQUNELElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxTQUFTLEVBQUU7WUFDMUIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxNQUFNLEtBQUssU0FBUyxFQUFFO2dCQUNqQyxJQUFJLEdBQUcsQ0FBQyxTQUFTLEVBQUU7b0JBQ2YsSUFBSSxPQUFPLEdBQUcsQ0FBQyxTQUFTLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRTs7NEJBQ2xFLE9B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b3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDb2x1bW5GaWx0ZXJUeXBlIH0gZnJvbSAnLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5cclxuaW1wb3J0IHsgQm9vbGVhbkZpbHRlckNvbnRyb2wsIERhdGVGaWx0ZXJDb250cm9sLCBFbnVtRmlsdGVyQ29udHJvbCxcclxuICAgICAgICBOdW1iZXJGaWx0ZXJDb250cm9sLCBUZXh0RmlsdGVyQ29udHJvbCB9IGZyb20gJy4uL3BsdWdpbnMvc21hcnQtZmlsdGVyL2NvbnRyb2xEYXRhL2ZpbHRlci1jb250cm9sLm9wdGlvbnMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRTbWFydEZpbHRlclNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBjb25kaXRpb25zOiBhbnlbXSA9IFtdO1xyXG4gICAgY29udHJvbERhdGE6IGFueSA9IFtdO1xyXG5cclxuICAgIGZpbHRlckNoYW5nZWQgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgIHJlbW92ZUZpbHRlciA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjbGVhckFsbEZpbHRlciA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcblxyXG4gICAgZ2V0Q29sdW1uRmlsdGVyRGF0YShjb2w6IGFueSkge1xyXG4gICAgICAgIGxldCBmaWx0ZXJDb250cm9sRGF0YTogYW55ID0ge1xyXG4gICAgICAgICAgICBjb250cm9sdHlwZTogJ3RleHQnLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGNvbC5maWx0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5maWx0ZXIgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbC5mb3JtYXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5mb3JtYXR0ZXIgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKGNvbC5mb3JtYXR0ZXIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zOiBhbnkgPSBjb2wuZm9ybWF0dGVyWydvcHRpb25zJ107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY29sLmZvcm1hdHRlclsndHlwZSddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJGaWx0ZXJDb250cm9sKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlbnVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRW51bUZpbHRlckNvbnRyb2woY29sLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuRmlsdGVyQ29udHJvbChjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGF0ZXRpbWUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0eWUgPSAnZGF0ZXRpbWUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmbXQgPSAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJldHVybkZtdCA9ICd5eXl5LU1NLWRkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZtdC5pbmRleE9mKCdISDonKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHllID0gJ2RhdGUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRm10ICs9ICcgSEg6bW0nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZtdC5pbmRleE9mKCdzcycpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5GbXQgKz0gJzpzcyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eWUgPSAnZGF0ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckNvbnRyb2xEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sdHlwZTogJ2ZsZXhpYmxlRGF0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQ6IGZtdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1R5cGU6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUaW1lOiB0eWUgPT09ICdkYXRldGltZSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVGV4dEZpbHRlckNvbnRyb2woY29sKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJDb250cm9sRGF0YTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY29sLmZpbHRlci50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmVudW06XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBFbnVtRmlsdGVyQ29udHJvbChjb2wsIGNvbC5maWx0ZXIub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGU6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGV0aW1lOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZUZpbHRlckNvbnRyb2woY29sLCBjb2wuZmlsdGVyLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sdW1uRmlsdGVyVHlwZS5udW1iZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJGaWx0ZXJDb250cm9sKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmJvb2xlYW46XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuRmlsdGVyQ29udHJvbChjb2wpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmlsdGVyQ29udHJvbERhdGE7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBmaWx0ZXJDb25kaXRpb25DaGFuZ2VkKGU6IHtjb25kaXRpb25zOiBhbnlbXSwgY29udHJvbERhdGE6IGFueSwgZnJvbTogJ3Rvb2xiYXInIHwgJ3BhbmVsJ30pIHtcclxuICAgICAgICBjb25zdCBpdGVtcyA9IGUuY29uZGl0aW9ucztcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbmRpdGlvbnMgfHwgIXRoaXMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2goLi4uaXRlbXMpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xEYXRhLnB1c2goey4uLmUuY29udHJvbERhdGF9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLy8gVE9ETywgQ09OVFJPTERBVEEg55qE57Si5byV5LiOY29uZGl0aW9ucyDnmoTntKLlvJXlvojlj6/og73kuI3mmK8x5LiqXHJcbiAgICAgICAgICAgIGlmIChlLmZyb20gPT09ICd0b29sYmFyJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gWy4uLml0ZW1zXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHRoaXMuY29uZGl0aW9ucy5maWx0ZXIobiA9PiBuLkZpbHRlckZpZWxkICE9PSBpdGVtc1swXS5GaWx0ZXJGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2goeyAuLi5pdGVtc1swXSB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2goLi4uaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZS5jb250cm9sRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3RybElkeCA9IHRoaXMuY29udHJvbERhdGEuZmluZEluZGV4KG4gPT4gbi5sYWJlbENvZGUgPT09IGUuY29udHJvbERhdGEubGFiZWxDb2RlKTtcclxuICAgICAgICAgICAgICAgIGlmIChjdHJsSWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xEYXRhW2N0cmxJZHhdID0gey4uLmUuY29udHJvbERhdGF9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xEYXRhLnB1c2goey4uLmUuY29udHJvbERhdGF9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VkLm5leHQoe2NvbmRpdGlvbnM6IFsuLi50aGlzLmNvbmRpdGlvbnNdLCBjb250cm9sRGF0YTogWy4uLnRoaXMuY29udHJvbERhdGFdIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUNvbmRpdGlvbihlLCBlbWl0UmVtb3ZlID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAodGhpcy5jb25kaXRpb25zICYmIHRoaXMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zLmZpbHRlcihuID0+IG4uRmlsdGVyRmllbGQgIT09IGUubGFiZWxDb2RlKTtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sRGF0YSA9IHRoaXMuY29udHJvbERhdGEuZmlsdGVyKG4gPT4gbi5sYWJlbENvZGUgIT09IGUubGFiZWxDb2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VkLm5leHQoe2NvbmRpdGlvbnM6IFsuLi50aGlzLmNvbmRpdGlvbnNdLCBjb250cm9sRGF0YTogWy4uLnRoaXMuY29udHJvbERhdGFdIH0pO1xyXG4gICAgICAgIGlmIChlbWl0UmVtb3ZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRmlsdGVyLm5leHQoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyQWxsKCkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY29udHJvbERhdGEgPSBbXTtcclxuICAgICAgICB0aGlzLmNsZWFyQWxsRmlsdGVyLm5leHQobnVsbCk7XHJcbiAgICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { LocaleService } from '@farris/ui-locale';
import { Injectable, Injector, EventEmitter } from '@angular/core';
import { Compare } from '@farris/ui-common/types';
import { DatagridFacadeService } from './datagrid-facade.service';
import { Utils } from './../utils/utils';
import { ColumnFilterType } from '../types/data-column';
import { DatagridColumnsHelper } from './datagrid-columns.helper';
import { trim } from 'lodash-es';
var DatagridFilterService = /** @class */ (function () {
    function DatagridFilterService(dfs, localeSer, inject) {
        this.dfs = dfs;
        this.localeSer = localeSer;
        this.inject = inject;
        this.removeField = new EventEmitter();
    }
    /**
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.validateRowData = /**
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        if (!conditions || Object.keys(conditions).length === 0) {
            return true;
        }
        return this.checkAllFieldInRowData(rowData, conditions);
    };
    /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.executeFilter = /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    function (data, conditions) {
        var _this = this;
        if (this.dfs.getState().enableSmartFilter) {
            return this.executeSmartFilter(data, conditions);
        }
        if (data && data.length) {
            return data.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.validateRowData(n, conditions); }));
        }
        return data;
    };
    /**
     * @private
     * @param {?} fieldDataValue
     * @param {?} operator
     * @param {?} targetValue
     * @return {?}
     */
    DatagridFilterService.prototype.getCompareResult = /**
     * @private
     * @param {?} fieldDataValue
     * @param {?} operator
     * @param {?} targetValue
     * @return {?}
     */
    function (fieldDataValue, operator, targetValue) {
        /** @type {?} */
        var op = parseInt('' + operator, 10);
        switch (op) {
            case Compare.Equal:
                return fieldDataValue == targetValue;
            case Compare.NotEqual:
                return ('' + fieldDataValue).toLowerCase() !== ('' + targetValue).toLowerCase();
            case Compare.Greater:
                return fieldDataValue > targetValue;
            case Compare.GreaterOrEqual:
                return fieldDataValue >= targetValue;
            case Compare.Less:
                return fieldDataValue < targetValue;
            case Compare.LessOrEqual:
                return fieldDataValue <= targetValue;
            case Compare.Like:
                if (fieldDataValue == null) {
                    fieldDataValue = '';
                }
                return ('' + fieldDataValue).toLowerCase().indexOf(targetValue.toLowerCase()) > -1;
            case Compare.NotLike:
                return ('' + fieldDataValue).toLowerCase().indexOf(targetValue.toLowerCase()) === -1;
            case Compare.In:
                targetValue = targetValue || [];
                return targetValue.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n == fieldDataValue; })) > -1;
            case 1001: // Empty
                return trim(fieldDataValue) === '' || fieldDataValue === null || fieldDataValue === undefined;
            case 1002: // NotEmpty
                return trim(fieldDataValue) !== '' && fieldDataValue !== null && fieldDataValue !== undefined;
            case 1003: // Null
                return fieldDataValue === null;
            case 1004: // NotNull
                return fieldDataValue !== null;
        }
    };
    /**
     * @private
     * @param {?} result1
     * @param {?} relation
     * @param {?} result2
     * @return {?}
     */
    DatagridFilterService.prototype.getRelationResult = /**
     * @private
     * @param {?} result1
     * @param {?} relation
     * @param {?} result2
     * @return {?}
     */
    function (result1, relation, result2) {
        /** @type {?} */
        var _relation = relation.toLowerCase();
        if (_relation === 'and') {
            return result1 && result2;
        }
        else {
            return result1 || result2;
        }
    };
    /**
     * @private
     * @param {?} resultObj
     * @return {?}
     */
    DatagridFilterService.prototype.checkAllFieldResult = /**
     * @private
     * @param {?} resultObj
     * @return {?}
     */
    function (resultObj) {
        if (!resultObj) {
            return true;
        }
        return Object.values(resultObj).reduce((/**
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        function (c, n) {
            return c && n;
        }), true);
    };
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.checkAllFieldInRowData = /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        var _this = this;
        // this.state = conditions;
        /** @type {?} */
        var resultObj = null;
        if (conditions) {
            /** @type {?} */
            var fields = Object.keys(conditions);
            resultObj = {};
            fields.forEach((/**
             * @param {?} field
             * @return {?}
             */
            function (field) {
                /** @type {?} */
                var fieldValue = Utils.getValue(field, rowData);
                /** @type {?} */
                var columnObj = _this.dfs.getColumn(field);
                if (columnObj && columnObj.isMultilingualField) {
                    fieldValue = Utils.getMultilingualValue(fieldValue, _this.localeSer.localeId);
                }
                /** @type {?} */
                var where = conditions[field];
                var value1 = where.value1, operator1 = where.operator1, relation = where.relation, operator2 = where.operator2, value2 = where.value2;
                if (where) {
                    /** @type {?} */
                    var result = _this.getCompareResult(fieldValue, operator1, value1);
                    resultObj[field] = result;
                    if (relation) {
                        /** @type {?} */
                        var result2 = _this.getCompareResult(fieldValue, operator2, value2);
                        resultObj[field] = _this.getRelationResult(result, relation, result2);
                    }
                }
            }));
        }
        return this.checkAllFieldResult(resultObj);
    };
    /**
     * @param {?} field
     * @return {?}
     */
    DatagridFilterService.prototype.removeFilterField = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        this.removeField.emit(field);
    };
    /**
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.convertFilterCondition2String = /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        var _this = this;
        if (!conditions) {
            return '';
        }
        /** @type {?} */
        var str = '';
        /** @type {?} */
        var andText = this.localeSer.getValue('datagrid.filter.and');
        /** @type {?} */
        var orText = this.localeSer.getValue('datagrid.filter.or');
        /** @type {?} */
        var and = "<span class='badge badge-success'>" + andText + "</span>";
        /** @type {?} */
        var and2 = "<span class='badge badge-info'>" + andText + "</span>";
        /** @type {?} */
        var or = "<span class='badge badge-warning'>" + orText + "</span>";
        /** @type {?} */
        var lbracket = "<b>\u3014</b>";
        /** @type {?} */
        var rbracket = "<b>\u3015</b>";
        /** @type {?} */
        var ellipsis = "[ <span class=\"ellipsis\" title=\"$title$\">  $value$<i class=\"f-icon f-icon-lookup\"></i></span> ]";
        str = Object.keys(conditions).reduce((/**
         * @param {?} c
         * @param {?} r
         * @return {?}
         */
        function (c, r) {
            /** @type {?} */
            var filter = conditions[r];
            /** @type {?} */
            var col = _this.dfs.getColumn(r);
            /** @type {?} */
            var t = "<b>" + col.title + "</b>";
            /** @type {?} */
            var s = " " + t + " " + _this.getCompareString(filter.operator1) + " " + Utils.escapeValue(filter.value1) + "  ";
            if (filter.operator1 == Compare.In) {
                /** @type {?} */
                var txt = filter.value1;
                /** @type {?} */
                var txt2 = txt;
                if (col.filter.type === ColumnFilterType.enum) {
                    /** @type {?} */
                    var enumOpts = DatagridColumnsHelper.getFilterEnumOptions(col);
                    txt = DatagridColumnsHelper.getEnumText(enumOpts, filter.value1);
                    txt2 = txt.split(',').slice(0, 2).join(',');
                }
                else {
                    txt2 = txt.slice(0, 2).join(',');
                }
                s = " " + t + " " + _this.getCompareString(filter.operator1) + " [ " + txt + " ]  ";
                if (filter.value1.length > 2) {
                    s = " " + t + " " + _this.getCompareString(filter.operator1) + " " + ellipsis.replace('$title$', txt).replace('$value$', txt2) + "  ";
                }
            }
            else {
                if (filter.operator1 == Compare.Equal && Array.isArray(filter.value1)) {
                    if (!filter.value1.length) {
                        s = " " + t + " " + _this.getCompareString(filter.operator1) + " ''  ";
                    }
                }
            }
            if (filter.relation) {
                /** @type {?} */
                var s2 = t + " " + _this.getCompareString(filter.operator2) + " " + filter.value2;
                s = lbracket + " " + s + " " + (filter.relation === 'and' ? and2 : or) + " " + s2 + " " + rbracket;
            }
            return c + " <span class=\"filter-field filter-column-" + r + "\"> " + s + " AND </span>";
        }), '');
        /** @type {?} */
        var lastANDidx = str.lastIndexOf('AND');
        /** @type {?} */
        var resultStr = str.substr(0, lastANDidx);
        resultStr += str.substr(lastANDidx + 3);
        return resultStr.replace(/AND/g, and).replace(/OR/g, or);
    };
    /**
     * @private
     * @param {?} operator
     * @return {?}
     */
    DatagridFilterService.prototype.getCompareString = /**
     * @private
     * @param {?} operator
     * @return {?}
     */
    function (operator) {
        /** @type {?} */
        var op = parseInt('' + operator, 10);
        /** @type {?} */
        var code = '';
        switch (op) {
            case Compare.Equal:
            case Compare.NotEqual:
            case Compare.Greater:
            case Compare.GreaterOrEqual:
            case Compare.Less:
            case Compare.LessOrEqual:
            case Compare.Like:
            case Compare.NotLike:
            case Compare.In:
                code = Compare[op];
                code = code[0].toLowerCase() + code.substr(1);
                return this.localeSer.getValue('datagrid.filter.operators.' + code);
            case 1001: // Empty
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.empty');
            case 1002: // NotEmpty
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.notEmpty');
            case 1003: // Null
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.null');
            case 1004: // NotNull
                return ' ' + this.localeSer.getValue('datagrid.filter.operators.notNull');
        }
    };
    /**
     * @param {?} condition
     * @return {?}
     */
    DatagridFilterService.prototype.convert2FilterArray = /**
     * @param {?} condition
     * @return {?}
     */
    function (condition) {
        var _this = this;
        /** @type {?} */
        var filterArr = [];
        /** @type {?} */
        var excludeDataTypes = ['number', 'date', 'datetime'];
        if (condition) {
            /** @type {?} */
            var fields = Object.keys(condition);
            if (fields && fields.length) {
                fields.forEach((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) {
                    /** @type {?} */
                    var columnInfo = _this.dfs.getColumn(field);
                    /** @type {?} */
                    var dataType = columnInfo.dataType || 'string';
                    /** @type {?} */
                    var obj = { filterField: field, value: '', lbracket: '', rbracket: '', relation: 1, compare: 0 };
                    /** @type {?} */
                    var conditionVal = condition[field];
                    if (typeof conditionVal === 'object') {
                        // tfs 568484
                        /** @type {?} */
                        var operator1 = parseInt('' + conditionVal.operator1, 10);
                        if (operator1 === 1001 || operator1 === 1002) {
                            obj.compare = operator1 === 1001 ? Compare.Equal : Compare.NotEqual;
                            obj.lbracket = '(';
                            obj.relation = operator1 === 1002 ? 1 : 2;
                            filterArr.push(obj);
                            if (excludeDataTypes.includes(dataType)) {
                                obj.value = null;
                                obj.lbracket = '';
                                obj.relation = 1;
                                obj.compare = operator1 === 1002 ? Compare.IsNot : Compare.Is;
                                return;
                            }
                            /** @type {?} */
                            var obj2 = { filterField: field, value: null, lbracket: '', rbracket: ')', relation: 1, compare: 0 };
                            if (operator1 === 1002) {
                                obj2.compare = Compare.IsNot;
                            }
                            else {
                                obj2.compare = Compare.Is;
                            }
                            filterArr.push(obj2);
                            return;
                        }
                        obj.compare = conditionVal.operator1;
                        obj.value = conditionVal.value1;
                        filterArr.push(obj);
                        if (conditionVal.value2) {
                            obj.lbracket = '(';
                            obj.relation = conditionVal.relation === 'and' ? 1 : 2;
                            /** @type {?} */
                            var obj2 = { filterField: field, value: '', lbracket: '', rbracket: ')', relation: 1, compare: 0 };
                            obj2.compare = conditionVal.operator2;
                            obj2.value = conditionVal.value2;
                            filterArr.push(obj2);
                        }
                        else {
                            if (conditionVal.operator2) {
                                /** @type {?} */
                                var op2 = parseInt('' + conditionVal.operator2, 10);
                                if (op2 === 1001 || op2 === 1002) {
                                    obj.lbracket = '(';
                                    obj.relation = conditionVal.relation === 'and' ? 1 : 2;
                                    /** @type {?} */
                                    var obj2 = { filterField: field, value: '', lbracket: '(', rbracket: '', relation: 2, compare: 0 };
                                    obj2.compare = op2 === 1001 ? Compare.Equal : Compare.NotEqual;
                                    obj2.relation = op2 === 1002 ? 1 : 2;
                                    filterArr.push(obj2);
                                    if (excludeDataTypes.includes(dataType)) {
                                        obj2.value = null;
                                        obj2.lbracket = '';
                                        obj2.rbracket = ')';
                                        obj2.relation = 1;
                                        obj2.compare = op2 === 1002 ? Compare.IsNot : Compare.Is;
                                        return;
                                    }
                                    /** @type {?} */
                                    var obj21 = { filterField: field, value: null, lbracket: '', rbracket: '))', relation: 1, compare: 0 };
                                    obj21.compare = op2 === 1001 ? Compare.Is : Compare.IsNot;
                                    filterArr.push(obj21);
                                }
                            }
                        }
                    }
                    return obj;
                }));
            }
        }
        if (filterArr.length) {
            this.checkEnumTypeFilters(filterArr);
            filterArr[filterArr.length - 1].relation = 0;
        }
        return filterArr;
    };
    /**
     * @private
     * @param {?} filterArr
     * @return {?}
     */
    DatagridFilterService.prototype.checkEnumTypeFilters = /**
     * @private
     * @param {?} filterArr
     * @return {?}
     */
    function (filterArr) {
        var _this = this;
        /** @type {?} */
        var enumFilters = {};
        filterArr.forEach((/**
         * @param {?} f
         * @param {?} i
         * @return {?}
         */
        function (f, i) {
            /** @type {?} */
            var enumFilterArr = _this.convertEnumTypeFilter(f);
            if (enumFilterArr && enumFilterArr.length) {
                enumFilters[f.filterField] = enumFilterArr;
            }
        }));
        /** @type {?} */
        var keys = Object.keys(enumFilters);
        if (keys.length) {
            keys.forEach((/**
             * @param {?} k
             * @return {?}
             */
            function (k) {
                /** @type {?} */
                var i = filterArr.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return n.filterField === k; }));
                filterArr.splice.apply(filterArr, tslib_1.__spread([i, 1], enumFilters[k]));
            }));
        }
        return filterArr;
    };
    // 将enum 类型的条件转换多个条件
    // 将enum 类型的条件转换多个条件
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    DatagridFilterService.prototype.convertEnumTypeFilter = 
    // 将enum 类型的条件转换多个条件
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        if (filter) {
            /** @type {?} */
            var col = (/** @type {?} */ (this.dfs.getColumn(filter.filterField)));
            if (col && col.filter && col.filter.type === ColumnFilterType.enum) {
                if (Array.isArray(filter.value) && filter.value.length) {
                    if (filter.value.length === 1) {
                        filter.compare = Compare.Equal;
                        filter.value = filter.value[0];
                        return [];
                    }
                    else {
                        // > 1
                        /** @type {?} */
                        var filterArr = filter.value.map((/**
                         * @param {?} val
                         * @return {?}
                         */
                        function (val) {
                            return {
                                filterField: filter.filterField,
                                value: val,
                                lbracket: '',
                                rbracket: '',
                                relation: 2,
                                // or
                                compare: 0
                            };
                        }));
                        filterArr[0].lbracket = '(';
                        filterArr[filter.value.length - 1].rbracket = ')';
                        filterArr[filter.value.length - 1].relation = 1;
                        return filterArr;
                    }
                }
            }
        }
        return [];
    };
    /**
     * @param {?} col
     * @return {?}
     */
    DatagridFilterService.prototype.createColumnFilterOptions = /**
     * @param {?} col
     * @return {?}
     */
    function (col) {
        /** @type {?} */
        var filterTypeOptions = {
            type: ColumnFilterType.string,
            enableOperator: true
        };
        if (col.editor) {
            switch (col.editor.type) {
                case 'textarea':
                case 'textbox':
                case 'language-textbox':
                    filterTypeOptions = {
                        type: ColumnFilterType.string,
                        enableOperator: true
                    };
                    break;
                case 'checkbox':
                case 'switch':
                    filterTypeOptions = {
                        type: ColumnFilterType.boolean,
                        enableOperator: false
                    };
                    break;
                case 'numberbox':
                    filterTypeOptions = {
                        type: ColumnFilterType.number,
                        enableOperator: true
                    };
                    break;
                case 'combolist':
                case 'select':
                    filterTypeOptions = {
                        type: ColumnFilterType.enum,
                        enableOperator: true,
                        options: col.editor.options
                    };
                    break;
                case 'datepicker':
                    filterTypeOptions = {
                        type: col['dataType'] === 'datetime' ? ColumnFilterType.datetime : ColumnFilterType.date,
                        enableOperator: true,
                        options: {
                            dateFormat: col.editor.options.dateFormat,
                            returnFormat: col.editor.options.returnFormat
                        }
                    };
                    break;
                case 'timepicker':
                    filterTypeOptions = {
                        type: ColumnFilterType.time,
                        enableOperator: true
                    };
                    break;
            }
        }
        else if (col.formatter) {
            if (typeof col.formatter === 'object' && Object.keys(col.formatter).length) {
                /** @type {?} */
                var options = col.formatter['options'];
                switch (col.formatter['type']) {
                    case 'number':
                        filterTypeOptions = {
                            type: ColumnFilterType.number,
                            enableOperator: true
                        };
                        break;
                    case 'enum':
                        filterTypeOptions = {
                            type: ColumnFilterType.enum,
                            enableOperator: true,
                            options: options
                        };
                        break;
                    case 'boolean':
                        filterTypeOptions = {
                            type: ColumnFilterType.boolean,
                            enableOperator: false
                        };
                        break;
                    case 'datetime':
                        /** @type {?} */
                        var tye = ColumnFilterType.datetime;
                        /** @type {?} */
                        var fmt = 'yyyy-MM-dd';
                        /** @type {?} */
                        var returnFmt = 'yyyy-MM-dd';
                        if (options && options.format) {
                            fmt = options.format;
                            if (fmt.indexOf('HH:') == -1) {
                                tye = ColumnFilterType.date;
                            }
                            else {
                                returnFmt += ' HH:mm';
                                if (fmt.indexOf('ss') > -1) {
                                    returnFmt += ':ss';
                                }
                            }
                        }
                        else {
                            tye = ColumnFilterType.date;
                        }
                        filterTypeOptions = {
                            type: tye,
                            enableOperator: true
                        };
                        filterTypeOptions.options = { dateFormat: fmt, returnFormat: returnFmt };
                        break;
                    default:
                        filterTypeOptions = {
                            type: ColumnFilterType.string,
                            enableOperator: true
                        };
                }
            }
        }
        else {
            filterTypeOptions = {
                type: ColumnFilterType.string,
                enableOperator: true
            };
        }
        return filterTypeOptions;
    };
    //#region  Smart Filter
    //#region  Smart Filter
    /**
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.convertSmartFilter2EntityFilter = 
    //#region  Smart Filter
    /**
     * @param {?} conditions
     * @return {?}
     */
    function (conditions) {
        if (conditions && conditions.length) {
            return conditions.map((/**
             * @param {?} n
             * @return {?}
             */
            function (n) {
                return n;
            }));
        }
        return [];
    };
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.validateRowData2 = /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        if (!conditions || conditions.length === 0) {
            return true;
        }
        return this.checkRowDataWithCondition(rowData, conditions);
    };
    /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.checkRowDataWithCondition = /**
     * @private
     * @param {?} rowData
     * @param {?} conditions
     * @return {?}
     */
    function (rowData, conditions) {
        var _this = this;
        /** @type {?} */
        var resultObj = null;
        if (conditions) {
            resultObj = {};
            conditions.forEach((/**
             * @param {?} condition
             * @return {?}
             */
            function (condition) {
                /** @type {?} */
                var field = condition.FilterField;
                /** @type {?} */
                var fieldValue = Utils.getValue(field, rowData);
                /** @type {?} */
                var columnObj = _this.dfs.getColumn(field);
                if (columnObj && columnObj.isMultilingualField) {
                    fieldValue = Utils.getMultilingualValue(fieldValue, _this.localeSer.localeId);
                }
                /** @type {?} */
                var where = condition;
                var Value = where.Value, Relation = where.Relation, operator1 = where.Compare;
                if (where) {
                    /** @type {?} */
                    var r = _this.getCompareResult(fieldValue, operator1, Value);
                    if (resultObj[field] === undefined) {
                        resultObj[field] = [r];
                    }
                    else {
                        resultObj[field].push(r);
                    }
                }
            }));
        }
        // return this.checkAllFieldResult(resultObj);
        /** @type {?} */
        var fields = Object.keys(resultObj);
        /** @type {?} */
        var result = [];
        fields.forEach((/**
         * @param {?} f
         * @return {?}
         */
        function (f) {
            /** @type {?} */
            var _filters = conditions.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.FilterField === f; }));
            if (resultObj[f].length === 1) {
                result.push(resultObj[f][0]);
            }
            else {
                if (_filters[0].Relation === 1 && resultObj[f].length === 2) { // and
                    result.push(resultObj[f][0] && resultObj[f][1]);
                }
                else { // or
                    result.push(resultObj[f].indexOf(true) > -1);
                }
            }
        }));
        return result.indexOf(false) === -1;
    };
    /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    DatagridFilterService.prototype.executeSmartFilter = /**
     * @param {?} data
     * @param {?} conditions
     * @return {?}
     */
    function (data, conditions) {
        var _this = this;
        if (data && data.length) {
            return data.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return _this.validateRowData2(n, conditions); }));
        }
        return data;
    };
    DatagridFilterService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DatagridFilterService.ctorParameters = function () { return [
        { type: DatagridFacadeService },
        { type: LocaleService },
        { type: Injector }
    ]; };
    return DatagridFilterService;
}());
export { DatagridFilterService };
if (false) {
    /** @type {?} */
    DatagridFilterService.prototype.removeField;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.localeSer;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterService.prototype.inject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWZpbHRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUM3RSxPQUFPLEVBQUUsT0FBTyxFQUE2QixNQUFNLHlCQUF5QixDQUFDO0FBQzdFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUN6QyxPQUFPLEVBQWMsZ0JBQWdCLEVBQTBELE1BQU0sc0JBQXNCLENBQUM7QUFDNUgsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVqQztJQUlJLCtCQUFvQixHQUEwQixFQUFVLFNBQXdCLEVBQVUsTUFBZ0I7UUFBdEYsUUFBRyxHQUFILEdBQUcsQ0FBdUI7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVTtRQUYxRyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7SUFHekMsQ0FBQzs7Ozs7O0lBRUQsK0NBQWU7Ozs7O0lBQWYsVUFBZ0IsT0FBWSxFQUFFLFVBQXNEO1FBQ2hGLElBQUksQ0FBQyxVQUFVLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3JELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFP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SSxPQUFBLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLEVBQXBDLENBQW9DLEVBQUMsQ0FBQztTQUNqRTtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7O2dCQWpoQkosVUFBVTs7OztnQkFORixxQkFBcUI7Z0JBSHJCLGFBQWE7Z0JBQ0QsUUFBUTs7SUE0aEI3Qiw0QkFBQztDQUFBLEFBcGhCRCxJQW9oQkM7U0FuaEJZLHFCQUFxQjs7O0lBQzlCLDRDQUF5Qzs7Ozs7SUFFN0Isb0NBQWtDOzs7OztJQUFFLDBDQUFnQzs7Ozs7SUFBRSx1Q0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgRXZlbnRFbWl0dGVyLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21wYXJlLCBGaWx0ZXJDb25kaXRpb24sIFJlbGF0aW9uIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vdHlwZXMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEZhY2FkZVNlcnZpY2UgfSBmcm9tICcuL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLy4uL3V0aWxzL3V0aWxzJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiwgQ29sdW1uRmlsdGVyVHlwZSwgQ29sdW1uRmlsdGVyLCBGaWx0ZXJDb25kaXRpb24gYXMgQ2xpZW50RmlsdGVyQ29uZGl0aW9uIH0gZnJvbSAnLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbHVtbnNIZWxwZXIgfSBmcm9tICcuL2RhdGFncmlkLWNvbHVtbnMuaGVscGVyJztcclxuaW1wb3J0IHsgdHJpbSB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZEZpbHRlclNlcnZpY2Uge1xyXG4gICAgcmVtb3ZlRmllbGQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRmczogRGF0YWdyaWRGYWNhZGVTZXJ2aWNlLCBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSwgcHJpdmF0ZSBpbmplY3Q6IEluamVjdG9yKSB7XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVSb3dEYXRhKHJvd0RhdGE6IGFueSwgY29uZGl0aW9uczogeyBbZmllbGQ6IHN0cmluZ106IENsaWVudEZpbHRlckNvbmRpdGlvbiB9KSB7XHJcbiAgICAgICAgaWYgKCFjb25kaXRpb25zIHx8IE9iamVjdC5rZXlzKGNvbmRpdGlvbnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZEluUm93RGF0YShyb3dEYXRhLCBjb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBleGVjdXRlRmlsdGVyKGRhdGE6IFtdLCBjb25kaXRpb25zOiBhbnkpOiBhbnlbXSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLmRmcy5nZXRTdGF0ZSgpLmVuYWJsZVNtYXJ0RmlsdGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVTbWFydEZpbHRlcihkYXRhLCBjb25kaXRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmZpbHRlcihuID0+IHRoaXMudmFsaWRhdGVSb3dEYXRhKG4sIGNvbmRpdGlvbnMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb21wYXJlUmVzdWx0KGZpZWxkRGF0YVZhbHVlOiBhbnksIG9wZXJhdG9yOiBDb21wYXJlLCB0YXJnZXRWYWx1ZTogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgb3AgPSBwYXJzZUludCgnJyArIG9wZXJhdG9yLCAxMCk7XHJcbiAgICAgICAgc3dpdGNoIChvcCkge1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuRXF1YWw6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPT0gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RFcXVhbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyBmaWVsZERhdGFWYWx1ZSkudG9Mb3dlckNhc2UoKSAhPT0gKCcnICsgdGFyZ2V0VmFsdWUpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlID4gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5HcmVhdGVyT3JFcXVhbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZERhdGFWYWx1ZSA+PSB0YXJnZXRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3M6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGREYXRhVmFsdWUgPCB0YXJnZXRWYWx1ZTtcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3NPckVxdWFsOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlIDw9IHRhcmdldFZhbHVlO1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuTGlrZTpcclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZERhdGFWYWx1ZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGREYXRhVmFsdWUgPSAnJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiAoJycgKyBmaWVsZERhdGFWYWx1ZSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRhcmdldFZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTE7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5Ob3RMaWtlOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgnJyArIGZpZWxkRGF0YVZhbHVlKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGFyZ2V0VmFsdWUudG9Mb3dlckNhc2UoKSkgPT09IC0xO1xyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuSW46XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRWYWx1ZSA9IHRhcmdldFZhbHVlIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFZhbHVlLmZpbmRJbmRleCggbiA9PiBuID09IGZpZWxkRGF0YVZhbHVlKSA+IC0xO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDE6IC8vIEVtcHR5XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJpbShmaWVsZERhdGFWYWx1ZSkgPT09ICcnIHx8IGZpZWxkRGF0YVZhbHVlID09PSBudWxsIHx8IGZpZWxkRGF0YVZhbHVlID09PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwMjogIC8vIE5vdEVtcHR5XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJpbShmaWVsZERhdGFWYWx1ZSkgIT09ICcnICYmIGZpZWxkRGF0YVZhbHVlICE9PSBudWxsICYmIGZpZWxkRGF0YVZhbHVlICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwMzogLy8gTnVsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkRGF0YVZhbHVlID09PSBudWxsO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDQ6IC8vIE5vdE51bGxcclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZERhdGFWYWx1ZSAhPT0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSZWxhdGlvblJlc3VsdChyZXN1bHQxOiBib29sZWFuLCByZWxhdGlvbjogJ2FuZCcgfCAnb3InLCByZXN1bHQyOiBib29sZWFuKSB7XHJcbiAgICAgICAgY29uc3QgX3JlbGF0aW9uID0gcmVsYXRpb24udG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBpZiAoX3JlbGF0aW9uID09PSAnYW5kJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0MSAmJiByZXN1bHQyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQxIHx8IHJlc3VsdDI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tBbGxGaWVsZFJlc3VsdChyZXN1bHRPYmo6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9KSB7XHJcbiAgICAgICAgaWYgKCFyZXN1bHRPYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhyZXN1bHRPYmopLnJlZHVjZSgoYywgbikgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gYyAmJiBuO1xyXG4gICAgICAgIH0sIHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tBbGxGaWVsZEluUm93RGF0YShyb3dEYXRhOiBhbnksIGNvbmRpdGlvbnM6IHsgW2ZpZWxkOiBzdHJpbmddOiBDbGllbnRGaWx0ZXJDb25kaXRpb24gfSkge1xyXG4gICAgICAgIC8vIHRoaXMuc3RhdGUgPSBjb25kaXRpb25zO1xyXG4gICAgICAgIGxldCByZXN1bHRPYmogPSBudWxsO1xyXG4gICAgICAgIGlmIChjb25kaXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IE9iamVjdC5rZXlzKGNvbmRpdGlvbnMpO1xyXG4gICAgICAgICAgICByZXN1bHRPYmogPSB7fTtcclxuICAgICAgICAgICAgZmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkVmFsdWUgPSBVdGlscy5nZXRWYWx1ZShmaWVsZCwgcm93RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW5PYmogPSB0aGlzLmRmcy5nZXRDb2x1bW4oZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbk9iaiAmJiBjb2x1bW5PYmouaXNNdWx0aWxpbmd1YWxGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkVmFsdWUgPSBVdGlscy5nZXRNdWx0aWxpbmd1YWxWYWx1ZShmaWVsZFZhbHVlLCB0aGlzLmxvY2FsZVNlci5sb2NhbGVJZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qgd2hlcmUgPSBjb25kaXRpb25zW2ZpZWxkXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWUxLCBvcGVyYXRvcjEsIHJlbGF0aW9uLCBvcGVyYXRvcjIsIHZhbHVlMiB9ID0gd2hlcmU7XHJcbiAgICAgICAgICAgICAgICBpZiAod2hlcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmdldENvbXBhcmVSZXN1bHQoZmllbGRWYWx1ZSAsIG9wZXJhdG9yMSwgdmFsdWUxKTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRPYmpbZmllbGRdID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWxhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQyID0gdGhpcy5nZXRDb21wYXJlUmVzdWx0KGZpZWxkVmFsdWUsIG9wZXJhdG9yMiwgdmFsdWUyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW2ZpZWxkXSA9IHRoaXMuZ2V0UmVsYXRpb25SZXN1bHQocmVzdWx0LCByZWxhdGlvbiwgcmVzdWx0Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0FsbEZpZWxkUmVzdWx0KHJlc3VsdE9iaik7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlRmlsdGVyRmllbGQoZmllbGQpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUZpZWxkLmVtaXQoZmllbGQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnZlcnRGaWx0ZXJDb25kaXRpb24yU3RyaW5nKGNvbmRpdGlvbnM6IGFueSkge1xyXG4gICAgICAgIGlmICghY29uZGl0aW9ucykge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBzdHIgPSAnJztcclxuICAgICAgICBjb25zdCBhbmRUZXh0ID0gdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5hbmQnKTtcclxuICAgICAgICBjb25zdCBvclRleHQgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9yJyk7XHJcbiAgICAgICAgY29uc3QgYW5kID0gYDxzcGFuIGNsYXNzPSdiYWRnZSBiYWRnZS1zdWNjZXNzJz4ke2FuZFRleHR9PC9zcGFuPmA7XHJcbiAgICAgICAgY29uc3QgYW5kMiA9IGA8c3BhbiBjbGFzcz0nYmFkZ2UgYmFkZ2UtaW5mbyc+JHthbmRUZXh0fTwvc3Bhbj5gO1xyXG4gICAgICAgIGNvbnN0IG9yID0gYDxzcGFuIGNsYXNzPSdiYWRnZSBiYWRnZS13YXJuaW5nJz4ke29yVGV4dH08L3NwYW4+YDtcclxuICAgICAgICBjb25zdCBsYnJhY2tldCA9IGA8Yj7jgJQ8L2I+YDtcclxuICAgICAgICBjb25zdCByYnJhY2tldCA9IGA8Yj7jgJU8L2I+YDtcclxuICAgICAgICBjb25zdCBlbGxpcHNpcyA9IGBbIDxzcGFuIGNsYXNzPVwiZWxsaXBzaXNcIiB0aXRsZT1cIiR0aXRsZSRcIj4gICR2YWx1ZSQ8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPjwvc3Bhbj4gXWA7XHJcblxyXG4gICAgICAgIHN0ciA9IE9iamVjdC5rZXlzKGNvbmRpdGlvbnMpLnJlZHVjZSgoYywgcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBjb25kaXRpb25zW3JdO1xyXG4gICAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmRmcy5nZXRDb2x1bW4ocik7XHJcbiAgICAgICAgICAgIGNvbnN0IHQgPSBgPGI+JHtjb2wudGl0bGV9PC9iPmA7XHJcblxyXG4gICAgICAgICAgICBsZXQgcyA9IGAgJHt0fSAke3RoaXMuZ2V0Q29tcGFyZVN0cmluZyhmaWx0ZXIub3BlcmF0b3IxKX0gJHtVdGlscy5lc2NhcGVWYWx1ZShmaWx0ZXIudmFsdWUxKX0gIGA7XHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXIub3BlcmF0b3IxID09IENvbXBhcmUuSW4pIHtcclxuICAgICAgICAgICAgICAgIGxldCB0eHQgPSBmaWx0ZXIudmFsdWUxO1xyXG4gICAgICAgICAgICAgICAgbGV0IHR4dDIgPSB0eHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmVudW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbnVtT3B0cyA9IERhdGFncmlkQ29sdW1uc0hlbHBlci5nZXRGaWx0ZXJFbnVtT3B0aW9ucyhjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgIHR4dCA9IERhdGFncmlkQ29sdW1uc0hlbHBlci5nZXRFbnVtVGV4dChlbnVtT3B0cywgZmlsdGVyLnZhbHVlMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHh0MiA9IHR4dC5zcGxpdCgnLCcpLnNsaWNlKDAsIDIpLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHh0MiA9IHR4dC5zbGljZSgwLCAyKS5qb2luKCcsJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcyA9IGAgJHt0fSAke3RoaXMuZ2V0Q29tcGFyZVN0cmluZyhmaWx0ZXIub3BlcmF0b3IxKX0gWyAke3R4dH0gXSAgYDtcclxuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIudmFsdWUxLmxlbmd0aCA+IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzID0gYCAke3R9ICR7dGhpcy5nZXRDb21wYXJlU3RyaW5nKGZpbHRlci5vcGVyYXRvcjEpfSAke2VsbGlwc2lzLnJlcGxhY2UoJyR0aXRsZSQnLCB0eHQpLnJlcGxhY2UoJyR2YWx1ZSQnLCB0eHQyKX0gIGA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLm9wZXJhdG9yMSA9PSBDb21wYXJlLkVxdWFsICYmIEFycmF5LmlzQXJyYXkoZmlsdGVyLnZhbHVlMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbHRlci52YWx1ZTEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBgICR7dH0gJHt0aGlzLmdldENvbXBhcmVTdHJpbmcoZmlsdGVyLm9wZXJhdG9yMSl9ICcnICBgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZmlsdGVyLnJlbGF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzMiA9IGAke3R9ICR7dGhpcy5nZXRDb21wYXJlU3RyaW5nKGZpbHRlci5vcGVyYXRvcjIpfSAke2ZpbHRlci52YWx1ZTJ9YDtcclxuICAgICAgICAgICAgICAgIHMgPSBgJHtsYnJhY2tldH0gJHtzfSAke2ZpbHRlci5yZWxhdGlvbiA9PT0gJ2FuZCcgPyBhbmQyIDogb3J9ICR7czJ9ICR7cmJyYWNrZXR9YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYCR7Y30gPHNwYW4gY2xhc3M9XCJmaWx0ZXItZmllbGQgZmlsdGVyLWNvbHVtbi0ke3J9XCI+ICR7c30gQU5EIDwvc3Bhbj5gO1xyXG4gICAgICAgIH0sICcnKTtcclxuICAgICAgICBjb25zdCBsYXN0QU5EaWR4ID0gc3RyLmxhc3RJbmRleE9mKCdBTkQnKTtcclxuICAgICAgICBsZXQgcmVzdWx0U3RyID0gc3RyLnN1YnN0cigwLCBsYXN0QU5EaWR4KTtcclxuICAgICAgICByZXN1bHRTdHIgKz0gc3RyLnN1YnN0cihsYXN0QU5EaWR4ICsgMyk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFN0ci5yZXBsYWNlKC9BTkQvZywgYW5kKS5yZXBsYWNlKC9PUi9nLCBvcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRDb21wYXJlU3RyaW5nKG9wZXJhdG9yOiBDb21wYXJlKSB7XHJcbiAgICAgICAgY29uc3Qgb3AgPSBwYXJzZUludCgnJyArIG9wZXJhdG9yLCAxMCk7XHJcbiAgICAgICAgbGV0IGNvZGUgPSAnJztcclxuICAgICAgICBzd2l0Y2ggKG9wKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5FcXVhbDpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLk5vdEVxdWFsOlxyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuR3JlYXRlcjpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkdyZWF0ZXJPckVxdWFsOlxyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuTGVzczpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLkxlc3NPckVxdWFsOlxyXG4gICAgICAgICAgICBjYXNlIENvbXBhcmUuTGlrZTpcclxuICAgICAgICAgICAgY2FzZSBDb21wYXJlLk5vdExpa2U6XHJcbiAgICAgICAgICAgIGNhc2UgQ29tcGFyZS5JbjpcclxuICAgICAgICAgICAgICAgIGNvZGUgPSBDb21wYXJlW29wXTtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSBjb2RlWzBdLnRvTG93ZXJDYXNlKCkgKyBjb2RlLnN1YnN0cigxKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9wZXJhdG9ycy4nICsgY29kZSk7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwMTogLy8gRW1wdHlcclxuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm9wZXJhdG9ycy5lbXB0eScpO1xyXG4gICAgICAgICAgICBjYXNlIDEwMDI6ICAvLyBOb3RFbXB0eVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcgJyArIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIub3BlcmF0b3JzLm5vdEVtcHR5Jyk7XHJcbiAgICAgICAgICAgIGNhc2UgMTAwMzogLy8gTnVsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcgJyArIHRoaXMubG9jYWxlU2VyLmdldFZhbHVlKCdkYXRhZ3JpZC5maWx0ZXIub3BlcmF0b3JzLm51bGwnKTtcclxuICAgICAgICAgICAgY2FzZSAxMDA0OiAvLyBOb3ROdWxsXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJyAnICsgdGhpcy5sb2NhbGVTZXIuZ2V0VmFsdWUoJ2RhdGFncmlkLmZpbHRlci5vcGVyYXRvcnMubm90TnVsbCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0MkZpbHRlckFycmF5KGNvbmRpdGlvbjogeyBbZmllbGQ6IHN0cmluZ106IGFueSB9KTogRmlsdGVyQ29uZGl0aW9uW10ge1xyXG4gICAgICAgIGNvbnN0IGZpbHRlckFyciA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGV4Y2x1ZGVEYXRhVHlwZXMgPSBbJ251bWJlcicsICdkYXRlJywgJ2RhdGV0aW1lJ107XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBPYmplY3Qua2V5cyhjb25kaXRpb24pO1xyXG4gICAgICAgICAgICBpZiAoZmllbGRzICYmIGZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1uSW5mbyA9IHRoaXMuZGZzLmdldENvbHVtbihmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YVR5cGUgPSBjb2x1bW5JbmZvLmRhdGFUeXBlIHx8ICdzdHJpbmcnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7IGZpbHRlckZpZWxkOiBmaWVsZCwgdmFsdWU6ICcnLCBsYnJhY2tldDogJycsIHJicmFja2V0OiAnJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb25WYWwgPSBjb25kaXRpb25bZmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZGl0aW9uVmFsID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0ZnMgNTY4NDg0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9yMSA9IHBhcnNlSW50KCcnICsgY29uZGl0aW9uVmFsLm9wZXJhdG9yMSwgMTApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3BlcmF0b3IxID09PSAxMDAxIHx8IG9wZXJhdG9yMSA9PT0gMTAwMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNvbXBhcmUgPSBvcGVyYXRvcjEgPT09IDEwMDEgPyBDb21wYXJlLkVxdWFsIDogQ29tcGFyZS5Ob3RFcXVhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5sYnJhY2tldCA9ICcoJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWxhdGlvbiA9IG9wZXJhdG9yMSA9PT0gMTAwMiA/IDEgOiAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyQXJyLnB1c2gob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleGNsdWRlRGF0YVR5cGVzLmluY2x1ZGVzKGRhdGFUeXBlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmxicmFja2V0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlbGF0aW9uID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY29tcGFyZSA9IG9wZXJhdG9yMSA9PT0gMTAwMiA/IENvbXBhcmUuSXNOb3QgOiBDb21wYXJlLklzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmoyID0geyBmaWx0ZXJGaWVsZDogZmllbGQsIHZhbHVlOiBudWxsLCBsYnJhY2tldDogJycsIHJicmFja2V0OiAnKScsIHJlbGF0aW9uOiAxLCBjb21wYXJlOiAwIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdG9yMSA9PT0gMTAwMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IENvbXBhcmUuSXNOb3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IENvbXBhcmUuSXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckFyci5wdXNoKG9iajIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY29tcGFyZSA9IGNvbmRpdGlvblZhbC5vcGVyYXRvcjE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai52YWx1ZSA9IGNvbmRpdGlvblZhbC52YWx1ZTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckFyci5wdXNoKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb25WYWwudmFsdWUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVsYXRpb24gPSBjb25kaXRpb25WYWwucmVsYXRpb24gPT09ICdhbmQnID8gMSA6IDI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqMiA9IHsgZmlsdGVyRmllbGQ6IGZpZWxkLCB2YWx1ZTogJycsIGxicmFja2V0OiAnJywgcmJyYWNrZXQ6ICcpJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IGNvbmRpdGlvblZhbC5vcGVyYXRvcjI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnZhbHVlID0gY29uZGl0aW9uVmFsLnZhbHVlMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25kaXRpb25WYWwub3BlcmF0b3IyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3AyID0gcGFyc2VJbnQoJycgKyBjb25kaXRpb25WYWwub3BlcmF0b3IyLCAxMCk7IC8vICBFbXB0eTogMTAwMSwgTm90RW1wdHk6IDEwMDJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3AyID09PSAxMDAxIHx8IG9wMiA9PT0gMTAwMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZWxhdGlvbiA9IGNvbmRpdGlvblZhbC5yZWxhdGlvbiA9PT0gJ2FuZCcgPyAxIDogMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iajIgPSB7IGZpbHRlckZpZWxkOiBmaWVsZCwgdmFsdWU6ICcnLCBsYnJhY2tldDogJygnLCByYnJhY2tldDogJycsIHJlbGF0aW9uOiAyLCBjb21wYXJlOiAwIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IG9wMiA9PT0gMTAwMSA/IENvbXBhcmUuRXF1YWwgOiBDb21wYXJlLk5vdEVxdWFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnJlbGF0aW9uID0gb3AyID09PSAxMDAyPyAxOiAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4Y2x1ZGVEYXRhVHlwZXMuaW5jbHVkZXMoZGF0YVR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIubGJyYWNrZXQgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIucmJyYWNrZXQgPSAnKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoyLnJlbGF0aW9uID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iajIuY29tcGFyZSA9IG9wMiA9PT0gMTAwMiA/IENvbXBhcmUuSXNOb3QgOiBDb21wYXJlLklzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmoyMSA9IHsgZmlsdGVyRmllbGQ6IGZpZWxkLCB2YWx1ZTogbnVsbCwgbGJyYWNrZXQ6ICcnLCByYnJhY2tldDogJykpJywgcmVsYXRpb246IDEsIGNvbXBhcmU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqMjEuY29tcGFyZSA9IG9wMiA9PT0gMTAwMSA/IENvbXBhcmUuSXMgOiBDb21wYXJlLklzTm90O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnIucHVzaChvYmoyMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGZpbHRlckFyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja0VudW1UeXBlRmlsdGVycyhmaWx0ZXJBcnIpO1xyXG4gICAgICAgICAgICBmaWx0ZXJBcnJbZmlsdGVyQXJyLmxlbmd0aCAtIDFdLnJlbGF0aW9uID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmaWx0ZXJBcnI7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0VudW1UeXBlRmlsdGVycyhmaWx0ZXJBcnI6IEZpbHRlckNvbmRpdGlvbltdKSB7XHJcbiAgICAgICAgY29uc3QgZW51bUZpbHRlcnM6e1trZXk6c3RyaW5nXTogYW55W119ID0geyB9O1xyXG4gICAgICAgIGZpbHRlckFyci5mb3JFYWNoKChmLCBpKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVudW1GaWx0ZXJBcnIgPSB0aGlzLmNvbnZlcnRFbnVtVHlwZUZpbHRlcihmKTtcclxuICAgICAgICAgICAgaWYgKGVudW1GaWx0ZXJBcnIgJiYgZW51bUZpbHRlckFyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGVudW1GaWx0ZXJzW2YuZmlsdGVyRmllbGRdID0gZW51bUZpbHRlckFyclxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhlbnVtRmlsdGVycyk7XHJcbiAgICAgICAgaWYgKGtleXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGtleXMuZm9yRWFjaCgoaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGZpbHRlckFyci5maW5kSW5kZXgobiA9PiBuLmZpbHRlckZpZWxkID09PSBrKTtcclxuICAgICAgICAgICAgICAgIGZpbHRlckFyci5zcGxpY2UoaSwgMSwgLi4uZW51bUZpbHRlcnNba10pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZpbHRlckFycjtcclxuICAgIH1cclxuXHJcbiAgICAvLyDlsIZlbnVtIOexu+Wei+eahOadoeS7tui9rOaNouWkmuS4quadoeS7tlxyXG4gICAgcHJpdmF0ZSBjb252ZXJ0RW51bVR5cGVGaWx0ZXIoZmlsdGVyOiBGaWx0ZXJDb25kaXRpb24pIDogRmlsdGVyQ29uZGl0aW9uW10ge1xyXG4gICAgICAgIGlmIChmaWx0ZXIpIHtcclxuICAgICAgICAgICAgY29uc3QgY29sID0gdGhpcy5kZnMuZ2V0Q29sdW1uKGZpbHRlci5maWx0ZXJGaWVsZCkgYXMgRGF0YUNvbHVtbjtcclxuICAgICAgICAgICAgaWYgKGNvbCAmJiBjb2wuZmlsdGVyICYmIGNvbC5maWx0ZXIudHlwZSA9PT0gIENvbHVtbkZpbHRlclR5cGUuZW51bSkgIHtcclxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGZpbHRlci52YWx1ZSkgJiYgZmlsdGVyLnZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIudmFsdWUubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5jb21wYXJlID0gQ29tcGFyZS5FcXVhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLnZhbHVlID0gZmlsdGVyLnZhbHVlWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gPiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmaWx0ZXJBcnIgPSBmaWx0ZXIudmFsdWUubWFwKCh2YWw6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGaWVsZDogZmlsdGVyLmZpbHRlckZpZWxkLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYnJhY2tldDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmJyYWNrZXQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uOiAyLCAgLy8gb3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlOiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnJbMF0ubGJyYWNrZXQgPSAnKCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckFycltmaWx0ZXIudmFsdWUubGVuZ3RoIC0xXS5yYnJhY2tldCA9ICcpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyQXJyW2ZpbHRlci52YWx1ZS5sZW5ndGggLTFdLnJlbGF0aW9uID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlckFycjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVDb2x1bW5GaWx0ZXJPcHRpb25zKGNvbDogRGF0YUNvbHVtbikge1xyXG4gICAgICAgIGxldCBmaWx0ZXJUeXBlT3B0aW9uczogQ29sdW1uRmlsdGVyID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLnN0cmluZyxcclxuICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChjb2wuZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoY29sLmVkaXRvci50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd0ZXh0YXJlYSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICd0ZXh0Ym94JzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2xhbmd1YWdlLXRleHRib3gnOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLnN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnc3dpdGNoJzpcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5ib29sZWFuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyYm94JzpcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5udW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbWJvbGlzdCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3QnOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLmVudW0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBjb2wuZWRpdG9yLm9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZGF0ZXBpY2tlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGNvbFsnZGF0YVR5cGUnXSA9PT0gJ2RhdGV0aW1lJyA/IENvbHVtbkZpbHRlclR5cGUuZGF0ZXRpbWUgOiBDb2x1bW5GaWx0ZXJUeXBlLmRhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0OiBjb2wuZWRpdG9yLm9wdGlvbnMuZGF0ZUZvcm1hdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkZvcm1hdDogY29sLmVkaXRvci5vcHRpb25zLnJldHVybkZvcm1hdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3RpbWVwaWNrZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLnRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGNvbC5mb3JtYXR0ZXIpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb2wuZm9ybWF0dGVyID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyhjb2wuZm9ybWF0dGVyKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnM6IGFueSA9IGNvbC5mb3JtYXR0ZXJbJ29wdGlvbnMnXTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY29sLmZvcm1hdHRlclsndHlwZSddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLm51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VudW0nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuZW51bSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZU9wZXJhdG9yOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDb2x1bW5GaWx0ZXJUeXBlLmJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGF0ZXRpbWUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHllID0gQ29sdW1uRmlsdGVyVHlwZS5kYXRldGltZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZtdCA9ICd5eXl5LU1NLWRkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJldHVybkZtdCA9ICd5eXl5LU1NLWRkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5mb3JtYXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtdCA9IG9wdGlvbnMuZm9ybWF0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZtdC5pbmRleE9mKCdISDonKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5ZSA9IENvbHVtbkZpbHRlclR5cGUuZGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRm10ICs9ICcgSEg6bW0nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbXQuaW5kZXhPZignc3MnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkZtdCArPSAnOnNzJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eWUgPSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZU9wdGlvbnMub3B0aW9ucyA9IHsgZGF0ZUZvcm1hdDogZm10LCByZXR1cm5Gb3JtYXQ6IHJldHVybkZtdCB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IENvbHVtbkZpbHRlclR5cGUuc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlT3BlcmF0b3I6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZpbHRlclR5cGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogQ29sdW1uRmlsdGVyVHlwZS5zdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBlbmFibGVPcGVyYXRvcjogdHJ1ZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmlsdGVyVHlwZU9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jcmVnaW9uICBTbWFydCBGaWx0ZXJcclxuXHJcbiAgICBjb252ZXJ0U21hcnRGaWx0ZXIyRW50aXR5RmlsdGVyKGNvbmRpdGlvbnM6IGFueVtdKSB7XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbnMgJiYgY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbmRpdGlvbnMubWFwKG4gPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdmFsaWRhdGVSb3dEYXRhMihyb3dEYXRhOiBhbnksIGNvbmRpdGlvbnM6IGFueSkge1xyXG4gICAgICAgIGlmICghY29uZGl0aW9ucyB8fCBjb25kaXRpb25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tSb3dEYXRhV2l0aENvbmRpdGlvbihyb3dEYXRhLCBjb25kaXRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrUm93RGF0YVdpdGhDb25kaXRpb24ocm93RGF0YTogYW55LCBjb25kaXRpb25zKSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdE9iaiA9IG51bGw7XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbnMpIHtcclxuICAgICAgICAgICAgcmVzdWx0T2JqID0ge307XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbnMuZm9yRWFjaChjb25kaXRpb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSBjb25kaXRpb24uRmlsdGVyRmllbGQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmllbGRWYWx1ZSA9IFV0aWxzLmdldFZhbHVlKGZpZWxkLCByb3dEYXRhKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbk9iaiA9IHRoaXMuZGZzLmdldENvbHVtbihmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uT2JqICYmIGNvbHVtbk9iai5pc011bHRpbGluZ3VhbEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRWYWx1ZSA9IFV0aWxzLmdldE11bHRpbGluZ3VhbFZhbHVlKGZpZWxkVmFsdWUsIHRoaXMubG9jYWxlU2VyLmxvY2FsZUlkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB3aGVyZSA9IGNvbmRpdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgVmFsdWUsIFJlbGF0aW9uLCBDb21wYXJlOiBvcGVyYXRvcjEgfSA9IHdoZXJlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHdoZXJlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuZ2V0Q29tcGFyZVJlc3VsdChmaWVsZFZhbHVlLCBvcGVyYXRvcjEsIFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0T2JqW2ZpZWxkXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtmaWVsZF0gPSBbIHIgXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRPYmpbZmllbGRdLnB1c2gocik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyByZXR1cm4gdGhpcy5jaGVja0FsbEZpZWxkUmVzdWx0KHJlc3VsdE9iaik7XHJcbiAgICAgICAgY29uc3QgZmllbGRzID0gT2JqZWN0LmtleXMocmVzdWx0T2JqKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgICAgICBmaWVsZHMuZm9yRWFjaCggKGYpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgX2ZpbHRlcnMgPSBjb25kaXRpb25zLmZpbHRlcihuID0+IG4uRmlsdGVyRmllbGQgPT09IGYpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0T2JqW2ZdLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocmVzdWx0T2JqW2ZdWzBdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChfZmlsdGVyc1swXS5SZWxhdGlvbiA9PT0gMSAmJiByZXN1bHRPYmpbZl0ubGVuZ3RoID09PSAyKSB7ICAvLyBhbmRcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZXN1bHRPYmpbZl1bMF0gJiYgcmVzdWx0T2JqW2ZdWzFdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7ICAvLyBvclxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJlc3VsdE9ialtmXS5pbmRleE9mKHRydWUpID4gLTEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQuaW5kZXhPZihmYWxzZSkgPT09IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIGV4ZWN1dGVTbWFydEZpbHRlcihkYXRhOiBbXSwgY29uZGl0aW9uczogYW55W10pIHtcclxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS5maWx0ZXIobiA9PiB0aGlzLnZhbGlkYXRlUm93RGF0YTIobiwgY29uZGl0aW9ucykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxufVxyXG4iXX0=
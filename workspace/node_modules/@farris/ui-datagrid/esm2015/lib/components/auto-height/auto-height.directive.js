/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from '../../datagrid.component';
import { Directive, Injector, Input, ElementRef } from '@angular/core';
import { DatagridBodyComponent } from '../body';
export class AutoHeightDirective {
    /**
     * @param {?} dg
     * @param {?} inject
     * @param {?} el
     */
    constructor(dg, inject, el) {
        this.dg = dg;
        this.inject = inject;
        this.el = el;
        this.autoHeight = false;
        this._timer = null;
        this._dgb = null;
        this._dgb = this.inject.get(DatagridBodyComponent);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // this.updateDatagridHeight(this.wheelHeight);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this._updateDatagridHeight(this.wheelHeight);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.wheelHeight) {
            this._updateDatagridHeight(this.wheelHeight);
        }
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        // this.checkScrollbarPosition();
    }
    /**
     * @private
     * @param {?} wheelHeight
     * @return {?}
     */
    updateDatagridHeight(wheelHeight) {
        if (this.el && this.el.nativeElement && this.el.nativeElement.parentElement) {
            if (this.autoHeight) {
                if (!wheelHeight) {
                    wheelHeight = 240;
                    if (!this.dg.ds || !this.dg.ds.rows || !this.dg.ds.rows.length) {
                        wheelHeight = (!this.dg.emptyDataHeight || this.dg.emptyDataHeight < 0) ? 240 : this.dg.emptyDataHeight;
                    }
                }
                /** @type {?} */
                let h = parseInt(wheelHeight, 10);
                if (this.dg.showHeader) {
                    if (!this.dg.realHeaderHeight) {
                        h += this.dg.setHeaderHeight();
                    }
                    else {
                        h += this.dg.realHeaderHeight;
                    }
                }
                if (this.dg.showFooter) {
                    h += this.dg.footerHeight;
                }
                if (this.dg.pagination) {
                    /** @type {?} */
                    const ph = this.dg.pagerHeight || 40;
                    h += ph;
                }
                if (this.dg.showFilterBar) {
                    h += this.dg.filterBarHeight;
                }
                if (this.dg.showRowGroupPanel) {
                    h += this.dg.rowGroupPanelHeight;
                }
                /** @type {?} */
                let wh = `${wheelHeight}px`;
                if (this.dg.maxHeight && h > this.dg.maxHeight) {
                    wh = this._dgb.getViewPortHeight();
                }
                this.el.nativeElement.parentElement.style.height = wh;
                this.el.nativeElement.parentElement.parentElement.style.height = wh;
                if (this.dg.dgContainer) {
                    if (this.dg.maxHeight && h > this.dg.maxHeight) {
                        h = this.dg.maxHeight;
                    }
                    /** @type {?} */
                    const dgHeight = `${h}px`;
                    // 更新grid 最外层的高度
                    this.dg.dgContainer.nativeElement.style.height = dgHeight;
                    // farris-datagrid 增加高度
                    this.dg.el.nativeElement.style.height = dgHeight;
                    this.dg.height = h;
                    if (this.dg.maxHeight) {
                        if (this.dg.maxHeight && this.dg.maxHeight < 55) {
                            this.dg.maxHeight = 60;
                        }
                        /** @type {?} */
                        const gridContainerEl = this.dg.el.nativeElement.parentElement;
                        gridContainerEl.style.height = 'unset';
                        gridContainerEl.style.maxHeight = this.dg.maxHeight + 'px';
                        gridContainerEl.style.minHeight = h + 'px';
                    }
                }
                else {
                    this.dg.el.nativeElement.querySelector('.f-datagrid').style.height = `${h}px`;
                }
            }
        }
    }
    /**
     * @private
     * @param {?} wheelHeight
     * @return {?}
     */
    _updateDatagridHeight(wheelHeight) {
        if (this.dg.autoHeight) {
            if (this.dg.el.nativeElement.parentElement.className.indexOf('f-utils-fill') > -1) {
                this.dg.el.nativeElement.parentElement.className = this.dg.el.nativeElement.parentElement.className.replace('f-utils-fill', '');
            }
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.updateDatagridHeight(wheelHeight);
            }), 50);
        }
    }
}
AutoHeightDirective.decorators = [
    { type: Directive, args: [{
                selector: '[auto-height]',
            },] }
];
/** @nocollapse */
AutoHeightDirective.ctorParameters = () => [
    { type: DatagridComponent },
    { type: Injector },
    { type: ElementRef }
];
AutoHeightDirective.propDecorators = {
    autoHeight: [{ type: Input, args: ['auto-height',] }],
    wheelHeight: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    AutoHeightDirective.prototype.autoHeight;
    /**
     * 数据列表总高度
     * @type {?}
     */
    AutoHeightDirective.prototype.wheelHeight;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype._timer;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype._dgb;
    /** @type {?} */
    AutoHeightDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    AutoHeightDirective.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1oZWlnaHQuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2F1dG8taGVpZ2h0L2F1dG8taGVpZ2h0LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFhLFNBQVMsRUFBVSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBb0QsTUFBTSxlQUFlLENBQUM7QUFDNUksT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBS2hELE1BQU0sT0FBTyxtQkFBbUI7Ozs7OztJQVM1QixZQUFtQixFQUFxQixFQUFVLE1BQWdCLEVBQVUsRUFBYztRQUF2RSxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVU7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBUHBFLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFJakMsV0FBTSxHQUFHLElBQUksQ0FBQztRQUNkLFNBQUksR0FBRyxJQUFJLENBQUM7UUFHaEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7Ozs7SUFFRCxRQUFRO1FBQ0osK0NBQStDO0lBQ25ELENBQUM7Ozs7SUFFRCxlQUFlO1FBQ1gsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNqRCxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUM5QixJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUU7WUFDckIsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztTQUNoRDtJQUNMLENBQUM7Ozs7SUFFRCxTQUFTO1FBQ0ws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Q0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDL0UsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQzthQUNuSTtZQUNELFVBQVU7OztZQUFDLEdBQUcsRUFBRTtnQkFDWixJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDM0MsQ0FBQyxHQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQ1Y7SUFDTCxDQUFDOzs7WUF6SEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxlQUFlO2FBQzVCOzs7O1lBTlEsaUJBQWlCO1lBQ2EsUUFBUTtZQUFTLFVBQVU7Ozt5QkFRN0QsS0FBSyxTQUFDLGFBQWE7MEJBRW5CLEtBQUs7Ozs7SUFGTix5Q0FBeUM7Ozs7O0lBRXpDLDBDQUE2Qjs7Ozs7SUFFN0IscUNBQXNCOzs7OztJQUN0QixtQ0FBb0I7O0lBRVIsaUNBQTRCOzs7OztJQUFFLHFDQUF3Qjs7Ozs7SUFBRSxpQ0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2RhdGFncmlkLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgRGlyZWN0aXZlLCBPbkluaXQsIEluamVjdG9yLCBJbnB1dCwgRWxlbWVudFJlZiwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBEb0NoZWNrIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQm9keUNvbXBvbmVudCB9IGZyb20gJy4uL2JvZHknO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1thdXRvLWhlaWdodF0nLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXV0b0hlaWdodERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBEb0NoZWNrIHtcclxuXHJcbiAgICBASW5wdXQoJ2F1dG8taGVpZ2h0JykgYXV0b0hlaWdodCA9IGZhbHNlO1xyXG4gICAgLyoqIOaVsOaNruWIl+ihqOaAu+mrmOW6piAqL1xyXG4gICAgQElucHV0KCkgd2hlZWxIZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIF90aW1lciA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9kZ2IgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkZzogRGF0YWdyaWRDb21wb25lbnQsIHByaXZhdGUgaW5qZWN0OiBJbmplY3RvciwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZikge1xyXG4gICAgICAgIHRoaXMuX2RnYiA9IHRoaXMuaW5qZWN0LmdldChEYXRhZ3JpZEJvZHlDb21wb25lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIC8vIHRoaXMudXBkYXRlRGF0YWdyaWRIZWlnaHQodGhpcy53aGVlbEhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZURhdGFncmlkSGVpZ2h0KHRoaXMud2hlZWxIZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy53aGVlbEhlaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVEYXRhZ3JpZEhlaWdodCh0aGlzLndoZWVsSGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdEb0NoZWNrKCkge1xyXG4gICAgICAgIC8vIHRoaXMuY2hlY2tTY3JvbGxiYXJQb3NpdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlRGF0YWdyaWRIZWlnaHQod2hlZWxIZWlnaHQpIHtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZWwgJiYgdGhpcy5lbC5uYXRpdmVFbGVtZW50ICYmIHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghd2hlZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGVlbEhlaWdodCA9IDI0MDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmRzIHx8ICF0aGlzLmRnLmRzLnJvd3MgfHwgIXRoaXMuZGcuZHMucm93cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hlZWxIZWlnaHQgPSAoIXRoaXMuZGcuZW1wdHlEYXRhSGVpZ2h0IHx8IHRoaXMuZGcuZW1wdHlEYXRhSGVpZ2h0IDwgMCApID8gMjQwIDogdGhpcy5kZy5lbXB0eURhdGFIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IGggPSAgcGFyc2VJbnQod2hlZWxIZWlnaHQsIDEwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zaG93SGVhZGVyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5yZWFsSGVhZGVySGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGggKz0gdGhpcy5kZy5zZXRIZWFkZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoICs9IHRoaXMuZGcucmVhbEhlYWRlckhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0Zvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGggKz0gdGhpcy5kZy5mb290ZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBoID0gdGhpcy5kZy5wYWdlckhlaWdodCB8fCA0MDtcclxuICAgICAgICAgICAgICAgICAgICBoICs9IHBoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNob3dGaWx0ZXJCYXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBoICs9IHRoaXMuZGcuZmlsdGVyQmFySGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNob3dSb3dHcm91cFBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaCArPSB0aGlzLmRnLnJvd0dyb3VwUGFuZWxIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHdoID0gIGAke3doZWVsSGVpZ2h0fXB4YDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5tYXhIZWlnaHQgJiYgaCA+IHRoaXMuZGcubWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2ggPSB0aGlzLl9kZ2IuZ2V0Vmlld1BvcnRIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9IHdoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSB3aDsgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuZGdDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5tYXhIZWlnaHQgJiYgaCA+IHRoaXMuZGcubWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGggPSB0aGlzLmRnLm1heEhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRnSGVpZ2h0ID0gYCR7aH1weGA7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pu05pawZ3JpZCDmnIDlpJblsYLnmoTpq5jluqZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmRnQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gZGdIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZmFycmlzLWRhdGFncmlkIOWinuWKoOmrmOW6plxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBkZ0hlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5oZWlnaHQgPSBoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5tYXhIZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcubWF4SGVpZ2h0ICYmIHRoaXMuZGcubWF4SGVpZ2h0IDwgNTUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcubWF4SGVpZ2h0ID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBncmlkQ29udGFpbmVyRWwgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZENvbnRhaW5lckVsLnN0eWxlLmhlaWdodCA9ICd1bnNldCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRDb250YWluZXJFbC5zdHlsZS5tYXhIZWlnaHQgPSB0aGlzLmRnLm1heEhlaWdodCArICdweCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRDb250YWluZXJFbC5zdHlsZS5taW5IZWlnaHQgPSBoICsgJ3B4JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmYtZGF0YWdyaWQnKS5zdHlsZS5oZWlnaHQgPSBgJHtofXB4YDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF91cGRhdGVEYXRhZ3JpZEhlaWdodCh3aGVlbEhlaWdodCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKCdmLXV0aWxzLWZpbGwnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc05hbWUgPSB0aGlzLmRnLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgnZi11dGlscy1maWxsJywgJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEYXRhZ3JpZEhlaWdodCh3aGVlbEhlaWdodCk7XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
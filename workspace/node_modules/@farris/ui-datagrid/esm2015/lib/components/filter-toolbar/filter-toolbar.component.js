/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { takeUntil } from 'rxjs/operators';
import { LocaleService } from '@farris/ui-locale';
import { Subject } from 'rxjs';
import { Component, ViewEncapsulation, Injector, ChangeDetectorRef, ElementRef, ViewChild, Renderer2, Input, NgZone } from '@angular/core';
import { DatagridService } from './../../services/datagrid.service';
import ResizeObserver from 'resize-observer-polyfill';
import { DatagridComponent } from '../../datagrid.component';
export class DatagridFilterToolbarComponent {
    /**
     * @param {?} inject
     * @param {?} el
     * @param {?} cd
     * @param {?} dgs
     * @param {?} render
     * @param {?} ngZone
     * @param {?} localeSer
     */
    constructor(inject, el, cd, dgs, render, ngZone, localeSer) {
        this.inject = inject;
        this.el = el;
        this.cd = cd;
        this.dgs = dgs;
        this.render = render;
        this.ngZone = ngZone;
        this.localeSer = localeSer;
        this.empty = '[ 无 ]';
        this.filterText = this.empty;
        this.openFilterPanel = false;
        this.showExpand = false;
        this.enableFilterSetting = false;
        this.windowResizeHandler = null;
        this.ro = null;
        this.destory$ = new Subject();
        this.empty = this.localeSer.getValue('datagrid.filter.nofilter');
        this.filterText = this.empty;
    }
    /**
     * @return {?}
     */
    get toolbarWidth() {
        return this.filterToolbarRef.nativeElement.offsetWidth;
    }
    /**
     * @return {?}
     */
    get filterTextContainerWidth() {
        /** @type {?} */
        let actionW = 52;
        if (this.enableFilterSetting) {
            actionW = 65;
        }
        return this.toolbarWidth - 85 - actionW;
    }
    /**
     * @return {?}
     */
    get filterTextRealWidth() {
        this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'nowrap');
        /** @type {?} */
        const w = this.filterPanelTextRef.nativeElement.scrollWidth;
        this.render.setStyle(this.filterPanelTextRef.nativeElement, 'white-space', 'normal');
        return w;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.dg = this.inject.get(DatagridComponent);
        this.dfrs = this.dg.clientFilterService;
        this.dgs.clearFilter.pipe(takeUntil(this.destory$)).subscribe((/**
         * @return {?}
         */
        () => {
            this.filterText = this.empty;
            this.openFilterPanel = false;
            this.dgs.onFilterTextChange(this.filterText);
            this.cd.detectChanges();
        }));
        this.filterChangeSubscription = this.dgs.onFilterChanged.pipe(takeUntil(this.destory$)).subscribe((/**
         * @param {?} n
         * @return {?}
         */
        (n) => {
            this.filterText = this.dfrs.convertFilterCondition2String(n);
            if (!this.filterText) {
                this.filterText = this.empty;
            }
            this.updateExpandState();
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.bindEvent();
            }), 100);
            if (!this.showExpand) {
                this.openFilterPanel = false;
            }
            this.cd.detectChanges();
            this.dgs.onFilterTextChange(this.filterText);
        }));
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.ro = new ResizeObserver((/**
             * @return {?}
             */
            () => {
                if (this['_CONTAINER_SIZE_CHANGED_TIMER_']) {
                    clearTimeout(this['_CONTAINER_SIZE_CHANGED_TIMER_']);
                }
                this['_CONTAINER_SIZE_CHANGED_TIMER_'] = setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.updateExpandState();
                    this.cd.detectChanges();
                }), 100);
            }));
            this.ro.observe(this.el.nativeElement.closest('div.f-datagrid'));
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destory$.next();
        this.destory$.complete();
        this.ro.disconnect();
        if (this.filterChangeSubscription) {
            this.filterChangeSubscription.unsubscribe();
            this.filterChangeSubscription = null;
        }
        if (this.windowResizeHandler) {
            this.windowResizeHandler();
            this.windowResizeHandler = null;
        }
    }
    /**
     * @private
     * @return {?}
     */
    bindEvent() {
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const filterFields = this.filterToolbarRef.nativeElement.querySelectorAll('.filter-field');
            this.bindFilterFieldHandler(filterFields);
            /** @type {?} */
            const dropdownFilterFields = this.filterPanelTextRef.nativeElement.querySelectorAll('.filter-field');
            this.bindFilterFieldHandler(dropdownFilterFields, false);
        }));
    }
    /**
     * @private
     * @param {?} filterFields
     * @param {?=} hidePanel
     * @return {?}
     */
    bindFilterFieldHandler(filterFields, hidePanel = true) {
        if (filterFields && filterFields.length) {
            filterFields.forEach((/**
             * @param {?} ff
             * @return {?}
             */
            ff => {
                this.render.listen(ff, 'click', (/**
                 * @return {?}
                 */
                () => {
                    this.removeFilterField(ff, hidePanel);
                }));
            }));
        }
    }
    /**
     * @private
     * @param {?} ff
     * @param {?=} hidePanel
     * @return {?}
     */
    removeFilterField(ff, hidePanel = true) {
        /** @type {?} */
        const field = ff.classList[1].replace('filter-column-', '');
        // delete this.dg.conditions[field];
        ff.remove();
        if (hidePanel) {
            this.openFilterPanel = false;
            this.updateExpandState();
        }
        this.dfrs.removeFilterField(field);
    }
    /**
     * @private
     * @return {?}
     */
    updateExpandState() {
        this.showExpand = this.isShowExpand();
    }
    /**
     * @return {?}
     */
    isShowExpand() {
        if (this.filterTextContainerWidth > this.filterTextRealWidth) {
            return false;
        }
        else if (this.filterTextRealWidth > this.filterTextContainerWidth) {
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    clearFilter($event) {
        this.filterText = this.empty;
        this.dgs.onClearFilter();
        this.dgs.onFilterChanged.emit({});
        return false;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    refreshFilter($event) {
        this.dg.filterData();
        return false;
    }
    /**
     * @return {?}
     */
    showFilterTextPanel() {
        this.openFilterPanel = !this.openFilterPanel;
        this.cd.detectChanges();
    }
}
DatagridFilterToolbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-toolbar',
                template: `
        <div class="f-datagrid-filter-toolbar-panel" #filterPanel [class.show]="openFilterPanel" style="width: auto">
            <span class="filter-text" #filterPanelText [innerHTML]="filterText"></span>
        </div>
        <div class="f-datagrid-filter-toolbar" #filterToolbar>
            <span class="title">{{'datagrid.filter.title'| locale}}：</span>
            <span #filterbarTxt class="filter-text" [innerHTML]="filterText"> </span>
            <span class="filter-action" *ngIf="filterText !== empty ">
                <span *ngIf="showExpand" class="f-icon filter-action-item"
                    [class.f-icon-arrow-chevron-up]="openFilterPanel"
                    [class.f-icon-arrow-chevron-down]="!openFilterPanel"
                (click)="showFilterTextPanel()" title="{{'datagrid.filter.more'|locale}}"></span>
                <span title="{{'datagrid.filter.clearAll'|locale}}" class="f-icon f-icon-x filter-action-item filter-clear" (click)="clearFilter($event)"></span>
                <span title="refresh" class="f-icon f-icon-reload-sm filter-action-item filter-refresh" style="color: #388fff" (click)="refreshFilter($event)"></span>
                <span *ngIf="enableFilterSetting" class="f-icon f-icon-cog filter-action-item" title="{{'datagrid.filter.setting'|locale}}"></span>
            </span>
        </div>
    `,
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
DatagridFilterToolbarComponent.ctorParameters = () => [
    { type: Injector },
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: DatagridService },
    { type: Renderer2 },
    { type: NgZone },
    { type: LocaleService }
];
DatagridFilterToolbarComponent.propDecorators = {
    enableFilterSetting: [{ type: Input }],
    filterPanelRef: [{ type: ViewChild, args: ['filterPanel',] }],
    filterPanelTextRef: [{ type: ViewChild, args: ['filterPanelText',] }],
    filterTextRef: [{ type: ViewChild, args: ['filterbarTxt',] }],
    filterToolbarRef: [{ type: ViewChild, args: ['filterToolbar',] }]
};
if (false) {
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.empty;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterText;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.openFilterPanel;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.showExpand;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.enableFilterSetting;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterPanelTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterTextRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterToolbarRef;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.filterChangeSubscription;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.windowResizeHandler;
    /** @type {?} */
    DatagridFilterToolbarComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.destory$;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dfrs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.inject;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridFilterToolbarComponent.prototype.localeSer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1kYXRhZ3JpZC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2ZpbHRlci10b29sYmFyL2ZpbHRlci10b29sYmFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsT0FBTyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFVLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUE2QixNQUFNLGVBQWUsQ0FBQztBQUM5SyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHcEUsT0FBTyxjQUFjLE1BQU0sMEJBQTBCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUF5QjdELE1BQU0sT0FBTyw4QkFBOEI7Ozs7Ozs7Ozs7SUF1Q3ZDLFlBQ1ksTUFBZ0IsRUFDaEIsRUFBYyxFQUNkLEVBQXFCLEVBQ3JCLEdBQW9CLEVBQ3BCLE1BQWlCLEVBQ2pCLE1BQWMsRUFDZCxTQUF3QjtRQU54QixXQUFNLEdBQU4sTUFBTSxDQUFVO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFpQjtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxjQUFTLEdBQVQsU0FBUyxDQUFlO1FBN0NwQyxVQUFLLEdBQUcsT0FBTyxDQUFDO1FBQ2hCLGVB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RUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzVCLENBQUM7OztZQWpNSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7OztLQWlCVDtnQkFDRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTthQUN4Qzs7OztZQTdCOEMsUUFBUTtZQUFxQixVQUFVO1lBQTdCLGlCQUFpQjtZQUNqRSxlQUFlO1lBRDJFLFNBQVM7WUFBUyxNQUFNO1lBRmxILGFBQWE7OztrQ0F1Q2pCLEtBQUs7NkJBRUwsU0FBUyxTQUFDLGFBQWE7aUNBQ3ZCLFNBQVMsU0FBQyxpQkFBaUI7NEJBQzNCLFNBQVMsU0FBQyxjQUFjOytCQUN4QixTQUFTLFNBQUMsZUFBZTs7OztJQVgxQiwrQ0FBZ0I7O0lBQ2hCLG9EQUF3Qjs7SUFFeEIseURBQXdCOztJQUN4QixvREFBbUI7O0lBRW5CLDZEQUFxQzs7SUFFckMsd0RBQXFEOztJQUNyRCw0REFBNkQ7O0lBQzdELHVEQUFxRDs7SUFDckQsMERBQXlEOztJQXFCekQsa0VBQXVDOztJQUN2Qyw2REFBMkI7O0lBQzNCLDRDQUEwQjs7Ozs7SUFDMUIsa0RBQWlDOzs7OztJQUNqQyw4Q0FBb0M7Ozs7O0lBQ3BDLDRDQUE4Qjs7Ozs7SUFFMUIsZ0RBQXdCOzs7OztJQUN4Qiw0Q0FBc0I7Ozs7O0lBQ3RCLDRDQUE2Qjs7Ozs7SUFDN0IsNkNBQTRCOzs7OztJQUM1QixnREFBeUI7Ozs7O0lBQ3pCLGdEQUFzQjs7Ozs7SUFDdEIsbURBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBJbmplY3RvciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIE9wdGlvbmFsLCBIb3N0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERhdGFncmlkU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkRmlsdGVyU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvZGF0YWdyaWQtZmlsdGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyAgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLWZhY2FkZS5zZXJ2aWNlJztcclxuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuXHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmlsdGVyLXRvb2xiYXInLFxyXG4gICAgdGVtcGxhdGU6IGBcclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1maWx0ZXItdG9vbGJhci1wYW5lbFwiICNmaWx0ZXJQYW5lbCBbY2xhc3Muc2hvd109XCJvcGVuRmlsdGVyUGFuZWxcIiBzdHlsZT1cIndpZHRoOiBhdXRvXCI+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZmlsdGVyLXRleHRcIiAjZmlsdGVyUGFuZWxUZXh0IFtpbm5lckhUTUxdPVwiZmlsdGVyVGV4dFwiPjwvc3Bhbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZi1kYXRhZ3JpZC1maWx0ZXItdG9vbGJhclwiICNmaWx0ZXJUb29sYmFyPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRpdGxlXCI+e3snZGF0YWdyaWQuZmlsdGVyLnRpdGxlJ3wgbG9jYWxlfX3vvJo8L3NwYW4+XHJcbiAgICAgICAgICAgIDxzcGFuICNmaWx0ZXJiYXJUeHQgY2xhc3M9XCJmaWx0ZXItdGV4dFwiIFtpbm5lckhUTUxdPVwiZmlsdGVyVGV4dFwiPiA8L3NwYW4+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZmlsdGVyLWFjdGlvblwiICpuZ0lmPVwiZmlsdGVyVGV4dCAhPT0gZW1wdHkgXCI+XHJcbiAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cInNob3dFeHBhbmRcIiBjbGFzcz1cImYtaWNvbiBmaWx0ZXItYWN0aW9uLWl0ZW1cIlxyXG4gICAgICAgICAgICAgICAgICAgIFtjbGFzcy5mLWljb24tYXJyb3ctY2hldnJvbi11cF09XCJvcGVuRmlsdGVyUGFuZWxcIlxyXG4gICAgICAgICAgICAgICAgICAgIFtjbGFzcy5mLWljb24tYXJyb3ctY2hldnJvbi1kb3duXT1cIiFvcGVuRmlsdGVyUGFuZWxcIlxyXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cInNob3dGaWx0ZXJUZXh0UGFuZWwoKVwiIHRpdGxlPVwie3snZGF0YWdyaWQuZmlsdGVyLm1vcmUnfGxvY2FsZX19XCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gdGl0bGU9XCJ7eydkYXRhZ3JpZC5maWx0ZXIuY2xlYXJBbGwnfGxvY2FsZX19XCIgY2xhc3M9XCJmLWljb24gZi1pY29uLXggZmlsdGVyLWFjdGlvbi1pdGVtIGZpbHRlci1jbGVhclwiIChjbGljayk9XCJjbGVhckZpbHRlcigkZXZlbnQpXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgPHNwYW4gdGl0bGU9XCJyZWZyZXNoXCIgY2xhc3M9XCJmLWljb24gZi1pY29uLXJlbG9hZC1zbSBmaWx0ZXItYWN0aW9uLWl0ZW0gZmlsdGVyLXJlZnJlc2hcIiBzdHlsZT1cImNvbG9yOiAjMzg4ZmZmXCIgKGNsaWNrKT1cInJlZnJlc2hGaWx0ZXIoJGV2ZW50KVwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIDxzcGFuICpuZ0lmPVwiZW5hYmxlRmlsdGVyU2V0dGluZ1wiIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1jb2cgZmlsdGVyLWFjdGlvbi1pdGVtXCIgdGl0bGU9XCJ7eydkYXRhZ3JpZC5maWx0ZXIuc2V0dGluZyd8bG9jYWxlfX1cIj48L3NwYW4+XHJcbiAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgIGAsXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZEZpbHRlclRvb2xiYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgICBlbXB0eSA9ICdbIOaXoCBdJztcclxuICAgIGZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG5cclxuICAgIG9wZW5GaWx0ZXJQYW5lbCA9IGZhbHNlO1xyXG4gICAgc2hvd0V4cGFuZCA9IGZhbHNlO1xyXG5cclxuICAgIEBJbnB1dCgpIGVuYWJsZUZpbHRlclNldHRpbmcgPSBmYWxzZTtcclxuXHJcbiAgICBAVmlld0NoaWxkKCdmaWx0ZXJQYW5lbCcpIGZpbHRlclBhbmVsUmVmOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyUGFuZWxUZXh0JykgZmlsdGVyUGFuZWxUZXh0UmVmOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZmlsdGVyYmFyVHh0JykgZmlsdGVyVGV4dFJlZjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlclRvb2xiYXInKSBmaWx0ZXJUb29sYmFyUmVmOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIGdldCB0b29sYmFyV2lkdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyVG9vbGJhclJlZi5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmaWx0ZXJUZXh0Q29udGFpbmVyV2lkdGgoKSB7XHJcbiAgICAgICAgbGV0IGFjdGlvblcgPSA1MjtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVGaWx0ZXJTZXR0aW5nKSB7XHJcbiAgICAgICAgICAgIGFjdGlvblcgPSA2NTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9vbGJhcldpZHRoIC0gODUgLSBhY3Rpb25XO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBmaWx0ZXJUZXh0UmVhbFdpZHRoKCkge1xyXG4gICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZmlsdGVyUGFuZWxUZXh0UmVmLm5hdGl2ZUVsZW1lbnQsICd3aGl0ZS1zcGFjZScsICdub3dyYXAnKTtcclxuICAgICAgICBjb25zdCB3ID0gdGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxXaWR0aDtcclxuICAgICAgICB0aGlzLnJlbmRlci5zZXRTdHlsZSh0aGlzLmZpbHRlclBhbmVsVGV4dFJlZi5uYXRpdmVFbGVtZW50LCAnd2hpdGUtc3BhY2UnLCAnbm9ybWFsJyk7XHJcbiAgICAgICAgcmV0dXJuIHc7XHJcbiAgICB9XHJcblxyXG4gICAgZmlsdGVyQ2hhbmdlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICB3aW5kb3dSZXNpemVIYW5kbGVyID0gbnVsbDtcclxuICAgIHJvOiBSZXNpemVPYnNlcnZlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIGRlc3RvcnkkID0gbmV3IFN1YmplY3QoKTtcclxuICAgIHByaXZhdGUgZGZyczogRGF0YWdyaWRGaWx0ZXJTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGluamVjdDogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcclxuICAgICAgICBwcml2YXRlIGxvY2FsZVNlcjogTG9jYWxlU2VydmljZSxcclxuICAgICAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW1wdHkgPSB0aGlzLmxvY2FsZVNlci5nZXRWYWx1ZSgnZGF0YWdyaWQuZmlsdGVyLm5vZmlsdGVyJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyVGV4dCA9IHRoaXMuZW1wdHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGcgPSB0aGlzLmluamVjdC5nZXQ8RGF0YWdyaWRDb21wb25lbnQ+KERhdGFncmlkQ29tcG9uZW50KTtcclxuICAgICAgICB0aGlzLmRmcnMgPSB0aGlzLmRnLmNsaWVudEZpbHRlclNlcnZpY2U7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmNsZWFyRmlsdGVyLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdG9yeSQpKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWx0ZXJQYW5lbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmRncy5vbkZpbHRlclRleHRDaGFuZ2UodGhpcy5maWx0ZXJUZXh0KTtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZmlsdGVyQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5kZ3Mub25GaWx0ZXJDaGFuZ2VkLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdG9yeSQpKS5zdWJzY3JpYmUoKG4pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5kZnJzLmNvbnZlcnRGaWx0ZXJDb25kaXRpb24yU3RyaW5nKG4pO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZmlsdGVyVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJUZXh0ID0gdGhpcy5lbXB0eTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVFeHBhbmRTdGF0ZSgpO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zaG93RXhwYW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5GaWx0ZXJQYW5lbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICB0aGlzLmRncy5vbkZpbHRlclRleHRDaGFuZ2UodGhpcy5maWx0ZXJUZXh0KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5ybyA9IG5ldyBSZXNpemVPYnNlcnZlcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpc1snX0NPTlRBSU5FUl9TSVpFX0NIQU5HRURfVElNRVJfJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpc1snX0NPTlRBSU5FUl9TSVpFX0NIQU5HRURfVElNRVJfJ10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpc1snX0NPTlRBSU5FUl9TSVpFX0NIQU5HRURfVElNRVJfJ10gPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4cGFuZFN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucm8ub2JzZXJ2ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xvc2VzdCgnZGl2LmYtZGF0YWdyaWQnKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0b3J5JC5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kZXN0b3J5JC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIHRoaXMucm8uZGlzY29ubmVjdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckNoYW5nZVN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLndpbmRvd1Jlc2l6ZUhhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhpcy53aW5kb3dSZXNpemVIYW5kbGVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMud2luZG93UmVzaXplSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEV2ZW50KCkge1xyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyRmllbGRzID0gdGhpcy5maWx0ZXJUb29sYmFyUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbHRlci1maWVsZCcpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRGaWx0ZXJGaWVsZEhhbmRsZXIoZmlsdGVyRmllbGRzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duRmlsdGVyRmllbGRzID0gdGhpcy5maWx0ZXJQYW5lbFRleHRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWZpZWxkJyk7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEZpbHRlckZpZWxkSGFuZGxlcihkcm9wZG93bkZpbHRlckZpZWxkcywgZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmluZEZpbHRlckZpZWxkSGFuZGxlcihmaWx0ZXJGaWVsZHM6IGFueSwgaGlkZVBhbmVsID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmIChmaWx0ZXJGaWVsZHMgJiYgZmlsdGVyRmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBmaWx0ZXJGaWVsZHMuZm9yRWFjaChmZiA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5saXN0ZW4oZmYsICdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUZpbHRlckZpZWxkKGZmLCBoaWRlUGFuZWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbW92ZUZpbHRlckZpZWxkKGZmOiBhbnksIGhpZGVQYW5lbCA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBmaWVsZCA9IGZmLmNsYXNzTGlzdFsxXS5yZXBsYWNlKCdmaWx0ZXItY29sdW1uLScsICcnKTtcclxuICAgICAgICAvLyBkZWxldGUgdGhpcy5kZy5jb25kaXRpb25zW2ZpZWxkXTtcclxuICAgICAgICBmZi5yZW1vdmUoKTtcclxuICAgICAgICBpZiAoaGlkZVBhbmVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3BlbkZpbHRlclBhbmVsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhwYW5kU3RhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kZnJzLnJlbW92ZUZpbHRlckZpZWxkKGZpZWxkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUV4cGFuZFN0YXRlKCkge1xyXG4gICAgICAgIHRoaXMuc2hvd0V4cGFuZCA9IHRoaXMuaXNTaG93RXhwYW5kKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTaG93RXhwYW5kKCkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5maWx0ZXJUZXh0Q29udGFpbmVyV2lkdGggPiB0aGlzLmZpbHRlclRleHRSZWFsV2lkdGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5maWx0ZXJUZXh0UmVhbFdpZHRoID4gdGhpcy5maWx0ZXJUZXh0Q29udGFpbmVyV2lkdGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhckZpbHRlcigkZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmZpbHRlclRleHQgPSB0aGlzLmVtcHR5O1xyXG4gICAgICAgIHRoaXMuZGdzLm9uQ2xlYXJGaWx0ZXIoKTtcclxuICAgICAgICB0aGlzLmRncy5vbkZpbHRlckNoYW5nZWQuZW1pdCh7fSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2hGaWx0ZXIoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5kZy5maWx0ZXJEYXRhKCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dGaWx0ZXJUZXh0UGFuZWwoKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuRmlsdGVyUGFuZWwgPSAhdGhpcy5vcGVuRmlsdGVyUGFuZWw7XHJcbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICB9XHJcbn1cclxuIl19
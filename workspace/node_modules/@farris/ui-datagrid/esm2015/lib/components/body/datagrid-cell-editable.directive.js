/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-06 07:43:07
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-19 15:48:27
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Directive, Input, ElementRef, Renderer2, ContentChild, Injector, forwardRef, Inject, NgZone } from '@angular/core';
import { filter, debounceTime, takeUntil } from 'rxjs/operators';
import { DatagridService } from './../../services/datagrid.service';
import { DatagridCellComponent } from './datagrid-cell.component';
import { DatagridBodyComponent } from './datagrid-body.component';
import { DatagridRowDirective } from './datagrid-row.directive';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { DatagridComponent } from '../../datagrid.component';
import { CELL_SELECTED_CLS, CELL_EDITING_CLS, ALLOW_EDIT_CELL_HIGHLIGHT_CLS } from '../../types/constant';
import { of, noop, Subject } from 'rxjs';
import { Utils } from '../../utils/utils';
export class DatagridCellEditableDirective {
    /**
     * @param {?} injector
     * @param {?} el
     * @param {?} render
     * @param {?} dg
     * @param {?} ngZone
     */
    constructor(injector, el, render, dg, ngZone) {
        this.injector = injector;
        this.el = el;
        this.render = render;
        this.dg = dg;
        this.ngZone = ngZone;
        // private _readonly$ = null;
        this.cellEditorCreatedSubscription = null;
        this.cellEditorDestorySubscription = null;
        this.destroy$ = new Subject();
        this.validMessageEle = null;
        this.dgb = this.injector.get(DatagridBodyComponent);
        this.dr = this.injector.get(DatagridRowDirective);
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        if (!this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription = this.dgs.cellEditorCreated.pipe(takeUntil(this.destroy$)).pipe(filter((/**
             * @param {?} __0
             * @return {?}
             */
            ({ column, editorRef, cellEditorRef, templateRef }) => {
                return column.field === this.column.field && this.dg.selectedRow.id === this.dr.rowId;
            }))).subscribe((/**
             * @param {?} __0
             * @return {?}
             */
            ({ editorRef, cellEditorRef, templateRef }) => {
                if (editorRef) {
                    this['editor'] = editorRef.instance;
                    this['formControl'] = (/** @type {?} */ (this.editor.formControl));
                    this.cellEditorRef = cellEditorRef;
                    this.emitBeginEdit();
                }
                else {
                    this['formControl'] = (/** @type {?} */ (this.dr.form.get(this.column.field)));
                    this.bindEditorInputEvent();
                    this.dg.beginEdit.emit({ editor: null, column: this.column, rowData: this.rowData, gridInstance: this.dg, template: templateRef });
                }
                this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
            }));
        }
        this.dg.dgs.cellEditorDestory.pipe(takeUntil(this.destroy$)).pipe(filter((/**
         * @param {?} __0
         * @return {?}
         */
        ({ column }) => {
            return this.dg.selectedRow && column.field === this.column.field && this.dg.selectedRow.id === this.dr.rowId;
        }))).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.dg.editMode === 'cell') {
                this.dg.selectedRow.editors = [];
                if (this.dg.currentCell) {
                    this.dg.currentCell.editor = null;
                    this.dg.currentCell.cellEditorRef = null;
                }
            }
            this.unBindEditorInputEvent();
            this.cellEditorRef = null;
            this.formControl = null;
            this.editor = null;
            this.removeValidMessage();
        }));
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.rowData && !changes.rowData.isFirstChange()) {
            this.initCellEvent();
            this.setCellClsWithEditorType();
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.initCellEvent();
        this.setCellClsWithEditorType();
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    runZoneClick(e) {
        if (this['zoneClick']) {
            Object.assign(e, { rowData: this.rowData });
            this['zoneClick'].forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                n.target.style.pointerEvents = 'auto';
                if (n.callback) {
                    n.callback(e);
                }
                else if (n.handler) {
                    n.handler(e);
                }
            }));
            if (this.dg.isFF) {
                e.target['__zone_symbol__clickfalse'] = this['zoneClick'];
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    initCellEvent() {
        if (this.column && (this.column.editor || this.column.editorTemplate)) {
            if (!this.dg.clickToEdit) {
                this.celldblclick = this.render.listen(this.el.nativeElement, 'dblclick', (/**
                 * @param {?} e
                 * @return {?}
                 */
                (e) => {
                    this.onDblClickCell(e);
                }));
            }
            this.el.nativeElement.edit = (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.closeEditingCell().subscribe((/**
                 * @param {?} canEdit
                 * @return {?}
                 */
                (canEdit) => {
                    if (canEdit) {
                        this.onClickCell(e);
                        if (!this.dg.selectedRow || this.dg.selectedRow.id !== this.dr.rowId) {
                            this.dg.selectRow(this.dr.rowId, true, false);
                        }
                        this.runZoneClick(e);
                    }
                }));
            });
            this.el.nativeElement.editCell = (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.openCellEditor();
            });
        }
        else {
            this.clickTimer = 0;
        }
        /** @type {?} */
        const excludeTarget = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            return e.target.parentElement.nodeName !== 'GRID-BODY-CELL' &&
                e.target.nodeName !== 'INPUT' && e.target.nodeName !== 'TEXTAREA' &&
                !(e.target.className.indexOf('custom-control-label') > -1 &&
                    e.target.parentElement && e.target.parentElement.className.indexOf('custom-control') > -1) &&
                !e.target.closest('input-group') && !e.target.closest('farris-switch') &&
                !e.target.closest('farris-number-spinner') &&
                !e.target.closest('farris-datepicker') &&
                !e.target.closest('farris-time-picker') &&
                !e.target.closest('grid-editor-textarea') &&
                !e.target.closest('farris-checkboxgroup') &&
                !e.target.closest('grid-editor-checkbox') && !e.target.closest('farris-radiogroup') &&
                !e.target.closest('farris-organization-selector') && !e.target.closest('farris-personnel-selector');
        });
        if (this.column.proxyClick === undefined) {
            this.column.proxyClick = true;
        }
        if (this.column.template && this.column.proxyClick) {
            if (this['_tdmousedown_']) {
                this.el.nativeElement.removeEventListener('mousedown', this['_tdmousedown_'], true);
                this['_tdmousedown_'] = null;
            }
            this.el.nativeElement.addEventListener('mousedown', this['_tdmousedown_'] = (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (excludeTarget(e)) {
                    this['zoneClick'] = e.target['__zone_symbol__clickfalse'] || e.target['__zone_symbol__ANGULARclickFALSE'];
                    if (this['zoneClick'] && this['zoneClick'].length) {
                        if (!this.dg.isFF) {
                            e.target.style.pointerEvents = 'none';
                        }
                        else {
                            if (e.target['__zone_symbol__clickfalse']) {
                                delete (e.target['__zone_symbol__clickfalse']);
                            }
                            if (e.target['__zone_symbol__ANGULARclickFALSE']) {
                                delete (e.target['__zone_symbol__ANGULARclickFALSE']);
                            }
                        }
                        this['zoneClick'].forEach(((/**
                         * @param {?} proxyClick
                         * @return {?}
                         */
                        proxyClick => {
                            if (!proxyClick.target) {
                                proxyClick.target = e.target;
                            }
                        })));
                    }
                }
            }), true);
            /*
            this['_tdmousedown_'] = this.render.listen(this.el.nativeElement, 'mousedown', (e: any) => {
                if (excludeTarget(e)) {
                    this['zoneClick'] = e.target['__zone_symbol__clickfalse'] || e.target['__zone_symbol__ANGULARclickFALSE'];
                    if (this['zoneClick'] && this['zoneClick'].length) {
                        e.target.style.pointerEvents = 'none';
                        this['zoneClick'].forEach((proxyClick => {
                            if (!proxyClick.target) {
                                proxyClick.target = e.target;
                            }
                        }));
                    }
                }
            });
            */
        }
        this.el.nativeElement.gridCellData = { rowData: this.rowData, rowIndex: this.dr.rowIndex };
        this.el.nativeElement.closeEdit = (/**
         * @return {?}
         */
        () => this.closeEditingCell());
        this.el.nativeElement.selectCell = (/**
         * @param {?} e
         * @param {?} el
         * @return {?}
         */
        (e, el) => {
            if (this.dg.disableRow && this.dg.disableRow(this.rowData, this.dr.rowIndex)) {
                return;
            }
            /** @type {?} */
            const beforEventParam = {
                rowIndex: this.dr.rowIndex,
                rowData: this.rowData,
                gridInstance: this.dg
            };
            /** @type {?} */
            const runTemplateClickEvent = (/**
             * @return {?}
             */
            () => {
                if (!this.dg.currentCell) {
                    this.selectCell(this.column.field, el);
                    if (!this.dg.currentCell) {
                        this.dg.currentCell = { rowData: this.rowData };
                    }
                    else {
                        if (!this.dg.currentCell.rowData) {
                            this.dg.currentCell.rowData = this.rowData;
                        }
                    }
                }
                if (this['zoneClick']) {
                    this.runZoneClick(e);
                }
                this.dg.cellClick.emit({ column: this.column, rowData: this.rowData, gridInstance: this.dg, event: e });
            });
            /** @type {?} */
            const useNewSelectionMode = this.dg.sms.beforRowClick(Object.assign({}, beforEventParam, { e, id: this.dr.rowId, dr: this.dr, cellref: this }));
            if (useNewSelectionMode) {
                this.selectCell(this.column.field, el);
                if (!this.dg.currentCell) {
                    this.dg.currentCell = { rowData: this.rowData };
                }
                else {
                    if (!this.dg.currentCell.rowData) {
                        this.dg.currentCell.rowData = this.rowData;
                    }
                }
                this.dg.cellClick.emit({ column: this.column, rowData: this.rowData, gridInstance: this.dg, event: e });
                return;
            }
            if (this.dfs.isRowSelected(this.dr.rowId)) {
                if (!this.dg.keepSelect && !this.column.template) {
                    if (this.dg.currentCell && this.dg.currentCell.cellElement && this.dg.currentCell.cellElement.id === el.id) {
                        this.dg.cancelSelectCell();
                    }
                    this.dg.beforeUnselect(beforEventParam).pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} canUnselect
                     * @return {?}
                     */
                    (canUnselect) => {
                        if (canUnselect) {
                            // this.dg.unSelect.emit(this.dg.selectedRow);
                            this.dfs.unSelectRow(this.dr.rowIndex, this.rowData, { instance: this.dg });
                            /** @type {?} */
                            const trCLS = this.el.nativeElement.className;
                            if (trCLS.indexOf('f-datagrid-row-selected') > -1) {
                                this.el.nativeElement.className = trCLS.replace('f-datagrid-row-selected', '');
                            }
                        }
                        this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                        this.dg.dgs.setSelecedRow.emit();
                    }));
                }
                else {
                    this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                    runTemplateClickEvent();
                }
            }
            else {
                /** @type {?} */
                let r$ = of(true);
                if (this.dg.beforeSelect) {
                    /** @type {?} */
                    const r = this.dg.beforeSelect({ rowIndex: this.dr.rowIndex, rowData: this.rowData, gridInstance: this.dg });
                    if (r && r.subscribe) {
                        r$ = r;
                    }
                }
                /** @type {?} */
                const zoneClick = this['zoneClick'];
                /** @type {?} */
                const _timer = zoneClick && zoneClick.length ? 100 : 0;
                r$.pipe(debounceTime(_timer)).subscribe((/**
                 * @param {?} t
                 * @return {?}
                 */
                (t) => {
                    if (t) {
                        this.selectCell(this.column.field, el);
                        this.dg.cellClick.emit({ column: this.column, rowData: this.rowData, gridInstance: this.dg, event: e });
                        if (_timer) {
                            this.runZoneClick(e);
                        }
                    }
                    this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                    this.dg.dgs.setSelecedRow.emit();
                }));
            }
        });
        this.el.nativeElement.cancelSelected = (/**
         * @return {?}
         */
        () => {
            this.render.removeClass(this.el.nativeElement, CELL_SELECTED_CLS);
            this.render.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
        if (this.cellclick) {
            this.cellclick();
        }
        if (this.celldblclick) {
            this.celldblclick();
        }
        this.unBindEditorInputEvent();
        if (this.bindCellEventSubscription) {
            this.bindCellEventSubscription.unsubscribe();
            this.bindCellEventSubscription = null;
        }
        if (this.cellEditorCreatedSubscription) {
            this.cellEditorCreatedSubscription.unsubscribe();
            this.cellEditorCreatedSubscription = null;
        }
        if (this.cellEditorDestorySubscription) {
            this.cellEditorDestorySubscription.unsubscribe();
            this.cellEditorDestorySubscription = null;
        }
        this.editor = null;
        this.cellEditorRef = null;
        this.formControl = null;
        if (this.el) {
            this.el.nativeElement.cancelSelected = noop;
            this.el.nativeElement.selectCell = noop;
            this.el.nativeElement.closeEdit = noop;
            this.el.nativeElement.gridCellData = noop;
            this.el.nativeElement.edit = noop;
            this.el.nativeElement.selectCell = noop;
            if (this['_tdmousedown_']) {
                this.el.nativeElement.removeEventListener('mousedown', this['_tdmousedown_'], true);
                this['_tdmousedown_'] = null;
            }
            this.el = null;
        }
    }
    /**
     * @private
     * @return {?}
     */
    isDifferentCell() {
        if (!this.dg.currentCell) {
            return true;
        }
        else {
            if (!this.dg.selectedRow || this.dg.selectedRow.index !== this.dr.rowIndex) {
                return true;
            }
            else {
                if (this.dr.rowIndex !== this.dg.currentCell.rowIndex) {
                    return true;
                }
                else {
                    return this.dg.currentCell.field !== this.column.field;
                }
            }
        }
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    onClickCell(event) {
        // 关闭其他Grid 的编辑器
        document.body.click();
        this.dg.beforeClickCell.emit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (this.dr.disabled) {
            return;
        }
        if (this.dg.disabled) {
            return;
        }
        else {
            if (!this.dg.editable || this.isReadonly()) {
                if (this.dg.enableHighlightCell) {
                    event.stopPropagation();
                    this.dg.endEditing();
                    this.selectCell(this.column.field);
                }
                // 只读单元格，点击后须触发行点击事件 tfs 574551
                this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
                return;
            }
            else {
                if (this.dg.editMode === 'row') {
                    return;
                }
            }
        }
        if (this.dg.selectionMode === 'default' && event) {
            if (event.ctrlKey || event.shiftKey) {
                return;
            }
        }
        event.stopPropagation();
        if (event.target['nodeName'] === 'INPUT') {
            return;
        }
        // if (this.dg.clickToEdit && !this.dg.dblclickRow.observers.length) {
        //     this.dg.clickDelay = 0;
        // }
        this.render.addClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (!this.dg.isSingleClick && this.dg.editMode) {
            this.dg.isSingleClick = true;
            if (this.clickTimer) {
                clearTimeout(this.clickTimer);
            }
            this.clickTimer = setTimeout((/**
             * @return {?}
             */
            () => {
                if (this.dg.isSingleClick && this.dg.editable && this.dg.editMode === 'cell') {
                    this.dg.isSingleClick = false;
                    clearTimeout(this.clickTimer);
                    // if (!this.closeEditingCell()) {
                    //     return;
                    // }
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    (f) => {
                        if (f) {
                            if (this.dg.clickToEdit) {
                                !this.dg.nowrap && this.dgb.updateRowHeight();
                                this.openCellEditor();
                            }
                            else {
                                this.selectCell(this.column.field);
                            }
                            this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
                            event.preventDefault();
                        }
                    }));
                }
            }), this.dg.clickDelay);
        }
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    onDblClickCell(event) {
        if (this.dg.disabled || this.isReadonly()) {
            return;
        }
        if (event.target['nodeName'] === 'INPUT' || event.target['nodeName'] === 'TEXTAREA') {
            return;
        }
        if (this.dg.editable && this.dg.editMode === 'cell') {
            if (this.clickTimer) {
                this.dg.isSingleClick = false;
                clearTimeout(this.clickTimer);
                this.clickTimer = null;
            }
            this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} f
             * @return {?}
             */
            f => {
                if (f) {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.openCellEditor();
                    }));
                }
            }));
        }
    }
    /**
     * @param {?=} col
     * @return {?}
     */
    isReadonly(col = this.column) {
        if (this.dg.editable) {
            // 参与合并的单元格不允许编辑
            if (this.dg.mergeCell && this.dg.mergeFields.indexOf(col.field) > -1) {
                return true;
            }
            return this.getReadonlyValue(col);
        }
        else {
            return true;
        }
    }
    /**
     * @private
     * @param {?=} col
     * @return {?}
     */
    getReadonlyValue(col = this.column) {
        if (col.readonly !== undefined) {
            if (typeof col.readonly === 'boolean') {
                return col.readonly;
            }
            else if (typeof col.readonly === 'function') {
                return col.readonly(this.rowData);
            }
        }
        return false;
    }
    /**
     * @return {?}
     */
    openCellEditor() {
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if ((!this.column.editor && !this.column.editorTemplate) || !this.dg.editable || this.isReadonly()) {
            if (this.dg.selectionMode === 'default' && this.dg.multiSelect) {
                this.dg.clearCheckeds();
            }
            this.selectCell(this.column.field);
            return;
        }
        /** @type {?} */
        const beforeEditEvent = this.dg.beforeEdit({ rowIndex: this.dr.rowIndex, rowData: this.rowData, column: this.column, gridInstance: this.dg });
        if (!beforeEditEvent || !beforeEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return;
        }
        if (this.dg.currentCell) {
            if (!this.dg.currentCell.cellRef || this.dg.currentCell.cellRef.column.field !== this.column.field) {
                this.dg.currentCell.cellRef = this.dc;
            }
        }
        beforeEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        (flag) => {
            if (flag) {
                if (this.isDifferentCell()) {
                    if (this.dg.selectionMode === 'default' && this.dg.multiSelect) {
                        this.dg.clearCheckeds();
                    }
                    this.selectCell(this.column.field);
                }
                this.dfs.editCell();
            }
            else {
                this.selectCell(this.column.field);
                // tfs 574612
                this.dg.rowClick.emit({ data: this.rowData, grid: this.dg, dblclick: false });
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    emitBeginEdit() {
        /** @type {?} */
        const _cellEditorRef = this.cellEditorRef || this.dc.cellEditor;
        this.render.removeClass(this.dg.el.nativeElement, 'f-datagrid-unselect');
        if (this.dg.editMode === 'cell') {
            this.dg.selectedRow.editors = [this.editor];
            this.dg.currentCell.editor = this.editor;
            this.dg.currentCell.cellEditorRef = _cellEditorRef;
            this.bindEditorInputEvent();
            this.render.addClass(this.el.nativeElement, CELL_EDITING_CLS);
            // this.formControl.setValue(this.dc.value);
            this.dg.beginEdit.emit({ editor: _cellEditorRef, column: this.column, rowData: this.rowData, gridInstance: this.dg });
            if (this.column.editor.type === 'textarea' && this.column.editor.options && this.column.editor.options.editType === 'dialog') {
                this.editor.showDialog();
            }
        }
        if (this.dr && !this.dg.nowrap) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.dr.updateRowHeight();
            }));
        }
        if (this.editor) {
            this.validMessageEle = this.showValidMessage();
        }
    }
    /**
     * @return {?}
     */
    removeValidMessage() {
        // 移除验证信息
        if (this.validMessageEle) {
            this.validMessageEle.remove();
            this.validMessageEle = null;
            if (this.dg.formValidations) {
                delete this.dg.formValidations[this.column.field];
            }
        }
    }
    /**
     * @return {?}
     */
    showValidMessage() {
        if (this.dg.formValidations && this.dg.formValidations[this.column.field]) {
            const { isValid, message } = this.dg.formValidations[this.column.field];
            if (!isValid && message) {
                /** @type {?} */
                const tr = this.editor.el.nativeElement.closest('tr');
                /** @type {?} */
                const td = this.editor.el.nativeElement.closest('td');
                /** @type {?} */
                const parentContainver = this.editor.el.nativeElement.closest('.f-datagrid-table');
                /** @type {?} */
                const box = document.createElement('div');
                /** @type {?} */
                const msgWrap = document.createElement('span');
                box.appendChild(msgWrap);
                msgWrap.innerText = message;
                box.style.position = 'absolute';
                box.style.background = '#FDEFEF';
                box.style.color = '#F46160';
                /** @type {?} */
                let top = tr.offsetTop - 21;
                if (tr.getAttribute('index') == '0') {
                    top = tr.offsetHeight;
                }
                box.style.top = `${top}px`;
                box.style.left = `${td.offsetLeft + 5}px`;
                box.style.zIndex = '996';
                box.style.padding = '0.1875rem 0.5rem';
                box.style.fontSize = '.8125rem';
                box.style.lineHeight = '14px';
                // document.body.append(box);
                parentContainver.append(box);
                return box;
            }
            return null;
        }
    }
    /**
     * @return {?}
     */
    closeEditingCell() {
        if (!this.dg.isCellEditing()) {
            return of(true);
        }
        /** @type {?} */
        let currentCell = null;
        /** @type {?} */
        let editor = null;
        if (this.dg.currentCell) {
            currentCell = (/** @type {?} */ (this.dg.currentCell.cellRef));
            if (currentCell) {
                if (!currentCell.isEditing) {
                    return of(true);
                }
                if (currentCell.cellEditor && currentCell.cellEditor.componentRef && !currentCell.column.editorTemplate) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    if (editor) {
                        // 执行blur 事件
                        if (editor.inputElement) {
                            /** @type {?} */
                            const domName = editor.inputElement.nodeName;
                            /** @type {?} */
                            const blurFn = editor.options && editor.options.onBlur;
                            if (blurFn) {
                                if ((domName === 'INPUT' || domName === 'TEXTAREA') && this.dg['focusElement'] === editor.inputElement) {
                                    blurFn({ editorRef: editor, rowData: currentCell.rowData });
                                }
                            }
                            if (editor.inputElement.blur) {
                                editor.inputElement.blur();
                            }
                            this.dg['focusElement'] = null;
                        }
                        if (editor.blur) {
                            editor.blur();
                        }
                        if (editor.pending) {
                            return of(false);
                        }
                        if (editor.formControl) {
                            if (editor.formControl.pending) {
                                return of(false);
                            }
                            if (editor.formControl && editor.formControl.invalid && !this.dg.endEditByInvalid) {
                                return of(false);
                            }
                        }
                        else {
                            return of(true);
                        }
                    }
                    else {
                        return of(true);
                    }
                }
            }
        }
        else {
            return of(true);
        }
        this.dg.isSingleClick = false;
        /** @type {?} */
        const _col_ = (editor || currentCell).column;
        /** @type {?} */
        const afterEditEvent = this.dg.afterEdit(currentCell.rowIndex, currentCell.rowData, _col_, editor);
        if (!afterEditEvent || !afterEditEvent.subscribe) {
            this.dg.writeConsole('please return an Observable Type.');
            return of(undefined);
        }
        // let cellEndEdit = of(undefined);
        /** @type {?} */
        let cellEndEdit = new Subject();
        afterEditEvent.pipe(takeUntil(this.destroy$)).subscribe((/**
         * @param {?} flag
         * @return {?}
         */
        (flag) => {
            if (flag) {
                /** @type {?} */
                let val = currentCell.value === undefined ? '' : currentCell.value;
                if (currentCell && currentCell.formControl && currentCell.formControl.value !== undefined && val !== currentCell.formControl.value) {
                    val = currentCell.formControl.value;
                    currentCell.isEditing = false;
                    currentCell.updateValue(val);
                }
                this.dfs.endEditCell();
                this.dgs.onEndCellEdit(this.dfs.getCurrentCell());
                this.unBindEditorInputEvent();
                // 移除编辑样式
                this.render.removeClass(this.el.nativeElement, CELL_EDITING_CLS);
                if (this.dg.selectedRow) {
                    this.dg.selectedRow.editors = [];
                }
                // this.dg.selectedRow.data = this.rowData;
                // 更新行样式或者单元格样式
                /** @type {?} */
                const _rid = this.dfs.primaryId(currentCell.rowData);
                this.dfs.rowUpdate$.next({ index: currentCell.rowIndex, data: currentCell.rowData, cellRef: currentCell, keyID: _rid });
                if (this.dg.showFooter) {
                    // 更新footerData
                    this.dgs.refreshFooterData.emit();
                }
                // 刷新行数据
                // this.dr.refresh();
                if (this.dg.selectedRow && this.dg.selectedRow.dr) {
                    this.dg.selectedRow.dr.refresh();
                }
                if (this['ENDEDIT_TIMER']) {
                    clearTimeout(this['ENDEDIT_TIMER']);
                }
                const { rowIndex, rowData } = currentCell;
                this['ENDEDIT_TIMER'] = setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dg.endEdit.emit({ rowIndex, rowData, column: _col_, value: val });
                    // cellEndEdit = of(true);
                    cellEndEdit.next(true);
                }), 100);
            }
            else {
                if (currentCell && currentCell.cellEditor && currentCell.cellEditor.componentRef && currentCell.cellEditor.componentRef.instance) {
                    editor = currentCell.cellEditor.componentRef.instance;
                    editor.inputElement.focus();
                    // cellEndEdit = of(false);
                    cellEndEdit.next(false);
                }
                else {
                    // cellEndEdit = of(true);
                    cellEndEdit.next(true);
                }
            }
        }));
        return cellEndEdit.asObservable();
    }
    /**
     * @return {?}
     */
    cancelCellEditing() {
        if (this.dg.currentCell && this.dg.currentCell.isEditing && this.dg.selectedRow.index > -1) {
            // this.dfs.resetRow(this.dg.selectedRow.id);
            this.dc.rowData = this.dg.selectedRow.data;
            this.formControl.reset(Utils.getValue(this.column.field, this.dc.rowData));
            this.closeEditingCell();
        }
    }
    /**
     * @return {?}
     */
    bindEditorInputEvent() {
        /** @type {?} */
        const ceRef = this.cellEditorRef || this.dc.cellEditor;
        /** @type {?} */
        let input = null;
        if (ceRef) {
            input = ceRef.componentRef.instance.inputElement;
        }
        else {
            if (this.column.editorTemplate) {
                input = this.dc.el.nativeElement.querySelector('input,textarea');
            }
        }
        if (input) {
            input.focus();
            if (this.dg.selectOnEditing && this.column.editorTemplate) {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    if (input.select) {
                        input.select();
                    }
                }));
            }
            this.editorInputKeydownEvent = this.render.listen(input, 'keydown', (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                this.onKeyDownForInput(e);
            }));
        }
    }
    /**
     * @return {?}
     */
    unBindEditorInputEvent() {
        if (this.editorInputKeydownEvent) {
            this.editorInputKeydownEvent();
            this.editorInputKeydownEvent = null;
        }
    }
    // private isLastCell() {
    //     let i = this.dg.flatColumns.length;
    //     while(i <= ) {
    //         if (this.dg.flatColumns[i])
    //     }
    // }
    /**
     * @return {?}
     */
    findLastEditCell() {
        /** @type {?} */
        let i = this.dg.colGroup.columns.length - 1;
        /** @type {?} */
        let _col = null;
        while (i >= 0) {
            /** @type {?} */
            const col = this.dg.colGroup.columns[i];
            if (col.editor || col.editorTemplate) {
                _col = col;
                break;
            }
            else {
                i--;
            }
        }
        return _col;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onKeyDownForInput(e) {
        /** @type {?} */
        const keyCode = e.keyCode;
        if (e.altKey || e.ctrlKey) {
            return;
        }
        if ((this.editor && this.editor.stopPropagation) || keyCode === 13 || this.column.editorTemplate) {
            e.stopPropagation();
        }
        switch (keyCode) {
            case 32: // SPACE
                if (this.column.editor.type === 'switch') {
                    e.preventDefault();
                    this.editor.instance.updateChecked(e, false);
                }
                break;
            case 13: // Enter
                this.closeEditingCell().pipe(takeUntil(this.destroy$)).pipe(debounceTime(100)).subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => {
                    if (f) {
                        this.dg.dgContainer.nativeElement.focus();
                        /** @type {?} */
                        const lastEditCell = this.findLastEditCell();
                        /** @type {?} */
                        const enterParam = { gird: this.dg, cell: this.dg.currentCell, event: e, lastCell: lastEditCell.field === this.column.field };
                        if (this.column.onEnterHandler) {
                            this.column.onEnterHandler(enterParam);
                        }
                        else {
                            /** @type {?} */
                            const nextTd = this.dg.findNextCell(this.column.field, 'right');
                            if (this.dg.currentCell.lastRow && (!nextTd || lastEditCell.field === this.column.field)) {
                                this.dg.lastCellEnterHandler.emit(enterParam);
                            }
                        }
                    }
                }));
                break;
            case 27: // ESC
                this.cancelCellEditing();
                break;
            case 9: // Tab
                e.stopPropagation();
                this.dg.clickDelay = 0;
                if (e.shiftKey) {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.movePrevCellAndEdit();
                        }
                    }));
                }
                else {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.moveNextCellAndEdit(e);
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 40: // ↓
                /** 选中下一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.selectNextRowAndEditCell(this.column.field, 'down');
                        }
                    }));
                    e.preventDefault();
                }
                break;
            case 38: // ↑
                /** 选中上一行，且当前列进入编辑态; 仅普通文本输入框支持 */
                if (this.column.editor.type === 'textbox') {
                    this.closeEditingCell().pipe(takeUntil(this.destroy$)).subscribe((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => {
                        if (f) {
                            this.selectNextRowAndEditCell(this.column.field, 'up');
                        }
                    }));
                    e.preventDefault();
                }
                break;
        }
    }
    /**
     * @private
     * @param {?} field
     * @param {?=} tdElement
     * @return {?}
     */
    selectCell(field, tdElement) {
        this.closeEditingCell().subscribe((/**
         * @param {?} t
         * @return {?}
         */
        t => {
            if (!t) {
                return;
            }
            tdElement = tdElement || this.el.nativeElement;
            this.clearCellSelectedClass();
            if (field && field !== this.dg.ControlPanelFeild && field.indexOf('farris-datagrid-column') === -1) {
                this.render.addClass(tdElement, CELL_SELECTED_CLS);
            }
            // this.dr.drHover.setRowHoverCls(false);
            this.dfs.setCurrentCell(this.dr, field, tdElement, this.dc);
            if (!this.dg.fast && this.column.fixed !== 'left' && this.column.fixed !== 'right') {
                this.moveScrollbar(tdElement);
            }
        }));
    }
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    moveScrollbar(td) {
        /** @type {?} */
        const tdPosLeft = td.offsetLeft + td.offsetWidth;
        /** @type {?} */
        const containerWidth = this.dg.width - this.dgb.columnsGroup.leftFixedWidth - this.dgb.columnsGroup.rightFixedWidth;
        /** @type {?} */
        const tdRect = td.getBoundingClientRect();
        /** @type {?} */
        const scrollContainer = this.dgb.ps.elementRef.nativeElement;
        /** @type {?} */
        const psContainer = scrollContainer.getBoundingClientRect();
        /** @type {?} */
        const scrollTop = scrollContainer.scrollTop;
        /** @type {?} */
        const scrollLeft = scrollContainer.scrollLeft;
        /** @type {?} */
        const scrollbarXLeft = this.dgb.ps.elementRef.nativeElement.scrollLeft;
        if (tdPosLeft > containerWidth) {
            /** @type {?} */
            const x = tdPosLeft - containerWidth + 2;
            // const x = tdPosLeft - this.dgb.ps.instance.scrollbarXWidth + 2;
            if (x > scrollbarXLeft) {
                this.dgb.ps.scrollToX(x);
            }
        }
        else {
            // if (tdRect.x < psContainer.x) {
            //     const x = scrollLeft - tdRect.x;
            //     this.dgb.ps.scrollToX(x);
            // }
            if (td.offsetLeft < scrollLeft) {
                this.dgb.ps.scrollToX(td.offsetLeft);
            }
        }
        /** @type {?} */
        const tdPosTop = tdRect.top - psContainer.top + tdRect.height;
        if (tdPosTop > psContainer.height) {
            /** @type {?} */
            const y = tdPosTop - psContainer.height;
            this.dgb.ps.scrollToY(scrollTop + y);
        }
        else {
            if (tdRect.y < psContainer.y) {
                this.dgb.ps.scrollToY(scrollTop - (psContainer.y - tdRect.y));
            }
        }
    }
    /**
     * @private
     * @param {?=} event
     * @return {?}
     */
    moveNextCellAndEdit(event) {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        // const fieldIndex = this.dfs.getColumnIndex(this.column.field);
        /** @type {?} */
        const fieldIndex = this.dg.colGroup.columns.findIndex((/**
         * @param {?} n
         * @return {?}
         */
        n => (n.id && n.id === this.column.id) || n.field === this.column.field));
        if (fieldIndex + 1 < this.dgb.columnsGroup.columns.length) {
            /** @type {?} */
            const nextColumn = this.dgb.columnsGroup.columns[fieldIndex + 1];
            /** @type {?} */
            const nextTd = this.dg.findNextTd(nextColumn);
            if (nextTd && (!nextColumn.fixed || nextColumn.fixed === 'center')) {
                this.moveScrollbar(nextTd);
            }
            // const nextTd = this.dg.currentCell.cellElement.nextElementSibling;
            if (nextColumn && ((!nextColumn.editor && !nextColumn.editorTemplate) || this.isReadonly(nextColumn))) {
                if (nextTd) {
                    nextTd.selectCell(event, nextTd);
                }
                return;
            }
            if (nextTd) {
                nextTd.focus();
                if (nextColumn.editor || nextColumn.editorTemplate) {
                    nextTd.editCell();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
        else {
            // next row's first cell to editing
            /** @type {?} */
            const nextTr = this.dg.currentCell.cellElement.parentElement.nextElementSibling;
            if (nextTr && nextTr.tagName === 'TR') {
                // nextTr.children.find(td => td.editCell).editCell();
                /** @type {?} */
                let firstEditor = false;
                /** @type {?} */
                let i = 0;
                while (!firstEditor) {
                    firstEditor = !!nextTr.children[i].editCell;
                    if (!firstEditor) {
                        i++;
                    }
                }
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                nextTr.children[i].editCell();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    movePrevCellAndEdit() {
        // if (!this.closeEditingCell()) {
        //     return;
        // }
        /** @type {?} */
        const fieldIndex = this.dfs.getColumnIndex(this.column.field);
        if (fieldIndex - 1 >= 0) {
            /** @type {?} */
            const nextColumn = this.dgb.columnsGroup.normalColumns[fieldIndex - 1];
            if (nextColumn && this.isReadonly(nextColumn)) {
                return;
            }
            /** @type {?} */
            const nextTd = this.dg.currentCell.cellElement.previousElementSibling;
            if (nextTd) {
                // this.selectCell(nextColumn.field, nextTd);
                nextTd.focus();
                if (nextColumn.editor) {
                    // this.dfs.editCell();
                    nextTd.click();
                    this.dgs.onCellEdit(nextTd);
                }
            }
        }
    }
    /**
     * @private
     * @param {?} cellFieldName
     * @param {?} dir
     * @return {?}
     */
    selectNextRowAndEditCell(cellFieldName, dir) {
        if (!this.dg.currentCell) {
            this.dg.writeConsole('当前选中单元格为空');
            return;
        }
        /** @type {?} */
        const p = dir === 'down' ? 'nextElementSibling' : 'previousElementSibling';
        /** @type {?} */
        const nextTr = this.dg.currentCell.cellElement.parentElement[p];
        if (nextTr && nextTr.tagName === 'TR') {
            /** @type {?} */
            const td = Array.from(nextTr.children).find((/**
             * @param {?} td
             * @return {?}
             */
            (td) => td.getAttribute('field') == cellFieldName));
            if (td && td.editCell) {
                if (this.dg.selectionMode === 'default') {
                    this.dg.clearCheckeds();
                }
                td.editCell();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    clearCellSelectedClass() {
        this.dg.removeCellSelectedCls();
    }
    /**
     * @private
     * @return {?}
     */
    setCellClsWithEditorType() {
        // 设置当前选中单元格样式
        if (this.dg.currentCell && this.dg.enableHighlightCell) {
            if (this.dg.currentCell.field === this.column.field && this.dg.currentCell.rowId === this.rowData[this.dg.idField] && !this.dc.isEditing) {
                this.clearCellSelectedClass();
                this.render.addClass(this.el.nativeElement, CELL_SELECTED_CLS);
            }
        }
        if (!this.dg.enableEditCellStyle) {
            return;
        }
        /** @type {?} */
        const td = this.el.nativeElement;
        this.cleanOtherEditorIcon(td);
        // 当前行禁用，不允许编辑。
        if (this.dr.disabled) {
            return;
        }
        if (!this.column.editor) {
            return;
        }
        if (this.isReadonly()) {
            return;
        }
        /** @type {?} */
        const editorType = this.column.editor.type;
        /** @type {?} */
        const cls = this.column.align === 'right' ? 'allow-edit-cell-left' : 'allow-edit-cell';
        this.render.addClass(td, cls);
        this.render.addClass(td, ALLOW_EDIT_CELL_HIGHLIGHT_CLS[editorType]);
    }
    /**
     * @private
     * @param {?} td
     * @return {?}
     */
    cleanOtherEditorIcon(td) {
        /** @type {?} */
        const values = Object.values(ALLOW_EDIT_CELL_HIGHLIGHT_CLS);
        values.forEach((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (td.className.indexOf(v) > -1) {
                td.className = td.className.replace('allow-edit-cell-left', '').replace('allow-edit-cell', '');
                td.className = td.className.replace(v, '');
            }
        }));
    }
}
DatagridCellEditableDirective.decorators = [
    { type: Directive, args: [{
                selector: '[cell-editable]',
                exportAs: 'cellEditable'
            },] }
];
/** @nocollapse */
DatagridCellEditableDirective.ctorParameters = () => [
    { type: Injector },
    { type: ElementRef },
    { type: Renderer2 },
    { type: DatagridComponent, decorators: [{ type: Inject, args: [forwardRef((/**
                     * @return {?}
                     */
                    () => DatagridComponent)),] }] },
    { type: NgZone }
];
DatagridCellEditableDirective.propDecorators = {
    rowData: [{ type: Input, args: ['cell-editable',] }],
    column: [{ type: Input }],
    dc: [{ type: ContentChild, args: [DatagridCellComponent,] }]
};
if (false) {
    /** @type {?} */
    DatagridCellEditableDirective.prototype.rowData;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.column;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.clickTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.celldblclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.bindCellEventSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.editorInputKeydownEvent;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.editor;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.formControl;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.cellEditorRef;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dc;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgb;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dr;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dfs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.dgs;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorCreatedSubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.cellEditorDestorySubscription;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.validMessageEle;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.injector;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellEditableDirective.prototype.render;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.dg;
    /** @type {?} */
    DatagridCellEditableDirective.prototype.ngZone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY2VsbC1lZGl0YWJsZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1jZWxsLWVkaXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFRQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFVLFlBQVksRUFBYSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBaUIsTUFBTSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUV4TCxPQUFPLEVBQUUsTUFBTSxFQUE0QixZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0YsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSw2QkFBNkIsRUFBMkIsTUFBTSxzQkFBc0IsQ0FBQztBQUVuSSxPQUFPLEVBQUUsRUFBRSxFQUFpQixJQUFJLEVBQUUsT0FBTyxFQUFlLE1BQU0sTUFBTSxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQU0xQyxNQUFNLE9BQU8sNkJBQTZCOzs7Ozs7OztJQTRCdEMsWUFDWSxRQUFrQixFQUFTLEVBQWMsRUFBVSxNQUFp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QUMxQixrRUFBZ0Q7Ozs7O0lBRWhELGdFQUFxQzs7SUFDckMsK0NBQVk7O0lBQ1osb0RBQXlCOztJQUN6QixzREFBbUI7O0lBR25CLDJDQUErRDs7Ozs7SUFDL0QsNENBQW1DOzs7OztJQUNuQywyQ0FBaUM7Ozs7O0lBQ2pDLDRDQUFtQzs7Ozs7SUFDbkMsNENBQTZCOzs7OztJQUc3QixzRUFBNkM7Ozs7O0lBQzdDLHNFQUE2Qzs7Ozs7SUFDN0MsaURBQWlDOzs7OztJQUNqQyx3REFBK0I7Ozs7O0lBRzNCLGlEQUEwQjs7SUFBRSwyQ0FBcUI7Ozs7O0lBQUUsK0NBQXlCOztJQUM1RSwyQ0FBeUU7O0lBQUUsK0NBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogQEF1dGhvcjog55av54uC56eA5omNKEx1Y2FzIEh1YW5nKVxyXG4gKiBARGF0ZTogMjAxOS0wOC0wNiAwNzo0MzowN1xyXG4gKiBATGFzdEVkaXRvcnM6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQExhc3RFZGl0VGltZTogMjAxOS0xMS0xOSAxNTo0ODoyN1xyXG4gKiBAUVE6IDEwNTU4MTgyMzlcclxuICogQFZlcnNpb246IHYwLjAuMVxyXG4gKi9cclxuaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBPbkluaXQsIENvbnRlbnRDaGlsZCwgT25EZXN0cm95LCBJbmplY3RvciwgZm9yd2FyZFJlZiwgSW5qZWN0LCBBZnRlclZpZXdJbml0LCBOZ1pvbmUsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHN3aXRjaE1hcCwgdGFrZUxhc3QsIGRlYm91bmNlVGltZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2VzL2RhdGFncmlkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENlbGxDb21wb25lbnQgfSBmcm9tICcuL2RhdGFncmlkLWNlbGwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRCb2R5Q29tcG9uZW50IH0gZnJvbSAnLi9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IERhdGFncmlkUm93RGlyZWN0aXZlIH0gZnJvbSAnLi9kYXRhZ3JpZC1yb3cuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiB9IGZyb20gJy4vLi4vLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZEZhY2FkZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vZGF0YWdyaWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ0VMTF9TRUxFQ1RFRF9DTFMsIENFTExfRURJVElOR19DTFMsIEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTLCBUUl9QUkVGSVgsIFRSX0lEX1BSRUZJWCB9IGZyb20gJy4uLy4uL3R5cGVzL2NvbnN0YW50JztcclxuaW1wb3J0IHsgRG9tSGFuZGxlciB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2RvbWhhbmRsZXInO1xyXG5pbXBvcnQgeyBvZiwgU3Vic2NyaXB0aW9uLCAgbm9vcCwgU3ViamVjdCwgT2JzZXJ2YWJsZSAgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLi8uLi91dGlscy91dGlscyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2NlbGwtZWRpdGFibGVdJyxcclxuICAgIGV4cG9ydEFzOiAnY2VsbEVkaXRhYmxlJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRDZWxsRWRpdGFibGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgnY2VsbC1lZGl0YWJsZScpIHJvd0RhdGE6IGFueTtcclxuICAgIEBJbnB1dCgpIGNvbHVtbjogRGF0YUNvbHVtbjtcclxuXHJcbiAgICBwcml2YXRlIGNsaWNrVGltZXI6IGFueTtcclxuXHJcbiAgICBwcml2YXRlIGNlbGxjbGljazogYW55O1xyXG4gICAgcHJpdmF0ZSBjZWxsZGJsY2xpY2s6IGFueTtcclxuICAgIHByaXZhdGUgYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIHByaXZhdGUgZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQ6IGFueTtcclxuICAgIGVkaXRvcjogYW55O1xyXG4gICAgZm9ybUNvbnRyb2w6IEZvcm1Db250cm9sO1xyXG4gICAgY2VsbEVkaXRvclJlZjogYW55O1xyXG5cclxuXHJcbiAgICBAQ29udGVudENoaWxkKERhdGFncmlkQ2VsbENvbXBvbmVudCkgZGM6IERhdGFncmlkQ2VsbENvbXBvbmVudDtcclxuICAgIHByaXZhdGUgZGdiOiBEYXRhZ3JpZEJvZHlDb21wb25lbnQ7XHJcbiAgICBwcml2YXRlIGRyOiBEYXRhZ3JpZFJvd0RpcmVjdGl2ZTtcclxuICAgIHByaXZhdGUgZGZzOiBEYXRhZ3JpZEZhY2FkZVNlcnZpY2U7XHJcbiAgICBwcml2YXRlIGRnczogRGF0YWdyaWRTZXJ2aWNlO1xyXG5cclxuICAgIC8vIHByaXZhdGUgX3JlYWRvbmx5JCA9IG51bGw7XHJcbiAgICBwcml2YXRlIGNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgIHByaXZhdGUgY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIHZhbGlkTWVzc2FnZUVsZSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsIHB1YmxpYyBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMixcclxuICAgICAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gRGF0YWdyaWRDb21wb25lbnQpKSBwdWJsaWMgZGc6IERhdGFncmlkQ29tcG9uZW50LCBwdWJsaWMgbmdab25lOiBOZ1pvbmUpIHtcclxuICAgICAgICB0aGlzLmRnYiA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkQm9keUNvbXBvbmVudCk7XHJcbiAgICAgICAgdGhpcy5kciA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkUm93RGlyZWN0aXZlKTtcclxuICAgICAgICB0aGlzLmRmcyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkRmFjYWRlU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5kZ3MgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZFNlcnZpY2UpO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24gPSB0aGlzLmRncy5jZWxsRWRpdG9yQ3JlYXRlZC5waXBlKFxyXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpXHJcbiAgICAgICAgICAgICkucGlwZShcclxuICAgICAgICAgICAgICAgIGZpbHRlcigoeyBjb2x1bW4sIGVkaXRvclJlZiwgY2VsbEVkaXRvclJlZiwgdGVtcGxhdGVSZWYgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW4uZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQgPT09IHRoaXMuZHIucm93SWQ7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApLnN1YnNjcmliZSgoeyBlZGl0b3JSZWYsIGNlbGxFZGl0b3JSZWYsIHRlbXBsYXRlUmVmIH0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlZGl0b3JSZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWydlZGl0b3InXSA9IGVkaXRvclJlZi5pbnN0YW5jZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWydmb3JtQ29udHJvbCddID0gdGhpcy5lZGl0b3IuZm9ybUNvbnRyb2wgYXMgRm9ybUNvbnRyb2w7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yUmVmID0gY2VsbEVkaXRvclJlZjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXRCZWdpbkVkaXQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snZm9ybUNvbnRyb2wnXSA9IHRoaXMuZHIuZm9ybS5nZXQodGhpcy5jb2x1bW4uZmllbGQpIGFzIEZvcm1Db250cm9sO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmJlZ2luRWRpdC5lbWl0KHsgZWRpdG9yOiBudWxsLCBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgdGVtcGxhdGU6IHRlbXBsYXRlUmVmIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGcucm93Q2xpY2suZW1pdCh7IGRhdGE6IHRoaXMucm93RGF0YSwgZ3JpZDogdGhpcy5kZywgZGJsY2xpY2s6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZGcuZGdzLmNlbGxFZGl0b3JEZXN0b3J5LnBpcGUoXHJcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICkucGlwZShcclxuICAgICAgICAgICAgZmlsdGVyKCh7IGNvbHVtbiB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZy5zZWxlY3RlZFJvdyAmJiBjb2x1bW4uZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQgPT09IHRoaXMuZHIucm93SWQ7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmVkaXRvcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5lZGl0b3IgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVkaXRvclJlZiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51bkJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvclJlZiA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvciA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZVZhbGlkTWVzc2FnZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMucm93RGF0YSAmJiAhY2hhbmdlcy5yb3dEYXRhLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRDZWxsRXZlbnQoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRDZWxsQ2xzV2l0aEVkaXRvclR5cGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdENlbGxFdmVudCgpO1xyXG4gICAgICAgIHRoaXMuc2V0Q2VsbENsc1dpdGhFZGl0b3JUeXBlKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgcnVuWm9uZUNsaWNrKGU6IGFueSkge1xyXG4gICAgICAgIGlmKHRoaXNbJ3pvbmVDbGljayddKSB7XHJcblxyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGUsIHtyb3dEYXRhOiB0aGlzLnJvd0RhdGF9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXNbJ3pvbmVDbGljayddLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBuLnRhcmdldC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nO1xyXG4gICAgICAgICAgICAgICAgaWYgKG4uY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBuLmNhbGxiYWNrKGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuLmhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBuLmhhbmRsZXIoZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuaXNGRikge1xyXG4gICAgICAgICAgICAgICAgZS50YXJnZXRbJ19fem9uZV9zeW1ib2xfX2NsaWNrZmFsc2UnXSA9IHRoaXNbJ3pvbmVDbGljayddO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdENlbGxFdmVudCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2x1bW4gJiYgKHRoaXMuY29sdW1uLmVkaXRvciB8fCB0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmNsaWNrVG9FZGl0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNlbGxkYmxjbGljayA9IHRoaXMucmVuZGVyLmxpc3Rlbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkYmxjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkRibENsaWNrQ2VsbChlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5lZGl0ID0gKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnN1YnNjcmliZSgoY2FuRWRpdDogYm9vbGVhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYW5FZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25DbGlja0NlbGwoZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGcuc2VsZWN0ZWRSb3cgfHwgdGhpcy5kZy5zZWxlY3RlZFJvdy5pZCAhPT0gdGhpcy5kci5yb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RSb3codGhpcy5kci5yb3dJZCwgdHJ1ZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1blpvbmVDbGljayhlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZWRpdENlbGwgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbEVkaXRvcigpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tUaW1lciA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBleGNsdWRlVGFyZ2V0ID0gKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZS50YXJnZXQucGFyZW50RWxlbWVudC5ub2RlTmFtZSAhPT0gJ0dSSUQtQk9EWS1DRUxMJyAmJlxyXG4gICAgICAgICAgICBlLnRhcmdldC5ub2RlTmFtZSAhPT0gJ0lOUFVUJyAmJiAgZS50YXJnZXQubm9kZU5hbWUgIT09ICdURVhUQVJFQScgJiZcclxuICAgICAgICAgICAgIShlLnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZignY3VzdG9tLWNvbnRyb2wtbGFiZWwnKSA+IC0xICYmIFxyXG4gICAgICAgICAgICBlLnRhcmdldC5wYXJlbnRFbGVtZW50ICYmIGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoJ2N1c3RvbS1jb250cm9sJykgPiAtMSkgJiZcclxuICAgICAgICAgICAgIWUudGFyZ2V0LmNsb3Nlc3QoJ2lucHV0LWdyb3VwJykgJiYgIWUudGFyZ2V0LmNsb3Nlc3QoJ2ZhcnJpcy1zd2l0Y2gnKSAmJlxyXG4gICAgICAgICAgICAhZS50YXJnZXQuY2xvc2VzdCgnZmFycmlzLW51bWJlci1zcGlubmVyJykgJiZcclxuICAgICAgICAgICAgIWUudGFyZ2V0LmNsb3Nlc3QoJ2ZhcnJpcy1kYXRlcGlja2VyJykgJiZcclxuICAgICAgICAgICAgIWUudGFyZ2V0LmNsb3Nlc3QoJ2ZhcnJpcy10aW1lLXBpY2tlcicpICYmIFxyXG4gICAgICAgICAgICAhZS50YXJnZXQuY2xvc2VzdCgnZ3JpZC1lZGl0b3ItdGV4dGFyZWEnKSAmJlxyXG4gICAgICAgICAgICAhZS50YXJnZXQuY2xvc2VzdCgnZmFycmlzLWNoZWNrYm94Z3JvdXAnKSAmJiBcclxuICAgICAgICAgICAgIWUudGFyZ2V0LmNsb3Nlc3QoJ2dyaWQtZWRpdG9yLWNoZWNrYm94JykgJiYgIWUudGFyZ2V0LmNsb3Nlc3QoJ2ZhcnJpcy1yYWRpb2dyb3VwJykgJiZcclxuICAgICAgICAgICAgIWUudGFyZ2V0LmNsb3Nlc3QoJ2ZhcnJpcy1vcmdhbml6YXRpb24tc2VsZWN0b3InKSAmJiAhZS50YXJnZXQuY2xvc2VzdCgnZmFycmlzLXBlcnNvbm5lbC1zZWxlY3RvcicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uLnByb3h5Q2xpY2sgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbi5wcm94eUNsaWNrID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtbi50ZW1wbGF0ZSAmJiB0aGlzLmNvbHVtbi5wcm94eUNsaWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzWydfdGRtb3VzZWRvd25fJ10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzWydfdGRtb3VzZWRvd25fJ10sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpc1snX3RkbW91c2Vkb3duXyddID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXNbJ190ZG1vdXNlZG93bl8nXSA9IChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChleGNsdWRlVGFyZ2V0KGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1snem9uZUNsaWNrJ10gPSBlLnRhcmdldFsnX196b25lX3N5bWJvbF9fY2xpY2tmYWxzZSddIHx8IGUudGFyZ2V0WydfX3pvbmVfc3ltYm9sX19BTkdVTEFSY2xpY2tGQUxTRSddO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzWyd6b25lQ2xpY2snXSAmJiB0aGlzWyd6b25lQ2xpY2snXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmlzRkYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXRbJ19fem9uZV9zeW1ib2xfX2NsaWNrZmFsc2UnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZShlLnRhcmdldFsnX196b25lX3N5bWJvbF9fY2xpY2tmYWxzZSddKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldFsnX196b25lX3N5bWJvbF9fQU5HVUxBUmNsaWNrRkFMU0UnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZShlLnRhcmdldFsnX196b25lX3N5bWJvbF9fQU5HVUxBUmNsaWNrRkFMU0UnXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1snem9uZUNsaWNrJ10uZm9yRWFjaCgocHJveHlDbGljayA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb3h5Q2xpY2sudGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlDbGljay50YXJnZXQgPSBlLnRhcmdldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICB0aGlzWydfdGRtb3VzZWRvd25fJ10gPSB0aGlzLnJlbmRlci5saXN0ZW4odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4Y2x1ZGVUYXJnZXQoZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWyd6b25lQ2xpY2snXSA9IGUudGFyZ2V0WydfX3pvbmVfc3ltYm9sX19jbGlja2ZhbHNlJ10gfHwgZS50YXJnZXRbJ19fem9uZV9zeW1ib2xfX0FOR1VMQVJjbGlja0ZBTFNFJ107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNbJ3pvbmVDbGljayddICYmIHRoaXNbJ3pvbmVDbGljayddLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzWyd6b25lQ2xpY2snXS5mb3JFYWNoKChwcm94eUNsaWNrID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJveHlDbGljay50YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eUNsaWNrLnRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgKi9cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5ncmlkQ2VsbERhdGEgPSB7IHJvd0RhdGE6IHRoaXMucm93RGF0YSwgcm93SW5kZXg6IHRoaXMuZHIucm93SW5kZXggfTtcclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xvc2VFZGl0ID0gKCkgPT4gdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCk7XHJcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnNlbGVjdENlbGwgPSAoZSwgZWwpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZGlzYWJsZVJvdyAmJiB0aGlzLmRnLmRpc2FibGVSb3codGhpcy5yb3dEYXRhLCB0aGlzLmRyLnJvd0luZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBiZWZvckV2ZW50UGFyYW0gPSB7XHJcbiAgICAgICAgICAgICAgICByb3dJbmRleDogdGhpcy5kci5yb3dJbmRleCxcclxuICAgICAgICAgICAgICAgIHJvd0RhdGE6IHRoaXMucm93RGF0YSxcclxuICAgICAgICAgICAgICAgIGdyaWRJbnN0YW5jZTogdGhpcy5kZ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcnVuVGVtcGxhdGVDbGlja0V2ZW50ID0gKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCwgZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsID0geyByb3dEYXRhOiB0aGlzLnJvd0RhdGEgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbC5yb3dEYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwucm93RGF0YSA9IHRoaXMucm93RGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzWyd6b25lQ2xpY2snXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucnVuWm9uZUNsaWNrKGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2VsbENsaWNrLmVtaXQoeyBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgZXZlbnQ6IGUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHVzZU5ld1NlbGVjdGlvbk1vZGUgPSB0aGlzLmRnLnNtcy5iZWZvclJvd0NsaWNrKHsgLi4uYmVmb3JFdmVudFBhcmFtLCBlLCBpZDogdGhpcy5kci5yb3dJZCwgZHI6IHRoaXMuZHIsIGNlbGxyZWY6IHRoaXMgfSk7XHJcbiAgICAgICAgICAgIGlmICh1c2VOZXdTZWxlY3Rpb25Nb2RlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQsIGVsKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY3VycmVudENlbGwgPSB7IHJvd0RhdGE6IHRoaXMucm93RGF0YSB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5jdXJyZW50Q2VsbC5yb3dEYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5yb3dEYXRhID0gdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuY2VsbENsaWNrLmVtaXQoeyBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZywgZXZlbnQ6IGUgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGZzLmlzUm93U2VsZWN0ZWQodGhpcy5kci5yb3dJZCkpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5rZWVwU2VsZWN0ICYmICF0aGlzLmNvbHVtbi50ZW1wbGF0ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCAmJiB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50ICYmIHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQuaWQgPT09IGVsLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2FuY2VsU2VsZWN0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5iZWZvcmVVbnNlbGVjdChiZWZvckV2ZW50UGFyYW0pLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSxcclxuICAgICAgICAgICAgICAgICAgICApLnN1YnNjcmliZSgoY2FuVW5zZWxlY3Q6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhblVuc2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmRnLnVuU2VsZWN0LmVtaXQodGhpcy5kZy5zZWxlY3RlZFJvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRmcy51blNlbGVjdFJvdyh0aGlzLmRyLnJvd0luZGV4LCB0aGlzLnJvd0RhdGEsIHtpbnN0YW5jZTogdGhpcy5kZ30pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ckNMUyA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc05hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJDTFMuaW5kZXhPZignZi1kYXRhZ3JpZC1yb3ctc2VsZWN0ZWQnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZSA9IHRyQ0xTLnJlcGxhY2UoJ2YtZGF0YWdyaWQtcm93LXNlbGVjdGVkJywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucm93Q2xpY2suZW1pdCh7IGRhdGE6IHRoaXMucm93RGF0YSwgZ3JpZDogdGhpcy5kZywgZGJsY2xpY2s6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmRncy5zZXRTZWxlY2VkUm93LmVtaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5yb3dDbGljay5lbWl0KHsgZGF0YTogdGhpcy5yb3dEYXRhLCBncmlkOiB0aGlzLmRnLCBkYmxjbGljazogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVuVGVtcGxhdGVDbGlja0V2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgciQ6IE9ic2VydmFibGU8YW55PiA9IG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuYmVmb3JlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuZGcuYmVmb3JlU2VsZWN0KHsgcm93SW5kZXg6IHRoaXMuZHIucm93SW5kZXggLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAociAmJiByLnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByJCA9IHI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3Qgem9uZUNsaWNrID0gdGhpc1snem9uZUNsaWNrJ107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBfdGltZXIgPSB6b25lQ2xpY2sgJiYgem9uZUNsaWNrLmxlbmd0aCA/IDEwMDogMDtcclxuICAgICAgICAgICAgICAgIHIkLnBpcGUoZGVib3VuY2VUaW1lKF90aW1lcikpLnN1YnNjcmliZSgodCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCwgZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmNlbGxDbGljay5lbWl0KHsgY29sdW1uOiB0aGlzLmNvbHVtbiwgcm93RGF0YTogdGhpcy5yb3dEYXRhLCBncmlkSW5zdGFuY2U6IHRoaXMuZGcsIGV2ZW50OiBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1blpvbmVDbGljayhlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnJvd0NsaWNrLmVtaXQoeyBkYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWQ6IHRoaXMuZGcsIGRibGNsaWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmRncy5zZXRTZWxlY2VkUm93LmVtaXQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2FuY2VsU2VsZWN0ZWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgQ0VMTF9TRUxFQ1RFRF9DTFMpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfRURJVElOR19DTFMpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsY2xpY2spIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsY2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNlbGxkYmxjbGljaykge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxkYmxjbGljaygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51bkJpbmRFZGl0b3JJbnB1dEV2ZW50KCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmJpbmRDZWxsRXZlbnRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kQ2VsbEV2ZW50U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZENlbGxFdmVudFN1YnNjcmlwdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jZWxsRWRpdG9yQ3JlYXRlZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JDcmVhdGVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbEVkaXRvckNyZWF0ZWRTdWJzY3JpcHRpb24gPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbEVkaXRvckRlc3RvcnlTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxsRWRpdG9yRGVzdG9yeVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNlbGxFZGl0b3JEZXN0b3J5U3Vic2NyaXB0aW9uID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZWRpdG9yID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNlbGxFZGl0b3JSZWYgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5lbCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2FuY2VsU2VsZWN0ZWQgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc2VsZWN0Q2VsbCA9IG5vb3A7XHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5jbG9zZUVkaXQgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ3JpZENlbGxEYXRhID0gbm9vcDtcclxuICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmVkaXQgPSBub29wO1xyXG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc2VsZWN0Q2VsbCA9IG5vb3A7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpc1snX3RkbW91c2Vkb3duXyddKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpc1snX3RkbW91c2Vkb3duXyddLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIHRoaXNbJ190ZG1vdXNlZG93bl8nXSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGlzRGlmZmVyZW50Q2VsbCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcuY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLnNlbGVjdGVkUm93IHx8IHRoaXMuZGcuc2VsZWN0ZWRSb3cuaW5kZXggIT09IHRoaXMuZHIucm93SW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZHIucm93SW5kZXggIT09IHRoaXMuZGcuY3VycmVudENlbGwucm93SW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGcuY3VycmVudENlbGwuZmllbGQgIT09IHRoaXMuY29sdW1uLmZpZWxkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25DbGlja0NlbGwoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIC8vIOWFs+mXreWFtuS7lkdyaWQg55qE57yW6L6R5ZmoXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGljaygpO1xyXG5cclxuICAgICAgICB0aGlzLmRnLmJlZm9yZUNsaWNrQ2VsbC5lbWl0KHsgcm93SW5kZXg6IHRoaXMuZHIucm93SW5kZXgsIHJvd0RhdGE6IHRoaXMucm93RGF0YSwgY29sdW1uOiB0aGlzLmNvbHVtbiwgZ3JpZEluc3RhbmNlOiB0aGlzLmRnIH0pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kci5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmVkaXRhYmxlIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5lbmFibGVIaWdobGlnaHRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIOWPquivu+WNleWFg+agvO+8jOeCueWHu+WQjumhu+inpuWPkeihjOeCueWHu+S6i+S7tiB0ZnMgNTc0NTUxXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnJvd0NsaWNrLmVtaXQoeyBkYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWQ6IHRoaXMuZGcsIGRibGNsaWNrOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRNb2RlID09PSAncm93Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0aW9uTW9kZSA9PT0gJ2RlZmF1bHQnICYmIGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnSU5QVVQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyBpZiAodGhpcy5kZy5jbGlja1RvRWRpdCAmJiAhdGhpcy5kZy5kYmxjbGlja1Jvdy5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuZGcuY2xpY2tEZWxheSA9IDA7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5kZy5lbC5uYXRpdmVFbGVtZW50LCAnZi1kYXRhZ3JpZC11bnNlbGVjdCcpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNTaW5nbGVDbGljayAmJiB0aGlzLmRnLmVkaXRNb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jbGlja1RpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jbGlja1RpbWVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jbGlja1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5pc1NpbmdsZUNsaWNrICYmIHRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5pc1NpbmdsZUNsaWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY2xpY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VFZGl0aW5nQ2VsbCgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKVxyXG4gICAgICAgICAgICAgICAgICAgICkuc3Vic2NyaWJlKChmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmNsaWNrVG9FZGl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXRoaXMuZGcubm93cmFwICYmIHRoaXMuZGdiLnVwZGF0ZVJvd0hlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbkNlbGxFZGl0b3IoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudCwgJ2YtZGF0YWdyaWQtdW5zZWxlY3QnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5kZy5jbGlja0RlbGF5KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbkRibENsaWNrQ2VsbChldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVkIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChldmVudC50YXJnZXRbJ25vZGVOYW1lJ10gPT09ICdJTlBVVCcgfHwgZXZlbnQudGFyZ2V0Wydub2RlTmFtZSddID09PSAnVEVYVEFSRUEnKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdGFibGUgJiYgdGhpcy5kZy5lZGl0TW9kZSA9PT0gJ2NlbGwnKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNsaWNrVGltZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY2xpY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWNrVGltZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuQ2VsbEVkaXRvcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgXHJcbiAgICB9XHJcblxyXG4gICAgaXNSZWFkb25seShjb2wgPSB0aGlzLmNvbHVtbikge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmVkaXRhYmxlKSB7XHJcbiAgICAgICAgICAgIC8vIOWPguS4juWQiOW5tueahOWNleWFg+agvOS4jeWFgeiuuOe8lui+kVxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5tZXJnZUNlbGwgJiYgdGhpcy5kZy5tZXJnZUZpZWxkcy5pbmRleE9mKGNvbC5maWVsZCkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVhZG9ubHlWYWx1ZShjb2wpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFJlYWRvbmx5VmFsdWUoY29sID0gdGhpcy5jb2x1bW4pIHtcclxuICAgICAgICBpZiAoY29sLnJlYWRvbmx5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb2wucmVhZG9ubHkgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbC5yZWFkb25seTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29sLnJlYWRvbmx5ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sLnJlYWRvbmx5KHRoaXMucm93RGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIG9wZW5DZWxsRWRpdG9yKCkge1xyXG4gICAgICAgIC8vIOW9k+WJjeihjOemgeeUqO+8jOS4jeWFgeiuuOe8lui+keOAglxyXG4gICAgICAgIGlmICh0aGlzLmRyLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgoIXRoaXMuY29sdW1uLmVkaXRvciAmJiAhdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHx8ICF0aGlzLmRnLmVkaXRhYmxlIHx8IHRoaXMuaXNSZWFkb25seSgpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0JyAmJiB0aGlzLmRnLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBiZWZvcmVFZGl0RXZlbnQgPSB0aGlzLmRnLmJlZm9yZUVkaXQoeyByb3dJbmRleDogdGhpcy5kci5yb3dJbmRleCwgcm93RGF0YTogdGhpcy5yb3dEYXRhLCBjb2x1bW46IHRoaXMuY29sdW1uLCBncmlkSW5zdGFuY2U6IHRoaXMuZGcgfSk7XHJcbiAgICAgICAgaWYgKCFiZWZvcmVFZGl0RXZlbnQgfHwgIWJlZm9yZUVkaXRFdmVudC5zdWJzY3JpYmUpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy53cml0ZUNvbnNvbGUoJ3BsZWFzZSByZXR1cm4gYW4gT2JzZXJ2YWJsZSBUeXBlLicpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGcuY3VycmVudENlbGwuY2VsbFJlZiB8fCB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYuY29sdW1uLmZpZWxkICE9PSB0aGlzLmNvbHVtbi5maWVsZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsUmVmID0gdGhpcy5kYztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGJlZm9yZUVkaXRFdmVudC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChmbGFnKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RpZmZlcmVudENlbGwoKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3Rpb25Nb2RlID09PSAnZGVmYXVsdCcgJiYgdGhpcy5kZy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRmcy5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY29sdW1uLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIC8vIHRmcyA1NzQ2MTJcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcucm93Q2xpY2suZW1pdCh7IGRhdGE6IHRoaXMucm93RGF0YSwgZ3JpZDogdGhpcy5kZywgZGJsY2xpY2s6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBlbWl0QmVnaW5FZGl0KCkge1xyXG5cclxuICAgICAgICBjb25zdCBfY2VsbEVkaXRvclJlZiA9IHRoaXMuY2VsbEVkaXRvclJlZiB8fCB0aGlzLmRjLmNlbGxFZGl0b3I7XHJcblxyXG4gICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZGcuZWwubmF0aXZlRWxlbWVudCwgJ2YtZGF0YWdyaWQtdW5zZWxlY3QnKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmVkaXRvcnMgPSBbdGhpcy5lZGl0b3JdO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmVkaXRvciA9IHRoaXMuZWRpdG9yO1xyXG4gICAgICAgICAgICB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFZGl0b3JSZWYgPSBfY2VsbEVkaXRvclJlZjtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRWRpdG9ySW5wdXRFdmVudCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHRoaXMuZm9ybUNvbnRyb2wuc2V0VmFsdWUodGhpcy5kYy52YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuYmVnaW5FZGl0LmVtaXQoeyBlZGl0b3I6IF9jZWxsRWRpdG9yUmVmLCBjb2x1bW46IHRoaXMuY29sdW1uLCByb3dEYXRhOiB0aGlzLnJvd0RhdGEsIGdyaWRJbnN0YW5jZTogdGhpcy5kZyB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRhcmVhJyAmJiB0aGlzLmNvbHVtbi5lZGl0b3Iub3B0aW9ucyAmJiB0aGlzLmNvbHVtbi5lZGl0b3Iub3B0aW9ucy5lZGl0VHlwZSA9PT0gJ2RpYWxvZycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLnNob3dEaWFsb2coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZHIgJiYgIXRoaXMuZGcubm93cmFwKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kci51cGRhdGVSb3dIZWlnaHQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5lZGl0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy52YWxpZE1lc3NhZ2VFbGUgPSB0aGlzLnNob3dWYWxpZE1lc3NhZ2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlVmFsaWRNZXNzYWdlKCkge1xyXG4gICAgICAgIC8vIOenu+mZpOmqjOivgeS/oeaBr1xyXG4gICAgICAgIGlmICh0aGlzLnZhbGlkTWVzc2FnZUVsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZhbGlkTWVzc2FnZUVsZS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy52YWxpZE1lc3NhZ2VFbGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5mb3JtVmFsaWRhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRnLmZvcm1WYWxpZGF0aW9uc1t0aGlzLmNvbHVtbi5maWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2hvd1ZhbGlkTWVzc2FnZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5kZy5mb3JtVmFsaWRhdGlvbnMgJiYgdGhpcy5kZy5mb3JtVmFsaWRhdGlvbnNbdGhpcy5jb2x1bW4uZmllbGRdKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpc1ZhbGlkLCBtZXNzYWdlfSA9IHRoaXMuZGcuZm9ybVZhbGlkYXRpb25zW3RoaXMuY29sdW1uLmZpZWxkXTtcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkICYmIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gdGhpcy5lZGl0b3IuZWwubmF0aXZlRWxlbWVudC5jbG9zZXN0KCd0cicpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGQgPSB0aGlzLmVkaXRvci5lbC5uYXRpdmVFbGVtZW50LmNsb3Nlc3QoJ3RkJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRDb250YWludmVyID0gdGhpcy5lZGl0b3IuZWwubmF0aXZlRWxlbWVudC5jbG9zZXN0KCcuZi1kYXRhZ3JpZC10YWJsZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbXNnV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgICAgICAgICAgICAgIGJveC5hcHBlbmRDaGlsZChtc2dXcmFwKTtcclxuICAgICAgICAgICAgICAgIG1zZ1dyYXAuaW5uZXJUZXh0ID0gbWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgICAgICAgICAgYm94LnN0eWxlLmJhY2tncm91bmQgPSAnI0ZERUZFRic7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUuY29sb3IgPSAnI0Y0NjE2MCc7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHRvcCA9IHRyLm9mZnNldFRvcCAtIDIxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyLmdldEF0dHJpYnV0ZSgnaW5kZXgnKSA9PSAnMCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3AgPSB0ci5vZmZzZXRIZWlnaHQ7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGJveC5zdHlsZS50b3AgPSBgJHt0b3B9cHhgO1xyXG4gICAgICAgICAgICAgICAgYm94LnN0eWxlLmxlZnQgPSBgJHt0ZC5vZmZzZXRMZWZ0ICsgNX1weGA7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUuekluZGV4ID0gJzk5Nic7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUucGFkZGluZyA9ICcwLjE4NzVyZW0gMC41cmVtJztcclxuICAgICAgICAgICAgICAgIGJveC5zdHlsZS5mb250U2l6ZSA9ICcuODEyNXJlbSc7XHJcbiAgICAgICAgICAgICAgICBib3guc3R5bGUubGluZUhlaWdodCA9ICcxNHB4JztcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBkb2N1bWVudC5ib2R5LmFwcGVuZChib3gpO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50Q29udGFpbnZlci5hcHBlbmQoYm94KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYm94O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2VFZGl0aW5nQ2VsbCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGcuaXNDZWxsRWRpdGluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjdXJyZW50Q2VsbCA9IG51bGw7XHJcbiAgICAgICAgbGV0IGVkaXRvcjogYW55ID0gbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCkge1xyXG5cclxuICAgICAgICAgICAgY3VycmVudENlbGwgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxSZWYgYXMgRGF0YWdyaWRDZWxsQ29tcG9uZW50O1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudENlbGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudENlbGwuaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2VsbC5jZWxsRWRpdG9yICYmIGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmICYmICFjdXJyZW50Q2VsbC5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBlZGl0b3IgPSBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmiafooYxibHVyIOS6i+S7tlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmlucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9tTmFtZSA9IGVkaXRvci5pbnB1dEVsZW1lbnQubm9kZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibHVyRm4gPSAgZWRpdG9yLm9wdGlvbnMgJiYgZWRpdG9yLm9wdGlvbnMub25CbHVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsdXJGbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZG9tTmFtZSA9PT0gJ0lOUFVUJyB8fCBkb21OYW1lID09PSAnVEVYVEFSRUEnKSAmJiAgdGhpcy5kZ1snZm9jdXNFbGVtZW50J10gPT09IGVkaXRvci5pbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmx1ckZuKHsgZWRpdG9yUmVmOiBlZGl0b3IsIHJvd0RhdGE6IGN1cnJlbnRDZWxsLnJvd0RhdGF9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmlucHV0RWxlbWVudC5ibHVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmlucHV0RWxlbWVudC5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ1snZm9jdXNFbGVtZW50J10gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmJsdXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5ibHVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3IucGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRvci5mb3JtQ29udHJvbC5wZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdG9yLmZvcm1Db250cm9sICYmIGVkaXRvci5mb3JtQ29udHJvbC5pbnZhbGlkICYmICF0aGlzLmRnLmVuZEVkaXRCeUludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZGcuaXNTaW5nbGVDbGljayA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IF9jb2xfID0gKGVkaXRvciB8fCBjdXJyZW50Q2VsbCkuY29sdW1uO1xyXG4gICAgICAgIGNvbnN0IGFmdGVyRWRpdEV2ZW50ID0gdGhpcy5kZy5hZnRlckVkaXQoY3VycmVudENlbGwucm93SW5kZXgsIGN1cnJlbnRDZWxsLnJvd0RhdGEsIF9jb2xfLCBlZGl0b3IpO1xyXG4gICAgICAgIGlmICghYWZ0ZXJFZGl0RXZlbnQgfHwgIWFmdGVyRWRpdEV2ZW50LnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRnLndyaXRlQ29uc29sZSgncGxlYXNlIHJldHVybiBhbiBPYnNlcnZhYmxlIFR5cGUuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih1bmRlZmluZWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gbGV0IGNlbGxFbmRFZGl0ID0gb2YodW5kZWZpbmVkKTtcclxuICAgICAgICBsZXQgY2VsbEVuZEVkaXQgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgICAgICBhZnRlckVkaXRFdmVudC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKChmbGFnOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmbGFnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHZhbCA9IGN1cnJlbnRDZWxsLnZhbHVlID09PSB1bmRlZmluZWQgPyAnJyA6IGN1cnJlbnRDZWxsLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDZWxsICYmIGN1cnJlbnRDZWxsLmZvcm1Db250cm9sICYmIGN1cnJlbnRDZWxsLmZvcm1Db250cm9sLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsICE9PSBjdXJyZW50Q2VsbC5mb3JtQ29udHJvbC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbCA9IGN1cnJlbnRDZWxsLmZvcm1Db250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLmlzRWRpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDZWxsLnVwZGF0ZVZhbHVlKHZhbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMuZW5kRWRpdENlbGwoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uRW5kQ2VsbEVkaXQodGhpcy5kZnMuZ2V0Q3VycmVudENlbGwoKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuQmluZEVkaXRvcklucHV0RXZlbnQoKTtcclxuICAgICAgICAgICAgICAgIC8vIOenu+mZpOe8lui+keagt+W8j1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCBDRUxMX0VESVRJTkdfQ0xTKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZWRpdG9ycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5kZy5zZWxlY3RlZFJvdy5kYXRhID0gdGhpcy5yb3dEYXRhO1xyXG4gICAgICAgICAgICAgICAgLy8g5pu05paw6KGM5qC35byP5oiW6ICF5Y2V5YWD5qC85qC35byPXHJcbiAgICAgICAgICAgICAgICBjb25zdCBfcmlkID0gdGhpcy5kZnMucHJpbWFyeUlkKGN1cnJlbnRDZWxsLnJvd0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMucm93VXBkYXRlJC5uZXh0KHsgaW5kZXg6IGN1cnJlbnRDZWxsLnJvd0luZGV4LCBkYXRhOiBjdXJyZW50Q2VsbC5yb3dEYXRhLCBjZWxsUmVmOiBjdXJyZW50Q2VsbCwga2V5SUQ6IF9yaWQgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0Zvb3Rlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsGZvb3RlckRhdGFcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5yZWZyZXNoRm9vdGVyRGF0YS5lbWl0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5Yi35paw6KGM5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmRyLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGVkUm93ICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuZHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93LmRyLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpc1snRU5ERURJVF9USU1FUiddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXNbJ0VOREVESVRfVElNRVInXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgeyByb3dJbmRleCwgcm93RGF0YSB9ID0gY3VycmVudENlbGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpc1snRU5ERURJVF9USU1FUiddID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0LmVtaXQoeyByb3dJbmRleCwgcm93RGF0YSwgY29sdW1uOiBfY29sXywgdmFsdWU6IHZhbH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNlbGxFbmRFZGl0ID0gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbEVuZEVkaXQubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudENlbGwgJiYgY3VycmVudENlbGwuY2VsbEVkaXRvciAmJiBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZiAmJiBjdXJyZW50Q2VsbC5jZWxsRWRpdG9yLmNvbXBvbmVudFJlZi5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvciA9IGN1cnJlbnRDZWxsLmNlbGxFZGl0b3IuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5pbnB1dEVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjZWxsRW5kRWRpdCA9IG9mKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsRW5kRWRpdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2VsbEVuZEVkaXQgPSBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsRW5kRWRpdC5uZXh0KHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNlbGxFbmRFZGl0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbENlbGxFZGl0aW5nKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnLmN1cnJlbnRDZWxsICYmIHRoaXMuZGcuY3VycmVudENlbGwuaXNFZGl0aW5nICYmIHRoaXMuZGcuc2VsZWN0ZWRSb3cuaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmRmcy5yZXNldFJvdyh0aGlzLmRnLnNlbGVjdGVkUm93LmlkKTtcclxuICAgICAgICAgICAgdGhpcy5kYy5yb3dEYXRhID0gdGhpcy5kZy5zZWxlY3RlZFJvdy5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1Db250cm9sLnJlc2V0KFV0aWxzLmdldFZhbHVlKHRoaXMuY29sdW1uLmZpZWxkLCB0aGlzLmRjLnJvd0RhdGEpKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBiaW5kRWRpdG9ySW5wdXRFdmVudCgpIHtcclxuICAgICAgICBjb25zdCBjZVJlZiA9IHRoaXMuY2VsbEVkaXRvclJlZiB8fCB0aGlzLmRjLmNlbGxFZGl0b3I7XHJcbiAgICAgICAgbGV0IGlucHV0ID0gbnVsbDtcclxuICAgICAgICBpZiAoY2VSZWYpIHtcclxuICAgICAgICAgICAgaW5wdXQgPSBjZVJlZi5jb21wb25lbnRSZWYuaW5zdGFuY2UuaW5wdXRFbGVtZW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3JUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQgPSB0aGlzLmRjLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQsdGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0T25FZGl0aW5nICYmIHRoaXMuY29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuc2VsZWN0KSB7IGlucHV0LnNlbGVjdCgpOyB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCA9IHRoaXMucmVuZGVyLmxpc3RlbihpbnB1dCwgJ2tleWRvd24nLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbktleURvd25Gb3JJbnB1dChlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVuQmluZEVkaXRvcklucHV0RXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZWRpdG9ySW5wdXRLZXlkb3duRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5lZGl0b3JJbnB1dEtleWRvd25FdmVudCgpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcklucHV0S2V5ZG93bkV2ZW50ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcHJpdmF0ZSBpc0xhc3RDZWxsKCkge1xyXG4gICAgLy8gICAgIGxldCBpID0gdGhpcy5kZy5mbGF0Q29sdW1ucy5sZW5ndGg7XHJcbiAgICAvLyAgICAgd2hpbGUoaSA8PSApIHtcclxuICAgIC8vICAgICAgICAgaWYgKHRoaXMuZGcuZmxhdENvbHVtbnNbaV0pXHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG5cclxuICAgIGZpbmRMYXN0RWRpdENlbGwoKSB7XHJcbiAgICAgICAgbGV0IGkgPSB0aGlzLmRnLmNvbEdyb3VwLmNvbHVtbnMubGVuZ3RoIC0gMTtcclxuICAgICAgICBsZXQgX2NvbCA9IG51bGw7XHJcbiAgICAgICAgd2hpbGUoaSA+PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbCA9IHRoaXMuZGcuY29sR3JvdXAuY29sdW1uc1tpXTtcclxuICAgICAgICAgICAgaWYgKGNvbC5lZGl0b3IgfHwgY29sLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICBfY29sID0gY29sO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBfY29sO1xyXG4gICAgfVxyXG5cclxuICAgIG9uS2V5RG93bkZvcklucHV0KGU6IEtleWJvYXJkRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBrZXlDb2RlID0gZS5rZXlDb2RlO1xyXG4gICAgICAgIGlmIChlLmFsdEtleSB8fCBlLmN0cmxLZXkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLnN0b3BQcm9wYWdhdGlvbikgfHwga2V5Q29kZSA9PT0gMTMgfHwgdGhpcy5jb2x1bW4uZWRpdG9yVGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHN3aXRjaCAoa2V5Q29kZSkge1xyXG4gICAgICAgICAgICBjYXNlIDMyOiAgLy8gU1BBQ0VcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3N3aXRjaCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuaW5zdGFuY2UudXBkYXRlQ2hlY2tlZChlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxMzogIC8vIEVudGVyXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTAwKVxyXG4gICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoZiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5kZ0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RFZGl0Q2VsbCA9IHRoaXMuZmluZExhc3RFZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50ZXJQYXJhbSA9IHsgZ2lyZDogdGhpcy5kZywgY2VsbDogdGhpcy5kZy5jdXJyZW50Q2VsbCwgZXZlbnQ6IGUsIGxhc3RDZWxsOiBsYXN0RWRpdENlbGwuZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5vbkVudGVySGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2x1bW4ub25FbnRlckhhbmRsZXIoZW50ZXJQYXJhbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0VGQgPSB0aGlzLmRnLmZpbmROZXh0Q2VsbCh0aGlzLmNvbHVtbi5maWVsZCwgJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbC5sYXN0Um93ICYmICghbmV4dFRkIHx8IGxhc3RFZGl0Q2VsbC5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5sYXN0Q2VsbEVudGVySGFuZGxlci5lbWl0KGVudGVyUGFyYW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAyNzogLy8gRVNDXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbENlbGxFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA5OiAvLyBUYWJcclxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmNsaWNrRGVsYXkgPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUHJldkNlbGxBbmRFZGl0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZU5leHRDZWxsQW5kRWRpdChlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDQwOiAvLyDihpNcclxuICAgICAgICAgICAgICAgIC8qKiDpgInkuK3kuIvkuIDooYzvvIzkuJTlvZPliY3liJfov5vlhaXnvJbovpHmgIE7IOS7heaZrumAmuaWh+acrOi+k+WFpeahhuaUr+aMgSAqL1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29sdW1uLmVkaXRvci50eXBlID09PSAndGV4dGJveCcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKS5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKGYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3ROZXh0Um93QW5kRWRpdENlbGwodGhpcy5jb2x1bW4uZmllbGQsICdkb3duJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAzODogLy8g4oaRXHJcbiAgICAgICAgICAgICAgICAvKiog6YCJ5Lit5LiK5LiA6KGM77yM5LiU5b2T5YmN5YiX6L+b5YWl57yW6L6R5oCBOyDku4Xmma7pgJrmlofmnKzovpPlhaXmoYbmlK/mjIEgKi9cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbHVtbi5lZGl0b3IudHlwZSA9PT0gJ3RleHRib3gnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZShmID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0TmV4dFJvd0FuZEVkaXRDZWxsKHRoaXMuY29sdW1uLmZpZWxkLCAndXAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNlbGVjdENlbGwoZmllbGQ6IHN0cmluZywgdGRFbGVtZW50PzogYW55KSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkuc3Vic2NyaWJlKHQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0ZEVsZW1lbnQgPSB0ZEVsZW1lbnQgfHwgdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbFNlbGVjdGVkQ2xhc3MoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZCAhPT0gdGhpcy5kZy5Db250cm9sUGFuZWxGZWlsZCAmJiBmaWVsZC5pbmRleE9mKCdmYXJyaXMtZGF0YWdyaWQtY29sdW1uJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0ZEVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gdGhpcy5kci5kckhvdmVyLnNldFJvd0hvdmVyQ2xzKGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5kZnMuc2V0Q3VycmVudENlbGwodGhpcy5kciwgZmllbGQsIHRkRWxlbWVudCwgdGhpcy5kYyk7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5mYXN0ICYmIHRoaXMuY29sdW1uLmZpeGVkICE9PSAnbGVmdCcgJiYgdGhpcy5jb2x1bW4uZml4ZWQgIT09ICdyaWdodCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubW92ZVNjcm9sbGJhcih0ZEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlU2Nyb2xsYmFyKHRkOiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0ZFBvc0xlZnQgPSB0ZC5vZmZzZXRMZWZ0ICsgdGQub2Zmc2V0V2lkdGg7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyV2lkdGggPSB0aGlzLmRnLndpZHRoIC0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLmxlZnRGaXhlZFdpZHRoIC0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuICAgICAgICBjb25zdCB0ZFJlY3QgPSB0ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBjb25zdCBzY3JvbGxDb250YWluZXIgPSB0aGlzLmRnYi5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcHNDb250YWluZXIgPSBzY3JvbGxDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsVG9wID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcDtcclxuICAgICAgICBjb25zdCBzY3JvbGxMZWZ0ID0gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbExlZnQ7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsYmFyWExlZnQgPSB0aGlzLmRnYi5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgICBpZiAodGRQb3NMZWZ0ID4gY29udGFpbmVyV2lkdGgpIHtcclxuICAgICAgICAgICAgY29uc3QgeCA9IHRkUG9zTGVmdCAtIGNvbnRhaW5lcldpZHRoICsgMjtcclxuICAgICAgICAgICAgLy8gY29uc3QgeCA9IHRkUG9zTGVmdCAtIHRoaXMuZGdiLnBzLmluc3RhbmNlLnNjcm9sbGJhclhXaWR0aCArIDI7XHJcbiAgICAgICAgICAgIGlmICh4ID4gc2Nyb2xsYmFyWExlZnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWCh4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGlmICh0ZFJlY3QueCA8IHBzQ29udGFpbmVyLngpIHtcclxuICAgICAgICAgICAgLy8gICAgIGNvbnN0IHggPSBzY3JvbGxMZWZ0IC0gdGRSZWN0Lng7XHJcbiAgICAgICAgICAgIC8vICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1goeCk7XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgaWYgKHRkLm9mZnNldExlZnQgPCBzY3JvbGxMZWZ0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnYi5wcy5zY3JvbGxUb1godGQub2Zmc2V0TGVmdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRkUG9zVG9wID0gdGRSZWN0LnRvcCAtIHBzQ29udGFpbmVyLnRvcCArIHRkUmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgaWYgKHRkUG9zVG9wID4gcHNDb250YWluZXIuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSB0ZFBvc1RvcCAtIHBzQ29udGFpbmVyLmhlaWdodDtcclxuICAgICAgICAgICAgdGhpcy5kZ2IucHMuc2Nyb2xsVG9ZKHNjcm9sbFRvcCArIHkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0ZFJlY3QueSA8IHBzQ29udGFpbmVyLnkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdiLnBzLnNjcm9sbFRvWShzY3JvbGxUb3AgLSAocHNDb250YWluZXIueSAtIHRkUmVjdC55KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlTmV4dENlbGxBbmRFZGl0KGV2ZW50PzogYW55KSB7XHJcbiAgICAgICAgLy8gaWYgKCF0aGlzLmNsb3NlRWRpdGluZ0NlbGwoKSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGNvbnN0IGZpZWxkSW5kZXggPSB0aGlzLmRmcy5nZXRDb2x1bW5JbmRleCh0aGlzLmNvbHVtbi5maWVsZCk7XHJcbiAgICAgICAgY29uc3QgZmllbGRJbmRleCA9IHRoaXMuZGcuY29sR3JvdXAuY29sdW1ucy5maW5kSW5kZXgobiA9PiAobi5pZCAmJiBuLmlkID09PSB0aGlzLmNvbHVtbi5pZCkgfHwgbi5maWVsZCA9PT0gdGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIGlmIChmaWVsZEluZGV4ICsgMSA8IHRoaXMuZGdiLmNvbHVtbnNHcm91cC5jb2x1bW5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0Q29sdW1uID0gdGhpcy5kZ2IuY29sdW1uc0dyb3VwLmNvbHVtbnNbZmllbGRJbmRleCArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0VGQ6IGFueSA9IHRoaXMuZGcuZmluZE5leHRUZChuZXh0Q29sdW1uKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChuZXh0VGQgJiYgKCFuZXh0Q29sdW1uLmZpeGVkIHx8IG5leHRDb2x1bW4uZml4ZWQgPT09ICdjZW50ZXInKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlU2Nyb2xsYmFyKG5leHRUZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICBpZiAobmV4dENvbHVtbiAmJiAoKCFuZXh0Q29sdW1uLmVkaXRvciAmJiAhbmV4dENvbHVtbi5lZGl0b3JUZW1wbGF0ZSkgfHwgdGhpcy5pc1JlYWRvbmx5KG5leHRDb2x1bW4pKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRUZC5zZWxlY3RDZWxsKGV2ZW50LCBuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobmV4dFRkKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0VGQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uLmVkaXRvciB8fCBuZXh0Q29sdW1uLmVkaXRvclRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25DZWxsRWRpdChuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gbmV4dCByb3cncyBmaXJzdCBjZWxsIHRvIGVkaXRpbmdcclxuICAgICAgICAgICAgY29uc3QgbmV4dFRyID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudC5wYXJlbnRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRUciAmJiBuZXh0VHIudGFnTmFtZSA9PT0gJ1RSJykge1xyXG4gICAgICAgICAgICAgICAgLy8gbmV4dFRyLmNoaWxkcmVuLmZpbmQodGQgPT4gdGQuZWRpdENlbGwpLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgZmlyc3RFZGl0b3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlICghZmlyc3RFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaXJzdEVkaXRvciA9ICEhbmV4dFRyLmNoaWxkcmVuW2ldLmVkaXRDZWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZmlyc3RFZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuY2xlYXJDaGVja2VkcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV4dFRyLmNoaWxkcmVuW2ldLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlUHJldkNlbGxBbmRFZGl0KCkge1xyXG4gICAgICAgIC8vIGlmICghdGhpcy5jbG9zZUVkaXRpbmdDZWxsKCkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBjb25zdCBmaWVsZEluZGV4ID0gdGhpcy5kZnMuZ2V0Q29sdW1uSW5kZXgodGhpcy5jb2x1bW4uZmllbGQpO1xyXG4gICAgICAgIGlmIChmaWVsZEluZGV4IC0gMSA+PSAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRDb2x1bW4gPSB0aGlzLmRnYi5jb2x1bW5zR3JvdXAubm9ybWFsQ29sdW1uc1tmaWVsZEluZGV4IC0gMV07XHJcbiAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uICYmIHRoaXMuaXNSZWFkb25seShuZXh0Q29sdW1uKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRUZCA9IHRoaXMuZGcuY3VycmVudENlbGwuY2VsbEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgaWYgKG5leHRUZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zZWxlY3RDZWxsKG5leHRDb2x1bW4uZmllbGQsIG5leHRUZCk7XHJcbiAgICAgICAgICAgICAgICBuZXh0VGQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0Q29sdW1uLmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZGZzLmVkaXRDZWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFRkLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25DZWxsRWRpdChuZXh0VGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2VsZWN0TmV4dFJvd0FuZEVkaXRDZWxsKGNlbGxGaWVsZE5hbWU6IHN0cmluZywgZGlyOiAnZG93bicgfCAndXAnKSB7XHJcblxyXG4gICAgICAgIGlmKCF0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcud3JpdGVDb25zb2xlKCflvZPliY3pgInkuK3ljZXlhYPmoLzkuLrnqbonKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcCA9IGRpciA9PT0gJ2Rvd24nID8gJ25leHRFbGVtZW50U2libGluZyc6ICdwcmV2aW91c0VsZW1lbnRTaWJsaW5nJztcclxuICAgICAgICBjb25zdCBuZXh0VHIgPSB0aGlzLmRnLmN1cnJlbnRDZWxsLmNlbGxFbGVtZW50LnBhcmVudEVsZW1lbnRbcF07XHJcbiAgICAgICAgaWYgKG5leHRUciAmJiBuZXh0VHIudGFnTmFtZSA9PT0gJ1RSJykge1xyXG4gICAgICAgICAgICBjb25zdCB0ZDogYW55ID0gQXJyYXkuZnJvbShuZXh0VHIuY2hpbGRyZW4pLmZpbmQoKHRkOiBhbnkpID0+IHRkLmdldEF0dHJpYnV0ZSgnZmllbGQnKSA9PSBjZWxsRmllbGROYW1lKTtcclxuICAgICAgICAgICAgaWYgKHRkICYmIHRkLmVkaXRDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zZWxlY3Rpb25Nb2RlID09PSAnZGVmYXVsdCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jbGVhckNoZWNrZWRzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0ZC5lZGl0Q2VsbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJDZWxsU2VsZWN0ZWRDbGFzcygpIHtcclxuICAgICAgICB0aGlzLmRnLnJlbW92ZUNlbGxTZWxlY3RlZENscygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Q2VsbENsc1dpdGhFZGl0b3JUeXBlKCkge1xyXG5cclxuICAgICAgICAvLyDorr7nva7lvZPliY3pgInkuK3ljZXlhYPmoLzmoLflvI9cclxuICAgICAgICBpZiAodGhpcy5kZy5jdXJyZW50Q2VsbCAmJiB0aGlzLmRnLmVuYWJsZUhpZ2hsaWdodENlbGwpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuY3VycmVudENlbGwuZmllbGQgPT09IHRoaXMuY29sdW1uLmZpZWxkICYmIHRoaXMuZGcuY3VycmVudENlbGwucm93SWQgPT09IHRoaXMucm93RGF0YVt0aGlzLmRnLmlkRmllbGRdICYmICF0aGlzLmRjLmlzRWRpdGluZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckNlbGxTZWxlY3RlZENsYXNzKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIENFTExfU0VMRUNURURfQ0xTKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5lbmFibGVFZGl0Q2VsbFN0eWxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRkID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuY2xlYW5PdGhlckVkaXRvckljb24odGQpO1xyXG4gICAgICAgIC8vIOW9k+WJjeihjOemgeeUqO+8jOS4jeWFgeiuuOe8lui+keOAglxyXG4gICAgICAgIGlmICh0aGlzLmRyLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jb2x1bW4uZWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlzUmVhZG9ubHkoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBlZGl0b3JUeXBlID0gdGhpcy5jb2x1bW4uZWRpdG9yLnR5cGU7XHJcbiAgICAgICAgY29uc3QgY2xzID0gdGhpcy5jb2x1bW4uYWxpZ24gPT09ICdyaWdodCcgPyAnYWxsb3ctZWRpdC1jZWxsLWxlZnQnIDogJ2FsbG93LWVkaXQtY2VsbCc7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGQsIGNscyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGQsIEFMTE9XX0VESVRfQ0VMTF9ISUdITElHSFRfQ0xTW2VkaXRvclR5cGVdKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsZWFuT3RoZXJFZGl0b3JJY29uKHRkKSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyhBTExPV19FRElUX0NFTExfSElHSExJR0hUX0NMUyk7XHJcbiAgICAgICAgdmFsdWVzLmZvckVhY2godiA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0ZC5jbGFzc05hbWUuaW5kZXhPZih2KSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0ZC5jbGFzc05hbWUgPSB0ZC5jbGFzc05hbWUucmVwbGFjZSgnYWxsb3ctZWRpdC1jZWxsLWxlZnQnLCAnJykucmVwbGFjZSgnYWxsb3ctZWRpdC1jZWxsJywgJycpO1xyXG4gICAgICAgICAgICAgICAgdGQuY2xhc3NOYW1lID0gdGQuY2xhc3NOYW1lLnJlcGxhY2UodiwgJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
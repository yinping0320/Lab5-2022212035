/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { switchMap, delay, debounceTime, takeUntil } from 'rxjs/operators';
import { of, Subject } from 'rxjs';
import ResizeObserver from 'resize-observer-polyfill';
/*
 * @Author: 疯狂秀才(Lucas Huang)
 * @Date: 2019-08-12 07:47:12
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-26 10:21:25
 * @QQ: 1055818239
 * @Version: v0.0.1
 */
import { Component, Input, ViewChild, Renderer2, ElementRef, ChangeDetectorRef, ChangeDetectionStrategy, NgZone, Injector, Optional, ApplicationRef, Output, EventEmitter } from '@angular/core';
import { DatagridFacadeService } from '../../services/datagrid-facade.service';
import { ScrollbarDirective } from '../../scrollbar/scrollbar.directive';
import { GROUP_ROW_FIELD, IS_GROUP_FOOTER_ROW_FIELD, GROUP_VISIBLE_FIELD } from '../../services/state';
import { SCROLL_X_ACTION, SCROLL_Y_ACTION, SCROLL_X_REACH_START_ACTION, TR_PREFIX, WORDWRAP_ROW_HEIGHT_CLS } from '../../types/constant';
import { DatagridService } from '../../services/datagrid.service';
import { DatagridComponent } from '../../datagrid.component';
import { FormatCellDataPipe } from '../../utils/format-cell-data.pipe';
import { ColumnFormatService } from '@farris/ui-common/column';
import { Utils } from '../../utils/utils';
export class DatagridBodyComponent {
    /**
     * @param {?} injector
     * @param {?} app
     * @param {?} dg
     * @param {?} cd
     * @param {?} el
     */
    constructor(injector, app, dg, cd, el) {
        this.injector = injector;
        this.app = app;
        this.dg = dg;
        this.cd = cd;
        this.el = el;
        // 自动高度时，禁用纵向滚动条
        this.psConfig = { swipeEasing: false, minScrollbarLength: 15, handlers: ['click-rail', 'drag-thumb', 'wheel', 'touch'], suppressScrollY: this.dg.autoHeight && this.dg.maxHeight ? false : this.dg.autoHeight };
        this.scrollTop = 0;
        this.scrollLeft = 0;
        this.deltaTopHeight = 0;
        // wheelHeight = 0;
        this.wheelWidth = 0;
        this._fixedRightScrollLeft = 0;
        this.maxScrollLeft = 0;
        this.showRightShadow = false;
        this.footerHeight = 0;
        // 虚拟加载
        this.topHideHeight = 0;
        this.bottomHideHeight = 0;
        this.startRowIndex = 0;
        this.dataChange = new EventEmitter();
        this.scrollBarMode = 'auto';
        this.checkedRows = [];
        /**
         * 性能优化版，默认为 false
         */
        this.fast = false;
        this.visibleContextMenus = [];
        this.currentRowId = undefined;
        this._hoverRowIndex = -1;
        this.subscriptions = [];
        this.minRowBuffer = 3;
        this.vScrollDir = 1;
        this.rowsCache = {};
        this.lastRenderedScrollTop = 0;
        this.lastRenderedScrollLeft = 0;
        this.prevScrollTop = 0;
        this.prevScrollLeft = 0;
        this.rows = [];
        this.blankTopHeight = 0;
        this.blankBottomHeight = 0;
        this.cellContentFormatter = null;
        // 当启用多选且允许多选中，列表不能编辑时，取选中后禁止触发body 的click 事件
        this.__triggerBodyClickEvent = true;
        this.destroy$ = new Subject();
        this._onMouseClick = null;
        this._scrollTimer = 0;
        this._scrollXTimer = 0;
        this.ro = null;
        this.resizeObserverTimer = 0;
        this._clickCellWeakMap = new WeakMap();
        this.onBeforeShowContextMenu = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            // row_1_fixedleft  row_1  row_1_fixedright
            const { contextMenuDom, event } = e;
            if (event.target.closest('.datagrid-editor')) {
                return of({ show: false });
            }
            /** @type {?} */
            let rowID = event.target.id;
            if (contextMenuDom) {
                // 排除分组行、分组合计行
                if (contextMenuDom.className.indexOf('f-datagrid-group-row') === -1 && contextMenuDom.className.indexOf('f-datagrid-group-footer') === -1) {
                    rowID = Utils.getRowIdByTr(contextMenuDom);
                    /** @type {?} */
                    const rowData = this.dfs.findRow(rowID);
                    /** @type {?} */
                    const focusTargetWidth = this.viewportW > this.totalWidth ? this.totalWidth : this.viewportW;
                    /** @type {?} */
                    const td = event.target.closest('td');
                    /** @type {?} */
                    let colInfo = null;
                    if (td) {
                        /** @type {?} */
                        const fieldName = td.getAttribute('field');
                        colInfo = fieldName ? this.dfs.getColumn(fieldName) : null;
                    }
                    /** @type {?} */
                    let beforeShowContextMenus$ = of(true);
                    if (this.dg.beforeShowContextMenus) {
                        /** @type {?} */
                        const showContextMenu = this.dg.beforeShowContextMenus({ rowid: rowID, data: rowData.data, grid: this.dg, column: colInfo });
                        if (typeof showContextMenu === 'boolean') {
                            beforeShowContextMenus$ = of(showContextMenu);
                        }
                        else {
                            if (showContextMenu['subscribe']) {
                                beforeShowContextMenus$ = showContextMenu;
                            }
                        }
                    }
                    return beforeShowContextMenus$.pipe(switchMap((/**
                     * @param {?} e
                     * @return {?}
                     */
                    (e) => {
                        /** @type {?} */
                        const params = { rowid: rowID, data: rowData.data, grid: this.dg, column: colInfo };
                        if (typeof e === 'object') {
                            const { show: isShow, customData } = e;
                            return of({ show: isShow, data: Object.assign(params, { customData: customData ? customData : null }), focusTargetWidth });
                        }
                        else {
                            return of({ show: e, data: params, focusTargetWidth });
                        }
                    })));
                }
            }
            return of({ show: false });
        });
        this.dfs = this.injector.get(DatagridFacadeService);
        this.dgs = this.injector.get(DatagridService);
        this.ngZone = this.injector.get(NgZone);
        this.render = this.injector.get(Renderer2);
        /** @type {?} */
        const columnFormatService = this.injector.get(ColumnFormatService);
        this.cellContentFormatter = new FormatCellDataPipe(columnFormatService, this.injector);
    }
    /**
     * @return {?}
     */
    get fixedRightScrollLeft() {
        return this._fixedRightScrollLeft;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set fixedRightScrollLeft(val) {
        this._fixedRightScrollLeft = val;
    }
    /**
     * @return {?}
     */
    get hoverRowIndex() {
        return this._hoverRowIndex;
    }
    /**
     * @param {?} rowIdx
     * @return {?}
     */
    set hoverRowIndex(rowIdx) {
        this._hoverRowIndex = rowIdx;
        this.cd.detectChanges();
    }
    /**
     * @return {?}
     */
    get selectedRows() {
        return this.dg.selections;
    }
    //////////////////////////////////////////////////////////////////////////
    /**
     * @return {?}
     */
    get scrollbarXHeight() {
        if (this.dg && this.ps && this.ps.instance) {
            /** @type {?} */
            const h = this.dg.scrollBarShowMode === 'allways' && this.ps.instance['scrollbarXActive'] ? 22 : 0;
            if (this.ps.instance['scrollbarYActive'] && h) {
                return h + 18; // + (this.dg.showScrollArrow && this.ps.instance['scrollbarYActive'] ? 18 : 0);
            }
        }
    }
    /**
     * @return {?}
     */
    get scrollbarYWidth() {
        if (this.dg && this.ps && this.ps.instance) {
            return this.dg.scrollBarShowMode === 'allways' && this.ps.instance['scrollbarYActive'] && this.showRightShadow ? 18 : 0;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.listenSubjects();
        this.dg.scrollInstance = this.ps;
        /** @type {?} */
        const s1 = this.dgs.showGridHeader.subscribe((/**
         * @param {?} headerHeight
         * @return {?}
         */
        headerHeight => {
            this.updateContainerSize(headerHeight);
        }));
        this.subscriptions.push(s1);
        /** @type {?} */
        const s10 = this.dgs.footerPositionChanged.subscribe((/**
         * @return {?}
         */
        () => {
            this.updateContainerSize();
        }));
        this.subscriptions.push(s10);
        /** @type {?} */
        const s2 = this.dgs.rowHeightChanged.subscribe((/**
         * @return {?}
         */
        () => {
            this.cd.detectChanges();
        }));
        this.subscriptions.push(s2);
        /** @type {?} */
        const s3 = this.dfs.clientSort$.subscribe((/**
         * @return {?}
         */
        () => {
            this.checkScrollbarPosition(true);
            this.cd.detectChanges();
            // this.dg.columnSorted.emit();
        }));
        this.subscriptions.push(s3);
        /** @type {?} */
        const s5 = this.dg.dgs.columnsChanged.pipe(delay(50)).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e && e.scrollToLeft) {
                this.ps.elementRef.nativeElement.scrollTo(0, 0);
                this.ps.scrollToLeft(0, 100);
            }
        }));
        this.subscriptions.push(s5);
        this.viewScrollContainer.nativeElement.addEventListener('click', this._onMouseClick = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            this.onMouseClick(e);
        }));
        if (!this.dg.nowrap) {
            this.dgs.dataloaded.subscribe((/**
             * @return {?}
             */
            () => {
                this.updateRowHeight();
            }));
        }
    }
    /**
     * @private
     * @param {?=} headerHeight
     * @return {?}
     */
    updateContainerSize(headerHeight) {
        /** @type {?} */
        const hh = headerHeight || this.dg.realHeaderHeight;
        this.setPositionTop(hh);
        this.height = this.dg.height - this.top;
        this.bodyStyle = this.getBodyStyle();
        this.cd.detectChanges();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.data && !changes.data.isFirstChange()) {
            this.bodyStyle = this.getBodyStyle();
            this.dfs.setCurrentPageData(changes.data.currentValue);
            /** @type {?} */
            const isDiffrentDataSource = !!changes.data.currentValue.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => !n['__group__'])).map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.id)).filter((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                return !changes.data.previousValue.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => !n['__group__'])).find((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => p.id === n));
            })).length;
            /** @type {?} */
            const isSameLength = changes.data.currentValue.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => !n['__group__'])).length >= changes.data.previousValue.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => !n['__group__'])).length;
            this.onDataChanged(isSameLength, isDiffrentDataSource);
            if (!changes.data.currentValue || !changes.data.currentValue.length) {
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.setPositionTop(this.dg.realHeaderHeight);
                }));
            }
        }
        if (changes.footerHeight !== undefined && !changes.footerHeight.isFirstChange()) {
            this.bodyStyle = this.getBodyStyle();
        }
        if (changes.scrollBarMode !== undefined && !changes.scrollBarMode.isFirstChange()) {
            if (this.ps && this.ps.instance && this.scrollBarMode === 'allways' && this.ps.instance.scrollbarYActive) {
                this.rightFixedWidth += this.showRightShadow ? 18 : 0;
            }
            else {
                this.rightFixedWidth = this.columnsGroup.rightFixedWidth;
            }
            if (this.dg.scrollBarShowMode === 'allways' && this.ps && this.ps.instance && this.ps.instance.scrollbarXActive) {
                this.blankBottomHeight += 22;
            }
        }
        if (changes.showScrollArrow && !changes.showScrollArrow.isFirstChange()) {
            this.ps && this.ps.update();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
        this.cellContentFormatter = null;
        this.dg.scrollInstance = null;
        this.destroySubscriptions();
        this.viewScrollContainer.nativeElement.removeEventListener('click', this._onMouseClick);
        if (this.ro) {
            this.ro.unobserve(this.viewScrollContainer.nativeElement);
            this.ro.disconnect();
        }
        if (this.resizeObserverTimer) {
            clearTimeout(this.resizeObserverTimer);
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.ro = new ResizeObserver((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (this.viewScrollContainer.nativeElement.offsetParent) {
                if (this.resizeObserverTimer) {
                    clearTimeout(this.resizeObserverTimer);
                }
                this.resizeObserverTimer = setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.updateCanvasHeight();
                    if (this.scrollBarMode === 'allways') {
                        this.ps.update();
                    }
                    // this.setFixedRightWidth();
                    this.cd.detectChanges();
                    this.dgs.scrollbarUpdate.emit({ scrollbarRef: this.ps.instance, rightWidth: this.rightFixedWidth, showRightShadow: this.showRightShadow });
                }), 100);
            }
        }));
        this.ro.observe(this.viewScrollContainer.nativeElement);
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
    }
    /**
     * @private
     * @param {?} headerHeight
     * @return {?}
     */
    setPositionTop(headerHeight) {
        this.top = headerHeight;
        if ((this.dg.enableFilterRow || this.dg.enableSmartFilter) && this.dg.showFilterBar) {
            this.top += this.dg.filterBarHeight;
        }
        if (this.dg.showRowGroupPanel) {
            this.top += this.dg.rowGroupPanelHeight;
        }
        if (this.dg.showFooter && (this.dg.footerPosition === 'top' || this.dg.footerPosition === 'both')) {
            // headerHeight 已包括过滤行的高度 tfs 542471
            if (this.data && this.data.length) {
                this.top += this.dg.footerHeight;
            }
        }
    }
    /**
     * @private
     * @param {?=} toTop
     * @return {?}
     */
    checkScrollbarPosition(toTop = false) {
        if (!this.dg.data || !this.dg.data.length) {
            return;
        }
        /** @type {?} */
        const scrollBar = this.ps.instance;
        /** @type {?} */
        const scrollElRef = this.ps.elementRef.nativeElement;
        // scrollBar.update();
        /** @type {?} */
        const lastScrollLeft = scrollBar ? scrollBar.lastScrollLeft : 0;
        /** @type {?} */
        const lastScrollTop = scrollBar ? scrollBar.lastScrollTop : 0;
        // const lastScrollLeft = this.scrollLeft;
        // const lastScrollTop = this.scrollTop;
        /** @type {?} */
        const scrollTop = scrollElRef.scrollTop;
        /** @type {?} */
        const scrollLeft = scrollElRef.scrollLeft;
        if (!toTop) {
            if (scrollTop != lastScrollTop) {
                this.ps.scrollToTop(lastScrollTop);
                this.dgs.onScrollMove(lastScrollTop, SCROLL_Y_ACTION);
            }
        }
        else {
            this.ps.scrollToTop();
            this.dgs.onScrollMove(lastScrollTop, SCROLL_Y_ACTION);
        }
        this.scrollLeft = lastScrollLeft;
        if (scrollLeft != lastScrollLeft) {
            this.ps.scrollToX(lastScrollLeft);
            this.dgs.onScrollMove(lastScrollLeft, SCROLL_X_ACTION);
        }
        else {
            if (lastScrollLeft) {
                this.dgs.onScrollMove(lastScrollLeft, SCROLL_X_ACTION);
            }
        }
    }
    /**
     * 数据发生变化，重新加载数据时执行
     * 重置滚动条位置
     * @private
     * @param {?=} isSameLength
     * @param {?=} isDiffrentDataSource
     * @return {?}
     */
    onDataChanged(isSameLength = true, isDiffrentDataSource = false) {
        this.dg.setPagerHeight();
        this.viewportH = this.getViewPortHeight();
        this.bodyStyle = this.getBodyStyle();
        /**
         * update:
         * node_modules\perfect-scrollbar\types\perfect-scrollbar.d.ts
         * lastScrollTop: number
         */
        if (this.ps && this.ps.instance && !this.dg.isEditing() && !this.dg.clientFilterChanged && !this.dg.autoHeight) {
            this.scrollTop = 0;
            this.lastRenderedScrollTop = 0;
            this.ps.scrollToTop();
            this.scrollLeft = 0;
            this.ps.scrollToLeft();
        }
        this.rowsCache = {};
        /** @type {?} */
        const keepscrollPos = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const scrollInfo = this.dg.dfs.getState().scrollInfo;
            if (scrollInfo) {
                if (scrollInfo.y) {
                    this.scrollTop = scrollInfo.y;
                    this.dg.scrollInstance.scrollToY(scrollInfo.y);
                    this.dgs.onScrollMove(scrollInfo.y, SCROLL_Y_ACTION);
                }
                if (scrollInfo.x) {
                    this.scrollLeft = scrollInfo.x;
                    this.dg.scrollInstance.scrollToX(scrollInfo.x);
                    this.dg.dgs.onScrollMove(scrollInfo.x, SCROLL_X_ACTION);
                }
            }
        });
        if (!this.dg.nowrap || this.dg.autoHeight) {
            this.renderData(false);
            this.dgs.cellContentWrapChanged.next(this.width);
        }
        else {
            if (isSameLength) {
                keepscrollPos();
            }
            this.renderData(false);
            this.ps.update();
        }
        if (isDiffrentDataSource) {
            this.dg.initSelectOrChecked();
        }
        else {
            this.dg.refreshSelectedData();
        }
        this.dg.clientFilterChanged = false;
        this.dataChange.emit(this.data);
        if (this.dg.scrollBarShowMode === 'allways' && this.ps.instance && !this.dg.showScrollArrow) {
            this.hasYScrollbar();
        }
    }
    /**
     * @private
     * @return {?}
     */
    destroySubscriptions() {
        if (this.subscriptions && this.subscriptions.length) {
            this.subscriptions.forEach((/**
             * @param {?} sub
             * @return {?}
             */
            (sub) => {
                if (sub) {
                    sub.unsubscribe();
                    sub = null;
                }
            }));
            this.subscriptions = [];
        }
    }
    /**
     * @private
     * @return {?}
     */
    listenSubjects() {
        this.destroySubscriptions();
        this.gridSizeSubscribe = this.dfs.gridSize$.pipe(takeUntil(this.destroy$)).pipe(debounceTime(50)).subscribe((/**
         * @param {?} state
         * @return {?}
         */
        state => {
            if (state) {
                this.dg.setPagerHeight();
                /** @type {?} */
                const hh = this.dg.setHeaderHeight();
                this.setPositionTop(hh);
                this.height = state.height - this.top;
                /** @type {?} */
                const oldWidth = this.width;
                this.width = Math.floor(state.width);
                this.rowHeight = state.rowHeight;
                if (this.dg.showBorder) {
                    this.width -= 2;
                }
                this.viewportW = this.width;
                this.viewportH = this.getViewPortHeight();
                this.canvasHeight = this.getCanvasHeight();
                this.ngZone.runOutsideAngular((/**
                 * @return {?}
                 */
                () => {
                    this.columnsGroup = state.columnsGroup;
                    this.checkScrollbarPosition();
                    // this.setFixedRightPosition();
                    this.updateColumnSize(state.columnsGroup);
                    this.dgs.showFixedShadow.emit({ showRightShadow: this.showRightShadow, x: this.fixedRightScrollLeft });
                    this.renderData(false);
                    if ((!this.dg.nowrap || this.dg.autoHeight) && this.rows && this.rows.length) {
                        if (oldWidth !== this.width) {
                            this.dgs.cellContentWrapChanged.next(oldWidth);
                        }
                        else {
                            this.keepScrollbarPosition(oldWidth);
                        }
                    }
                    else {
                        if (this._scrollXTimer) {
                            clearTimeout(this._scrollXTimer);
                        }
                        this._scrollXTimer = setTimeout((/**
                         * @return {?}
                         */
                        () => {
                            this.keepScrollbarPosition(oldWidth);
                        }), 100);
                    }
                }));
            }
        }));
        this.subscriptions.push(this.gridSizeSubscribe);
        this.columnResizeSubscribe = this.dfs.columnResize$.subscribe((/**
         * @param {?} cg
         * @return {?}
         */
        (cg) => {
            this.updateColumnSize(cg);
            this.cd.detectChanges();
        }));
        this.subscriptions.push(this.columnResizeSubscribe);
        this.dgs.setSelecedRow.subscribe((/**
         * @param {?} r
         * @return {?}
         */
        (r) => {
            if (r && r.selected) {
                this.currentRowId = r.id;
            }
            else {
                this.currentRowId = undefined;
            }
        }));
        this.selectRowSubscribe = this.dfs.selectRow$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            if (row) {
                this.currentRowId = row.id;
                // 20210817 方向键移动后刷新视图状态
                this.cd.detectChanges();
            }
        }));
        this.subscriptions.push(this.selectRowSubscribe);
        this.unselectRowSubscribe = this.dfs.unSelectRow$.subscribe((/**
         * @param {?} prevRow
         * @return {?}
         */
        (prevRow) => {
            if (prevRow && prevRow.id === this.currentRowId) {
                this.currentRowId = undefined;
                this.dg.selectedRow = null;
            }
            if (!this.dg.editable && this.dg.multiSelect) {
                this.__triggerBodyClickEvent = this.dg.selectionMode === 'default';
            }
            this.cd.detectChanges();
        }));
        this.subscriptions.push(this.unselectRowSubscribe);
        this.selectAllSubscribe = this.dfs.selectAll$.subscribe((/**
         * @param {?} rows
         * @return {?}
         */
        (rows) => {
            this.dg.selectAll.emit(rows);
            this.cd.detectChanges();
        }));
        this.subscriptions.push(this.selectAllSubscribe);
        this.checkRowSubscribe = this.dfs.checkRow$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            this.dg.checked.emit(row);
            this.checkedRowsChanged();
            // this.cd.detectChanges();
        }));
        this.subscriptions.push(this.checkRowSubscribe);
        this.clearSelectionsSubscribe = this.dfs.clearSelections$.subscribe((/**
         * @return {?}
         */
        () => {
            this.currentRowId = undefined;
            if (this.dg.checkOnSelect) {
                this.checkedRowsChanged();
            }
            this.dg.unSelectAll.emit();
        }));
        this.subscriptions.push(this.clearSelectionsSubscribe);
        this.uncheckRowSubscribe = this.dfs.unCheckRow$.subscribe((/**
         * @param {?} prevRow
         * @return {?}
         */
        (prevRow) => {
            this.dg.unChecked.emit(prevRow);
            this.checkedRowsChanged();
            // this.cd.detectChanges();
        }));
        this.subscriptions.push(this.uncheckRowSubscribe);
        this.checkAllSubscribe = this.dfs.checkAll$.subscribe((/**
         * @param {?} rows
         * @return {?}
         */
        (rows) => {
            this.dg.checkAll.emit(rows);
            this.checkedRowsChanged();
            // this.cd.detectChanges();
        }));
        this.subscriptions.push(this.checkAllSubscribe);
        this.clearCheckedsSubscribe = this.dfs.clearCheckeds$.subscribe((/**
         * @param {?} rows
         * @return {?}
         */
        (rows) => {
            if (this.dg.selectOnCheck) {
                this.currentRowId = undefined;
            }
            this.dg.unCheckAll.emit(rows);
            this.checkedRowsChanged();
            this.cd.detectChanges();
        }));
        this.subscriptions.push(this.clearCheckedsSubscribe);
        this.subscriptions.push(this.dgs.setScrollbarPosition.subscribe((/**
         * @return {?}
         */
        () => {
            this.checkScrollbarPosition();
            this.updateScrollPosition(this.scrollLeft);
        })));
        this.dgs.columnResized.pipe(delay(100)).subscribe((/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (!this.dg.nowrap ||
                (this.dg.currentCell && this.dg.currentCell.isEditing && this.dg.currentCell.column &&
                    this.dg.currentCell.column.editor && this.dg.currentCell.column.editor.type === 'textarea')) {
                /** @type {?} */
                const trdoms = this.dg.dgContainer.nativeElement.querySelectorAll('.f-datagrid-body-row:not(.f-datagrid-footer-row)');
                trdoms.forEach((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => {
                    this.render.setStyle(n, 'height', 'auto');
                }));
                /** @type {?} */
                let trID = '';
                if (e) {
                    /** @type {?} */
                    const rowId = e.id;
                    trID = TR_PREFIX + rowId;
                }
                this.updateRowHeight(trID);
            }
            if (this.dg.headerWrap) {
                this.dg.setHeaderHeight();
                this.dfs.columnResizeEnd();
            }
        }));
        this.dgs.cellContentWrapChanged.pipe(takeUntil(this.destroy$), debounceTime(100)).subscribe((/**
         * @param {?} oldWidth
         * @return {?}
         */
        (oldWidth) => {
            this.updateRowHeight();
            if (oldWidth != null) {
                this.keepScrollbarPosition(oldWidth);
            }
            else {
                this.ps && this.ps.instance && this.ps.instance.update();
            }
        }));
        this.dg.dfs.rowUpdate$.subscribe((/**
         * @param {?} row
         * @return {?}
         */
        (row) => {
            if (row && row.data) {
                this.buildCustomCellStyle(row);
            }
        }));
        if (this.dg.groupRows) {
            this.dfs.expandGroupRow.pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (e && e.data) {
                    this.groupRowStateChanged(e.data, true);
                    setTimeout((/**
                     * @return {?}
                     */
                    () => { this.updateRowHeight(); }));
                }
            }));
            this.dfs.collapseGroupRow.pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (e && e.data) {
                    this.groupRowStateChanged(e.data, false);
                }
            }));
        }
    }
    /**
     * @private
     * @param {?} groupRow
     * @param {?} isExpand
     * @return {?}
     */
    groupRowExpandUpdate(groupRow, isExpand) {
        if (groupRow.rows && groupRow.rows.length) {
            groupRow.rows.forEach((/**
             * @param {?} n
             * @return {?}
             */
            n => {
                if (n[IS_GROUP_FOOTER_ROW_FIELD]) {
                    this.data.filter((/**
                     * @param {?} t
                     * @return {?}
                     */
                    t => t[GROUP_ROW_FIELD] === n[GROUP_ROW_FIELD])).forEach((/**
                     * @param {?} d
                     * @return {?}
                     */
                    d => {
                        d[GROUP_VISIBLE_FIELD] = isExpand && groupRow.expanded;
                    }));
                }
                else {
                    /** @type {?} */
                    const item = this.data.find((/**
                     * @param {?} e
                     * @return {?}
                     */
                    e => e.id === n.id));
                    if (item) {
                        item[GROUP_VISIBLE_FIELD] = isExpand && groupRow.expanded;
                        if (item.rows && item.rows.length) {
                            this.groupRowExpandUpdate(item, isExpand);
                        }
                    }
                }
            }));
        }
    }
    /**
     * @private
     * @param {?} rowData
     * @param {?} expand
     * @return {?}
     */
    groupRowStateChanged(rowData, expand) {
        if (this.dg.virtualized) {
            /** @type {?} */
            const gr = this.data.find((/**
             * @param {?} n
             * @return {?}
             */
            n => n.id === rowData.id));
            this.groupRowExpandUpdate(gr, expand);
            this.renderData(false);
        }
        else {
            this.getCanvasHeight();
        }
        if (this['_psUpdateTimer_']) {
            clearTimeout(this['_psUpdateTimer_']);
        }
        this['_psUpdateTimer_'] = setTimeout((/**
         * @return {?}
         */
        () => {
            this.ps.update();
            this.cd.detectChanges();
        }), 100);
    }
    /**
     * @private
     * @param {?} oldWidth
     * @return {?}
     */
    keepScrollbarPosition(oldWidth) {
        if (!this.cd["destroyed"]) {
            this.cd.detectChanges();
        }
        if (!this.ps.instance) {
            return;
        }
        if (this["keepScrollbarPositionTIMER"]) {
            clearTimeout(this["keepScrollbarPositionTIMER"]);
        }
        this["keepScrollbarPositionTIMER"] = setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.width > oldWidth) {
                /** @type {?} */
                const x = this.scrollLeft - (this.width - oldWidth);
                this.ps.elementRef.nativeElement.scrollLeft = x < 0 ? 0 : x;
            }
            if (!this.dg.nowrap || this.dg.autoHeight) {
                this.updateCanvasHeight();
            }
            this.ps.update();
            this.updateScrollPosition(this.ps.elementRef.nativeElement.scrollLeft);
            this.dgs.scrollbarUpdate.emit({ scrollbarRef: this.ps.instance, rightWidth: this.rightFixedWidth, showRightShadow: this.showRightShadow });
        }), 50);
    }
    /**
     * @private
     * @param {?} cg
     * @return {?}
     */
    updateColumnSize(cg) {
        if (cg) {
            this.columnsGroup = cg;
            this.leftFixedWidth = this.columnsGroup.leftFixedWidth;
            this.colsWidth = this.columnsGroup.normalWidth;
            this.scrollLeft = this.ps.elementRef.nativeElement.scrollLeft;
            this.maxScrollLeft = this.colsWidth + this.leftFixedWidth;
            this.fixedRightScrollLeft = this.maxScrollLeft;
            // grid 容器宽度
            /** @type {?} */
            const dgContainerWidth = this.dg.dgContainer.nativeElement.offsetWidth;
            // 所有列宽之和
            /** @type {?} */
            const allColsWidth = Math.floor(this.columnsGroup.totalWidth);
            this.bodyStyle = this.getBodyStyle();
            if (dgContainerWidth > allColsWidth || dgContainerWidth === allColsWidth) {
                this.showRightShadow = false;
            }
            else {
                this.showRightShadow = true;
                // 右侧固定列的位置
                this.fixedRightScrollLeft = this.width + this.scrollLeft;
            }
            this.setFixedRightWidth();
        }
    }
    /**
     * @private
     * @return {?}
     */
    setFixedRightWidth() {
        this.rightFixedWidth = this.columnsGroup.rightFixedWidth;
        this.totalWidth = this.columnsGroup.totalWidth;
        if (this.ps && this.ps.instance && this.dg.scrollBarShowMode === 'allways') {
            if (this.ps.instance.scrollbarYActive) {
                this.rightFixedWidth += 18;
            }
        }
    }
    /**
     * @private
     * @param {?} row
     * @return {?}
     */
    buildCustomCellStyle(row) {
        /** @type {?} */
        let rightTrs = [];
        /** @type {?} */
        let leftTrs = [];
        if (this.fixedRightEl) {
            rightTrs = this.fixedRightEl.nativeElement.querySelectorAll('tr');
        }
        if (this.fixedLeftEl) {
            leftTrs = this.fixedLeftEl.nativeElement.querySelectorAll('.fixed-left-row');
        }
        /** @type {?} */
        const trs = this.mainArea.nativeElement.querySelectorAll('tr.f-datagrid-body-row');
        /** @type {?} */
        const updateCellStyle = (/**
         * @param {?} arr
         * @param {?} col
         * @param {?} style
         * @return {?}
         */
        (arr, col, style) => {
            if (arr.length) {
                /** @type {?} */
                const td = arr[row.index].querySelector(`[field="${col.field}"]`);
                if (td) {
                    this.dg.renderCustomStyle(style, td);
                }
            }
        });
        this.dg.flatColumns.forEach((/**
         * @param {?} col
         * @return {?}
         */
        col => {
            if (col.styler) {
                /** @type {?} */
                const _rd = row.data;
                /** @type {?} */
                const val = Utils.getValue(col.field, _rd);
                /** @type {?} */
                const cs = col.styler(val, _rd, row.index);
                if (cs && Object.keys(cs).length) {
                    updateCellStyle(leftTrs, col, cs);
                    updateCellStyle(rightTrs, col, cs);
                    updateCellStyle(trs, col, cs);
                }
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    checkedRowsChanged() {
        this.dgs.onCheckedRowsCountChange();
        /** @type {?} */
        const checkedRows = this.dg.checkeds;
        this.dg.checkValues = checkedRows.map((/**
         * @param {?} r
         * @return {?}
         */
        r => r.id));
        this.dg.checkValuesChange.emit(this.dg.checkValues);
        this.dg.checkedChange.emit(checkedRows);
    }
    /**
     * @private
     * @return {?}
     */
    getTrDomHeight() {
        /** @type {?} */
        const list = [];
        /** @type {?} */
        let rightTrs = [];
        /** @type {?} */
        let leftTrs = [];
        /** @type {?} */
        let trdoms = [];
        if (this.fixedRightEl) {
            rightTrs = this.fixedRightEl.nativeElement.querySelectorAll('tr');
        }
        if (this.fixedLeftEl) {
            leftTrs = this.fixedLeftEl.nativeElement.querySelectorAll('.fixed-left-row');
        }
        if (this.mainArea) {
            trdoms = this.mainArea.nativeElement.querySelectorAll('tr.f-datagrid-body-row');
        }
        trdoms.forEach((/**
         * @param {?} tr
         * @param {?} i
         * @return {?}
         */
        (tr, i) => {
            /** @type {?} */
            let t1 = 0;
            /** @type {?} */
            const t2 = Math.ceil(tr.offsetHeight);
            /** @type {?} */
            let t3 = 0;
            if (leftTrs && leftTrs.length) {
                t1 = Math.ceil(leftTrs[i].offsetHeight);
            }
            if (rightTrs && rightTrs.length) {
                t3 = Math.ceil(rightTrs[i].offsetHeight);
            }
            /** @type {?} */
            const _h = Math.max(t1, t2, t3, this.dg.rowHeight);
            list.push(_h);
        }));
        return list;
    }
    /**
     * @return {?}
     */
    updateRowHeight2() {
        /** @type {?} */
        let rightTrs = [];
        /** @type {?} */
        let leftTrs = [];
        /** @type {?} */
        let trdoms = [];
        if (this.fixedRightEl) {
            rightTrs = this.fixedRightEl.nativeElement.querySelectorAll('tr');
        }
        if (this.fixedLeftEl) {
            leftTrs = this.fixedLeftEl.nativeElement.querySelectorAll('.fixed-left-row');
        }
        if (this.mainArea) {
            trdoms = this.mainArea.nativeElement.querySelectorAll('tr.f-datagrid-body-row');
        }
        trdoms.forEach((/**
         * @param {?} tr
         * @param {?} i
         * @return {?}
         */
        (tr, i) => {
            this.removeRowHeightCls(tr);
            if (leftTrs && leftTrs[i]) {
                this.removeRowHeightCls(leftTrs[i]);
            }
            if (rightTrs && rightTrs[i]) {
                this.removeRowHeightCls(rightTrs[i]);
            }
        }));
        if (this['UPDATE_ROW_HEIGHT_TIMER']) {
            clearTimeout(this['UPDATE_ROW_HEIGHT_TIMER']);
        }
        this['UPDATE_ROW_HEIGHT_TIMER'] = setTimeout((/**
         * @return {?}
         */
        () => {
            trdoms.forEach((/**
             * @param {?} tr
             * @param {?} i
             * @return {?}
             */
            (tr, i) => {
                /** @type {?} */
                let t1 = 0;
                /** @type {?} */
                const t2 = Math.ceil(tr.offsetHeight);
                /** @type {?} */
                let t3 = 0;
                /** @type {?} */
                let leftTr = null;
                /** @type {?} */
                let rightTr = null;
                if (leftTrs && leftTrs.length) {
                    t1 = Math.ceil(leftTrs[i].offsetHeight);
                    leftTr = leftTrs[i];
                }
                if (rightTrs && rightTrs.length) {
                    t3 = Math.ceil(rightTrs[i].offsetHeight);
                    rightTr = rightTrs[i];
                }
                /** @type {?} */
                const _h = Math.max(t1, t2, t3, this.dg.rowHeight);
                if (!this.dg.nowrap || this.dg.autoHeight) {
                    /** @type {?} */
                    const heightClsName = WORDWRAP_ROW_HEIGHT_CLS + '_' + _h;
                    /** @type {?} */
                    const minRowHeightClsName = 'min_row_height_' + this.rowHeight;
                    /** @type {?} */
                    const _addRowHeightClsToDom = (/**
                     * @param {?} trdom
                     * @return {?}
                     */
                    (trdom) => {
                        this.removeRowHeightCls(trdom);
                        this.render.addClass(trdom, heightClsName);
                        this.render.addClass(trdom, minRowHeightClsName);
                    });
                    this.addRowHeightCls(heightClsName, _h);
                    _addRowHeightClsToDom(tr);
                    if (leftTr) {
                        _addRowHeightClsToDom(leftTr);
                    }
                    if (rightTr) {
                        _addRowHeightClsToDom(rightTr);
                    }
                }
            }));
        }), 100);
    }
    /**
     * @private
     * @param {?} tr
     * @return {?}
     */
    removeRowHeightCls(tr) {
        if (!tr) {
            return;
        }
        /** @type {?} */
        const _cls = Array.from(tr.classList).find((/**
         * @param {?} n
         * @return {?}
         */
        (n) => n.indexOf(WORDWRAP_ROW_HEIGHT_CLS) > -1));
        if (_cls) {
            tr.classList.remove(_cls);
        }
    }
    /**
     * @private
     * @param {?} heightClsName
     * @param {?} _h
     * @return {?}
     */
    addRowHeightCls(heightClsName, _h) {
        this.dgs.removeCssRule(`${this.dg.customStyleKey()} .${heightClsName}`);
        this.dg.renderCustomStyle2({ style: { height: _h + 'px!important' } }, null, heightClsName);
    }
    /**
     * 允许数据折行时，计算行号的行高
     * @param {?=} trDomId
     * @return {?}
     */
    updateRowHeight(trDomId = null) {
        if (this.fast) {
            return;
        }
        if (!this.mainArea) {
            return;
        }
        /** @type {?} */
        const dgBody = this.el.nativeElement.querySelector('div.f-datagrid-body');
        if (dgBody) {
            if (!this.dg.nowrap || this.dg.autoHeight) {
                this.render.addClass(dgBody, 'data-wrap');
            }
            else {
                this.render.removeClass(dgBody, 'data-wrap');
            }
        }
        if (!trDomId) {
            this.updateRowHeight2();
        }
        else {
            /** @type {?} */
            const tr = Utils.getTrDomById(trDomId, document);
            if (!tr) {
                return;
            }
            /** @type {?} */
            const leftTrId = trDomId + '_fixedleft';
            /** @type {?} */
            const rightTrId = trDomId + '_fixedright';
            /** @type {?} */
            const leftTr = Utils.getTrDomById(leftTrId, document);
            /** @type {?} */
            const rightTr = Utils.getTrDomById(rightTrId, document);
            this.removeRowHeightCls(tr);
            this.removeRowHeightCls(leftTr);
            this.removeRowHeightCls(rightTr);
            /** @type {?} */
            const _arr = [];
            if (this.fixedRightEl) {
                /** @type {?} */
                const rtr = Utils.getTrDomById(trDomId, this.fixedRightEl.nativeElement);
                if (rtr) {
                    _arr.push(Math.ceil(rtr.offsetHeight));
                }
            }
            if (this.fixedLeftEl) {
                /** @type {?} */
                const ltr = Utils.getTrDomById(trDomId, this.fixedLeftEl.nativeElement);
                if (ltr) {
                    _arr.push(Math.ceil(ltr.offsetHeight));
                }
            }
            if (this.mainArea) {
                /** @type {?} */
                const tr = Utils.getTrDomById(trDomId, this.mainArea.nativeElement);
                if (tr) {
                    _arr.push(Math.ceil(tr.offsetHeight));
                }
            }
            /** @type {?} */
            const _h = Math.max(..._arr);
            /** @type {?} */
            const heightClsName = WORDWRAP_ROW_HEIGHT_CLS + '_' + _h;
            if (!this.dg.nowrap || this.dg.autoHeight) {
                this.render.addClass(tr, heightClsName);
                this.addRowHeightCls(heightClsName, _h);
                if (leftTr) {
                    this.render.addClass(leftTr, heightClsName);
                }
                if (rightTr) {
                    this.render.addClass(rightTr, heightClsName);
                }
            }
        }
        this.updateCanvasHeight();
        // 移除height: auto
        /** @type {?} */
        const trdoms = this.dg.dgContainer.nativeElement.querySelectorAll('.f-datagrid-body-row:not(f-datagrid-footer-row)');
        trdoms.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => n.style.height = ''));
        if (!this.cd['destroyed']) {
            this.cd.detectChanges();
        }
    }
    /**
     * @private
     * @return {?}
     */
    getBodyStyle() {
        /** @type {?} */
        let h = this.getViewPortHeight();
        if (!this.data.length) {
            if (this.dg.useBlankWhenDataIsEmpty) {
                h = this.dg.emptyDataHeight;
            }
            else {
                if (this.dg.autoHeight) {
                    h = this.dg.emptyDataHeight;
                }
                if (this.dg.footerData && this.dg.showFooter) {
                    /** @type {?} */
                    let fd = this.dg.footerData;
                    if (this.dg.footerData.subscribe) {
                        fd = this.dg.footerData['value'];
                    }
                    if (fd && Array.isArray(fd) && fd.length) {
                        h = h - this.dg.footerHeight;
                        if (this.dg.footerPosition === 'both') {
                            h = h - this.dg.footerHeight;
                        }
                    }
                }
            }
        }
        else {
            if (this.dg.showFooter && this.dg.footerPosition === 'both') {
                h = h - this.dg.footerHeight;
            }
        }
        return {
            height: `${Math.floor(h) + 1}px`
        };
    }
    /**
     * @private
     * @param {?} scrollLeft
     * @return {?}
     */
    updateScrollPosition(scrollLeft) {
        this.scrollLeft = scrollLeft;
        this.fixedRightScrollLeft = this.scrollLeft + this.width - this.rightFixedWidth;
        if (this.fixedRightScrollLeft === this.maxScrollLeft || this.fixedRightScrollLeft > this.maxScrollLeft) {
            this.fixedRightScrollLeft = this.maxScrollLeft;
            this.showRightShadow = false;
        }
        else {
            this.showRightShadow = true;
        }
        if (this.fixedLeftEl) {
            this.render.setStyle(this.fixedLeftEl.nativeElement, 'transform', `translate3d(${this.scrollLeft}px, 0px, 0px)`);
        }
        if (this.fixedRightEl) {
            /** @type {?} */
            let l = this.dg.width - (this.dg.showBorder ? 2 : 0) - this.columnsGroup.rightFixedWidth;
            if (this.ps && this.ps.instance && this.ps.instance.scrollbarYActive && this.dg.scrollBarShowMode === 'allways') {
                l -= 18;
            }
            /** @type {?} */
            let realWidth = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth + this.columnsGroup.rightFixedWidth;
            if (this.dg.width - (this.dg.showBorder ? 2 : 0) > realWidth) {
                l = this.columnsGroup.leftFixedWidth + this.columnsGroup.normalWidth;
            }
            l += this.scrollLeft;
            this.fixedRightScrollLeft = l;
            this.render.setStyle(this.fixedRightEl.nativeElement, 'transform', `translate3d(${this.fixedRightScrollLeft}px, 0px, 0px)`);
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onScrollToX($event) {
        /** @type {?} */
        const x = $event.target.scrollLeft;
        this.updateScrollPosition(x);
        // this.cd.detectChanges();
        this.dgs.onScrollMove(x, SCROLL_X_ACTION);
        this.dfs.updateProperty('scrollInfo', { y: $event.target.scrollTop, x });
        this.dgs.showFixedShadow.emit({ showRightShadow: this.showRightShadow, x: this.fixedRightScrollLeft });
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onScrollToY($event) {
        if (this._scrollTimer) {
            clearTimeout(this._scrollTimer);
        }
        this._scrollTimer = setTimeout((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const y = $event.target.scrollTop;
            if (this.dg.virtualized) {
                this.handleScroll();
            }
            this.scrollTop = y;
            this.dfs.updateProperty('scrollInfo', { y, x: $event.target.scrollLeft });
            this.dg.scrollY.emit(y);
            this.dgs.onScrollMove(y, SCROLL_Y_ACTION);
        }), 100);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onPsXReachStart($event) {
        /** @type {?} */
        const x = $event.target.scrollLeft;
        this.updateScrollPosition(x);
        this.dgs.onScrollMove(x, SCROLL_X_REACH_START_ACTION);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onPsXReachEnd($event) {
        this.showRightShadow = false;
        // const x = $event.target.scrollLeft;
        // this.updateScrollPosition(x);
        // this.cd.detectChanges();
        // // this.dgs.onShowFixedShadow(this.showRightShadow);
        // this.dgs.onScrollMove(x, SCROLL_X_REACH_END_ACTION);
    }
    /**
     * @param {?} rowData
     * @return {?}
     */
    isChecked(rowData) {
        if (rowData) {
            return this.dfs.isRowChecked(rowData[this.dg.idField]);
        }
        else {
            return false;
        }
    }
    /**
     * @param {?} rowData
     * @return {?}
     */
    isSelected(rowData) {
        if (rowData) {
            return this.dfs.isRowSelected(rowData[this.dg.idField]);
        }
        return false;
    }
    /**
     * @param {?} row
     * @param {?=} open
     * @return {?}
     */
    toggleGroupRow(row, open = true) {
        row.expanded = open;
        this.ps.update();
    }
    /** =================================== 分 ====== 隔 ====== 线 =================================== */
    /**
     * 获取可视区域高度
     * @return {?}
     */
    getViewPortHeight() {
        /** @type {?} */
        let viewPortHeight = this.dg.height;
        if (this.dg.showHeader) {
            viewPortHeight = viewPortHeight - this.dg.realHeaderHeight;
        }
        if ((this.dg.enableFilterRow || this.dg.enableSmartFilter) && this.dg.showFilterBar) {
            viewPortHeight -= this.dg.filterBarHeight;
        }
        if (this.dg.showRowGroupPanel) {
            viewPortHeight -= this.dg.rowGroupPanelHeight;
        }
        if (this.dg.showFooter && this.data.length) {
            viewPortHeight = viewPortHeight - this.dg.footerHeight;
        }
        if (this.dg.pagination) {
            viewPortHeight = viewPortHeight - this.dg.pagerHeight - 2;
        }
        if (this.dg.showBorder) {
            viewPortHeight -= 2;
        }
        this.viewportH = viewPortHeight;
        return viewPortHeight;
    }
    // 不折行时，所有数据的高度
    /**
     * @private
     * @return {?}
     */
    allRowsHeight() {
        /** @type {?} */
        const rowHeightpatch = 1;
        // this.dg.autoHeight ? 2 : 1;
        /** @type {?} */
        const rowHeight = this.dg.rowHeight + rowHeightpatch;
        /** @type {?} */
        let itemsCount = 0;
        if (this.dg.groupRows) {
            /** @type {?} */
            const data = this.data.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n['__group_visible__'] || n['__group_visible__'] === undefined));
            if (this.dg.groupSummaryPosition === 'inGroupRow') {
                itemsCount = data.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => !n['__group_footer__'])).length;
            }
            else {
                itemsCount = data.length;
            }
        }
        else {
            itemsCount = this.data.length;
        }
        /** @type {?} */
        let h = itemsCount * rowHeight;
        if (this.dg.autoHeight) {
            h += itemsCount;
        }
        else {
            h += 2;
        }
        return h;
    }
    /**
     * @private
     * @return {?}
     */
    getCanvasHeight() {
        /** @type {?} */
        let canvasHeight = 0;
        if (!this.data || !this.data.length) {
            this.canvasHeight = 0;
            return 0;
        }
        if (this.dg.nowrap) {
            // tfs 572022
            if (this.dg.maxHeight && this.dg.autoHeight && this.mainArea) {
                canvasHeight = Math.floor(this.mainArea.nativeElement.getBoundingClientRect().height);
            }
            else {
                canvasHeight = this.allRowsHeight();
            }
        }
        else {
            canvasHeight = this.getTrDomHeight().reduce((/**
             * @param {?} r
             * @param {?} c
             * @return {?}
             */
            (r, c) => r + c), 0);
        }
        if (!canvasHeight) {
            canvasHeight = this.viewportH;
        }
        canvasHeight = canvasHeight + (this.dg.scrollBarShowMode === 'allways' && (this.ps.instance && this.ps.instance['scrollbarXActive']) ? 18 : 0);
        this.canvasHeight = canvasHeight;
        return canvasHeight;
    }
    /**
     * @return {?}
     */
    updateCanvasHeight() {
        this.canvasHeight = this.getCanvasHeight();
    }
    /**
     * @private
     * @param {?} y
     * @return {?}
     */
    getRowFromPosition(y) {
        return Math.floor(y / (this.dg.rowHeight + 1));
    }
    /**
     * @param {?=} viewportTop
     * @param {?=} viewportLeft
     * @return {?}
     */
    getVisibleRange(viewportTop, viewportLeft) {
        if (viewportTop == null) {
            viewportTop = this.scrollTop;
        }
        if (viewportLeft == null) {
            viewportLeft = this.scrollLeft;
        }
        return {
            top: this.getRowFromPosition(viewportTop),
            bottom: this.getRowFromPosition(viewportTop + this.viewportH) + 1,
            leftPx: viewportLeft,
            rightPx: viewportLeft + this.viewportW
        };
    }
    /**
     * @private
     * @param {?=} viewportTop
     * @param {?=} viewportLeft
     * @return {?}
     */
    getRenderedRange(viewportTop, viewportLeft) {
        /** @type {?} */
        const range = this.getVisibleRange(viewportTop, viewportLeft);
        /** @type {?} */
        const buffer = Math.round(this.viewportH / (this.dg.rowHeight + 1));
        /** @type {?} */
        const minBuffer = this.minRowBuffer;
        if (this.vScrollDir == -1) {
            range.top -= buffer;
            range.bottom += minBuffer;
        }
        else if (this.vScrollDir == 1) {
            range.top -= minBuffer;
            range.bottom += buffer;
        }
        else {
            range.top -= minBuffer;
            range.bottom += minBuffer;
        }
        range.top = Math.max(0, range.top);
        range.bottom = Math.min(this.data.length - 1, range.bottom);
        range.leftPx -= this.viewportW;
        range.rightPx += this.viewportW;
        range.leftPx = Math.max(0, range.leftPx);
        range.rightPx = Math.min(this.canvasWidth, range.rightPx);
        return range;
    }
    /**
     * @private
     * @param {?} range
     * @return {?}
     */
    renderRows(range) {
        /** @type {?} */
        const rows = [];
        /** @type {?} */
        let dataLength = this.data.length;
        /** @type {?} */
        let _data = this.data;
        // 启用分组
        if (this.dg.groupRows && this.dg.groupField) {
            _data = _data.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n['__group_visible__'] || n['__group_visible__'] === undefined));
            if (this.dg.groupSummaryPosition === 'inGroupRow') {
                _data = _data.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => !n['__group_footer__']));
            }
            dataLength = _data.length;
            this.rowsCache = {};
        }
        for (let i = range.top; i <= range.bottom; i++) {
            if (this.rowsCache[i] || (i == dataLength)) {
                continue;
            }
            rows.push(i);
            // Create an entry right away so that appendRowHtml() can
            // start populatating it.
            this.rowsCache[i] = {
                rowNode: null,
                // ColSpans of rendered cells (by column idx).
                // Can also be used for checking whether a cell has been rendered.
                cellColSpans: [],
                // Cell nodes (by column idx).  Lazy-populated by ensureCellNodesInRowsCache().
                cellNodesByColumnIdx: [],
                // Column indices of cell nodes that have been rendered, but not yet indexed in
                // cellNodesByColumnIdx.  These are in the same order as cell nodes added at the
                // end of the row.
                cellRenderQueue: []
            };
        }
        for (let i = 0, ii = rows.length; i < ii; i++) {
            this.rowsCache[rows[i]].rowNode = _data[rows[i]];
        }
        return Object.keys(this.rowsCache).map((/**
         * @param {?} n
         * @return {?}
         */
        n => this.rowsCache[n].rowNode)).filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n));
    }
    /**
     * @private
     * @param {?} row
     * @return {?}
     */
    removeRowFromCache(row) {
        /** @type {?} */
        const cacheEntry = this.rowsCache[row];
        if (!cacheEntry) {
            return;
        }
        delete this.rowsCache[row];
    }
    /**
     * @private
     * @param {?} rangeToKeep
     * @return {?}
     */
    cleanupRows(rangeToKeep) {
        for (const i in this.rowsCache) {
            if (i < rangeToKeep.top || i > rangeToKeep.bottom) {
                this.removeRowFromCache(i);
            }
        }
    }
    /**
     * @param {?=} showYscrollbar
     * @return {?}
     */
    hasYScrollbar(showYscrollbar) {
        setTimeout((/**
         * @return {?}
         */
        () => {
            showYscrollbar = showYscrollbar == undefined ? this.ps.instance.scrollbarYActive : showYscrollbar;
            /** @type {?} */
            const hasY = showYscrollbar && this.dg.scrollBarShowMode === 'allways' ? 18 : 0;
            this.dfs.updateProperty('scrollbarY', hasY);
            this.dfs.resize();
        }), 60);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onClickScrollArrow($event) {
        const { dir, event } = $event;
        if (this.ps && this.ps.instance) {
            const { x, y } = this.ps.instance.reach;
            switch (dir) {
                case 'left':
                    if (x !== 'start') {
                        this.viewScrollContainer.nativeElement.scrollLeft = this.viewScrollContainer.nativeElement.scrollLeft - 40;
                    }
                    break;
                case 'right':
                    if (x !== 'end') {
                        this.viewScrollContainer.nativeElement.scrollLeft = this.viewScrollContainer.nativeElement.scrollLeft + 40;
                    }
                    break;
                case 'top':
                    if (y !== 'start') {
                        this.viewScrollContainer.nativeElement.scrollTop = this.viewScrollContainer.nativeElement.scrollTop - 40;
                    }
                    break;
                case 'bottom':
                    if (y !== 'end') {
                        this.viewScrollContainer.nativeElement.scrollTop = this.viewScrollContainer.nativeElement.scrollTop + 40;
                    }
                    break;
            }
            this.ps.update();
        }
    }
    /**
     * @private
     * @param {?=} detectchanges
     * @return {?}
     */
    renderData(detectchanges = true) {
        this.canvasHeight = this.getCanvasHeight();
        if (!this.dg.virtualized || this.dg.autoHeight) {
            this.rows = this.data;
        }
        else {
            /** @type {?} */
            const visible = this.getVisibleRange();
            /** @type {?} */
            const rendered = this.getRenderedRange();
            // remove rows no longer in the viewport
            this.cleanupRows(rendered);
            // render missing rows
            this.rows = this.renderRows(rendered);
            this.startRowIndex = rendered.top;
            this.lastRenderedScrollTop = this.scrollTop;
            this.lastRenderedScrollLeft = this.scrollLeft;
            this.blankTopHeight = this.startRowIndex * (this.dg.rowHeight + 1);
            this.blankBottomHeight = this.canvasHeight - this.blankTopHeight - (this.rows.length * (this.dg.rowHeight + 1));
            if (this.dg.scrollBarShowMode === 'allways' && this.ps && this.ps.instance && this.ps.instance.scrollbarXActive) {
                this.blankBottomHeight += 22;
            }
            if (detectchanges) {
                this.cd.detectChanges();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    handleScroll() {
        this.scrollTop = this.ps.elementRef.nativeElement.scrollTop;
        this.scrollLeft = this.ps.elementRef.nativeElement.scrollLeft;
        return this._handleScroll();
    }
    /**
     * @private
     * @return {?}
     */
    _handleScroll() {
        /** @type {?} */
        const viewportContainer = this.viewScrollContainer.nativeElement;
        /** @type {?} */
        let maxScrollDistanceY = viewportContainer.scrollHeight - viewportContainer.clientHeight;
        /** @type {?} */
        let maxScrollDistanceX = viewportContainer.scrollWidth - viewportContainer.clientWidth;
        // Protect against erroneous clientHeight/Width greater than scrollHeight/Width.
        // Sometimes seen in Chrome.
        maxScrollDistanceY = Math.max(0, maxScrollDistanceY);
        maxScrollDistanceX = Math.max(0, maxScrollDistanceX);
        // Ceiling the max scroll values
        if (this.scrollTop > maxScrollDistanceY) {
            this.scrollTop = maxScrollDistanceY;
        }
        if (this.scrollLeft > maxScrollDistanceX) {
            this.scrollLeft = maxScrollDistanceX;
        }
        /** @type {?} */
        const vScrollDist = Math.abs(this.scrollTop - this.prevScrollTop);
        /** @type {?} */
        const hScrollDist = Math.abs(this.scrollLeft - this.prevScrollLeft);
        if (hScrollDist) {
            this.prevScrollLeft = this.scrollLeft;
            // $viewportScrollContainerX[0].scrollLeft = scrollLeft;
            // if (hasFrozenColumns()) {
            //     if (hasFrozenRows) {
            //         $viewportTopR[0].scrollLeft = scrollLeft;
            //     }
            // } else {
            //     if (hasFrozenRows) {
            //         $viewportTopL[0].scrollLeft = scrollLeft;
            //     }
            // }
        }
        /** @type {?} */
        const lastScrollTop = this.lastRenderedScrollTop;
        if (vScrollDist) {
            this.vScrollDir = this.prevScrollTop < this.scrollTop ? 1 : -1;
            this.prevScrollTop = this.scrollTop;
            // if (hasFrozenColumns()) {
            //     if (hasFrozenRows && !options.frozenBottom) {
            //         $viewportBottomL[0].scrollTop = scrollTop;
            //     } else {
            //         $viewportTopL[0].scrollTop = scrollTop;
            //     }
            // }
            // switch virtual pages if needed
            if (vScrollDist < this.viewportH) {
                this._scrollTo(this.scrollTop);
            }
        }
        if (hScrollDist || vScrollDist) {
            /** @type {?} */
            const dx = Math.abs(this.lastRenderedScrollLeft - this.scrollLeft);
            /** @type {?} */
            const dy = Math.abs(lastScrollTop - this.scrollTop);
            if (dx > 20 || dy > 20) {
                // if rendering is forced or scrolling is small enough to be "easy", just render
                if (dy < this.viewportH && dx < this.viewportW) {
                    this.renderData();
                }
                else {
                    this.renderData();
                }
            }
        }
        if (hScrollDist || vScrollDist) {
            return true;
        }
        return false;
    }
    /**
     * @private
     * @param {?} y
     * @return {?}
     */
    _scrollTo(y) {
        /** @type {?} */
        const $viewportScrollContainerY = this.viewScrollContainer.nativeElement;
        y = Math.max(y, 0);
        y = Math.min(y, this.canvasHeight - this.viewportH);
        /** @type {?} */
        const newScrollTop = y;
        if (this.prevScrollTop != newScrollTop) {
            this.vScrollDir = (this.prevScrollTop < newScrollTop) ? 1 : -1;
            this.lastRenderedScrollTop = (this.scrollTop = this.prevScrollTop = newScrollTop);
            // if (hasFrozenColumns()) {
            //     $viewportTopL[0].scrollTop = newScrollTop;
            // }
            // if (hasFrozenRows) {
            //     $viewportBottomL[0].scrollTop = $viewportBottomR[0].scrollTop = newScrollTop;
            // }
            // $viewportScrollContainerY.scrollTop = newScrollTop;
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseClick($event) {
        // document.body.click();
        /** @type {?} */
        const target = (/** @type {?} */ ($event.target));
        if (target.nodeName === 'TEXTAREA' || target.nodeName === 'INPUT') {
            return;
        }
        /** @type {?} */
        let td = target;
        if (target.nodeName !== 'TD') {
            td = target.closest('TD');
        }
        if (!td) {
            if (this.dg.isEditing() && (this.dg.exitRowEditingWhenBodyClick || this.dg.editMode == 'cell')) {
                this.dg.endEditing();
            }
            return;
        }
        /** @type {?} */
        let curT = new Date().getTime()
        //上一次时间戳
        ;
        //上一次时间戳
        /** @type {?} */
        let lastT = this['lastTapDiffTime'] || 0;
        //对上一次时间戳重新赋值
        this['lastTapDiffTime'] = curT;
        //做差
        /** @type {?} */
        let diff = curT - lastT;
        /** @type {?} */
        const isClickSameRow = (/**
         * @return {?}
         */
        () => {
            if (this._clickCellWeakMap.has(this.el.nativeElement) && td && td.parentElement === this._clickCellWeakMap.get(this.el.nativeElement)) {
                this._clickCellWeakMap.delete(this.el.nativeElement);
                return true;
            }
            return false;
        });
        /** @type {?} */
        const runTdClick = (/**
         * @return {?}
         */
        () => {
            if (td && td.selectCell) {
                td.selectCell($event, td);
            }
            else {
                this._selectRow(td, (/**
                 * @param {?} id
                 * @param {?} rowSelected
                 * @return {?}
                 */
                (id, rowSelected) => {
                    /** @type {?} */
                    let emit = !rowSelected;
                    if (this.dg.selectionMode === 'default') {
                        this.dg.clearCheckeds();
                        emit = true;
                    }
                    this.dg.selectRow(id, emit, false);
                    this.dg['updateAllCheckboxStatus']();
                }));
            }
        });
        /** @type {?} */
        const runSelectRow = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const dblclickTimer = this.dg.dblclickRow.observers.length ? 200 : 0;
            if (isClickSameRow()) {
                if (diff < dblclickTimer) {
                    this.dg.writeConsole('双击');
                    //清除上一次单击的定时器ID
                    clearTimeout(this['lastTapTimeFunc']);
                }
                else {
                    //定时器id
                    this['lastTapTimeFunc'] = setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        runTdClick();
                    }), dblclickTimer);
                }
            }
            else {
                this['lastTapTimeFunc'] = setTimeout((/**
                 * @return {?}
                 */
                () => {
                    runTdClick();
                }), dblclickTimer ? 180 : 0);
            }
            this._clickCellWeakMap.set(this.el.nativeElement, td.parentElement);
        });
        if (!this.dg.editable && td) {
            // 解决超链点击事件，要先执行选中行
            $event.stopPropagation();
            runSelectRow();
            return;
        }
        if (this.dg.editMode === 'row') {
            if (this.dg.exitRowEditingWhenBodyClick && this.dg.isEditing()) {
                this.dg.endEditing();
            }
            this._selectRow(td, (/**
             * @param {?} id
             * @param {?} rowSelected
             * @return {?}
             */
            (id, rowSelected) => {
                this.dg.selectRow(id, !rowSelected, false);
            }));
            return;
        }
        if (!td && this.dg.currentCell) {
            td = this.dg.currentCell.cellElement;
            if (td && td.closeEdit) {
                $event.stopPropagation();
                td.closeEdit();
                return;
            }
        }
        if (td) {
            // 行禁用时
            if (this.dg.disableRow) {
                /** @type {?} */
                let rowData = null;
                /** @type {?} */
                let rowIndex = -1;
                if (td.gridCellData) {
                    rowData = td.gridCellData.rowData;
                    rowIndex = td.gridCellData.rowIndex;
                }
                else {
                    /** @type {?} */
                    const rowInfo = this.dg.getRowIdByTr(td.parentElement);
                    if (rowInfo) {
                        rowData = rowInfo.data;
                        rowIndex = rowInfo.index;
                    }
                }
                if (rowData) {
                    if (this.dg.disableRow(rowData, rowIndex)) {
                        this.dg.endEditing();
                        return;
                    }
                }
                else {
                    this.dg.writeConsole('未获取到行数据。');
                    return;
                }
            }
            $event.stopPropagation();
            if (this.dg.editable && this.dg.editMode === 'cell') {
                if (td.edit) {
                    this._selectRow(td, (/**
                     * @return {?}
                     */
                    () => {
                        td.edit($event);
                    }));
                }
                else {
                    // 允许编辑点击行号时，可以选中行
                    if (td.selectCell || td.className.indexOf('f-datagrid-cell-rownumber') > -1) {
                        runSelectRow();
                    }
                    else {
                        // 当点分组行或合计行时，须结束编辑
                        this.dg.isEditing() && this.dg.endEditing();
                    }
                }
            }
            else {
                if (td.selectCell) {
                    runSelectRow();
                }
                else {
                    if (this.dg.isEditing() && (this.dg.exitRowEditingWhenBodyClick || this.dg.editMode === 'cell')) {
                        this.dg.endEditing();
                    }
                    // this._selectRow(td, (id, rowSelected) => {
                    //     this.dg.selectRow(id, !rowSelected, false);
                    // });
                    runTdClick();
                }
            }
        }
    }
    /**
     * @private
     * @param {?} tdEl
     * @param {?} callback
     * @return {?}
     */
    _selectRow(tdEl, callback) {
        if (tdEl) {
            /** @type {?} */
            const tr = tdEl.parentElement;
            /** @type {?} */
            const rowInfo = this.dg.getRowIdByTr(tr);
            if (!rowInfo) {
                return;
            }
            const { data, index, id } = rowInfo;
            /** @type {?} */
            const rowisSelected = this.dfs.isRowSelected(id);
            this.dg._beforeSelectRow$(index, data, id).pipe(takeUntil(this.destroy$)).subscribe((/**
             * @param {?} t
             * @return {?}
             */
            (t) => {
                if (t) {
                    callback(id, rowisSelected);
                }
            }));
        }
    }
}
DatagridBodyComponent.decorators = [
    { type: Component, args: [{
                selector: 'datagrid-body',
                template: "<!--\r\n * @Author: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:07\r\n * @LastEditors: \u75AF\u72C2\u79C0\u624D(Lucas Huang)\r\n * @LastEditTime: 2019-11-26 08:20:46\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n -->\r\n\r\n<ng-container  *ngIf=\"(!data || !data.length) && !dg.useBlankWhenDataIsEmpty\" >\r\n\r\n    <div *ngIf=\"!dg.emptyTemplate && !dg.emptyComponentType\" class=\"d-flex flex-column f-datagrid-norecords\"\r\n        style=\"position:absolute; margin:0;left: 0; z-index: 1;justify-content: center; align-items: center;pointer-events: none;\" \r\n        [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" >\r\n        <div class=\"f-datagrid-norecords-content\" style=\"margin: 0;width: 100%;position: relative; top: 0\">\r\n            {{ 'datagrid.emptyMessage' | locale }}\r\n        </div>\r\n    </div>\r\n    <div class=\"f-datagrid-body\" [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" style=\"z-index: 1;\"  *ngIf=\"dg.emptyTemplate && !dg.emptyComponentType\">\r\n        <ng-container #emptyTemplate [ngTemplateOutlet]=\"dg.emptyTemplate\" ></ng-container>\r\n    </div>\r\n    <div class=\"f-datagrid-body\" [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" style=\"z-index: 1;\"  *ngIf=\"dg.emptyComponentType\"\r\n    component-template [ctx]=\"{ instance: dg }\" [cmpRef]=\"dg.emptyComponentType\">\r\n    </div>\r\n   \r\n</ng-container>\r\n\r\n\r\n\r\n<div class=\"f-datagrid-body\" [ngStyle]=\"bodyStyle\" [style.top.px]=\"top\" [style.width.px]=\"viewportW\" \r\n[farris-context-menus]=\"contextMenuItems\" [disabled]=\"!dg.enableContextMenu\" [activeDomName]=\"'tr'\" [beforeShowContextMenu]=\"onBeforeShowContextMenu\"\r\n[menuClass]=\"'f-datagrid-context-menu'\">\r\n\r\n    <div #viewScrollContainer [scrollbar]=\"psConfig\" #ps=\"ngxScrollbar\"\r\n        class=\"ps f-datagrid-body-wheel-area\" \r\n        style=\"width: 100%;\"\r\n        [ngStyle]=\"bodyStyle\"\r\n        (psXReachEnd)=\"onPsXReachEnd($event)\"\r\n        (psScrollY)=\"onScrollToY($event)\"\r\n        (psScrollX)=\"onScrollToX($event)\" (psXReachStart)=\"onPsXReachStart($event)\"\r\n        [style.paddingRight.px]=\"scrollbarYWidth\">\r\n       \r\n        <div class=\"f-datagrid-norecords\"  [auto-height]=\"dg.autoHeight\" [wheelHeight]=\"dg.emptyDataHeight || 240\" style=\"height: 100%\" [style.width.px]=\"canvasWidth - 2\"  *ngIf=\"!data || !data.length\">\r\n            <!-- <div *ngIf=\"!dg.emptyTemplate\" class=\"f-datagrid-norecords-content\" style=\"width: 100%\" >{{ 'datagrid.emptyMessage' | locale }}</div>\r\n            <ng-container #emptyTemplate *ngIf=\"dg.emptyTemplate\" [ngTemplateOutlet]=\"dg.emptyTemplate\" ></ng-container> -->\r\n        </div>\r\n\r\n        <div [style.display]=\"dg.flatColumns?.length ? '': 'none'\"  *ngIf=\"data && data.length && !fast\"\r\n            class=\"f-datagrid-bg\" [auto-height]=\"dg.autoHeight\" [wheelHeight]=\"canvasHeight\"\r\n            [style.height.px]=\"canvasHeight\" [style.width.px]=\"totalWidth\" >\r\n            \r\n                <div #blankTop hidefocus style=\"width: 100%\" [style.height.px]=\"blankTopHeight\"></div>\r\n                \r\n                <div #fixedLeft class=\"f-datagrid-table f-datagrid-body-fixed-left\" style=\"z-index:999\" [class.f-datagrid-fixed-left-shadow]=\"!!scrollLeft && !dg.groupRows\"\r\n                    *ngIf=\"dg.showLineNumber || dg.showCheckbox || (columnsGroup?.leftFixed && columnsGroup?.leftFixed.length)\"  [style.width.px]=\"leftFixedWidth\" \r\n                    [style.transform]=\"'translate3d('+ scrollLeft +'px, 0px, 0px)'\">\r\n\r\n                    <fixed-left-rows [columns]=\"columnsGroup?.leftFixed\" [checkedRows]=\"checkedRows\" [selectedRows]=\"selectedRows\" [data]=\"rows\"></fixed-left-rows>\r\n                </div>\r\n\r\n                <div #fixedRight class=\"f-datagrid-table f-datagrid-body-fixed-right\" \r\n                    *ngIf=\"columnsGroup?.rightFixed && columnsGroup?.rightFixed.length\"\r\n                    [class.f-datagrid-fixed-right-shadow]=\"showRightShadow\" \r\n                    style=\"border: 0\" [style.width.px]=\"rightFixedWidth\" \r\n                    [style.transform]=\"'translate3d('+ fixedRightScrollLeft +'px, 0px, 0px)'\">\r\n                    \r\n                    <datagrid-rows #rightRows [fixedRight]=\"true\" [startRowIndex]=\"startRowIndex\" \r\n                    [width]=\"columnsGroup?.rightFixedWidth\"\r\n                    [columns]=\"columnsGroup?.rightFixed\" [data]=\"rows\"></datagrid-rows>\r\n                </div>\r\n\r\n                <div #main [style.width.px]=\"colsWidth\" style=\"position: relative;\" [style.left.px]=\"leftFixedWidth\" class=\"f-datagrid-table f-datagrid-body-center\">\r\n                    <datagrid-rows #mainRows [hasFixedColumns]=\"columnsGroup?.leftFixed && columnsGroup?.leftFixed?.length\" [startRowIndex]=\"startRowIndex\" [columns]=\"columnsGroup?.normalColumns\" [data]=\"rows\"></datagrid-rows>\r\n                </div>\r\n\r\n                <div hidefocus style=\"width: 100%\" [style.height.px]=\"blankBottomHeight\"></div>\r\n\r\n        </div>\r\n\r\n\r\n        <div [style.display]=\"dg.flatColumns?.length ? '': 'none'\"  *ngIf=\"data && data.length && fast\"\r\n        class=\"f-datagrid-bg\" [auto-height]=\"dg.autoHeight\" [wheelHeight]=\"canvasHeight\"\r\n        [style.height.px]=\"canvasHeight\" [style.width.px]=\"totalWidth\" >\r\n        \r\n                <div #blankTop hidefocus style=\"width: 100%\" [style.height.px]=\"blankTopHeight\"></div>\r\n\r\n                <div #main style=\"position: relative;\"  class=\"f-datagrid-table f-datagrid-body-center\">\r\n                    <datagrid-rows #mainRows [hasFixedColumns]=\"columnsGroup?.leftFixed && columnsGroup?.leftFixed?.length\"  [startRowIndex]=\"startRowIndex\" [columns]=\"columnsGroup?.columns\" [data]=\"rows\"></datagrid-rows>\r\n                </div>\r\n\r\n                <div hidefocus style=\"width: 100%\" [style.height.px]=\"blankBottomHeight\"></div>\r\n\r\n        </div>\r\n    </div>\r\n\r\n    <scrollbar-arrows [scrollbarXActive]=\"ps.instance && ps.instance.scrollbarXActive\" [scrollbarYActive]=\"ps.instance && ps.instance.scrollbarYActive\" \r\n    *ngIf=\"dg.scrollBarShowMode === 'allways' && dg.showScrollArrow\" (hasYScrollbar)=\"hasYScrollbar($event)\" (scrollMoveTo)=\"onClickScrollArrow($event)\"\r\n    [reachX]=\"ps.instance && ps.instance.reach.x\" [reachY]=\"ps.instance && ps.instance.reach.y\"></scrollbar-arrows>\r\n\r\n\r\n</div>\r\n\r\n\r\n\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
DatagridBodyComponent.ctorParameters = () => [
    { type: Injector },
    { type: ApplicationRef },
    { type: DatagridComponent, decorators: [{ type: Optional }] },
    { type: ChangeDetectorRef },
    { type: ElementRef }
];
DatagridBodyComponent.propDecorators = {
    footerHeight: [{ type: Input }],
    canvasWidth: [{ type: Input }],
    columnsGroup: [{ type: Input }],
    topHideHeight: [{ type: Input }],
    bottomHideHeight: [{ type: Input }],
    startRowIndex: [{ type: Input }],
    data: [{ type: Input }],
    dataChange: [{ type: Output }],
    scrollBarMode: [{ type: Input }],
    contextMenuItems: [{ type: Input }],
    checkedRows: [{ type: Input }],
    fast: [{ type: Input }],
    ps: [{ type: ViewChild, args: ['ps',] }],
    tableRowsCmp: [{ type: ViewChild, args: ['mainRows',] }],
    rightRowsCmp: [{ type: ViewChild, args: ['rightRows',] }],
    fixedLeftEl: [{ type: ViewChild, args: ['fixedLeft',] }],
    fixedRightEl: [{ type: ViewChild, args: ['fixedRight',] }],
    mainArea: [{ type: ViewChild, args: ['main',] }],
    viewScrollContainer: [{ type: ViewChild, args: ['viewScrollContainer',] }]
};
if (false) {
    /** @type {?} */
    DatagridBodyComponent.prototype.psConfig;
    /** @type {?} */
    DatagridBodyComponent.prototype.top;
    /** @type {?} */
    DatagridBodyComponent.prototype.height;
    /** @type {?} */
    DatagridBodyComponent.prototype.width;
    /** @type {?} */
    DatagridBodyComponent.prototype.colsWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.totalWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.leftFixedWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.rightFixedWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.rowHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.bodyStyle;
    /** @type {?} */
    DatagridBodyComponent.prototype.scrollTop;
    /** @type {?} */
    DatagridBodyComponent.prototype.scrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.deltaTopHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.wheelWidth;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._fixedRightScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.maxScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.showRightShadow;
    /** @type {?} */
    DatagridBodyComponent.prototype.footerHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.canvasWidth;
    /** @type {?} */
    DatagridBodyComponent.prototype.columnsGroup;
    /** @type {?} */
    DatagridBodyComponent.prototype.topHideHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.bottomHideHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.startRowIndex;
    /** @type {?} */
    DatagridBodyComponent.prototype.data;
    /** @type {?} */
    DatagridBodyComponent.prototype.dataChange;
    /** @type {?} */
    DatagridBodyComponent.prototype.scrollBarMode;
    /** @type {?} */
    DatagridBodyComponent.prototype.contextMenuItems;
    /** @type {?} */
    DatagridBodyComponent.prototype.checkedRows;
    /**
     * 性能优化版，默认为 false
     * @type {?}
     */
    DatagridBodyComponent.prototype.fast;
    /** @type {?} */
    DatagridBodyComponent.prototype.ps;
    /** @type {?} */
    DatagridBodyComponent.prototype.tableRowsCmp;
    /** @type {?} */
    DatagridBodyComponent.prototype.rightRowsCmp;
    /** @type {?} */
    DatagridBodyComponent.prototype.fixedLeftEl;
    /** @type {?} */
    DatagridBodyComponent.prototype.fixedRightEl;
    /** @type {?} */
    DatagridBodyComponent.prototype.mainArea;
    /** @type {?} */
    DatagridBodyComponent.prototype.viewScrollContainer;
    /** @type {?} */
    DatagridBodyComponent.prototype.visibleContextMenus;
    /** @type {?} */
    DatagridBodyComponent.prototype.currentRowId;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._hoverRowIndex;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.gridSizeSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.columnResizeSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.onDataSourceChangeSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.selectRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.unselectRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.selectAllSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.checkRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.clearSelectionsSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.checkAllSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.uncheckRowSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.clearCheckedsSubscribe;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.subscriptions;
    /** @type {?} */
    DatagridBodyComponent.prototype.dfs;
    /** @type {?} */
    DatagridBodyComponent.prototype.dgs;
    /** @type {?} */
    DatagridBodyComponent.prototype.ngZone;
    /** @type {?} */
    DatagridBodyComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.viewportH;
    /** @type {?} */
    DatagridBodyComponent.prototype.viewportW;
    /** @type {?} */
    DatagridBodyComponent.prototype.canvasHeight;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.minRowBuffer;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.vScrollDir;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.rowsCache;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.lastRenderedScrollTop;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.lastRenderedScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.prevScrollTop;
    /** @type {?} */
    DatagridBodyComponent.prototype.prevScrollLeft;
    /** @type {?} */
    DatagridBodyComponent.prototype.rows;
    /** @type {?} */
    DatagridBodyComponent.prototype.blankTopHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.blankBottomHeight;
    /** @type {?} */
    DatagridBodyComponent.prototype.cellContentFormatter;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.__triggerBodyClickEvent;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.destroy$;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._onMouseClick;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._scrollTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._scrollXTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.resizeObserverTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype._clickCellWeakMap;
    /** @type {?} */
    DatagridBodyComponent.prototype.onBeforeShowContextMenu;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.app;
    /** @type {?} */
    DatagridBodyComponent.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    DatagridBodyComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtYm9keS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYm9keS9kYXRhZ3JpZC1ib2R5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFPLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hGLE9BQU8sRUFBZ0IsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQzs7Ozs7Ozs7O0FBU3RELE9BQU8sRUFDSCxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQzlDLFVBQVUsRUFBYSxpQkFBaUIsRUFDZCx1QkFBdUIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFzQixRQUFRLEVBQUUsY0FBYyxFQUFnQixNQUFNLEVBQUUsWUFBWSxFQUN4SixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUMvRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUV6RSxPQUFPLEVBQWdFLGVBQWUsRUFBRSx5QkFBeUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3JLLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLDJCQUEyQixFQUE2QixTQUFTLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwSyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDbEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDdkUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBTzFDLE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7O0lBMEk5QixZQUNZLFFBQWtCLEVBQ2xCLEdBQW1CLEVBQ1IsRUFBcUIsRUFDaEMsRUFBcUIsRUFBVSxFQUFjO1FBSDdDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsUUFBRyxHQUFILEdBQUcsQ0FBZ0I7UUFDUixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNoQyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7O1FBNUl6RCxhQUFRLEdBQUcsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxZQUFZLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQVcxTSxjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsZUFBVSxHQUFHLENBQUMsQ0FBQztRQUNmLG1CQUFjLEdBQUcsQ0FBQyxDQUFDOztRQUVuQixlQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ1AsMEJBQXFCLEdBQUcsQ0FBQyxDQUFDO1FBUWxDLGtCQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ2YsaUJBQVksR0FBRyxDQUFDLENBQUM7O1FBSWpCLGtCQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLHFCQUFnQixHQUFHLENBQUMsQ0FBQztRQUVyQixrQkFBYSxHQUFHLENBQUMsQ0FBQztRQUdqQixlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVqQyxrQkFBYSxHQUFHLE1BQU0sQ0FBQztRQUd2QixnQkFBVyxHQUFHLEVBQUUsQ0FBQzs7OztRQUdqQixTQUFJLEdBQUcsS0FBSyxDQUFDO1FBWXRCLHdCQUFtQixHQUFHLEVBQUUsQ0FBQztRQUN6QixpQkFBWSxHQUFHLFNBQVMsQ0FBQztRQUVqQixtQkFBYyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBeUJwQixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQVduQixpQkFBWSxHQUFHLENBQUMsQ0FBQztRQUNqQixlQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLDBCQUFxQixHQUFHLENBQUMsQ0FBQztRQUMxQiwyQkFBc0IsR0FBRyxDQUFDLENBQUM7UUFDbkMsa0JBQWEsR0FBRyxDQUFDLENBQUM7UUFDbEIsbUJBQWMsR0FBRyxDQUFDLENBQUM7UUFDbkIsU0FBSSxHQUFHLEVBQUUsQ0FBQztRQUNWLG1CQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLHNCQUFpQixHQUFHLENBQUMsQ0FBQztRQW1CdEIseUJBQW9CLEdBQXVCLElBQUksQ0FBQzs7UUFHeEMsNEJBQXVCLEdBQUcsSUFBSSxDQUFDO1FBQy9CLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ3pCLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLGlCQUFZLEdBQVEsQ0FBQyxDQUFDO1FBQ3RCLGtCQUFhLEdBQVEsQ0FBQyxDQUFDO1FBQ3ZCLE9BQUUsR0FBMEIsSUFBSSxDQUFDO1FBQ2pDLHdCQUFtQixHQUFRLENBQUMsQ0FBQztRQUU3QixzQkFBaUIsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBd2lEMUMsNEJBQXVCOzs7O1FBQUcsQ0FBQyxDQUFNLEVBQUUsRUFBRTs7a0JBRTNCLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUM7WUFFbkMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFO2dCQUMxQyxPQUFPLEVBQUUsQ0FBQyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO2FBQzVCOztnQkFHRyxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBRTNCLElBQUksY0FBYyxFQUFFO2dCQUNoQixjQUFjO2dCQUNkLElBQUksY0FBYyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxjQUFjLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO29CQUN2SSxLQUFLLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQzs7MEJBQ3JDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7OzBCQUlqQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTOzswQkFDdEYsRUFBRSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQzs7d0JBQ2pDLE9BQU8sR0FBRyxJQUFJO29CQUNsQixJQUFJLEVBQUUsRUFBRTs7OEJBQ0UsU0FBUyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDO3dCQUMxQyxPQUFPLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO3FCQUM5RDs7d0JBRUcsdUJBQXVCLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQztvQkFDdEMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLHNCQUFzQixFQUFFOzs4QkFDMUIsZUFBZSxHQUFRLElBQUksQ0FBQyxFQUFFLENBQUMsc0JBQXNCLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUMsQ0FBQzt3QkFDaEksSUFBSSxPQUFPLGVBQWUsS0FBSyxTQUFTLEVBQUU7NEJBQ3RDLHVCQUF1QixHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQzt5QkFDakQ7NkJBQU07NEJBQ0gsSUFBSSxlQUFlLENBQUMsV0FBVyxDQUFDLEVBQUU7Z0NBQzlCLHVCQUF1QixHQUFHLGVBQWUsQ0FBQzs2QkFDN0M7eUJBQ0o7cUJBQ0o7b0JBRUQsT0FBTyx1QkFBdUIsQ0FBQyxJQUFJLENBQy9CLFNBQVM7Ozs7b0JBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRTs7OEJBQ1gsTUFBTSxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFDO3dCQUNsRixJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsRUFBRTtrQ0FDakIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxHQUFHLENBQUM7NEJBQ3RDLE9BQU8sRUFBRSxDQUFDLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRSxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUEsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLEVBQUMsQ0FBQyxDQUFDO3lCQUMzSDs2QkFBTTs0QkFDSCxPQUFPLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7eUJBQzFEO29CQUNMLENBQUMsRUFBQyxDQUNMLENBQUM7aUJBQ0w7YUFDSjtZQUNELE9BQU8sRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxFQUFBO1FBcmxERyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7O2NBRXJDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDO1FBQ2xFLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLGtCQUFrQixDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMzRixDQUFDOzs7O0lBcElELElBQUksb0JBQW9CO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLHFCQUFxQixDQUFDO0lBQ3RDLENBQUM7Ozs7O0lBQ0QsSUFBSSxvQkFBb0IsQ0FBQyxHQUFHO1FBQ3hCLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxHQUFHLENBQUM7SUFDckMsQ0FBQzs7OztJQXNDRCxJQUFJLGFBQWE7UUFDYixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDL0IsQ0FBQzs7Ozs7SUFDRCxJQUFJLGFBQWEsQ0FBQyxNQUFjO1FBQzVCLElBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDO1FBQzdCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDNUIsQ0FBQzs7OztJQUVELElBQUksWUFBWTtRQUNaLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUM7SUFDOUIsQ0FBQzs7Ozs7SUFzQ0QsSUFBSSxnQkFBZ0I7UUFDaEIsSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUU7O2tCQUNsQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xHLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzNDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLGdGQUFnRjthQUNsRztTQUVKO0lBQ0wsQ0FBQzs7OztJQUNELElBQUksZUFBZTtRQUNmLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFO1lBQ3hDLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUMzSDtJQUNMLENBQUM7Ozs7SUE4QkQsUUFBUTtRQUVKLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsRUFBRSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDOztjQUMzQixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsU0FBUzs7OztRQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ3hELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMzQyxDQUFDLEVBQUM7UUFDRixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzs7Y0FFdEIsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsU0FBUzs7O1FBQUMsR0FBRyxFQUFFO1lBQ3RELElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBQy9CLENBQUMsRUFBQztRQUNGLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDOztjQUV2QixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTOzs7UUFBQyxHQUFHLEVBQUU7WUFDaEQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUM1QixDQUFDLEVBQUM7UUFDRixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzs7Y0FFdEIsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFNBQVM7OztRQUFDLEdBQUcsRUFBRTtZQUMzQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN4QiwrQkFBK0I7UUFDbkMsQ0FBQyxFQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7O2NBRXRCLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUN0QyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQ1osQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRTtZQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxFQUFFO2dCQUNyQixJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQ2hDO1FBQ0wsQ0FBQyxFQUFDO1FBQ0YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFNUIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWE7Ozs7UUFBRyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3hGLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekIsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRTtZQUNqQixJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxTQUFTOzs7WUFBQyxHQUFHLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUMzQixDQUFDLEVBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQzs7Ozs7O0lBRU8sbUJBQW1CLENBQUMsWUFBa0I7O2NBQ3BDLEVBQUUsR0FBRyxZQUFZLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0I7UUFDbkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDeEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUM5QixJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQy9DLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3JDLElBQUksQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQzs7a0JBRWpELG9CQUFvQixHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBQyxDQUFDLEdBQUc7Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUMsQ0FBQyxNQUFNOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQzVHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLEVBQUMsQ0FBQyxJQUFJOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEVBQUMsQ0FBQTtZQUN6RixDQUFDLEVBQUMsQ0FBQyxNQUFNOztrQkFFSCxZQUFZLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLEVBQUMsQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLEVBQUMsQ0FBQyxNQUFNO1lBQ3BKLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLG9CQUFvQixDQUFDLENBQUM7WUFFdkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFO2dCQUNqRSxVQUFVOzs7Z0JBQUMsR0FBRyxFQUFFO29CQUNaLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUNsRCxDQUFDLEVBQUMsQ0FBQzthQUNOO1NBQ0o7UUFFRCxJQUFJLE9BQU8sQ0FBQyxZQUFZLEtBQUssU0FBUyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsRUFBRTtZQUM3RSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUN4QztRQUVELElBQUksT0FBTyxDQUFDLGFBQWEsS0FBSyxTQUFTLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQy9FLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDdEcsSUFBSSxDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN6RDtpQkFBTTtnQkFDSCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDO2FBQzVEO1lBRUQsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFO2dCQUM3RyxJQUFJLENBQUMsaUJBQWlCLElBQUksRUFBRSxDQUFDO2FBQ2hDO1NBQ0o7UUFFRCxJQUFJLE9BQU8sQ0FBQyxlQUFlLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ3JFLElBQUksQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUMvQjtJQUNMLENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1AsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7UUFDakMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQzlCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUV4RixJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDVCxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDMUQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUN4QjtRQUVELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO1lBQzFCLFlBQVksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztTQUMxQztJQUVMLENBQUM7Ozs7SUFFRCxlQUFlO1FBQ1gsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLGNBQWM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQy9CLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUU7Z0JBQ3JELElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFO29CQUMxQixZQUFZLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7aUJBQzFDO2dCQUNELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxVQUFVOzs7Z0JBQUMsR0FBRyxFQUFFO29CQUN2QyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztvQkFDMUIsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFNBQVMsRUFBRTt3QkFDbEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztxQkFDcEI7b0JBQ0QsNkJBQTZCO29CQUM3QixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUN4QixJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUUsZUFBZSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDO2dCQUMvSSxDQUFDLEdBQUUsR0FBRyxDQUFDLENBQUM7YUFDWDtRQUNMLENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzVELENBQUM7Ozs7SUFFRCxrQkFBa0I7SUFDbEIsQ0FBQzs7Ozs7O0lBRU8sY0FBYyxDQUFDLFlBQW9CO1FBQ3ZDLElBQUksQ0FBQyxHQUFHLEdBQUcsWUFBWSxDQUFDO1FBRXhCLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUU7WUFDakYsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQztTQUN2QztRQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRTtZQUMzQixJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUM7U0FDM0M7UUFFRCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxLQUFLLE1BQU0sQ0FBQyxFQUFFO1lBQy9GLG9DQUFvQztZQUNwQyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUM7YUFDcEM7U0FDSjtJQUNMLENBQUM7Ozs7OztJQUVPLHNCQUFzQixDQUFDLEtBQUssR0FBRyxLQUFLO1FBQ3hDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUN2QyxPQUFPO1NBQ1Y7O2NBQ0ssU0FBUyxHQUFRLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUTs7Y0FDakMsV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLGFBQWE7OztjQUU5QyxjQUFjLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDOztjQUN6RCxhQUFhLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7O2NBS3ZELFNBQVMsR0FBRyxXQUFXLENBQUMsU0FBUzs7Y0FDakMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxVQUFVO1FBRXpDLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDUixJQUFJLFNBQVMsSUFBSSxhQUFhLEVBQUU7Z0JBQzVCLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUNuQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsZUFBZSxDQUFDLENBQUM7YUFDekQ7U0FDSjthQUFNO1lBQ0gsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsZUFBZSxDQUFDLENBQUM7U0FDekQ7UUFFRCxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQztRQUNqQyxJQUFJLFVBQVUsSUFBSSxjQUFjLEVBQUU7WUFDOUIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsY0FBYyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1NBQzFEO2FBQU07WUFDSCxJQUFJLGNBQWMsRUFBRTtnQkFDaEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsY0FBYyxFQUFFLGVBQWUsQ0FBQyxDQUFDO2FBQzFEO1NBQ0o7SUFDTCxDQUFDOzs7Ozs7Ozs7SUFNTyxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksRUFBRSxvQkFBb0IsR0FBRyxLQUFLO1FBQ25FLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUMxQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUVyQzs7OztXQUlHO1FBQ0gsSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsbUJBQW1CLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRztZQUM3RyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMscUJBQXFCLEdBQUcsQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7WUFDcEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUMxQjtRQUVELElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDOztjQUNkLGFBQWE7OztRQUFHLEdBQUcsRUFBRTs7a0JBQ2pCLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxVQUFVO1lBQ3BELElBQUksVUFBVSxFQUFHO2dCQUNiLElBQUksVUFBVSxDQUFDLENBQUMsRUFBRTtvQkFDZCxJQUFJLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUM7b0JBQzlCLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQy9DLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLENBQUM7aUJBQ3hEO2dCQUVELElBQUksVUFBVSxDQUFDLENBQUMsRUFBRTtvQkFDZCxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUM7b0JBQy9CLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQy9DLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDO2lCQUMzRDthQUNKO1FBQ0wsQ0FBQyxDQUFBO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3BEO2FBQU07WUFDSCxJQUFJLFlBQVksRUFBRTtnQkFDZCxhQUFhLEVBQUUsQ0FBQzthQUNuQjtZQUNELElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNwQjtRQUdELElBQUksb0JBQW9CLEVBQUU7WUFDdEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsRUFBRSxDQUFDLG1CQUFtQixFQUFFLENBQUM7U0FDakM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztRQUNwQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFaEMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFFO1lBQ3pGLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUN4QjtJQUNMLENBQUM7Ozs7O0lBRU8sb0JBQW9CO1FBQ3hCLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRTtZQUNqRCxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU87Ozs7WUFBQyxDQUFDLEdBQWlCLEVBQUUsRUFBRTtnQkFDN0MsSUFBSSxHQUFHLEVBQUU7b0JBQ0wsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDO29CQUNsQixHQUFHLEdBQUcsSUFBSSxDQUFDO2lCQUNkO1lBQ0wsQ0FBQyxFQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztTQUMzQjtJQUNMLENBQUM7Ozs7O0lBRU8sY0FBYztRQUNsQixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUU1QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUM1QyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUMzQixDQUFDLElBQUksQ0FDRixZQUFZLENBQUMsRUFBRSxDQUFDLENBQ25CLENBQUMsU0FBUzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2hCLElBQUksS0FBSyxFQUFFO2dCQUNQLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLENBQUM7O3NCQUNuQixFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLEVBQUU7Z0JBQ3BDLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRXhCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDOztzQkFFaEMsUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLO2dCQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyQyxJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7Z0JBRWpDLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7b0JBQ3BCLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDO2lCQUNuQjtnQkFFRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQzFDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUUzQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQjs7O2dCQUFDLEdBQUcsRUFBRTtvQkFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDO29CQUN2QyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztvQkFDOUIsZ0NBQWdDO29CQUNoQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUUxQyxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztvQkFDdkcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFFdkIsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO3dCQUMxRSxJQUFJLFFBQVEsS0FBSyxJQUFJLENBQUMsS0FBSyxFQUFFOzRCQUN6QixJQUFJLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzt5QkFDbEQ7NkJBQU07NEJBQ0gsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3lCQUN4QztxQkFDSjt5QkFBTTt3QkFDSCxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7NEJBQ3BCLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7eUJBQ3BDO3dCQUVELElBQUksQ0FBQyxhQUFhLEdBQUcsVUFBVTs7O3dCQUFDLEdBQUcsRUFBRTs0QkFDakMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUN6QyxDQUFDLEdBQUUsR0FBRyxDQUFDLENBQUM7cUJBQ1g7Z0JBRUwsQ0FBQyxFQUFDLENBQUM7YUFDTjtRQUNMLENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFaEQsSUFBSSxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLEVBQWUsRUFBRSxFQUFFO1lBQzlFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzVCLENBQUMsRUFBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFFcEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsU0FBUzs7OztRQUFDLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRTtnQkFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO2FBQzVCO2lCQUFNO2dCQUNILElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDO2FBQ2pDO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsU0FBUzs7OztRQUFDLENBQUMsR0FBZ0IsRUFBRSxFQUFFO1lBQ3pFLElBQUksR0FBRyxFQUFFO2dCQUNMLElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDM0Isd0JBQXdCO2dCQUN4QixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQzNCO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUVqRCxJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsU0FBUzs7OztRQUFDLENBQUMsT0FBb0IsRUFBRSxFQUFFO1lBQ2pGLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLFlBQVksRUFBRTtnQkFDN0MsSUFBSSxDQUFDLFlBQVksR0FBRyxTQUFTLENBQUM7Z0JBQzlCLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQzthQUM5QjtZQUVELElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRTtnQkFDMUMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxLQUFLLFNBQVMsQ0FBQzthQUN0RTtZQUVELElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUVuRCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsU0FBUzs7OztRQUFDLENBQUMsSUFBbUIsRUFBRSxFQUFFO1lBQzVFLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzVCLENBQUMsRUFBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFakQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLEdBQWdCLEVBQUUsRUFBRTtZQUN2RSxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDMUIsMkJBQTJCO1FBQy9CLENBQUMsRUFBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFaEQsSUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsU0FBUzs7O1FBQUMsR0FBRyxFQUFFO1lBQ3JFLElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDO1lBQzlCLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2FBQzdCO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0IsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUV2RCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsU0FBUzs7OztRQUFDLENBQUMsT0FBb0IsRUFBRSxFQUFFO1lBQy9FLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMxQiwyQkFBMkI7UUFDL0IsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUVsRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsU0FBUzs7OztRQUFDLENBQUMsSUFBbUIsRUFBRSxFQUFFO1lBQzFFLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1QixJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMxQiwyQkFBMkI7UUFDL0IsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUVoRCxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsU0FBUzs7OztRQUFDLENBQUMsSUFBbUIsRUFBRSxFQUFFO1lBQ3BGLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDO2FBQ2pDO1lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1lBQzFCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxFQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUVyRCxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLFNBQVM7OztRQUFDLEdBQUcsRUFBRTtZQUNqRSxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsRUFBQyxDQUFDLENBQUM7UUFFSixJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQ3ZCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FDYixDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQU0sRUFBRSxFQUFFO1lBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU07Z0JBQ2YsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTTtvQkFDL0UsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxVQUFVLENBQUMsRUFBRTs7c0JBQzNGLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsa0RBQWtELENBQUM7Z0JBQ3JILE1BQU0sQ0FBQyxPQUFPOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFO29CQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQzlDLENBQUMsRUFBQyxDQUFDOztvQkFFQyxJQUFJLEdBQUcsRUFBRTtnQkFDYixJQUFJLENBQUMsRUFBRTs7MEJBQ0csS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFO29CQUNsQixJQUFJLEdBQUcsU0FBUyxHQUFHLEtBQUssQ0FBQztpQkFDNUI7Z0JBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM5QjtZQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BCLElBQUksQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLENBQUM7YUFDOUI7UUFFTCxDQUFDLEVBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUNoQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUN4QixZQUFZLENBQUMsR0FBRyxDQUFDLENBQ3BCLENBQUMsU0FBUzs7OztRQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO1lBQzdCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN2QixJQUFJLFFBQVEsSUFBSSxJQUFJLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN4QztpQkFBTTtnQkFDSCxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQzVEO1FBQ0wsQ0FBQyxFQUFDLENBQUM7UUFHSCxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsU0FBUzs7OztRQUFDLENBQUMsR0FBaUMsRUFBRSxFQUFFO1lBQ25FLElBQUksR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUU7Z0JBQ2pCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNsQztRQUNMLENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRTtZQUNuQixJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQ3hCLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQzNCLENBQUMsU0FBUzs7OztZQUFDLENBQUMsQ0FBTSxFQUFFLEVBQUU7Z0JBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUU7b0JBQ2IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7b0JBQ3hDLFVBQVU7OztvQkFBQyxHQUFHLEVBQUUsR0FBRSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQSxDQUFDLEVBQUMsQ0FBQztpQkFDL0M7WUFDTCxDQUFDLEVBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUMxQixTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUMzQixDQUFDLFNBQVM7Ozs7WUFBQyxDQUFDLENBQU0sRUFBRSxFQUFFO2dCQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFO29CQUNiLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2lCQUM1QztZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7Ozs7O0lBRU8sb0JBQW9CLENBQUMsUUFBUSxFQUFFLFFBQVE7UUFDM0MsSUFBSSxRQUFRLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ3ZDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTzs7OztZQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUN0QixJQUFJLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFO29CQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU07Ozs7b0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FBQyxFQUFDLENBQUMsT0FBTzs7OztvQkFBQyxDQUFDLENBQUMsRUFBRTt3QkFDekUsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLEdBQUcsUUFBUSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUM7b0JBQzNELENBQUMsRUFBQyxDQUFDO2lCQUNOO3FCQUFNOzswQkFDRyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJOzs7O29CQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFDO29CQUMvQyxJQUFJLElBQUksRUFBRTt3QkFDTixJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxRQUFRLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQzt3QkFDMUQsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFOzRCQUMvQixJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO3lCQUM3QztxQkFDSjtpQkFDSjtZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7Ozs7O0lBSU8sb0JBQW9CLENBQUMsT0FBTyxFQUFFLE1BQWU7UUFDakQsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRTs7a0JBQ2YsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxPQUFPLENBQUMsRUFBRSxFQUFDO1lBQ25ELElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUMxQjthQUFNO1lBQ0gsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQzFCO1FBRUQsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRTtZQUN6QixZQUFZLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztTQUN6QztRQUVELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLFVBQVU7OztRQUFDLEdBQUcsRUFBRTtZQUN0QyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxHQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ1gsQ0FBQzs7Ozs7O0lBRU8scUJBQXFCLENBQUMsUUFBZ0I7UUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFDdkIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUMzQjtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRTtZQUNuQixPQUFPO1NBQ1Y7UUFFRCxJQUFJLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxFQUFFO1lBQ3BDLFlBQVksQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQyxDQUFDO1NBQ3BEO1FBRUQsSUFBSSxDQUFDLDRCQUE0QixDQUFDLEdBQUcsVUFBVTs7O1FBQUMsR0FBRyxFQUFFO1lBQ2pELElBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxRQUFRLEVBQUU7O3NCQUNqQixDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDO2dCQUNuRCxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQy9EO1lBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFO2dCQUN2QyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQzthQUM3QjtZQUNELElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDakIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN2RSxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUUsZUFBZSxFQUFFLElBQUksQ0FBQyxlQUFlLEVBQUcsQ0FBQyxDQUFDO1FBQ2hKLENBQUMsR0FBRSxFQUFFLENBQUMsQ0FBQztJQUNYLENBQUM7Ozs7OztJQUdPLGdCQUFnQixDQUFDLEVBQWU7UUFDcEMsSUFBSSxFQUFFLEVBQUU7WUFDSixJQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztZQUV2QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7WUFFL0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1lBQzlELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1lBQzFELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDOzs7a0JBRXpDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxXQUFXOzs7a0JBRWhFLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO1lBRTdELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3JDLElBQUksZ0JBQWdCLEdBQUcsWUFBWSxJQUFJLGdCQUFnQixLQUFLLFlBQVksRUFBRTtnQkFDdEUsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7YUFDaEM7aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7Z0JBQzVCLFdBQVc7Z0JBQ1gsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQzthQUM3RDtZQUNELElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1NBQzdCO0lBQ0wsQ0FBQzs7Ozs7SUFFTyxrQkFBa0I7UUFDdEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQztRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO1FBQy9DLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixLQUFLLFNBQVMsRUFBRTtZQUN4RSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFO2dCQUNuQyxJQUFJLENBQUMsZUFBZSxJQUFJLEVBQUUsQ0FBQzthQUM5QjtTQUNKO0lBQ0wsQ0FBQzs7Ozs7O0lBRU8sb0JBQW9CLENBQUMsR0FBaUM7O1lBRXRELFFBQVEsR0FBRyxFQUFFOztZQUNiLE9BQU8sR0FBRyxFQUFFO1FBQ2hCLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNuQixRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDckU7UUFFRCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbEIsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLENBQUM7U0FDaEY7O2NBRUssR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLHdCQUF3QixDQUFDOztjQUU1RSxlQUFlOzs7Ozs7UUFBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDeEMsSUFBSSxHQUFHLENBQUMsTUFBTSxFQUFFOztzQkFDTixFQUFFLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLENBQUMsV0FBVyxHQUFHLENBQUMsS0FBSyxJQUFJLENBQUM7Z0JBQ2pFLElBQUksRUFBRSxFQUFFO29CQUNKLElBQUksQ0FBQyxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2lCQUN4QzthQUNKO1FBQ0wsQ0FBQyxDQUFBO1FBRUQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsT0FBTzs7OztRQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzlCLElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRTs7c0JBQ04sR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJOztzQkFDZCxHQUFHLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQzs7c0JBQ3BDLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQztnQkFDMUMsSUFBSSxFQUFFLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUU7b0JBQzlCLGVBQWUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUNsQyxlQUFlLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDbkMsZUFBZSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ2pDO2FBQ0o7UUFDTCxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7O0lBRU8sa0JBQWtCO1FBQ3RCLElBQUksQ0FBQyxHQUFHLENBQUMsd0JBQXdCLEVBQUUsQ0FBQzs7Y0FDOUIsV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUTtRQUNwQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzVDLENBQUM7Ozs7O0lBRU8sY0FBYzs7Y0FDWixJQUFJLEdBQUcsRUFBRTs7WUFDWCxRQUFRLEdBQUcsRUFBRTs7WUFDYixPQUFPLEdBQUcsRUFBRTs7WUFDWixNQUFNLEdBQUcsRUFBRTtRQUNmLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNuQixRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDckU7UUFFRCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbEIsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLENBQUM7U0FDaEY7UUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDZixNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsd0JBQXdCLENBQUMsQ0FBQztTQUNuRjtRQUNELE1BQU0sQ0FBQyxPQUFPOzs7OztRQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFOztnQkFDakIsRUFBRSxHQUFHLENBQUM7O2tCQUNKLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUM7O2dCQUNqQyxFQUFFLEdBQUcsQ0FBQztZQUNWLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7Z0JBQzNCLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUMzQztZQUVELElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUU7Z0JBQzdCLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUM1Qzs7a0JBRUssRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDbEQsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFHRCxnQkFBZ0I7O1lBQ1IsUUFBUSxHQUFHLEVBQUU7O1lBQ2IsT0FBTyxHQUFHLEVBQUU7O1lBQ1osTUFBTSxHQUFHLEVBQUU7UUFDZixJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDbkIsUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3JFO1FBRUQsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2xCLE9BQU8sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQ2hGO1FBRUQsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLHdCQUF3QixDQUFDLENBQUM7U0FDbkY7UUFFRCxNQUFNLENBQUMsT0FBTzs7Ozs7UUFBQyxDQUFDLEVBQU8sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMxQixJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUIsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUN2QixJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDdkM7WUFDRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN4QztRQUNMLENBQUMsRUFBQyxDQUFDO1FBRUgsSUFBSSxJQUFJLENBQUMseUJBQXlCLENBQUMsRUFBRTtZQUNqQyxZQUFZLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQztTQUNqRDtRQUVELElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxHQUFHLFVBQVU7OztRQUFDLEdBQUcsRUFBRTtZQUM5QyxNQUFNLENBQUMsT0FBTzs7Ozs7WUFBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRTs7b0JBQ2pCLEVBQUUsR0FBRyxDQUFDOztzQkFDSixFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDOztvQkFDakMsRUFBRSxHQUFHLENBQUM7O29CQUVOLE1BQU0sR0FBRyxJQUFJOztvQkFDYixPQUFPLEdBQUcsSUFBSTtnQkFDbEIsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtvQkFDM0IsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUN4QyxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO2lCQUN0QjtnQkFFRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFO29CQUM3QixFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7b0JBQ3pDLE9BQU8sR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3pCOztzQkFFSyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFFbEQsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFOzswQkFDakMsYUFBYSxHQUFHLHVCQUF1QixHQUFHLEdBQUcsR0FBRyxFQUFFOzswQkFDbEQsbUJBQW1CLEdBQUcsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLFNBQVM7OzBCQUV4RCxxQkFBcUI7Ozs7b0JBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRTt3QkFDcEMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7d0JBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO29CQUNyRCxDQUFDLENBQUE7b0JBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBRXhDLHFCQUFxQixDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUUxQixJQUFJLE1BQU0sRUFBRTt3QkFDUixxQkFBcUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztxQkFDakM7b0JBRUQsSUFBSSxPQUFPLEVBQUU7d0JBQ1QscUJBQXFCLENBQUMsT0FBTyxDQUFDLENBQUM7cUJBQ2xDO2lCQUNKO1lBQ0wsQ0FBQyxFQUFDLENBQUM7UUFDUCxDQUFDLEdBQUUsR0FBRyxDQUFDLENBQUM7SUFDWixDQUFDOzs7Ozs7SUFFTyxrQkFBa0IsQ0FBQyxFQUFFO1FBQ3pCLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDTCxPQUFPO1NBQ1Y7O2NBQ0ssSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUk7Ozs7UUFBQyxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFDO1FBQ2xHLElBQUksSUFBSSxFQUFFO1lBQ04sRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0I7SUFDTCxDQUFDOzs7Ozs7O0lBRU8sZUFBZSxDQUFDLGFBQXFCLEVBQUUsRUFBVTtRQUNyRCxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLEtBQUssYUFBYSxFQUFFLENBQUMsQ0FBQztRQUN4RSxJQUFJLENBQUMsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEVBQUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsR0FBRyxjQUFjLEVBQUUsRUFBQyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQztJQUM5RixDQUFDOzs7Ozs7SUFJRCxlQUFlLENBQUMsT0FBTyxHQUFHLElBQUk7UUFDMUIsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1gsT0FBTztTQUNWO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDaEIsT0FBTztTQUNWOztjQUVLLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUM7UUFDekUsSUFBSSxNQUFNLEVBQUU7WUFDUixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQzthQUM3QztpQkFBTTtnQkFDSCxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7YUFDaEQ7U0FDSjtRQUdELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDVixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztTQUMzQjthQUFNOztrQkFDRyxFQUFFLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDO1lBQ2hELElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ0wsT0FBTzthQUNWOztrQkFFSyxRQUFRLEdBQUcsT0FBTyxHQUFHLFlBQVk7O2tCQUNqQyxTQUFTLEdBQUcsT0FBTyxHQUFHLGFBQWE7O2tCQUNuQyxNQUFNLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDOztrQkFDL0MsT0FBTyxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQztZQUN2RCxJQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQzs7a0JBRzNCLElBQUksR0FBRyxFQUFFO1lBQ2YsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFOztzQkFDYixHQUFHLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUM7Z0JBQ3hFLElBQUksR0FBRyxFQUFFO29CQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztpQkFDMUM7YUFDSjtZQUVELElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTs7c0JBQ1osR0FBRyxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDO2dCQUN2RSxJQUFJLEdBQUcsRUFBRTtvQkFDTCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7aUJBQzFDO2FBQ0o7WUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7O3NCQUNULEVBQUUsR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztnQkFDbkUsSUFBSSxFQUFFLEVBQUU7b0JBQ0osSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2lCQUN6QzthQUNKOztrQkFFSyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQzs7a0JBRXRCLGFBQWEsR0FBRyx1QkFBdUIsR0FBRyxHQUFHLEdBQUcsRUFBRTtZQUV4RCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBRXZDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxhQUFhLENBQUMsQ0FBQztnQkFDeEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBRXhDLElBQUksTUFBTSxFQUFFO29CQUNSLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQztpQkFDL0M7Z0JBRUQsSUFBSSxPQUFPLEVBQUU7b0JBQ1QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFDO2lCQUNoRDthQUNKO1NBQ0o7UUFFRCxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQzs7O2NBR3BCLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsaURBQWlELENBQUM7UUFDcEgsTUFBTSxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEVBQUUsRUFBQyxDQUFDO1FBRXpDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDM0I7SUFDTCxDQUFDOzs7OztJQUdPLFlBQVk7O1lBQ1osQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtRQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFFbkIsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLHVCQUF1QixFQUFFO2dCQUNqQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUM7YUFDL0I7aUJBQU07Z0JBQ0gsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRTtvQkFDcEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDO2lCQUMvQjtnQkFFRCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFOzt3QkFDdEMsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVTtvQkFDM0IsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUU7d0JBQzlCLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztxQkFDcEM7b0JBRUQsSUFBSSxFQUFFLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFO3dCQUN0QyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDO3dCQUU3QixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxLQUFLLE1BQU0sRUFBRTs0QkFDbkMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQzt5QkFDaEM7cUJBQ0o7aUJBQ0o7YUFDSjtTQUNKO2FBQU07WUFFSCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxLQUFLLE1BQU0sRUFBRTtnQkFDekQsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQzthQUNoQztTQUNKO1FBQ0QsT0FBTztZQUNILE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJO1NBQ25DLENBQUM7SUFDTixDQUFDOzs7Ozs7SUFFTyxvQkFBb0IsQ0FBQyxVQUFlO1FBQ3hDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBRTdCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUNoRixJQUFJLElBQUksQ0FBQyxvQkFBb0IsS0FBSyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3BHLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQy9DLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO1NBQ2hDO2FBQU07WUFDSCxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztTQUMvQjtRQUVELElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNsQixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsZUFBZSxJQUFJLENBQUMsVUFBVSxlQUFlLENBQUMsQ0FBQztTQUNwSDtRQUVELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTs7Z0JBQ2YsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlO1lBQ3hGLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGlCQUFpQixLQUFLLFNBQVMsRUFBRTtnQkFDN0csQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUNYOztnQkFDRyxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlO1lBQ3BILElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxTQUFTLEVBQUU7Z0JBQzFELENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQzthQUN4RTtZQUNELENBQUMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDO1lBRXJCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLGVBQWUsSUFBSSxDQUFDLG9CQUFvQixlQUFlLENBQUMsQ0FBQztTQUMvSDtJQUNMLENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFDLE1BQVc7O2NBQ2IsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVTtRQUNsQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsMkJBQTJCO1FBQzNCLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxlQUFlLENBQUMsQ0FBQztRQUMxQyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6RSxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztJQUMzRyxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxNQUFXO1FBRW5CLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNuQixZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ25DO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxVQUFVOzs7UUFBQyxHQUFHLEVBQUU7O2tCQUMxQixDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTO1lBRWpDLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUU7Z0JBQ3JCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQzthQUN2QjtZQUVELElBQUksQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO1lBRW5CLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1lBRTFFLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDOUMsQ0FBQyxHQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ1osQ0FBQzs7Ozs7SUFFRCxlQUFlLENBQUMsTUFBVzs7Y0FDakIsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVTtRQUNsQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLDJCQUEyQixDQUFDLENBQUM7SUFDMUQsQ0FBQzs7Ozs7SUFFRCxhQUFhLENBQUMsTUFBVztRQUNyQixJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztRQUM3QixzQ0FBc0M7UUFDdEMsZ0NBQWdDO1FBQ2hDLDJCQUEyQjtRQUMzQix1REFBdUQ7UUFDdkQsdURBQXVEO0lBQzNELENBQUM7Ozs7O0lBRUQsU0FBUyxDQUFDLE9BQVk7UUFDbEIsSUFBSSxPQUFPLEVBQUU7WUFDVCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDMUQ7YUFBTTtZQUNILE9BQU8sS0FBSyxDQUFDO1NBQ2hCO0lBQ0wsQ0FBQzs7Ozs7SUFFRCxVQUFVLENBQUMsT0FBWTtRQUNuQixJQUFJLE9BQU8sRUFBRTtZQUNULE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUMzRDtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Ozs7OztJQUVELGNBQWMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxHQUFHLElBQUk7UUFDM0IsR0FBRyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNyQixDQUFDOzs7Ozs7SUFPTSxpQkFBaUI7O1lBQ2hCLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU07UUFDbkMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRTtZQUNwQixjQUFjLEdBQUcsY0FBYyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUM7U0FDOUQ7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFO1lBQ2pGLGNBQWMsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQztTQUM3QztRQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRTtZQUMzQixjQUFjLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQztTQUNqRDtRQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDeEMsY0FBYyxHQUFHLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQztTQUMxRDtRQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7WUFDcEIsY0FBYyxHQUFHLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7U0FDN0Q7UUFFRCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFO1lBQ3BCLGNBQWMsSUFBSSxDQUFDLENBQUM7U0FDdkI7UUFFRCxJQUFJLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxPQUFPLGNBQWMsQ0FBQztJQUMxQixDQUFDOzs7Ozs7SUFHTyxhQUFhOztjQUNYLGNBQWMsR0FBRyxDQUFDOzs7Y0FDbEIsU0FBUyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxHQUFHLGNBQWM7O1lBRWhELFVBQVUsR0FBRyxDQUFDO1FBQ2xCLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUU7O2tCQUNiLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU07Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFHLFNBQVMsRUFBQztZQUNoRyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEtBQUssWUFBWSxFQUFFO2dCQUMvQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU07Ozs7Z0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFDLENBQUMsTUFBTSxDQUFDO2FBQ2hFO2lCQUFNO2dCQUNILFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO2FBQzVCO1NBQ0o7YUFBTTtZQUNILFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUNqQzs7WUFFRyxDQUFDLEdBQUcsVUFBVSxHQUFHLFNBQVM7UUFFOUIsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRTtZQUNwQixDQUFDLElBQUksVUFBVSxDQUFDO1NBQ25CO2FBQU07WUFDSCxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ1Y7UUFFRCxPQUFPLENBQUMsQ0FBQztJQUNiLENBQUM7Ozs7O0lBRU8sZUFBZTs7WUFDZixZQUFZLEdBQUcsQ0FBQztRQUVwQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2pDLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sQ0FBQyxDQUFDO1NBQ1o7UUFFRCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFO1lBQ2hCLGFBQWE7WUFDYixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQzFELFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLHFCQUFxQixFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDekY7aUJBQU07Z0JBQ0gsWUFBWSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQzthQUN2QztTQUNKO2FBQU07WUFDSCxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLE1BQU07Ozs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ25FO1FBRUQsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNmLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQ2pDO1FBRUQsWUFBWSxHQUFHLFlBQVksR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsaUJBQWlCLEtBQUssU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9JLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLE9BQU8sWUFBWSxDQUFDO0lBQ3hCLENBQUM7Ozs7SUFFRCxrQkFBa0I7UUFDZCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUMvQyxDQUFDOzs7Ozs7SUFHTyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25ELENBQUM7Ozs7OztJQUVELGVBQWUsQ0FBQyxXQUFvQixFQUFFLFlBQXFCO1FBQ3ZELElBQUksV0FBVyxJQUFJLElBQUksRUFBRTtZQUNyQixXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztTQUNoQztRQUNELElBQUksWUFBWSxJQUFJLElBQUksRUFBRTtZQUN0QixZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztTQUNsQztRQUVELE9BQU87WUFDSCxHQUFHLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztZQUN6QyxNQUFNLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQztZQUNqRSxNQUFNLEVBQUUsWUFBWTtZQUNwQixPQUFPLEVBQUUsWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTO1NBQ3pDLENBQUM7SUFDTixDQUFDOzs7Ozs7O0lBRU8sZ0JBQWdCLENBQUMsV0FBb0IsRUFBRSxZQUFxQjs7Y0FDMUQsS0FBSyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQzs7Y0FDdkQsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFDOztjQUM3RCxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVk7UUFFbkMsSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ3ZCLEtBQUssQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxNQUFNLElBQUksU0FBUyxDQUFDO1NBQzdCO2FBQU0sSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsRUFBRTtZQUM3QixLQUFLLENBQUMsR0FBRyxJQUFJLFNBQVMsQ0FBQztZQUN2QixLQUFLLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQztTQUMxQjthQUFNO1lBQ0gsS0FBSyxDQUFDLEdBQUcsSUFBSSxTQUFTLENBQUM7WUFDdkIsS0FBSyxDQUFDLE1BQU0sSUFBSSxTQUFTLENBQUM7U0FDN0I7UUFFRCxLQUFLLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUU1RCxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDL0IsS0FBSyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO1FBRWhDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDOzs7Ozs7SUFFTyxVQUFVLENBQUMsS0FBSzs7Y0FDZCxJQUFJLEdBQUcsRUFBRTs7WUFDWCxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNOztZQUM3QixLQUFLLEdBQUksSUFBSSxDQUFDLElBQUk7UUFFckIsT0FBTztRQUNSLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7WUFDekMsS0FBSyxHQUFJLEtBQUssQ0FBQyxNQUFNOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsbUJBQW1CLENBQUMsS0FBRyxTQUFTLEVBQUMsQ0FBQztZQUV6RixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEtBQUssWUFBWSxFQUFFO2dCQUMvQyxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU07Ozs7Z0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFDLENBQUM7YUFDckQ7WUFFRCxVQUFVLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztZQUMxQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztTQUN2QjtRQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM1QyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksVUFBVSxDQUFDLEVBQUc7Z0JBQ3pDLFNBQVM7YUFDWjtZQUVELElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFYix5REFBeUQ7WUFDekQseUJBQXlCO1lBQ3pCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUc7Z0JBQ2hCLE9BQU8sRUFBRSxJQUFJOzs7Z0JBSWIsWUFBWSxFQUFFLEVBQUU7O2dCQUdoQixvQkFBb0IsRUFBRSxFQUFFOzs7O2dCQUt4QixlQUFlLEVBQUUsRUFBRTthQUN0QixDQUFDO1NBQ0w7UUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzNDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNwRDtRQUVELE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxNQUFNOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUMxRixDQUFDOzs7Ozs7SUFHTyxrQkFBa0IsQ0FBQyxHQUFHOztjQUNwQixVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUM7UUFDdEMsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNiLE9BQU87U0FDVjtRQUVELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQixDQUFDOzs7Ozs7SUFFTyxXQUFXLENBQUMsV0FBVztRQUMzQixLQUFLLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDNUIsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRTtnQkFDL0MsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzlCO1NBQ0o7SUFDTCxDQUFDOzs7OztJQUVELGFBQWEsQ0FBQyxjQUF3QjtRQUNsQyxVQUFVOzs7UUFBQyxHQUFHLEVBQUU7WUFDWixjQUFjLEdBQUcsY0FBYyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUEsQ0FBQyxDQUFDLGNBQWMsQ0FBQzs7a0JBQzNGLElBQUksR0FBRyxjQUFjLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvRSxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDNUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN0QixDQUFDLEdBQUUsRUFBRSxDQUFDLENBQUM7SUFDWCxDQUFDOzs7OztJQUVELGtCQUFrQixDQUFDLE1BQU07Y0FDZixFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxNQUFNO1FBQzdCLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRTtrQkFDdkIsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSztZQUV2QyxRQUFPLEdBQUcsRUFBRTtnQkFDUixLQUFLLE1BQU07b0JBQ1AsSUFBSSxDQUFDLEtBQUksT0FBTyxFQUFFO3dCQUNkLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztxQkFDOUc7b0JBQ0QsTUFBTTtnQkFDVixLQUFLLE9BQU87b0JBQ1IsSUFBSSxDQUFDLEtBQUksS0FBSyxFQUFFO3dCQUNaLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztxQkFDOUc7b0JBQ0QsTUFBTTtnQkFDVixLQUFLLEtBQUs7b0JBQ04sSUFBSSxDQUFDLEtBQUssT0FBTyxFQUFFO3dCQUNmLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztxQkFDNUc7b0JBQ0QsTUFBTTtnQkFDVixLQUFLLFFBQVE7b0JBQ1QsSUFBSSxDQUFDLEtBQUssS0FBSyxFQUFFO3dCQUNiLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztxQkFDNUc7b0JBQ0QsTUFBTTthQUNiO1lBRUQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNwQjtJQUNMLENBQUM7Ozs7OztJQUVPLFVBQVUsQ0FBQyxhQUFhLEdBQUcsSUFBSTtRQUNuQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUU7WUFDNUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ3pCO2FBQU07O2tCQUNHLE9BQU8sR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFOztrQkFDaEMsUUFBUSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUV4Qyx3Q0FBd0M7WUFDeEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUUzQixzQkFBc0I7WUFDdEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQztZQUVsQyxJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUM1QyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUk5QyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNuRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hILElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDN0csSUFBSSxDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQzthQUNoQztZQUdELElBQUksYUFBYSxFQUFFO2dCQUNmLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7YUFDM0I7U0FDSjtJQUVMLENBQUM7Ozs7O0lBRU8sWUFBWTtRQUNoQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUM7UUFDNUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1FBQzlELE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ2hDLENBQUM7Ozs7O0lBRU8sYUFBYTs7Y0FDWCxpQkFBaUIsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsYUFBYTs7WUFDNUQsa0JBQWtCLEdBQUcsaUJBQWlCLENBQUMsWUFBWSxHQUFHLGlCQUFpQixDQUFDLFlBQVk7O1lBQ3BGLGtCQUFrQixHQUFHLGlCQUFpQixDQUFDLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxXQUFXO1FBRXRGLGdGQUFnRjtRQUNoRiw0QkFBNEI7UUFDNUIsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUNyRCxrQkFBa0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBRXJELGdDQUFnQztRQUNoQyxJQUFJLElBQUksQ0FBQyxTQUFTLEdBQUcsa0JBQWtCLEVBQUU7WUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztTQUN2QztRQUNELElBQUksSUFBSSxDQUFDLFVBQVUsR0FBRyxrQkFBa0IsRUFBRTtZQUN0QyxJQUFJLENBQUMsVUFBVSxHQUFHLGtCQUFrQixDQUFDO1NBQ3hDOztjQUVLLFdBQVcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQzs7Y0FDM0QsV0FBVyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBRW5FLElBQUksV0FBVyxFQUFFO1lBQ2IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBRXRDLHdEQUF3RDtZQUN4RCw0QkFBNEI7WUFDNUIsMkJBQTJCO1lBQzNCLG9EQUFvRDtZQUNwRCxRQUFRO1lBQ1IsV0FBVztZQUNYLDJCQUEyQjtZQUMzQixvREFBb0Q7WUFDcEQsUUFBUTtZQUNSLElBQUk7U0FDUDs7Y0FFSyxhQUFhLEdBQUcsSUFBSSxDQUFDLHFCQUFxQjtRQUVoRCxJQUFJLFdBQVcsRUFBRTtZQUNiLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9ELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUVwQyw0QkFBNEI7WUFDNUIsb0RBQW9EO1lBQ3BELHFEQUFxRDtZQUNyRCxlQUFlO1lBQ2Ysa0RBQWtEO1lBQ2xELFFBQVE7WUFDUixJQUFJO1lBRUosaUNBQWlDO1lBQ2pDLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQzlCLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQ2xDO1NBQ0o7UUFFRCxJQUFJLFdBQVcsSUFBSSxXQUFXLEVBQUU7O2tCQUN0QixFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQzs7a0JBQzVELEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ25ELElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxFQUFFO2dCQUNwQixnRkFBZ0Y7Z0JBQ2hGLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUU7b0JBQzVDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztpQkFDckI7cUJBQU07b0JBQ0gsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO2lCQUNyQjthQUNKO1NBQ0o7UUFFRCxJQUFJLFdBQVcsSUFBSSxXQUFXLEVBQUU7WUFDNUIsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Ozs7OztJQUVPLFNBQVMsQ0FBQyxDQUFDOztjQUNULHlCQUF5QixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhO1FBQ3hFLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuQixDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7O2NBRTlDLFlBQVksR0FBRyxDQUFDO1FBRXRCLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxZQUFZLEVBQUU7WUFDcEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLHFCQUFxQixHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsYUFBYSxHQUFHLFlBQVksQ0FBQyxDQUFDO1lBRWxGLDRCQUE0QjtZQUM1QixpREFBaUQ7WUFDakQsSUFBSTtZQUVKLHVCQUF1QjtZQUN2QixvRkFBb0Y7WUFDcEYsSUFBSTtZQUVKLHNEQUFzRDtTQUN6RDtJQUNMLENBQUM7Ozs7O0lBSUQsWUFBWSxDQUFDLE1BQWtCOzs7Y0FFckIsTUFBTSxHQUFHLG1CQUFBLE1BQU0sQ0FBQyxNQUFNLEVBQU87UUFFbkMsSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLFVBQVUsSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLE9BQU8sRUFBRztZQUNoRSxPQUFPO1NBQ1Y7O1lBRUcsRUFBRSxHQUFHLE1BQU07UUFDZixJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssSUFBSSxFQUFFO1lBQzFCLEVBQUUsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzdCO1FBRUQsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNMLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsMkJBQTJCLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLEVBQUc7Z0JBQzdGLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLENBQUM7YUFDeEI7WUFDRCxPQUFPO1NBQ1Y7O1lBRUcsSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFO1FBQy9CLFFBQVE7Ozs7WUFDSixLQUFLLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztRQUN4QyxhQUFhO1FBQ2IsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsSUFBSSxDQUFDOzs7WUFFM0IsSUFBSSxHQUFHLElBQUksR0FBRyxLQUFLOztjQUdqQixjQUFjOzs7UUFBRyxHQUFHLEVBQUU7WUFDeEIsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxhQUFhLEtBQUssSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxFQUFFO2dCQUNuSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3JELE9BQU8sSUFBSSxDQUFDO2FBQ2Y7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDLENBQUE7O2NBRUssVUFBVTs7O1FBQUcsR0FBRyxFQUFFO1lBQ3BCLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3JCLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2FBQzdCO2lCQUFNO2dCQUNILElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRTs7Ozs7Z0JBQUUsQ0FBQyxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUU7O3dCQUNoQyxJQUFJLEdBQUcsQ0FBQyxXQUFXO29CQUN2QixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxLQUFLLFNBQVMsRUFBRTt3QkFDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQzt3QkFDeEIsSUFBSSxHQUFHLElBQUksQ0FBQztxQkFDZjtvQkFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUNuQyxJQUFJLENBQUMsRUFBRSxDQUFDLHlCQUF5QixDQUFDLEVBQUUsQ0FBQztnQkFDekMsQ0FBQyxFQUFDLENBQUM7YUFDTjtRQUNMLENBQUMsQ0FBQTs7Y0FFSyxZQUFZOzs7UUFBRyxHQUFHLEVBQUU7O2tCQUNoQixhQUFhLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFBLENBQUMsQ0FBQyxDQUFDO1lBRW5FLElBQUksY0FBYyxFQUFFLEVBQUc7Z0JBQ25CLElBQUksSUFBSSxHQUFHLGFBQWEsRUFBRTtvQkFDdEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQzNCLGVBQWU7b0JBQ2YsWUFBWSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUE7aUJBQ3hDO3FCQUFNO29CQUNILE9BQU87b0JBQ1AsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsVUFBVTs7O29CQUFDLEdBQUcsRUFBRTt3QkFDdEMsVUFBVSxFQUFFLENBQUM7b0JBQ2pCLENBQUMsR0FBRSxhQUFhLENBQUMsQ0FBQztpQkFDckI7YUFDSjtpQkFBTTtnQkFDSCxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxVQUFVOzs7Z0JBQUMsR0FBRyxFQUFFO29CQUN0QyxVQUFVLEVBQUUsQ0FBQztnQkFDakIsQ0FBQyxHQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUM5QjtZQUVELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hFLENBQUMsQ0FBQTtRQUdELElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxFQUFFLEVBQUU7WUFDekIsbUJBQW1CO1lBQ25CLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN6QixZQUFZLEVBQUUsQ0FBQztZQUNmLE9BQU87U0FDVjtRQUVELElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEtBQUssS0FBSyxFQUFFO1lBQzVCLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQywyQkFBMkIsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFO2dCQUM1RCxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDO2FBQ3hCO1lBQ0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFOzs7OztZQUFFLENBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFO2dCQUNwQyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0MsQ0FBQyxFQUFDLENBQUM7WUFDSCxPQUFPO1NBQ1Y7UUFDRCxJQUFJLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFO1lBQzVCLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUM7WUFDckMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLFNBQVMsRUFBRTtnQkFDcEIsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUN6QixFQUFFLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ2YsT0FBTzthQUNWO1NBQ0o7UUFHRCxJQUFJLEVBQUUsRUFBRTtZQUNKLE9BQU87WUFDUCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFOztvQkFDaEIsT0FBTyxHQUFHLElBQUk7O29CQUNkLFFBQVEsR0FBRyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksRUFBRSxDQUFDLFlBQVksRUFBRTtvQkFDakIsT0FBTyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDO29CQUNsQyxRQUFRLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7aUJBQ3ZDO3FCQUFNOzswQkFDRyxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQztvQkFDdEQsSUFBSSxPQUFPLEVBQUU7d0JBQ1QsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7d0JBQ3ZCLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO3FCQUM1QjtpQkFDSjtnQkFFRCxJQUFJLE9BQU8sRUFBRTtvQkFDVCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsRUFBRTt3QkFDdkMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQzt3QkFDckIsT0FBTztxQkFDVjtpQkFDSjtxQkFBTTtvQkFDSCxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztvQkFDakMsT0FBTztpQkFDVjthQUNKO1lBQ0QsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3pCLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO2dCQUNqRCxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUU7b0JBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFOzs7b0JBQUUsR0FBRyxFQUFFO3dCQUNyQixFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNwQixDQUFDLEVBQUMsQ0FBQztpQkFDTjtxQkFBTTtvQkFDSCxrQkFBa0I7b0JBQ2xCLElBQUksRUFBRSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO3dCQUN6RSxZQUFZLEVBQUUsQ0FBQztxQkFDbEI7eUJBQU07d0JBQ0gsbUJBQW1CO3dCQUNuQixJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLENBQUM7cUJBQy9DO2lCQUNKO2FBQ0o7aUJBQU07Z0JBQ0gsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFO29CQUNmLFlBQVksRUFBRSxDQUFDO2lCQUNsQjtxQkFBTTtvQkFDSCxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLDJCQUEyQixJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxLQUFLLE1BQU0sQ0FBQyxFQUFFO3dCQUM3RixJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDO3FCQUN4QjtvQkFDRCw2Q0FBNkM7b0JBQzdDLGtEQUFrRDtvQkFDbEQsTUFBTTtvQkFDTixVQUFVLEVBQUUsQ0FBQztpQkFDaEI7YUFDSjtTQUNKO0lBRUwsQ0FBQzs7Ozs7OztJQUlPLFVBQVUsQ0FBQyxJQUFpQixFQUFFLFFBQVE7UUFDMUMsSUFBSSxJQUFJLEVBQUU7O2tCQUNBLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYTs7a0JBQ3ZCLE9BQU8sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFFeEMsSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDVixPQUFPO2FBQ1Y7a0JBRUssRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQyxHQUFHLE9BQU87O2tCQUMzQixhQUFhLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO1lBQ2hELElBQUksQ0FBQyxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFNBQVM7Ozs7WUFBQyxDQUFDLENBQU0sRUFBRSxFQUFFO2dCQUMzRixJQUFJLENBQUMsRUFBRTtvQkFDSCxRQUFRLENBQUMsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDO2lCQUMvQjtZQUNMLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDOzs7WUFuckRKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsZUFBZTtnQkFDekIsa2hOQUFvQztnQkFDcEMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07YUFDbEQ7Ozs7WUFuQjhELFFBQVE7WUFBZ0MsY0FBYztZQVM1RyxpQkFBaUIsdUJBd0pqQixRQUFRO1lBbEtVLGlCQUFpQjtZQUF4QyxVQUFVOzs7MkJBaURULEtBQUs7MEJBQ0wsS0FBSzsyQkFDTCxLQUFLOzRCQUVMLEtBQUs7K0JBQ0wsS0FBSzs0QkFFTCxLQUFLO21CQUNMLEtBQUs7eUJBRUwsTUFBTTs0QkFFTixLQUFLOytCQUNMLEtBQUs7MEJBRUwsS0FBSzttQkFHTCxLQUFLO2lCQUdMLFNBQVMsU0FBQyxJQUFJOzJCQUNkLFNBQVMsU0FBQyxVQUFVOzJCQUNwQixTQUFTLFNBQUMsV0FBVzswQkFDckIsU0FBUyxTQUFDLFdBQVc7MkJBQ3JCLFNBQVMsU0FBQyxZQUFZO3VCQUN0QixTQUFTLFNBQUMsTUFBTTtrQ0FDaEIsU0FBUyxTQUFDLHFCQUFxQjs7OztJQXJEaEMseUNBQTBNOztJQUUxTSxvQ0FBWTs7SUFDWix1Q0FBZTs7SUFDZixzQ0FBYzs7SUFDZCwwQ0FBa0I7O0lBQ2xCLDJDQUFtQjs7SUFDbkIsK0NBQXVCOztJQUN2QixnREFBd0I7O0lBQ3hCLDBDQUFrQjs7SUFDbEIsMENBQWU7O0lBQ2YsMENBQWM7O0lBQ2QsMkNBQWU7O0lBQ2YsK0NBQW1COztJQUVuQiwyQ0FBZTs7Ozs7SUFDZixzREFBa0M7O0lBUWxDLDhDQUFrQjs7SUFDbEIsZ0RBQXdCOztJQUN4Qiw2Q0FBMEI7O0lBQzFCLDRDQUFxQjs7SUFDckIsNkNBQW1DOztJQUVuQyw4Q0FBMkI7O0lBQzNCLGlEQUE4Qjs7SUFFOUIsOENBQTJCOztJQUMzQixxQ0FBbUI7O0lBRW5CLDJDQUEwQzs7SUFFMUMsOENBQWdDOztJQUNoQyxpREFBNkM7O0lBRTdDLDRDQUEwQjs7Ozs7SUFHMUIscUNBQXNCOztJQUd0QixtQ0FBeUM7O0lBQ3pDLDZDQUF5Qzs7SUFDekMsNkNBQTBDOztJQUMxQyw0Q0FBZ0Q7O0lBQ2hELDZDQUFrRDs7SUFDbEQseUNBQXdDOztJQUN4QyxvREFBa0U7O0lBR2xFLG9EQUF5Qjs7SUFDekIsNkNBQXlCOzs7OztJQUV6QiwrQ0FBNEI7Ozs7O0lBYTVCLGtEQUF3Qzs7Ozs7SUFDeEMsc0RBQTRDOzs7OztJQUM1Qyw0REFBa0Q7Ozs7O0lBQ2xELG1EQUF5Qzs7Ozs7SUFDekMscURBQTJDOzs7OztJQUMzQyxtREFBeUM7Ozs7O0lBQ3pDLGtEQUF3Qzs7Ozs7SUFDeEMseURBQStDOzs7OztJQUMvQyxrREFBd0M7Ozs7O0lBQ3hDLG9EQUEwQzs7Ozs7SUFDMUMsdURBQTZDOzs7OztJQUU3Qyw4Q0FBMkI7O0lBRTNCLG9DQUFrQzs7SUFDbEMsb0NBQTRCOztJQUM1Qix1Q0FBc0I7O0lBQ3RCLHVDQUF5Qjs7Ozs7SUFHekIsMENBQWtCOztJQUNsQiwwQ0FBVTs7SUFDViw2Q0FBYTs7Ozs7SUFDYiw2Q0FBeUI7Ozs7O0lBQ3pCLDJDQUF1Qjs7Ozs7SUFDdkIsMENBQXVCOzs7OztJQUN2QixzREFBa0M7Ozs7O0lBQ2xDLHVEQUFtQzs7SUFDbkMsOENBQWtCOztJQUNsQiwrQ0FBbUI7O0lBQ25CLHFDQUFVOztJQUNWLCtDQUFtQjs7SUFDbkIsa0RBQXNCOztJQW1CdEIscURBQWdEOzs7OztJQUdoRCx3REFBdUM7Ozs7O0lBQ3ZDLHlDQUFpQzs7Ozs7SUFDakMsOENBQTZCOzs7OztJQUM3Qiw2Q0FBOEI7Ozs7O0lBQzlCLDhDQUErQjs7Ozs7SUFDL0IsbUNBQXlDOzs7OztJQUN6QyxvREFBcUM7Ozs7O0lBRXJDLGtEQUEwQzs7SUF3aUQxQyx3REFxREM7Ozs7O0lBMWxERyx5Q0FBMEI7Ozs7O0lBQzFCLG9DQUEyQjs7SUFDM0IsbUNBQXdDOzs7OztJQUN4QyxtQ0FBNkI7Ozs7O0lBQUUsbUNBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IHN3aXRjaE1hcCwgZGVsYXksIGRlYm91bmNlVGltZSwgdGFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgb2YsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IFJlc2l6ZU9ic2VydmVyIGZyb20gJ3Jlc2l6ZS1vYnNlcnZlci1wb2x5ZmlsbCc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShMdWNhcyBIdWFuZylcclxuICogQERhdGU6IDIwMTktMDgtMTIgMDc6NDc6MTJcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMjYgMTA6MjE6MjVcclxuICogQFFROiAxMDU1ODE4MjM5XHJcbiAqIEBWZXJzaW9uOiB2MC4wLjFcclxuICovXHJcbmltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgUmVuZGVyZXIyLFxyXG4gICAgRWxlbWVudFJlZiwgT25EZXN0cm95LCBDaGFuZ2VEZXRlY3RvclJlZiwgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCxcclxuICAgIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIE5nWm9uZSwgSW5qZWN0b3IsIGZvcndhcmRSZWYsIEluamVjdCwgT3B0aW9uYWwsIEFwcGxpY2F0aW9uUmVmLCBIb3N0TGlzdGVuZXIsIE91dHB1dCwgRXZlbnRFbWl0dGVyXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBEYXRhZ3JpZEZhY2FkZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC1mYWNhZGUuc2VydmljZSc7XHJcbmltcG9ydCB7IFNjcm9sbGJhckRpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL3Njcm9sbGJhci9zY3JvbGxiYXIuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgQ29sdW1uR3JvdXAgfSBmcm9tICcuLi8uLi90eXBlcyc7XHJcbmltcG9ydCB7IFNlbGVjdGVkUm93LCBEYXRhUmVzdWx0LCBST1dfSU5ERVhfRklFTEQsIElTX0dST1VQX1JPV19GSUVMRCwgR1JPVVBfUk9XX0ZJRUxELCBJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxELCBHUk9VUF9WSVNJQkxFX0ZJRUxEIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3RhdGUnO1xyXG5pbXBvcnQgeyBTQ1JPTExfWF9BQ1RJT04sIFNDUk9MTF9ZX0FDVElPTiwgU0NST0xMX1hfUkVBQ0hfU1RBUlRfQUNUSU9OLCBTQ1JPTExfWF9SRUFDSF9FTkRfQUNUSU9OLCBUUl9QUkVGSVgsIFdPUkRXUkFQX1JPV19IRUlHSFRfQ0xTIH0gZnJvbSAnLi4vLi4vdHlwZXMvY29uc3RhbnQnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kYXRhZ3JpZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBGb3JtYXRDZWxsRGF0YVBpcGUgfSBmcm9tICcuLi8uLi91dGlscy9mb3JtYXQtY2VsbC1kYXRhLnBpcGUnO1xyXG5pbXBvcnQgeyBDb2x1bW5Gb3JtYXRTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1jb21tb24vY29sdW1uJztcclxuaW1wb3J0IHsgQ29udGV4dE1lbnVJdGVtIH0gZnJvbSAnQGZhcnJpcy91aS1jb250ZXh0LW1lbnUnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdkYXRhZ3JpZC1ib2R5JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9ib2R5LmNvbXBvbmVudC5odG1sJyxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZEJvZHlDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBBZnRlclZpZXdDaGVja2VkIHtcclxuICAgIC8vIOiHquWKqOmrmOW6puaXtu+8jOemgeeUqOe6teWQkea7muWKqOadoVxyXG4gICAgcHNDb25maWcgPSB7IHN3aXBlRWFzaW5nOiBmYWxzZSwgbWluU2Nyb2xsYmFyTGVuZ3RoOiAxNSwgaGFuZGxlcnM6IFsnY2xpY2stcmFpbCcsICdkcmFnLXRodW1iJywgJ3doZWVsJywgJ3RvdWNoJ10sIHN1cHByZXNzU2Nyb2xsWTogdGhpcy5kZy5hdXRvSGVpZ2h0ICYmIHRoaXMuZGcubWF4SGVpZ2h0ID8gZmFsc2U6IHRoaXMuZGcuYXV0b0hlaWdodCB9O1xyXG5cclxuICAgIHRvcDogbnVtYmVyO1xyXG4gICAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgY29sc1dpZHRoOiBudW1iZXI7XHJcbiAgICB0b3RhbFdpZHRoOiBudW1iZXI7XHJcbiAgICBsZWZ0Rml4ZWRXaWR0aDogbnVtYmVyO1xyXG4gICAgcmlnaHRGaXhlZFdpZHRoOiBudW1iZXI7XHJcbiAgICByb3dIZWlnaHQ6IG51bWJlcjtcclxuICAgIGJvZHlTdHlsZTogYW55O1xyXG4gICAgc2Nyb2xsVG9wID0gMDtcclxuICAgIHNjcm9sbExlZnQgPSAwO1xyXG4gICAgZGVsdGFUb3BIZWlnaHQgPSAwO1xyXG4gICAgLy8gd2hlZWxIZWlnaHQgPSAwO1xyXG4gICAgd2hlZWxXaWR0aCA9IDA7XHJcbiAgICBwcml2YXRlIF9maXhlZFJpZ2h0U2Nyb2xsTGVmdCA9IDA7XHJcbiAgICBnZXQgZml4ZWRSaWdodFNjcm9sbExlZnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpeGVkUmlnaHRTY3JvbGxMZWZ0O1xyXG4gICAgfVxyXG4gICAgc2V0IGZpeGVkUmlnaHRTY3JvbGxMZWZ0KHZhbCkge1xyXG4gICAgICAgIHRoaXMuX2ZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdmFsO1xyXG4gICAgfVxyXG5cclxuICAgIG1heFNjcm9sbExlZnQgPSAwO1xyXG4gICAgc2hvd1JpZ2h0U2hhZG93ID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBmb290ZXJIZWlnaHQgPSAwO1xyXG4gICAgQElucHV0KCkgY2FudmFzV2lkdGg7XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zR3JvdXA6IENvbHVtbkdyb3VwO1xyXG4gICAgLy8g6Jma5ouf5Yqg6L29XHJcbiAgICBASW5wdXQoKSB0b3BIaWRlSGVpZ2h0ID0gMDtcclxuICAgIEBJbnB1dCgpIGJvdHRvbUhpZGVIZWlnaHQgPSAwO1xyXG5cclxuICAgIEBJbnB1dCgpIHN0YXJ0Um93SW5kZXggPSAwO1xyXG4gICAgQElucHV0KCkgZGF0YTogYW55O1xyXG5cclxuICAgIEBPdXRwdXQoKSBkYXRhQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIEBJbnB1dCgpIHNjcm9sbEJhck1vZGUgPSAnYXV0byc7XHJcbiAgICBASW5wdXQoKSBjb250ZXh0TWVudUl0ZW1zOiBDb250ZXh0TWVudUl0ZW1bXTtcclxuXHJcbiAgICBASW5wdXQoKSBjaGVja2VkUm93cyA9IFtdO1xyXG5cclxuICAgIC8qKiDmgKfog73kvJjljJbniYjvvIzpu5jorqTkuLogZmFsc2UgKi9cclxuICAgIEBJbnB1dCgpIGZhc3QgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgQFZpZXdDaGlsZCgncHMnKSBwcz86IFNjcm9sbGJhckRpcmVjdGl2ZTtcclxuICAgIEBWaWV3Q2hpbGQoJ21haW5Sb3dzJykgdGFibGVSb3dzQ21wOiBhbnk7XHJcbiAgICBAVmlld0NoaWxkKCdyaWdodFJvd3MnKSByaWdodFJvd3NDbXA6IGFueTtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpeGVkTGVmdCcpIGZpeGVkTGVmdEVsOiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZml4ZWRSaWdodCcpIGZpeGVkUmlnaHRFbDogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ21haW4nKSBtYWluQXJlYTogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGQoJ3ZpZXdTY3JvbGxDb250YWluZXInKSB2aWV3U2Nyb2xsQ29udGFpbmVyOiBFbGVtZW50UmVmO1xyXG5cclxuXHJcbiAgICB2aXNpYmxlQ29udGV4dE1lbnVzID0gW107XHJcbiAgICBjdXJyZW50Um93SWQgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgcHJpdmF0ZSBfaG92ZXJSb3dJbmRleCA9IC0xO1xyXG4gICAgZ2V0IGhvdmVyUm93SW5kZXgoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faG92ZXJSb3dJbmRleDtcclxuICAgIH1cclxuICAgIHNldCBob3ZlclJvd0luZGV4KHJvd0lkeDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5faG92ZXJSb3dJbmRleCA9IHJvd0lkeDtcclxuICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2VsZWN0ZWRSb3dzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRnLnNlbGVjdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBncmlkU2l6ZVN1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBjb2x1bW5SZXNpemVTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgb25EYXRhU291cmNlQ2hhbmdlU3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIHNlbGVjdFJvd1N1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSB1bnNlbGVjdFJvd1N1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBzZWxlY3RBbGxTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgY2hlY2tSb3dTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgY2xlYXJTZWxlY3Rpb25zU3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIGNoZWNrQWxsU3Vic2NyaWJlOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIHVuY2hlY2tSb3dTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgY2xlYXJDaGVja2Vkc1N1YnNjcmliZTogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIHByaXZhdGUgc3Vic2NyaXB0aW9ucyA9IFtdO1xyXG5cclxuICAgIHB1YmxpYyBkZnM6IERhdGFncmlkRmFjYWRlU2VydmljZTtcclxuICAgIHB1YmxpYyBkZ3M6IERhdGFncmlkU2VydmljZTtcclxuICAgIHB1YmxpYyBuZ1pvbmU6IE5nWm9uZTtcclxuICAgIHB1YmxpYyByZW5kZXI6IFJlbmRlcmVyMjtcclxuXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIHByaXZhdGUgdmlld3BvcnRIO1xyXG4gICAgdmlld3BvcnRXO1xyXG4gICAgY2FudmFzSGVpZ2h0O1xyXG4gICAgcHJpdmF0ZSBtaW5Sb3dCdWZmZXIgPSAzO1xyXG4gICAgcHJpdmF0ZSB2U2Nyb2xsRGlyID0gMTtcclxuICAgIHByaXZhdGUgcm93c0NhY2hlID0ge307XHJcbiAgICBwcml2YXRlIGxhc3RSZW5kZXJlZFNjcm9sbFRvcCA9IDA7XHJcbiAgICBwcml2YXRlIGxhc3RSZW5kZXJlZFNjcm9sbExlZnQgPSAwO1xyXG4gICAgcHJldlNjcm9sbFRvcCA9IDA7XHJcbiAgICBwcmV2U2Nyb2xsTGVmdCA9IDA7XHJcbiAgICByb3dzID0gW107XHJcbiAgICBibGFua1RvcEhlaWdodCA9IDA7XHJcbiAgICBibGFua0JvdHRvbUhlaWdodCA9IDA7XHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbiAgICBnZXQgc2Nyb2xsYmFyWEhlaWdodCgpIHtcclxuICAgICAgICBpZiAodGhpcy5kZyAmJiB0aGlzLnBzICYmIHRoaXMucHMuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgaCA9IHRoaXMuZGcuc2Nyb2xsQmFyU2hvd01vZGUgPT09ICdhbGx3YXlzJyAmJiB0aGlzLnBzLmluc3RhbmNlWydzY3JvbGxiYXJYQWN0aXZlJ10gPyAyMiA6IDA7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBzLmluc3RhbmNlWydzY3JvbGxiYXJZQWN0aXZlJ10gJiYgaCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGggKyAxODsgLy8gKyAodGhpcy5kZy5zaG93U2Nyb2xsQXJyb3cgJiYgdGhpcy5wcy5pbnN0YW5jZVsnc2Nyb2xsYmFyWUFjdGl2ZSddID8gMTggOiAwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgc2Nyb2xsYmFyWVdpZHRoKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmRnICYmIHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZy5zY3JvbGxCYXJTaG93TW9kZSA9PT0gJ2FsbHdheXMnICYmIHRoaXMucHMuaW5zdGFuY2VbJ3Njcm9sbGJhcllBY3RpdmUnXSAmJiB0aGlzLnNob3dSaWdodFNoYWRvdyA/IDE4IDogMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2VsbENvbnRlbnRGb3JtYXR0ZXI6IEZvcm1hdENlbGxEYXRhUGlwZSA9IG51bGw7XHJcblxyXG4gICAgLy8g5b2T5ZCv55So5aSa6YCJ5LiU5YWB6K645aSa6YCJ5Lit77yM5YiX6KGo5LiN6IO957yW6L6R5pe277yM5Y+W6YCJ5Lit5ZCO56aB5q2i6Kem5Y+RYm9keSDnmoRjbGljayDkuovku7ZcclxuICAgIHByaXZhdGUgX190cmlnZ2VyQm9keUNsaWNrRXZlbnQgPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBwcml2YXRlIF9vbk1vdXNlQ2xpY2sgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBfc2Nyb2xsVGltZXI6IGFueSA9IDA7XHJcbiAgICBwcml2YXRlIF9zY3JvbGxYVGltZXI6IGFueSA9IDA7XHJcbiAgICBwcml2YXRlIHJvOiBSZXNpemVPYnNlcnZlciB8IG51bGwgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSByZXNpemVPYnNlcnZlclRpbWVyOiBhbnkgPSAwO1xyXG5cclxuICAgIHByaXZhdGUgX2NsaWNrQ2VsbFdlYWtNYXAgPSBuZXcgV2Vha01hcCgpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgYXBwOiBBcHBsaWNhdGlvblJlZixcclxuICAgICAgICBAT3B0aW9uYWwoKSBwdWJsaWMgZGc6IERhdGFncmlkQ29tcG9uZW50LFxyXG4gICAgICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGVsOiBFbGVtZW50UmVmXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmRmcyA9IHRoaXMuaW5qZWN0b3IuZ2V0KERhdGFncmlkRmFjYWRlU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5kZ3MgPSB0aGlzLmluamVjdG9yLmdldChEYXRhZ3JpZFNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMubmdab25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgICAgICB0aGlzLnJlbmRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMik7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbHVtbkZvcm1hdFNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChDb2x1bW5Gb3JtYXRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmNlbGxDb250ZW50Rm9ybWF0dGVyID0gbmV3IEZvcm1hdENlbGxEYXRhUGlwZShjb2x1bW5Gb3JtYXRTZXJ2aWNlLCB0aGlzLmluamVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgdGhpcy5saXN0ZW5TdWJqZWN0cygpO1xyXG4gICAgICAgIHRoaXMuZGcuc2Nyb2xsSW5zdGFuY2UgPSB0aGlzLnBzO1xyXG4gICAgICAgIGNvbnN0IHMxID0gdGhpcy5kZ3Muc2hvd0dyaWRIZWFkZXIuc3Vic2NyaWJlKGhlYWRlckhlaWdodCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ29udGFpbmVyU2l6ZShoZWFkZXJIZWlnaHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMxKTtcclxuXHJcbiAgICAgICAgY29uc3QgczEwID0gdGhpcy5kZ3MuZm9vdGVyUG9zaXRpb25DaGFuZ2VkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ29udGFpbmVyU2l6ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMxMCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHMyID0gdGhpcy5kZ3Mucm93SGVpZ2h0Q2hhbmdlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzMik7XHJcblxyXG4gICAgICAgIGNvbnN0IHMzID0gdGhpcy5kZnMuY2xpZW50U29ydCQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja1Njcm9sbGJhclBvc2l0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAgICAgLy8gdGhpcy5kZy5jb2x1bW5Tb3J0ZWQuZW1pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMzKTtcclxuICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHM1ID0gdGhpcy5kZy5kZ3MuY29sdW1uc0NoYW5nZWQucGlwZShcclxuICAgICAgICAgICAgZGVsYXkoNTApXHJcbiAgICAgICAgKS5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZSAmJiBlLnNjcm9sbFRvTGVmdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsVG8oMCwgMCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBzLnNjcm9sbFRvTGVmdCgwLCAxMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goczUpO1xyXG4gICAgICAgXHJcbiAgICAgICAgdGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbk1vdXNlQ2xpY2sgPSAoZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9uTW91c2VDbGljayhlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCkge1xyXG4gICAgICAgICAgICB0aGlzLmRncy5kYXRhbG9hZGVkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJvd0hlaWdodCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVDb250YWluZXJTaXplKGhlYWRlckhlaWdodD86IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGhoID0gaGVhZGVySGVpZ2h0IHx8IHRoaXMuZGcucmVhbEhlYWRlckhlaWdodDtcclxuICAgICAgICB0aGlzLnNldFBvc2l0aW9uVG9wKGhoKTtcclxuICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMuZGcuaGVpZ2h0IC0gdGhpcy50b3A7XHJcbiAgICAgICAgdGhpcy5ib2R5U3R5bGUgPSB0aGlzLmdldEJvZHlTdHlsZSgpO1xyXG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5kYXRhICYmICFjaGFuZ2VzLmRhdGEuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYm9keVN0eWxlID0gdGhpcy5nZXRCb2R5U3R5bGUoKTtcclxuICAgICAgICAgICAgdGhpcy5kZnMuc2V0Q3VycmVudFBhZ2VEYXRhKGNoYW5nZXMuZGF0YS5jdXJyZW50VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgaXNEaWZmcmVudERhdGFTb3VyY2UgPSAhIWNoYW5nZXMuZGF0YS5jdXJyZW50VmFsdWUuZmlsdGVyKG4gPT4gIW5bJ19fZ3JvdXBfXyddKS5tYXAobiA9PiBuLmlkKS5maWx0ZXIobiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIWNoYW5nZXMuZGF0YS5wcmV2aW91c1ZhbHVlLmZpbHRlcihuID0+ICFuWydfX2dyb3VwX18nXSkuZmluZChwID0+IHAuaWQgPT09IG4pXHJcbiAgICAgICAgICAgIH0pLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGlzU2FtZUxlbmd0aCA9IGNoYW5nZXMuZGF0YS5jdXJyZW50VmFsdWUuZmlsdGVyKG4gPT4gIW5bJ19fZ3JvdXBfXyddKS5sZW5ndGggPj0gY2hhbmdlcy5kYXRhLnByZXZpb3VzVmFsdWUuZmlsdGVyKG4gPT4gIW5bJ19fZ3JvdXBfXyddKS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHRoaXMub25EYXRhQ2hhbmdlZChpc1NhbWVMZW5ndGgsIGlzRGlmZnJlbnREYXRhU291cmNlKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZSB8fCAhY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25Ub3AodGhpcy5kZy5yZWFsSGVhZGVySGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2hhbmdlcy5mb290ZXJIZWlnaHQgIT09IHVuZGVmaW5lZCAmJiAhY2hhbmdlcy5mb290ZXJIZWlnaHQuaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYm9keVN0eWxlID0gdGhpcy5nZXRCb2R5U3R5bGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFuZ2VzLnNjcm9sbEJhck1vZGUgIT09IHVuZGVmaW5lZCAmJiAhY2hhbmdlcy5zY3JvbGxCYXJNb2RlLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wcyAmJiB0aGlzLnBzLmluc3RhbmNlICYmIHRoaXMuc2Nyb2xsQmFyTW9kZSA9PT0gJ2FsbHdheXMnICYmIHRoaXMucHMuaW5zdGFuY2Uuc2Nyb2xsYmFyWUFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkV2lkdGggKz0gdGhpcy5zaG93UmlnaHRTaGFkb3cgPyAxOCA6IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0Rml4ZWRXaWR0aCA9IHRoaXMuY29sdW1uc0dyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnNjcm9sbEJhclNob3dNb2RlID09PSAnYWxsd2F5cycgJiYgdGhpcy5wcyAmJiB0aGlzLnBzLmluc3RhbmNlICYmIHRoaXMucHMuaW5zdGFuY2Uuc2Nyb2xsYmFyWEFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ibGFua0JvdHRvbUhlaWdodCArPSAyMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMuc2hvd1Njcm9sbEFycm93ICYmICFjaGFuZ2VzLnNob3dTY3JvbGxBcnJvdy5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgICAgICAgdGhpcy5wcyAmJiB0aGlzLnBzLnVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3kkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgdGhpcy5jZWxsQ29udGVudEZvcm1hdHRlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5kZy5zY3JvbGxJbnN0YW5jZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5kZXN0cm95U3Vic2NyaXB0aW9ucygpO1xyXG4gICAgICAgIHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25Nb3VzZUNsaWNrKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucm8pIHtcclxuICAgICAgICAgICAgdGhpcy5yby51bm9ic2VydmUodGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnJvLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnJlc2l6ZU9ic2VydmVyVGltZXIpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVzaXplT2JzZXJ2ZXJUaW1lcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5ybyA9IG5ldyBSZXNpemVPYnNlcnZlcigoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0UGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNpemVPYnNlcnZlclRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVzaXplT2JzZXJ2ZXJUaW1lcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZU9ic2VydmVyVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbEJhck1vZGUgPT09ICdhbGx3YXlzJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNldEZpeGVkUmlnaHRXaWR0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLnNjcm9sbGJhclVwZGF0ZS5lbWl0KHsgc2Nyb2xsYmFyUmVmOiB0aGlzLnBzLmluc3RhbmNlLCByaWdodFdpZHRoOiB0aGlzLnJpZ2h0Rml4ZWRXaWR0aCwgc2hvd1JpZ2h0U2hhZG93OiB0aGlzLnNob3dSaWdodFNoYWRvdyB9KTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5yby5vYnNlcnZlKHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQb3NpdGlvblRvcChoZWFkZXJIZWlnaHQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMudG9wID0gaGVhZGVySGVpZ2h0O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICgodGhpcy5kZy5lbmFibGVGaWx0ZXJSb3cgfHwgdGhpcy5kZy5lbmFibGVTbWFydEZpbHRlcikgJiYgdGhpcy5kZy5zaG93RmlsdGVyQmFyKSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9wICs9IHRoaXMuZGcuZmlsdGVyQmFySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2hvd1Jvd0dyb3VwUGFuZWwpIHtcclxuICAgICAgICAgICAgdGhpcy50b3AgKz0gdGhpcy5kZy5yb3dHcm91cFBhbmVsSGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0Zvb3RlciAmJiAodGhpcy5kZy5mb290ZXJQb3NpdGlvbiA9PT0gJ3RvcCcgfHwgdGhpcy5kZy5mb290ZXJQb3NpdGlvbiA9PT0gJ2JvdGgnKSkge1xyXG4gICAgICAgICAgICAvLyBoZWFkZXJIZWlnaHQg5bey5YyF5ous6L+H5ruk6KGM55qE6auY5bqmIHRmcyA1NDI0NzFcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvcCArPSB0aGlzLmRnLmZvb3RlckhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNoZWNrU2Nyb2xsYmFyUG9zaXRpb24odG9Ub3AgPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5kZy5kYXRhIHx8ICF0aGlzLmRnLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsQmFyOiBhbnkgPSB0aGlzLnBzLmluc3RhbmNlO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbEVsUmVmID0gdGhpcy5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgLy8gc2Nyb2xsQmFyLnVwZGF0ZSgpO1xyXG4gICAgICAgIGNvbnN0IGxhc3RTY3JvbGxMZWZ0ID0gc2Nyb2xsQmFyID8gc2Nyb2xsQmFyLmxhc3RTY3JvbGxMZWZ0IDogMDtcclxuICAgICAgICBjb25zdCBsYXN0U2Nyb2xsVG9wID0gc2Nyb2xsQmFyID8gc2Nyb2xsQmFyLmxhc3RTY3JvbGxUb3AgOiAwO1xyXG5cclxuICAgICAgICAvLyBjb25zdCBsYXN0U2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcclxuICAgICAgICAvLyBjb25zdCBsYXN0U2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XHJcblxyXG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHNjcm9sbEVsUmVmLnNjcm9sbFRvcDtcclxuICAgICAgICBjb25zdCBzY3JvbGxMZWZ0ID0gc2Nyb2xsRWxSZWYuc2Nyb2xsTGVmdDtcclxuXHJcbiAgICAgICAgaWYgKCF0b1RvcCkge1xyXG4gICAgICAgICAgICBpZiAoc2Nyb2xsVG9wICE9IGxhc3RTY3JvbGxUb3ApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHMuc2Nyb2xsVG9Ub3AobGFzdFNjcm9sbFRvcCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRncy5vblNjcm9sbE1vdmUobGFzdFNjcm9sbFRvcCwgU0NST0xMX1lfQUNUSU9OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucHMuc2Nyb2xsVG9Ub3AoKTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Mub25TY3JvbGxNb3ZlKGxhc3RTY3JvbGxUb3AsIFNDUk9MTF9ZX0FDVElPTik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSBsYXN0U2Nyb2xsTGVmdDtcclxuICAgICAgICBpZiAoc2Nyb2xsTGVmdCAhPSBsYXN0U2Nyb2xsTGVmdCkge1xyXG4gICAgICAgICAgICB0aGlzLnBzLnNjcm9sbFRvWChsYXN0U2Nyb2xsTGVmdCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZShsYXN0U2Nyb2xsTGVmdCwgU0NST0xMX1hfQUNUSU9OKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAobGFzdFNjcm9sbExlZnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZShsYXN0U2Nyb2xsTGVmdCwgU0NST0xMX1hfQUNUSU9OKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaVsOaNruWPkeeUn+WPmOWMlu+8jOmHjeaWsOWKoOi9veaVsOaNruaXtuaJp+ihjFxyXG4gICAgICog6YeN572u5rua5Yqo5p2h5L2N572uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgb25EYXRhQ2hhbmdlZChpc1NhbWVMZW5ndGggPSB0cnVlLCBpc0RpZmZyZW50RGF0YVNvdXJjZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5kZy5zZXRQYWdlckhlaWdodCgpO1xyXG4gICAgICAgIHRoaXMudmlld3BvcnRIID0gdGhpcy5nZXRWaWV3UG9ydEhlaWdodCgpO1xyXG4gICAgICAgIHRoaXMuYm9keVN0eWxlID0gdGhpcy5nZXRCb2R5U3R5bGUoKTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogdXBkYXRlOlxyXG4gICAgICAgICAqIG5vZGVfbW9kdWxlc1xccGVyZmVjdC1zY3JvbGxiYXJcXHR5cGVzXFxwZXJmZWN0LXNjcm9sbGJhci5kLnRzXHJcbiAgICAgICAgICogbGFzdFNjcm9sbFRvcDogbnVtYmVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgaWYgKHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSAmJiAhdGhpcy5kZy5pc0VkaXRpbmcoKSAmJiAhdGhpcy5kZy5jbGllbnRGaWx0ZXJDaGFuZ2VkICYmICF0aGlzLmRnLmF1dG9IZWlnaHQgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gMDtcclxuICAgICAgICAgICAgdGhpcy5sYXN0UmVuZGVyZWRTY3JvbGxUb3AgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnBzLnNjcm9sbFRvVG9wKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IDA7XHJcbiAgICAgICAgICAgIHRoaXMucHMuc2Nyb2xsVG9MZWZ0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJvd3NDYWNoZSA9IHt9O1xyXG4gICAgICAgIGNvbnN0IGtlZXBzY3JvbGxQb3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjcm9sbEluZm8gPSB0aGlzLmRnLmRmcy5nZXRTdGF0ZSgpLnNjcm9sbEluZm87XHJcbiAgICAgICAgICAgIGlmIChzY3JvbGxJbmZvICkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjcm9sbEluZm8ueSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gc2Nyb2xsSW5mby55O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2Nyb2xsSW5zdGFuY2Uuc2Nyb2xsVG9ZKHNjcm9sbEluZm8ueSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ3Mub25TY3JvbGxNb3ZlKHNjcm9sbEluZm8ueSwgU0NST0xMX1lfQUNUSU9OKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsSW5mby54KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gc2Nyb2xsSW5mby54O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2Nyb2xsSW5zdGFuY2Uuc2Nyb2xsVG9YKHNjcm9sbEluZm8ueCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5kZ3Mub25TY3JvbGxNb3ZlKHNjcm9sbEluZm8ueCwgU0NST0xMX1hfQUNUSU9OKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5ub3dyYXAgfHwgdGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRGF0YShmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLmNlbGxDb250ZW50V3JhcENoYW5nZWQubmV4dCh0aGlzLndpZHRoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoaXNTYW1lTGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBrZWVwc2Nyb2xsUG9zKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJEYXRhKGZhbHNlKTtcclxuICAgICAgICAgICAgdGhpcy5wcy51cGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKGlzRGlmZnJlbnREYXRhU291cmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcuaW5pdFNlbGVjdE9yQ2hlY2tlZCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGcucmVmcmVzaFNlbGVjdGVkRGF0YSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRnLmNsaWVudEZpbHRlckNoYW5nZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRhdGFDaGFuZ2UuZW1pdCh0aGlzLmRhdGEpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5zY3JvbGxCYXJTaG93TW9kZSA9PT0gJ2FsbHdheXMnICYmIHRoaXMucHMuaW5zdGFuY2UgJiYgIXRoaXMuZGcuc2hvd1Njcm9sbEFycm93KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFzWVNjcm9sbGJhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRlc3Ryb3lTdWJzY3JpcHRpb25zKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnMgJiYgdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaCgoc3ViOiBTdWJzY3JpcHRpb24pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzdWIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzdWIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxpc3RlblN1YmplY3RzKCkge1xyXG4gICAgICAgIHRoaXMuZGVzdHJveVN1YnNjcmlwdGlvbnMoKTtcclxuXHJcbiAgICAgICAgdGhpcy5ncmlkU2l6ZVN1YnNjcmliZSA9IHRoaXMuZGZzLmdyaWRTaXplJC5waXBlKFxyXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICApLnBpcGUoXHJcbiAgICAgICAgICAgIGRlYm91bmNlVGltZSg1MClcclxuICAgICAgICApLnN1YnNjcmliZShzdGF0ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5zZXRQYWdlckhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGggPSB0aGlzLmRnLnNldEhlYWRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblRvcChoaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBzdGF0ZS5oZWlnaHQgLSB0aGlzLnRvcDtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRXaWR0aCA9IHRoaXMud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gTWF0aC5mbG9vcihzdGF0ZS53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvd0hlaWdodCA9IHN0YXRlLnJvd0hlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5zaG93Qm9yZGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53aWR0aCAtPSAyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudmlld3BvcnRXID0gdGhpcy53aWR0aDtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld3BvcnRIID0gdGhpcy5nZXRWaWV3UG9ydEhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSB0aGlzLmdldENhbnZhc0hlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbnNHcm91cCA9IHN0YXRlLmNvbHVtbnNHcm91cDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrU2Nyb2xsYmFyUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnNldEZpeGVkUmlnaHRQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29sdW1uU2l6ZShzdGF0ZS5jb2x1bW5zR3JvdXApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRncy5zaG93Rml4ZWRTaGFkb3cuZW1pdCh7IHNob3dSaWdodFNoYWRvdzogdGhpcy5zaG93UmlnaHRTaGFkb3csIHg6IHRoaXMuZml4ZWRSaWdodFNjcm9sbExlZnQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJEYXRhKGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCghdGhpcy5kZy5ub3dyYXAgfHwgdGhpcy5kZy5hdXRvSGVpZ2h0KSAmJiB0aGlzLnJvd3MgJiYgdGhpcy5yb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkV2lkdGggIT09IHRoaXMud2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGdzLmNlbGxDb250ZW50V3JhcENoYW5nZWQubmV4dChvbGRXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmtlZXBTY3JvbGxiYXJQb3NpdGlvbihvbGRXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2Nyb2xsWFRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fc2Nyb2xsWFRpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2Nyb2xsWFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmtlZXBTY3JvbGxiYXJQb3NpdGlvbihvbGRXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuZ3JpZFNpemVTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbHVtblJlc2l6ZVN1YnNjcmliZSA9IHRoaXMuZGZzLmNvbHVtblJlc2l6ZSQuc3Vic2NyaWJlKChjZzogQ29sdW1uR3JvdXApID0+IHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVDb2x1bW5TaXplKGNnKTtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5jb2x1bW5SZXNpemVTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5zZXRTZWxlY2VkUm93LnN1YnNjcmliZSgocjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyICYmIHIuc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJvd0lkID0gci5pZDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJvd0lkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RSb3dTdWJzY3JpYmUgPSB0aGlzLmRmcy5zZWxlY3RSb3ckLnN1YnNjcmliZSgocm93OiBTZWxlY3RlZFJvdykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocm93KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRSb3dJZCA9IHJvdy5pZDtcclxuICAgICAgICAgICAgICAgIC8vIDIwMjEwODE3IOaWueWQkemUruenu+WKqOWQjuWIt+aWsOinhuWbvueKtuaAgVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLnNlbGVjdFJvd1N1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMudW5zZWxlY3RSb3dTdWJzY3JpYmUgPSB0aGlzLmRmcy51blNlbGVjdFJvdyQuc3Vic2NyaWJlKChwcmV2Um93OiBTZWxlY3RlZFJvdykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocHJldlJvdyAmJiBwcmV2Um93LmlkID09PSB0aGlzLmN1cnJlbnRSb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Um93SWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnNlbGVjdGVkUm93ID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX190cmlnZ2VyQm9keUNsaWNrRXZlbnQgPSB0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0JztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy51bnNlbGVjdFJvd1N1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2VsZWN0QWxsU3Vic2NyaWJlID0gdGhpcy5kZnMuc2VsZWN0QWxsJC5zdWJzY3JpYmUoKHJvd3M6IFNlbGVjdGVkUm93W10pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5kZy5zZWxlY3RBbGwuZW1pdChyb3dzKTtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5zZWxlY3RBbGxTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLmNoZWNrUm93U3Vic2NyaWJlID0gdGhpcy5kZnMuY2hlY2tSb3ckLnN1YnNjcmliZSgocm93OiBTZWxlY3RlZFJvdykgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmNoZWNrZWQuZW1pdChyb3cpO1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWRSb3dzQ2hhbmdlZCgpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmNoZWNrUm93U3Vic2NyaWJlKTtcclxuXHJcbiAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbnNTdWJzY3JpYmUgPSB0aGlzLmRmcy5jbGVhclNlbGVjdGlvbnMkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJvd0lkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5jaGVja09uU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWRSb3dzQ2hhbmdlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZGcudW5TZWxlY3RBbGwuZW1pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuY2xlYXJTZWxlY3Rpb25zU3Vic2NyaWJlKTtcclxuXHJcbiAgICAgICAgdGhpcy51bmNoZWNrUm93U3Vic2NyaWJlID0gdGhpcy5kZnMudW5DaGVja1JvdyQuc3Vic2NyaWJlKChwcmV2Um93OiBTZWxlY3RlZFJvdykgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRnLnVuQ2hlY2tlZC5lbWl0KHByZXZSb3cpO1xyXG4gICAgICAgICAgICB0aGlzLmNoZWNrZWRSb3dzQ2hhbmdlZCgpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLnVuY2hlY2tSb3dTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLmNoZWNrQWxsU3Vic2NyaWJlID0gdGhpcy5kZnMuY2hlY2tBbGwkLnN1YnNjcmliZSgocm93czogU2VsZWN0ZWRSb3dbXSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmNoZWNrQWxsLmVtaXQocm93cyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFJvd3NDaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuY2hlY2tBbGxTdWJzY3JpYmUpO1xyXG5cclxuICAgICAgICB0aGlzLmNsZWFyQ2hlY2tlZHNTdWJzY3JpYmUgPSB0aGlzLmRmcy5jbGVhckNoZWNrZWRzJC5zdWJzY3JpYmUoKHJvd3M6IFNlbGVjdGVkUm93W10pID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuc2VsZWN0T25DaGVjaykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Um93SWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5kZy51bkNoZWNrQWxsLmVtaXQocm93cyk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFJvd3NDaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuY2xlYXJDaGVja2Vkc1N1YnNjcmliZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuZGdzLnNldFNjcm9sbGJhclBvc2l0aW9uLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tTY3JvbGxiYXJQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNjcm9sbFBvc2l0aW9uKHRoaXMuc2Nyb2xsTGVmdCk7XHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICB0aGlzLmRncy5jb2x1bW5SZXNpemVkLnBpcGUoXHJcbiAgICAgICAgICAgIGRlbGF5KDEwMClcclxuICAgICAgICApLnN1YnNjcmliZSgoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5ub3dyYXAgfHxcclxuICAgICAgICAgICAgICAgICh0aGlzLmRnLmN1cnJlbnRDZWxsICYmIHRoaXMuZGcuY3VycmVudENlbGwuaXNFZGl0aW5nICYmIHRoaXMuZGcuY3VycmVudENlbGwuY29sdW1uICYmXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5jdXJyZW50Q2VsbC5jb2x1bW4uZWRpdG9yICYmIHRoaXMuZGcuY3VycmVudENlbGwuY29sdW1uLmVkaXRvci50eXBlID09PSAndGV4dGFyZWEnKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJkb21zID0gdGhpcy5kZy5kZ0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mLWRhdGFncmlkLWJvZHktcm93Om5vdCguZi1kYXRhZ3JpZC1mb290ZXItcm93KScpO1xyXG4gICAgICAgICAgICAgICAgdHJkb21zLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuc2V0U3R5bGUobiwgJ2hlaWdodCcsICdhdXRvJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgdHJJRCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgaWYgKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dJZCA9IGUuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJJRCA9IFRSX1BSRUZJWCArIHJvd0lkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm93SGVpZ2h0KHRySUQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5oZWFkZXJXcmFwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLnNldEhlYWRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZnMuY29sdW1uUmVzaXplRW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGdzLmNlbGxDb250ZW50V3JhcENoYW5nZWQucGlwZShcclxuICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpLFxyXG4gICAgICAgICAgICBkZWJvdW5jZVRpbWUoMTAwKVxyXG4gICAgICAgICkuc3Vic2NyaWJlKChvbGRXaWR0aDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUm93SGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIGlmIChvbGRXaWR0aCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmtlZXBTY3JvbGxiYXJQb3NpdGlvbihvbGRXaWR0aCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBzICYmIHRoaXMucHMuaW5zdGFuY2UgJiYgdGhpcy5wcy5pbnN0YW5jZS51cGRhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5kZy5kZnMucm93VXBkYXRlJC5zdWJzY3JpYmUoKHJvdzogeyBpbmRleDogbnVtYmVyLCBkYXRhOiBhbnkgfSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocm93ICYmIHJvdy5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkQ3VzdG9tQ2VsbFN0eWxlKHJvdyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGZzLmV4cGFuZEdyb3VwUm93LnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoKGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgJiYgZS5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm91cFJvd1N0YXRlQ2hhbmdlZChlLmRhdGEsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge3RoaXMudXBkYXRlUm93SGVpZ2h0KCk7fSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy5jb2xsYXBzZUdyb3VwUm93LnBpcGUoXHJcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5kZXN0cm95JClcclxuICAgICAgICAgICAgKS5zdWJzY3JpYmUoKGU6IGFueSkgPT57XHJcbiAgICAgICAgICAgICAgICBpZiAoZSAmJiBlLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyb3VwUm93U3RhdGVDaGFuZ2VkKGUuZGF0YSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBncm91cFJvd0V4cGFuZFVwZGF0ZShncm91cFJvdywgaXNFeHBhbmQpIHtcclxuICAgICAgICBpZiAoZ3JvdXBSb3cucm93cyAmJiBncm91cFJvdy5yb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBncm91cFJvdy5yb3dzLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAobltJU19HUk9VUF9GT09URVJfUk9XX0ZJRUxEXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5maWx0ZXIodCA9PiB0W0dST1VQX1JPV19GSUVMRF0gPT09IG5bR1JPVVBfUk9XX0ZJRUxEXSkuZm9yRWFjaChkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZFtHUk9VUF9WSVNJQkxFX0ZJRUxEXSA9IGlzRXhwYW5kICYmIGdyb3VwUm93LmV4cGFuZGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhLmZpbmQoZSA9PiBlLmlkID09PSBuLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtW0dST1VQX1ZJU0lCTEVfRklFTERdID0gaXNFeHBhbmQgJiYgZ3JvdXBSb3cuZXhwYW5kZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnJvd3MgJiYgaXRlbS5yb3dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm91cFJvd0V4cGFuZFVwZGF0ZShpdGVtLCBpc0V4cGFuZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUgZ3JvdXBSb3dTdGF0ZUNoYW5nZWQocm93RGF0YSwgZXhwYW5kOiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcudmlydHVhbGl6ZWQpIHtcclxuICAgICAgICAgICAgY29uc3QgZ3IgPSB0aGlzLmRhdGEuZmluZChuID0+IG4uaWQgPT09IHJvd0RhdGEuaWQpO1xyXG4gICAgICAgICAgICB0aGlzLmdyb3VwUm93RXhwYW5kVXBkYXRlKGdyLCBleHBhbmQpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckRhdGEoZmFsc2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q2FudmFzSGVpZ2h0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpc1snX3BzVXBkYXRlVGltZXJfJ10pIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXNbJ19wc1VwZGF0ZVRpbWVyXyddKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXNbJ19wc1VwZGF0ZVRpbWVyXyddID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucHMudXBkYXRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH0sIDEwMClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGtlZXBTY3JvbGxiYXJQb3NpdGlvbihvbGRXaWR0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNkW1wiZGVzdHJveWVkXCJdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLnBzLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjsgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzW1wia2VlcFNjcm9sbGJhclBvc2l0aW9uVElNRVJcIl0pIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXNbXCJrZWVwU2Nyb2xsYmFyUG9zaXRpb25USU1FUlwiXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzW1wia2VlcFNjcm9sbGJhclBvc2l0aW9uVElNRVJcIl0gPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMud2lkdGggPiBvbGRXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuc2Nyb2xsTGVmdCAtICh0aGlzLndpZHRoIC0gb2xkV2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA9IHggPCAwID8gMCA6IHg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCB8fCB0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wcy51cGRhdGUoKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVTY3JvbGxQb3NpdGlvbih0aGlzLnBzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0KTtcclxuICAgICAgICAgICAgdGhpcy5kZ3Muc2Nyb2xsYmFyVXBkYXRlLmVtaXQoeyBzY3JvbGxiYXJSZWY6IHRoaXMucHMuaW5zdGFuY2UsIHJpZ2h0V2lkdGg6IHRoaXMucmlnaHRGaXhlZFdpZHRoLCBzaG93UmlnaHRTaGFkb3c6IHRoaXMuc2hvd1JpZ2h0U2hhZG93ICB9KTtcclxuICAgICAgICB9LCA1MCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlQ29sdW1uU2l6ZShjZzogQ29sdW1uR3JvdXApIHtcclxuICAgICAgICBpZiAoY2cpIHtcclxuICAgICAgICAgICAgdGhpcy5jb2x1bW5zR3JvdXAgPSBjZztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMubGVmdEZpeGVkV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5sZWZ0Rml4ZWRXaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5jb2xzV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5ub3JtYWxXaWR0aDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IHRoaXMucHMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgIHRoaXMubWF4U2Nyb2xsTGVmdCA9IHRoaXMuY29sc1dpZHRoICsgdGhpcy5sZWZ0Rml4ZWRXaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCA9IHRoaXMubWF4U2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgLy8gZ3JpZCDlrrnlmajlrr3luqZcclxuICAgICAgICAgICAgY29uc3QgZGdDb250YWluZXJXaWR0aCA9IHRoaXMuZGcuZGdDb250YWluZXIubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgICAgICAgICAgLy8g5omA5pyJ5YiX5a695LmL5ZKMXHJcbiAgICAgICAgICAgIGNvbnN0IGFsbENvbHNXaWR0aCA9IE1hdGguZmxvb3IodGhpcy5jb2x1bW5zR3JvdXAudG90YWxXaWR0aCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmJvZHlTdHlsZSA9IHRoaXMuZ2V0Qm9keVN0eWxlKCk7XHJcbiAgICAgICAgICAgIGlmIChkZ0NvbnRhaW5lcldpZHRoID4gYWxsQ29sc1dpZHRoIHx8IGRnQ29udGFpbmVyV2lkdGggPT09IGFsbENvbHNXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93UmlnaHRTaGFkb3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JpZ2h0U2hhZG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vIOWPs+S+p+WbuuWumuWIl+eahOS9jee9rlxyXG4gICAgICAgICAgICAgICAgdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCA9IHRoaXMud2lkdGggICsgdGhpcy5zY3JvbGxMZWZ0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Rml4ZWRSaWdodFdpZHRoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Rml4ZWRSaWdodFdpZHRoKCkge1xyXG4gICAgICAgIHRoaXMucmlnaHRGaXhlZFdpZHRoID0gdGhpcy5jb2x1bW5zR3JvdXAucmlnaHRGaXhlZFdpZHRoO1xyXG4gICAgICAgIHRoaXMudG90YWxXaWR0aCA9IHRoaXMuY29sdW1uc0dyb3VwLnRvdGFsV2lkdGg7XHJcbiAgICAgICAgaWYgKHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSAmJiB0aGlzLmRnLnNjcm9sbEJhclNob3dNb2RlID09PSAnYWxsd2F5cycpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHMuaW5zdGFuY2Uuc2Nyb2xsYmFyWUFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yaWdodEZpeGVkV2lkdGggKz0gMTg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEN1c3RvbUNlbGxTdHlsZShyb3c6IHsgaW5kZXg6IG51bWJlciwgZGF0YTogYW55IH0pIHtcclxuXHJcbiAgICAgICAgbGV0IHJpZ2h0VHJzID0gW107XHJcbiAgICAgICAgbGV0IGxlZnRUcnMgPSBbXTtcclxuICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgcmlnaHRUcnMgPSB0aGlzLmZpeGVkUmlnaHRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5maXhlZExlZnRFbCkge1xyXG4gICAgICAgICAgICBsZWZ0VHJzID0gdGhpcy5maXhlZExlZnRFbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maXhlZC1sZWZ0LXJvdycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHJzID0gdGhpcy5tYWluQXJlYS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyLmYtZGF0YWdyaWQtYm9keS1yb3cnKTtcclxuXHJcbiAgICAgICAgY29uc3QgdXBkYXRlQ2VsbFN0eWxlID0gKGFyciwgY29sLCBzdHlsZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGQgPSBhcnJbcm93LmluZGV4XS5xdWVyeVNlbGVjdG9yKGBbZmllbGQ9XCIke2NvbC5maWVsZH1cIl1gKTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcucmVuZGVyQ3VzdG9tU3R5bGUoc3R5bGUsIHRkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZGcuZmxhdENvbHVtbnMuZm9yRWFjaChjb2wgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY29sLnN0eWxlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgX3JkID0gcm93LmRhdGE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSBVdGlscy5nZXRWYWx1ZShjb2wuZmllbGQsIF9yZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjcyA9IGNvbC5zdHlsZXIodmFsLCBfcmQsIHJvdy5pbmRleCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3MgJiYgT2JqZWN0LmtleXMoY3MpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNlbGxTdHlsZShsZWZ0VHJzLCBjb2wsIGNzKTtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVDZWxsU3R5bGUocmlnaHRUcnMsIGNvbCwgY3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNlbGxTdHlsZSh0cnMsIGNvbCwgY3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja2VkUm93c0NoYW5nZWQoKSB7XHJcbiAgICAgICAgdGhpcy5kZ3Mub25DaGVja2VkUm93c0NvdW50Q2hhbmdlKCk7XHJcbiAgICAgICAgY29uc3QgY2hlY2tlZFJvd3MgPSB0aGlzLmRnLmNoZWNrZWRzO1xyXG4gICAgICAgIHRoaXMuZGcuY2hlY2tWYWx1ZXMgPSBjaGVja2VkUm93cy5tYXAociA9PiByLmlkKTtcclxuICAgICAgICB0aGlzLmRnLmNoZWNrVmFsdWVzQ2hhbmdlLmVtaXQodGhpcy5kZy5jaGVja1ZhbHVlcyk7XHJcbiAgICAgICAgdGhpcy5kZy5jaGVja2VkQ2hhbmdlLmVtaXQoY2hlY2tlZFJvd3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VHJEb21IZWlnaHQoKSB7XHJcbiAgICAgICAgY29uc3QgbGlzdCA9IFtdO1xyXG4gICAgICAgIGxldCByaWdodFRycyA9IFtdO1xyXG4gICAgICAgIGxldCBsZWZ0VHJzID0gW107XHJcbiAgICAgICAgbGV0IHRyZG9tcyA9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkUmlnaHRFbCkge1xyXG4gICAgICAgICAgICByaWdodFRycyA9IHRoaXMuZml4ZWRSaWdodEVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgndHInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkTGVmdEVsKSB7XHJcbiAgICAgICAgICAgIGxlZnRUcnMgPSB0aGlzLmZpeGVkTGVmdEVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpeGVkLWxlZnQtcm93Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5tYWluQXJlYSkge1xyXG4gICAgICAgICAgICB0cmRvbXMgPSB0aGlzLm1haW5BcmVhLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgndHIuZi1kYXRhZ3JpZC1ib2R5LXJvdycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cmRvbXMuZm9yRWFjaCgodHIsIGkpID0+IHtcclxuICAgICAgICAgICAgbGV0IHQxID0gMDtcclxuICAgICAgICAgICAgY29uc3QgdDIgPSBNYXRoLmNlaWwodHIub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgbGV0IHQzID0gMDtcclxuICAgICAgICAgICAgaWYgKGxlZnRUcnMgJiYgbGVmdFRycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHQxID0gTWF0aC5jZWlsKGxlZnRUcnNbaV0ub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHJpZ2h0VHJzICYmIHJpZ2h0VHJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdDMgPSBNYXRoLmNlaWwocmlnaHRUcnNbaV0ub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgX2ggPSBNYXRoLm1heCh0MSwgdDIsIHQzLCB0aGlzLmRnLnJvd0hlaWdodCk7XHJcbiAgICAgICAgICAgIGxpc3QucHVzaChfaCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHVwZGF0ZVJvd0hlaWdodDIoKSB7XHJcbiAgICAgICAgbGV0IHJpZ2h0VHJzID0gW107XHJcbiAgICAgICAgbGV0IGxlZnRUcnMgPSBbXTtcclxuICAgICAgICBsZXQgdHJkb21zID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuZml4ZWRSaWdodEVsKSB7XHJcbiAgICAgICAgICAgIHJpZ2h0VHJzID0gdGhpcy5maXhlZFJpZ2h0RWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0cicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZml4ZWRMZWZ0RWwpIHtcclxuICAgICAgICAgICAgbGVmdFRycyA9IHRoaXMuZml4ZWRMZWZ0RWwubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZml4ZWQtbGVmdC1yb3cnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1haW5BcmVhKSB7XHJcbiAgICAgICAgICAgIHRyZG9tcyA9IHRoaXMubWFpbkFyZWEubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0ci5mLWRhdGFncmlkLWJvZHktcm93Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0cmRvbXMuZm9yRWFjaCgodHI6IGFueSwgaSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZVJvd0hlaWdodENscyh0cik7XHJcbiAgICAgICAgICAgIGlmIChsZWZ0VHJzICYmIGxlZnRUcnNbaV0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUm93SGVpZ2h0Q2xzKGxlZnRUcnNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyaWdodFRycyAmJiByaWdodFRyc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVSb3dIZWlnaHRDbHMocmlnaHRUcnNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzWydVUERBVEVfUk9XX0hFSUdIVF9USU1FUiddKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzWydVUERBVEVfUk9XX0hFSUdIVF9USU1FUiddKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXNbJ1VQREFURV9ST1dfSEVJR0hUX1RJTUVSJ10gPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdHJkb21zLmZvckVhY2goKHRyLCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdDEgPSAwO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdDIgPSBNYXRoLmNlaWwodHIub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIGxldCB0MyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGxlZnRUciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmlnaHRUciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAobGVmdFRycyAmJiBsZWZ0VHJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQxID0gTWF0aC5jZWlsKGxlZnRUcnNbaV0ub2Zmc2V0SGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0VHIgPSBsZWZ0VHJzW2ldXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJpZ2h0VHJzICYmIHJpZ2h0VHJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHQzID0gTWF0aC5jZWlsKHJpZ2h0VHJzW2ldLm9mZnNldEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRUciA9IHJpZ2h0VHJzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IF9oID0gTWF0aC5tYXgodDEsIHQyLCB0MywgdGhpcy5kZy5yb3dIZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kZy5ub3dyYXAgfHwgdGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0Q2xzTmFtZSA9IFdPUkRXUkFQX1JPV19IRUlHSFRfQ0xTICsgJ18nICsgX2g7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluUm93SGVpZ2h0Q2xzTmFtZSA9ICdtaW5fcm93X2hlaWdodF8nICsgdGhpcy5yb3dIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgX2FkZFJvd0hlaWdodENsc1RvRG9tID0gKHRyZG9tKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUm93SGVpZ2h0Q2xzKHRyZG9tKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModHJkb20sIGhlaWdodENsc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0cmRvbSwgbWluUm93SGVpZ2h0Q2xzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFJvd0hlaWdodENscyhoZWlnaHRDbHNOYW1lLCBfaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIF9hZGRSb3dIZWlnaHRDbHNUb0RvbSh0cik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsZWZ0VHIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2FkZFJvd0hlaWdodENsc1RvRG9tKGxlZnRUcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmlnaHRUcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfYWRkUm93SGVpZ2h0Q2xzVG9Eb20ocmlnaHRUcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlUm93SGVpZ2h0Q2xzKHRyKSB7XHJcbiAgICAgICAgaWYgKCF0cikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IF9jbHMgPSBBcnJheS5mcm9tKHRyLmNsYXNzTGlzdCkuZmluZCgobjogc3RyaW5nKSA9PiBuLmluZGV4T2YoV09SRFdSQVBfUk9XX0hFSUdIVF9DTFMpID4gLTEpO1xyXG4gICAgICAgIGlmIChfY2xzKSB7XHJcbiAgICAgICAgICAgIHRyLmNsYXNzTGlzdC5yZW1vdmUoX2Nscyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYWRkUm93SGVpZ2h0Q2xzKGhlaWdodENsc05hbWU6IHN0cmluZywgX2g6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuZGdzLnJlbW92ZUNzc1J1bGUoYCR7dGhpcy5kZy5jdXN0b21TdHlsZUtleSgpfSAuJHtoZWlnaHRDbHNOYW1lfWApO1xyXG4gICAgICAgIHRoaXMuZGcucmVuZGVyQ3VzdG9tU3R5bGUyKHtzdHlsZTogeyBoZWlnaHQ6IF9oICsgJ3B4IWltcG9ydGFudCcgfX0sIG51bGwsIGhlaWdodENsc05hbWUpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKiog5YWB6K645pWw5o2u5oqY6KGM5pe277yM6K6h566X6KGM5Y+355qE6KGM6auYICovXHJcbiAgICB1cGRhdGVSb3dIZWlnaHQodHJEb21JZCA9IG51bGwpIHtcclxuICAgICAgICBpZiAodGhpcy5mYXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5tYWluQXJlYSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkZ0JvZHkgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2LmYtZGF0YWdyaWQtYm9keScpO1xyXG4gICAgICAgIGlmIChkZ0JvZHkpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRnLm5vd3JhcCB8fCB0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKGRnQm9keSwgJ2RhdGEtd3JhcCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3MoZGdCb2R5LCAnZGF0YS13cmFwJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIGlmICghdHJEb21JZCkge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVJvd0hlaWdodDIoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCB0ciA9IFV0aWxzLmdldFRyRG9tQnlJZCh0ckRvbUlkLCBkb2N1bWVudCk7XHJcbiAgICAgICAgICAgIGlmICghdHIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgbGVmdFRySWQgPSB0ckRvbUlkICsgJ19maXhlZGxlZnQnO1xyXG4gICAgICAgICAgICBjb25zdCByaWdodFRySWQgPSB0ckRvbUlkICsgJ19maXhlZHJpZ2h0JztcclxuICAgICAgICAgICAgY29uc3QgbGVmdFRyID0gVXRpbHMuZ2V0VHJEb21CeUlkKGxlZnRUcklkLCBkb2N1bWVudCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0VHIgPSBVdGlscy5nZXRUckRvbUJ5SWQocmlnaHRUcklkLCBkb2N1bWVudCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlUm93SGVpZ2h0Q2xzKHRyKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVSb3dIZWlnaHRDbHMobGVmdFRyKTtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVSb3dIZWlnaHRDbHMocmlnaHRUcik7XHJcblxyXG5cclxuICAgICAgICAgICAgY29uc3QgX2FyciA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJ0ciA9IFV0aWxzLmdldFRyRG9tQnlJZCh0ckRvbUlkLCB0aGlzLmZpeGVkUmlnaHRFbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGlmIChydHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBfYXJyLnB1c2goTWF0aC5jZWlsKHJ0ci5vZmZzZXRIZWlnaHQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZml4ZWRMZWZ0RWwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGx0ciA9IFV0aWxzLmdldFRyRG9tQnlJZCh0ckRvbUlkLCB0aGlzLmZpeGVkTGVmdEVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGx0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9hcnIucHVzaChNYXRoLmNlaWwobHRyLm9mZnNldEhlaWdodCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5tYWluQXJlYSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHIgPSBVdGlscy5nZXRUckRvbUJ5SWQodHJEb21JZCwgdGhpcy5tYWluQXJlYS5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9hcnIucHVzaChNYXRoLmNlaWwodHIub2Zmc2V0SGVpZ2h0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IF9oID0gTWF0aC5tYXgoLi4uX2Fycik7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBoZWlnaHRDbHNOYW1lID0gV09SRFdSQVBfUk9XX0hFSUdIVF9DTFMgKyAnXycgKyBfaDtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kZy5ub3dyYXAgfHwgdGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModHIsIGhlaWdodENsc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRSb3dIZWlnaHRDbHMoaGVpZ2h0Q2xzTmFtZSwgX2gpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChsZWZ0VHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyhsZWZ0VHIsIGhlaWdodENsc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyaWdodFRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3MocmlnaHRUciwgaGVpZ2h0Q2xzTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XHJcblxyXG4gICAgICAgIC8vIOenu+mZpGhlaWdodDogYXV0b1xyXG4gICAgICAgIGNvbnN0IHRyZG9tcyA9IHRoaXMuZGcuZGdDb250YWluZXIubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZi1kYXRhZ3JpZC1ib2R5LXJvdzpub3QoZi1kYXRhZ3JpZC1mb290ZXItcm93KScpO1xyXG4gICAgICAgIHRyZG9tcy5mb3JFYWNoKG4gPT4gbi5zdHlsZS5oZWlnaHQgPSAnJyk7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jZFsnZGVzdHJveWVkJ10pIHtcclxuICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldEJvZHlTdHlsZSgpIHtcclxuICAgICAgICBsZXQgaCA9IHRoaXMuZ2V0Vmlld1BvcnRIZWlnaHQoKTtcclxuICAgICAgICBpZiAoIXRoaXMuZGF0YS5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnVzZUJsYW5rV2hlbkRhdGFJc0VtcHR5KSB7XHJcbiAgICAgICAgICAgICAgICBoID0gdGhpcy5kZy5lbXB0eURhdGFIZWlnaHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5hdXRvSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaCA9IHRoaXMuZGcuZW1wdHlEYXRhSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmZvb3RlckRhdGEgJiYgdGhpcy5kZy5zaG93Rm9vdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZkID0gdGhpcy5kZy5mb290ZXJEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmZvb3RlckRhdGEuc3Vic2NyaWJlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZkID0gdGhpcy5kZy5mb290ZXJEYXRhWyd2YWx1ZSddO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZkICYmIEFycmF5LmlzQXJyYXkoZmQpICYmIGZkLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoID0gaCAtIHRoaXMuZGcuZm9vdGVySGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuZm9vdGVyUG9zaXRpb24gPT09ICdib3RoJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGggLSB0aGlzLmRnLmZvb3RlckhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zaG93Rm9vdGVyICYmIHRoaXMuZGcuZm9vdGVyUG9zaXRpb24gPT09ICdib3RoJykge1xyXG4gICAgICAgICAgICAgICAgaCA9IGggLSB0aGlzLmRnLmZvb3RlckhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBoZWlnaHQ6IGAke01hdGguZmxvb3IoaCkgKyAxfXB4YFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVTY3JvbGxQb3NpdGlvbihzY3JvbGxMZWZ0OiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSBzY3JvbGxMZWZ0O1xyXG5cclxuICAgICAgICB0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0ICsgdGhpcy53aWR0aCAtIHRoaXMucmlnaHRGaXhlZFdpZHRoO1xyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID09PSB0aGlzLm1heFNjcm9sbExlZnQgfHwgdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCA+IHRoaXMubWF4U2Nyb2xsTGVmdCkge1xyXG4gICAgICAgICAgICB0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0ID0gdGhpcy5tYXhTY3JvbGxMZWZ0O1xyXG4gICAgICAgICAgICB0aGlzLnNob3dSaWdodFNoYWRvdyA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd1JpZ2h0U2hhZG93ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZpeGVkTGVmdEVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZml4ZWRMZWZ0RWwubmF0aXZlRWxlbWVudCwgJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUzZCgke3RoaXMuc2Nyb2xsTGVmdH1weCwgMHB4LCAwcHgpYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5maXhlZFJpZ2h0RWwpIHtcclxuICAgICAgICAgICAgbGV0IGwgPSB0aGlzLmRnLndpZHRoIC0gKHRoaXMuZGcuc2hvd0JvcmRlciA/IDIgOiAwKSAtIHRoaXMuY29sdW1uc0dyb3VwLnJpZ2h0Rml4ZWRXaWR0aDtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSAmJiB0aGlzLnBzLmluc3RhbmNlLnNjcm9sbGJhcllBY3RpdmUgJiYgdGhpcy5kZy5zY3JvbGxCYXJTaG93TW9kZSA9PT0gJ2FsbHdheXMnKSB7XHJcbiAgICAgICAgICAgICAgICBsIC09IDE4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCByZWFsV2lkdGggPSB0aGlzLmNvbHVtbnNHcm91cC5sZWZ0Rml4ZWRXaWR0aCArIHRoaXMuY29sdW1uc0dyb3VwLm5vcm1hbFdpZHRoICsgdGhpcy5jb2x1bW5zR3JvdXAucmlnaHRGaXhlZFdpZHRoO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy53aWR0aCAtICh0aGlzLmRnLnNob3dCb3JkZXIgPyAyIDogMCkgPiByZWFsV2lkdGgpIHtcclxuICAgICAgICAgICAgICAgIGwgPSB0aGlzLmNvbHVtbnNHcm91cC5sZWZ0Rml4ZWRXaWR0aCArIHRoaXMuY29sdW1uc0dyb3VwLm5vcm1hbFdpZHRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGwgKz0gdGhpcy5zY3JvbGxMZWZ0O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCA9IGw7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnNldFN0eWxlKHRoaXMuZml4ZWRSaWdodEVsLm5hdGl2ZUVsZW1lbnQsICd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlM2QoJHt0aGlzLmZpeGVkUmlnaHRTY3JvbGxMZWZ0fXB4LCAwcHgsIDBweClgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25TY3JvbGxUb1goJGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBjb25zdCB4ID0gJGV2ZW50LnRhcmdldC5zY3JvbGxMZWZ0O1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2Nyb2xsUG9zaXRpb24oeCk7XHJcbiAgICAgICAgLy8gdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgdGhpcy5kZ3Mub25TY3JvbGxNb3ZlKHgsIFNDUk9MTF9YX0FDVElPTik7XHJcbiAgICAgICAgdGhpcy5kZnMudXBkYXRlUHJvcGVydHkoJ3Njcm9sbEluZm8nLCB7IHk6ICRldmVudC50YXJnZXQuc2Nyb2xsVG9wLCB4IH0pO1xyXG4gICAgICAgIHRoaXMuZGdzLnNob3dGaXhlZFNoYWRvdy5lbWl0KHsgc2hvd1JpZ2h0U2hhZG93OiB0aGlzLnNob3dSaWdodFNoYWRvdywgeDogdGhpcy5maXhlZFJpZ2h0U2Nyb2xsTGVmdCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvblNjcm9sbFRvWSgkZXZlbnQ6IGFueSkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fc2Nyb2xsVGltZXIpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3Njcm9sbFRpbWVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3Njcm9sbFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSAkZXZlbnQudGFyZ2V0LnNjcm9sbFRvcDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLnZpcnR1YWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNjcm9sbCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IHk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRmcy51cGRhdGVQcm9wZXJ0eSgnc2Nyb2xsSW5mbycsIHsgeSwgeDogJGV2ZW50LnRhcmdldC5zY3JvbGxMZWZ0IH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kZy5zY3JvbGxZLmVtaXQoeSk7XHJcbiAgICAgICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZSh5LCBTQ1JPTExfWV9BQ1RJT04pO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Qc1hSZWFjaFN0YXJ0KCRldmVudDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgeCA9ICRldmVudC50YXJnZXQuc2Nyb2xsTGVmdDtcclxuICAgICAgICB0aGlzLnVwZGF0ZVNjcm9sbFBvc2l0aW9uKHgpO1xyXG4gICAgICAgIHRoaXMuZGdzLm9uU2Nyb2xsTW92ZSh4LCBTQ1JPTExfWF9SRUFDSF9TVEFSVF9BQ1RJT04pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUHNYUmVhY2hFbmQoJGV2ZW50OiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNob3dSaWdodFNoYWRvdyA9IGZhbHNlO1xyXG4gICAgICAgIC8vIGNvbnN0IHggPSAkZXZlbnQudGFyZ2V0LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgLy8gdGhpcy51cGRhdGVTY3JvbGxQb3NpdGlvbih4KTtcclxuICAgICAgICAvLyB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICAvLyAvLyB0aGlzLmRncy5vblNob3dGaXhlZFNoYWRvdyh0aGlzLnNob3dSaWdodFNoYWRvdyk7XHJcbiAgICAgICAgLy8gdGhpcy5kZ3Mub25TY3JvbGxNb3ZlKHgsIFNDUk9MTF9YX1JFQUNIX0VORF9BQ1RJT04pO1xyXG4gICAgfVxyXG5cclxuICAgIGlzQ2hlY2tlZChyb3dEYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAocm93RGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZnMuaXNSb3dDaGVja2VkKHJvd0RhdGFbdGhpcy5kZy5pZEZpZWxkXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpc1NlbGVjdGVkKHJvd0RhdGE6IGFueSkge1xyXG4gICAgICAgIGlmIChyb3dEYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRmcy5pc1Jvd1NlbGVjdGVkKHJvd0RhdGFbdGhpcy5kZy5pZEZpZWxkXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVHcm91cFJvdyhyb3csIG9wZW4gPSB0cnVlKSB7XHJcbiAgICAgICAgcm93LmV4cGFuZGVkID0gb3BlbjtcclxuICAgICAgICB0aGlzLnBzLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgLyoqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IOWIhiA9PT09PT0g6ZqUID09PT09PSDnur8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cclxuXHJcbiAgICAvKiog6I635Y+W5Y+v6KeG5Yy65Z+f6auY5bqmICovXHJcbiAgICBwdWJsaWMgZ2V0Vmlld1BvcnRIZWlnaHQoKSB7XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0SGVpZ2h0ID0gdGhpcy5kZy5oZWlnaHQ7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuc2hvd0hlYWRlcikge1xyXG4gICAgICAgICAgICB2aWV3UG9ydEhlaWdodCA9IHZpZXdQb3J0SGVpZ2h0IC0gdGhpcy5kZy5yZWFsSGVhZGVySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCh0aGlzLmRnLmVuYWJsZUZpbHRlclJvdyB8fCB0aGlzLmRnLmVuYWJsZVNtYXJ0RmlsdGVyKSAmJiB0aGlzLmRnLnNob3dGaWx0ZXJCYXIpIHtcclxuICAgICAgICAgICAgdmlld1BvcnRIZWlnaHQgLT0gdGhpcy5kZy5maWx0ZXJCYXJIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5zaG93Um93R3JvdXBQYW5lbCkge1xyXG4gICAgICAgICAgICB2aWV3UG9ydEhlaWdodCAtPSB0aGlzLmRnLnJvd0dyb3VwUGFuZWxIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5zaG93Rm9vdGVyICYmIHRoaXMuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdmlld1BvcnRIZWlnaHQgPSB2aWV3UG9ydEhlaWdodCAtIHRoaXMuZGcuZm9vdGVySGVpZ2h0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcucGFnaW5hdGlvbikge1xyXG4gICAgICAgICAgICB2aWV3UG9ydEhlaWdodCA9IHZpZXdQb3J0SGVpZ2h0IC0gdGhpcy5kZy5wYWdlckhlaWdodCAtIDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5kZy5zaG93Qm9yZGVyKSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0SGVpZ2h0IC09IDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnZpZXdwb3J0SCA9IHZpZXdQb3J0SGVpZ2h0O1xyXG4gICAgICAgIHJldHVybiB2aWV3UG9ydEhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDkuI3mipjooYzml7bvvIzmiYDmnInmlbDmja7nmoTpq5jluqZcclxuICAgIHByaXZhdGUgYWxsUm93c0hlaWdodCgpIHtcclxuICAgICAgICBjb25zdCByb3dIZWlnaHRwYXRjaCA9IDE7ICAvLyB0aGlzLmRnLmF1dG9IZWlnaHQgPyAyIDogMTtcclxuICAgICAgICBjb25zdCByb3dIZWlnaHQgPSB0aGlzLmRnLnJvd0hlaWdodCArIHJvd0hlaWdodHBhdGNoO1xyXG5cclxuICAgICAgICBsZXQgaXRlbXNDb3VudCA9IDA7XHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZ3JvdXBSb3dzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGEuZmlsdGVyKG4gPT4gblsnX19ncm91cF92aXNpYmxlX18nXSB8fCBuWydfX2dyb3VwX3Zpc2libGVfXyddPT09dW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuZ3JvdXBTdW1tYXJ5UG9zaXRpb24gPT09ICdpbkdyb3VwUm93Jykge1xyXG4gICAgICAgICAgICAgICAgaXRlbXNDb3VudCA9IGRhdGEuZmlsdGVyKG4gPT4gIW5bJ19fZ3JvdXBfZm9vdGVyX18nXSkubGVuZ3RoO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaXRlbXNDb3VudCA9IGRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaXRlbXNDb3VudCA9IHRoaXMuZGF0YS5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgaCA9IGl0ZW1zQ291bnQgKiByb3dIZWlnaHQ7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgaCArPSBpdGVtc0NvdW50O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGggKz0gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q2FudmFzSGVpZ2h0KCkge1xyXG4gICAgICAgIGxldCBjYW52YXNIZWlnaHQgPSAwO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZGF0YSB8fCAhdGhpcy5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhc0hlaWdodCA9IDA7XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcubm93cmFwKSB7XHJcbiAgICAgICAgICAgIC8vIHRmcyA1NzIwMjJcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcubWF4SGVpZ2h0ICYmIHRoaXMuZGcuYXV0b0hlaWdodCAmJiB0aGlzLm1haW5BcmVhKSB7XHJcbiAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgPSBNYXRoLmZsb29yKHRoaXMubWFpbkFyZWEubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0ID0gdGhpcy5hbGxSb3dzSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLmdldFRyRG9tSGVpZ2h0KCkucmVkdWNlKChyLCBjKSA9PiByICsgYywgMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWNhbnZhc0hlaWdodCkge1xyXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0aGlzLnZpZXdwb3J0SDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbnZhc0hlaWdodCA9IGNhbnZhc0hlaWdodCArICh0aGlzLmRnLnNjcm9sbEJhclNob3dNb2RlID09PSAnYWxsd2F5cycgJiYgKHRoaXMucHMuaW5zdGFuY2UgJiYgdGhpcy5wcy5pbnN0YW5jZVsnc2Nyb2xsYmFyWEFjdGl2ZSddKSA/IDE4IDogMCk7XHJcbiAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSBjYW52YXNIZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIGNhbnZhc0hlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVDYW52YXNIZWlnaHQoKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSB0aGlzLmdldENhbnZhc0hlaWdodCgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldFJvd0Zyb21Qb3NpdGlvbih5KSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeSAvICh0aGlzLmRnLnJvd0hlaWdodCArIDEpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRWaXNpYmxlUmFuZ2Uodmlld3BvcnRUb3A/OiBudW1iZXIsIHZpZXdwb3J0TGVmdD86IG51bWJlcikge1xyXG4gICAgICAgIGlmICh2aWV3cG9ydFRvcCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZpZXdwb3J0VG9wID0gdGhpcy5zY3JvbGxUb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2aWV3cG9ydExlZnQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2aWV3cG9ydExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0b3A6IHRoaXMuZ2V0Um93RnJvbVBvc2l0aW9uKHZpZXdwb3J0VG9wKSxcclxuICAgICAgICAgICAgYm90dG9tOiB0aGlzLmdldFJvd0Zyb21Qb3NpdGlvbih2aWV3cG9ydFRvcCArIHRoaXMudmlld3BvcnRIKSArIDEsXHJcbiAgICAgICAgICAgIGxlZnRQeDogdmlld3BvcnRMZWZ0LFxyXG4gICAgICAgICAgICByaWdodFB4OiB2aWV3cG9ydExlZnQgKyB0aGlzLnZpZXdwb3J0V1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSZW5kZXJlZFJhbmdlKHZpZXdwb3J0VG9wPzogbnVtYmVyLCB2aWV3cG9ydExlZnQ/OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCByYW5nZSA9IHRoaXMuZ2V0VmlzaWJsZVJhbmdlKHZpZXdwb3J0VG9wLCB2aWV3cG9ydExlZnQpO1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlciA9IE1hdGgucm91bmQodGhpcy52aWV3cG9ydEggLyAodGhpcy5kZy5yb3dIZWlnaHQgKyAxKSk7XHJcbiAgICAgICAgY29uc3QgbWluQnVmZmVyID0gdGhpcy5taW5Sb3dCdWZmZXI7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnZTY3JvbGxEaXIgPT0gLTEpIHtcclxuICAgICAgICAgICAgcmFuZ2UudG9wIC09IGJ1ZmZlcjtcclxuICAgICAgICAgICAgcmFuZ2UuYm90dG9tICs9IG1pbkJ1ZmZlcjtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMudlNjcm9sbERpciA9PSAxKSB7XHJcbiAgICAgICAgICAgIHJhbmdlLnRvcCAtPSBtaW5CdWZmZXI7XHJcbiAgICAgICAgICAgIHJhbmdlLmJvdHRvbSArPSBidWZmZXI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmFuZ2UudG9wIC09IG1pbkJ1ZmZlcjtcclxuICAgICAgICAgICAgcmFuZ2UuYm90dG9tICs9IG1pbkJ1ZmZlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJhbmdlLnRvcCA9IE1hdGgubWF4KDAsIHJhbmdlLnRvcCk7XHJcbiAgICAgICAgcmFuZ2UuYm90dG9tID0gTWF0aC5taW4odGhpcy5kYXRhLmxlbmd0aCAtIDEsIHJhbmdlLmJvdHRvbSk7XHJcblxyXG4gICAgICAgIHJhbmdlLmxlZnRQeCAtPSB0aGlzLnZpZXdwb3J0VztcclxuICAgICAgICByYW5nZS5yaWdodFB4ICs9IHRoaXMudmlld3BvcnRXO1xyXG5cclxuICAgICAgICByYW5nZS5sZWZ0UHggPSBNYXRoLm1heCgwLCByYW5nZS5sZWZ0UHgpO1xyXG4gICAgICAgIHJhbmdlLnJpZ2h0UHggPSBNYXRoLm1pbih0aGlzLmNhbnZhc1dpZHRoLCByYW5nZS5yaWdodFB4KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJhbmdlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVuZGVyUm93cyhyYW5nZSkge1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSBbXTtcclxuICAgICAgICBsZXQgZGF0YUxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGg7XHJcbiAgICAgICAgbGV0IF9kYXRhID0gIHRoaXMuZGF0YTtcclxuXHJcbiAgICAgICAgIC8vIOWQr+eUqOWIhue7hFxyXG4gICAgICAgIGlmICh0aGlzLmRnLmdyb3VwUm93cyAmJiB0aGlzLmRnLmdyb3VwRmllbGQpIHtcclxuICAgICAgICAgICAgX2RhdGEgPSAgX2RhdGEuZmlsdGVyKG4gPT4gblsnX19ncm91cF92aXNpYmxlX18nXSB8fCBuWydfX2dyb3VwX3Zpc2libGVfXyddPT09dW5kZWZpbmVkKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmdyb3VwU3VtbWFyeVBvc2l0aW9uID09PSAnaW5Hcm91cFJvdycpIHtcclxuICAgICAgICAgICAgICAgIF9kYXRhID0gX2RhdGEuZmlsdGVyKG4gPT4gIW5bJ19fZ3JvdXBfZm9vdGVyX18nXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRhdGFMZW5ndGggPSBfZGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHRoaXMucm93c0NhY2hlID0ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gcmFuZ2UudG9wOyBpIDw9IHJhbmdlLmJvdHRvbTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvd3NDYWNoZVtpXSB8fCAoaSA9PSBkYXRhTGVuZ3RoKSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByb3dzLnB1c2goaSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgYW4gZW50cnkgcmlnaHQgYXdheSBzbyB0aGF0IGFwcGVuZFJvd0h0bWwoKSBjYW5cclxuICAgICAgICAgICAgLy8gc3RhcnQgcG9wdWxhdGF0aW5nIGl0LlxyXG4gICAgICAgICAgICB0aGlzLnJvd3NDYWNoZVtpXSA9IHtcclxuICAgICAgICAgICAgICAgIHJvd05vZGU6IG51bGwsXHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ29sU3BhbnMgb2YgcmVuZGVyZWQgY2VsbHMgKGJ5IGNvbHVtbiBpZHgpLlxyXG4gICAgICAgICAgICAgICAgLy8gQ2FuIGFsc28gYmUgdXNlZCBmb3IgY2hlY2tpbmcgd2hldGhlciBhIGNlbGwgaGFzIGJlZW4gcmVuZGVyZWQuXHJcbiAgICAgICAgICAgICAgICBjZWxsQ29sU3BhbnM6IFtdLFxyXG5cclxuICAgICAgICAgICAgICAgIC8vIENlbGwgbm9kZXMgKGJ5IGNvbHVtbiBpZHgpLiAgTGF6eS1wb3B1bGF0ZWQgYnkgZW5zdXJlQ2VsbE5vZGVzSW5Sb3dzQ2FjaGUoKS5cclxuICAgICAgICAgICAgICAgIGNlbGxOb2Rlc0J5Q29sdW1uSWR4OiBbXSxcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb2x1bW4gaW5kaWNlcyBvZiBjZWxsIG5vZGVzIHRoYXQgaGF2ZSBiZWVuIHJlbmRlcmVkLCBidXQgbm90IHlldCBpbmRleGVkIGluXHJcbiAgICAgICAgICAgICAgICAvLyBjZWxsTm9kZXNCeUNvbHVtbklkeC4gIFRoZXNlIGFyZSBpbiB0aGUgc2FtZSBvcmRlciBhcyBjZWxsIG5vZGVzIGFkZGVkIGF0IHRoZVxyXG4gICAgICAgICAgICAgICAgLy8gZW5kIG9mIHRoZSByb3cuXHJcbiAgICAgICAgICAgICAgICBjZWxsUmVuZGVyUXVldWU6IFtdXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSByb3dzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5yb3dzQ2FjaGVbcm93c1tpXV0ucm93Tm9kZSA9IF9kYXRhW3Jvd3NbaV1dO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMucm93c0NhY2hlKS5tYXAobiA9PiB0aGlzLnJvd3NDYWNoZVtuXS5yb3dOb2RlKS5maWx0ZXIobiA9PiBuKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVSb3dGcm9tQ2FjaGUocm93KSB7XHJcbiAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IHRoaXMucm93c0NhY2hlW3Jvd107XHJcbiAgICAgICAgaWYgKCFjYWNoZUVudHJ5KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRlbGV0ZSB0aGlzLnJvd3NDYWNoZVtyb3ddO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYW51cFJvd3MocmFuZ2VUb0tlZXApIHtcclxuICAgICAgICBmb3IgKGNvbnN0IGkgaW4gdGhpcy5yb3dzQ2FjaGUpIHtcclxuICAgICAgICAgICAgaWYgKGkgPCByYW5nZVRvS2VlcC50b3AgfHwgaSA+IHJhbmdlVG9LZWVwLmJvdHRvbSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVSb3dGcm9tQ2FjaGUoaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGFzWVNjcm9sbGJhcihzaG93WXNjcm9sbGJhcj86IGJvb2xlYW4pIHtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgc2hvd1lzY3JvbGxiYXIgPSBzaG93WXNjcm9sbGJhciA9PSB1bmRlZmluZWQgPyB0aGlzLnBzLmluc3RhbmNlLnNjcm9sbGJhcllBY3RpdmU6IHNob3dZc2Nyb2xsYmFyO1xyXG4gICAgICAgICAgICBjb25zdCBoYXNZID0gc2hvd1lzY3JvbGxiYXIgJiYgdGhpcy5kZy5zY3JvbGxCYXJTaG93TW9kZSA9PT0gJ2FsbHdheXMnID8gMTggOiAwO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy51cGRhdGVQcm9wZXJ0eSgnc2Nyb2xsYmFyWScsIGhhc1kpO1xyXG4gICAgICAgICAgICB0aGlzLmRmcy5yZXNpemUoKTtcclxuICAgICAgICB9LCA2MCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGlja1Njcm9sbEFycm93KCRldmVudCkge1xyXG4gICAgICAgIGNvbnN0IHsgZGlyLCBldmVudCB9ID0gJGV2ZW50O1xyXG4gICAgICAgIGlmICh0aGlzLnBzICYmIHRoaXMucHMuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzLnBzLmluc3RhbmNlLnJlYWNoO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHN3aXRjaChkaXIpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh4IT09ICdzdGFydCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgLSA0MDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHghPT0gJ2VuZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgKyA0MDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd0b3AnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh5ICE9PSAnc3RhcnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCAtIDQwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHkgIT09ICdlbmQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCArIDQwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5wcy51cGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW5kZXJEYXRhKGRldGVjdGNoYW5nZXMgPSB0cnVlKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSB0aGlzLmdldENhbnZhc0hlaWdodCgpO1xyXG4gICAgICAgIGlmICghdGhpcy5kZy52aXJ0dWFsaXplZCB8fCB0aGlzLmRnLmF1dG9IZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy5yb3dzID0gdGhpcy5kYXRhO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZpc2libGUgPSB0aGlzLmdldFZpc2libGVSYW5nZSgpO1xyXG4gICAgICAgICAgICBjb25zdCByZW5kZXJlZCA9IHRoaXMuZ2V0UmVuZGVyZWRSYW5nZSgpO1xyXG5cclxuICAgICAgICAgICAgLy8gcmVtb3ZlIHJvd3Mgbm8gbG9uZ2VyIGluIHRoZSB2aWV3cG9ydFxyXG4gICAgICAgICAgICB0aGlzLmNsZWFudXBSb3dzKHJlbmRlcmVkKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlbmRlciBtaXNzaW5nIHJvd3NcclxuICAgICAgICAgICAgdGhpcy5yb3dzID0gdGhpcy5yZW5kZXJSb3dzKHJlbmRlcmVkKTtcclxuICAgICAgICAgICAgdGhpcy5zdGFydFJvd0luZGV4ID0gcmVuZGVyZWQudG9wO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZW5kZXJlZFNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZW5kZXJlZFNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XHJcblxyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuYmxhbmtUb3BIZWlnaHQgPSB0aGlzLnN0YXJ0Um93SW5kZXggKiAodGhpcy5kZy5yb3dIZWlnaHQgKyAxKTtcclxuICAgICAgICAgICAgdGhpcy5ibGFua0JvdHRvbUhlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0IC0gdGhpcy5ibGFua1RvcEhlaWdodCAtICh0aGlzLnJvd3MubGVuZ3RoICogKHRoaXMuZGcucm93SGVpZ2h0ICsgMSkpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5kZy5zY3JvbGxCYXJTaG93TW9kZSA9PT0gJ2FsbHdheXMnICYmIHRoaXMucHMgJiYgdGhpcy5wcy5pbnN0YW5jZSAmJiB0aGlzLnBzLmluc3RhbmNlLnNjcm9sbGJhclhBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmxhbmtCb3R0b21IZWlnaHQgKz0gMjI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoZGV0ZWN0Y2hhbmdlcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBoYW5kbGVTY3JvbGwoKSB7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSB0aGlzLnBzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxUb3A7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gdGhpcy5wcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdDtcclxuICAgICAgICByZXR1cm4gdGhpcy5faGFuZGxlU2Nyb2xsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaGFuZGxlU2Nyb2xsKCkge1xyXG4gICAgICAgIGNvbnN0IHZpZXdwb3J0Q29udGFpbmVyID0gdGhpcy52aWV3U2Nyb2xsQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgbGV0IG1heFNjcm9sbERpc3RhbmNlWSA9IHZpZXdwb3J0Q29udGFpbmVyLnNjcm9sbEhlaWdodCAtIHZpZXdwb3J0Q29udGFpbmVyLmNsaWVudEhlaWdodDtcclxuICAgICAgICBsZXQgbWF4U2Nyb2xsRGlzdGFuY2VYID0gdmlld3BvcnRDb250YWluZXIuc2Nyb2xsV2lkdGggLSB2aWV3cG9ydENvbnRhaW5lci5jbGllbnRXaWR0aDtcclxuXHJcbiAgICAgICAgLy8gUHJvdGVjdCBhZ2FpbnN0IGVycm9uZW91cyBjbGllbnRIZWlnaHQvV2lkdGggZ3JlYXRlciB0aGFuIHNjcm9sbEhlaWdodC9XaWR0aC5cclxuICAgICAgICAvLyBTb21ldGltZXMgc2VlbiBpbiBDaHJvbWUuXHJcbiAgICAgICAgbWF4U2Nyb2xsRGlzdGFuY2VZID0gTWF0aC5tYXgoMCwgbWF4U2Nyb2xsRGlzdGFuY2VZKTtcclxuICAgICAgICBtYXhTY3JvbGxEaXN0YW5jZVggPSBNYXRoLm1heCgwLCBtYXhTY3JvbGxEaXN0YW5jZVgpO1xyXG5cclxuICAgICAgICAvLyBDZWlsaW5nIHRoZSBtYXggc2Nyb2xsIHZhbHVlc1xyXG4gICAgICAgIGlmICh0aGlzLnNjcm9sbFRvcCA+IG1heFNjcm9sbERpc3RhbmNlWSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IG1heFNjcm9sbERpc3RhbmNlWTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsTGVmdCA+IG1heFNjcm9sbERpc3RhbmNlWCkge1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSBtYXhTY3JvbGxEaXN0YW5jZVg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB2U2Nyb2xsRGlzdCA9IE1hdGguYWJzKHRoaXMuc2Nyb2xsVG9wIC0gdGhpcy5wcmV2U2Nyb2xsVG9wKTtcclxuICAgICAgICBjb25zdCBoU2Nyb2xsRGlzdCA9IE1hdGguYWJzKHRoaXMuc2Nyb2xsTGVmdCAtIHRoaXMucHJldlNjcm9sbExlZnQpO1xyXG5cclxuICAgICAgICBpZiAoaFNjcm9sbERpc3QpIHtcclxuICAgICAgICAgICAgdGhpcy5wcmV2U2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcclxuXHJcbiAgICAgICAgICAgIC8vICR2aWV3cG9ydFNjcm9sbENvbnRhaW5lclhbMF0uc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7XHJcbiAgICAgICAgICAgIC8vIGlmIChoYXNGcm96ZW5Db2x1bW5zKCkpIHtcclxuICAgICAgICAgICAgLy8gICAgIGlmIChoYXNGcm96ZW5Sb3dzKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgJHZpZXdwb3J0VG9wUlswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gICAgIGlmIChoYXNGcm96ZW5Sb3dzKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgJHZpZXdwb3J0VG9wTFswXS5zY3JvbGxMZWZ0ID0gc2Nyb2xsTGVmdDtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbGFzdFNjcm9sbFRvcCA9IHRoaXMubGFzdFJlbmRlcmVkU2Nyb2xsVG9wO1xyXG5cclxuICAgICAgICBpZiAodlNjcm9sbERpc3QpIHtcclxuICAgICAgICAgICAgdGhpcy52U2Nyb2xsRGlyID0gdGhpcy5wcmV2U2Nyb2xsVG9wIDwgdGhpcy5zY3JvbGxUb3AgPyAxIDogLTE7XHJcbiAgICAgICAgICAgIHRoaXMucHJldlNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xyXG5cclxuICAgICAgICAgICAgLy8gaWYgKGhhc0Zyb3plbkNvbHVtbnMoKSkge1xyXG4gICAgICAgICAgICAvLyAgICAgaWYgKGhhc0Zyb3plblJvd3MgJiYgIW9wdGlvbnMuZnJvemVuQm90dG9tKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgJHZpZXdwb3J0Qm90dG9tTFswXS5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIC8vICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICR2aWV3cG9ydFRvcExbMF0uc2Nyb2xsVG9wID0gc2Nyb2xsVG9wO1xyXG4gICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgICAgICAvLyBzd2l0Y2ggdmlydHVhbCBwYWdlcyBpZiBuZWVkZWRcclxuICAgICAgICAgICAgaWYgKHZTY3JvbGxEaXN0IDwgdGhpcy52aWV3cG9ydEgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbFRvKHRoaXMuc2Nyb2xsVG9wKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhTY3JvbGxEaXN0IHx8IHZTY3JvbGxEaXN0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGR4ID0gTWF0aC5hYnModGhpcy5sYXN0UmVuZGVyZWRTY3JvbGxMZWZ0IC0gdGhpcy5zY3JvbGxMZWZ0KTtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBNYXRoLmFicyhsYXN0U2Nyb2xsVG9wIC0gdGhpcy5zY3JvbGxUb3ApO1xyXG4gICAgICAgICAgICBpZiAoZHggPiAyMCB8fCBkeSA+IDIwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiByZW5kZXJpbmcgaXMgZm9yY2VkIG9yIHNjcm9sbGluZyBpcyBzbWFsbCBlbm91Z2ggdG8gYmUgXCJlYXN5XCIsIGp1c3QgcmVuZGVyXHJcbiAgICAgICAgICAgICAgICBpZiAoZHkgPCB0aGlzLnZpZXdwb3J0SCAmJiBkeCA8IHRoaXMudmlld3BvcnRXKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaFNjcm9sbERpc3QgfHwgdlNjcm9sbERpc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9zY3JvbGxUbyh5KSB7XHJcbiAgICAgICAgY29uc3QgJHZpZXdwb3J0U2Nyb2xsQ29udGFpbmVyWSA9IHRoaXMudmlld1Njcm9sbENvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHkgPSBNYXRoLm1heCh5LCAwKTtcclxuICAgICAgICB5ID0gTWF0aC5taW4oeSwgdGhpcy5jYW52YXNIZWlnaHQgLSB0aGlzLnZpZXdwb3J0SCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1Njcm9sbFRvcCA9IHk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnByZXZTY3JvbGxUb3AgIT0gbmV3U2Nyb2xsVG9wKSB7XHJcbiAgICAgICAgICAgIHRoaXMudlNjcm9sbERpciA9ICh0aGlzLnByZXZTY3JvbGxUb3AgPCBuZXdTY3JvbGxUb3ApID8gMSA6IC0xO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZW5kZXJlZFNjcm9sbFRvcCA9ICh0aGlzLnNjcm9sbFRvcCA9IHRoaXMucHJldlNjcm9sbFRvcCA9IG5ld1Njcm9sbFRvcCk7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiAoaGFzRnJvemVuQ29sdW1ucygpKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAkdmlld3BvcnRUb3BMWzBdLnNjcm9sbFRvcCA9IG5ld1Njcm9sbFRvcDtcclxuICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAgICAgLy8gaWYgKGhhc0Zyb3plblJvd3MpIHtcclxuICAgICAgICAgICAgLy8gICAgICR2aWV3cG9ydEJvdHRvbUxbMF0uc2Nyb2xsVG9wID0gJHZpZXdwb3J0Qm90dG9tUlswXS5zY3JvbGxUb3AgPSBuZXdTY3JvbGxUb3A7XHJcbiAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgIC8vICR2aWV3cG9ydFNjcm9sbENvbnRhaW5lclkuc2Nyb2xsVG9wID0gbmV3U2Nyb2xsVG9wO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIG9uTW91c2VDbGljaygkZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICAvLyBkb2N1bWVudC5ib2R5LmNsaWNrKCk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gJGV2ZW50LnRhcmdldCBhcyBhbnk7XHJcblxyXG4gICAgICAgIGlmICh0YXJnZXQubm9kZU5hbWUgPT09ICdURVhUQVJFQScgfHwgdGFyZ2V0Lm5vZGVOYW1lID09PSAnSU5QVVQnICkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgbGV0IHRkID0gdGFyZ2V0O1xyXG4gICAgICAgIGlmICh0YXJnZXQubm9kZU5hbWUgIT09ICdURCcpIHtcclxuICAgICAgICAgICAgdGQgPSB0YXJnZXQuY2xvc2VzdCgnVEQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGcuaXNFZGl0aW5nKCkgJiYgKHRoaXMuZGcuZXhpdFJvd0VkaXRpbmdXaGVuQm9keUNsaWNrIHx8IHRoaXMuZGcuZWRpdE1vZGUgPT0gJ2NlbGwnKSApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuZW5kRWRpdGluZygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjdXJUID0gbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAvL+S4iuS4gOasoeaXtumXtOaIs1xyXG4gICAgICAgIGxldCBsYXN0VCA9IHRoaXNbJ2xhc3RUYXBEaWZmVGltZSddIHx8IDA7XHJcbiAgICAgICAgLy/lr7nkuIrkuIDmrKHml7bpl7TmiLPph43mlrDotYvlgLxcclxuICAgICAgICB0aGlzWydsYXN0VGFwRGlmZlRpbWUnXSA9IGN1clQ7XHJcbiAgICAgICAgLy/lgZrlt65cclxuICAgICAgICBsZXQgZGlmZiA9IGN1clQgLSBsYXN0VDtcclxuICAgICAgIFxyXG5cclxuICAgICAgICBjb25zdCBpc0NsaWNrU2FtZVJvdyA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2NsaWNrQ2VsbFdlYWtNYXAuaGFzKHRoaXMuZWwubmF0aXZlRWxlbWVudCkgJiYgdGQgJiYgdGQucGFyZW50RWxlbWVudCA9PT0gdGhpcy5fY2xpY2tDZWxsV2Vha01hcC5nZXQodGhpcy5lbC5uYXRpdmVFbGVtZW50KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2xpY2tDZWxsV2Vha01hcC5kZWxldGUodGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJ1blRkQ2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0ZCAmJiB0ZC5zZWxlY3RDZWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0ZC5zZWxlY3RDZWxsKCRldmVudCwgdGQpOyBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdFJvdyh0ZCwgKGlkLCByb3dTZWxlY3RlZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbWl0ID0gIXJvd1NlbGVjdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLnNlbGVjdGlvbk1vZGUgPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmNsZWFyQ2hlY2tlZHMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0Um93KGlkLCBlbWl0LCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZ1sndXBkYXRlQWxsQ2hlY2tib3hTdGF0dXMnXSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJ1blNlbGVjdFJvdyA9ICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGJsY2xpY2tUaW1lciA9IHRoaXMuZGcuZGJsY2xpY2tSb3cub2JzZXJ2ZXJzLmxlbmd0aCA/IDIwMDogMDtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc0NsaWNrU2FtZVJvdygpICkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpZmYgPCBkYmxjbGlja1RpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy53cml0ZUNvbnNvbGUoJ+WPjOWHuycpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5riF6Zmk5LiK5LiA5qyh5Y2V5Ye755qE5a6a5pe25ZmoSURcclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpc1snbGFzdFRhcFRpbWVGdW5jJ10pXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5a6a5pe25ZmoaWRcclxuICAgICAgICAgICAgICAgICAgICB0aGlzWydsYXN0VGFwVGltZUZ1bmMnXSA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydW5UZENsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZGJsY2xpY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzWydsYXN0VGFwVGltZUZ1bmMnXSA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJ1blRkQ2xpY2soKTtcclxuICAgICAgICAgICAgICAgIH0sIGRibGNsaWNrVGltZXIgPyAxODA6IDApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9jbGlja0NlbGxXZWFrTWFwLnNldCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIHRkLnBhcmVudEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5kZy5lZGl0YWJsZSAmJiB0ZCkge1xyXG4gICAgICAgICAgICAvLyDop6PlhrPotoXpk77ngrnlh7vkuovku7bvvIzopoHlhYjmiafooYzpgInkuK3ooYxcclxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBydW5TZWxlY3RSb3coKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGcuZWRpdE1vZGUgPT09ICdyb3cnKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmV4aXRSb3dFZGl0aW5nV2hlbkJvZHlDbGljayAmJiB0aGlzLmRnLmlzRWRpdGluZygpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmVuZEVkaXRpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9zZWxlY3RSb3codGQsIChpZCwgcm93U2VsZWN0ZWQpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGcuc2VsZWN0Um93KGlkLCAhcm93U2VsZWN0ZWQsIGZhbHNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0ZCAmJiB0aGlzLmRnLmN1cnJlbnRDZWxsKSB7XHJcbiAgICAgICAgICAgIHRkID0gdGhpcy5kZy5jdXJyZW50Q2VsbC5jZWxsRWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKHRkICYmIHRkLmNsb3NlRWRpdCkge1xyXG4gICAgICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgdGQuY2xvc2VFZGl0KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAodGQpIHtcclxuICAgICAgICAgICAgLy8g6KGM56aB55So5pe2XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmRpc2FibGVSb3cpIHtcclxuICAgICAgICAgICAgICAgIGxldCByb3dEYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGxldCByb3dJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRkLmdyaWRDZWxsRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd0RhdGEgPSB0ZC5ncmlkQ2VsbERhdGEucm93RGF0YTtcclxuICAgICAgICAgICAgICAgICAgICByb3dJbmRleCA9IHRkLmdyaWRDZWxsRGF0YS5yb3dJbmRleDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93SW5mbyA9IHRoaXMuZGcuZ2V0Um93SWRCeVRyKHRkLnBhcmVudEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3dJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd0RhdGEgPSByb3dJbmZvLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd0luZGV4ID0gcm93SW5mby5pbmRleDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJvd0RhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZy5kaXNhYmxlUm93KHJvd0RhdGEsIHJvd0luZGV4KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRnLmVuZEVkaXRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy53cml0ZUNvbnNvbGUoJ+acquiOt+WPluWIsOihjOaVsOaNruOAgicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRnLmVkaXRhYmxlICYmIHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRkLmVkaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RSb3codGQsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGQuZWRpdCgkZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlhYHorrjnvJbovpHngrnlh7vooYzlj7fml7bvvIzlj6/ku6XpgInkuK3ooYxcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGQuc2VsZWN0Q2VsbCB8fCB0ZC5jbGFzc05hbWUuaW5kZXhPZignZi1kYXRhZ3JpZC1jZWxsLXJvd251bWJlcicpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVuU2VsZWN0Um93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5b2T54K55YiG57uE6KGM5oiW5ZCI6K6h6KGM5pe277yM6aG757uT5p2f57yW6L6RXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGcuaXNFZGl0aW5nKCkgJiYgdGhpcy5kZy5lbmRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRkLnNlbGVjdENlbGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBydW5TZWxlY3RSb3coKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGcuaXNFZGl0aW5nKCkgJiYgKHRoaXMuZGcuZXhpdFJvd0VkaXRpbmdXaGVuQm9keUNsaWNrIHx8IHRoaXMuZGcuZWRpdE1vZGUgPT09ICdjZWxsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZy5lbmRFZGl0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuX3NlbGVjdFJvdyh0ZCwgKGlkLCByb3dTZWxlY3RlZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmRnLnNlbGVjdFJvdyhpZCwgIXJvd1NlbGVjdGVkLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVuVGRDbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUgX3NlbGVjdFJvdyh0ZEVsOiBIVE1MRWxlbWVudCwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAodGRFbCkge1xyXG4gICAgICAgICAgICBjb25zdCB0ciA9IHRkRWwucGFyZW50RWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3Qgcm93SW5mbyA9IHRoaXMuZGcuZ2V0Um93SWRCeVRyKHRyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghcm93SW5mbykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB7ZGF0YSwgaW5kZXgsIGlkfSA9IHJvd0luZm9cclxuICAgICAgICAgICAgY29uc3Qgcm93aXNTZWxlY3RlZCA9IHRoaXMuZGZzLmlzUm93U2VsZWN0ZWQoaWQpO1xyXG4gICAgICAgICAgICB0aGlzLmRnLl9iZWZvcmVTZWxlY3RSb3ckKGluZGV4LCBkYXRhLCBpZCkucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpLnN1YnNjcmliZSgodDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGlkLCByb3dpc1NlbGVjdGVkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQmVmb3JlU2hvd0NvbnRleHRNZW51ID0gKGU6IGFueSkgPT4ge1xyXG4gICAgICAgIC8vIHJvd18xX2ZpeGVkbGVmdCAgcm93XzEgIHJvd18xX2ZpeGVkcmlnaHRcclxuICAgICAgICBjb25zdCB7IGNvbnRleHRNZW51RG9tLCBldmVudCB9ID0gZTtcclxuXHJcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuZGF0YWdyaWQtZWRpdG9yJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtzaG93OiBmYWxzZX0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGxldCByb3dJRCA9IGV2ZW50LnRhcmdldC5pZDtcclxuXHJcbiAgICAgICAgaWYgKGNvbnRleHRNZW51RG9tKSB7XHJcbiAgICAgICAgICAgIC8vIOaOkumZpOWIhue7hOihjOOAgeWIhue7hOWQiOiuoeihjFxyXG4gICAgICAgICAgICBpZiAoY29udGV4dE1lbnVEb20uY2xhc3NOYW1lLmluZGV4T2YoJ2YtZGF0YWdyaWQtZ3JvdXAtcm93JykgPT09IC0xICYmIGNvbnRleHRNZW51RG9tLmNsYXNzTmFtZS5pbmRleE9mKCdmLWRhdGFncmlkLWdyb3VwLWZvb3RlcicpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcm93SUQgPSBVdGlscy5nZXRSb3dJZEJ5VHIoY29udGV4dE1lbnVEb20pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93RGF0YSA9IHRoaXMuZGZzLmZpbmRSb3cocm93SUQpO1xyXG5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvY3VzVGFyZ2V0V2lkdGggPSB0aGlzLnZpZXdwb3J0VyA+IHRoaXMudG90YWxXaWR0aCA/IHRoaXMudG90YWxXaWR0aCA6IHRoaXMudmlld3BvcnRXO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGQgPSBldmVudC50YXJnZXQuY2xvc2VzdCgndGQnKSA7XHJcbiAgICAgICAgICAgICAgICBsZXQgY29sSW5mbyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAodGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSB0ZC5nZXRBdHRyaWJ1dGUoJ2ZpZWxkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sSW5mbyA9IGZpZWxkTmFtZSA/IHRoaXMuZGZzLmdldENvbHVtbihmaWVsZE5hbWUpIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgYmVmb3JlU2hvd0NvbnRleHRNZW51cyQgPSBvZih0cnVlKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRnLmJlZm9yZVNob3dDb250ZXh0TWVudXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaG93Q29udGV4dE1lbnU6IGFueSA9IHRoaXMuZGcuYmVmb3JlU2hvd0NvbnRleHRNZW51cyh7IHJvd2lkOiByb3dJRCwgZGF0YTogcm93RGF0YS5kYXRhLCBncmlkOiB0aGlzLmRnLCBjb2x1bW46IGNvbEluZm99KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNob3dDb250ZXh0TWVudSA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJlZm9yZVNob3dDb250ZXh0TWVudXMkID0gb2Yoc2hvd0NvbnRleHRNZW51KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd0NvbnRleHRNZW51WydzdWJzY3JpYmUnXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlU2hvd0NvbnRleHRNZW51cyQgPSBzaG93Q29udGV4dE1lbnU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGJlZm9yZVNob3dDb250ZXh0TWVudXMkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKChlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0geyByb3dpZDogcm93SUQsIGRhdGE6IHJvd0RhdGEuZGF0YSwgZ3JpZDogdGhpcy5kZywgY29sdW1uOiBjb2xJbmZvfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzaG93OiBpc1Nob3csIGN1c3RvbURhdGEgfSA9IGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2Yoe3Nob3c6IGlzU2hvdywgZGF0YTogT2JqZWN0LmFzc2lnbihwYXJhbXMsIHsgY3VzdG9tRGF0YTogY3VzdG9tRGF0YSA/IGN1c3RvbURhdGE6IG51bGwgfSksIGZvY3VzVGFyZ2V0V2lkdGh9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZih7IHNob3c6IGUsIGRhdGE6IHBhcmFtcywgZm9jdXNUYXJnZXRXaWR0aCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZih7IHNob3c6IGZhbHNlIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DatagridComponent } from './../../datagrid.component';
import { Utils } from './../../utils/utils';
import { Input, ElementRef, Directive, Injector, NgZone, Renderer2 } from '@angular/core';
import { CommonUtils } from '@farris/ui-common';
import { DomHandler } from '../../services/domhandler';
export class DatagridCellTooltipDirective {
    /**
     * @param {?} el
     * @param {?} injector
     */
    constructor(el, injector) {
        this.el = el;
        this.injector = injector;
        this.position = 'top-left';
        this.delay = 1000;
        this.cls = '';
        this.type = 'info';
        this.tipMode = 'auto';
        this.showTipTimer = null;
        this._mouseenter = null;
        this._mouseleave = null;
        this._mouseclick = null;
        this.ngZone = null;
        this.render = null;
        if (this.injector) {
            this.commonUtils = this.injector.get(CommonUtils, new CommonUtils());
            this.ngZone = this.injector.get(NgZone);
            this.render = this.injector.get(Renderer2);
            this.dg = this.injector.get(DatagridComponent);
        }
        else {
            this.commonUtils = new CommonUtils();
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.ngZone && this.enable) {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            () => {
                this._mouseenter = Utils.on(this.el.nativeElement, 'mouseenter', this.onMouseEnter.bind(this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                this._mouseleave = Utils.on(this.el.nativeElement, 'mouseleave', this.onMouseLeave.bind(this), { target: '.f-datagrid-cell-content', options: { capture: true } });
                this._mouseclick = Utils.on(this.el.nativeElement, 'mousedown', this.onClick.bind(this));
            }));
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.hide();
        if (this._mouseenter) {
            this._mouseenter();
        }
        if (this._mouseleave) {
            this._mouseleave();
        }
        if (this._mouseclick) {
            this._mouseclick();
        }
        // this.dg = null;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onMouseEnter($event) {
        if (!this.enable) {
            return;
        }
        if ($event.fromElement) {
            if (!$event.fromElement.closest('.f-datagrid')) {
                return;
            }
        }
        /** @type {?} */
        const cellTiptimer = this.dg ? this.dg.cellTipTimer : 1000;
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        this.showTipTimer = setTimeout((/**
         * @return {?}
         */
        () => {
            this.show($event);
        }), cellTiptimer);
    }
    /**
     * @return {?}
     */
    onMouseLeave() {
        this.hide();
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onClick(e) {
        // e.stopPropagation();
        this.hide();
    }
    /**
     * @private
     * @return {?}
     */
    getTextContainer() {
        return DomHandler.findSingle(this.container, '.f-tooltip-text');
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    donotShowTips(target) {
        /** @type {?} */
        const tdWidth = target.offsetWidth;
        /** @type {?} */
        const tagetSty = window.getComputedStyle(target);
        /** @type {?} */
        const txtWidth = this.commonUtils.getTextWidth(this.message, tagetSty.font);
        const { paddingLeft, paddingRight } = tagetSty;
        /** @type {?} */
        const _width = tdWidth - (Number(paddingLeft.replace('px', '')) || 0) - (Number(paddingRight.replace('px', '')) || 0);
        /** @type {?} */
        let tr = target.closest('tr');
        if (tr) {
            /** @type {?} */
            const trId = tr.id;
            // tr = document.querySelector('#'+ trId);
            tr = Utils.getTrDomById(trId, document);
        }
        if (this.tipMode === 'auto') {
            if (tr) {
                return _width && _width > txtWidth;
            }
            return true;
        }
        else {
            return tr ? false : true;
        }
    }
    /**
     * @return {?}
     */
    hide() {
        if (!this.enable) {
            return;
        }
        if (this.showTipTimer) {
            clearTimeout(this.showTipTimer);
            this.showTipTimer = null;
        }
        if (this.container && this.container.parentElement) {
            document.body.removeChild(this.container);
        }
        this.container = null;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    show($event) {
        /** @type {?} */
        const cellEl = (/** @type {?} */ ($event.target));
        // this.enable = cellEl.getAttribute('cell-tooltip') === 'true';
        this.message = cellEl.getAttribute('message');
        this.tipMode = cellEl.getAttribute('tipMode') || 'auto';
        if (!this.enable || !this.message) {
            return;
        }
        /** @type {?} */
        const tipWidth = cellEl.getAttribute('tipWidth');
        /** @type {?} */
        const tipHeight = cellEl.getAttribute('tipHeight');
        this.position = cellEl.getAttribute('position') || 'top-left';
        // 检查下内容宽度是否超出列宽
        if (this.donotShowTips($event.target) && cellEl.innerText === this.message) {
            return;
        }
        // const boxEl = this.el.nativeElement;
        /** @type {?} */
        const boxEl = $event.target;
        /** @type {?} */
        const elSize = this.getBoxSizeObj(boxEl);
        /** 如果存在则不新建，只需要修改里面的内容 */
        if (!this.container) {
            this.create(elSize);
        }
        else {
            DomHandler.findSingle(this.container, '.f-tooltip-text').innerHTML = this.message;
        }
        this.container.style.maxWidth = `${window.innerWidth - 30}px`;
        this.container.style.minWidth = '35px';
        if (tipWidth) {
            this.container.style.width = tipWidth;
        }
        if (tipHeight) {
            this.container.style.height = tipHeight;
        }
        /** @type {?} */
        const offset = DomHandler.getOffset(boxEl);
        /** @type {?} */
        const targetTop = offset.top;
        /** @type {?} */
        const targetLeft = offset.left;
        /** @type {?} */
        let left;
        /** @type {?} */
        let top;
        this.container.style.display = 'block';
        this.changeTooltipPosition(boxEl);
        /** @type {?} */
        const arrow = DomHandler.findSingle(this.container, '.f-tooltip-arrow');
        /** @type {?} */
        const tooltipSize = this.getTooltipSize();
        // 检查内容高度
        if (window.innerHeight - 10 < tooltipSize.height) {
            this.container.style.height = `${window.innerHeight - 20}px`;
            tooltipSize.height = window.innerHeight - 25;
            /** @type {?} */
            const textContainer = this.getTextContainer();
            textContainer.style.height = `${tooltipSize.height}px`;
            textContainer.style.overflow = 'hidden';
        }
        /** @type {?} */
        const n = this.updateArrowPosition(arrow, offset, $event);
        switch (this.position) {
            case 'right':
                left = targetLeft + elSize.width;
                top = n;
                break;
            case 'left':
                left = targetLeft - tooltipSize.width;
                top = n;
                break;
            case 'top-left':
                top = targetTop - tooltipSize.height - 7;
                left = n;
                break;
        }
        if (left) {
            this.container.style.left = left + 'px';
        }
        this.container.style.top = top + 'px';
        this.container.style.zIndex = 999999;
    }
    /**
     * @private
     * @param {?} arrow
     * @param {?} elOffset
     * @param {?} $event
     * @return {?}
     */
    updateArrowPosition(arrow, elOffset, $event) {
        /** @type {?} */
        const tooltipSize = this.getTooltipSize();
        if (this.position === 'left' || this.position === 'right') {
            /** @type {?} */
            const targetTop = elOffset.top;
            /** @type {?} */
            const halfHeight = tooltipSize.height / 2;
            /** @type {?} */
            let top = 10;
            if (targetTop > halfHeight && window.innerHeight - targetTop > halfHeight) {
                top = targetTop - tooltipSize.height / 2;
            }
            // 调整箭头的位置
            if (arrow) {
                arrow.style.top = `${targetTop - top}px`;
            }
            return top;
        }
        else if (this.position === 'top-left') {
            /** @type {?} */
            let left = $event.pageX - tooltipSize.width / 2;
            if (left < 10) {
                left = elOffset.left;
            }
            if (left + tooltipSize.width > window.innerWidth) {
                left = window.innerWidth - tooltipSize.width - 20;
            }
            // 调整箭头的位置
            if (arrow) {
                if ($event.pageX - left > 28) {
                    if ($event.pageX - left + 28 > tooltipSize.width) {
                        arrow.style.left = `${tooltipSize.width - 28}px`;
                    }
                    else {
                        arrow.style.left = `${$event.pageX - left}px`;
                    }
                }
            }
            return left;
        }
    }
    /**
     * @param {?} elSize
     * @return {?}
     */
    create(elSize) {
        /** @type {?} */
        let styleClass = this.tooltipCls();
        this.container = document.createElement('div');
        if (this.tooltipStyleClass) {
            styleClass += ' ' + this.tooltipStyleClass;
        }
        this.container.className = styleClass;
        /** @type {?} */
        const tooltipArrow = document.createElement('div');
        tooltipArrow.className = 'f-tooltip-arrow ';
        this.container.appendChild(tooltipArrow);
        /** @type {?} */
        const tooltipText = document.createElement('div');
        tooltipText.className = 'f-tooltip-text ';
        tooltipText.innerHTML = this.message;
        /** @type {?} */
        const maxWidth = window.innerWidth - 50;
        tooltipText.style.maxWidth = `${maxWidth}px`;
        tooltipText.style.wordBreak = 'break-all';
        this.container.style.textAlign = 'center';
        if (this.positionStyle) {
            this.container.style.position = this.positionStyle;
        }
        this.container.appendChild(tooltipText);
        document.body.appendChild(this.container);
    }
    /**
     * @private
     * @return {?}
     */
    tooltipCls() {
        return 'datagrid-cell-tooltip f-tooltip ' + this.getThemeCls() + ' f-tooltip-' + this.position + ' ' + this.cls;
    }
    /**
     * @private
     * @return {?}
     */
    getThemeCls() {
        if (this.type) {
            return 'f-tooltip-' + this.type;
        }
        return '';
    }
    /**
     * 获取宿主尺寸
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    getBoxSizeObj(boxEl) {
        /** @type {?} */
        const p = boxEl.getBoundingClientRect();
        return {
            width: DomHandler.getOuterWidth(boxEl),
            height: DomHandler.getOuterHeight(boxEl),
            left: p.left,
            right: p.right,
            top: p.top,
            bottom: p.bottom
        };
    }
    /**
     * 获取tooltip 容器尺寸
     * @private
     * @return {?}
     */
    getTooltipSize() {
        return {
            width: DomHandler.getOuterWidth(this.container),
            height: DomHandler.getOuterHeight(this.container)
        };
    }
    /**
     * 获取窗口尺寸
     * @private
     * @return {?}
     */
    getWindowSize() {
        return {
            width: window.innerWidth,
            height: window.innerHeight
        };
    }
    /**
     * 根据内容的多少，自动更改tooltip 的位置
     * @private
     * @param {?} boxEl
     * @return {?}
     */
    changeTooltipPosition(boxEl) {
        /** @type {?} */
        const boxSize = this.getBoxSizeObj(boxEl);
        /** @type {?} */
        const tooltip = this.getTooltipSize();
        /** @type {?} */
        const winSize = this.getWindowSize();
        this.container.className = this.tooltipCls();
        if (tooltip.width < winSize.width && tooltip.height < boxSize.top) {
            // this.position = 'top-left';
            return;
        }
        else {
            /** @type {?} */
            const elOffset = DomHandler.getOffset(boxEl);
            /** @type {?} */
            const elLeft = elOffset.left;
            /** @type {?} */
            const elRight = winSize.width - elLeft - boxSize.width;
            if (elLeft > elRight) {
                this.position = 'left';
            }
            else {
                this.position = 'right';
            }
            /** @type {?} */
            const toolTipTextWidth = elLeft > elRight ? elLeft : elRight;
            /** @type {?} */
            const textEl = this.getTextContainer();
            textEl.style.maxWidth = `${toolTipTextWidth - 30}px`;
            this.container.style.maxWidth = `${toolTipTextWidth}px`;
        }
    }
}
DatagridCellTooltipDirective.decorators = [
    { type: Directive, args: [{
                selector: '[cell-tooltip]',
                exportAs: 'cellTooltip'
            },] }
];
/** @nocollapse */
DatagridCellTooltipDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Injector }
];
DatagridCellTooltipDirective.propDecorators = {
    enable: [{ type: Input, args: ['cell-tooltip',] }],
    position: [{ type: Input }],
    positionStyle: [{ type: Input }],
    tooltipStyleClass: [{ type: Input }],
    message: [{ type: Input }],
    delay: [{ type: Input }],
    cls: [{ type: Input }],
    type: [{ type: Input }],
    tipMode: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.enable;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.position;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.positionStyle;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tooltipStyleClass;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.message;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.delay;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.cls;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.type;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.tipMode;
    /** @type {?} */
    DatagridCellTooltipDirective.prototype.container;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.commonUtils;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.showTipTimer;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseenter;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseleave;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype._mouseclick;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.dg;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    DatagridCellTooltipDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2VsbC10b29sdGlwLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktZGF0YWdyaWQvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90b29sdGlwL2NlbGwtdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQWEsS0FBSyxFQUFnQixVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFNdkQsTUFBTSxPQUFPLDRCQUE0Qjs7Ozs7SUF5QnJDLFlBQW9CLEVBQWMsRUFBVSxRQUFrQjtRQUExQyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQXZCckQsYUFBUSxHQUFrRixVQUFVLENBQUM7UUFJckcsVUFBSyxHQUFHLElBQUksQ0FBQztRQUViLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFDVCxTQUFJLEdBQThDLE1BQU0sQ0FBQztRQUN6RCxZQUFPLEdBQXVCLE1BQU0sQ0FBQztRQU10QyxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUdwQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUNuQixXQUFNLEdBQVcsSUFBSSxDQUFDO1FBQ3RCLFdBQU0sR0FBYyxJQUFJLENBQUM7UUFHN0IsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFdBQVcsR0FBRyxJ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QThDOztJQUk5QyxpREFBZTs7Ozs7SUFDZixtREFBaUM7Ozs7O0lBQ2pDLG9EQUE0Qjs7Ozs7SUFHNUIsbURBQTJCOzs7OztJQUMzQixtREFBMkI7Ozs7O0lBQzNCLG1EQUEyQjs7Ozs7SUFDM0IsOENBQThCOzs7OztJQUM5Qiw4Q0FBaUM7Ozs7O0lBQ2pDLDBDQUE4Qjs7Ozs7SUFDbEIsMENBQXNCOzs7OztJQUFFLGdEQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi9kYXRhZ3JpZC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4vLi4vLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgeyBPbkRlc3Ryb3ksIElucHV0LCBIb3N0TGlzdGVuZXIsIEVsZW1lbnRSZWYsIERpcmVjdGl2ZSwgSW5qZWN0b3IsIE9uSW5pdCwgTmdab25lLCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbHMgfSBmcm9tICdAZmFycmlzL3VpLWNvbW1vbic7XHJcbmltcG9ydCB7IERvbUhhbmRsZXIgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9kb21oYW5kbGVyJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbY2VsbC10b29sdGlwXScsXHJcbiAgICBleHBvcnRBczogJ2NlbGxUb29sdGlwJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRDZWxsVG9vbHRpcERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICAgIEBJbnB1dCgnY2VsbC10b29sdGlwJykgZW5hYmxlOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgcG9zaXRpb246ICd0b3AnIHwgJ2JvdHRvbScgfCAnbGVmdCcgfCAncmlnaHQnIHwgJ3RvcC1sZWZ0JyB8ICd0b3AtY2VudGVyJyB8ICd0b3AtcmlnaHQnID0gJ3RvcC1sZWZ0JztcclxuICAgIEBJbnB1dCgpIHBvc2l0aW9uU3R5bGU6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHRvb2x0aXBTdHlsZUNsYXNzOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgICBASW5wdXQoKSBkZWxheSA9IDEwMDA7XHJcblxyXG4gICAgQElucHV0KCkgY2xzID0gJyc7XHJcbiAgICBASW5wdXQoKSB0eXBlOiAnZGFuZ2VyJyB8ICdzdWNjZXNzJyB8ICdpbmZvJyB8ICd3YXJuaW5nJyA9ICdpbmZvJztcclxuICAgIEBJbnB1dCgpIHRpcE1vZGU6ICdhbGx3YXlzJyB8ICdhdXRvJyA9ICdhdXRvJztcclxuXHJcbiAgICAvLyBASG9zdEJpbmRpbmcoJ3N0eWxlLndpZHRoJykgY21wV2lkdGggPSAnMTAwJSc7XHJcblxyXG4gICAgY29udGFpbmVyOiBhbnk7XHJcbiAgICBwcml2YXRlIGNvbW1vblV0aWxzOiBDb21tb25VdGlscztcclxuICAgIHByaXZhdGUgc2hvd1RpcFRpbWVyID0gbnVsbDtcclxuXHJcblxyXG4gICAgcHJpdmF0ZSBfbW91c2VlbnRlciA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9tb3VzZWxlYXZlID0gbnVsbDtcclxuICAgIHByaXZhdGUgX21vdXNlY2xpY2sgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSA9IG51bGw7XHJcbiAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyID0gbnVsbDtcclxuICAgIHByaXZhdGUgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgICAgICBpZiAodGhpcy5pbmplY3Rvcikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbW1vblV0aWxzID0gdGhpcy5pbmplY3Rvci5nZXQoQ29tbW9uVXRpbHMsIG5ldyBDb21tb25VdGlscygpKTtcclxuICAgICAgICAgICAgdGhpcy5uZ1pvbmUgPSB0aGlzLmluamVjdG9yLmdldChOZ1pvbmUpO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlciA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRnID0gdGhpcy5pbmplY3Rvci5nZXQoRGF0YWdyaWRDb21wb25lbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29tbW9uVXRpbHMgPSBuZXcgQ29tbW9uVXRpbHMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm5nWm9uZSAmJiB0aGlzLmVuYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZWVudGVyID0gVXRpbHMub24odGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnbW91c2VlbnRlcicsIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcyksIHsgdGFyZ2V0OiAnLmYtZGF0YWdyaWQtY2VsbC1jb250ZW50Jywgb3B0aW9uczogeyBjYXB0dXJlOiB0cnVlIH19KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21vdXNlbGVhdmUgPSBVdGlscy5vbih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWxlYXZlJywgdGhpcy5vbk1vdXNlTGVhdmUuYmluZCh0aGlzKSwgeyB0YXJnZXQ6ICcuZi1kYXRhZ3JpZC1jZWxsLWNvbnRlbnQnLCBvcHRpb25zOiB7IGNhcHR1cmU6IHRydWUgfX0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbW91c2VjbGljayA9IFV0aWxzLm9uKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ21vdXNlZG93bicsIHRoaXMub25DbGljay5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWVudGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlZW50ZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWxlYXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlbGVhdmUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9tb3VzZWNsaWNrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdXNlY2xpY2soKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMuZGcgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW91c2VFbnRlcigkZXZlbnQ6IGFueSkge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoJGV2ZW50LmZyb21FbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICghJGV2ZW50LmZyb21FbGVtZW50LmNsb3Nlc3QoJy5mLWRhdGFncmlkJykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGNlbGxUaXB0aW1lciA9IHRoaXMuZGcgPyB0aGlzLmRnLmNlbGxUaXBUaW1lciA6IDEwMDA7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnNob3dUaXBUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zaG93VGlwVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dUaXBUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2hvd1RpcFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvdygkZXZlbnQpO1xyXG4gICAgICAgIH0sIGNlbGxUaXB0aW1lcik7XHJcbiAgICB9XHJcblxyXG4gICAgb25Nb3VzZUxlYXZlKCkge1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xpY2soZTogTW91c2VFdmVudCkge1xyXG4gICAgICAgIC8vIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUZXh0Q29udGFpbmVyKCkge1xyXG4gICAgICAgIHJldHVybiBEb21IYW5kbGVyLmZpbmRTaW5nbGUodGhpcy5jb250YWluZXIsICcuZi10b29sdGlwLXRleHQnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRvbm90U2hvd1RpcHModGFyZ2V0OiBhbnkpIHtcclxuICAgICAgICBjb25zdCB0ZFdpZHRoID0gdGFyZ2V0Lm9mZnNldFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IHRhZ2V0U3R5ID0gIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdHh0V2lkdGggPSB0aGlzLmNvbW1vblV0aWxzLmdldFRleHRXaWR0aCh0aGlzLm1lc3NhZ2UsIHRhZ2V0U3R5LmZvbnQpO1xyXG4gICAgICAgIGNvbnN0IHsgcGFkZGluZ0xlZnQsIHBhZGRpbmdSaWdodCB9ID0gdGFnZXRTdHk7XHJcbiAgICAgICAgY29uc3QgX3dpZHRoID0gdGRXaWR0aCAtIChOdW1iZXIocGFkZGluZ0xlZnQucmVwbGFjZSgncHgnLCAnJykpIHx8IDApIC0gKE51bWJlcihwYWRkaW5nUmlnaHQucmVwbGFjZSgncHgnLCAnJykpIHx8IDApO1xyXG5cclxuICAgICAgICBsZXQgdHIgPSB0YXJnZXQuY2xvc2VzdCgndHInKTtcclxuICAgICAgICBpZiAodHIpIHtcclxuICAgICAgICAgICAgY29uc3QgdHJJZCA9IHRyLmlkO1xyXG4gICAgICAgICAgICAvLyB0ciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyMnKyB0cklkKTtcclxuICAgICAgICAgICAgdHIgPSBVdGlscy5nZXRUckRvbUJ5SWQodHJJZCwgZG9jdW1lbnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMudGlwTW9kZSA9PT0gJ2F1dG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF93aWR0aCAmJiBfd2lkdGggPiB0eHRXaWR0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHIgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zaG93VGlwVGltZXIpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2hvd1RpcFRpbWVyKTtcclxuICAgICAgICAgICAgdGhpcy5zaG93VGlwVGltZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyICYmIHRoaXMuY29udGFpbmVyLnBhcmVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBzaG93KCRldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNlbGxFbCA9ICRldmVudC50YXJnZXQgYXMgYW55O1xyXG4gICAgICAgIC8vIHRoaXMuZW5hYmxlID0gY2VsbEVsLmdldEF0dHJpYnV0ZSgnY2VsbC10b29sdGlwJykgPT09ICd0cnVlJztcclxuICAgICAgICB0aGlzLm1lc3NhZ2UgPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCdtZXNzYWdlJyk7XHJcbiAgICAgICAgdGhpcy50aXBNb2RlID0gY2VsbEVsLmdldEF0dHJpYnV0ZSgndGlwTW9kZScpIHx8ICdhdXRvJztcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZSB8fCAhdGhpcy5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRpcFdpZHRoID0gY2VsbEVsLmdldEF0dHJpYnV0ZSgndGlwV2lkdGgnKTtcclxuICAgICAgICBjb25zdCB0aXBIZWlnaHQgPSBjZWxsRWwuZ2V0QXR0cmlidXRlKCd0aXBIZWlnaHQnKTtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gY2VsbEVsLmdldEF0dHJpYnV0ZSgncG9zaXRpb24nKSB8fCAndG9wLWxlZnQnO1xyXG5cclxuICAgICAgICAvLyDmo4Dmn6XkuIvlhoXlrrnlrr3luqbmmK/lkKbotoXlh7rliJflrr1cclxuICAgICAgICBpZiAodGhpcy5kb25vdFNob3dUaXBzKCRldmVudC50YXJnZXQpICYmIGNlbGxFbC5pbm5lclRleHQgPT09IHRoaXMubWVzc2FnZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjb25zdCBib3hFbCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICBjb25zdCBib3hFbCA9ICRldmVudC50YXJnZXQ7XHJcbiAgICAgICAgY29uc3QgZWxTaXplID0gdGhpcy5nZXRCb3hTaXplT2JqKGJveEVsKTtcclxuXHJcblxyXG4gICAgICAgIC8qKiDlpoLmnpzlrZjlnKjliJnkuI3mlrDlu7rvvIzlj6rpnIDopoHkv67mlLnph4zpnaLnmoTlhoXlrrkgKi9cclxuICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlKGVsU2l6ZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgRG9tSGFuZGxlci5maW5kU2luZ2xlKHRoaXMuY29udGFpbmVyLCAnLmYtdG9vbHRpcC10ZXh0JykuaW5uZXJIVE1MID0gdGhpcy5tZXNzYWdlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUubWF4V2lkdGggPSBgJHt3aW5kb3cuaW5uZXJXaWR0aCAtIDMwfXB4YDtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5taW5XaWR0aCA9ICczNXB4JztcclxuXHJcbiAgICAgICAgaWYgKHRpcFdpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLndpZHRoID0gdGlwV2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGlwSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IHRpcEhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBjb25zdCBvZmZzZXQgPSBEb21IYW5kbGVyLmdldE9mZnNldChib3hFbCk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0VG9wID0gb2Zmc2V0LnRvcDtcclxuICAgICAgICBjb25zdCB0YXJnZXRMZWZ0ID0gb2Zmc2V0LmxlZnQ7XHJcbiAgICAgICAgbGV0IGxlZnQ6IG51bWJlcjtcclxuICAgICAgICBsZXQgdG9wOiBudW1iZXI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcblxyXG4gICAgICAgIHRoaXMuY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGJveEVsKTtcclxuICAgICAgICBjb25zdCBhcnJvdyA9IERvbUhhbmRsZXIuZmluZFNpbmdsZSh0aGlzLmNvbnRhaW5lciwgJy5mLXRvb2x0aXAtYXJyb3cnKTtcclxuICAgICAgICBjb25zdCB0b29sdGlwU2l6ZSA9IHRoaXMuZ2V0VG9vbHRpcFNpemUoKTtcclxuXHJcbiAgICAgICAgLy8g5qOA5p+l5YaF5a656auY5bqmXHJcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCAtIDEwIDwgdG9vbHRpcFNpemUuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGAke3dpbmRvdy5pbm5lckhlaWdodCAtIDIwfXB4YDtcclxuXHJcbiAgICAgICAgICAgIHRvb2x0aXBTaXplLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDI1O1xyXG4gICAgICAgICAgICBjb25zdCB0ZXh0Q29udGFpbmVyID0gdGhpcy5nZXRUZXh0Q29udGFpbmVyKCk7XHJcbiAgICAgICAgICAgIHRleHRDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7dG9vbHRpcFNpemUuaGVpZ2h0fXB4YDtcclxuICAgICAgICAgICAgdGV4dENvbnRhaW5lci5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnVwZGF0ZUFycm93UG9zaXRpb24oYXJyb3csIG9mZnNldCwgJGV2ZW50KTtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMucG9zaXRpb24pIHtcclxuICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgbGVmdCA9IHRhcmdldExlZnQgKyBlbFNpemUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB0b3AgPSBuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgbGVmdCA9IHRhcmdldExlZnQgLSB0b29sdGlwU2l6ZS53aWR0aDtcclxuICAgICAgICAgICAgICAgIHRvcCA9IG47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndG9wLWxlZnQnOlxyXG4gICAgICAgICAgICAgICAgdG9wID0gdGFyZ2V0VG9wIC0gdG9vbHRpcFNpemUuaGVpZ2h0IC0gNztcclxuICAgICAgICAgICAgICAgIGxlZnQgPSBuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobGVmdCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS50b3AgPSB0b3AgKyAncHgnO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLnpJbmRleCA9IDk5OTk5OTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUFycm93UG9zaXRpb24oYXJyb3c6IGFueSwgZWxPZmZzZXQ6IHsgdG9wLCBsZWZ0IH0sICRldmVudDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgdG9vbHRpcFNpemUgPSB0aGlzLmdldFRvb2x0aXBTaXplKCk7XHJcbiAgICAgICAgaWYgKHRoaXMucG9zaXRpb24gPT09ICdsZWZ0JyB8fCB0aGlzLnBvc2l0aW9uID09PSAncmlnaHQnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFRvcCA9IGVsT2Zmc2V0LnRvcDtcclxuICAgICAgICAgICAgY29uc3QgaGFsZkhlaWdodCA9IHRvb2x0aXBTaXplLmhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIGxldCB0b3AgPSAxMDtcclxuICAgICAgICAgICAgaWYgKHRhcmdldFRvcCA+IGhhbGZIZWlnaHQgJiYgd2luZG93LmlubmVySGVpZ2h0IC0gdGFyZ2V0VG9wID4gaGFsZkhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdG9wID0gdGFyZ2V0VG9wIC0gdG9vbHRpcFNpemUuaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g6LCD5pW0566t5aS055qE5L2N572uXHJcbiAgICAgICAgICAgIGlmIChhcnJvdykge1xyXG4gICAgICAgICAgICAgICAgYXJyb3cuc3R5bGUudG9wID0gYCR7dGFyZ2V0VG9wIC0gdG9wfXB4YDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRvcDtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucG9zaXRpb24gPT09ICd0b3AtbGVmdCcpIHtcclxuICAgICAgICAgICAgbGV0IGxlZnQgPSAkZXZlbnQucGFnZVggLSB0b29sdGlwU2l6ZS53aWR0aCAvIDI7XHJcblxyXG4gICAgICAgICAgICBpZiAobGVmdCA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gZWxPZmZzZXQubGVmdDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnQgKyB0b29sdGlwU2l6ZS53aWR0aCA+IHdpbmRvdy5pbm5lcldpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gd2luZG93LmlubmVyV2lkdGggLSB0b29sdGlwU2l6ZS53aWR0aCAtIDIwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOiwg+aVtOeureWktOeahOS9jee9rlxyXG4gICAgICAgICAgICBpZiAoYXJyb3cpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkZXZlbnQucGFnZVggLSBsZWZ0ID4gMjgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJGV2ZW50LnBhZ2VYIC0gbGVmdCArIDI4ID4gdG9vbHRpcFNpemUud2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyb3cuc3R5bGUubGVmdCA9IGAke3Rvb2x0aXBTaXplLndpZHRoIC0gMjggfXB4YDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJvdy5zdHlsZS5sZWZ0ID0gYCR7JGV2ZW50LnBhZ2VYIC0gbGVmdCB9cHhgO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxlZnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZShlbFNpemU6IGFueSkge1xyXG4gICAgICAgIGxldCBzdHlsZUNsYXNzID0gdGhpcy50b29sdGlwQ2xzKCk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBpZiAodGhpcy50b29sdGlwU3R5bGVDbGFzcykge1xyXG4gICAgICAgICAgICBzdHlsZUNsYXNzICs9ICcgJyArIHRoaXMudG9vbHRpcFN0eWxlQ2xhc3M7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9IHN0eWxlQ2xhc3M7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvb2x0aXBBcnJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRvb2x0aXBBcnJvdy5jbGFzc05hbWUgPSAnZi10b29sdGlwLWFycm93ICc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodG9vbHRpcEFycm93KTtcclxuXHJcbiAgICAgICAgY29uc3QgdG9vbHRpcFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0b29sdGlwVGV4dC5jbGFzc05hbWUgPSAnZi10b29sdGlwLXRleHQgJztcclxuICAgICAgICB0b29sdGlwVGV4dC5pbm5lckhUTUwgPSB0aGlzLm1lc3NhZ2U7XHJcblxyXG4gICAgICAgIGNvbnN0IG1heFdpZHRoID0gd2luZG93LmlubmVyV2lkdGggLSA1MDtcclxuICAgICAgICB0b29sdGlwVGV4dC5zdHlsZS5tYXhXaWR0aCA9IGAke21heFdpZHRofXB4YDtcclxuXHJcbiAgICAgICAgdG9vbHRpcFRleHQuc3R5bGUud29yZEJyZWFrID0gJ2JyZWFrLWFsbCc7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnBvc2l0aW9uU3R5bGUpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUucG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uU3R5bGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0b29sdGlwVGV4dCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB0b29sdGlwQ2xzKCkge1xyXG4gICAgICAgIHJldHVybiAnZGF0YWdyaWQtY2VsbC10b29sdGlwIGYtdG9vbHRpcCAnICsgdGhpcy5nZXRUaGVtZUNscygpICsgJyBmLXRvb2x0aXAtJyArIHRoaXMucG9zaXRpb24gKyAnICcgKyB0aGlzLmNscztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFRoZW1lQ2xzKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdmLXRvb2x0aXAtJyArIHRoaXMudHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDojrflj5blrr/kuLvlsLrlr7ggKi9cclxuICAgIHByaXZhdGUgZ2V0Qm94U2l6ZU9iaihib3hFbCkge1xyXG4gICAgICAgIGNvbnN0IHAgPSBib3hFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aWR0aDogRG9tSGFuZGxlci5nZXRPdXRlcldpZHRoKGJveEVsKSxcclxuICAgICAgICAgICAgaGVpZ2h0OiBEb21IYW5kbGVyLmdldE91dGVySGVpZ2h0KGJveEVsKSxcclxuICAgICAgICAgICAgbGVmdDogcC5sZWZ0LFxyXG4gICAgICAgICAgICByaWdodDogcC5yaWdodCxcclxuICAgICAgICAgICAgdG9wOiBwLnRvcCxcclxuICAgICAgICAgICAgYm90dG9tOiBwLmJvdHRvbVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOiOt+WPlnRvb2x0aXAg5a655Zmo5bC65a+4ICovXHJcbiAgICBwcml2YXRlIGdldFRvb2x0aXBTaXplKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiBEb21IYW5kbGVyLmdldE91dGVyV2lkdGgodGhpcy5jb250YWluZXIpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IERvbUhhbmRsZXIuZ2V0T3V0ZXJIZWlnaHQodGhpcy5jb250YWluZXIpXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W56qX5Y+j5bC65a+4ICovXHJcbiAgICBwcml2YXRlIGdldFdpbmRvd1NpemUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOagueaNruWGheWuueeahOWkmuWwke+8jOiHquWKqOabtOaUuXRvb2x0aXAg55qE5L2N572uICovXHJcbiAgICBwcml2YXRlIGNoYW5nZVRvb2x0aXBQb3NpdGlvbihib3hFbDogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYm94U2l6ZSA9IHRoaXMuZ2V0Qm94U2l6ZU9iaihib3hFbCk7XHJcbiAgICAgICAgY29uc3QgdG9vbHRpcCA9IHRoaXMuZ2V0VG9vbHRpcFNpemUoKTtcclxuICAgICAgICBjb25zdCB3aW5TaXplID0gdGhpcy5nZXRXaW5kb3dTaXplKCk7XHJcblxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTmFtZSA9IHRoaXMudG9vbHRpcENscygpO1xyXG5cclxuICAgICAgICBpZiAodG9vbHRpcC53aWR0aCA8IHdpblNpemUud2lkdGggJiYgdG9vbHRpcC5oZWlnaHQgPCBib3hTaXplLnRvcCkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLnBvc2l0aW9uID0gJ3RvcC1sZWZ0JztcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsT2Zmc2V0ID0gRG9tSGFuZGxlci5nZXRPZmZzZXQoYm94RWwpO1xyXG4gICAgICAgICAgICBjb25zdCBlbExlZnQgPSBlbE9mZnNldC5sZWZ0O1xyXG4gICAgICAgICAgICBjb25zdCBlbFJpZ2h0ID0gd2luU2l6ZS53aWR0aCAtIGVsTGVmdCAtIGJveFNpemUud2lkdGg7XHJcblxyXG4gICAgICAgICAgICBpZiAoZWxMZWZ0ID4gZWxSaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9ICdsZWZ0JztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSAncmlnaHQnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0b29sVGlwVGV4dFdpZHRoID0gZWxMZWZ0ID4gZWxSaWdodCA/IGVsTGVmdCA6IGVsUmlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHRFbCA9IHRoaXMuZ2V0VGV4dENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICB0ZXh0RWwuc3R5bGUubWF4V2lkdGggPSBgJHt0b29sVGlwVGV4dFdpZHRoIC0gMzB9cHhgO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5tYXhXaWR0aCA9IGAke3Rvb2xUaXBUZXh0V2lkdGh9cHhgO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59XHJcbiJdfQ==
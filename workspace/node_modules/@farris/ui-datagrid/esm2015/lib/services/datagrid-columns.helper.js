/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ColumnFilterType } from './../types/data-column';
import { bindCallback, of } from 'rxjs';
export class DatagridColumnsHelper {
    /**
     * 获取总列数
     * @private
     * @param {?} firstCols
     * @return {?}
     */
    static getColumnTotal(firstCols) {
        /** @type {?} */
        let total = 0;
        firstCols.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            total += (n.colspan || 1);
        }));
        return total;
    }
    // 查找未赋值项的索引
    /**
     * @private
     * @param {?} arr
     * @return {?}
     */
    static findUndefinedItem(arr) {
        for (let i = 0; i < arr.length; i++) {
            if (arr[i] == undefined) {
                return i;
            }
        }
        return -1;
    }
    /**
     * @private
     * @param {?} columns
     * @return {?}
     */
    static getColumnFields(columns) {
        /** @type {?} */
        const aa = [];
        // 根据第一行计算总列数
        /** @type {?} */
        const colTotal = DatagridColumnsHelper.getColumnTotal(columns[0]);
        // 创建空数组
        for (let i = 0; i < columns.length; i++) {
            aa[i] = new Array(colTotal);
        }
        for (let i = 0; i < columns.length; i++) {
            columns[i].forEach((/**
             * @param {?} col
             * @return {?}
             */
            col => {
                /** @type {?} */
                let k = DatagridColumnsHelper.findUndefinedItem(aa[i]);
                if (k >= 0) {
                    /** @type {?} */
                    const field = col.field || col.id || '';
                    for (let c = 0; c < (col.colspan || 1); c++) {
                        for (let r = 0; r < (col.rowspan || 1); r++) {
                            aa[i + r][k] = field;
                        }
                        k++;
                    }
                }
            }));
        }
        return aa;
    }
    /**
     * @param {?} col
     * @param {?} ins
     * @return {?}
     */
    static columnIsVisible(col, ins) {
        if (col.visible === undefined) {
            col.visible = true;
        }
        /** @type {?} */
        const t = typeof col.visible;
        if (t === 'boolean') {
            return col.visible;
        }
        else if (t === 'function') {
            return col.visible({ instance: ins, column: col });
        }
        else {
            return true;
        }
    }
    /**
     * @param {?} columns
     * @return {?}
     */
    static getFields(columns) {
        // 移除隐藏的列
        /** @type {?} */
        const _cols = columns.map((/**
         * @param {?} cols
         * @return {?}
         */
        cols => {
            cols = cols.filter((/**
             * @param {?} col
             * @return {?}
             */
            col => DatagridColumnsHelper.columnIsVisible(col, DatagridColumnsHelper.gridInstance)));
            return cols;
        }));
        /** @type {?} */
        const fields = DatagridColumnsHelper.getColumnFields(_cols);
        return fields.length ? fields[fields.length - 1] : fields;
    }
    /**
     * @param {?} column
     * @return {?}
     */
    static getFilterEnumOptions(column) {
        /** @type {?} */
        let enumSetting = null;
        if (column.filter.type === ColumnFilterType.enum) {
            /** @type {?} */
            const fmt = (/** @type {?} */ (column.formatter));
            if (fmt) {
                enumSetting = fmt.options;
            }
            else {
                if (column.filter.options) {
                    enumSetting = column.filter.options;
                }
            }
        }
        return enumSetting;
    }
    /**
     * @param {?} enumOpts
     * @param {?} value1
     * @return {?}
     */
    static getEnumText(enumOpts, value1) {
        if (!enumOpts) {
            return '';
        }
        const { valueField, textField, data } = enumOpts;
        /** @type {?} */
        let str = '';
        if (value1) {
            str += ` ${value1.map((/**
             * @param {?} v
             * @return {?}
             */
            v => {
                /** @type {?} */
                const enumItem = data.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => d[valueField] === v));
                return enumItem[textField];
            })).join(',')}`;
        }
        return str;
    }
    /**
     * @param {?} col
     * @return {?}
     */
    static columnVisibleAsObservable(col) {
        if (typeof col.visible === 'function') {
            /** @type {?} */
            const visibleAsObservable = bindCallback(col.visible);
            return visibleAsObservable();
        }
        return of(col.visible);
    }
    /**
     * @param {?} col
     * @param {?} allCols
     * @return {?}
     */
    static getParentColumns(col, allCols) {
        /** @type {?} */
        const arr = [];
        /** @type {?} */
        const _getParents = (/**
         * @param {?} c
         * @return {?}
         */
        (c) => {
            if (c && c.parentId) {
                /** @type {?} */
                const parentCol = allCols.find((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.id === c.parentId));
                // arr.splice(0, 0, parentCol);
                arr.push(parentCol);
                _getParents(parentCol);
            }
        });
        _getParents(col);
        return arr;
    }
    /**
     * @param {?} col
     * @param {?} allCols
     * @return {?}
     */
    static getChildColumns(col, allCols) {
        /** @type {?} */
        const arr = [];
        /** @type {?} */
        const _getChilds = (/**
         * @param {?} c
         * @return {?}
         */
        (c) => {
            if (c && c.parentId) {
                /** @type {?} */
                const childs = allCols.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.parentId === c.id));
                arr.splice(0, 0, ...childs);
                childs.forEach((/**
                 * @param {?} child
                 * @return {?}
                 */
                child => {
                    _getChilds(child);
                }));
            }
        });
        _getChilds(col);
        return arr;
    }
    // 检查多表头时，设计器中将列设为隐藏
    /**
     * @param {?} allCols
     * @return {?}
     */
    static checkGroupHeaderColumnVisible(allCols) {
        /** @type {?} */
        const hiddenFields = allCols.filter((/**
         * @param {?} n
         * @return {?}
         */
        n => n.visible === false)).map((/**
         * @param {?} n
         * @return {?}
         */
        n => n.field));
        hiddenFields.forEach((/**
         * @param {?} field
         * @return {?}
         */
        field => {
            /** @type {?} */
            const _col = allCols.find((/**
             * @param {?} col
             * @return {?}
             */
            col => col.field === field || col.id === field));
            if (_col) {
                /** @type {?} */
                const parents = DatagridColumnsHelper.getParentColumns(_col, allCols);
                parents.forEach((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => {
                    /** @type {?} */
                    const _childs = allCols.filter((/**
                     * @param {?} n
                     * @return {?}
                     */
                    n => n.parentId === p.id && (n.visible || n.visible === undefined)));
                    p.colspan = _childs.reduce((/**
                     * @param {?} r
                     * @param {?} c
                     * @return {?}
                     */
                    (r, c) => {
                        r = r + (c.colspan || 1);
                        return r;
                    }), 0);
                    p.visible = !!p.colspan;
                }));
            }
        }));
    }
    // 多表头下仅有一列显示
    /**
     * @return {?}
     */
    static onlyOneColumn() {
    }
}
DatagridColumnsHelper.gridInstance = null;
if (false) {
    /** @type {?} */
    DatagridColumnsHelper.gridInstance;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtY29sdW1ucy5oZWxwZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLWNvbHVtbnMuaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWMsZ0JBQWdCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN0RSxPQUFPLEVBQUUsWUFBWSxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV4QyxNQUFNLE9BQU8scUJBQXFCOzs7Ozs7O0lBS3RCLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBZ0I7O1lBQ3RDLEtBQUssR0FBRyxDQUFDO1FBQ2IsU0FBUyxDQUFDLE9BQU87Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUNsQixLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzlCLENBQUMsRUFBQyxDQUFDO1FBQ0gsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQzs7Ozs7OztJQUdPLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHO1FBQ2hDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2pDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLFNBQVMsRUFBRTtnQkFDckIsT0FBTyxDQUFDLENBQUM7YUFDWjtTQUNKO1FBQ0QsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNkLENBQUM7Ozs7OztJQUVPLE1BQU0sQ0FBQyxlQUFlLENBQUMsT0FBTzs7Y0FDNUIsRUFBRSxHQUFHLEVBQUU7OztjQUVQLFFBQVEsR0FBRyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLFFBQVE7UUFDUixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxD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Q0FBQztJQUNQLENBQUM7Ozs7O0lBR0QsTUFBTSxDQUFDLGFBQWE7SUFFcEIsQ0FBQzs7QUFuS00sa0NBQVksR0FBRyxJQUFJLENBQUM7OztJQUEzQixtQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhQ29sdW1uLCBDb2x1bW5GaWx0ZXJUeXBlIH0gZnJvbSAnLi8uLi90eXBlcy9kYXRhLWNvbHVtbic7XHJcbmltcG9ydCB7IGJpbmRDYWxsYmFjaywgb2YgfSBmcm9tICdyeGpzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBEYXRhZ3JpZENvbHVtbnNIZWxwZXIge1xyXG5cclxuICAgIHN0YXRpYyBncmlkSW5zdGFuY2UgPSBudWxsO1xyXG5cclxuICAgIC8qKiDojrflj5bmgLvliJfmlbAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIGdldENvbHVtblRvdGFsKGZpcnN0Q29sczogYW55W10pIHtcclxuICAgICAgICBsZXQgdG90YWwgPSAwO1xyXG4gICAgICAgIGZpcnN0Q29scy5mb3JFYWNoKG4gPT4ge1xyXG4gICAgICAgICAgICB0b3RhbCArPSAobi5jb2xzcGFuIHx8IDEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0b3RhbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmn6Xmib7mnKrotYvlgLzpobnnmoTntKLlvJVcclxuICAgIHByaXZhdGUgc3RhdGljIGZpbmRVbmRlZmluZWRJdGVtKGFycikge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChhcnJbaV0gPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2V0Q29sdW1uRmllbGRzKGNvbHVtbnMpIHtcclxuICAgICAgICBjb25zdCBhYSA9IFtdO1xyXG4gICAgICAgIC8vIOagueaNruesrOS4gOihjOiuoeeul+aAu+WIl+aVsFxyXG4gICAgICAgIGNvbnN0IGNvbFRvdGFsID0gRGF0YWdyaWRDb2x1bW5zSGVscGVyLmdldENvbHVtblRvdGFsKGNvbHVtbnNbMF0pO1xyXG4gICAgICAgIC8vIOWIm+W7uuepuuaVsOe7hFxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBhYVtpXSA9IG5ldyBBcnJheShjb2xUb3RhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb2x1bW5zW2ldLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBrID0gRGF0YWdyaWRDb2x1bW5zSGVscGVyLmZpbmRVbmRlZmluZWRJdGVtKGFhW2ldKTtcclxuICAgICAgICAgICAgICAgIGlmIChrID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGNvbC5maWVsZCB8fCBjb2wuaWQgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCAoY29sLmNvbHNwYW4gfHwgMSk7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IChjb2wucm93c3BhbiB8fCAxKTsgcisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYVtpICsgcl1ba10gPSBmaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBrKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFhO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjb2x1bW5Jc1Zpc2libGUoY29sOiBhbnksIGluczogYW55KSB7XHJcbiAgICAgICAgaWYgKGNvbC52aXNpYmxlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY29sLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdCA9IHR5cGVvZiBjb2wudmlzaWJsZTtcclxuICAgICAgICBpZiAodCA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2wudmlzaWJsZTtcclxuICAgICAgICB9IGVsc2UgaWYgKCB0ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2wudmlzaWJsZSh7aW5zdGFuY2U6IGlucywgY29sdW1uOiBjb2x9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEZpZWxkcyhjb2x1bW5zKSB7XHJcbiAgICAgICAgLy8g56e76Zmk6ZqQ6JeP55qE5YiXXHJcbiAgICAgICAgY29uc3QgX2NvbHMgPSBjb2x1bW5zLm1hcChjb2xzID0+IHtcclxuICAgICAgICAgICAgY29scyA9IGNvbHMuZmlsdGVyKGNvbCA9PiBEYXRhZ3JpZENvbHVtbnNIZWxwZXIuY29sdW1uSXNWaXNpYmxlKGNvbCwgRGF0YWdyaWRDb2x1bW5zSGVscGVyLmdyaWRJbnN0YW5jZSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gY29scztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgZmllbGRzID0gIERhdGFncmlkQ29sdW1uc0hlbHBlci5nZXRDb2x1bW5GaWVsZHMoX2NvbHMpO1xyXG4gICAgICAgIHJldHVybiBmaWVsZHMubGVuZ3RoID8gZmllbGRzW2ZpZWxkcy5sZW5ndGggLSAxXSA6IGZpZWxkcztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0RmlsdGVyRW51bU9wdGlvbnMoY29sdW1uOiBEYXRhQ29sdW1uKSB7XHJcbiAgICAgICAgbGV0IGVudW1TZXR0aW5nID0gbnVsbDtcclxuICAgICAgICBpZiAoY29sdW1uLmZpbHRlci50eXBlID09PSBDb2x1bW5GaWx0ZXJUeXBlLmVudW0pIHtcclxuICAgICAgICAgICAgY29uc3QgZm10ID0gY29sdW1uLmZvcm1hdHRlciBhcyBhbnk7XHJcbiAgICAgICAgICAgIGlmIChmbXQpIHtcclxuICAgICAgICAgICAgICAgIGVudW1TZXR0aW5nID0gZm10Lm9wdGlvbnM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uLmZpbHRlci5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW51bVNldHRpbmcgPSBjb2x1bW4uZmlsdGVyLm9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBlbnVtU2V0dGluZztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0RW51bVRleHQoZW51bU9wdHM6IGFueSwgdmFsdWUxOiBhbnkpIHtcclxuICAgICAgICBpZiAoIWVudW1PcHRzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAgJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgdmFsdWVGaWVsZCwgdGV4dEZpZWxkLCBkYXRhIH0gPSBlbnVtT3B0cztcclxuICAgICAgICBsZXQgc3RyID0gJyc7XHJcbiAgICAgICAgaWYgKHZhbHVlMSkge1xyXG4gICAgICAgICAgICBzdHIgKz0gYCAke3ZhbHVlMS5tYXAodiA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbnVtSXRlbSA9IGRhdGEuZmluZChkID0+IGRbdmFsdWVGaWVsZF0gPT09IHYpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVudW1JdGVtW3RleHRGaWVsZF07XHJcbiAgICAgICAgICAgIH0pLmpvaW4oJywnKX1gO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjb2x1bW5WaXNpYmxlQXNPYnNlcnZhYmxlKGNvbDogRGF0YUNvbHVtbikge1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29sLnZpc2libGUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc3QgdmlzaWJsZUFzT2JzZXJ2YWJsZSA9IGJpbmRDYWxsYmFjayhjb2wudmlzaWJsZSk7XHJcbiAgICAgICAgICAgIHJldHVybiB2aXNpYmxlQXNPYnNlcnZhYmxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZihjb2wudmlzaWJsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldFBhcmVudENvbHVtbnMoY29sOiBEYXRhQ29sdW1uLCBhbGxDb2xzKSB7XHJcbiAgICAgICAgY29uc3QgYXJyID0gW107XHJcbiAgICAgICAgY29uc3QgX2dldFBhcmVudHMgPSAoYykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYyAmJiBjLnBhcmVudElkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRDb2wgPSBhbGxDb2xzLmZpbmQobiA9PiBuLmlkID09PSBjLnBhcmVudElkKTtcclxuICAgICAgICAgICAgICAgIC8vIGFyci5zcGxpY2UoMCwgMCwgcGFyZW50Q29sKTtcclxuICAgICAgICAgICAgICAgIGFyci5wdXNoKHBhcmVudENvbCk7XHJcbiAgICAgICAgICAgICAgICBfZ2V0UGFyZW50cyhwYXJlbnRDb2wpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfZ2V0UGFyZW50cyhjb2wpO1xyXG4gICAgICAgIHJldHVybiBhcnI7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldENoaWxkQ29sdW1ucyhjb2w6IERhdGFDb2x1bW4sIGFsbENvbHMpIHtcclxuICAgICAgICBjb25zdCBhcnIgPSBbXTtcclxuICAgICAgICBjb25zdCBfZ2V0Q2hpbGRzID0gKGMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGMgJiYgYy5wYXJlbnRJZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGRzID0gYWxsQ29scy5maWx0ZXIobiA9PiBuLnBhcmVudElkID09PSBjLmlkKTtcclxuICAgICAgICAgICAgICAgIGFyci5zcGxpY2UoMCwgMCwgLi4uY2hpbGRzKTtcclxuICAgICAgICAgICAgICAgIGNoaWxkcy5mb3JFYWNoKGNoaWxkID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBfZ2V0Q2hpbGRzKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBfZ2V0Q2hpbGRzKGNvbCk7XHJcbiAgICAgICAgcmV0dXJuIGFycjtcclxuICAgIH1cclxuXHJcbiAgICAvLyDmo4Dmn6XlpJrooajlpLTml7bvvIzorr7orqHlmajkuK3lsIbliJforr7kuLrpmpDol49cclxuICAgIHN0YXRpYyBjaGVja0dyb3VwSGVhZGVyQ29sdW1uVmlzaWJsZShhbGxDb2xzKSB7XHJcbiAgICAgICAgY29uc3QgaGlkZGVuRmllbGRzID0gYWxsQ29scy5maWx0ZXIobiA9PiBuLnZpc2libGUgPT09IGZhbHNlKS5tYXAobiA9PiBuLmZpZWxkKTtcclxuICAgICAgICBoaWRkZW5GaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IF9jb2wgPSBhbGxDb2xzLmZpbmQoY29sID0+IGNvbC5maWVsZCA9PT0gZmllbGQgfHwgY29sLmlkID09PSBmaWVsZCk7XHJcbiAgICAgICAgICAgIGlmIChfY29sKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRzID0gRGF0YWdyaWRDb2x1bW5zSGVscGVyLmdldFBhcmVudENvbHVtbnMoX2NvbCwgYWxsQ29scyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcGFyZW50cy5mb3JFYWNoKHAgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IF9jaGlsZHMgPSBhbGxDb2xzLmZpbHRlcihuID0+IG4ucGFyZW50SWQgPT09IHAuaWQgJiYgKG4udmlzaWJsZSB8fCBuLnZpc2libGUgPT09IHVuZGVmaW5lZCkgKTtcclxuICAgICAgICAgICAgICAgICAgICBwLmNvbHNwYW4gPSBfY2hpbGRzLnJlZHVjZSgoIHIsIGMgKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSByICsgKGMuY29sc3BhbiB8fCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcC52aXNpYmxlID0gISFwLmNvbHNwYW47XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWkmuihqOWktOS4i+S7heacieS4gOWIl+aYvuekulxyXG4gICAgc3RhdGljIG9ubHlPbmVDb2x1bW4oKSB7XHJcblxyXG4gICAgfVxyXG59XHJcbiJdfQ==
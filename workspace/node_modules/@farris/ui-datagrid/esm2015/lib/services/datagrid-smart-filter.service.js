/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { ColumnFilterType } from '../types/data-column';
import { BooleanFilterControl, DateFilterControl, EnumFilterControl, NumberFilterControl, TextFilterControl } from '../plugins/smart-filter/controlData/filter-control.options';
export class DatagridSmartFilterService {
    constructor() {
        this.conditions = [];
        this.controlData = [];
        this.filterChanged = new Subject();
        this.removeFilter = new Subject();
        this.clearAllFilter = new Subject();
    }
    /**
     * @param {?} col
     * @return {?}
     */
    getColumnFilterData(col) {
        /** @type {?} */
        let filterControlData = {
            controltype: 'text',
        };
        if (col.filter !== undefined) {
            if (typeof col.filter === 'boolean') {
                if (col.formatter) {
                    if (typeof col.formatter === 'object' && Object.keys(col.formatter).length) {
                        /** @type {?} */
                        const options = col.formatter['options'];
                        switch (col.formatter['type']) {
                            case 'number':
                                return NumberFilterControl(col);
                            case 'enum':
                                return EnumFilterControl(col, options);
                            case 'boolean':
                                return BooleanFilterControl(col);
                            case 'datetime':
                                /** @type {?} */
                                let tye = 'datetime';
                                /** @type {?} */
                                let fmt = 'yyyy-MM-dd';
                                /** @type {?} */
                                let returnFmt = 'yyyy-MM-dd';
                                if (options && options.format) {
                                    fmt = options.format;
                                    if (fmt.indexOf('HH:') == -1) {
                                        tye = 'date';
                                    }
                                    else {
                                        returnFmt += ' HH:mm';
                                        if (fmt.indexOf('ss') > -1) {
                                            returnFmt += ':ss';
                                        }
                                    }
                                }
                                else {
                                    tye = 'date';
                                }
                                filterControlData = {
                                    controltype: 'flexibleDate',
                                    dateFormat: fmt,
                                    single: false,
                                    showType: 3,
                                    showTime: tye === 'datetime'
                                };
                                break;
                            default:
                                return TextFilterControl(col);
                        }
                    }
                }
                return filterControlData;
            }
            else {
                switch (col.filter.type) {
                    case ColumnFilterType.enum:
                        return EnumFilterControl(col, col.filter.options);
                    case ColumnFilterType.date:
                    case ColumnFilterType.datetime:
                        return DateFilterControl(col, col.filter.options);
                    case ColumnFilterType.number:
                        return NumberFilterControl(col);
                    case ColumnFilterType.boolean:
                        return BooleanFilterControl(col);
                }
            }
        }
        return filterControlData;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    filterConditionChanged(e) {
        /** @type {?} */
        const items = e.conditions;
        if (!this.conditions || !this.conditions.length) {
            this.conditions.push(...items);
            this.controlData.push(Object.assign({}, e.controlData));
        }
        else {
            /// TODO, CONTROLDATA 的索引与conditions 的索引很可能不是1个
            if (e.from === 'toolbar') {
                this.conditions = [...items];
            }
            else {
                this.conditions = this.conditions.filter((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.FilterField !== items[0].FilterField));
                if (items.length === 1) {
                    this.conditions.push(Object.assign({}, items[0]));
                }
                else {
                    this.conditions.push(...items);
                }
            }
            if (e.controlData) {
                /** @type {?} */
                const ctrlIdx = this.controlData.findIndex((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => n.labelCode === e.controlData.labelCode));
                if (ctrlIdx > -1) {
                    this.controlData[ctrlIdx] = Object.assign({}, e.controlData);
                }
                else {
                    this.controlData.push(Object.assign({}, e.controlData));
                }
            }
        }
        this.filterChanged.next({ conditions: [...this.conditions], controlData: [...this.controlData] });
    }
    /**
     * @param {?} e
     * @param {?=} emitRemove
     * @return {?}
     */
    removeCondition(e, emitRemove = false) {
        if (this.conditions && this.conditions.length) {
            this.conditions = this.conditions.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.FilterField !== e.labelCode));
            this.controlData = this.controlData.filter((/**
             * @param {?} n
             * @return {?}
             */
            n => n.labelCode !== e.labelCode));
        }
        this.filterChanged.next({ conditions: [...this.conditions], controlData: [...this.controlData] });
        if (emitRemove) {
            this.removeFilter.next(e);
        }
    }
    /**
     * @return {?}
     */
    clearAll() {
        this.conditions = [];
        this.controlData = [];
        this.clearAllFilter.next(null);
    }
}
DatagridSmartFilterService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DatagridSmartFilterService.ctorParameters = () => [];
if (false) {
    /**
     * @type {?}
     * @private
     */
    DatagridSmartFilterService.prototype.conditions;
    /** @type {?} */
    DatagridSmartFilterService.prototype.controlData;
    /** @type {?} */
    DatagridSmartFilterService.prototype.filterChanged;
    /** @type {?} */
    DatagridSmartFilterService.prototype.removeFilter;
    /** @type {?} */
    DatagridSmartFilterService.prototype.clearAllFilter;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YWdyaWQtc21hcnQtZmlsdGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWRhdGFncmlkLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RhdGFncmlkLXNtYXJ0LWZpbHRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFeEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGlCQUFpQixFQUFFLGlCQUFpQixFQUMzRCxtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDREQUE0RCxDQUFDO0FBR25ILE1BQU0sT0FBTywwQkFBMEI7SUFTbkM7UUFSUSxlQUFVLEdBQVUsRUFBRSxDQUFDO1FBQy9CLGdCQUFXLEdBQVEsRUFBRSxDQUFDO1FBRXRCLGtCQUFhLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUU5QixpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFDN0IsbUJBQWMsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBRWYsQ0FBQzs7Ozs7SUFHakIsbUJBQW1CLENBQUMsR0FBUTs7WUFDcEIsaUJBQWlCLEdBQVE7WUFDekIsV0FBVyxFQUFFLE1BQU07U0FDdEI7UUFDRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssU0FBUyxFQUFFO1lBQzFCLElBQUksT0FBTyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDakMsSUFBSSxHQUFHLENBQUMsU0FBUyxFQUFFO29CQUNmLElBQUksT0FBTyxHQUFHLENBQUMsU0FBUyxLQUFLLFFBQVEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUU7OzhC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SUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUU7WUFDM0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU07Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLEtBQUssQ0FBQyxDQUFDLFNBQVMsRUFBQyxDQUFDO1lBQzdFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxLQUFLLENBQUMsQ0FBQyxTQUFTLEVBQUMsQ0FBQztTQUNoRjtRQUNELElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUMsVUFBVSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pHLElBQUksVUFBVSxFQUFFO1lBQ1osSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0I7SUFDTCxDQUFDOzs7O0lBRUQsUUFBUTtRQUNKLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLENBQUM7OztZQS9ISixVQUFVOzs7Ozs7Ozs7SUFFUCxnREFBK0I7O0lBQy9CLGlEQUFzQjs7SUFFdEIsbURBQThCOztJQUU5QixrREFBNkI7O0lBQzdCLG9EQUErQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDb2x1bW5GaWx0ZXJUeXBlIH0gZnJvbSAnLi4vdHlwZXMvZGF0YS1jb2x1bW4nO1xyXG5cclxuaW1wb3J0IHsgQm9vbGVhbkZpbHRlckNvbnRyb2wsIERhdGVGaWx0ZXJDb250cm9sLCBFbnVtRmlsdGVyQ29udHJvbCxcclxuICAgICAgICBOdW1iZXJGaWx0ZXJDb250cm9sLCBUZXh0RmlsdGVyQ29udHJvbCB9IGZyb20gJy4uL3BsdWdpbnMvc21hcnQtZmlsdGVyL2NvbnRyb2xEYXRhL2ZpbHRlci1jb250cm9sLm9wdGlvbnMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRGF0YWdyaWRTbWFydEZpbHRlclNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBjb25kaXRpb25zOiBhbnlbXSA9IFtdO1xyXG4gICAgY29udHJvbERhdGE6IGFueSA9IFtdO1xyXG5cclxuICAgIGZpbHRlckNoYW5nZWQgPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAgIHJlbW92ZUZpbHRlciA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjbGVhckFsbEZpbHRlciA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcblxyXG4gICAgZ2V0Q29sdW1uRmlsdGVyRGF0YShjb2w6IGFueSkge1xyXG4gICAgICAgIGxldCBmaWx0ZXJDb250cm9sRGF0YTogYW55ID0ge1xyXG4gICAgICAgICAgICBjb250cm9sdHlwZTogJ3RleHQnLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGNvbC5maWx0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5maWx0ZXIgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbC5mb3JtYXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbC5mb3JtYXR0ZXIgPT09ICdvYmplY3QnICYmIE9iamVjdC5rZXlzKGNvbC5mb3JtYXR0ZXIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zOiBhbnkgPSBjb2wuZm9ybWF0dGVyWydvcHRpb25zJ107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY29sLmZvcm1hdHRlclsndHlwZSddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJGaWx0ZXJDb250cm9sKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlbnVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRW51bUZpbHRlckNvbnRyb2woY29sLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuRmlsdGVyQ29udHJvbChjb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGF0ZXRpbWUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0eWUgPSAnZGF0ZXRpbWUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmbXQgPSAneXl5eS1NTS1kZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJldHVybkZtdCA9ICd5eXl5LU1NLWRkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZtdC5pbmRleE9mKCdISDonKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHllID0gJ2RhdGUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRm10ICs9ICcgSEg6bW0nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZtdC5pbmRleE9mKCdzcycpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5GbXQgKz0gJzpzcyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eWUgPSAnZGF0ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckNvbnRyb2xEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sdHlwZTogJ2ZsZXhpYmxlRGF0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQ6IGZtdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1R5cGU6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUaW1lOiB0eWUgPT09ICdkYXRldGltZSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVGV4dEZpbHRlckNvbnRyb2woY29sKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJDb250cm9sRGF0YTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY29sLmZpbHRlci50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmVudW06XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBFbnVtRmlsdGVyQ29udHJvbChjb2wsIGNvbC5maWx0ZXIub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGU6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmRhdGV0aW1lOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZUZpbHRlckNvbnRyb2woY29sLCBjb2wuZmlsdGVyLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQ29sdW1uRmlsdGVyVHlwZS5udW1iZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJGaWx0ZXJDb250cm9sKGNvbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBDb2x1bW5GaWx0ZXJUeXBlLmJvb2xlYW46XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuRmlsdGVyQ29udHJvbChjb2wpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmlsdGVyQ29udHJvbERhdGE7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBmaWx0ZXJDb25kaXRpb25DaGFuZ2VkKGU6IHtjb25kaXRpb25zOiBhbnlbXSwgY29udHJvbERhdGE6IGFueSwgZnJvbTogJ3Rvb2xiYXInIHwgJ3BhbmVsJ30pIHtcclxuICAgICAgICBjb25zdCBpdGVtcyA9IGUuY29uZGl0aW9ucztcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbmRpdGlvbnMgfHwgIXRoaXMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2goLi4uaXRlbXMpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xEYXRhLnB1c2goey4uLmUuY29udHJvbERhdGF9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLy8gVE9ETywgQ09OVFJPTERBVEEg55qE57Si5byV5LiOY29uZGl0aW9ucyDnmoTntKLlvJXlvojlj6/og73kuI3mmK8x5LiqXHJcbiAgICAgICAgICAgIGlmIChlLmZyb20gPT09ICd0b29sYmFyJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gWy4uLml0ZW1zXTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IHRoaXMuY29uZGl0aW9ucy5maWx0ZXIobiA9PiBuLkZpbHRlckZpZWxkICE9PSBpdGVtc1swXS5GaWx0ZXJGaWVsZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2goeyAuLi5pdGVtc1swXSB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnB1c2goLi4uaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZS5jb250cm9sRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3RybElkeCA9IHRoaXMuY29udHJvbERhdGEuZmluZEluZGV4KG4gPT4gbi5sYWJlbENvZGUgPT09IGUuY29udHJvbERhdGEubGFiZWxDb2RlKTtcclxuICAgICAgICAgICAgICAgIGlmIChjdHJsSWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xEYXRhW2N0cmxJZHhdID0gey4uLmUuY29udHJvbERhdGF9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xEYXRhLnB1c2goey4uLmUuY29udHJvbERhdGF9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VkLm5leHQoe2NvbmRpdGlvbnM6IFsuLi50aGlzLmNvbmRpdGlvbnNdLCBjb250cm9sRGF0YTogWy4uLnRoaXMuY29udHJvbERhdGFdIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUNvbmRpdGlvbihlLCBlbWl0UmVtb3ZlID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAodGhpcy5jb25kaXRpb25zICYmIHRoaXMuY29uZGl0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gdGhpcy5jb25kaXRpb25zLmZpbHRlcihuID0+IG4uRmlsdGVyRmllbGQgIT09IGUubGFiZWxDb2RlKTtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sRGF0YSA9IHRoaXMuY29udHJvbERhdGEuZmlsdGVyKG4gPT4gbi5sYWJlbENvZGUgIT09IGUubGFiZWxDb2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5maWx0ZXJDaGFuZ2VkLm5leHQoe2NvbmRpdGlvbnM6IFsuLi50aGlzLmNvbmRpdGlvbnNdLCBjb250cm9sRGF0YTogWy4uLnRoaXMuY29udHJvbERhdGFdIH0pO1xyXG4gICAgICAgIGlmIChlbWl0UmVtb3ZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRmlsdGVyLm5leHQoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyQWxsKCkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMuY29udHJvbERhdGEgPSBbXTtcclxuICAgICAgICB0aGlzLmNsZWFyQWxsRmlsdGVyLm5leHQobnVsbCk7XHJcbiAgICB9XHJcbn1cclxuIl19
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("lodash-es"),require("bignumber.js"),require("@farris/ui-common"),require("@farris/ui-locale"),require("@farris/ui-common/types"),require("@angular/common"),require("perfect-scrollbar"),require("resize-observer-polyfill"),require("@farris/ui-filter-panel"),require("@angular/platform-browser"),require("@farris/ui-common/column"),require("@angular/forms"),require("@farris/ui-notify"),require("@farris/ui-pagination"),require("@farris/ui-filter"),require("@farris/smooth-dnd"),require("@farris/ui-context-menu")):"function"==typeof define&&define.amd?define("@farris/ui-datagrid",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","lodash-es","bignumber.js","@farris/ui-common","@farris/ui-locale","@farris/ui-common/types","@angular/common","perfect-scrollbar","resize-observer-polyfill","@farris/ui-filter-panel","@angular/platform-browser","@farris/ui-common/column","@angular/forms","@farris/ui-notify","@farris/ui-pagination","@farris/ui-filter","@farris/smooth-dnd","@farris/ui-context-menu"],e):e(((t=t||self).farris=t.farris||{},t.farris["ui-datagrid"]={}),t.ng.core,t.ng.common.http,t.rxjs,t.rxjs.operators,t.lodashEs,t.bignumber_js,t.uiCommon,t.uiLocale,t.types,t.ng.common,t.PerfectScrollbar,t.ResizeObserver,t.uiFilterPanel,t.ng.platformBrowser,t.column,t.ng.forms,t.uiNotify,t.uiPagination,t.uiFilter,t.smoothDnd,t.uiContextMenu)}(this,function(t,e,i,r,n,o,s,l,a,d,c,h,u,p,f,g,m,y,w,v,b,C){"use strict";h=h&&h.hasOwnProperty("default")?h["default"]:h,u=u&&u.hasOwnProperty("default")?u["default"]:u;var x=function(){return(x=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function S(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,o=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(l){n={error:l}}finally{try{r&&!r.done&&(i=o["return"])&&i.call(o)}finally{if(n)throw n.error}}return s}function R(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(S(arguments[e]));return t}var E={string:0,number:1,boolean:2,date:3,time:4,datetime:5,"enum":6,fromdata:7};E[E.string]="string",E[E.number]="number",E[E.boolean]="boolean",E[E.date]="date",E[E.time]="time",E[E.datetime]="datetime",E[E["enum"]]="enum",E[E.fromdata]="fromdata";var I={none:-1,max:0,min:1,sum:2,average:3,count:4};I[I.none]="none",I[I.max]="max",I[I.min]="min",I[I.sum]="sum",I[I.average]="average",I[I.count]="count";var k=new e.InjectionToken("Farris DataGrid Editors."),F=new e.InjectionToken("Farris DataGrid Validators."),_=new e.InjectionToken("Farris DataGrid Filter-Row Component."),D=new e.InjectionToken("Farris DataGrid Setting Panel Component."),T=new e.InjectionToken("Farris DataGrid Setting Service."),O=new e.InjectionToken(" Datagrid Settings HttpClient."),H="psScrollX",P="psXReachEnd",L="psXReachStart",A="f-datagrid-fixed-left-shadow",j="f-datagrid-cell-selected",M="f-datagrid-cell-editing",G={sm:{row:29,header:35,pager:40},md:{row:36,header:40,pager:44},lg:{row:46,header:40,pager:44},xl:{row:60,header:40,pager:44}},N={datagrid:"highlight-allowedit-cell",textarea:"cell-textarea",textbox:"cell-textbox",checkbox:"cell-checkbox",datepicker:"cell-datepicker","input-group":"cell-input-group",select:"cell-combolist",lookup:"cell-lookup",numberbox:"cell-numberbox",combolist:"cell-combolist","combo-lookup":"cell-combolist","switch":"cell-switch",timepicker:"cell-timepicker","language-textbox":"cell-language-textbox","enum-editor":"cell-enum-editor"},z={idField:"id",showLineNumber:!1,selections:[],checkedRows:[],currentRow:null,columnsGroup:null,columns:[],fitColumns:!1,onlySelectSelf:!0,selectOnCheck:!0,checkOnSelect:!0,pageIndex:1,pageSize:20,pagerHeight:40,checkboxColumnWidth:36,pagination:!1,virtual:{rowIndex:0,scrollTop:0,topHideHeight:0,bottomHideHeight:0,isScrollChange:!1},sortName:undefined,sortOrder:undefined,multiSort:!1,remoteSort:!0,changes:null,showGroupColumn:!1},V="__row_index__",W="__group__",$="__group_parent_id__",B="__group_footer__",U="__group_visible__",X="__group_level__",q=["afterEdit","app","beforeCheck","beforeClickCell","beforeEdit","beforeSelect","beforeSortColumn","beforeUncheck","beforeUnselect","beginEdit","cancelEdited","cd","cellClick","checkAll","checkValuesChange","checked","checkedChange","clientFilterService","colFormatSer","columnMoved","columnSorted","componentType","dataChange","dblclickRow","destroy$","dfs","dgColumns","dgContainer","dgPager","dgs","domSanitizer","editors","el","endEdit","farrisInstances","filterChanged","footerTemplate","groupFieldChange","groupFields$","inject","lastCellEnterHandle","loadSuccess","localeService","longTextArea","rowAppended","rowClick","rowDeleted","render2","pageSizeChanged","onDocumentMouseDown","pageChanged","resizeProxy","resizeProxyBg","ro","rowUpdated","scrollInstance","scrollY","scrollYLoad","selectAll","selectChanged","sms","selectValueChange","selectValuesChange","settingService","smartFilterService","subscriptions","trackByRows","unCheckAll","unChecked","unSelect","unSelectAll","zone","__component_type__","__pagination","_active_datagrid_cls","_autoFitColumns","_blured_datagrid_cls","_columns","_custom_datagrid_cls","_editable","_fields","_fit","_fitColumns","_footerData","_groupField","_isResized","_loading","_lockPagination","_selectedRow","_showRowGroupPanel","_sizeType","_total"],Y=function(){function t(){}return t.uuid=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.keysInData=function(t,e){return"no property"!=t.split(".").reduce(function(t,e){return t&&t.hasOwnProperty(e)?t[e]:"no property"},e)},t.getValue=function(t,e,i){if(void 0===i&&(i=!1),!e)return"";var r="";return r=-1===t.indexOf(".")||e.hasOwnProperty(t)?e[t]:t.split(".").reduce(function(t,e){return t?t[e]:null},e),i?this.escapeValue(r):r},t.setValue=function(t,e,i,r){if(void 0===r&&(r=!0),t)if(t.indexOf(".")>-1&&r){var n=null,o=t.split(".");o.reduce(function(t,e){return n=t,t[e]},i),n&&(n[o.pop()]=e)}else i[t]=e},t.getMultilingualValue=function(t,e){if(t&&"object"==typeof t&&Object.keys(t).length>0){var i=t[e=e||"zh-CHS"];return i!==undefined?i:""}return""},t.escapeValue=function(t){if(null===t||t===undefined||""===t)return"";return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;"):t},t.eventPath=function(t){var e=t.composedPath&&t.composedPath()||t.path,i=t.target;if(null!=e)return e.indexOf(window)<0?e.concat(window):e;if(i===window)return[window];var r=function(t,e){void 0===e&&(e=undefined),e=e||[];var i=t.parentNode;return i?r(i,e.concat(i)):e};return[i].concat(r(i),window)},t.hasDialogOpen=function(){return document.body.className.indexOf("modal-open")>-1},t.on=function(t,e,i,r){void 0===r&&(r={});var n=function(t){return t.target.matches(r.target)&&i.call(t.target,t)};return t.addEventListener(e,r.target?n:i,r.options||!1),function(){t.removeEventListener(e,n,r)}},t.off=function(t,e,i,r){void 0===i&&(i=function(){}),void 0===r&&(r={}),t.removeEventListener(e,i,r)},t.getBLen=function(t){return null==t?0:("string"!=typeof t&&(t+=""),t.replace(/[^\x00-\xff]/g,"01").length)},t.getWhenEmptyText=function(t,e){var i={"zh-CHS":"请输入","zh-CHT":"請輸入",en:"Please input"};if(t.editor)switch(t.editor.type){case"datepicker":case"select":case"lookup":case"combolist":case"combo-lookup":return{"zh-CHS":"请选择","zh-CHT":"請選擇",en:"Please select"}[e];default:return i[e]}return"_datagrid-setting-control_"===t.field?"":i[e]},t.getRowIdByTr=function(t){if(t){var e=t.getAttribute("id");return null==e||e==undefined?null:e.replace("row_","").replace("_fixedright","").replace("_fixedleft","").replace("_grouprow","")}return null},t.getTrDomById=function(t,e){return e?e.querySelector('[id="'+t+'"]'):null},t}(),K=function(){function t(){}return t.getColumnTotal=function(t){var e=0;return t.forEach(function(t){e+=t.colspan||1}),e},t.findUndefinedItem=function(t){for(var e=0;e<t.length;e++)if(t[e]==undefined)return e;return-1},t.getColumnFields=function(e){for(var i=[],r=t.getColumnTotal(e[0]),n=0;n<e.length;n++)i[n]=new Array(r);var o=function(r){e[r].forEach(function(e){var n=t.findUndefinedItem(i[r]);if(n>=0)for(var o=e.field||e.id||"",s=0;s<(e.colspan||1);s++){for(var l=0;l<(e.rowspan||1);l++)i[r+l][n]=o;n++}})};for(n=0;n<e.length;n++)o(n);return i},t.columnIsVisible=function(t,e){t.visible===undefined&&(t.visible=!0);var i=typeof t.visible;return"boolean"===i?t.visible:"function"!==i||t.visible({instance:e,column:t})},t.getFields=function(e){var i=e.map(function(e){return e=e.filter(function(e){return t.columnIsVisible(e,t.gridInstance)})}),r=t.getColumnFields(i);return r.length?r[r.length-1]:r},t.getFilterEnumOptions=function(t){var e=null;if(t.filter.type===E["enum"]){var i=t.formatter;i?e=i.options:t.filter.options&&(e=t.filter.options)}return e},t.getEnumText=function(t,e){if(!t)return"";var i=t.valueField,r=t.textField,n=t.data,o="";return e&&(o+=" "+e.map(function(t){return n.find(function(e){return e[i]===t})[r]}).join(",")),o},t.columnVisibleAsObservable=function(t){return"function"==typeof t.visible?r.bindCallback(t.visible)():r.of(t.visible)},t.getParentColumns=function(t,e){var i=[],r=function(t){if(t&&t.parentId){var n=e.find(function(e){return e.id===t.parentId});i.push(n),r(n)}};return r(t),i},t.getChildColumns=function(t,e){var i=[],r=function(t){if(t&&t.parentId){var n=e.filter(function(e){return e.parentId===t.id});i.splice.apply(i,R([0,0],n)),n.forEach(function(t){r(t)})}};return r(t),i},t.checkGroupHeaderColumnVisible=function(e){e.filter(function(t){return!1===t.visible}).map(function(t){return t.field}).forEach(function(i){var r=e.find(function(t){return t.field===i||t.id===i});r&&t.getParentColumns(r,e).forEach(function(t){var i=e.filter(function(e){return e.parentId===t.id&&(e.visible||e.visible===undefined)});t.colspan=i.reduce(function(t,e){return t+=e.colspan||1},0),t.visible=!!t.colspan})})},t.onlyOneColumn=function(){},t.gridInstance=null,t}(),Z=function(){function t(t){this.http=t,this.localId="zh-CHS",this.store=new r.BehaviorSubject(null),this.virtualRowSubject=new r.BehaviorSubject(null),this.gridSizeSubject=new r.Subject,this.errorSubject=new r.Subject,this.selectRowSubject=new r.Subject,this.unSelectRowSubject=new r.Subject,this.columnResizeSubject=new r.Subject,this.clearSelectionSubject=new r.Subject,this.checkRowSubject=new r.Subject,this.unCheckRowSubject=new r.Subject,this.clearCheckedsSubject=new r.Subject,this.clearAllSubject=new r.Subject,this.checkAllSubject=new r.Subject,this.unCheckAllSubject=new r.Subject,this.selectAllSubject=new r.Subject,this.selectCellSubject=new r.Subject,this.error$=this.errorSubject.asObservable(),this.selectRow$=this.selectRowSubject.asObservable(),this.unSelectRow$=this.unSelectRowSubject.asObservable(),this.columnResize$=this.columnResizeSubject.asObservable(),this.clearSelections$=this.clearSelectionSubject.asObservable(),this.checkRow$=this.checkRowSubject.asObservable(),this.unCheckRow$=this.unCheckRowSubject.asObservable(),this.clearCheckeds$=this.clearCheckedsSubject.asObservable(),this.clearAll$=this.clearAllSubject.asObservable(),this.checkAll$=this.checkAllSubject.asObservable(),this.unCheckAll$=this.unCheckAllSubject.asObservable(),this.selectAll$=this.selectAllSubject.asObservable(),this.currentCell$=this.selectCellSubject.asObservable(),this.editCell$=new e.EventEmitter,this.clientSort$=new e.EventEmitter,this.rowAppend$=new e.EventEmitter,this.rowUpdate$=new e.EventEmitter,this.rowDelete$=new e.EventEmitter,this.expandGroupRow=new e.EventEmitter,this.collapseGroupRow=new e.EventEmitter,this.updateCheckboxState$=new e.EventEmitter,this.state$=this.store.asObservable().pipe(n.filter(function(t){return t})),this.columnGroup$=this.gridSizeSubject.asObservable().pipe(n.filter(function(t){return t}),n.map(function(t){return t.columnsGroup}),n.switchMap(function(t){return r.of(t)}),n.distinctUntilChanged()),this.gridSize$=this.gridSizeSubject.asObservable().pipe(n.filter(function(t){return t}),n.map(function(t){var e=x({},t);return{headerHeight:e.headerHeight,pagerHeight:e.pagerHeight,width:e.width,columnsGroup:e.columnsGroup,height:e.height,rowHeight:e.rowHeight}}),n.distinctUntilChanged()),this.data$=this.virtualRowSubject.pipe(n.filter(function(t){return t}),n.switchMap(function(t){return r.of({index:t.startIndex||0,rows:t.virtualRows||[],top:t.topHideHeight,bottom:t.bottomHideHeight,scrolling:t.isScrollChange})}),n.distinctUntilChanged()),this.difference=function(t,e){return t.filter(function(t){return!e.includes(t)})},this.differenceBy=function(t,e,i){var r=new Set(e.map(i));return t.map(i).filter(function(t){return!r.has(t)})},this._state=o.cloneDeep(z)}return t.prototype.updateVirthualRows=function(t,e){void 0===e&&(e=!1);var i=this.getVirthualRows(t);i.isScrollChange=e,this.updateState({virtual:i},!1),this.virtualRowSubject.next(i)},t.prototype.getVirthualRows=function(t){var e=this._state.data||[],i={rowIndex:0,virtualRows:e,topHideHeight:0,bottomHideHeight:0};if(0===e.length||this._state.autoHeight&&!this._state.groupRows)return i.virtualRows=e,i;if(this._state.flatColumns&&this._state.flatColumns.length&&this._state.groupRows){var r=this.groupRows2(o.cloneDeep(e));i.virtualRows=r}return this._state.mergeCell&&this._state.enableClientSortForMergeCell&&(i.virtualRows=this.sort(i.virtualRows)),i},t.prototype.getData=function(t){return void 0===t&&(t=!1),t?this._state.originalData||[]:this._state.data||[]},t.prototype.getState=function(){return this._state},t.prototype.getVirtualState=function(){return this._state.virtual},t.prototype.getPageInfo=function(){var t=x({},this._state);return{pageIndex:t.pageIndex,pageSize:t.pageSize}},t.prototype.initState=function(t){this.updateState(t,!1),this._state.originalData=o.cloneDeep(this._state.data),this.initColumns(),this.gridSizeSubject.next(this._state),this.updateVirthualRows(0)},t.prototype.loadData=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),t=t||[],this.updateState({data:t},!1),e&&(this._state.originalData=o.cloneDeep(this._state.data)),i&&this._state.sortName){var r=this.sort(this._state.data);this.updateState({data:r},!1)}this.updateVirthualRows(this._state.virtual.scrollTop||0),this._state.checkedRows=this.getCheckedRowsFromSource()},t.prototype.resetRow=function(t){var e=this,i=this._state.originalData;if(i){var r=i.find(function(i){return e.primaryId(i)===t});this.getCurrentRow().data=o.cloneDeep(r),this.updateRow(t,r)}},t.prototype.fetchData=function(t){return this.http.get(t).pipe(n.map(function(t){return t}))},t.prototype.setTotal=function(t){this.updateState({total:t},!1)},t.prototype.updateProperty=function(t,e){var i;this.updateState(((i={})[t]=e,i),!1)},t.prototype.setPagination=function(t,e,i){this.updateState({pageIndex:t,pageSize:e,total:i},!1)},t.prototype.setScrollTop=function(t){var e=x({},this._state.virtual,{scrollTop:t});this.updateState({virtual:e},!1)},t.prototype.isMultiSelect=function(){return this._state.multiSelect},t.prototype._isRowSelected=function(t){return!(!t||!this._state.currentRow)&&this._state.currentRow.id.toString()===t.toString()},t.prototype.isRowSelected=function(t,e){void 0===e&&(e=null);var i=this._isRowSelected(t);return!this.isMultiSelect()||this._state.onlySelectSelf?i:(e||(e=this._state.selections),this._canCancelSelectWhenMulti()?i:!(!e||0===e.length)&&e.findIndex(function(e){return e.id==t})>-1)},t.prototype.isRowChecked=function(t,e){return void 0===e&&(e=null),e||(e=this.getCheckeds()),!(!t||!e.length)&&e.findIndex(function(e){return e.id.toString()===t.toString()})>-1},t.prototype.isCheckAll=function(){var t=this,e=this.getAllRowsForLive().map(function(e){return t.primaryId(e)}),i=this._state.checkedRows.map(function(t){return t.id});return!this.difference(e,i).length},t.prototype.getCurrentPageCheckeds=function(){var t=this,e=this.getAllRowsForLive().map(function(e){return t.primaryId(e)});return this._state.checkedRows.filter(function(t){return e.indexOf(t.id)>-1})},t.prototype.getCurrentRow=function(){return this._state.currentRow||undefined},t.prototype.getSelections=function(){var t=this,e=this._state.data;if(this._state.selections&&this._state.selections.length)if(e&&e.length){var i=e.map(function(e){return t.primaryId(e)});this._state.selections=this._state.selections.filter(function(t){return i.includes(t.id)})}else this._state.selections=[];return this._state.selections||[]},t.prototype.getCheckedRowsFromSource=function(){var t=this;return(this._state.checkedRows||[]).map(function(e){var i=t.findRow(e.id);return i&&i.data&&(e.data=i.data),e})},t.prototype.getCheckeds=function(t){return void 0===t&&(t=!1),t&&(this._state.checkedRows=this.getCheckedRowsFromSource()),this._state.checkedRows||[]},t.prototype.updateCheckedData=function(t,e){var i=this,r=this.getCheckeds();if(r.length){var n=r.find(function(e){return i.primaryId(e)==t});n&&Object.keys(e).forEach(function(t){Y.setValue(t,e[t],n.data)})}},t.prototype.setCheckedRows=function(t,e){var i=this;if(void 0===e&&(e=!0),t&&t.length){var r=this._state.checkedRows||[];t.forEach(function(t){var n=i.findRow(t);if(e&&n){if(!i.isRowChecked(t,r)){var o={id:i.primaryId(n.data),data:n.data,index:n.index};r.push(o)}}else i._state.enableMorePageSelect&&e||(r=r.filter(function(e){return e.id!==t}))}),this._state.checkedRows=r}else this._clearCheckeds()},t.prototype.checkRecord=function(t,e){if(void 0===e&&(e=!0),t){var i=this.findRow(t);if(i){var r=x({},i),n=r.index,o=r.data;e?this.checkRow(n,o):this.unCheckRow(n,o)}else this.errorSubject.next("未找到ID为"+t+"的数据。")}else this.errorSubject.next("参数id 不能为空。")},t.prototype.checkRow=function(t,e,i){var r=this;void 0===i&&(i=null),this._state.multiSelect||this._clearCheckeds();var n=this.primaryId(e),o=this._state.checkedRows||[],s={id:n,data:e,index:t};n&&!this.isRowChecked(n,o)&&(o.push(s),this._state.checkedRows=o,this._state.selectOnCheck&&(i&&i.instance&&i.instance.beforeSelect?i.instance.beforeSelect({rowIndex:t,rowData:e,gridInstance:i.instance}).subscribe(function(i){i&&r.selectRow(t,e)}):this.selectRow(t,e)),this.checkRowSubject.next(s)),this.updateCheckboxState$.emit(x({},s,{checked:!0}))},t.prototype.unCheckRow=function(t,e,i){var r=this;void 0===i&&(i=null);var n=this.primaryId(e),o=this._state.checkedRows||[],s={id:n,data:e,index:t};this.isRowChecked(n,o)&&(o=o.filter(function(t){return""+t.id!=""+n}),this._state.checkedRows=o,this._state.selectOnCheck&&(i&&i.instance&&i.instance.beforeUnselect?i.instance.beforeUnselect({rowIndex:t,rowData:e,gridInstance:i.instance}).subscribe(function(i){i&&r.unSelectRow(t,e)}):this.unSelectRow(t,e)),this.unCheckRowSubject.next(s)),this.updateCheckboxState$.emit(x({},s,{checked:!1}))},t.prototype.setCurrentPageData=function(t){this._state.currentPageData=t},t.prototype.getCurrentPageData=function(){return this._state.currentPageData||[]},t.prototype.getAllRowsForLive=function(){var t=this,e=this._state.data||[];return this._state.pagination&&!this._state.pagerOnServer&&(e=this.getCurrentPageData()),this._state.disableRow&&(e=e.filter(function(e,i){return!t._state.disableRow(e,i)})),e},t.prototype.checkAll=function(){var t=this;this._state.checkedRows=this._state.checkedRows||[];var e=this.getAllRowsForLive(),i=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}});if(this._state.checkedRows.length){var r=[];i.forEach(function(e){t._state.checkedRows.find(function(t){return t.id==e.id})||r.push(e)}),this._state.checkedRows=this._state.checkedRows.concat(r)}else this._state.checkedRows=i;this._state.selectOnCheck&&!this._state.onlySelectSelf&&(this._state.selections=[],this._state.selections=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}})),this.checkAllSubject.next(this._state.checkedRows)},t.prototype.selectAll=function(){var t=this;this._state.selections=[];var e=this.getAllRowsForLive();this._state.selections=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}}),this._state.checkOnSelect&&(this._state.checkedRows=[],this._state.checkedRows=e.map(function(e,i){return{id:t.primaryId(e),index:i,data:e}})),this.selectAllSubject.next(this._state.selections)},t.prototype.findRow=function(t){var e=this;if(this._state.data&&this._state.data.length){var i=-1,r=this._state.data.find(function(r,n){var o=e.primaryId(r)==t;return o&&(i=n),o});return-1===i?null:{index:i,data:r}}return null},t.prototype.findRowIndex=function(t){var e=this;return this._state.data&&this._state.data.length?this._state.data.findIndex(function(i){return e.primaryId(i)===t}):-1},t.prototype.setSelectRow=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0);var r=this.findRow(t),n=x({},r),o=n.index,s={id:t,data:n.data,index:o};this.isMultiSelect()&&(e?this.selectRowForMulti(s,!1,i):this.unSelectRowForMulti(s,!1,i));var l=e?s:null;this.updateState({currentRow:l},!1)},t.prototype.selectRecord=function(t,e){if(void 0===e&&(e=!0),t){var i=this.findRow(t);if(i){var r=x({},i),n=r.index,o=r.data;e?this.selectRow(n,o):this.unSelectRow(n,o)}else this.errorSubject.next("未找到ID为"+t+"的数据。")}else this.errorSubject.next("参数id 不能为空。")},t.prototype.selectRow=function(t,e,i){var r=this;void 0===i&&(i=null);var n=this.isMultiSelect(),o=this.primaryId(e),s={id:o,data:e,index:t};this.isRowSelected(o)&&this._state.currentRow||(n?this.selectRowForMulti(s,!0,i):(this.updateState({currentRow:s},!1),this.selectRowSubject.next(this._state.currentRow),this._state.showCheckbox&&this._state.checkOnSelect&&(this._state.checkedRows=[s],i&&i.instance&&i.instance.beforeCheck?i.instance.beforeCheck({rowIndex:t,rowData:e,gridInstance:i.instance}).subscribe(function(){r.checkRowSubject.next(s)}):this.checkRowSubject.next(s))))},t.prototype.selectRowForMulti=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=null),this._state.onlySelectSelf?(this._clearSelections(),this.updateState({currentRow:t,selections:[t]},!1)):(this._state.selections=this._state.selections||[],this._state.selections=this._state.selections.filter(function(e){return e.id!==t.id}),this._state.selections.push(t)),e&&this.selectRowSubject.next(t),this._state.checkOnSelect&&this.checkRow(t.index,t.data,i)},t.prototype.unSelectRowForMulti=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=null),this._state.selections=this._state.selections.filter(function(e){return e.id!==t.id}),(this._canCancelSelectWhenMulti()||this._state.currentRow&&this._state.currentRow.id===t.id)&&this.updateState({currentRow:null}),this._state.checkOnSelect&&this.unCheckRow(t.index,t.data,i),e&&this.unSelectRowSubject.next(t)},t.prototype.unSelectRow=function(t,e,i){void 0===i&&(i=null);var r={id:this.primaryId(e),index:t,data:e};this.isMultiSelect()?this.unSelectRowForMulti(r,!0,i):this._state.currentRow&&(this.updateState({currentRow:null}),this.unSelectRowSubject.next(r),this._state.showCheckbox&&this.unCheckRow(r.index,r.data,i))},t.prototype._canCancelSelectWhenMulti=function(){return!this._state.keepSelect&&this._state.onlySelectSelf},t.prototype._clearSelections=function(t){this._state.currentRow=null,t&&t.length?this._state.selections=this._state.selections.filter(function(e){return t.findIndex(function(t){return t==e.id})>-1}):this._state.selections=[]},t.prototype._clearCheckeds=function(t){var e=this;void 0===t&&(t=[]),t.length?this._state.checkedRows=this._state.checkedRows.filter(function(i){return-1==t.findIndex(function(t){return e.primaryId(t)===i.id})}):this._state.checkedRows=[]},t.prototype.clearSelections=function(t){var e=this._state.selections;t=t||[],this._clearSelections(t);var i=e.filter(function(e){return-1==t.findIndex(function(t){return t==e.id})});(this._state.checkOnSelect||!this._state.multiSelect&&this._state.showCheckbox)&&(this._state.checkedRows=this._state.checkedRows.filter(function(i){return!e.find(function(e){return e.id==i.id&&-1==t.findIndex(function(t){return t==i.id})})}),this.clearCheckedsSubject.next(i)),this.clearSelectionSubject.next(i)},t.prototype.clearCheckeds=function(t){void 0===t&&(t=!0);var e=this.getAllRowsForLive(),i=t?[]:e;this._clearCheckeds(i),this._state.selectOnCheck&&this._clearSelections(),this.clearCheckedsSubject.next(e)},t.prototype.clearAll=function(){this._clearCheckeds(),this._clearSelections(),this.clearAllSubject.next()},t.prototype.setMultiSelect=function(t){this._state.multiSelect=t},t.prototype.setCheckOnSelect=function(t){this._state.checkOnSelect=t},t.prototype.setSelectOnCheck=function(t){this._state.selectOnCheck=t},t.prototype.setCurrentCell=function(t,e,i,r){var n=x({},t),o=n.rowIndex,s=n.rowData,l=x({},this._state.currentCell,{rowIndex:o,rowData:s,field:e,rowId:this.primaryId(s),cellElement:i});if(e!==this._state.ControlPanelFeild){r&&(l.cellRef=r),e&&(l.column=this.getColumn(e));var a=o===this.getData().length-1;l.lastRow=a}else l=null;this._state.currentCell=null,this.updateState({currentCell:l},!1),this.selectRow(o,s),this._state.currentRow&&(this._state.currentRow.dr=t),this.selectCellSubject.next(l)},t.prototype.cancelSelectCell=function(){this._state.currentCell&&(this._state.currentCell=null,this.updateState({currentCell:null},!1),this.selectCellSubject.next(null))},t.prototype.primaryId=function(t){return t[this._state.idField]},t.prototype.getCurrentCell=function(){return this._state.currentCell},t.prototype.editCell=function(){if(this._state.currentCell&&!this._state.currentCell.isEditing){var t=x({},this._state.currentCell,{isEditing:!0});this.updateState({currentCell:t},!1),this.selectCellSubject.next(t)}},t.prototype.endEditCell=function(){if(this._state.currentCell&&this._state.currentCell.isEditing){var t=x({},this._state.currentCell,{isEditing:!1});this.updateState({currentCell:t},!1),this.selectCellSubject.next(t)}},t.prototype.appendRow=function(t){if(!t||!this.primaryId(t))throw new Error("主键标识字段不能为空。");var e=this.primaryId(t);if(-1!==this.findRowIndex(e))throw new Error("主键ID 已存在！ID: "+e);this._state.data.push(t);var i=R(this._state.data);this.updateState({data:i},!1),this._state.originalData=o.cloneDeep(this._state.data),this.refresh(),this.rowAppend$.emit(t)},t.prototype.updateRow=function(t,e){var i=this.findRow(t);if(i&&i.data&&e){Object.keys(e).forEach(function(t){Y.setValue(t,e[t],i.data)}),this.updateCheckedData(t,e);var r=x({},i,{keyID:t});this.rowUpdate$.emit(r)}},t.prototype.deleteRow=function(t){var e=this.findRow(t);if(e){var i=this.removeRow(this._state.data,t);return this.updateState({data:i},!1),this._state.originalData=o.cloneDeep(this._state.data),this.refresh(),this.rowDelete$.emit(t),e}},t.prototype.removeRow=function(t,e){var i=this;return t.filter(function(t){var r=i.primaryId(t);return e!==r})},t.prototype.isCellSelected=function(t){var e=this.getCurrentCell();return!!e&&(this._state.currentRow.index===e.rowIndex&&e.field===t.field)},t.prototype.updateState=function(t,e){void 0===e&&(e=!0);var i=x({},this._state,t);this._state=i,e&&this.store.next(this._state)},t.prototype.resize=function(t){t&&this.updateState(t,!1),this.resetColumnsSize(),this._state.groupRows||this.updateVirthualRows(this._state.virtual.scrollTop)},t.prototype.fitColumns=function(t){this.updateState({fitColumns:t},!1),this.resetColumnsSize()},t.prototype.useUserSetColumnSize=function(){if(this._state.autoFitColumns){var t=this._state.width,e=this._state.columnsGroup,i=e.leftFixedWidth,r=e.rightFixedWidth;return e.originalTotalWidth>t-i-r}return!1},t.prototype.resetColumnsSize=function(){if(this._state.fitColumns){var t=this.useUserSetColumnSize();this.setFitColumnsWidth(this._state.columnsGroup,t,t)}this.gridSizeSubject.next(this._state)},t.prototype.updateColumns=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),this._state.columns=t,this.initColumns(i,e),this.resizeColumns(e)},t.prototype.getGroupColumns=function(t){var e=this,i=[],r=this.getAllFlatColumns();return t.forEach(function(t){t.colspan&&1!=t.colspan?i=i.concat(e.getGroupColumns(r.filter(function(e){return e.parentId==t.id}))):i.find(function(e){return e.field===t.field})||i.push(t)}),i},t.prototype.initColumns=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this._state.flatColumns,r={leftFixed:[],rightFixed:[],normalColumns:[],columns:[]};if(i&&i.length){var n=this.getFixedCols("left"),o=this.getFixedCols("right"),s=this.getFixedCols();i.forEach(function(t){t.originalWidth?e&&(t.width=t.originalWidth):t.originalWidth=t.width}),r={leftFixed:n,rightFixed:o,normalColumns:s,columns:n.concat(s).concat(o)},this.initColumnsWidth(r,e),this._state.fitColumns&&this.setFitColumnsWidth(r,!0),this.updateState({columnsGroup:r},t)}else r.leftFixedWidth=0,r.rightFixedWidth=0,r.normalWidth=0,r.totalWidth=0,this.updateState({columnsGroup:r},t)},t.prototype.getColumnIndex=function(t,e){void 0===e&&(e="");var i=this._state.columnsGroup;return!e||this._state.fast?i.normalColumns.findIndex(function(e){return e.field===t}):"left"===e?i.leftFixed.findIndex(function(e){return e.field===t}):"right"===e?i.rightFixed.findIndex(function(e){return e.field===t}):void 0},t.prototype.columnResizeEnd=function(){this.resizeColumns()},t.prototype.resizeColumns=function(t){void 0===t&&(t=!1);var e=this._state.columnsGroup;if(this.initColumnsWidth(e,t),this._state.fitColumns){var i=this.useUserSetColumnSize();i?this.setFitColumnsWidth(e,t,i):this.setFitColumnsWidth(e,t)}this.updateState({columnsGroup:x({},e)},!1),this.gridSizeSubject.next(this._state)},t.prototype.getAllFlatColumns=function(){return o.flatten(this._state.columns)},t.prototype.getColumn=function(t){return this.getAllFlatColumns().find(function(e){return e.field===t})},t.prototype.setFitColumnsWidth=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),t)if(t.normalWidth=this._state.width-t.leftFixedWidth-t.rightFixedWidth,this._state.scrollbarY&&(t.normalWidth-=this._state.scrollbarY),this._state.showBorder&&(t.normalWidth-=2),i)t.totalWidth=t.originalTotalWidth,e&&t.normalColumns.forEach(function(t){t.width=t.originalWidth}),t.normalWidth=t.normalColumns.reduce(function(t,i){return!e&&i.width?t+i.width:t+i.originalWidth},0),t.totalWidth=t.leftFixedWidth+t.rightFixedWidth+t.normalWidth;else{var r=t.normalColumns.reduce(function(t,i){return e?t+i.originalWidth:t+i.width},0);t.normalColumns.forEach(function(i){i.width=e?Number((i.originalWidth/r*t.normalWidth).toFixed(2)):Number((i.width/r*t.normalWidth).toFixed(2))}),t.totalWidth=t.leftFixedWidth+t.rightFixedWidth+t.normalWidth}},t.prototype.getFixedCols=function(t){void 0===t&&(t="");var e=[];if(e=t?this._state.flatColumns.filter(function(e){return e.fixed===t}):this._state.flatColumns.filter(function(t){return"left"!==t.fixed&&"right"!==t.fixed}),this._state.columns.length>1&&e.length){var i=K.getFields(this._state.columns),r=[];return i.forEach(function(t){var i=e.find(function(e){return(e.field||"")===t});i&&r.push(i)}),r}return e},t.prototype.initColumnsWidth=function(t,e){void 0===e&&(e=!1);var i=0;i=this._state.showLineNumber?i+this._state.lineNumberWidth:i,i=this._state.showCheckbox?i+this._state.checkboxColumnWidth:i;var r=function(t,e,i){return t.reduce(function(t,e){return e.left=t,i?t+e.originalWidth:t+e.width},e)};t.leftFixedWidth=i,t.leftFixed&&t.leftFixed.length&&(t.leftFixedWidth=r(t.leftFixed,i,e)),t.rightFixedWidth=0,t.rightFixed&&t.rightFixed.length&&(t.rightFixedWidth=r(t.rightFixed,0,e)),t.normalWidth=0,this._state.columns&&this._state.columns.length&&(t.normalWidth=r(t.normalColumns,0,e),t.originalTotalWidth=r(t.normalColumns,0,!0)),t.totalWidth=t.leftFixedWidth+t.rightFixedWidth+t.normalWidth},t.prototype.showCheckbox=function(t){void 0===t&&(t=!0);var e=this._state.columnsGroup;this.updateState({showCheckbox:t},!1),e.leftFixedWidth=t?e.leftFixedWidth+this._state.checkboxColumnWidth:e.leftFixedWidth-this._state.checkboxColumnWidth,this.columnResizeSubject.next(e)},t.prototype.hideCheckbox=function(){this.showCheckbox(!1)},t.prototype.showLineNumber=function(t){void 0===t&&(t=!0);var e=this._state.columnsGroup;this.updateState({showLineNumber:t},!1),e.leftFixedWidth=t?e.leftFixedWidth+this._state.lineNumberWidth:e.leftFixedWidth-this._state.lineNumberWidth,this.columnResizeSubject.next(e)},t.prototype.hideLineNumber=function(){this.showLineNumber(!1)},t.prototype.setSortInfo=function(t,e){e=e||"";var i=(t=t||"").split(","),r=e.split(","),n=this._state.columnsGroup,o=function(t){t&&t.length&&t.forEach(function(t){t.order=undefined;var e=i.findIndex(function(e){return e===t.field});e>-1&&(t.order=r[e])})};o(n.normalColumns),o(n.leftFixed),o(n.rightFixed),this.updateState({sortName:t,sortOrder:e},!1)},t.prototype.orderBy=function(t,e,i){var r=this,n=e.reduce(function(t,e){return t[e]=r.getColumn(e),t},{});return R(t).sort(function(t,o){return e.reduce(function(e,s,l){if(0===e){var a=Y.getValue(s,t),d=Y.getValue(s,o);n[s]&&n[s].isMultilingualField&&(a=Y.getMultilingualValue(a,r.localId),d=Y.getMultilingualValue(d,r.localId)),a!==undefined&&null!==a||(a=""),d!==undefined&&null!==d||(d="");var c=S(i&&"desc"===i[l]?[d,a]:[a,d],2),h=c[0],u=c[1];e="string"==typeof h?h.localeCompare(u):h>u?1:h<u?-1:0}return e},0)})},t.prototype.sort=function(t){var e=this._state.sortOrder.split(","),i=this._state.sortName.split(",");if(this._state.mergeCell&&this._state.mergeFields&&this._state.mergeFields.length){var r=[],n=R(this._state.mergeFields);return i.forEach(function(t,i){var o=n.indexOf(t);-1==o&&(n.push(t),o=n.length-1),r[o]=e[i]}),this.orderBy(t,n,r)}return this.orderBy(t,i,e)},t.prototype.clientSort=function(t){if(this._state.sortName){t&&this.updateState({data:t},!1);var e=this.sort(this._state.data);this.loadData(e,!1)}else this.clearSort();this.clientSort$.emit({sortName:this._state.sortName,sortOrder:this._state.sortOrder})},t.prototype.clearSort=function(){this.loadData(this._state.originalData,!1)},t.prototype.loadFilterData=function(t){this.loadData(t,!1)},t.prototype.hasRowChanges=function(t){var e=this._state.changes;return!!e&&e[t]},t.prototype.appendChanges=function(t){if(t){var e=t[this._state.idField];if(e){var i=""+e;this.hasRowChanges(i)?this._state.changes[i]=Object.assign(this._state.changes[i],t):(this._state.changes=this._state.changes||{},this._state.changes[i]=t)}}},t.prototype.acceptChanges=function(){var t=this,e=this._state.changes;e&&(Object.keys(e).forEach(function(i){t.updateRow(i,e[i])}),this._state.originalData=o.cloneDeep(this._state.data))},t.prototype.rejectChanges=function(t){var e=this;if(void 0===t&&(t=null),this._state.changes){if(t){if(this._state.changes[""+t]){var i=this._state.originalData.find(function(i){return e.primaryId(i)===t});this._state.data.forEach(function(r){e.primaryId(r)===t&&(r=o.cloneDeep(i))})}}else this._state.data=o.cloneDeep(this._state.originalData),this._state.changes=null;this.refresh()}},t.prototype.getChanges=function(){return this._state.changes},t.prototype.refresh=function(){var t=o.cloneDeep(this._state.data);this.loadData(t)},t.prototype.getFooterData=function(t){var e=this;if(!t||!t.length)return[];var i=o.flatten(this._state.columns).filter(function(t){return!t.colspan||1==t.colspan}),r={};return i.forEach(function(i){if(i.footer&&i.footer.options){var n=i.footer.options,o=n.text,s=n.calculationType;if(s!==undefined&&-1!=s){var l=e.calculation(t,s,i);r[i.field]=l}else r[i.field]=o||""}else r[i.field]=""}),[r]},t.prototype.arrToGroup=function(t,e){if(e.length){var i=e.shift(),r=o.groupBy(t,function(t){return Y.getValue(i,t)});return this.toGroup(r,e),r}},t.prototype.toGroup=function(t,e){var i=this;e.length&&Object.keys(t).forEach(function(r){var n=t[r],s=e.map(function(t){return t}),l=s.shift();t[r]=o.groupBy(n,function(t){return Y.getValue(l,t)}),s.length&&i.toGroup(t[r],s)})},t.prototype.groupRows2Flat=function(t,e,i){var r=this,n=[];e===undefined&&(e=0);var s=this._state.idField,l=(this._state.flatColumns,this._state.data),a=this._state.groupField.split(","),d=i?i[s]:null,c=this._state.columnsGroup.normalColumns.length,h=this._state.expandGroupRows;return Object.keys(t).forEach(function(u,p){var f,g,m=((f={})[s]=Y.uuid(),f[W]=!0,f[X]=e,f.data={},f.value=u,f[U]=!0,f.expanded=h,f.field=a[e],f.colspan=c,f.total=0,f.rows=[],f[$]=d,f);i?(m.rows=i.rows.filter(function(t){return!t[W]&&!t[B]&&Y.getValue(a[e],t)===u}),m[U]=h):m.rows=l.filter(function(t){return""+Y.getValue(a[e],t)===u}),i&&i.rows.push(m),m.total=m.rows.filter(function(t){return!t[W]&&!t[B]}).length,n.push(m);var y=t[u];if(o.isPlainObject(y)){var w=e+1;n=n.concat(r.groupRows2Flat(y,w,m))}else m.total=y.length,y=y.map(function(t){return t[$]=m[s],t[U]=h,t[X]=m[X]+1,t}),m.rows=y,n=n.concat(y);if(r._state.groupFooter){var v=((g={})[B]=!0,g[$]=m[s],g[U]=h,g[X]=e,g.data={},g);m.rows.push(v),n.push(v)}}),n},t.prototype.updateGroupFooterData=function(t,e,i){var r=this;e.forEach(function(e){if(e.groupFooter&&e.groupFooter.options){var n=e.groupFooter.options,o=n.text,s=n.calculationType;if(s!==undefined&&-1!=s){var l=r.calculation(i,s,e);t.data[e.field]=l}else t.data[e.field]=o||""}else t.data[e.field]=""})},t.prototype.groupRows2=function(t){var e=this;if(t&&t.length){var i=this._state.flatColumns,r=this._state.groupField||"";if(!r)return t;var n=this.arrToGroup(t,r.split(",")),o=this.groupRows2Flat(n,0,null),s=0;return o.map(function(t,r){if(t[W]||t[B]||(t[V]=s,s++),t[B]){var n=(l=t[$],o.find(function(t){return t[e._state.idField]===l})).rows.filter(function(t){return!t[W]&&!t[B]});e.updateGroupFooterData(t,i,n)}var l;return t}),o}return[]},t.prototype.showGroupFooter=function(t){this.updateState({groupFooter:t},!1),this.updateVirthualRows(0)},t.prototype.updateGroupFooter=function(t){var e=this,i=this._state.virtual.virtualRows.find(function(e){return e.id===t});if(i&&i.rows){var r=i.rows,n=r.filter(function(t){return t.__group_footer__}),o=this._state.flatColumns,s=r.filter(function(t){return!t.__group_footer__});n.forEach(function(t){e.updateGroupFooterData(t,o,s)}),i.__group_parent_id__&&this.updateGroupFooter(i.__group_parent_id__)}},t.prototype.calculation=function(t,e,i){var r="";if(!t||!t.length)return"";var n=i.field,o=t.map(function(t){return Y.getValue(n,t)||0});switch(e){case I.sum:r=s.BigNumber.sum.apply(null,o).toFixed();break;case I.max:r=s.BigNumber.max.apply(null,o).toFixed();break;case I.min:r=s.BigNumber.min.apply(null,o).toFixed();break;case I.average:r=s.BigNumber.sum.apply(null,o).div(o.length).toFixed();break;case I.count:r=t.length}return r},t.prototype.setGroupRowsVisible=function(t,e,i){var r=this;if(void 0===i&&(i=!0),t.rows){var n=t.rows.filter(function(t){return t[W]}),o=t.rows.filter(function(t){return t[B]});o&&o.length&&o.forEach(function(i){i[U]=e&&t.expanded}),n.forEach(function(i){i[U]=e&&t.expanded&&t[U],r.setGroupRowsVisible(i,e,!1)}),n.length||t.rows.forEach(function(i){i[U]=e&&t.expanded&&t[U]}),i&&(e?this.expandGroupRow.emit({data:t}):this.collapseGroupRow.emit({data:t}))}},t.prototype.setinitialOptions=function(t){this._state.initialOptions={},this._state.initialOptions.groupField=t.groupField,this._state.initialOptions.expandGroupRows=t.expandGroupRows,this._state.initialOptions.sort={sortName:t.sortName,sortOrder:t.sortOrder};var e=function(t){return"_datagrid-setting-control_"===t.field?null:{field:t.field,title:t.title,colspan:t.colspan,rowspan:t.rowspan,fixed:t.fixed,width:t.width||100,sortable:t.sortable,order:t.order,halign:t.halign,align:t.align,visible:t.visible,allowGrouping:t.allowGrouping,groupFooter:o.cloneDeep(t.groupFooter||{}),footer:o.cloneDeep(t.footer||{}),dataType:t.dataType||"string"}};t.columns&&(1===t.columns.length?this._state.initialOptions.columnFields=t.columns[0].map(function(t){return e(t)}).filter(function(t){return t}):this._state.initialOptions.groupHeaderFields=t.columns.map(function(t){return t.map(function(t){return e(t)}).filter(function(t){return t})}),this._state.initialOptions.designerColumns=R(t.columns.map(function(t){return R(t)})))},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient}]},t}(),J=function(){function t(){this.scorllSubject=new r.Subject,this.scrollX=new r.BehaviorSubject(0),this.rowHoverSubject=new r.Subject,this.rowSelectSubject=new r.Subject,this.dataSourceChangedSubject=new r.Subject,this.editCellSubject=new r.Subject,this.selectCellSubject=new r.Subject,this.endCellEdit=new r.Subject,this.changeCheckedRows=new r.Subject,this.scorll$=this.scorllSubject.asObservable(),this.scrollX$=this.scorll$.pipe(n.filter(function(t){return"psScrollX"===t.type}),n.map(function(t){return t.x}),n.debounceTime(50)),this.scrollY$=this.scorll$.pipe(n.filter(function(t){return"psScrollY"===t.type}),n.map(function(t){return t.x}),n.debounceTime(50)),this.rowHover$=this.rowHoverSubject.asObservable(),this.rowClick$=this.rowSelectSubject.asObservable(),this.onDataSourceChange=this.dataSourceChangedSubject.asObservable(),this.cellEdit$=this.editCellSubject.asObservable(),this.endCellEdit$=this.endCellEdit.asObservable(),this.checkedRowsTotalChanged$=this.changeCheckedRows.asObservable(),this.updateEmptyStyle$=new e.EventEmitter,this.showGridHeader=new e.EventEmitter,this.uncheckAll=new e.EventEmitter,this.checkAll=new e.EventEmitter,this.columnResized=new e.EventEmitter,this.rowHeightChanged=new e.EventEmitter,this.loadVirtualData=new e.EventEmitter,this.showFixedShadow=new e.EventEmitter,this.setSelecedRow=new e.EventEmitter,this.setCheckedRows=new e.EventEmitter,this.scrollToCurrentRow=new e.EventEmitter,this.columnsChanged=new e.EventEmitter,this.cellContentWrapChanged=new e.EventEmitter,this.onFilterChanged=new e.EventEmitter,this.clearFilter=new e.EventEmitter,this.filterTextChange=new e.EventEmitter,this.toggleFilterRow=new e.EventEmitter,this.closeFilterPanel=new e.EventEmitter,this.refreshFooterData=new e.EventEmitter,this.disableHeader=new e.EventEmitter,this.changeCheckAllStatus=new e.EventEmitter,this.setScrollbarPosition=new e.EventEmitter,this.smartFilterBarExpand=new e.EventEmitter,this.smartFilterDataChange=new e.EventEmitter,this.scrollbarUpdate=new e.EventEmitter,this.footerPositionChanged=new e.EventEmitter,this.styleElement=null,this.commonUtils=null,this.idService=null,this.cellEditorCreated=new e.EventEmitter,this.cellEditorDestory=new e.EventEmitter,this.focusRowChanged=new e.EventEmitter,this.dataloaded=new e.EventEmitter,this.toggleGroupRow$=new e.EventEmitter,this.toggleAllGroupRows$=new e.EventEmitter,this.cssTextCache=[],this.groupBy=function(t,e){return t.map("function"==typeof e?e:function(t){return Y.getValue(e,t)}).reduce(function(e,i,r){return e[i]=(e[i]||[]).concat(t[r]),e},{})}}return t.prototype.onScrollMove=function(t,e){this.scorllSubject.next({x:t,type:e})},t.prototype.dataSourceChanged=function(){this.dataSourceChangedSubject.next()},t.prototype.onRowHover=function(t,e,i){this.rowHoverSubject.next({index:t,data:e,mouseenter:i})},t.prototype.onRowClick=function(t,e){this.rowSelectSubject.next({index:t,data:e})},t.prototype.onCellEdit=function(t){this.editCellSubject.next(t)},t.prototype.onEndCellEdit=function(t){this.endCellEdit.next(t)},t.prototype.onSelectCell=function(t){this.selectCellSubject.next(t)},t.prototype.onCheckedRowsCountChange=function(){this.changeCheckedRows.next()},t.prototype.onRowHeightChange=function(t){this.rowHeightChanged.emit(t)},t.prototype.onLoadVirtualData=function(t){this.loadVirtualData.emit({data:t})},t.prototype.onClearFilter=function(){this.clearFilter.emit(),this.filterTextChange.emit("")},t.prototype.onFilterTextChange=function(t){this.filterTextChange.emit(t)},t.prototype.restoreScrollbarPosition=function(){this.setScrollbarPosition.emit()},t.prototype.updateEmptyStyle=function(){this.updateEmptyStyle$.emit()},t.prototype.getMergeCellInfo=function(t,e){var i,r={},n=null;return e.forEach(function(e,o){0===o&&t.forEach(function(t,o){var s,l=((s={})[e]={show:!0,rowspan:1},s);r[o]?r[o][e]||(r[o]=Object.assign(r[o],l)):r[o]=l;var a=r[o];if(i=t[e],null===n||n!==i)n=i,a[e].show=!0,a[e].startIndex=o;else{var d=r[o-1][e].startIndex;a[e].startIndex=d,a[e].show=!1,r[d][e].rowspan++}})}),r},t.prototype.getMergeCellInfo0=function(t,e){var i,r,n={};return t.forEach(function(t,o){var s,l=((s={})[e]={show:!0,rowspan:1,value:""},s);n[o]||(n[o]=l);var a=n[o];if(r=Y.getValue(e,t),a[e].value=r,i===undefined||i!==r)i=r,a[e].show=!0,a[e].startIndex=o;else{var d=n[o-1][e].startIndex;a[e].startIndex=d,a[e].show=!1,n[d][e].rowspan++}}),n},t.prototype.getMergeCellInfo2=function(t,e){var i={},r=null;i=this.getMergeCellInfo0(t,e.splice(0,1)[0]);var n=this.groupBy(t,e[0]),o=Object.keys(n),s=0;return e.forEach(function(t,e){o.forEach(function(e,o){var l;n[e].forEach(function(e,n){var o;i[s]&&!i[s][t]&&(i[s]=Object.assign(i[s],((o={})[t]={show:!0,rowspan:1,value:""},o)));var a=i[s];if(l=Y.getValue(t,e),a[t].value=l,null===r||r!==l)r=l,a[t].show=!0,a[t].startIndex=s;else{var d=i[s-1][t].startIndex;a[t].startIndex=d,a[t].show=!1,i[d][t].rowspan++}s++})})}),i},t.prototype.getMergeCellInfo3=function(t,e){var i={},r=e.splice(0,1)[0];i=this.getMergeCellInfo0(t,r);return e.forEach(function(r,n){var o,s,l=0;n>0&&e[n-1],t.forEach(function(e,n){var a;i[l]&&!i[l][r]&&(i[l]=Object.assign(i[l],((a={})[r]={show:!0,rowspan:1,value:""},a)));var d=i[l];if(s=Y.getValue(r,e),d[r].value=s,l>0){var c=i[l-1];Object.keys(d).map(function(t){return""+d[t].value}).join(",")!==Object.keys(c).map(function(t){return""+c[t].value}).join(",")&&(o=undefined)}if(o===undefined||o!==s)o=s,d[r].show=!0,d[r].startIndex=l;else{var h=i[l-1][r].startIndex;d[r].startIndex=h,d[r].show=!1,i[h][r].rowspan++}t.length-1>l&&l++})}),i},t.prototype.getMergeInfo=function(t,e,i){return e&&i&&i[t]&&i[t][e]?i[t][e]:null},t.prototype.removeStyleSheet=function(){this.styleElement&&(this.styleElement.remove(),this.styleElement=null,this.cssTextCache=[])},t.prototype.createStyleElement=function(t){this.styleElement=this._createStyleSheet(t)},t.prototype.appendCssRules=function(t){this.styleElement&&this._appendCssRules(t,this.styleElement.sheet)},t.prototype.removeCssRule=function(t){var e=this;this.styleElement&&("string"==typeof t?(this._removeCssRule(t,this.styleElement.sheet),this.cssTextCache=this.cssTextCache.filter(function(e){return-1==e.indexOf(t)})):Array.isArray(t)&&t.forEach(function(t){e._removeCssRule(t,e.styleElement.sheet),e.cssTextCache=e.cssTextCache.filter(function(t){return-1==t.indexOf(t)})}))},t.prototype._createStyleSheet=function(t){var e=document.querySelector("head"),i=t,r=null;return document.querySelector("#"+i)?(r=document.querySelector("#"+i)).innerText="":((r=document.createElement("style")).id=i,r.type="text/css",e.appendChild(r)),r},t.prototype._appendCssRules=function(t,e){var i,r,n="";try{for(var o=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}(t),s=o.next();!s.done;s=o.next()){var l=s.value,a=l.slice(0,l.indexOf("{")).trim(),d=this._getCssTextBySelector(a,e),c="";d&&-1==a.indexOf("customcellcls_")&&-1==a.indexOf("customgrouprowcls_")&&-1==a.indexOf("customrowcls_")&&(c+=d.cssText.slice(d.cssText.indexOf("{")+1,d.cssText.indexOf("}")));var h=a+"{ "+(c+=l.slice(l.indexOf("{")+1,l.indexOf("}")).replace(/"/g,"").replace(/,/g,";")+";")+" }";n+=h,this.cssTextCache.includes(h)||(this.cssTextCache.push(h),e.addRule?e.addRule(a,c,0):e.insertRule(h,0))}}catch(u){i={error:u}}finally{try{s&&!s.done&&(r=o["return"])&&r.call(o)}finally{if(i)throw i.error}}return n},t.prototype._removeCssRule=function(t,e){if(e){var i=e.cssRules||e.rules,r=0,n=!1;do{if((n=i[r])&&n.selectorText.toLowerCase()==t.toLowerCase())return e.cssRules?e.deleteRule(r):e.removeRule(r),n;r++}while(n)}},t.prototype.createConfigKey=function(t){location.host;var e=location.hash,i=(location.href,location.pathname),r="",n="";if(e){var o=e.split("?");r=o[0];var s={};o[1]&&o[1].split("&").map(function(t){s[t.split("=")[0]]=t.split("=")[1]});var a=""+i;s&&Object.keys(s).length&&(n=s.funcId||"")&&localStorage.setItem(a,n),n||(n=localStorage.getItem(a))}var d=r+"_"+n+"_"+t;return this.idService||(this.idService=new l.IdService),this.idService.encrypt(d)},t.prototype.getCustomStyle=function(t,e){if("object"==typeof t)return t;if("function"==typeof t){var i=e||[];return t.apply(void 0,R(i))}},t.prototype.findNextTr=function(t,e){var i=function(t){return!(!t||-1!=t.className.indexOf("f-datagrid-disable-row"))&&t},r="down"===e?"nextElementSibling":"previousElementSibling";return function(t){for(var e=null,n=!0;n;)if(e=i(t))n=!1;else if(t&&t[r]){if(e=i(t[r]))break}else n=!1;return e}(t)},t.prototype._getCssTextBySelector=function(t,e){if(e){var i=e.cssRules||e.rules,r=0,n=!1;do{if((n=i[r])&&n.selectorText.toLowerCase()==t.toLowerCase())return n;r++}while(n)}},t}(),Q=new e.InjectionToken("DataGrid Request Data Service."),tt=function(){},et={required:"此字段不能为空。",min:"最小值不能小于${0}",max:"最大值不能大于${0}",minlength:"至少输入${0}个字符",maxlength:"字符长度不能大于${0}",email:"Email 格式不正确",requriedtrue:"务必选中",pattern:"输入的格式不正确。"},it=function(){function t(){}return t.prototype.getValidatorErrorMessage=function(t,e){t=t.toLowerCase();var i=e.find(function(e){return e.type.toLowerCase()===t});return i&&i.messager?i.messager:et[t]?et[t]:"验证不通过！"},t.decorators=[{type:e.Injectable}],t}(),rt=function(){function t(){}return t.hasClass=function(t,e){return!!t&&(t.classList?Array.from(t.classList).filter(function(t){return t===e}).length>0:t.className.indexOf(e)>-1)},t.removeClass=function(t,e){t&&(t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," "))},t.findSingle=function(t,e){return t?t.querySelector(e):null},t.getOffset=function(t){var e=t.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}},t.getOuterHeight=function(t,e){var i=t.offsetHeight;if(e){var r=getComputedStyle(t);i+=parseFloat(r.marginTop)+parseFloat(r.marginBottom)}return i},t.getOuterWidth=function(t,e){var i=t.offsetWidth;if(e){var r=getComputedStyle(t);i+=parseFloat(r.marginLeft)+parseFloat(r.marginRight)}return i},t}(),nt=function(){function t(t,i,r){this.dfs=t,this.localeSer=i,this.inject=r,this.removeField=new e.EventEmitter}return t.prototype.validateRowData=function(t,e){return!e||0===Object.keys(e).length||this.checkAllFieldInRowData(t,e)},t.prototype.executeFilter=function(t,e){var i=this;return this.dfs.getState().enableSmartFilter?this.executeSmartFilter(t,e):t&&t.length?t.filter(function(t){return i.validateRowData(t,e)}):t},t.prototype.getCompareResult=function(t,e,i){switch(parseInt(""+e,10)){case d.Compare.Equal:return t==i;case d.Compare.NotEqual:return(""+t).toLowerCase()!==(""+i).toLowerCase();case d.Compare.Greater:return t>i;case d.Compare.GreaterOrEqual:return t>=i;case d.Compare.Less:return t<i;case d.Compare.LessOrEqual:return t<=i;case d.Compare.Like:return null==t&&(t=""),(""+t).toLowerCase().indexOf(i.toLowerCase())>-1;case d.Compare.NotLike:return-1===(""+t).toLowerCase().indexOf(i.toLowerCase());case d.Compare.In:return(i=i||[]).findIndex(function(e){return e==t})>-1;case 1001:return""===o.trim(t)||null===t||t===undefined;case 1002:return""!==o.trim(t)&&null!==t&&t!==undefined;case 1003:return null===t;case 1004:return null!==t}},t.prototype.getRelationResult=function(t,e,i){return"and"===e.toLowerCase()?t&&i:t||i},t.prototype.checkAllFieldResult=function(t){return!t||Object.values(t).reduce(function(t,e){return t&&e},!0)},t.prototype.checkAllFieldInRowData=function(t,e){var i=this,r=null;if(e){var n=Object.keys(e);r={},n.forEach(function(n){var o=Y.getValue(n,t),s=i.dfs.getColumn(n);s&&s.isMultilingualField&&(o=Y.getMultilingualValue(o,i.localeSer.localeId));var l=e[n],a=l.value1,d=l.operator1,c=l.relation,h=l.operator2,u=l.value2;if(l){var p=i.getCompareResult(o,d,a);if(r[n]=p,c){var f=i.getCompareResult(o,h,u);r[n]=i.getRelationResult(p,c,f)}}})}return this.checkAllFieldResult(r)},t.prototype.removeFilterField=function(t){this.removeField.emit(t)},t.prototype.convertFilterCondition2String=function(t){var e=this;if(!t)return"";var i="",r=this.localeSer.getValue("datagrid.filter.and"),n=this.localeSer.getValue("datagrid.filter.or"),o="<span class='badge badge-success'>"+r+"</span>",s="<span class='badge badge-info'>"+r+"</span>",l="<span class='badge badge-warning'>"+n+"</span>",a=(i=Object.keys(t).reduce(function(i,r){var n=t[r],o=e.dfs.getColumn(r),a="<b>"+o.title+"</b>",c=" "+a+" "+e.getCompareString(n.operator1)+" "+Y.escapeValue(n.value1)+"  ";if(n.operator1==d.Compare.In){var h=n.value1,u=h;if(o.filter.type===E["enum"]){var p=K.getFilterEnumOptions(o);u=(h=K.getEnumText(p,n.value1)).split(",").slice(0,2).join(",")}else u=h.slice(0,2).join(",");c=" "+a+" "+e.getCompareString(n.operator1)+" [ "+h+" ]  ",n.value1.length>2&&(c=" "+a+" "+e.getCompareString(n.operator1)+" "+'[ <span class="ellipsis" title="$title$">  $value$<i class="f-icon f-icon-lookup"></i></span> ]'.replace("$title$",h).replace("$value$",u)+"  ")}else n.operator1==d.Compare.Equal&&Array.isArray(n.value1)&&(n.value1.length||(c=" "+a+" "+e.getCompareString(n.operator1)+" ''  "));if(n.relation){var f=a+" "+e.getCompareString(n.operator2)+" "+n.value2;c="<b>〔</b> "+c+" "+("and"===n.relation?s:l)+" "+f+" <b>〕</b>"}return i+' <span class="filter-field filter-column-'+r+'"> '+c+" AND </span>"},"")).lastIndexOf("AND"),c=i.substr(0,a);return(c+=i.substr(a+3)).replace(/AND/g,o).replace(/OR/g,l)},t.prototype.getCompareString=function(t){var e=parseInt(""+t,10),i="";switch(e){case d.Compare.Equal:case d.Compare.NotEqual:case d.Compare.Greater:case d.Compare.GreaterOrEqual:case d.Compare.Less:case d.Compare.LessOrEqual:case d.Compare.Like:case d.Compare.NotLike:case d.Compare.In:return i=(i=d.Compare[e])[0].toLowerCase()+i.substr(1),this.localeSer.getValue("datagrid.filter.operators."+i);case 1001:return" "+this.localeSer.getValue("datagrid.filter.operators.empty");case 1002:return" "+this.localeSer.getValue("datagrid.filter.operators.notEmpty");case 1003:return" "+this.localeSer.getValue("datagrid.filter.operators.null");case 1004:return" "+this.localeSer.getValue("datagrid.filter.operators.notNull")}},t.prototype.convert2FilterArray=function(t){var e=this,i=[],r=["number","date","datetime"];if(t){var n=Object.keys(t);n&&n.length&&n.forEach(function(n){var o=e.dfs.getColumn(n).dataType||"string",s={filterField:n,value:"",lbracket:"",rbracket:"",relation:1,compare:0},l=t[n];if("object"==typeof l){var a=parseInt(""+l.operator1,10);if(1001===a||1002===a)return s.compare=1001===a?d.Compare.Equal:d.Compare.NotEqual,s.lbracket="(",s.relation=1002===a?1:2,i.push(s),r.includes(o)?(s.value=null,s.lbracket="",s.relation=1,void(s.compare=1002===a?d.Compare.IsNot:d.Compare.Is)):((h={filterField:n,value:null,lbracket:"",rbracket:")",relation:1,compare:0}).compare=1002===a?d.Compare.IsNot:d.Compare.Is,void i.push(h));if(s.compare=l.operator1,s.value=l.value1,i.push(s),l.value2)s.lbracket="(",s.relation="and"===l.relation?1:2,(h={filterField:n,value:"",lbracket:"",rbracket:")",relation:1,compare:0}).compare=l.operator2,h.value=l.value2,i.push(h);else if(l.operator2){var c=parseInt(""+l.operator2,10);if(1001===c||1002===c){var h;if(s.lbracket="(",s.relation="and"===l.relation?1:2,(h={filterField:n,value:"",lbracket:"(",rbracket:"",relation:2,compare:0}).compare=1001===c?d.Compare.Equal:d.Compare.NotEqual,h.relation=1002===c?1:2,i.push(h),r.includes(o))return h.value=null,h.lbracket="",h.rbracket=")",h.relation=1,void(h.compare=1002===c?d.Compare.IsNot:d.Compare.Is);var u={filterField:n,value:null,lbracket:"",rbracket:"))",relation:1,compare:0};u.compare=1001===c?d.Compare.Is:d.Compare.IsNot,i.push(u)}}}return s})}return i.length&&(this.checkEnumTypeFilters(i),i[i.length-1].relation=0),i},t.prototype.checkEnumTypeFilters=function(t){var e=this,i={};t.forEach(function(t,r){var n=e.convertEnumTypeFilter(t);n&&n.length&&(i[t.filterField]=n)});var r=Object.keys(i);return r.length&&r.forEach(function(e){var r=t.findIndex(function(t){return t.filterField===e});t.splice.apply(t,R([r,1],i[e]))}),t},t.prototype.convertEnumTypeFilter=function(t){if(t){var e=this.dfs.getColumn(t.filterField);if(e&&e.filter&&e.filter.type===E["enum"]&&Array.isArray(t.value)&&t.value.length){if(1===t.value.length)return t.compare=d.Compare.Equal,t.value=t.value[0],[];var i=t.value.map(function(e){return{filterField:t.filterField,value:e,lbracket:"",rbracket:"",relation:2,compare:0}});return i[0].lbracket="(",i[t.value.length-1].rbracket=")",i[t.value.length-1].relation=1,i}}return[]},t.prototype.createColumnFilterOptions=function(t){var e={type:E.string,enableOperator:!0};if(t.editor)switch(t.editor.type){case"textarea":case"textbox":case"language-textbox":e={type:E.string,enableOperator:!0};break;case"checkbox":case"switch":e={type:E.boolean,enableOperator:!1};break;case"numberbox":e={type:E.number,enableOperator:!0};break;case"combolist":case"select":e={type:E["enum"],enableOperator:!0,options:t.editor.options};break;case"datepicker":e={type:"datetime"===t.dataType?E.datetime:E.date,enableOperator:!0,options:{dateFormat:t.editor.options.dateFormat,returnFormat:t.editor.options.returnFormat}};break;case"timepicker":e={type:E.time,enableOperator:!0}}else if(t.formatter){if("object"==typeof t.formatter&&Object.keys(t.formatter).length){var i=t.formatter.options;switch(t.formatter.type){case"number":e={type:E.number,enableOperator:!0};break;case"enum":e={type:E["enum"],enableOperator:!0,options:i};break;case"boolean":e={type:E.boolean,enableOperator:!1};break;case"datetime":var r=E.datetime,n="yyyy-MM-dd",o="yyyy-MM-dd";i&&i.format?-1==(n=i.format).indexOf("HH:")?r=E.date:(o+=" HH:mm",n.indexOf("ss")>-1&&(o+=":ss")):r=E.date,(e={type:r,enableOperator:!0}).options={dateFormat:n,returnFormat:o};break;default:e={type:E.string,enableOperator:!0}}}}else e={type:E.string,enableOperator:!0};return e},t.prototype.convertSmartFilter2EntityFilter=function(t){return t&&t.length?t.map(function(t){return t}):[]},t.prototype.validateRowData2=function(t,e){return!e||0===e.length||this.checkRowDataWithCondition(t,e)},t.prototype.checkRowDataWithCondition=function(t,e){var i=this,r=null;e&&(r={},e.forEach(function(e){var n=e.FilterField,o=Y.getValue(n,t),s=i.dfs.getColumn(n);s&&s.isMultilingualField&&(o=Y.getMultilingualValue(o,i.localeSer.localeId));var l=e,a=l.Value,d=(l.Relation,l.Compare);if(l){var c=i.getCompareResult(o,d,a);r[n]===undefined?r[n]=[c]:r[n].push(c)}}));var n=Object.keys(r),o=[];return n.forEach(function(t){var i=e.filter(function(e){return e.FilterField===t});1===r[t].length?o.push(r[t][0]):1===i[0].Relation&&2===r[t].length?o.push(r[t][0]&&r[t][1]):o.push(r[t].indexOf(!0)>-1)}),-1===o.indexOf(!1)},t.prototype.executeSmartFilter=function(t,e){var i=this;return t&&t.length?t.filter(function(t){return i.validateRowData2(t,e)}):t},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:Z},{type:a.LocaleService},{type:e.Injector}]},t}(),ot=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[],imports:[c.CommonModule],exports:[],providers:[]}]}],t}(),st=function(){},lt=new e.InjectionToken("PERFECT_SCROLLBAR_CONFIG"),at=function(t,e,i,r){this.x=t,this.y=e,this.w=i,this.h=r},dt=function(t,e){this.x=t,this.y=e},ct=["psScrollY","psScrollX","psScrollUp","psScrollDown","psScrollLeft","psScrollRight","psYReachEnd","psYReachStart","psXReachEnd","psXReachStart"],ht=function(){function t(t){void 0===t&&(t={}),this.assign(t)}return t.prototype.assign=function(t){for(var e in void 0===t&&(t={}),t)this[e]=t[e]},t}(),ut=function(){function t(t,i,n,o,s){this.zone=t,this.differs=i,this.elementRef=n,this.platformId=o,this.defaults=s,this.instance=null,this.ro=null,this.timeout=null,this.animation=null,this.configDiff=null,this.ngDestroy=new r.Subject,this.disabled=!1,this.psScrollY=new e.EventEmitter,this.psScrollX=new e.EventEmitter,this.psScrollUp=new e.EventEmitter,this.psScrollDown=new e.EventEmitter,this.psScrollLeft=new e.EventEmitter,this.psScrollRight=new e.EventEmitter,this.psYReachEnd=new e.EventEmitter,this.psYReachStart=new e.EventEmitter,this.psXReachEnd=new e.EventEmitter,this.psXReachStart=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;if(!this.disabled&&c.isPlatformBrowser(this.platformId)){var e=new ht(this.defaults);e.assign(this.config),this.zone.runOutsideAngular(function(){setTimeout(function(){t.instance=new h(t.elementRef.nativeElement,e)})}),this.configDiff||(this.configDiff=this.differs.find(this.config||{}).create(),this.configDiff.diff(this.config||{})),this.zone.runOutsideAngular(function(){t.ro=new u(function(){t.update()}),t.elementRef.nativeElement.children[0]&&t.ro.observe(t.elementRef.nativeElement.children[0]),t.ro.observe(t.elementRef.nativeElement)}),this.zone.runOutsideAngular(function(){ct.forEach(function(e){var i=e.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()});e.indexOf("X")>-1||e.indexOf("Left")>-1||e.indexOf("Right")>-1?r.fromEvent(t.elementRef.nativeElement,i).subscribe(function(i){t[e].emit(i)}):r.fromEvent(t.elementRef.nativeElement,i).pipe(n.takeUntil(t.ngDestroy)).pipe(n.auditTime(20)).subscribe(function(i){t[e].emit(i)})})})}},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnDestroy=function(){var t=this;c.isPlatformBrowser(this.platformId)&&(this.ngDestroy.next(),this.ngDestroy.complete(),this.ro&&this.ro.disconnect(),this.timeout&&"undefined"!=typeof window&&window.clearTimeout(this.timeout),this.zone.runOutsideAngular(function(){t.instance&&t.instance.destroy()}),this.instance=null)},t.prototype.ngDoCheck=function(){!this.disabled&&this.configDiff&&c.isPlatformBrowser(this.platformId)&&(this.configDiff.diff(this.config||{})&&(this.ngOnDestroy(),this.ngOnInit()))},t.prototype.ngOnChanges=function(t){t.disabled&&!t.disabled.isFirstChange()&&c.isPlatformBrowser(this.platformId)&&t.disabled.currentValue!==t.disabled.previousValue&&(!0===t.disabled.currentValue?this.ngOnDestroy():!1===t.disabled.currentValue&&this.ngOnInit())},t.prototype.ps=function(){return this.instance},t.prototype.update=function(){var t=this;"undefined"!=typeof window&&(this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){if(!t.disabled&&t.configDiff)try{t.zone.runOutsideAngular(function(){t.instance&&t.instance.update()})}catch(e){}},0))},t.prototype.geometry=function(t){return void 0===t&&(t="scroll"),new at(this.elementRef.nativeElement[t+"Left"],this.elementRef.nativeElement[t+"Top"],this.elementRef.nativeElement[t+"Width"],this.elementRef.nativeElement[t+"Height"])},t.prototype.position=function(t){return void 0===t&&(t=!1),!t&&this.instance?new dt(this.instance.reach.x||0,this.instance.reach.y||0):new dt(this.elementRef.nativeElement.scrollLeft,this.elementRef.nativeElement.scrollTop)},t.prototype.scrollable=function(t){void 0===t&&(t="any");var e=this.elementRef.nativeElement;return"any"===t?e.classList.contains("ps--active-x")||e.classList.contains("ps--active-y"):"both"===t?e.classList.contains("ps--active-x")&&e.classList.contains("ps--active-y"):e.classList.contains("ps--active-"+t)},t.prototype.scrollTo=function(t,e,i){this.disabled||(null==e&&null==i?this.animateScrolling("scrollTop",t,i):(null!=t&&this.animateScrolling("scrollLeft",t,i),null!=e&&this.animateScrolling("scrollTop",e,i)))},t.prototype.scrollToX=function(t,e){this.animateScrolling("scrollLeft",t,e)},t.prototype.scrollToY=function(t,e){this.animateScrolling("scrollTop",t,e)},t.prototype.scrollToTop=function(t,e){this.animateScrolling("scrollTop",t||0,e)},t.prototype.scrollToLeft=function(t,e){this.animateScrolling("scrollLeft",t||0,e)},t.prototype.scrollToRight=function(t,e){var i=this.elementRef.nativeElement.scrollWidth-this.elementRef.nativeElement.clientWidth;this.animateScrolling("scrollLeft",i-(t||0),e)},t.prototype.scrollToBottom=function(t,e){var i=this.elementRef.nativeElement.scrollHeight-this.elementRef.nativeElement.clientHeight;this.animateScrolling("scrollTop",i-(t||0),e)},t.prototype.scrollToElement=function(t,e,i){var r=this.elementRef.nativeElement.querySelector(t);if(r){var n=r.getBoundingClientRect(),o=this.elementRef.nativeElement.getBoundingClientRect();if(this.elementRef.nativeElement.classList.contains("ps--active-x")){var s=this.elementRef.nativeElement.scrollLeft,l=n.left-o.left+s;this.animateScrolling("scrollLeft",l+(e||0),i)}if(this.elementRef.nativeElement.classList.contains("ps--active-y")){s=this.elementRef.nativeElement.scrollTop,l=n.top-o.top+s;this.animateScrolling("scrollTop",l+(e||0),i)}}},t.prototype.animateScrolling=function(t,e,i){var r=this;if(this.animation&&(window.cancelAnimationFrame(this.animation),this.animation=null),i&&"undefined"!=typeof window){if(e!==this.elementRef.nativeElement[t]){var n=0,o=0,s=performance.now(),l=this.elementRef.nativeElement[t],a=(l-e)/2,d=function(c){o+=Math.PI/(i/(c-s)),n=Math.round(e+a+a*Math.cos(o)),r.elementRef.nativeElement[t]===l&&(o>=Math.PI?r.animateScrolling(t,e,0):(r.elementRef.nativeElement[t]=n,l=r.elementRef.nativeElement[t],s=c,r.animation=window.requestAnimationFrame(d)))};window.requestAnimationFrame(d)}}else this.elementRef.nativeElement[t]=e},t.decorators=[{type:e.Directive,args:[{selector:"[scrollbar]",exportAs:"ngxScrollbar"}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.KeyValueDiffers},{type:e.ElementRef},{type:undefined,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]},{type:undefined,decorators:[{type:e.Optional},{type:e.Inject,args:[lt]}]}]},t.propDecorators={disabled:[{type:e.Input}],config:[{type:e.Input,args:["scrollbar"]}],psScrollY:[{type:e.Output}],psScrollX:[{type:e.Output}],psScrollUp:[{type:e.Output}],psScrollDown:[{type:e.Output}],psScrollLeft:[{type:e.Output}],psScrollRight:[{type:e.Output}],psYReachEnd:[{type:e.Output}],psYReachStart:[{type:e.Output}],psXReachEnd:[{type:e.Output}],psXReachStart:[{type:e.Output}]},t}(),pt=function(){function t(t,i,n){this.zone=t,this.cdRef=i,this.platformId=n,this.states={},this.indicatorX=!1,this.indicatorY=!1,this.interaction=!1,this.scrollPositionX=0,this.scrollPositionY=0,this.scrollDirectionX=0,this.scrollDirectionY=0,this.usePropagationX=!1,this.usePropagationY=!1,this.allowPropagationX=!1,this.allowPropagationY=!1,this.stateTimeout=null,this.ngDestroy=new r.Subject,this.stateUpdate=new r.Subject,this.disabled=!1,this.usePSClass=!0,this.autoPropagation=!1,this.scrollIndicators=!1,this.psScrollY=new e.EventEmitter,this.psScrollX=new e.EventEmitter,this.psScrollUp=new e.EventEmitter,this.psScrollDown=new e.EventEmitter,this.psScrollLeft=new e.EventEmitter,this.psScrollRight=new e.EventEmitter,this.psYReachEnd=new e.EventEmitter,this.psYReachStart=new e.EventEmitter,this.psXReachEnd=new e.EventEmitter,this.psXReachStart=new e.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;c.isPlatformBrowser(this.platformId)&&(this.stateUpdate.pipe(n.takeUntil(this.ngDestroy)).pipe(n.distinctUntilChanged(function(e,i){return e===i&&!t.stateTimeout})).subscribe(function(e){t.stateTimeout&&"undefined"!=typeof window&&(window.clearTimeout(t.stateTimeout),t.stateTimeout=null),"x"===e||"y"===e?(t.interaction=!1,"x"===e?(t.indicatorX=!1,t.states.left=!1,t.states.right=!1,t.autoPropagation&&t.usePropagationX&&(t.allowPropagationX=!1)):"y"===e&&(t.indicatorY=!1,t.states.top=!1,t.states.bottom=!1,t.autoPropagation&&t.usePropagationY&&(t.allowPropagationY=!1))):("left"===e||"right"===e?(t.states.left=!1,t.states.right=!1,t.states[e]=!0,t.autoPropagation&&t.usePropagationX&&(t.indicatorX=!0)):"top"!==e&&"bottom"!==e||(t.states.top=!1,t.states.bottom=!1,t.states[e]=!0,t.autoPropagation&&t.usePropagationY&&(t.indicatorY=!0)),t.autoPropagation&&"undefined"!=typeof window&&(t.stateTimeout=window.setTimeout(function(){t.indicatorX=!1,t.indicatorY=!1,t.stateTimeout=null,t.interaction&&(t.states.left||t.states.right)&&(t.allowPropagationX=!0),t.interaction&&(t.states.top||t.states.bottom)&&(t.allowPropagationY=!0),t.cdRef.markForCheck()},500))),t.cdRef.markForCheck(),t.cdRef.detectChanges()}),this.zone.runOutsideAngular(function(){if(t.directiveRef){var e=t.directiveRef.elementRef.nativeElement;r.fromEvent(e,"wheel").pipe(n.takeUntil(t.ngDestroy)).subscribe(function(e){if(!t.disabled&&t.autoPropagation){var i=e.deltaX,r=e.deltaY;t.checkPropagation(e,i,r)}}),r.fromEvent(e,"touchmove").pipe(n.takeUntil(t.ngDestroy)).subscribe(function(e){if(!t.disabled&&t.autoPropagation){var i=e.touches[0].clientX,r=e.touches[0].clientY,n=i-t.scrollPositionX,o=r-t.scrollPositionY;t.checkPropagation(e,n,o),t.scrollPositionX=i,t.scrollPositionY=r}}),r.merge(r.fromEvent(e,"ps-scroll-x").pipe(n.mapTo("x")),r.fromEvent(e,"ps-scroll-y").pipe(n.mapTo("y")),r.fromEvent(e,"ps-x-reach-end").pipe(n.mapTo("right")),r.fromEvent(e,"ps-y-reach-end").pipe(n.mapTo("bottom")),r.fromEvent(e,"ps-x-reach-start").pipe(n.mapTo("left")),r.fromEvent(e,"ps-y-reach-start").pipe(n.mapTo("top"))).pipe(n.takeUntil(t.ngDestroy)).subscribe(function(e){t.disabled||!t.autoPropagation&&!t.scrollIndicators||t.stateUpdate.next(e)})}}),window.setTimeout(function(){ct.forEach(function(e){t.directiveRef&&(t.directiveRef[e]=t[e])})},0))},t.prototype.ngOnDestroy=function(){c.isPlatformBrowser(this.platformId)&&(this.ngDestroy.next(),this.ngDestroy.unsubscribe(),this.stateTimeout&&"undefined"!=typeof window&&window.clearTimeout(this.stateTimeout))},t.prototype.ngDoCheck=function(){if(c.isPlatformBrowser(this.platformId)&&!this.disabled&&this.autoPropagation&&this.directiveRef){var t=this.directiveRef.elementRef.nativeElement;this.usePropagationX=t.classList.contains("ps--active-x"),this.usePropagationY=t.classList.contains("ps--active-y")}},t.prototype.checkPropagation=function(t,e,i){this.interaction=!0;var r=e<0?-1:1,n=i<0?-1:1;(this.usePropagationX&&this.usePropagationY||this.usePropagationX&&(!this.allowPropagationX||this.scrollDirectionX!==r)||this.usePropagationY&&(!this.allowPropagationY||this.scrollDirectionY!==n))&&(t.preventDefault(),t.stopPropagation()),e&&(this.scrollDirectionX=r),i&&(this.scrollDirectionY=n),this.stateUpdate.next("interaction"),this.cdRef.detectChanges()},t.decorators=[{type:e.Component,args:[{selector:"scrollbar",exportAs:"ngxScrollbar",template:'<div style="position: static;" [class.ps]="usePSClass" [scrollbar]="config" [disabled]="disabled">\r\n    <div class="ps-content">\r\n      <ng-content></ng-content>\r\n    </div>\r\n  \r\n    <div *ngIf="scrollIndicators" class="ps-overlay" [class.ps-at-top]="states.top" [class.ps-at-left]="states.left" [class.ps-at-right]="states.right" [class.ps-at-bottom]="states.bottom">\r\n      <div class="ps-indicator-top" [class.ps-indicator-show]="indicatorY && interaction"></div>\r\n      <div class="ps-indicator-left" [class.ps-indicator-show]="indicatorX && interaction"></div>\r\n      <div class="ps-indicator-right" [class.ps-indicator-show]="indicatorX && interaction"></div>\r\n      <div class="ps-indicator-bottom" [class.ps-indicator-show]="indicatorY && interaction"></div>\r\n    </div>\r\n  </div>',encapsulation:e.ViewEncapsulation.None}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.ChangeDetectorRef},{type:undefined,decorators:[{type:e.Inject,args:[e.PLATFORM_ID]}]}]},t.propDecorators={disabled:[{type:e.Input}],usePSClass:[{type:e.Input}],autoPropagation:[{type:e.HostBinding,args:["class.ps-show-limits"]},{type:e.Input}],scrollIndicators:[{type:e.HostBinding,args:["class.ps-show-active"]},{type:e.Input}],config:[{type:e.Input}],psScrollY:[{type:e.Output}],psScrollX:[{type:e.Output}],psScrollUp:[{type:e.Output}],psScrollDown:[{type:e.Output}],psScrollLeft:[{type:e.Output}],psScrollRight:[{type:e.Output}],psYReachEnd:[{type:e.Output}],psYReachStart:[{type:e.Output}],psXReachEnd:[{type:e.Output}],psXReachStart:[{type:e.Output}],directiveRef:[{type:e.ViewChild,args:[ut]}]},t}(),ft=function(){function t(){this.reachX="start",this.reachY="start",this.scrollbarXActive=!1,this.scrollbarYActive=!1,this.hasXScrollbar=new e.EventEmitter,this.hasYScrollbar=new e.EventEmitter,this.scrollMoveTo=new e.EventEmitter}return t.prototype.ngOnInit=function(){},t.prototype.ngOnChanges=function(t){t.scrollbarYActive&&!t.scrollbarYActive.isFirstChange()&&this.hasYScrollbar.emit(this.scrollbarYActive)},t.prototype.scrollTo=function(t,e){t.stopPropagation(),this.scrollMoveTo.emit({dir:e,event:t})},t.decorators=[{type:e.Component,args:[{selector:"scrollbar-arrows",template:'<ng-container *ngIf="scrollbarXActive">\r\n    <div class="scrollbar-arrow scrollbar-arrow-left" (click)="scrollTo($event, \'left\')" [class.scrollbar-arrow-disable]="reachX === \'start\'">\r\n        <span class="f-icon f-icon-arrow-60-left"></span>\r\n    </div>\r\n    <div class="scrollbar-arrow scrollbar-arrow-right" [class.scrollbar-y]="scrollbarYActive" (click)="scrollTo($event, \'right\')"  [class.scrollbar-arrow-disable]="reachX === \'end\'">\r\n        <span class="f-icon f-icon-arrow-60-right"></span>\r\n    </div>\r\n</ng-container>\r\n\r\n\r\n\r\n<ng-container *ngIf="scrollbarYActive">\r\n    <div class="scrollbar-arrow scrollbar-arrow-top" (click)="scrollTo($event, \'top\')"  [class.scrollbar-arrow-disable]="reachY === \'start\'">\r\n        <span class="f-icon f-icon-arrow-60-up"></span>\r\n    </div>\r\n    <div class="scrollbar-arrow scrollbar-arrow-bottom" [class.scrollbar-x]="scrollbarXActive" (click)="scrollTo($event, \'bottom\')"  [class.scrollbar-arrow-disable]="reachY === \'end\'">\r\n        <span class="f-icon f-icon-arrow-60-down"></span>\r\n    </div>\r\n</ng-container>\r\n\r\n<div class="scrollbar-arrow-block" *ngIf="scrollbarYActive && scrollbarXActive"></div>\r\n',encapsulation:e.ViewEncapsulation.None,styles:[".scrollbar-allways-show .ps.ps--active-x>.ps__rail-x{margin-right:0!important}.scrollbar-allways-show .ps.ps--active-y>.ps__rail-y{margin-bottom:0!important}.scrollbar-allways-show .ps.ps--active-x.ps--active-y>.ps__rail-x{margin-right:18px!important}.scrollbar-allways-show .ps.ps--active-x.ps--active-y>.ps__rail-y{margin-bottom:18px!important}.scrollbar-allways-show.scroolbar-arrows .ps.ps--active-x>.ps__rail-x{margin-right:18px!important;margin-left:18px!important}.scrollbar-allways-show.scroolbar-arrows .ps.ps--active-y>.ps__rail-y{margin-top:18px!important;margin-bottom:18px!important}.scrollbar-allways-show.scroolbar-arrows .ps.ps--active-x.ps--active-y>.ps__rail-x{margin-right:36px!important}.scrollbar-allways-show.scroolbar-arrows .ps.ps--active-x.ps--active-y>.ps__rail-y{margin-bottom:36px!important}.scroolbar-arrows .scrollbar-arrow{position:absolute;width:18px;height:18px;z-index:1000;background:#f5f6f9;color:#505050}.scroolbar-arrows .scrollbar-arrow:hover:not(.scrollbar-arrow-disable){background:#d2d8e9}.scroolbar-arrows .scrollbar-arrow:active:not(.scrollbar-arrow-disable){background:#b2b2b2;color:#fff}.scroolbar-arrows .scrollbar-arrow-left{bottom:0;border-top:1px solid #dee4ed}.scroolbar-arrows .scrollbar-arrow-right{right:0;bottom:0;border-top:1px solid #dee4ed}.scroolbar-arrows .scrollbar-arrow-bottom,.scroolbar-arrows .scrollbar-arrow-left,.scroolbar-arrows .scrollbar-arrow-right,.scroolbar-arrows .scrollbar-arrow-top{display:flex;align-items:center;justify-content:center}.scroolbar-arrows .scrollbar-arrow-left .f-icon,.scroolbar-arrows .scrollbar-arrow-right .f-icon{position:relative;top:-1px;font-size:12px}.scroolbar-arrows .scrollbar-arrow-bottom .f-icon,.scroolbar-arrows .scrollbar-arrow-top .f-icon{font-size:12px}.scroolbar-arrows .scrollbar-arrow-right.scrollbar-y{right:18px}.scroolbar-arrows .scrollbar-arrow-top{top:0;right:0;border-left:1px solid #dee4ed}.scroolbar-arrows .scrollbar-arrow-bottom{bottom:0;right:0;border-left:1px solid #dee4ed}.scroolbar-arrows .scrollbar-arrow-bottom.scrollbar-x{bottom:18px}.scroolbar-arrows .scrollbar-arrow-block{width:18px;height:18px;position:absolute;right:0;bottom:0;background:#fff;z-index:1000}.scroolbar-arrows .scrollbar-arrow-disable{color:#dadada}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={reachX:[{type:e.Input}],reachY:[{type:e.Input}],scrollbarXActive:[{type:e.Input}],scrollbarYActive:[{type:e.Input}],hasXScrollbar:[{type:e.Output}],hasYScrollbar:[{type:e.Output}],scrollMoveTo:[{type:e.Output}]},t}(),gt=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[c.CommonModule],declarations:[pt,ut,ft],exports:[c.CommonModule,pt,ut,ft]}]}],t}(),mt=function(){function t(t){this.template=t}return t.decorators=[{type:e.Directive,args:[{selector:"[grid-cell-editor]"}]}],t.ctorParameters=function(){return[{type:e.TemplateRef}]},t}(),yt=function(){function t(){this.halign="left",this.align="left",this.readonly=!0,this.editable=!1}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterContentInit=function(){},t.decorators=[{type:e.Directive,args:[{selector:"farris-grid-column"}]}],t.ctorParameters=function(){return[]},t.propDecorators={field:[{type:e.Input}],title:[{type:e.Input}],width:[{type:e.Input}],halign:[{type:e.Input}],align:[{type:e.Input}],formatter:[{type:e.Input}],readonly:[{type:e.Input}],editable:[{type:e.Input}],editor:[{type:e.ContentChild,args:[mt]}]},t}(),wt=function(){function t(t,i,n){this.el=t,this.render=i,this.inject=n,this.padding="",this.height=40,this.filterData=[],this.clearFilters=new e.EventEmitter,this.removeFilter=new e.EventEmitter,this.filterChange=new e.EventEmitter,this.resize=new e.EventEmitter,this.sk="",this.destory$=new r.Subject}return t.prototype.ngOnInit=function(){var t=this;this.dg=this.inject.get(xt),this.sk="smartfilter_"+this.dg.dgs.createConfigKey(this.dg.id),this.dg.dgs.clearFilter.pipe(n.takeUntil(this.destory$)).subscribe(function(){t.clearFilters.emit(null)})},t.prototype.ngOnChanges=function(t){},t.prototype.ngOnDestroy=function(){this.destory$.next(),this.destory$.complete()},t.prototype.onQuery=function(t){var e=t.data,i=t.filterItem;if(e&&e.length){var r=JSON.parse(e);r&&r.length&&this.filterChange.emit({conditions:r,filterItem:i})}},t.prototype.onResetFilter=function(t){this.clearFilters.emit(t)},t.prototype.onRemoveFilter=function(t){this.removeFilter.emit(t)},t.prototype.onResize=function(t){var e=this;setTimeout(function(){var t=e.el.nativeElement.querySelector(".f-filter-wrapper");if(t){var i=t.offsetHeight;i&&e.resize.emit(i+6)}})},t.decorators=[{type:e.Component,args:[{selector:"smart-filter-toolbar",template:'\r\n<div class="f-datagrid-filter-toolbar" [style.height.px]="height" \r\n[style.padding]="padding" placeholder="此处显示列过滤条件" style="align-items: normal;"\r\n[style.display]="filterData && filterData.length ? \'\' : \'none\'">\r\n<farris-filter [filterList]="filterData" (query)="onQuery($event)"  #farrisFilter\r\n    (resetChange)="onResetFilter($event)" (clearFilter)="onRemoveFilter($event)"\r\n    (filterResize)="onResize($event)" (expandFilter)="onResize($event)"\r\n    [localStorageKey]="sk"\r\n>\r\n</farris-filter>\r\n\r\n</div>'}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector}]},t.propDecorators={padding:[{type:e.Input}],height:[{type:e.Input}],filterData:[{type:e.Input}],clearFilters:[{type:e.Output}],removeFilter:[{type:e.Output}],filterChange:[{type:e.Output}],resize:[{type:e.Output}],filtebar:[{type:e.ViewChild,args:["farrisFilter"]}]},t}();function vt(t,e){var i=e.valueField||e.idField;return{controltype:"checkboxgroup",enumValues:e.data.map(function(t){return{value:t[i],name:t[e.textField]}})}}var bt=function(){function t(){this.conditions=[],this.controlData=[],this.filterChanged=new r.Subject,this.removeFilter=new r.Subject,this.clearAllFilter=new r.Subject}return t.prototype.getColumnFilterData=function(t){var e={controltype:"text"};if(t.filter!==undefined){if("boolean"==typeof t.filter){if(t.formatter&&"object"==typeof t.formatter&&Object.keys(t.formatter).length){var i=t.formatter.options;switch(t.formatter.type){case"number":return{controltype:"flexibleNumber",single:!1};case"enum":return vt(0,i);case"boolean":return{controltype:"bool-check"};case"datetime":var r="datetime",n="yyyy-MM-dd";i&&i.format?-1==(n=i.format).indexOf("HH:")?r="date":n.indexOf("ss"):r="date",e={controltype:"flexibleDate",dateFormat:n,single:!1,showType:3,showTime:"datetime"===r};break;default:return{controltype:"text"}}}return e}switch(t.filter.type){case E["enum"]:return vt(0,t.filter.options);case E.date:case E.datetime:return function(t,e){var i="datetime",r="yyyy-MM-dd";return e&&e.format?-1==(r=e.format).indexOf("HH:")?i="date":r.indexOf("ss"):i="date",{controltype:"flexibleDate",dateFormat:r,single:!1,showType:1,showTime:"datetime"===i}}(0,t.filter.options);case E.number:return{controltype:"flexibleNumber",single:!1};case E.boolean:return{controltype:"bool-check"}}}return e},t.prototype.filterConditionChanged=function(t){var e,i,r=t.conditions;if(this.conditions&&this.conditions.length){if("toolbar"===t.from?this.conditions=R(r):(this.conditions=this.conditions.filter(function(t){return t.FilterField!==r[0].FilterField}),1===r.length?this.conditions.push(x({},r[0])):(i=this.conditions).push.apply(i,R(r))),t.controlData){var n=this.controlData.findIndex(function(e){return e.labelCode===t.controlData.labelCode});n>-1?this.controlData[n]=x({},t.controlData):this.controlData.push(x({},t.controlData))}}else(e=this.conditions).push.apply(e,R(r)),this.controlData.push(x({},t.controlData));this.filterChanged.next({conditions:R(this.conditions),controlData:R(this.controlData)})},t.prototype.removeCondition=function(t,e){void 0===e&&(e=!1),this.conditions&&this.conditions.length&&(this.conditions=this.conditions.filter(function(e){return e.FilterField!==t.labelCode}),this.controlData=this.controlData.filter(function(e){return e.labelCode!==t.labelCode})),this.filterChanged.next({conditions:R(this.conditions),controlData:R(this.controlData)}),e&&this.removeFilter.next(t)},t.prototype.clearAll=function(){this.conditions=[],this.controlData=[],this.clearAllFilter.next(null)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),Ct=function(){function t(t){var e=this;this.dgRef=null,this.oldSettings=null,this.selectStartEvent=null,this.events=null,this.dgRef=t,"default"===this.dgRef.selectionMode&&t.zone.runOutsideAngular(function(){e.removeEvents(),e.events=e.registerStopSelectionEvent()})}return t.prototype.destroy=function(){this.dgRef=null,this.removeEvents()},t.prototype.removeEvents=function(){this.events&&this.events.length&&(this.events.forEach(function(t){t()}),this.events=null)},t.prototype.toggleMode=function(){this.dgRef&&("default"===this.dgRef.selectionMode?this.enableWindowsSelectionMode():this.restoreSettings())},t.prototype.enableWindowsSelectionMode=function(){this.dgRef&&(this.oldSettings={showCheckbox:this.dgRef.showCheckbox,keepSelect:this.dgRef.keepSelect,onlySelectSelf:this.dgRef.onlySelectSelf,selectOnCheck:this.dgRef.selectOnCheck,checkOnSelect:this.dgRef.checkOnSelect},this.dgRef.showCheckbox=!0,this.dgRef.keepSelect=!0,this.dgRef.onlySelectSelf=!1,this.dgRef.selectOnCheck=!0,this.dgRef.checkOnSelect=!0,this.dgRef.dfs.updateProperty("keepSelect",!0),this.dgRef.dfs.updateProperty("onlySelectSelf",!1),this.dgRef.dfs.updateProperty("selectOnCheck",!0),this.dgRef.dfs.updateProperty("checkOnSelect",!0))},t.prototype.restoreSettings=function(){this.dgRef&&this.oldSettings&&(this.dgRef.showCheckbox=this.oldSettings.showCheckbox,this.dgRef.keepSelect=this.oldSettings.keepSelect,this.dgRef.onlySelectSelf=this.oldSettings.onlySelectSelf,this.dgRef.selectOnCheck=this.oldSettings.selectOnCheck,this.dgRef.checkOnSelect=this.oldSettings.checkOnSelect,this.dgRef.dfs.updateProperty("keepSelect",this.oldSettings.keepSelect),this.dgRef.dfs.updateProperty("onlySelectSelf",this.oldSettings.onlySelectSelf),this.dgRef.dfs.updateProperty("selectOnCheck",this.oldSettings.selectOnCheck),this.dgRef.dfs.updateProperty("checkOnSelect",this.oldSettings.checkOnSelect))},t.prototype.registerStopSelectionEvent=function(){var t=this;return[this.dgRef.render2.listen(document,"keydown",function(e){(e.ctrlKey||e.shiftKey)&&t.unselectable()}),this.dgRef.render2.listen(document,"keyup",function(e){(e.ctrlKey||e.shiftKey||17===e.keyCode||16===e.keyCode)&&t.enableSelectable()})]},t.prototype.unselectable=function(){this.dgRef.render2.setAttribute(this.dgRef.dgContainer.nativeElement,"unselectable","on"),this.dgRef.render2.setAttribute(this.dgRef.dgContainer.nativeElement,"onselectstart","return false"),this.dgRef.render2.setStyle(this.dgRef.dgContainer.nativeElement,"-moz-user-select","none")},t.prototype.enableSelectable=function(){this.dgRef.render2.removeAttribute(this.dgRef.dgContainer.nativeElement,"unselectable"),this.dgRef.render2.removeAttribute(this.dgRef.dgContainer.nativeElement,"onselectstart"),this.dgRef.render2.removeStyle(this.dgRef.dgContainer.nativeElement,"-moz-user-select")},t.prototype.beforRowClick=function(t){var e=this;if(this.dgRef&&"default"===this.dgRef.selectionMode){var i=this.dgRef.dfs.isRowSelected(t.id),o=t.e.ctrlKey,s=t.e.shiftKey;if(this.dgRef.endEditing(),o||s){if(s){var l=this.dgRef.focusRowIndex;-1===l&&(l=0);var a=t.rowIndex,d=l,c=a;l>a&&(d=a,c=l);var h=R(this.dgRef.getRows()).splice(d,c-d+1).map(function(t){return e.dgRef.dfs.primaryId(t)});return o||this.dgRef.clearCheckeds(!1,!1),this.dgRef.checkRows(h,!0),!0}}else if(i){var u=this.dgRef.getRows().map(function(t){return t.id}),p=this.dgRef.checkValues.filter(function(e){return u.includes(e)&&e!=t.id}),f=this.dgRef.checkValues.filter(function(t){return!u.includes(t)});p&&p.length&&(this.dgRef.unCheckRows(p,!0),this.dgRef.clearSelections(R([t.id],f)))}else this.dgRef.clearCheckeds();if(i&&o)return t.e.stopPropagation(),this.dgRef.unCheckRow(t.id),!0;var g=t.cellref?t.cellref.zoneClick:"",m=g&&g.length?100:0,y=r.of(!0);if(this.dgRef.beforeSelect){var w=this.dgRef.beforeSelect(t);w&&w.subscribe&&(y=w)}return y.pipe(n.delay(m)).subscribe(function(i){i&&(e.dgRef.dfs.selectRow(t.rowIndex,t.rowData),e.dgRef.selectedRow&&(e.dgRef.selectedRow.dr=t.dr)),e.dgRef.rowClick.emit({data:t.rowData,grid:e.dgRef,dblclick:!1}),e.dgRef.dgs.setSelecedRow.emit({selected:!0,id:e.dgRef.dfs.primaryId(t.rowData)}),m&&t.cellref&&t.cellref.runZoneClick&&t.cellref.runZoneClick(t.e)}),!0}return!1},t.prototype.endRowClick=function(){this.dgRef&&"default"===this.dgRef.selectionMode&&(this.dgRef.checkOnSelect=!1)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:xt}]},t}(),xt=function(){function t(t,i,o,s,d,c,h,u,p){var f=this;this.cd=t,this.el=i,this.inject=o,this.zone=s,this.dfs=d,this.dgs=c,this.app=h,this.domSanitizer=u,this.render2=p,this.auther="Lucas Huang - QQ:1055818239",this.version="0.8.x",this.__component_type__="DatagridComponent",this.fast=!1,this.pos="relative",this.hostCls=!1,this.useThemes=!0,this.id="",this.useHtmlTable=!1,this.autoHeight=!1,this.maxHeight=0,this.showBorder=!1,this.striped=!0,this.width=800,this.height=300,this.showHeader=!0,this.headerHeight=35,this.headerWrap=!1,this.showFooter=!1,this.footerHeight=29,this.footerDataFrom="client",this.footerPosition="bottom",this.rowHeight=29,this._sizeType="sm",this._fit=!1,this._fitColumns=!1,this._autoFitColumns=!1,this.disabled=!1,this.scrollBarShowMode="auto",this.scrollBarOptions={width:18,height:18},this.showScrollArrow=!1,this.resizeColumn=!0,this.showLineNumber=!1,this.lineNumberTitle="",this.lineNumberWidth=36,this.checkboxColumnWidth=36,this.rowHover=!0,this.clickToEdit=!0,this._lockPagination=!1,this.__pagination=!0,this.pagerContentTemplate=null,this.pagerPos="right",this.pagerViewMode="default",this.pagerOnServer=!0,this.pageList=[10,20,30,50,100],this.pageIndex=1,this.pageSize=20,this.pagerHeight=56,this.showPageList=!1,this.showPageInfo=!0,this.showPageNumber=!0,this.pagerLabelSize=7,this.showGotoInput=!1,this.enableMorePageSelect=!1,this.showSelectedList=!1,this.cellTipTimer=1e3,this.controlPaginationState=!0,this._total=0,this.enableSelectRow=!0,this.multiSelect=!1,this.showCheckbox=!1,this.showAllCheckbox=!1,this.onlySelectSelf=!0,this.checkOnSelect=!1,this.selectOnCheck=!1,this.selectionMode="custom",this.keepSelect=!0,this.useBlankWhenDataIsEmpty=!1,this.emptyDataHeight=240,this.emptyMessage="暂无数据",this.emptyTemplate=null,this.emptyComponentType=null,this.idField="id",this._footerData=r.of([]),this.endEditByInvalid=!0,this._columns=[],this._fields=[],this.nowrap=!0,this.virtualized=!1,this.virtualizedAsyncLoad=!1,this.editMode="row",this._editable=!1,this.enableEditCellStyle=!1,this.selectOnEditing=!1,this.editorHeight=30,this.remoteSort=!1,this.hoverRowCls="f-datagrid-row-hover",this.enableDragColumn=!1,this.rowGroupPanelHeight=50,this.groupRows=!1,this.groupFooter=!1,this.expandGroupRows=!0,this.groupSummaryPosition="groupFooterRow",this.groupCellColSpan=1,this._groupField="",this.groupFields$=new r.BehaviorSubject([]),this.showGroupColumn=!0,this._showRowGroupPanel=!1,this.AutoColumnWidthUseDblclick=!0,this.useDefaultFilter=!1,this.enableSmartFilter=!1,this.enableFilterRow=!1,this.remoteFilter=!1,this.showFilterBar=!1,this.filterBarHeight=32,this.filterRowHeight=40,this.conditions={},this.selectValue=null,this.checkValues=[],this.selectValues=[],this.mergeCell=!1,this.mergeFields=[],this.enableClientSortForMergeCell=!1,this.useControlPanel=!1,this.enableSimpleMode=!1,this.controlPanelMode="advanced",this.enableScheme=!1,this.defaultSchemeName="系统预制",this.enableSetMultiHeaders=!1,this.maxMultiHeaders=3,this.showConfirmWhenSchemeChanged=!1,this.stopPropagation=!0,this.closeOtherGridEditor=!1,this.clearSelectionsWhenDataIsEmpty=!0,this.enableContextMenu=!1,this.contextMenus=null,this.selectValueChange=new e.EventEmitter,this.checkValuesChange=new e.EventEmitter,this.selectValuesChange=new e.EventEmitter,this.beginEdit=new e.EventEmitter,this.endEdit=new e.EventEmitter,this.cancelEdited=new e.EventEmitter,this.scrollY=new e.EventEmitter,this.pageSizeChanged=new e.EventEmitter,this.pageChanged=new e.EventEmitter,this.loadSuccess=new e.EventEmitter,this.emptyData=new e.EventEmitter,this.filterChanged=new e.EventEmitter,this.enableHighlightCell=!1,this.checkedRowsDataFromSource=!1,this.editcellWhenTabKeydwon=!1,this.beforeClickCell=new e.EventEmitter,this.dblclickRow=new e.EventEmitter,this.selectChanged=new e.EventEmitter,this.unSelect=new e.EventEmitter,this.selectAll=new e.EventEmitter,this.unSelectAll=new e.EventEmitter,this.scrollYLoad=new e.EventEmitter,this.checked=new e.EventEmitter,this.unChecked=new e.EventEmitter,this.checkAll=new e.EventEmitter,this.unCheckAll=new e.EventEmitter,this.checkedChange=new e.EventEmitter,this.columnSorted=new e.EventEmitter,this.rowClick=new e.EventEmitter,this.rowAppended=new e.EventEmitter,this.rowDeleted=new e.EventEmitter,this.rowUpdated=new e.EventEmitter,this.dataChange=new e.EventEmitter,this.lastCellEnterHandler=new e.EventEmitter,this.groupFieldChange=new e.EventEmitter,this.columnMoved=new e.EventEmitter,this.cellClick=new e.EventEmitter,this.resized=new e.EventEmitter,this._loading=!1,this._selectedRow=null,this.ds={index:0,rows:[],top:0,bottom:0,scrolling:!1},this.pagerOpts={},this.editors={},this.validators=[],this.footerWidth=0,this.clickDelay=150,this.resizeColumnInfo={proxyLineEdge:0,startWidth:0,startX:0,left:0},this.ro=null,this.subscriptions=[],this.realHeaderHeight=0,this.modalClickEvent=null,this.pending=!1,this.scrollInstance=null,this.mergeCellInfo={},this.ignoreTarget=["INPUT","SELECT","TEXTAREA"],this.clientFilterService=null,this.ControlPanelFeild="_datagrid-setting-control_",this._isResized=!1,this.gridSize={width:this.width+"px",height:this.height+"px"},this.clientFilterChanged=!1,this.styleSheetId="",this.groupRowPanelPlaceholder="",this.commonUtils=null,this.smartFilterService=null,this.smartFilterResult={controlData:[],conditions:[]},this.smartFilterBarHeight=32,this._active_datagrid_cls="datagrid-active",this._blured_datagrid_cls="datagrid-blurred",this._custom_datagrid_cls="datagrid",this.focusRowIndex=-1,this.documentBodyMouseDown=null,this.farrisInstances=null,this.currentPagerData=[],this.resizeTimer=null,this.debugSer=null,this.DATA_CHANGED_TIMER=null,this.exitRowEditingWhenBodyClick=!1,this.formValidations=null,this.isFF=!1,this._footerRowHeight=this.footerHeight,this.trackByRows=function(t,e){return e&&e[f.idField]||t},this.onDocumentMouseDown=function(t){var e=t.target.closest(".f-datagrid");if(f.pending)return!1;if(e){if(e.id===f.id)return void(f.isEditing()&&(f.exitRowEditingWhenBodyClick||"cell"==f.editMode)&&f.endEditing())}else f.activeDataGrid(!1);if(Y.hasDialogOpen()){var i=f.inDialog(),r=t.target.closest(".modal-body");if(!i||!r)return;if(i!=r)return}if(f.currentCell){if(!f.currentCell.cellElement)return;if(f.currentCell.isEditing){var o=t.target.__zone_symbol__clickfalse,s=t.target.closest(".bedesigner-toolbar"),l=t.target.className.indexOf("beEleGridButton")>-1,a=o&&o.length&&(t.target.closest(".f-section-in-mainsubcard")||l||s||t.target.closest(".datagrid-toolbars"));a&&!e&&(t.target.style.pointerEvents="none",t.stopPropagation());var d=a?s||l?50:200:0,c=f.currentCell.rowIndex;f.currentCell.cellElement.closeEdit().pipe(n.debounceTime(d)).subscribe(function(e){f.currentCell&&c!==f.currentCell.rowIndex||e&&(f.currentCell&&f.currentCell.cellElement&&(rt.removeClass(f.currentCell.cellElement,j),rt.removeClass(f.currentCell.cellElement,M)),f.dfs.cancelSelectCell(),f.unbindDocumentEditListener(),f.currentCell=null,a&&(o.forEach(function(e){e.callback(t)}),t.target.style.pointerEvents="auto",(s||l)&&f.app.tick()))})}}else f.isEditing()&&("cell"==f.editMode||f.exitRowEditingWhenBodyClick)&&f.endEditing()},this.styleSheetId="DATAGRID-"+Y.uuid(),this.localeService=this.inject.get(a.LocaleService),this.restService=this.inject.get(Q,null),this.colFormatSer=this.inject.get(g.ColumnFormatService),this.commonUtils=this.inject.get(l.CommonUtils,null),this.clientFilterService=new nt(d,this.localeService,o),this.farrisInstances=this.inject.get(l.FarrisComponentInstanceService,null),this.debugSer=this.inject.get(l.DebugService,null);var m="";if(l.WEBAPI_PREFIX_TOKEN&&(m=this.inject.get(l.WEBAPI_PREFIX_TOKEN,"")),this.debugSer||(this.debugSer=new l.DebugService),this.debugSer.useDebugMode&&this.debugSer.useDebugMode(),this.smartFilterService=this.inject.get(bt,null),this.idService=this.inject.get(l.IdService,null),this.dfs.localId=this.localeService.localeId,this.settingService=this.inject.get(T,null),this.settingService){this.settingService.setUriPerfixStr(m);var y=this.inject.get(O,null);this.settingService.httpRestService=y}var w=this.dfs.data$.pipe(n.switchMap(function(t){return f.beforeLoad?f.beforeLoad({data:t.rows,instance:f}).pipe(n.map(function(e){return e&&e.data&&(t.rows=e.data),t})):r.of(t)})).subscribe(function(t){f.cleanDom();var e=x({},t);f.conditions&&Object.keys(f.conditions).length&&!f.remoteFilter&&f.useDefaultFilter&&(e.rows=f.clientFilterService.executeFilter(e.rows,f.conditions)),f.ds=e,f.ds.rows&&f.ds.rows.length?(f.data=f.dfs.getData(),f.mergeCell&&f.mergeFields&&f.mergeFields.length&&(f.mergeCellInfo=f.dgs.getMergeCellInfo3(f.ds.rows,R(f.mergeFields))),f.setPagerTotal(),f.loadSuccess.emit(f.ds.rows)):(f.data=[],f.currentCell=null,f.clearSelectionsWhenDataIsEmpty&&f.clearAll(),f.emptyData.emit()),f.ds.scrolling||f.updateFooterData(),f.cd.detectChanges(),f.DATA_CHANGED_TIMER&&clearTimeout(f.DATA_CHANGED_TIMER),f.DATA_CHANGED_TIMER=setTimeout(function(){f.autoHeight&&f.maxHeight&&(f.maxHeight<55&&(f.maxHeight=60),"DIV"!==f.el.nativeElement.parentElement.nodeName&&f.writeConsole("Datagrid父容器必须为DIV。"));f.useBlankWhenDataIsEmpty&&f.calculateGridSize(f.fit),f.dgs.dataloaded.emit(),f.updateAllCheckboxStatus()},100)});this.subscriptions.push(w);var v=this.dfs.columnGroup$.pipe(n.debounceTime(60)).subscribe(function(t){t&&(f.colGroup=t,f.footerWidth=t.totalWidth,f.cd.detectChanges())});this.subscriptions.push(v),this.subscriptions.push(this.dfs.gridSize$.subscribe(function(t){t&&t.columnsGroup&&(f.colGroup=t.columnsGroup,f.nowrap||f.setFooterHeight(),f.cd.detectChanges())})),this.initEditorAndValidator();var b=this.dfs.currentCell$.subscribe(function(t){f.currentCell=t,t&&t.cellRef&&(t.cellRef.isEditing=t.isEditing),f.unbindMoveSelectRowEvent(),f.bindDocumentEditListener()});this.dfs.selectRow$.subscribe(function(t){f.currentCell||f.bindDocumentMoveSelectRowEvent(),f.selectedRow=t}),this.subscriptions.push(b),K.gridInstance=this;var C=this.dgs.onFilterChanged.pipe(n.debounceTime(200)).subscribe(function(t){f.conditions=t,f.clientFilterChanged=!0,f.filterData(f.conditions)});this.subscriptions.push(C);var S=this.dgs.refreshFooterData.subscribe(function(){f.updateFooterData()});this.subscriptions.push(S),this.dgs.commonUtils=this.commonUtils,this.dgs.focusRowChanged.subscribe(function(t){t&&(f.focusRowIndex=t.rowIndex)})}return Object.defineProperty(t.prototype,"autoHeightCls",{get:function(){return this.autoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sizeType",{get:function(){return this._sizeType},set:function(t){this._sizeType=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fit",{get:function(){return this._fit},set:function(t){this._fit=t,this.hostCls=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fitColumns",{get:function(){return this._fitColumns},set:function(t){this._fitColumns!==t&&(this._fitColumns=t,t?this.setFitColumns(t):(this.dfs.fitColumns(!1),this.dfs.initColumns(!1,!0),this.restituteColumnsSize()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoFitColumns",{get:function(){return this._autoFitColumns},set:function(t){this._autoFitColumns=t,this.dfs.updateProperty("autoFitColumns",t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lockPagination",{get:function(){return this._lockPagination},set:function(t){this._lockPagination=t,this.dgPager&&this.dgPager[t?"lock":"unlock"]()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pagination",{get:function(){return this.__pagination},set:function(t){this.__pagination!==t&&(this.__pagination=t,this.dfs.updateProperty("pagination",t),this.dgs.showGridHeader.emit())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"total",{get:function(){return this._total},set:function(t){this._total=t,this.pagerOpts.totalItems=t,this.pagination||(this.pagerOpts.itemsPerPage=t),this.dfs.setTotal(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerData",{get:function(){return this._footerData},set:function(t){t&&t.subscribe?this._footerData=t:this._footerData=r.of(t||[]),t&&this.setFooterHeight(),this.cd.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},set:function(t){this._columns=this.correctColumns(t),this.dfs.updateProperty("columns",this._columns)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this._fields},set:function(t){this._fields=t,this.columns=t,this.data&&this.columnsChanged(!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editable",{get:function(){return this._editable},set:function(t){this._editable!==t&&(this._editable=t,this.cd.detectChanges(),this.dgs.updateEmptyStyle())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupField",{get:function(){return this._groupField},set:function(t){this._groupField=t||"",Array.isArray(this._groupField)&&(this._groupField=this._groupField.join(",")),this._groupField?this.groupFields$.next(this._groupField.split(",")):this.groupFields$.next([]),this.dfs.updateProperty("groupField",this._groupField)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showRowGroupPanel",{get:function(){return this.groupRows&&this._showRowGroupPanel},set:function(t){this._showRowGroupPanel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},set:function(t){this._loading=t,this.cd.destroyed||this.cd.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selections",{get:function(){return this.dfs.getSelections()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkeds",{get:function(){return this.checkedRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkedRows",{get:function(){var t=this,e=this.dfs.getCheckeds();if(this.enableMorePageSelect){if(e&&e.length)return this.checkedRowsDataFromSource?e.map(function(e){var i=t.dfs.findRow(e.id);return i&&(e.data=i.data),e}):R(e)}else if(this.data&&this.data.length){var i=this.data.map(function(e){return e[t.idField]});return this.checkedRowsDataFromSource?e.filter(function(t){return i.includes(t.id)}).map(function(e){var i=t.dfs.findRow(e.id);return i&&(e.data=i.data),e}):e.filter(function(t){return i.includes(t.id)})}return[]},set:function(t){var e=this;t&&t.length&&(t=t.map(function(t){return t.data?t:{id:t[e.idField],data:t}})),this.dfs.updateProperty("checkedRows",t||[]),this.initSelectOrChecked(),this.cd.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRow",{get:function(){return this._selectedRow},set:function(t){t?this.selectValue!=t.id&&(this._selectedRow=t,this.selectValue=t.id,this.selectValueChange.emit(t.id),this.selectChanged.emit(t)):(this.unSelect.emit(this._selectedRow),this.selectValue=null,this.selectValueChange.emit(""),this._selectedRow=null)},enumerable:!0,configurable:!0}),t.prototype.setCurrentPagerData=function(t){this.currentPagerData=t},t.prototype.writeConsole=function(t,e){void 0===e&&(e="warn"),this.debugSer&&(this.debugSer[e]?this.debugSer[e](t):console[e](t))},t.prototype.updateFooterData=function(){if((this.showFooter||this.pagerContentTemplate)&&"client"===this.footerDataFrom){var t=this.dfs.getFooterData(this.data);JSON.stringify(this._footerData.value)!==JSON.stringify(t)&&(this.footerData=r.of(t))}},t.prototype.ngDoCheck=function(){},t.prototype.ngOnInit=function(){var t=this;this.sms=new Ct(this),this.checkFilterStyle(),this.useThemes&&this._checkSize(),this.checkOptions(),this.groupRowPanelPlaceholder=this.localeService.getValue("datagrid.groupRow.tips"),this.smartFilterService&&(this.enableSmartFilter&&this.showFilterBar&&(this.smartFilterResult&&this.smartFilterResult.controlData&&this.smartFilterResult.controlData.length?this.filterBarHeight=this.smartFilterBarHeight:this.filterBarHeight=0),this.smartFilterService.filterChanged.subscribe(function(e){(t.smartFilterResult||e)&&JSON.stringify(t.smartFilterResult)!==JSON.stringify(e)&&(t.smartFilterResult=e,t.clientFilterChanged=!0,t.filterData(e.conditions),!t.smartFilterResult||t.smartFilterResult.controlData&&!t.smartFilterResult.controlData.length?t.onFilterBarResize(0):t.filterBarHeight||t.onFilterBarResize(t.smartFilterBarHeight))})),this.isFF=this.commonUtils.getBrowserType().ff},t.prototype.ngAfterViewInit=function(){var t=this;(this.setHeaderHeight(),this.setPagerHeight(),this.initBeforeEvents(),this.fit&&this.setGridNewSizeWhenFit(),this.initState(),this.el&&this.farrisInstances&&this.farrisInstances.add(this.el.nativeElement,this),this.data&&this.data.length||this.fetchData(1,this.pageSize).subscribe(function(e){e&&(t.total=e.total,e.footer&&(t.footerData=e.footer),t.loadData(e.items))}),this.zone.runOutsideAngular(function(){t.render2.addClass(t.dgContainer.nativeElement,t._custom_datagrid_cls),t.ro=new u(function(e){if("none"!==e[0].target.style.display){var i=e[0].contentRect.width;if(i){var r=e[0].contentRect.height,n=Math.floor(i),o=Math.floor(r),s=Math.round(i),l=Math.round(r),a=Math.ceil(i),d=Math.ceil(r);t.width!==n&&t.width!==s&&t.width!==a||t.height!==o&&t.height!==l&&t.height!==d?(t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t.calculateGridSize(t.fit),t.resized.emit()},100)):t.dgs.restoreScrollbarPosition()}}}),t.ro.observe(t.el.nativeElement.parentElement),document.body.removeEventListener("mousedown",t.documentBodyMouseDown,!0),document.body.addEventListener("mousedown",t.documentBodyMouseDown=function(e){if(t.isEditing()){var i=e.target;i.closest("td.f-datagrid-cell")&&!i.closest(".f-datagrid-footer-row")||i.closest(".date-overlay-container")||i.closest(".time-picker-overlay")||i.closest(".language-textbox-panel")||i.closest(".farris-notify")||i.closest(".comboPanel")||t.onDocumentMouseDown(e)}},!0)}),this.showFooter)&&(this.footerTemplate&&this.el.nativeElement.querySelector(".f-datagrid-footer")&&(this.footerHeight=this.el.nativeElement.querySelector(".f-datagrid-footer").offsetHeight));this.fit&&(this.el.nativeElement.parentElement&&(this.el.nativeElement.parentElement.style.position="relative"),this.calculateGridSize(this.fit)),this.selectionMode&&"default"===this.selectionMode&&this.multiSelect&&this.sms.enableWindowsSelectionMode(),this.setCellStyle()},t.prototype.ngAfterContentInit=function(){this.dgColumns&&this.dgColumns.length&&(this.columns=this.dgColumns.map(function(t){return x({},t)}))},t.prototype.ngOnChanges=function(t){var e=this;if(t.data&&!t.data.isFirstChange()&&(this.dfs.loadData(t.data.currentValue),this.dgs.dataSourceChanged()),t.showAllCheckbox===undefined||t.showAllCheckbox.isFirstChange()||t.showAllCheckbox.currentValue!=t.showAllCheckbox.previousValue&&this.columnsChanged(!1),t.showCheckbox===undefined||t.showCheckbox.isFirstChange()||this.dfs.showCheckbox(t.showCheckbox.currentValue),t.showLineNumber===undefined||t.showLineNumber.isFirstChange()||this.dfs.showLineNumber(t.showLineNumber.currentValue),t.multiSelect===undefined||t.multiSelect.isFirstChange()||(this.dfs.setMultiSelect(t.multiSelect.currentValue),this.columnsChanged()),t.checkOnSelect===undefined||t.checkOnSelect.isFirstChange()||this.dfs.setCheckOnSelect(t.checkOnSelect.currentValue),t.selectOnCheck===undefined||t.selectOnCheck.isFirstChange()||this.dfs.setSelectOnCheck(t.selectOnCheck.currentValue),t.onlySelectSelf===undefined||t.onlySelectSelf.isFirstChange()||this.dfs.updateProperty("onlySelectSelf",t.onlySelectSelf.currentValue),t.keepSelect===undefined||t.keepSelect.isFirstChange()||this.dfs.updateProperty("keepSelect",t.keepSelect.currentValue),t.headerWrap===undefined||t.headerWrap.isFirstChange()||setTimeout(function(){e.setHeaderHeight(),e.cd.detectChanges(),e.dfs.columnResizeEnd()}),t.nowrap===undefined||t.nowrap.isFirstChange()||(this.checkNowrap(),this.setRowHeight(!1),this.dgs.cellContentWrapChanged.emit(),this.dfs.updateProperty("nowrap",t.nowrap.currentValue)),t.multiSort===undefined||t.multiSort.isFirstChange()||this.dfs.updateProperty("multiSort",t.multiSort.currentValue),t.editable===undefined||t.editable.isFirstChange()||(this.dfs.updateProperty("editable",t.editable.currentValue),t.editable.currentValue||this.endCellEdit(),this.isSingleClick=null,this.cd.detectChanges()),t.showHeader===undefined||t.showHeader.isFirstChange()||(this.dfs.updateProperty("showHeader",t.showHeader.currentValue),this.headerHeightChange(),this.cd.detectChanges()),t.showFilterBar!==undefined&&!t.showFilterBar.isFirstChange()){this.dfs.updateProperty("showFilterBar",t.showFilterBar.currentValue),this.dgs.showGridHeader.emit(this.realHeaderHeight);var i=0;this.conditions&&this.conditions.length&&(i=32),this.onFilterBarResize(i)}if(t.showFooter===undefined||t.showFooter.isFirstChange()||(this.dfs.updateProperty("showFooter",t.showFooter.currentValue),this.calculateGridSize(this.fit)),t.pagerOnServer===undefined||t.pagerOnServer.isFirstChange()||(this.dfs.updateProperty("pagerOnServer",t.pagerOnServer.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{remote:this.pagerOnServer})),t.pageIndex===undefined||t.pageIndex.isFirstChange()||(this.dfs.updateProperty("pageIndex",t.pageIndex.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{currentPage:this.pageIndex})),t.pageSize===undefined||t.pageSize.isFirstChange()||(this.dfs.updateProperty("pageSize",t.pageSize.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{itemsPerPage:this.pageSize})),t.pageList===undefined||t.pageList.isFirstChange()||(this.dfs.updateProperty("pageList",t.pageList.currentValue),this.pagerOpts=Object.assign(this.pagerOpts,{pageList:this.pageList})),t.columns===undefined||t.columns.isFirstChange()||this.columnsChanged(),t.sizeType===undefined||t.sizeType.isFirstChange()||(this._sizeType=t.sizeType.currentValue,this.setRowHeight(!0),this.dfs.updateProperty("rowHeight",this.rowHeight),this.setFooterHeight(),this.refresh(),this.dgs.onRowHeightChange(this.rowHeight)),t.rowHeight&&!t.rowHeight.isFirstChange()&&this.setRowHeight(!1),t.selectValue&&!t.selectValue.isFirstChange()&&this.selectRow(this.selectValue,!1),t.checkValues&&!t.checkValues.isFirstChange()){var r=this.dfs.differenceBy(t.checkValues.currentValue||[],t.checkValues.previousValue||[],function(t){return t});r&&r.length&&this.checkRows(r,!1);var n=this.dfs.differenceBy(t.checkValues.previousValue||[],t.checkValues.currentValue||[],function(t){return t});n&&n.length&&this.unCheckRows(n,!1),this.zone.runOutsideAngular(function(){setTimeout(function(){e.checkValues=e.checkeds.map(function(t){return t.id}),e.checkValuesChange.emit(e.checkValues),e.checkedChange.emit(e.checkeds),e.updateAllCheckboxStatus()},10)})}t.showGroupColumn&&!t.showGroupColumn.isFirstChange()&&(this.toggleVisibleColumn(this.groupField.split(","),t.showGroupColumn.currentValue),this.columnsChanged()),t.autoFitColumns&&!t.autoFitColumns.isFirstChange()&&this.dfs.updateProperty("autoFitColumns",t.autoFitColumns.currentValue),t.groupRows&&!t.groupRows.isFirstChange()&&(this.dfs.updateProperty("groupRows",t.groupRows.currentValue),this.refresh()),t.mergeCell&&!t.mergeCell.isFirstChange()&&this.refresh(),t.mergeFields&&!t.mergeFields.isFirstChange()&&this.refresh(),t.enableFilterRow&&!t.enableFilterRow.isFirstChange()&&(this.dfs.updateProperty("enableFilterRow",t.enableFilterRow.currentValue),this.showHeader&&(this.setHeaderHeight(),this.filterBarHeight=32,this.dgs.toggleFilterRow.emit(this.enableFilterRow),this.dgs.showGridHeader.emit(this.realHeaderHeight),this.cd.detectChanges())),t.enableSmartFilter&&!t.enableSmartFilter.isFirstChange()&&this.dfs.updateProperty("enableSmartFilter",t.enableSmartFilter.currentValue),t.enableDragColumn&&!t.enableDragColumn.isFirstChange()&&this.checkDragColumns(),t.showRowGroupPanel&&!t.showRowGroupPanel.isFirstChange()&&(this.dgs.smartFilterBarExpand.emit(),this.dgs.showGridHeader.emit(this.realHeaderHeight)),t.selectionMode&&!t.selectionMode.isFirstChange()&&this.sms.toggleMode()},t.prototype.checkFilterStyle=function(){this.enableFilterRow&&this.enableSmartFilter&&(this.enableFilterRow=!1)},t.prototype._checkSize=function(){var t="sm";switch(localStorage.getItem("gsp_rtf_themSKey")){case"default":t="sm";break;case"loose":t="md"}this.sizeType=t},t.prototype.checkDragColumns=function(){this.isMultiHeader()&&(this.enableDragColumn=!1)},t.prototype.enableSettings=function(){return this.useControlPanel&&(!this.isMultiHeader()||this.isMultiHeader()&&this.enableSetMultiHeaders)},t.prototype.checkOptions=function(){var t=this;if(this.gridSize={width:this.width+"px",height:this.height+"px"},this.id?(this.styleSheetId=this.id+"_"+Y.uuid().replace(/-/g,"").substr(0,10),this._custom_datagrid_cls=this.styleSheetId):(this.id="FarrisDataGrid"+Y.uuid().replace(/-/g,"").substr(0,10),this.useControlPanel&&(this.useControlPanel=!1,this.writeConsole("启用列配置属性，未设置ID，此功能将禁用。")),this._custom_datagrid_cls=this.id),this.settingService&&this.useControlPanel&&this.settingService.registerGridInstance(this),this.dgs.createStyleElement(this.styleSheetId),!this.idField)throw new Error("The Datagrid's idField can't be Null. ");this.checkNowrap(),this.checkSortInfo(),this.checkMergeCell(),this.setCheckboxBehavior(),this.initPaginationOptions(),this.columns||(this.columns=this.fields),this.checkGroupHeaderColumns(),this.checkGroupRowSetting(),this.checkColumnsType(),this.checkDragColumns();var e=function(){t._flatColumns(),t.setRowHeight()};if(this.dfs.setinitialOptions({columns:this.columns,groupField:this.groupField,sortName:this.sortName,sortOrder:this.sortOrder,expandGroupRows:this.expandGroupRows}),this.isMultiHeader()||(this.enableSetMultiHeaders=!1),this.settingService&&this.enableSettings()){var i=this.settingService.getSettings(this.id);if(!i)return void e();i.subscribe(function(e){if(e){if(t.enableScheme&&t.settingService.schemeService){var i=t.settingService.schemeService.getStateValue(t.id,"list");i&&i.length&&t.userProfileSetting(e)}else t.userProfileSetting(e);t.setRowHeight(!1)}t.data&&t.data.length&&t.dfs.updateProperty("data",t.data),t.columnsChanged(t.groupRows&&t.data&&!!t.data.length)},function(i){e(),t.writeConsole(i,"error")})}else e()},t.prototype.refreshSelectedData=function(){var t=this;if(this.selectedRow&&this.selectedRow.id)if(this.data&&this.data.length){var e=this.data.find(function(e){return e[t.idField]===t.selectedRow.id});this.selectedRow.data=e}else this.selectedRow=null},t.prototype.ngOnDestroy=function(){this.unsubscribes(),this.ro&&(this.el.nativeElement.parentElement&&this.ro.unobserve(this.el.nativeElement.parentElement),this.ro.disconnect()),this.documentRowKeydownHandler&&this.documentRowKeydownHandler(),this.currentCell=null,this.clientFilterService=null,this.cleanDom(),this.dgs.removeStyleSheet(),this.settingService&&this.settingService.destroy&&this.settingService.destroy(this.id),this.sms&&(this.sms.destroy(),this.sms=null),document.body.removeEventListener("mousedown",this.documentBodyMouseDown,!0),this.farrisInstances&&this.farrisInstances.destroy(this.el.nativeElement),this._selectedRow=null,this.editors={},K.gridInstance=null,this.unbindMoveSelectRowEvent(),this.unbindDocumentEditListener()},t.prototype.onClick=function(t){if(this.showSelectedList&&this.dgPager&&this.dgPager.closeSelectedList(),!this.pending){var e=t.target;"TEXTAREA"!==e.nodeName&&"INPUT"!==e.nodeName?this.currentCell&&this.currentCell.editor&&this.currentCell.editor._editorClickEvent?t.stopPropagation():this.stopPropagation&&t.stopPropagation():t.stopPropagation()}},t.prototype.initPaginationOptions=function(){this.pagerOpts={id:this.id?this.id+"-pager_"+Y.uuid():"farris-datagrid-pager_"+Y.uuid(),itemsPerPage:this.pagination?this.pageSize:this.total,currentPage:this.pageIndex,totalItems:this.total,pageList:this.pageList,remote:this.pagerOnServer}},t.prototype.updatePagerOptions=function(){this.pagerOpts=Object.assign(this.pagerOpts,{itemsPerPage:this.pageSize,currentPage:this.pageIndex,totalItems:this.total})},t.prototype.setPagerTotal=function(){var t=this.data.length;this.pagination&&0===this.total&&this.virtualized?this.pagerOpts.totalItems=t:this.pagination||(this.pagerOpts.itemsPerPage=t)},t.prototype.setFooterHeight=function(t){var e=this;if(this.showFooter&&!this.footerTemplate){if(!(t=t||this._footerData.value)||!t.length)return;if(this.nowrap){this.dgs.removeCssRule(this.customStyleKey()+" .f-datagrid-footer .f-datagrid-footer-row"),this.renderCustomStyle2({style:{height:this._footerRowHeight+"px!important"}},null,"f-datagrid-footer .f-datagrid-footer-row");var i="f-datagrid-footer-row .f-datagrid-cell-content,f-datagrid-group-footer .f-datagrid-cell-content,f-datagrid-footer-row .f-datagrid-cell";i.split(",").forEach(function(t){e.dgs.removeCssRule(e.customStyleKey()+" ."+t)});var r=this._footerRowHeight-1;i.split(",").forEach(function(t){e.renderCustomStyle2({style:{height:r+"px!important","line-height":r+"px!important"}},null,t)}),this.footerHeight=t.length*this._footerRowHeight}else this._footer_height_timer_&&clearTimeout(this._footer_height_timer_),this._footer_height_timer_=setTimeout(function(){var i=document.querySelector(".f-datagrid-footer-top"),r=document.querySelector(".f-datagrid-footer-bottom"),n=t.length*e._footerRowHeight,o="min_footer_row_height_"+e._footerRowHeight;i?(i.querySelectorAll("tr").forEach(function(t){e.render2.addClass(t,o)}),e.render2.setStyle(i,"height",n+"px"),n=Math.max.apply(Math,R(Array.from(i.querySelectorAll("table")).map(function(t){return t.offsetHeight}))),e.render2.setStyle(i,"height",n+"px")):r&&(r.querySelectorAll("tr").forEach(function(t){e.render2.addClass(t,o)}),e.render2.setStyle(r,"height",n+"px"),n=Math.max.apply(Math,R(Array.from(r.querySelectorAll("table")).map(function(t){return t.offsetHeight}))),e.render2.setStyle(r,"height",n+"px")),n!==e.footerHeight&&(e.footerHeight=n,t.length*e._footerRowHeight>e.footerHeight&&(e.footerHeight=t.length*e._footerRowHeight),e.dfs.columnResizeEnd())},100)}},t.prototype.customStyleKey=function(){return"."+this._custom_datagrid_cls},t.prototype.setRowHeight=function(t){void 0===t&&(t=!1);var e=G[this._sizeType].row;t?(this.rowHeight=e,this.filterRowHeight=G[this._sizeType].pager):this.rowHeight=e>this.rowHeight?e:this.rowHeight;var i=this.customStyleKey()+".f-datagrid-body-row, "+this.customStyleKey()+" .f-datagrid-cell",r=this.customStyleKey()+" .f-datagrid-cell-content";if(this.dgs.removeCssRule(i),this.dgs.removeCssRule(r),29!==this.rowHeight&&this.nowrap){var n=[i+" { height: "+this.rowHeight+"px }",r+" { height: "+this.rowHeight+"px; line-height: "+this.rowHeight+"px }"];this.dgs.appendCssRules(n)}},t.prototype.initSelectOrChecked=function(){var t=this,e=this.dfs.getCurrentPageData();if(!this.enableMorePageSelect&&this.multiSelect&&(this.checkeds&&this.checkeds.length?this.checkeds.forEach(function(i){e.find(function(e){return e[t.idField]==i.id})||t.unCheckRow(i.id,!1)}):this.clearCheckeds()),this.selectValue&&e.find(function(e){return e[t.idField]==t.selectValue})&&(this.selectRow(this.selectValue,!1),this.refreshSelectedData()),this.multiSelect){if(this.checkValues&&this.checkValues.length){var i=this.checkeds.map(function(t){return t.id}),r=this.dfs.difference(i,this.checkValues);r.length?this.checkRows(r,!1):this.checkValues=[]}else this.checkValues=[];this.checkValues=this.checkeds.map(function(t){return t.id}),this._isResized&&!this.virtualized||(this.checkValuesChange.emit(this.checkValues),this.checkedChange.emit(this.checkeds)),this.updateAllCheckboxStatus(e)}},t.prototype.updateAllCheckboxStatus=function(t){var e=this;t||(t=this.dfs.getCurrentPageData());var i=0;if(this.showAllCheckbox){var r=t.map(function(t){return t[e.idField]}),n=r.filter(function(t){return e.checkValues.includes(t)});if(n&&n.length){var o=!this.dfs.difference(r,this.checkValues).length;this.checkValues&&this.checkValues.length?o?i=1:o||(i=2):i=0}}this.dgs.changeCheckAllStatus.emit(i)},t.prototype.setCheckboxBehavior=function(){!this.multiSelect&&this.showCheckbox},t.prototype._cancelColumnFixed=function(t){if(!t.filter(function(t){return(!t.fixed||"left"!==t.fixed&&"right"!==t.fixed)&&(t.visible||t.visible===undefined)}).length){var e=t.length,i=t.filter(function(t){return"right"===t.fixed}),r=t.filter(function(t){return"left"===t.fixed});r.length==e||i.length==e?t.forEach(function(t){t.fixed=""}):1===i.length?r.forEach(function(t){t.fixed=""}):i.forEach(function(t){t.fixed=""})}},t.prototype._flatColumns=function(){var t=this;if(this.columns&&this.columns.length)if(this._cancelColumnFixed(this.columns[0].filter(function(e){return e.field!==t.ControlPanelFeild})),this.isMultiHeader())if(this.fast)this.flatColumns=this.dfs.getGroupColumns(this.columns[0]);else{var e=o.flatten(this.columns);e.forEach(function(t){if(t.parentId){var i=e.find(function(e){return e.id===t.parentId});i&&(t.fixed=i.fixed)}}),this.flatColumns=e.filter(function(e){return(!e.colspan||1==e.colspan)&&t.columnIsVisible(e)})}else this.flatColumns=o.flatten(this.columns).filter(function(e){return(!e.colspan||1==e.colspan)&&t.columnIsVisible(e)})},t.prototype.columnIsVisible=function(t){return K.columnIsVisible(t,this)},t.prototype.addControlCol=function(){var t=this;if(this.enableSettings()){var e=this.columns[0].find(function(e){return e.field===t.ControlPanelFeild});if(e)e.visible=!0;else{var i={field:this.ControlPanelFeild,width:24,rowspan:this.columns.length,fixed:"right",visible:!0};this.columns[0].push(i)}}},t.prototype.checkGroupHeaderColumns=function(){if(this.isMultiHeader()){var t=o.flatten(this.columns);K.checkGroupHeaderColumnVisible(t)}},t.prototype.correctColumns=function(t){return t&&t.length&&!Array.isArray(t[0])?[t]:t||[]},t.prototype.checkColumnsType=function(){var t=this;this.columns&&this.columns.length&&(this.addControlCol(),this.columns.forEach(function(e,i){e.forEach(function(e,r){if(e.field||(e.field="farris-datagrid-column_"+i+"_"+r),e.valign||(e.valign="middle"),e.width===undefined||null===e.width?e.width=100:"string"==typeof e.width&&(e.width=parseInt(e.width,10)),e.originalWidth||(e.originalWidth=e.width),e.formatter&&"function"!=typeof e.formatter&&0===Object.keys(e.formatter).length&&(e.formatter=null),!t.showGroupColumn&&t.groupRows&&t.toggleVisibleColumn(t.groupField.split(","),!1),e.filter)if("boolean"==typeof e.filter)e.field?e.filter=t.clientFilterService.createColumnFilterOptions(e):e.filter=!1;else if(!e.filter.options||!Object.keys(e.filter.options).length)switch(e.filter.type){case E["enum"]:e.filter.options=e.formatter.options;break;case E.date:e.filter.options={dateFormat:"yyyy-MM-dd",returnFormat:"yyyy-MM-dd"};break;case E.datetime:e.filter.options={dateFormat:"yyyy-MM-dd HH:mm:ss",returnFormat:"yyyy-MM-dd HH:mm:ss"}}e.hidden!==undefined&&e.visible===undefined&&("boolean"==typeof e.hidden?e.visible=!e.hidden:"function"==typeof e.hidden&&(e.visible=function(){return!e.hidden.bind(t)})),(!e.field||e.field.indexOf("farris-datagrid-column_")>-1)&&(e.filter=!1)})}))},t.prototype.checkGroupRowSetting=function(){},t.prototype.checkMergeCell=function(){this.mergeCell&&(this.mergeFields&&this.mergeFields.length?(this.virtualized=!1,this.virtualizedAsyncLoad=!1):this.mergeCell=!1)},t.prototype.checkSortInfo=function(){this.sortName&&(this.sortOrder||(this.sortOrder=this.sortName.split(",").map(function(){return"asc"}).join(",")))},t.prototype.checkNowrap=function(){this.nowrap||(this.virtualized=!1)},t.prototype.setHeaderHeight=function(){if(this.realHeaderHeight=0,this.showHeader){var t=this.el.nativeElement.querySelector(".f-datagrid-header");if(this.headerWrap){if(t){this.render2.removeStyle(t,"minHeight");var e=t.querySelector(".f-datagrid-header-fixed-left");e&&this.render2.setStyle(e,"height","auto");var i=t.querySelector(".f-datagrid-header-fixed-right");i&&this.render2.setStyle(i,"height","auto"),t.querySelectorAll("table tr:not(.f-datagrid-filter-row)").forEach(function(t){t.style.height="auto",Array.from(t.children).forEach(function(t){return t.style.height="auto"})});var r=Array.from(t.querySelectorAll("table"));if(r){var n=r.map(function(t){return t.offsetHeight}),o=Math.max.apply(Math,R(n));this.realHeaderHeight=o,t.style.minHeight=this.realHeaderHeight+"px"}e&&this.render2.setStyle(e,"height",this.realHeaderHeight+"px"),i&&this.render2.setStyle(i,"height",this.realHeaderHeight+"px")}}else{var s=G[this._sizeType],l=s.header,a=s.pager;this.useThemes&&(this.headerHeight=l,this.filterRowHeight=a),this.realHeaderHeight=this.columns.length*this.headerHeight,this.enableFilterRow&&(this.realHeaderHeight+=this.filterRowHeight),t&&(t.style.minHeight=this.realHeaderHeight+"px")}}return this.realHeaderHeight},t.prototype.columnsChanged=function(t,e,i){var r=this;void 0===t&&(t=!0),void 0===e&&(e=null),void 0===i&&(i=!0);var n=null===e?this.fitColumns:e;this.dfs.updateProperty("expandGroupRows",this.expandGroupRows),this.checkColumnsType(),this._flatColumns(),this.headerHeightChange(),this.dfs.updateProperty("flatColumns",this.flatColumns),this.dfs.updateColumns(this.columns,n,!0),this.updateFooterData(),this.dgs.columnsChanged.emit({scrollToLeft:t,rebuildFilterBar:i}),t&&(this._COLUMNS_CHANAGED_TIMER_&&clearTimeout(this._COLUMNS_CHANAGED_TIMER_),this._COLUMNS_CHANAGED_TIMER_=setTimeout(function(){r.refresh()},60)),this.setCellStyle()},t.prototype.headerHeightChange=function(){this.setHeaderHeight(),this.dgs.showGridHeader.emit(this.realHeaderHeight)},t.prototype.inDialog=function(){return this.el.nativeElement.closest(".modal-body")},t.prototype.initEditorAndValidator=function(){var t=this,e=this.inject.get(k,[]);e.length&&e.forEach(function(e){t.editors[e.name]=e.value});var i=this.inject.get(F,[]);i&&i.length&&(this.validators=i)},t.prototype.setPagerHeight=function(){this.useHtmlTable||(this.pagination?this.pagerHeight=this.dgPager&&this.dgPager.outerHeight||40:this.pagerHeight=0)},t.prototype.initState=function(){var t=this;this.data=this.data||[];var e={};Object.keys(this).forEach(function(i){q.includes(i)||(e[i]=t[i])}),this.dfs.initState(x({},e,{fitColumns:this.fitColumns,fit:this.fit,groupField:this._groupField})),e=null},t.prototype.setFitColumns=function(t){void 0===t&&(t=!0),this.columns&&this.dfs.fitColumns(t)},t.prototype.setGridNewSizeWhenFit=function(){var t=this.el.nativeElement.parentElement;if(t){var e=t.getBoundingClientRect(),i=e.width,r=e.height,n=this.getElementPadding(t),o=this.getElementBorderWidth(t),s="floor";this.maxHeight&&this.autoHeight&&(s="ceil"),this.width=Math[s](Math.floor(i)-o.left-o.right-n.left-n.right),this.height=Math[s](Math.floor(r)-o.top-o.bottom-n.top-n.bottom),this.maxHeight&&this.autoHeight&&(this.height+=1),this.height||(this.height=this.dfs.getState().height||300),this.width||(this.width=this.dfs.getState().width||800)}},t.prototype.calculateGridSize=function(t){var e=this;if(void 0===t&&(t=!0),!this.useHtmlTable){var i=function(){var t=e.height;!e.useBlankWhenDataIsEmpty||e.data&&e.data.length||(t=e.emptyDataHeight+e.realHeaderHeight,e.showRowGroupPanel&&(t+=e.rowGroupPanelHeight),e.showFilterBar&&(t+=e.filterBarHeight),e.showFooter&&e.footerData.value.length&&(t+=e.footerHeight),e.pagination&&(t+=e.pagerHeight||40));e.gridSize.height===t+"px"&&e.gridSize.width===e.width+"px"||(e.gridSize={width:e.width+"px",height:t+"px"},e.dfs.resize({width:e.width,height:t}))};t?(this.setGridNewSizeWhenFit(),this.width&&this.height&&(this._isResized=!0,i(),this._isResized=!1,this.cd.destroyed||this.cd.detectChanges())):i()}},t.prototype.initBeforeEvents=function(){this.beforeSelect||(this.beforeSelect=function(){return r.of(!0)}),this.beforeUnselect||(this.beforeUnselect=function(){return r.of(!0)}),this.beforeCheck||(this.beforeCheck=function(){return r.of(!0)}),this.beforeUncheck||(this.beforeUncheck=function(){return r.of(!0)}),this.beforeSortColumn||(this.beforeSortColumn=function(){return r.of(!0)}),this.beforeEdit||(this.beforeEdit=function(){return r.of(!0)}),this.afterEdit||(this.afterEdit=function(){return r.of(!0)})},t.prototype.unbindMoveSelectRowEvent=function(){this.documentRowKeydownHandler&&(this.documentRowKeydownHandler(),this.documentRowKeydownHandler=null)},t.prototype.bindDocumentMoveSelectRowEvent=function(){var t=this;this.unbindMoveSelectRowEvent(),this.unbindDocumentEditListener(),this.documentRowKeydownHandler=this.render2.listen(document,"keydown",function(e){if(t.isActived()&&!document.querySelectorAll("farris-loading").length){if(e.target){var i=e.target.nodeName;if(t.ignoreTarget.indexOf(i)>-1)return}switch(40!==e.keyCode&&38!==e.keyCode||e.preventDefault(),e.keyCode){case 40:t.selectNextRow();break;case 38:t.selectPrevRow()}}})},t.prototype.bindEditListenerInModal=function(){var t=this;if(Y.hasDialogOpen()){var e=this.inDialog();if(e){var i=e.closest(".farris-modal");i&&(this.modalClickEvent=this.render2.listen(i,"click",function(){t.endEditing(),t.currentCell=null}))}}},t.prototype.bindDocumentEditListener=function(){var t=this;this.unbindDocumentEditListener(),this.documentCellKeydownHandler||(this.documentCellKeydownHandler=function(e){(e.target.closest(".f-datagrid")||"BODY"===e.target.nodeName)&&t.isActived()&&t.onKeyDownEvent(e)},this.documentCellKeydownEvents=this.render2.listen(document,"keydown",this.documentCellKeydownHandler))},t.prototype.unbindDocumentEditListener=function(){this.documentCellClickHandler&&(this.docuemntCellClickEvents(),this.documentCellClickHandler=null),this.documentCellKeydownHandler&&(this.documentCellKeydownEvents(),this.documentCellKeydownHandler=null),this.modalClickEvent&&(this.modalClickEvent(),this.modalClickEvent=null)},t.prototype.onKeyDownEvent=function(t){if(!this.disabled){var e=t.keyCode;if(this.currentCell&&!this.currentCell.isEditing)switch([13,40,37,38,39,9].indexOf(e)>-1&&t.preventDefault(),e){case 32:this.currentCell&&this.currentCell.column.onSpaceHandler&&(t.stopPropagation(),this.currentCell.column.onSpaceHandler({grid:this,cell:this.currentCell,event:t}));break;case 13:if(this.currentCell){var i=this.currentCell.cellElement.editCell;i?i.apply(this.currentCell.cellElement):this.currentCell.column.onEnterHandler&&(t.stopPropagation(),this.currentCell.column.onEnterHandler({grid:this,cell:this.currentCell,event:t}))}break;case 40:this.selectNextCell("down",t);break;case 38:this.selectNextCell("up",t);break;case 39:this.selectNextCell("right",t);break;case 37:this.selectNextCell("left",t);break;case 9:t.shiftKey?this.selectNextCell("left",t):this.selectNextCell("right",t)}}},t.prototype.unsubscribes=function(){this.subscriptions.forEach(function(t){t&&(t.unsubscribe(),t=null)}),this.subscriptions=[],this.docuemntCellClickEvents&&this.docuemntCellClickEvents()},t.prototype.isRowEditing=function(){return!(!this.selectedRow||-1===this.selectedRow.index)&&("row"===this.editMode&&(this.selectedRow.editors&&this.selectedRow.editors.length))},t.prototype.isCellEditing=function(){return!(!this.currentCell||"cell"!==this.editMode)&&(this.currentCell.editor||!this.currentCell.column||this.currentCell.column.editorTemplate||(this.currentCell.isEditing=!1,this.currentCell.cellRef&&(this.currentCell.cellRef.isEditing=!1)),this.currentCell.isEditing)},t.prototype.isEditing=function(){return"row"===this.editMode?this.isRowEditing():this.isCellEditing()},t.prototype.endEditing=function(){"row"===this.editMode?this.endRowEdit():"cell"===this.editMode&&this.endCellEdit()},t.prototype.getEditors=function(){return this.selectedRow.editors},t.prototype.editCell=function(t,e,i){var r;if(void 0===i&&(i=null),this.activeDataGrid(),this.dfs.findRowIndex(t)>-1){this.endCellEdit();var n="row_"+t,o=Y.getTrDomById(n,this.el.nativeElement),s=null;o&&(s=o.querySelector('[field="'+e+'"]'));var l=this.getColumn(e);if(!s&&l.fixed)if("left"===l.fixed){var a=Y.getTrDomById(n+"_fixedleft",this.el.nativeElement);s=a&&a.querySelector('[field="'+e+'"]')}else if("right"===l.fixed){var d=Y.getTrDomById(n+"_fixedright",this.el.nativeElement);s=d&&d.querySelector('[field="'+e+'"]')}i&&(this.formValidations=Object.assign(this.formValidations||{},((r={})[e]=i,r))),s&&s.editCell&&(this.currentCell=null,this.EDITCELL_TIMER&&clearTimeout(this.EDITCELL_TIMER),this.EDITCELL_TIMER=setTimeout(function(){s.editCell()},0))}},t.prototype.endCellEdit=function(t){if(this.currentCell&&(rt.removeClass(this.currentCell.cellElement,j),this.currentCell.isEditing)){this.currentCell.cellEditorRef&&this.currentCell.cellEditorRef.hideCover();var e=this.currentCell.cellElement.closeEdit();e&&e.subscribe()}},t.prototype.editRow=function(t){var e=this;if(!this.editable||"row"!==this.editMode)return!1;if(t&&this.selectRow(t),!this.selectedRow||-1===this.selectedRow.index)return this.writeConsole("Please select a row."),!1;var i=x({},this.selectedRow),r=i.index,n=i.data,o=this.beforeEdit({rowIndex:r,rowData:n,gridInstance:this});if(o&&o.subscribe){var s="row_"+t,l=Y.getTrDomById(s,this.el.nativeElement);this.selectedRow.dr||l.click(),o.subscribe(function(t){if(t&&e.selectedRow.dr&&e.selectedRow.dr.cells){var i=e.selectedRow.dr.cells.toArray();if(!i||!i.length)return;i.forEach(function(t){t.column.editor&&(t.isEditing=!0)}),e.selectedRow.dr.cd.detectChanges(),setTimeout(function(){var t=i.map(function(t){if(t.cellEditor)return t.cellEditor.componentRef}).filter(function(t){return t});e.selectedRow.editors=t,t&&t.length&&t[0].instance.inputElement&&t[0].instance.inputElement.focus(),e.bindRowEditorKeydownEvent(),e.cd.destroyed||e.cd.detectChanges(),e.beginEdit.emit({rowIndex:r,rowData:n,gridInstance:e,editor:t})})}})}else this.writeConsole("please return an Observable Type.")},t.prototype.endRowEdit=function(){var t=this;if(!this.isRowEditing())return{canEnd:!0};if(this.selectedRow&&-1!==this.selectedRow.index){var e=x({},this.selectedRow),i=e.index,r=e.data,n=e.dr,o=x({},this.currentCell),s=o.editor,l=o.column;if(document.body.click(),this.pending)return{canEnd:!1};if(!n.form)return{canEnd:!0};var a=n.form;if(a.markAsTouched(),a.invalid&&!this.endEditByInvalid)return{canEnd:!1};var d=this.afterEdit(i,r,l,s);if(!d||!d.subscribe)return this.writeConsole("please return an Observable Type."),{canEnd:!1};d.subscribe(function(e){if(e){t.closeAllCellEditor(),t.selectedRow.dr.form&&(t.selectedRow.dr.rowData=Object.assign(t.selectedRow.dr.rowData,t.selectedRow.dr.form.value),t.dfs.updateRow(t.selectedRow.id,t.selectedRow.dr.rowData),t.cd.detectChanges());var n="";s&&s.formControl&&(n=s.formControl.value),t.endEdit.emit({rowIndex:i,rowData:r,column:l,value:n}),t.dgs.refreshFooterData.emit()}})}else this.writeConsole("Please select a row.")},t.prototype.cancelEdit=function(t,e){void 0===e&&(e=!0),this.isEditing()&&(this.closeAllCellEditor(),t&&this.dfs.rejectChanges(t),this.cd.detectChanges(),e&&this.cancelEdited.emit())},t.prototype.closeAllCellEditor=function(){if(this.selectedRow&&this.selectedRow.dr){var t=this.selectedRow.dr.cells;t&&(t.forEach(function(t){return t.isEditing=!1}),this.currentCell&&(this.currentCell.isEditing=!1)),this.selectedRow.editors=null}this.unbindRowEditorKeydownEvent()},t.prototype.rowEditTabKeydwonEvent=function(t){var e=this;if(9===(t.which||t.keyCode)){var i=t.target.closest("td"),r=t.target.closest("tr"),n=i.nextElementSibling,o=function(t){return!t.querySelector("input")&&!t.querySelector("textarea")&&!t.querySelector("select")},s=function(){var t=r.nextElementSibling;if(t){t.click();var i=t.getAttribute("id").replace("row_","");i&&e.editRow(i)}};if(n){if(o(n)){var l=r.querySelectorAll("td"),a=-1;l.forEach(function(t,e){t===n&&(a=e)});for(var d=!0;a<l.length;){if(!o(l[a])){d=!1;break}a++}d&&s()}}else s()}t.stopPropagation()},t.prototype.bindRowEditorKeydownEvent=function(){var t=this;this.documentRowEditKeydownHanlder||(this.documentRowEditKeydownHanlder=this.render2.listen(document,"keydown",this.rowEditTabKeydwonEvent.bind(this))),this.documentClickEndRowEditHandler=this.render2.listen(document,"click",function(e){if(t.pending)return!1;Y.hasDialogOpen()||t.isRowEditing()})},t.prototype.unbindRowEditorKeydownEvent=function(){this.documentRowEditKeydownHanlder&&(this.documentRowEditKeydownHanlder(),this.documentRowEditKeydownHanlder=null),this.documentClickEndRowEditHandler&&(this.documentClickEndRowEditHandler(),this.documentClickEndRowEditHandler=null)},t.prototype._clientFilter=function(t,e){if(void 0===e&&(e=!1),e){var i=this.dfs.getData(!0);if(t&&Object.keys(t).length){var r=this.clientFilterService.executeFilter(i,t);this.dfs.loadFilterData(r)}else this.loadData(i,!1,!0)}this.virtualized||this.scrollToTop();var n=this.checkFilterValues(t);this.filterChanged.emit(n)},t.prototype.smartFilterData=function(t){if(this.remoteFilter){var e=this.clientFilterService.convertSmartFilter2EntityFilter(t);e=this.checkFilterValues(e),this.filterChanged.emit(e)}else this._clientFilter(t,this.useDefaultFilter)},t.prototype.onClearSmartFilters=function(t){var e=this;this.smartFilterResult={conditions:[],controlData:[]},this.conditions=[],this.smartFilterData([]),this.smartFilterService.clearAll(),setTimeout(function(){e.onFilterBarResize(0)})},t.prototype.onRemoveSmartFilterItem=function(t){if(t){var e=x({},t);e.labelCode=t.fieldCode,this.smartFilterService.removeCondition(e,!0)}},t.prototype.onFilterBarResize=function(t){this.filterBarHeight=t;var e=this.el.nativeElement.querySelector(".f-datagrid-column-drop-panel");e&&!t&&(e.style.top="0px"),this.dgs.showGridHeader.emit(this.realHeaderHeight),this.dgs.smartFilterBarExpand.emit()},t.prototype.onSmartFilterChange=function(t){var e=t.conditions,i=t.filterItem;this.smartFilterService.filterConditionChanged({conditions:e,controlData:i,from:"toolbar"}),this.dgs.smartFilterDataChange.emit(i)},t.prototype.filterData=function(t){if(t?this.conditions=t:t=this.conditions,this.scrollToTop(),this.enableSmartFilter)this.smartFilterData(t);else if(this.remoteFilter){var e=this.clientFilterService.convert2FilterArray(t);this.filterChanged.emit(e)}else this._clientFilter(t,!0)},t.prototype.clearCondition=function(){if(this.dgs.onClearFilter(),this.enableFilterRow||this.enableSmartFilter){var t=!1;this.conditions&&(t=Array.isArray(this.conditions)?!!this.conditions.length:!!Object.keys(this.conditions).length),t&&(this.conditions=this.enableSmartFilter?[]:{},this.clientFilterChanged=!0,this.filterData(this.conditions))}},t.prototype._loadData=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!0),this.loading&&this.closeLoading(!this.pagination),t=t||[],i&&this.scrollInstance&&this.scrollInstance.instance){var r=this.scrollInstance.instance.lastScrollTop,n=this.scrollInstance.instance.lastScrollLeft;this.dfs.updateProperty("scrollInfo",{y:r,x:n})}else this.dfs.updateProperty("scrollInfo",{y:0,x:0});this.pagination&&(this.dfs.setPagination(this.pageIndex,this.pageSize,this.total),this.updatePagerOptions(),this.cd.destroyed||this.cd.detectChanges()),this.data=t,e?this.remoteSort?this.dfs.loadData(t):this.dfs.loadData(t,!0,!0):this.dfs.loadData(t),this.setPagerHeight(),this.dgs.dataSourceChanged()},t.prototype.loadData=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!0),this._loadData(t,e,i)},t.prototype.loadVirtualData=function(t){this.groupRows?this.writeConsole('if you using GROUPROWS, please set [virtualized]="false" [virtualizedAsyncLoad]="false"'):this.virtualizedAsyncLoad&&this.dgs.onLoadVirtualData(t)},t.prototype.fetchData=function(t,e){if(this.restService){this.showLoading();var i={pageIndex:t,pageSize:e};return this.sortName&&(i.sortName=this.sortName),this.sortOrder&&(i.sortOrder=this.sortOrder),this.restService.getData(this.url,i)}return r.of(undefined)},t.prototype.refresh=function(){this.dfs.refresh()},t.prototype.reload=function(){var t=this;this.fetchData(1,this.pageSize).subscribe(function(e){e&&(t.pageIndex=1,t.total=e.total,t.loadData(e.items))})},t.prototype.getRows=function(){return this.groupRows||this.virtualized?this.pagerOnServer?this.ds.rows:this.currentPagerData:this.pagerOnServer?this.data:this.currentPagerData},t.prototype.getGroupRow=function(t){var e=(this.getRows()||[]).filter(function(t){return t[W]}),i=e.findIndex(function(e){return e.id==t});return{data:e[i],index:i}},t.prototype.setPageIndex=function(t,e){void 0===e&&(e=!0),this.pageIndex=t,this.pagerOpts.currentPage=t,e&&this.cd.detectChanges()},t.prototype.setPageList=function(t,e){void 0===e&&(e=!0),this.pageList=t,this.pagerOpts.pageList=t,e&&this.cd.detectChanges()},t.prototype.onPageChange=function(t){var e=this;this.lockPagination||(this.controlPaginationState&&this.setPageIndex(t,!1),this.fetchData(t,this.pageSize).subscribe(function(t){t&&e.loadData(t.items)}),this.focusRowIndex=-1,this.scrollToTop(),this.pageChanged.emit({pageIndex:t,pageSize:this.pageSize}))},t.prototype.onPageSizeChange=function(t){var e=this;this.lockPagination||(this.focusRowIndex=-1,this.scrollToTop(),this.pageSize=t,this.pagerOpts.itemsPerPage=t,this.fetchData(1,t).subscribe(function(t){t&&(e.pageIndex=1,e.loadData(t.items))}),this.pageSizeChanged.emit({pageSize:t,pageIndex:this.pageIndex}))},t.prototype.onRemoveSelectedItem=function(t){this.dfs.findRowIndex(t)>-1?(this.unCheckRow(t),this.cd.detectChanges()):(this.unCheckRow(t,!1),this.checkValues=this.checkeds.map(function(t){return t.id}))},t.prototype.onClearSelectedItem=function(t){this.selectOnCheck&&(this.selectValue=""),this.clearCheckeds(!0)},t.prototype.showLoading=function(){this.loading=!0,this.cd.detectChanges()},t.prototype.closeLoading=function(t){void 0===t&&(t=!0),this.loading=!1,t&&this.cd.detectChanges()},t.prototype.replacePX2Empty=function(t){return t?Number.parseInt(t.replace("px",""),10):0},t.prototype.renderCustomCls=function(t,e){var i=this;t&&("!"===t[0]?t.slice(1).split(" ").filter(function(t){return t}).forEach(function(t){t&&i.render2.removeClass(e,t)}):t.split(" ").filter(function(t){return t}).forEach(function(t){t&&i.render2.addClass(e,t)}))},t.prototype.renderCustomStyle=function(t,e,i){void 0===i&&(i=null),t&&(t.cls&&this.renderCustomCls(t.cls,e),t.style&&(i||(Object.keys(t.style).forEach(function(e){"color"===e.toLowerCase()&&t.style[e]&&-1===t.style[e].indexOf("!important")&&(t.style[e]=t.style[e]+"!important")}),i=this.customStyleKey()+" #"+e.id+" "+JSON.stringify(t.style)),this.dgs.appendCssRules([i])))},t.prototype.renderCustomStyle2=function(t,e,i){if(t&&(t.cls&&e&&this.renderCustomCls(t.cls,e),t.style)){Object.keys(t.style).forEach(function(e){(e.toLowerCase().indexOf("background")>-1||"color"===e.toLowerCase())&&t.style[e]&&-1===t.style[e].indexOf("!important")&&(t.style[e]=t.style[e]+"!important")});var r=this.customStyleKey()+" ."+i+" "+JSON.stringify(t.style);i.indexOf(this.customStyleKey())>-1&&(r=i+" "+JSON.stringify(t.style)),this.dgs.appendCssRules([r])}},t.prototype.getBoundingClientRect=function(t){return t.nativeElement.getBoundingClientRect()},t.prototype.getElementPadding=function(t){var e=getComputedStyle(t);return{top:this.replacePX2Empty(e.paddingTop),left:this.replacePX2Empty(e.paddingLeft),bottom:this.replacePX2Empty(e.paddingBottom),right:this.replacePX2Empty(e.paddingRight)}},t.prototype.getElementBorderWidth=function(t){var e=getComputedStyle(t);return{top:this.replacePX2Empty(e.borderTopWidth),bottom:this.replacePX2Empty(e.borderBottomWidth),right:this.replacePX2Empty(e.borderRightWidth),left:this.replacePX2Empty(e.borderLeftWidth)}},t.prototype.formatData=function(t,e,i){var r=this.getFieldValue(t,e);return this.colFormatSer.format(r,e,i)},t.prototype.getFieldValue=function(t,e){return Y.getValue(t,e)},t.prototype.canOperateCheckbox=function(){return this.multiSelect&&this.showCheckbox},t.prototype.findNextTd=function(t){if(!t)return null;var e="row_"+this.selectedRow.id,i="row_"+this.selectedRow.id+"_fixedleft",r="row_"+this.selectedRow.id+"_fixedright",n=null,o=null;return"left"===t.fixed?(n=Y.getTrDomById(i,document))&&(o=n.querySelector('[field="'+t.field+'"]')):"right"===t.fixed?(n=Y.getTrDomById(r,document))&&(o=n.querySelector('[field="'+t.field+'"]')):(n=Y.getTrDomById(e,document))&&(o=n.querySelector('[field="'+t.field+'"]')),o},t.prototype.findNextCell=function(t,e){var i=null;if(this.currentCell&&this.currentCell.cellElement){var r=this.dfs.getColumn(t),n=(r.fixed,this.colGroup.columns.findIndex(function(t){return t.id&&t.id===r.id||t.field===r.field})),o=this.currentCell.cellElement,s='[field="'+t+'"]';if("up"===e){var l=this.dgs.findNextTr(o.parentElement.previousElementSibling,"up");l&&(i=l.querySelector(s))}else if("down"===e){var a=this.dgs.findNextTr(o.parentElement.nextElementSibling,"down");a&&(i=a.querySelector(s))}else if("left"===e){(d=this.colGroup.columns[n-1])&&(i=this.findNextTd(d))}else if("right"===e){var d;(d=this.colGroup.columns[n+1])&&(i=this.findNextTd(d))}}return i},t.prototype.selectNextCell=function(t,e){var i=this.findNextCell(this.currentCell.field,t);if("up"!==t||i){if(i&&-1==i.className.indexOf("f-datagrid-cell-rownumber")&&-1==i.className.indexOf("f-datagrid-cell-checkbox"))return"Tab"===e.code&&this.editable&&this.editcellWhenTabKeydwon?i.click.apply(i,[e]):i.selectCell&&("default"===this.selectionMode&&this.clearCheckeds(),i.selectCell(e,i)),i;var r='td[field="'+this.colGroup.columns[0].field+'"]',n=this.currentCell.cellElement.parentElement,o=n.nextElementSibling;if("left"===t&&(o=n.previousElementSibling),o){var s=Y.getRowIdByTr(o)+"_fixedleft";o.id.indexOf("_fixedright")>-1&&this.colGroup.leftFixed&&this.colGroup.leftFixed.length&&(o=Y.getTrDomById(s,document)),"left"===t&&o.id.indexOf("_fixedleft")>-1&&(o=Y.getTrDomById(s,document));var l=o.querySelector(r);l&&l.selectCell&&("default"===this.selectionMode&&this.clearCheckeds(),l.selectCell(e,l))}}},t.prototype.getRowIdByTr=function(t){if(t&&t.className.indexOf("f-datagrid-group-row")>-1)return null;var e=Y.getRowIdByTr(t);return null==e||e==undefined?null:this.dfs.findRow(e)?x({},this.dfs.findRow(e),{id:e}):null},t.prototype._beforeSelectRow$=function(t,e,i){var n={rowIndex:t,rowData:e,gridInstance:this,id:i,dr:null},o=r.of(!0);if(this.beforeSelect&&!this.dfs.isRowSelected(i)){var s=this.beforeSelect(n);s&&s.subscribe&&(o=s)}return o},t.prototype.selectNextRow=function(){var t=this;if(this.selectedRow){var e=this.selectedRow.dr.el.nativeElement;if(e.nextElementSibling){var i=this.getRowIdByTr(e.nextElementSibling),r=i.id,n=i.data,o=i.index;r&&this._beforeSelectRow$(o,n,r).subscribe(function(e){e&&t.selectRow(r,!0)})}}},t.prototype.selectPrevRow=function(){var t=this;if(this.selectedRow){var e=this.selectedRow.dr.el.nativeElement;if(e.previousElementSibling){var i=this.getRowIdByTr(e.previousElementSibling),r=i.id,n=i.data,o=i.index;r&&this._beforeSelectRow$(o,n,r).subscribe(function(e){e&&t.selectRow(r,!0)})}}},t.prototype.removeCellSelectedCls=function(){var t=this;this.currentCell&&this.currentCell.cellElement&&(rt.removeClass(this.currentCell.cellElement,j),this.render2.removeClass(this.currentCell.cellElement,M));var e=this.el.nativeElement.querySelectorAll("."+j);e.length&&e.forEach(function(e){t.render2.removeClass(e,j)})},t.prototype.selectRow=function(t,e,i){var r=this;if(void 0===e&&(e=!0),void 0===i&&(i=!1),this.selectedRow&&this.selectedRow.id===t)return e&&this.dfs.selectRecord(t),void(i&&this.scrollToCurrentRow());var n=function(){if(r.removeCellSelectedCls(),r.enableSelectRow){if(!r.multiSelect&&r.showCheckbox&&r.clearCheckeds(!1,!1),r.multiSelect&&"default"===r.selectionMode&&!r.enableMorePageSelect&&r.clearAll(),!t||r.selectedRow&&r.selectedRow.id==t)r.checkOnSelect&&r.checkRows([t]);else{var n=r.dfs.findRow(t);if(n&&r.disableRow&&r.disableRow(n.data,n.index))return;e?r.dfs.selectRecord(t):(r.dfs.setSelectRow(t,e),r.selectedRow=r.dfs.getCurrentRow(),r.checkOnSelect&&r.checkRows([t]),r.dgs.setSelecedRow.emit({id:t,selected:!0}))}i&&r.scrollToCurrentRow()}};if(this.isEditing())if("cell"===this.editMode){var o=this.currentCell.cellElement.closeEdit();o&&o.subscribe(n)}else this.endRowEdit(),n();else n()},t.prototype.scrollToCurrentRow=function(){this.dgs.scrollToCurrentRow.next()},t.prototype.unSelectRow=function(t,e){void 0===e&&(e=!0),t&&(this.closeAllCellEditor(),this.currentCell&&this.currentCell.rowId==t&&this.cancelSelectCell(),e?this.dfs.selectRecord(t,!1):(this.dfs.setSelectRow(t,!1),this.selectedRow=null,this.dgs.setSelecedRow.emit({id:t,selected:!1})))},t.prototype.selectAllRows=function(){this.multiSelect&&this.enableSelectRow&&this.dfs.selectAll()},t.prototype.cancelSelectCell=function(){this.currentCell&&(this.currentCell.cellElement&&this.currentCell.cellElement.cancelSelected(),this.currentCell.isEditing||(this.currentCell=null,this.dfs.cancelSelectCell()))},t.prototype.clearSelections=function(t){this.dfs.clearSelections(t),this.selectedRow=null,this.cancelSelectCell(),this.cd.detectChanges()},t.prototype.checkRow=function(t,e){void 0===e&&(e=!0),this.canOperateCheckbox()&&(e?this.dfs.checkRecord(t):this.checkRows([t]))},t.prototype.checkRows=function(t,e){void 0===e&&(e=!1),t&&t.length&&(this.dfs.setCheckedRows(t,!0),this.dgs.setCheckedRows.next({ids:t,checked:!0}),"default"===this.selectionMode&&this.dfs.updateProperty("selections",this.checkeds),e&&(this.checkValues=this.checkeds.map(function(t){return t.id}),this.checkValuesChange.emit(this.checkValues),this.checkedChange.emit(this.checkeds)),this.updateAllCheckboxStatus())},t.prototype.unCheckRows=function(t,e){void 0===e&&(e=!1),t&&t.length&&(this.dfs.setCheckedRows(t,!1),this.dgs.setCheckedRows.next({ids:t,checked:!1}),e&&(this.checkValues=this.checkeds.map(function(t){return t.id}),this.checkValuesChange.emit(this.checkValues),this.checkedChange.emit(this.checkeds)),this.updateAllCheckboxStatus())},t.prototype.checkAllRows=function(t){void 0===t&&(t=!0),this.canOperateCheckbox()&&(this.dfs.checkAll(),this.dgs.checkAll.emit(),t&&this.checkAll.emit())},t.prototype.unCheckRow=function(t,e){void 0===e&&(e=!0),this.canOperateCheckbox()&&(this.currentCell&&this.currentCell.rowId==t&&this.cancelSelectCell(),e?this.dfs.checkRecord(t,!1):this.unCheckRows([t]),this.updateAllCheckboxStatus())},t.prototype.clearCheckeds=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this.dfs.clearCheckeds(t),this.checkValues=[],this.cancelSelectCell(),e&&this.dgs.uncheckAll.emit()},t.prototype.clearAll=function(){this.selectedRow=null,this.checkValues=[],this.dfs.clearAll(),this.dgs.uncheckAll.emit(),this.updateAllCheckboxStatus()},t.prototype.getResizeProxyPosLeft=function(t){var e=t.target,i=this.getBoundingClientRect(this.dgContainer),r=e.parentElement,n=r.getBoundingClientRect().left,o=r.offsetWidth-(t.pageX-n);return this.resizeColumnInfo.proxyLineEdge=o,this.resizeColumnInfo.startWidth=r.offsetWidth,this.resizeColumnInfo.startX=t.pageX,this.resizeColumnInfo.left=n-i.left-1+o,t.pageX-i.left-1+o},t.prototype.toggleResizeProxy=function(t){void 0===t&&(t=!0);var e="block";t||(e="none"),this.render2.setStyle(this.resizeProxyBg.nativeElement,"display",e),this.render2.setStyle(this.resizeProxy.nativeElement,"display",e)},t.prototype.onColumnResizeBegin=function(t){if(this.resizeProxy){this.render2.setStyle(document.body,"cursor","e-resize");var e=this.resizeProxy.nativeElement,i=this.getResizeProxyPosLeft(t);this.render2.setStyle(e,"left",i+"px");var r=0;if((this.enableFilterRow||this.enableSmartFilter)&&this.showFilterBar&&(r+=this.filterBarHeight),this.showRowGroupPanel&&(r+=this.rowGroupPanelHeight),this.render2.setStyle(e,"top",r+"px"),this.autoHeight){var n=0;this.pagination&&(n+=this.pagerHeight),this.showFooter&&(n+=this.footerHeight),this.render2.setStyle(e,"height","calc(100% - "+n+"px)")}else this.render2.setStyle(e,"height",this.height-this.pagerHeight+"px");this.toggleResizeProxy()}},t.prototype.onColumnResize=function(t){var e=this.resizeProxy.nativeElement,i=this.getBoundingClientRect(this.dgContainer),r=t.pageX-i.left-1+this.resizeColumnInfo.proxyLineEdge;r-this.resizeColumnInfo.left>20?this.render2.setStyle(e,"left",r+"px"):this.render2.setStyle(e,"left",this.resizeColumnInfo.left+20+"px"),t.stopPropagation(),t.preventDefault()},t.prototype.onColumnResizeEnd=function(t,e){var i=this;this.render2.removeStyle(document.body,"cursor"),this.toggleResizeProxy(!1),this.resizeColumnInfo.proxyLineEdge=0;var r=this.resizeColumnInfo.startWidth+t.pageX-this.resizeColumnInfo.startX;if(r<20&&(r=20),e.width>r){var n=e.width-r;if(!this.fitColumns&&this.scrollInstance.elementRef.nativeElement.scrollLeft){var o=this.scrollInstance.elementRef.nativeElement.scrollLeft-n;this.scrollInstance.scrollToX(o)}}if(e.width!=r){if(e.width=r,!this.nowrap&&this.showFooter&&this.setFooterHeight(),this.useControlPanel&&this.settingService)return void this.settingService.saveUserConfig(this.id).subscribe(function(){i.dfs.columnResizeEnd(),i.dgs.columnResized.emit()});this.dfs.columnResizeEnd(),this.dgs.columnResized.emit(),this.updateFixedColumnCssForFastMode(e)}},t.prototype.restituteColumnsSize=function(){this.dfs.resizeColumns(!0),this.dgs.columnResized.emit()},t.prototype.sizeToContent=function(t,e){if(!this.AutoColumnWidthUseDblclick)return!1;for(var i="",r=this.data,n=r.length-1;n>=0;n--){var o=Y.getValue(t.field,r[n]);0!==o&&(o=o||"");var s=""+o;if(t.formatter&&o!==undefined&&(s=this.colFormatSer.format(o,r[n],t.formatter)),Y.getBLen(s)>Y.getBLen(i))i=s;else{this.longTextArea.nativeElement.innerHTML=s;var l=this.longTextArea.nativeElement.offsetWidth;this.longTextArea.nativeElement.innerHTML=i,l>this.longTextArea.nativeElement.offsetWidth&&(i=s)}}this.longTextArea.nativeElement.innerHTML=i;var a=this.longTextArea.nativeElement.offsetWidth+26;this.longTextArea.nativeElement.innerHTML=e.nativeElement.innerText;var d=this.longTextArea.nativeElement.offsetWidth+26;t.sortable&&(d+=24);var c=a>d?a:d;if(this.flatColumns.findIndex(function(e){return e.field===t.field})===this.flatColumns.length-1&&(c+=6),t.width>c){var h=t.width-c;if(this.scrollInstance.elementRef.nativeElement.scrollLeft){var u=this.scrollInstance.elementRef.nativeElement.scrollLeft-h;this.scrollInstance.scrollToX(u<0?0:u)}}t.width!=c&&(t.width=c,this.dfs.resizeColumns(),this.dgs.columnResized.emit())},t.prototype.getChanges=function(){return this.dfs.getChanges()},t.prototype.acceptChanges=function(){this.dfs.acceptChanges()},t.prototype.rejectChanges=function(){this.dfs.rejectChanges()},t.prototype.appendRow=function(t){this.cancelEdit(null),this.dfs.appendRow(t),this.dataChange.emit(this.dfs.getData()),this.rowAppended.emit()},t.prototype.updateRow=function(t,e){if(this.dfs.updateRow(t,e),this._updateRow(t,e),this.currentCell&&this.currentCell.isEditing&&e){var i=this.currentCell,r=i.column,n=i.cellRef;if(n&&r&&r.field&&r.editor&&"input-group"==r.editor.type.toLowerCase()&&Y.keysInData(r.field,e)){var o=n.rowData,s=this.commonUtils.getValue(r.field,o);n.formControl&&n.formControl.patchValue(s)}}this.updateFooterData(),this.dataChange.emit(this.dfs.getData()),this.rowUpdated.emit(),this.mergeCell&&this.refresh()},t.prototype._updateRow=function(t,e){var i=this,r=this.getRows().find(function(e){return i.dfs.primaryId(e)===t});r&&(e&&Object.keys(e).forEach(function(t){Y.setValue(t,e[t],r)}))},t.prototype.refreshRow=function(t){var e=this.dfs.findRow(t);e&&e.data?this.dfs.rowUpdate$.emit(e):this.writeConsole("Can not found row by id. id: "+t)},t.prototype.deleteRow=function(t){if(this.cancelEdit(t,!1),!t){if(!this.selectValue)throw new Error("删除行时主键标识ID 不能为空。");t=this.selectValue}var e=this.dfs.deleteRow(t);this.dataChange.emit(this.dfs.getData()),this.currentCell=null,this.dfs.updateProperty("currentCell",null),this.cd.detectChanges(),this.rowDeleted.emit(e)},t.prototype.validateRow=function(){},t.prototype.insertRow=function(){},t.prototype.scrollToLeft=function(){this.scrollInstance&&this.scrollInstance.scrollToLeft(0,200)},t.prototype.scrollToRight=function(){this.scrollInstance&&this.scrollInstance.scrollToRight(0,200)},t.prototype.scrollToTop=function(){if(this.scrollInstance){this.scrollInstance.scrollToTop(0,100);var t=this.dfs.getState().scrollInfo;t&&(t.y=0,this.dfs.updateProperty("scrollInfo",t))}},t.prototype.scrollToBottom=function(){this.scrollInstance&&this.scrollInstance.scrollToBottom(0,100)},t.prototype._setColumnReadonly=function(t,e,i){if(void 0===i&&(i=!0),t&&t.length&&e){var r=t.find(function(t){return t.field===e});r&&(r.readonly=i)}},t.prototype.setColumnReadonly=function(t,e){void 0===e&&(e=!0),this._setColumnReadonly(this.colGroup.leftFixed,t,e),this._setColumnReadonly(this.colGroup.rightFixed,t,e),this._setColumnReadonly(this.colGroup.normalColumns,t,e)},t.prototype.isMultiHeader=function(){return this.columns&&this.columns.length>1&&Array.isArray(this.columns[1])},t.prototype.toggleVisibleColumn=function(t,e){if(void 0===e&&(e=!0),this.isMultiHeader()){var i=o.flatten(this.columns);i.forEach(function(t){t.origianlColSpan===undefined&&(t.origianlColSpan=t.colspan)}),t.forEach(function(t){var r=i.find(function(e){return e.field===t||e.id===t});if(r){if(r.visible===e)return;r.visible=e;var n=K.getParentColumns(r,i),o=K.getChildColumns(r,i);o.forEach(function(t){t.visible=e}),e&&o.length&&(r.colspan=r.origianlColSpan);var s=r.colspan||1;n.forEach(function(t){if(e){var r=i.filter(function(e){return e.parentId===t.id&&e.visible});t.colspan=r.reduce(function(t,e){return t+=e.colspan||1},0)}else t.colspan=t.colspan-s;t.visible=!!t.colspan})}})}else this.columns.forEach(function(i){t.forEach(function(t){var r=i.find(function(e){return e.field===t||e.id===t});r&&(r.visible=e)})})},t.prototype.getColumn=function(t){return o.flatten(this.columns).find(function(e){return e.field===t||e.id===t})},t.prototype.showColumn=function(t,e){void 0===e&&(e=!0),"string"==typeof t?this.toggleVisibleColumn([t],!0):this.toggleVisibleColumn(t,!0),this.columnsChanged(e)},t.prototype.hideColumn=function(t,e){void 0===e&&(e=!0),"string"==typeof t?this.toggleVisibleColumn([t],!1):this.toggleVisibleColumn(t,!1),this.columnsChanged(e)},t.prototype.updateColumn=function(t,e,i){void 0===i&&(i=!0),this.columns.forEach(function(i){var r=i.find(function(e){return e.field===t});r&&(r=Object.assign(r,e))}),i&&this.columnsChanged()},t.prototype.setColumnFormatter=function(t,e,i){void 0===i&&(i=!0),this.columns.forEach(function(i){var r=i.find(function(e){return e.field===t});r&&(r.formatter=e)}),i&&this.columnsChanged()},t.prototype.updateColumnFormatterOptions=function(t,e,i){void 0===i&&(i=!0),this.columns.forEach(function(i){var r=i.find(function(e){return e.field===t});if(r&&r.formatter){var n=r.formatter;n.options=n.options||{},n.options=Object.assign(n.options,e||{})}}),i&&this.columnsChanged()},t.prototype.setColumnTitle=function(t,e,i){void 0===i&&(i=!0),this.columns.forEach(function(i){var r=i.find(function(e){return e.field===t});r&&(r.title=e)}),i&&this.columnsChanged()},t.prototype.sort=function(t,e){null===t||""===t||null===e||""===e?this.clearSort():(t&&e&&(this.sortName=t,this.sortOrder=e,this.dfs.setSortInfo(this.sortName,this.sortOrder)),this.remoteSort||this.dfs.clientSort(),this.onColumnSorted())},t.prototype.clearSort=function(){this.sortName="",this.sortOrder="",this.dfs.setSortInfo("",""),this.remoteSort||this.data&&this.data.length&&this.dfs.clearSort(),this.onColumnSorted()},t.prototype.onColumnSorted=function(){var t=null;if(this.sortName&&this.sortOrder){var e=this.sortOrder.split(",");t=this.sortName.split(",").reduce(function(t,i,r){return t[i]=e[r]||"asc",t},{})}this.remoteSort||this.dfs.clientSort(),this.columnSorted.emit(t)},t.prototype.updateSortInfo=function(t,e){var i=this,r=this.sortName,n=this.sortOrder,o=[],s=[];r&&(o=r.split(","),s=n.split(","));var l=t.split(","),a=e.split(",");l.forEach(function(t,e){var r=a[e]||"asc",n=r,l=o.findIndex(function(e){return e===t});if(l>=0){var d="asc"===s[l]?"desc":"asc";n=d,i.multiSort&&"asc"===n?(n=undefined,o.splice(l,1),s.splice(l,1)):s[l]=d}else i.multiSort?(o.push(t),s.push(r)):(o=[t],s=[r])}),this.sortName=o.join(","),this.sortOrder=s.join(",")},t.prototype.showControlPanel=function(t){t.stopPropagation();this.useControlPanel&&this.settingService&&(this.checkSettingHttp(),this.settingService.show(this))},t.prototype.checkSettingHttp=function(){if(!this.settingService.httpRestService||!this.settingService.httpRestService.befRepository){var t=this.inject.get(O,null);this.settingService.httpRestService=t}},t.prototype.disableHeader=function(t){void 0===t&&(t=!0),this.dgs.disableHeader.emit(t)},t.prototype.userProfileSetting=function(t){var e,i,r=this,n=t.sortInfo,o=t.viewColumns,s=t.groupField,l=t.columnFormat,a=t.expandGroupRows,d=t.multiHeaders;if(n){var c=n.sortName,h=n.sortOrder;e=c,i=h,c&&c.length&&(this.sortName=c.join(","),h&&(this.sortOrder=h.join(","))),this.__sortInfo=n}if(this.enableSetMultiHeaders&&d&&(d.viewCols||[]).length){var u=this.dfs._state.initialOptions,p=this.settingService.getMultiHeaderColumns(d.viewCols,u);p&&(this.columns=p,this.addControlCol())}else o&&o.length&&(this.columns=this.columns.map(function(t){return r.settingService.updateColumnFormat(t,l,r),r.settingService.newVisibleOrderColumns(t,o,l,r)}),this.addControlCol());this.columns.forEach(function(t){t.forEach(function(t){if(e&&e.length){var r=e.indexOf(t.field);r>-1&&(t.order=i[r])}(!t.field||t.field.indexOf("farris-datagrid-column_")>-1)&&(t.filter=!1)})}),this.groupRows&&null!==s&&s!==undefined&&(this.groupField=s,this.expandGroupRows=a===undefined?this.expandGroupRows:a),this.settingService.setCurrentConfigs(t)},t.prototype.isActived=function(){return rt.hasClass(this.dgContainer.nativeElement,this._active_datagrid_cls)&&this.dgContainer.nativeElement.offsetParent},t.prototype.cleanDom=function(){var t=document.querySelectorAll(".datagrid-cell-tooltip");t&&t.length&&t.forEach(function(t){t.remove()})},t.prototype.cellIsReadOnly=function(t,e){var i=!1;return this.disableRow&&(i=this.disableRow(e)),i||t.readonly!==undefined&&("boolean"==typeof t.readonly?i=t.readonly:"function"==typeof t.readonly&&(i=t.readonly(e))),i},t.prototype.groupFieldChanged=function(){this.columnsChanged(),this.settingService&&(this.checkSettingHttp(),this.settingService.saveUserConfig(this.id).subscribe()),this.groupFieldChange.emit({newGroupField:this.groupField,grid:this})},t.prototype.removeGroupField=function(t){var e=this.groupField.split(","),i=e.indexOf(t);i>-1&&e.splice(i,1).join(","),this.groupField=e.join(","),this.toggleVisibleColumn([t],!0),this.groupFieldChanged()},t.prototype.clearAllGrouppingField=function(t){var e=this;this.showLoading(),setTimeout(function(){var t=e.groupField.split(",");e.groupField="",e.toggleVisibleColumn(t,!0),e.groupFieldChanged(),e.closeLoading()})},t.prototype.setGroupFields=function(t){this.groupField=t,this.columnsChanged()},t.prototype.activeDataGrid=function(t){var e=this;void 0===t&&(t=!0);var i=document.querySelectorAll(".f-datagrid.datagrid-active");i.length&&i.forEach(function(t){e.render2.removeClass(t,e._active_datagrid_cls)}),t&&this.render2.addClass(this.dgContainer.nativeElement,this._active_datagrid_cls)},t.prototype.onDatagridContainerFocus=function(t){this.disabled||this.activeDataGrid()},t.prototype.setShadowColumnForFastMode=function(){if(this.fast){var t=this.flatColumns.filter(function(t){return"left"===t.fixed}),e=this.flatColumns.filter(function(t){return"right"===t.fixed});if(t&&t.length){var i=0;this.showCheckbox&&(i+=36),this.showLineNumber&&(i+=this.lineNumberWidth),t.forEach(function(e,r){i+=r?t[r-1].width:0,e.left=i}),t[t.length-1].leftShadowCol=!0,this.dfs.getColumn(t[t.length-1].field).leftShadowCol=!0}if(e&&e.length){e[0].rightShadowCol=!0;var r=e.reduce(function(t,e){return t+e.width},0);e.forEach(function(t,e){r-=t.width,t.right=r}),this.dfs.getColumn(e[0].field).rightShadowCol=!0}}},t.prototype.setCellStyle=function(){var t=this;if(this.flatColumns&&this.flatColumns.length){var e=[];this.setShadowColumnForFastMode(),this.flatColumns.forEach(function(i){var r=t.customStyleKey()+" .cell-text-align__"+i.field.replace(/\./g,"_")+" {align-items: "+function(t){var e="center";switch(t.valign){case"top":e="flex-start";break;case"bottom":e="flex-end";break;default:e="center"}return e}(i)+", justify-content: "+function(t){var e="flex-start";return"right"===t.align?e="flex-end":"center"===t.align&&(e="center"),e}(i)+"}";if(e.push(r),t.fast&&("left"===i.fixed||"right"===i.fixed)){var n=t.customStyleKey()+" .f-datagrid-fast__fixed-"+i.fixed+'[field="'+i.field+'"]{';"left"===i.fixed&&(n+="left: "+i.left+"px}"),"right"===i.fixed&&(n+="right: "+i.right+"px}"),e.push(n)}}),this.dgs.appendCssRules(e)}},t.prototype.updateFixedColumnCssForFastMode=function(t){if(this.fast){var e=this.flatColumns.findIndex(function(e){return e.field===t.field}),i=this.flatColumns[e+1];if(this.setShadowColumnForFastMode(),i&&i.fixed){var r=this.customStyleKey()+" .f-datagrid-fast__fixed-"+i.fixed+'[field="'+i.field+'"]'+"{"+i.fixed+":"+i[i.fixed]+"px}";this.dgs.appendCssRules([r])}}},t.prototype.expandGroupRow=function(t){this.dgs.toggleGroupRow$.emit({expand:!0,groupRowIndex:t})},t.prototype.collapseGroupRow=function(t){this.dgs.toggleGroupRow$.emit({expand:!1,groupRowIndex:t})},t.prototype.expandAllGroupRows=function(){this.dgs.toggleAllGroupRows$.emit({expand:!0})},t.prototype.collapseAllGroupRows=function(){this.dgs.toggleAllGroupRows$.emit({expand:!1})},t.prototype.checkFilterValues=function(t){var e=this,i=o.cloneDeep(t);this.enableSmartFilter&&Array.from(new Set(i.map(function(t){return t.FilterField}))).forEach(function(t){var r=e.dfs.getColumn(t);if(r&&"datetime"===r.dataType){var n=i.filter(function(e){return e.FilterField===t}),s=e.smartFilterService.controlData.find(function(e){return e.labelCode==t}),l=n[0].Value;if(-1===l.indexOf(":"))if(1===n.length)if(n[0].Value=l+" 00:00:00",s.value.single){n[0].Compare=d.Compare.GreaterOrEqual;var a=o.cloneDeep(n[0]);a.Value=l+" 23:59:59",a.Compare=d.Compare.LessOrEqual;var c=i.findIndex(function(e){return e.FilterField===t});i.splice(c+1,0,a)}else s.value.endValue&&(n[0].Value=l+" 23:59:59");else n[0].Value=n[0].Value+" 00:00:00",n[1].Value=n[1].Value+" 23:59:59"}});return i},t.prototype.getActionColumn=function(){return o.flatten(this.dfs.getState().initialOptions.designerColumns).find(function(t){return t.id&&t.id.indexOf("_caozuolie")>-1})},t.prototype.hideActionColumn=function(){var t=this.getActionColumn();t&&this.hideColumn(t.field)},t.prototype.showActionColumn=function(){var t=this.getActionColumn();t&&this.showColumn(t.field)},t.prototype.applyNewSize=function(t){var e=this;if(t&&!Array.isArray(t)&&"boolean"!=typeof t){var i={headerHeight:35,footerHeight:31,rowHeight:31,checkboxColumnWidth:36,lineNumberWidth:36,filterRowHeight:40},o=["headerHeight","footerHeight","rowHeight","checkboxColumnWidth","lineNumberWidth","filterRowHeight"],s=Object.keys(t);if(s&&s.length&&s.forEach(function(e){if(o.find(function(t){return t===e})){var r=t[e];null==r||isNaN(r)?delete t[e]:("string"==typeof r&&parseInt(r,10)?r=parseInt(r,10):"number"==typeof r&&(r=Math.floor(r)),isNaN(r)||r<=0||r<i[e]?t[e]=i[e]:t[e]=r>100?100:r)}else delete t[e]}),Object.keys(t).length){this.useThemes=!1,Object.assign(this,t),this._footerRowHeight=this.footerHeight;var l="min_row_height_"+this.rowHeight;this.dgs.removeCssRule(this.customStyleKey()+" ."+l),this.renderCustomStyle2({style:{"min-height":this.rowHeight+"px",height:this.rowHeight+"px"}},null,l);var a="min_footer_row_height_"+this._footerRowHeight;this.dgs.removeCssRule(this.customStyleKey()+" ."+a),this.renderCustomStyle2({style:{"min-height":this._footerRowHeight+"px",height:this.rowHeight+"px"}},null,a),this.dfs.updateState(t,!1),r.of(1).pipe(n.debounceTime(200)).subscribe(function(){e.setHeaderHeight(),e.setRowHeight(),e.setFooterHeight(),e.columnsChanged(),e.nowrap||e.dgs.cellContentWrapChanged.emit()})}}else this.writeConsole("传入的参数类型不匹配！The parameter type is incorrect!","warn")},t.decorators=[{type:e.Component,args:[{selector:"farris-datagrid",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-10 11:02:50\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-18 15:48:39\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n<div #datagridContainer *ngIf="!useHtmlTable"  tabindex="0" style="outline: 0;" hidefocus="true" class="f-datagrid" [ngStyle]="gridSize"  [attr.id]="id"\r\n    [class.f-datagrid-rowhover]="rowHover" [class.f-datagrid-bordered]="showBorder" [class.f-datagrid-wrap]="!nowrap" [class.f-datagrid-strip]="striped"\r\n    [class.f-datagrid-mergecell]="mergeCell" [class.f-datagrid-enable-highlight]="enableHighlightCell" [class.f-datagrid-fast]="fast" \r\n    [class.highlight-allowedit-cell]="enableEditCellStyle && editable" [class.scrollbar-allways-show]="scrollBarShowMode === \'allways\'" [class.scroolbar-arrows]="showScrollArrow"\r\n    [class.f-datagrid-sm]="sizeType === \'sm\'" [class.f-datagrid-lg]="sizeType === \'lg\'" [class.f-datagrid-xl]="sizeType === \'xl\'"\r\n    (focus)="onDatagridContainerFocus($event)" >\r\n    <div class="f-datagrid-column-drop-panel d-flex flex-row" *ngIf="showRowGroupPanel"\r\n        [style.height.px]="rowGroupPanelHeight" [style.top.px]="showFilterBar ? (filterBarHeight): 0"\r\n        [attr.placeholder]="groupField ? \'\': groupRowPanelPlaceholder" [style.pointer-events]="editable ? \'none\': \'\'">\r\n        <div class="row-group-fields flex-fill" drop-column style="display: inline-block!important;">\r\n            <div class="group-field smooth-dnd-draggable-wrapper" *ngFor="let f of groupFields$ | async">{{ dfs.getColumn(f)?.title }}\r\n                <span class="f-icon f-icon-x" title="{{ \'datagrid.groupRow.removeColumn\'| locale }}" (click)="removeGroupField(f)"></span>\r\n            </div>\r\n        </div>\r\n        <button class="f-datagrid-clear-group-field btn btn-light ml-auto"\r\n        title="{{\'datagrid.groupRow.clearTip\' | locale}}" (click)="clearAllGrouppingField($event)" [style.display]="groupField ? \'\' : \'none\'">\r\n            <span class="f-icon f-icon-remove"></span> {{\'datagrid.groupRow.clear\' | locale}}\r\n        </button>\r\n    </div>\r\n    \r\n    <filter-toolbar #filterText *ngIf="enableFilterRow && showFilterBar"></filter-toolbar>\r\n    <smart-filter-toolbar #smartfiltertoolbar *ngIf="enableSmartFilter && showFilterBar"\r\n    [height]="filterBarHeight"\r\n    [filterData]="smartFilterResult?.controlData || []" \r\n    (clearFilters)="onClearSmartFilters($event)"\r\n    (removeFilter)="onRemoveSmartFilterItem($event)"\r\n    [padding]="showBorder && filterBarHeight ? \'3px\': \'\'"\r\n    (resize)="onFilterBarResize($event)"\r\n    (filterChange)="onSmartFilterChange($event)"></smart-filter-toolbar>\r\n\r\n    <datagrid-header class="d-flex flex-fill" *ngIf="showHeader" #header [fast]="fast"\r\n    [columns]="columns" [columnsGroup]="colGroup" [height]="realHeaderHeight"\r\n    [style.height.px]="realHeaderHeight" style="position: relative;width:100%;" \r\n    [enableDragColumn]="enableDragColumn" [wrapHeader]="headerWrap"\r\n    [enableFilterRow]="enableFilterRow" [scrollbarMode]="scrollBarShowMode"></datagrid-header>\r\n\r\n\r\n    <datagrid-footer [height]="footerHeight" [width]="footerWidth" [columnsGroup]="colGroup" [position]="\'top\'"\r\n    [columns]="colGroup?.normalColumns" [data]="footerData | async" \r\n    [hasFixedColumns]="colGroup?.leftFixed && colGroup?.leftFixed?.length" [fast]="fast"\r\n    *ngIf="(footerPosition===\'top\' || footerPosition === \'both\') && showFooter && ((ds && ds.rows && ds.rows.length) || (footerData | async).length)"></datagrid-footer>\r\n\r\n    <datagrid-body [columnsGroup]="colGroup" [data]="ds.rows | paginate: pagerOpts" (dataChange)="setCurrentPagerData($event)"\r\n        [startRowIndex]="ds.index" [checkedRows]="checkedRows" cell-tooltip [canvasWidth]="colGroup?.totalWidth"\r\n        [topHideHeight]="ds.top" [bottomHideHeight]="ds.bottom" [footerHeight]="footerHeight"\r\n        [scrollBarMode]="scrollBarShowMode" [contextMenuItems]="contextMenus"  [fast]="fast"></datagrid-body>\r\n\r\n    <datagrid-footer [height]="footerHeight" [width]="footerWidth" [columnsGroup]="colGroup" [position]="\'bottom\'"\r\n    [columns]="colGroup?.normalColumns" [data]="footerData | async"  [fast]="fast"\r\n    [hasFixedColumns]="colGroup?.leftFixed && colGroup?.leftFixed?.length" \r\n    *ngIf="(footerPosition===\'bottom\' || footerPosition === \'both\') && showFooter && ((ds && ds.rows && ds.rows.length) || (footerData | async).length)"></datagrid-footer>\r\n    \r\n    <datagrid-pager *ngIf="pagination" #dgPager \r\n        [showPageList]="showPageList"\r\n        [id]="pagerOpts.id" [locked]="lockPagination"\r\n        [showPageInfo]="showPageInfo"\r\n        [viewMode]="pagerViewMode"\r\n        [showPageNumber] = "showPageNumber"\r\n        [maxSize]="pagerLabelSize"\r\n        [showSelectedList]="showSelectedList && multiSelect"\r\n        [selectedData]="checkedRows"\r\n        [showGotoInput]="showGotoInput"\r\n        (pageChange)="onPageChange($event)"\r\n        (pageSizeChange)="onPageSizeChange($event)"\r\n        (removeSelectedItem)="onRemoveSelectedItem($event)"\r\n        (clearSelectedItem)="onClearSelectedItem($event)"\r\n        [listItemFormatter]="selectedItemFormatter"\r\n        [contentTemplate]="pagerContentTemplate"\r\n        [data]="footerData | async"\r\n        [pagerPos]="pagerPos"\r\n        ></datagrid-pager>\r\n\r\n    <div class="f-datagrid-resize-bg" #resizeProxyBg></div>\r\n    <div #resizeProxy class="f-datagrid-resize-proxy" *ngIf="resizeColumn"></div>\r\n    \r\n    <datagrid-loading *ngIf="loading"></datagrid-loading>\r\n    <div style="position: absolute; left: -1000px; top: -1000px;visibility: hidden;" #longTextArea></div>\r\n    <div class="f-datagrid-disabled" style="position: absolute;\r\n        background: #fff;\r\n        height: 100%;\r\n        width: 100%;\r\n        z-index: 99;\r\n        opacity: .3;" *ngIf="disabled">\r\n    </div>\r\n</div>\r\n\r\n\r\n<div #datagridContainer\r\nclass="f-datagrid f-datagrid-htmltable" [attr.id]="id"\r\n[class.f-datagrid-rowhover]="rowHover"\r\n[class.f-datagrid-bordered]="showBorder"\r\n[class.f-datagrid-wrap]="!nowrap"\r\n[class.f-datagrid-strip]="striped" \r\n[class.f-datagrid-md]="sizeType === \'md\'"\r\n[class.f-datagrid-sm]="sizeType === \'sm\'" [class.f-datagrid-lg]="sizeType === \'lg\'" [class.f-datagrid-xl]="sizeType === \'xl\'"\r\n*ngIf="useHtmlTable" style="border-right: 0px; border-bottom: 0px; overflow: auto">\r\n\r\n    <auto-height [columnsGroup]="colGroup" [columns]="columns" [data]="ds.rows"></auto-height>\r\n</div>\r\n',encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush,providers:[Z,J,bt],exportAs:"datagrid",styles:[".f-datagrid-header table{\n            background-color: #F1F3F7;\n        }\n        .scrollbar-allways-show .ps.ps--active-x > .ps__rail-x {\n            margin-right: 0px!important;\n        }\n        .scrollbar-allways-show .ps.ps--active-y > .ps__rail-y {\n            margin-bottom: 0px!important;\n        }\n        .scrollbar-allways-show .ps.ps--active-x.ps--active-y > .ps__rail-x {\n            margin-right: 18px!important;\n        }\n        .scrollbar-allways-show .ps.ps--active-x.ps--active-y > .ps__rail-y {\n            margin-bottom: 18px!important;\n        }\n\n        "]}]}],t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:e.ElementRef},{type:e.Injector},{type:e.NgZone},{type:Z},{type:J},{type:e.ApplicationRef},{type:f.DomSanitizer},{type:e.Renderer2}]},t.propDecorators={fast:[{type:e.Input}],pos:[{type:e.HostBinding,args:["style.position"]}],hostCls:[{type:e.HostBinding,args:["class.f-datagrid-full"]}],autoHeightCls:[{type:e.HostBinding,args:["class.f-datagrid-auto-height"]}],useThemes:[{type:e.Input}],id:[{type:e.Input}],useHtmlTable:[{type:e.Input}],autoHeight:[{type:e.Input}],maxHeight:[{type:e.Input}],showBorder:[{type:e.Input}],striped:[{type:e.Input}],width:[{type:e.Input}],height:[{type:e.Input}],showHeader:[{type:e.Input}],headerHeight:[{type:e.Input}],headerWrap:[{type:e.Input}],showFooter:[{type:e.Input}],footerHeight:[{type:e.Input}],footerDataFrom:[{type:e.Input}],footerTemplate:[{type:e.Input}],footerComponentType:[{type:e.Input}],footerPosition:[{type:e.Input}],footerStyler:[{type:e.Input}],rowHeight:[{type:e.Input}],sizeType:[{type:e.Input}],fit:[{type:e.Input}],fitColumns:[{type:e.Input}],autoFitColumns:[{type:e.Input}],disabled:[{type:e.Input}],scrollBarShowMode:[{type:e.Input}],scrollBarOptions:[{type:e.Input}],showScrollArrow:[{type:e.Input}],resizeColumn:[{type:e.Input}],showLineNumber:[{type:e.Input}],lineNumberTitle:[{type:e.Input}],lineNumberWidth:[{type:e.Input}],checkboxColumnWidth:[{type:e.Input}],rowHover:[{type:e.Input}],clickToEdit:[{type:e.Input}],lockPagination:[{type:e.Input}],pagination:[{type:e.Input}],pagerContentTemplate:[{type:e.Input}],pagerPos:[{type:e.Input}],pagerViewMode:[{type:e.Input}],pagerOnServer:[{type:e.Input}],pageList:[{type:e.Input}],pageIndex:[{type:e.Input}],pageSize:[{type:e.Input}],pagerHeight:[{type:e.Input}],showPageList:[{type:e.Input}],showPageInfo:[{type:e.Input}],showPageNumber:[{type:e.Input}],pagerLabelSize:[{type:e.Input}],showGotoInput:[{type:e.Input}],enableMorePageSelect:[{type:e.Input}],showSelectedList:[{type:e.Input}],selectedItemFormatter:[{type:e.Input}],cellTipTimer:[{type:e.Input}],controlPaginationState:[{type:e.Input}],total:[{type:e.Input}],enableSelectRow:[{type:e.Input}],multiSelect:[{type:e.Input}],showCheckbox:[{type:e.Input}],showAllCheckbox:[{type:e.Input}],onlySelectSelf:[{type:e.Input}],checkOnSelect:[{type:e.Input}],selectOnCheck:[{type:e.Input}],selectionMode:[{type:e.Input}],keepSelect:[{type:e.Input}],useBlankWhenDataIsEmpty:[{type:e.Input}],emptyDataHeight:[{type:e.Input}],emptyMessage:[{type:e.Input}],emptyTemplate:[{type:e.Input}],emptyComponentType:[{type:e.Input}],idField:[{type:e.Input}],url:[{type:e.Input}],data:[{type:e.Input}],footerData:[{type:e.Input}],endEditByInvalid:[{type:e.Input}],columns:[{type:e.Input}],fields:[{type:e.Input}],nowrap:[{type:e.Input}],virtualized:[{type:e.Input}],virtualizedAsyncLoad:[{type:e.Input}],rowStyler:[{type:e.Input}],editMode:[{type:e.Input}],editable:[{type:e.Input}],enableEditCellStyle:[{type:e.Input}],selectOnEditing:[{type:e.Input}],editorHeight:[{type:e.Input}],remoteSort:[{type:e.Input}],sortName:[{type:e.Input}],sortOrder:[{type:e.Input}],multiSort:[{type:e.Input}],hoverRowCls:[{type:e.Input}],enableDragColumn:[{type:e.Input}],rowGroupPanelHeight:[{type:e.Input}],groupRows:[{type:e.Input}],groupFooter:[{type:e.Input}],expandGroupRows:[{type:e.Input}],groupFooterStyler:[{type:e.Input}],groupSummaryPosition:[{type:e.Input}],groupCellColSpan:[{type:e.Input}],groupField:[{type:e.Input}],showGroupColumn:[{type:e.Input}],groupFormatter:[{type:e.Input}],groupStyler:[{type:e.Input}],showRowGroupPanel:[{type:e.Input}],AutoColumnWidthUseDblclick:[{type:e.Input}],disableRow:[{type:e.Input}],useDefaultFilter:[{type:e.Input}],enableSmartFilter:[{type:e.Input}],enableFilterRow:[{type:e.Input}],remoteFilter:[{type:e.Input}],showFilterBar:[{type:e.Input}],filterBarHeight:[{type:e.Input}],filterRowHeight:[{type:e.Input}],conditions:[{type:e.Input}],selectValue:[{type:e.Input}],checkValues:[{type:e.Input}],selectValues:[{type:e.Input}],mergeCell:[{type:e.Input}],mergeFields:[{type:e.Input}],enableClientSortForMergeCell:[{type:e.Input}],useControlPanel:[{type:e.Input}],enableSimpleMode:[{type:e.Input}],controlPanelMode:[{type:e.Input}],enableScheme:[{type:e.Input}],defaultSchemeName:[{type:e.Input}],enableSetMultiHeaders:[{type:e.Input}],maxMultiHeaders:[{type:e.Input}],showConfirmWhenSchemeChanged:[{type:e.Input}],stopPropagation:[{type:e.Input}],closeOtherGridEditor:[{type:e.Input}],clearSelectionsWhenDataIsEmpty:[{type:e.Input}],enableContextMenu:[{type:e.Input}],contextMenus:[{type:e.Input}],beforeShowContextMenus:[{type:e.Input}],selectValueChange:[{type:e.Output}],checkValuesChange:[{type:e.Output}],selectValuesChange:[{type:e.Output}],beforeEdit:[{type:e.Input}],beginEdit:[{type:e.Output}],afterEdit:[{type:e.Input}],endEdit:[{type:e.Output}],cancelEdited:[{type:e.Output}],scrollY:[{type:e.Output}],pageSizeChanged:[{type:e.Output}],pageChanged:[{type:e.Output}],loadSuccess:[{type:e.Output}],emptyData:[{type:e.Output}],filterChanged:[{type:e.Output}],beforeSelect:[{type:e.Input}],beforeUnselect:[{type:e.Input}],beforeCheck:[{type:e.Input}],beforeUncheck:[{type:e.Input}],beforeSortColumn:[{type:e.Input}],beforeLoad:[{type:e.Input}],enableHighlightCell:[{type:e.Input}],checkedRowsDataFromSource:[{type:e.Input}],editcellWhenTabKeydwon:[{type:e.Input}],beforeClickCell:[{type:e.Output}],dblclickRow:[{type:e.Output}],selectChanged:[{type:e.Output}],unSelect:[{type:e.Output}],selectAll:[{type:e.Output}],unSelectAll:[{type:e.Output}],scrollYLoad:[{type:e.Output}],checked:[{type:e.Output}],unChecked:[{type:e.Output}],checkAll:[{type:e.Output}],unCheckAll:[{type:e.Output}],checkedChange:[{type:e.Output}],columnSorted:[{type:e.Output}],rowClick:[{type:e.Output}],rowAppended:[{type:e.Output}],rowDeleted:[{type:e.Output}],rowUpdated:[{type:e.Output}],dataChange:[{type:e.Output}],lastCellEnterHandler:[{type:e.Output}],groupFieldChange:[{type:e.Output}],columnMoved:[{type:e.Output}],cellClick:[{type:e.Output}],resized:[{type:e.Output}],dgColumns:[{type:e.ContentChildren,args:[yt]}],dgPager:[{type:e.ViewChild,args:["dgPager"]}],resizeProxy:[{type:e.ViewChild,args:["resizeProxy"]}],resizeProxyBg:[{type:e.ViewChild,args:["resizeProxyBg"]}],dgContainer:[{type:e.ViewChild,args:["datagridContainer"]}],longTextArea:[{type:e.ViewChild,args:["longTextArea"]}],smartFilterToolbar:[{type:e.ViewChild,args:["smartfiltertoolbar"]}],exitRowEditingWhenBodyClick:[{type:e.Input}],onClick:[{type:e.HostListener,args:["click",["$event"]]}]},t}(),St=function(){function t(t,e,i,r,n,o,s){this.render=t,this.el=e,this.zone=i,this.inject=r,this.filterPanelService=n,this.smartFilterSer=o,this.dg=s,this.filterData=null,this.disabled=!1,this.smartFilterDataChanged$=null,this.removeFilter$=null,this.clearAllFilter$=null,this.smartFilterEvents=[],this.idService=this.inject.get(l.IdService,null)}return t.prototype.ngOnInit=function(){var t=this;this.removeFilter$||(this.removeFilter$=this.smartFilterSer.removeFilter.subscribe(function(e){e&&e.labelCode===t.column.field&&(t.filterData=null,t.render.removeClass(t.el.nativeElement,"active"))}),this.smartFilterEvents.push(this.removeFilter$)),this.clearAllFilter$||(this.clearAllFilter$=this.smartFilterSer.clearAllFilter.subscribe(function(){t.filterData=null,t.render.removeClass(t.el.nativeElement,"active")}),this.smartFilterEvents.push(this.clearAllFilter$)),this.dg&&!this.smartFilterDataChanged$&&(this.smartFilterDataChanged$=this.dg.dgs.smartFilterDataChange.subscribe(function(e){e&&t.column.field===e.fieldCode&&(t.filterData.value=e.value,t.filterData.control.single=e.control.single)}),this.smartFilterEvents.push(this.smartFilterDataChanged$)),this.dg.dgs.clearFilter.subscribe(function(){t.filterData=null,t.dg.smartFilterResult={controlData:[],conditions:[]},t.smartFilterSer.clearAll(),t.render.removeClass(t.el.nativeElement,"active")})},t.prototype.ngOnDestroy=function(){this.filterPanelRef&&(this.filterPanelService.hidePanel(),this.filterPanelRef=null),this.smartFilterEvents&&this.smartFilterEvents.length&&(this.smartFilterEvents.forEach(function(t){t.unsubscribe(),t=null}),this.smartFilterEvents=[])},t.prototype.getFilterData=function(){var t=this.column,e=t.field,i=t.title;return this.filterData||(this.filterData=this.smartFilterSer.controlData.find(function(t){return t.id===e})),this.filterData||(this.filterData={id:e,labelCode:e,code:e,name:i,control:this.smartFilterSer.getColumnFilterData(this.column),placeHolder:"",value:{value:""}}),this.filterData.value&&this.filterData.control.controltype.indexOf("flexible")>-1&&(this.filterData.value.single?(delete this.filterData.value.startValue,delete this.filterData.value.endValue):this.filterData.value.value=""),o.cloneDeep(this.filterData)},t.prototype.getPanelPosition=function(t){var e=t.pageX-33,i=t.pageY+9,r=t.target.getBoundingClientRect(),n=0;window.innerWidth-e<380&&(e=e-(380-(window.innerWidth-e))-20,n=r.left-e);return{x:e,y:i,moveArrow:n}},t.prototype.hideFilterPanel=function(){this.filterPanelRef&&(this.filterPanelService.hidePanel(),this.filterPanelRef=null,this.filterData&&("bool-check"===this.filterData.control.controltype?this.filterData.value.value:this.filterData.valueText)||this.render.removeClass(this.el.nativeElement,"active"))},t.prototype.clearColumnFilter=function(t){this.filterData=null,this.hideFilterPanel(),this.smartFilterSer.removeCondition(t)},t.prototype.showFilterPanel=function(t){var e=this;t.stopPropagation(),this.render.addClass(this.el.nativeElement,"active");var i=this.getPanelPosition(t),r=i.x,n=i.y,o=i.moveArrow;if(this.filterPanelRef=this.filterPanelService.showPanel({left:r,top:n,item:this.getFilterData(),panelExtendTemplate:this.column.sortable?this.sortTmp:null,localStorageKey:"smartfilter_"+this.dg.dgs.createConfigKey(this.dg.id),target:t.target}),o){var s=this.filterPanelRef.el.querySelector(".f-filter-panel-arrow");s&&this.render.setStyle(s,"left",o+"px")}this.filterPanelRef.dataChange.subscribe(function(t){e.filterData&&e.filterData.id==t.id&&t.value&&t.value.single!==undefined&&(e.filterData.value=t.value,e.filterData.control.single=t.value.single)}),this.filterPanelRef.hidePanel.subscribe(function(t){e.hideFilterPanel()}),this.filterPanelRef.filterSubmit.subscribe(function(t){t.filter&&t.filter.length?(e.filterData=t.item||null,e.hideFilterPanel(),e.smartFilterSer.filterConditionChanged({conditions:t.filter,controlData:t.item,from:"panel"})):e.clearColumnFilter(t.item)}),this.filterPanelRef.clearFilter.subscribe(function(t){e.clearColumnFilter(t)})},t.prototype.onClick=function(t){if(t.stopPropagation(),!this.disabled)return this.showFilterPanel(t),!1},t.prototype.onSort=function(t,e){var i=this;t.stopPropagation(),this.column.order===e?this.column.order="":this.column.order=e;var r=this.dg.sortName,n=this.dg.sortOrder,o=[],s=[];r&&(o=r.split(","),s=n.split(","));var l=this.column.order,a=o.findIndex(function(t){return t===i.column.field});a>=0?""===l?(l=undefined,o.splice(a,1),s.splice(a,1)):s[a]=l:this.dg.multiSort?(o.push(this.column.field),s.push(l)):(o=[this.column.field],s=[l]),this.hideFilterPanel(),this.dg.sortName=o.join(","),this.dg.sortOrder=s.join(","),this.dg.dfs.setSortInfo(this.dg.sortName,this.dg.sortOrder),this.dg.beforeSortColumn(this.dg.sortName,this.dg.sortOrder,this.dg).subscribe(function(){i.dg.onColumnSorted()})},t.decorators=[{type:e.Component,args:[{selector:"datagrid-smart-filter, [datagrid-smart-filter]",template:'<ng-template #sort>\r\n    <div class="f-filter-panel-sort-wrapper f-filter-panel-sort-wrapper-hasfilter">\r\n        <div class="f-filter-panel-sort">\r\n            <div class="panel-sort-up panel-sort-item" [class.active]="column?.order === \'asc\'" (click)="onSort($event, \'asc\')">\r\n                <span class="panel-sort-item-icon f-icon f-icon-col-ascendingorder"></span>\r\n                <span class="panel-sort-item-text">{{ \'datagrid.settings.asc\' | locale: \'升序\' }}</span>\r\n            </div>\r\n            <div class="panel-sort-down panel-sort-item" [class.active]="column?.order === \'desc\'"  (click)="onSort($event, \'desc\')">\r\n                <span class="panel-sort-item-icon f-icon f-icon-col-descendingorder"></span>\r\n                <span class="panel-sort-item-text">{{ \'datagrid.settings.desc\' | locale: \'降序\' }}</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</ng-template>',providers:[p.FilterPanelService]}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.ElementRef},{type:e.NgZone},{type:e.Injector},{type:p.FilterPanelService},{type:bt},{type:xt,decorators:[{type:e.Optional}]}]},t.propDecorators={column:[{type:e.Input}],filterData:[{type:e.Input}],disabled:[{type:e.Input}],sortTmp:[{type:e.ViewChild,args:["sort"]}],onClick:[{type:e.HostListener,args:["click",["$event"]]}]},t}(),Rt=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[St],imports:[p.FilterPanelModule,a.LocaleModule.forRoot()],exports:[St]}]}],t}(),Et=function(){function t(t,i){this.cfs=t,this.injector=i,this.localeId="ZH-CHS",this.localeId=this.injector.get(e.LOCALE_ID)}return t.prototype.transform=function(t,e,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!1),e&&t&&t.field){var n=Y.getValue(t.field,e);if(t.editor&&t.editor.options&&t.editor.options.isPassword&&!t.formatter)return n?"******":"";var o=t.formatter;if(i)o=t.groupFooter?t.groupFooter.formatter:undefined;else if(r){if("object"==typeof(o=t.footer?t.footer.formatter:undefined))if(!o.options)o={type:o.type,options:o}}if(o){if(o){if("number"===o.type&&(o.options&&Object.keys(o.options).length||(o.options={thousand:",",precision:2})),"datetime"===o.type&&o.options&&t.editor&&t.editor.options){var s=t.editor.options,l=s.dateRange,a=s.dateRangeDatesDelimiter;o.options=Object.assign({dateRange:l,dateRangeDatesDelimiter:a},o.options)}"timeago"===o.type&&(o.options?o.options.locale=o.options.locale||this.localeId:o.options={locale:this.localeId})}this.getDatagridInstance();var d="";return this.dataGrid?(d=this.cfs.format(n,e,o,{utils:this.dataGrid.commonUtils,locale:this.localeId}),this.setFooterCellTitle(d,r,t.field),this.setPlaceHolderWhenEnableEditCellStyle(t,d,e,i||r)):(d=this.cfs.format(n,e,o,{locale:this.localeId}),this.setFooterCellTitle(d,r,t.field),d)}var c=n;return t.isMultilingualField?c=this.getMultilingualValue(n):null!==n&&n!==undefined&&"0"!==n&&"string"==typeof n&&(this.getDatagridInstance(),n.indexOf("\n")>-1&&this.dataGrid&&this.dataGrid.nowrap&&(c=n.replace(/\n/g," ")),this.setFooterCellTitle(c,r,t.field)),this.setPlaceHolderWhenEnableEditCellStyle(t,c,e,i||r)}return""},t.prototype.setFooterCellTitle=function(t,e,i){if(t&&e&&this.elRef){var r=this.elRef.nativeElement.querySelector('td[field="'+i+'"] .f-datagrid-footer-cell');r&&(r.title=t)}},t.prototype.getMultilingualValue=function(t){if(t&&"object"==typeof t&&Object.keys(t).length>0){if(this.injector&&(this.localeService=this.injector.get(a.LocaleService)),this.localeService){var e=this.localeService.localeId;return Y.getMultilingualValue(t,e)}return t["zh-CHS"]}return""},t.prototype.setPlaceHolderWhenEnableEditCellStyle=function(t,e,i,r){if(this.getDatagridInstance(),this.dataGrid){if(this.dataGrid.enableEditCellStyle){if(!this.dataGrid.editable||null!==e&&e!==undefined&&""!==e||r||this.cellIsReadOnly(t,i)){if(this.elRef)(n=this.elRef.nativeElement.querySelector(".cell-text-box"))&&n.className.indexOf("cell-empty")>-1&&(n.className=n.className.replace("cell-empty"," "));return e}var n;if(this.elRef)(n=this.elRef.nativeElement.querySelector(".cell-text-box"))&&-1===n.className.indexOf("cell-empty")&&(n.className=n.className+" cell-empty");return Y.getWhenEmptyText(t,this.localeId)}return e}return e},t.prototype.getDatagridInstance=function(){this.dataGrid||(this.dataGrid=this.injector.get(xt,null)),this.elRef||(this.elRef=this.injector.get(e.ElementRef,null))},t.prototype.cellIsReadOnly=function(t,e){return this.dataGrid.cellIsReadOnly(t,e)},t.decorators=[{type:e.Pipe,args:[{name:"formatCellData",pure:!1}]}],t.ctorParameters=function(){return[{type:g.ColumnFormatService},{type:e.Injector,decorators:[{type:e.Optional}]}]},t}(),It=function(){function t(t,i,o,s,l){var a=this;this.injector=t,this.app=i,this.dg=o,this.cd=s,this.el=l,this.psConfig={swipeEasing:!1,minScrollbarLength:15,handlers:["click-rail","drag-thumb","wheel","touch"],suppressScrollY:(!this.dg.autoHeight||!this.dg.maxHeight)&&this.dg.autoHeight},this.scrollTop=0,this.scrollLeft=0,this.deltaTopHeight=0,this.wheelWidth=0,this._fixedRightScrollLeft=0,this.maxScrollLeft=0,this.showRightShadow=!1,this.footerHeight=0,this.topHideHeight=0,this.bottomHideHeight=0,this.startRowIndex=0,this.dataChange=new e.EventEmitter,this.scrollBarMode="auto",this.checkedRows=[],this.fast=!1,this.visibleContextMenus=[],this.currentRowId=undefined,this._hoverRowIndex=-1,this.subscriptions=[],this.minRowBuffer=3,this.vScrollDir=1,this.rowsCache={},this.lastRenderedScrollTop=0,this.lastRenderedScrollLeft=0,this.prevScrollTop=0,this.prevScrollLeft=0,this.rows=[],this.blankTopHeight=0,this.blankBottomHeight=0,this.cellContentFormatter=null,this.__triggerBodyClickEvent=!0,this.destroy$=new r.Subject,this._onMouseClick=null,this._scrollTimer=0,this._scrollXTimer=0,this.ro=null,this.resizeObserverTimer=0,this._clickCellWeakMap=new WeakMap,this.onBeforeShowContextMenu=function(t){var e=t.contextMenuDom,i=t.event;if(i.target.closest(".datagrid-editor"))return r.of({show:!1});var o=i.target.id;if(e&&-1===e.className.indexOf("f-datagrid-group-row")&&-1===e.className.indexOf("f-datagrid-group-footer")){o=Y.getRowIdByTr(e);var s=a.dfs.findRow(o),l=a.viewportW>a.totalWidth?a.totalWidth:a.viewportW,d=i.target.closest("td"),c=null;if(d){var h=d.getAttribute("field");c=h?a.dfs.getColumn(h):null}var u=r.of(!0);if(a.dg.beforeShowContextMenus){var p=a.dg.beforeShowContextMenus({rowid:o,data:s.data,grid:a.dg,column:c});"boolean"==typeof p?u=r.of(p):p.subscribe&&(u=p)}return u.pipe(n.switchMap(function(t){var e={rowid:o,data:s.data,grid:a.dg,column:c};if("object"==typeof t){var i=t.show,n=t.customData;return r.of({show:i,data:Object.assign(e,{customData:n||null}),focusTargetWidth:l})}return r.of({show:t,data:e,focusTargetWidth:l})}))}return r.of({show:!1})},this.dfs=this.injector.get(Z),this.dgs=this.injector.get(J),this.ngZone=this.injector.get(e.NgZone),this.render=this.injector.get(e.Renderer2);var d=this.injector.get(g.ColumnFormatService);this.cellContentFormatter=new Et(d,this.injector)}return Object.defineProperty(t.prototype,"fixedRightScrollLeft",{get:function(){return this._fixedRightScrollLeft},set:function(t){this._fixedRightScrollLeft=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hoverRowIndex",{get:function(){return this._hoverRowIndex},set:function(t){this._hoverRowIndex=t,this.cd.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRows",{get:function(){return this.dg.selections},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarXHeight",{get:function(){if(this.dg&&this.ps&&this.ps.instance){var t="allways"===this.dg.scrollBarShowMode&&this.ps.instance.scrollbarXActive?22:0;if(this.ps.instance.scrollbarYActive&&t)return t+18}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarYWidth",{get:function(){if(this.dg&&this.ps&&this.ps.instance)return"allways"===this.dg.scrollBarShowMode&&this.ps.instance.scrollbarYActive&&this.showRightShadow?18:0},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.listenSubjects(),this.dg.scrollInstance=this.ps;var e=this.dgs.showGridHeader.subscribe(function(e){t.updateContainerSize(e)});this.subscriptions.push(e);var i=this.dgs.footerPositionChanged.subscribe(function(){t.updateContainerSize()});this.subscriptions.push(i);var r=this.dgs.rowHeightChanged.subscribe(function(){t.cd.detectChanges()});this.subscriptions.push(r);var o=this.dfs.clientSort$.subscribe(function(){t.checkScrollbarPosition(!0),t.cd.detectChanges()});this.subscriptions.push(o);var s=this.dg.dgs.columnsChanged.pipe(n.delay(50)).subscribe(function(e){e&&e.scrollToLeft&&(t.ps.elementRef.nativeElement.scrollTo(0,0),t.ps.scrollToLeft(0,100))});this.subscriptions.push(s),this.viewScrollContainer.nativeElement.addEventListener("click",this._onMouseClick=function(e){t.onMouseClick(e)}),this.dg.nowrap||this.dgs.dataloaded.subscribe(function(){t.updateRowHeight()})},t.prototype.updateContainerSize=function(t){var e=t||this.dg.realHeaderHeight;this.setPositionTop(e),this.height=this.dg.height-this.top,this.bodyStyle=this.getBodyStyle(),this.cd.detectChanges()},t.prototype.ngOnChanges=function(t){var e=this;if(t.data&&!t.data.isFirstChange()){this.bodyStyle=this.getBodyStyle(),this.dfs.setCurrentPageData(t.data.currentValue);var i=!!t.data.currentValue.filter(function(t){return!t.__group__}).map(function(t){return t.id}).filter(function(e){return!t.data.previousValue.filter(function(t){return!t.__group__}).find(function(t){return t.id===e})}).length,r=t.data.currentValue.filter(function(t){return!t.__group__}).length>=t.data.previousValue.filter(function(t){return!t.__group__}).length;this.onDataChanged(r,i),t.data.currentValue&&t.data.currentValue.length||setTimeout(function(){e.setPositionTop(e.dg.realHeaderHeight)})}t.footerHeight===undefined||t.footerHeight.isFirstChange()||(this.bodyStyle=this.getBodyStyle()),t.scrollBarMode===undefined||t.scrollBarMode.isFirstChange()||(this.ps&&this.ps.instance&&"allways"===this.scrollBarMode&&this.ps.instance.scrollbarYActive?this.rightFixedWidth+=this.showRightShadow?18:0:this.rightFixedWidth=this.columnsGroup.rightFixedWidth,"allways"===this.dg.scrollBarShowMode&&this.ps&&this.ps.instance&&this.ps.instance.scrollbarXActive&&(this.blankBottomHeight+=22)),t.showScrollArrow&&!t.showScrollArrow.isFirstChange()&&this.ps&&this.ps.update()},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.cellContentFormatter=null,this.dg.scrollInstance=null,this.destroySubscriptions(),this.viewScrollContainer.nativeElement.removeEventListener("click",this._onMouseClick),this.ro&&(this.ro.unobserve(this.viewScrollContainer.nativeElement),this.ro.disconnect()),this.resizeObserverTimer&&clearTimeout(this.resizeObserverTimer)},t.prototype.ngAfterViewInit=function(){var t=this;this.ro=new u(function(e){t.viewScrollContainer.nativeElement.offsetParent&&(t.resizeObserverTimer&&clearTimeout(t.resizeObserverTimer),t.resizeObserverTimer=setTimeout(function(){t.updateCanvasHeight(),"allways"===t.scrollBarMode&&t.ps.update(),t.cd.detectChanges(),t.dgs.scrollbarUpdate.emit({scrollbarRef:t.ps.instance,rightWidth:t.rightFixedWidth,showRightShadow:t.showRightShadow})},100))}),this.ro.observe(this.viewScrollContainer.nativeElement)},t.prototype.ngAfterViewChecked=function(){},t.prototype.setPositionTop=function(t){this.top=t,(this.dg.enableFilterRow||this.dg.enableSmartFilter)&&this.dg.showFilterBar&&(this.top+=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(this.top+=this.dg.rowGroupPanelHeight),!this.dg.showFooter||"top"!==this.dg.footerPosition&&"both"!==this.dg.footerPosition||this.data&&this.data.length&&(this.top+=this.dg.footerHeight)},t.prototype.checkScrollbarPosition=function(t){if(void 0===t&&(t=!1),this.dg.data&&this.dg.data.length){var e=this.ps.instance,i=this.ps.elementRef.nativeElement,r=e?e.lastScrollLeft:0,n=e?e.lastScrollTop:0,o=i.scrollTop,s=i.scrollLeft;t?(this.ps.scrollToTop(),this.dgs.onScrollMove(n,"psScrollY")):o!=n&&(this.ps.scrollToTop(n),this.dgs.onScrollMove(n,"psScrollY")),this.scrollLeft=r,s!=r?(this.ps.scrollToX(r),this.dgs.onScrollMove(r,H)):r&&this.dgs.onScrollMove(r,H)}},t.prototype.onDataChanged=function(t,e){var i=this;void 0===t&&(t=!0),void 0===e&&(e=!1),this.dg.setPagerHeight(),this.viewportH=this.getViewPortHeight(),this.bodyStyle=this.getBodyStyle(),!this.ps||!this.ps.instance||this.dg.isEditing()||this.dg.clientFilterChanged||this.dg.autoHeight||(this.scrollTop=0,this.lastRenderedScrollTop=0,this.ps.scrollToTop(),this.scrollLeft=0,this.ps.scrollToLeft()),this.rowsCache={};var r;!this.dg.nowrap||this.dg.autoHeight?(this.renderData(!1),this.dgs.cellContentWrapChanged.next(this.width)):(t&&(r=i.dg.dfs.getState().scrollInfo)&&(r.y&&(i.scrollTop=r.y,i.dg.scrollInstance.scrollToY(r.y),i.dgs.onScrollMove(r.y,"psScrollY")),r.x&&(i.scrollLeft=r.x,i.dg.scrollInstance.scrollToX(r.x),i.dg.dgs.onScrollMove(r.x,H))),this.renderData(!1),this.ps.update()),e?this.dg.initSelectOrChecked():this.dg.refreshSelectedData(),this.dg.clientFilterChanged=!1,this.dataChange.emit(this.data),"allways"===this.dg.scrollBarShowMode&&this.ps.instance&&!this.dg.showScrollArrow&&this.hasYScrollbar()},t.prototype.destroySubscriptions=function(){this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){t&&(t.unsubscribe(),t=null)}),this.subscriptions=[])},t.prototype.listenSubjects=function(){var t=this;this.destroySubscriptions(),this.gridSizeSubscribe=this.dfs.gridSize$.pipe(n.takeUntil(this.destroy$)).pipe(n.debounceTime(50)).subscribe(function(e){if(e){t.dg.setPagerHeight();var i=t.dg.setHeaderHeight();t.setPositionTop(i),t.height=e.height-t.top;var r=t.width;t.width=Math.floor(e.width),t.rowHeight=e.rowHeight,t.dg.showBorder&&(t.width-=2),t.viewportW=t.width,t.viewportH=t.getViewPortHeight(),t.canvasHeight=t.getCanvasHeight(),t.ngZone.runOutsideAngular(function(){t.columnsGroup=e.columnsGroup,t.checkScrollbarPosition(),t.updateColumnSize(e.columnsGroup),t.dgs.showFixedShadow.emit({showRightShadow:t.showRightShadow,x:t.fixedRightScrollLeft}),t.renderData(!1),(!t.dg.nowrap||t.dg.autoHeight)&&t.rows&&t.rows.length?r!==t.width?t.dgs.cellContentWrapChanged.next(r):t.keepScrollbarPosition(r):(t._scrollXTimer&&clearTimeout(t._scrollXTimer),t._scrollXTimer=setTimeout(function(){t.keepScrollbarPosition(r)},100))})}}),this.subscriptions.push(this.gridSizeSubscribe),this.columnResizeSubscribe=this.dfs.columnResize$.subscribe(function(e){t.updateColumnSize(e),t.cd.detectChanges()}),this.subscriptions.push(this.columnResizeSubscribe),this.dgs.setSelecedRow.subscribe(function(e){e&&e.selected?t.currentRowId=e.id:t.currentRowId=undefined}),this.selectRowSubscribe=this.dfs.selectRow$.subscribe(function(e){e&&(t.currentRowId=e.id,t.cd.detectChanges())}),this.subscriptions.push(this.selectRowSubscribe),this.unselectRowSubscribe=this.dfs.unSelectRow$.subscribe(function(e){e&&e.id===t.currentRowId&&(t.currentRowId=undefined,t.dg.selectedRow=null),!t.dg.editable&&t.dg.multiSelect&&(t.__triggerBodyClickEvent="default"===t.dg.selectionMode),t.cd.detectChanges()}),this.subscriptions.push(this.unselectRowSubscribe),this.selectAllSubscribe=this.dfs.selectAll$.subscribe(function(e){t.dg.selectAll.emit(e),t.cd.detectChanges()}),this.subscriptions.push(this.selectAllSubscribe),this.checkRowSubscribe=this.dfs.checkRow$.subscribe(function(e){t.dg.checked.emit(e),t.checkedRowsChanged()}),this.subscriptions.push(this.checkRowSubscribe),this.clearSelectionsSubscribe=this.dfs.clearSelections$.subscribe(function(){t.currentRowId=undefined,t.dg.checkOnSelect&&t.checkedRowsChanged(),t.dg.unSelectAll.emit()}),this.subscriptions.push(this.clearSelectionsSubscribe),this.uncheckRowSubscribe=this.dfs.unCheckRow$.subscribe(function(e){t.dg.unChecked.emit(e),t.checkedRowsChanged()}),this.subscriptions.push(this.uncheckRowSubscribe),this.checkAllSubscribe=this.dfs.checkAll$.subscribe(function(e){t.dg.checkAll.emit(e),t.checkedRowsChanged()}),this.subscriptions.push(this.checkAllSubscribe),this.clearCheckedsSubscribe=this.dfs.clearCheckeds$.subscribe(function(e){t.dg.selectOnCheck&&(t.currentRowId=undefined),t.dg.unCheckAll.emit(e),t.checkedRowsChanged(),t.cd.detectChanges()}),this.subscriptions.push(this.clearCheckedsSubscribe),this.subscriptions.push(this.dgs.setScrollbarPosition.subscribe(function(){t.checkScrollbarPosition(),t.updateScrollPosition(t.scrollLeft)})),this.dgs.columnResized.pipe(n.delay(100)).subscribe(function(e){if(!t.dg.nowrap||t.dg.currentCell&&t.dg.currentCell.isEditing&&t.dg.currentCell.column&&t.dg.currentCell.column.editor&&"textarea"===t.dg.currentCell.column.editor.type){t.dg.dgContainer.nativeElement.querySelectorAll(".f-datagrid-body-row:not(.f-datagrid-footer-row)").forEach(function(e){t.render.setStyle(e,"height","auto")});var i="";if(e)i="row_"+e.id;t.updateRowHeight(i)}t.dg.headerWrap&&(t.dg.setHeaderHeight(),t.dfs.columnResizeEnd())}),this.dgs.cellContentWrapChanged.pipe(n.takeUntil(this.destroy$),n.debounceTime(100)).subscribe(function(e){t.updateRowHeight(),null!=e?t.keepScrollbarPosition(e):t.ps&&t.ps.instance&&t.ps.instance.update()}),this.dg.dfs.rowUpdate$.subscribe(function(e){e&&e.data&&t.buildCustomCellStyle(e)}),this.dg.groupRows&&(this.dfs.expandGroupRow.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){e&&e.data&&(t.groupRowStateChanged(e.data,!0),setTimeout(function(){t.updateRowHeight()}))}),this.dfs.collapseGroupRow.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){e&&e.data&&t.groupRowStateChanged(e.data,!1)}))},t.prototype.groupRowExpandUpdate=function(t,e){var i=this;t.rows&&t.rows.length&&t.rows.forEach(function(r){if(r[B])i.data.filter(function(t){return t[$]===r[$]}).forEach(function(i){i[U]=e&&t.expanded});else{var n=i.data.find(function(t){return t.id===r.id});n&&(n[U]=e&&t.expanded,n.rows&&n.rows.length&&i.groupRowExpandUpdate(n,e))}})},t.prototype.groupRowStateChanged=function(t,e){var i=this;if(this.dg.virtualized){var r=this.data.find(function(e){return e.id===t.id});this.groupRowExpandUpdate(r,e),this.renderData(!1)}else this.getCanvasHeight();this._psUpdateTimer_&&clearTimeout(this._psUpdateTimer_),this._psUpdateTimer_=setTimeout(function(){i.ps.update(),i.cd.detectChanges()},100)},t.prototype.keepScrollbarPosition=function(t){var e=this;this.cd.destroyed||this.cd.detectChanges(),this.ps.instance&&(this.keepScrollbarPositionTIMER&&clearTimeout(this.keepScrollbarPositionTIMER),this.keepScrollbarPositionTIMER=setTimeout(function(){if(e.width>t){var i=e.scrollLeft-(e.width-t);e.ps.elementRef.nativeElement.scrollLeft=i<0?0:i}e.dg.nowrap&&!e.dg.autoHeight||e.updateCanvasHeight(),e.ps.update(),e.updateScrollPosition(e.ps.elementRef.nativeElement.scrollLeft),e.dgs.scrollbarUpdate.emit({scrollbarRef:e.ps.instance,rightWidth:e.rightFixedWidth,showRightShadow:e.showRightShadow})},50))},t.prototype.updateColumnSize=function(t){if(t){this.columnsGroup=t,this.leftFixedWidth=this.columnsGroup.leftFixedWidth,this.colsWidth=this.columnsGroup.normalWidth,this.scrollLeft=this.ps.elementRef.nativeElement.scrollLeft,this.maxScrollLeft=this.colsWidth+this.leftFixedWidth,this.fixedRightScrollLeft=this.maxScrollLeft;var e=this.dg.dgContainer.nativeElement.offsetWidth,i=Math.floor(this.columnsGroup.totalWidth);this.bodyStyle=this.getBodyStyle(),e>i||e===i?this.showRightShadow=!1:(this.showRightShadow=!0,this.fixedRightScrollLeft=this.width+this.scrollLeft),this.setFixedRightWidth()}},t.prototype.setFixedRightWidth=function(){this.rightFixedWidth=this.columnsGroup.rightFixedWidth,this.totalWidth=this.columnsGroup.totalWidth,this.ps&&this.ps.instance&&"allways"===this.dg.scrollBarShowMode&&this.ps.instance.scrollbarYActive&&(this.rightFixedWidth+=18)},t.prototype.buildCustomCellStyle=function(t){var e=this,i=[],r=[];this.fixedRightEl&&(i=this.fixedRightEl.nativeElement.querySelectorAll("tr")),this.fixedLeftEl&&(r=this.fixedLeftEl.nativeElement.querySelectorAll(".fixed-left-row"));var n=this.mainArea.nativeElement.querySelectorAll("tr.f-datagrid-body-row"),o=function(i,r,n){if(i.length){var o=i[t.index].querySelector('[field="'+r.field+'"]');o&&e.dg.renderCustomStyle(n,o)}};this.dg.flatColumns.forEach(function(e){if(e.styler){var s=t.data,l=Y.getValue(e.field,s),a=e.styler(l,s,t.index);a&&Object.keys(a).length&&(o(r,e,a),o(i,e,a),o(n,e,a))}})},t.prototype.checkedRowsChanged=function(){this.dgs.onCheckedRowsCountChange();var t=this.dg.checkeds;this.dg.checkValues=t.map(function(t){return t.id}),this.dg.checkValuesChange.emit(this.dg.checkValues),this.dg.checkedChange.emit(t)},t.prototype.getTrDomHeight=function(){var t=this,e=[],i=[],r=[],n=[];return this.fixedRightEl&&(i=this.fixedRightEl.nativeElement.querySelectorAll("tr")),this.fixedLeftEl&&(r=this.fixedLeftEl.nativeElement.querySelectorAll(".fixed-left-row")),this.mainArea&&(n=this.mainArea.nativeElement.querySelectorAll("tr.f-datagrid-body-row")),n.forEach(function(n,o){var s=0,l=Math.ceil(n.offsetHeight),a=0;r&&r.length&&(s=Math.ceil(r[o].offsetHeight)),i&&i.length&&(a=Math.ceil(i[o].offsetHeight));var d=Math.max(s,l,a,t.dg.rowHeight);e.push(d)}),e},t.prototype.updateRowHeight2=function(){var t=this,e=[],i=[],r=[];this.fixedRightEl&&(e=this.fixedRightEl.nativeElement.querySelectorAll("tr")),this.fixedLeftEl&&(i=this.fixedLeftEl.nativeElement.querySelectorAll(".fixed-left-row")),this.mainArea&&(r=this.mainArea.nativeElement.querySelectorAll("tr.f-datagrid-body-row")),r.forEach(function(r,n){t.removeRowHeightCls(r),i&&i[n]&&t.removeRowHeightCls(i[n]),e&&e[n]&&t.removeRowHeightCls(e[n])}),this.UPDATE_ROW_HEIGHT_TIMER&&clearTimeout(this.UPDATE_ROW_HEIGHT_TIMER),this.UPDATE_ROW_HEIGHT_TIMER=setTimeout(function(){r.forEach(function(r,n){var o=0,s=Math.ceil(r.offsetHeight),l=0,a=null,d=null;i&&i.length&&(o=Math.ceil(i[n].offsetHeight),a=i[n]),e&&e.length&&(l=Math.ceil(e[n].offsetHeight),d=e[n]);var c=Math.max(o,s,l,t.dg.rowHeight);if(!t.dg.nowrap||t.dg.autoHeight){var h="wrap_row_height__"+c,u="min_row_height_"+t.rowHeight,p=function(e){t.removeRowHeightCls(e),t.render.addClass(e,h),t.render.addClass(e,u)};t.addRowHeightCls(h,c),p(r),a&&p(a),d&&p(d)}})},100)},t.prototype.removeRowHeightCls=function(t){if(t){var e=Array.from(t.classList).find(function(t){return t.indexOf("wrap_row_height_")>-1});e&&t.classList.remove(e)}},t.prototype.addRowHeightCls=function(t,e){this.dgs.removeCssRule(this.dg.customStyleKey()+" ."+t),this.dg.renderCustomStyle2({style:{height:e+"px!important"}},null,t)},t.prototype.updateRowHeight=function(t){if(void 0===t&&(t=null),!this.fast&&this.mainArea){var e=this.el.nativeElement.querySelector("div.f-datagrid-body");if(e&&(!this.dg.nowrap||this.dg.autoHeight?this.render.addClass(e,"data-wrap"):this.render.removeClass(e,"data-wrap")),t){var i=Y.getTrDomById(t,document);if(!i)return;var r=t+"_fixedleft",n=t+"_fixedright",o=Y.getTrDomById(r,document),s=Y.getTrDomById(n,document);this.removeRowHeightCls(i),this.removeRowHeightCls(o),this.removeRowHeightCls(s);var l=[];if(this.fixedRightEl){var a=Y.getTrDomById(t,this.fixedRightEl.nativeElement);a&&l.push(Math.ceil(a.offsetHeight))}if(this.fixedLeftEl){var d=Y.getTrDomById(t,this.fixedLeftEl.nativeElement);d&&l.push(Math.ceil(d.offsetHeight))}if(this.mainArea){var c=Y.getTrDomById(t,this.mainArea.nativeElement);c&&l.push(Math.ceil(c.offsetHeight))}var h=Math.max.apply(Math,R(l)),u="wrap_row_height__"+h;this.dg.nowrap&&!this.dg.autoHeight||(this.render.addClass(i,u),this.addRowHeightCls(u,h),o&&this.render.addClass(o,u),s&&this.render.addClass(s,u))}else this.updateRowHeight2();this.updateCanvasHeight(),this.dg.dgContainer.nativeElement.querySelectorAll(".f-datagrid-body-row:not(f-datagrid-footer-row)").forEach(function(t){return t.style.height=""}),this.cd.destroyed||this.cd.detectChanges()}},t.prototype.getBodyStyle=function(){var t=this.getViewPortHeight();if(this.data.length)this.dg.showFooter&&"both"===this.dg.footerPosition&&(t-=this.dg.footerHeight);else if(this.dg.useBlankWhenDataIsEmpty)t=this.dg.emptyDataHeight;else if(this.dg.autoHeight&&(t=this.dg.emptyDataHeight),this.dg.footerData&&this.dg.showFooter){var e=this.dg.footerData;this.dg.footerData.subscribe&&(e=this.dg.footerData.value),e&&Array.isArray(e)&&e.length&&(t-=this.dg.footerHeight,"both"===this.dg.footerPosition&&(t-=this.dg.footerHeight))}return{height:Math.floor(t)+1+"px"}},t.prototype.updateScrollPosition=function(t){if(this.scrollLeft=t,this.fixedRightScrollLeft=this.scrollLeft+this.width-this.rightFixedWidth,this.fixedRightScrollLeft===this.maxScrollLeft||this.fixedRightScrollLeft>this.maxScrollLeft?(this.fixedRightScrollLeft=this.maxScrollLeft,this.showRightShadow=!1):this.showRightShadow=!0,this.fixedLeftEl&&this.render.setStyle(this.fixedLeftEl.nativeElement,"transform","translate3d("+this.scrollLeft+"px, 0px, 0px)"),this.fixedRightEl){var e=this.dg.width-(this.dg.showBorder?2:0)-this.columnsGroup.rightFixedWidth;this.ps&&this.ps.instance&&this.ps.instance.scrollbarYActive&&"allways"===this.dg.scrollBarShowMode&&(e-=18);var i=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth+this.columnsGroup.rightFixedWidth;this.dg.width-(this.dg.showBorder?2:0)>i&&(e=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth),e+=this.scrollLeft,this.fixedRightScrollLeft=e,this.render.setStyle(this.fixedRightEl.nativeElement,"transform","translate3d("+this.fixedRightScrollLeft+"px, 0px, 0px)")}},t.prototype.onScrollToX=function(t){var e=t.target.scrollLeft;this.updateScrollPosition(e),this.dgs.onScrollMove(e,H),this.dfs.updateProperty("scrollInfo",{y:t.target.scrollTop,x:e}),this.dgs.showFixedShadow.emit({showRightShadow:this.showRightShadow,x:this.fixedRightScrollLeft})},t.prototype.onScrollToY=function(t){var e=this;this._scrollTimer&&clearTimeout(this._scrollTimer),this._scrollTimer=setTimeout(function(){var i=t.target.scrollTop;e.dg.virtualized&&e.handleScroll(),e.scrollTop=i,e.dfs.updateProperty("scrollInfo",{y:i,x:t.target.scrollLeft}),e.dg.scrollY.emit(i),e.dgs.onScrollMove(i,"psScrollY")},100)},t.prototype.onPsXReachStart=function(t){var e=t.target.scrollLeft;this.updateScrollPosition(e),this.dgs.onScrollMove(e,L)},t.prototype.onPsXReachEnd=function(t){this.showRightShadow=!1},t.prototype.isChecked=function(t){return!!t&&this.dfs.isRowChecked(t[this.dg.idField])},t.prototype.isSelected=function(t){return!!t&&this.dfs.isRowSelected(t[this.dg.idField])},t.prototype.toggleGroupRow=function(t,e){void 0===e&&(e=!0),t.expanded=e,this.ps.update()},t.prototype.getViewPortHeight=function(){var t=this.dg.height;return this.dg.showHeader&&(t-=this.dg.realHeaderHeight),(this.dg.enableFilterRow||this.dg.enableSmartFilter)&&this.dg.showFilterBar&&(t-=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(t-=this.dg.rowGroupPanelHeight),this.dg.showFooter&&this.data.length&&(t-=this.dg.footerHeight),this.dg.pagination&&(t=t-this.dg.pagerHeight-2),this.dg.showBorder&&(t-=2),this.viewportH=t,t},t.prototype.allRowsHeight=function(){var t=this.dg.rowHeight+1,e=0;if(this.dg.groupRows){var i=this.data.filter(function(t){return t.__group_visible__||t.__group_visible__===undefined});e="inGroupRow"===this.dg.groupSummaryPosition?i.filter(function(t){return!t.__group_footer__}).length:i.length}else e=this.data.length;var r=e*t;return this.dg.autoHeight?r+=e:r+=2,r},t.prototype.getCanvasHeight=function(){var t=0;return this.data&&this.data.length?((t=this.dg.nowrap?this.dg.maxHeight&&this.dg.autoHeight&&this.mainArea?Math.floor(this.mainArea.nativeElement.getBoundingClientRect().height):this.allRowsHeight():this.getTrDomHeight().reduce(function(t,e){return t+e},0))||(t=this.viewportH),t+="allways"===this.dg.scrollBarShowMode&&this.ps.instance&&this.ps.instance.scrollbarXActive?18:0,this.canvasHeight=t,t):(this.canvasHeight=0,0)},t.prototype.updateCanvasHeight=function(){this.canvasHeight=this.getCanvasHeight()},t.prototype.getRowFromPosition=function(t){return Math.floor(t/(this.dg.rowHeight+1))},t.prototype.getVisibleRange=function(t,e){return null==t&&(t=this.scrollTop),null==e&&(e=this.scrollLeft),{top:this.getRowFromPosition(t),bottom:this.getRowFromPosition(t+this.viewportH)+1,leftPx:e,rightPx:e+this.viewportW}},t.prototype.getRenderedRange=function(t,e){var i=this.getVisibleRange(t,e),r=Math.round(this.viewportH/(this.dg.rowHeight+1)),n=this.minRowBuffer;return-1==this.vScrollDir?(i.top-=r,i.bottom+=n):1==this.vScrollDir?(i.top-=n,i.bottom+=r):(i.top-=n,i.bottom+=n),i.top=Math.max(0,i.top),i.bottom=Math.min(this.data.length-1,i.bottom),i.leftPx-=this.viewportW,i.rightPx+=this.viewportW,i.leftPx=Math.max(0,i.leftPx),i.rightPx=Math.min(this.canvasWidth,i.rightPx),i},t.prototype.renderRows=function(t){var e=this,i=[],r=this.data.length,n=this.data;this.dg.groupRows&&this.dg.groupField&&(n=n.filter(function(t){return t.__group_visible__||t.__group_visible__===undefined}),"inGroupRow"===this.dg.groupSummaryPosition&&(n=n.filter(function(t){return!t.__group_footer__})),r=n.length,this.rowsCache={});for(var o=t.top;o<=t.bottom;o++)this.rowsCache[o]||o==r||(i.push(o),this.rowsCache[o]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]});o=0;for(var s=i.length;o<s;o++)this.rowsCache[i[o]].rowNode=n[i[o]];return Object.keys(this.rowsCache).map(function(t){return e.rowsCache[t].rowNode}).filter(function(t){return t})},t.prototype.removeRowFromCache=function(t){this.rowsCache[t]&&delete this.rowsCache[t]},t.prototype.cleanupRows=function(t){for(var e in this.rowsCache)(e<t.top||e>t.bottom)&&this.removeRowFromCache(e)},t.prototype.hasYScrollbar=function(t){var e=this;setTimeout(function(){var i=(t=t==undefined?e.ps.instance.scrollbarYActive:t)&&"allways"===e.dg.scrollBarShowMode?18:0;e.dfs.updateProperty("scrollbarY",i),e.dfs.resize()},60)},t.prototype.onClickScrollArrow=function(t){var e=t.dir;t.event;if(this.ps&&this.ps.instance){var i=this.ps.instance.reach,r=i.x,n=i.y;switch(e){case"left":"start"!==r&&(this.viewScrollContainer.nativeElement.scrollLeft=this.viewScrollContainer.nativeElement.scrollLeft-40);break;case"right":"end"!==r&&(this.viewScrollContainer.nativeElement.scrollLeft=this.viewScrollContainer.nativeElement.scrollLeft+40);break;case"top":"start"!==n&&(this.viewScrollContainer.nativeElement.scrollTop=this.viewScrollContainer.nativeElement.scrollTop-40);break;case"bottom":"end"!==n&&(this.viewScrollContainer.nativeElement.scrollTop=this.viewScrollContainer.nativeElement.scrollTop+40)}this.ps.update()}},t.prototype.renderData=function(t){if(void 0===t&&(t=!0),this.canvasHeight=this.getCanvasHeight(),!this.dg.virtualized||this.dg.autoHeight)this.rows=this.data;else{this.getVisibleRange();var e=this.getRenderedRange();this.cleanupRows(e),this.rows=this.renderRows(e),this.startRowIndex=e.top,this.lastRenderedScrollTop=this.scrollTop,this.lastRenderedScrollLeft=this.scrollLeft,this.blankTopHeight=this.startRowIndex*(this.dg.rowHeight+1),this.blankBottomHeight=this.canvasHeight-this.blankTopHeight-this.rows.length*(this.dg.rowHeight+1),"allways"===this.dg.scrollBarShowMode&&this.ps&&this.ps.instance&&this.ps.instance.scrollbarXActive&&(this.blankBottomHeight+=22),t&&this.cd.detectChanges()}},t.prototype.handleScroll=function(){return this.scrollTop=this.ps.elementRef.nativeElement.scrollTop,this.scrollLeft=this.ps.elementRef.nativeElement.scrollLeft,this._handleScroll()},t.prototype._handleScroll=function(){var t=this.viewScrollContainer.nativeElement,e=t.scrollHeight-t.clientHeight,i=t.scrollWidth-t.clientWidth;e=Math.max(0,e),i=Math.max(0,i),this.scrollTop>e&&(this.scrollTop=e),this.scrollLeft>i&&(this.scrollLeft=i);var r=Math.abs(this.scrollTop-this.prevScrollTop),n=Math.abs(this.scrollLeft-this.prevScrollLeft);n&&(this.prevScrollLeft=this.scrollLeft);var o=this.lastRenderedScrollTop;if(r&&(this.vScrollDir=this.prevScrollTop<this.scrollTop?1:-1,this.prevScrollTop=this.scrollTop,r<this.viewportH&&this._scrollTo(this.scrollTop)),n||r){var s=Math.abs(this.lastRenderedScrollLeft-this.scrollLeft),l=Math.abs(o-this.scrollTop);(s>20||l>20)&&(l<this.viewportH&&this.viewportW,this.renderData())}return!(!n&&!r)},t.prototype._scrollTo=function(t){this.viewScrollContainer.nativeElement;t=Math.max(t,0);var e=t=Math.min(t,this.canvasHeight-this.viewportH);this.prevScrollTop!=e&&(this.vScrollDir=this.prevScrollTop<e?1:-1,this.lastRenderedScrollTop=this.scrollTop=this.prevScrollTop=e)},t.prototype.onMouseClick=function(t){var e=this,i=t.target;if("TEXTAREA"!==i.nodeName&&"INPUT"!==i.nodeName){var r=i;if("TD"!==i.nodeName&&(r=i.closest("TD")),r){var n=(new Date).getTime(),o=this.lastTapDiffTime||0;this.lastTapDiffTime=n;var s=n-o,l=function(){r&&r.selectCell?r.selectCell(t,r):e._selectRow(r,function(t,i){var r=!i;"default"===e.dg.selectionMode&&(e.dg.clearCheckeds(),r=!0),e.dg.selectRow(t,r,!1),e.dg.updateAllCheckboxStatus()})},a=function(){var t=e.dg.dblclickRow.observers.length?200:0;e._clickCellWeakMap.has(e.el.nativeElement)&&r&&r.parentElement===e._clickCellWeakMap.get(e.el.nativeElement)&&(e._clickCellWeakMap["delete"](e.el.nativeElement),1)?s<t?(e.dg.writeConsole("双击"),clearTimeout(e.lastTapTimeFunc)):e.lastTapTimeFunc=setTimeout(function(){l()},t):e.lastTapTimeFunc=setTimeout(function(){l()},t?180:0),e._clickCellWeakMap.set(e.el.nativeElement,r.parentElement)};if(!this.dg.editable&&r)return t.stopPropagation(),void a();if("row"===this.dg.editMode)return this.dg.exitRowEditingWhenBodyClick&&this.dg.isEditing()&&this.dg.endEditing(),void this._selectRow(r,function(t,i){e.dg.selectRow(t,!i,!1)});if(!r&&this.dg.currentCell&&(r=this.dg.currentCell.cellElement)&&r.closeEdit)return t.stopPropagation(),void r.closeEdit();if(r){if(this.dg.disableRow){var d=null,c=-1;if(r.gridCellData)d=r.gridCellData.rowData,c=r.gridCellData.rowIndex;else{var h=this.dg.getRowIdByTr(r.parentElement);h&&(d=h.data,c=h.index)}if(!d)return void this.dg.writeConsole("未获取到行数据。");if(this.dg.disableRow(d,c))return void this.dg.endEditing()}t.stopPropagation(),this.dg.editable&&"cell"===this.dg.editMode?r.edit?this._selectRow(r,function(){r.edit(t)}):r.selectCell||r.className.indexOf("f-datagrid-cell-rownumber")>-1?a():this.dg.isEditing()&&this.dg.endEditing():r.selectCell?a():(this.dg.isEditing()&&(this.dg.exitRowEditingWhenBodyClick||"cell"===this.dg.editMode)&&this.dg.endEditing(),l())}}else this.dg.isEditing()&&(this.dg.exitRowEditingWhenBodyClick||"cell"==this.dg.editMode)&&this.dg.endEditing()}},t.prototype._selectRow=function(t,e){if(t){var i=t.parentElement,r=this.dg.getRowIdByTr(i);if(!r)return;var o=r.data,s=r.index,l=r.id,a=this.dfs.isRowSelected(l);this.dg._beforeSelectRow$(s,o,l).pipe(n.takeUntil(this.destroy$)).subscribe(function(t){t&&e(l,a)})}},t.decorators=[{type:e.Component,args:[{selector:"datagrid-body",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:07\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-26 08:20:46\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n<ng-container  *ngIf="(!data || !data.length) && !dg.useBlankWhenDataIsEmpty" >\r\n\r\n    <div *ngIf="!dg.emptyTemplate && !dg.emptyComponentType" class="d-flex flex-column f-datagrid-norecords"\r\n        style="position:absolute; margin:0;left: 0; z-index: 1;justify-content: center; align-items: center;pointer-events: none;" \r\n        [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" >\r\n        <div class="f-datagrid-norecords-content" style="margin: 0;width: 100%;position: relative; top: 0">\r\n            {{ \'datagrid.emptyMessage\' | locale }}\r\n        </div>\r\n    </div>\r\n    <div class="f-datagrid-body" [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" style="z-index: 1;"  *ngIf="dg.emptyTemplate && !dg.emptyComponentType">\r\n        <ng-container #emptyTemplate [ngTemplateOutlet]="dg.emptyTemplate" ></ng-container>\r\n    </div>\r\n    <div class="f-datagrid-body" [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" style="z-index: 1;"  *ngIf="dg.emptyComponentType"\r\n    component-template [ctx]="{ instance: dg }" [cmpRef]="dg.emptyComponentType">\r\n    </div>\r\n   \r\n</ng-container>\r\n\r\n\r\n\r\n<div class="f-datagrid-body" [ngStyle]="bodyStyle" [style.top.px]="top" [style.width.px]="viewportW" \r\n[farris-context-menus]="contextMenuItems" [disabled]="!dg.enableContextMenu" [activeDomName]="\'tr\'" [beforeShowContextMenu]="onBeforeShowContextMenu"\r\n[menuClass]="\'f-datagrid-context-menu\'">\r\n\r\n    <div #viewScrollContainer [scrollbar]="psConfig" #ps="ngxScrollbar"\r\n        class="ps f-datagrid-body-wheel-area" \r\n        style="width: 100%;"\r\n        [ngStyle]="bodyStyle"\r\n        (psXReachEnd)="onPsXReachEnd($event)"\r\n        (psScrollY)="onScrollToY($event)"\r\n        (psScrollX)="onScrollToX($event)" (psXReachStart)="onPsXReachStart($event)"\r\n        [style.paddingRight.px]="scrollbarYWidth">\r\n       \r\n        <div class="f-datagrid-norecords"  [auto-height]="dg.autoHeight" [wheelHeight]="dg.emptyDataHeight || 240" style="height: 100%" [style.width.px]="canvasWidth - 2"  *ngIf="!data || !data.length">\r\n            \x3c!-- <div *ngIf="!dg.emptyTemplate" class="f-datagrid-norecords-content" style="width: 100%" >{{ \'datagrid.emptyMessage\' | locale }}</div>\r\n            <ng-container #emptyTemplate *ngIf="dg.emptyTemplate" [ngTemplateOutlet]="dg.emptyTemplate" ></ng-container> --\x3e\r\n        </div>\r\n\r\n        <div [style.display]="dg.flatColumns?.length ? \'\': \'none\'"  *ngIf="data && data.length && !fast"\r\n            class="f-datagrid-bg" [auto-height]="dg.autoHeight" [wheelHeight]="canvasHeight"\r\n            [style.height.px]="canvasHeight" [style.width.px]="totalWidth" >\r\n            \r\n                <div #blankTop hidefocus style="width: 100%" [style.height.px]="blankTopHeight"></div>\r\n                \r\n                <div #fixedLeft class="f-datagrid-table f-datagrid-body-fixed-left" style="z-index:999" [class.f-datagrid-fixed-left-shadow]="!!scrollLeft && !dg.groupRows"\r\n                    *ngIf="dg.showLineNumber || dg.showCheckbox || (columnsGroup?.leftFixed && columnsGroup?.leftFixed.length)"  [style.width.px]="leftFixedWidth" \r\n                    [style.transform]="\'translate3d(\'+ scrollLeft +\'px, 0px, 0px)\'">\r\n\r\n                    <fixed-left-rows [columns]="columnsGroup?.leftFixed" [checkedRows]="checkedRows" [selectedRows]="selectedRows" [data]="rows"></fixed-left-rows>\r\n                </div>\r\n\r\n                <div #fixedRight class="f-datagrid-table f-datagrid-body-fixed-right" \r\n                    *ngIf="columnsGroup?.rightFixed && columnsGroup?.rightFixed.length"\r\n                    [class.f-datagrid-fixed-right-shadow]="showRightShadow" \r\n                    style="border: 0" [style.width.px]="rightFixedWidth" \r\n                    [style.transform]="\'translate3d(\'+ fixedRightScrollLeft +\'px, 0px, 0px)\'">\r\n                    \r\n                    <datagrid-rows #rightRows [fixedRight]="true" [startRowIndex]="startRowIndex" \r\n                    [width]="columnsGroup?.rightFixedWidth"\r\n                    [columns]="columnsGroup?.rightFixed" [data]="rows"></datagrid-rows>\r\n                </div>\r\n\r\n                <div #main [style.width.px]="colsWidth" style="position: relative;" [style.left.px]="leftFixedWidth" class="f-datagrid-table f-datagrid-body-center">\r\n                    <datagrid-rows #mainRows [hasFixedColumns]="columnsGroup?.leftFixed && columnsGroup?.leftFixed?.length" [startRowIndex]="startRowIndex" [columns]="columnsGroup?.normalColumns" [data]="rows"></datagrid-rows>\r\n                </div>\r\n\r\n                <div hidefocus style="width: 100%" [style.height.px]="blankBottomHeight"></div>\r\n\r\n        </div>\r\n\r\n\r\n        <div [style.display]="dg.flatColumns?.length ? \'\': \'none\'"  *ngIf="data && data.length && fast"\r\n        class="f-datagrid-bg" [auto-height]="dg.autoHeight" [wheelHeight]="canvasHeight"\r\n        [style.height.px]="canvasHeight" [style.width.px]="totalWidth" >\r\n        \r\n                <div #blankTop hidefocus style="width: 100%" [style.height.px]="blankTopHeight"></div>\r\n\r\n                <div #main style="position: relative;"  class="f-datagrid-table f-datagrid-body-center">\r\n                    <datagrid-rows #mainRows [hasFixedColumns]="columnsGroup?.leftFixed && columnsGroup?.leftFixed?.length"  [startRowIndex]="startRowIndex" [columns]="columnsGroup?.columns" [data]="rows"></datagrid-rows>\r\n                </div>\r\n\r\n                <div hidefocus style="width: 100%" [style.height.px]="blankBottomHeight"></div>\r\n\r\n        </div>\r\n    </div>\r\n\r\n    <scrollbar-arrows [scrollbarXActive]="ps.instance && ps.instance.scrollbarXActive" [scrollbarYActive]="ps.instance && ps.instance.scrollbarYActive" \r\n    *ngIf="dg.scrollBarShowMode === \'allways\' && dg.showScrollArrow" (hasYScrollbar)="hasYScrollbar($event)" (scrollMoveTo)="onClickScrollArrow($event)"\r\n    [reachX]="ps.instance && ps.instance.reach.x" [reachY]="ps.instance && ps.instance.reach.y"></scrollbar-arrows>\r\n\r\n\r\n</div>\r\n\r\n\r\n\r\n',changeDetection:e.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ApplicationRef},{type:xt,decorators:[{type:e.Optional}]},{type:e.ChangeDetectorRef},{type:e.ElementRef}]},t.propDecorators={footerHeight:[{type:e.Input}],canvasWidth:[{type:e.Input}],columnsGroup:[{type:e.Input}],topHideHeight:[{type:e.Input}],bottomHideHeight:[{type:e.Input}],startRowIndex:[{type:e.Input}],data:[{type:e.Input}],dataChange:[{type:e.Output}],scrollBarMode:[{type:e.Input}],contextMenuItems:[{type:e.Input}],checkedRows:[{type:e.Input}],fast:[{type:e.Input}],ps:[{type:e.ViewChild,args:["ps"]}],tableRowsCmp:[{type:e.ViewChild,args:["mainRows"]}],rightRowsCmp:[{type:e.ViewChild,args:["rightRows"]}],fixedLeftEl:[{type:e.ViewChild,args:["fixedLeft"]}],fixedRightEl:[{type:e.ViewChild,args:["fixedRight"]}],mainArea:[{type:e.ViewChild,args:["main"]}],viewScrollContainer:[{type:e.ViewChild,args:["viewScrollContainer"]}]},t}(),kt=function(){function t(t,e,i,r,n,o){this.dg=t,this.dgb=e,this.cd=i,this.el=r,this.zone=n,this.render=o,this._mouseenter=null,this._mouseleave=null}return t.prototype.ngOnInit=function(){var t=this;this.dg.rowHover&&!this.dg.fast&&this.zone.runOutsideAngular(function(){t._mouseenter=Y.on(t.el.nativeElement,"mouseenter",t.onmouseenter.bind(t),{target:".f-datagrid-body-row",options:{capture:!0}}),t._mouseleave=Y.on(t.el.nativeElement,"mouseleave",t.onmouseleave.bind(t),{target:".f-datagrid-body-row",options:{capture:!0}})})},t.prototype.ngOnDestroy=function(){this._mouseenter&&this._mouseenter(),this._mouseleave&&this._mouseleave()},t.prototype.onmouseenter=function(t){this.setRowHoverCls(t)},t.prototype.onmouseleave=function(t){this.setRowHoverCls(t,!1)},t.prototype.setRowHoverCls=function(t,e){if(void 0===e&&(e=!0),this.dg.rowHover&&t.target.matches(".f-datagrid-body-row")){this.rowIndex=t.target.getAttribute("index");var i=this.dg.el.nativeElement.querySelector(".f-datagrid-body");if(i){var r=i.querySelector(".f-datagrid-body-fixed-left"),n=i.querySelector(".f-datagrid-body-fixed-right"),o=i.querySelector(".f-datagrid-body-center"),s=e?"addClass":"removeClass",l='tr[index="'+this.rowIndex+'"]',a=this.el.nativeElement.closest("div");if(a&&a.className){var d=o.querySelector(l);if(!d)return;if(d.className.indexOf("f-datagrid-disable-row")>-1)return;var c=null,h=null;n&&(h=n.querySelector(l)),r&&(c=r.querySelector(l)),r&&c&&this.render[s](c,this.dg.hoverRowCls),n&&h&&this.render[s](h,this.dg.hoverRowCls),this.render[s](d,this.dg.hoverRowCls)}}}},t.decorators=[{type:e.Directive,args:[{selector:"[row-hover]",exportAs:"rowHover"}]}],t.ctorParameters=function(){return[{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:It,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return It})]}]},{type:e.ChangeDetectorRef},{type:e.ElementRef},{type:e.NgZone},{type:e.Renderer2}]},t.propDecorators={rowIndex:[{type:e.Input}],rowData:[{type:e.Input,args:["row-hover"]}]},t}(),Ft=function(){function t(t,i,n,o,s,l){this.dg=t,this.injector=i,this.fb=n,this.el=o,this.render=s,this.drHover=l,this.editable=!1,this.clickHandler=new e.EventEmitter,this.rowUpdated=new e.EventEmitter,this.form=new m.FormGroup({}),this.documentRowDblclickEvent=null,this.columnsChangedSubscription=null,this.datasourceChangedSubscription=null,this.subscriptions=[],this.destroy$=new r.Subject,this.dfs=this.injector.get(Z),this.ngZone=this.injector.get(e.NgZone),this.cd=this.injector.get(e.ChangeDetectorRef),this.dgb=this.injector.get(It)}return Object.defineProperty(t.prototype,"rowId",{get:function(){return this.rowData?this.dfs.primaryId(this.rowData):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return!!this.dg.disableRow&&this.dg.disableRow(this.rowData,this.rowIndex)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.datasourceChangedSubscription=this.dg.dgs.onDataSourceChange.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.renderCustomStyle()}),this.columnsChangedSubscription=this.dg.dgs.columnsChanged.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.createControl()});var e=this.dg.dfs.rowUpdate$.pipe(n.takeUntil(this.destroy$),n.filter(function(e){return e.keyID===t.rowId})).subscribe(function(e){e&&e.data&&(t.dfs.primaryId(e.data)===t.rowId&&t.renderCustomStyle(e.data),Object.assign(t.rowData,e.data),t.updateCellEmptyStyle(),t.rowUpdated.emit(t.rowData),t.cd.detectChanges())});this.subscriptions.push(e);var i=this.dg.dgs.updateEmptyStyle$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.updateCellEmptyStyle()});this.subscriptions.push(i);var r=this.dg.dfs.selectRow$.pipe(n.takeUntil(this.destroy$)).pipe(n.filter(function(e){return e.id===t.rowId})).subscribe(function(){if(t.dg.selectedRow&&!t.dg.selectedRow.dr){var e=t.getRowPosition();"left"===e?t.dg.selectedRow.drl=t:"right"===e?t.dg.selectedRow.drr=t:t.dg.selectedRow.dr=t}});this.subscriptions.push(r)},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.columnsChangedSubscription&&(this.columnsChangedSubscription.unsubscribe(),this.columnsChangedSubscription=null),this.datasourceChangedSubscription&&(this.datasourceChangedSubscription.unsubscribe(),this.datasourceChangedSubscription=null),this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[]),this.form&&(this.form=null),this.cells=null},t.prototype.ngOnChanges=function(t){t.rowData&&!t.rowData.isFirstChange()&&this.updateCellEmptyStyle()},t.prototype.ngAfterViewInit=function(){this.renderCustomStyle(),this.updateCellEmptyStyle()},t.prototype.getRowPosition=function(){var t=this.el.nativeElement.id;return t.indexOf("fixedleft")>-1?"left":t.indexOf("fixedright")>-1?"right":"center"},t.prototype.renderCustomStyle=function(t){if(void 0===t&&(t=null),this.dg.rowStyler){var e=t||this.rowData,i=this.dg.rowStyler(e,this.rowIndex),r=this.el.nativeElement,n=Array.from(r.classList).find(function(t){return t.indexOf("customrowcls_")>-1});if(n&&r.classList.remove(n),i&&Object.keys(i).length){var o="customrowcls_"+this.dg.idService.encrypt(JSON.stringify(i));this.dg.renderCustomStyle2(i,this.el.nativeElement,"f-datagrid-body ."+o),this.render.addClass(this.el.nativeElement,o)}}},t.prototype.onRowClick=function(t){},t.prototype.initFormControl=function(){this.form=this.fb.group({}),this.createControl(),this.form.bindingData=this.rowData},t.prototype.createControl=function(){var t=this;this.dg&&this.dg.flatColumns&&this.dg.flatColumns.forEach(function(e){if((e.editor||e.editorTemplate)&&!t.form.controls[e.field]){var i=t.createFormControl(e);t.form.addControl(e.field,i)}})},t.prototype.createFormControl=function(t){return this.fb.control(Y.getValue(t.field,this.rowData),{validators:t.editor?this.bindValidations(t.editor.validators):null})},t.prototype.bindValidations=function(t){var e=this,i=[];return t&&t.length&&t.forEach(function(t){var r=null;switch(t.type){case"required":r=m.Validators.required;break;case"min":r=m.Validators.min(t.value);break;case"max":r=m.Validators.max(t.value);break;case"minLength":r=m.Validators.minLength(t.value);break;case"maxLength":r=m.Validators.maxLength(t.value);break;case"email":r=m.Validators.email;break;case"requiredTrue":r=m.Validators.requiredTrue;break;case"pattern":r=m.Validators.pattern(t.value)}if(r)i.push(r);else if(e.dg.validators&&e.dg.validators.length){var n=e.dg.validators.find(function(e){return e.name===t.type});n&&(r=n.value(e.rowData),i.push(r))}}),i},t.prototype.refresh=function(){this.updateRowHeight(),this.updateCellEmptyStyle()},t.prototype.updateRowHeight=function(){if(!this.dg.nowrap){var t=this.dgb.mainArea.nativeElement.querySelector('tr[index="'+this.rowIndex+'"]');t.style.height="auto";var e=null,i=null,r=[t.offsetHeight];if(this.dgb){this.dgb.fixedLeftEl&&(e=this.dgb.fixedLeftEl.nativeElement.querySelector('tr[index="'+this.rowIndex+'"]'))&&(e.style.height="auto",r.push(e.offsetHeight)),this.dgb.fixedRightEl&&(i=this.dgb.fixedRightEl.nativeElement.querySelector('tr[index="'+this.rowIndex+'"]'))&&(i.style.height="auto",r.push(i.offsetHeight));var n=Math.max.apply(Math,R(r));t.style.height=n+"px",e&&(e.style.height=n+"px"),i&&(i.style.height=n+"px"),this.cd.markForCheck(),this.dgb.updateCanvasHeight()}}},t.prototype.updateCellEmptyStyle=function(){var t=this;if(this.dg.enableEditCellStyle){var e=!1;this.dg.disableRow&&(e=this.dg.disableRow(this.rowData,this.rowIndex));!function(i){if(i.length)for(var r=0;r<i.length;r++){var n=i[r].getAttribute("field");if(n){var o=t.dfs.getColumn(n);if(o){if(!o.editor)continue;var s="right"===o.align?"allow-edit-cell-left":"allow-edit-cell",l=N[o.editor.type],a=i[r].querySelector(".cell-text-box"),d=Y.getValue(n,t.rowData),c=t.dg.colFormatSer.format(d,t.rowData,o.formatter);!t.dg.editable||e||t.dg.cellIsReadOnly(o,t.rowData)?(i[r].className=i[r].className.replace(s,""),i[r].className=i[r].className.replace(l,""),a&&(a.className.indexOf("cell-empty")>-1&&(a.className=a.className.replace("cell-empty","")),""===d||null===d||d===undefined?a.innerHTML="":a.innerHTML=c)):(a&&(""===d||null===d||d===undefined?(-1===a.className.indexOf("cell-empty")&&(a.className=a.className+" cell-empty"),a.innerHTML=Y.getWhenEmptyText(o,t.dg.localeService.localeId)):a.innerHTML=c),i[r].className.indexOf("cell-readonly")>-1&&(i[r].className=i[r].className.replace("cell-readonly","")),-1===i[r].className.indexOf(s)&&t.render.addClass(i[r],s),-1===i[r].className.indexOf(l)&&t.render.addClass(i[r],l))}}}}(this.el.nativeElement.querySelectorAll('td[field]:not([field="_datagrid-setting-control_"])'))}},t.decorators=[{type:e.Directive,args:[{selector:"[grid-row]",exportAs:"gridRow"}]}],t.ctorParameters=function(){return[{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:e.Injector},{type:m.FormBuilder},{type:e.ElementRef},{type:e.Renderer2},{type:kt,decorators:[{type:e.Optional},{type:e.Self}]}]},t.propDecorators={editable:[{type:e.Input}],rowData:[{type:e.Input,args:["grid-row"]}],rowIndex:[{type:e.Input}],clickHandler:[{type:e.Output}],rowUpdated:[{type:e.Output}],cells:[{type:e.ContentChildren,args:[e.forwardRef(function(){return Tt}),{descendants:!0}]}]},t}(),_t=function(){function t(t,e,i,r,n){this.resolver=t,this.container=e,this.app=i,this.fb=r,this.dg=n,this.cfs=null,this.timer=null,this.cfs=this.dg.inject.get(g.ColumnFormatService)}return t.prototype.ngOnInit=function(){this.column.editor&&this.createCellEditor()},t.prototype.ngAfterViewInit=function(){this.dg.dgs.cellEditorCreated.emit({editorRef:this.componentRef,column:this.column,cellEditorRef:this})},t.prototype.ngOnDestroy=function(){this.dg.dgs.cellEditorDestory.emit({editorRef:this.componentRef,column:this.column,cellEditorRef:this}),this.componentRef&&this.componentRef.destroy(),this.componentRef=null,this.timer&&clearTimeout(this.timer)},t.prototype.createCellEditor=function(){var t=this,e=this.column.editor.type;if(this.dg.editors[e]){var i=this.resolver.resolveComponentFactory(this.dg.editors[e]);this.componentRef=this.container.createComponent(i),this.componentRef.instance.column=this.column,this.componentRef.instance.group=this.group,this.componentRef.instance.height=this.height,this.componentRef.instance.controlId=(this.dg.id||"DATAGRID_EDITOR")+"_"+this.column.field,this.updateControlValue(),this.componentRef.changeDetectorRef.markForCheck(),this.componentRef.changeDetectorRef.detectChanges(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.componentRef.instance.instance&&"lookup"===e&&(t.componentRef.instance.instance.changeDetector.destroyed||t.componentRef.instance.instance.changeDetector.detectChanges())})}else this.dg.writeConsole("找不到名称为 "+e+" 对应的类。","error")},t.prototype.updateControlValue=function(){this.group&&(this.group.bindingData=this.rowData,this.group.controls[this.column.field]&&this.group.controls[this.column.field].setValue(this.value,{emitEvent:!0}))},t.prototype.hideCover=function(){this.componentRef&&this.column.editor&&("combolist"===this.column.editor.type||"combo-lookup"===this.column.editor.type)&&this.componentRef.instance.hide(!1)},t.decorators=[{type:e.Directive,args:[{selector:"[cell-editor]"}]}],t.ctorParameters=function(){return[{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef},{type:e.ApplicationRef},{type:m.FormBuilder},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]}]},t.propDecorators={column:[{type:e.Input}],group:[{type:e.Input}],rowData:[{type:e.Input}],value:[{type:e.Input}],height:[{type:e.Input}]},t}(),Dt=function(){function t(t){this.sanitizer=t,this.dangerWords=["<script","onerror","alert("]}return t.prototype.transform=function(t,e){switch(e){case"html":return""===t||null===t||t===undefined?t:this.sanitizer.bypassSecurityTrustHtml(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(t);default:throw new Error("Invalid safe type specified: "+e)}},t.prototype.hasDanger=function(t){if("number"==typeof t||"boolean"==typeof t)return!1;var e=0;return this.dangerWords.forEach(function(i){t.indexOf(i)>-1&&e++}),0!==e},t.decorators=[{type:e.Pipe,args:[{name:"safe"}]}],t.ctorParameters=function(){return[{type:f.DomSanitizer}]},t}(),Tt=function(){function t(t,i,r,n,o,s,l){var a=this;this.dg=t,this.dr=i,this.el=r,this.cd=n,this.injector=o,this.colFormatSer=s,this.domSanitizer=l,this.cls="",this.lastColumn=!1,this._isEditing=!1,this.controlHeight="auto",this.isSelected=!1,this._cellEditorTemplate=null,this.cellClick=new e.EventEmitter,this.cellDblClick=new e.EventEmitter,this.cellContext={},this.cellStyler={},this.safePipe=null,this.ro=null,this.canEdit=function(){return a.dg.editable&&"cell"===a.dg.editMode&&a.column.editor},this.dfs=this.injector.get(Z),this.dgs=this.injector.get(J),this.safePipe=new Dt(this.domSanitizer),this.render=this.injector.get(e.Renderer2),this.cfr=this.injector.get(e.ComponentFactoryResolver)}return Object.defineProperty(t.prototype,"isEditing",{get:function(){return this._isEditing},set:function(t){var e=this;this._isEditing!==t&&(this._isEditing=t,t&&(this.dr.form&&Object.keys(this.dr.form.controls).length||this.dr.initFormControl(),this.column.editorTemplate&&this.column.editorTemplate.elementRef&&(this.cellContext.formGroup=this.dr.form,setTimeout(function(){if(e.el){var t=e.el.nativeElement.querySelector("input,textarea");t&&t.focus()}},10))),this.column.editor&&"textarea"===this.column.editor.type&&(this.dg.nowrap||(this.controlHeight=this.dr.el.nativeElement.offsetHeight)),this.cd.destroyed||this.cd.detectChanges())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellEditorTemplate",{get:function(){return this._cellEditorTemplate},set:function(t){this._cellEditorTemplate=t,t&&this.dg.dgs.cellEditorCreated.emit({editorRef:null,column:this.column,cellEditorRef:null,templateRef:t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.rowData&&this.column&&this.column.field?Y.getValue(this.column.field,this.rowData):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formControl",{get:function(){return this.cellEditor&&this.cellEditor.componentRef?this.cellEditor.componentRef.instance.formControl:this.column.editorTemplate?this.dr.form.get(this.column.field):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFormatterIsFn",{get:function(){return"function"==typeof this.column.formatter||"boolean"===this.column.formatter.type},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.initCellTemplateContext()},t.prototype.ngOnChanges=function(t){if(t.rowData&&!t.rowData.isFirstChange()&&(this.initCellTemplateContext(),this.buildCustomCellStyle(),this.formControl)){var e=Y.getValue(this.column.field,this.rowData);this.formControl.setValue(e)}},t.prototype.initCellTemplateContext=function(){this.cellContext={field:this.column.field,rowIndex:this.rowIndex,rowData:this.rowData,column:this.column,instance:this,formGroup:this.dr.form,tools:{utils:this.dg.commonUtils,format:this.dg.colFormatSer,number:this.dg.colFormatSer.numberhelper,date:this.dg.colFormatSer.datehelper}}},t.prototype.ngAfterViewInit=function(){this.buildCustomCellStyle();var t="cell-text-align__"+this.column.field.replace(/\./g,"_");this.render.addClass(this.cellContainer.nativeElement,t)},t.prototype.ngOnDestroy=function(){this.cellSubscription&&(this.cellSubscription.unsubscribe(),this.cellSubscription=null),this.rowUpdateSubscription&&(this.rowUpdateSubscription.unsubscribe(),this.rowUpdateSubscription=null),this.cellContext=null},t.prototype.buildCustomCellStyle=function(t){void 0===t&&(t=null);var e=this.el.nativeElement.parentNode,i=this.column.field.replace(/\./g,"_");e.id||(e.id="row_"+this.dr.rowId+"_"+this.rowIndex+"-"+i);var r="customcellcls_"+i+"_",n=function(){var t=Array.from(e.classList).find(function(t){return t.indexOf("customcellcls_")>-1});t&&e.classList.remove(t)};if(this.column.styler){var o=t||this.rowData,s=Y.getValue(this.column.field,o),l=this.column.styler(s,o,this.rowIndex);l&&Object.keys(l).length&&(n(),r+=this.dg.idService.encrypt(JSON.stringify(l)),this.render.addClass(e,r),this.dg.renderCustomStyle2(l,e,r))}else n()},t.prototype.updateValue=function(t){var e,i=this;if(this.dr.form){Y.setValue(this.column.field,t,this.rowData);var r=this.rowData[this.dg.idField],n=this.dg.data.find(function(t){return t[i.dg.idField]===r});n&&Y.setValue(this.column.field,t,n),this.dfs.updateCheckedData(r,((e={})[this.column.field]=t,e)),this.cd.destroyed||this.cd.detectChanges()}},t.decorators=[{type:e.Component,args:[{selector:"grid-body-cell",template:'\n    <div\n     [cell-tooltip]="column.showTips && !isEditing"   [attr.tipMode]=" column.tipMode || \'auto\'"\n     [attr.message]="column | tipmsg: rowData"  [attr.position]=" column?.tipOptions?.position || \'top-left\'"\n     [attr.tipWidth]="column?.tipOptions?.width" [attr.tipHeight]="column?.tipOptions?.height"\n     class="f-datagrid-cell-content" #cellContainer  [component-template]="column" [ctx]="cellContext"\n    >\n        <ng-container *ngIf="!isEditing && !column.template && !column.componentType">\n            <ng-container *ngIf="column.formatter">\n                <span class="cell-text-box" *ngIf="cellFormatterIsFn" [innerHtml]=" column | formatCellData: rowData | safe: \'html\'"></span>\n                <span class="cell-text-box" *ngIf="!cellFormatterIsFn">{{  column | formatCellData: rowData }}</span>\n            </ng-container>\n            <span *ngIf="!column.formatter" class="cell-text-box" [class.grid-cell-nowrap]="dg.nowrap" [class.grid-cell-wrap]="!dg.nowrap">{{  column | formatCellData: rowData }}</span>\n        </ng-container>\n\n        <ng-container #cellTemplate *ngIf="!isEditing && column.template && !column.componentType" [ngTemplateOutlet]="column.template" [ngTemplateOutletContext]="{$implicit: cellContext}"></ng-container>\n        <ng-container #cellEditorTemplate *ngIf="isEditing && column.editorTemplate" [ngTemplateOutlet]="column.editorTemplate" [ngTemplateOutletContext]="{$implicit: cellContext}"></ng-container>\n        <ng-container #editorTemplate *ngIf="isEditing && !column.editorTemplate" cell-editor [height]="controlHeight" [rowData]="rowData" [value]="value" [column]="column" [group]="dr.form"></ng-container>\n    </div>\n    ',changeDetection:e.ChangeDetectionStrategy.Default}]}],t.ctorParameters=function(){return[{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:Ft,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return Ft})]}]},{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:e.Injector},{type:g.ColumnFormatService},{type:f.DomSanitizer}]},t.propDecorators={width:[{type:e.Input}],height:[{type:e.Input}],cls:[{type:e.Input}],column:[{type:e.Input}],rowData:[{type:e.Input}],rowIndex:[{type:e.Input}],lastColumn:[{type:e.Input}],isEditing:[{type:e.Input}],isSelected:[{type:e.Input}],cellContainer:[{type:e.ViewChild,args:["cellContainer"]}],cellTemplateVcr:[{type:e.ViewChild,args:["cellTemplate",{read:e.ViewContainerRef}]}],cellEditorTemplate:[{type:e.ViewChild,args:["cellEditorTemplate",{read:e.ViewContainerRef}]}],cellEditor:[{type:e.ViewChild,args:[_t]}],cellClick:[{type:e.Output}],cellDblClick:[{type:e.Output}]},t}(),Ot=function(){function t(t,e,i,o,s){var l=this;this.injector=t,this.el=e,this.render=i,this.dg=o,this.ngZone=s,this.cellEditorCreatedSubscription=null,this.cellEditorDestorySubscription=null,this.destroy$=new r.Subject,this.validMessageEle=null,this.dgb=this.injector.get(It),this.dr=this.injector.get(Ft),this.dfs=this.injector.get(Z),this.dgs=this.injector.get(J),this.cellEditorCreatedSubscription||(this.cellEditorCreatedSubscription=this.dgs.cellEditorCreated.pipe(n.takeUntil(this.destroy$)).pipe(n.filter(function(t){var e=t.column;t.editorRef,t.cellEditorRef,t.templateRef;return e.field===l.column.field&&l.dg.selectedRow.id===l.dr.rowId})).subscribe(function(t){var e=t.editorRef,i=t.cellEditorRef,r=t.templateRef;e?(l.editor=e.instance,l.formControl=l.editor.formControl,l.cellEditorRef=i,l.emitBeginEdit()):(l.formControl=l.dr.form.get(l.column.field),l.bindEditorInputEvent(),l.dg.beginEdit.emit({editor:null,column:l.column,rowData:l.rowData,gridInstance:l.dg,template:r})),l.dg.rowClick.emit({data:l.rowData,grid:l.dg,dblclick:!1})})),this.dg.dgs.cellEditorDestory.pipe(n.takeUntil(this.destroy$)).pipe(n.filter(function(t){var e=t.column;return l.dg.selectedRow&&e.field===l.column.field&&l.dg.selectedRow.id===l.dr.rowId})).subscribe(function(t){"cell"===l.dg.editMode&&(l.dg.selectedRow.editors=[],l.dg.currentCell&&(l.dg.currentCell.editor=null,l.dg.currentCell.cellEditorRef=null)),l.unBindEditorInputEvent(),l.cellEditorRef=null,l.formControl=null,l.editor=null,l.removeValidMessage()})}return t.prototype.ngOnInit=function(){},t.prototype.ngOnChanges=function(t){t.rowData&&!t.rowData.isFirstChange()&&(this.initCellEvent(),this.setCellClsWithEditorType())},t.prototype.ngAfterViewInit=function(){this.initCellEvent(),this.setCellClsWithEditorType()},t.prototype.runZoneClick=function(t){this.zoneClick&&(Object.assign(t,{rowData:this.rowData}),this.zoneClick.forEach(function(e){e.target.style.pointerEvents="auto",e.callback?e.callback(t):e.handler&&e.handler(t)}),this.dg.isFF&&(t.target.__zone_symbol__clickfalse=this.zoneClick))},t.prototype.initCellEvent=function(){var t=this;this.column&&(this.column.editor||this.column.editorTemplate)?(this.dg.clickToEdit||(this.celldblclick=this.render.listen(this.el.nativeElement,"dblclick",function(e){t.onDblClickCell(e)})),this.el.nativeElement.edit=function(e){t.closeEditingCell().subscribe(function(i){i&&(t.onClickCell(e),t.dg.selectedRow&&t.dg.selectedRow.id===t.dr.rowId||t.dg.selectRow(t.dr.rowId,!0,!1),t.runZoneClick(e))})},this.el.nativeElement.editCell=function(e){t.openCellEditor()}):this.clickTimer=0;this.column.proxyClick===undefined&&(this.column.proxyClick=!0),this.column.template&&this.column.proxyClick&&(this._tdmousedown_&&(this.el.nativeElement.removeEventListener("mousedown",this._tdmousedown_,!0),this._tdmousedown_=null),this.el.nativeElement.addEventListener("mousedown",this._tdmousedown_=function(e){(function(t){return!("GRID-BODY-CELL"===t.target.parentElement.nodeName||"INPUT"===t.target.nodeName||"TEXTAREA"===t.target.nodeName||t.target.className.indexOf("custom-control-label")>-1&&t.target.parentElement&&t.target.parentElement.className.indexOf("custom-control")>-1||t.target.closest("input-group")||t.target.closest("farris-switch")||t.target.closest("farris-number-spinner")||t.target.closest("farris-datepicker")||t.target.closest("farris-time-picker")||t.target.closest("grid-editor-textarea")||t.target.closest("farris-checkboxgroup")||t.target.closest("grid-editor-checkbox")||t.target.closest("farris-radiogroup")||t.target.closest("farris-organization-selector")||t.target.closest("farris-personnel-selector"))})(e)&&(t.zoneClick=e.target.__zone_symbol__clickfalse||e.target.__zone_symbol__ANGULARclickFALSE,t.zoneClick&&t.zoneClick.length&&(t.dg.isFF?(e.target.__zone_symbol__clickfalse&&delete e.target.__zone_symbol__clickfalse,e.target.__zone_symbol__ANGULARclickFALSE&&delete e.target.__zone_symbol__ANGULARclickFALSE):e.target.style.pointerEvents="none",t.zoneClick.forEach(function(t){t.target||(t.target=e.target)})))},!0)),this.el.nativeElement.gridCellData={rowData:this.rowData,rowIndex:this.dr.rowIndex},this.el.nativeElement.closeEdit=function(){return t.closeEditingCell()},this.el.nativeElement.selectCell=function(e,i){if(!t.dg.disableRow||!t.dg.disableRow(t.rowData,t.dr.rowIndex)){var o={rowIndex:t.dr.rowIndex,rowData:t.rowData,gridInstance:t.dg};if(t.dg.sms.beforRowClick(x({},o,{e:e,id:t.dr.rowId,dr:t.dr,cellref:t})))return t.selectCell(t.column.field,i),t.dg.currentCell?t.dg.currentCell.rowData||(t.dg.currentCell.rowData=t.rowData):t.dg.currentCell={rowData:t.rowData},void t.dg.cellClick.emit({column:t.column,rowData:t.rowData,gridInstance:t.dg,event:e});if(t.dfs.isRowSelected(t.dr.rowId))t.dg.keepSelect||t.column.template?(t.dg.rowClick.emit({data:t.rowData,grid:t.dg,dblclick:!1}),t.dg.currentCell||(t.selectCell(t.column.field,i),t.dg.currentCell?t.dg.currentCell.rowData||(t.dg.currentCell.rowData=t.rowData):t.dg.currentCell={rowData:t.rowData}),t.zoneClick&&t.runZoneClick(e),t.dg.cellClick.emit({column:t.column,rowData:t.rowData,gridInstance:t.dg,event:e})):(t.dg.currentCell&&t.dg.currentCell.cellElement&&t.dg.currentCell.cellElement.id===i.id&&t.dg.cancelSelectCell(),t.dg.beforeUnselect(o).pipe(n.takeUntil(t.destroy$)).subscribe(function(e){if(e){t.dfs.unSelectRow(t.dr.rowIndex,t.rowData,{instance:t.dg});var i=t.el.nativeElement.className;i.indexOf("f-datagrid-row-selected")>-1&&(t.el.nativeElement.className=i.replace("f-datagrid-row-selected",""))}t.dg.rowClick.emit({data:t.rowData,grid:t.dg,dblclick:!1}),t.dg.dgs.setSelecedRow.emit()}));else{var s=r.of(!0);if(t.dg.beforeSelect){var l=t.dg.beforeSelect({rowIndex:t.dr.rowIndex,rowData:t.rowData,gridInstance:t.dg});l&&l.subscribe&&(s=l)}var a=t.zoneClick,d=a&&a.length?100:0;s.pipe(n.debounceTime(d)).subscribe(function(r){r&&(t.selectCell(t.column.field,i),t.dg.cellClick.emit({column:t.column,rowData:t.rowData,gridInstance:t.dg,event:e}),d&&t.runZoneClick(e)),t.dg.rowClick.emit({data:t.rowData,grid:t.dg,dblclick:!1}),t.dg.dgs.setSelecedRow.emit()})}}},this.el.nativeElement.cancelSelected=function(){t.render.removeClass(t.el.nativeElement,j),t.render.removeClass(t.el.nativeElement,M)}},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.cellclick&&this.cellclick(),this.celldblclick&&this.celldblclick(),this.unBindEditorInputEvent(),this.bindCellEventSubscription&&(this.bindCellEventSubscription.unsubscribe(),this.bindCellEventSubscription=null),this.cellEditorCreatedSubscription&&(this.cellEditorCreatedSubscription.unsubscribe(),this.cellEditorCreatedSubscription=null),this.cellEditorDestorySubscription&&(this.cellEditorDestorySubscription.unsubscribe(),this.cellEditorDestorySubscription=null),this.editor=null,this.cellEditorRef=null,this.formControl=null,this.el&&(this.el.nativeElement.cancelSelected=r.noop,this.el.nativeElement.selectCell=r.noop,this.el.nativeElement.closeEdit=r.noop,this.el.nativeElement.gridCellData=r.noop,this.el.nativeElement.edit=r.noop,this.el.nativeElement.selectCell=r.noop,this._tdmousedown_&&(this.el.nativeElement.removeEventListener("mousedown",this._tdmousedown_,!0),this._tdmousedown_=null),this.el=null)},t.prototype.isDifferentCell=function(){return!this.dg.currentCell||(!this.dg.selectedRow||this.dg.selectedRow.index!==this.dr.rowIndex||(this.dr.rowIndex!==this.dg.currentCell.rowIndex||this.dg.currentCell.field!==this.column.field))},t.prototype.onClickCell=function(t){var e=this;if(document.body.click(),this.dg.beforeClickCell.emit({rowIndex:this.dr.rowIndex,rowData:this.rowData,column:this.column,gridInstance:this.dg}),!this.dr.disabled&&!this.dg.disabled)return!this.dg.editable||this.isReadonly()?(this.dg.enableHighlightCell&&(t.stopPropagation(),this.dg.endEditing(),this.selectCell(this.column.field)),void this.dg.rowClick.emit({data:this.rowData,grid:this.dg,dblclick:!1})):void("row"!==this.dg.editMode&&("default"===this.dg.selectionMode&&t&&(t.ctrlKey||t.shiftKey)||(t.stopPropagation(),"INPUT"!==t.target.nodeName&&(this.render.addClass(this.dg.el.nativeElement,"f-datagrid-unselect"),!this.dg.isSingleClick&&this.dg.editMode&&(this.dg.isSingleClick=!0,this.clickTimer&&clearTimeout(this.clickTimer),this.clickTimer=setTimeout(function(){e.dg.isSingleClick&&e.dg.editable&&"cell"===e.dg.editMode&&(e.dg.isSingleClick=!1,clearTimeout(e.clickTimer),e.closeEditingCell().pipe(n.takeUntil(e.destroy$)).subscribe(function(i){i&&(e.dg.clickToEdit?(!e.dg.nowrap&&e.dgb.updateRowHeight(),e.openCellEditor()):e.selectCell(e.column.field),e.render.removeClass(e.dg.el.nativeElement,"f-datagrid-unselect"),t.preventDefault())}))},this.dg.clickDelay))))))},t.prototype.onDblClickCell=function(t){var e=this;this.dg.disabled||this.isReadonly()||"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&this.dg.editable&&"cell"===this.dg.editMode&&(this.clickTimer&&(this.dg.isSingleClick=!1,clearTimeout(this.clickTimer),this.clickTimer=null),this.closeEditingCell().pipe(n.takeUntil(this.destroy$)).subscribe(function(t){t&&setTimeout(function(){e.openCellEditor()})}))},t.prototype.isReadonly=function(t){return void 0===t&&(t=this.column),!this.dg.editable||(!!(this.dg.mergeCell&&this.dg.mergeFields.indexOf(t.field)>-1)||this.getReadonlyValue(t))},t.prototype.getReadonlyValue=function(t){if(void 0===t&&(t=this.column),t.readonly!==undefined){if("boolean"==typeof t.readonly)return t.readonly;if("function"==typeof t.readonly)return t.readonly(this.rowData)}return!1},t.prototype.openCellEditor=function(){var t=this;if(!this.dr.disabled){if(!this.column.editor&&!this.column.editorTemplate||!this.dg.editable||this.isReadonly())return"default"===this.dg.selectionMode&&this.dg.multiSelect&&this.dg.clearCheckeds(),void this.selectCell(this.column.field);var e=this.dg.beforeEdit({rowIndex:this.dr.rowIndex,rowData:this.rowData,column:this.column,gridInstance:this.dg});e&&e.subscribe?(this.dg.currentCell&&(this.dg.currentCell.cellRef&&this.dg.currentCell.cellRef.column.field===this.column.field||(this.dg.currentCell.cellRef=this.dc)),e.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){e?(t.isDifferentCell()&&("default"===t.dg.selectionMode&&t.dg.multiSelect&&t.dg.clearCheckeds(),t.selectCell(t.column.field)),t.dfs.editCell()):(t.selectCell(t.column.field),t.dg.rowClick.emit({data:t.rowData,grid:t.dg,dblclick:!1}))})):this.dg.writeConsole("please return an Observable Type.")}},t.prototype.emitBeginEdit=function(){var t=this,e=this.cellEditorRef||this.dc.cellEditor;this.render.removeClass(this.dg.el.nativeElement,"f-datagrid-unselect"),"cell"===this.dg.editMode&&(this.dg.selectedRow.editors=[this.editor],this.dg.currentCell.editor=this.editor,this.dg.currentCell.cellEditorRef=e,this.bindEditorInputEvent(),this.render.addClass(this.el.nativeElement,M),this.dg.beginEdit.emit({editor:e,column:this.column,rowData:this.rowData,gridInstance:this.dg}),"textarea"===this.column.editor.type&&this.column.editor.options&&"dialog"===this.column.editor.options.editType&&this.editor.showDialog()),this.dr&&!this.dg.nowrap&&setTimeout(function(){t.dr.updateRowHeight()}),this.editor&&(this.validMessageEle=this.showValidMessage())},t.prototype.removeValidMessage=function(){this.validMessageEle&&(this.validMessageEle.remove(),this.validMessageEle=null,this.dg.formValidations&&delete this.dg.formValidations[this.column.field])},t.prototype.showValidMessage=function(){if(this.dg.formValidations&&this.dg.formValidations[this.column.field]){var t=this.dg.formValidations[this.column.field],e=t.isValid,i=t.message;if(!e&&i){var r=this.editor.el.nativeElement.closest("tr"),n=this.editor.el.nativeElement.closest("td"),o=this.editor.el.nativeElement.closest(".f-datagrid-table"),s=document.createElement("div"),l=document.createElement("span");s.appendChild(l),l.innerText=i,s.style.position="absolute",s.style.background="#FDEFEF",s.style.color="#F46160";var a=r.offsetTop-21;return"0"==r.getAttribute("index")&&(a=r.offsetHeight),s.style.top=a+"px",s.style.left=n.offsetLeft+5+"px",s.style.zIndex="996",s.style.padding="0.1875rem 0.5rem",s.style.fontSize=".8125rem",s.style.lineHeight="14px",o.append(s),s}return null}},t.prototype.closeEditingCell=function(){var t=this;if(!this.dg.isCellEditing())return r.of(!0);var e=null,i=null;if(!this.dg.currentCell)return r.of(!0);if(e=this.dg.currentCell.cellRef){if(!e.isEditing)return r.of(!0);if(e.cellEditor&&e.cellEditor.componentRef&&!e.column.editorTemplate){if(!(i=e.cellEditor.componentRef.instance))return r.of(!0);if(i.inputElement){var o=i.inputElement.nodeName,s=i.options&&i.options.onBlur;s&&("INPUT"!==o&&"TEXTAREA"!==o||this.dg.focusElement!==i.inputElement||s({editorRef:i,rowData:e.rowData})),i.inputElement.blur&&i.inputElement.blur(),this.dg.focusElement=null}if(i.blur&&i.blur(),i.pending)return r.of(!1);if(!i.formControl)return r.of(!0);if(i.formControl.pending)return r.of(!1);if(i.formControl&&i.formControl.invalid&&!this.dg.endEditByInvalid)return r.of(!1)}}this.dg.isSingleClick=!1;var l=(i||e).column,a=this.dg.afterEdit(e.rowIndex,e.rowData,l,i);if(!a||!a.subscribe)return this.dg.writeConsole("please return an Observable Type."),r.of(undefined);var d=new r.Subject;return a.pipe(n.takeUntil(this.destroy$)).subscribe(function(r){if(r){var n=e.value===undefined?"":e.value;e&&e.formControl&&e.formControl.value!==undefined&&n!==e.formControl.value&&(n=e.formControl.value,e.isEditing=!1,e.updateValue(n)),t.dfs.endEditCell(),t.dgs.onEndCellEdit(t.dfs.getCurrentCell()),t.unBindEditorInputEvent(),t.render.removeClass(t.el.nativeElement,M),t.dg.selectedRow&&(t.dg.selectedRow.editors=[]);var o=t.dfs.primaryId(e.rowData);t.dfs.rowUpdate$.next({index:e.rowIndex,data:e.rowData,cellRef:e,keyID:o}),t.dg.showFooter&&t.dgs.refreshFooterData.emit(),t.dg.selectedRow&&t.dg.selectedRow.dr&&t.dg.selectedRow.dr.refresh(),t.ENDEDIT_TIMER&&clearTimeout(t.ENDEDIT_TIMER);var s=e.rowIndex,a=e.rowData;t.ENDEDIT_TIMER=setTimeout(function(){t.dg.endEdit.emit({rowIndex:s,rowData:a,column:l,value:n}),d.next(!0)},100)}else e&&e.cellEditor&&e.cellEditor.componentRef&&e.cellEditor.componentRef.instance?((i=e.cellEditor.componentRef.instance).inputElement.focus(),d.next(!1)):d.next(!0)}),d.asObservable()},t.prototype.cancelCellEditing=function(){this.dg.currentCell&&this.dg.currentCell.isEditing&&this.dg.selectedRow.index>-1&&(this.dc.rowData=this.dg.selectedRow.data,this.formControl.reset(Y.getValue(this.column.field,this.dc.rowData)),this.closeEditingCell())},t.prototype.bindEditorInputEvent=function(){var t=this,e=this.cellEditorRef||this.dc.cellEditor,i=null;e?i=e.componentRef.instance.inputElement:this.column.editorTemplate&&(i=this.dc.el.nativeElement.querySelector("input,textarea")),i&&(i.focus(),this.dg.selectOnEditing&&this.column.editorTemplate&&setTimeout(function(){i.select&&i.select()}),this.editorInputKeydownEvent=this.render.listen(i,"keydown",function(e){t.onKeyDownForInput(e)}))},t.prototype.unBindEditorInputEvent=function(){this.editorInputKeydownEvent&&(this.editorInputKeydownEvent(),this.editorInputKeydownEvent=null)},t.prototype.findLastEditCell=function(){for(var t=this.dg.colGroup.columns.length-1,e=null;t>=0;){var i=this.dg.colGroup.columns[t];if(i.editor||i.editorTemplate){e=i;break}t--}return e},t.prototype.onKeyDownForInput=function(t){var e=this,i=t.keyCode;if(!t.altKey&&!t.ctrlKey)switch((this.editor&&this.editor.stopPropagation||13===i||this.column.editorTemplate)&&t.stopPropagation(),i){case 32:"switch"===this.column.editor.type&&(t.preventDefault(),this.editor.instance.updateChecked(t,!1));break;case 13:this.closeEditingCell().pipe(n.takeUntil(this.destroy$)).pipe(n.debounceTime(100)).subscribe(function(i){if(i){e.dg.dgContainer.nativeElement.focus();var r=e.findLastEditCell(),n={gird:e.dg,cell:e.dg.currentCell,event:t,lastCell:r.field===e.column.field};if(e.column.onEnterHandler)e.column.onEnterHandler(n);else{var o=e.dg.findNextCell(e.column.field,"right");!e.dg.currentCell.lastRow||o&&r.field!==e.column.field||e.dg.lastCellEnterHandler.emit(n)}}});break;case 27:this.cancelCellEditing();break;case 9:t.stopPropagation(),this.dg.clickDelay=0,t.shiftKey?this.closeEditingCell().pipe(n.takeUntil(this.destroy$)).subscribe(function(t){t&&e.movePrevCellAndEdit()}):(this.closeEditingCell().pipe(n.takeUntil(this.destroy$)).subscribe(function(i){i&&e.moveNextCellAndEdit(t)}),t.preventDefault());break;case 40:"textbox"===this.column.editor.type&&(this.closeEditingCell().pipe(n.takeUntil(this.destroy$)).subscribe(function(t){t&&e.selectNextRowAndEditCell(e.column.field,"down")}),t.preventDefault());break;case 38:"textbox"===this.column.editor.type&&(this.closeEditingCell().pipe(n.takeUntil(this.destroy$)).subscribe(function(t){t&&e.selectNextRowAndEditCell(e.column.field,"up")}),t.preventDefault())}},t.prototype.selectCell=function(t,e){var i=this;this.closeEditingCell().subscribe(function(r){r&&(e=e||i.el.nativeElement,i.clearCellSelectedClass(),t&&t!==i.dg.ControlPanelFeild&&-1===t.indexOf("farris-datagrid-column")&&i.render.addClass(e,j),i.dfs.setCurrentCell(i.dr,t,e,i.dc),i.dg.fast||"left"===i.column.fixed||"right"===i.column.fixed||i.moveScrollbar(e))})},t.prototype.moveScrollbar=function(t){var e=t.offsetLeft+t.offsetWidth,i=this.dg.width-this.dgb.columnsGroup.leftFixedWidth-this.dgb.columnsGroup.rightFixedWidth,r=t.getBoundingClientRect(),n=this.dgb.ps.elementRef.nativeElement,o=n.getBoundingClientRect(),s=n.scrollTop,l=n.scrollLeft,a=this.dgb.ps.elementRef.nativeElement.scrollLeft;if(e>i){var d=e-i+2;d>a&&this.dgb.ps.scrollToX(d)}else t.offsetLeft<l&&this.dgb.ps.scrollToX(t.offsetLeft);var c=r.top-o.top+r.height;if(c>o.height){var h=c-o.height;this.dgb.ps.scrollToY(s+h)}else r.y<o.y&&this.dgb.ps.scrollToY(s-(o.y-r.y))},t.prototype.moveNextCellAndEdit=function(t){var e=this,i=this.dg.colGroup.columns.findIndex(function(t){return t.id&&t.id===e.column.id||t.field===e.column.field});if(i+1<this.dgb.columnsGroup.columns.length){var r=this.dgb.columnsGroup.columns[i+1],n=this.dg.findNextTd(r);if(!n||r.fixed&&"center"!==r.fixed||this.moveScrollbar(n),r&&(!r.editor&&!r.editorTemplate||this.isReadonly(r)))return void(n&&n.selectCell(t,n));n&&(n.focus(),(r.editor||r.editorTemplate)&&(n.editCell(),this.dgs.onCellEdit(n)))}else{var o=this.dg.currentCell.cellElement.parentElement.nextElementSibling;if(o&&"TR"===o.tagName){for(var s=!1,l=0;!s;)(s=!!o.children[l].editCell)||l++;"default"===this.dg.selectionMode&&this.dg.clearCheckeds(),o.children[l].editCell()}}},t.prototype.movePrevCellAndEdit=function(){var t=this.dfs.getColumnIndex(this.column.field);if(t-1>=0){var e=this.dgb.columnsGroup.normalColumns[t-1];if(e&&this.isReadonly(e))return;var i=this.dg.currentCell.cellElement.previousElementSibling;i&&(i.focus(),e.editor&&(i.click(),this.dgs.onCellEdit(i)))}},t.prototype.selectNextRowAndEditCell=function(t,e){if(this.dg.currentCell){var i="down"===e?"nextElementSibling":"previousElementSibling",r=this.dg.currentCell.cellElement.parentElement[i];if(r&&"TR"===r.tagName){var n=Array.from(r.children).find(function(e){return e.getAttribute("field")==t});n&&n.editCell&&("default"===this.dg.selectionMode&&this.dg.clearCheckeds(),n.editCell())}}else this.dg.writeConsole("当前选中单元格为空")},t.prototype.clearCellSelectedClass=function(){this.dg.removeCellSelectedCls()},t.prototype.setCellClsWithEditorType=function(){if(this.dg.currentCell&&this.dg.enableHighlightCell&&(this.dg.currentCell.field!==this.column.field||this.dg.currentCell.rowId!==this.rowData[this.dg.idField]||this.dc.isEditing||(this.clearCellSelectedClass(),this.render.addClass(this.el.nativeElement,j))),this.dg.enableEditCellStyle){var t=this.el.nativeElement;if(this.cleanOtherEditorIcon(t),!this.dr.disabled&&this.column.editor&&!this.isReadonly()){var e=this.column.editor.type,i="right"===this.column.align?"allow-edit-cell-left":"allow-edit-cell";this.render.addClass(t,i),this.render.addClass(t,N[e])}}},t.prototype.cleanOtherEditorIcon=function(t){Object.values(N).forEach(function(e){t.className.indexOf(e)>-1&&(t.className=t.className.replace("allow-edit-cell-left","").replace("allow-edit-cell",""),t.className=t.className.replace(e,""))})},t.decorators=[{type:e.Directive,args:[{selector:"[cell-editable]",exportAs:"cellEditable"}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ElementRef},{type:e.Renderer2},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:e.NgZone}]},t.propDecorators={rowData:[{type:e.Input,args:["cell-editable"]}],column:[{type:e.Input}],dc:[{type:e.ContentChild,args:[Tt]}]},t}(),Ht=function(){function t(t,e,i,n,o,s){this.cd=t,this.dg=e,this.dgb=i,this.el=n,this.injector=o,this.ngZone=s,this.fixedRight=!1,this.hasFixedColumns=!1,this.isGroupRow=W,this.groupRow=$,this.isGroupFooter=B,this.visible=U,this.groupLevelField=X,this.filterConditions="",this.checkedRows=[],this.ro=null,this.subscriptions=[],this.destroy$=new r.Subject}return Object.defineProperty(t.prototype,"groupSummaryDataInGroupRow",{get:function(){return"inGroupRow"===this.dg.groupSummaryPosition},enumerable:!0,configurable:!0}),t.prototype.listenEvent=function(){var t=this,e=this.dg.dgs.setSelecedRow.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.detectChanges()});this.subscriptions.push(e);var i=this.dg.dfs.rowAppend$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.detectChanges()});this.subscriptions.push(i);var r=this.dg.dfs.rowUpdate$.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){if(e&&t.dg.groupRows&&t.dg.groupFooter&&t.dg.groupField){var i=e.data[t.groupRow];if(i===undefined){var r=t.dg.getRows().find(function(i){return i.id===t.dg.dfs.primaryId(e.data)});r&&(i=t.dg.commonUtils.getValue(t.groupRow,r))}""!==i&&null!==i?t.dg.dfs.updateGroupFooter(i):t.dg.writeConsole("未获取到groupRowId。","error")}});this.subscriptions.push(r),this.scrollToCurrentRowSubscription=this.dg.dgs.scrollToCurrentRow.pipe(n.delay(50)).subscribe(function(){t.scrollToFirstSelectedRow();var e=t.dg.dfs.getState().scrollInfo;t.dg.scrollInstance.scrollToLeft(),t.dg.enableFilterRow&&e&&e.x&&t.dg.dgs.closeFilterPanel.emit()}),this.dg.dfs.checkRow$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.checkedRows=t.dg.dfs.getCheckeds(),t.detectChanges()}),this.dg.dfs.clearCheckeds$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.checkedRows=t.dg.dfs.getCheckeds(),t.detectChanges()}),this.dg.dgs.toggleGroupRow$.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){var i=e.expand,r=e.groupRowIndex;t._toggleGroupRow(r,i),setTimeout(function(){t.dgb.ps&&t.dgb.ps.update()},10)}),this.dg.dgs.toggleAllGroupRows$.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){var i=e.expand;t.toggleAllGroupRows(i),setTimeout(function(){t.dgb.ps&&t.dgb.ps.update()},10)})},t.prototype.ngOnInit=function(){this.listenEvent()},t.prototype.ngOnDestroy=function(){this.unSubscriptions()},t.prototype._toggleGroupRow=function(t,e){if(void 0===e&&(e=!0),t>-1){var i=this.dg.getRows(),r=i.filter(function(t){return t[W]})[t];r||(r=i[t]),r&&this.toggleGroupRow(r,t,e)}},t.prototype.toggleAllGroupRows=function(t){var e=this;void 0===t&&(t=!0),this.data.filter(function(t){return t[W]}).forEach(function(i){i.expanded=t,e.dg.dfs.setGroupRowsVisible(i,t,!1)}),this.cd.detectChanges(),t?this.dg.dfs.expandGroupRow.emit():this.dg.dfs.collapseGroupRow.emit()},t.prototype.unSubscriptions=function(){this.destroy$.next(),this.destroy$.complete(),this.scrollToCurrentRowSubscription&&(this.scrollToCurrentRowSubscription.unsubscribe(),this.scrollToCurrentRowSubscription=null),this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe}),this.subscriptions=[])},t.prototype.ngAfterViewInit=function(){var t=this;this.ngZone.runOutsideAngular(function(){setTimeout(function(){t.dg.nowrap||t.dg.calculateGridSize()},100)})},t.prototype.getGroupColumn=function(t){return this.dg.flatColumns.find(function(e){return e.field===t})},t.prototype.detectChanges=function(){this.cd.destroyed||this.cd.detectChanges()},t.prototype.trackByField=function(t,e){return e.field},t.prototype.isElementInViewport=function(t){var e=this.dgb.ps.instance.element.getBoundingClientRect(),i=t.getBoundingClientRect(),r=i.top<=e.height+e.top,n=i.bottom<=e.bottom;return r&&n},t.prototype._elementIntoView=function(t,e){if(t)t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded(!1):t.scrollIntoView({block:"nearest",inline:"nearest"});else{var i=e*this.dg.rowHeight;i&&this.dg.scrollInstance.scrollToY(i)}},t.prototype.scrollToFirstSelectedRow=function(){if(this.dg.selectedRow){var t=this.dg.selectedRow.index,e="row_"+this.dg.selectedRow.id,i=Y.getTrDomById(e,document);if(0===t&&this.dgb.ps&&this.dgb.ps.instance)return 0===this.dgb.ps.instance.element.scrollTop?void 0:void this.dg.scrollInstance.scrollToY(0);var r=this.dgb.getVisibleRange(),n=r.top,o=r.bottom;if(t===n||t===o)return void this._elementIntoView(i,t);if(t>n&&t<o&&i&&this.isElementInViewport(i))return;this._elementIntoView(i,t)}},t.prototype.toggleGroupRow=function(t,e,i,r){r&&r.stopPropagation(),t.expanded=i,this.dg.dfs.setGroupRowsVisible(t,i)},t.prototype.mergeInfo=function(t,e){return this.dg.dgs.getMergeInfo(e,t,this.dg.mergeCellInfo)},t.prototype.showCell=function(t,e){var i=this.mergeInfo(t.field,e),r=!0;return i&&(r=i.show),r},t.prototype.getRowSpan=function(t,e){var i=this.mergeInfo(t.field,e);return i&&this.showCell(t,e)?(t.readonly=!0,i.rowspan):1},t.prototype.getGroupSummaryData=function(t){var e=this.dg.getRows();if(e&&e.length){var i=this.dg.getRows().find(function(e){return e.__group_parent_id__===t&&e.__group_footer__});if(i)return i.data}return null},t.decorators=[{type:e.Component,args:[{selector:"datagrid-rows",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:07\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-19 20:34:12\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\x3c!-- [class.f-datagrid-row-hover]="dg.rowHover && dgb.hoverRowIndex === hoverRow.rowIndex" \r\n        [class.f-datagrid-row-odd]="odd && dg.striped"\r\n        [class.f-datagrid-row-even]="!odd && dg.striped"\r\n--\x3e\r\n\r\n<ng-template #grouprowControl let-ctx>\r\n    <div class="d-flex flex-row" style="align-items: center; white-space: nowrap;">\r\n        <span class="f-icon f-datagrid-group-expanded ml-1 mr-1" *ngIf="!ctx.row.expanded" (click)="toggleGroupRow(ctx.row, ctx.index, true, $event)"></span>\r\n        <span class="f-icon f-datagrid-group-collapsed ml-1 mr-1" *ngIf="ctx.row.expanded" (click)="toggleGroupRow(ctx.row, ctx.index, false, $event)"></span>\r\n        <span class="f-utils-fill group-row-text" *ngIf="dg.groupFormatter" [innerHTML]="ctx.row | formatGroupRow: \'\': dg.groupFormatter| safe: \'html\' "></span>\r\n        <span class="f-utils-fill group-row-text" *ngIf="!dg.groupFormatter"> {{ ctx.row | formatGroupRow: getGroupColumn(ctx.row.field)  }} </span>\r\n    </div>\r\n</ng-template>\r\n\r\n<table #tableEl style="border:0; width: 100%" class="f-datagrid-rows" cellpadding=0 cellspacing="0" row-hover row-dblclick\r\n[ngStyle]="fixedRight && width ? { width: width +\'px\' }: {}">\r\n    <colgroup>\r\n        <col width="36px" *ngIf="dg.showCheckbox && dg.fast">\r\n        <col [width]="dg?.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber && dg.fast">\r\n        <col *ngFor="let col of columns" [width]="col.width + \'px\'" />\r\n    </colgroup>\r\n\r\n    <tbody *ngIf="dg.groupRows && dg.groupField" id="{{\'row-group-tbody_\'+ dg.id}}" >\r\n        <ng-container *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n            <tr *ngIf="row[isGroupRow]" class="f-datagrid-body-row f-datagrid-group-row" [style.display]="row[visible] ? \'\': \'none\'" [group-row]="row" [attr.group-index]="i" [attr.expand]="row.expanded || true" [attr.id]="row | rowDataId: false:false: true">\r\n                <td *ngIf="dg.showCheckbox && dg.fast" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center; left: 0"\r\n                    [class.f-datagrid-fast__fixed-left]="dg.fast" [class.l-shadow-col]="dg.fast && !dg.showLineNumber && !hasFixedColumns">\r\n                    <div class="f-datagrid-cell-content checkbox-column" style="text-overflow: unset;">\r\n                        <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow" [rowData]="row"\r\n                            [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                    </div>\r\n                </td>\r\n        \r\n                <td *ngIf="dg.showLineNumber && dg.fast" [style.width.px]="dg.lineNumberWidth"  class="f-datagrid-cell f-datagrid-cell-rownumber"\r\n                    [class.f-datagrid-fast__fixed-left]="dg.fast"  [style.left.px]="dg.showCheckbox ? 36: 0" [class.l-shadow-col]="dg.fast && !hasFixedColumns">\r\n                    <div class="f-datagrid-cell-content">\r\n                        {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + i + 1 }}\r\n                    </div>\r\n                </td>\r\n\r\n\r\n                <td *ngIf="!fixedRight && !groupSummaryDataInGroupRow && !hasFixedColumns" class="f-datagrid-cell f-dg-groupcell" [attr.colspan]="hasFixedColumns? columns.length: row[\'colspan\']" [style.paddingLeft.px]="row[groupLevelField] * 15">\r\n                    <ng-container [ngTemplateOutlet]="grouprowControl" [ngTemplateOutletContext]="{$implicit: { row: row, index: i }}"></ng-container>\r\n                </td>\r\n                \r\n                <td *ngIf="!fixedRight && !groupSummaryDataInGroupRow && hasFixedColumns" class="f-datagrid-cell f-dg-groupcell" [attr.colspan]="hasFixedColumns? columns.length: row[\'colspan\']" [style.paddingLeft.px]="row[groupLevelField] * 15">\r\n                </td>\r\n\r\n                <ng-container *ngIf="groupSummaryDataInGroupRow && !fixedRight">\r\n\r\n                    <ng-container *ngFor="let col of columns; trackBy: trackByField; let ci = index;">\r\n                        <td *ngIf="!fixedRight && ci === 0 && !hasFixedColumns" class="f-datagrid-cell" [style.paddingLeft.px]="row[groupLevelField] * 15" [attr.colspan]="dg.groupCellColSpan">\r\n                            <ng-container [ngTemplateOutlet]="grouprowControl" [ngTemplateOutletContext]="{$implicit: { row: row, index: i }}"></ng-container>\r\n                        </td>\r\n                             \r\n                        <td class="f-datagrid-cell"  \r\n                            *ngIf="!hasFixedColumns ?ci > 0 && ci >= dg.groupCellColSpan: true"\r\n                            [attr.field]="col.field" \r\n                            [attr.align]=" col.groupFooter?.align || col.align">\r\n                            <div class="f-datagrid-cell-content" [innerHTML]="col | formatCellData: getGroupSummaryData(row.id) : true: false | safe: \'html\'"></div>\r\n                        </td>\r\n                    </ng-container>\r\n                </ng-container>\r\n\r\n                <td *ngIf="fixedRight" class="f-datagrid-cell" [attr.colspan]="columns.length"></td>\r\n            </tr>\r\n\r\n            <ng-container *ngIf="!row[isGroupRow]">\r\n                <ng-container *ngIf="!row[isGroupFooter]">\r\n                    <tr class="f-datagrid-body-row"\r\n                        [attr.id]="row | rowDataId:fixedRight"\r\n                        [attr.index]="startRowIndex + i"\r\n                        [grid-row]="row"\r\n                        [editable]="dg.editable"\r\n                        [rowIndex]="startRowIndex + i" #dr="gridRow"\r\n                        [formGroup]="dr.form"\r\n                        [class.f-datagrid-row-selected]="row | rowIsSelected"\r\n                        [style.display]="row[visible] ? \'\': \'none\'"\r\n                        [class.f-datagrid-disable-row]="dr.disabled">\r\n\r\n                        <td *ngIf="dg.showCheckbox && dg.fast" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center; left: 0"\r\n                        [class.f-datagrid-fast__fixed-left]="dg.fast" [class.l-shadow-col]="dg.fast && !dg.showLineNumber && !hasFixedColumns">\r\n                            <div class="f-datagrid-cell-content checkbox-column" style="text-overflow: unset;">\r\n                            <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow" [rowData]="row"\r\n                                [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                            </div>\r\n                        </td>\r\n            \r\n                        <td *ngIf="dg.showLineNumber && dg.fast" [style.width.px]="dg.lineNumberWidth"  class="f-datagrid-cell f-datagrid-cell-rownumber"\r\n                        [class.f-datagrid-fast__fixed-left]="dg.fast"  [style.left.px]="dg.showCheckbox ? 36: 0" [class.l-shadow-col]="dg.fast && !hasFixedColumns">\r\n                            <div class="f-datagrid-cell-content">\r\n                                {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + i + 1 }}\r\n                            </div>\r\n                        </td>\r\n\r\n\r\n                        <td class="f-datagrid-cell"\r\n                            [cell-editable]="row"\r\n                            [column]="col"\r\n                            [attr.field]="col.field" #cell\r\n                            [style.paddingLeft.px]="(ci === 0 && !fixedRight && !hasFixedColumns) ? row[groupLevelField] * 10 + 25 : 0"\r\n                            [attr.align]="col.align"\r\n                            [class.f-datagrid-fast__fixed-left]="dg.fast && col.fixed && col.fixed === \'left\'"\r\n                            [class.f-datagrid-fast__fixed-right]="dg.fast && col.fixed && col.fixed === \'right\'"\r\n                            [class.r-shadow-col]="col.rightShadowCol"\r\n                            [class.l-shadow-col]="col.leftShadowCol"\r\n                            *ngFor="let col of columns; trackBy: trackByField; let ci = index;">\r\n                            <grid-body-cell\r\n                                [width]="col.width"\r\n                                [height]="dg.rowHeight"\r\n                                [column]="col"\r\n                                [rowData]="row"\r\n                                [rowIndex]="startRowIndex + i">\r\n                            </grid-body-cell>\r\n                        </td>\r\n                    </tr>\r\n                </ng-container>\r\n\r\n                <ng-container *ngIf="row[isGroupFooter] && !groupSummaryDataInGroupRow">\r\n                    <tr class="f-datagrid-body-row f-datagrid-group-footer" \r\n                        *ngIf="!row[isGroupRow]"\r\n                        [attr.index]="startRowIndex + i"\r\n                        [group-footer-row-styler]="row"\r\n                        [style.display]="row[visible] ? \'\': \'none\'">\r\n                        <td class="f-datagrid-cell"\r\n                            [attr.field]="col.field" \r\n                            [attr.colspan]="col.groupFooter?.colspan || 1"\r\n                            [attr.align]=" col.groupFooter?.align || col.align"\r\n                            [style.display]="col.groupFooter?.visible === false ? \'none\': \'\'"\r\n                            [style.paddingLeft.px]="(ci === 0 && !fixedRight && !hasFixedColumns)? row[groupLevelField] * 10 + 25 : 0"\r\n                            footer-cell-styler [column]="col" [rowData]="row" [isGroupFooter]="true"\r\n                            *ngFor="let col of columns; trackBy: trackByField; let ci = index;">\r\n                            <div class="f-datagrid-cell-content" [innerHTML]="col | formatCellData: row.data : true: false | safe: \'html\'"></div>\r\n                        </td>\r\n                    </tr>\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n        </ng-container>\r\n\r\n    </tbody>\r\n    <tbody *ngIf="!dg.groupRows || !dg.groupField" id="{{ (fixedRight? \'right-tbody_\' : \'normal-rows-tbody_\')+ dg.id}}">\r\n\r\n        <ng-container *ngIf="!dg.mergeCell">\r\n            <tr class="f-datagrid-body-row"\r\n                [attr.id]="row | rowDataId: fixedRight"\r\n                [attr.index]="startRowIndex + i"\r\n                [grid-row]="row"\r\n                [editable]="dg.editable"\r\n                [rowIndex]="startRowIndex + i" #dr="gridRow"\r\n                [formGroup]="dr.form"\r\n                #tr\r\n                [class.f-datagrid-row-selected]="row | rowIsSelected"\r\n                [class.f-datagrid-disable-row]="dr.disabled"\r\n                *ngFor="let row of data; trackBy: dg.trackByRows; let i = index"\r\n                >\r\n\r\n                    <td *ngIf="dg.showCheckbox && dg.fast" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center; left: 0"\r\n                    [class.f-datagrid-fast__fixed-left]="dg.fast" [class.l-shadow-col]="dg.fast && !dg.showLineNumber && !hasFixedColumns">\r\n                        <div class="f-datagrid-cell-content checkbox-column" style="text-overflow: unset;">\r\n                        <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow" [rowData]="row"\r\n                            [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                        </div>\r\n                    </td>\r\n        \r\n                    <td *ngIf="dg.showLineNumber && dg.fast" [style.width.px]="dg.lineNumberWidth"  class="f-datagrid-cell f-datagrid-cell-rownumber"\r\n                    [class.f-datagrid-fast__fixed-left]="dg.fast"  [style.left.px]="dg.showCheckbox ? 36: 0" [class.l-shadow-col]="dg.fast && !hasFixedColumns">\r\n                        <div class="f-datagrid-cell-content">\r\n                            {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + i + 1 }}\r\n                        </div>\r\n                    </td>\r\n\r\n                    <td class="f-datagrid-cell"\r\n                        [attr.field]="col.field" \r\n                        [attr.align]="col.align"\r\n                        [style.vertical-align]="col.valign"\r\n                        [cell-editable]="row"\r\n                        [column]="col"  #editorcell="cellEditable"\r\n                        [class.cell-readonly]="col | cellReadonly: row: dg"\r\n                        [style.display]="dg.columnIsVisible(col) ? \'\': \'none\'"\r\n                        [class.f-datagrid-fast__fixed-left]="dg.fast && col.fixed && col.fixed === \'left\'"\r\n                        [class.f-datagrid-fast__fixed-right]="dg.fast && col.fixed && col.fixed === \'right\'"\r\n                        [class.r-shadow-col]="col.rightShadowCol"\r\n                        [class.l-shadow-col]="col.leftShadowCol"\r\n                        *ngFor="let col of columns;trackBy: dg.trackByRows; index as ci; last as islast;">\r\n                        <grid-body-cell\r\n                            [width]="col.width"\r\n                            [height]="dg.rowHeight"\r\n                            [lastColumn]="islast"\r\n                            [column]="col"\r\n                            [rowData]="row"\r\n                            [rowIndex]="startRowIndex + i">\r\n                        </grid-body-cell>\r\n                    </td>\r\n                </tr>\r\n            </ng-container>\r\n            <ng-container *ngIf="dg.mergeCell">\r\n                <tr class="f-datagrid-body-row"\r\n                    [attr.id]="row | rowDataId: fixedRight "\r\n                    [attr.index]="startRowIndex + i"\r\n                    [grid-row]="row"\r\n                    [editable]="dg.editable"\r\n                    [rowIndex]="startRowIndex + i"\r\n                    #dr="gridRow" [formGroup]="dr.form"\r\n                    [class.f-datagrid-row-selected]="row | rowIsSelected"\r\n                    [class.f-datagrid-disable-row]="dr.disabled"\r\n                    #tr\r\n                    *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n\r\n                        <td *ngIf="dg.showCheckbox && dg.fast" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center;left:0" \r\n                            [class.f-datagrid-fast__fixed-left]="dg.fast" [class.l-shadow-col]="dg.fast && !dg.showLineNumber && !hasFixedColumns">\r\n                            <div class="f-datagrid-cell-content checkbox-column" style="text-overflow: unset;">\r\n                            <datagrid-checkbox [disabled]="row | disableRow: startRowIndex + i: dg.disableRow" [rowData]="row"\r\n                                [rowIndex]="startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                            </div>\r\n                        </td>\r\n            \r\n                        <td *ngIf="dg.showLineNumber  && dg.fast" [style.width.px]="dg.lineNumberWidth" class="f-datagrid-cell f-datagrid-cell-rownumber"\r\n                        [class.f-datagrid-fast__fixed-left]="dg.fast" [style.left.px]="dg.showCheckbox ? 36: 0"\r\n                        [class.l-shadow-col]="dg.fast && !hasFixedColumns">\r\n                            <div class="f-datagrid-cell-content">\r\n                                {{ dg.pageSize * (dg.pageIndex-1) + startRowIndex + i + 1 }}\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td *ngFor="let column of columns; trackBy: trackByField; index as ci; last as islast;"\r\n                            [attr.field]="column.field"\r\n                            class="f-datagrid-cell" \r\n                            [attr.align]="column.align"\r\n                            [style.display]=" showCell(column, startRowIndex + i) ? \'\': \'none\' "\r\n                            [style.vertical-align]="column.valign"\r\n                            [attr.rowspan]=" getRowSpan(column, startRowIndex + i)"\r\n                            [cell-editable]="row"\r\n                            [column]="column" #td \r\n                            [class.f-datagrid-td-merged]="td.rowSpan > 1"\r\n                            [class.f-datagrid-fast__fixed-left]="dg.fast && column.fixed && column.fixed === \'left\'"\r\n                            [class.f-datagrid-fast__fixed-right]="dg.fast && column.fixed && column.fixed === \'right\'"\r\n                            [class.r-shadow-col]="column.rightShadowCol"\r\n                            [class.l-shadow-col]="column.leftShadowCol">\r\n                            <grid-body-cell \r\n                                [width]="column.width"\r\n                                [height]="dg.rowHeight" \r\n                                [lastColumn]="islast"\r\n                                [column]="column"\r\n                                [rowData]="row"\r\n                                [rowIndex]="startRowIndex + i">\r\n                            </grid-body-cell>\r\n                        </td>\r\n                </tr>\r\n            </ng-container>\r\n    </tbody>\r\n\r\n</table>'}]}],t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]},{type:It,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return It})]}]},{type:e.ElementRef},{type:e.Injector},{type:e.NgZone}]},t.propDecorators={startRowIndex:[{type:e.Input}],data:[{type:e.Input}],columns:[{type:e.Input}],tableEl:[{type:e.ViewChild,args:["tableEl"]}],fixedRight:[{type:e.Input}],hasFixedColumns:[{type:e.Input}],width:[{type:e.Input}]},t}(),Pt=function(){function t(){}return t.decorators=[{type:e.Component,args:[{selector:"grid-editor-textbox",template:""}]}],t}(),Lt=function(){function t(t,i,o,s){var l=this;this.render2=t,this.injector=i,this.dg=o,this.ngZone=s,this.height=35,this.columns=[],this.enableDragColumn=!1,this.wrapHeader=!1,this.enableFilterRow=!1,this.scrollbarMode="auto",this.fast=!1,this.ro=null,this.rightFixedColumnWidth=0,this.normalColumnWidth=0,this.showOverlay=!1,this.disableSort=!1,this.scrollX=0,this.showShadowCls=!1,this.top=0,this.hasFixedLeftColumns=!1,this.destroy$=new r.Subject,this.lineNumberTitle="序号",this.dfs=this.injector.get(Z),this.dgs=this.injector.get(J),this.cfr=this.injector.get(e.ComponentFactoryResolver),this.cd=this.injector.get(e.ChangeDetectorRef),this.el=this.injector.get(e.ElementRef),this.dfrs=this.dg.clientFilterService,this.dgs.scorll$.pipe(n.takeUntil(this.destroy$)).subscribe(function(t){t.type!==H&&t.type!==P&&t.type!==L||(l.scrollX=t.x,l.render2.setStyle(l.headerColumnsTable.nativeElement,"transform","translate3d(-"+t.x+"px, 0px, 0px)"),l.dg.groupRows||l.fixedLeft&&(t.x?l.render2.addClass(l.fixedLeft.nativeElement,A):l.render2.removeClass(l.fixedLeft.nativeElement,A))),t.type===L&&l.fixedLeft&&l.render2.removeClass(l.fixedLeft.nativeElement,A)}),this.dgs.showFixedShadow.pipe(n.takeUntil(this.destroy$)).subscribe(function(t){l.fixedRight&&l.setFixedColumnPosition(t.showRightShadow,t.x)}),this.dgs.disableHeader.pipe(n.takeUntil(this.destroy$)).subscribe(function(t){l.showOverlay=t,l.disableSort=t,l.cd.detectChanges()})}return Object.defineProperty(t.prototype,"chkAll",{set:function(t){this._chkall=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fr",{set:function(t){t&&(this.fixedRight=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowSpan",{get:function(){return this.columns.length},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.dgs.checkedRowsTotalChanged$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){if(t._chkall){var e=t.dfs.getCurrentPageCheckeds().length,i=t.dfs.isCheckAll(),r=i||!e;t._chkall.chk.nativeElement.indeterminate=!r;var n=i&&e>0;t._chkall.updateStatus(n)}}),this.dgs.uncheckAll.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.dg.showAllCheckbox&&t._chkall&&(t._chkall.chk.nativeElement.indeterminate=!1,t._chkall.chk.nativeElement.checked=!1)}),this.dgs.checkAll.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t._chkall&&(t._chkall.chk.nativeElement.checked=!0)}),this.dgs.scrollbarUpdate.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.ps=e.scrollbarRef,t.rightFixedColumnWidth=t.getRightFixedColWidth(t.ps),t.fixedRight&&t.setFixedColumnPosition(e.showRightShadow,0),t.cd.detectChanges()}),this.dgs.showGridHeader.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.setHeaderPosition()}),this.dgs.smartFilterBarExpand.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.setHeaderPosition()}),this.rightFixedColumnWidth=this.getRightFixedColWidth(this.ps),this.hasFixedLeftColumns=this.columnsGroup&&this.columnsGroup.leftFixed&&!!this.columnsGroup.leftFixed.length},t.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){t.setHeaderPosition()}),this.lineNumberTitle=this.getLineNumberTitle()},t.prototype.ngOnChanges=function(t){var e=this;t.columnsGroup&&!t.columnsGroup.isFirstChange()&&setTimeout(function(){e.rightFixedColumnWidth=e.getRightFixedColWidth(e.ps),e.hasFixedLeftColumns=e.columnsGroup&&e.columnsGroup.leftFixed&&!!e.columnsGroup.leftFixed.length,e.cd.destroyed||e.cd.detectChanges()})},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.fixedRight=null},t.prototype.getLineNumberTitle=function(){return this.dg.lineNumberTitle?this.dg.lineNumberTitle:this.dg.localeService.getValue("datagrid.lineNumberTitle")},t.prototype.getRightFixedColWidth=function(t){if(void 0===t&&(t=null),!this.columnsGroup)return 0;var e=this.columnsGroup.rightFixedWidth;return(t=this.dg.scrollInstance?this.dg.scrollInstance.instance:null)&&t.scrollbarYActive&&"allways"===this.scrollbarMode?e+18:e},t.prototype.setHeaderPosition=function(){var t=0;(this.dg.enableFilterRow||this.dg.enableSmartFilter)&&this.dg.showFilterBar&&(t+=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(t+=this.dg.rowGroupPanelHeight),this.top=t,this.render2.setStyle(this.el.nativeElement,"top",t+"px");var e=this.dg.customStyleKey()+" .f-datagrid-header .f-datagrid-header-cell-content";this.dgs.removeCssRule(e),this.dg.renderCustomStyle2({style:{"min-height":this.dg.headerHeight+"px"}},this.el.nativeElement,e);var i=this.dg.customStyleKey()+" .f-datagrid-header-row.f-datagrid-filter-row .f-datagrid-header-cell-content";this.dgs.removeCssRule(i),this.dg.enableFilterRow&&this.dgs.appendCssRules([i+" { height: "+this.dg.filterRowHeight+"px;min-height:"+this.dg.filterRowHeight+"px }"])},t.prototype.isShowShadow=function(t){return this.dg.dgContainer.nativeElement.offsetWidth<this.dg.colGroup.totalWidth},t.prototype.isColspan=function(t,e,i,r){void 0===r&&(r=!1);var n=function(t){return t&&"none"!=t?r?(!i.colspan||1===i.colspan)&&i.fixed===t:i.colspan&&i.colspan>1&&i.fixed&&i.fixed===t:r?!(i.colspan&&1!==i.colspan||i.fixed&&"none"!==i.fixed):i.colspan&&i.colspan>1&&(!i.fixed||"none"===i.fixed)};return t||e?t?n("left"):e?n("right"):void 0:n("none")},t.prototype.setFixedColumnPosition=function(t,e){this.showShadowCls=t;var i=t?"addClass":"removeClass";this.render2[i](this.fixedRight.nativeElement,"f-datagrid-fixed-right-shadow");var r=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth+this.rightFixedColumnWidth,n=this.dg.width,o=this.dg.width-(this.dg.showBorder?2:0)-this.rightFixedColumnWidth;n>r&&(o=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth),this.render2.setStyle(this.fixedRight.nativeElement,"left",o+"px")},t.prototype.onRowNumerColumnDblClick=function(t,e){var i=this.dg.getRows().length;if(this.dg.pagination){var r=this.dg.pageSize;i=r*this.dg.pageIndex+r}this.dg.longTextArea.nativeElement.innerHTML=i;var n=this.dg.longTextArea.nativeElement.offsetWidth;n>e.offsetWidth&&(this.dg.lineNumberWidth=n+10,this.dfs.updateProperty("lineNumberWidth",this.dg.lineNumberWidth),this.dfs.resizeColumns())},t.prototype.onSortColumnClick=function(t,e){var i=this;this.SORT_CLICK_TIMER&&clearTimeout(this.SORT_CLICK_TIMER),this.SORT_CLICK_TIMER=setTimeout(function(){i._onSortClick(t,e)},250)},t.prototype._onSortClick=function(t,e){var i=this;if(t.stopPropagation(),!this.disableSort&&e.sortable){this.dg.cancelEdit(null);var r=this.dg.sortName,n=this.dg.sortOrder,o=[],s=[];r&&(o=r.split(","),s=n.split(","));var l=e.order||"asc",a=l,d=o.findIndex(function(t){return t===e.field});if(d>=0){var c="asc"===s[d]?"desc":"asc";"asc"===(a=c)?(a=undefined,o.splice(d,1),s.splice(d,1)):s[d]=c}else this.dg.multiSort?(o.push(e.field),s.push(l)):(o=[e.field],s=[l]);e.order=a,this.dg.sortName=o.join(","),this.dg.sortOrder=s.join(","),this.dfs.setSortInfo(this.dg.sortName,this.dg.sortOrder),this.dg.beforeSortColumn(this.dg.sortName,this.dg.sortOrder,this.dg).subscribe(function(){i.dg.onColumnSorted()})}},t.decorators=[{type:e.Component,args:[{selector:"datagrid-header",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-06 07:43:53\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-11-05 08:53:26\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n \x3c!-- [style.maxWidth.px]="col.width - 44"   =>  style="width: 100%"    --\x3e\r\n<ng-template #filterAndSort let-col>\r\n    <ng-container *ngIf="col.filter">\r\n        <span style="width: 100%" class="f-datagrid-header-cell-title" [header-style]="col"><span class="text-danger" *ngIf=" col.validators | showStar ">*</span>{{col.title}}</span>\r\n        <ng-container *ngIf="col.sortable ">\r\n            <span class="f-datagrid-sort" [class.f-datagrid-filter-sort-asc]="col.order === \'asc\'"\r\n                [class.f-datagrid-filter-sort-desc]="col.order === \'desc\'"\r\n                [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'" *ngIf="col.order"\r\n                datagrid-smart-filter [disabled]="disableSort" [column]="col"> </span>\r\n            <span class="f-datagrid-sort f-datagrid-filter-sort" [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n                datagrid-smart-filter [disabled]="disableSort" [column]="col" *ngIf="!col.order"></span>\r\n        </ng-container>\r\n        <ng-container *ngIf="!col.sortable">\r\n            <span class="f-datagrid-sort f-datagrid-filter" datagrid-smart-filter  [disabled]="disableSort"  [column]="col"></span>\r\n        </ng-container>\r\n    </ng-container>\r\n    <ng-container *ngIf="!col.filter" [ngTemplateOutlet]="column_title" [ngTemplateOutletContext]="{$implicit: col}">\r\n    </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #column_title let-col>\r\n    <ng-container *ngIf="!col.sortable">\r\n        <span [style.width.px]="col.width - 20" class="f-datagrid-header-cell-title" [header-style]="col" \r\n            *ngIf="col.field !== dg.ControlPanelFeild"><span class="text-danger" *ngIf=" col.validators | showStar ">*</span>{{col.title}}</span>\r\n        <span *ngIf="col.field === dg.ControlPanelFeild" class="f-datagrid-header-cell-title"\r\n            style="position: absolute; left: 3px; cursor: pointer;"\r\n            (click)="dg.showControlPanel($event)">\r\n            <span class="f-icon f-icon-home-setup"></span>\r\n        </span>\r\n    </ng-container>\r\n    <ng-container *ngIf="col.sortable">\r\n        <span style="width: 100%"  class="f-datagrid-header-cell-title" [header-style]="col"><span class="text-danger" *ngIf=" col.validators | showStar ">*</span>{{col.title}}</span>\r\n        <span class="f-datagrid-sort" [class.f-datagrid-sort-asc]="col.order === \'asc\'"\r\n            [class.f-datagrid-sort-desc]="col.order === \'desc\'"\r\n            [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n            (click)="onSortColumnClick($event, col)" *ngIf="col.order"> </span>\r\n        <span class="f-datagrid-sort" [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n            (click)="onSortColumnClick($event, col)" *ngIf="!col.order "></span>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\x3c!-- 使用表头模板时，排序模板 --\x3e\r\n<ng-template #column_sort let-col>\r\n    <ng-container *ngIf="!col.sortable">\r\n        <span *ngIf="col.field === dg.ControlPanelFeild" class="f-datagrid-header-cell-title"\r\n            style="position: absolute; left: 3px; cursor: pointer;"\r\n            (click)="dg.showControlPanel($event)">\r\n            <span class="f-icon f-icon-home-setup"></span>\r\n        </span>\r\n    </ng-container>\r\n    <ng-container *ngIf="col.sortable">\r\n        <span class="f-datagrid-sort" [class.f-datagrid-sort-asc]="col.order === \'asc\'"\r\n            [class.f-datagrid-sort-desc]="col.order === \'desc\'"\r\n            [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n            (click)="onSortColumnClick($event, col)" *ngIf="col.order"> </span>\r\n        <span class="f-datagrid-sort" [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n            (click)="onSortColumnClick($event, col)" *ngIf="!col.order "></span>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n\x3c!-- 使用表头模板时，智能过滤模板 --\x3e\r\n<ng-template #smartfilter let-col>\r\n    <ng-container *ngIf="col.filter">\r\n        <ng-container *ngIf="col.sortable ">\r\n            <span class="f-datagrid-sort" [class.f-datagrid-filter-sort-asc]="col.order === \'asc\'"\r\n                [class.f-datagrid-filter-sort-desc]="col.order === \'desc\'"\r\n                [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'" *ngIf="col.order"\r\n                datagrid-smart-filter [disabled]="disableSort" [column]="col"> </span>\r\n            <span class="f-datagrid-sort f-datagrid-filter-sort" [style.cursor]="disableSort ? \'not-allowed\': \'pointer\'"\r\n                datagrid-smart-filter [disabled]="disableSort" [column]="col" *ngIf="!col.order"></span>\r\n        </ng-container>\r\n        <ng-container *ngIf="!col.sortable">\r\n            <span class="f-datagrid-sort f-datagrid-filter" datagrid-smart-filter  [disabled]="disableSort"  [column]="col"></span>\r\n        </ng-container>\r\n    </ng-container>\r\n    <ng-container *ngIf="!col.filter" [ngTemplateOutlet]="column_sort" [ngTemplateOutletContext]="{$implicit: col}"></ng-container>\r\n</ng-template>\r\n\r\n\r\n<ng-template #column_template let-col let-left="left" let-right="right">\r\n    <ng-container *ngIf="isColspan(left, right, col, false) ">\r\n        <td [resize-column]="col" class="f-datagrid-header-cell f-datagrid-header-cell-group" [attr.align]="col.halign"\r\n            [attr.colspan]="col.colspan" [attr.title]="col.title"\r\n            [class.r-shadow-col]="col.rightShadowCol"\r\n            [class.l-shadow-col]="col.leftShadowCol" [header-style]="col">\r\n            <div class="f-datagrid-header-cell-content  d-flex align-items-center" [header-style]="col" [groupHeader]="true">{{col.title}}</div>\r\n        </td>\r\n    </ng-container>\r\n    <ng-container *ngIf="isColspan(left, right, col, true)">\r\n        <td [resize-column]="col" class="f-datagrid-header-cell" [attr.align]="col.halign" [attr.field]="col.field"\r\n            [attr.rowspan]="col.rowspan" [attr.title]="col.title"\r\n            *ngIf="dg.columnIsVisible(col)"\r\n            [style.display]="dg.columnIsVisible(col) ? \'\': \'none\'"\r\n            [class.f-datagrid-header-cell-sort]="col.sortable"\r\n            [class.smooth-dnd-draggable-wrapper]="enableDragColumn && col.field !== dg.ControlPanelFeild "\r\n            [header-style]="col">\r\n            <div class="f-datagrid-header-cell-content  d-flex flex-row align-items-center" [style.width.px]="col.width" >\r\n                <span class="drag-column-bar f-icon f-icon-more-vertical" *ngIf="col.field !== dg.ControlPanelFeild && enableDragColumn && !dg.editable"></span>\r\n                \r\n                <ng-container *ngIf="col.headerTemplate && !col.headerComponentType">\r\n                    <span class="text-danger pr-1" *ngIf=" col.validators | showStar ">*</span>\r\n                    <ng-container [ngTemplateOutlet]="col.headerTemplate" [ngTemplateOutletContext]="{$implicit: col}"></ng-container>\r\n                    <ng-container [ngTemplateOutlet]=" !dg.enableSmartFilter ? column_sort : smartfilter " [ngTemplateOutletContext]="{$implicit: col}"></ng-container>\r\n                </ng-container>\r\n                <ng-container *ngIf="!col.headerTemplate && !col.headerComponentType" [ngTemplateOutlet]=" !dg.enableSmartFilter ? column_title : filterAndSort " [ngTemplateOutletContext]="{$implicit: col}"></ng-container>\r\n                <ng-container  *ngIf="col.headerComponentType">\r\n                    <span class="text-danger" *ngIf=" col.validators | showStar ">*</span>\r\n                    <ng-container component-template [ctx]="{ col: col }"></ng-container>\r\n                    <ng-container [ngTemplateOutlet]=" !dg.enableSmartFilter ? column_sort : smartfilter " [ngTemplateOutletContext]="{$implicit: col}"></ng-container>\r\n                </ng-container>\r\n            </div>\r\n        </td>\r\n    </ng-container>\r\n</ng-template>\r\n\r\n<ng-template #header_template_inner let-columns let-left="left" let-right="right" let-groupCols="groupCols">\r\n    <table cellpadding="0" cellspacing="0" border="0" style="height: 100%; ">\r\n        <colgroup>\r\n            <col [style.width.px]="dg.checkboxColumnWidth || 36" *ngIf="dg.showCheckbox && left">\r\n            <col [width]="dg?.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber && left">\r\n            <ng-container *ngFor="let col of groupCols">\r\n                <col [width]="col.width + \'px\'" *ngIf="col.width && col.field">\r\n            </ng-container>\r\n        </colgroup>\r\n        <thead [class.header-wrap]="wrapHeader">\r\n            <tr class="f-datagrid-header-row" *ngFor="let cols of columns; index as colsIdx; first as isFirst"\r\n                [drag-column]="enableDragColumn" [groupName]="left?\'left\': right ? \'right\': \'center\'">\r\n                \x3c!-- 复选框 --\x3e\r\n                <td *ngIf="dg.showCheckbox && isFirst && left" #chktd\r\n                    class="f-datagrid-header-cell f-datagrid-header-checkbox" \r\n                    [attr.rowspan]="rowSpan">\r\n                    <div class="f-datagrid-header-cell-content" style="overflow:hidden;text-align:center" [style.width.px]="dg.checkboxColumnWidth || 36">\r\n                        <datagrid-header-checkbox #chkAll *ngIf="dg.showAllCheckbox && dg.multiSelect" ></datagrid-header-checkbox>\r\n                    </div>\r\n                </td>\r\n                \x3c!-- 行号 --\x3e\r\n                <td *ngIf="dg.showLineNumber && isFirst && left" #rntd\r\n                    class="f-datagrid-header-cell f-datagrid-cell-rownumber" [attr.rowspan]="rowSpan"\r\n                    (dblclick)="onRowNumerColumnDblClick($event, rntd)">\r\n                    <div class="f-datagrid-header-cell-content  d-flex align-items-center" style="padding: 0px;"  [style.width.px]="dg?.lineNumberWidth">\r\n                        \r\n                        <span style="width: 100%" class="f-datagrid-header-cell-title">\r\n                            {{ lineNumberTitle }}\r\n                        </span>\r\n                    </div>\r\n                </td>\r\n                <ng-container *ngFor="let col of cols; last as isLast">\r\n                    <ng-container\r\n                        *ngTemplateOutlet="column_template; context: {$implicit: col, left: left, right: right}">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngIf="enableFilterRow" [style.height.px]="dg.filterRowHeight" class="f-datagrid-header-row f-datagrid-filter-row">\r\n                \x3c!-- 复选框 --\x3e\r\n                <td *ngIf="dg.showCheckbox && left" class="f-datagrid-header-cell f-datagrid-header-checkbox" >\r\n                </td>\r\n                \x3c!-- 行号 --\x3e\r\n                <td *ngIf="dg.showLineNumber && left" class="f-datagrid-header-cell f-datagrid-cell-rownumber" >\r\n                </td>\r\n                \r\n                <ng-container filter-row-creator [left]="left" [right]="right">\r\n                </ng-container>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</ng-template>\r\n\r\n\r\n<ng-template #header_template_inner_right let-columns let-left="left" let-right="right" let-groupCols="groupCols">\r\n    <table cellpadding="0" cellspacing="0" border="0" style="height: 100%; " [style.width.px]="columnsGroup.rightFixedWidth">\r\n        <colgroup>\r\n            <col [style.width.px]="dg.checkboxColumnWidth || 36" *ngIf="dg.showCheckbox && left">\r\n            <col [width]="dg?.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber && left">\r\n            <ng-container *ngFor="let col of groupCols">\r\n                <col [width]="col.width + \'px\'" *ngIf="col.width && col.field">\r\n            </ng-container>\r\n        </colgroup>\r\n        <thead [class.header-wrap]="wrapHeader">\r\n            <tr class="f-datagrid-header-row" *ngFor="let cols of columns; index as colsIdx; first as isFirst"\r\n                [drag-column]="enableDragColumn" [groupName]="left?\'left\': right ? \'right\': \'center\'">\r\n                \x3c!-- 复选框 --\x3e\r\n                <td *ngIf="dg.showCheckbox && isFirst && left" #chktd\r\n                    class="f-datagrid-header-cell f-datagrid-header-checkbox" \r\n                    [attr.rowspan]="rowSpan">\r\n                    <div class="f-datagrid-header-cell-content" style="width: 36px; text-align: center;overflow:hidden; ">\r\n                        <datagrid-header-checkbox #chkAll *ngIf="dg.showAllCheckbox && dg.multiSelect" ></datagrid-header-checkbox>\r\n                    </div>\r\n                </td>\r\n                \x3c!-- 行号 --\x3e\r\n                <td *ngIf="dg.showLineNumber && isFirst && left" #rntd\r\n                    class="f-datagrid-header-cell f-datagrid-cell-rownumber" [attr.rowspan]="rowSpan"\r\n                    (dblclick)="onRowNumerColumnDblClick($event, rntd)">\r\n                    <div class="f-datagrid-header-cell-content" style="padding: 0px;"  [style.width.px]="dg?.lineNumberWidth">\r\n                        \r\n                        <span style="width: 100%" class="f-datagrid-header-cell-title">\r\n                            {{ lineNumberTitle }}\r\n                        </span>\r\n                    </div>\r\n                </td>\r\n                <ng-container *ngFor="let col of cols; last as isLast">\r\n                    <ng-container\r\n                        *ngTemplateOutlet="column_template; context: {$implicit: col, left: left, right: right}">\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n            <tr *ngIf="enableFilterRow" [style.height.px]="dg.filterRowHeight" class="f-datagrid-header-row f-datagrid-filter-row">\r\n                \x3c!-- 复选框 --\x3e\r\n                <td *ngIf="dg.showCheckbox && left" class="f-datagrid-header-cell f-datagrid-header-checkbox" >\r\n                </td>\r\n                \x3c!-- 行号 --\x3e\r\n                <td *ngIf="dg.showLineNumber && left" class="f-datagrid-header-cell f-datagrid-cell-rownumber" >\r\n                </td>\r\n                \r\n                <ng-container filter-row-creator [left]="left" [right]="right">\r\n                </ng-container>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</ng-template>\r\n\r\n\r\n\r\n<div class="f-datagrid-header" #header [style.width.px]="dg.width">\r\n\r\n            \r\n        \x3c!--左侧固定列--\x3e\r\n        <div #fixedLeft class="f-datagrid-header-fixed-left"\r\n            *ngIf="columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox "\r\n            [style.width.px]="columnsGroup?.leftFixedWidth"\r\n            [style.height.px]="height">\r\n            <ng-container *ngTemplateOutlet="header_template_inner; context: { $implicit: columns, left: true, right: false,\r\n                groupCols:  columnsGroup?.leftFixed}">\r\n            </ng-container>\r\n        </div>\r\n\r\n        \x3c!--正常列--\x3e\r\n        <div #headerContainer class="f-datagrid-header-center" \r\n            [style.left.px]="columnsGroup?.leftFixedWidth"\r\n            [style.width.px]="columnsGroup?.normalWidth"\r\n            style="position: absolute;height: 100%">\r\n            <ng-container *ngTemplateOutlet="header_template_inner; context: {$implicit: columns, left: false, right: false,\r\n                groupCols:  columnsGroup?.normalColumns}">\r\n            </ng-container>\r\n        </div>\r\n        \x3c!--右侧固定列--\x3e\r\n        <div #fixedRight class="f-datagrid-header-fixed-right"\r\n            *ngIf="columnsGroup?.rightFixed && columnsGroup?.rightFixed.length"\r\n            [style.width.px]="dg.showBorder?  rightFixedColumnWidth : rightFixedColumnWidth + 1"\r\n            [style.height.px]="height" style="border: 0; background-color: #F1F3F7;">\r\n            <ng-container *ngTemplateOutlet="header_template_inner_right; context: {$implicit: columns, left: false, right: true,\r\n                groupCols: columnsGroup?.rightFixed}">\r\n            </ng-container>\r\n        </div>\r\n\r\n    <div class="filter-row-disabled"\r\n        style="position: absolute;background: rgb(255, 255, 255);width: 100%;z-index: 9;height: 40px; bottom:0;opacity: 0;"\r\n        [style.left.px]="dg.showAllCheckbox ? 36 : 0" *ngIf="showOverlay && dg.enableFilterRow">\r\n    </div>\r\n</div>\r\n\r\n',encapsulation:e.ViewEncapsulation.None,exportAs:"dgHeader",styles:["\n        .f-datagrid-header-cell:hover>div>div {\n            width: calc(100% - 15px);\n        }\n\n        .drag-column-bar.f-icon-more-vertical:before {\n            position: relative;\n            top: -2px;\n        }\n        .f-datagrid-header-cell-content .f-datagrid-sort:before {\n            position: relative;\n            top: -1px;\n        }\n    "]}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.Injector},{type:xt,decorators:[{type:e.Optional}]},{type:e.NgZone}]},t.propDecorators={height:[{type:e.Input}],columns:[{type:e.Input}],columnsGroup:[{type:e.Input}],enableDragColumn:[{type:e.Input}],wrapHeader:[{type:e.Input}],enableFilterRow:[{type:e.Input}],scrollbarMode:[{type:e.Input}],fast:[{type:e.Input}],header:[{type:e.ViewChild,args:["header"]}],headerColumnsTable:[{type:e.ViewChild,args:["headerContainer"]}],fixedLeft:[{type:e.ViewChild,args:["fixedLeft"]}],chkAll:[{type:e.ViewChild,args:["chkAll"]}],fr:[{type:e.ViewChild,args:["fixedRight"]}]},t}(),At=function(){function t(t,i,o,s){var l=this;this.vc=t,this.injector=i,this.dg=o,this.ngZone=s,this.destroy$=new r.Subject,this.dfs=this.injector.get(Z),this.dgs=this.injector.get(J),this.cfr=this.injector.get(e.ComponentFactoryResolver),this.cd=this.injector.get(e.ChangeDetectorRef),this.dfrs=this.dg.clientFilterService,this.headeRef=this.injector.get(Lt),this.filterRowType=this.injector.get(_,null),this.dgs.clearFilter.pipe(n.takeUntil(this.destroy$)).subscribe(function(){l.filterRowRef&&l.filterRowRef.instance.clearFilterValue(!1)}),this.dgs.columnsChanged.pipe(n.takeUntil(this.destroy$)).subscribe(function(t){var e=!t||t.rebuildFilterBar;l.createFilterRow(e)}),this.dfrs&&this.dfrs.removeField.pipe(n.takeUntil(this.destroy$)).subscribe(function(t){l.filterRowRef&&t&&l.filterRowRef.instance.removeField(t)})}return t.prototype.ngOnInit=function(){this.createFilterRow(!0)},t.prototype.ngOnChanges=function(t){},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},t.prototype.createFilterRow=function(t){var e=this;void 0===t&&(t=!1),t&&this.filterRowRef&&(this.filterRowRef.destroy(),this.filterRowRef=null),this._FILTERROW_CREATE_TIMER_&&clearTimeout(this._FILTERROW_CREATE_TIMER_),this._FILTERROW_CREATE_TIMER_=setTimeout(function(){e._createFilterRow(),t&&!e.cd.destroyed&&e.cd.detectChanges()},50)},t.prototype._createFilterRow=function(){var t=this;if(this.dg.enableFilterRow){if(!this.filterRowType)return;var e=this.dg.colGroup.normalColumns;if(this.left?e=this.dg.colGroup.leftFixed:this.right&&(e=this.dg.colGroup.rightFixed),!this.filterRowRef&&this.vc){var i=this.cfr.resolveComponentFactory(this.filterRowType);this.filterRowRef=this.vc.createComponent(i),this.filterRowRef.instance.fixedLeft=this.left,this.filterRowRef.instance.columns=e,this.filterRowRef.instance.gridInstance=this.dg,this.dgs.closeFilterPanel.subscribe(function(){t.filterRowRef.instance.dfrs.closeFilterPanel()}),this.filterRowRef.instance.conditionChange.subscribe(function(e){var i=JSON.stringify(t.dg.conditions||{}),r=e.conditions,n=e.removedFields;n&&delete t.dg.conditions[n];var o=t.mergeFilterConditions(r||{});i!==JSON.stringify(o||{})&&(Object.keys(o).forEach(function(e){t.dg.dfs.getColumn(e)||delete o[e]}),t.dgs.onFilterChanged.emit(o))})}}},t.prototype.mergeFilterConditions=function(t){var e=Object.assign(this.dg.conditions||{},t||{});return Object.keys(e).forEach(function(t){null===e[t]&&delete e[t]}),e},t.decorators=[{type:e.Directive,args:[{selector:"[filter-row-creator]"}]}],t.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.Injector},{type:xt},{type:e.NgZone}]},t.propDecorators={left:[{type:e.Input}],right:[{type:e.Input}]},t}(),jt=function(){function t(t,e,i,r){this.dh=t,this.ngzone=e,this.el=i,this.render=r,this.dg=this.dh.dg}return t.prototype.ngAfterViewInit=function(){var t=this;this.isEnable()&&(this.render.addClass(this.el.nativeElement,"f-datagrid-header-cell-resize"),this.resizer=document.createElement("span"),this.resizer.className="column-resize-bar",this.el.nativeElement.appendChild(this.resizer),this.ngzone.runOutsideAngular(function(){var e=r.fromEvent(t.resizer,"mouseup");t.resizerMouseDownListener=r.fromEvent(t.resizer,"mousedown").pipe(n.takeUntil(e)).subscribe(function(e){return t.onMouseDown(e)})}))},t.prototype.onDblClickHandler=function(t){if(!(t&&t.target&&t.target.className.indexOf("f-datagrid-sort")>-1)){if(this.col.field&&this.col.field!==this.dg.ControlPanelFeild){var e=this.el;this.dg.sizeToContent(this.col,e)}return!1}},t.prototype.isEnable=function(){return!!this.dg.resizeColumn&&(this.col.field===this.dg.ControlPanelFeild&&(this.col.resizable=!1),this.col.resizable===undefined&&(this.col.resizable=!0),this.col.resizable)},t.prototype.bindDocumentEvents=function(){var t=this;this.ngzone.runOutsideAngular(function(){t.documentMouseMoveListener=t.onMouseMove.bind(t),document.addEventListener("mousemove",t.documentMouseMoveListener),t.documentMouseUpListener=t.onMouseUp.bind(t),document.addEventListener("mouseup",t.documentMouseUpListener)})},t.prototype.unbindDocumentEvents=function(){this.documentMouseMoveListener&&(document.removeEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseMoveListener=null),this.documentMouseUpListener&&(document.removeEventListener("mouseup",this.documentMouseUpListener),this.documentMouseUpListener=null)},t.prototype.onMouseDown=function(t){t.stopPropagation(),this.dg.onColumnResizeBegin(t),this.render.addClass(this.el.nativeElement,"column-resizeing"),this.bindDocumentEvents()},t.prototype.onMouseMove=function(t){this.dg.onColumnResize(t)},t.prototype.onMouseUp=function(t){this.dg.onColumnResizeEnd(t,this.col),this.render.removeClass(this.el.nativeElement,"column-resizeing"),this.unbindDocumentEvents()},t.prototype.ngOnDestroy=function(){this.resizerMouseDownListener&&this.resizerMouseDownListener.unsubscribe(),this.unbindDocumentEvents(),this.dblclickListener&&this.dblclickListener(),this.resizer=null},t.decorators=[{type:e.Directive,args:[{selector:"[resize-column]"}]}],t.ctorParameters=function(){return[{type:Lt,decorators:[{type:e.Optional}]},{type:e.NgZone},{type:e.ElementRef},{type:e.Renderer2}]},t.propDecorators={col:[{type:e.Input,args:["resize-column"]}],onDblClickHandler:[{type:e.HostListener,args:["dblclick",["$event"]]}]},t}(),Mt=function(){function t(t,i,n){this.render=t,this.injector=i,this.dg=n,this._footerData=[],this.position="bottom",this.hasFixedColumns=!1,this.fast=!1,this.scrollX=0,this.showShadowCls=!1,this.rightFixedColumnWidth=0,this.cdRef=null,this.destroy$=new r.Subject,this.dg=this.injector.get(xt),this.dgs=this.injector.get(J),this.cdRef=this.injector.get(e.ChangeDetectorRef)}return Object.defineProperty(t.prototype,"data",{get:function(){return this._footerData},set:function(t){this._footerData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fr",{set:function(t){t&&(this.fixedRight=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.scrollEvents(),this.renderFooterStyle(),this.setFooterPosition(!1),this.rightFixedColumnWidth=this.getRightFixedColWidth()},t.prototype.ngOnChanges=function(t){t.position&&this.setFooterPosition(!0),t.columnsGroup&&!t.columnsGroup.isFirstChange()&&(this.rightFixedColumnWidth=this.getRightFixedColWidth())},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.scrollXSubscription&&(this.scrollXSubscription.unsubscribe(),this.scrollXSubscription=null)},t.prototype.scrollEvents=function(){var t=this;this.dgs.showGridHeader.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.setFooterPosition(!1)}),this.scrollXSubscription=this.dgs.scorll$.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.scrollX=e.x,t.fast?e.type===H&&t.footerBody2&&(t.footerBody2.nativeElement.scrollLeft=e.x):(e.type!==H&&e.type!==P&&e.type!==L||t.dg.footerTemplate||(t.render.setStyle(t.footerBody.nativeElement,"transform","translate3d(-"+e.x+"px, 0px, 0px)"),t.fixedLeft&&(e.x?t.render.addClass(t.fixedLeft.nativeElement,A):t.render.removeClass(t.fixedLeft.nativeElement,A))),e.type===L&&t.fixedLeft&&t.render.removeClass(t.fixedLeft.nativeElement,A))}),this.fast||(this.dgs.showFixedShadow.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.fixedRight&&t.setFixedColumnPosition(e.showRightShadow,e.x)}),this.dgs.scrollbarUpdate.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.rightFixedColumnWidth=t.getRightFixedColWidth(e.scrollbarRef),t.fixedRight&&t.setFixedColumnPosition(e.showRightShadow,0),t.cdRef&&t.cdRef.detectChanges()}))},t.prototype.getRightFixedColWidth=function(t){if(void 0===t&&(t=null),!this.columnsGroup)return 0;var e=this.columnsGroup.rightFixedWidth;return(t=this.dg.scrollInstance?this.dg.scrollInstance.instance:null)&&t.scrollbarYActive&&"allways"===this.dg.scrollBarShowMode?e+18:e},t.prototype.setFooterPosition=function(t){if(void 0===t&&(t=!0),"bottom"===this.position){var e=0;this.dg.pagination&&(e=this.dg.pagerHeight||40),this.render.removeStyle(this.footerContainer.nativeElement,"top"),this.render.setStyle(this.footerContainer.nativeElement,"bottom",e+"px")}if("top"===this.position){var i=0;this.dg.showHeader&&(i=this.dg.realHeaderHeight||35),this.dg.showRowGroupPanel&&(i+=this.dg.rowGroupPanelHeight),this.dg.showFilterBar&&(i+=this.dg.filterBarHeight),this.render.removeStyle(this.footerContainer.nativeElement,"bottom"),this.render.setStyle(this.footerContainer.nativeElement,"top",i+"px")}t&&this.dgs.footerPositionChanged.emit()},t.prototype.renderFooterStyle=function(){if(this.dg.footerStyler){var t=this.dgs.getCustomStyle(this.dg.footerStyler,null),e=this.dg.customStyleKey()+" .f-datagrid-footer",i=this.dg.customStyleKey()+" .f-datagrid-footer .f-datagrid-body-fixed-left,"+this.dg.customStyleKey()+" .f-datagrid-footer .f-datagrid-body-fixed-right",r=this.dg.customStyleKey()+".f-datagrid-fast .f-datagrid-cell.f-datagrid-fast__fixed-left,"+this.dg.customStyleKey()+".f-datagrid-fast .f-datagrid-cell.f-datagrid-fast__fixed-right";if(t&&Object.keys(t).length){var n=[];t.style&&(n.push(e+" "+JSON.stringify(t.style)),n.push(i+" "+JSON.stringify(t.style)),this.fast&&n.push(r+" "+JSON.stringify(t.style))),this.dgs.appendCssRules(n)}else this.dgs.removeCssRule([e,i])}},t.prototype.setFixedColumnPosition=function(t,e){this.showShadowCls=t;var i=t?"addClass":"removeClass";this.render[i](this.fixedRight.nativeElement,"f-datagrid-fixed-right-shadow");var r=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth+this.rightFixedColumnWidth,n=this.dg.width,o=this.dg.width-(this.dg.showBorder?2:0)-this.rightFixedColumnWidth;n>r&&(o=this.columnsGroup.leftFixedWidth+this.columnsGroup.normalWidth),this.render.setStyle(this.fixedRight.nativeElement,"left",o+"px")},t.decorators=[{type:e.Component,args:[{selector:"datagrid-footer",template:'\x3c!--\r\n * @Author: 疯狂秀才(Lucas Huang)\r\n * @Date: 2019-08-12 15:02:10\r\n * @LastEditors: 疯狂秀才(Lucas Huang)\r\n * @LastEditTime: 2019-10-31 14:50:47\r\n * @QQ: 1055818239\r\n * @Version: v0.0.1\r\n --\x3e\r\n\r\n <ng-template #footer_content_template_fast let-columns let-left="fixedLeft" let-right="fixedRight">\r\n    <table cellpadding="0" cellspacing="0" border="0" style="border:0;" class="f-datagrid-rows" [style.width.px]="columnsGroup?.normalWidth" >\r\n        <colgroup>\r\n            <col [style.width.px]="dg.checkboxColumnWidth || 36" *ngIf="dg.showCheckbox"/>\r\n            <col [width]="dg.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber"/>\r\n            <col *ngFor="let col of columns" [width]="col.width + \'px\'"/>\r\n        </colgroup>\r\n        <tbody>\r\n            <tr #tr class="f-datagrid-body-row f-datagrid-footer-row"\r\n                *ngFor="let row of data;let rowIndex = index;trackBy: dg.trackByRows" \r\n                [attr.index]="rowIndex">\r\n\r\n                <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center; left: 0"\r\n                [class.f-datagrid-fast__fixed-left]="dg.fast" [class.l-shadow-col]="!dg.showLineNumber && !hasFixedColumns"></td>\r\n                <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber" \r\n                [class.f-datagrid-fast__fixed-left]="dg.fast"  [style.left.px]="dg.showCheckbox ? 36: 0" [class.l-shadow-col]="!hasFixedColumns"></td>\r\n\r\n                <td class="f-datagrid-cell {{ \'footer-td-\'+ col.field }}"\r\n                    [style.width.px]="col.width"\r\n                    [attr.colspan]="col.footer?.colspan || 1"\r\n                    [style.display]="col.footer?.visible === false ? \'none\': \'\'"\r\n                    [attr.field]="col.field" [attr.align]="col.footer?.align || col.align"\r\n                    *ngFor="let col of columns; let ci = index;"\r\n                    footer-cell-styler [column]="col" [rowData]="row" [rowIndex]="rowIndex"\r\n                    [class.f-datagrid-fast__fixed-left]=" col.fixed && col.fixed === \'left\'"\r\n                    [class.f-datagrid-fast__fixed-right]=" col.fixed && col.fixed === \'right\'"\r\n                    [class.r-shadow-col]="col.rightShadowCol"\r\n                    [class.l-shadow-col]="col.leftShadowCol">\r\n                    <div class="f-datagrid-cell-content" style="width: 100%">\r\n                        <span *ngIf="col.footer && col.footer.formatter" [innerHtml]="col | formatCellData: row : false: true | safe: \'html\'"></span>\r\n                        <span *ngIf="!col.footer || !col.footer.formatter">{{ col | formatCellData: row : false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</ng-template>\r\n<ng-template #footer_content_template let-columns let-left="fixedLeft" let-right="fixedRight">\r\n    <table cellpadding="0" cellspacing="0" border="0" style="border:0;height: 100%;" class="f-datagrid-rows" [style.width.px]="right? columnsGroup?.rightFixedWidth: left? columnsGroup?.leftFixedWidth: columnsGroup?.normalWidth">\r\n        <colgroup>\r\n            <col [style.width.px]="dg.checkboxColumnWidth || 36" *ngIf="dg.showCheckbox && left"/>\r\n            <col [width]="dg.lineNumberWidth + \'px\'" *ngIf="dg.showLineNumber && left"/>\r\n            <col *ngFor="let col of columns" [width]="col.width + \'px\'"/>\r\n        </colgroup>\r\n        <tbody>\r\n            <tr #tr class="f-datagrid-body-row f-datagrid-footer-row"\r\n                *ngFor="let row of data;let rowIndex = index;trackBy: dg.trackByRows" \r\n                [attr.index]="rowIndex">\r\n\r\n                <td *ngIf="dg.showCheckbox && left" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center"></td>\r\n                <td *ngIf="dg.showLineNumber  && left" class="f-datagrid-cell f-datagrid-cell-rownumber" ></td>\r\n\r\n                <td class="f-datagrid-cell {{ \'footer-td-\'+ col.field }}"\r\n                    [style.width.px]="col.width"\r\n                    [attr.colspan]="col.footer?.colspan || 1"\r\n                    [style.display]="col.footer?.visible === false ? \'none\': \'\'"\r\n                    [attr.field]="col.field" [attr.align]="col.footer?.align || col.align"\r\n                    *ngFor="let col of columns; let ci = index;"\r\n                    footer-cell-styler [column]="col" [rowData]="row" [rowIndex]="rowIndex">\r\n                    <div class="f-datagrid-cell-content" style="width: 100%">\r\n                        <span class="f-datagrid-footer-cell" *ngIf="col.footer && col.footer.formatter" [innerHtml]="col | formatCellData: row : false: true | safe: \'html\'"></span>\r\n                        <span class="f-datagrid-footer-cell" *ngIf="!col.footer || !col.footer.formatter">{{ col | formatCellData: row : false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</ng-template>\r\n\r\n<div #footerContainer class="f-datagrid-footer" [style.height.px]="height" style="overflow: hidden;"\r\n    [style.width.px]="dg.width"\r\n    [class.f-datagrid-footer-top]="position === \'top\'" [class.f-datagrid-footer-bottom]="position === \'bottom\'"\r\n    component-template [ctx]="{ footerData: data }" [cmpRef]="dg.footerComponentType"\r\n    [style.border-radius]="position === \'top\'? \'0\': \'0 0 7px 7px\'">\r\n    <ng-container *ngIf="!dg.footerTemplate && !dg.footerComponentType">\r\n        \r\n        <div #fixedLeft class="f-datagrid-body-fixed-left" \r\n            [style.width.px]="columnsGroup?.leftFixedWidth" style="height: 100%;"\r\n            *ngIf="!fast && (columnsGroup?.leftFixed && columnsGroup?.leftFixed.length  || dg?.showLineNumber || dg?.showCheckbox) ">\r\n\r\n            <ng-container *ngTemplateOutlet="footer_content_template; context: {$implicit: columnsGroup?.leftFixed, fixedLeft: true}"></ng-container>\r\n            \r\n        </div>\r\n\r\n        <div #fixedRight class="f-datagrid-body-fixed-right" style="position: absolute;border: 0;height: 100%;"\r\n            [style.width.px]="dg.showBorder?  rightFixedColumnWidth : rightFixedColumnWidth + 1" \r\n            *ngIf="!fast && columnsGroup?.rightFixed && columnsGroup?.rightFixed.length">\r\n\r\n            <ng-container *ngTemplateOutlet="footer_content_template; context: {$implicit: columnsGroup?.rightFixed, fixedRight: true}"></ng-container>\r\n            \r\n        </div>\r\n\r\n        <div #footerBody class="f-datagrid-footer-rows" style="position: absolute; height: 100%;" *ngIf="!fast"\r\n            [style.left.px]="columnsGroup?.leftFixedWidth" [style.width.px]="columnsGroup?.normalWidth" >\r\n            <ng-container *ngTemplateOutlet="footer_content_template; context: {$implicit: columnsGroup?.normalColumns}"></ng-container>\r\n        </div>\r\n\r\n\r\n        <div #footerBody2 class="f-datagrid-footer-rows" style="position: absolute;width: 100%" *ngIf="fast">\r\n            <ng-container *ngTemplateOutlet="footer_content_template_fast; context: {$implicit: columnsGroup?.columns}"></ng-container>\r\n        </div>\r\n\r\n\r\n    </ng-container>\r\n\r\n\r\n    <ng-container *ngIf="dg.footerTemplate && !dg.footerComponentType" [ngTemplateOutlet]="dg.footerTemplate" [ngTemplateOutletContext]="{footerData: data }" ></ng-container>\r\n    \r\n</div>'}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.Injector},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]}]},t.propDecorators={data:[{type:e.Input}],height:[{type:e.Input}],width:[{type:e.Input}],columns:[{type:e.Input}],columnsGroup:[{type:e.Input}],position:[{type:e.Input}],hasFixedColumns:[{type:e.Input}],fast:[{type:e.Input}],footerContainer:[{type:e.ViewChild,args:["footerContainer"]}],footerBody:[{type:e.ViewChild,args:["footerBody"]}],footerBody2:[{type:e.ViewChild,args:["footerBody2"]}],fixedLeft:[{type:e.ViewChild,args:["fixedLeft"]}],fr:[{type:e.ViewChild,args:["fixedRight"]}]},t}(),Gt=function(){function t(t,i,r){this.el=t,this.cd=i,this.inject=r,this.pagerPos="right",this.id="farris-datagrid-pager",this.maxSize=7,this.directionLinks=!0,this.autoHide=!1,this.responsive=!1,this.previousLabel="上页",this.nextLabel="下页",this.showPageList=!1,this.showPageInfo=!0,this.showPageNumber=!0,this.locked=!1,this.selectedData=[],this.viewMode="default",this.showSelectedList=!1,this.showGotoInput=!1,this.contentTemplate=null,this.data=null,this.pageChange=new e.EventEmitter,this.pageSizeChange=new e.EventEmitter,this.removeSelectedItem=new e.EventEmitter,this.clearSelectedItem=new e.EventEmitter,this.styles={opacity:1},this.mouseInSelectedList=!1,this.openSelectedList=!1,this.selectionDataChange$=null,this.overLayService=null,this.inject&&(this.notifySer=this.inject.get(y.NotifyService,null)),this.overLayService=new l.OverLayHiddenService}return Object.defineProperty(t.prototype,"pagination",{get:function(){return this.pager.paginationDirective},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSize",{get:function(){return this.pagination.getPageSize()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"total",{get:function(){return this.pagination.getTotalItems()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outerHeight",{get:function(){return this.pc?this.pc.nativeElement.offsetHeight:40},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.listenCheckDataChanged()},t.prototype.ngAfterViewInit=function(){this.lockedStyles()},t.prototype.ngOnChanges=function(t){t.selectedData&&!t.selectedData.isFirstChange()&&(this.selectedData&&this.selectedData.length||this.closeSelectedList()),t.showSelectedList&&!t.showSelectedList.isFirstChange()&&this.listenCheckDataChanged(),t.locked&&!t.locked.isFirstChange()&&this.lockedStyles()},t.prototype.listenCheckDataChanged=function(){var t=this;if(this.showSelectedList){var e=this.inject.get(xt,null);e&&(this.selectionDataChange$=e.checkedChange.subscribe(function(e){t.selectedData=e,t.cd.destroyed||t.cd.detectChanges()}),this.resized$=e.resized.subscribe(function(){t.closeSelectedList()}))}else this.selectionDataChange$&&(this.selectionDataChange$.unsubscribe(),this.selectionDataChange$=null)},t.prototype.onPageChange=function(t){"object"==typeof t&&(t=t.pageIndex||1),this.pageChange.emit(Number.parseInt(t,10))},t.prototype.onPageSizeChange=function(t){this.pageSizeChange.emit(Number.parseInt(t,10))},t.prototype.lock=function(){this.locked=!0,this.lockedStyles()},t.prototype.unlock=function(){this.locked=!1,this.lockedStyles()},t.prototype.lockedStyles=function(){this.styles={opacity:this.locked?.5:1},this.cd.detectChanges()},t.prototype.onMouseEnter=function(t){var e=this;if(t.stopPropagation(),!this.locked){this.mouseInSelectedList=!0,this.selectedData&&this.selectedData.length?this.openSelectedList=!this.openSelectedList:this.openSelectedList=!1;var i=t.target;if(i.classList.contains("selected-list-badge")||(i=t.target.closest(".selected-list-badge")),this.openSelectedList){var r=this.el.nativeElement.querySelector(".pager-overlay-container"),n=i.closest(".modal-dialog"),o=i.getBoundingClientRect(),s=o.top,l=o.left;if(r){if(n){var a=n.getBoundingClientRect();s-=a.top,l-=a.left}r.style.top=s+"px",r.style.left=l-10+"px"}this.overLayService.registerMouseEvent(this.selectItemPanel.nativeElement,function(t){e.selectItemPanel.nativeElement.contains(t.target)||t.target.classList.contains("selected-list-badge")||t.target.closest(".selected-list-badge")||(e.closeSelectedList(),e.overLayService.destory(e.selectItemPanel.nativeElement))})}}},t.prototype.closeSelectedList=function(){this.openSelectedList=!1,this.mouseInSelectedList=!1,this.cd.destroyed||this.cd.detectChanges()},t.prototype.onDelSelectedItem=function(t){this.removeSelectedItem.emit(t)},t.prototype.onClearSelected=function(t){this.clearSelectedItem.emit(),this.closeSelectedList()},t.prototype.onSelectListPanelClose=function(t){this.closeSelectedList()},t.decorators=[{type:e.Component,args:[{selector:"datagrid-pager",template:'<div class="f-datagrid-pager" #pagerContainer [ngStyle]="styles">\r\n    <pagination-controls #pager [id]="id" [maxSize]="maxSize"\r\n        [directionLinks]="directionLinks"\r\n        [showPageList]="showPageList"\r\n        [showPageInfo]="showPageInfo"\r\n        [showPageNumber]="showPageNumber"\r\n        [autoHide]="autoHide" [responsive]="responsive"\r\n        [previousLabel]="previousLabel" [nextLabel]="nextLabel"\r\n        [showGotoInput]="showGotoInput"\r\n        (pageChange)="onPageChange($event)"\r\n        (pageSizeChange)="onPageSizeChange($event)"\r\n        [position]="pagerPos"\r\n        [viewMode]="viewMode" [showSelectedList]="showSelectedList">\r\n\r\n        <div class="pager-overlay-container" style="position:fixed;z-index: 999999;" #selectItemPanel>\r\n            <pager-selected-list *ngIf="openSelectedList"\r\n                [data]="selectedData | selectedItem: listItemFormatter"\r\n                (close)="onSelectListPanelClose($event)"\r\n                (remove)="onDelSelectedItem($event)"\r\n                (clear)="onClearSelected($event)"\r\n            ></pager-selected-list>\r\n        </div>\r\n\r\n        <div class="flex-fill pager-pos-right" style="left: 0" [style.position]="pagerPos===\'center\'? \'absolute\':\'relative\'">\r\n            <div class="d-flex flex-row" style="align-items: center;">\r\n                <span class="badge badge-pill badge-light mr-2 selected-list-badge" *ngIf="showSelectedList"\r\n                    style="cursor:pointer" [attr.title]="\'datagrid.selectionData.tooltip\' | locale"\r\n                    [class.badge-primary]="mouseInSelectedList"\r\n                    [innerHTML]="\'datagrid.selectionData.currentLenth\' | locale | replaceX: selectedData.length"\r\n                    (click)="onMouseEnter($event)">\r\n                </span>\r\n\r\n                <div class="f-utils-fill mr-2 content-template" *ngIf="contentTemplate && pagerPos === \'right\'">\r\n                    <ng-container [ngTemplateOutlet]="contentTemplate" [ngTemplateOutletContext]="{ footerData: data }"></ng-container>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <div class="flex-fill pager-pos-left" *ngIf="pagerPos === \'left\'">\r\n            <div class="d-flex flex-row" style="align-items: center;">\r\n                \r\n                <div class="f-utils-fill mr-2 content-template" *ngIf="contentTemplate">\r\n                    <ng-container [ngTemplateOutlet]="contentTemplate" [ngTemplateOutletContext]="{ footerData: data }"></ng-container>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n\r\n    </pagination-controls>\r\n</div>'}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:e.Injector,decorators:[{type:e.Optional}]}]},t.propDecorators={pagerPos:[{type:e.Input}],id:[{type:e.Input}],maxSize:[{type:e.Input}],directionLinks:[{type:e.Input}],autoHide:[{type:e.Input}],responsive:[{type:e.Input}],previousLabel:[{type:e.Input}],nextLabel:[{type:e.Input}],showPageList:[{type:e.Input}],showPageInfo:[{type:e.Input}],showPageNumber:[{type:e.Input}],locked:[{type:e.Input}],selectedData:[{type:e.Input}],viewMode:[{type:e.Input}],listItemFormatter:[{type:e.Input}],showSelectedList:[{type:e.Input}],showGotoInput:[{type:e.Input}],contentTemplate:[{type:e.Input}],data:[{type:e.Input}],pageChange:[{type:e.Output}],pageSizeChange:[{type:e.Output}],removeSelectedItem:[{type:e.Output}],clearSelectedItem:[{type:e.Output}],pc:[{type:e.ViewChild,args:["pagerContainer"]}],pager:[{type:e.ViewChild,args:["pager"]}],selectItemPanel:[{type:e.ViewChild,args:["selectItemPanel"]}]},t}(),Nt=function(){function t(t){this.domSanitizer=t}return t.prototype.ngOnInit=function(){this.loading?this.loading=this.domSanitizer.bypassSecurityTrustHtml(this.loading):this.loading=this.domSanitizer.bypassSecurityTrustHtml('<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n  <circle cx="50" cy="50" fill="none" r="30" stroke="#2c7dff" stroke-width="10"></circle>\n  <circle cx="50" cy="50" fill="none" r="30" stroke="#d0eaff" stroke-width="10" stroke-linecap="square" transform="rotate(178.821 50 50)">\n      <animateTransform attributeName="transform" type="rotate"\n          calcMode="linear" values="0 50 50;180 50 50;720 50 50" keyTimes="0;0.5;1" dur="1.6s" begin="0s"\n          repeatCount="indefinite"></animateTransform>\n      <animate attributeName="stroke-dasharray" calcMode="linear"\n          values="9.42477796076938 179.0707812546182;150.79644737231007 37.6991118430775;9.42477796076938 179.0707812546182"\n          keyTimes="0;0.5;1" dur="1.6" begin="0s" repeatCount="indefinite"></animate>\n  </circle>\n</svg>')},t.decorators=[{type:e.Component,args:[{selector:"datagrid-loading",template:'\n    <div style="width:100%;height:100%;position:absolute;top:0;left: 0;background:rgba(255,255,255,0);z-index: 90000000;pointer-events: unset;">\n        <div style="width: 50px;height: 50px;position: relative;top: 50%;margin-top: -25px;left: 50%;margin-left: -25px;"\n        [innerHTML]="loading" >\n        </div>\n    </div>\n    '}]}],t.ctorParameters=function(){return[{type:f.DomSanitizer}]},t.propDecorators={loading:[{type:e.Input}]},t}(),zt=function(){function t(){this.data=[],this.close=new e.EventEmitter,this.remove=new e.EventEmitter,this.clear=new e.EventEmitter,this.trackByFn=function(t,e){return e.id}}return t.prototype.ngOnInit=function(){},t.prototype.ngOnChanges=function(t){},t.prototype.onClose=function(t){t.stopPropagation(),this.close.emit()},t.prototype.onRemoveClick=function(t,e){t.stopPropagation(),this.remove.emit(e)},t.prototype.onClearClick=function(t){t.stopPropagation(),this.clear.emit()},t.prototype.onClick=function(t){return t.stopPropagation(),!1},t.decorators=[{type:e.Component,args:[{selector:"pager-selected-list",template:'\r\n<div class="f-cmp-pager-selected-list-wrapper " style="bottom: 10px">\r\n\t<div class="selected-list--content" (click)="onClick($event)">\r\n\t\t<div class="selected-list--arrow"></div>\r\n\t\t<div class="selected-list--title">\r\n            <div class="btn-group">\r\n                <button class="btn btn-link" (click)="onClearClick($event)"> \r\n                    <i class="f-icon f-icon-remove"></i>\r\n                    <span class="btn-text">{{ \'datagrid.selectionData.clearAll\' | locale: \'清空\' }}</span>\r\n                </button>\r\n            </div>\r\n            <div class="selected-list--close"><span class="f-icon f-icon-close" (click)="onClose($event)"></span></div>\r\n        </div> <div class="selected-list--main">\r\n            <ul class="selected-list">  \x3c!-- selected-list--wrap --\x3e\r\n                <li class="selected-list--item ng-star-inserted" *ngFor="let item of data; trackBy: trackByFn"  style="min-height: 35px;" title="{{item.text}}">\r\n\t\t\t\t\t<span class="f-icon f-icon-close-outline list-icon list-error" (click)="onRemoveClick($event, item.id)"></span>\r\n                    <div class="list-con" [innerHTML]="item.text"></div>\r\n                </li>\r\n                \r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n'}]}],t.ctorParameters=function(){return[]},t.propDecorators={data:[{type:e.Input}],close:[{type:e.Output}],remove:[{type:e.Output}],clear:[{type:e.Output}]},t}(),Vt=function(){function t(){}return t.prototype.transform=function(t,e){if(t)return t=e?t.map(function(t){return{id:t.id,text:e(t.data)}}):t.map(function(t){var e=[];return Object.keys(t.data).forEach(function(i){e.push(t.data[i])}),{id:t.id,text:e.join(", ")}})},t.decorators=[{type:e.Pipe,args:[{name:"selectedItem"}]}],t}(),Wt=function(){function t(){}return t.prototype.handleError=function(t){console.error(t)},t}(),$t=function(){function t(){}return t.prototype.handleError=function(t){console.error(t)},t}(),Bt=function(){function t(t,i){this.injector=t,this.dg=i,this.indeterminate=!1,this.checked$=null,this.destroy$=new r.Subject,this.subscriptions=[],this.dfs=this.injector.get(Z),this.cd=this.injector.get(e.ChangeDetectorRef)}return t.prototype.ngOnInit=function(){this.indeterminate&&(this.chk.nativeElement.indeterminate=!0),this.listenSubjects()},t.prototype.ngOnChanges=function(t){t.checked&&!t.checked.isFirstChange()&&this.changeCheckedStatus(t.checked.currentValue)},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[])},t.prototype.listenSubjects=function(){var t=this,e=this.dfs.primaryId(this.rowData);this.subscriptions.push(this.dg.checkAll.pipe(n.takeUntil(this.destroy$)).subscribe(function(){var i=!0;t.dg.disableRow&&((i=!t.dg.disableRow(t.rowData,t.rowIndex))||(i=t.dg.dfs.isRowChecked(e))),t.changeCheckedStatus(i)})),this.subscriptions.push(this.dg.unCheckAll.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){e&&e.length?e.find(function(e){return e[t.dg.idField]===t.rowData[t.dg.idField]})&&t.changeCheckedStatus(!1):t.changeCheckedStatus(!1)}));var i=this.dg.dgs.setCheckedRows.pipe(n.takeUntil(this.destroy$)).pipe(n.filter(function(t){return t.ids.includes(e)||t.ids.includes(""+e)}),n.map(function(t){var i=t.ids.includes(e)||t.ids.includes(""+e);return!!i&&(i&&t.checked)})).subscribe(function(e){t.checked=e,t.changeCheckedStatus(e)});this.subscriptions.push(i),this.dfs.updateCheckboxState$.pipe(n.takeUntil(this.destroy$)).pipe(n.filter(function(t){return t.id===e}),n.map(function(t){return!!t.checked})).subscribe(function(e){t.checked=e,t.changeCheckedStatus(e)})},t.prototype.handleClick=function(t){var e=this;if(!this.disabled){var i={rowIndex:this.rowIndex,rowData:this.rowData,gridInstance:this.dg};this.dg.endCellEdit(),this.chk.nativeElement.checked?this.dg.beforeUncheck(i).subscribe(function(t){t&&(e.dfs.unCheckRow(e.rowIndex,e.rowData,{instance:e.dg}),e.checked=!1,e.changeCheckedStatus(!1),e.dg.showSelectedList&&e.dg.cd.detectChanges())}):this.dg.beforeCheck(i).subscribe(function(t){t&&(e.dfs.checkRow(e.rowIndex,e.rowData,{instance:e.dg}),e.checked=!0,e.changeCheckedStatus(!0))})}t.stopPropagation()},t.prototype.changeCheckedStatus=function(t){this.chk.nativeElement.checked=t},t.decorators=[{type:e.Component,args:[{selector:"datagrid-checkbox",template:' <div class="custom-control custom-checkbox f-checkradio-single">\n        <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked">\n        <label class="custom-control-label" (click)="handleClick($event)"></label>\n    </div>',styles:["\n        :host {\n            vertical-align: middle;\n        }\n        :host .custom-checkbox {\n            opacity: 1;\n            float: none;\n            top: 2px;\n        }\n        "]}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:xt,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return xt})]}]}]},t.propDecorators={rowData:[{type:e.Input}],rowIndex:[{type:e.Input}],checked:[{type:e.Input}],disabled:[{type:e.Input}],indeterminate:[{type:e.Input}],chk:[{type:e.ViewChild,args:["chk"]}]},t}(),Ut=function(){function t(t){this.injector=t,this.indeterminate=!1,this.destroy$=new r.Subject,this.dfs=this.injector.get(Z),this.dg=this.injector.get(xt)}return t.prototype.ngOnInit=function(){var t=this;this.indeterminate&&(this.chk.nativeElement.indeterminate=!0),this.dg.dgs.changeCheckAllStatus.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){2===e?t.chk.nativeElement.indeterminate=!0:(t.chk.nativeElement.indeterminate=!1,t.updateStatus(!!e))})},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},t.prototype.updateStatus=function(t){this.checked=t,this.chk.nativeElement.checked=t},t.prototype.handleClick=function(t){this.dg.data&&this.dg.data.length&&(this.disabled||(this.checked=!this.checked,this.indeterminate=!1,this.chk.nativeElement.indeterminate=!1,this.checked?(this.dfs.checkAll(),this.chk.nativeElement.checked=!0):(this.dfs.clearCheckeds(!this.dg.enableMorePageSelect),this.dg.selectedRow&&this.dg.checkOnSelect&&this.dg.selectOnCheck&&this.dg.unSelectRow(this.dg.selectedRow.id),this.chk.nativeElement.checked=!1)),t.stopPropagation())},t.decorators=[{type:e.Component,args:[{selector:"datagrid-header-checkbox",template:' <div class="custom-control custom-checkbox f-checkradio-single">\n        <input type="checkbox" #chk class="custom-control-input" [disabled]="disabled" [checked]="checked">\n        <label class="custom-control-label" (click)="handleClick($event)"></label>\n    </div>',styles:["\n        :host {\n            vertical-align: middle;\n        }\n        :host .custom-checkbox {\n            opacity: 1;\n            float: none;\n            top: 4px;\n        }\n        "]}]}],t.ctorParameters=function(){return[{type:e.Injector}]},t.propDecorators={checked:[{type:e.Input}],disabled:[{type:e.Input}],indeterminate:[{type:e.Input}],chk:[{type:e.ViewChild,args:["chk"]}]},t}(),Xt=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e,i,r){if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),t){var n="row_"+this.dfs.primaryId(t);return e?n+="_fixedright":i&&(n+="_fixedleft"),r&&(n+="_grouprow"),n}return null},t.decorators=[{type:e.Pipe,args:[{name:"rowDataId"}]}],t.ctorParameters=function(){return[{type:Z}]},t}(),qt=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e,i){if(t){var r=t.value;if(!e&&this.dfs&&(e=this.dfs.getColumn(t.field)),e&&e.formatter&&"enum"===e.formatter.type){var n=e.formatter.options,o=x({},n),s=o.valueField,l=o.textField,a=o.data.find(function(e){return e[s]===t.value});r=a?a[l]:""}return i?i(t):r}return""},t.decorators=[{type:e.Pipe,args:[{name:"formatGroupRow"}]}],t.ctorParameters=function(){return[{type:Z,decorators:[{type:e.Optional}]}]},t}(),Yt=function(){function t(t,i,n,o,s,l,a){this.cd=t,this.dg=i,this.dgb=n,this.dfs=o,this.el=s,this.injector=l,this.ngZone=a,this.columns=[],this.toggle=new e.EventEmitter,this.checkedRows=[],this.selectedRows=[],this.data=[],this.groupRowIndex=V,this.isGroupRow=W,this.groupRow=$,this.isGroupFooter=B,this.visible=U,this.groupLevelField=X,this.filterConditions="",this.subscriptions=[],this.dgs=null,this.destroy$=new r.Subject,this.dgs=this.injector.get(J),this.render2=this.injector.get(e.Renderer2)}return t.prototype.listenSubject=function(){var t=this,e=this.dgs.setSelecedRow.pipe(n.takeUntil(this.destroy$)).subscribe(function(e){t.detectChanges()});this.subscriptions.push(e),this.dfs.checkRow$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.checkedRows=t.dfs.getCheckeds(),t.detectChanges()}),this.dfs.clearCheckeds$.pipe(n.takeUntil(this.destroy$)).subscribe(function(){t.checkedRows=t.dfs.getCheckeds(),t.detectChanges()})},t.prototype.ngOnInit=function(){this.listenSubject()},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.subscriptions&&this.subscriptions.length&&(this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions=[])},t.prototype.detectChanges=function(){this.cd.destroyed||this.cd.detectChanges()},t.prototype.toggleGroupRow=function(t,e,i,r){r&&r.stopPropagation(),t.expanded=i,this.dg.dfs.setGroupRowsVisible(t,i)},t.prototype.getGroupSummaryData=function(t){var e=this.dg.getRows();if(e&&e.length){var i=this.dg.getRows().find(function(e){return e.__group_parent_id__===t&&e.__group_footer__});if(i)return i.data}return null},t.prototype.getGroupColumn=function(t){return this.dg.flatColumns.find(function(e){return e.field===t})},t.decorators=[{type:e.Component,args:[{selector:"fixed-left-rows",template:'\r\n<ng-template #groupActionCell>\r\n    <td *ngIf="dg.showLineNumber || dg.showCheckbox" class="f-datagrid-cell f-datagrid-group-action"></td>\r\n</ng-template>\r\n\r\n<ng-template #grouprowControl let-ctx>\r\n    <div class="d-flex flex-row" style="align-items: center; white-space: nowrap;">\r\n        <span class="f-icon f-datagrid-group-expanded ml-1 mr-1" *ngIf="!ctx.row.expanded" (click)="toggleGroupRow(ctx.row, ctx.index, true, $event)"></span>\r\n        <span class="f-icon f-datagrid-group-collapsed ml-1 mr-1" *ngIf="ctx.row.expanded" (click)="toggleGroupRow(ctx.row, ctx.index, false, $event)"></span>\r\n        <span class="f-utils-fill group-row-text" *ngIf="dg.groupFormatter" [innerHTML]="ctx.row | formatGroupRow: \'\': dg.groupFormatter| safe: \'html\' "></span>\r\n        <span class="f-utils-fill  group-row-text" *ngIf="!dg.groupFormatter"> {{ ctx.row | formatGroupRow: getGroupColumn(ctx.row.field)  }} </span>\r\n    </div>\r\n</ng-template>\r\n\r\n\r\n<table class="f-datagrid-rows" style="width: 100%" cellpadding="0" cellspacing="0" row-hover row-dblclick>\r\n    <colgroup>\r\n        <col [style.width.px]="dg.checkboxColumnWidth || 36" *ngIf="dg.showCheckbox" />\r\n        <col [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber" />\r\n        <col *ngFor="let col of columns" [style.width.px]="col.width" />\r\n    </colgroup>\r\n\r\n\r\n    <tbody *ngIf="dg.groupRows && dg.groupField">\r\n        <ng-container *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n            <tr *ngIf="row[isGroupRow]" [style.display]="row[visible] ? \'\': \'none\'" [group-row]="row" \r\n            [attr.id]="row | rowDataId: false: true " class="f-datagrid-body-row fixed-left-row f-datagrid-group-row" [attr.index]="dgb.startRowIndex + i">\r\n\r\n                \x3c!-- <ng-container *ngIf="dg.showLineNumber && dg.showCheckbox; else groupActionCell">\r\n                    <td class="f-datagrid-cell f-datagrid-cell-checkbox"></td>\r\n                    <td class="f-datagrid-cell f-datagrid-cell-rownumber"></td>\r\n                    </ng-container>\r\n                    <td [cell-editable]="row" [column]="col" [attr.field]="col.field" class="f-datagrid-cell" [attr.align]="col.align" *ngFor="let col of columns; let ci = index;">\r\n                        <grid-body-cell [width]="col.width" [height]="dg.rowHeight" [column]="col" [rowData]="row" [rowIndex]="dgb.startRowIndex + i"></grid-body-cell>\r\n                    </td> \r\n                --\x3e\r\n                <td class="f-datagrid-cell f-datagrid-cell-checkbox" *ngIf="dg.showCheckbox"></td>\r\n                <td class="f-datagrid-cell f-datagrid-cell-rownumber" *ngIf="dg.showLineNumber"></td>\r\n\r\n                <td *ngIf="!(dg.groupSummaryPosition === \'inGroupRow\')" class="f-datagrid-cell" [attr.colspan]="columns.length" [style.paddingLeft.px]="row[groupLevelField] * 15">\r\n\r\n                    <ng-container [ngTemplateOutlet]="grouprowControl" [ngTemplateOutletContext]="{$implicit: { row: row, index: i }}"></ng-container>\r\n                    \r\n                </td>\r\n\r\n                <ng-container *ngIf="dg.groupSummaryPosition === \'inGroupRow\'">\r\n\r\n                    <ng-container *ngFor="let col of columns; let ci = index;">\r\n                        <td *ngIf="ci === 0" class="f-datagrid-cell" [style.paddingLeft.px]="row[groupLevelField] * 15" [attr.colspan]="dg.groupCellColSpan">\r\n\r\n                            <ng-container [ngTemplateOutlet]="grouprowControl" [ngTemplateOutletContext]="{$implicit: { row: row, index: i }}"></ng-container>\r\n\r\n                        </td>\r\n                             \r\n                        <td class="f-datagrid-cell"  \r\n                            *ngIf="ci > 0 && ci >= dg.groupCellColSpan"\r\n                            [attr.field]="col.field" \r\n                            [attr.align]=" col.groupFooter?.align || col.align">\r\n                            <div class="f-datagrid-cell-content" [innerHTML]="col | formatCellData: getGroupSummaryData(row.id) : true: false | safe: \'html\'"></div>\r\n                        </td>\r\n                    </ng-container>\r\n                </ng-container>\r\n            </tr>\r\n\r\n            <ng-container *ngIf="!row[isGroupRow]">\r\n\r\n                <ng-container *ngIf="row[isGroupFooter] && dg.groupSummaryPosition === \'groupFooterRow\'">\r\n                    <tr class="f-datagrid-body-row fixed-left-row f-datagrid-group-footer" [group-footer-row-styler]="row"\r\n                        [attr.index]="dgb.startRowIndex + i" [style.display]="row[visible] ? \'\': \'none\'">\r\n                        <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox"></td>\r\n                        <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber"></td>\r\n                        \r\n                        <td class="f-datagrid-cell"\r\n                            [attr.field]="col.field" \r\n                            [attr.colspan]="col.groupFooter?.colspan || 1"\r\n                            [attr.align]=" col.groupFooter?.align || col.align"\r\n                            [style.display]="col.groupFooter?.visible === false ? \'none\': \'\'"\r\n                            footer-cell-styler [column]="col" [rowData]="row" [isGroupFooter]="true"\r\n                            *ngFor="let col of columns; let ci = index;"\r\n                            [style.paddingLeft.px]="(ci === 0 ) ? row[groupLevelField] * 10 + 25 : 0">\r\n                            <div class="f-datagrid-cell-content" [innerHTML]="col | formatCellData: row.data : true: false | safe: \'html\'"></div>\r\n                        </td>\r\n                    </tr>\r\n                </ng-container>\r\n                <ng-container *ngIf="!row[isGroupFooter]">\r\n                    <tr class="f-datagrid-body-row fixed-left-row" [attr.index]="dgb.startRowIndex + i"\r\n                        [class.f-datagrid-row-selected]="row | rowIsSelected: selectedRows" [grid-row]="row"\r\n                        [rowIndex]="dgb.startRowIndex + i" [attr.id]="row | rowDataId: false: true "\r\n                        [class.f-datagrid-disable-row]="row | disableRow: (dgb.startRowIndex + i) : dg.disableRow"\r\n                        [style.display]="row[visible] ? \'\': \'none\'">\r\n\r\n                        <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center">\r\n                            <div class="f-datagrid-cell-content checkbox-column"  style="text-overflow: unset;">\r\n                                <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow"\r\n                                    [rowData]="row" [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                            </div>\r\n                        </td>\r\n\r\n                        <td *ngIf="dg.showLineNumber" class="f-datagrid-cell f-datagrid-cell-rownumber">\r\n                            <div class="f-datagrid-cell-content" *ngIf="dg.virtualized">\r\n                                {{ dg.pageSize * (dg.pageIndex-1) + row[groupRowIndex] + 1 }}\r\n                            </div>\r\n                            <div class="f-datagrid-cell-content" *ngIf="!dg.virtualized">\r\n                                {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + row[groupRowIndex] + 1 }}\r\n                            </div>\r\n                        </td>\r\n                        <td [cell-editable]="row" [column]="col" [attr.field]="col.field" class="f-datagrid-cell"\r\n                            [attr.align]="col.align" *ngFor="let col of columns; let ci = index;"\r\n                            [style.paddingLeft.px]="(ci === 0 ) ? row[groupLevelField] * 10 + 25 : 0">\r\n                            <grid-body-cell [width]="col.width" [height]="dg.rowHeight" [column]="col" [rowData]="row"\r\n                                [rowIndex]="dgb.startRowIndex + i"></grid-body-cell>\r\n                        </td>\r\n                    </tr>\r\n\r\n                </ng-container>\r\n\r\n            </ng-container>\r\n\r\n        </ng-container>\r\n\r\n    </tbody>\r\n\r\n\r\n    <tbody *ngIf="!dg.groupRows || !dg.groupField">\r\n        <tr class="f-datagrid-body-row fixed-left-row" [attr.index]="dgb.startRowIndex + i"\r\n            [class.f-datagrid-row-selected]="row | rowIsSelected" [grid-row]="row" \r\n            [rowIndex]="dgb.startRowIndex + i" [attr.id]="row | rowDataId: false: true "\r\n            [class.f-datagrid-disable-row]="row | disableRow: (dgb.startRowIndex + i) : dg.disableRow"\r\n            *ngFor="let row of data; trackBy: dg.trackByRows; let i = index"\r\n        >\r\n            <td *ngIf="dg.showCheckbox" class="f-datagrid-cell f-datagrid-cell-checkbox" style="text-align: center">\r\n                <div class="f-datagrid-cell-content checkbox-column" style="text-overflow: unset;">\r\n                <datagrid-checkbox [disabled]="row | disableRow: dgb.startRowIndex + i: dg.disableRow" [rowData]="row"\r\n                    [rowIndex]="dgb.startRowIndex + i" [checked]="row | rowIsChecked: checkedRows"></datagrid-checkbox>\r\n                </div>\r\n            </td>\r\n\r\n            <td *ngIf="dg.showLineNumber" [style.width.px]="dg.lineNumberWidth"  class="f-datagrid-cell f-datagrid-cell-rownumber">\r\n                <div class="f-datagrid-cell-content">\r\n                    {{ dg.pageSize * (dg.pageIndex-1) + dgb.startRowIndex + i + 1 }}\r\n                </div>\r\n            </td>\r\n\r\n            <td [cell-editable]="row" [column]="col" [attr.field]="col.field" class="f-datagrid-cell"\r\n                [attr.align]="col.align" *ngFor="let col of columns; let ci = index;">\r\n                <grid-body-cell [width]="col.width" [height]="dg.rowHeight" [column]="col" [rowData]="row"\r\n                    [rowIndex]="dgb.startRowIndex + i"></grid-body-cell>\r\n            </td>\r\n        </tr>\r\n    </tbody>\r\n\r\n\r\n\r\n\r\n</table>'}]}],t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:xt},{type:It},{type:Z},{type:e.ElementRef},{type:e.Injector},{type:e.NgZone}]},t.propDecorators={columns:[{type:e.Input}],toggle:[{type:e.Output}],checkedRows:[{type:e.Input}],selectedRows:[{type:e.Input}],data:[{type:e.Input}]},t}(),Kt=function(){function t(){}return t.prototype.transform=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.forEach(function(e,i){t=t.replace("{"+i+"}",e)}),t},t.decorators=[{type:e.Pipe,args:[{name:"replaceX"}]}],t}(),Zt=function(){function t(t,e,i,r){this.injector=t,this.render=e,this.el=i,this.dg=r}return t.prototype.ngOnInit=function(){var t=this;setTimeout(function(){if(t.dg&&t.dg.groupStyler){var e=t.el.nativeElement,i=Array.from(e.classList).find(function(t){return t.indexOf("customgrouprowcls_")>-1});i&&e.classList.remove(i);var r=t.dg.groupStyler(t.groupRow);if(!r)return;e.id||(e.id="group-tr_"+t.groupRow.id);var n="customgrouprowcls_"+t.dg.idService.encrypt(JSON.stringify(r));t.render.addClass(e,n),t.dg.renderCustomStyle2(r,e,n)}})},t.decorators=[{type:e.Directive,args:[{selector:"[group-row]"}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.Renderer2},{type:e.ElementRef},{type:xt}]},t.propDecorators={groupRow:[{type:e.Input,args:["group-row"]}]},t}(),Jt=function(){function t(){}return t.prototype.transform=function(t){return!(!t||!t.length)&&t.find(function(t){return"required"===t.type})},t.decorators=[{type:e.Pipe,args:[{name:"showStar"}]}],t}(),Qt=function(){function t(){}return t.prototype.transform=function(t,e,i){return!!i&&i(t,e)},t.decorators=[{type:e.Pipe,args:[{name:"disableRow"}]}],t}(),te=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t){return this.dfs.isRowSelected(t)},t.decorators=[{type:e.Pipe,args:[{name:"selectedRow"}]}],t.ctorParameters=function(){return[{type:Z}]},t}(),ee=function(){function t(){}return t.prototype.transform=function(t,e,i){return void 0===i&&(i=!1),Y.getValue(t,e,i)},t.decorators=[{type:e.Pipe,args:[{name:"fieldvalue"}]}],t}(),ie=function(){function t(t,i){this.el=t,this.injector=i,this.position="top-left",this.delay=1e3,this.cls="",this.type="info",this.tipMode="auto",this.showTipTimer=null,this._mouseenter=null,this._mouseleave=null,this._mouseclick=null,this.ngZone=null,this.render=null,this.injector?(this.commonUtils=this.injector.get(l.CommonUtils,new l.CommonUtils),this.ngZone=this.injector.get(e.NgZone),this.render=this.injector.get(e.Renderer2),this.dg=this.injector.get(xt)):this.commonUtils=new l.CommonUtils}return t.prototype.ngOnInit=function(){var t=this;this.ngZone&&this.enable&&this.ngZone.runOutsideAngular(function(){t._mouseenter=Y.on(t.el.nativeElement,"mouseenter",t.onMouseEnter.bind(t),{target:".f-datagrid-cell-content",options:{capture:!0}}),t._mouseleave=Y.on(t.el.nativeElement,"mouseleave",t.onMouseLeave.bind(t),{target:".f-datagrid-cell-content",options:{capture:!0}}),t._mouseclick=Y.on(t.el.nativeElement,"mousedown",t.onClick.bind(t))})},t.prototype.ngOnDestroy=function(){this.hide(),this._mouseenter&&this._mouseenter(),this._mouseleave&&this._mouseleave(),this._mouseclick&&this._mouseclick()},t.prototype.onMouseEnter=function(t){var e=this;if(this.enable&&(!t.fromElement||t.fromElement.closest(".f-datagrid"))){var i=this.dg?this.dg.cellTipTimer:1e3;this.showTipTimer&&(clearTimeout(this.showTipTimer),this.showTipTimer=null),this.showTipTimer=setTimeout(function(){e.show(t)},i)}},t.prototype.onMouseLeave=function(){this.hide()},t.prototype.onClick=function(t){this.hide()},t.prototype.getTextContainer=function(){return rt.findSingle(this.container,".f-tooltip-text")},t.prototype.donotShowTips=function(t){var e=t.offsetWidth,i=window.getComputedStyle(t),r=this.commonUtils.getTextWidth(this.message,i.font),n=i.paddingLeft,o=i.paddingRight,s=e-(Number(n.replace("px",""))||0)-(Number(o.replace("px",""))||0),l=t.closest("tr");if(l){var a=l.id;l=Y.getTrDomById(a,document)}return"auto"===this.tipMode?!l||s&&s>r:!l},t.prototype.hide=function(){this.enable&&(this.showTipTimer&&(clearTimeout(this.showTipTimer),this.showTipTimer=null),this.container&&this.container.parentElement&&document.body.removeChild(this.container),this.container=null)},t.prototype.show=function(t){var e=t.target;if(this.message=e.getAttribute("message"),this.tipMode=e.getAttribute("tipMode")||"auto",this.enable&&this.message){var i=e.getAttribute("tipWidth"),r=e.getAttribute("tipHeight");if(this.position=e.getAttribute("position")||"top-left",!this.donotShowTips(t.target)||e.innerText!==this.message){var n=t.target,o=this.getBoxSizeObj(n);this.container?rt.findSingle(this.container,".f-tooltip-text").innerHTML=this.message:this.create(o),this.container.style.maxWidth=window.innerWidth-30+"px",this.container.style.minWidth="35px",i&&(this.container.style.width=i),r&&(this.container.style.height=r);var s,l,a=rt.getOffset(n),d=a.top,c=a.left;this.container.style.display="block",this.changeTooltipPosition(n);var h=rt.findSingle(this.container,".f-tooltip-arrow"),u=this.getTooltipSize();if(window.innerHeight-10<u.height){this.container.style.height=window.innerHeight-20+"px",u.height=window.innerHeight-25;var p=this.getTextContainer();p.style.height=u.height+"px",p.style.overflow="hidden"}var f=this.updateArrowPosition(h,a,t);switch(this.position){case"right":s=c+o.width,l=f;break;case"left":s=c-u.width,l=f;break;case"top-left":l=d-u.height-7,s=f}s&&(this.container.style.left=s+"px"),this.container.style.top=l+"px",this.container.style.zIndex=999999}}},t.prototype.updateArrowPosition=function(t,e,i){var r=this.getTooltipSize();if("left"===this.position||"right"===this.position){var n=e.top,o=r.height/2,s=10;return n>o&&window.innerHeight-n>o&&(s=n-r.height/2),t&&(t.style.top=n-s+"px"),s}if("top-left"===this.position){var l=i.pageX-r.width/2;return l<10&&(l=e.left),l+r.width>window.innerWidth&&(l=window.innerWidth-r.width-20),t&&i.pageX-l>28&&(i.pageX-l+28>r.width?t.style.left=r.width-28+"px":t.style.left=i.pageX-l+"px"),l}},t.prototype.create=function(t){var e=this.tooltipCls();this.container=document.createElement("div"),this.tooltipStyleClass&&(e+=" "+this.tooltipStyleClass),this.container.className=e;var i=document.createElement("div");i.className="f-tooltip-arrow ",this.container.appendChild(i);var r=document.createElement("div");r.className="f-tooltip-text ",r.innerHTML=this.message;var n=window.innerWidth-50;r.style.maxWidth=n+"px",r.style.wordBreak="break-all",this.container.style.textAlign="center",this.positionStyle&&(this.container.style.position=this.positionStyle),this.container.appendChild(r),document.body.appendChild(this.container)},t.prototype.tooltipCls=function(){return"datagrid-cell-tooltip f-tooltip "+this.getThemeCls()+" f-tooltip-"+this.position+" "+this.cls},t.prototype.getThemeCls=function(){return this.type?"f-tooltip-"+this.type:""},t.prototype.getBoxSizeObj=function(t){var e=t.getBoundingClientRect();return{width:rt.getOuterWidth(t),height:rt.getOuterHeight(t),left:e.left,right:e.right,top:e.top,bottom:e.bottom}},t.prototype.getTooltipSize=function(){return{width:rt.getOuterWidth(this.container),height:rt.getOuterHeight(this.container)}},t.prototype.getWindowSize=function(){return{width:window.innerWidth,height:window.innerHeight}},t.prototype.changeTooltipPosition=function(t){var e=this.getBoxSizeObj(t),i=this.getTooltipSize(),r=this.getWindowSize();if(this.container.className=this.tooltipCls(),!(i.width<r.width&&i.height<e.top)){var n=rt.getOffset(t).left,o=r.width-n-e.width;this.position=n>o?"left":"right";var s=n>o?n:o;this.getTextContainer().style.maxWidth=s-30+"px",this.container.style.maxWidth=s+"px"}},t.decorators=[{type:e.Directive,args:[{selector:"[cell-tooltip]",exportAs:"cellTooltip"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Injector}]},t.propDecorators={enable:[{type:e.Input,args:["cell-tooltip"]}],position:[{type:e.Input}],positionStyle:[{type:e.Input}],tooltipStyleClass:[{type:e.Input}],message:[{type:e.Input}],delay:[{type:e.Input}],cls:[{type:e.Input}],type:[{type:e.Input}],tipMode:[{type:e.Input}]},t}(),re=function(){function t(t){this.injector=t}return t.prototype.transform=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t.showTips){this.colFormatSer=this.injector.get(g.ColumnFormatService);var r=this.getCellTooltipContent(t,e[0]);return r}return""},t.prototype.getCellTooltipContent=function(t,e){var i=Y.getValue(t.field,e);return t.tipContent?"string"==typeof t.tipContent?i=t.tipContent:"function"==typeof t.tipContent&&(i=t.tipContent(i,e,t)):i=t.formatter&&("function"==typeof t.formatter||"object"==typeof t.formatter&&Object.keys(t.formatter).length)?this.colFormatSer.format(i,e,t.formatter):Y.escapeValue(i),i},t.decorators=[{type:e.Pipe,args:[{name:"tipmsg",pure:!1}]}],t.ctorParameters=function(){return[{type:e.Injector}]},t}(),ne=function(){function t(t,e,i,n,o,s,l){this.inject=t,this.el=e,this.cd=i,this.dgs=n,this.render=o,this.ngZone=s,this.localeSer=l,this.empty="[ 无 ]",this.filterText=this.empty,this.openFilterPanel=!1,this.showExpand=!1,this.enableFilterSetting=!1,this.windowResizeHandler=null,this.ro=null,this.destory$=new r.Subject,this.empty=this.localeSer.getValue("datagrid.filter.nofilter"),this.filterText=this.empty}return Object.defineProperty(t.prototype,"toolbarWidth",{get:function(){return this.filterToolbarRef.nativeElement.offsetWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterTextContainerWidth",{get:function(){var t=52;return this.enableFilterSetting&&(t=65),this.toolbarWidth-85-t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterTextRealWidth",{get:function(){this.render.setStyle(this.filterPanelTextRef.nativeElement,"white-space","nowrap");var t=this.filterPanelTextRef.nativeElement.scrollWidth;return this.render.setStyle(this.filterPanelTextRef.nativeElement,"white-space","normal"),t},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.dg=this.inject.get(xt),this.dfrs=this.dg.clientFilterService,this.dgs.clearFilter.pipe(n.takeUntil(this.destory$)).subscribe(function(){t.filterText=t.empty,t.openFilterPanel=!1,t.dgs.onFilterTextChange(t.filterText),t.cd.detectChanges()}),this.filterChangeSubscription=this.dgs.onFilterChanged.pipe(n.takeUntil(this.destory$)).subscribe(function(e){t.filterText=t.dfrs.convertFilterCondition2String(e),t.filterText||(t.filterText=t.empty),t.updateExpandState(),setTimeout(function(){t.bindEvent()},100),t.showExpand||(t.openFilterPanel=!1),t.cd.detectChanges(),t.dgs.onFilterTextChange(t.filterText)}),this.ngZone.runOutsideAngular(function(){t.ro=new u(function(){t._CONTAINER_SIZE_CHANGED_TIMER_&&clearTimeout(t._CONTAINER_SIZE_CHANGED_TIMER_),t._CONTAINER_SIZE_CHANGED_TIMER_=setTimeout(function(){t.updateExpandState(),t.cd.detectChanges()},100)}),t.ro.observe(t.el.nativeElement.closest("div.f-datagrid"))})},t.prototype.ngOnDestroy=function(){this.destory$.next(),this.destory$.complete(),this.ro.disconnect(),this.filterChangeSubscription&&(this.filterChangeSubscription.unsubscribe(),this.filterChangeSubscription=null),this.windowResizeHandler&&(this.windowResizeHandler(),this.windowResizeHandler=null)},t.prototype.bindEvent=function(){var t=this;this.ngZone.runOutsideAngular(function(){var e=t.filterToolbarRef.nativeElement.querySelectorAll(".filter-field");t.bindFilterFieldHandler(e);var i=t.filterPanelTextRef.nativeElement.querySelectorAll(".filter-field");t.bindFilterFieldHandler(i,!1)})},t.prototype.bindFilterFieldHandler=function(t,e){var i=this;void 0===e&&(e=!0),t&&t.length&&t.forEach(function(t){i.render.listen(t,"click",function(){i.removeFilterField(t,e)})})},t.prototype.removeFilterField=function(t,e){void 0===e&&(e=!0);var i=t.classList[1].replace("filter-column-","");t.remove(),e&&(this.openFilterPanel=!1,this.updateExpandState()),this.dfrs.removeFilterField(i)},t.prototype.updateExpandState=function(){this.showExpand=this.isShowExpand()},t.prototype.isShowExpand=function(){return!(this.filterTextContainerWidth>this.filterTextRealWidth)&&this.filterTextRealWidth>this.filterTextContainerWidth},t.prototype.clearFilter=function(t){return this.filterText=this.empty,this.dgs.onClearFilter(),this.dgs.onFilterChanged.emit({}),!1},t.prototype.refreshFilter=function(t){return this.dg.filterData(),!1},t.prototype.showFilterTextPanel=function(){this.openFilterPanel=!this.openFilterPanel,this.cd.detectChanges()},t.decorators=[{type:e.Component,args:[{selector:"filter-toolbar",template:'\n        <div class="f-datagrid-filter-toolbar-panel" #filterPanel [class.show]="openFilterPanel" style="width: auto">\n            <span class="filter-text" #filterPanelText [innerHTML]="filterText"></span>\n        </div>\n        <div class="f-datagrid-filter-toolbar" #filterToolbar>\n            <span class="title">{{\'datagrid.filter.title\'| locale}}：</span>\n            <span #filterbarTxt class="filter-text" [innerHTML]="filterText"> </span>\n            <span class="filter-action" *ngIf="filterText !== empty ">\n                <span *ngIf="showExpand" class="f-icon filter-action-item"\n                    [class.f-icon-arrow-chevron-up]="openFilterPanel"\n                    [class.f-icon-arrow-chevron-down]="!openFilterPanel"\n                (click)="showFilterTextPanel()" title="{{\'datagrid.filter.more\'|locale}}"></span>\n                <span title="{{\'datagrid.filter.clearAll\'|locale}}" class="f-icon f-icon-x filter-action-item filter-clear" (click)="clearFilter($event)"></span>\n                <span title="refresh" class="f-icon f-icon-reload-sm filter-action-item filter-refresh" style="color: #388fff" (click)="refreshFilter($event)"></span>\n                <span *ngIf="enableFilterSetting" class="f-icon f-icon-cog filter-action-item" title="{{\'datagrid.filter.setting\'|locale}}"></span>\n            </span>\n        </div>\n    ',encapsulation:e.ViewEncapsulation.None}]}],t.ctorParameters=function(){return[{type:e.Injector},{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:J},{type:e.Renderer2},{type:e.NgZone},{type:a.LocaleService}]},t.propDecorators={enableFilterSetting:[{type:e.Input}],filterPanelRef:[{type:e.ViewChild,args:["filterPanel"]}],filterPanelTextRef:[{type:e.ViewChild,args:["filterPanelText"]}],filterTextRef:[{type:e.ViewChild,args:["filterbarTxt"]}],filterToolbarRef:[{type:e.ViewChild,args:["filterToolbar"]}]},t}(),oe=function(){function t(t,e,i){this.el=t,this.render=e,this.inject=i,this.groupHeader=!1,this.dg=null,this.dg=this.inject.get(xt)}return t.prototype.ngOnInit=function(){this.renderCss2Element()},t.prototype.ngAfterViewInit=function(){if(this.column.halign&&"left"!==this.column.halign){var t=this.el.nativeElement.querySelector(".farris-label-tips");t&&t.parentElement&&"DIV"==t.parentElement.nodeName?(this.render.setStyle(t.parentElement,"width","100%"),"right"===this.column.halign?this.render.setStyle(t.parentElement,"justify-content","end"):this.render.setStyle(t.parentElement,"justify-content","center")):this.groupHeader&&("right"===this.column.halign?this.render.setStyle(this.el.nativeElement,"justify-content","end"):this.render.setStyle(this.el.nativeElement,"justify-content","center"))}},t.prototype.renderCss2Element=function(){if(this.column&&this.column.headerStyler){var t=this.column.headerStyler,e=this.el.nativeElement,i=typeof this.column.headerStyler;if("string"===i)this.render.addClass(this.el.nativeElement,t);else if("function"===i){var r=this.column.headerStyler(this.column);r.cls&&this.render.addClass(this.el.nativeElement,r.cls),r.style&&this.renderStyle(e,r.style)}else"object"===i&&Object.keys(i).length&&this.renderStyle(e,t)}},t.prototype.renderStyle=function(t,e){var i=this.dg.customStyleKey()+' td[field="'+this.column.field+'"] span.f-datagrid-header-cell-title';this.dg.renderCustomStyle2({style:e},t,i);var r=this.dg.customStyleKey()+' td[field="'+this.column.field+'"].f-datagrid-header-cell';this.dg.renderCustomStyle2({style:e},t,r);var n=Object.keys(e).filter(function(t){return t.toLowerCase().indexOf("background")>-1});if(n&&n.length){var o=e[n[n.length-1]],s=this.dg.customStyleKey()+' td[field="'+this.column.field+'"] div.f-datagrid-header-cell-content::after';this.dg.renderCustomStyle2({style:{"background-color":o}},t,s)}},t.decorators=[{type:e.Directive,args:[{selector:"[header-style]",exportAs:"HeaderStyler"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector}]},t.propDecorators={column:[{type:e.Input,args:["header-style"]}],groupHeader:[{type:e.Input}]},t}(),se=function(){function t(t,e){this.dg=t,this.inject=e}return t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Component,args:[{selector:"auto-height",template:'<table style="width:100%" class="f-datagrid-ah" cellpadding="0" cellspacing="0" border="0">\r\n    <colgroup>\r\n        <col *ngIf="dg.showLineNumber" [width]="dg.lineNumberWidth + \'px\'">\r\n        <ng-container *ngFor="let col of columnsGroup?.normalColumns">\r\n            <col [width]="col.width + \'px\'">\r\n        </ng-container>\r\n    </colgroup>\r\n    <thead>\r\n        <tr class="f-datagrid-header-row" *ngFor="let cols of columns">\r\n            <td class="f-datagrid-header-cell" *ngIf="dg.showLineNumber"></td>\r\n            <ng-container *ngFor="let col of cols">\r\n                <ng-container *ngIf="col.colspan && !col.fixed">\r\n                    <td class="f-datagrid-header-cell f-datagrid-header-cell-group" \r\n                        [attr.align]="col.halign"\r\n                        [attr.colspan]="col.colspan">\r\n                        <div class="f-datagrid-header-cell-content" >\r\n                            {{ col.title }}\r\n                        </div>\r\n                    </td>\r\n                </ng-container>\r\n                <ng-container *ngIf="!col.colspan && !col.fixed">\r\n                    <td class="f-datagrid-header-cell" \r\n                        [attr.align]="col.halign" \r\n                        [attr.field]="col.field"\r\n                        [attr.rowspan]="col.rowspan">\r\n                        <div class="f-datagrid-header-cell-content">\r\n                            {{ col.title }}\r\n                        </div>\r\n                    </td>\r\n                </ng-container>\r\n            </ng-container>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr class="f-datagrid-body-row" [attr.id]="row | rowDataId" *ngFor="let row of data; trackBy: dg.trackByRows; let i = index">\r\n            <td class="f-datagrid-cell f-datagrid-cell-rownumber" [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber">{{ i+1 }}</td>\r\n            <td class="f-datagrid-cell" [attr.align]="col.align" *ngFor="let col of columnsGroup?.normalColumns; let ci = index;">\r\n                <span [innerHtml]=" col | formatCellData: row | safe: \'html\'"></span>\r\n            </td>\r\n        </tr>\r\n        <ng-container *ngIf="dg.showFooter && data && data.length">\r\n            <tr class="f-datagrid-body-row" *ngFor="let row of dg.footerData">\r\n                <td class="f-datagrid-cell f-datagrid-cell-rownumber" [style.width.px]="dg.lineNumberWidth" *ngIf="dg.showLineNumber"></td>\r\n                <td class="f-datagrid-cell" [attr.align]="col.align" *ngFor="let col of columnsGroup?.normalColumns" [attr.title]="col | formatCellData: row ">\r\n                    <div class="f-datagrid-cell-content">\r\n                        <span *ngIf="col.footer && col.footer.formatter" [innerHtml]=" col | formatCellData: row : false: true | safe: \'html\'"></span>\r\n                        <span *ngIf="!col.footer || !col.footer.formatter">{{ col | formatCellData: row: false: true }}</span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </ng-container>\r\n    </tbody>\r\n</table>'}]}],t.ctorParameters=function(){return[{type:xt},{type:e.Injector}]},t.propDecorators={columns:[{type:e.Input}],columnsGroup:[{type:e.Input}],data:[{type:e.Input}]},t}(),le=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e){if(!t)return!1;var i=this.dfs.primaryId(t);return!!i&&this.dfs.isRowSelected(i,e)},t.decorators=[{type:e.Pipe,args:[{name:"rowIsSelected",pure:!1}]}],t.ctorParameters=function(){return[{type:Z}]},t}(),ae=function(){function t(t){this.dfs=t}return t.prototype.transform=function(t,e){if(!t)return!1;var i=this.dfs.primaryId(t);return!!i&&this.dfs.isRowChecked(i,e)},t.decorators=[{type:e.Pipe,args:[{name:"rowIsChecked",pure:!1}]}],t.ctorParameters=function(){return[{type:Z}]},t}(),de=function(){function t(t,e,i,r){this.el=t,this.render=e,this.inject=i,this.dg=r}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.buildCustomGroupFooterRowStyle(this.rowData)},t.prototype.buildCustomGroupFooterRowStyle=function(t){var e=this;if(this.dg.groupFooterStyler){var i=this.dg.dgs.getCustomStyle(this.dg.groupFooterStyler,[t]);i&&(this.dg.renderCustomCls(i.cls,this.el.nativeElement),i.style&&Object.keys(i.style).forEach(function(t){e.el.nativeElement.style[t]=i.style[t]}))}},t.decorators=[{type:e.Directive,args:[{selector:"[group-footer-row-styler]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector},{type:xt}]},t.propDecorators={column:[{type:e.Input}],rowData:[{type:e.Input,args:["group-footer-row-styler"]}],rowIndex:[{type:e.Input}]},t}(),ce=function(){function t(t,e,i){this.dg=t,this.inject=e,this.el=i,this.autoHeight=!1,this._timer=null,this._dgb=null,this._dgb=this.inject.get(It)}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this._updateDatagridHeight(this.wheelHeight)},t.prototype.ngOnChanges=function(t){t.wheelHeight&&this._updateDatagridHeight(this.wheelHeight)},t.prototype.ngDoCheck=function(){},t.prototype.updateDatagridHeight=function(t){if(this.el&&this.el.nativeElement&&this.el.nativeElement.parentElement&&this.autoHeight){t||(t=240,this.dg.ds&&this.dg.ds.rows&&this.dg.ds.rows.length||(t=!this.dg.emptyDataHeight||this.dg.emptyDataHeight<0?240:this.dg.emptyDataHeight));var e=parseInt(t,10);if(this.dg.showHeader&&(this.dg.realHeaderHeight?e+=this.dg.realHeaderHeight:e+=this.dg.setHeaderHeight()),this.dg.showFooter&&(e+=this.dg.footerHeight),this.dg.pagination)e+=this.dg.pagerHeight||40;this.dg.showFilterBar&&(e+=this.dg.filterBarHeight),this.dg.showRowGroupPanel&&(e+=this.dg.rowGroupPanelHeight);var i=t+"px";if(this.dg.maxHeight&&e>this.dg.maxHeight&&(i=this._dgb.getViewPortHeight()),this.el.nativeElement.parentElement.style.height=i,this.el.nativeElement.parentElement.parentElement.style.height=i,this.dg.dgContainer){this.dg.maxHeight&&e>this.dg.maxHeight&&(e=this.dg.maxHeight);var r=e+"px";if(this.dg.dgContainer.nativeElement.style.height=r,this.dg.el.nativeElement.style.height=r,this.dg.height=e,this.dg.maxHeight){this.dg.maxHeight&&this.dg.maxHeight<55&&(this.dg.maxHeight=60);var n=this.dg.el.nativeElement.parentElement;n.style.height="unset",n.style.maxHeight=this.dg.maxHeight+"px",n.style.minHeight=e+"px"}}else this.dg.el.nativeElement.querySelector(".f-datagrid").style.height=e+"px"}},t.prototype._updateDatagridHeight=function(t){var e=this;this.dg.autoHeight&&(this.dg.el.nativeElement.parentElement.className.indexOf("f-utils-fill")>-1&&(this.dg.el.nativeElement.parentElement.className=this.dg.el.nativeElement.parentElement.className.replace("f-utils-fill","")),setTimeout(function(){e.updateDatagridHeight(t)},50))},t.decorators=[{type:e.Directive,args:[{selector:"[auto-height]"}]}],t.ctorParameters=function(){return[{type:xt},{type:e.Injector},{type:e.ElementRef}]},t.propDecorators={autoHeight:[{type:e.Input,args:["auto-height"]}],wheelHeight:[{type:e.Input}]},t}(),he=function(){function t(t,e,i,r,n){this.el=t,this.injector=e,this.ngZone=i,this.render=r,this.dg=n}return t.prototype.ngOnInit=function(){},t.prototype.ngOnDestroy=function(){},t.prototype.dblclickRowEvent=function(t){var e=this,i=t.target.closest("tr");if(i&&null!=i.id&&i.id!=undefined){var n=Y.getRowIdByTr(i);if(i.className.indexOf("f-datagrid-group-row")>-1){var o=n.replace("group-tr_",""),s=this.dg.getGroupRow(o),l=s.data,a=s.index;l&&!isNaN(a)&&(l.expanded?this.dg.collapseGroupRow(a):this.dg.expandGroupRow(a))}else{var d=i.getAttribute("index"),c=this.dg.dfs.findRow(n);if(c){if(this.dg.disableRow&&this.dg.disableRow(c.data,c.index))return t.stopPropagation(),!1;var h=function(){if(e.dg.dfs.isRowSelected(n))e.dg.dblclickRow.emit({rowData:c,id:n,index:d,grid:e.dg,dblclick:!0});else{var t=e.dg.beforeSelect({rowIndex:d,rowData:c.data,gridInstance:e.dg}),i=r.of(!0);t&&t.subscribe&&(i=t),i.subscribe(function(t){t&&(e.dg.selectRow(n,!0,!1),e.dg.dblclickRow.emit({rowData:c,id:n,index:d,grid:e.dg,dblclick:!0}))})}};this.dg.editable?"row"===this.dg.editMode&&this.dg.clickToEdit?(this.dg.endRowEdit(),setTimeout(function(){e.dg.editRow(n)},200)):(this.dg.isSingleClick=!1,h()):h(),t.stopPropagation(),t.preventDefault()}}}},t.decorators=[{type:e.Directive,args:[{selector:"[row-dblclick]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Injector},{type:e.NgZone},{type:e.Renderer2},{type:xt}]},t.propDecorators={dblclickRowEvent:[{type:e.HostListener,args:["dblclick",["$event"]]}]},t}(),ue=function(){function t(t,e,i,r){this.el=t,this.render=e,this.inject=i,this.dg=r,this.isGroupFooter=!1}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.isGroupFooter?this.setGroupFooterCellStyle(this.column):this.buildCustomCellStyle(this.column,this.rowData)},t.prototype.buildCustomCellStyle=function(t,e){var i=this.el.nativeElement.parentNode;if(i&&!i.id){var r=this.dg.dfs.primaryId(e),n="";i.closest(".f-datagrid-body-fixed-left")?n="-left":i.closest(".f-datagrid-body-fixed-right")&&(n="-right");var o="footer-row"+n+"_"+(r||this.rowIndex);i.id=o}if(this.el.nativeElement.id||(this.el.nativeElement.id="footer-td_"+this.rowIndex+"_"+this.column.field.replace(/\./g,"_")),t&&t.footer&&t.footer.styler){var s=e,l=(0,t.footer.styler)(s[t.field],s);l&&Object.keys(l).length?this.dg.renderCustomStyle(l,this.el.nativeElement):this.dg.dgs.removeCssRule("#"+this.el.nativeElement.id)}},t.prototype.setGroupFooterCellStyle=function(t){var e=this;if(t.groupFooter&&t.groupFooter.styler){var i=this.dg.commonUtils.getValue(t.field,this.rowData),r=this.dg.dgs.getCustomStyle(t.groupFooter.styler,[i,this.rowData]);r&&(this.dg.renderCustomCls(r.cls,this.el.nativeElement),r.style&&Object.keys(r.style).forEach(function(t){e.el.nativeElement.style[t]=r.style[t]}))}},t.decorators=[{type:e.Directive,args:[{selector:"[footer-cell-styler]"}]}],t.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2},{type:e.Injector},{type:xt}]},t.propDecorators={column:[{type:e.Input}],rowData:[{type:e.Input}],rowIndex:[{type:e.Input}],isGroupFooter:[{type:e.Input}]},t}(),pe=function(){function t(){}return t.prototype.moveItem=function(t,e,i){var r=t.splice(i,1);return t.splice.apply(t,R([e,0],r)),t},t.prototype.backupColumns=function(t){this.initColumns=t.map(function(t){return t.map(function(t){return{id:t.id,field:t.field}})})},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();b.constants.wrapperClass,b.constants.animationClass;b.smoothDnD.dropHandler=b.dropHandlers.reactDropHandler().handler,b.smoothDnD.wrapChild=!1;var fe=function(){function t(t,e,i,r,n,o,s){var l=this;this.ngzone=t,this.injector=e,this.render=i,this.el=r,this.header=n,this.dg=o,this.dndSer=s,this.enableDrag=!0,this.groupName="",this.options={groupName:this.groupName,orientation:"horizontal",behaviour:"move",dragHandleSelector:".drag-column-bar",dragClass:"drag-column-moving",dropPlaceholder:{className:"drop-group-field"},getGhostParent:function(){return document.body},getChildPayload:this.getChildPayload.bind(this),shouldAcceptDrop:function(t,e){return"number"!=typeof e&&(t.groupName===l.groupName&&!l.dg.isMultiHeader())},onDropReady:function(t){l.ngzone.run(function(){l.onDropReady(t)})},onDrop:function(t){l.ngzone.run(function(){l.onDrop(t)})},onDragEnter:function(){l.ngzone.run(function(){l.onDragEnter()})},onDragStart:function(t){l.ngzone.run(function(){l.onDragStart(t)})},onDragEnd:function(t){l.ngzone.run(function(){l.onDragEnd(t)})}}}return t.prototype.ngOnChanges=function(t){t.enableDrag&&!t.enableDrag.isFirstChange()&&(this.enableDrag?this.initDnD():this.disposeDnd())},t.prototype.ngAfterViewInit=function(){this.initDnD()},t.prototype.ngOnDestroy=function(){this.disposeDnd()},t.prototype.disposeDnd=function(){this.container&&(this.container.dispose(),this.container=null)},t.prototype.initDnD=function(){if(this.dg.enableDragColumn){if("left"===this.groupName||"right"===this.groupName){var t=this.columnsGroup(),e=t.left,i=t.right;if("left"===this.groupName&&!e.length)return;if("right"===this.groupName&&(!i.length||1===i.length&&"_datagrid-setting-control_"===i[0].field))return}this.options.groupName=this.groupName,this.disposeDnd(),this.enableDrag&&(this.container=b.smoothDnD(this.el.nativeElement,this.options),this.dndSer.backupColumns(this.header.columns))}},t.prototype.getChildPayload=function(t){var e=this;"left"===this.groupName&&(this.dg.showCheckbox&&t--,this.dg.showLineNumber&&t--);var i=this.columnsGroup();return"left"===this.groupName?i.left.filter(function(t,i){return e.dg.columnIsVisible(t)})[t]:"right"===this.groupName?i.right.filter(function(t,i){return e.dg.columnIsVisible(t)})[t]:i.middle.filter(function(t,i){return e.dg.columnIsVisible(t)})[t]},t.prototype.onDropReady=function(t){},t.prototype.onDrop=function(t){var e=this,i=t.addedIndex,r=t.payload;t.removedIndex;if(null!==i){var n=this.columnsGroup(),o=this.dg.columns[0],s=o.findIndex(function(t){return t.field===r.field}),l=i,a=[];"left"===this.groupName?(this.dg.showCheckbox&&l--,this.dg.showLineNumber&&l--,a=n.left):"center"===this.groupName?a=n.middle:"right"===this.groupName&&(a=n.right),function(t){if(t){var i=t.filter(function(t){return t.visible||t.visible===undefined})[l];if(i){var r=o.findIndex(function(t){return t.field===i.field});return e.dg.columns[0]=e.dndSer.moveItem(e.dg.columns[0],r,s),!0}}return!1}(a)&&(this.dg.columnsChanged(!1),this.dg.useControlPanel&&this.dg.settingService&&this.dg.settingService.saveUserConfig(this.dg.id),this.dg.columnMoved.emit({newColumns:this.dg.columns,grid:this.dg}))}},t.prototype.onDragStart=function(t){},t.prototype.onDragEnd=function(t){},t.prototype.onDragEnter=function(){},t.prototype.columnsGroup=function(){return{left:this.dg.columns[0].filter(function(t){return"left"===t.fixed}),right:this.dg.columns[0].filter(function(t){return"right"===t.fixed}),middle:this.dg.columns[0].filter(function(t){return"right"!==t.fixed&&"left"!==t.fixed})}},t.decorators=[{type:e.Directive,args:[{selector:"[drag-column]",providers:[pe]}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.Injector},{type:e.Renderer2},{type:e.ElementRef},{type:Lt},{type:xt},{type:pe}]},t.propDecorators={enableDrag:[{type:e.Input,args:["drag-column"]}],groupName:[{type:e.Input}],options:[{type:e.Input}]},t}();b.smoothDnD.dropHandler=b.dropHandlers.reactDropHandler().handler,b.smoothDnD.wrapChild=!1;b.constants.wrapperClass,b.constants.animationClass;var ge=function(){function t(t,e,i,r,n,o){var s=this;this.ngzone=t,this.injector=e,this.render=i,this.el=r,this.dg=n,this.dndSer=o,this.options={orientation:"horizontal",behaviour:"move",dragHandleSelector:".group-field",dropPlaceholder:{className:"drop-group-field"},getGhostParent:function(){return document.body},shouldAcceptDrop:function(t,e){return e!==undefined&&null!==e&&("number"==typeof e||s.getGroupFields().length<3&&(e.allowGrouping===undefined||e.allowGrouping))},getChildPayload:function(t){return t},onDropReady:function(t){s.ngzone.run(function(){s.onDropReady(t)})},onDrop:function(t){s.ngzone.run(function(){s.onDrop(t)})},onDragEnter:function(){s.ngzone.run(function(){s.onDragEnter()})},onDragStart:function(t){s.ngzone.run(function(){s.onDragStart(t)})},onDragEnd:function(t){s.ngzone.run(function(){s.onDragEnd(t)})}}}return t.prototype.ngAfterViewInit=function(){this.initDnD()},t.prototype.ngOnDestroy=function(){this.disposeDnd()},t.prototype.disposeDnd=function(){this.container&&(this.container.dispose(),this.container=null)},t.prototype.initDnD=function(){this.disposeDnd(),this.dg.showRowGroupPanel&&(this.container=b.smoothDnD(this.el.nativeElement,this.options))},t.prototype.onDropReady=function(t){},t.prototype.getGroupFields=function(){return this.dg.groupField?this.dg.groupField.split(","):[]},t.prototype.onDrop=function(t){var e=this,i=t.addedIndex,r=t.payload,n=t.removedIndex;if(null!==i){var o=this.getGroupFields();null===n?o.some(function(t){return t===r.field})||o.push(r.field):this.dndSer.moveItem(o,i,n),this.dg.groupField=o.join(","),this.dg.useControlPanel&&this.dg.settingService?(this.dg.checkSettingHttp(),this.dg.settingService.saveUserConfig(this.dg.id).subscribe(function(){e.dg.columnsChanged()})):this.dg.columnsChanged(),this.dg.groupFieldChange.emit({newGroupField:this.dg.groupField,grid:this.dg})}},t.prototype.onDragStart=function(t){},t.prototype.onDragEnd=function(t){},t.prototype.onDragEnter=function(){},t.decorators=[{type:e.Directive,args:[{selector:"[drop-column]",providers:[pe]}]}],t.ctorParameters=function(){return[{type:e.NgZone},{type:e.Injector},{type:e.Renderer2},{type:e.ElementRef},{type:xt},{type:pe}]},t.propDecorators={options:[{type:e.Input}]},t}(),me=function(){function t(){}return t.prototype.transform=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this.isReadonly(t,e[0],e[1])},t.prototype.isReadonly=function(t,e,i){return!i.editable||(!!(i.mergeCell&&i.mergeFields.indexOf(t.field)>-1)||this.getReadonlyValue(t,e))},t.prototype.getReadonlyValue=function(t,e){if(t.readonly!==undefined){if("boolean"==typeof t.readonly)return t.readonly;if("function"==typeof t.readonly)return t.readonly(e)}return!1},t.decorators=[{type:e.Pipe,args:[{name:"cellReadonly"}]}],t}(),ye={minScrollbarLength:20},we=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:e||[]}},t.decorators=[{type:e.NgModule,args:[{imports:[c.CommonModule,m.FormsModule,m.ReactiveFormsModule,i.HttpClientModule,w.PaginationModule,ot,gt,a.LocaleModule.forRoot(),g.DataColumnModule.forRoot(),y.NotifyModule.forRoot(),v.SimpleFilterModule,Rt,C.FarrisContextMenuModule,l.FarrisCommonModule.forRoot()],declarations:[Dt,Et,Xt,qt,Jt,ee,Kt,Qt,te,me,re,xt,Lt,Mt,jt,Ot,Tt,Ft,It,Gt,mt,yt,Ht,Yt,kt,Nt,Bt,Ut,_t,Pt,Zt,ie,ne,oe,ce,se,le,ae,Vt,zt,he,ue,fe,ge,At,wt,de],providers:[{provide:e.ErrorHandler,useClass:Wt},{provide:lt,useValue:ye},it],exports:[Dt,xt,Lt,yt,mt,Ot,kt,jt,Pt,Et,Xt,Kt,ee,re,Jt,ie,ne,le,ae,he,ue,fe,ge,At,wt,Rt,de,C.FarrisContextMenuModule,me],entryComponents:[]}]}],t}();t.ALLOW_EDIT_CELL_HIGHLIGHT_CLS=N,t.AutoHeightDirective=ce,t.CELL_EDITING_CLS=M,t.CELL_SELECTED_CLS=j,t.CUSTOM_CELL_CLS="customcellcls_",t.CUSTOM_GROUP_ROW_CLS="customgrouprowcls_",t.CUSTOM_ROW_CLS="customrowcls_",t.CalculationType=I,t.ColumnFilterType=E,t.DATAGRID_REST_SERVICEE=Q,t.DATAGRID_SETTING_FIELDNAME="_DATAGRID_CONTROL_PANEL_",t.DataGridLoadingComponent=Nt,t.DatagridBodyComponent=It,t.DatagridCellComponent=Tt,t.DatagridCellEditableDirective=Ot,t.DatagridCellEditorDirective=mt,t.DatagridColumnDirective=yt,t.DatagridComponent=xt,t.DatagridFacadeService=Z,t.DatagridFilterService=nt,t.DatagridFilterToolbarComponent=ne,t.DatagridFooterComponent=Mt,t.DatagridHeaderComponent=Lt,t.DatagridModule=we,t.DatagridPagerComponent=Gt,t.DatagridResizeColumnDirective=jt,t.DatagridRowDblClickDirective=he,t.DatagridRowDirective=Ft,t.DatagridRowHoverDirective=kt,t.DatagridRowsComponent=Ht,t.DatagridService=J,t.DatagridSmartFilterComponent=St,t.DatagridSmartFilterModule=Rt,t.DatagridSmartFilterService=bt,t.DatagridUtils=Y,t.DomHandler=rt,t.DragColumnDirective=fe,t.DragDropColumnService=pe,t.DropColumnDirective=ge,t.FIXED_LEFT_SHADOW_CLS=A,t.FIXED_RIGHT_SHADOW_CLS="f-datagrid-fixed-right-shadow",t.FilterRowCreateDirective=At,t.FooterCellStylerDirective=ue,t.GRID_EDITORS=k,t.GRID_FILTER_ROW=_,t.GRID_SETTINGS_HTTP=O,t.GRID_SETTINGS_PANEL=D,t.GRID_SETTINGS_SERVICE=T,t.GRID_VALIDATORS=F,t.GridCellEditorDirective=_t,t.GroupFooterRowStylerDirective=de,t.HeaderStyleDirective=oe,t.NgxPaginationModule=ot,t.PagerSelectedListComponent=zt,t.PaginationService=st,t.ROW_HOVER_CLS="f-datagrid-row-hover",t.ROW_SELECTED_CLS="f-datagrid-row-selected",t.RestService=tt,t.SCROLLBAR_CONFIG=lt,t.SCROLL_DOWN_ACTION="psScrollDown",t.SCROLL_LEFT_ACTION="psScrollLeft",t.SCROLL_RIGHT_ACTION="psScrollRight",t.SCROLL_UP_ACTION="psScrollUp",t.SCROLL_X_ACTION=H,t.SCROLL_X_REACH_END_ACTION=P,t.SCROLL_X_REACH_START_ACTION=L,t.SCROLL_Y_ACTION="psScrollY",t.SCROLL_Y_REACH_END_ACTION="psYReachEnd",t.SCROLL_Y_REACH_START_ACTION="psYReachStart",t.SIZE_TYPE=G,t.ScrollbarArrowsComponent=ft,t.ScrollbarComponent=pt,t.ScrollbarDirective=ut,t.ScrollbarModule=gt,t.SelectedItemPipe=Vt,t.SmartFilterToolbarComponent=wt,t.TR_ID_PREFIX="row_",t.TR_PREFIX="row_",t.TextboxEditorComponent=Pt,t.ValidatorMessagerService=it,t.WORDWRAP_ROW_HEIGHT_CLS="wrap_row_height_",t.defaultPaginationInfo={enable:!0,pageIndex:1,pageSize:10},t.ɵa=Dt,t.ɵb=Et,t.ɵc=Xt,t.ɵd=qt,t.ɵe=Jt,t.ɵf=ee,t.ɵg=Kt,t.ɵh=Qt,t.ɵi=te,t.ɵj=me,t.ɵk=re,t.ɵl=Yt,t.ɵm=Bt,t.ɵn=Ut,t.ɵo=Zt,t.ɵp=ie,t.ɵq=se,t.ɵr=le,t.ɵs=$t,t.ɵt=Wt,t.ɵu=ae,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-datagrid.umd.min.js.map
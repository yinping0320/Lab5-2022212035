/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Input, NgZone } from '@angular/core';
import ResizeObserver from 'resize-observer-polyfill';
export class FAreaResponseDirective {
    /**
     * @param {?} el
     * @param {?} ngzone
     * @param {?} render
     */
    constructor(el, ngzone, render) {
        this.el = el;
        this.ngzone = ngzone;
        this.render = render;
        this.ro = null;
        // 顺序不一致，不用object，用数组
        this.breakPoints = [
            { size: 'sm', width: 576 },
            { size: 'md', width: 768 },
            { size: 'lg', width: 888 },
            { size: 'xl', width: 1200 },
            { size: 'el', width: 1690 }
        ];
        this.clsNames = [];
        /**
         * 是否处理宽度不固定
         */
        this.autoResponse = true;
        /**
         * 只处理固定宽度；
         */
        this.enableResponse = true;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.supportResponse();
        this.bindEvent();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.hasOwnProperty('enableResponse')) {
            this.supportResponse();
        }
        if (changes.hasOwnProperty('autoResponse')) {
            this.bindEvent();
        }
    }
    /**
     * @private
     * @return {?}
     */
    bindEvent() {
        if (this.enableResponse && this.autoResponse) {
            // 已绑定过
            if (this.ro) {
                return;
            }
            else {
                this.ngzone.runOutsideAngular((/**
                 * @return {?}
                 */
                () => {
                    this.ro = new ResizeObserver((/**
                     * @param {?} entries
                     * @param {?} observer
                     * @return {?}
                     */
                    (entries, observer) => {
                        this.widthInterval(entries[0].contentRect.width);
                    }));
                    this.ro.observe(this.el.nativeElement);
                }));
            }
        }
        else {
            if (this.ro) {
                this.ro.unobserve(this.el.nativeElement);
                this.ro = null;
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    supportResponse() {
        // 启用响应
        if (this.enableResponse) {
            this.render.addClass(this.el.nativeElement, 'f-area-response');
            this.widthInterval();
        }
        else {
            // 移除对应的样式
            this.render.removeClass(this.el.nativeElement, 'f-area-response');
            for (let m = this.clsNames.length; m > 0; m--) {
                this.render.addClass(this.el.nativeElement, 'f-area-response--' + this.clsNames[m]);
                this.clsNames = [];
            }
        }
        this.bindEvent();
    }
    /**
     * @private
     * @param {?=} tWidth
     * @return {?}
     */
    widthInterval(tWidth = 0) {
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            setTimeout((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                let result = [];
                if (!this.el) {
                    return;
                }
                /** @type {?} */
                const areaWidth = tWidth ? tWidth : this.el.nativeElement.getBoundingClientRect().width;
                /** @type {?} */
                let width = parseFloat(areaWidth);
                for (let k = 0; k < this.breakPoints.length; k++) {
                    if (this.breakPoints[k]['width'] <= width) {
                        result.push(this.breakPoints[k]['size']);
                    }
                }
                if (this.clsNames.join(',') != result.join(',')) {
                    // 旧的比新的多，应该移除class
                    /** @type {?} */
                    let distance = this.clsNames.length - result.length;
                    if (distance > 0) {
                        for (let m = result.length; m < this.clsNames.length; m++) {
                            this.render.removeClass(this.el.nativeElement, 'f-area-response--' + this.clsNames[m]);
                        }
                    }
                    else {
                        for (let m = this.clsNames.length; m < result.length; m++) {
                            this.render.addClass(this.el.nativeElement, 'f-area-response--' + result[m]);
                        }
                    }
                    this.clsNames = [...result];
                }
            }), 0);
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.ro) {
            this.ro.unobserve(this.el.nativeElement);
            this.ro = null;
        }
    }
}
FAreaResponseDirective.decorators = [
    { type: Directive, args: [{
                selector: '[f-area-response]'
            },] }
];
/** @nocollapse */
FAreaResponseDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone },
    { type: Renderer2 }
];
FAreaResponseDirective.propDecorators = {
    autoResponse: [{ type: Input }],
    enableResponse: [{ type: Input, args: ['f-area-response',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.breakPoints;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.clsNames;
    /**
     * 是否处理宽度不固定
     * @type {?}
     */
    FAreaResponseDirective.prototype.autoResponse;
    /**
     * 只处理固定宽度；
     * @type {?}
     */
    FAreaResponseDirective.prototype.enableResponse;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.el;
    /** @type {?} */
    FAreaResponseDirective.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJlYS1yZXNwb25zZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWFyZWEtcmVzcG9uc2UvIiwic291cmNlcyI6WyJsaWIvYXJlYS1yZXNwb25zZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFzRCxNQUFNLGVBQWUsQ0FBQztBQUNwSSxPQUFPLGNBQWMsTUFBTSwwQkFBMEIsQ0FBQztBQUl0RCxNQUFNLE9BQU8sc0JBQXNCOzs7Ozs7SUFzQi9CLFlBQW9CLEVBQWMsRUFBUyxNQUFjLEVBQVUsTUFBaUI7UUFBaEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFTLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBckI1RSxPQUFFLEdBQTBCLElBQUksQ0FBQzs7UUFFakMsZ0JBQVcsR0FBRztZQUNsQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtTQUM5QixDQUFDO1FBRU0sYUFBUSxHQUFHLEVBQUUsQ0FBQzs7OztRQUliLGlCQUFZLEdBQUcsSUFBSSxDQUFDOzs7O1FBS0gsbUJBQWMsR0FBRyxJQUFJLENBQUM7SUFJaEQsQ0FBQzs7OztJQUNELGVBQWU7UUFDWCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFNBQVMsRUFBRSxD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QUM7aUJBQy9CO1lBQ0wsQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7O0lBQ0QsV0FBVztRQUNQLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNULElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDekMsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUM7U0FDbEI7SUFDTCxDQUFDOzs7WUFqSEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxtQkFBbUI7YUFDaEM7Ozs7WUFKbUIsVUFBVTtZQUFvQixNQUFNO1lBQXhCLFNBQVM7OzsyQkFvQnBDLEtBQUs7NkJBS0wsS0FBSyxTQUFDLGlCQUFpQjs7Ozs7OztJQW5CeEIsb0NBQXlDOzs7OztJQUV6Qyw2Q0FNRTs7Ozs7SUFFRiwwQ0FBc0I7Ozs7O0lBSXRCLDhDQUE2Qjs7Ozs7SUFLN0IsZ0RBQWdEOzs7OztJQUVwQyxvQ0FBc0I7O0lBQUUsd0NBQXFCOzs7OztJQUFFLHdDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBJbnB1dCwgTmdab25lLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tmLWFyZWEtcmVzcG9uc2VdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRkFyZWFSZXNwb25zZURpcmVjdGl2ZSBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuICAgIHByaXZhdGUgcm86IFJlc2l6ZU9ic2VydmVyIHwgbnVsbCA9IG51bGw7XHJcbiAgICAvLyDpobrluo/kuI3kuIDoh7TvvIzkuI3nlKhvYmplY3TvvIznlKjmlbDnu4RcclxuICAgIHByaXZhdGUgYnJlYWtQb2ludHMgPSBbXHJcbiAgICAgICAgeyBzaXplOiAnc20nLCB3aWR0aDogNTc2IH0sXHJcbiAgICAgICAgeyBzaXplOiAnbWQnLCB3aWR0aDogNzY4IH0sXHJcbiAgICAgICAgeyBzaXplOiAnbGcnLCB3aWR0aDogODg4IH0sXHJcbiAgICAgICAgeyBzaXplOiAneGwnLCB3aWR0aDogMTIwMCB9LFxyXG4gICAgICAgIHsgc2l6ZTogJ2VsJywgd2lkdGg6IDE2OTAgfVxyXG4gICAgXTtcclxuXHJcbiAgICBwcml2YXRlIGNsc05hbWVzID0gW107XHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuWkhOeQhuWuveW6puS4jeWbuuWumlxyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBhdXRvUmVzcG9uc2UgPSB0cnVlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Y+q5aSE55CG5Zu65a6a5a695bqm77ybXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgnZi1hcmVhLXJlc3BvbnNlJykgZW5hYmxlUmVzcG9uc2UgPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHB1YmxpYyBuZ3pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMikge1xyXG5cclxuICAgIH1cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgICAgICB0aGlzLnN1cHBvcnRSZXNwb25zZSgpO1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICB9XHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMuaGFzT3duUHJvcGVydHkoJ2VuYWJsZVJlc3BvbnNlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5zdXBwb3J0UmVzcG9uc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNoYW5nZXMuaGFzT3duUHJvcGVydHkoJ2F1dG9SZXNwb25zZScpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBiaW5kRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlUmVzcG9uc2UgJiYgdGhpcy5hdXRvUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy8g5bey57uR5a6a6L+HXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5nem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ybyA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcywgb2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53aWR0aEludGVydmFsKGVudHJpZXNbMF0uY29udGVudFJlY3Qud2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm8ub2JzZXJ2ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5ybykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yby51bm9ic2VydmUodGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucm8gPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzdXBwb3J0UmVzcG9uc2UoKSB7XHJcbiAgICAgICAgLy8g5ZCv55So5ZON5bqUXHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZi1hcmVhLXJlc3BvbnNlJyk7XHJcbiAgICAgICAgICAgIHRoaXMud2lkdGhJbnRlcnZhbCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOenu+mZpOWvueW6lOeahOagt+W8j1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWFyZWEtcmVzcG9uc2UnKTtcclxuICAgICAgICAgICAgZm9yIChsZXQgbSA9IHRoaXMuY2xzTmFtZXMubGVuZ3RoOyBtID4gMDsgbS0tKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWFyZWEtcmVzcG9uc2UtLScgKyB0aGlzLmNsc05hbWVzW21dKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xzTmFtZXMgPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSB3aWR0aEludGVydmFsKHRXaWR0aCA9IDApIHtcclxuICAgICAgICB0aGlzLm5nem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgYXJlYVdpZHRoID0gdFdpZHRoID8gdFdpZHRoIDogdGhpcy5lbC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdpZHRoID0gcGFyc2VGbG9hdChhcmVhV2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLmJyZWFrUG9pbnRzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYnJlYWtQb2ludHNba11bJ3dpZHRoJ10gPD0gd2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5icmVha1BvaW50c1trXVsnc2l6ZSddKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsc05hbWVzLmpvaW4oJywnKSAhPSByZXN1bHQuam9pbignLCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5pen55qE5q+U5paw55qE5aSa77yM5bqU6K+l56e76ZmkY2xhc3NcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZGlzdGFuY2UgPSB0aGlzLmNsc05hbWVzLmxlbmd0aCAtIHJlc3VsdC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBtID0gcmVzdWx0Lmxlbmd0aDsgbSA8IHRoaXMuY2xzTmFtZXMubGVuZ3RoOyBtKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtYXJlYS1yZXNwb25zZS0tJyArIHRoaXMuY2xzTmFtZXNbbV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbSA9IHRoaXMuY2xzTmFtZXMubGVuZ3RoOyBtIDwgcmVzdWx0Lmxlbmd0aDsgbSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWFyZWEtcmVzcG9uc2UtLScgKyByZXN1bHRbbV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xzTmFtZXMgPSBbLi4ucmVzdWx0XTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5ybykge1xyXG4gICAgICAgICAgICB0aGlzLnJvLnVub2JzZXJ2ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnJvID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, ElementRef, Renderer2, Input, NgZone } from '@angular/core';
import ResizeObserver from 'resize-observer-polyfill';
var FAreaResponseDirective = /** @class */ (function () {
    function FAreaResponseDirective(el, ngzone, render) {
        this.el = el;
        this.ngzone = ngzone;
        this.render = render;
        this.ro = null;
        // 顺序不一致，不用object，用数组
        this.breakPoints = [
            { size: 'sm', width: 576 },
            { size: 'md', width: 768 },
            { size: 'lg', width: 888 },
            { size: 'xl', width: 1200 },
            { size: 'el', width: 1690 }
        ];
        this.clsNames = [];
        /**
         * 是否处理宽度不固定
         */
        this.autoResponse = true;
        /**
         * 只处理固定宽度；
         */
        this.enableResponse = true;
    }
    /**
     * @return {?}
     */
    FAreaResponseDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.supportResponse();
        this.bindEvent();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    FAreaResponseDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.hasOwnProperty('enableResponse')) {
            this.supportResponse();
        }
        if (changes.hasOwnProperty('autoResponse')) {
            this.bindEvent();
        }
    };
    /**
     * @private
     * @return {?}
     */
    FAreaResponseDirective.prototype.bindEvent = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.enableResponse && this.autoResponse) {
            // 已绑定过
            if (this.ro) {
                return;
            }
            else {
                this.ngzone.runOutsideAngular((/**
                 * @return {?}
                 */
                function () {
                    _this.ro = new ResizeObserver((/**
                     * @param {?} entries
                     * @param {?} observer
                     * @return {?}
                     */
                    function (entries, observer) {
                        _this.widthInterval(entries[0].contentRect.width);
                    }));
                    _this.ro.observe(_this.el.nativeElement);
                }));
            }
        }
        else {
            if (this.ro) {
                this.ro.unobserve(this.el.nativeElement);
                this.ro = null;
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    FAreaResponseDirective.prototype.supportResponse = /**
     * @private
     * @return {?}
     */
    function () {
        // 启用响应
        if (this.enableResponse) {
            this.render.addClass(this.el.nativeElement, 'f-area-response');
            this.widthInterval();
        }
        else {
            // 移除对应的样式
            this.render.removeClass(this.el.nativeElement, 'f-area-response');
            for (var m = this.clsNames.length; m > 0; m--) {
                this.render.addClass(this.el.nativeElement, 'f-area-response--' + this.clsNames[m]);
                this.clsNames = [];
            }
        }
        this.bindEvent();
    };
    /**
     * @private
     * @param {?=} tWidth
     * @return {?}
     */
    FAreaResponseDirective.prototype.widthInterval = /**
     * @private
     * @param {?=} tWidth
     * @return {?}
     */
    function (tWidth) {
        var _this = this;
        if (tWidth === void 0) { tWidth = 0; }
        this.ngzone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            setTimeout((/**
             * @return {?}
             */
            function () {
                /** @type {?} */
                var result = [];
                if (!_this.el) {
                    return;
                }
                /** @type {?} */
                var areaWidth = tWidth ? tWidth : _this.el.nativeElement.getBoundingClientRect().width;
                /** @type {?} */
                var width = parseFloat(areaWidth);
                for (var k = 0; k < _this.breakPoints.length; k++) {
                    if (_this.breakPoints[k]['width'] <= width) {
                        result.push(_this.breakPoints[k]['size']);
                    }
                }
                if (_this.clsNames.join(',') != result.join(',')) {
                    // 旧的比新的多，应该移除class
                    /** @type {?} */
                    var distance = _this.clsNames.length - result.length;
                    if (distance > 0) {
                        for (var m = result.length; m < _this.clsNames.length; m++) {
                            _this.render.removeClass(_this.el.nativeElement, 'f-area-response--' + _this.clsNames[m]);
                        }
                    }
                    else {
                        for (var m = _this.clsNames.length; m < result.length; m++) {
                            _this.render.addClass(_this.el.nativeElement, 'f-area-response--' + result[m]);
                        }
                    }
                    _this.clsNames = tslib_1.__spread(result);
                }
            }), 0);
        }));
    };
    /**
     * @return {?}
     */
    FAreaResponseDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.ro) {
            this.ro.unobserve(this.el.nativeElement);
            this.ro = null;
        }
    };
    FAreaResponseDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[f-area-response]'
                },] }
    ];
    /** @nocollapse */
    FAreaResponseDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgZone },
        { type: Renderer2 }
    ]; };
    FAreaResponseDirective.propDecorators = {
        autoResponse: [{ type: Input }],
        enableResponse: [{ type: Input, args: ['f-area-response',] }]
    };
    return FAreaResponseDirective;
}());
export { FAreaResponseDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.ro;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.breakPoints;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.clsNames;
    /**
     * 是否处理宽度不固定
     * @type {?}
     */
    FAreaResponseDirective.prototype.autoResponse;
    /**
     * 只处理固定宽度；
     * @type {?}
     */
    FAreaResponseDirective.prototype.enableResponse;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.el;
    /** @type {?} */
    FAreaResponseDirective.prototype.ngzone;
    /**
     * @type {?}
     * @private
     */
    FAreaResponseDirective.prototype.render;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJlYS1yZXNwb25zZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLWFyZWEtcmVzcG9uc2UvIiwic291cmNlcyI6WyJsaWIvYXJlYS1yZXNwb25zZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBc0QsTUFBTSxlQUFlLENBQUM7QUFDcEksT0FBTyxjQUFjLE1BQU0sMEJBQTBCLENBQUM7QUFDdEQ7SUF5QkksZ0NBQW9CLEVBQWMsRUFBUyxNQUFjLEVBQVUsTUFBaUI7UUFBaEUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFTLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBckI1RSxPQUFFLEdBQTBCLElBQUksQ0FBQzs7UUFFakMsZ0JBQVcsR0FBRztZQUNsQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtZQUMzQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtTQUM5QixDQUFDO1FBRU0sYUFBUSxHQUFHLEVBQUUsQ0FBQzs7OztRQUliLGlCQUFZLEdBQUcsSUFBSSxDQUFDOzs7O1FBS0gsbUJBQWMsR0FBRyxJQUFJLENBQUM7SUFJaEQsQ0FBQzs7OztJQUNELGdEQUFlOzs7SUFBZjtRQUNJLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDckIsQ0FB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QkFBTyxNQUFNLENBQUMsQ0FBQztpQkFDL0I7WUFDTCxDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUM7UUFDVixDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7Ozs7SUFDRCw0Q0FBVzs7O0lBQVg7UUFDSSxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDVCxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDO1NBQ2xCO0lBQ0wsQ0FBQzs7Z0JBakhKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsbUJBQW1CO2lCQUNoQzs7OztnQkFKbUIsVUFBVTtnQkFBb0IsTUFBTTtnQkFBeEIsU0FBUzs7OytCQW9CcEMsS0FBSztpQ0FLTCxLQUFLLFNBQUMsaUJBQWlCOztJQTJGNUIsNkJBQUM7Q0FBQSxBQWxIRCxJQWtIQztTQS9HWSxzQkFBc0I7Ozs7OztJQUMvQixvQ0FBeUM7Ozs7O0lBRXpDLDZDQU1FOzs7OztJQUVGLDBDQUFzQjs7Ozs7SUFJdEIsOENBQTZCOzs7OztJQUs3QixnREFBZ0Q7Ozs7O0lBRXBDLG9DQUFzQjs7SUFBRSx3Q0FBcUI7Ozs7O0lBQUUsd0NBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIElucHV0LCBOZ1pvbmUsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCBSZXNpemVPYnNlcnZlciBmcm9tICdyZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwnO1xyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2YtYXJlYS1yZXNwb25zZV0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGQXJlYVJlc3BvbnNlRGlyZWN0aXZlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xyXG4gICAgcHJpdmF0ZSBybzogUmVzaXplT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcclxuICAgIC8vIOmhuuW6j+S4jeS4gOiHtO+8jOS4jeeUqG9iamVjdO+8jOeUqOaVsOe7hFxyXG4gICAgcHJpdmF0ZSBicmVha1BvaW50cyA9IFtcclxuICAgICAgICB7IHNpemU6ICdzbScsIHdpZHRoOiA1NzYgfSxcclxuICAgICAgICB7IHNpemU6ICdtZCcsIHdpZHRoOiA3NjggfSxcclxuICAgICAgICB7IHNpemU6ICdsZycsIHdpZHRoOiA4ODggfSxcclxuICAgICAgICB7IHNpemU6ICd4bCcsIHdpZHRoOiAxMjAwIH0sXHJcbiAgICAgICAgeyBzaXplOiAnZWwnLCB3aWR0aDogMTY5MCB9XHJcbiAgICBdO1xyXG5cclxuICAgIHByaXZhdGUgY2xzTmFtZXMgPSBbXTtcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5aSE55CG5a695bqm5LiN5Zu65a6aXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGF1dG9SZXNwb25zZSA9IHRydWU7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlj6rlpITnkIblm7rlrprlrr3luqbvvJtcclxuICAgICAqL1xyXG4gICAgQElucHV0KCdmLWFyZWEtcmVzcG9uc2UnKSBlbmFibGVSZXNwb25zZSA9IHRydWU7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHVibGljIG5nem9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyKSB7XHJcblxyXG4gICAgfVxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuc3VwcG9ydFJlc3BvbnNlKCk7XHJcbiAgICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgIH1cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgICAgICBpZiAoY2hhbmdlcy5oYXNPd25Qcm9wZXJ0eSgnZW5hYmxlUmVzcG9uc2UnKSkge1xyXG4gICAgICAgICAgICB0aGlzLnN1cHBvcnRSZXNwb25zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hhbmdlcy5oYXNPd25Qcm9wZXJ0eSgnYXV0b1Jlc3BvbnNlJykpIHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGJpbmRFdmVudCgpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVSZXNwb25zZSAmJiB0aGlzLmF1dG9SZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyDlt7Lnu5Hlrprov4dcclxuICAgICAgICAgICAgaWYgKHRoaXMucm8pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmd6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzLCBvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndpZHRoSW50ZXJ2YWwoZW50cmllc1swXS5jb250ZW50UmVjdC53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yby5vYnNlcnZlKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvLnVub2JzZXJ2ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ybyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHN1cHBvcnRSZXNwb25zZSgpIHtcclxuICAgICAgICAvLyDlkK/nlKjlk43lupRcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVSZXNwb25zZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdmLWFyZWEtcmVzcG9uc2UnKTtcclxuICAgICAgICAgICAgdGhpcy53aWR0aEludGVydmFsKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g56e76Zmk5a+55bqU55qE5qC35byPXHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtYXJlYS1yZXNwb25zZScpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBtID0gdGhpcy5jbHNOYW1lcy5sZW5ndGg7IG0gPiAwOyBtLS0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtYXJlYS1yZXNwb25zZS0tJyArIHRoaXMuY2xzTmFtZXNbbV0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbHNOYW1lcyA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHdpZHRoSW50ZXJ2YWwodFdpZHRoID0gMCkge1xyXG4gICAgICAgIHRoaXMubmd6b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcmVhV2lkdGggPSB0V2lkdGggPyB0V2lkdGggOiB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2lkdGggPSBwYXJzZUZsb2F0KGFyZWFXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRoaXMuYnJlYWtQb2ludHMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5icmVha1BvaW50c1trXVsnd2lkdGgnXSA8PSB3aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmJyZWFrUG9pbnRzW2tdWydzaXplJ10pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xzTmFtZXMuam9pbignLCcpICE9IHJlc3VsdC5qb2luKCcsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDml6fnmoTmr5TmlrDnmoTlpJrvvIzlupTor6Xnp7vpmaRjbGFzc1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkaXN0YW5jZSA9IHRoaXMuY2xzTmFtZXMubGVuZ3RoIC0gcmVzdWx0Lmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG0gPSByZXN1bHQubGVuZ3RoOyBtIDwgdGhpcy5jbHNOYW1lcy5sZW5ndGg7IG0rKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZi1hcmVhLXJlc3BvbnNlLS0nICsgdGhpcy5jbHNOYW1lc1ttXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBtID0gdGhpcy5jbHNOYW1lcy5sZW5ndGg7IG0gPCByZXN1bHQubGVuZ3RoOyBtKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2YtYXJlYS1yZXNwb25zZS0tJyArIHJlc3VsdFttXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbHNOYW1lcyA9IFsuLi5yZXN1bHRdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCAwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLnJvKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm8udW5vYnNlcnZlKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHRoaXMucm8gPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
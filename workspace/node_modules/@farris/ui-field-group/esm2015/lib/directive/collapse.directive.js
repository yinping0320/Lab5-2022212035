/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ElementRef, Renderer2, Input } from '@angular/core';
import { LocaleService } from '@farris/ui-locale';
export class CollapseDirective {
    // fold
    /*  */
    /**
     * @param {?} el
     * @param {?} render
     * @param {?} localeService
     */
    constructor(el, render, localeService) {
        this.el = el;
        this.render = render;
        this.localeService = localeService;
        /* 收折文本 */
        this.collapseText = '';
        /* 展开文本 */
        this.expandText = '';
        // this.collapseTemplate = collapseTemplate.templa;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // if (!this.el.nativeElement.classList.contains('f-state-visible')) {
        //     this.render.addClass(this.el.nativeElement, 'f-state-visible');
        // }
    }
    /**
     * 当标题  收折文本变化时，视图随之变化
     * @param {?} changeOption 变更变量集合
     * @return {?}
     */
    ngOnChanges(changeOption) {
        if (changeOption['title'] && this.titleDiv && this.titleText) {
            // 移除当前结构  重现渲染
            this.render.removeChild(this.titleDiv, this.titleText);
            this.titleText = this.render.createText(this.title);
            this.render.appendChild(this.titleDiv, this.titleText);
        }
        if ((changeOption['collapseText'] || changeOption['expandText']) && this.span) {
            if (this.collapse) {
                this.span.innerHTML = this.expandText;
            }
            else {
                this.span.innerHTML = this.collapseText;
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.parent = this.render.parentNode(this.el.nativeElement);
        // if (this.localeService) {
        //     this.collapseText = this.localeService.getValue('collapseDirective.fold');
        //     this.expandText = this.localeService.getValue('collapseDirective.expand');
        // }
        if (!this.parent.classList.contains('f-section-formgroup')) {
            this.render.addClass(parent, 'f-section-formgroup');
        }
        this.generateLegendChildren();
        this.changeState();
        // 绑定收折事件
        this.clickEvent = this.click.bind(this);
        this.titleDiv.addEventListener('click', this.clickEvent);
        this.button.addEventListener('click', this.clickEvent);
    }
    /**
     * @param {?} e
     * @return {?}
     */
    click(e) {
        this.collapse = !this.collapse;
        this.changeState();
    }
    /**
     * @return {?}
     */
    changeState() {
        if (this.collapse) {
            this.render.addClass(this.parent, 'f-state-collapse');
            // 按钮添加类
            this.render.removeClass(this.button, 'f-state-expand');
            if (this.expandText) {
                this.span.innerHTML = this.expandText;
            }
        }
        else {
            this.render.removeClass(this.parent, 'f-state-collapse');
            this.render.addClass(this.button, 'f-state-expand');
            if (this.collapseText) {
                this.span.innerHTML = this.collapseText;
            }
        }
    }
    // 生成fieldset内部元素
    /**
     * @return {?}
     */
    generateLegendChildren() {
        // 生成标题div
        this.titleDiv = this.render.createElement('div');
        this.titleText = this.render.createText(this.title);
        this.render.addClass(this.titleDiv, 'f-title');
        this.render.appendChild(this.titleDiv, this.titleText);
        // 生成header
        /** @type {?} */
        const header = this.render.createElement('div');
        this.render.addClass(header, 'f-header');
        // 生成toolbar div
        /** @type {?} */
        const toolbarDiv = this.render.createElement('div');
        this.render.addClass(toolbarDiv, 'f-toolbar');
        // 生成收折button
        this.button = this.render.createElement('button');
        this.render.addClass(this.button, 'btn');
        this.render.addClass(this.button, 'f-btn-collapse-expand');
        this.render.addClass(this.button, 'f-btn-mx');
        // 生成收折文本
        this.span = this.render.createElement('span');
        // 组合结构
        this.render.appendChild(this.button, this.span);
        this.render.appendChild(toolbarDiv, this.button);
        this.render.appendChild(header, this.titleDiv);
        this.render.appendChild(header, toolbarDiv);
        this.render.appendChild(this.el.nativeElement, header);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.clickEvent) {
            this.titleDiv.removeEventListener('click', this.clickEvent);
            this.button.removeEventListener('click', this.clickEvent);
        }
    }
}
CollapseDirective.decorators = [
    { type: Directive, args: [{
                selector: '[farrisCollapse]'
            },] }
];
/** @nocollapse */
CollapseDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: LocaleService }
];
CollapseDirective.propDecorators = {
    title: [{ type: Input }],
    collapse: [{ type: Input }],
    collapseText: [{ type: Input }],
    expandText: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    CollapseDirective.prototype.title;
    /** @type {?} */
    CollapseDirective.prototype.collapse;
    /** @type {?} */
    CollapseDirective.prototype.collapseText;
    /** @type {?} */
    CollapseDirective.prototype.expandText;
    /** @type {?} */
    CollapseDirective.prototype.button;
    /** @type {?} */
    CollapseDirective.prototype.span;
    /** @type {?} */
    CollapseDirective.prototype.parent;
    /** @type {?} */
    CollapseDirective.prototype.titleDiv;
    /** @type {?} */
    CollapseDirective.prototype.clickEvent;
    /** @type {?} */
    CollapseDirective.prototype.titleText;
    /**
     * @type {?}
     * @private
     */
    CollapseDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    CollapseDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    CollapseDirective.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGFwc2UuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWVsZC1ncm91cC8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmUvY29sbGFwc2UuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUUxQyxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFJbEQsTUFBTSxPQUFPLGlCQUFpQjs7Ozs7Ozs7SUE4QjFCLFlBQ1ksRUFBYyxFQUNkLE1BQWlCLEVBQ2pCLGFBQTRCO1FBRjVCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQ2pCLGtCQUFhLEdBQWIsYUFBYSxDQUFlOztRQXpCL0IsaUJBQVksR0FBRyxFQUFFLENBQUM7O1FBR2xCLGVBQVUsR0FBRyxFQUFFLENBQUM7UUF1QnJCLG1EQUFtRDtJQUN2RCxDQUFDOzs7O0lBRUQsUUFBUTtRQUVKLHNFQUFzRTtRQUN0RSxzRUFBc0U7UUFFdEUsSUFBSTtJQUVSLENBQUM7Ozs7OztJQU1ELFdBQVcsQ0FBQyxZQUEyQjtRQUNuQyxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDMUQsZUFBZTtZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFB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QUMsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFFNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFM0QsQ0FBQzs7OztJQUdELFdBQVc7UUFDUCxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzVELElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUM3RDtJQUNMLENBQUM7OztZQTNKSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjthQUMvQjs7OztZQU5jLFVBQVU7WUFBRSxTQUFTO1lBRzNCLGFBQWE7OztvQkFPakIsS0FBSzt1QkFFTCxLQUFLOzJCQUdMLEtBQUs7eUJBR0wsS0FBSzs7OztJQVJOLGtDQUF1Qjs7SUFFdkIscUNBQTJCOztJQUczQix5Q0FBMkI7O0lBRzNCLHVDQUF5Qjs7SUFLekIsbUNBQTBCOztJQUUxQixpQ0FBc0I7O0lBR3RCLG1DQUFvQjs7SUFHcEIscUNBQWM7O0lBRWQsdUNBQWdCOztJQUNoQixzQ0FBZTs7Ozs7SUFJWCwrQkFBc0I7Ozs7O0lBQ3RCLG1DQUF5Qjs7Ozs7SUFDekIsMENBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBJbnB1dCwgT25Jbml0LCBPbkRlc3Ryb3ksXHJcbiAgICBBZnRlclZpZXdJbml0LCBWaWV3Q29udGFpbmVyUmVmLCBWaWV3Q2hpbGQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlLCBTaW1wbGVDaGFuZ2VzXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbZmFycmlzQ29sbGFwc2VdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29sbGFwc2VEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuXHJcbiAgICAvLyBAQ1xyXG4gICAgQElucHV0KCkgdGl0bGU6IHN0cmluZztcclxuICAgIC8qIOWIneWni+WMlueKtuaAgSAgZmFsc2XmmK/kuI3mlLbmipggIHRydWXmmK/mlLbmipgqL1xyXG4gICAgQElucHV0KCkgY29sbGFwc2U6IGJvb2xlYW47XHJcblxyXG4gICAgLyog5pS25oqY5paH5pysICovXHJcbiAgICBASW5wdXQoKSBjb2xsYXBzZVRleHQgPSAnJztcclxuXHJcbiAgICAvKiDlsZXlvIDmlofmnKwgKi9cclxuICAgIEBJbnB1dCgpIGV4cGFuZFRleHQgPSAnJztcclxuXHJcblxyXG4gICAgLy8gY29sbGFwc2VUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIC8qIGJ1dHRvbiAqL1xyXG4gICAgYnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudDtcclxuICAgIC8qIHNwYW4gKi9cclxuICAgIHNwYW46IEhUTUxTcGFuRWxlbWVudDtcclxuXHJcbiAgICAvKiDmib7liLBjb2xsYXBzZeeItuWFg+e0oCAqL1xyXG4gICAgcGFyZW50OiBIVE1MRWxlbWVudDtcclxuXHJcblxyXG4gICAgdGl0bGVEaXY6IGFueTtcclxuXHJcbiAgICBjbGlja0V2ZW50OiBhbnk7XHJcbiAgICB0aXRsZVRleHQ6IGFueTtcclxuICAgIC8vIGZvbGRcclxuICAgIC8qICAqL1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIHJlbmRlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgIHByaXZhdGUgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSkge1xyXG4gICAgICAgIC8vIHRoaXMuY29sbGFwc2VUZW1wbGF0ZSA9IGNvbGxhcHNlVGVtcGxhdGUudGVtcGxhO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG5cclxuICAgICAgICAvLyBpZiAoIXRoaXMuZWwubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2Ytc3RhdGUtdmlzaWJsZScpKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2Ytc3RhdGUtdmlzaWJsZScpO1xyXG5cclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b2T5qCH6aKYICDmlLbmipjmlofmnKzlj5jljJbml7bvvIzop4blm77pmo/kuYvlj5jljJZcclxuICAgICAqIEBwYXJhbSBjaGFuZ2VPcHRpb24g5Y+Y5pu05Y+Y6YeP6ZuG5ZCIXHJcbiAgICAgKi9cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZU9wdGlvbjogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgICAgIGlmIChjaGFuZ2VPcHRpb25bJ3RpdGxlJ10gJiYgdGhpcy50aXRsZURpdiAmJiB0aGlzLnRpdGxlVGV4dCkge1xyXG4gICAgICAgICAgICAvLyDnp7vpmaTlvZPliY3nu5PmnoQgIOmHjeeOsOa4suafk1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZCh0aGlzLnRpdGxlRGl2LCB0aGlzLnRpdGxlVGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMudGl0bGVUZXh0ID0gdGhpcy5yZW5kZXIuY3JlYXRlVGV4dCh0aGlzLnRpdGxlKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQodGhpcy50aXRsZURpdiwgdGhpcy50aXRsZVRleHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKChjaGFuZ2VPcHRpb25bJ2NvbGxhcHNlVGV4dCddIHx8IGNoYW5nZU9wdGlvblsnZXhwYW5kVGV4dCddKSAmJiB0aGlzLnNwYW4pIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29sbGFwc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJIVE1MID0gdGhpcy5leHBhbmRUZXh0OyAgICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJIVE1MID0gdGhpcy5jb2xsYXBzZVRleHQ7ICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gdGhpcy5yZW5kZXIucGFyZW50Tm9kZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG5cclxuICAgICAgICAvLyBpZiAodGhpcy5sb2NhbGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuY29sbGFwc2VUZXh0ID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdjb2xsYXBzZURpcmVjdGl2ZS5mb2xkJyk7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuZXhwYW5kVGV4dCA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnY29sbGFwc2VEaXJlY3RpdmUuZXhwYW5kJyk7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBpZiAoIXRoaXMucGFyZW50LmNsYXNzTGlzdC5jb250YWlucygnZi1zZWN0aW9uLWZvcm1ncm91cCcpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHBhcmVudCwgJ2Ytc2VjdGlvbi1mb3JtZ3JvdXAnKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdlbmVyYXRlTGVnZW5kQ2hpbGRyZW4oKTtcclxuICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKCk7XHJcbiAgICAgICAgLy8g57uR5a6a5pS25oqY5LqL5Lu2XHJcbiAgICAgICAgdGhpcy5jbGlja0V2ZW50ID0gdGhpcy5jbGljay5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMudGl0bGVEaXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrRXZlbnQpO1xyXG4gICAgICAgIHRoaXMuYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0V2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGljayhlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNvbGxhcHNlID0gIXRoaXMuY29sbGFwc2U7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjaGFuZ2VTdGF0ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2xsYXBzZSkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLnBhcmVudCwgJ2Ytc3RhdGUtY29sbGFwc2UnKTtcclxuICAgICAgICAgICAgLy8g5oyJ6ZKu5re75Yqg57G7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyLnJlbW92ZUNsYXNzKHRoaXMuYnV0dG9uLCAnZi1zdGF0ZS1leHBhbmQnKTtcclxuICAgICAgICAgICAgaWYodGhpcy5leHBhbmRUZXh0KXtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3Bhbi5pbm5lckhUTUwgPSB0aGlzLmV4cGFuZFRleHQ7XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDbGFzcyh0aGlzLnBhcmVudCwgJ2Ytc3RhdGUtY29sbGFwc2UnKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5idXR0b24sICdmLXN0YXRlLWV4cGFuZCcpO1xyXG4gICAgICAgICAgICBpZih0aGlzLmNvbGxhcHNlVGV4dCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNwYW4uaW5uZXJIVE1MID0gdGhpcy5jb2xsYXBzZVRleHQ7XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8g55Sf5oiQZmllbGRzZXTlhoXpg6jlhYPntKBcclxuICAgIGdlbmVyYXRlTGVnZW5kQ2hpbGRyZW4oKSB7XHJcbiAgICAgICAgLy8g55Sf5oiQ5qCH6aKYZGl2XHJcbiAgICAgICAgdGhpcy50aXRsZURpdiA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHRoaXMudGl0bGVUZXh0ID0gdGhpcy5yZW5kZXIuY3JlYXRlVGV4dCh0aGlzLnRpdGxlKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLnRpdGxlRGl2LCAnZi10aXRsZScpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHRoaXMudGl0bGVEaXYsIHRoaXMudGl0bGVUZXh0KTtcclxuXHJcbiAgICAgICAgLy8g55Sf5oiQaGVhZGVyXHJcbiAgICAgICAgY29uc3QgaGVhZGVyID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3MoaGVhZGVyLCAnZi1oZWFkZXInKTtcclxuXHJcbiAgICAgICAgLy8g55Sf5oiQdG9vbGJhciBkaXZcclxuICAgICAgICBjb25zdCB0b29sYmFyRGl2ID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModG9vbGJhckRpdiwgJ2YtdG9vbGJhcicpO1xyXG5cclxuICAgICAgICAvLyDnlJ/miJDmlLbmiphidXR0b25cclxuICAgICAgICB0aGlzLmJ1dHRvbiA9IHRoaXMucmVuZGVyLmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFkZENsYXNzKHRoaXMuYnV0dG9uLCAnYnRuJyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYWRkQ2xhc3ModGhpcy5idXR0b24sICdmLWJ0bi1jb2xsYXBzZS1leHBhbmQnKTtcclxuICAgICAgICB0aGlzLnJlbmRlci5hZGRDbGFzcyh0aGlzLmJ1dHRvbiwgJ2YtYnRuLW14Jyk7XHJcbiAgICAgICAgLy8g55Sf5oiQ5pS25oqY5paH5pysXHJcbiAgICAgICAgdGhpcy5zcGFuID0gdGhpcy5yZW5kZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgIC8vIOe7hOWQiOe7k+aehFxyXG4gICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHRoaXMuYnV0dG9uLCB0aGlzLnNwYW4pO1xyXG4gICAgICAgIHRoaXMucmVuZGVyLmFwcGVuZENoaWxkKHRvb2xiYXJEaXYsIHRoaXMuYnV0dG9uKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoaGVhZGVyLCB0aGlzLnRpdGxlRGl2KTtcclxuICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZChoZWFkZXIsIHRvb2xiYXJEaXYpO1xyXG5cclxuICAgICAgICB0aGlzLnJlbmRlci5hcHBlbmRDaGlsZCh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIGhlYWRlcik7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jbGlja0V2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMudGl0bGVEaXYucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrRXZlbnQpO1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2tFdmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
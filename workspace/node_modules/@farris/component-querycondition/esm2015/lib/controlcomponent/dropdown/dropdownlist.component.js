/**
 * @fileoverview added by tsickle
 * Generated from: lib/controlcomponent/dropdown/dropdownlist.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { SolutionService } from '../../service/solution.service';
import { DropDownListValue } from '../../entity/conditionvalue/dropdownlistvalue';
export class DropDownListComponent {
    /**
     * @param {?} solutionService
     */
    constructor(solutionService) {
        this.solutionService = solutionService;
        this.hideLabel = false;
        /**
         * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
         */
        this.changeFields = [];
        this.conditionChange = new EventEmitter();
        //下拉列表数据源
        this.dropDownListDataSource = new Array();
        //下拉列表控件内显示文本
        this.selectedItemId = '';
        //是否允许编辑，当通过服务器端api取数时为true
        this.editable = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getDataSource();
        /** @type {?} */
        const initialValue = (/** @type {?} */ (this.item.value));
        initialValue.key && (this.selectedItemId = initialValue.key);
        this.testId = this.solutionService.getGuid();
        this.placeholder = (this.item.placeHolder) ? (this.item.placeHolder) : (this.item.control.placeholder);
        this.beforeShow = ((/** @type {?} */ (this.item.control))).beforeShow;
        this.beforeHide = ((/** @type {?} */ (this.item.control))).beforeHide;
        this.idField = ((/** @type {?} */ (this.item.control))).idField ? ((/** @type {?} */ (this.item.control))).idField : 'value';
        this.textField = ((/** @type {?} */ (this.item.control))).textField ? ((/** @type {?} */ (this.item.control))).textField : 'name';
        if (this.uri) {
            this.selectedItemId = (initialValue.value || []).map((/**
             * @param {?} n
             * @return {?}
             */
            n => n[this.textField])).join(',');
            this.editable = true;
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.getDataSource();
        if (changes['changeFields'] && changes['changeFields'].currentValue && !changes['changeFields'].firstChange) {
            /** @type {?} */
            const isChange = changes['changeFields'].currentValue.some((/**
             * @param {?} field
             * @return {?}
             */
            field => field == this.item.fieldCode));
            if (isChange) {
                this.selectedItemId = ((/** @type {?} */ (this.item.value))).key;
            }
        }
    }
    /**
     * @return {?}
     */
    getDataSource() {
        this.dropDownListDataSource = ((/** @type {?} */ (this.item.control))).enumValues;
        this.uri = ((/** @type {?} */ (this.item.control))).uri;
    }
    /**
     * @param {?} selected
     * @return {?}
     */
    selectChange(selected) {
        /** @type {?} */
        const selectedValue = selected['selections'].map((/**
         * @param {?} selection
         * @return {?}
         */
        (selection) => {
            return {
                value: this.uri ? selection[this.textField] : selection[this.idField],
                name: selection[this.textField]
            };
        }));
        this.item.value = new DropDownListValue({
            value: selectedValue,
            key: selected['value']
        });
        this.conditionChange.emit();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onClear(event) {
        this.item.value = new DropDownListValue();
    }
    /**
     * @param {?} field
     * @return {?}
     */
    getConditionItemTitle(field) {
        return this.solutionService.getConditionItemTitle(field);
    }
}
DropDownListComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-solution-dropdownlist',
                template: "<div class=\"farris-group-wrap\" id=\"{{item.id}}\">\r\n    <div class=\"form-group farris-form-group  common-group\"  [ngClass]=\"{'q-state-readonly':item.readonly}\">\r\n    <label class=\"col-form-label\" *ngIf=\"item && !hideLabel\" title=\"{{getConditionItemTitle(item)}}\">\r\n      <span class=\"farris-label-info text-danger\" *ngIf=\"item.control.isRequired()\">*</span>\r\n      <span class=\"farris-label-text\">{{item.fieldName}}</span>\r\n    </label>\r\n    <div class=\"farris-input-wrap\">\r\n    <farris-combo-list \r\n        [(ngModel)]=\"selectedItemId\"\r\n        [idField]=\"idField\"\r\n        [valueField]=\"idField\"\r\n        [textField]=\"textField\"\r\n        [editable]=\"editable\"\r\n        [data]=\"dropDownListDataSource\"\r\n        [uri]=\"uri\"\r\n        [beforeShow]=\"beforeShow\"\r\n        [beforeHide]=\"beforeHide\"\r\n        [multiSelect]=\"item.control.multiSelect\"\r\n        [placeholder]=\"placeholder\"\r\n        [panelHeight]=\"item.control.panelHeight ? item.control.panelHeight : 'auto'\"\r\n        (valueChange)=\"selectChange($event)\"\r\n        (clear)=\"onClear($event)\" \r\n        id=\"{{testId}}\"\r\n        [readonly]=\"item.readonly\">\r\n      </farris-combo-list>\r\n    </div>\r\n  </div>\r\n</div>\r\n"
            }] }
];
/** @nocollapse */
DropDownListComponent.ctorParameters = () => [
    { type: SolutionService }
];
DropDownListComponent.propDecorators = {
    hideLabel: [{ type: Input }],
    item: [{ type: Input }],
    changeFields: [{ type: Input }],
    conditionChange: [{ type: Output, args: ['conditionChange',] }]
};
if (false) {
    /** @type {?} */
    DropDownListComponent.prototype.hideLabel;
    /**
     * QueryCondition类型
     * @type {?}
     */
    DropDownListComponent.prototype.item;
    /**
     * 某个字段发生值变化事件时，需要同步清空的字段，可能不是当前字段
     * @type {?}
     */
    DropDownListComponent.prototype.changeFields;
    /** @type {?} */
    DropDownListComponent.prototype.conditionChange;
    /** @type {?} */
    DropDownListComponent.prototype.dropDownListDataSource;
    /** @type {?} */
    DropDownListComponent.prototype.uri;
    /** @type {?} */
    DropDownListComponent.prototype.beforeShow;
    /** @type {?} */
    DropDownListComponent.prototype.beforeHide;
    /** @type {?} */
    DropDownListComponent.prototype.idField;
    /** @type {?} */
    DropDownListComponent.prototype.textField;
    /** @type {?} */
    DropDownListComponent.prototype.selectedItemId;
    /** @type {?} */
    DropDownListComponent.prototype.testId;
    /** @type {?} */
    DropDownListComponent.prototype.placeholder;
    /** @type {?} */
    DropDownListComponent.prototype.editable;
    /**
     * @type {?}
     * @private
     */
    DropDownListComponent.prototype.solutionService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd25saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xjb21wb25lbnQvZHJvcGRvd24vZHJvcGRvd25saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixZQUFZLEVBQUUsTUFBTSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQVF6RyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFakUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFPbEYsTUFBTSxPQUFPLHFCQUFxQjs7OztJQW9DOUIsWUFBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBbEMzQyxjQUFTLEdBQVcsS0FBSyxDQUFBOzs7O1FBU3pCLGlCQUFZLEdBQWtCLEVBQUUsQ0FBQztRQUVmLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFHaEUsMkJBQXNCLEdBQWUsSUFBSSxLQUFLLEVBQU8sQ0FBQzs7UUFZdEQsbUJBQWMsR0FBUSxFQUFFLENBQUM7O1FBTXpCLGFBQVEsR0FBWSxLQUFLLENBQUM7SUFFNkIsQ0FBQzs7OztJQUV4RCxRQUFRO1FBQ0osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDOztjQUNmLFlBQVksR0FBRyxtQkFBQSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBcUI7UUFDekQsWUFBWSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUM3QyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsSUFB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LENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQzthQUNsQyxDQUFBO1FBQ0wsQ0FBQyxFQUFDO1FBQ0YsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQztZQUNwQyxLQUFLLEVBQUcsYUFBYTtZQUNyQixHQUFHLEVBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQztTQUMzQixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hDLENBQUM7Ozs7O0lBRUQsT0FBTyxDQUFDLEtBQVU7UUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGlCQUFpQixFQUFFLENBQUM7SUFDOUMsQ0FBQzs7Ozs7SUFFRCxxQkFBcUIsQ0FBQyxLQUFvQjtRQUN0QyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMscUJBQXFCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0QsQ0FBQzs7O1lBOUZKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsMkJBQTJCO2dCQUNyQywwd0NBQTRDO2FBQy9DOzs7O1lBUFEsZUFBZTs7O3dCQVduQixLQUFLO21CQUlMLEtBQUs7MkJBS0wsS0FBSzs4QkFFTCxNQUFNLFNBQUMsaUJBQWlCOzs7O0lBWHpCLDBDQUFrQzs7Ozs7SUFJbEMscUNBQW1COzs7OztJQUtuQiw2Q0FBMEM7O0lBRTFDLGdEQUFnRTs7SUFHaEUsdURBQXNEOztJQUV0RCxvQ0FBWTs7SUFFWiwyQ0FBZ0I7O0lBRWhCLDJDQUFnQjs7SUFFaEIsd0NBQWdCOztJQUVoQiwwQ0FBa0I7O0lBRWxCLCtDQUF5Qjs7SUFFekIsdUNBQWU7O0lBRWYsNENBQW9COztJQUVwQix5Q0FBMEI7Ozs7O0lBRWQsZ0RBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBPbkNoYW5nZXMsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L3F1ZXJ5Y29uZGl0aW9uJztcclxuaW1wb3J0IHsgQ29udHJvbFR5cGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUnO1xyXG5pbXBvcnQgeyBEcm9wRG93bkxpc3RDb250cm9sIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbnRyb2x0eXBlL2Ryb3Bkb3dubGlzdC9kcm9wZG93bmxpc3Rjb250cm9sJztcclxuaW1wb3J0IHsgRW51bVR5cGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29udHJvbHR5cGUvZHJvcGRvd25saXN0L2VudW10eXBlJztcclxuaW1wb3J0IHsgRW51bUludGVnZXJWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9kcm9wZG93bmxpc3QvaW50ZWdlcmVudW12YWx1ZSc7XHJcbmltcG9ydCB7IEVudW1TdHJpbmdWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9kcm9wZG93bmxpc3Qvc3RyaW5nZW51bXZhbHVlJztcclxuaW1wb3J0IHsgRW51bUJvb2xWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb250cm9sdHlwZS9kcm9wZG93bmxpc3QvYm9vbGVudW12YWx1ZSc7XHJcbmltcG9ydCB7IFNvbHV0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2Uvc29sdXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IElWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb25kaXRpb252YWx1ZS9pdmFsdWUnO1xyXG5pbXBvcnQgeyBEcm9wRG93bkxpc3RWYWx1ZSB9IGZyb20gJy4uLy4uL2VudGl0eS9jb25kaXRpb252YWx1ZS9kcm9wZG93bmxpc3R2YWx1ZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLXNvbHV0aW9uLWRyb3Bkb3dubGlzdCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd25saXN0LmNvbXBvbmVudC5odG1sJyxcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBEcm9wRG93bkxpc3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgQElucHV0KCkgaGlkZUxhYmVsOmJvb2xlYW4gPSBmYWxzZVxyXG4gICAgLyoqXHJcbiAgICAgKiBRdWVyeUNvbmRpdGlvbuexu+Wei1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKSBpdGVtOiBhbnk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmn5DkuKrlrZfmrrXlj5HnlJ/lgLzlj5jljJbkuovku7bml7bvvIzpnIDopoHlkIzmraXmuIXnqbrnmoTlrZfmrrXvvIzlj6/og73kuI3mmK/lvZPliY3lrZfmrrVcclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgY2hhbmdlRmllbGRzOiBBcnJheTxzdHJpbmc+ID0gW107XHJcblxyXG4gICAgQE91dHB1dCgnY29uZGl0aW9uQ2hhbmdlJykgY29uZGl0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgIC8v5LiL5ouJ5YiX6KGo5pWw5o2u5rqQXHJcbiAgICBkcm9wRG93bkxpc3REYXRhU291cmNlOiBBcnJheTxhbnk+ID0gbmV3IEFycmF5PGFueT4oKTtcclxuICAgIC8v5pyN5Yqh5Zmo56uvQVBJ5Zyw5Z2AXHJcbiAgICB1cmk6IHN0cmluZztcclxuICAgIC8v6Z2i5p2/5pi+56S65YmN5LqL5Lu2XHJcbiAgICBiZWZvcmVTaG93OiBhbnk7XHJcbiAgICAvL+mdouadv+makOiXj+WJjeS6i+S7tlxyXG4gICAgYmVmb3JlSGlkZTogYW55O1xyXG4gICAgLy/mnprkuL7lgLzlrZfmrrVcclxuICAgIGlkRmllbGQ6IHN0cmluZztcclxuICAgIC8v5p6a5Li+5ZCN56ew5a2X5q61XHJcbiAgICB0ZXh0RmllbGQ6IHN0cmluZztcclxuICAgIC8v5LiL5ouJ5YiX6KGo5o6n5Lu25YaF5pi+56S65paH5pysXHJcbiAgICBzZWxlY3RlZEl0ZW1JZDogYW55ID0gJyc7XHJcbiAgICAvL+e7hOS7tmlkXHJcbiAgICB0ZXN0SWQ6IHN0cmluZztcclxuICAgIC8v5pen57uT5p6E5LitcGxhY2Vob2xkZXLlsZ7mgKflnKhpdGVtLmNvbnRyb2zlhoVcclxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgICAvL+aYr+WQpuWFgeiuuOe8lui+ke+8jOW9k+mAmui/h+acjeWKoeWZqOerr2FwaeWPluaVsOaXtuS4unRydWVcclxuICAgIGVkaXRhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6IFNvbHV0aW9uU2VydmljZSkge31cclxuXHJcbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmdldERhdGFTb3VyY2UoKTtcclxuICAgICAgICBjb25zdCBpbml0aWFsVmFsdWUgPSB0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWU7XHJcbiAgICAgICAgaW5pdGlhbFZhbHVlLmtleSAmJiAodGhpcy5zZWxlY3RlZEl0ZW1JZCA9IGluaXRpYWxWYWx1ZS5rZXkpO1xyXG4gICAgICAgIHRoaXMudGVzdElkID0gdGhpcy5zb2x1dGlvblNlcnZpY2UuZ2V0R3VpZCgpO1xyXG4gICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSAodGhpcy5pdGVtLnBsYWNlSG9sZGVyKSA/ICh0aGlzLml0ZW0ucGxhY2VIb2xkZXIpIDogKHRoaXMuaXRlbS5jb250cm9sLnBsYWNlaG9sZGVyKTtcclxuICAgICAgICB0aGlzLmJlZm9yZVNob3cgPSAodGhpcy5pdGVtLmNvbnRyb2wgYXMgRHJvcERvd25MaXN0Q29udHJvbCkuYmVmb3JlU2hvdztcclxuICAgICAgICB0aGlzLmJlZm9yZUhpZGUgPSAodGhpcy5pdGVtLmNvbnRyb2wgYXMgRHJvcERvd25MaXN0Q29udHJvbCkuYmVmb3JlSGlkZTtcclxuICAgICAgICB0aGlzLmlkRmllbGQgPSAodGhpcy5pdGVtLmNvbnRyb2wgYXMgRHJvcERvd25MaXN0Q29udHJvbCkuaWRGaWVsZCA/ICh0aGlzLml0ZW0uY29udHJvbCBhcyBEcm9wRG93bkxpc3RDb250cm9sKS5pZEZpZWxkIDogJ3ZhbHVlJztcclxuICAgICAgICB0aGlzLnRleHRGaWVsZCA9ICh0aGlzLml0ZW0uY29udHJvbCBhcyBEcm9wRG93bkxpc3RDb250cm9sKS50ZXh0RmllbGQgPyAodGhpcy5pdGVtLmNvbnRyb2wgYXMgRHJvcERvd25MaXN0Q29udHJvbCkudGV4dEZpZWxkIDogJ25hbWUnO1xyXG4gICAgICAgIGlmKHRoaXMudXJpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtSWQgPSAoaW5pdGlhbFZhbHVlLnZhbHVlIHx8IFtdKS5tYXAobiA9PiBuW3RoaXMudGV4dEZpZWxkXSkuam9pbignLCcpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRhYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ2V0RGF0YVNvdXJjZSgpO1xyXG4gICAgICAgIGlmKGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddICYmIGNoYW5nZXNbJ2NoYW5nZUZpZWxkcyddLmN1cnJlbnRWYWx1ZSAmJiAhY2hhbmdlc1snY2hhbmdlRmllbGRzJ10uZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICAgICAgY29uc3QgaXNDaGFuZ2UgPSBjaGFuZ2VzWydjaGFuZ2VGaWVsZHMnXS5jdXJyZW50VmFsdWUuc29tZShmaWVsZCA9PiBmaWVsZCA9PSB0aGlzLml0ZW0uZmllbGRDb2RlKTtcclxuICAgICAgICAgICAgaWYoaXNDaGFuZ2Upe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1JZCA9ICh0aGlzLml0ZW0udmFsdWUgYXMgRHJvcERvd25MaXN0VmFsdWUpLmtleTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXREYXRhU291cmNlKCkge1xyXG4gICAgICAgIHRoaXMuZHJvcERvd25MaXN0RGF0YVNvdXJjZSA9ICh0aGlzLml0ZW0uY29udHJvbCBhcyBEcm9wRG93bkxpc3RDb250cm9sKS5lbnVtVmFsdWVzO1xyXG4gICAgICAgIHRoaXMudXJpID0gKHRoaXMuaXRlbS5jb250cm9sIGFzIERyb3BEb3duTGlzdENvbnRyb2wpLnVyaTtcclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RDaGFuZ2Uoc2VsZWN0ZWQ6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkVmFsdWUgPSBzZWxlY3RlZFsnc2VsZWN0aW9ucyddLm1hcCgoc2VsZWN0aW9uOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnVyaSA/IHNlbGVjdGlvblt0aGlzLnRleHRGaWVsZF0gOiBzZWxlY3Rpb25bdGhpcy5pZEZpZWxkXSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHNlbGVjdGlvblt0aGlzLnRleHRGaWVsZF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaXRlbS52YWx1ZSA9IG5ldyBEcm9wRG93bkxpc3RWYWx1ZSh7XHJcbiAgICAgICAgICAgIHZhbHVlIDogc2VsZWN0ZWRWYWx1ZSxcclxuICAgICAgICAgICAga2V5IDogIHNlbGVjdGVkWyd2YWx1ZSddXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25DaGFuZ2UuZW1pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoZXZlbnQ6IGFueSkge1xyXG4gICAgICAgIHRoaXMuaXRlbS52YWx1ZSA9IG5ldyBEcm9wRG93bkxpc3RWYWx1ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbmRpdGlvbkl0ZW1UaXRsZShmaWVsZDpRdWVyeUNvbmRpdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNvbHV0aW9uU2VydmljZS5nZXRDb25kaXRpb25JdGVtVGl0bGUoZmllbGQpO1xyXG4gICAgfVxyXG59Il19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/querycondition-advanced/querycondition-group/querycondition-group.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ChangeDetectorRef, ElementRef, Injector } from '@angular/core';
import { CompareTypeName, CompareTypeInControl } from '../config/compare-type.config';
import { StateService } from '../service/state.service';
import { cloneDeep } from 'lodash-es';
import { MessagerService } from '@farris/ui-messager';
import { LocaleService } from '@farris/ui-locale';
import { OverLayHiddenService } from "@farris/ui-common";
export class QueryconditionGroupComponent {
    /**
     * @param {?} stateSer
     * @param {?} cd
     * @param {?} msgSer
     * @param {?} localeService
     * @param {?} injector
     */
    constructor(stateSer, cd, msgSer, localeService, injector) {
        this.stateSer = stateSer;
        this.cd = cd;
        this.msgSer = msgSer;
        this.localeService = localeService;
        this.injector = injector;
        this.COMPARE_TYPE_NAME = CompareTypeName;
        this.COMPARE_TYPE_NAME_MULTI = CompareTypeName; //没办法，要求类似于帮助，下拉选择，一个叫等于，两个叫包含，但是逻辑还要一样
        //没办法，要求类似于帮助，下拉选择，一个叫等于，两个叫包含，但是逻辑还要一样
        this.COMPARE_TYPE_IN_CONTROL = CompareTypeInControl;
        this.fieldConfig = [];
        this.checklist = [];
        this.deleteGroupText = this.localeService.getValue('advancedMode.info.deleteGroupTooltip');
        this.fieldConfigSubscribe = null;
        this.checkedListSubscribe = null;
        this.forceState = [];
        this._self = null;
        this.activeConditionType = null;
        this.overLayService = null;
        this.fieldConfig = this.stateSer.getFieldConfig();
        this.fieldConfigSubscribe = this.stateSer.fieldConfig$.subscribe((/**
         * @param {?} config
         * @return {?}
         */
        (config) => {
            this.fieldConfig = config;
        }));
        this.checkedListSubscribe = this.stateSer.checkedList$.subscribe((/**
         * @param {?} checklist
         * @return {?}
         */
        (checklist) => {
            /** @type {?} */
            let _path = this.data.path.join('-');
            if (checklist[_path]) {
                this.checklist = checklist[_path];
            }
            else {
                this.checklist = [];
            }
        }));
        this.COMPARE_TYPE_NAME = [
            this.localeService.getValue('advancedMode.compareType.Equal'),
            this.localeService.getValue('advancedMode.compareType.NotEqual'),
            this.localeService.getValue('advancedMode.compareType.Greater'),
            this.localeService.getValue('advancedMode.compareType.GreaterOrEqual'),
            this.localeService.getValue('advancedMode.compareType.Less'),
            this.localeService.getValue('advancedMode.compareType.LessOrEqual'),
            this.localeService.getValue('advancedMode.compareType.Like'),
            this.localeService.getValue('advancedMode.compareType.LikeStartWith'),
            this.localeService.getValue('advancedMode.compareType.LikeEndWith')
        ];
        this.COMPARE_TYPE_NAME_MULTI = [
            this.localeService.getValue('advancedMode.compareType.Like'),
            this.localeService.getValue('advancedMode.compareType.NotLike'),
            this.localeService.getValue('advancedMode.compareType.Greater'),
            this.localeService.getValue('advancedMode.compareType.GreaterOrEqual'),
            this.localeService.getValue('advancedMode.compareType.Less'),
            this.localeService.getValue('advancedMode.compareType.LessOrEqual'),
            this.localeService.getValue('advancedMode.compareType.Like'),
            this.localeService.getValue('advancedMode.compareType.LikeStartWith'),
            this.localeService.getValue('advancedMode.compareType.LikeEndWith')
        ];
        this.overLayService = new OverLayHiddenService();
        this._self = this.injector.get(ElementRef);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.fieldConfigSubscribe.unsubscribe();
        this.checkedListSubscribe.unsubscribe();
    }
    /**
     * 下拉面板展开关闭事件
     * @param {?} event 下拉展开tue， 关闭false
     * @param {?=} dropdownMenu 点击的dropdown序号
     * @return {?}
     */
    dpStateHandler(event, dropdownMenu) {
        //解决鼠标在dropdown上滚动补关闭dropdown的问题
        if (event && typeof (dropdownMenu) === 'number') {
            this.activeConditionType = dropdownMenu.toString();
            this.forceState = [];
            this.overLayService.registerMouseEvent(this._self.nativeElement, (/**
             * @param {?} e
             * @return {?}
             */
            (e) => {
                if (!this.activeConditionType || !(e.type === 'wheel' || e.type === 'mousewheel'))
                    return;
                /** @type {?} */
                let tar = (/** @type {?} */ (e.target));
                /** @type {?} */
                let classList = Array.from(tar.classList || []);
                if (!classList.includes('dropdown-item-noopen') && this.activeConditionType) {
                    this.activeConditionType = null;
                    this.forceState = [false];
                    this.overLayService.destory(this._self.nativeElement);
                }
            }));
        }
        else {
            this.overLayService.destory(this._self.nativeElement);
        }
    }
    /**
     * 修改筛选条件控件类型
     * @param {?} item 筛选条件对象
     * @param {?} fieldItem 选中的控件类型
     * @return {?}
     */
    changeConditionType(item, fieldItem) {
        /** @type {?} */
        let conditionid = item.conditionid;
        /** @type {?} */
        let _fieldItem = cloneDeep(fieldItem);
        item = _fieldItem;
        item.conditionid = conditionid;
        item.compareType = 0;
        this.stateSer.changeQueryconditionData({ item, path: this.data.path }, 'modify');
    }
    /**
     * 修改筛选条件比较符
     * @param {?} item 筛选条件对象
     * @param {?} compareTypeIndex 筛选条件比较符
     * @return {?}
     */
    changeCompareType(item, compareTypeIndex) {
        item.compareType = compareTypeIndex;
        this.stateSer.changeQueryconditionData({ item, path: this.data.path }, 'modify');
    }
    /**
     * 添加筛选条件
     * @param {?} addPositionItem 添加的位置
     * @return {?}
     */
    addItem(addPositionItem) {
        /** @type {?} */
        let item = cloneDeep(this.fieldConfig[0]);
        this.stateSer.changeQueryconditionData({ item, path: this.data.path, addPositionItem: addPositionItem }, 'add');
    }
    /**
     * 删除筛选条件
     * @param {?} item 删除项
     * @return {?}
     */
    deleteItem(item) {
        this.stateSer.changeQueryconditionData({ deleteItems: [item], path: this.data.path }, 'delete-item');
    }
    /**
     * 修改筛选条件组关联关系
     * @return {?}
     */
    changeRelation() {
        /** @type {?} */
        let relation = this.data.relation === 1 ? 2 : 1;
        this.stateSer.changeGroupData({ relation, path: this.data.path }, 'modify-relation');
    }
    /**
     * 选中筛选条件
     * @param {?} item 选中项
     * @return {?}
     */
    handleCheckItem(item) {
        this.stateSer.changeCheckedList(this.data.path, item.conditionid);
    }
    /**
     * 取消筛选组
     * @return {?}
     */
    deleteGroup() {
        this.msgSer.confirm(this.localeService.getValue('advancedMode.info.deleteGroup')).subscribe((/**
         * @param {?} isConfirm
         * @return {?}
         */
        (isConfirm) => {
            if (isConfirm) {
                this.stateSer.deleteGroup(this.data.groupid, this.data.path);
            }
        }));
    }
}
QueryconditionGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'querycondition-group',
                template: "<div class=\"querycondition-advanced-content\">\r\n\r\n\r\n  <div>\r\n    <div class=\"querycondition-advanced-item\" *ngFor=\"let item of data.items;let i = index\">\r\n      <div class=\"querycondition-advanced-item-type mr-3\" fDropdown (dpChangeEvent)=\"dpStateHandler($event, i)\" [forceState]=\"forceState\" [autoRectify]=\"true\">\r\n        <button class=\"btn btn-secondary dropdown-toggle\" fDropdownToggle type=\"button\" [title]=\"item.fieldName\">\r\n          {{item.fieldName}}\r\n          <span class=\"f-icon f-icon-arrow-chevron-down\"></span>\r\n        </button>\r\n        <div class=\"dropdown-menu\" fDropdownMenu #dropdownMenu>\r\n          <li class=\"dropdown-item dropdown-item-noopen\" *ngFor=\"let fieldItem of fieldConfig;let i = index\"\r\n            (click)=\"changeConditionType(item, fieldItem)\"><span class=\"dropdown-item-noopen\">{{fieldItem.fieldName}}</span></li>\r\n\r\n        </div>\r\n      </div>\r\n      <div class=\"querycondition-advanced-item-compare mr-3\" fDropdown (dpChangeEvent)=\"dpStateHandler($event, i)\" [forceState]=\"forceState\" *ngIf=\"(item.control.singleSelect === undefined &&  item.control.multiSelect === undefined) || item.control.singleSelect === true || item.control.multiSelect === false\">\r\n        <button class=\"btn btn-secondary dropdown-toggle\" fDropdownToggle type=\"button\">\r\n          {{COMPARE_TYPE_NAME[item.compareType]}}\r\n          <span class=\"f-icon f-icon-arrow-chevron-down\"></span>\r\n        </button>\r\n        <div class=\"dropdown-menu\" fDropdownMenu>\r\n          <ng-container *ngFor=\"let label of COMPARE_TYPE_NAME;let i = index\">\r\n            <li class=\"dropdown-item dropdown-item-noopen\" [hidden]=\"!COMPARE_TYPE_IN_CONTROL[item.control.getControlType()].includes(i)\"\r\n            (click)=\"changeCompareType(item, i)\"><span  class=\"dropdown-item-noopen\">{{label}}</span></li>\r\n          </ng-container>\r\n          \r\n\r\n        </div>\r\n      </div>\r\n      <div class=\"querycondition-advanced-item-compare mr-3\" fDropdown (dpChangeEvent)=\"dpStateHandler($event)\" [forceState]=\"forceState\" *ngIf=\" item.control.singleSelect === false || item.control.multiSelect === true\">\r\n        <button class=\"btn btn-secondary dropdown-toggle\" fDropdownToggle type=\"button\">\r\n          {{COMPARE_TYPE_NAME_MULTI[item.compareType]}}\r\n          <span class=\"f-icon f-icon-arrow-chevron-down\"></span>\r\n        </button>\r\n        <div class=\"dropdown-menu\" fDropdownMenu>\r\n          <ng-container *ngFor=\"let label of COMPARE_TYPE_NAME_MULTI;let i = index\">\r\n            <li class=\"dropdown-item  dropdown-item-noopen\" [hidden]=\"!COMPARE_TYPE_IN_CONTROL[item.control.getControlType()].includes(i)\"\r\n            (click)=\"changeCompareType(item, i)\" class=\"dropdown-item-noopen\"><span >{{label}}</span></li>\r\n          </ng-container>\r\n          \r\n\r\n        </div>\r\n      </div>\r\n      <!-- <div class=\"querycondition-advanced-item-control mr-3\">{{data.path.join('-') + ' , ' + data.groupid + ' , ' + item.conditionid}}</div> -->\r\n      <div class=\"querycondition-advanced-item-control mr-3\">\r\n        <querycondition-item [item]=\"item\" ></querycondition-item>\r\n      </div>\r\n      <div class=\"querycondition-advanced-item-extend\">\r\n\r\n        <span class=\"f-icon f-icon-plus-sm mr-2\" (click)=\"addItem(item)\"></span>\r\n        <span class=\"f-icon f-icon-minus-sm\" (click)=\"deleteItem(item)\"></span>\r\n      </div>\r\n      <div class=\"custom-control custom-checkbox\">\r\n        <input #input class=\"custom-control-input\" type=\"checkbox\" \r\n          [checked]=\"checklist.includes(item.conditionid)\" />\r\n        <label class=\"custom-control-label\"\r\n          (click)=\"handleCheckItem(item)\"></label>\r\n      </div>\r\n\r\n\r\n\r\n    </div>\r\n    <querycondition-group [data]=\"children\" *ngFor=\"let children of data.children\"></querycondition-group>\r\n  </div>\r\n\r\n  <div class=\"querycondition-advanced-relation\"  *ngIf=\"(data.items.length + data.children.length) > 0\">\r\n    <span *ngIf=\"data.groupid !== 1\" class=\"querycondition-advanced-relation-close f-icon-filter-cancel btn-link\" (click)=\"deleteGroup()\" farrisTooltip [content]=\"deleteGroupText\"></span>\r\n    <span class=\"querycondition-advanced-relation-text btn-link\" (click)=\"changeRelation()\" >{{(data.relation === 1 ? 'advancedMode.text.and' : 'advancedMode.text.or') | locale}}</span>\r\n    <!-- <span (click)=\"deleteGroup()\">\u53D6\u6D88</span> -->\r\n  </div>\r\n\r\n</div>",
                styles: [".querycondition-advanced-content{display:-webkit-box;display:flex}.querycondition-advanced-item{padding:4px;display:-webkit-box;display:flex;height:40px}.querycondition-advanced-item-type button{text-align:left;width:240px;position:relative;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.querycondition-advanced-item-compare button{text-align:left;width:134px;position:relative}.querycondition-advanced-item-compare .f-icon-arrow-chevron-down::before,.querycondition-advanced-item-type .f-icon-arrow-chevron-down::before{position:absolute;right:8px;bottom:4px}.querycondition-advanced-content .dropdown-toggle::after{display:none}.querycondition-advanced-item-control{line-height:26px;width:240px}.querycondition-advanced-item-extend .f-icon{vertical-align:text-bottom}.querycondition-advanced-item-extend .f-icon:hover{cursor:pointer}.querycondition-advanced-item-extend .f-icon-plus-sm::before{font-size:14px;color:#2a87ff;background-color:#e8f2ff;border-radius:50%;position:relative;top:1px}.querycondition-advanced-item-extend .f-icon-minus-sm::before{font-size:14px;color:#f46160;background-color:#fadcdd;border-radius:50%;position:relative;top:1px}.querycondition-advanced-relation{margin:2px 0 2px 12px;border-left:1px solid rgba(222,227,240,1);position:relative;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;padding-left:12px;font-size:13px;color:#2a87ff;text-align:center;cursor:pointer}.querycondition-advanced-relation:hover .querycondition-advanced-relation-close{display:inline}.querycondition-advanced-relation-close{position:absolute;top:-4px;display:none}.querycondition-advanced-relation:hover .querycondition-advanced-relation-text{text-decoration:underline}.querycondition-advanced-item .custom-control-label:before{position:relative;top:2px}.querycondition-advanced-relation button{width:20px}.dropdown-menu{-webkit-writing-mode:horizontal-tb;-ms-writing-mode:lr-tb;writing-mode:horizontal-tb;overflow-y:overlay;max-height:45%}"]
            }] }
];
/** @nocollapse */
QueryconditionGroupComponent.ctorParameters = () => [
    { type: StateService },
    { type: ChangeDetectorRef },
    { type: MessagerService },
    { type: LocaleService },
    { type: Injector }
];
QueryconditionGroupComponent.propDecorators = {
    data: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    QueryconditionGroupComponent.prototype.COMPARE_TYPE_NAME;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.COMPARE_TYPE_NAME_MULTI;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.COMPARE_TYPE_IN_CONTROL;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.data;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.fieldConfig;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.checklist;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.deleteGroupText;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.fieldConfigSubscribe;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.checkedListSubscribe;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.forceState;
    /** @type {?} */
    QueryconditionGroupComponent.prototype._self;
    /** @type {?} */
    QueryconditionGroupComponent.prototype.activeConditionType;
    /**
     * @type {?}
     * @private
     */
    QueryconditionGroupComponent.prototype.overLayService;
    /**
     * @type {?}
     * @private
     */
    QueryconditionGroupComponent.prototype.stateSer;
    /**
     * @type {?}
     * @private
     */
    QueryconditionGroupComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    QueryconditionGroupComponent.prototype.msgSer;
    /**
     * @type {?}
     * @private
     */
    QueryconditionGroupComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    QueryconditionGroupComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnljb25kaXRpb24tZ3JvdXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21wb25lbnQtcXVlcnljb25kaXRpb24vIiwic291cmNlcyI6WyJsaWIvcXVlcnljb25kaXRpb24tYWR2YW5jZWQvcXVlcnljb25kaXRpb24tZ3JvdXAvcXVlcnljb25kaXRpb24tZ3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsaUJBQWlCLEVBQXdCLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEgsT0FBTyxFQUFlLGVBQWUsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBRW5HLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQTtBQUV2RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFNekQsTUFBTSxPQUFPLDRCQUE0Qjs7Ozs7Ozs7SUFpQnZDLFlBQW9CLFFBQXNCLEVBQVUsRUFBcUIsRUFBVSxNQUF1QixFQUFVLGFBQTRCLEVBQVUsUUFBa0I7UUFBeEosYUFBUSxHQUFSLFFBQVEsQ0FBYztRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFmNUssc0JBQWlCLEdBQUcsZUFBZSxDQUFBO1FBQ25DLDRCQUF1QixHQUFHLGVBQWUsQ0FBQSxDQUFDLHVDQUF1Qzs7UUFDakYsNEJBQXVCLEdBQUcsb0JB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LFFBQVEsRUFBRSxzQkFBc0I7Z0JBQ2hDLHUvSUFBb0Q7O2FBRXJEOzs7O1lBWFEsWUFBWTtZQUhjLGlCQUFpQjtZQU0zQyxlQUFlO1lBQ2YsYUFBYTtZQVBrRSxRQUFROzs7bUJBb0I3RixLQUFLOzs7O0lBSE4seURBQW1DOztJQUNuQywrREFBeUM7O0lBQ3pDLCtEQUE4Qzs7SUFDOUMsNENBQXlDOztJQUV6QyxtREFBdUM7O0lBQ3ZDLGlEQUE2Qjs7SUFFN0IsdURBQXFGOztJQUNyRiw0REFBeUM7O0lBQ3pDLDREQUF5Qzs7SUFDekMsa0RBQWU7O0lBQ2YsNkNBQVk7O0lBQ1osMkRBQTBCOzs7OztJQUMxQixzREFBb0Q7Ozs7O0lBQ3hDLGdEQUE4Qjs7Ozs7SUFBRSwwQ0FBNkI7Ozs7O0lBQUUsOENBQStCOzs7OztJQUFFLHFEQUFvQzs7Ozs7SUFBRSxnREFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIENoYW5nZURldGVjdG9yUmVmLCBPbkRlc3Ryb3ksIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29tcGFyZVR5cGUsIENvbXBhcmVUeXBlTmFtZSwgQ29tcGFyZVR5cGVJbkNvbnRyb2wgfSBmcm9tICcuLi9jb25maWcvY29tcGFyZS10eXBlLmNvbmZpZyc7XHJcbmltcG9ydCB7IFF1ZXJ5Y29uZGl0aW9uQWR2YW5jZWREYXRhIH0gZnJvbSAnLi4vdHlwZS90eXBlJ1xyXG5pbXBvcnQgeyBTdGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL3N0YXRlLnNlcnZpY2UnXHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L1F1ZXJ5Q29uZGl0aW9uJ1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcy9pbnRlcm5hbC9TdWJzY3JpcHRpb24nO1xyXG5pbXBvcnQgeyBPdmVyTGF5SGlkZGVuU2VydmljZSB9IGZyb20gXCJAZmFycmlzL3VpLWNvbW1vblwiO1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3F1ZXJ5Y29uZGl0aW9uLWdyb3VwJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcXVlcnljb25kaXRpb24tZ3JvdXAuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3F1ZXJ5Y29uZGl0aW9uLWdyb3VwLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUXVlcnljb25kaXRpb25Hcm91cENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgQ09NUEFSRV9UWVBFX05BTUUgPSBDb21wYXJlVHlwZU5hbWVcclxuICBDT01QQVJFX1RZUEVfTkFNRV9NVUxUSSA9IENvbXBhcmVUeXBlTmFtZSAvL+ayoeWKnuazle+8jOimgeaxguexu+S8vOS6juW4ruWKqe+8jOS4i+aLiemAieaLqe+8jOS4gOS4quWPq+etieS6ju+8jOS4pOS4quWPq+WMheWQq++8jOS9huaYr+mAu+i+kei/mOimgeS4gOagt1xyXG4gIENPTVBBUkVfVFlQRV9JTl9DT05UUk9MID0gQ29tcGFyZVR5cGVJbkNvbnRyb2xcclxuICBASW5wdXQoKSBkYXRhOiBRdWVyeWNvbmRpdGlvbkFkdmFuY2VkRGF0YVxyXG5cclxuICBmaWVsZENvbmZpZzogQXJyYXk8UXVlcnlDb25kaXRpb24+ID0gW11cclxuICBjaGVja2xpc3Q6IEFycmF5PHN0cmluZz4gPSBbXVxyXG5cclxuICBkZWxldGVHcm91cFRleHQgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5pbmZvLmRlbGV0ZUdyb3VwVG9vbHRpcCcpXHJcbiAgZmllbGRDb25maWdTdWJzY3JpYmU6IFN1YnNjcmlwdGlvbiA9IG51bGxcclxuICBjaGVja2VkTGlzdFN1YnNjcmliZTogU3Vic2NyaXB0aW9uID0gbnVsbFxyXG4gIGZvcmNlU3RhdGUgPSBbXVxyXG4gIF9zZWxmID0gbnVsbFxyXG4gIGFjdGl2ZUNvbmRpdGlvblR5cGUgPSBudWxsIFxyXG4gIHByaXZhdGUgb3ZlckxheVNlcnZpY2U6IE92ZXJMYXlIaWRkZW5TZXJ2aWNlID0gbnVsbDtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0YXRlU2VyOiBTdGF0ZVNlcnZpY2UsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIG1zZ1NlcjogTWVzc2FnZXJTZXJ2aWNlLCBwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UsIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yKSB7XHJcbiAgICB0aGlzLmZpZWxkQ29uZmlnID0gdGhpcy5zdGF0ZVNlci5nZXRGaWVsZENvbmZpZygpXHJcbiAgICB0aGlzLmZpZWxkQ29uZmlnU3Vic2NyaWJlID0gdGhpcy5zdGF0ZVNlci5maWVsZENvbmZpZyQuc3Vic2NyaWJlKChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLmZpZWxkQ29uZmlnID0gY29uZmlnXHJcbiAgICB9KVxyXG4gICAgdGhpcy5jaGVja2VkTGlzdFN1YnNjcmliZSA9IHRoaXMuc3RhdGVTZXIuY2hlY2tlZExpc3QkLnN1YnNjcmliZSgoY2hlY2tsaXN0OiBBcnJheTxzdHJpbmc+KSA9PiB7XHJcblxyXG4gICAgICBsZXQgX3BhdGggPSB0aGlzLmRhdGEucGF0aC5qb2luKCctJylcclxuICAgICAgaWYgKGNoZWNrbGlzdFtfcGF0aF0pIHtcclxuICAgICAgICB0aGlzLmNoZWNrbGlzdCA9IGNoZWNrbGlzdFtfcGF0aF1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmNoZWNrbGlzdCA9IFtdXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICB0aGlzLkNPTVBBUkVfVFlQRV9OQU1FID0gW1xyXG4gICAgICB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5jb21wYXJlVHlwZS5FcXVhbCcpLFxyXG4gICAgICB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5jb21wYXJlVHlwZS5Ob3RFcXVhbCcpLFxyXG4gICAgICB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5jb21wYXJlVHlwZS5HcmVhdGVyJyksXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkdyZWF0ZXJPckVxdWFsJyksXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkxlc3MnKSxcclxuICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuY29tcGFyZVR5cGUuTGVzc09yRXF1YWwnKSxcclxuICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuY29tcGFyZVR5cGUuTGlrZScpLFxyXG4gICAgICB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5jb21wYXJlVHlwZS5MaWtlU3RhcnRXaXRoJyksXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkxpa2VFbmRXaXRoJylcclxuICAgIF1cclxuICAgIHRoaXMuQ09NUEFSRV9UWVBFX05BTUVfTVVMVEkgPSBbXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkxpa2UnKSxcclxuICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuY29tcGFyZVR5cGUuTm90TGlrZScpLFxyXG4gICAgICB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5jb21wYXJlVHlwZS5HcmVhdGVyJyksXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkdyZWF0ZXJPckVxdWFsJyksXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkxlc3MnKSxcclxuICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuY29tcGFyZVR5cGUuTGVzc09yRXF1YWwnKSxcclxuICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuY29tcGFyZVR5cGUuTGlrZScpLFxyXG4gICAgICB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5jb21wYXJlVHlwZS5MaWtlU3RhcnRXaXRoJyksXHJcbiAgICAgIHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmNvbXBhcmVUeXBlLkxpa2VFbmRXaXRoJylcclxuICAgIF1cclxuICAgIHRoaXMub3ZlckxheVNlcnZpY2UgPSBuZXcgT3ZlckxheUhpZGRlblNlcnZpY2UoKTtcclxuICAgIHRoaXMuX3NlbGYgPSB0aGlzLmluamVjdG9yLmdldChFbGVtZW50UmVmKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZmllbGRDb25maWdTdWJzY3JpYmUudW5zdWJzY3JpYmUoKVxyXG4gICAgdGhpcy5jaGVja2VkTGlzdFN1YnNjcmliZS51bnN1YnNjcmliZSgpXHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5LiL5ouJ6Z2i5p2/5bGV5byA5YWz6Zet5LqL5Lu2XHJcbiAgICogQHBhcmFtIGV2ZW50IOS4i+aLieWxleW8gHR1Ze+8jCDlhbPpl61mYWxzZVxyXG4gICAqIEBwYXJhbSBkcm9wZG93bk1lbnUg54K55Ye755qEZHJvcGRvd27luo/lj7dcclxuICAgKi9cclxuICBkcFN0YXRlSGFuZGxlcihldmVudCwgZHJvcGRvd25NZW51Pykge1xyXG4gICAgLy/op6PlhrPpvKDmoIflnKhkcm9wZG93buS4iua7muWKqOihpeWFs+mXrWRyb3Bkb3du55qE6Zeu6aKYXHJcbiAgICBpZiAoZXZlbnQgJiYgdHlwZW9mIChkcm9wZG93bk1lbnUpID09PSAnbnVtYmVyJykge1xyXG4gICAgICB0aGlzLmFjdGl2ZUNvbmRpdGlvblR5cGUgPSBkcm9wZG93bk1lbnUudG9TdHJpbmcoKVxyXG4gICAgICB0aGlzLmZvcmNlU3RhdGUgPSBbXVxyXG4gICAgICB0aGlzLm92ZXJMYXlTZXJ2aWNlLnJlZ2lzdGVyTW91c2VFdmVudCh0aGlzLl9zZWxmLm5hdGl2ZUVsZW1lbnQsIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZUNvbmRpdGlvblR5cGUgfHwgIShlLnR5cGUgPT09ICd3aGVlbCcgfHwgZS50eXBlID09PSAnbW91c2V3aGVlbCcpKSByZXR1cm5cclxuICAgICAgICBsZXQgdGFyID0gZS50YXJnZXQgYXMgYW55XHJcbiAgICAgICAgbGV0IGNsYXNzTGlzdCA9IEFycmF5LmZyb20odGFyLmNsYXNzTGlzdCB8fCBbXSlcclxuICAgICAgICBpZiAoIWNsYXNzTGlzdC5pbmNsdWRlcygnZHJvcGRvd24taXRlbS1ub29wZW4nKSAmJiB0aGlzLmFjdGl2ZUNvbmRpdGlvblR5cGUpIHtcclxuICAgICAgICAgIHRoaXMuYWN0aXZlQ29uZGl0aW9uVHlwZSA9IG51bGxcclxuICAgICAgICAgIHRoaXMuZm9yY2VTdGF0ZSA9IFtmYWxzZV1cclxuICAgICAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLl9zZWxmLm5hdGl2ZUVsZW1lbnQpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMub3ZlckxheVNlcnZpY2UuZGVzdG9yeSh0aGlzLl9zZWxmLm5hdGl2ZUVsZW1lbnQpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDkv67mlLnnrZvpgInmnaHku7bmjqfku7bnsbvlnotcclxuICAgKiBAcGFyYW0gaXRlbSDnrZvpgInmnaHku7blr7nosaFcclxuICAgKiBAcGFyYW0gZmllbGRJdGVtIOmAieS4reeahOaOp+S7tuexu+Wei1xyXG4gICAqL1xyXG4gIGNoYW5nZUNvbmRpdGlvblR5cGUoaXRlbSwgZmllbGRJdGVtKSB7XHJcbiAgICBsZXQgY29uZGl0aW9uaWQgPSBpdGVtLmNvbmRpdGlvbmlkXHJcbiAgICBsZXQgX2ZpZWxkSXRlbSA9IGNsb25lRGVlcChmaWVsZEl0ZW0pXHJcblxyXG4gICAgaXRlbSA9IF9maWVsZEl0ZW1cclxuICAgIGl0ZW0uY29uZGl0aW9uaWQgPSBjb25kaXRpb25pZFxyXG4gICAgaXRlbS5jb21wYXJlVHlwZSA9IDBcclxuICAgIHRoaXMuc3RhdGVTZXIuY2hhbmdlUXVlcnljb25kaXRpb25EYXRhKHsgaXRlbSwgcGF0aDogdGhpcy5kYXRhLnBhdGggfSwgJ21vZGlmeScpXHJcblxyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDkv67mlLnnrZvpgInmnaHku7bmr5TovoPnrKZcclxuICAgKiBAcGFyYW0gaXRlbSDnrZvpgInmnaHku7blr7nosaFcclxuICAgKiBAcGFyYW0gY29tcGFyZVR5cGVJbmRleCDnrZvpgInmnaHku7bmr5TovoPnrKZcclxuICAgKi9cclxuICBjaGFuZ2VDb21wYXJlVHlwZShpdGVtLCBjb21wYXJlVHlwZUluZGV4KSB7XHJcbiAgICBpdGVtLmNvbXBhcmVUeXBlID0gY29tcGFyZVR5cGVJbmRleFxyXG4gICAgdGhpcy5zdGF0ZVNlci5jaGFuZ2VRdWVyeWNvbmRpdGlvbkRhdGEoeyBpdGVtLCBwYXRoOiB0aGlzLmRhdGEucGF0aCB9LCAnbW9kaWZ5JylcclxuXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5re75Yqg562b6YCJ5p2h5Lu2XHJcbiAgICogQHBhcmFtIGFkZFBvc2l0aW9uSXRlbSDmt7vliqDnmoTkvY3nva4gXHJcbiAgICovXHJcbiAgYWRkSXRlbShhZGRQb3NpdGlvbkl0ZW0pIHtcclxuICAgIGxldCBpdGVtID0gY2xvbmVEZWVwKHRoaXMuZmllbGRDb25maWdbMF0pXHJcbiAgICB0aGlzLnN0YXRlU2VyLmNoYW5nZVF1ZXJ5Y29uZGl0aW9uRGF0YSh7IGl0ZW0sIHBhdGg6IHRoaXMuZGF0YS5wYXRoLCBhZGRQb3NpdGlvbkl0ZW06IGFkZFBvc2l0aW9uSXRlbSB9LCAnYWRkJylcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOetm+mAieadoeS7tiBcclxuICAgKiBAcGFyYW0gaXRlbSDliKDpmaTpoblcclxuICAgKi9cclxuICBkZWxldGVJdGVtKGl0ZW0pIHtcclxuICAgIHRoaXMuc3RhdGVTZXIuY2hhbmdlUXVlcnljb25kaXRpb25EYXRhKHsgZGVsZXRlSXRlbXM6IFtpdGVtXSwgcGF0aDogdGhpcy5kYXRhLnBhdGggfSwgJ2RlbGV0ZS1pdGVtJylcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS/ruaUueetm+mAieadoeS7tue7hOWFs+iBlOWFs+ezu1xyXG4gICAqL1xyXG4gIGNoYW5nZVJlbGF0aW9uKCkge1xyXG4gICAgbGV0IHJlbGF0aW9uID0gdGhpcy5kYXRhLnJlbGF0aW9uID09PSAxID8gMiA6IDFcclxuICAgIHRoaXMuc3RhdGVTZXIuY2hhbmdlR3JvdXBEYXRhKHsgcmVsYXRpb24sIHBhdGg6IHRoaXMuZGF0YS5wYXRoIH0sICdtb2RpZnktcmVsYXRpb24nKVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAieS4reetm+mAieadoeS7tlxyXG4gICAqIEBwYXJhbSBpdGVtIOmAieS4remhuVxyXG4gICAqL1xyXG4gIGhhbmRsZUNoZWNrSXRlbShpdGVtKSB7XHJcbiAgICB0aGlzLnN0YXRlU2VyLmNoYW5nZUNoZWNrZWRMaXN0KHRoaXMuZGF0YS5wYXRoLCBpdGVtLmNvbmRpdGlvbmlkKVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOetm+mAiee7hFxyXG4gICAqL1xyXG4gIGRlbGV0ZUdyb3VwKCkge1xyXG4gICAgdGhpcy5tc2dTZXIuY29uZmlybSh0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5pbmZvLmRlbGV0ZUdyb3VwJykpLnN1YnNjcmliZSgoaXNDb25maXJtKSA9PiB7XHJcbiAgICAgIGlmIChpc0NvbmZpcm0pIHtcclxuICAgICAgICB0aGlzLnN0YXRlU2VyLmRlbGV0ZUdyb3VwKHRoaXMuZGF0YS5ncm91cGlkLCB0aGlzLmRhdGEucGF0aClcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxufVxyXG4iXX0=
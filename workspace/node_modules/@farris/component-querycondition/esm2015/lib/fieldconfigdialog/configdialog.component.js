/**
 * @fileoverview added by tsickle
 * Generated from: lib/fieldconfigdialog/configdialog.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, ViewEncapsulation, Input } from '@angular/core';
import { SolutionService } from '../service/solution.service';
import { LocaleService } from '@farris/ui-locale';
import { DialogComponent } from '@farris/ui-dialog';
import { MultiSelectComponent } from '@farris/ui-multi-select';
import { NotifyService } from '@farris/ui-notify';
export class ConfigDialogComponent {
    /**
     * @param {?} solutionService
     * @param {?} localeService
     * @param {?} notify
     */
    constructor(solutionService, localeService, notify) {
        this.solutionService = solutionService;
        this.localeService = localeService;
        this.notify = notify;
        this.inputSelectedFileds = [];
        this.cancelEmitter = new EventEmitter();
        this.confirmEmitter = new EventEmitter();
        this.selectedIds = [];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.filedsDataSource && changes.filedsDataSource.currentValue) {
            this.visibleFields = this.filedsDataSource.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => { return !!item.visible; }));
        }
        if (changes.inputSelectedFileds && changes.inputSelectedFileds.currentValue) {
            this.visibleSelectedFields = this.inputSelectedFileds.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => { return !!item.visible; }));
            if (this.visibleSelectedFields.length) {
                this.selectedIds = this.visibleSelectedFields.map((/**
                 * @param {?} qc
                 * @return {?}
                 */
                qc => qc.id));
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.title = this.localeService.getValue('queryCondition.container.config');
        if (this.filedsDataSource) {
            this.visibleFields = this.filedsDataSource.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => { return !!item.visible; }));
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.multiSelectCmp.enableMoveMore !== undefined) {
            this.multiSelectCmp.enableMoveMore = true;
        }
    }
    /**
     * 取消
     * @return {?}
     */
    cancel() {
        this.selectedIds = this.visibleSelectedFields.map((/**
         * @param {?} qc
         * @return {?}
         */
        qc => qc.id));
        //undo: 穿梭框组件的selectedId值为空数组时存在问题，通过组建的moveAllToLeft保证该功能
        if (!this.selectedIds.length) {
            this.multiSelectCmp.moveAllToLeft();
        }
        this.cancelEmitter.emit(true);
        this.multiSelectCmp.searchValue = '';
        this.dialog.close();
    }
    /**
     * 确认
     * @return {?}
     */
    confirm() {
        //必填字段必选选择，否则给与提示
        /** @type {?} */
        let requiredAndUncheck = this.visibleFields.filter((/**
         * @param {?} val
         * @return {?}
         */
        val => val.control && val.control.isRequired())).filter((/**
         * @param {?} item
         * @return {?}
         */
        item => !this.selectedIds.includes(item.id)));
        if (requiredAndUncheck && requiredAndUncheck.length) {
            /** @type {?} */
            let msg = requiredAndUncheck.map((/**
             * @param {?} val
             * @return {?}
             */
            val => val.fieldName)).join('、') + '为必选字段，请勾选后再进行保存操作。';
            this.notify.error(msg);
            return;
        }
        /** @type {?} */
        const selectedFields = [];
        /** @type {?} */
        let _fieldData;
        this.selectedIds.forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            /** @type {?} */
            const index = this.visibleSelectedFields.findIndex((/**
             * @param {?} field
             * @return {?}
             */
            field => field.id == id));
            if (index > -1) {
                selectedFields.push(this.visibleSelectedFields[index].fieldCode);
            }
            else {
                _fieldData = this.visibleFields.find((/**
                 * @param {?} field
                 * @return {?}
                 */
                field => field.id == id));
                _fieldData.value.clearValue();
                selectedFields.push(_fieldData.fieldCode);
            }
        }));
        this.confirmEmitter.emit(selectedFields);
        this.multiSelectCmp.searchValue = '';
        this.dialog.close();
    }
    /**
     * 重置
     * @return {?}
     */
    reset() {
    }
}
ConfigDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-queryconfigdialog',
                template: "<farris-dialog #dialog [buttons]=\"configDialogButtonRef\" [width]=\"699\" [height]=\"544\" [title]=\"title\">\r\n    <multi-select #searchMulti \r\n    [dataSource]=\"visibleFields\"\r\n     [idField]=\"'id'\" \r\n     [textField]=\"'fieldName'\" \r\n     [displayType]=\"'List'\" \r\n     [(selectedId)]=\"selectedIds\" \r\n     [showCheckbox]=\"true\">\r\n        <ng-template farrisTemplate=\"text\" let-data>\r\n            {{ data['fieldName'] }}\r\n        </ng-template>\r\n    </multi-select>\r\n</farris-dialog>\r\n<ng-template #configDialogButtonRef>\r\n    <button class=\"btn btn-primary\" (click)=\"confirm()\">{{'queryCondition.configDialog.confirm' | locale}}</button>\r\n    <button class=\"btn btn-secondary\" (click)=\"cancel()\">{{'queryCondition.configDialog.cancel' | locale}}</button>\r\n</ng-template>",
                encapsulation: ViewEncapsulation.None,
                styles: [""]
            }] }
];
/** @nocollapse */
ConfigDialogComponent.ctorParameters = () => [
    { type: SolutionService },
    { type: LocaleService },
    { type: NotifyService }
];
ConfigDialogComponent.propDecorators = {
    inputSelectedFileds: [{ type: Input }],
    filedsDataSource: [{ type: Input }],
    cancelEmitter: [{ type: Output }],
    confirmEmitter: [{ type: Output }],
    dialog: [{ type: ViewChild, args: ['dialog',] }],
    multiSelectCmp: [{ type: ViewChild, args: ['searchMulti',] }]
};
if (false) {
    /** @type {?} */
    ConfigDialogComponent.prototype.inputSelectedFileds;
    /** @type {?} */
    ConfigDialogComponent.prototype.filedsDataSource;
    /** @type {?} */
    ConfigDialogComponent.prototype.cancelEmitter;
    /** @type {?} */
    ConfigDialogComponent.prototype.confirmEmitter;
    /** @type {?} */
    ConfigDialogComponent.prototype.dialog;
    /** @type {?} */
    ConfigDialogComponent.prototype.multiSelectCmp;
    /** @type {?} */
    ConfigDialogComponent.prototype.selectedIds;
    /** @type {?} */
    ConfigDialogComponent.prototype.title;
    /** @type {?} */
    ConfigDialogComponent.prototype.visibleFields;
    /** @type {?} */
    ConfigDialogComponent.prototype.visibleSelectedFields;
    /**
     * @type {?}
     * @private
     */
    ConfigDialogComponent.prototype.solutionService;
    /**
     * @type {?}
     * @private
     */
    ConfigDialogComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    ConfigDialogComponent.prototype.notify;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uLyIsInNvdXJjZXMiOlsibGliL2ZpZWxkY29uZmlnZGlhbG9nL2NvbmZpZ2RpYWxvZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUE0QixpQkFBaUIsRUFBYyxLQUFLLEVBQXFGLE1BQU0sZUFBZSxDQUFDO0FBQ3RPLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQU9sRCxNQUFNLE9BQU8scUJBQXFCOzs7Ozs7SUFZOUIsWUFBb0IsZUFBZ0MsRUFBVSxhQUE0QixFQUFVLE1BQXFCO1FBQXJHLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQVhoSCx3QkFBbUIsR0FBMEIsRUFBRSxDQUFDO1FBRS9DLGtCQUFhLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDM0QsbUJBQWMsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUl0RSxnQkFBVyxHQUFrQixFQUFFLENBQUM7SUFJNkYsQ0FBQzs7Ozs7SUFFOUgsV0FBVyxDQUFDLE9BQXNCO1FBQzlCLElBQUcsT0FBTyxDQUFDLGdCQUFnQixJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUU7WUFDbEUsSUFBSSxDQUFD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QWlEOztJQUNqRCw4Q0FBcUU7O0lBQ3JFLCtDQUFzRTs7SUFDdEUsdUNBQTZDOztJQUM3QywrQ0FBK0Q7O0lBRS9ELDRDQUFnQzs7SUFDaEMsc0NBQWM7O0lBQ2QsOENBQXFDOztJQUNyQyxzREFBNkM7Ozs7O0lBQ2pDLGdEQUF3Qzs7Ozs7SUFBRSw4Q0FBb0M7Ozs7O0lBQUUsdUNBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBIb3N0QmluZGluZywgVmlld0VuY2Fwc3VsYXRpb24sIEVsZW1lbnRSZWYsIElucHV0LCBTa2lwU2VsZiwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBDb250ZW50Q2hpbGQsIEFmdGVyQ29udGVudEluaXQsIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU29sdXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9zb2x1dGlvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTG9jYWxlU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9jYWxlJztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiB9IGZyb20gJy4uL2VudGl0eS9xdWVyeWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IE11bHRpU2VsZWN0Q29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1tdWx0aS1zZWxlY3QnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLXF1ZXJ5Y29uZmlnZGlhbG9nJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9jb25maWdkaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vY29uZmlnZGlhbG9nLmNvbXBvbmVudC5jc3MnXSxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIENvbmZpZ0RpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHtcclxuICAgIEBJbnB1dCgpIGlucHV0U2VsZWN0ZWRGaWxlZHM6IEFycmF5PFF1ZXJ5Q29uZGl0aW9uPiA9IFtdO1xyXG4gICAgQElucHV0KCkgZmlsZWRzRGF0YVNvdXJjZTogQXJyYXk8UXVlcnlDb25kaXRpb24+O1xyXG4gICAgQE91dHB1dCgpIGNhbmNlbEVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICBAT3V0cHV0KCkgY29uZmlybUVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICBAVmlld0NoaWxkKCdkaWFsb2cnKSBkaWFsb2c6IERpYWxvZ0NvbXBvbmVudDtcclxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaE11bHRpJykgbXVsdGlTZWxlY3RDbXA6IE11bHRpU2VsZWN0Q29tcG9uZW50O1xyXG5cclxuICAgIHNlbGVjdGVkSWRzOiBBcnJheTxzdHJpbmc+ID0gW107XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG4gICAgdmlzaWJsZUZpZWxkczogQXJyYXk8UXVlcnlDb25kaXRpb24+O1xyXG4gICAgdmlzaWJsZVNlbGVjdGVkRmllbGRzOiBBcnJheTxRdWVyeUNvbmRpdGlvbj47XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNvbHV0aW9uU2VydmljZTogU29sdXRpb25TZXJ2aWNlLCBwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UsIHByaXZhdGUgbm90aWZ5OiBOb3RpZnlTZXJ2aWNlKSB7IH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgaWYoY2hhbmdlcy5maWxlZHNEYXRhU291cmNlICYmIGNoYW5nZXMuZmlsZWRzRGF0YVNvdXJjZS5jdXJyZW50VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy52aXNpYmxlRmllbGRzID0gdGhpcy5maWxlZHNEYXRhU291cmNlLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gISFpdGVtLnZpc2libGV9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFuZ2VzLmlucHV0U2VsZWN0ZWRGaWxlZHMgJiYgY2hhbmdlcy5pbnB1dFNlbGVjdGVkRmlsZWRzLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZpc2libGVTZWxlY3RlZEZpZWxkcyA9IHRoaXMuaW5wdXRTZWxlY3RlZEZpbGVkcy5maWx0ZXIoaXRlbSA9PiB7cmV0dXJuICEhaXRlbS52aXNpYmxlfSk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMudmlzaWJsZVNlbGVjdGVkRmllbGRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZElkcyA9IHRoaXMudmlzaWJsZVNlbGVjdGVkRmllbGRzLm1hcChxYyA9PiBxYy5pZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgncXVlcnlDb25kaXRpb24uY29udGFpbmVyLmNvbmZpZycpO1xyXG4gICAgICAgIGlmKHRoaXMuZmlsZWRzRGF0YVNvdXJjZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZpc2libGVGaWVsZHMgPSB0aGlzLmZpbGVkc0RhdGFTb3VyY2UuZmlsdGVyKGl0ZW0gPT4ge3JldHVybiAhIWl0ZW0udmlzaWJsZX0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgaWYodGhpcy5tdWx0aVNlbGVjdENtcC5lbmFibGVNb3ZlTW9yZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubXVsdGlTZWxlY3RDbXAuZW5hYmxlTW92ZU1vcmUgPSB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlj5bmtohcclxuICAgICAqL1xyXG4gICAgY2FuY2VsKCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJZHMgPSB0aGlzLnZpc2libGVTZWxlY3RlZEZpZWxkcy5tYXAocWMgPT4gcWMuaWQpO1xyXG4gICAgICAgIC8vdW5kbzog56m/5qKt5qGG57uE5Lu255qEc2VsZWN0ZWRJZOWAvOS4uuepuuaVsOe7hOaXtuWtmOWcqOmXrumimO+8jOmAmui/h+e7hOW7uueahG1vdmVBbGxUb0xlZnTkv53or4Hor6Xlip/og71cclxuICAgICAgICBpZighdGhpcy5zZWxlY3RlZElkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5tdWx0aVNlbGVjdENtcC5tb3ZlQWxsVG9MZWZ0KClcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYW5jZWxFbWl0dGVyLmVtaXQodHJ1ZSk7ICAgICAgICBcclxuICAgICAgICB0aGlzLm11bHRpU2VsZWN0Q21wLnNlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOehruiupFxyXG4gICAgICovXHJcbiAgICBjb25maXJtKCkge1xyXG5cclxuICAgICAgICAvL+W/heWhq+Wtl+auteW/hemAiemAieaLqe+8jOWQpuWImee7meS4juaPkOekulxyXG4gICAgICAgIGxldCByZXF1aXJlZEFuZFVuY2hlY2sgID0gdGhpcy52aXNpYmxlRmllbGRzLmZpbHRlcih2YWwgPT4gdmFsLmNvbnRyb2wgJiYgdmFsLmNvbnRyb2wuaXNSZXF1aXJlZCgpKS5maWx0ZXIoaXRlbSA9PiAhdGhpcy5zZWxlY3RlZElkcy5pbmNsdWRlcyhpdGVtLmlkKSlcclxuICAgICAgICBpZihyZXF1aXJlZEFuZFVuY2hlY2sgJiYgcmVxdWlyZWRBbmRVbmNoZWNrLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZXQgbXNnID0gcmVxdWlyZWRBbmRVbmNoZWNrLm1hcCh2YWwgPT4gdmFsLmZpZWxkTmFtZSkuam9pbign44CBJykgKyAn5Li65b+F6YCJ5a2X5q6177yM6K+35Yu+6YCJ5ZCO5YaN6L+b6KGM5L+d5a2Y5pON5L2c44CCJ1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeS5lcnJvcihtc2cpXHJcbiAgICAgICAgICAgIHJldHVybiBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRGaWVsZHMgPSBbXTtcclxuICAgICAgICBsZXQgX2ZpZWxkRGF0YTogUXVlcnlDb25kaXRpb247XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZElkcy5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnZpc2libGVTZWxlY3RlZEZpZWxkcy5maW5kSW5kZXgoZmllbGQgPT4gZmllbGQuaWQgPT0gaWQpO1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHMucHVzaCh0aGlzLnZpc2libGVTZWxlY3RlZEZpZWxkc1tpbmRleF0uZmllbGRDb2RlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9maWVsZERhdGEgPSB0aGlzLnZpc2libGVGaWVsZHMuZmluZChmaWVsZCA9PiBmaWVsZC5pZCA9PSBpZCk7XHJcbiAgICAgICAgICAgICAgICBfZmllbGREYXRhLnZhbHVlLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzLnB1c2goX2ZpZWxkRGF0YS5maWVsZENvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jb25maXJtRW1pdHRlci5lbWl0KHNlbGVjdGVkRmllbGRzKTtcclxuICAgICAgICB0aGlzLm11bHRpU2VsZWN0Q21wLnNlYXJjaFZhbHVlID0gJyc7XHJcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmHjee9rlxyXG4gICAgICovXHJcbiAgICByZXNldCgpIHtcclxuXHJcbiAgICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * Generated from: lib/querycondition-advanced/service/state.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { NotifyService } from '@farris/ui-notify';
import { cloneDeep } from 'lodash-es';
import { LocaleService } from '@farris/ui-locale';
var StateService = /** @class */ (function () {
    function StateService(notifySer, localeService) {
        this.notifySer = notifySer;
        this.localeService = localeService;
        this.fieldConfig = [];
        this.fieldConfig$ = new Subject();
        this.queryconditionData$ = new Subject();
        this.queryconditionListData$ = new Subject();
        this.checkedList = {};
        this.checkedList$ = new Subject();
    }
    /**
     * 重置筛选条件
     */
    /**
     * 重置筛选条件
     * @return {?}
     */
    StateService.prototype.reset = /**
     * 重置筛选条件
     * @return {?}
     */
    function () {
        this.queryconditionData = { relation: 1, items: [], children: [], path: [1], groupid: 1 };
        this.queryconditionData$.next(this.queryconditionData);
        this.updateQueryConditionListData();
    };
    /**
     *
     * @param data
     * @param type
     * @param isEmit 默认要发送emit，生成分组触发时不需要emit，因为生成分组方法本身会触发
     */
    /**
     *
     * @param {?} data
     * @param {?} type
     * @param {?=} isEmit 默认要发送emit，生成分组触发时不需要emit，因为生成分组方法本身会触发
     * @return {?}
     */
    StateService.prototype.changeQueryconditionData = /**
     *
     * @param {?} data
     * @param {?} type
     * @param {?=} isEmit 默认要发送emit，生成分组触发时不需要emit，因为生成分组方法本身会触发
     * @return {?}
     */
    function (data, type, isEmit) {
        if (isEmit === void 0) { isEmit = true; }
        var item = data.item, path = data.path, addPositionItem = data.addPositionItem, deleteItems = data.deleteItems;
        /** @type {?} */
        var target = this.queryconditionData;
        path.forEach((/**
         * @param {?} pathVal
         * @return {?}
         */
        function (pathVal) {
            //groupid = 1的时候未最外层
            if (pathVal !== 1) {
                target = target.children.find((/**
                 * @param {?} targetVal
                 * @return {?}
                 */
                function (targetVal) { return targetVal.groupid === pathVal; }));
            }
        }));
        switch (type) {
            case 'add':
                item.conditionid = this.getMaxConditionid() + 1;
                item.compareType = 0;
                if (addPositionItem) {
                    /** @type {?} */
                    var position = target.items.findIndex((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) { return val.conditionid === addPositionItem.conditionid; }));
                    position > -1 ? target.items.splice(position, 0, item) : target.items.push(item);
                }
                else {
                    target.items.push(item);
                }
                this.clearCheckedList();
                break;
            case 'delete-item':
                //删除单个条件，正常删除时使用
                if (deleteItems) {
                    deleteItems.forEach((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) {
                        /** @type {?} */
                        var deleteIndex = target.items.findIndex((/**
                         * @param {?} itemsVal
                         * @return {?}
                         */
                        function (itemsVal) { return itemsVal.conditionid === val.conditionid; }));
                        target.items.splice(deleteIndex, 1);
                    }));
                }
                this.clearCheckedList();
                //删除时优化下结构
                this.treeshake(this.queryconditionData);
                break;
            case 'delete-items':
                //删除多个条件，生产分组时使用
                if (deleteItems) {
                    deleteItems.forEach((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) {
                        /** @type {?} */
                        var deleteIndex = target.items.findIndex((/**
                         * @param {?} itemsVal
                         * @return {?}
                         */
                        function (itemsVal) { return itemsVal.conditionid === val.conditionid; }));
                        target.items.splice(deleteIndex, 1);
                    }));
                }
                this.clearCheckedList();
                break;
            case 'modify':
                /** @type {?} */
                var modifyIndex = target.items.findIndex((/**
                 * @param {?} itemsVal
                 * @return {?}
                 */
                function (itemsVal) { return itemsVal.conditionid === item.conditionid; }));
                target.items[modifyIndex] = item;
                break;
        }
        if (isEmit) {
            this.queryconditionData$.next(this.queryconditionData);
            this.updateQueryConditionListData();
        }
    };
    /**
     * 修改分组数据
     * @param data group数据
     * @param type 修改类型
     */
    /**
     * 修改分组数据
     * @param {?} data group数据
     * @param {?} type 修改类型
     * @return {?}
     */
    StateService.prototype.changeGroupData = /**
     * 修改分组数据
     * @param {?} data group数据
     * @param {?} type 修改类型
     * @return {?}
     */
    function (data, type) {
        var item = data.item, path = data.path, relation = data.relation;
        /** @type {?} */
        var target = this.queryconditionData;
        path.forEach((/**
         * @param {?} pathVal
         * @return {?}
         */
        function (pathVal) {
            //groupid = 1的时候未最外层
            if (pathVal !== 1) {
                target = target.children.find((/**
                 * @param {?} targetVal
                 * @return {?}
                 */
                function (targetVal) { return targetVal.groupid === pathVal; }));
            }
        }));
        switch (type) {
            case 'modify-relation':
                target.relation = relation;
                break;
        }
        this.queryconditionData$.next(this.queryconditionData);
        this.updateQueryConditionListData();
    };
    /**
     * 生成新的分组
     * @desc
     *
     */
    /**
     * 生成新的分组
     * @desc
     *
     * @return {?}
     */
    StateService.prototype.addGroup = /**
     * 生成新的分组
     * @desc
     *
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var groups = Object.keys(this.checkedList).filter((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return _this.checkedList[val].length; }))
        // 未选择筛选条件时候的点击提示
        ;
        // 未选择筛选条件时候的点击提示
        if (!groups.length) {
            //需要勾选
            this.notifySer.warning(this.localeService.getValue('advancedMode.info.noConditionInfo'));
        }
        else if (groups.length === 1) {
            //所有选择项归属于同一个group的items时
            /** @type {?} */
            var targetPath = groups[0].split('-').map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return Number(val); }));
            /** @type {?} */
            var target_1 = this.queryconditionData;
            targetPath.forEach((/**
             * @param {?} pathVal
             * @return {?}
             */
            function (pathVal) {
                //groupid = 1的时候未最外层
                if (pathVal !== 1) {
                    target_1 = target_1.children.find((/**
                     * @param {?} targetVal
                     * @return {?}
                     */
                    function (targetVal) { return targetVal.groupid === pathVal; }));
                }
            }));
            /** @type {?} */
            var flatItems = this.getFlatConditions(target_1);
            /** @type {?} */
            var modifyItems = flatItems.filter((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return _this.checkedList[groups[0]].includes(val.conditionid); }))
            //特别的，如果将group下的children.length为0，并且modifyItems的范围为全部的items，则提示
            ;
            //特别的，如果将group下的children.length为0，并且modifyItems的范围为全部的items，则提示
            if (!target_1.children.length && modifyItems.length === target_1.items.length) {
                //已经存在该分组了
                this.notifySer.warning(this.localeService.getValue('advancedMode.info.existGroupInfo'));
                return;
            }
            this.generateGroup(target_1, modifyItems, []);
        }
        else {
            //如果group存在多个组，首先找到涉及数据的最外层组，默认是group为1的组，即最大组
            /** @type {?} */
            var involvedGroupid_1 = 1;
            /** @type {?} */
            var involvedPath_1 = [1]
            //获取有选择数据的group，并将路径转化为Array<number>
            ;
            //获取有选择数据的group，并将路径转化为Array<number>
            /** @type {?} */
            var _groups = groups.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.split('-').map((/**
             * @param {?} val2
             * @return {?}
             */
            function (val2) { return Number(val2); })); }))
            //获取其中的最短路径
            ;
            //获取其中的最短路径
            /** @type {?} */
            var minLength = _groups.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.length; })).sort((/**
             * @param {?} a
             * @param {?} b
             * @return {?}
             */
            function (a, b) { return a - b; }))[0]
            //循环找到其中的涉及最小的 最大公共group
            ;
            var _loop_1 = function (i) {
                /** @type {?} */
                var nowGroupid = _groups[0][i];
                if (nowGroupid) {
                    //每个组的第i项都一致flag为true
                    /** @type {?} */
                    var flag = _groups.filter((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) { return val[i] === nowGroupid; })).length === _groups.length;
                    if (flag) {
                        involvedGroupid_1 = nowGroupid;
                        involvedPath_1.push(nowGroupid);
                    }
                    else {
                        return "break";
                    }
                }
                else {
                    return "break";
                }
            };
            //循环找到其中的涉及最小的 最大公共group
            for (var i = 1; i < minLength; i++) {
                var state_1 = _loop_1(i);
                if (state_1 === "break")
                    break;
            }
            //校验跨组，involvedGroupid下的items，可以不全选,不做校验
            //其他情况需要检查checklist对应数据是否已经为对应group的全部数据
            /** @type {?} */
            var flatGroupList_1 = this.getFlatChildren(this.queryconditionData)
            //检测involvedGroupid系的group的condition的全部数量是不是等于已选择的数量，如果是的话，提醒用户，所选条件已存在分组
            ;
            //检测involvedGroupid系的group的condition的全部数量是不是等于已选择的数量，如果是的话，提醒用户，所选条件已存在分组
            /** @type {?} */
            var involvedGroup = flatGroupList_1.find((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.groupid === involvedGroupid_1; }));
            /** @type {?} */
            var involvedConditionsAll = this.getFlatConditions(involvedGroup).length;
            /** @type {?} */
            var checkedAll = groups.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return _this.checkedList[val].length; })).reduce((/**
             * @param {?} a
             * @param {?} b
             * @return {?}
             */
            function (a, b) { return a + b; }));
            if (involvedConditionsAll === checkedAll) {
                //已经存在该分组了
                this.notifySer.warning(this.localeService.getValue('advancedMode.info.existGroupInfo'));
                return;
            }
            /** @type {?} */
            var validFlag = true
            // 获取所有基于相关involvedGroupid与checklist的children
            //方法：寻找最小共组在group数组的位置，如再第一位 ，则所有包含第二位的children都应该被勾选
            ;
            // 获取所有基于相关involvedGroupid与checklist的children
            //方法：寻找最小共组在group数组的位置，如再第一位 ，则所有包含第二位的children都应该被勾选
            /** @type {?} */
            var involvedChildrenGroupids_1 = [];
            _groups.forEach((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                /** @type {?} */
                var groupid = val[involvedPath_1.length];
                if (groupid && !involvedChildrenGroupids_1.includes(groupid)) {
                    involvedChildrenGroupids_1.push(groupid);
                }
            }));
            //获取上述步骤中所有group的condition数量（含子级）
            /** @type {?} */
            var involveChildrenConditionLen_1 = 0;
            involvedChildrenGroupids_1.forEach((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                /** @type {?} */
                var target = flatGroupList_1.find((/**
                 * @param {?} group
                 * @return {?}
                 */
                function (group) { return group.groupid === val; }));
                if (target) {
                    /** @type {?} */
                    var targetFlatConditionsLen = _this.getFlatConditions(target).length;
                    involveChildrenConditionLen_1 += targetFlatConditionsLen;
                }
            }));
            /** @type {?} */
            var involvedCheckedConditionLen_1 = 0;
            groups.filter((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val !== involvedPath_1.join('-'); })).forEach((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return involvedCheckedConditionLen_1 += _this.checkedList[val].length; }));
            if (involveChildrenConditionLen_1 !== involvedCheckedConditionLen_1) {
                //跨组操作需要勾选组内所有数据
                this.notifySer.error(this.localeService.getValue('advancedMode.info.checkedGroupInfo'));
                validFlag = false;
            }
            // groups.forEach(group => {
            //   if (!validFlag) {
            //     return
            //   }
            //   if (group !== involvedPath.join('-')) {
            //     let target = flatGroupList.find(val => val.path.join('-') === group)
            //     let targetFlatConditions = this.getFlatConditions(target)
            //     //当前节点下的所有items，与与该节点有关的所有items
            //     let checkedListBaseTarget = _groups.filter(val => val.includes(target.groupid)).map(val => val.join('-'))
            //     let checkedListBaseTargetLength = 0
            //     checkedListBaseTarget.forEach(val => checkedListBaseTargetLength = checkedListBaseTargetLength + this.checkedList[val].length)
            //     if (targetFlatConditions.length !== checkedListBaseTargetLength) {
            //       this.notifySer.error('跨组操作时，应勾选该组下全部数据')
            //       validFlag = false
            //     }
            //   }
            // })
            if (validFlag) {
                /** @type {?} */
                var modifyItemids_1 = this.checkedList[involvedPath_1.join('-')] || [];
                /** @type {?} */
                var target = flatGroupList_1.find((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) { return val.path.join('-') === involvedPath_1.join('-'); }));
                /** @type {?} */
                var modifyItems = target.items.filter((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) { return modifyItemids_1.includes(val.conditionid); }))
                //由于前面已经检测了包含了某child的全部condition，所以此处过滤应该包含子项。
                //方法：寻找最小共组在group数组的位置，如再第一位 ，则所有包含第二位的children都应该被勾选
                ;
                //由于前面已经检测了包含了某child的全部condition，所以此处过滤应该包含子项。
                //方法：寻找最小共组在group数组的位置，如再第一位 ，则所有包含第二位的children都应该被勾选
                /** @type {?} */
                var involvedChildrenGroup_1 = _groups.map((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) { return val[involvedPath_1.length]; })).filter((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) { return val; }));
                /** @type {?} */
                var children = target.children.filter((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) { return involvedChildrenGroup_1.includes(val.groupid); }))
                // let children = target.children.filter(val => groups.includes(val.path.join('-')))
                ;
                // let children = target.children.filter(val => groups.includes(val.path.join('-')))
                this.generateGroup(target, modifyItems, children);
            }
        }
        this.queryconditionData$.next(this.queryconditionData);
        this.updateQueryConditionListData();
        this.clearCheckedList();
    };
    /**
     *
     * @param groupid
     * @param path
     * @param isEmit 是否需要触发emit操作，对于treeshake方法，无需触发，默认为true
     * @param changeRootCompareType 属于treeshake过程中的取消分组，涉及到根节点且根节点只有该children的时候，需要修改根节点比较符，为true时修改
     */
    /**
     *
     * @param {?} groupid
     * @param {?} path
     * @param {?=} isEmit 是否需要触发emit操作，对于treeshake方法，无需触发，默认为true
     * @param {?=} changeRootCompareType 属于treeshake过程中的取消分组，涉及到根节点且根节点只有该children的时候，需要修改根节点比较符，为true时修改
     * @return {?}
     */
    StateService.prototype.deleteGroup = /**
     *
     * @param {?} groupid
     * @param {?} path
     * @param {?=} isEmit 是否需要触发emit操作，对于treeshake方法，无需触发，默认为true
     * @param {?=} changeRootCompareType 属于treeshake过程中的取消分组，涉及到根节点且根节点只有该children的时候，需要修改根节点比较符，为true时修改
     * @return {?}
     */
    function (groupid, path, isEmit, changeRootCompareType) {
        if (isEmit === void 0) { isEmit = true; }
        if (changeRootCompareType === void 0) { changeRootCompareType = false; }
        var _a, _b;
        if (groupid === 1) {
            //已经是最外层分组了
            this.notifySer.info(this.localeService.getValue('advancedMode.info.deleteGroupInfo'));
        }
        else {
            /** @type {?} */
            var target_2 = this.queryconditionData;
            /** @type {?} */
            var targetParent_1 = null;
            path.forEach((/**
             * @param {?} pathVal
             * @return {?}
             */
            function (pathVal) {
                //groupid = 1的时候未最外层
                if (pathVal !== 1) {
                    targetParent_1 = target_2;
                    target_2 = target_2.children.find((/**
                     * @param {?} targetVal
                     * @return {?}
                     */
                    function (targetVal) { return targetVal.groupid === pathVal; }));
                }
            }));
            targetParent_1.children = targetParent_1.children.filter((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.groupid !== groupid; }));
            /** @type {?} */
            var isChangeCompareType = (targetParent_1.groupid === 1) && changeRootCompareType && !targetParent_1.items.length && !targetParent_1.children.length;
            if (isChangeCompareType) {
                targetParent_1.relation = target_2.relation;
            }
            (_a = targetParent_1.children).push.apply(_a, tslib_1.__spread(target_2.children));
            (_b = targetParent_1.items).push.apply(_b, tslib_1.__spread(target_2.items));
            /** @type {?} */
            var childrens = this.getFlatChildren(targetParent_1);
            childrens.forEach((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.path = val.path.filter((/**
             * @param {?} pathItem
             * @return {?}
             */
            function (pathItem) { return pathItem !== groupid; })); }));
            if (isEmit) {
                this.queryconditionData$.next(this.queryconditionData);
                this.updateQueryConditionListData();
                this.clearCheckedList();
            }
        }
    };
    /**
     * @param {?} parentTarget
     * @param {?} items
     * @param {?} children
     * @return {?}
     */
    StateService.prototype.generateGroup = /**
     * @param {?} parentTarget
     * @param {?} items
     * @param {?} children
     * @return {?}
     */
    function (parentTarget, items, children) {
        /** @type {?} */
        var groupid = this.getMaxGroupid() + 1
        //删除最小范围的最大组 中移除掉的数据
        ;
        //删除最小范围的最大组 中移除掉的数据
        this.changeQueryconditionData({ deleteItems: items, path: parentTarget.path }, 'delete-items', false);
        //删除最小范围的最大组 中移除掉的children，注意，由于已经做过校验，children中的递归类型已经全部选择，只需将target中涉及的children移到newgroup，并将其内部的路由修改
        /** @type {?} */
        var allGroups = this.getFlatChildren(parentTarget);
        /** @type {?} */
        var parentPosition = parentTarget.path.findIndex((/**
         * @param {?} pathVal
         * @return {?}
         */
        function (pathVal) { return pathVal === parentTarget.groupid; }));
        children.forEach((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            // this.deleteGroup(val.groupid, val.path)
            parentTarget.children = parentTarget.children.filter((/**
             * @param {?} child
             * @return {?}
             */
            function (child) { return child.groupid !== val.groupid; }));
            allGroups.forEach((/**
             * @param {?} group
             * @return {?}
             */
            function (group) {
                if (group.path.includes(val.groupid)) {
                    group.path.splice(parentPosition + 1, 0, groupid);
                }
            }));
        }));
        /** @type {?} */
        var newGroup = {
            groupid: groupid,
            relation: 1,
            items: items,
            children: children,
            path: parentTarget.path.concat(groupid)
        };
        parentTarget.children.push(newGroup);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    StateService.prototype.setQueryconditionData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.queryconditionData = data;
        this.queryconditionData$.next(data);
        // 初始化可以不用更新QueryConditionListData，父组件已经传入
        // this.updateQueryConditionListData()
    };
    /**
     * @return {?}
     */
    StateService.prototype.getQueryconditionData = /**
     * @return {?}
     */
    function () {
        return this.queryconditionData;
    };
    /**
     * @param {?} config
     * @return {?}
     */
    StateService.prototype.changeFieldConfig = /**
     * @param {?} config
     * @return {?}
     */
    function (config) {
        this.fieldConfig = config;
        this.fieldConfig$.next(config);
    };
    /**
     * @return {?}
     */
    StateService.prototype.getFieldConfig = /**
     * @return {?}
     */
    function () {
        return this.fieldConfig;
    };
    /**
     * 修改已选择的筛选条件
     * @param path number[] 节点位置
     * @param item 筛选条件
     */
    /**
     * 修改已选择的筛选条件
     * @param {?} path number[] 节点位置
     * @param {?} item 筛选条件
     * @return {?}
     */
    StateService.prototype.changeCheckedList = /**
     * 修改已选择的筛选条件
     * @param {?} path number[] 节点位置
     * @param {?} item 筛选条件
     * @return {?}
     */
    function (path, item) {
        /** @type {?} */
        var _path = path.join('-');
        if (!this.checkedList[_path]) {
            this.checkedList[_path] = [item];
        }
        else {
            /** @type {?} */
            var index = this.checkedList[_path].indexOf(item);
            if (index < 0) {
                this.checkedList[_path].push(item);
            }
            else {
                this.checkedList[_path].splice(index, 1);
                if (!this.checkedList[_path].length) {
                    delete this.checkedList[_path];
                }
            }
        }
        this.checkedList$.next(this.checkedList);
    };
    /**
     * 清除已选择的筛选条件
     */
    /**
     * 清除已选择的筛选条件
     * @return {?}
     */
    StateService.prototype.clearCheckedList = /**
     * 清除已选择的筛选条件
     * @return {?}
     */
    function () {
        this.checkedList = {};
        this.checkedList$.next(this.checkedList);
    };
    /**
     *
     * @param data 需要查询的节点位置
     * @returns 该节点下所有的筛选条件信息
     */
    /**
     *
     * @param {?} data 需要查询的节点位置
     * @return {?} 该节点下所有的筛选条件信息
     */
    StateService.prototype.getFlatConditions = /**
     *
     * @param {?} data 需要查询的节点位置
     * @return {?} 该节点下所有的筛选条件信息
     */
    function (data) {
        var _this = this;
        if (data.children) {
            return [].concat.apply([], tslib_1.__spread([data.items], data.children.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return _this.getFlatConditions(val); }))));
        }
        return [].concat(data.items);
    };
    /**
     *
     * @param data 需要查询的节点
     * @returns 该节点下所有的组织信息
     */
    /**
     *
     * @param {?} data 需要查询的节点
     * @return {?} 该节点下所有的组织信息
     */
    StateService.prototype.getFlatChildren = /**
     *
     * @param {?} data 需要查询的节点
     * @return {?} 该节点下所有的组织信息
     */
    function (data) {
        var _this = this;
        if (data.children) {
            return [].concat.apply([], tslib_1.__spread([data], data.children.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return _this.getFlatChildren(val); }))));
        }
        return [].concat(data);
    };
    /**
     * @desc 获取数据中已有的最大筛选条件编号
     * @returns 当前数据中已有的最大筛选条件编号
     */
    /**
     * @desc 获取数据中已有的最大筛选条件编号
     * @return {?} 当前数据中已有的最大筛选条件编号
     */
    StateService.prototype.getMaxConditionid = /**
     * @desc 获取数据中已有的最大筛选条件编号
     * @return {?} 当前数据中已有的最大筛选条件编号
     */
    function () {
        /** @type {?} */
        var maxid = 0;
        /** @type {?} */
        var items = this.getFlatConditions(this.queryconditionData);
        /** @type {?} */
        var conditionList = items.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) { return b.conditionid - a.conditionid; }));
        if (conditionList.length) {
            maxid = conditionList[0].conditionid;
        }
        return maxid;
    };
    /**
     * @desc 获取数据中已有的最大组织编号
     * @returns 当前数据中已有的最大组织编号
     */
    /**
     * @desc 获取数据中已有的最大组织编号
     * @return {?} 当前数据中已有的最大组织编号
     */
    StateService.prototype.getMaxGroupid = /**
     * @desc 获取数据中已有的最大组织编号
     * @return {?} 当前数据中已有的最大组织编号
     */
    function () {
        /** @type {?} */
        var maxid = 0;
        /** @type {?} */
        var childrens = this.getFlatChildren(this.queryconditionData);
        /** @type {?} */
        var conditionList = childrens.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) { return b.groupid - a.groupid; }));
        if (conditionList.length) {
            maxid = conditionList[0].groupid;
        }
        return maxid;
    };
    /**
     * 将querycondition转化为Array的格式并交付后端解析
     * @param data  解析的数据
     * @param parentRelation 父节点的关联关系
     * @returns
     */
    /**
     * 将querycondition转化为Array的格式并交付后端解析
     * @param {?} data  解析的数据
     * @param {?=} parentRelation 父节点的关联关系
     * @return {?}
     */
    StateService.prototype.objToArrayData = /**
     * 将querycondition转化为Array的格式并交付后端解析
     * @param {?} data  解析的数据
     * @param {?=} parentRelation 父节点的关联关系
     * @return {?}
     */
    function (data, parentRelation) {
        var _this = this;
        /** @type {?} */
        var items = data.items;
        /** @type {?} */
        var children = data.children;
        items.forEach((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return val.relation = data.relation; }));
        if (children.length) {
            items = [].concat.apply([], tslib_1.__spread(items, children.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return _this.objToArrayData(val, data.relation); }))));
        }
        if (items.length && parentRelation) {
            items[items.length - 1].relation = parentRelation;
            items[0].Lbracket ? items[0].Lbracket += '(' : items[0].Lbracket = '(';
            items[items.length - 1].Rbracket ? items[items.length - 1].Rbracket += ')' : items[items.length - 1].Rbracket = ')';
        }
        return tslib_1.__spread(items);
    };
    /**
     * @return {?}
     */
    StateService.prototype.updateQueryConditionListData = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.objToArrayData(cloneDeep(this.queryconditionData));
        this.queryconditionListData = result;
        this.queryconditionListData$.next(this.queryconditionListData);
    };
    /**
     * 执行完增删操作后，存在部分group中无数据的情况，需要删除掉该部分无用数据
     * @param data
     */
    /**
     * 执行完增删操作后，存在部分group中无数据的情况，需要删除掉该部分无用数据
     * @param {?} data
     * @param {?=} parentData
     * @return {?}
     */
    StateService.prototype.treeshake = /**
     * 执行完增删操作后，存在部分group中无数据的情况，需要删除掉该部分无用数据
     * @param {?} data
     * @param {?=} parentData
     * @return {?}
     */
    function (data, parentData) {
        var _this = this;
        if (data.children.length) {
            data.children.forEach((/**
             * @param {?} group
             * @return {?}
             */
            function (group) { return _this.treeshake(group, data); }));
        }
        //items存在或者children的数量大于等于2为正常数据，无需处理，return仅是返回给最外层数据
        if (data.items.length || data.children.length > 1) {
        }
        else if (data.groupid === 1) {
            //groupid === 1 特殊处理，items和children可以为0，但是children长度为1且items无数据时要将children处理
            if (!data.items.length && data.children.length === 1) {
                this.deleteGroup(data.children[0].groupid, data.children[0].path, false, true);
            }
        }
        else if (!data.children.length) {
            //children数量为0 items数量也为0， 该节点无存在必要，直接删除
            parentData.children = parentData.children.filter((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.groupid !== data.groupid; }));
        }
        else if (data.children.length === 1) {
            //items不存在，只有一个children,相当于删除该层分组，将子children升级
            this.deleteGroup(data.groupid, data.path, false, true);
        }
    };
    StateService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    StateService.ctorParameters = function () { return [
        { type: NotifyService },
        { type: LocaleService }
    ]; };
    return StateService;
}());
export { StateService };
if (false) {
    /** @type {?} */
    StateService.prototype.fieldConfig;
    /** @type {?} */
    StateService.prototype.fieldConfig$;
    /** @type {?} */
    StateService.prototype.queryconditionData;
    /** @type {?} */
    StateService.prototype.queryconditionData$;
    /** @type {?} */
    StateService.prototype.queryconditionListData;
    /** @type {?} */
    StateService.prototype.queryconditionListData$;
    /** @type {?} */
    StateService.prototype.checkedList;
    /** @type {?} */
    StateService.prototype.checkedList$;
    /**
     * @type {?}
     * @private
     */
    StateService.prototype.notifySer;
    /**
     * @type {?}
     * @private
     */
    StateService.prototype.localeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uLyIsInNvdXJjZXMiOlsibGliL3F1ZXJ5Y29uZGl0aW9uLWFkdmFuY2VkL3NlcnZpY2Uvc3RhdGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDdEMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xEO0lBZ0JFLHNCQUFvQixTQUF3QixFQUFVLGFBQTRCO1FBQTlELGNBQVMsR0FBVCxTQUFTLENBQWU7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQWJsRixnQkFBVyxHQUEwQixFQUFFLENBQUE7UUFDdkMsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFBO1FBRzVCLHdCQUFtQixHQUFHLElBQUksT0FBTyxFQUFFLENBQUE7UUFJbkMsNEJBQXVCLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQTtRQUd2QyxnQkFBVyxHQUFHLEVBQUUsQ0FBQTtRQUNoQixpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUE7SUFJNUIsQ0FBQztJQUlEOztPQUVHOzs7OztJQUNILDRCQUFLOzs7O0lBQUw7UUFDRSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUE7UUFDekYsSUFBSSxDQUFDLG1C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WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFF1ZXJ5Q29uZGl0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L1F1ZXJ5Q29uZGl0aW9uJ1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFF1ZXJ5Y29uZGl0aW9uQWR2YW5jZWREYXRhIH0gZnJvbSAnLi4vdHlwZS90eXBlJ1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICdsb2Rhc2gtZXMnO1xyXG5pbXBvcnQgeyBMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2NhbGUnO1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBTdGF0ZVNlcnZpY2Uge1xyXG5cclxuICBmaWVsZENvbmZpZzogQXJyYXk8UXVlcnlDb25kaXRpb24+ID0gW11cclxuICBmaWVsZENvbmZpZyQgPSBuZXcgU3ViamVjdCgpXHJcblxyXG4gIHF1ZXJ5Y29uZGl0aW9uRGF0YTogUXVlcnljb25kaXRpb25BZHZhbmNlZERhdGFcclxuICBxdWVyeWNvbmRpdGlvbkRhdGEkID0gbmV3IFN1YmplY3QoKVxyXG5cclxuICAvL+eItue7hOS7tueahHNlbGVjdGVkRmllbGRDb25kaXRpb25z77yM5L6b5p+l6K+i5L2/55SoXHJcbiAgcXVlcnljb25kaXRpb25MaXN0RGF0YTogQXJyYXk8UXVlcnlDb25kaXRpb24+XHJcbiAgcXVlcnljb25kaXRpb25MaXN0RGF0YSQgPSBuZXcgU3ViamVjdCgpXHJcblxyXG5cclxuICBjaGVja2VkTGlzdCA9IHt9XHJcbiAgY2hlY2tlZExpc3QkID0gbmV3IFN1YmplY3QoKVxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbm90aWZ5U2VyOiBOb3RpZnlTZXJ2aWNlLCBwcml2YXRlIGxvY2FsZVNlcnZpY2U6IExvY2FsZVNlcnZpY2UpIHtcclxuXHJcblxyXG4gIH1cclxuXHJcblxyXG5cclxuICAvKipcclxuICAgKiDph43nva7nrZvpgInmnaHku7ZcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMucXVlcnljb25kaXRpb25EYXRhID0geyByZWxhdGlvbjogMSwgaXRlbXM6IFtdLCBjaGlsZHJlbjogW10sIHBhdGg6IFsxXSwgZ3JvdXBpZDogMSB9XHJcbiAgICB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSQubmV4dCh0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSlcclxuICAgIHRoaXMudXBkYXRlUXVlcnlDb25kaXRpb25MaXN0RGF0YSgpXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGRhdGEgXHJcbiAgICogQHBhcmFtIHR5cGUgXHJcbiAgICogQHBhcmFtIGlzRW1pdCDpu5jorqTopoHlj5HpgIFlbWl077yM55Sf5oiQ5YiG57uE6Kem5Y+R5pe25LiN6ZyA6KaBZW1pdO+8jOWboOS4uueUn+aIkOWIhue7hOaWueazleacrOi6q+S8muinpuWPkVxyXG4gICAqL1xyXG4gIGNoYW5nZVF1ZXJ5Y29uZGl0aW9uRGF0YShkYXRhLCB0eXBlLCBpc0VtaXQgPSB0cnVlKSB7XHJcbiAgICBjb25zdCB7IGl0ZW0sIHBhdGgsIGFkZFBvc2l0aW9uSXRlbSwgZGVsZXRlSXRlbXMgfSA9IGRhdGFcclxuICAgIGxldCB0YXJnZXQgPSB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YVxyXG4gICAgcGF0aC5mb3JFYWNoKHBhdGhWYWwgPT4ge1xyXG4gICAgICAvL2dyb3VwaWQgPSAx55qE5pe25YCZ5pyq5pyA5aSW5bGCXHJcbiAgICAgIGlmIChwYXRoVmFsICE9PSAxKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmNoaWxkcmVuLmZpbmQodGFyZ2V0VmFsID0+IHRhcmdldFZhbC5ncm91cGlkID09PSBwYXRoVmFsKVxyXG4gICAgICB9XHJcblxyXG4gICAgfSlcclxuICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICBjYXNlICdhZGQnOlxyXG4gICAgICAgIGl0ZW0uY29uZGl0aW9uaWQgPSB0aGlzLmdldE1heENvbmRpdGlvbmlkKCkgKyAxXHJcbiAgICAgICAgaXRlbS5jb21wYXJlVHlwZSA9IDBcclxuXHJcbiAgICAgICAgaWYgKGFkZFBvc2l0aW9uSXRlbSkge1xyXG4gICAgICAgICAgbGV0IHBvc2l0aW9uID0gdGFyZ2V0Lml0ZW1zLmZpbmRJbmRleCh2YWwgPT4gdmFsLmNvbmRpdGlvbmlkID09PSBhZGRQb3NpdGlvbkl0ZW0uY29uZGl0aW9uaWQpXHJcbiAgICAgICAgICBwb3NpdGlvbiA+IC0xID8gdGFyZ2V0Lml0ZW1zLnNwbGljZShwb3NpdGlvbiwgMCwgaXRlbSkgOiB0YXJnZXQuaXRlbXMucHVzaChpdGVtKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0YXJnZXQuaXRlbXMucHVzaChpdGVtKVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNsZWFyQ2hlY2tlZExpc3QoKVxyXG5cclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZGVsZXRlLWl0ZW0nOlxyXG4gICAgICAgIC8v5Yig6Zmk5Y2V5Liq5p2h5Lu277yM5q2j5bi45Yig6Zmk5pe25L2/55SoXHJcbiAgICAgICAgaWYgKGRlbGV0ZUl0ZW1zKSB7XHJcbiAgICAgICAgICBkZWxldGVJdGVtcy5mb3JFYWNoKHZhbCA9PiB7XHJcbiAgICAgICAgICAgIGxldCBkZWxldGVJbmRleCA9IHRhcmdldC5pdGVtcy5maW5kSW5kZXgoaXRlbXNWYWwgPT4gaXRlbXNWYWwuY29uZGl0aW9uaWQgPT09IHZhbC5jb25kaXRpb25pZClcclxuICAgICAgICAgICAgdGFyZ2V0Lml0ZW1zLnNwbGljZShkZWxldGVJbmRleCwgMSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2xlYXJDaGVja2VkTGlzdCgpXHJcbiAgICAgICAgLy/liKDpmaTml7bkvJjljJbkuIvnu5PmnoRcclxuICAgICAgICB0aGlzLnRyZWVzaGFrZSh0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSlcclxuXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2RlbGV0ZS1pdGVtcyc6XHJcbiAgICAgICAgLy/liKDpmaTlpJrkuKrmnaHku7bvvIznlJ/kuqfliIbnu4Tml7bkvb/nlKhcclxuICAgICAgICBpZiAoZGVsZXRlSXRlbXMpIHtcclxuICAgICAgICAgIGRlbGV0ZUl0ZW1zLmZvckVhY2godmFsID0+IHtcclxuICAgICAgICAgICAgbGV0IGRlbGV0ZUluZGV4ID0gdGFyZ2V0Lml0ZW1zLmZpbmRJbmRleChpdGVtc1ZhbCA9PiBpdGVtc1ZhbC5jb25kaXRpb25pZCA9PT0gdmFsLmNvbmRpdGlvbmlkKVxyXG4gICAgICAgICAgICB0YXJnZXQuaXRlbXMuc3BsaWNlKGRlbGV0ZUluZGV4LCAxKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jbGVhckNoZWNrZWRMaXN0KClcclxuXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ21vZGlmeSc6XHJcblxyXG4gICAgICAgIGxldCBtb2RpZnlJbmRleCA9IHRhcmdldC5pdGVtcy5maW5kSW5kZXgoaXRlbXNWYWwgPT4gaXRlbXNWYWwuY29uZGl0aW9uaWQgPT09IGl0ZW0uY29uZGl0aW9uaWQpXHJcbiAgICAgICAgdGFyZ2V0Lml0ZW1zW21vZGlmeUluZGV4XSA9IGl0ZW1cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGlzRW1pdCkge1xyXG4gICAgICB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSQubmV4dCh0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSlcclxuICAgICAgdGhpcy51cGRhdGVRdWVyeUNvbmRpdGlvbkxpc3REYXRhKClcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiDkv67mlLnliIbnu4TmlbDmja5cclxuICAgKiBAcGFyYW0gZGF0YSBncm91cOaVsOaNrlxyXG4gICAqIEBwYXJhbSB0eXBlIOS/ruaUueexu+Wei1xyXG4gICAqL1xyXG4gIGNoYW5nZUdyb3VwRGF0YShkYXRhLCB0eXBlKSB7XHJcbiAgICBjb25zdCB7IGl0ZW0sIHBhdGgsIHJlbGF0aW9uIH0gPSBkYXRhXHJcbiAgICBsZXQgdGFyZ2V0ID0gdGhpcy5xdWVyeWNvbmRpdGlvbkRhdGFcclxuICAgIHBhdGguZm9yRWFjaChwYXRoVmFsID0+IHtcclxuICAgICAgLy9ncm91cGlkID0gMeeahOaXtuWAmeacquacgOWkluWxglxyXG4gICAgICBpZiAocGF0aFZhbCAhPT0gMSkge1xyXG4gICAgICAgIHRhcmdldCA9IHRhcmdldC5jaGlsZHJlbi5maW5kKHRhcmdldFZhbCA9PiB0YXJnZXRWYWwuZ3JvdXBpZCA9PT0gcGF0aFZhbClcclxuICAgICAgfVxyXG5cclxuXHJcbiAgICB9KVxyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgIGNhc2UgJ21vZGlmeS1yZWxhdGlvbic6XHJcbiAgICAgICAgdGFyZ2V0LnJlbGF0aW9uID0gcmVsYXRpb247XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSQubmV4dCh0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSlcclxuICAgIHRoaXMudXBkYXRlUXVlcnlDb25kaXRpb25MaXN0RGF0YSgpXHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5oiQ5paw55qE5YiG57uEXHJcbiAgICogQGRlc2MgXHJcbiAgICpcclxuICAgKi9cclxuICBhZGRHcm91cCgpIHtcclxuICAgIGxldCBncm91cHMgPSBPYmplY3Qua2V5cyh0aGlzLmNoZWNrZWRMaXN0KS5maWx0ZXIodmFsID0+IHRoaXMuY2hlY2tlZExpc3RbdmFsXS5sZW5ndGgpXHJcbiAgICAvLyDmnKrpgInmi6nnrZvpgInmnaHku7bml7blgJnnmoTngrnlh7vmj5DnpLpcclxuICAgIGlmICghZ3JvdXBzLmxlbmd0aCkge1xyXG4gICAgICAvL+mcgOimgeWLvumAiVxyXG4gICAgICB0aGlzLm5vdGlmeVNlci53YXJuaW5nKHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmluZm8ubm9Db25kaXRpb25JbmZvJykpXHJcblxyXG4gICAgfSBlbHNlIGlmIChncm91cHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIC8v5omA5pyJ6YCJ5oup6aG55b2S5bGe5LqO5ZCM5LiA5LiqZ3JvdXDnmoRpdGVtc+aXtlxyXG4gICAgICBsZXQgdGFyZ2V0UGF0aDogQXJyYXk8bnVtYmVyPiA9IGdyb3Vwc1swXS5zcGxpdCgnLScpLm1hcCh2YWwgPT4gTnVtYmVyKHZhbCkpXHJcbiAgICAgIGxldCB0YXJnZXQgPSB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YVxyXG4gICAgICB0YXJnZXRQYXRoLmZvckVhY2gocGF0aFZhbCA9PiB7XHJcbiAgICAgICAgLy9ncm91cGlkID0gMeeahOaXtuWAmeacquacgOWkluWxglxyXG4gICAgICAgIGlmIChwYXRoVmFsICE9PSAxKSB7XHJcbiAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuY2hpbGRyZW4uZmluZCh0YXJnZXRWYWwgPT4gdGFyZ2V0VmFsLmdyb3VwaWQgPT09IHBhdGhWYWwpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSlcclxuICAgICAgbGV0IGZsYXRJdGVtcyA9IHRoaXMuZ2V0RmxhdENvbmRpdGlvbnModGFyZ2V0KVxyXG4gICAgICBsZXQgbW9kaWZ5SXRlbXMgPSBmbGF0SXRlbXMuZmlsdGVyKHZhbCA9PiB0aGlzLmNoZWNrZWRMaXN0W2dyb3Vwc1swXV0uaW5jbHVkZXModmFsLmNvbmRpdGlvbmlkKSlcclxuICAgICAgLy/nibnliKvnmoTvvIzlpoLmnpzlsIZncm91cOS4i+eahGNoaWxkcmVuLmxlbmd0aOS4ujDvvIzlubbkuJRtb2RpZnlJdGVtc+eahOiMg+WbtOS4uuWFqOmDqOeahGl0ZW1z77yM5YiZ5o+Q56S6XHJcbiAgICAgIGlmICghdGFyZ2V0LmNoaWxkcmVuLmxlbmd0aCAmJiBtb2RpZnlJdGVtcy5sZW5ndGggPT09IHRhcmdldC5pdGVtcy5sZW5ndGgpIHtcclxuICAgICAgICAvL+W3sue7j+WtmOWcqOivpeWIhue7hOS6hlxyXG4gICAgICAgIHRoaXMubm90aWZ5U2VyLndhcm5pbmcodGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuaW5mby5leGlzdEdyb3VwSW5mbycpKVxyXG4gICAgICAgIHJldHVyblxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZ2VuZXJhdGVHcm91cCh0YXJnZXQsIG1vZGlmeUl0ZW1zLCBbXSlcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL+WmguaenGdyb3Vw5a2Y5Zyo5aSa5Liq57uE77yM6aaW5YWI5om+5Yiw5raJ5Y+K5pWw5o2u55qE5pyA5aSW5bGC57uE77yM6buY6K6k5pivZ3JvdXDkuLox55qE57uE77yM5Y2z5pyA5aSn57uEXHJcbiAgICAgIGxldCBpbnZvbHZlZEdyb3VwaWQgPSAxXHJcbiAgICAgIGxldCBpbnZvbHZlZFBhdGggPSBbMV1cclxuICAgICAgLy/ojrflj5bmnInpgInmi6nmlbDmja7nmoRncm91cO+8jOW5tuWwhui3r+W+hOi9rOWMluS4ukFycmF5PG51bWJlcj5cclxuICAgICAgbGV0IF9ncm91cHMgPSBncm91cHMubWFwKHZhbCA9PiB2YWwuc3BsaXQoJy0nKS5tYXAodmFsMiA9PiBOdW1iZXIodmFsMikpKVxyXG4gICAgICAvL+iOt+WPluWFtuS4reeahOacgOefrei3r+W+hFxyXG4gICAgICBsZXQgbWluTGVuZ3RoID0gX2dyb3Vwcy5tYXAodmFsID0+IHZhbC5sZW5ndGgpLnNvcnQoKGEsIGIpID0+IGEgLSBiKVswXVxyXG4gICAgICAvL+W+queOr+aJvuWIsOWFtuS4reeahOa2ieWPiuacgOWwj+eahCDmnIDlpKflhazlhbFncm91cFxyXG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG1pbkxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgbGV0IG5vd0dyb3VwaWQgPSBfZ3JvdXBzWzBdW2ldXHJcbiAgICAgICAgaWYgKG5vd0dyb3VwaWQpIHtcclxuICAgICAgICAgIC8v5q+P5Liq57uE55qE56ysaemhuemDveS4gOiHtGZsYWfkuLp0cnVlXHJcbiAgICAgICAgICBsZXQgZmxhZyA9IF9ncm91cHMuZmlsdGVyKHZhbCA9PiB2YWxbaV0gPT09IG5vd0dyb3VwaWQpLmxlbmd0aCA9PT0gX2dyb3Vwcy5sZW5ndGhcclxuICAgICAgICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgICAgIGludm9sdmVkR3JvdXBpZCA9IG5vd0dyb3VwaWRcclxuICAgICAgICAgICAgaW52b2x2ZWRQYXRoLnB1c2gobm93R3JvdXBpZClcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvL+agoemqjOi3qOe7hO+8jGludm9sdmVkR3JvdXBpZOS4i+eahGl0ZW1z77yM5Y+v5Lul5LiN5YWo6YCJLOS4jeWBmuagoemqjFxyXG4gICAgICAvL+WFtuS7luaDheWGtemcgOimgeajgOafpWNoZWNrbGlzdOWvueW6lOaVsOaNruaYr+WQpuW3sue7j+S4uuWvueW6lGdyb3Vw55qE5YWo6YOo5pWw5o2uXHJcbiAgICAgIGxldCBmbGF0R3JvdXBMaXN0ID0gdGhpcy5nZXRGbGF0Q2hpbGRyZW4odGhpcy5xdWVyeWNvbmRpdGlvbkRhdGEpXHJcbiAgICAgIC8v5qOA5rWLaW52b2x2ZWRHcm91cGlk57O755qEZ3JvdXDnmoRjb25kaXRpb27nmoTlhajpg6jmlbDph4/mmK/kuI3mmK/nrYnkuo7lt7LpgInmi6nnmoTmlbDph4/vvIzlpoLmnpzmmK/nmoTor53vvIzmj5DphpLnlKjmiLfvvIzmiYDpgInmnaHku7blt7LlrZjlnKjliIbnu4RcclxuICAgICAgbGV0IGludm9sdmVkR3JvdXAgPSBmbGF0R3JvdXBMaXN0LmZpbmQodmFsID0+IHZhbC5ncm91cGlkID09PSBpbnZvbHZlZEdyb3VwaWQpXHJcbiAgICAgIGxldCBpbnZvbHZlZENvbmRpdGlvbnNBbGwgPSB0aGlzLmdldEZsYXRDb25kaXRpb25zKGludm9sdmVkR3JvdXApLmxlbmd0aFxyXG4gICAgICBsZXQgY2hlY2tlZEFsbCA9IGdyb3Vwcy5tYXAodmFsID0+IHRoaXMuY2hlY2tlZExpc3RbdmFsXS5sZW5ndGgpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpXHJcblxyXG4gICAgICBpZiAoaW52b2x2ZWRDb25kaXRpb25zQWxsID09PSBjaGVja2VkQWxsKSB7XHJcbiAgICAgICAgLy/lt7Lnu4/lrZjlnKjor6XliIbnu4TkuoZcclxuICAgICAgICB0aGlzLm5vdGlmeVNlci53YXJuaW5nKHRoaXMubG9jYWxlU2VydmljZS5nZXRWYWx1ZSgnYWR2YW5jZWRNb2RlLmluZm8uZXhpc3RHcm91cEluZm8nKSlcclxuICAgICAgICByZXR1cm5cclxuICAgICAgfVxyXG4gICAgICBsZXQgdmFsaWRGbGFnID0gdHJ1ZVxyXG4gICAgICAvLyDojrflj5bmiYDmnInln7rkuo7nm7jlhbNpbnZvbHZlZEdyb3VwaWTkuI5jaGVja2xpc3TnmoRjaGlsZHJlblxyXG4gICAgICAvL+aWueazle+8muWvu+aJvuacgOWwj+WFsee7hOWcqGdyb3Vw5pWw57uE55qE5L2N572u77yM5aaC5YaN56ys5LiA5L2NIO+8jOWImeaJgOacieWMheWQq+esrOS6jOS9jeeahGNoaWxkcmVu6YO95bqU6K+l6KKr5Yu+6YCJXHJcbiAgICAgIGxldCBpbnZvbHZlZENoaWxkcmVuR3JvdXBpZHMgPSBbXVxyXG4gICAgICBfZ3JvdXBzLmZvckVhY2godmFsID0+IHtcclxuICAgICAgICBsZXQgZ3JvdXBpZCA9IHZhbFtpbnZvbHZlZFBhdGgubGVuZ3RoXVxyXG4gICAgICAgIGlmIChncm91cGlkICYmICFpbnZvbHZlZENoaWxkcmVuR3JvdXBpZHMuaW5jbHVkZXMoZ3JvdXBpZCkpIHtcclxuICAgICAgICAgIGludm9sdmVkQ2hpbGRyZW5Hcm91cGlkcy5wdXNoKGdyb3VwaWQpXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAvL+iOt+WPluS4iui/sOatpemqpOS4reaJgOaciWdyb3Vw55qEY29uZGl0aW9u5pWw6YeP77yI5ZCr5a2Q57qn77yJXHJcbiAgICAgIGxldCBpbnZvbHZlQ2hpbGRyZW5Db25kaXRpb25MZW4gPSAwXHJcbiAgICAgIGludm9sdmVkQ2hpbGRyZW5Hcm91cGlkcy5mb3JFYWNoKHZhbCA9PiB7XHJcbiAgICAgICAgbGV0IHRhcmdldCA9IGZsYXRHcm91cExpc3QuZmluZChncm91cCA9PiBncm91cC5ncm91cGlkID09PSB2YWwpXHJcbiAgICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgICAgbGV0IHRhcmdldEZsYXRDb25kaXRpb25zTGVuID0gdGhpcy5nZXRGbGF0Q29uZGl0aW9ucyh0YXJnZXQpLmxlbmd0aFxyXG4gICAgICAgICAgaW52b2x2ZUNoaWxkcmVuQ29uZGl0aW9uTGVuICs9IHRhcmdldEZsYXRDb25kaXRpb25zTGVuXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICBsZXQgaW52b2x2ZWRDaGVja2VkQ29uZGl0aW9uTGVuID0gMFxyXG4gICAgICBncm91cHMuZmlsdGVyKHZhbCA9PiB2YWwgIT09IGludm9sdmVkUGF0aC5qb2luKCctJykpLmZvckVhY2godmFsID0+IGludm9sdmVkQ2hlY2tlZENvbmRpdGlvbkxlbiArPSB0aGlzLmNoZWNrZWRMaXN0W3ZhbF0ubGVuZ3RoKVxyXG5cclxuICAgICAgaWYgKGludm9sdmVDaGlsZHJlbkNvbmRpdGlvbkxlbiAhPT0gaW52b2x2ZWRDaGVja2VkQ29uZGl0aW9uTGVuKSB7XHJcbiAgICAgICAgLy/ot6jnu4Tmk43kvZzpnIDopoHli77pgInnu4TlhoXmiYDmnInmlbDmja5cclxuICAgICAgICB0aGlzLm5vdGlmeVNlci5lcnJvcih0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2FkdmFuY2VkTW9kZS5pbmZvLmNoZWNrZWRHcm91cEluZm8nKSlcclxuICAgICAgICB2YWxpZEZsYWcgPSBmYWxzZVxyXG4gICAgICB9XHJcbiAgICAgIC8vIGdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHtcclxuICAgICAgLy8gICBpZiAoIXZhbGlkRmxhZykge1xyXG4gICAgICAvLyAgICAgcmV0dXJuXHJcbiAgICAgIC8vICAgfVxyXG4gICAgICAvLyAgIGlmIChncm91cCAhPT0gaW52b2x2ZWRQYXRoLmpvaW4oJy0nKSkge1xyXG5cclxuICAgICAgLy8gICAgIGxldCB0YXJnZXQgPSBmbGF0R3JvdXBMaXN0LmZpbmQodmFsID0+IHZhbC5wYXRoLmpvaW4oJy0nKSA9PT0gZ3JvdXApXHJcbiAgICAgIC8vICAgICBsZXQgdGFyZ2V0RmxhdENvbmRpdGlvbnMgPSB0aGlzLmdldEZsYXRDb25kaXRpb25zKHRhcmdldClcclxuICAgICAgLy8gICAgIC8v5b2T5YmN6IqC54K55LiL55qE5omA5pyJaXRlbXPvvIzkuI7kuI7or6XoioLngrnmnInlhbPnmoTmiYDmnIlpdGVtc1xyXG4gICAgICAvLyAgICAgbGV0IGNoZWNrZWRMaXN0QmFzZVRhcmdldCA9IF9ncm91cHMuZmlsdGVyKHZhbCA9PiB2YWwuaW5jbHVkZXModGFyZ2V0Lmdyb3VwaWQpKS5tYXAodmFsID0+IHZhbC5qb2luKCctJykpXHJcbiAgICAgIC8vICAgICBsZXQgY2hlY2tlZExpc3RCYXNlVGFyZ2V0TGVuZ3RoID0gMFxyXG4gICAgICAvLyAgICAgY2hlY2tlZExpc3RCYXNlVGFyZ2V0LmZvckVhY2godmFsID0+IGNoZWNrZWRMaXN0QmFzZVRhcmdldExlbmd0aCA9IGNoZWNrZWRMaXN0QmFzZVRhcmdldExlbmd0aCArIHRoaXMuY2hlY2tlZExpc3RbdmFsXS5sZW5ndGgpXHJcbiAgICAgIC8vICAgICBpZiAodGFyZ2V0RmxhdENvbmRpdGlvbnMubGVuZ3RoICE9PSBjaGVja2VkTGlzdEJhc2VUYXJnZXRMZW5ndGgpIHtcclxuICAgICAgLy8gICAgICAgdGhpcy5ub3RpZnlTZXIuZXJyb3IoJ+i3qOe7hOaTjeS9nOaXtu+8jOW6lOWLvumAieivpee7hOS4i+WFqOmDqOaVsOaNricpXHJcbiAgICAgIC8vICAgICAgIHZhbGlkRmxhZyA9IGZhbHNlXHJcbiAgICAgIC8vICAgICB9XHJcbiAgICAgIC8vICAgfVxyXG4gICAgICAvLyB9KVxyXG4gICAgICBpZiAodmFsaWRGbGFnKSB7XHJcbiAgICAgICAgbGV0IG1vZGlmeUl0ZW1pZHMgPSB0aGlzLmNoZWNrZWRMaXN0W2ludm9sdmVkUGF0aC5qb2luKCctJyldIHx8IFtdXHJcbiAgICAgICAgbGV0IHRhcmdldCA9IGZsYXRHcm91cExpc3QuZmluZCh2YWwgPT4gdmFsLnBhdGguam9pbignLScpID09PSBpbnZvbHZlZFBhdGguam9pbignLScpKVxyXG5cclxuICAgICAgICBsZXQgbW9kaWZ5SXRlbXMgPSB0YXJnZXQuaXRlbXMuZmlsdGVyKHZhbCA9PiBtb2RpZnlJdGVtaWRzLmluY2x1ZGVzKHZhbC5jb25kaXRpb25pZCkpXHJcbiAgICAgICAgLy/nlLHkuo7liY3pnaLlt7Lnu4/mo4DmtYvkuobljIXlkKvkuobmn5BjaGlsZOeahOWFqOmDqGNvbmRpdGlvbu+8jOaJgOS7peatpOWkhOi/h+a7pOW6lOivpeWMheWQq+WtkOmhueOAglxyXG4gICAgICAgIC8v5pa55rOV77ya5a+75om+5pyA5bCP5YWx57uE5ZyoZ3JvdXDmlbDnu4TnmoTkvY3nva7vvIzlpoLlho3nrKzkuIDkvY0g77yM5YiZ5omA5pyJ5YyF5ZCr56ys5LqM5L2N55qEY2hpbGRyZW7pg73lupTor6Xooqvli77pgIlcclxuICAgICAgICBsZXQgaW52b2x2ZWRDaGlsZHJlbkdyb3VwID0gX2dyb3Vwcy5tYXAodmFsID0+IHZhbFtpbnZvbHZlZFBhdGgubGVuZ3RoXSkuZmlsdGVyKHZhbCA9PiB2YWwpXHJcbiAgICAgICAgbGV0IGNoaWxkcmVuID0gdGFyZ2V0LmNoaWxkcmVuLmZpbHRlcih2YWwgPT4gaW52b2x2ZWRDaGlsZHJlbkdyb3VwLmluY2x1ZGVzKHZhbC5ncm91cGlkKSlcclxuICAgICAgICAvLyBsZXQgY2hpbGRyZW4gPSB0YXJnZXQuY2hpbGRyZW4uZmlsdGVyKHZhbCA9PiBncm91cHMuaW5jbHVkZXModmFsLnBhdGguam9pbignLScpKSlcclxuICAgICAgICB0aGlzLmdlbmVyYXRlR3JvdXAodGFyZ2V0LCBtb2RpZnlJdGVtcywgY2hpbGRyZW4pXHJcblxyXG4gICAgICB9XHJcblxyXG5cclxuICAgIH1cclxuICAgIHRoaXMucXVlcnljb25kaXRpb25EYXRhJC5uZXh0KHRoaXMucXVlcnljb25kaXRpb25EYXRhKVxyXG4gICAgdGhpcy51cGRhdGVRdWVyeUNvbmRpdGlvbkxpc3REYXRhKClcclxuICAgIHRoaXMuY2xlYXJDaGVja2VkTGlzdCgpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBcclxuICAgKiBAcGFyYW0gZ3JvdXBpZCBcclxuICAgKiBAcGFyYW0gcGF0aCBcclxuICAgKiBAcGFyYW0gaXNFbWl0IOaYr+WQpumcgOimgeinpuWPkWVtaXTmk43kvZzvvIzlr7nkuo50cmVlc2hha2Xmlrnms5XvvIzml6DpnIDop6blj5HvvIzpu5jorqTkuLp0cnVlXHJcbiAgICogQHBhcmFtIGNoYW5nZVJvb3RDb21wYXJlVHlwZSDlsZ7kuo50cmVlc2hha2Xov4fnqIvkuK3nmoTlj5bmtojliIbnu4TvvIzmtonlj4rliLDmoLnoioLngrnkuJTmoLnoioLngrnlj6rmnInor6VjaGlsZHJlbueahOaXtuWAme+8jOmcgOimgeS/ruaUueagueiKgueCueavlOi+g+espu+8jOS4unRydWXml7bkv67mlLlcclxuICAgKi9cclxuICBkZWxldGVHcm91cChncm91cGlkLCBwYXRoLCBpc0VtaXQgPSB0cnVlLCBjaGFuZ2VSb290Q29tcGFyZVR5cGUgPSBmYWxzZSkge1xyXG5cclxuICAgIGlmIChncm91cGlkID09PSAxKSB7XHJcbiAgICAgIC8v5bey57uP5piv5pyA5aSW5bGC5YiG57uE5LqGXHJcbiAgICAgIHRoaXMubm90aWZ5U2VyLmluZm8odGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdhZHZhbmNlZE1vZGUuaW5mby5kZWxldGVHcm91cEluZm8nKSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCB0YXJnZXQgPSB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YVxyXG4gICAgICBsZXQgdGFyZ2V0UGFyZW50ID0gbnVsbFxyXG4gICAgICBwYXRoLmZvckVhY2gocGF0aFZhbCA9PiB7XHJcbiAgICAgICAgLy9ncm91cGlkID0gMeeahOaXtuWAmeacquacgOWkluWxglxyXG4gICAgICAgIGlmIChwYXRoVmFsICE9PSAxKSB7XHJcbiAgICAgICAgICB0YXJnZXRQYXJlbnQgPSB0YXJnZXRcclxuICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5jaGlsZHJlbi5maW5kKHRhcmdldFZhbCA9PiB0YXJnZXRWYWwuZ3JvdXBpZCA9PT0gcGF0aFZhbClcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIHRhcmdldFBhcmVudC5jaGlsZHJlbiA9IHRhcmdldFBhcmVudC5jaGlsZHJlbi5maWx0ZXIodmFsID0+IHZhbC5ncm91cGlkICE9PSBncm91cGlkKVxyXG4gICAgICBsZXQgaXNDaGFuZ2VDb21wYXJlVHlwZSA9ICh0YXJnZXRQYXJlbnQuZ3JvdXBpZCA9PT0gMSkgJiYgY2hhbmdlUm9vdENvbXBhcmVUeXBlICYmICF0YXJnZXRQYXJlbnQuaXRlbXMubGVuZ3RoICYmICF0YXJnZXRQYXJlbnQuY2hpbGRyZW4ubGVuZ3RoXHJcbiAgICAgIGlmKGlzQ2hhbmdlQ29tcGFyZVR5cGUpIHtcclxuICAgICAgICB0YXJnZXRQYXJlbnQucmVsYXRpb24gPSB0YXJnZXQucmVsYXRpb25cclxuICAgICAgfVxyXG4gICAgICB0YXJnZXRQYXJlbnQuY2hpbGRyZW4ucHVzaCguLi50YXJnZXQuY2hpbGRyZW4pXHJcbiAgICAgIHRhcmdldFBhcmVudC5pdGVtcy5wdXNoKC4uLnRhcmdldC5pdGVtcylcclxuICAgICAgbGV0IGNoaWxkcmVucyA9IHRoaXMuZ2V0RmxhdENoaWxkcmVuKHRhcmdldFBhcmVudClcclxuICAgICAgY2hpbGRyZW5zLmZvckVhY2godmFsID0+IHZhbC5wYXRoID0gdmFsLnBhdGguZmlsdGVyKHBhdGhJdGVtID0+IHBhdGhJdGVtICE9PSBncm91cGlkKSlcclxuICAgICAgaWYgKGlzRW1pdCkge1xyXG4gICAgICAgIHRoaXMucXVlcnljb25kaXRpb25EYXRhJC5uZXh0KHRoaXMucXVlcnljb25kaXRpb25EYXRhKVxyXG4gICAgICAgIHRoaXMudXBkYXRlUXVlcnlDb25kaXRpb25MaXN0RGF0YSgpXHJcbiAgICAgICAgdGhpcy5jbGVhckNoZWNrZWRMaXN0KClcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdlbmVyYXRlR3JvdXAocGFyZW50VGFyZ2V0LCBpdGVtcywgY2hpbGRyZW4pIHtcclxuICAgIGxldCBncm91cGlkID0gdGhpcy5nZXRNYXhHcm91cGlkKCkgKyAxXHJcblxyXG4gICAgLy/liKDpmaTmnIDlsI/ojIPlm7TnmoTmnIDlpKfnu4Qg5Lit56e76Zmk5o6J55qE5pWw5o2uXHJcbiAgICB0aGlzLmNoYW5nZVF1ZXJ5Y29uZGl0aW9uRGF0YSh7IGRlbGV0ZUl0ZW1zOiBpdGVtcywgcGF0aDogcGFyZW50VGFyZ2V0LnBhdGggfSwgJ2RlbGV0ZS1pdGVtcycsIGZhbHNlKVxyXG4gICAgLy/liKDpmaTmnIDlsI/ojIPlm7TnmoTmnIDlpKfnu4Qg5Lit56e76Zmk5o6J55qEY2hpbGRyZW7vvIzms6jmhI/vvIznlLHkuo7lt7Lnu4/lgZrov4fmoKHpqozvvIxjaGlsZHJlbuS4reeahOmAkuW9kuexu+Wei+W3sue7j+WFqOmDqOmAieaLqe+8jOWPqumcgOWwhnRhcmdldOS4rea2ieWPiueahGNoaWxkcmVu56e75YiwbmV3Z3JvdXDvvIzlubblsIblhbblhoXpg6jnmoTot6/nlLHkv67mlLlcclxuICAgIGxldCBhbGxHcm91cHMgPSB0aGlzLmdldEZsYXRDaGlsZHJlbihwYXJlbnRUYXJnZXQpXHJcblxyXG5cclxuICAgIGxldCBwYXJlbnRQb3NpdGlvbiA9IHBhcmVudFRhcmdldC5wYXRoLmZpbmRJbmRleChwYXRoVmFsID0+IHBhdGhWYWwgPT09IHBhcmVudFRhcmdldC5ncm91cGlkKVxyXG4gICAgY2hpbGRyZW4uZm9yRWFjaCh2YWwgPT4ge1xyXG5cclxuICAgICAgLy8gdGhpcy5kZWxldGVHcm91cCh2YWwuZ3JvdXBpZCwgdmFsLnBhdGgpXHJcbiAgICAgIHBhcmVudFRhcmdldC5jaGlsZHJlbiA9IHBhcmVudFRhcmdldC5jaGlsZHJlbi5maWx0ZXIoY2hpbGQgPT4gY2hpbGQuZ3JvdXBpZCAhPT0gdmFsLmdyb3VwaWQpXHJcbiAgICAgIGFsbEdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHtcclxuICAgICAgICBpZiAoZ3JvdXAucGF0aC5pbmNsdWRlcyh2YWwuZ3JvdXBpZCkpIHtcclxuICAgICAgICAgIGdyb3VwLnBhdGguc3BsaWNlKHBhcmVudFBvc2l0aW9uICsgMSwgMCwgZ3JvdXBpZClcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuXHJcbiAgICBsZXQgbmV3R3JvdXA6IFF1ZXJ5Y29uZGl0aW9uQWR2YW5jZWREYXRhID0ge1xyXG4gICAgICBncm91cGlkLFxyXG4gICAgICByZWxhdGlvbjogMSxcclxuICAgICAgaXRlbXM6IGl0ZW1zLFxyXG4gICAgICBjaGlsZHJlbjogY2hpbGRyZW4sXHJcbiAgICAgIHBhdGg6IHBhcmVudFRhcmdldC5wYXRoLmNvbmNhdChncm91cGlkKVxyXG4gICAgfVxyXG4gICAgcGFyZW50VGFyZ2V0LmNoaWxkcmVuLnB1c2gobmV3R3JvdXApXHJcblxyXG4gIH1cclxuXHJcblxyXG5cclxuICBzZXRRdWVyeWNvbmRpdGlvbkRhdGEoZGF0YSkge1xyXG4gICAgdGhpcy5xdWVyeWNvbmRpdGlvbkRhdGEgPSBkYXRhXHJcbiAgICB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSQubmV4dChkYXRhKVxyXG4gICAgLy8g5Yid5aeL5YyW5Y+v5Lul5LiN55So5pu05pawUXVlcnlDb25kaXRpb25MaXN0RGF0Ye+8jOeItue7hOS7tuW3sue7j+S8oOWFpVxyXG4gICAgLy8gdGhpcy51cGRhdGVRdWVyeUNvbmRpdGlvbkxpc3REYXRhKClcclxuICB9XHJcblxyXG4gIGdldFF1ZXJ5Y29uZGl0aW9uRGF0YSgpIHtcclxuICAgIHJldHVybiB0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YVxyXG4gIH1cclxuXHJcbiAgY2hhbmdlRmllbGRDb25maWcoY29uZmlnKSB7XHJcbiAgICB0aGlzLmZpZWxkQ29uZmlnID0gY29uZmlnXHJcbiAgICB0aGlzLmZpZWxkQ29uZmlnJC5uZXh0KGNvbmZpZylcclxuICB9XHJcbiAgZ2V0RmllbGRDb25maWcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5maWVsZENvbmZpZ1xyXG4gIH1cclxuXHJcblxyXG5cclxuICAvKipcclxuICAgKiDkv67mlLnlt7LpgInmi6nnmoTnrZvpgInmnaHku7ZcclxuICAgKiBAcGFyYW0gcGF0aCBudW1iZXJbXSDoioLngrnkvY3nva5cclxuICAgKiBAcGFyYW0gaXRlbSDnrZvpgInmnaHku7ZcclxuICAgKi9cclxuICBjaGFuZ2VDaGVja2VkTGlzdChwYXRoLCBpdGVtKSB7XHJcblxyXG4gICAgbGV0IF9wYXRoID0gcGF0aC5qb2luKCctJylcclxuICAgIGlmICghdGhpcy5jaGVja2VkTGlzdFtfcGF0aF0pIHtcclxuICAgICAgdGhpcy5jaGVja2VkTGlzdFtfcGF0aF0gPSBbaXRlbV1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBpbmRleCA9IHRoaXMuY2hlY2tlZExpc3RbX3BhdGhdLmluZGV4T2YoaXRlbSlcclxuICAgICAgaWYgKGluZGV4IDwgMCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tlZExpc3RbX3BhdGhdLnB1c2goaXRlbSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmNoZWNrZWRMaXN0W19wYXRoXS5zcGxpY2UoaW5kZXgsIDEpXHJcbiAgICAgICAgaWYgKCF0aGlzLmNoZWNrZWRMaXN0W19wYXRoXS5sZW5ndGgpIHtcclxuICAgICAgICAgIGRlbGV0ZSB0aGlzLmNoZWNrZWRMaXN0W19wYXRoXVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcbiAgICB0aGlzLmNoZWNrZWRMaXN0JC5uZXh0KHRoaXMuY2hlY2tlZExpc3QpXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmuIXpmaTlt7LpgInmi6nnmoTnrZvpgInmnaHku7ZcclxuICAgKi9cclxuICBjbGVhckNoZWNrZWRMaXN0KCkge1xyXG4gICAgdGhpcy5jaGVja2VkTGlzdCA9IHt9XHJcbiAgICB0aGlzLmNoZWNrZWRMaXN0JC5uZXh0KHRoaXMuY2hlY2tlZExpc3QpXHJcbiAgfVxyXG5cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBkYXRhIOmcgOimgeafpeivoueahOiKgueCueS9jee9rlxyXG4gICAqIEByZXR1cm5zIOivpeiKgueCueS4i+aJgOacieeahOetm+mAieadoeS7tuS/oeaBr1xyXG4gICAqL1xyXG4gIGdldEZsYXRDb25kaXRpb25zKGRhdGEpIHtcclxuICAgIGlmIChkYXRhLmNoaWxkcmVuKSB7XHJcbiAgICAgIHJldHVybiBbXS5jb25jYXQoZGF0YS5pdGVtcywgLi4uZGF0YS5jaGlsZHJlbi5tYXAodmFsID0+IHRoaXMuZ2V0RmxhdENvbmRpdGlvbnModmFsKSkpXHJcblxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtdLmNvbmNhdChkYXRhLml0ZW1zKVxyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBkYXRhIOmcgOimgeafpeivoueahOiKgueCuVxyXG4gICAqIEByZXR1cm5zIOivpeiKgueCueS4i+aJgOacieeahOe7hOe7h+S/oeaBr1xyXG4gICAqL1xyXG4gIGdldEZsYXRDaGlsZHJlbihkYXRhKSB7XHJcbiAgICBpZiAoZGF0YS5jaGlsZHJlbikge1xyXG4gICAgICByZXR1cm4gW10uY29uY2F0KGRhdGEsIC4uLmRhdGEuY2hpbGRyZW4ubWFwKHZhbCA9PiB0aGlzLmdldEZsYXRDaGlsZHJlbih2YWwpKSlcclxuICAgIH1cclxuICAgIHJldHVybiBbXS5jb25jYXQoZGF0YSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjIOiOt+WPluaVsOaNruS4reW3suacieeahOacgOWkp+etm+mAieadoeS7tue8luWPt1xyXG4gICAqIEByZXR1cm5zIOW9k+WJjeaVsOaNruS4reW3suacieeahOacgOWkp+etm+mAieadoeS7tue8luWPtyBcclxuICAgKi9cclxuICBnZXRNYXhDb25kaXRpb25pZCgpIHtcclxuXHJcbiAgICBsZXQgbWF4aWQgPSAwXHJcbiAgICBsZXQgaXRlbXMgPSB0aGlzLmdldEZsYXRDb25kaXRpb25zKHRoaXMucXVlcnljb25kaXRpb25EYXRhKVxyXG4gICAgbGV0IGNvbmRpdGlvbkxpc3QgPSBpdGVtcy5zb3J0KChhLCBiKSA9PiBiLmNvbmRpdGlvbmlkIC0gYS5jb25kaXRpb25pZClcclxuICAgIGlmIChjb25kaXRpb25MaXN0Lmxlbmd0aCkge1xyXG4gICAgICBtYXhpZCA9IGNvbmRpdGlvbkxpc3RbMF0uY29uZGl0aW9uaWRcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbWF4aWRcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjIOiOt+WPluaVsOaNruS4reW3suacieeahOacgOWkp+e7hOe7h+e8luWPt1xyXG4gICAqIEByZXR1cm5zIOW9k+WJjeaVsOaNruS4reW3suacieeahOacgOWkp+e7hOe7h+e8luWPtyBcclxuICAgKi9cclxuICBnZXRNYXhHcm91cGlkKCkge1xyXG5cclxuICAgIGxldCBtYXhpZCA9IDBcclxuICAgIGxldCBjaGlsZHJlbnMgPSB0aGlzLmdldEZsYXRDaGlsZHJlbih0aGlzLnF1ZXJ5Y29uZGl0aW9uRGF0YSlcclxuICAgIGxldCBjb25kaXRpb25MaXN0ID0gY2hpbGRyZW5zLnNvcnQoKGEsIGIpID0+IGIuZ3JvdXBpZCAtIGEuZ3JvdXBpZClcclxuICAgIGlmIChjb25kaXRpb25MaXN0Lmxlbmd0aCkge1xyXG4gICAgICBtYXhpZCA9IGNvbmRpdGlvbkxpc3RbMF0uZ3JvdXBpZFxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBtYXhpZFxyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOWwhnF1ZXJ5Y29uZGl0aW9u6L2s5YyW5Li6QXJyYXnnmoTmoLzlvI/lubbkuqTku5jlkI7nq6/op6PmnpBcclxuICAgKiBAcGFyYW0gZGF0YSAg6Kej5p6Q55qE5pWw5o2uXHJcbiAgICogQHBhcmFtIHBhcmVudFJlbGF0aW9uIOeItuiKgueCueeahOWFs+iBlOWFs+ezu1xyXG4gICAqIEByZXR1cm5zIFxyXG4gICAqL1xyXG4gIG9ialRvQXJyYXlEYXRhKGRhdGEsIHBhcmVudFJlbGF0aW9uPykge1xyXG5cclxuICAgIGxldCBpdGVtcyA9IGRhdGEuaXRlbXNcclxuICAgIGxldCBjaGlsZHJlbiA9IGRhdGEuY2hpbGRyZW5cclxuICAgIGl0ZW1zLmZvckVhY2godmFsID0+IHZhbC5yZWxhdGlvbiA9IGRhdGEucmVsYXRpb24pXHJcblxyXG4gICAgaWYgKGNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICBpdGVtcyA9IFtdLmNvbmNhdCguLi5pdGVtcywgLi4uY2hpbGRyZW4ubWFwKHZhbCA9PiB0aGlzLm9ialRvQXJyYXlEYXRhKHZhbCwgZGF0YS5yZWxhdGlvbikpKVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChpdGVtcy5sZW5ndGggJiYgcGFyZW50UmVsYXRpb24pIHtcclxuXHJcbiAgICAgIGl0ZW1zW2l0ZW1zLmxlbmd0aCAtIDFdLnJlbGF0aW9uID0gcGFyZW50UmVsYXRpb25cclxuICAgICAgaXRlbXNbMF0uTGJyYWNrZXQgPyBpdGVtc1swXS5MYnJhY2tldCArPSAnKCcgOiBpdGVtc1swXS5MYnJhY2tldCA9ICcoJ1xyXG4gICAgICBpdGVtc1tpdGVtcy5sZW5ndGggLSAxXS5SYnJhY2tldCA/IGl0ZW1zW2l0ZW1zLmxlbmd0aCAtIDFdLlJicmFja2V0ICs9ICcpJyA6IGl0ZW1zW2l0ZW1zLmxlbmd0aCAtIDFdLlJicmFja2V0ID0gJyknXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFsuLi5pdGVtc11cclxuXHJcbiAgfVxyXG4gIHVwZGF0ZVF1ZXJ5Q29uZGl0aW9uTGlzdERhdGEoKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gdGhpcy5vYmpUb0FycmF5RGF0YShjbG9uZURlZXAodGhpcy5xdWVyeWNvbmRpdGlvbkRhdGEpKVxyXG4gICAgdGhpcy5xdWVyeWNvbmRpdGlvbkxpc3REYXRhID0gcmVzdWx0XHJcbiAgICB0aGlzLnF1ZXJ5Y29uZGl0aW9uTGlzdERhdGEkLm5leHQodGhpcy5xdWVyeWNvbmRpdGlvbkxpc3REYXRhKVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omn6KGM5a6M5aKe5Yig5pON5L2c5ZCO77yM5a2Y5Zyo6YOo5YiGZ3JvdXDkuK3ml6DmlbDmja7nmoTmg4XlhrXvvIzpnIDopoHliKDpmaTmjonor6Xpg6jliIbml6DnlKjmlbDmja5cclxuICAgKiBAcGFyYW0gZGF0YSBcclxuICAgKi9cclxuICB0cmVlc2hha2UoZGF0YSwgcGFyZW50RGF0YT8pIHtcclxuICAgIGlmIChkYXRhLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICBkYXRhLmNoaWxkcmVuLmZvckVhY2goZ3JvdXAgPT4gdGhpcy50cmVlc2hha2UoZ3JvdXAsIGRhdGEpKVxyXG4gICAgfVxyXG4gICAgLy9pdGVtc+WtmOWcqOaIluiAhWNoaWxkcmVu55qE5pWw6YeP5aSn5LqO562J5LqOMuS4uuato+W4uOaVsOaNru+8jOaXoOmcgOWkhOeQhu+8jHJldHVybuS7heaYr+i/lOWbnue7meacgOWkluWxguaVsOaNrlxyXG4gICAgaWYgKGRhdGEuaXRlbXMubGVuZ3RoIHx8IGRhdGEuY2hpbGRyZW4ubGVuZ3RoID4gMSkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoZGF0YS5ncm91cGlkID09PSAxKSB7XHJcbiAgICAgIC8vZ3JvdXBpZCA9PT0gMSDnibnmrorlpITnkIbvvIxpdGVtc+WSjGNoaWxkcmVu5Y+v5Lul5Li6MO+8jOS9huaYr2NoaWxkcmVu6ZW/5bqm5Li6MeS4lGl0ZW1z5peg5pWw5o2u5pe26KaB5bCGY2hpbGRyZW7lpITnkIZcclxuICAgICAgaWYgKCFkYXRhLml0ZW1zLmxlbmd0aCAmJiBkYXRhLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgIHRoaXMuZGVsZXRlR3JvdXAoZGF0YS5jaGlsZHJlblswXS5ncm91cGlkLCBkYXRhLmNoaWxkcmVuWzBdLnBhdGgsIGZhbHNlLCB0cnVlKVxyXG4gICAgICB9XHJcblxyXG4gICAgfSBlbHNlIGlmICghZGF0YS5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgLy9jaGlsZHJlbuaVsOmHj+S4ujAgaXRlbXPmlbDph4/kuZ/kuLow77yMIOivpeiKgueCueaXoOWtmOWcqOW/heimge+8jOebtOaOpeWIoOmZpFxyXG4gICAgICBwYXJlbnREYXRhLmNoaWxkcmVuID0gcGFyZW50RGF0YS5jaGlsZHJlbi5maWx0ZXIodmFsID0+IHZhbC5ncm91cGlkICE9PSBkYXRhLmdyb3VwaWQpXHJcbiAgICB9IGVsc2UgaWYgKGRhdGEuY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIC8vaXRlbXPkuI3lrZjlnKjvvIzlj6rmnInkuIDkuKpjaGlsZHJlbiznm7jlvZPkuo7liKDpmaTor6XlsYLliIbnu4TvvIzlsIblrZBjaGlsZHJlbuWNh+e6p1xyXG4gICAgICB0aGlzLmRlbGV0ZUdyb3VwKGRhdGEuZ3JvdXBpZCwgZGF0YS5wYXRoLCBmYWxzZSwgdHJ1ZSlcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuXHJcblxyXG59XHJcbiJdfQ==
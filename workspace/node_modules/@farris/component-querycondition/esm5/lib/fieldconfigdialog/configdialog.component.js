/**
 * @fileoverview added by tsickle
 * Generated from: lib/fieldconfigdialog/configdialog.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, ViewEncapsulation, Input } from '@angular/core';
import { SolutionService } from '../service/solution.service';
import { LocaleService } from '@farris/ui-locale';
import { DialogComponent } from '@farris/ui-dialog';
import { MultiSelectComponent } from '@farris/ui-multi-select';
import { NotifyService } from '@farris/ui-notify';
var ConfigDialogComponent = /** @class */ (function () {
    function ConfigDialogComponent(solutionService, localeService, notify) {
        this.solutionService = solutionService;
        this.localeService = localeService;
        this.notify = notify;
        this.inputSelectedFileds = [];
        this.cancelEmitter = new EventEmitter();
        this.confirmEmitter = new EventEmitter();
        this.selectedIds = [];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ConfigDialogComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.filedsDataSource && changes.filedsDataSource.currentValue) {
            this.visibleFields = this.filedsDataSource.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return !!item.visible; }));
        }
        if (changes.inputSelectedFileds && changes.inputSelectedFileds.currentValue) {
            this.visibleSelectedFields = this.inputSelectedFileds.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return !!item.visible; }));
            if (this.visibleSelectedFields.length) {
                this.selectedIds = this.visibleSelectedFields.map((/**
                 * @param {?} qc
                 * @return {?}
                 */
                function (qc) { return qc.id; }));
            }
        }
    };
    /**
     * @return {?}
     */
    ConfigDialogComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.title = this.localeService.getValue('queryCondition.container.config');
        if (this.filedsDataSource) {
            this.visibleFields = this.filedsDataSource.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return !!item.visible; }));
        }
    };
    /**
     * @return {?}
     */
    ConfigDialogComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (this.multiSelectCmp.enableMoveMore !== undefined) {
            this.multiSelectCmp.enableMoveMore = true;
        }
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @return {?}
     */
    ConfigDialogComponent.prototype.cancel = /**
     * 取消
     * @return {?}
     */
    function () {
        this.selectedIds = this.visibleSelectedFields.map((/**
         * @param {?} qc
         * @return {?}
         */
        function (qc) { return qc.id; }));
        //undo: 穿梭框组件的selectedId值为空数组时存在问题，通过组建的moveAllToLeft保证该功能
        if (!this.selectedIds.length) {
            this.multiSelectCmp.moveAllToLeft();
        }
        this.cancelEmitter.emit(true);
        this.multiSelectCmp.searchValue = '';
        this.dialog.close();
    };
    /**
     * 确认
     */
    /**
     * 确认
     * @return {?}
     */
    ConfigDialogComponent.prototype.confirm = /**
     * 确认
     * @return {?}
     */
    function () {
        var _this = this;
        //必填字段必选选择，否则给与提示
        /** @type {?} */
        var requiredAndUncheck = this.visibleFields.filter((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return val.control && val.control.isRequired(); })).filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return !_this.selectedIds.includes(item.id); }));
        if (requiredAndUncheck && requiredAndUncheck.length) {
            /** @type {?} */
            var msg = requiredAndUncheck.map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) { return val.fieldName; })).join('、') + '为必选字段，请勾选后再进行保存操作。';
            this.notify.error(msg);
            return;
        }
        /** @type {?} */
        var selectedFields = [];
        /** @type {?} */
        var _fieldData;
        this.selectedIds.forEach((/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            /** @type {?} */
            var index = _this.visibleSelectedFields.findIndex((/**
             * @param {?} field
             * @return {?}
             */
            function (field) { return field.id == id; }));
            if (index > -1) {
                selectedFields.push(_this.visibleSelectedFields[index].fieldCode);
            }
            else {
                _fieldData = _this.visibleFields.find((/**
                 * @param {?} field
                 * @return {?}
                 */
                function (field) { return field.id == id; }));
                _fieldData.value.clearValue();
                selectedFields.push(_fieldData.fieldCode);
            }
        }));
        this.confirmEmitter.emit(selectedFields);
        this.multiSelectCmp.searchValue = '';
        this.dialog.close();
    };
    /**
     * 重置
     */
    /**
     * 重置
     * @return {?}
     */
    ConfigDialogComponent.prototype.reset = /**
     * 重置
     * @return {?}
     */
    function () {
    };
    ConfigDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-queryconfigdialog',
                    template: "<farris-dialog #dialog [buttons]=\"configDialogButtonRef\" [width]=\"699\" [height]=\"544\" [title]=\"title\">\r\n    <multi-select #searchMulti \r\n    [dataSource]=\"visibleFields\"\r\n     [idField]=\"'id'\" \r\n     [textField]=\"'fieldName'\" \r\n     [displayType]=\"'List'\" \r\n     [(selectedId)]=\"selectedIds\" \r\n     [showCheckbox]=\"true\">\r\n        <ng-template farrisTemplate=\"text\" let-data>\r\n            {{ data['fieldName'] }}\r\n        </ng-template>\r\n    </multi-select>\r\n</farris-dialog>\r\n<ng-template #configDialogButtonRef>\r\n    <button class=\"btn btn-primary\" (click)=\"confirm()\">{{'queryCondition.configDialog.confirm' | locale}}</button>\r\n    <button class=\"btn btn-secondary\" (click)=\"cancel()\">{{'queryCondition.configDialog.cancel' | locale}}</button>\r\n</ng-template>",
                    encapsulation: ViewEncapsulation.None,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ConfigDialogComponent.ctorParameters = function () { return [
        { type: SolutionService },
        { type: LocaleService },
        { type: NotifyService }
    ]; };
    ConfigDialogComponent.propDecorators = {
        inputSelectedFileds: [{ type: Input }],
        filedsDataSource: [{ type: Input }],
        cancelEmitter: [{ type: Output }],
        confirmEmitter: [{ type: Output }],
        dialog: [{ type: ViewChild, args: ['dialog',] }],
        multiSelectCmp: [{ type: ViewChild, args: ['searchMulti',] }]
    };
    return ConfigDialogComponent;
}());
export { ConfigDialogComponent };
if (false) {
    /** @type {?} */
    ConfigDialogComponent.prototype.inputSelectedFileds;
    /** @type {?} */
    ConfigDialogComponent.prototype.filedsDataSource;
    /** @type {?} */
    ConfigDialogComponent.prototype.cancelEmitter;
    /** @type {?} */
    ConfigDialogComponent.prototype.confirmEmitter;
    /** @type {?} */
    ConfigDialogComponent.prototype.dialog;
    /** @type {?} */
    ConfigDialogComponent.prototype.multiSelectCmp;
    /** @type {?} */
    ConfigDialogComponent.prototype.selectedIds;
    /** @type {?} */
    ConfigDialogComponent.prototype.title;
    /** @type {?} */
    ConfigDialogComponent.prototype.visibleFields;
    /** @type {?} */
    ConfigDialogComponent.prototype.visibleSelectedFields;
    /**
     * @type {?}
     * @private
     */
    ConfigDialogComponent.prototype.solutionService;
    /**
     * @type {?}
     * @private
     */
    ConfigDialogComponent.prototype.localeService;
    /**
     * @type {?}
     * @private
     */
    ConfigDialogComponent.prototype.notify;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uLyIsInNvdXJjZXMiOlsibGliL2ZpZWxkY29uZmlnZGlhbG9nL2NvbmZpZ2RpYWxvZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUE0QixpQkFBaUIsRUFBYyxLQUFLLEVBQXFGLE1BQU0sZUFBZSxDQUFDO0FBQ3RPLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRDtJQWtCSSwrQkFBb0IsZUFBZ0MsRUFBVSxhQUE0QixFQUFVLE1BQXFCO1FBQXJHLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQVhoSCx3QkFBbUIsR0FBMEIsRUFBRSxDQUFDO1FBRS9DLGtCQUFhLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDM0QsbUJBQWMsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUl0RSxnQkFBVyxHQUFrQixFQUFFLENBQUM7SUFJNkYsQ0FBQzs7Ozs7SUFFOUgsMkNBQVc7Ozs7SUFBWCxVQUFZLE9BQXNCO1FBQzlCLElBQUcsT0FBTyxDQUFDLGdCQUFnQixJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUU7WUFDbEUsSUFBSSxDQUFDLGFBQWEsR0FBRyxJ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Q2YsYUFBYTtnQkFJYixhQUFhOzs7c0NBUWpCLEtBQUs7bUNBQ0wsS0FBSztnQ0FDTCxNQUFNO2lDQUNOLE1BQU07eUJBQ04sU0FBUyxTQUFDLFFBQVE7aUNBQ2xCLFNBQVMsU0FBQyxhQUFhOztJQW1GNUIsNEJBQUM7Q0FBQSxBQS9GRCxJQStGQztTQXpGWSxxQkFBcUI7OztJQUM5QixvREFBeUQ7O0lBQ3pELGlEQUFpRDs7SUFDakQsOENBQXFFOztJQUNyRSwrQ0FBc0U7O0lBQ3RFLHVDQUE2Qzs7SUFDN0MsK0NBQStEOztJQUUvRCw0Q0FBZ0M7O0lBQ2hDLHNDQUFjOztJQUNkLDhDQUFxQzs7SUFDckMsc0RBQTZDOzs7OztJQUNqQyxnREFBd0M7Ozs7O0lBQUUsOENBQW9DOzs7OztJQUFFLHVDQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgSG9zdEJpbmRpbmcsIFZpZXdFbmNhcHN1bGF0aW9uLCBFbGVtZW50UmVmLCBJbnB1dCwgU2tpcFNlbGYsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgQ29udGVudENoaWxkLCBBZnRlckNvbnRlbnRJbml0LCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFNvbHV0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2Uvc29sdXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbmltcG9ydCB7IERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgUXVlcnlDb25kaXRpb24gfSBmcm9tICcuLi9lbnRpdHkvcXVlcnljb25kaXRpb24nO1xyXG5pbXBvcnQgeyBNdWx0aVNlbGVjdENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktbXVsdGktc2VsZWN0JztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1xdWVyeWNvbmZpZ2RpYWxvZycsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29uZmlnZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL2NvbmZpZ2RpYWxvZy5jb21wb25lbnQuY3NzJ10sXHJcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb25maWdEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBASW5wdXQoKSBpbnB1dFNlbGVjdGVkRmlsZWRzOiBBcnJheTxRdWVyeUNvbmRpdGlvbj4gPSBbXTtcclxuICAgIEBJbnB1dCgpIGZpbGVkc0RhdGFTb3VyY2U6IEFycmF5PFF1ZXJ5Q29uZGl0aW9uPjtcclxuICAgIEBPdXRwdXQoKSBjYW5jZWxFbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQE91dHB1dCgpIGNvbmZpcm1FbWl0dGVyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQFZpZXdDaGlsZCgnZGlhbG9nJykgZGlhbG9nOiBEaWFsb2dDb21wb25lbnQ7XHJcbiAgICBAVmlld0NoaWxkKCdzZWFyY2hNdWx0aScpIG11bHRpU2VsZWN0Q21wOiBNdWx0aVNlbGVjdENvbXBvbmVudDtcclxuXHJcbiAgICBzZWxlY3RlZElkczogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gICAgdGl0bGU6IHN0cmluZztcclxuICAgIHZpc2libGVGaWVsZHM6IEFycmF5PFF1ZXJ5Q29uZGl0aW9uPjtcclxuICAgIHZpc2libGVTZWxlY3RlZEZpZWxkczogQXJyYXk8UXVlcnlDb25kaXRpb24+O1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2x1dGlvblNlcnZpY2U6IFNvbHV0aW9uU2VydmljZSwgcHJpdmF0ZSBsb2NhbGVTZXJ2aWNlOiBMb2NhbGVTZXJ2aWNlLCBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSkgeyB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmKGNoYW5nZXMuZmlsZWRzRGF0YVNvdXJjZSAmJiBjaGFuZ2VzLmZpbGVkc0RhdGFTb3VyY2UuY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlzaWJsZUZpZWxkcyA9IHRoaXMuZmlsZWRzRGF0YVNvdXJjZS5maWx0ZXIoaXRlbSA9PiB7cmV0dXJuICEhaXRlbS52aXNpYmxlfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY2hhbmdlcy5pbnB1dFNlbGVjdGVkRmlsZWRzICYmIGNoYW5nZXMuaW5wdXRTZWxlY3RlZEZpbGVkcy5jdXJyZW50VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy52aXNpYmxlU2VsZWN0ZWRGaWVsZHMgPSB0aGlzLmlucHV0U2VsZWN0ZWRGaWxlZHMuZmlsdGVyKGl0ZW0gPT4ge3JldHVybiAhIWl0ZW0udmlzaWJsZX0pO1xyXG4gICAgICAgICAgICBpZih0aGlzLnZpc2libGVTZWxlY3RlZEZpZWxkcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJZHMgPSB0aGlzLnZpc2libGVTZWxlY3RlZEZpZWxkcy5tYXAocWMgPT4gcWMuaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5Q29uZGl0aW9uLmNvbnRhaW5lci5jb25maWcnKTtcclxuICAgICAgICBpZih0aGlzLmZpbGVkc0RhdGFTb3VyY2UpIHtcclxuICAgICAgICAgICAgdGhpcy52aXNpYmxlRmllbGRzID0gdGhpcy5maWxlZHNEYXRhU291cmNlLmZpbHRlcihpdGVtID0+IHtyZXR1cm4gISFpdGVtLnZpc2libGV9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmKHRoaXMubXVsdGlTZWxlY3RDbXAuZW5hYmxlTW92ZU1vcmUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLm11bHRpU2VsZWN0Q21wLmVuYWJsZU1vdmVNb3JlID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Y+W5raIXHJcbiAgICAgKi9cclxuICAgIGNhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkSWRzID0gdGhpcy52aXNpYmxlU2VsZWN0ZWRGaWVsZHMubWFwKHFjID0+IHFjLmlkKTtcclxuICAgICAgICAvL3VuZG86IOepv+aireahhue7hOS7tueahHNlbGVjdGVkSWTlgLzkuLrnqbrmlbDnu4Tml7blrZjlnKjpl67popjvvIzpgJrov4fnu4Tlu7rnmoRtb3ZlQWxsVG9MZWZ05L+d6K+B6K+l5Yqf6IO9XHJcbiAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWRJZHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubXVsdGlTZWxlY3RDbXAubW92ZUFsbFRvTGVmdCgpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2FuY2VsRW1pdHRlci5lbWl0KHRydWUpOyAgICAgICAgXHJcbiAgICAgICAgdGhpcy5tdWx0aVNlbGVjdENtcC5zZWFyY2hWYWx1ZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnoa7orqRcclxuICAgICAqL1xyXG4gICAgY29uZmlybSgpIHtcclxuXHJcbiAgICAgICAgLy/lv4XloavlrZfmrrXlv4XpgInpgInmi6nvvIzlkKbliJnnu5nkuI7mj5DnpLpcclxuICAgICAgICBsZXQgcmVxdWlyZWRBbmRVbmNoZWNrICA9IHRoaXMudmlzaWJsZUZpZWxkcy5maWx0ZXIodmFsID0+IHZhbC5jb250cm9sICYmIHZhbC5jb250cm9sLmlzUmVxdWlyZWQoKSkuZmlsdGVyKGl0ZW0gPT4gIXRoaXMuc2VsZWN0ZWRJZHMuaW5jbHVkZXMoaXRlbS5pZCkpXHJcbiAgICAgICAgaWYocmVxdWlyZWRBbmRVbmNoZWNrICYmIHJlcXVpcmVkQW5kVW5jaGVjay5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IG1zZyA9IHJlcXVpcmVkQW5kVW5jaGVjay5tYXAodmFsID0+IHZhbC5maWVsZE5hbWUpLmpvaW4oJ+OAgScpICsgJ+S4uuW/hemAieWtl+aute+8jOivt+WLvumAieWQjuWGjei/m+ihjOS/neWtmOaTjeS9nOOAgidcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnkuZXJyb3IobXNnKVxyXG4gICAgICAgICAgICByZXR1cm4gXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRmllbGRzID0gW107XHJcbiAgICAgICAgbGV0IF9maWVsZERhdGE6IFF1ZXJ5Q29uZGl0aW9uO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy52aXNpYmxlU2VsZWN0ZWRGaWVsZHMuZmluZEluZGV4KGZpZWxkID0+IGZpZWxkLmlkID09IGlkKTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzLnB1c2godGhpcy52aXNpYmxlU2VsZWN0ZWRGaWVsZHNbaW5kZXhdLmZpZWxkQ29kZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfZmllbGREYXRhID0gdGhpcy52aXNpYmxlRmllbGRzLmZpbmQoZmllbGQgPT4gZmllbGQuaWQgPT0gaWQpO1xyXG4gICAgICAgICAgICAgICAgX2ZpZWxkRGF0YS52YWx1ZS5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkcy5wdXNoKF9maWVsZERhdGEuZmllbGRDb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuY29uZmlybUVtaXR0ZXIuZW1pdChzZWxlY3RlZEZpZWxkcyk7XHJcbiAgICAgICAgdGhpcy5tdWx0aVNlbGVjdENtcC5zZWFyY2hWYWx1ZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDph43nva5cclxuICAgICAqL1xyXG4gICAgcmVzZXQoKSB7XHJcblxyXG4gICAgfVxyXG59XHJcbiJdfQ==
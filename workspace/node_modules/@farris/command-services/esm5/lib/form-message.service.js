import { Inject, Injectable, LOCALE_ID, Optional } from '@angular/core';
import { from } from 'rxjs';
import { MessagerService } from '@farris/ui-messager';
import { LanguageService } from './languag.service';
import { ExceptionFactory } from './error/index';
/**
 * 表单消息服务
 * @scope FormModule
 * @summary
 * 1、包装@farris/ui的消息服务；
 * 2、提供针对表单的快捷方法；
 */
var FormMessageService = /** @class */ (function () {
    /**
     * 构造函数
     * 注入@farris/ui的LoadingService
     */
    function FormMessageService(messagerService, languageService, curLanguage) {
        this.messagerService = messagerService;
        this.languageService = languageService;
        this.curLanguage = curLanguage;
        this.languageService = this.languageService || LanguageService.getInstance();
    }
    /**
     * question弹窗
     */
    FormMessageService.prototype.question = function (content) {
        var confirmResult$ = this.confirmPromise(content);
        return from(confirmResult$);
    };
    /**
     * 带默认焦点的弹出提示
     * @param content 内容
     */
    FormMessageService.prototype.question2 = function (content) {
        var _this = this;
        var promise$ = new Promise(function (resolve, reject) {
            var dialogRef = _this.messagerService.question2(content, [
                {
                    text: _this.languageService.no,
                    cls: 'btn btn-secondary',
                    handle: function () {
                        resolve(false);
                        dialogRef.close();
                    }
                },
                {
                    text: _this.languageService.yes,
                    cls: 'btn btn-primary',
                    defaultFocus: true,
                    handle: function () {
                        resolve(true);
                        dialogRef.close();
                    }
                }
            ]);
        });
        return from(promise$);
    };
    /**
     * 弹出输入对话框
     * @param title 标题
     */
    FormMessageService.prototype.prompt = function (title) {
        return this.messagerService.prompt(title);
    };
    /**
     * 使用Promise实例包装回调方法，以同步回调方法执行后结果
     * @param content
     */
    FormMessageService.prototype.confirmPromise = function (content) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.messagerService.question(content, function () { resolve(true); }, function () { resolve(false); });
        });
    };
    /**
     * 确认弹框
     * @param content 弹出内容提示
     */
    FormMessageService.prototype.confirm = function (content) {
        return this.messagerService.confirm(content);
    };
    /**
     * 消息弹框
     */
    FormMessageService.prototype.info = function (content) {
        this.messagerService.info(content);
    };
    /**
     * 错误弹框
     */
    FormMessageService.prototype.error = function (content) {
        this.messagerService.error(content);
    };
    /**
     * 警告弹框
     */
    FormMessageService.prototype.warning = function (content) {
        this.messagerService.warning(content);
    };
    /**
     * 服务器端异常提示弹框
     */
    FormMessageService.prototype.httpErrorInServer = function (httpError) {
        var error = httpError.error;
        if (typeof (error) === 'string') {
            try {
                error = JSON.parse(error);
            }
            catch (e) { }
        }
        if (!error || error.Level == null || error.Level == undefined) { // 未封装error或未设置异常等级
            this.messagerService.error(httpError.message);
            return;
        }
        var exceptionStrategy = ExceptionFactory.getInstance(this.messagerService, this.languageService).getExceptionHandleStrategy(error.Level);
        exceptionStrategy.handleException(error);
    };
    /**
     * 客户端异常提示弹框
     */
    FormMessageService.prototype.httpErrorInClient = function (httpError) {
        if (!httpError) {
            return;
        }
        var message = httpError.error && httpError.error.error && httpError.error.error.message;
        var exceptionMsg = message || httpError.message && httpError.message.replace(/http:\/\/[a-zA-Z0-9.:]{1,}/, '');
        var options = {
            // title: this.languageService.clientNotifyTitle,
            // showMaxButton: true,
            showHeader: false,
            width: 400,
            height: 200,
            safeHtml: false
        };
        this.messagerService.show('error', exceptionMsg, options);
    };
    /**
     * 401异常处理
     * 为了独立弹出重新登录提示框，切换到运行框架http服务后可以删除
     * @param httpError 异常
     */
    FormMessageService.prototype.http401Error = function (httpError) {
        var dialogShownKey = '401ErrorShownFlag';
        if (!httpError || window[dialogShownKey]) {
            return;
        }
        var i18n = {
            en: {
                title: 'Warning',
                sessionInvalid: 'Your login has expired, please login again.',
                ok: 'ok',
                cancel: 'cancel'
            },
            'zh-CHS': {
                title: '提示',
                sessionInvalid: '用户登录信息已失效，是否重新登录?',
                ok: '确认',
                cancel: '取消'
            }
        };
        this.curLanguage = this.curLanguage || 'zh-CHS';
        var messageOptions = {
            title: i18n[this.curLanguage].title,
            initialState: {
                okText: i18n[this.curLanguage].ok,
                okHandle: function () {
                    modalRef.close();
                    window[dialogShownKey] = false;
                    var eventResult = httpError && httpError.error || {};
                    var redirectUri = eventResult.redirect_uri || '/login.html';
                    window.location.href = "/logout.html#?logout-before-redirect=true&loginUri=" + redirectUri;
                },
                cancelText: i18n[this.curLanguage].cancel,
                cancelHandle: function () {
                    modalRef.close();
                    window[dialogShownKey] = false;
                }
            },
            showHeader: true,
            width: 420,
            height: 180,
            fitContent: false
        };
        var modalRef = this.messagerService.show('question', i18n[this.curLanguage].sessionInvalid, messageOptions);
        window[dialogShownKey] = true;
        if (modalRef && modalRef.dialog && modalRef.dialog.instance.closed) {
            modalRef.dialog.instance.closed.subscribe(function () {
                window[dialogShownKey] = false;
            });
        }
    };
    FormMessageService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FormMessageService.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
    ]; };
    return FormMessageService;
}());
export { FormMessageService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1tZXNzYWdlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZm9ybS1tZXNzYWdlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4RSxPQUFPLEVBQTJCLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBeUIsZ0JBQWdCLEVBQXNCLE1BQU0sZUFBZSxDQUFDO0FBRzVGOzs7Ozs7R0FNRztBQUNIO0lBR0U7OztPQUdHO0lBQ0gsNEJBQ1UsZUFBZ0MsRUFDcEIsZUFBZ0MsRUFDekIsV0FBbUI7UUFGdEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ3BCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUN6QixnQkFBVyxHQUFYLFdBQVcsQ0FBUTtRQUU5QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLElBQUksZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQy9FLENBQUM7SUFDRDs7T0FFRztJQUNJLHFDQUFRLEdBQWYsVUFBZ0IsT0FBZTtRQUM3QixJQUFNLGNBQWMsR0FBcUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN0RSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksc0NBQVMsR0FBaEIsVUFBaUIsT0FBZTtRQUFoQyxpQkF5QkM7UUF4QkMsSUFBTSxRQUFRLEdBQXFCLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDN0QsSUFB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Q0FBQyxDQUFDO1FBQzlHLE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDOUIsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUU7WUFDbEUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUNqQyxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7Z0JBeE1GLFVBQVU7Ozs7Z0JBYkYsZUFBZTtnQkFFZixlQUFlLHVCQW9CbkIsUUFBUTs2Q0FDUixNQUFNLFNBQUMsU0FBUzs7SUFnTXJCLHlCQUFDO0NBQUEsQUExTUQsSUEwTUM7QUFFRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgTE9DQUxFX0lELCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IGZyb21Qcm9taXNlIH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL2Zyb21Qcm9taXNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi9sYW5ndWFnLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTZXJ2ZXJFeGNlcHRpb25FbnRpdHksIEV4Y2VwdGlvbkZhY3RvcnksIElFeGNlcHRpb25TdHJhdGVneSB9IGZyb20gJy4vZXJyb3IvaW5kZXgnO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG4vKipcclxuICog6KGo5Y2V5raI5oGv5pyN5YqhXHJcbiAqIEBzY29wZSBGb3JtTW9kdWxlXHJcbiAqIEBzdW1tYXJ5XHJcbiAqIDHjgIHljIXoo4VAZmFycmlzL3Vp55qE5raI5oGv5pyN5Yqh77ybXHJcbiAqIDLjgIHmj5Dkvpvpkojlr7nooajljZXnmoTlv6vmjbfmlrnms5XvvJtcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgRm9ybU1lc3NhZ2VTZXJ2aWNlIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICog5rOo5YWlQGZhcnJpcy91aeeahExvYWRpbmdTZXJ2aWNlXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSxcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGN1ckxhbmd1YWdlOiBzdHJpbmcsIC8vIOS4uuS6hueLrOeri+W8ueWHuumHjeaWsOeZu+W9leaPkOekuuahhu+8jOWIh+aNouWIsOi/kOihjOahhuaetmh0dHDmnI3liqHlkI7lj6/ku6XliKDpmaRcclxuICApIHtcclxuICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gdGhpcy5sYW5ndWFnZVNlcnZpY2UgfHwgTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIHF1ZXN0aW9u5by556qXXHJcbiAgICovXHJcbiAgcHVibGljIHF1ZXN0aW9uKGNvbnRlbnQ6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgY29uZmlybVJlc3VsdCQ6IFByb21pc2U8Ym9vbGVhbj4gPSB0aGlzLmNvbmZpcm1Qcm9taXNlKGNvbnRlbnQpO1xyXG4gICAgcmV0dXJuIGZyb20oY29uZmlybVJlc3VsdCQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bim6buY6K6k54Sm54K555qE5by55Ye65o+Q56S6XHJcbiAgICogQHBhcmFtIGNvbnRlbnQg5YaF5a65XHJcbiAgICovXHJcbiAgcHVibGljIHF1ZXN0aW9uMihjb250ZW50OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHByb21pc2UkOiBQcm9taXNlPGJvb2xlYW4+ID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm1lc3NhZ2VyU2VydmljZS5xdWVzdGlvbjIoXHJcbiAgICAgICAgY29udGVudCxcclxuICAgICAgICBbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHRleHQ6IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLm5vLFxyXG4gICAgICAgICAgICBjbHM6ICdidG4gYnRuLXNlY29uZGFyeScsXHJcbiAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIGRpYWxvZ1JlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlU2VydmljZS55ZXMsXHJcbiAgICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeScsXHJcbiAgICAgICAgICAgIGRlZmF1bHRGb2N1czogdHJ1ZSxcclxuICAgICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgICBkaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIF0pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZnJvbShwcm9taXNlJCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlvLnlh7rovpPlhaXlr7nor53moYZcclxuICAgKiBAcGFyYW0gdGl0bGUg5qCH6aKYXHJcbiAgICovXHJcbiAgcHVibGljIHByb21wdCh0aXRsZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLm1lc3NhZ2VyU2VydmljZS5wcm9tcHQodGl0bGUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5L2/55SoUHJvbWlzZeWunuS+i+WMheijheWbnuiwg+aWueazle+8jOS7peWQjOatpeWbnuiwg+aWueazleaJp+ihjOWQjue7k+aenFxyXG4gICAqIEBwYXJhbSBjb250ZW50XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb25maXJtUHJvbWlzZShjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLnF1ZXN0aW9uKFxyXG4gICAgICAgIGNvbnRlbnQsXHJcbiAgICAgICAgKCkgPT4geyByZXNvbHZlKHRydWUpOyB9LFxyXG4gICAgICAgICgpID0+IHsgcmVzb2x2ZShmYWxzZSk7IH1cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56Gu6K6k5by55qGGXHJcbiAgICogQHBhcmFtIGNvbnRlbnQg5by55Ye65YaF5a655o+Q56S6XHJcbiAgICovXHJcbiAgcHVibGljIGNvbmZpcm0oY29udGVudDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdlclNlcnZpY2UuY29uZmlybShjb250ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa2iOaBr+W8ueahhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbmZvKGNvbnRlbnQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuaW5mbyhjb250ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmUmeivr+W8ueahhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBlcnJvcihjb250ZW50OiBzdHJpbmcpIHtcclxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKGNvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K2m5ZGK5by55qGGXHJcbiAgICovXHJcbiAgcHVibGljIHdhcm5pbmcoY29udGVudDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS53YXJuaW5nKGNvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pyN5Yqh5Zmo56uv5byC5bi45o+Q56S65by55qGGXHJcbiAgICovXHJcbiAgcHVibGljIGh0dHBFcnJvckluU2VydmVyKGh0dHBFcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpOiB2b2lkIHtcclxuICAgIGxldCBlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5ID0gaHR0cEVycm9yLmVycm9yO1xyXG4gICAgaWYgKHR5cGVvZiAoZXJyb3IpID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGVycm9yID0gSlNPTi5wYXJzZShlcnJvcik7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFlcnJvciB8fCBlcnJvci5MZXZlbCA9PSBudWxsIHx8IGVycm9yLkxldmVsID09IHVuZGVmaW5lZCkgeyAvLyDmnKrlsIHoo4VlcnJvcuaIluacquiuvue9ruW8guW4uOetiee6p1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcihodHRwRXJyb3IubWVzc2FnZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGV4Y2VwdGlvblN0cmF0ZWd5OiBJRXhjZXB0aW9uU3RyYXRlZ3kgPSBFeGNlcHRpb25GYWN0b3J5LmdldEluc3RhbmNlKHRoaXMubWVzc2FnZXJTZXJ2aWNlLCB0aGlzLmxhbmd1YWdlU2VydmljZSkuZ2V0RXhjZXB0aW9uSGFuZGxlU3RyYXRlZ3koZXJyb3IuTGV2ZWwpO1xyXG4gICAgZXhjZXB0aW9uU3RyYXRlZ3kuaGFuZGxlRXhjZXB0aW9uKGVycm9yKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWuouaIt+err+W8guW4uOaPkOekuuW8ueahhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBodHRwRXJyb3JJbkNsaWVudChodHRwRXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogdm9pZCB7XHJcbiAgICBpZiAoIWh0dHBFcnJvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZXNzYWdlID0gaHR0cEVycm9yLmVycm9yICYmIGh0dHBFcnJvci5lcnJvci5lcnJvciAmJiBodHRwRXJyb3IuZXJyb3IuZXJyb3IubWVzc2FnZTtcclxuICAgIGNvbnN0IGV4Y2VwdGlvbk1zZyA9IG1lc3NhZ2UgfHwgaHR0cEVycm9yLm1lc3NhZ2UgJiYgaHR0cEVycm9yLm1lc3NhZ2UucmVwbGFjZSgvaHR0cDpcXC9cXC9bYS16QS1aMC05LjpdezEsfS8sICcnKTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgIC8vIHRpdGxlOiB0aGlzLmxhbmd1YWdlU2VydmljZS5jbGllbnROb3RpZnlUaXRsZSxcclxuICAgICAgLy8gc2hvd01heEJ1dHRvbjogdHJ1ZSxcclxuICAgICAgc2hvd0hlYWRlcjogZmFsc2UsXHJcbiAgICAgIHdpZHRoOiA0MDAsXHJcbiAgICAgIGhlaWdodDogMjAwLFxyXG4gICAgICBzYWZlSHRtbDogZmFsc2VcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2Uuc2hvdygnZXJyb3InLCBleGNlcHRpb25Nc2csIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogNDAx5byC5bi45aSE55CGXHJcbiAgICog5Li65LqG54us56uL5by55Ye66YeN5paw55m75b2V5o+Q56S65qGG77yM5YiH5o2i5Yiw6L+Q6KGM5qGG5p62aHR0cOacjeWKoeWQjuWPr+S7peWIoOmZpFxyXG4gICAqIEBwYXJhbSBodHRwRXJyb3Ig5byC5bi4XHJcbiAgICovXHJcbiAgcHVibGljIGh0dHA0MDFFcnJvcihodHRwRXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogdm9pZCB7XHJcbiAgICBjb25zdCBkaWFsb2dTaG93bktleSA9ICc0MDFFcnJvclNob3duRmxhZyc7XHJcblxyXG4gICAgaWYgKCFodHRwRXJyb3IgfHwgd2luZG93W2RpYWxvZ1Nob3duS2V5XSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaTE4biA9IHtcclxuICAgICAgZW46IHtcclxuICAgICAgICB0aXRsZTogJ1dhcm5pbmcnLFxyXG4gICAgICAgIHNlc3Npb25JbnZhbGlkOiAnWW91ciBsb2dpbiBoYXMgZXhwaXJlZCwgcGxlYXNlIGxvZ2luIGFnYWluLicsXHJcbiAgICAgICAgb2s6ICdvaycsXHJcbiAgICAgICAgY2FuY2VsOiAnY2FuY2VsJ1xyXG4gICAgICB9LFxyXG4gICAgICAnemgtQ0hTJzoge1xyXG4gICAgICAgIHRpdGxlOiAn5o+Q56S6JyxcclxuICAgICAgICBzZXNzaW9uSW52YWxpZDogJ+eUqOaIt+eZu+W9leS/oeaBr+W3suWkseaViO+8jOaYr+WQpumHjeaWsOeZu+W9lT8nLFxyXG4gICAgICAgIG9rOiAn56Gu6K6kJyxcclxuICAgICAgICBjYW5jZWw6ICflj5bmtognXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLmN1ckxhbmd1YWdlID0gdGhpcy5jdXJMYW5ndWFnZSB8fCAnemgtQ0hTJztcclxuXHJcbiAgICBjb25zdCBtZXNzYWdlT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IGkxOG5bdGhpcy5jdXJMYW5ndWFnZV0udGl0bGUsXHJcbiAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgIG9rVGV4dDogaTE4blt0aGlzLmN1ckxhbmd1YWdlXS5vayxcclxuICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgIHdpbmRvd1tkaWFsb2dTaG93bktleV0gPSBmYWxzZTtcclxuICAgICAgICAgIGNvbnN0IGV2ZW50UmVzdWx0ID0gaHR0cEVycm9yICYmIGh0dHBFcnJvci5lcnJvciB8fCB7fTtcclxuICAgICAgICAgIGNvbnN0IHJlZGlyZWN0VXJpID0gZXZlbnRSZXN1bHQucmVkaXJlY3RfdXJpIHx8ICcvbG9naW4uaHRtbCc7XHJcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGAvbG9nb3V0Lmh0bWwjP2xvZ291dC1iZWZvcmUtcmVkaXJlY3Q9dHJ1ZSZsb2dpblVyaT0ke3JlZGlyZWN0VXJpfWA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjYW5jZWxUZXh0OiBpMThuW3RoaXMuY3VyTGFuZ3VhZ2VdLmNhbmNlbCxcclxuICAgICAgICBjYW5jZWxIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICB3aW5kb3dbZGlhbG9nU2hvd25LZXldID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBzaG93SGVhZGVyOiB0cnVlLFxyXG4gICAgICB3aWR0aDogNDIwLFxyXG4gICAgICBoZWlnaHQ6IDE4MCxcclxuICAgICAgZml0Q29udGVudDogZmFsc2VcclxuICAgIH07XHJcbiAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMubWVzc2FnZXJTZXJ2aWNlLnNob3coJ3F1ZXN0aW9uJywgaTE4blt0aGlzLmN1ckxhbmd1YWdlXS5zZXNzaW9uSW52YWxpZCwgbWVzc2FnZU9wdGlvbnMpO1xyXG4gICAgd2luZG93W2RpYWxvZ1Nob3duS2V5XSA9IHRydWU7XHJcbiAgICBpZiAobW9kYWxSZWYgJiYgbW9kYWxSZWYuZGlhbG9nICYmIG1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZS5jbG9zZWQpIHtcclxuICAgICAgbW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmNsb3NlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIHdpbmRvd1tkaWFsb2dTaG93bktleV0gPSBmYWxzZTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgRm9ybU1lc3NhZ2VTZXJ2aWNlIH07XHJcblxyXG4iXX0=
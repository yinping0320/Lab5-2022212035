import { Injectable } from '@angular/core';
import { FrameContext, BindingList } from '@farris/devkit';
import { EntityTraversingService } from './entity-traversing.service';
/**
 * 实体聚合服务
 */
var EntityAggregationService = /** @class */ (function () {
    function EntityAggregationService(frameContext) {
        this.frameContext = frameContext;
        this.traversingService = this.frameContext.injector.get(EntityTraversingService);
    }
    Object.defineProperty(EntityAggregationService.prototype, "bindingData", {
        get: function () {
            return this.frameContext.bindingData;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 获取path对应列表记录的条数
     */
    EntityAggregationService.prototype.count = function (path) {
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        return entityListData.length;
    };
    /**
     * 获取path对应字段的和
     */
    EntityAggregationService.prototype.sum = function (path) {
        var _this = this;
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        var total = entityListData.reduce(function (accTotal, entityData) {
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            propValue = isNaN(propValue) ? 0 : propValue;
            accTotal += propValue;
            return accTotal;
        }, 0);
        return total;
    };
    /**
     * 获取path对应字段的平均值
     */
    EntityAggregationService.prototype.avg = function (path) {
        var count = this.count(path);
        var total = this.sum(path);
        return count !== 0 ? total / count : 0;
    };
    /**
     * 获取path对应字段的最大值
     */
    EntityAggregationService.prototype.max = function (path) {
        var _this = this;
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        var max = entityListData.reduce(function (accMax, entityData) {
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMax || propValue > accMax)) {
                accMax = propValue;
            }
            return accMax;
        }, null);
        return max ? max : 0;
    };
    /**
     * 获取path对应字段的最小值
     */
    EntityAggregationService.prototype.min = function (path) {
        var _this = this;
        var splitedPath = this.splitPath(path);
        var entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        var min = entityListData.reduce(function (accMin, entityData) {
            var propValue = parseFloat(_this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMin || propValue < accMin)) {
                accMin = propValue;
            }
            return accMin;
        }, null);
        return min ? min : 0;
    };
    /**
     * 获取属性值
     */
    EntityAggregationService.prototype.getPropValue = function (entityData, path) {
        var currentData = entityData;
        path.forEach(function (pathItem) {
            // 提前退出的都重置为null，主要针对关联对象未赋值场景
            if (!currentData) {
                currentData = null;
                return;
            }
            currentData = currentData[pathItem];
        });
        return currentData;
    };
    /**
     * 分隔路径，分隔符列表路径和属性路径
     * @return 形如 {parentListPath: [], propertyPath: []}
     */
    EntityAggregationService.prototype.splitPath = function (path) {
        var listPath = path.concat([]);
        var propPath = [];
        var currentNode = this.bindingData.getValue(listPath);
        while (currentNode instanceof BindingList !== true) {
            var propPathItem = listPath.pop();
            if (!propPathItem) {
                return;
            }
            propPath.unshift(propPathItem);
            currentNode = this.bindingData.getValue(listPath);
        }
        return {
            listPath: listPath,
            propPath: propPath
        };
    };
    EntityAggregationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    EntityAggregationService.ctorParameters = function () { return [
        { type: FrameContext }
    ]; };
    return EntityAggregationService;
}());
export { EntityAggregationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LWFnZ3JlZ2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZW50aXR5LXNlcnZpY2VzL2VudGl0eS1hZ2dyZWdhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBZSxXQUFXLEVBQWlCLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFPdEU7O0dBRUc7QUFDSDtJQVNFLGtDQUFvQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUM1QyxJQUFJLENBQUMsaUJBQWlCLEdBQUssSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUEwQix1QkFBdUIsQ0FBQyxDQUFDO0lBQzlHLENBQUM7SUFSRCxzQkFBWSxpREFBVzthQUF2QjtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7UUFDdkMsQ0FBQzs7O09BQUE7SUFRRDs7T0FFRztJQUNJLHdDQUFLLEdBQVosVUFBYSxJQUFjO1FBQ3pCLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN0RixPQUFPLGNBQWMsQ0FBQyxNQUFNLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0ksc0NBQUcsR0FBVixVQUFXLElBQWM7UUFBekIsaUJBV0M7UUFWQyxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLElBQU0sY0FBYyxH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Y2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZyYW1lQ29udGV4dCwgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0LCBCaW5kaW5nT2JqZWN0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBFbnRpdHlUcmF2ZXJzaW5nU2VydmljZSB9IGZyb20gJy4vZW50aXR5LXRyYXZlcnNpbmcuc2VydmljZSc7XHJcblxyXG5pbnRlcmZhY2UgU3BsaXRlZFBhdGgge1xyXG4gIGxpc3RQYXRoOiBzdHJpbmdbXTtcclxuICBwcm9wUGF0aDogc3RyaW5nW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlrp7kvZPogZrlkIjmnI3liqFcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgRW50aXR5QWdncmVnYXRpb25TZXJ2aWNlIHtcclxuXHJcbiAgcHJpdmF0ZSBnZXQgYmluZGluZ0RhdGEoKTogQmluZGluZ0RhdGEge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB0cmF2ZXJzaW5nU2VydmljZTogRW50aXR5VHJhdmVyc2luZ1NlcnZpY2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpIHtcclxuICAgIHRoaXMudHJhdmVyc2luZ1NlcnZpY2UgICA9IHRoaXMuZnJhbWVDb250ZXh0LmluamVjdG9yLmdldDxFbnRpdHlUcmF2ZXJzaW5nU2VydmljZT4oRW50aXR5VHJhdmVyc2luZ1NlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WcGF0aOWvueW6lOWIl+ihqOiusOW9leeahOadoeaVsFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb3VudChwYXRoOiBzdHJpbmdbXSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xyXG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcclxuICAgIHJldHVybiBlbnRpdHlMaXN0RGF0YS5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU5a2X5q6155qE5ZKMXHJcbiAgICovXHJcbiAgcHVibGljIHN1bShwYXRoOiBzdHJpbmdbXSkge1xyXG4gICAgY29uc3Qgc3BsaXRlZFBhdGggPSB0aGlzLnNwbGl0UGF0aChwYXRoKTtcclxuICAgIGNvbnN0IGVudGl0eUxpc3REYXRhID0gdGhpcy50cmF2ZXJzaW5nU2VydmljZS5nZXRFbnRpdHlMaXN0RGF0YShzcGxpdGVkUGF0aC5saXN0UGF0aCk7XHJcblxyXG4gICAgY29uc3QgdG90YWwgPSBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY1RvdGFsOiBudW1iZXIsIGVudGl0eURhdGE6IGFueSkgPT4ge1xyXG4gICAgICBsZXQgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xyXG4gICAgICBwcm9wVmFsdWUgPSBpc05hTihwcm9wVmFsdWUpID8gMCA6IHByb3BWYWx1ZTtcclxuICAgICAgYWNjVG90YWwgKz0gcHJvcFZhbHVlO1xyXG4gICAgICByZXR1cm4gYWNjVG90YWw7XHJcbiAgICB9LCAwKTtcclxuICAgIHJldHVybiB0b3RhbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTlubPlnYflgLxcclxuICAgKi9cclxuICBwdWJsaWMgYXZnKHBhdGg6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCBjb3VudCA9IHRoaXMuY291bnQocGF0aCk7XHJcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMuc3VtKHBhdGgpO1xyXG4gICAgcmV0dXJuIGNvdW50ICE9PSAwID8gdG90YWwgLyBjb3VudCA6IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU5a2X5q6155qE5pyA5aSn5YC8XHJcbiAgICovXHJcbiAgcHVibGljIG1heChwYXRoOiBzdHJpbmdbXSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xyXG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcclxuXHJcbiAgICBjb25zdCBtYXggPSAgZW50aXR5TGlzdERhdGEucmVkdWNlKChhY2NNYXg6IG51bWJlciwgZW50aXR5RGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5nZXRQcm9wVmFsdWUoZW50aXR5RGF0YSwgc3BsaXRlZFBhdGgucHJvcFBhdGgpKTtcclxuICAgICAgaWYgKGlzTmFOKHByb3BWYWx1ZSkgPT09IGZhbHNlICYmICggIWFjY01heCB8fCBwcm9wVmFsdWUgPiBhY2NNYXgpKSB7XHJcbiAgICAgICAgYWNjTWF4ID0gcHJvcFZhbHVlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBhY2NNYXg7XHJcbiAgICB9LCBudWxsKTtcclxuICAgIHJldHVybiBtYXggPyBtYXggOiAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WcGF0aOWvueW6lOWtl+auteeahOacgOWwj+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBtaW4ocGF0aDogc3RyaW5nW10pOiBudW1iZXIge1xyXG4gICAgY29uc3Qgc3BsaXRlZFBhdGggPSB0aGlzLnNwbGl0UGF0aChwYXRoKTtcclxuICAgIGNvbnN0IGVudGl0eUxpc3REYXRhID0gdGhpcy50cmF2ZXJzaW5nU2VydmljZS5nZXRFbnRpdHlMaXN0RGF0YShzcGxpdGVkUGF0aC5saXN0UGF0aCk7XHJcblxyXG4gICAgY29uc3QgbWluID0gZW50aXR5TGlzdERhdGEucmVkdWNlKChhY2NNaW46IG51bWJlciwgZW50aXR5RGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5nZXRQcm9wVmFsdWUoZW50aXR5RGF0YSwgc3BsaXRlZFBhdGgucHJvcFBhdGgpKTtcclxuICAgICAgaWYgKGlzTmFOKHByb3BWYWx1ZSkgPT09IGZhbHNlICYmICggIWFjY01pbiB8fCBwcm9wVmFsdWUgPCBhY2NNaW4pKSB7XHJcbiAgICAgICAgYWNjTWluID0gcHJvcFZhbHVlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBhY2NNaW47XHJcbiAgICB9LCBudWxsKTtcclxuICAgIHJldHVybiBtaW4gPyBtaW4gOiAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5bGe5oCn5YC8XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRQcm9wVmFsdWUoZW50aXR5RGF0YTogYW55LCBwYXRoOiBzdHJpbmdbXSkge1xyXG4gICAgbGV0IGN1cnJlbnREYXRhID0gZW50aXR5RGF0YTtcclxuICAgIHBhdGguZm9yRWFjaCgocGF0aEl0ZW06IHN0cmluZykgPT4ge1xyXG5cclxuICAgICAgLy8g5o+Q5YmN6YCA5Ye655qE6YO96YeN572u5Li6bnVsbO+8jOS4u+imgemSiOWvueWFs+iBlOWvueixoeacqui1i+WAvOWcuuaZr1xyXG4gICAgICBpZiAoIWN1cnJlbnREYXRhKSB7XHJcbiAgICAgICAgY3VycmVudERhdGEgPSBudWxsO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjdXJyZW50RGF0YSA9IGN1cnJlbnREYXRhW3BhdGhJdGVtXTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBjdXJyZW50RGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhumalOi3r+W+hO+8jOWIhumalOespuWIl+ihqOi3r+W+hOWSjOWxnuaAp+i3r+W+hFxyXG4gICAqIEByZXR1cm4g5b2i5aaCIHtwYXJlbnRMaXN0UGF0aDogW10sIHByb3BlcnR5UGF0aDogW119XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzcGxpdFBhdGgocGF0aDogc3RyaW5nW10pOiBTcGxpdGVkUGF0aCB7XHJcbiAgICBjb25zdCBsaXN0UGF0aCA9IHBhdGguY29uY2F0KFtdKTtcclxuICAgIGNvbnN0IHByb3BQYXRoID0gW107XHJcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGxpc3RQYXRoKTtcclxuICAgIHdoaWxlIChjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIEJpbmRpbmdMaXN0ICE9PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IHByb3BQYXRoSXRlbSA9IGxpc3RQYXRoLnBvcCgpO1xyXG4gICAgICBpZiAoIXByb3BQYXRoSXRlbSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBwcm9wUGF0aC51bnNoaWZ0KHByb3BQYXRoSXRlbSk7XHJcbiAgICAgIGN1cnJlbnROb2RlID0gdGhpcy5iaW5kaW5nRGF0YS5nZXRWYWx1ZShsaXN0UGF0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbGlzdFBhdGg6IGxpc3RQYXRoLFxyXG4gICAgICBwcm9wUGF0aDogcHJvcFBhdGhcclxuICAgIH07XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgRW50aXR5QWdncmVnYXRpb25TZXJ2aWNlIH07XHJcbiJdfQ==
import * as tslib_1 from "tslib";
import { Optional } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { LanguageService } from '../languag.service';
import { DeviceAbility } from '../util/device-ability';
import moment from 'moment';
/**
 * 异常处理基类
 */
var ExceptionStrategy = /** @class */ (function () {
    function ExceptionStrategy(messagerService, languageService) {
        this.messagerService = messagerService;
        this.languageService = languageService;
    }
    /** @nocollapse */
    ExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return ExceptionStrategy;
}());
export { ExceptionStrategy };
/**
 * 信息级别异常处理
 */
var InfoExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(InfoExceptionStrategy, _super);
    function InfoExceptionStrategy(messagerService, languageService) {
        return _super.call(this, messagerService, languageService) || this;
    }
    InfoExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.messagerService.info(error.Message);
    };
    /** @nocollapse */
    InfoExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return InfoExceptionStrategy;
}(ExceptionStrategy));
export { InfoExceptionStrategy };
/**
 * 警告级别异常处理
 */
var WarningExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(WarningExceptionStrategy, _super);
    function WarningExceptionStrategy(messagerService, languageService) {
        return _super.call(this, messagerService, languageService) || this;
    }
    WarningExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.messagerService.warning(error.Message);
    };
    /** @nocollapse */
    WarningExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return WarningExceptionStrategy;
}(ExceptionStrategy));
export { WarningExceptionStrategy };
/**
 * 错误级别异常处理
 */
var ErrorExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(ErrorExceptionStrategy, _super);
    function ErrorExceptionStrategy(messagerService, languageService) {
        var _this = _super.call(this, messagerService, languageService) || this;
        _this.langService = null;
        _this.langService = languageService;
        if (!_this.langService) {
            _this.langService = new LanguageService();
        }
        return _this;
    }
    ErrorExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.handleErrorLevel(error);
    };
    ErrorExceptionStrategy.prototype.handleErrorLevel = function (error) {
        var _this = this;
        var exceptionMsg = error.Message || '';
        var date = error.date || new Date();
        var localDate = moment(date).format('YYYY-MM-DD HH:mm:ss');
        var detail = error.Detail || error.Message + "\r\n\u53D1\u751F\u65F6\u95F4\uFF1A" + localDate + "\r\n\u8BE6\u7EC6\u4FE1\u606F\uFF1A" + error.innerMessage || '';
        var innerMessage = error.innerMessage || null;
        var bsModalRef;
        var options = {
            // title: this.languageService.serverNotifyTitle,
            showMaxButton: false,
            buttons: [
                {
                    text: this.langService.roger,
                    cls: 'btn btn-primary btn-lg',
                    handle: function () {
                        bsModalRef.close();
                    }
                }
            ],
            // showHeader: false,
            width: 440,
            height: 200,
            safeHtml: false,
            exception: {
                date: localDate,
                message: innerMessage,
                copyButton: {
                    text: this.langService.copy,
                    onClick: function (e) {
                        var result = DeviceAbility.copyToClipboard(detail);
                        var text = result ? _this.langService.copySuccess : _this.langService.copyFailed;
                        bsModalRef.content.showMiniNotify(text, 1500);
                    }
                }
            }
        };
        this.displayError(error);
        bsModalRef = this.messagerService.show('exception', exceptionMsg, options);
    };
    /**
     * 在控制台中显示错误信息
     */
    ErrorExceptionStrategy.prototype.displayError = function (error) {
        if (!error) {
            return;
        }
        if (!console || !console.error) {
            return;
        }
        console.error(error);
    };
    /** @nocollapse */
    ErrorExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return ErrorExceptionStrategy;
}(ExceptionStrategy));
export { ErrorExceptionStrategy };
/**
 * 致命错误级别异常处理
 */
var FatalExceptionStrategy = /** @class */ (function (_super) {
    tslib_1.__extends(FatalExceptionStrategy, _super);
    function FatalExceptionStrategy(messagerService, languageService) {
        return _super.call(this, messagerService, languageService) || this;
    }
    FatalExceptionStrategy.prototype.handleException = function (error) {
        if (!error) {
            return;
        }
        this.messagerService.error(error.Message);
    };
    /** @nocollapse */
    FatalExceptionStrategy.ctorParameters = function () { return [
        { type: MessagerService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return FatalExceptionStrategy;
}(ExceptionStrategy));
export { FatalExceptionStrategy };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjZXB0aW9uX3N0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2Vycm9yL2V4Y2VwdGlvbl9zdHJhdGVneS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXJELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUl2RCxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFTNUI7O0dBRUc7QUFDSDtJQUNFLDJCQUNTLGVBQWdDLEVBQ3BCLGVBQWdDO1FBRDVDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNwQixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7SUFDckQsQ0FBQzs7O2dCQXZCTSxlQUFlO2dCQUNmLGVBQWUsdUJBcUJuQixRQUFROztJQUViLHdCQUFDO0NBQUEsQUFMRCxJQUtDO1NBTFksaUJBQWlCO0FBTzlCOztHQUVHO0FBQ0g7SUFBMkMsaURBQWlCO0lBQzFELCtCQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO2VBQzVDLGtCQUFNLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFDekMsQ0FBQztJQUVNLCtDQUFlLEdBQXRCLFVBQXVCLEtBQTRCO1FBQ2pELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0MsQ0FBQzs7O2dCQTFDTSxlQUFlO2dCQUNmLGVBQWUsdUJBK0JuQixRQUFROztJQVdiLDRCQUFDO0NBQUEsQUFkRCxDQUEyQyxpQkFBaUIsR0FjM0Q7U0FkWSxxQkFBcUI7QUFpQmxDOztHQUVHO0FB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QUFDO1FBQ0YsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN6QixVQUFVLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBQ0Q7O09BRUc7SUFDSyw2Q0FBWSxHQUFwQixVQUFxQixLQUE0QjtRQUMvQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDOUIsT0FBTztTQUNSO1FBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QixDQUFDOzs7Z0JBN0lNLGVBQWU7Z0JBQ2YsZUFBZSx1QkF3RW5CLFFBQVE7O0lBcUViLDZCQUFDO0NBQUEsQUF6RUQsQ0FBNEMsaUJBQWlCLEdBeUU1RDtTQXpFWSxzQkFBc0I7QUEyRW5DOztHQUVHO0FBQ0g7SUFBNEMsa0RBQWlCO0lBQzNELGdDQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO2VBQzVDLGtCQUFNLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFDekMsQ0FBQztJQUVNLGdEQUFlLEdBQXRCLFVBQXVCLEtBQTRCO1FBQ2pELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQzs7O2dCQWhLTSxlQUFlO2dCQUNmLGVBQWUsdUJBcUpuQixRQUFROztJQVdiLDZCQUFDO0NBQUEsQUFkRCxDQUE0QyxpQkFBaUIsR0FjNUQ7U0FkWSxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uL2xhbmd1YWcuc2VydmljZSc7XHJcbmltcG9ydCB7IFNlcnZlckV4Y2VwdGlvbkVudGl0eSB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBEZXZpY2VBYmlsaXR5IH0gZnJvbSAnLi4vdXRpbC9kZXZpY2UtYWJpbGl0eSc7XHJcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuLi9mb3JtLW5vdGlmeS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XHJcbi8qKlxyXG4gKiDlvILluLjlpITnkIbmjqXlj6NcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcclxuICBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQ7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICog5byC5bi45aSE55CG5Z+657G7XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRXhjZXB0aW9uU3RyYXRlZ3kge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHVibGljIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog5L+h5oGv57qn5Yir5byC5bi45aSE55CGXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgSW5mb0V4Y2VwdGlvblN0cmF0ZWd5IGV4dGVuZHMgRXhjZXB0aW9uU3RyYXRlZ3kgaW1wbGVtZW50cyBJRXhjZXB0aW9uU3RyYXRlZ3kge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSkge1xyXG4gICAgc3VwZXIobWVzc2FnZXJTZXJ2aWNlLCBsYW5ndWFnZVNlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGhhbmRsZUV4Y2VwdGlvbihlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5KTogdm9pZCB7XHJcbiAgICBpZiAoIWVycm9yKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5pbmZvKGVycm9yLk1lc3NhZ2UpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiDorablkYrnuqfliKvlvILluLjlpITnkIZcclxuICovXHJcbmV4cG9ydCBjbGFzcyBXYXJuaW5nRXhjZXB0aW9uU3RyYXRlZ3kgZXh0ZW5kcyBFeGNlcHRpb25TdHJhdGVneSBpbXBsZW1lbnRzIElFeGNlcHRpb25TdHJhdGVneSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcclxuICAgIGlmICghZXJyb3IpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLndhcm5pbmcoZXJyb3IuTWVzc2FnZSk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIOmUmeivr+e6p+WIq+W8guW4uOWkhOeQhlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEVycm9yRXhjZXB0aW9uU3RyYXRlZ3kgZXh0ZW5kcyBFeGNlcHRpb25TdHJhdGVneSBpbXBsZW1lbnRzIElFeGNlcHRpb25TdHJhdGVneSB7XHJcbiAgcHJpdmF0ZSBsYW5nU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlID0gbnVsbDtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgIHN1cGVyKG1lc3NhZ2VyU2VydmljZSwgbGFuZ3VhZ2VTZXJ2aWNlKTtcclxuICAgIHRoaXMubGFuZ1NlcnZpY2UgPSBsYW5ndWFnZVNlcnZpY2U7XHJcbiAgICBpZiAoIXRoaXMubGFuZ1NlcnZpY2UpIHtcclxuICAgICAgdGhpcy5sYW5nU2VydmljZSA9IG5ldyBMYW5ndWFnZVNlcnZpY2UoKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcclxuICAgIGlmICghZXJyb3IpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaGFuZGxlRXJyb3JMZXZlbChlcnJvcik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUVycm9yTGV2ZWwoZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xyXG4gICAgY29uc3QgZXhjZXB0aW9uTXNnID0gZXJyb3IuTWVzc2FnZSB8fCAnJztcclxuICAgIGNvbnN0IGRhdGUgPSBlcnJvci5kYXRlIHx8IG5ldyBEYXRlKCk7XHJcbiAgICBjb25zdCBsb2NhbERhdGUgPSBtb21lbnQoZGF0ZSkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJyk7XHJcbiAgICBjb25zdCBkZXRhaWwgPSBlcnJvci5EZXRhaWwgfHwgYCR7ZXJyb3IuTWVzc2FnZX1cXHJcXG7lj5HnlJ/ml7bpl7TvvJoke2xvY2FsRGF0ZX1cXHJcXG7or6bnu4bkv6Hmga/vvJoke2Vycm9yLmlubmVyTWVzc2FnZX1gIHx8ICcnO1xyXG5cclxuICAgIGNvbnN0IGlubmVyTWVzc2FnZSA9IGVycm9yLmlubmVyTWVzc2FnZSB8fCBudWxsO1xyXG4gICAgbGV0IGJzTW9kYWxSZWY6IEJzTW9kYWxSZWY7XHJcbiAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAvLyB0aXRsZTogdGhpcy5sYW5ndWFnZVNlcnZpY2Uuc2VydmVyTm90aWZ5VGl0bGUsXHJcbiAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICBidXR0b25zOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGV4dDogdGhpcy5sYW5nU2VydmljZS5yb2dlcixcclxuICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeSBidG4tbGcnLFxyXG4gICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIGJzTW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIC8vIHNob3dIZWFkZXI6IGZhbHNlLFxyXG4gICAgICB3aWR0aDogNDQwLFxyXG4gICAgICBoZWlnaHQ6IDIwMCxcclxuICAgICAgc2FmZUh0bWw6IGZhbHNlLFxyXG4gICAgICBleGNlcHRpb246IHtcclxuICAgICAgICBkYXRlOiBsb2NhbERhdGUsXHJcbiAgICAgICAgbWVzc2FnZTogaW5uZXJNZXNzYWdlLFxyXG4gICAgICAgIGNvcHlCdXR0b246IHtcclxuICAgICAgICAgIHRleHQ6IHRoaXMubGFuZ1NlcnZpY2UuY29weSxcclxuICAgICAgICAgIG9uQ2xpY2s6IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IERldmljZUFiaWxpdHkuY29weVRvQ2xpcGJvYXJkKGRldGFpbCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSByZXN1bHQgPyB0aGlzLmxhbmdTZXJ2aWNlLmNvcHlTdWNjZXNzIDogdGhpcy5sYW5nU2VydmljZS5jb3B5RmFpbGVkO1xyXG4gICAgICAgICAgICBic01vZGFsUmVmLmNvbnRlbnQuc2hvd01pbmlOb3RpZnkodGV4dCwgMTUwMCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhpcy5kaXNwbGF5RXJyb3IoZXJyb3IpO1xyXG4gICAgYnNNb2RhbFJlZiA9IHRoaXMubWVzc2FnZXJTZXJ2aWNlLnNob3coJ2V4Y2VwdGlvbicsIGV4Y2VwdGlvbk1zZywgb3B0aW9ucyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWcqOaOp+WItuWPsOS4reaYvuekuumUmeivr+S/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGlzcGxheUVycm9yKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpIHtcclxuICAgIGlmICghZXJyb3IpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFjb25zb2xlIHx8ICFjb25zb2xlLmVycm9yKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOiHtOWRvemUmeivr+e6p+WIq+W8guW4uOWkhOeQhlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEZhdGFsRXhjZXB0aW9uU3RyYXRlZ3kgZXh0ZW5kcyBFeGNlcHRpb25TdHJhdGVneSBpbXBsZW1lbnRzIElFeGNlcHRpb25TdHJhdGVneSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcclxuICAgIGlmICghZXJyb3IpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKGVycm9yLk1lc3NhZ2UpO1xyXG4gIH1cclxufVxyXG4iXX0=
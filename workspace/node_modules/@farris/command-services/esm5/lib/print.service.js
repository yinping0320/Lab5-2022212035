import { Injectable, Optional } from '@angular/core';
import { EMPTY } from 'rxjs';
import { FormMessageService } from './form-message.service';
import { LanguageService } from './languag.service';
import { CloudprintService, OutputType, FileType, PrintType } from '@gsp-svc/cloudprint';
import { FormNotifyService } from './form-notify.service';
// tslint:disable: unified-signatures
// tslint:disable: max-line-length
/**
 * 打印服务
 * @Scope FrameComponent
 */
var PrintService = /** @class */ (function () {
    /**
     * 构造函数
     */
    function PrintService(msgService, languageService, printService, formNotifyService) {
        this.msgService = msgService;
        this.languageService = languageService;
        this.printService = printService;
        this.formNotifyService = formNotifyService;
    }
    /**
     * 打印单据
     * @param beMetaId BE元数据标识
     * @param bizBillId 业务单据标识
     */
    PrintService.prototype.printSingle = function (beMetaId, bizBillId) {
        if (!bizBillId) {
            // this.msgService.error(this.languageService.unallowEmptyBizBillId);
            this.showWarning(this.languageService.unallowEmptyBizBillId);
            return EMPTY;
        }
        return this.printArray(beMetaId, [bizBillId]);
    };
    /**
     * 打印单据（通过id或ids）
     * @param beMetaId be元数据Id
     * @param ids 单据id或ids
     */
    PrintService.prototype.printByIds = function (beMetaId, ids) {
        if (!ids) {
            // this.msgService.error(this.languageService.unallowEmptyBizBillId);
            this.showWarning(this.languageService.unallowEmptyBizBillId);
            return EMPTY;
        }
        var dataIds = ids.split(',').filter(function (item) { return item; });
        return this.printArray(beMetaId, dataIds);
    };
    /**
     * 打印单据（带维度）
     * @param beMetaId be元数据Id
     * @param ids 单据id或ids
     * @param dim1 维度1值
     * @param dim2 维度2值
     * @param billCategoryId 单据类型Id
     */
    PrintService.prototype.printByIdsWithDimension = function (beMetaId, ids, dim1, dim2, billCategoryId) {
        if (!ids) {
            // this.msgService.error(this.languageService.unallowEmptyBizBillId);
            this.showWarning(this.languageService.unallowEmptyBizBillId);
            return EMPTY;
        }
        var dataIds = ids.split(',').filter(function (item) { return item; });
        return this.printArray(beMetaId, dataIds, dim1, dim2, billCategoryId);
    };
    /**
     * 打印多个单据
     * @param beMetaId BE元数据标识
     * @param dataIds 业务单据标识数组
     * @param dim1 维度1
     * @param dim2 维度2
     * @param billCategoryId 业务单据类型Id
     */
    PrintService.prototype.printArray = function (beMetaId, dataIds, dim1, dim2, billCategoryId) {
        if (!dataIds || dataIds.length === 0) {
            // this.msgService.error(this.languageService.unallowEmptyBizBillId);
            this.showWarning(this.languageService.unallowEmptyBizBillId);
            return EMPTY;
        }
        var sourceOptions = this.buildSourceOptions({
            dataIds: dataIds,
            sourceId: beMetaId
        });
        var outputOptions = this.buildOutputOptions();
        if (typeof dim1 !== 'undefined') {
            sourceOptions.FirstDimensionVal = dim1;
        }
        if (typeof dim2 !== 'undefined') {
            sourceOptions.SecondDimensionVal = dim2;
        }
        if (typeof billCategoryId !== 'undefined') {
            sourceOptions.billCategoryId = billCategoryId;
        }
        return this.printService.outputBEData(sourceOptions, outputOptions, 'tab');
    };
    /**
     * 按照BE取数方式批量打印单据
     * @param beMetaId BE元数据标识
     * @param filterCondition 过滤条件
     * @param sortCondition 排序条件
     * @param includeChildData 包含子表数据
     */
    PrintService.prototype.printMulti = function (beMetaId, filterCondition, sortCondition, includeChildData) {
        if (includeChildData === void 0) { includeChildData = true; }
        var entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };
        if (filterCondition) {
            // 统一纠正最后一个过滤条件的Relation
            var filters = JSON.parse(filterCondition);
            if (filters && filters.length > 0) {
                filters[filters.length - 1].Relation = 0;
            }
            entryFilter.filterConditions = filters;
        }
        if (sortCondition) {
            entryFilter.sortConditions = JSON.parse(sortCondition);
        }
        // sfo:SourceFilterOptions
        var sourceFilterOptions = this.buildSourceFilterOptions({ sourceId: beMetaId, entryFilter: entryFilter, includeChildData: includeChildData });
        var outputOptions = this.buildOutputOptions();
        return this.printService.outputBEDataWithFilter(sourceFilterOptions, outputOptions, 'tab');
    };
    /**
     * 按照BE取数方式批量打印单据(带维度)
     * @param beMetaId BE元数据标识
     * @param filterCondition 过滤条件
     * @param sortCondition 排序条件
     * @param dim1 维度1value
     * @param dim2 维度2value
     * @param billCategoryId 业务单据类型Id
     * @param includeChildData 包含子表数据
     */
    PrintService.prototype.printMultiWithDimension = function (beMetaId, filterCondition, sortCondition, dim1, dim2, billCategoryId, includeChildData) {
        if (includeChildData === void 0) { includeChildData = true; }
        var entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };
        if (filterCondition) {
            // 统一纠正最后一个过滤条件的Relation
            var filters = JSON.parse(filterCondition);
            if (filters && filters.length > 0) {
                filters[filters.length - 1].Relation = 0;
            }
            entryFilter.filterConditions = filters;
        }
        if (sortCondition) {
            entryFilter.sortConditions = JSON.parse(sortCondition);
        }
        var sfo = this.buildSourceFilterOptions({ sourceId: beMetaId, entryFilter: entryFilter, includeChildData: includeChildData });
        if (typeof dim1 !== 'undefined') {
            sfo.FirstDimensionVal = dim1;
        }
        if (typeof dim2 !== 'undefined') {
            sfo.SecondDimensionVal = dim2;
        }
        if (typeof billCategoryId !== 'undefined') {
            sfo.billCategoryId = billCategoryId;
        }
        var outputOptions = this.buildOutputOptions();
        return this.printService.outputBEDataWithFilter(sfo, outputOptions, 'tab');
    };
    /**
     * 构造SourceOptions
     * @param options options
     */
    PrintService.prototype.buildSourceOptions = function (options) {
        var so = {
            DataIds: options && options.dataIds || undefined,
            SourceId: options && options.sourceId || undefined,
            FirstDimensionVal: options && options.dim1 || undefined,
            SecondDimensionVal: options && options.dim2 || undefined,
            RetrieveParam: options && options.retrieveParam || undefined,
            FormatId: options && options.formatId || undefined,
            billCategoryId: options && options.billCategoryId || undefined,
            ServiceUnit: options && options.serviceUnit || undefined,
            currentPage: options && options.currentPage || undefined,
            pageRowCount: options && options.pageRowCount || undefined,
            queryType: options && options.queryType || undefined,
            queryServiceId: options && options.queryServiceId || undefined,
            queryParam: options && options.queryParam || undefined
        };
        return so;
    };
    /**
     * 构造OutputOptions
     * @param options options
     */
    PrintService.prototype.buildOutputOptions = function (options) {
        var oo = {
            OutputType: options && options.outputType || OutputType.PRINT,
            FileType: options && options.fileType || FileType.Html5,
            Path: options && options.path || undefined,
            DeviceId: options && options.deviceId || undefined,
            printJob: options && options.printJob || undefined,
            printerName: options && options.printerName || undefined,
            printSetting: options && options.printSetting || undefined,
            printType: options && options.printType || PrintType.Form
        };
        return oo;
    };
    /**
     * 构造SourceFilterOptions
     * @param options options
     */
    PrintService.prototype.buildSourceFilterOptions = function (options) {
        var entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };
        var sfo = {
            SourceId: options.sourceId,
            EntityFilter: options && options.entryFilter || entryFilter,
            FirstDimensionVal: options && options.dim1 || undefined,
            SecondDimensionVal: options && options.dim2 || undefined,
            FormatId: options && options.formatId || undefined,
            ServiceUnit: options && options.serviceUnit || undefined,
            billCategoryId: options && options.billCategoryId || undefined,
            currentPage: options && options.currentPage || undefined,
            pageRowCount: options && options.pageRowCount || undefined,
            queryParam: options && options.queryParam || undefined,
            queryServiceId: options && options.queryServiceId || undefined,
            queryType: options && options.queryType || undefined,
            includeChildData: options && options.hasOwnProperty('includeChildData') ? options.includeChildData : true
        };
        return sfo;
    };
    /**
     * 展示错误消息
     * @param message 错误消息
     */
    PrintService.prototype.showWarning = function (message) {
        if (this.notifyService) {
            this.notifyService.warning(message, { hideTitle: true });
        }
        else if (this.msgService) {
            this.msgService.error(message);
        }
    };
    Object.defineProperty(PrintService.prototype, "notifyService", {
        get: function () {
            if (this.formNotifyService) {
                return this.formNotifyService;
            }
            else if (this.injector) {
                return this.injector.get(FormNotifyService, null);
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrintService.prototype, "commandContext", {
        get: function () {
            return this['context'] || null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrintService.prototype, "frameContext", {
        get: function () {
            return this.commandContext && this.commandContext.frameContext || null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PrintService.prototype, "injector", {
        get: function () {
            return this.frameContext && this.frameContext.injector || null;
        },
        enumerable: true,
        configurable: true
    });
    PrintService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PrintService.ctorParameters = function () { return [
        { type: FormMessageService },
        { type: LanguageService },
        { type: CloudprintService },
        { type: FormNotifyService, decorators: [{ type: Optional }] }
    ]; };
    return PrintService;
}());
export { PrintService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9wcmludC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQVksUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0IsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBR3BELE9BQU8sRUFBRSxpQkFBaUIsRUFBZ0MsVUFBVSxFQUFFLFFBQVEsRUFBdUIsU0FBUyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDNUksT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQscUNBQXFDO0FBQ3JDLGtDQUFrQztBQUNsQzs7O0dBR0c7QUFDSDtJQU9FOztPQUVHO0lBQ0gsc0JBQ1UsVUFBOEIsRUFDOUIsZUFBZ0MsRUFDaEMsWUFBK0IsRUFDbkIsaUJBQW9DO1FBSGhELGVBQVUsR0FBVixVQUFVLENBQW9CO1FBQzlCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxpQkFBWSxHQUFaLFlBQVksQ0FBbUI7UUFDbkIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtJQUUxRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLGtDQUFXLEdBQWxCLFVBQW1CLFFBQWdCLEVBQUUsU0FBaUI7UUFDcEQsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNkLHFFQUFxRTtZQUNyRSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUM3RCxPQUFPLEtBQUssQ0FBQztTQUNkO1FBQ0QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxD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QUNFLE9BQU8sSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUM7UUFDekUsQ0FBQzs7O09BQUE7SUFDRCxzQkFBWSxrQ0FBUTthQUFwQjtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUM7UUFDakUsQ0FBQzs7O09BQUE7O2dCQXZQRixVQUFVOzs7O2dCQVpGLGtCQUFrQjtnQkFDbEIsZUFBZTtnQkFHZixpQkFBaUI7Z0JBQ2pCLGlCQUFpQix1QkFxQnJCLFFBQVE7O0lBME9iLG1CQUFDO0NBQUEsQUF4UEQsSUF3UEM7QUFFRCxPQUFPLEVBQUUsWUFBWSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRU1QVFkgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRm9ybU1lc3NhZ2VTZXJ2aWNlIH0gZnJvbSAnLi9mb3JtLW1lc3NhZ2Uuc2VydmljZSc7XHJcbmltcG9ydCB7IExhbmd1YWdlU2VydmljZSB9IGZyb20gJy4vbGFuZ3VhZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSB9IGZyb20gJ0BmYXJyaXMvYmVmJztcclxuaW1wb3J0IHsgQ29tbWFuZENvbnRleHQsIEVudGl0eSwgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBDbG91ZHByaW50U2VydmljZSwgT3V0cHV0T3B0aW9ucywgU291cmNlT3B0aW9ucywgT3V0cHV0VHlwZSwgRmlsZVR5cGUsIFNvdXJjZUZpbHRlck9wdGlvbnMsIFByaW50VHlwZSB9IGZyb20gJ0Bnc3Atc3ZjL2Nsb3VkcHJpbnQnO1xyXG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4vZm9ybS1ub3RpZnkuc2VydmljZSc7XHJcbi8vIHRzbGludDpkaXNhYmxlOiB1bmlmaWVkLXNpZ25hdHVyZXNcclxuLy8gdHNsaW50OmRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG4vKipcclxuICog5omT5Y2w5pyN5YqhXHJcbiAqIEBTY29wZSBGcmFtZUNvbXBvbmVudFxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBQcmludFNlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIOWunuS9k+S7k+W6k1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVwb3NpdG9yeTogQmVmUmVwb3NpdG9yeTxFbnRpdHk+O1xyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbXNnU2VydmljZTogRm9ybU1lc3NhZ2VTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSxcclxuICAgIHByaXZhdGUgcHJpbnRTZXJ2aWNlOiBDbG91ZHByaW50U2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgZm9ybU5vdGlmeVNlcnZpY2U6IEZvcm1Ob3RpZnlTZXJ2aWNlLFxyXG4gICkge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5Y2w5Y2V5o2uXHJcbiAgICogQHBhcmFtIGJlTWV0YUlkIEJF5YWD5pWw5o2u5qCH6K+GXHJcbiAgICogQHBhcmFtIGJpekJpbGxJZCDkuJrliqHljZXmja7moIfor4ZcclxuICAgKi9cclxuICBwdWJsaWMgcHJpbnRTaW5nbGUoYmVNZXRhSWQ6IHN0cmluZywgYml6QmlsbElkOiBzdHJpbmcpIHtcclxuICAgIGlmICghYml6QmlsbElkKSB7XHJcbiAgICAgIC8vIHRoaXMubXNnU2VydmljZS5lcnJvcih0aGlzLmxhbmd1YWdlU2VydmljZS51bmFsbG93RW1wdHlCaXpCaWxsSWQpO1xyXG4gICAgICB0aGlzLnNob3dXYXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnVuYWxsb3dFbXB0eUJpekJpbGxJZCk7XHJcbiAgICAgIHJldHVybiBFTVBUWTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnByaW50QXJyYXkoYmVNZXRhSWQsIFtiaXpCaWxsSWRdKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5omT5Y2w5Y2V5o2u77yI6YCa6L+HaWTmiJZpZHPvvIlcclxuICAgKiBAcGFyYW0gYmVNZXRhSWQgYmXlhYPmlbDmja5JZFxyXG4gICAqIEBwYXJhbSBpZHMg5Y2V5o2uaWTmiJZpZHNcclxuICAgKi9cclxuICBwdWJsaWMgcHJpbnRCeUlkcyhiZU1ldGFJZDogc3RyaW5nLCBpZHM6IHN0cmluZykge1xyXG4gICAgaWYgKCFpZHMpIHtcclxuICAgICAgLy8gdGhpcy5tc2dTZXJ2aWNlLmVycm9yKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnVuYWxsb3dFbXB0eUJpekJpbGxJZCk7XHJcbiAgICAgIHRoaXMuc2hvd1dhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UudW5hbGxvd0VtcHR5Qml6QmlsbElkKTtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0YUlkczogQXJyYXk8c3RyaW5nPiA9IGlkcy5zcGxpdCgnLCcpLmZpbHRlcihpdGVtID0+IGl0ZW0pO1xyXG4gICAgcmV0dXJuIHRoaXMucHJpbnRBcnJheShiZU1ldGFJZCwgZGF0YUlkcyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJk+WNsOWNleaNru+8iOW4pue7tOW6pu+8iVxyXG4gICAqIEBwYXJhbSBiZU1ldGFJZCBiZeWFg+aVsOaNrklkXHJcbiAgICogQHBhcmFtIGlkcyDljZXmja5pZOaIlmlkc1xyXG4gICAqIEBwYXJhbSBkaW0xIOe7tOW6pjHlgLxcclxuICAgKiBAcGFyYW0gZGltMiDnu7TluqYy5YC8XHJcbiAgICogQHBhcmFtIGJpbGxDYXRlZ29yeUlkIOWNleaNruexu+Wei0lkXHJcbiAgICovXHJcbiAgcHVibGljIHByaW50QnlJZHNXaXRoRGltZW5zaW9uKGJlTWV0YUlkOiBzdHJpbmcsIGlkczogc3RyaW5nLCBkaW0xOiBzdHJpbmcsIGRpbTI6IHN0cmluZywgYmlsbENhdGVnb3J5SWQ/OiBzdHJpbmcpIHtcclxuICAgIGlmICghaWRzKSB7XHJcbiAgICAgIC8vIHRoaXMubXNnU2VydmljZS5lcnJvcih0aGlzLmxhbmd1YWdlU2VydmljZS51bmFsbG93RW1wdHlCaXpCaWxsSWQpO1xyXG4gICAgICB0aGlzLnNob3dXYXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnVuYWxsb3dFbXB0eUJpekJpbGxJZCk7XHJcbiAgICAgIHJldHVybiBFTVBUWTtcclxuICAgIH1cclxuICAgIGNvbnN0IGRhdGFJZHM6IEFycmF5PHN0cmluZz4gPSBpZHMuc3BsaXQoJywnKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcclxuICAgIHJldHVybiB0aGlzLnByaW50QXJyYXkoYmVNZXRhSWQsIGRhdGFJZHMsIGRpbTEsIGRpbTIsIGJpbGxDYXRlZ29yeUlkKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5omT5Y2w5aSa5Liq5Y2V5o2uXHJcbiAgICogQHBhcmFtIGJlTWV0YUlkIEJF5YWD5pWw5o2u5qCH6K+GXHJcbiAgICogQHBhcmFtIGRhdGFJZHMg5Lia5Yqh5Y2V5o2u5qCH6K+G5pWw57uEXHJcbiAgICogQHBhcmFtIGRpbTEg57u05bqmMVxyXG4gICAqIEBwYXJhbSBkaW0yIOe7tOW6pjJcclxuICAgKiBAcGFyYW0gYmlsbENhdGVnb3J5SWQg5Lia5Yqh5Y2V5o2u57G75Z6LSWRcclxuICAgKi9cclxuICBwdWJsaWMgcHJpbnRBcnJheShiZU1ldGFJZDogc3RyaW5nLCBkYXRhSWRzOiBzdHJpbmdbXSwgZGltMT86IGFueSwgZGltMj86IGFueSwgYmlsbENhdGVnb3J5SWQ/OiBzdHJpbmcpIHtcclxuICAgIGlmICghZGF0YUlkcyB8fCBkYXRhSWRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAvLyB0aGlzLm1zZ1NlcnZpY2UuZXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2UudW5hbGxvd0VtcHR5Qml6QmlsbElkKTtcclxuICAgICAgdGhpcy5zaG93V2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZS51bmFsbG93RW1wdHlCaXpCaWxsSWQpO1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzb3VyY2VPcHRpb25zOiBTb3VyY2VPcHRpb25zID0gdGhpcy5idWlsZFNvdXJjZU9wdGlvbnMoe1xyXG4gICAgICBkYXRhSWRzOiBkYXRhSWRzLFxyXG4gICAgICBzb3VyY2VJZDogYmVNZXRhSWRcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IG91dHB1dE9wdGlvbnM6IE91dHB1dE9wdGlvbnMgPSB0aGlzLmJ1aWxkT3V0cHV0T3B0aW9ucygpO1xyXG5cclxuICAgIGlmICh0eXBlb2YgZGltMSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgc291cmNlT3B0aW9ucy5GaXJzdERpbWVuc2lvblZhbCA9IGRpbTE7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGRpbTIgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHNvdXJjZU9wdGlvbnMuU2Vjb25kRGltZW5zaW9uVmFsID0gZGltMjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgYmlsbENhdGVnb3J5SWQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHNvdXJjZU9wdGlvbnMuYmlsbENhdGVnb3J5SWQgPSBiaWxsQ2F0ZWdvcnlJZDtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnByaW50U2VydmljZS5vdXRwdXRCRURhdGEoc291cmNlT3B0aW9ucywgb3V0cHV0T3B0aW9ucywgJ3RhYicpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5oyJ54WnQkXlj5bmlbDmlrnlvI/mibnph4/miZPljbDljZXmja5cclxuICAgKiBAcGFyYW0gYmVNZXRhSWQgQkXlhYPmlbDmja7moIfor4ZcclxuICAgKiBAcGFyYW0gZmlsdGVyQ29uZGl0aW9uIOi/h+a7pOadoeS7tlxyXG4gICAqIEBwYXJhbSBzb3J0Q29uZGl0aW9uIOaOkuW6j+adoeS7tlxyXG4gICAqIEBwYXJhbSBpbmNsdWRlQ2hpbGREYXRhIOWMheWQq+WtkOihqOaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcmludE11bHRpKGJlTWV0YUlkOiBzdHJpbmcsIGZpbHRlckNvbmRpdGlvbjogc3RyaW5nLCBzb3J0Q29uZGl0aW9uOiBzdHJpbmcsIGluY2x1ZGVDaGlsZERhdGE6IGJvb2xlYW4gPSB0cnVlKSB7XHJcbiAgICBjb25zdCBlbnRyeUZpbHRlciA9IHsgJ2lzVXNlUGFnaW5hdGlvbic6IGZhbHNlLCAnZmlsdGVyQ29uZGl0aW9ucyc6IFtdLCAnc29ydENvbmRpdGlvbnMnOiBbXSwgJ3BhZ2luYXRpb24nOiBudWxsIH07XHJcbiAgICBpZiAoZmlsdGVyQ29uZGl0aW9uKSB7XHJcbiAgICAgIC8vIOe7n+S4gOe6oOato+acgOWQjuS4gOS4qui/h+a7pOadoeS7tueahFJlbGF0aW9uXHJcbiAgICAgIGNvbnN0IGZpbHRlcnMgPSBKU09OLnBhcnNlKGZpbHRlckNvbmRpdGlvbik7XHJcbiAgICAgIGlmIChmaWx0ZXJzICYmIGZpbHRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGZpbHRlcnNbZmlsdGVycy5sZW5ndGggLSAxXS5SZWxhdGlvbiA9IDA7XHJcbiAgICAgIH1cclxuICAgICAgZW50cnlGaWx0ZXIuZmlsdGVyQ29uZGl0aW9ucyA9IGZpbHRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNvcnRDb25kaXRpb24pIHtcclxuICAgICAgZW50cnlGaWx0ZXIuc29ydENvbmRpdGlvbnMgPSBKU09OLnBhcnNlKHNvcnRDb25kaXRpb24pO1xyXG4gICAgfVxyXG4gICAgLy8gc2ZvOlNvdXJjZUZpbHRlck9wdGlvbnNcclxuICAgIGNvbnN0IHNvdXJjZUZpbHRlck9wdGlvbnM6IFNvdXJjZUZpbHRlck9wdGlvbnMgPSB0aGlzLmJ1aWxkU291cmNlRmlsdGVyT3B0aW9ucyh7IHNvdXJjZUlkOiBiZU1ldGFJZCwgZW50cnlGaWx0ZXIsIGluY2x1ZGVDaGlsZERhdGEgfSk7XHJcbiAgICBjb25zdCBvdXRwdXRPcHRpb25zOiBPdXRwdXRPcHRpb25zID0gdGhpcy5idWlsZE91dHB1dE9wdGlvbnMoKTtcclxuICAgIHJldHVybiB0aGlzLnByaW50U2VydmljZS5vdXRwdXRCRURhdGFXaXRoRmlsdGVyKHNvdXJjZUZpbHRlck9wdGlvbnMsIG91dHB1dE9wdGlvbnMsICd0YWInKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5oyJ54WnQkXlj5bmlbDmlrnlvI/mibnph4/miZPljbDljZXmja4o5bim57u05bqmKVxyXG4gICAqIEBwYXJhbSBiZU1ldGFJZCBCReWFg+aVsOaNruagh+ivhlxyXG4gICAqIEBwYXJhbSBmaWx0ZXJDb25kaXRpb24g6L+H5ruk5p2h5Lu2XHJcbiAgICogQHBhcmFtIHNvcnRDb25kaXRpb24g5o6S5bqP5p2h5Lu2XHJcbiAgICogQHBhcmFtIGRpbTEg57u05bqmMXZhbHVlXHJcbiAgICogQHBhcmFtIGRpbTIg57u05bqmMnZhbHVlXHJcbiAgICogQHBhcmFtIGJpbGxDYXRlZ29yeUlkIOS4muWKoeWNleaNruexu+Wei0lkXHJcbiAgICogQHBhcmFtIGluY2x1ZGVDaGlsZERhdGEg5YyF5ZCr5a2Q6KGo5pWw5o2uXHJcbiAgICovXHJcbiAgcHVibGljIHByaW50TXVsdGlXaXRoRGltZW5zaW9uKGJlTWV0YUlkOiBzdHJpbmcsIGZpbHRlckNvbmRpdGlvbjogc3RyaW5nLCBzb3J0Q29uZGl0aW9uOiBzdHJpbmcsIGRpbTE6IHN0cmluZywgZGltMjogc3RyaW5nLCBiaWxsQ2F0ZWdvcnlJZD86IHN0cmluZywgaW5jbHVkZUNoaWxkRGF0YTogYm9vbGVhbiA9IHRydWUpIHtcclxuICAgIGNvbnN0IGVudHJ5RmlsdGVyID0geyAnaXNVc2VQYWdpbmF0aW9uJzogZmFsc2UsICdmaWx0ZXJDb25kaXRpb25zJzogW10sICdzb3J0Q29uZGl0aW9ucyc6IFtdLCAncGFnaW5hdGlvbic6IG51bGwgfTtcclxuICAgIGlmIChmaWx0ZXJDb25kaXRpb24pIHtcclxuICAgICAgLy8g57uf5LiA57qg5q2j5pyA5ZCO5LiA5Liq6L+H5ruk5p2h5Lu255qEUmVsYXRpb25cclxuICAgICAgY29uc3QgZmlsdGVycyA9IEpTT04ucGFyc2UoZmlsdGVyQ29uZGl0aW9uKTtcclxuICAgICAgaWYgKGZpbHRlcnMgJiYgZmlsdGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZmlsdGVyc1tmaWx0ZXJzLmxlbmd0aCAtIDFdLlJlbGF0aW9uID0gMDtcclxuICAgICAgfVxyXG4gICAgICBlbnRyeUZpbHRlci5maWx0ZXJDb25kaXRpb25zID0gZmlsdGVycztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc29ydENvbmRpdGlvbikge1xyXG4gICAgICBlbnRyeUZpbHRlci5zb3J0Q29uZGl0aW9ucyA9IEpTT04ucGFyc2Uoc29ydENvbmRpdGlvbik7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzZm86IFNvdXJjZUZpbHRlck9wdGlvbnMgPSB0aGlzLmJ1aWxkU291cmNlRmlsdGVyT3B0aW9ucyh7IHNvdXJjZUlkOiBiZU1ldGFJZCwgZW50cnlGaWx0ZXIsIGluY2x1ZGVDaGlsZERhdGEgfSk7XHJcbiAgICBpZiAodHlwZW9mIGRpbTEgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHNmby5GaXJzdERpbWVuc2lvblZhbCA9IGRpbTE7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGRpbTIgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHNmby5TZWNvbmREaW1lbnNpb25WYWwgPSBkaW0yO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBiaWxsQ2F0ZWdvcnlJZCAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgc2ZvLmJpbGxDYXRlZ29yeUlkID0gYmlsbENhdGVnb3J5SWQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBvdXRwdXRPcHRpb25zOiBPdXRwdXRPcHRpb25zID0gdGhpcy5idWlsZE91dHB1dE9wdGlvbnMoKTtcclxuICAgIHJldHVybiB0aGlzLnByaW50U2VydmljZS5vdXRwdXRCRURhdGFXaXRoRmlsdGVyKHNmbywgb3V0cHV0T3B0aW9ucywgJ3RhYicpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKBTb3VyY2VPcHRpb25zXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRTb3VyY2VPcHRpb25zKG9wdGlvbnM6IHsgZGF0YUlkczogc3RyaW5nW10sIHNvdXJjZUlkOiBzdHJpbmcsIFtwcm9wOiBzdHJpbmddOiBhbnkgfSk6IFNvdXJjZU9wdGlvbnMge1xyXG4gICAgY29uc3Qgc286IFNvdXJjZU9wdGlvbnMgPSB7XHJcbiAgICAgIERhdGFJZHM6IG9wdGlvbnMgJiYgb3B0aW9ucy5kYXRhSWRzIHx8IHVuZGVmaW5lZCxcclxuICAgICAgU291cmNlSWQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5zb3VyY2VJZCB8fCB1bmRlZmluZWQsXHJcbiAgICAgIEZpcnN0RGltZW5zaW9uVmFsOiBvcHRpb25zICYmIG9wdGlvbnMuZGltMSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIFNlY29uZERpbWVuc2lvblZhbDogb3B0aW9ucyAmJiBvcHRpb25zLmRpbTIgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBSZXRyaWV2ZVBhcmFtOiBvcHRpb25zICYmIG9wdGlvbnMucmV0cmlldmVQYXJhbSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIEZvcm1hdElkOiBvcHRpb25zICYmIG9wdGlvbnMuZm9ybWF0SWQgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBiaWxsQ2F0ZWdvcnlJZDogb3B0aW9ucyAmJiBvcHRpb25zLmJpbGxDYXRlZ29yeUlkIHx8IHVuZGVmaW5lZCxcclxuICAgICAgU2VydmljZVVuaXQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5zZXJ2aWNlVW5pdCB8fCB1bmRlZmluZWQsXHJcbiAgICAgIGN1cnJlbnRQYWdlOiBvcHRpb25zICYmIG9wdGlvbnMuY3VycmVudFBhZ2UgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBwYWdlUm93Q291bnQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5wYWdlUm93Q291bnQgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBxdWVyeVR5cGU6IG9wdGlvbnMgJiYgb3B0aW9ucy5xdWVyeVR5cGUgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBxdWVyeVNlcnZpY2VJZDogb3B0aW9ucyAmJiBvcHRpb25zLnF1ZXJ5U2VydmljZUlkIHx8IHVuZGVmaW5lZCxcclxuICAgICAgcXVlcnlQYXJhbTogb3B0aW9ucyAmJiBvcHRpb25zLnF1ZXJ5UGFyYW0gfHwgdW5kZWZpbmVkXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHNvO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKBPdXRwdXRPcHRpb25zXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRPdXRwdXRPcHRpb25zKG9wdGlvbnM/OiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSk6IE91dHB1dE9wdGlvbnMge1xyXG4gICAgY29uc3Qgb286IE91dHB1dE9wdGlvbnMgPSB7XHJcbiAgICAgIE91dHB1dFR5cGU6IG9wdGlvbnMgJiYgb3B0aW9ucy5vdXRwdXRUeXBlIHx8IE91dHB1dFR5cGUuUFJJTlQsXHJcbiAgICAgIEZpbGVUeXBlOiBvcHRpb25zICYmIG9wdGlvbnMuZmlsZVR5cGUgfHwgRmlsZVR5cGUuSHRtbDUsXHJcbiAgICAgIFBhdGg6IG9wdGlvbnMgJiYgb3B0aW9ucy5wYXRoIHx8IHVuZGVmaW5lZCxcclxuICAgICAgRGV2aWNlSWQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5kZXZpY2VJZCB8fCB1bmRlZmluZWQsXHJcbiAgICAgIHByaW50Sm9iOiBvcHRpb25zICYmIG9wdGlvbnMucHJpbnRKb2IgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBwcmludGVyTmFtZTogb3B0aW9ucyAmJiBvcHRpb25zLnByaW50ZXJOYW1lIHx8IHVuZGVmaW5lZCxcclxuICAgICAgcHJpbnRTZXR0aW5nOiBvcHRpb25zICYmIG9wdGlvbnMucHJpbnRTZXR0aW5nIHx8IHVuZGVmaW5lZCxcclxuICAgICAgcHJpbnRUeXBlOiBvcHRpb25zICYmIG9wdGlvbnMucHJpbnRUeXBlIHx8IFByaW50VHlwZS5Gb3JtXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG9vO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDmnoTpgKBTb3VyY2VGaWx0ZXJPcHRpb25zXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGRTb3VyY2VGaWx0ZXJPcHRpb25zKG9wdGlvbnM6IHsgc291cmNlSWQ6IHN0cmluZywgW3Byb3A6IHN0cmluZ106IGFueSB9KTogU291cmNlRmlsdGVyT3B0aW9ucyB7XHJcbiAgICBjb25zdCBlbnRyeUZpbHRlciA9IHsgJ2lzVXNlUGFnaW5hdGlvbic6IGZhbHNlLCAnZmlsdGVyQ29uZGl0aW9ucyc6IFtdLCAnc29ydENvbmRpdGlvbnMnOiBbXSwgJ3BhZ2luYXRpb24nOiBudWxsIH07XHJcbiAgICBjb25zdCBzZm86IFNvdXJjZUZpbHRlck9wdGlvbnMgJiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSA9IHtcclxuICAgICAgU291cmNlSWQ6IG9wdGlvbnMuc291cmNlSWQsXHJcbiAgICAgIEVudGl0eUZpbHRlcjogb3B0aW9ucyAmJiBvcHRpb25zLmVudHJ5RmlsdGVyIHx8IGVudHJ5RmlsdGVyLFxyXG4gICAgICBGaXJzdERpbWVuc2lvblZhbDogb3B0aW9ucyAmJiBvcHRpb25zLmRpbTEgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBTZWNvbmREaW1lbnNpb25WYWw6IG9wdGlvbnMgJiYgb3B0aW9ucy5kaW0yIHx8IHVuZGVmaW5lZCxcclxuICAgICAgRm9ybWF0SWQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5mb3JtYXRJZCB8fCB1bmRlZmluZWQsXHJcbiAgICAgIFNlcnZpY2VVbml0OiBvcHRpb25zICYmIG9wdGlvbnMuc2VydmljZVVuaXQgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBiaWxsQ2F0ZWdvcnlJZDogb3B0aW9ucyAmJiBvcHRpb25zLmJpbGxDYXRlZ29yeUlkIHx8IHVuZGVmaW5lZCxcclxuICAgICAgY3VycmVudFBhZ2U6IG9wdGlvbnMgJiYgb3B0aW9ucy5jdXJyZW50UGFnZSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIHBhZ2VSb3dDb3VudDogb3B0aW9ucyAmJiBvcHRpb25zLnBhZ2VSb3dDb3VudCB8fCB1bmRlZmluZWQsXHJcbiAgICAgIHF1ZXJ5UGFyYW06IG9wdGlvbnMgJiYgb3B0aW9ucy5xdWVyeVBhcmFtIHx8IHVuZGVmaW5lZCxcclxuICAgICAgcXVlcnlTZXJ2aWNlSWQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5xdWVyeVNlcnZpY2VJZCB8fCB1bmRlZmluZWQsXHJcbiAgICAgIHF1ZXJ5VHlwZTogb3B0aW9ucyAmJiBvcHRpb25zLnF1ZXJ5VHlwZSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIGluY2x1ZGVDaGlsZERhdGE6IG9wdGlvbnMgJiYgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnaW5jbHVkZUNoaWxkRGF0YScpID8gb3B0aW9ucy5pbmNsdWRlQ2hpbGREYXRhIDogdHJ1ZVxyXG4gICAgfTtcclxuICAgIHJldHVybiBzZm87XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWxleekuumUmeivr+a2iOaBr1xyXG4gICAqIEBwYXJhbSBtZXNzYWdlIOmUmeivr+a2iOaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd1dhcm5pbmcobWVzc2FnZTogc3RyaW5nKSB7XHJcbiAgICBpZiAodGhpcy5ub3RpZnlTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKG1lc3NhZ2UsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLm1zZ1NlcnZpY2UpIHtcclxuICAgICAgdGhpcy5tc2dTZXJ2aWNlLmVycm9yKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGdldCBub3RpZnlTZXJ2aWNlKCk6IEZvcm1Ob3RpZnlTZXJ2aWNlIHwgbnVsbCB7XHJcbiAgICBpZiAodGhpcy5mb3JtTm90aWZ5U2VydmljZSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5mb3JtTm90aWZ5U2VydmljZTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5pbmplY3Rvcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5pbmplY3Rvci5nZXQ8Rm9ybU5vdGlmeVNlcnZpY2U+KEZvcm1Ob3RpZnlTZXJ2aWNlLCBudWxsKTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBjb21tYW5kQ29udGV4dCgpOiBDb21tYW5kQ29udGV4dCB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXNbJ2NvbnRleHQnXSB8fCBudWxsO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBmcmFtZUNvbnRleHQoKTogRnJhbWVDb250ZXh0IHwgbnVsbCB7XHJcbiAgICByZXR1cm4gdGhpcy5jb21tYW5kQ29udGV4dCAmJiB0aGlzLmNvbW1hbmRDb250ZXh0LmZyYW1lQ29udGV4dCB8fCBudWxsO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBpbmplY3RvcigpOiBJbmplY3RvciB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0ICYmIHRoaXMuZnJhbWVDb250ZXh0LmluamVjdG9yIHx8IG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBQcmludFNlcnZpY2UgfTtcclxuIl19
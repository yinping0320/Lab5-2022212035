import { Injectable } from "@angular/core";
var WorkFlowMessageService = /** @class */ (function () {
    function WorkFlowMessageService() {
        this.messageHandler = function (callback) {
            return function (event) {
                var message = event.data;
                if (message) {
                    message.sender = event.source;
                }
                if (typeof callback === 'function') {
                    callback(message);
                }
            };
        };
    }
    /**
     * 监听工作流消息
     * @param callback 回调
     */
    WorkFlowMessageService.prototype.listen = function (callback) {
        this.handler = this.messageHandler(callback);
        window.addEventListener('message', this.handler);
    };
    WorkFlowMessageService.prototype.destroy = function () {
        if (this.handler) {
            window.removeEventListener('message', this.handler);
        }
    };
    /**
     * 给工作流表单发送消息
     * @param message
     */
    WorkFlowMessageService.prototype.send = function (message) {
        if (!message) {
            return;
        }
        var win = window;
        if (message.target) {
            win = message.target || window;
            delete message.target;
        }
        if (win) {
            win.postMessage(message, '*');
        }
    };
    WorkFlowMessageService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    WorkFlowMessageService.ctorParameters = function () { return []; };
    return WorkFlowMessageService;
}());
export { WorkFlowMessageService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29yay1mbG93LW1lc3NhZ2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi93b3JrLWZsb3cvd29yay1mbG93LW1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzNDO0lBSUU7UUFDRSxJQUFJLENBQUMsY0FBYyxHQUFHLFVBQUMsUUFBd0M7WUFDN0QsT0FBTyxVQUFDLEtBQVU7Z0JBQ2hCLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUF5QixDQUFDO2dCQUM5QyxJQUFJLE9BQU8sRUFBRTtvQkFDWCxPQUFPLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7aUJBQy9CO2dCQUNELElBQUksT0FBTyxRQUFRLEtBQUssVUFBVSxFQUFFO29CQUNsQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQ25CO1lBQ0gsQ0FBQyxDQUFBO1FBQ0gsQ0FBQyxDQUFBO0lBQ0gsQ0FBQztJQUNEOzs7T0FHRztJQUNJLHVDQUFNLEdBQWIsVUFBYyxRQUF3QztRQUNwRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDN0MsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUNNLHdDQUFPLEdBQWQ7UUFDRSxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDaEIsTUFBTSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDckQ7SUFFSCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0kscUNBQUksR0FBWCxVQUFZLE9BQTBCO1FBQ3BDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixPQUFPO1NBQ1I7UUFDRCxJQUFJLEdBQUcsR0FBVyxNQUFNLENBQUM7UUFDekIsSUFBSSxPQUFPLENBQUMsTUFBTSxFQUFFO1lBQ2xCLEdBQUcsR0FBRyxPQUFPLENBQUMsTUFBZ0IsSUFBSSxNQUFNLENBQUM7WUFDekMsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxHQUFHLEVBQUU7WUFDUCxHQUFHLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztTQUMvQjtJQUNILENBQUM7O2dCQS9DRixVQUFVOzs7O0lBZ0RYLDZCQUFDO0NBQUEsQUFoREQsSUFnREM7U0EvQ1ksc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFdvcmtGbG93IH0gZnJvbSBcIi4vdHlwZXNcIjtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFdvcmtGbG93TWVzc2FnZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgbWVzc2FnZUhhbmRsZXI6IChjYWxsYmFjazogKGU6IFdvcmtGbG93LklNZXNzYWdlKSA9PiB2b2lkKSA9PiAoZXZlbnQ6IGFueSkgPT4gdm9pZDtcclxuICBwcml2YXRlIGhhbmRsZXI6IChldmVudDogYW55KSA9PiB2b2lkO1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlciA9IChjYWxsYmFjazogKGU6IFdvcmtGbG93LklNZXNzYWdlKSA9PiB2b2lkKSA9PiB7XHJcbiAgICAgIHJldHVybiAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgIHZhciBtZXNzYWdlID0gZXZlbnQuZGF0YSBhcyBXb3JrRmxvdy5JTWVzc2FnZTtcclxuICAgICAgICBpZiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgbWVzc2FnZS5zZW5kZXIgPSBldmVudC5zb3VyY2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDnm5HlkKzlt6XkvZzmtYHmtojmga9cclxuICAgKiBAcGFyYW0gY2FsbGJhY2sg5Zue6LCDXHJcbiAgICovXHJcbiAgcHVibGljIGxpc3RlbihjYWxsYmFjazogKGU6IFdvcmtGbG93LklNZXNzYWdlKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLmhhbmRsZXIgPSB0aGlzLm1lc3NhZ2VIYW5kbGVyKGNhbGxiYWNrKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5oYW5kbGVyKTtcclxuICB9XHJcbiAgcHVibGljIGRlc3Ryb3koKSB7XHJcbiAgICBpZiAodGhpcy5oYW5kbGVyKSB7XHJcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5oYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOe7meW3peS9nOa1geihqOWNleWPkemAgea2iOaBr1xyXG4gICAqIEBwYXJhbSBtZXNzYWdlIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZW5kKG1lc3NhZ2U6IFdvcmtGbG93LklNZXNzYWdlKTogdm9pZCB7XHJcbiAgICBpZiAoIW1lc3NhZ2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHdpbjogV2luZG93ID0gd2luZG93O1xyXG4gICAgaWYgKG1lc3NhZ2UudGFyZ2V0KSB7XHJcbiAgICAgIHdpbiA9IG1lc3NhZ2UudGFyZ2V0IGFzIFdpbmRvdyB8fCB3aW5kb3c7XHJcbiAgICAgIGRlbGV0ZSBtZXNzYWdlLnRhcmdldDtcclxuICAgIH1cclxuICAgIGlmICh3aW4pIHtcclxuICAgICAgd2luLnBvc3RNZXNzYWdlKG1lc3NhZ2UsICcqJyk7XHJcbiAgICB9XHJcbiAgfVxyXG59Il19
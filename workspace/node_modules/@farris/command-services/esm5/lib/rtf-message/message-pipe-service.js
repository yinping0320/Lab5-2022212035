import { MessagePipe } from './message-pipe';
import { RuntimeFrameworkService } from '../rtf-service';
import { QuerystringService } from '../querystring';
var MessagePipeService = /** @class */ (function () {
    function MessagePipeService() {
    }
    /**
     * 通过token获取消息管道
     * @param token 消息管道标识
     */
    MessagePipeService.get = function (token) {
        var pipe = new MessagePipe(token, this.rtfService);
        return pipe;
    };
    /**
     * 创建消息管道
     * @param pipeName 管道名称
     * @param useFormContext 是否使用表单上下文创建管道标识
     * @param pipeType 管道类型(可选)，默认Subject<any>
     */
    MessagePipeService.create = function (pipeName, useFormContext, pipeType) {
        var options = null;
        if (useFormContext) {
            var params = this.querystringService.parse(window.location.hash);
            var funcId = params.funcId, appId = params.appId, appEntrance = params.appEntrance;
            options = { funcId: funcId, appId: appId, appEntrance: appEntrance };
        }
        var token = this.rtfService.subjectRegister(pipeName, options, pipeType);
        if (!token) {
            return null;
        }
        var pipe = new MessagePipe(token, this.rtfService);
        return pipe;
    };
    MessagePipeService.rtfService = new RuntimeFrameworkService();
    MessagePipeService.querystringService = new QuerystringService();
    return MessagePipeService;
}());
export { MessagePipeService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS1waXBlLXNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvcnRmLW1lc3NhZ2UvbWVzc2FnZS1waXBlLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXpELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXBEO0lBQUE7SUErQkEsQ0FBQztJQTVCQzs7O09BR0c7SUFDVyxzQkFBRyxHQUFqQixVQUFrQixLQUFhO1FBQzdCLElBQU0sSUFBSSxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Q7Ozs7O09BS0c7SUFDVyx5QkFBTSxHQUFwQixVQUFxQixRQUFnQixFQUFFLGNBQXVCLEVBQUUsUUFBdUI7UUFDckYsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ25CLElBQUksY0FBYyxFQUFFO1lBQ2xCLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzRCxJQUFBLHNCQUFNLEVBQUUsb0JBQUssRUFBRSxnQ0FBVyxDQUFZO1lBQzlDLE9BQU8sR0FBRyxFQUFFLE1BQU0sUUFBQSxFQUFFLEtBQUssT0FBQSxFQUFFLFdBQVcsYUFBQSxFQUFFLENBQUM7U0FDMUM7UUFDRCxJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzNFLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsSUFBTSxJQUFJLEdBQUcsSUFBSSxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUE3QmMsNkJBQVUsR0FBNEIsSUFBSSx1QkFBdUIsRUFBRSxDQUFDO0lBQ3BFLHFDQUFrQixHQUF1QixJQUFJLGtCQUFrQixFQUFFLENBQUM7SUE2Qm5GLHlCQUFDO0NBQUEsQUEvQkQsSUErQkM7U0EvQlksa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWVzc2FnZVBpcGUgfSBmcm9tICcuL21lc3NhZ2UtcGlwZSc7XHJcbmltcG9ydCB7IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlIH0gZnJvbSAnLi4vcnRmLXNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFF1ZXJ5c3RyaW5nU2VydmljZSB9IGZyb20gJy4uL3F1ZXJ5c3RyaW5nJztcclxuXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlUGlwZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgc3RhdGljIHJ0ZlNlcnZpY2U6IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlID0gbmV3IFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlKCk7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgcXVlcnlzdHJpbmdTZXJ2aWNlOiBRdWVyeXN0cmluZ1NlcnZpY2UgPSBuZXcgUXVlcnlzdHJpbmdTZXJ2aWNlKCk7XHJcbiAgLyoqXHJcbiAgICog6YCa6L+HdG9rZW7ojrflj5bmtojmga/nrqHpgZNcclxuICAgKiBAcGFyYW0gdG9rZW4g5raI5oGv566h6YGT5qCH6K+GXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZXQodG9rZW46IHN0cmluZyk6IE1lc3NhZ2VQaXBlIHtcclxuICAgIGNvbnN0IHBpcGUgPSBuZXcgTWVzc2FnZVBpcGUodG9rZW4sIHRoaXMucnRmU2VydmljZSk7XHJcbiAgICByZXR1cm4gcGlwZTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yib5bu65raI5oGv566h6YGTXHJcbiAgICogQHBhcmFtIHBpcGVOYW1lIOeuoemBk+WQjeensFxyXG4gICAqIEBwYXJhbSB1c2VGb3JtQ29udGV4dCDmmK/lkKbkvb/nlKjooajljZXkuIrkuIvmlofliJvlu7rnrqHpgZPmoIfor4ZcclxuICAgKiBAcGFyYW0gcGlwZVR5cGUg566h6YGT57G75Z6LKOWPr+mAiSnvvIzpu5jorqRTdWJqZWN0PGFueT5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZShwaXBlTmFtZTogc3RyaW5nLCB1c2VGb3JtQ29udGV4dDogYm9vbGVhbiwgcGlwZVR5cGU/OiBTdWJqZWN0PGFueT4pOiBNZXNzYWdlUGlwZSB7XHJcbiAgICBsZXQgb3B0aW9ucyA9IG51bGw7XHJcbiAgICBpZiAodXNlRm9ybUNvbnRleHQpIHtcclxuICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5xdWVyeXN0cmluZ1NlcnZpY2UucGFyc2Uod2luZG93LmxvY2F0aW9uLmhhc2gpO1xyXG4gICAgICBjb25zdCB7IGZ1bmNJZCwgYXBwSWQsIGFwcEVudHJhbmNlIH0gPSBwYXJhbXM7XHJcbiAgICAgIG9wdGlvbnMgPSB7IGZ1bmNJZCwgYXBwSWQsIGFwcEVudHJhbmNlIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b2tlbiA9IHRoaXMucnRmU2VydmljZS5zdWJqZWN0UmVnaXN0ZXIocGlwZU5hbWUsIG9wdGlvbnMsIHBpcGVUeXBlKTtcclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwaXBlID0gbmV3IE1lc3NhZ2VQaXBlKHRva2VuLCB0aGlzLnJ0ZlNlcnZpY2UpO1xyXG4gICAgcmV0dXJuIHBpcGU7XHJcbiAgfVxyXG59XHJcbiJdfQ==
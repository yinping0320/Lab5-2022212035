import * as tslib_1 from "tslib";
import { Injectable, Optional } from '@angular/core';
import { of, empty, EMPTY } from 'rxjs';
import { tap, switchMap, concatMap } from 'rxjs/operators';
import { FrameContext, FieldMetadataUtil } from '@farris/devkit';
import { FormLoadingService } from '../form-loading/form-loading.service';
import { FormNotifyService } from '../form-notify.service';
import { LanguageService } from '../languag.service';
import { FormMessageService } from '../form-message.service';
import { FormErrorService } from '../error/form-error.service';
import { BaseDataService } from './base-data.service';
import { TreeUtilFactory } from './tree-table/util/tree-util-factory';
import { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';
import { DataChangeDetectionService } from '../data-change-detection.service';
// tslint:disable: no-string-literal
/**
 * 树数据服务
 */
var TreeDataService = /** @class */ (function (_super) {
    tslib_1.__extends(TreeDataService, _super);
    /**
     * 构造函数
     */
    function TreeDataService(frameContext, messageService, loadingService, notifyService, errorService, languageService) {
        var _this = _super.call(this, frameContext) || this;
        _this.messageService = messageService;
        _this.loadingService = loadingService;
        _this.notifyService = notifyService;
        _this.errorService = errorService;
        _this.languageService = languageService;
        if (!languageService) {
            _this.languageService = LanguageService.getInstance();
        }
        return _this;
    }
    Object.defineProperty(TreeDataService.prototype, "hierarchyInfoKey", {
        /**
         * 分级信息字段名
         */
        get: function () {
            return this.virtualRootFrameContext.getParam('hierarchyInfoKey');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "virtualRootFrameContext", {
        get: function () {
            return this.frameContext.getVirtualRootFrameContext();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * 加载数据
     */
    TreeDataService.prototype.load = function (filters, sorts) {
        var _this = this;
        var filtersArray = this.parseConditions(filters);
        var sortsArray = this.parseConditions(sorts);
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var query$ = this.repository.getEntities(filtersArray, sortsArray, null, null);
        return query$.pipe(tap(function () {
            // 纠正选中节点
            if (correctSelectedNode === true) {
                var hierarchyType = _this.getHierarchyType();
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 分层加载数据
     */
    TreeDataService.prototype.loadByLevel = function (filters, sorts, frozenCurrentRow) {
        var _this = this;
        this.setLoadByLevelState(filters, sorts);
        var filtersArray = this.parseConditions(filters);
        var sortsArray = this.parseConditions(sorts);
        // const parentId = this.bindingData.list.currentId;
        var parentId = this.getIdToExpand();
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        var hierarchyType = this.getHierarchyType();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return empty();
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 构造分页信息
        var pagination = this.buildPaginationInfo(parentId);
        var reload = this.frameContext.params.get('_RELOAD_CHILDREN_') || false;
        var query$ = repository.loadByParentId(this.repository, this.hierarchyInfoKey, parentId, filtersArray, sortsArray, frozenCurrentRow, pagination, this.frameContext, reload);
        return query$.pipe(tap(function (entities) {
            _this.frameContext.params.delete('_RELOAD_CHILDREN_');
            // 纠正选中节点
            if (correctSelectedNode === true) {
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                }
            }
            var currentRowId = _this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                var containsCurrentRow = entities.find(function (item) { return item.primaryValue === currentRowId; });
                if (containsCurrentRow) {
                    _this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!_this.repository.entityCollection.getEntityById(currentRowId)) {
                    var firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        _this.setCurrentId(firstChildId);
                    }
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 加载完整树
     * @param virtualPropertyName 虚拟字段
     * @param fullTreeType 是否是完整树加载 0：完整树 1：部分树
     * @param loadType 是否分级加载 0：全部加载 1：分级加载
     * @param filter 过滤条件
     * @param frozenCurrentRow 冻结当前行
     */
    TreeDataService.prototype.loadFullTree = function (virtualPropertyName, fullTreeType, loadType, filters, frozenCurrentRow) {
        var _this = this;
        if (typeof fullTreeType !== 'string') {
            throw new Error('ArgumentError: fullTreeType 不能为空且必须为字符串。');
        }
        if (typeof loadType !== 'string') {
            throw new Error('ArgumentError: loadType 不能为空且必须为字符串。');
        }
        if (frozenCurrentRow === undefined) {
            frozenCurrentRow = false;
        }
        if (typeof frozenCurrentRow !== 'boolean') {
            frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;
        }
        var virtualRootFrameContext = this.virtualRootFrameContext;
        // 还原上次设置的结果集
        virtualRootFrameContext.params.delete('_DEVKIT_expandRowIds');
        virtualRootFrameContext.params.delete('_DEVKIT_selectedRowId');
        virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', null);
        var filtersArray = this.parseConditions(filters);
        var parentId = this.getIdToExpand();
        var correctSelectedNode = this.repository.entityCollection.count() === 0;
        var hierarchyType = this.getHierarchyType();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (repository === null) {
            return EMPTY;
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var context = {
            frameContext: this.frameContext,
            frozenCurrentRow: frozenCurrentRow
        };
        // tslint:disable-next-line: max-line-length
        var query$ = repository.loadFullTree(this.repository, this.hierarchyInfoKey, parentId, virtualPropertyName, fullTreeType, loadType, filtersArray, context);
        return query$.pipe(tap(function (entities) {
            var selectedRowId = virtualRootFrameContext.params.get('_DEVKIT_selectedRowId');
            // 纠正选中节点
            if (correctSelectedNode === true || !selectedRowId) {
                var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
                if (treeNodeUtil !== null) {
                    var computedFirstRowId = treeNodeUtil.selectFirstRootNode(_this.bindingData, _this.hierarchyInfoKey);
                    if (computedFirstRowId) {
                        virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', computedFirstRowId);
                    }
                }
            }
            var currentRowId = _this.bindingData.list.currentItem.primaryKeyValue;
            if (frozenCurrentRow) {
                // 如果上一次选中行为本次加载数据中的一条，则应该重新选中该行
                var containsCurrentRow = entities.find(function (item) { return item.primaryValue === currentRowId; });
                if (containsCurrentRow) {
                    _this.setCurrentId(currentRowId);
                }
                // 原来的当前行不在已经加载的数据中，如展开到第三级，将第三级的某行设为当前行，全部收起，展开第一级
                if (!_this.repository.entityCollection.getEntityById(currentRowId) && entities && entities.length > 0) {
                    var firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;
                    if (firstChildId) {
                        _this.setCurrentId(firstChildId);
                    }
                }
            }
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.loadFailed, error);
        }));
    };
    /**
     * 获取最新展开的节点
     */
    TreeDataService.prototype.getIdToExpand = function () {
        var expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        var idToExpand = expandNodes.pop();
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
        return idToExpand;
    };
    /**
     * 设置最新展开的节点
     */
    TreeDataService.prototype.setIdToExpand = function (idToExpand) {
        var expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];
        expandNodes.push(idToExpand);
        this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);
    };
    /**
     * 解析过滤条件
     */
    TreeDataService.prototype.parseConditions = function (conditions) {
        var conditionsString = (!conditions || conditions === '') ? '[]' : conditions;
        return JSON.parse(conditionsString);
    };
    /**
     * 新增同级
     */
    TreeDataService.prototype.addSibling = function (id) {
        var _this = this;
        // 设计时id的获取改为从命令参数上获取，但设计时没有参数必填检查，
        // 如果打开表单保存了（即更新了最新的命令构件），但没有配置该参数，可能会传递过来一个空值，
        // 为了兼容此情况，使用当前行id作为id的值
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id || id === 'undefined') {
            id = '';
        }
        // 记录最近一次修改的数据id
        var lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        var hierarchyType = this.getHierarchyType();
        // 执行取数
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            // 错误的分级码
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        var result$ = repository.addSibling(this.repository, id);
        return result$.pipe(tap(function () {
            _this.virtualRootFrameContext.setParam('IS_ADD', true);
            _this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.addSiblingFailed, error);
        }));
    };
    /**
     * 新增下级
     */
    TreeDataService.prototype.addChild = function (id) {
        var _this = this;
        // 原因同addSibling的修改
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            // 请选择父节点
            this.notifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });
            return empty();
        }
        // 记录最近一次修改的数据id
        var lastModifiedId = this.bindingData.list.currentId;
        // 获取分级方式
        var hierarchyType = this.getHierarchyType();
        // 执行取数
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        // 新增的时候，要展开父节点
        this.setIdToExpand(id);
        var reloadChild$ = this.reloadByLevel();
        var repository = TreeRepositoryFactory.getInstance(hierarchyType);
        if (!repository) {
            throw new Error(this.languageService['errorHierarchyKey']);
        }
        var addChild$ = repository.addChild(this.repository, id);
        var result$ = reloadChild$.pipe(switchMap(function () {
            return addChild$;
        }), tap(function () {
            _this.virtualRootFrameContext.setParam('IS_ADD', true);
            _this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.addChildFailed, error);
        }));
        return result$;
    };
    /**
     * 批量保存
     */
    TreeDataService.prototype.save = function () {
        var _this = this;
        if (this.messagePipe) {
            this.messagePipe.next({ messageType: 'save' });
        }
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var save$ = this.repository.applyChanges();
        var result$ = save$.pipe(tap(function () {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.notifyService.success(_this.languageService.saveSuccess, { hideTitle: true });
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.multiSaveFailed, error);
        }));
        return result$;
    };
    /**
     * 删除
     */
    TreeDataService.prototype.remove = function (id, successMsg) {
        var _this = this;
        // 原因同addSibling
        id = id ? id : this.bindingData.list.currentId;
        // 参数检查
        if (!id) {
            this.notifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });
            return empty();
        }
        // 存在子节点不允许删除
        var treeNodesData = this.repository.entityCollection.toJSON();
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            return empty();
        }
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            this.notifyService.warning(this.languageService['deleteChildFirst'], { hideTitle: true });
            return empty();
        }
        // 确认删除
        var action$ = this.messageService.question(this.languageService.confirmDeletion);
        return action$.pipe(concatMap(function (result) {
            if (!result) {
                return empty();
            }
            // 获取删除后要设置的节点id
            var nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, _this.hierarchyInfoKey, id);
            // 执行删除
            var loadingTimerId = _this.loadingService.showLoadingWithDelay(500);
            var remove$ = _this.frameContext.repository.removeById(id);
            return remove$.pipe(tap(function () {
                // 设置选中节点
                treeNodeUtil.selectedNode(_this.bindingData, _this.hierarchyInfoKey, nextNodeId);
                _this.loadingService.hideDelayLoading(loadingTimerId);
                if (successMsg && successMsg.trim()) {
                    var showMessage = true;
                    if (successMsg.startsWith('{') && successMsg.endsWith('}')) {
                        try {
                            var options = JSON.parse(successMsg);
                            if (options.showMessage === false) {
                                showMessage = false;
                            }
                        }
                        catch (_a) { }
                    }
                    if (showMessage !== false) {
                        _this.notifyService.success(successMsg, { hideTitle: true });
                    }
                }
                else {
                    _this.notifyService.success(_this.languageService.deleteSuccess, { hideTitle: true });
                }
                // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });
            }, function (error) {
                _this.loadingService.hideDelayLoading(loadingTimerId);
                _this.errorService.exception(_this.languageService.deleteFailed, error);
            }));
        }));
    };
    /**
     * 取消时检测未保存记录
     */
    TreeDataService.prototype.cancel = function () {
        var _this = this;
        var hasChange$ = DataChangeDetectionService.hasChange(this.frameContext);
        return hasChange$.pipe(switchMap(function (changed) {
            if (!changed) {
                return _this._cancel();
            }
            else {
                return _this.messageService.question(_this.languageService['cancelWithoutSave']).pipe(switchMap(function (ifCancel) {
                    if (ifCancel === false) {
                        return EMPTY;
                    }
                    return _this._cancel();
                }));
            }
        }));
    };
    /**
     * 构造分页信息
     * @param parentId parentId
     * @returns
     */
    TreeDataService.prototype.buildPaginationInfo = function (parentId) {
        var pagination = { pageIndex: 0, pageSize: 0 };
        var enableNodePagination = this.frameContext.params.get('enableNodePagination');
        if (!parentId) {
            // 一级分页
            var pageSize = this.repository.entityCollection.pageSize || 0;
            var pageIndex = this.repository.entityCollection.pageIndex || 0;
            // 启用了一级分页
            if (pageSize !== 0) {
                pagination.pageSize = pageSize;
                pagination.pageIndex = pageIndex;
            }
        }
        else {
            // 如果未启用节点分页或当前为顶级节点加载，则不处理节点分页
            if (enableNodePagination) {
                var nodePageSize = this.frameContext.params.get('nodePageSize') || 0;
                var nodePageIndex = this.frameContext.params.get("_NODE_" + parentId + "_PAGE_INDEX_");
                if (!nodePageIndex) {
                    this.frameContext.params.set("_NODE_" + parentId + "_PAGE_INDEX_", 1);
                    nodePageIndex = 1;
                }
                pagination.pageIndex = nodePageIndex;
                pagination.pageSize = nodePageSize;
            }
        }
        return pagination;
    };
    /**
     * 取消变更
     */
    TreeDataService.prototype._cancel = function () {
        var _this = this;
        var loadingTimerId = this.loadingService.showLoadingWithDelay(500);
        var cancel$ = this.repository.cancelChanges();
        return cancel$.pipe(switchMap(function () {
            var isAdd = _this.virtualRootFrameContext.getParam('IS_ADD');
            var lastModifiedId = _this.virtualRootFrameContext.getParam('LAST_MODIFIED_ID');
            var currentId = _this.bindingData.list.currentId;
            if (isAdd === true) {
                _this.repository.entityCollection.removeEntityById(currentId);
                // 重置编辑状态
                _this.virtualRootFrameContext.setParam('IS_ADD', false);
                if (lastModifiedId) {
                    setTimeout(function () {
                        _this.bindingData.list.setCurrentId(lastModifiedId, true, true);
                    }, 0);
                }
                return of(null);
            }
            else {
                return _this.repository.updateById(currentId);
            }
        }), tap(function () {
            _this.loadingService.hideDelayLoading(loadingTimerId);
        }, function (error) {
            _this.loadingService.hideDelayLoading(loadingTimerId);
            _this.errorService.exception(_this.languageService.cancelFailed, error);
        }));
    };
    /**
     * 检查是否存在下级节点（内部方法，请勿使用）
     */
    TreeDataService.prototype.hasChildNodes = function (id, treeNodesData) {
        var treeNodeUtil = this.getTreeNodeUtil();
        if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {
            return true;
        }
        return false;
    };
    /**
     * 计算删除后的当前节点id（内部方法，请勿使用）
     */
    TreeDataService.prototype.getNextNodeIdAfterRemoving = function (idToRemove, treeNodesData) {
        var treeNodeUtil = this.getTreeNodeUtil();
        var nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, idToRemove);
        return nextNodeId;
    };
    /**
     * 设置删除后的当前节点节点（内部方法，请勿使用）
     */
    TreeDataService.prototype.setNextNodeAfterRemoving = function (nextNodeId) {
        var treeNodeUtil = this.getTreeNodeUtil();
        treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);
    };
    /**
     * 设置树的当前行(给完整树使用)
     * @param id id
     */
    TreeDataService.prototype.setCurrentId = function (id) {
        id = id || this.frameContext.getVirtualRootFrameContext().uiState['__DEVKIT__selectedRow'] || this.bindingData.list.currentItem.primaryKeyValue;
        this.frameContext.bindingData.list.setCurrentId(id, true, true, true);
    };
    /**
     * 选中树的第一个节点
     */
    TreeDataService.prototype.selectFirstRow = function () {
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil !== null) {
            treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);
        }
    };
    /**
     * 获取树节点工具类实例
     */
    TreeDataService.prototype.getTreeNodeUtil = function () {
        var hierarchyType = this.getHierarchyType();
        var treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);
        if (treeNodeUtil === null) {
            throw new Error("\u4E0D\u652F\u6301" + hierarchyType + "\u7C7B\u578B\u7684\u5206\u7EA7");
        }
        return treeNodeUtil;
    };
    /**
     * 记录加载状态
     * @todo：待删除
     */
    TreeDataService.prototype.setLoadByLevelState = function (filters, sorts) {
        // @todo：临时处理
        this.virtualRootFrameContext.setParam('isLoadTreeByLevel', true);
        this.virtualRootFrameContext.setParam('loadTreeByLevelFilter', filters);
        this.virtualRootFrameContext.setParam('loadTreeByLevelSort', sorts);
    };
    /**
     * 展开当前节点
     * @todo：待删除
     */
    TreeDataService.prototype.reloadByLevel = function () {
        var isLoadByLevel = this.virtualRootFrameContext.getParam('isLoadTreeByLevel');
        if (isLoadByLevel === true) {
            var filters = this.virtualRootFrameContext.getParam('loadTreeByLevelFilter');
            var sorts = this.virtualRootFrameContext.getParam('loadTreeByLevelSort');
            return this.loadByLevel(filters, sorts);
        }
        return of([]);
    };
    TreeDataService.prototype.getHierarchyType = function () {
        var ngObjects = FieldMetadataUtil.getNgObjects(this.repository.entityType);
        var hierarchyInfoNgObjectInfo = ngObjects[this.hierarchyInfoKey];
        var hierarchyType = 'path'; // 分级码默认为path，兼容原表单
        if (hierarchyInfoNgObjectInfo.hasOwnProperty('hierarchyType') && hierarchyInfoNgObjectInfo['hierarchyType'] != null) {
            hierarchyType = hierarchyInfoNgObjectInfo['hierarchyType'];
        }
        if (hierarchyType == null || hierarchyType.length < 1) {
            // '分级码配置信息错误'
            throw new Error(this.languageService['incorrectHierarchyConfig']);
        }
        return hierarchyType;
    };
    Object.defineProperty(TreeDataService.prototype, "messagePipe", {
        /**
         * 获取根组件消息管道
         */
        get: function () {
            if (this.frameContext) {
                var appContext = this.frameContext.getFormAppContext() || null;
                if (appContext) {
                    return appContext.messagePipe || null;
                }
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    TreeDataService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    TreeDataService.ctorParameters = function () { return [
        { type: FrameContext },
        { type: FormMessageService },
        { type: FormLoadingService },
        { type: FormNotifyService },
        { type: FormErrorService },
        { type: LanguageService, decorators: [{ type: Optional }] }
    ]; };
    return TreeDataService;
}(BaseDataService));
export { TreeDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy90cmVlLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFjLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNELE9BQU8sRUFBVSxZQUFZLEVBQUUsaUJBQWlCLEVBQW1CLE1BQU0sZ0JBQWdCLENBQUM7QUFHMUYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDMUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzdELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRS9ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDdEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0saURBQWlELENBQUM7QUFDeEYsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDOUUsb0NBQW9DO0FBRXBDOztHQUVHO0FBQ0g7SUFDOEIsMkNBQWU7SUFZM0M7O09BRUc7SUFDSCx5QkFDRSxZQUEwQixFQUNsQixjQUFrQyxFQUNsQyxjQUFrQyxFQUNsQyxhQUFn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QUFDO2dCQUNqRSxJQUFJLFVBQVUsRUFBRTtvQkFDZCxPQUFPLFVBQVUsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDO2lCQUN2QzthQUNGO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDOzs7T0FBQTs7Z0JBaG5CRixVQUFVOzs7O2dCQW5CTSxZQUFZO2dCQU1wQixrQkFBa0I7Z0JBSGxCLGtCQUFrQjtnQkFDbEIsaUJBQWlCO2dCQUdqQixnQkFBZ0I7Z0JBRmhCLGVBQWUsdUJBb0NuQixRQUFROztJQTJsQmIsc0JBQUM7Q0FBQSxBQWpuQkQsQ0FDOEIsZUFBZSxHQWduQjVDO0FBQ0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIGVtcHR5LCBFTVBUWSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YXAsIHN3aXRjaE1hcCwgY29uY2F0TWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgRW50aXR5LCBGcmFtZUNvbnRleHQsIEZpZWxkTWV0YWRhdGFVdGlsLCBOZ0ZpZWxkUHJvcGVydHkgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnksIEJlZlJlcG9zaXRvcnlVdGlsIH0gZnJvbSAnQGZhcnJpcy9iZWYnO1xyXG5cclxuaW1wb3J0IHsgRm9ybUxvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1sb2FkaW5nL2Zvcm0tbG9hZGluZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybU5vdGlmeVNlcnZpY2UgfSBmcm9tICcuLi9mb3JtLW5vdGlmeS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGFuZ3VhZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRm9ybU1lc3NhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vZm9ybS1tZXNzYWdlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtRXJyb3JTZXJ2aWNlIH0gZnJvbSAnLi4vZXJyb3IvZm9ybS1lcnJvci5zZXJ2aWNlJztcclxuXHJcbmltcG9ydCB7IEJhc2VEYXRhU2VydmljZSB9IGZyb20gJy4vYmFzZS1kYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBFZGl0U3RhdGVVdGlsIH0gZnJvbSAnLi91dGlscy9pbmRleCc7XHJcbmltcG9ydCB7IFRyZWVVdGlsRmFjdG9yeSB9IGZyb20gJy4vdHJlZS10YWJsZS91dGlsL3RyZWUtdXRpbC1mYWN0b3J5JztcclxuaW1wb3J0IHsgVHJlZVJlcG9zaXRvcnlGYWN0b3J5IH0gZnJvbSAnLi90cmVlLXRhYmxlL3JlcG9zaXRvcnkvdHJlZS1yZXBvc2l0b3J5LWZhY3RvcnknO1xyXG5pbXBvcnQgeyBEYXRhQ2hhbmdlRGV0ZWN0aW9uU2VydmljZSB9IGZyb20gJy4uL2RhdGEtY2hhbmdlLWRldGVjdGlvbi5zZXJ2aWNlJztcclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsXHJcblxyXG4vKipcclxuICog5qCR5pWw5o2u5pyN5YqhXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIFRyZWVEYXRhU2VydmljZSBleHRlbmRzIEJhc2VEYXRhU2VydmljZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhue6p+S/oeaBr+Wtl+auteWQjVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGhpZXJhcmNoeUluZm9LZXkoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdoaWVyYXJjaHlJbmZvS2V5Jyk7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZnJhbWVDb250ZXh0LmdldFZpcnR1YWxSb290RnJhbWVDb250ZXh0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnoTpgKDlh73mlbBcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlU2VydmljZTogRm9ybU1lc3NhZ2VTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsb2FkaW5nU2VydmljZTogRm9ybUxvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBGb3JtTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgZXJyb3JTZXJ2aWNlOiBGb3JtRXJyb3JTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZVxyXG4gICkge1xyXG4gICAgc3VwZXIoZnJhbWVDb250ZXh0KTtcclxuICAgIGlmICghbGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliqDovb3mlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgbG9hZChmaWx0ZXJzPzogc3RyaW5nLCBzb3J0cz86IHN0cmluZyk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIGNvbnN0IGZpbHRlcnNBcnJheSA9IHRoaXMucGFyc2VDb25kaXRpb25zKGZpbHRlcnMpO1xyXG4gICAgY29uc3Qgc29ydHNBcnJheSA9IHRoaXMucGFyc2VDb25kaXRpb25zKHNvcnRzKTtcclxuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xyXG5cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgcXVlcnkkID0gdGhpcy5yZXBvc2l0b3J5LmdldEVudGl0aWVzKGZpbHRlcnNBcnJheSwgc29ydHNBcnJheSwgbnVsbCwgbnVsbCk7XHJcbiAgICByZXR1cm4gcXVlcnkkLnBpcGUoXHJcbiAgICAgIHRhcChcclxuICAgICAgICAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgLy8g57qg5q2j6YCJ5Lit6IqC54K5XHJcbiAgICAgICAgICBpZiAoY29ycmVjdFNlbGVjdGVkTm9kZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgICAgICAgICAgaWYgKHRyZWVOb2RlVXRpbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RGaXJzdFJvb3ROb2RlKHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UubG9hZEZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIhuWxguWKoOi9veaVsOaNrlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2FkQnlMZXZlbChmaWx0ZXJzPzogc3RyaW5nLCBzb3J0cz86IHN0cmluZywgZnJvemVuQ3VycmVudFJvdz86IGJvb2xlYW4gfCBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eVtdPiB7XHJcbiAgICB0aGlzLnNldExvYWRCeUxldmVsU3RhdGUoZmlsdGVycywgc29ydHMpO1xyXG4gICAgY29uc3QgZmlsdGVyc0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoZmlsdGVycyk7XHJcbiAgICBjb25zdCBzb3J0c0FycmF5ID0gdGhpcy5wYXJzZUNvbmRpdGlvbnMoc29ydHMpO1xyXG4gICAgLy8gY29uc3QgcGFyZW50SWQgPSB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG4gICAgY29uc3QgcGFyZW50SWQgPSB0aGlzLmdldElkVG9FeHBhbmQoKTtcclxuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xyXG4gICAgaWYgKGZyb3plbkN1cnJlbnRSb3cgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBmcm96ZW5DdXJyZW50Um93ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGZyb3plbkN1cnJlbnRSb3cgIT09ICdib29sZWFuJykge1xyXG4gICAgICBmcm96ZW5DdXJyZW50Um93ID0gZnJvemVuQ3VycmVudFJvdyA9PT0gJ3RydWUnID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuXHJcbiAgICBpZiAocmVwb3NpdG9yeSA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgLy8g5p6E6YCg5YiG6aG15L+h5oGvXHJcbiAgICBjb25zdCBwYWdpbmF0aW9uID0gdGhpcy5idWlsZFBhZ2luYXRpb25JbmZvKHBhcmVudElkKTtcclxuICAgIGNvbnN0IHJlbG9hZCA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ19SRUxPQURfQ0hJTERSRU5fJykgfHwgZmFsc2U7XHJcbiAgICBjb25zdCBxdWVyeSQgPSByZXBvc2l0b3J5LmxvYWRCeVBhcmVudElkKHRoaXMucmVwb3NpdG9yeSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5LCBwYXJlbnRJZCwgZmlsdGVyc0FycmF5LCBzb3J0c0FycmF5LCBmcm96ZW5DdXJyZW50Um93LCBwYWdpbmF0aW9uLCB0aGlzLmZyYW1lQ29udGV4dCwgcmVsb2FkKTtcclxuICAgIHJldHVybiBxdWVyeSQucGlwZShcclxuICAgICAgdGFwKFxyXG4gICAgICAgIChlbnRpdGllczogRW50aXR5W10pID0+IHtcclxuICAgICAgICAgIHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19SRUxPQURfQ0hJTERSRU5fJyk7XHJcbiAgICAgICAgICAvLyDnuqDmraPpgInkuK3oioLngrlcclxuICAgICAgICAgIGlmIChjb3JyZWN0U2VsZWN0ZWROb2RlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgICAgICAgICAgaWYgKHRyZWVOb2RlVXRpbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHRyZWVOb2RlVXRpbC5zZWxlY3RGaXJzdFJvb3ROb2RlKHRoaXMuYmluZGluZ0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICBpZiAoZnJvemVuQ3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzkuIrkuIDmrKHpgInkuK3ooYzkuLrmnKzmrKHliqDovb3mlbDmja7kuK3nmoTkuIDmnaHvvIzliJnlupTor6Xph43mlrDpgInkuK3or6XooYxcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbnNDdXJyZW50Um93ID0gZW50aXRpZXMuZmluZChpdGVtID0+IGl0ZW0ucHJpbWFyeVZhbHVlID09PSBjdXJyZW50Um93SWQpO1xyXG4gICAgICAgICAgICBpZiAoY29udGFpbnNDdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDljp/mnaXnmoTlvZPliY3ooYzkuI3lnKjlt7Lnu4/liqDovb3nmoTmlbDmja7kuK3vvIzlpoLlsZXlvIDliLDnrKzkuInnuqfvvIzlsIbnrKzkuInnuqfnmoTmn5DooYzorr7kuLrlvZPliY3ooYzvvIzlhajpg6jmlLbotbfvvIzlsZXlvIDnrKzkuIDnuqdcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGN1cnJlbnRSb3dJZCkpIHtcclxuICAgICAgICAgICAgICBjb25zdCBmaXJzdENoaWxkSWQgPSBlbnRpdGllcyAmJiBBcnJheS5pc0FycmF5KGVudGl0aWVzKSAmJiBlbnRpdGllcy5sZW5ndGggPiAwICYmIGVudGl0aWVzWzBdLnByaW1hcnlWYWx1ZSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgIGlmIChmaXJzdENoaWxkSWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudElkKGZpcnN0Q2hpbGRJZCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxhbmd1YWdlU2VydmljZS5sb2FkRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliqDovb3lrozmlbTmoJFcclxuICAgKiBAcGFyYW0gdmlydHVhbFByb3BlcnR5TmFtZSDomZrmi5/lrZfmrrVcclxuICAgKiBAcGFyYW0gZnVsbFRyZWVUeXBlIOaYr+WQpuaYr+WujOaVtOagkeWKoOi9vSAw77ya5a6M5pW05qCRIDHvvJrpg6jliIbmoJFcclxuICAgKiBAcGFyYW0gbG9hZFR5cGUg5piv5ZCm5YiG57qn5Yqg6L29IDDvvJrlhajpg6jliqDovb0gMe+8muWIhue6p+WKoOi9vVxyXG4gICAqIEBwYXJhbSBmaWx0ZXIg6L+H5ruk5p2h5Lu2XHJcbiAgICogQHBhcmFtIGZyb3plbkN1cnJlbnRSb3cg5Ya757uT5b2T5YmN6KGMXHJcbiAgICovXHJcbiAgcHVibGljIGxvYWRGdWxsVHJlZSh2aXJ0dWFsUHJvcGVydHlOYW1lOiBzdHJpbmcsIGZ1bGxUcmVlVHlwZTogc3RyaW5nLCBsb2FkVHlwZTogc3RyaW5nLCBmaWx0ZXJzOiBzdHJpbmcsIGZyb3plbkN1cnJlbnRSb3c/OiBib29sZWFuIHwgc3RyaW5nKTogT2JzZXJ2YWJsZTxFbnRpdHlbXT4ge1xyXG4gICAgaWYgKHR5cGVvZiBmdWxsVHJlZVR5cGUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignQXJndW1lbnRFcnJvcjogZnVsbFRyZWVUeXBlIOS4jeiDveS4uuepuuS4lOW/hemhu+S4uuWtl+espuS4suOAgicpO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBsb2FkVHlwZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudEVycm9yOiBsb2FkVHlwZSDkuI3og73kuLrnqbrkuJTlv4XpobvkuLrlrZfnrKbkuLLjgIInKTtcclxuICAgIH1cclxuICAgIGlmIChmcm96ZW5DdXJyZW50Um93ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgZnJvemVuQ3VycmVudFJvdyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBmcm96ZW5DdXJyZW50Um93ICE9PSAnYm9vbGVhbicpIHtcclxuICAgICAgZnJvemVuQ3VycmVudFJvdyA9IGZyb3plbkN1cnJlbnRSb3cgPT09ICd0cnVlJyA/IHRydWUgOiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IHZpcnR1YWxSb290RnJhbWVDb250ZXh0ID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dDtcclxuICAgIC8vIOi/mOWOn+S4iuasoeiuvue9rueahOe7k+aenOmbhlxyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQucGFyYW1zLmRlbGV0ZSgnX0RFVktJVF9leHBhbmRSb3dJZHMnKTtcclxuICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnBhcmFtcy5kZWxldGUoJ19ERVZLSVRfc2VsZWN0ZWRSb3dJZCcpO1xyXG4gICAgdmlydHVhbFJvb3RGcmFtZUNvbnRleHQudWlTdGF0ZS5zZXRQcm9wZXJ0eVZhbHVlKCdfX0RFVktJVF9fc2VsZWN0ZWRSb3cnLCBudWxsKTtcclxuICAgIGNvbnN0IGZpbHRlcnNBcnJheSA9IHRoaXMucGFyc2VDb25kaXRpb25zKGZpbHRlcnMpO1xyXG4gICAgY29uc3QgcGFyZW50SWQgPSB0aGlzLmdldElkVG9FeHBhbmQoKTtcclxuICAgIGNvbnN0IGNvcnJlY3RTZWxlY3RlZE5vZGUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5jb3VudCgpID09PSAwO1xyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZSA9IHRoaXMuZ2V0SGllcmFyY2h5VHlwZSgpO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuXHJcbiAgICBpZiAocmVwb3NpdG9yeSA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBsb2FkaW5nVGltZXJJZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvd0xvYWRpbmdXaXRoRGVsYXkoNTAwKTtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB7XHJcbiAgICAgIGZyYW1lQ29udGV4dDogdGhpcy5mcmFtZUNvbnRleHQsXHJcbiAgICAgIGZyb3plbkN1cnJlbnRSb3dcclxuICAgIH07XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgY29uc3QgcXVlcnkkID0gcmVwb3NpdG9yeS5sb2FkRnVsbFRyZWUodGhpcy5yZXBvc2l0b3J5LCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIHBhcmVudElkLCB2aXJ0dWFsUHJvcGVydHlOYW1lLCBmdWxsVHJlZVR5cGUsIGxvYWRUeXBlLCBmaWx0ZXJzQXJyYXksIGNvbnRleHQpO1xyXG4gICAgcmV0dXJuIHF1ZXJ5JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKGVudGl0aWVzOiBFbnRpdHlbXSkgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWRSb3dJZCA9IHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ19ERVZLSVRfc2VsZWN0ZWRSb3dJZCcpO1xyXG4gICAgICAgICAgLy8g57qg5q2j6YCJ5Lit6IqC54K5XHJcbiAgICAgICAgICBpZiAoY29ycmVjdFNlbGVjdGVkTm9kZSA9PT0gdHJ1ZSB8fCAhc2VsZWN0ZWRSb3dJZCkge1xyXG4gICAgICAgICAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICAgICAgICAgIGlmICh0cmVlTm9kZVV0aWwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICBjb25zdCBjb21wdXRlZEZpcnN0Um93SWQgPSB0cmVlTm9kZVV0aWwuc2VsZWN0Rmlyc3RSb290Tm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXkpO1xyXG4gICAgICAgICAgICAgIGlmIChjb21wdXRlZEZpcnN0Um93SWQpIHtcclxuICAgICAgICAgICAgICAgIHZpcnR1YWxSb290RnJhbWVDb250ZXh0LnVpU3RhdGUuc2V0UHJvcGVydHlWYWx1ZSgnX19ERVZLSVRfX3NlbGVjdGVkUm93JywgY29tcHV0ZWRGaXJzdFJvd0lkKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3dJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICAgICAgICBpZiAoZnJvemVuQ3VycmVudFJvdykge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzkuIrkuIDmrKHpgInkuK3ooYzkuLrmnKzmrKHliqDovb3mlbDmja7kuK3nmoTkuIDmnaHvvIzliJnlupTor6Xph43mlrDpgInkuK3or6XooYxcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbnNDdXJyZW50Um93ID0gZW50aXRpZXMuZmluZChpdGVtID0+IGl0ZW0ucHJpbWFyeVZhbHVlID09PSBjdXJyZW50Um93SWQpO1xyXG4gICAgICAgICAgICBpZiAoY29udGFpbnNDdXJyZW50Um93KSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDljp/mnaXnmoTlvZPliY3ooYzkuI3lnKjlt7Lnu4/liqDovb3nmoTmlbDmja7kuK3vvIzlpoLlsZXlvIDliLDnrKzkuInnuqfvvIzlsIbnrKzkuInnuqfnmoTmn5DooYzorr7kuLrlvZPliY3ooYzvvIzlhajpg6jmlLbotbfvvIzlsZXlvIDnrKzkuIDnuqdcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGN1cnJlbnRSb3dJZCkgJiYgZW50aXRpZXMgJiYgZW50aXRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2hpbGRJZCA9IGVudGl0aWVzICYmIEFycmF5LmlzQXJyYXkoZW50aXRpZXMpICYmIGVudGl0aWVzLmxlbmd0aCA+IDAgJiYgZW50aXRpZXNbMF0ucHJpbWFyeVZhbHVlIHx8IG51bGw7XHJcbiAgICAgICAgICAgICAgaWYgKGZpcnN0Q2hpbGRJZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDdXJyZW50SWQoZmlyc3RDaGlsZElkKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmxvYWRGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluacgOaWsOWxleW8gOeahOiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRJZFRvRXhwYW5kKCkge1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xyXG4gICAgY29uc3QgaWRUb0V4cGFuZCA9IGV4cGFuZE5vZGVzLnBvcCgpO1xyXG4gICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnVFJFRV9MQVRFU1RfRVhQQU5ERURfSUQnLCBleHBhbmROb2Rlcyk7XHJcbiAgICByZXR1cm4gaWRUb0V4cGFuZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruacgOaWsOWxleW8gOeahOiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRJZFRvRXhwYW5kKGlkVG9FeHBhbmQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgZXhwYW5kTm9kZXMgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdUUkVFX0xBVEVTVF9FWFBBTkRFRF9JRCcpIHx8IFtdO1xyXG4gICAgZXhwYW5kTm9kZXMucHVzaChpZFRvRXhwYW5kKTtcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ1RSRUVfTEFURVNUX0VYUEFOREVEX0lEJywgZXhwYW5kTm9kZXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6Kej5p6Q6L+H5ruk5p2h5Lu2XHJcbiAgICovXHJcbiAgcHVibGljIHBhcnNlQ29uZGl0aW9ucyhjb25kaXRpb25zPzogc3RyaW5nKTogYW55W10ge1xyXG4gICAgY29uc3QgY29uZGl0aW9uc1N0cmluZyA9ICghY29uZGl0aW9ucyB8fCBjb25kaXRpb25zID09PSAnJykgPyAnW10nIDogY29uZGl0aW9ucztcclxuICAgIHJldHVybiBKU09OLnBhcnNlKGNvbmRpdGlvbnNTdHJpbmcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5paw5aKe5ZCM57qnXHJcbiAgICovXHJcbiAgcHVibGljIGFkZFNpYmxpbmcoaWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcblxyXG4gICAgLy8g6K6+6K6h5pe2aWTnmoTojrflj5bmlLnkuLrku47lkb3ku6Tlj4LmlbDkuIrojrflj5bvvIzkvYborr7orqHml7bmsqHmnInlj4LmlbDlv4Xloavmo4Dmn6XvvIxcclxuICAgIC8vIOWmguaenOaJk+W8gOihqOWNleS/neWtmOS6hu+8iOWNs+abtOaWsOS6huacgOaWsOeahOWRveS7pOaehOS7tu+8ie+8jOS9huayoeaciemFjee9ruivpeWPguaVsO+8jOWPr+iDveS8muS8oOmAkui/h+adpeS4gOS4quepuuWAvO+8jFxyXG4gICAgLy8g5Li65LqG5YW85a655q2k5oOF5Ya177yM5L2/55So5b2T5YmN6KGMaWTkvZzkuLppZOeahOWAvFxyXG4gICAgaWQgPSBpZCA/IGlkIDogdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuXHJcbiAgICAvLyDlj4LmlbDmo4Dmn6VcclxuICAgIGlmICghaWQgfHwgaWQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGlkID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6K6w5b2V5pyA6L+R5LiA5qyh5L+u5pS555qE5pWw5o2uaWRcclxuICAgIGNvbnN0IGxhc3RNb2RpZmllZElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgIC8vIOiOt+WPluWIhue6p+aWueW8j1xyXG4gICAgY29uc3QgaGllcmFyY2h5VHlwZTogc3RyaW5nID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICAvLyDmiafooYzlj5bmlbBcclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICghcmVwb3NpdG9yeSkge1xyXG4gICAgICAvLyDplJnor6/nmoTliIbnuqfnoIFcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydlcnJvckhpZXJhcmNoeUtleSddKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZXBvc2l0b3J5LmFkZFNpYmxpbmcodGhpcy5yZXBvc2l0b3J5LCBpZCk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnSVNfQUREJywgdHJ1ZSk7XHJcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdMQVNUX01PRElGSUVEX0lEJywgbGFzdE1vZGlmaWVkSWQpO1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuYWRkU2libGluZ0ZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOWinuS4i+e6p1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRDaGlsZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuXHJcbiAgICAvLyDljp/lm6DlkIxhZGRTaWJsaW5n55qE5L+u5pS5XHJcbiAgICBpZCA9IGlkID8gaWQgOiB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG5cclxuICAgIC8vIOWPguaVsOajgOafpVxyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICAvLyDor7fpgInmi6nniLboioLngrlcclxuICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ3Bsc1NlbGVjdFBhcmVudE5vZGUnXSwgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOiusOW9leacgOi/keS4gOasoeS/ruaUueeahOaVsOaNrmlkXHJcbiAgICBjb25zdCBsYXN0TW9kaWZpZWRJZCA9IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICAvLyDojrflj5bliIbnuqfmlrnlvI9cclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgIC8vIOaJp+ihjOWPluaVsFxyXG4gICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XHJcblxyXG4gICAgLy8g5paw5aKe55qE5pe25YCZ77yM6KaB5bGV5byA54i26IqC54K5XHJcbiAgICB0aGlzLnNldElkVG9FeHBhbmQoaWQpO1xyXG4gICAgY29uc3QgcmVsb2FkQ2hpbGQkID0gdGhpcy5yZWxvYWRCeUxldmVsKCk7XHJcblxyXG4gICAgY29uc3QgcmVwb3NpdG9yeSA9IFRyZWVSZXBvc2l0b3J5RmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICghcmVwb3NpdG9yeSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5sYW5ndWFnZVNlcnZpY2VbJ2Vycm9ySGllcmFyY2h5S2V5J10pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYWRkQ2hpbGQkID0gcmVwb3NpdG9yeS5hZGRDaGlsZCh0aGlzLnJlcG9zaXRvcnksIGlkKTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSByZWxvYWRDaGlsZCQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gYWRkQ2hpbGQkO1xyXG4gICAgICB9KSxcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ0lTX0FERCcsIHRydWUpO1xyXG4gICAgICAgICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnTEFTVF9NT0RJRklFRF9JRCcsIGxhc3RNb2RpZmllZElkKTtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmFkZENoaWxkRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+S/neWtmFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzYXZlKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgaWYgKHRoaXMubWVzc2FnZVBpcGUpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlUGlwZS5uZXh0KHsgbWVzc2FnZVR5cGU6ICdzYXZlJyB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3Qgc2F2ZSQgPSB0aGlzLnJlcG9zaXRvcnkuYXBwbHlDaGFuZ2VzKCk7XHJcbiAgICBjb25zdCByZXN1bHQkID0gc2F2ZSQucGlwZShcclxuICAgICAgdGFwKFxyXG4gICAgICAgICgpID0+IHtcclxuICAgICAgICAgIHRoaXMubG9hZGluZ1NlcnZpY2UuaGlkZURlbGF5TG9hZGluZyhsb2FkaW5nVGltZXJJZCk7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxhbmd1YWdlU2VydmljZS5zYXZlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLm11bHRpU2F2ZUZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICAgIHJldHVybiByZXN1bHQkO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliKDpmaRcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlKGlkOiBzdHJpbmcsIHN1Y2Nlc3NNc2c/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuXHJcbiAgICAvLyDljp/lm6DlkIxhZGRTaWJsaW5nXHJcbiAgICBpZCA9IGlkID8gaWQgOiB0aGlzLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG5cclxuICAgIC8vIOWPguaVsOajgOafpVxyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxhbmd1YWdlU2VydmljZVsncGxzU2VsZWN0RGVsZXRlRGF0YSddLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5a2Y5Zyo5a2Q6IqC54K55LiN5YWB6K645Yig6ZmkXHJcbiAgICBjb25zdCB0cmVlTm9kZXNEYXRhID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udG9KU09OKCk7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlUeXBlID0gdGhpcy5nZXRIaWVyYXJjaHlUeXBlKCk7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSBUcmVlVXRpbEZhY3RvcnkuZ2V0SW5zdGFuY2UoaGllcmFyY2h5VHlwZSk7XHJcbiAgICBpZiAodHJlZU5vZGVVdGlsID09PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBlbXB0eSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRyZWVOb2RlVXRpbC5oYXNDaGlsZE5vZGVzKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWQpID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydkZWxldGVDaGlsZEZpcnN0J10sIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDnoa7orqTliKDpmaRcclxuICAgIGNvbnN0IGFjdGlvbiQgPSB0aGlzLm1lc3NhZ2VTZXJ2aWNlLnF1ZXN0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNvbmZpcm1EZWxldGlvbik7XHJcbiAgICByZXR1cm4gYWN0aW9uJC5waXBlKFxyXG4gICAgICBjb25jYXRNYXAocmVzdWx0ID0+IHtcclxuICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgcmV0dXJuIGVtcHR5KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDojrflj5bliKDpmaTlkI7opoHorr7nva7nmoToioLngrlpZFxyXG4gICAgICAgIGNvbnN0IG5leHROb2RlSWQgPSB0cmVlTm9kZVV0aWwuZ2V0TmV4dE5vZGVJZCh0cmVlTm9kZXNEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIGlkKTtcclxuXHJcbiAgICAgICAgLy8g5omn6KGM5Yig6ZmkXHJcbiAgICAgICAgY29uc3QgbG9hZGluZ1RpbWVySWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3dMb2FkaW5nV2l0aERlbGF5KDUwMCk7XHJcbiAgICAgICAgY29uc3QgcmVtb3ZlJCA9IHRoaXMuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkucmVtb3ZlQnlJZChpZCk7XHJcbiAgICAgICAgcmV0dXJuIHJlbW92ZSQucGlwZShcclxuICAgICAgICAgIHRhcCgoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyDorr7nva7pgInkuK3oioLngrlcclxuICAgICAgICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdGVkTm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIG5leHROb2RlSWQpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3NNc2cgJiYgc3VjY2Vzc01zZy50cmltKCkpIHtcclxuICAgICAgICAgICAgICBsZXQgc2hvd01lc3NhZ2U6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgIGlmIChzdWNjZXNzTXNnLnN0YXJ0c1dpdGgoJ3snKSAmJiBzdWNjZXNzTXNnLmVuZHNXaXRoKCd9JykpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBKU09OLnBhcnNlKHN1Y2Nlc3NNc2cpO1xyXG4gICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zaG93TWVzc2FnZSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIHsgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAoc2hvd01lc3NhZ2UgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2VzcyhzdWNjZXNzTXNnLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlU3VjY2VzcywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICAgICAgICB0aGlzLmVycm9yU2VydmljZS5leGNlcHRpb24odGhpcy5sYW5ndWFnZVNlcnZpY2UuZGVsZXRlRmFpbGVkLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOaXtuajgOa1i+acquS/neWtmOiusOW9lVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjYW5jZWwoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGhhc0NoYW5nZSQgPSBEYXRhQ2hhbmdlRGV0ZWN0aW9uU2VydmljZS5oYXNDaGFuZ2UodGhpcy5mcmFtZUNvbnRleHQpO1xyXG4gICAgcmV0dXJuIGhhc0NoYW5nZSQucGlwZShcclxuICAgICAgc3dpdGNoTWFwKChjaGFuZ2VkOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgaWYgKCFjaGFuZ2VkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5fY2FuY2VsKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VTZXJ2aWNlLnF1ZXN0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlWydjYW5jZWxXaXRob3V0U2F2ZSddKS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKGlmQ2FuY2VsOiBib29sZWFuKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGlmQ2FuY2VsID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FuY2VsKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWIhumhteS/oeaBr1xyXG4gICAqIEBwYXJhbSBwYXJlbnRJZCBwYXJlbnRJZFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBidWlsZFBhZ2luYXRpb25JbmZvKHBhcmVudElkOiBhbnkpIHtcclxuICAgIGNvbnN0IHBhZ2luYXRpb246IGFueSA9IHsgcGFnZUluZGV4OiAwLCBwYWdlU2l6ZTogMCB9O1xyXG4gICAgY29uc3QgZW5hYmxlTm9kZVBhZ2luYXRpb24gPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KCdlbmFibGVOb2RlUGFnaW5hdGlvbicpO1xyXG4gICAgaWYgKCFwYXJlbnRJZCkge1xyXG4gICAgICAvLyDkuIDnuqfliIbpobVcclxuICAgICAgY29uc3QgcGFnZVNpemUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlU2l6ZSB8fCAwO1xyXG4gICAgICBjb25zdCBwYWdlSW5kZXggPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlSW5kZXggfHwgMDtcclxuICAgICAgLy8g5ZCv55So5LqG5LiA57qn5YiG6aG1XHJcbiAgICAgIGlmIChwYWdlU2l6ZSAhPT0gMCkge1xyXG4gICAgICAgIHBhZ2luYXRpb24ucGFnZVNpemUgPSBwYWdlU2l6ZTtcclxuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VJbmRleCA9IHBhZ2VJbmRleDtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5aaC5p6c5pyq5ZCv55So6IqC54K55YiG6aG15oiW5b2T5YmN5Li66aG257qn6IqC54K55Yqg6L2977yM5YiZ5LiN5aSE55CG6IqC54K55YiG6aG1XHJcbiAgICAgIGlmIChlbmFibGVOb2RlUGFnaW5hdGlvbikge1xyXG4gICAgICAgIGNvbnN0IG5vZGVQYWdlU2l6ZSA9IHRoaXMuZnJhbWVDb250ZXh0LnBhcmFtcy5nZXQoJ25vZGVQYWdlU2l6ZScpIHx8IDA7XHJcbiAgICAgICAgbGV0IG5vZGVQYWdlSW5kZXggPSB0aGlzLmZyYW1lQ29udGV4dC5wYXJhbXMuZ2V0KGBfTk9ERV8ke3BhcmVudElkfV9QQUdFX0lOREVYX2ApO1xyXG4gICAgICAgIGlmICghbm9kZVBhZ2VJbmRleCkge1xyXG4gICAgICAgICAgdGhpcy5mcmFtZUNvbnRleHQucGFyYW1zLnNldChgX05PREVfJHtwYXJlbnRJZH1fUEFHRV9JTkRFWF9gLCAxKTtcclxuICAgICAgICAgIG5vZGVQYWdlSW5kZXggPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYWdpbmF0aW9uLnBhZ2VJbmRleCA9IG5vZGVQYWdlSW5kZXg7XHJcbiAgICAgICAgcGFnaW5hdGlvbi5wYWdlU2l6ZSA9IG5vZGVQYWdlU2l6ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBhZ2luYXRpb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojlj5jmm7RcclxuICAgKi9cclxuICBwcml2YXRlIF9jYW5jZWwoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGxvYWRpbmdUaW1lcklkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93TG9hZGluZ1dpdGhEZWxheSg1MDApO1xyXG4gICAgY29uc3QgY2FuY2VsJCA9IHRoaXMucmVwb3NpdG9yeS5jYW5jZWxDaGFuZ2VzKCk7XHJcbiAgICByZXR1cm4gY2FuY2VsJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlzQWRkID0gdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5nZXRQYXJhbSgnSVNfQUREJyk7XHJcbiAgICAgICAgY29uc3QgbGFzdE1vZGlmaWVkSWQgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdMQVNUX01PRElGSUVEX0lEJyk7XHJcbiAgICAgICAgY29uc3QgY3VycmVudElkID0gdGhpcy5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuXHJcbiAgICAgICAgaWYgKGlzQWRkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5yZW1vdmVFbnRpdHlCeUlkKGN1cnJlbnRJZCk7XHJcblxyXG4gICAgICAgICAgLy8g6YeN572u57yW6L6R54q25oCBXHJcbiAgICAgICAgICB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LnNldFBhcmFtKCdJU19BREQnLCBmYWxzZSk7XHJcbiAgICAgICAgICBpZiAobGFzdE1vZGlmaWVkSWQpIHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChsYXN0TW9kaWZpZWRJZCwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZUJ5SWQoY3VycmVudElkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG4gICAgICB0YXAoXHJcbiAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5sb2FkaW5nU2VydmljZS5oaWRlRGVsYXlMb2FkaW5nKGxvYWRpbmdUaW1lcklkKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmxvYWRpbmdTZXJ2aWNlLmhpZGVEZWxheUxvYWRpbmcobG9hZGluZ1RpbWVySWQpO1xyXG4gICAgICAgICAgdGhpcy5lcnJvclNlcnZpY2UuZXhjZXB0aW9uKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNhbmNlbEZhaWxlZCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpeaYr+WQpuWtmOWcqOS4i+e6p+iKgueCue+8iOWGhemDqOaWueazle+8jOivt+WLv+S9v+eUqO+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXNDaGlsZE5vZGVzKGlkOiBzdHJpbmcsIHRyZWVOb2Rlc0RhdGE6IGFueVtdKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xyXG4gICAgaWYgKHRyZWVOb2RlVXRpbC5oYXNDaGlsZE5vZGVzKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWQpID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K6h566X5Yig6Zmk5ZCO55qE5b2T5YmN6IqC54K5aWTvvIjlhoXpg6jmlrnms5XvvIzor7fli7/kvb/nlKjvvIlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TmV4dE5vZGVJZEFmdGVyUmVtb3ZpbmcoaWRUb1JlbW92ZTogc3RyaW5nLCB0cmVlTm9kZXNEYXRhOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xyXG4gICAgY29uc3QgbmV4dE5vZGVJZCA9IHRyZWVOb2RlVXRpbC5nZXROZXh0Tm9kZUlkKHRyZWVOb2Rlc0RhdGEsIHRoaXMuaGllcmFyY2h5SW5mb0tleSwgaWRUb1JlbW92ZSk7XHJcbiAgICByZXR1cm4gbmV4dE5vZGVJZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiuvue9ruWIoOmZpOWQjueahOW9k+WJjeiKgueCueiKgueCue+8iOWGhemDqOaWueazle+8jOivt+WLv+S9v+eUqO+8iVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXROZXh0Tm9kZUFmdGVyUmVtb3ZpbmcobmV4dE5vZGVJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCB0cmVlTm9kZVV0aWwgPSB0aGlzLmdldFRyZWVOb2RlVXRpbCgpO1xyXG4gICAgdHJlZU5vZGVVdGlsLnNlbGVjdGVkTm9kZSh0aGlzLmJpbmRpbmdEYXRhLCB0aGlzLmhpZXJhcmNoeUluZm9LZXksIG5leHROb2RlSWQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDorr7nva7moJHnmoTlvZPliY3ooYwo57uZ5a6M5pW05qCR5L2/55SoKVxyXG4gICAqIEBwYXJhbSBpZCBpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDdXJyZW50SWQoaWQ6IHN0cmluZykge1xyXG4gICAgaWQgPSBpZCB8fCB0aGlzLmZyYW1lQ29udGV4dC5nZXRWaXJ0dWFsUm9vdEZyYW1lQ29udGV4dCgpLnVpU3RhdGVbJ19fREVWS0lUX19zZWxlY3RlZFJvdyddIHx8IHRoaXMuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SXRlbS5wcmltYXJ5S2V5VmFsdWU7XHJcbiAgICB0aGlzLmZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChpZCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOmAieS4reagkeeahOesrOS4gOS4quiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZWxlY3RGaXJzdFJvdygpIHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICh0cmVlTm9kZVV0aWwgIT09IG51bGwpIHtcclxuICAgICAgdHJlZU5vZGVVdGlsLnNlbGVjdEZpcnN0Um9vdE5vZGUodGhpcy5iaW5kaW5nRGF0YSwgdGhpcy5oaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5qCR6IqC54K55bel5YW357G75a6e5L6LXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRUcmVlTm9kZVV0aWwoKTogYW55IHtcclxuICAgIGNvbnN0IGhpZXJhcmNoeVR5cGUgPSB0aGlzLmdldEhpZXJhcmNoeVR5cGUoKTtcclxuICAgIGNvbnN0IHRyZWVOb2RlVXRpbCA9IFRyZWVVdGlsRmFjdG9yeS5nZXRJbnN0YW5jZShoaWVyYXJjaHlUeXBlKTtcclxuICAgIGlmICh0cmVlTm9kZVV0aWwgPT09IG51bGwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuI3mlK/mjIEke2hpZXJhcmNoeVR5cGV957G75Z6L55qE5YiG57qnYCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJlZU5vZGVVdGlsO1xyXG4gIH1cclxuXHJcblxyXG5cclxuICAvKipcclxuICAgKiDorrDlvZXliqDovb3nirbmgIFcclxuICAgKiBAdG9kb++8muW+heWIoOmZpFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0TG9hZEJ5TGV2ZWxTdGF0ZShmaWx0ZXJzOiBzdHJpbmcsIHNvcnRzOiBzdHJpbmcpIHtcclxuXHJcbiAgICAvLyBAdG9kb++8muS4tOaXtuWkhOeQhlxyXG4gICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnaXNMb2FkVHJlZUJ5TGV2ZWwnLCB0cnVlKTtcclxuICAgIHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuc2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbEZpbHRlcicsIGZpbHRlcnMpO1xyXG4gICAgdGhpcy52aXJ0dWFsUm9vdEZyYW1lQ29udGV4dC5zZXRQYXJhbSgnbG9hZFRyZWVCeUxldmVsU29ydCcsIHNvcnRzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxleW8gOW9k+WJjeiKgueCuVxyXG4gICAqIEB0b2Rv77ya5b6F5Yig6ZmkXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWxvYWRCeUxldmVsKCk6IE9ic2VydmFibGU8RW50aXR5W10+IHtcclxuICAgIGNvbnN0IGlzTG9hZEJ5TGV2ZWwgPSB0aGlzLnZpcnR1YWxSb290RnJhbWVDb250ZXh0LmdldFBhcmFtKCdpc0xvYWRUcmVlQnlMZXZlbCcpO1xyXG4gICAgaWYgKGlzTG9hZEJ5TGV2ZWwgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgZmlsdGVycyA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbEZpbHRlcicpO1xyXG4gICAgICBjb25zdCBzb3J0cyA9IHRoaXMudmlydHVhbFJvb3RGcmFtZUNvbnRleHQuZ2V0UGFyYW0oJ2xvYWRUcmVlQnlMZXZlbFNvcnQnKTtcclxuICAgICAgcmV0dXJuIHRoaXMubG9hZEJ5TGV2ZWwoZmlsdGVycywgc29ydHMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKFtdKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0SGllcmFyY2h5VHlwZSgpIHtcclxuICAgIGNvbnN0IG5nT2JqZWN0cyA9IEZpZWxkTWV0YWRhdGFVdGlsLmdldE5nT2JqZWN0cyh0aGlzLnJlcG9zaXRvcnkuZW50aXR5VHlwZSk7XHJcbiAgICBjb25zdCBoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvID0gbmdPYmplY3RzW3RoaXMuaGllcmFyY2h5SW5mb0tleV07XHJcbiAgICBsZXQgaGllcmFyY2h5VHlwZSA9ICdwYXRoJzsgLy8g5YiG57qn56CB6buY6K6k5Li6cGF0aO+8jOWFvOWuueWOn+ihqOWNlVxyXG4gICAgaWYgKGhpZXJhcmNoeUluZm9OZ09iamVjdEluZm8uaGFzT3duUHJvcGVydHkoJ2hpZXJhcmNoeVR5cGUnKSAmJiBoaWVyYXJjaHlJbmZvTmdPYmplY3RJbmZvWydoaWVyYXJjaHlUeXBlJ10gIT0gbnVsbCkge1xyXG4gICAgICBoaWVyYXJjaHlUeXBlID0gaGllcmFyY2h5SW5mb05nT2JqZWN0SW5mb1snaGllcmFyY2h5VHlwZSddIGFzIHN0cmluZztcclxuICAgIH1cclxuICAgIGlmIChoaWVyYXJjaHlUeXBlID09IG51bGwgfHwgaGllcmFyY2h5VHlwZS5sZW5ndGggPCAxKSB7XHJcbiAgICAgIC8vICfliIbnuqfnoIHphY3nva7kv6Hmga/plJnor68nXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmxhbmd1YWdlU2VydmljZVsnaW5jb3JyZWN0SGllcmFyY2h5Q29uZmlnJ10pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhpZXJhcmNoeVR5cGU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluaguee7hOS7tua2iOaBr+euoemBk1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IG1lc3NhZ2VQaXBlKCkge1xyXG4gICAgaWYgKHRoaXMuZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dC5nZXRGb3JtQXBwQ29udGV4dCgpIHx8IG51bGw7XHJcbiAgICAgIGlmIChhcHBDb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIGFwcENvbnRleHQubWVzc2FnZVBpcGUgfHwgbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59XHJcbmV4cG9ydCB7IFRyZWVEYXRhU2VydmljZSB9O1xyXG4iXX0=
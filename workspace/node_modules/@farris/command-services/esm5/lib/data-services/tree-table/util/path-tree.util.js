/**
 * 树数据的帮助类
 */
var PathTreeNodeUtil = /** @class */ (function () {
    function PathTreeNodeUtil() {
    }
    /**
     * 选中第一个根节点
     */
    PathTreeNodeUtil.prototype.selectFirstRootNode = function (bindingData, hierarchyInfoKey) {
        var treeNodesData = bindingData.list.toJSON();
        var firstRootNodeId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);
        this.selectedNode(bindingData, hierarchyInfoKey, firstRootNodeId);
        return firstRootNodeId;
    };
    PathTreeNodeUtil.prototype.selectNodeByBindingList = function (bindingList, hierarchyInfoKey, selectedNodeId) {
        var treeNodesData = bindingList.toJSON();
        // 如果要设置的节点不存在，则设置第1个根节点
        var selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);
        var currentId = selectedNodeId;
        if (!selectedNodeData) {
            currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);
        }
        setTimeout(function () {
            bindingList.setCurrentId(currentId, true, true);
        }, 0);
    };
    /**
     * 选中节点
     */
    PathTreeNodeUtil.prototype.selectedNode = function (bindingData, hierarchyInfoKey, selectedNodeId) {
        var treeNodesData = bindingData.list.toJSON();
        // 如果要设置的节点不存在，则设置第1个根节点
        var selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);
        var currentId = selectedNodeId;
        if (!selectedNodeData) {
            currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);
        }
        if (bindingData.rowSelectedEventSuspend === true) {
            return;
        }
        setTimeout(function () {
            bindingData.list.currentId = null;
            bindingData.list.setCurrentId(currentId, true, true);
        }, 0);
    };
    /**
     * 检查是否有子节点
     */
    PathTreeNodeUtil.prototype.hasChildNodes = function (treeNodesData, hierarchyInfoKey, fid) {
        var fNodeData = this.getNodeDataById(treeNodesData, fid);
        // const fLayer = fNodeData[hierarchyInfoKey]['layer'];
        // const fPath  = fNodeData[hierarchyInfoKey]['path'];
        var fIsDetail = fNodeData[hierarchyInfoKey]['isDetail'];
        // 非明细节点，返回true
        if (fIsDetail === false) {
            return true;
        }
        return false;
        // const childNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fPath);
        // return childNodesData.length > 0;
    };
    /**
     * 获取根节点（多个根节点时获取第一个）
     * @return 找不到时返回null
     */
    PathTreeNodeUtil.prototype.getFirstNodeId = function (treeNodesData, hierarchyInfoKey) {
        var rootData = treeNodesData.find(function (itemData) {
            var layer = itemData[hierarchyInfoKey]['layer'];
            return layer === 1;
        });
        if (!rootData) {
            var rootLayer_1 = this.getRootLayer(treeNodesData, hierarchyInfoKey);
            rootData = treeNodesData.find(function (itemData) {
                var layer = itemData[hierarchyInfoKey]['layer'];
                return layer === rootLayer_1;
            });
        }
        return rootData ? rootData['id'] : '';
    };
    PathTreeNodeUtil.prototype.getRootLayer = function (treeNodesData, hierarchyInfoKey) {
        var layer = null;
        if (treeNodesData && Array.isArray(treeNodesData)) {
            var layers = treeNodesData.map(function (item) {
                var layer = item[hierarchyInfoKey]['layer'];
                return layer;
            });
            var minLayer = Math.min.apply(Math, layers);
            if (!isNaN(minLayer)) {
                layer = minLayer;
            }
        }
        return layer;
    };
    /**
     * 获取下一个节点（删除后）
     */
    PathTreeNodeUtil.prototype.getNextNodeId = function (treeNodesData, hierarchyInfoKey, currentId) {
        // 当前节点信息
        var currentNodeData = treeNodesData.find(function (itemData) {
            return itemData['id'] === currentId;
        });
        var currentPath = currentNodeData[hierarchyInfoKey]['path'];
        var currentLayer = currentNodeData[hierarchyInfoKey]['layer'];
        // 父节点信息
        var fLayer = currentLayer - 1;
        var fPath = currentPath.substring(0, currentPath.length - 4);
        // 查找兄弟节点
        var siblingtreeNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fPath);
        // 如果没有兄弟节点，向上查找
        if (siblingtreeNodesData.length === 1) {
            var parentData = treeNodesData.find(function (itemData) {
                return itemData[hierarchyInfoKey]['path'] === fPath;
            });
            // 存在父节点，则设置父节点；
            // 不存在父节点，则设置第一个根节点。
            if (!parentData) {
                return this.getFirstNodeId(treeNodesData, hierarchyInfoKey);
            }
            return parentData['id'];
        }
        else {
            return this.getNextSiblingNodeId(siblingtreeNodesData, currentId);
        }
    };
    /**
     * 获取下个兄弟节点的id
     */
    PathTreeNodeUtil.prototype.getNextSiblingNodeId = function (siblingtreeNodesData, currentId) {
        if (siblingtreeNodesData.length <= 1) {
            return '';
        }
        var currentIndex = siblingtreeNodesData.findIndex(function (itemData) {
            return itemData['id'] === currentId;
        });
        // 最后一行上移一行，其他下移一行
        var nextIndex = -1;
        if (currentIndex === siblingtreeNodesData.length - 1) {
            nextIndex = currentIndex - 1;
        }
        else {
            nextIndex = currentIndex + 1;
        }
        return siblingtreeNodesData[nextIndex]['id'];
    };
    /**
     * 获取下级节点的BindingObjects集合
     */
    PathTreeNodeUtil.prototype.getChildNodesData = function (treeNodesData, hierarchyInfoKey, fLayer, fPath) {
        var childtreeNodesData = treeNodesData.filter(function (itemData) {
            var layer = itemData[hierarchyInfoKey]['layer'];
            var path = itemData[hierarchyInfoKey]['path'];
            return (layer === fLayer + 1) && path.startsWith(fPath);
        });
        return childtreeNodesData;
    };
    /**
     * 获取id获取节点数据
     */
    PathTreeNodeUtil.prototype.getNodeDataById = function (treeNodesData, id) {
        var nodeData = treeNodesData.find(function (itemData) {
            return itemData['id'] === id;
        });
        return nodeData ? nodeData : null;
    };
    return PathTreeNodeUtil;
}());
export { PathTreeNodeUtil };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0aC10cmVlLnV0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy90cmVlLXRhYmxlL3V0aWwvcGF0aC10cmVlLnV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7O0dBRUc7QUFDSDtJQUFBO0lBK0tBLENBQUM7SUE3S0M7O09BRUc7SUFDSSw4Q0FBbUIsR0FBMUIsVUFBMkIsV0FBd0IsRUFBRSxnQkFBd0I7UUFFM0UsSUFBTSxhQUFhLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNoRCxJQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzdFLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLGdCQUFnQixFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBQ2xFLE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFDTSxrREFBdUIsR0FBOUIsVUFBK0IsV0FBd0IsRUFBRSxnQkFBd0IsRUFBRSxjQUFzQjtRQUN2RyxJQUFNLGFBQWEsR0FBRyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDM0Msd0JBQXdCO1FBQ3hCLElBQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDN0UsSUFBSSxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQy9CLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUNyQixTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztTQUNsRTtRQUVELFVBQVUsQ0FBQztZQUNULFdBQVcsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsRCxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDUixD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O1lBQ2xELElBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2hELE9BQU8sQ0FBQyxLQUFLLEtBQUssTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLGtCQUFrQixDQUFDO0lBQzVCLENBQUM7SUFFRDs7T0FFRztJQUNJLDBDQUFlLEdBQXRCLFVBQXVCLGFBQW9CLEVBQUUsRUFBVTtRQUNyRCxJQUFNLFFBQVEsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLFVBQUMsUUFBYTtZQUNoRCxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDcEMsQ0FBQztJQUNILHVCQUFDO0FBQUQsQ0FBQyxBQS9LRCxJQStLQztBQUVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmluZGluZ0RhdGEsIEJpbmRpbmdMaXN0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5cclxuLyoqXHJcbiAqIOagkeaVsOaNrueahOW4ruWKqeexu1xyXG4gKi9cclxuY2xhc3MgUGF0aFRyZWVOb2RlVXRpbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAieS4reesrOS4gOS4quagueiKgueCuVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZWxlY3RGaXJzdFJvb3ROb2RlKGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSwgaGllcmFyY2h5SW5mb0tleTogc3RyaW5nKTogc3RyaW5nIHtcclxuXHJcbiAgICBjb25zdCB0cmVlTm9kZXNEYXRhID0gYmluZGluZ0RhdGEubGlzdC50b0pTT04oKTtcclxuICAgIGNvbnN0IGZpcnN0Um9vdE5vZGVJZCA9IHRoaXMuZ2V0Rmlyc3ROb2RlSWQodHJlZU5vZGVzRGF0YSwgaGllcmFyY2h5SW5mb0tleSk7XHJcbiAgICB0aGlzLnNlbGVjdGVkTm9kZShiaW5kaW5nRGF0YSwgaGllcmFyY2h5SW5mb0tleSwgZmlyc3RSb290Tm9kZUlkKTtcclxuICAgIHJldHVybiBmaXJzdFJvb3ROb2RlSWQ7XHJcbiAgfVxyXG4gIHB1YmxpYyBzZWxlY3ROb2RlQnlCaW5kaW5nTGlzdChiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QsIGhpZXJhcmNoeUluZm9LZXk6IHN0cmluZywgc2VsZWN0ZWROb2RlSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgdHJlZU5vZGVzRGF0YSA9IGJpbmRpbmdMaXN0LnRvSlNPTigpO1xyXG4gICAgLy8g5aaC5p6c6KaB6K6+572u55qE6IqC54K55LiN5a2Y5Zyo77yM5YiZ6K6+572u56ysMeS4quagueiKgueCuVxyXG4gICAgY29uc3Qgc2VsZWN0ZWROb2RlRGF0YSA9IHRoaXMuZ2V0Tm9kZURhdGFCeUlkKHRyZWVOb2Rlc0RhdGEsIHNlbGVjdGVkTm9kZUlkKTtcclxuICAgIGxldCBjdXJyZW50SWQgPSBzZWxlY3RlZE5vZGVJZDtcclxuICAgIGlmICghc2VsZWN0ZWROb2RlRGF0YSkge1xyXG4gICAgICBjdXJyZW50SWQgPSB0aGlzLmdldEZpcnN0Tm9kZUlkKHRyZWVOb2Rlc0RhdGEsIGhpZXJhcmNoeUluZm9LZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBiaW5kaW5nTGlzdC5zZXRDdXJyZW50SWQoY3VycmVudElkLCB0cnVlLCB0cnVlKTtcclxuICAgIH0sIDApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgInkuK3oioLngrlcclxuICAgKi9cclxuICBwdWJsaWMgc2VsZWN0ZWROb2RlKGJpbmRpbmdEYXRhOiBCaW5kaW5nRGF0YSwgaGllcmFyY2h5SW5mb0tleTogc3RyaW5nLCBzZWxlY3RlZE5vZGVJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCB0cmVlTm9kZXNEYXRhID0gYmluZGluZ0RhdGEubGlzdC50b0pTT04oKTtcclxuICAgIC8vIOWmguaenOimgeiuvue9rueahOiKgueCueS4jeWtmOWcqO+8jOWImeiuvue9ruesrDHkuKrmoLnoioLngrlcclxuICAgIGNvbnN0IHNlbGVjdGVkTm9kZURhdGEgPSB0aGlzLmdldE5vZGVEYXRhQnlJZCh0cmVlTm9kZXNEYXRhLCBzZWxlY3RlZE5vZGVJZCk7XHJcbiAgICBsZXQgY3VycmVudElkID0gc2VsZWN0ZWROb2RlSWQ7XHJcbiAgICBpZiAoIXNlbGVjdGVkTm9kZURhdGEpIHtcclxuICAgICAgY3VycmVudElkID0gdGhpcy5nZXRGaXJzdE5vZGVJZCh0cmVlTm9kZXNEYXRhLCBoaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgIH1cclxuICAgIGlmIChiaW5kaW5nRGF0YS5yb3dTZWxlY3RlZEV2ZW50U3VzcGVuZCA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQgPSBudWxsO1xyXG4gICAgICBiaW5kaW5nRGF0YS5saXN0LnNldEN1cnJlbnRJZChjdXJyZW50SWQsIHRydWUsIHRydWUpO1xyXG4gICAgfSwgMCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmo4Dmn6XmmK/lkKbmnInlrZDoioLngrlcclxuICAgKi9cclxuICBwdWJsaWMgaGFzQ2hpbGROb2Rlcyh0cmVlTm9kZXNEYXRhOiBhbnlbXSwgaGllcmFyY2h5SW5mb0tleTogc3RyaW5nLCBmaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZk5vZGVEYXRhID0gdGhpcy5nZXROb2RlRGF0YUJ5SWQodHJlZU5vZGVzRGF0YSwgZmlkKTtcclxuICAgIC8vIGNvbnN0IGZMYXllciA9IGZOb2RlRGF0YVtoaWVyYXJjaHlJbmZvS2V5XVsnbGF5ZXInXTtcclxuICAgIC8vIGNvbnN0IGZQYXRoICA9IGZOb2RlRGF0YVtoaWVyYXJjaHlJbmZvS2V5XVsncGF0aCddO1xyXG4gICAgY29uc3QgZklzRGV0YWlsID0gZk5vZGVEYXRhW2hpZXJhcmNoeUluZm9LZXldWydpc0RldGFpbCddO1xyXG5cclxuICAgIC8vIOmdnuaYjue7huiKgueCue+8jOi/lOWbnnRydWVcclxuICAgIGlmIChmSXNEZXRhaWwgPT09IGZhbHNlKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgLy8gY29uc3QgY2hpbGROb2Rlc0RhdGEgPSB0aGlzLmdldENoaWxkTm9kZXNEYXRhKHRyZWVOb2Rlc0RhdGEsIGhpZXJhcmNoeUluZm9LZXksIGZMYXllciwgZlBhdGgpO1xyXG4gICAgLy8gcmV0dXJuIGNoaWxkTm9kZXNEYXRhLmxlbmd0aCA+IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmoLnoioLngrnvvIjlpJrkuKrmoLnoioLngrnml7bojrflj5bnrKzkuIDkuKrvvIlcclxuICAgKiBAcmV0dXJuIOaJvuS4jeWIsOaXtui/lOWbnm51bGxcclxuICAgKi9cclxuICBwcml2YXRlIGdldEZpcnN0Tm9kZUlkKHRyZWVOb2Rlc0RhdGE6IGFueVtdLCBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgbGV0IHJvb3REYXRhID0gdHJlZU5vZGVzRGF0YS5maW5kKChpdGVtRGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGxheWVyID0gaXRlbURhdGFbaGllcmFyY2h5SW5mb0tleV1bJ2xheWVyJ107XHJcbiAgICAgIHJldHVybiBsYXllciA9PT0gMTtcclxuICAgIH0pO1xyXG4gICAgaWYgKCFyb290RGF0YSkge1xyXG4gICAgICBjb25zdCByb290TGF5ZXIgPSB0aGlzLmdldFJvb3RMYXllcih0cmVlTm9kZXNEYXRhLCBoaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgICAgcm9vdERhdGEgPSB0cmVlTm9kZXNEYXRhLmZpbmQoKGl0ZW1EYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBsYXllciA9IGl0ZW1EYXRhW2hpZXJhcmNoeUluZm9LZXldWydsYXllciddO1xyXG4gICAgICAgIHJldHVybiBsYXllciA9PT0gcm9vdExheWVyO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiByb290RGF0YSA/IHJvb3REYXRhWydpZCddIDogJyc7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0Um9vdExheWVyKHRyZWVOb2Rlc0RhdGE6IGFueVtdLCBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmcpIHtcclxuICAgIGxldCBsYXllciA9IG51bGw7XHJcbiAgICBpZiAodHJlZU5vZGVzRGF0YSAmJiBBcnJheS5pc0FycmF5KHRyZWVOb2Rlc0RhdGEpKSB7XHJcbiAgICAgIGNvbnN0IGxheWVycyA9IHRyZWVOb2Rlc0RhdGEubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgIGNvbnN0IGxheWVyID0gaXRlbVtoaWVyYXJjaHlJbmZvS2V5XVsnbGF5ZXInXTtcclxuICAgICAgICByZXR1cm4gbGF5ZXI7XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBtaW5MYXllciA9IE1hdGgubWluLmFwcGx5KE1hdGgsIGxheWVycyk7XHJcbiAgICAgIGlmICghaXNOYU4obWluTGF5ZXIpKSB7XHJcbiAgICAgICAgbGF5ZXIgPSBtaW5MYXllcjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxheWVyO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bkuIvkuIDkuKroioLngrnvvIjliKDpmaTlkI7vvIlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TmV4dE5vZGVJZCh0cmVlTm9kZXNEYXRhOiBhbnlbXSwgaGllcmFyY2h5SW5mb0tleTogc3RyaW5nLCBjdXJyZW50SWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcblxyXG4gICAgLy8g5b2T5YmN6IqC54K55L+h5oGvXHJcbiAgICBjb25zdCBjdXJyZW50Tm9kZURhdGEgPSB0cmVlTm9kZXNEYXRhLmZpbmQoKGl0ZW1EYXRhOiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIGl0ZW1EYXRhWydpZCddID09PSBjdXJyZW50SWQ7XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gY3VycmVudE5vZGVEYXRhW2hpZXJhcmNoeUluZm9LZXldWydwYXRoJ107XHJcbiAgICBjb25zdCBjdXJyZW50TGF5ZXIgPSBjdXJyZW50Tm9kZURhdGFbaGllcmFyY2h5SW5mb0tleV1bJ2xheWVyJ107XHJcblxyXG4gICAgLy8g54i26IqC54K55L+h5oGvXHJcbiAgICBjb25zdCBmTGF5ZXIgPSBjdXJyZW50TGF5ZXIgLSAxO1xyXG4gICAgY29uc3QgZlBhdGggPSBjdXJyZW50UGF0aC5zdWJzdHJpbmcoMCwgY3VycmVudFBhdGgubGVuZ3RoIC0gNCk7XHJcblxyXG4gICAgLy8g5p+l5om+5YWE5byf6IqC54K5XHJcbiAgICBjb25zdCBzaWJsaW5ndHJlZU5vZGVzRGF0YSA9IHRoaXMuZ2V0Q2hpbGROb2Rlc0RhdGEodHJlZU5vZGVzRGF0YSwgaGllcmFyY2h5SW5mb0tleSwgZkxheWVyLCBmUGF0aCk7XHJcblxyXG4gICAgLy8g5aaC5p6c5rKh5pyJ5YWE5byf6IqC54K577yM5ZCR5LiK5p+l5om+XHJcbiAgICBpZiAoc2libGluZ3RyZWVOb2Rlc0RhdGEubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgIGNvbnN0IHBhcmVudERhdGEgPSB0cmVlTm9kZXNEYXRhLmZpbmQoKGl0ZW1EYXRhOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gaXRlbURhdGFbaGllcmFyY2h5SW5mb0tleV1bJ3BhdGgnXSA9PT0gZlBhdGg7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8g5a2Y5Zyo54i26IqC54K577yM5YiZ6K6+572u54i26IqC54K577ybXHJcbiAgICAgIC8vIOS4jeWtmOWcqOeItuiKgueCue+8jOWImeiuvue9ruesrOS4gOS4quagueiKgueCueOAglxyXG4gICAgICBpZiAoIXBhcmVudERhdGEpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaXJzdE5vZGVJZCh0cmVlTm9kZXNEYXRhLCBoaWVyYXJjaHlJbmZvS2V5KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcGFyZW50RGF0YVsnaWQnXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmdldE5leHRTaWJsaW5nTm9kZUlkKHNpYmxpbmd0cmVlTm9kZXNEYXRhLCBjdXJyZW50SWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5LiL5Liq5YWE5byf6IqC54K555qEaWRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TmV4dFNpYmxpbmdOb2RlSWQoc2libGluZ3RyZWVOb2Rlc0RhdGE6IGFueVtdLCBjdXJyZW50SWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBpZiAoc2libGluZ3RyZWVOb2Rlc0RhdGEubGVuZ3RoIDw9IDEpIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHNpYmxpbmd0cmVlTm9kZXNEYXRhLmZpbmRJbmRleCgoaXRlbURhdGE6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gaXRlbURhdGFbJ2lkJ10gPT09IGN1cnJlbnRJZDtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOacgOWQjuS4gOihjOS4iuenu+S4gOihjO+8jOWFtuS7luS4i+enu+S4gOihjFxyXG4gICAgbGV0IG5leHRJbmRleCA9IC0xO1xyXG4gICAgaWYgKGN1cnJlbnRJbmRleCA9PT0gc2libGluZ3RyZWVOb2Rlc0RhdGEubGVuZ3RoIC0gMSkge1xyXG4gICAgICBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggLSAxO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbmV4dEluZGV4ID0gY3VycmVudEluZGV4ICsgMTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc2libGluZ3RyZWVOb2Rlc0RhdGFbbmV4dEluZGV4XVsnaWQnXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluS4i+e6p+iKgueCueeahEJpbmRpbmdPYmplY3Rz6ZuG5ZCIXHJcbiAgICovXHJcbiAgcHVibGljIGdldENoaWxkTm9kZXNEYXRhKHRyZWVOb2Rlc0RhdGE6IGFueVtdLCBoaWVyYXJjaHlJbmZvS2V5OiBzdHJpbmcsIGZMYXllcjogbnVtYmVyLCBmUGF0aDogc3RyaW5nKTogYW55W10ge1xyXG4gICAgY29uc3QgY2hpbGR0cmVlTm9kZXNEYXRhID0gdHJlZU5vZGVzRGF0YS5maWx0ZXIoKGl0ZW1EYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxheWVyID0gaXRlbURhdGFbaGllcmFyY2h5SW5mb0tleV1bJ2xheWVyJ107XHJcbiAgICAgIGNvbnN0IHBhdGggPSBpdGVtRGF0YVtoaWVyYXJjaHlJbmZvS2V5XVsncGF0aCddO1xyXG4gICAgICByZXR1cm4gKGxheWVyID09PSBmTGF5ZXIgKyAxKSAmJiBwYXRoLnN0YXJ0c1dpdGgoZlBhdGgpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gY2hpbGR0cmVlTm9kZXNEYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WaWTojrflj5boioLngrnmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Tm9kZURhdGFCeUlkKHRyZWVOb2Rlc0RhdGE6IGFueVtdLCBpZDogc3RyaW5nKTogYW55IHtcclxuICAgIGNvbnN0IG5vZGVEYXRhID0gdHJlZU5vZGVzRGF0YS5maW5kKChpdGVtRGF0YTogYW55KSA9PiB7XHJcbiAgICAgIHJldHVybiBpdGVtRGF0YVsnaWQnXSA9PT0gaWQ7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBub2RlRGF0YSA/IG5vZGVEYXRhIDogbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFBhdGhUcmVlTm9kZVV0aWwgfTtcclxuIl19
import { Injectable } from '@angular/core';
// tslint:disable: no-unused-expression
/**
 * 菜单状态服务
 * @scope FormModule
 */
var MenuStateService = /** @class */ (function () {
    function MenuStateService() {
        this.COMMAND_SERVICE_LINK_STORAGE_KEY = 'COMMAND_SERVICE_LINK_STORAGE_KEY';
    }
    MenuStateService.prototype.getState = function () {
        var data = !!sessionStorage && sessionStorage.getItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY) || null;
        if (!!data) {
            return JSON.parse(data);
        }
        return {};
    };
    MenuStateService.prototype.setState = function (links) {
        !!sessionStorage && sessionStorage.setItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY, JSON.stringify(links));
    };
    MenuStateService.prototype.addMenuState = function (parentMenuId, childMenuId, status) {
        if (status === void 0) { status = true; }
        if (!childMenuId) {
            return;
        }
        var state = this.getState();
        var isParentExist = !!state && state.hasOwnProperty(parentMenuId);
        var childItem = { id: childMenuId, status: status };
        if (isParentExist) {
            var parent_1 = state[parentMenuId];
            var isChildItemExist = parent_1.find(function (item) { return item.id === childMenuId; });
            if (!isChildItemExist) {
                state[parentMenuId].push(childItem);
            }
        }
        else {
            state[parentMenuId] = [childItem];
        }
        this.setState(state);
    };
    MenuStateService.prototype.getMenuState = function (parentMenuId, childMenuId) {
        var state = this.getState();
        if (state === null) {
            return null;
        }
        var isParentExist = state.hasOwnProperty(parentMenuId);
        if (!isParentExist) {
            return null;
        }
        var parentMenu = state[parentMenuId];
        var childMenu = parentMenu.filter(function (item) { return item.status === true; });
        if (typeof childMenuId === 'undefined' || childMenuId.length < 1) {
            return childMenu;
        }
        return parentMenu.filter(function (item) { return item.status && item.id === childMenuId; });
    };
    MenuStateService.prototype.updateMenuState = function (childMenuId, status) {
        var state = this.getState();
        if (state === null) {
            return;
        }
        Object.keys(state).forEach(function (key) {
            var childMenu = state[key].find(function (item) { return item.id === childMenuId; });
            if (!!childMenu) {
                childMenu.status = status;
            }
        });
        this.setState(state);
    };
    MenuStateService.prototype.removeMenu = function (menuId) {
        this.removeParentMenu(menuId);
        this.removeChildMenu(menuId);
    };
    MenuStateService.prototype.removeParentMenu = function (menuId) {
        var state = this.getState();
        if (state === null) {
            return null;
        }
        Object.keys(state).forEach(function (item) {
            if (item === menuId && state[menuId].length < 1) {
                delete state[item];
            }
        });
        this.setState(state);
    };
    MenuStateService.prototype.removeChildMenu = function (menuId) {
        var state = this.getState();
        if (state === null) {
            return;
        }
        Object.keys(state).forEach(function (parentMenuId) {
            var childMenus = state[parentMenuId];
            if (childMenus && childMenus.length > 0) {
                childMenus.forEach(function (child, index) {
                    if (child.id === menuId) {
                        childMenus.splice(index, 1);
                    }
                });
            }
        });
        this.setState(state);
    };
    MenuStateService.decorators = [
        { type: Injectable }
    ];
    return MenuStateService;
}());
export { MenuStateService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS1zdGF0ZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL21lbnUtc3RhdGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLHVDQUF1QztBQUN2Qzs7O0dBR0c7QUFDSDtJQUFBO1FBRXFCLHFDQUFnQyxHQUFHLGtDQUFrQyxDQUFDO0lBMkYzRixDQUFDO0lBMUZXLG1DQUFRLEdBQWhCO1FBQ0ksSUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLGNBQWMsSUFBSSxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN2RyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUU7WUFDUixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDM0I7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFDTyxtQ0FBUSxHQUFoQixVQUFpQixLQUFLO1FBQ2xCLENBQUMsQ0FBQyxjQUFjLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzdHLENBQUM7SUFDTSx1Q0FBWSxHQUFuQixVQUFvQixZQUFvQixFQUFFLFdBQW1CLEVBQUUsTUFBc0I7UUFBdEIsdUJBQUEsRUFBQSxhQUFzQjtRQUNqRixJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2QsT0FBTztTQUNWO1FBQ0QsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzlCLElBQU0sYUFBYSxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNwRSxJQUFNLFNBQVMsR0FB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QUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsSUFBSTtZQUMzQixJQUFJLElBQUksS0FBSyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzdDLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3RCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFDTywwQ0FBZSxHQUF2QixVQUF3QixNQUFjO1FBQ2xDLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QixJQUFJLEtBQUssS0FBSyxJQUFJLEVBQUU7WUFDaEIsT0FBTztTQUNWO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQSxZQUFZO1lBQ25DLElBQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN2QyxJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDckMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFDLEtBQUssRUFBRSxLQUFLO29CQUM1QixJQUFJLEtBQUssQ0FBQyxFQUFFLEtBQUssTUFBTSxFQUFFO3dCQUNyQixVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztxQkFDL0I7Z0JBQ0wsQ0FBQyxDQUFDLENBQUM7YUFDTjtRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN6QixDQUFDOztnQkE1RkosVUFBVTs7SUE2RlgsdUJBQUM7Q0FBQSxBQTdGRCxJQTZGQztBQUVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTogbm8tdW51c2VkLWV4cHJlc3Npb25cclxuLyoqXHJcbiAqIOiPnOWNleeKtuaAgeacjeWKoVxyXG4gKiBAc2NvcGUgRm9ybU1vZHVsZVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBNZW51U3RhdGVTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgQ09NTUFORF9TRVJWSUNFX0xJTktfU1RPUkFHRV9LRVkgPSAnQ09NTUFORF9TRVJWSUNFX0xJTktfU1RPUkFHRV9LRVknO1xyXG4gICAgcHJpdmF0ZSBnZXRTdGF0ZSgpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gISFzZXNzaW9uU3RvcmFnZSAmJiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHRoaXMuQ09NTUFORF9TRVJWSUNFX0xJTktfU1RPUkFHRV9LRVkpIHx8IG51bGw7XHJcbiAgICAgICAgaWYgKCEhZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBzZXRTdGF0ZShsaW5rcykge1xyXG4gICAgICAgICEhc2Vzc2lvblN0b3JhZ2UgJiYgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSh0aGlzLkNPTU1BTkRfU0VSVklDRV9MSU5LX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShsaW5rcykpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGFkZE1lbnVTdGF0ZShwYXJlbnRNZW51SWQ6IHN0cmluZywgY2hpbGRNZW51SWQ6IHN0cmluZywgc3RhdHVzOiBib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmICghY2hpbGRNZW51SWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoKTtcclxuICAgICAgICBjb25zdCBpc1BhcmVudEV4aXN0ID0gISFzdGF0ZSAmJiBzdGF0ZS5oYXNPd25Qcm9wZXJ0eShwYXJlbnRNZW51SWQpO1xyXG4gICAgICAgIGNvbnN0IGNoaWxkSXRlbSA9IHsgaWQ6IGNoaWxkTWVudUlkLCBzdGF0dXMgfTtcclxuICAgICAgICBpZiAoaXNQYXJlbnRFeGlzdCkge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBzdGF0ZVtwYXJlbnRNZW51SWRdO1xyXG4gICAgICAgICAgICBjb25zdCBpc0NoaWxkSXRlbUV4aXN0ID0gcGFyZW50LmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSBjaGlsZE1lbnVJZCk7XHJcbiAgICAgICAgICAgIGlmICghaXNDaGlsZEl0ZW1FeGlzdCkge1xyXG4gICAgICAgICAgICAgICAgc3RhdGVbcGFyZW50TWVudUlkXS5wdXNoKGNoaWxkSXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdGF0ZVtwYXJlbnRNZW51SWRdID0gW2NoaWxkSXRlbV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUpO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldE1lbnVTdGF0ZShwYXJlbnRNZW51SWQ6IHN0cmluZywgY2hpbGRNZW51SWQ/OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoKTtcclxuICAgICAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlzUGFyZW50RXhpc3QgPSBzdGF0ZS5oYXNPd25Qcm9wZXJ0eShwYXJlbnRNZW51SWQpO1xyXG4gICAgICAgIGlmICghaXNQYXJlbnRFeGlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyZW50TWVudSA9IHN0YXRlW3BhcmVudE1lbnVJZF07XHJcbiAgICAgICAgY29uc3QgY2hpbGRNZW51ID0gcGFyZW50TWVudS5maWx0ZXIoaXRlbSA9PiBpdGVtLnN0YXR1cyA9PT0gdHJ1ZSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjaGlsZE1lbnVJZCA9PT0gJ3VuZGVmaW5lZCcgfHwgY2hpbGRNZW51SWQubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGRNZW51O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGFyZW50TWVudS5maWx0ZXIoaXRlbSA9PiBpdGVtLnN0YXR1cyAmJiBpdGVtLmlkID09PSBjaGlsZE1lbnVJZCk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgdXBkYXRlTWVudVN0YXRlKGNoaWxkTWVudUlkOiBzdHJpbmcsIHN0YXR1czogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpO1xyXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkTWVudSA9IHN0YXRlW2tleV0uZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGNoaWxkTWVudUlkKTtcclxuICAgICAgICAgICAgaWYgKCEhY2hpbGRNZW51KSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZE1lbnUuc3RhdHVzID0gc3RhdHVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgcmVtb3ZlTWVudShtZW51SWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlUGFyZW50TWVudShtZW51SWQpO1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRNZW51KG1lbnVJZCk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlbW92ZVBhcmVudE1lbnUobWVudUlkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoKTtcclxuICAgICAgICBpZiAoc3RhdGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbSA9PT0gbWVudUlkICYmIHN0YXRlW21lbnVJZF0ubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlW2l0ZW1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlbW92ZUNoaWxkTWVudShtZW51SWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpO1xyXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKHBhcmVudE1lbnVJZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkTWVudXMgPSBzdGF0ZVtwYXJlbnRNZW51SWRdO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRNZW51cyAmJiBjaGlsZE1lbnVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkTWVudXMuZm9yRWFjaCgoY2hpbGQsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLmlkID09PSBtZW51SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRNZW51cy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IE1lbnVTdGF0ZVNlcnZpY2UgfTtcclxuIl19
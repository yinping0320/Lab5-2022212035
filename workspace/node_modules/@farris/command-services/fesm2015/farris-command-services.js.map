{"version":3,"file":"farris-command-services.js.map","sources":["ng://@farris/command-services/lib/form-loading/hide-event.service.ts","ng://@farris/command-services/lib/form-loading/form-loading.service.ts","ng://@farris/command-services/lib/languages/language-message-en.ts","ng://@farris/command-services/lib/languages/language-message-zh.ts","ng://@farris/command-services/lib/languages/language-message-zhft.ts","ng://@farris/command-services/lib/languages/language-message-factory.ts","ng://@farris/command-services/lib/languag.service.ts","ng://@farris/command-services/lib/error/types.ts","ng://@farris/command-services/lib/util/device-ability.ts","ng://@farris/command-services/lib/error/exception_strategy.ts","ng://@farris/command-services/lib/error/exception_strategy_factory.ts","ng://@farris/command-services/lib/util/http.ts","ng://@farris/command-services/lib/error/form-error.service.ts","ng://@farris/command-services/lib/form-message.service.ts","ng://@farris/command-services/lib/form-notify.service.ts","ng://@farris/command-services/lib/form-wizard.service.ts","ng://@farris/command-services/lib/check.service.ts","ng://@farris/command-services/lib/data-check.service.ts","ng://@farris/command-services/lib/event.service.ts","ng://@farris/command-services/lib/menu-state.service.ts","ng://@farris/command-services/lib/router.service.ts","ng://@farris/command-services/lib/types.ts","ng://@farris/command-services/lib/querystring.ts","ng://@farris/command-services/lib/rtf-service.ts","ng://@farris/command-services/lib/navigation-event.service.ts","ng://@farris/command-services/lib/farris-form.service.ts","ng://@farris/command-services/lib/navigation.service.ts","ng://@farris/command-services/lib/data-services/utils/edit-state.util.ts","ng://@farris/command-services/lib/data-services/utils/app-param.util.ts","ng://@farris/command-services/lib/form-notify-strategy.service.ts","ng://@farris/command-services/lib/command-service.ts","ng://@farris/command-services/lib/verify.service.ts","ng://@farris/command-services/lib/validation.service.ts","ng://@farris/command-services/lib/data-change-detection.service.ts","ng://@farris/command-services/lib/data-services/card-data.service.ts","ng://@farris/command-services/lib/navigation-middleware.service.ts","ng://@farris/command-services/lib/grid.middleware.service.ts","ng://@farris/command-services/lib/param.service.ts","ng://@farris/command-services/lib/keybinding-service.ts","ng://@farris/command-services/lib/filter-condition.service.ts","ng://@farris/command-services/lib/ui-state.service.ts","ng://@farris/command-services/lib/state-machine.service.ts","ng://@farris/command-services/lib/binding-data.service.ts","ng://@farris/command-services/lib/application-param.service.ts","ng://@farris/command-services/lib/entity-services/entity-traversing.service.ts","ng://@farris/command-services/lib/entity-services/entity-manipulation.service.ts","ng://@farris/command-services/lib/entity-services/entity-aggregation.service.ts","ng://@farris/command-services/lib/entity-services/entity-list.service.ts","ng://@farris/command-services/lib/entity-services/entity.service.ts","ng://@farris/command-services/lib/binding-path.service.ts","ng://@farris/command-services/lib/form-control.service.ts","ng://@farris/command-services/lib/frame-context.service.ts","ng://@farris/command-services/lib/focus-invalid.service.ts","ng://@farris/command-services/lib/change-item.service.ts","ng://@farris/command-services/lib/service.ts","ng://@farris/command-services/lib/data-grid.service.ts","ng://@farris/command-services/lib/data-services/list-data.service.ts","ng://@farris/command-services/lib/data-services/sub-list-data.service.ts","ng://@farris/command-services/lib/data-services/base-data.service.ts","ng://@farris/command-services/lib/data-services/tree-table/util/parent-tree.util.ts","ng://@farris/command-services/lib/data-services/tree-table/util/path-tree.util.ts","ng://@farris/command-services/lib/data-services/tree-table/util/tree-util-factory.ts","ng://@farris/command-services/lib/data-services/tree-table/repository/parent-tree-repository.ts","ng://@farris/command-services/lib/data-services/tree-table/repository/path-tree-repository.ts","ng://@farris/command-services/lib/data-services/tree-table/repository/tree-repository-factory.ts","ng://@farris/command-services/lib/data-services/tree-data.service.ts","ng://@farris/command-services/lib/data-services/filter-condition-data.service.ts","ng://@farris/command-services/lib/data-services/edit-data.service.ts","ng://@farris/command-services/lib/data-services/remove-data.service.ts","ng://@farris/command-services/lib/data-services/save-data.service.ts","ng://@farris/command-services/lib/data-services/sub-tree-data-service.ts","ng://@farris/command-services/lib/be-action.service.ts","ng://@farris/command-services/lib/approve.service.ts","ng://@farris/command-services/lib/print.service.ts","ng://@farris/command-services/lib/attachment/types.ts","ng://@farris/command-services/lib/attachment/attachment.util.ts","ng://@farris/command-services/lib/attachment/attachment-data.service.ts","ng://@farris/command-services/lib/attachment/attachment.service.ts","ng://@farris/command-services/lib/attachment/file.service.ts","ng://@farris/command-services/lib/dialog.service.ts","ng://@farris/command-services/lib/sidebar-service.ts","ng://@farris/command-services/lib/filter-service.ts","ng://@farris/command-services/lib/component-manager.service.ts","ng://@farris/command-services/lib/authority/authority.service.ts","ng://@farris/command-services/lib/authority/authority.ts","ng://@farris/command-services/lib/exception.handler.ts","ng://@farris/command-services/lib/providers/legacy_providers.ts","ng://@farris/command-services/lib/user-settings.service.ts","ng://@farris/command-services/lib/work-flow/work-flow-message.service.ts","ng://@farris/command-services/lib/work-flow/work-flow-message.ts","ng://@farris/command-services/lib/work-flow/work-flow-message.handler.ts","ng://@farris/command-services/lib/providers/module_providers.ts","ng://@farris/command-services/lib/query-solution/enum/compare-type.enum.ts","ng://@farris/command-services/lib/query-solution/enum/value-type.enum.ts","ng://@farris/command-services/lib/query-solution/enum/relation-type.enum.ts","ng://@farris/command-services/lib/query-solution/handlers/text.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/daterage.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/dropdown.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/numberrage.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/smarthelp.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-year.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/checkbox.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-month.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/monthrange.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-date-time.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-number.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-date.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/combolookup.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/radio.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/inputgroup.handler.ts","ng://@farris/command-services/lib/query-solution/querycondition.handler.factory.ts","ng://@farris/command-services/lib/query-solution/query-solution.service.ts","ng://@farris/command-services/lib/end-edit.service.ts","ng://@farris/command-services/lib/remote-summary.service.ts","ng://@farris/command-services/lib/batch-edit.service.ts","ng://@farris/command-services/lib/discussion-group.service.ts","ng://@farris/command-services/lib/list-filter/list-filter.service.ts","ng://@farris/command-services/lib/manifest/form_manifest_service.ts","ng://@farris/command-services/lib/manifest/form_expression_manifest_service.ts","ng://@farris/command-services/lib/localization.service.ts","ng://@farris/command-services/lib/form-attention.service.ts","ng://@farris/command-services/lib/feature-edit/feature-repository.ts","ng://@farris/command-services/lib/feature-edit/types.ts","ng://@farris/command-services/lib/feature-edit/feature-data.service.ts","ng://@farris/command-services/lib/feature-edit/feature-edit.service.ts","ng://@farris/command-services/lib/expression_service.ts","ng://@farris/command-services/lib/dirty-checking.service.ts","ng://@farris/command-services/lib/pop_up.service.ts","ng://@farris/command-services/lib/form.service.ts","ng://@farris/command-services/lib/view-model.service.ts","ng://@farris/command-services/lib/pagination.service.ts","ng://@farris/command-services/lib/providers/frame_providers.ts","ng://@farris/command-services/lib/providers/dynamic_providers.ts","ng://@farris/command-services/lib/command-services-module.ts","ng://@farris/command-services/lib/rtf-message/message-pipe.ts","ng://@farris/command-services/lib/rtf-message/message-pipe-service.ts","ng://@farris/command-services/lib/back_end_message_handler.ts","ng://@farris/command-services/public-api.ts","ng://@farris/command-services/farris-command-services.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\n\r\n/**\r\n * åéæ¶æ¯ç»FormLoadingServiceï¼\r\n * ä½¿å¶æ¥æ¶åè°ç¨hide()å½æ°\r\n * æ­¤æå¡ä»ç¨äºå¤çHttpå¼å¸¸\r\n */\r\n@Injectable()\r\nclass HideEventService {\r\n    public hideEvent = new Subject<any>();\r\n}\r\n\r\nexport { HideEventService };","import { Injectable, SkipSelf, Optional } from '@angular/core';\r\nimport { LoadingService, LoadingConfig, LoadingComponent } from '@farris/ui-loading';\r\nimport { HideEventService } from './hide-event.service';\r\nimport { AppContext, FrameContext } from '@farris/devkit';\r\n// tslint:disable: no-string-literal\r\n/**\r\n * å è½½æç¤ºHelper\r\n * 1ãåè£@farris/uiçLoadingServiceï¼\r\n * 2ãæä¾éå¯¹è¡¨åçå¿«æ·æ¹æ³ï¼\r\n */\r\n@Injectable()\r\nclass FormLoadingService {\r\n  private static isSuspend = false;\r\n  /**\r\n   * å è½½ä¸­ç»ä»¶å®ä¾\r\n   */\r\n  private loadingCmp: LoadingComponent;\r\n\r\n  /**\r\n   * å»¶è¿loadingå®æ¶å¨\r\n   */\r\n  private loadingTimerIds: any[] = [];\r\n\r\n  /**\r\n   * å¼ºå¶æ¾ç¤ºï¼ä¸è½éè\r\n   */\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * æ³¨å¥@farris/uiçLoadingService\r\n   */\r\n  constructor(\r\n    private loadingService: LoadingService,\r\n    @Optional() private hideEventService: HideEventService,\r\n    @Optional() private applicationContext: AppContext,\r\n  ) {\r\n    if (hideEventService) {\r\n      this.hideEventService.hideEvent.subscribe(\r\n        result => {\r\n          this.hide();\r\n        }\r\n      );\r\n    }\r\n  }\r\n  public setSuspend(flag: boolean) {\r\n    FormLoadingService.isSuspend = flag;\r\n  }\r\n  /**\r\n   * æ¾ç¤ºå è½½ä¸­\r\n   */\r\n  public show(configOrMessage?: any): LoadingComponent {\r\n    if (FormLoadingService.isSuspend === true) {\r\n      return;\r\n    }\r\n    if (this.loadingCmp) {\r\n      this.loadingCmp.close();\r\n      this.loadingCmp = null;\r\n    }\r\n    this.registerService();\r\n    const loadingConfig = this.buildLoadingConfig(configOrMessage);\r\n    this.loadingCmp = this.loadingService.show(loadingConfig);\r\n    return this.loadingCmp;\r\n  }\r\n\r\n  /**\r\n   * å»¶è¿æ¾ç¤ºLoading\r\n   */\r\n  public showLoadingWithDelay(delayTime: number, configOrMessage?: any): any {\r\n    // this.show(configOrMessage);\r\n    const timerId = setTimeout(() => {\r\n      this.show(configOrMessage);\r\n    }, delayTime);\r\n    this.loadingTimerIds.push(timerId);\r\n    this.registerService();\r\n    return timerId;\r\n  }\r\n\r\n  /**\r\n   * éèå»¶è¿çLoading\r\n   */\r\n  public hideDelayLoading(timerIdToClear: any) {\r\n    this.clearLoadingTimer(timerIdToClear);\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * æé LoadingConfig\r\n   * @param configOrMessage éç½®å¯¹è±¡ææ¶æ¯å­ç¬¦ä¸²\r\n   */\r\n  private buildLoadingConfig(configOrMessage: any): LoadingConfig {\r\n    let loadingConfig: LoadingConfig;\r\n    if (!!configOrMessage) {\r\n      if (typeof configOrMessage === 'object') {\r\n        loadingConfig = configOrMessage;\r\n      } else {\r\n        loadingConfig = { 'message': configOrMessage };\r\n      }\r\n    } else {\r\n      loadingConfig = {};\r\n    }\r\n    if (!loadingConfig.hasOwnProperty('delay')) {\r\n      loadingConfig.delay = 0;\r\n    }\r\n    return loadingConfig;\r\n  }\r\n\r\n  /**\r\n   * å³é­ææloading\r\n   */\r\n  public clearAll() {\r\n    FormLoadingService.isSuspend = false;\r\n    window.setTimeout(() => {\r\n      this.loadingService.clearAll();\r\n    }, 350);\r\n    this.loadingCmp = null;\r\n    this.clearAllLoadingTimers();\r\n    this.destroy();\r\n  }\r\n\r\n  /**\r\n   * æ¸ç©ºLoadingå®æ¶å¨\r\n   */\r\n  private clearLoadingTimer(timerIdToClear: any) {\r\n    clearTimeout(timerIdToClear);\r\n    this.loadingTimerIds = this.loadingTimerIds.filter((timerId: any) => {\r\n      return timerId !== timerIdToClear;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * æ¸ç©ºææLoadingå®æ¶å¨\r\n   */\r\n  private clearAllLoadingTimers() {\r\n    this.loadingTimerIds.forEach((timerId: any) => {\r\n      this.clearLoadingTimer(timerId);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * éèå è½½ä¸­\r\n   */\r\n  public hide() {\r\n    if (!this.loadingCmp) {\r\n      this.destroy();\r\n      return;\r\n    }\r\n    if (FormLoadingService.isSuspend === true) {\r\n      return;\r\n    }\r\n    this.loadingCmp.close();\r\n    this.loadingCmp = null;\r\n    this.destroy();\r\n  }\r\n  /**\r\n   * éæ¯loadingService\r\n   */\r\n  public destroy() {\r\n    if (FormLoadingService.isSuspend === true) {\r\n      return;\r\n    }\r\n    const services: any[] = window['DEVKIT_LOADING_SERVICE'] || [];\r\n    if (services && Array.isArray(services) && services.length > 0) {\r\n      services.forEach((service: FormLoadingService) => {\r\n        if (service) {\r\n          service.clearAllLoadingTimers();\r\n          if (service.loadingCmp) {\r\n            service.loadingCmp.close();\r\n            service.loadingCmp = null;\r\n        }\r\n        }\r\n      });\r\n    }\r\n    window['DEVKIT_LOADING_SERVICE'] = [];\r\n  }\r\n\r\n  /**\r\n   * æ³¨åææçLoadingServiceå®ä¾\r\n   */\r\n  private registerService() {\r\n    const services: any[] = window['DEVKIT_LOADING_SERVICE'] || [];\r\n    services.push(this);\r\n    window['DEVKIT_LOADING_SERVICE'] = services;\r\n  }\r\n}\r\n\r\n\r\nexport { FormLoadingService };\r\n","\r\nimport { LanguageMessage } from './language-message';\r\n\r\n/**\r\n * è±æè¯­è¨æ¶æ¯\r\n */\r\nclass LanguageMessageForEn implements LanguageMessage {\r\n  yes = 'Yes';\r\n  no = 'No';\r\n  unsaveNotifyTitle = 'Exist unsave record. Do save operation or not?';\r\n  clientNotifyTitle = 'System Prompt In The Frontend';\r\n  serverNotifyTitle = 'System Prompt In The Backend';\r\n  cancelApproveSuccess = 'Cancel Approve Success';\r\n  cancelApproveFailed = 'Cancel Approve Failed';\r\n  unallowEmptyProcessInstanceName = 'Process Instance Name Can Not Be Empty';\r\n  unallowEmptyBizBillId = 'Biz Bill Id Can Not Be Empty';\r\n  unallowEmptyChildBizBillId = 'Child Biz Bill Id Can Not Be Empty';\r\n  bizDefKeyRequired = 'Biz Def Key can\\'t be empty.';\r\n  procInsIdRequired = 'Process instance Id can\\'t be empty.';\r\n  addChildFailed = 'Add Child Failed';\r\n  addSiblingFailed = 'Add Sibling Failed';\r\n  addSubChildFailed = 'Add Sub Child Failed';\r\n  addSubSiblingFailed = 'Add Sub Sibling Failed';\r\n  deleteFailed = 'Delete Failed';\r\n  multiSaveFailed = 'MultiSave Failed';\r\n  appendFailed = 'Append Failed';\r\n  queryFailed = 'Query Failed';\r\n  cancelFailed = 'Cancel Failed';\r\n  updateFailed = 'Update Failed';\r\n  addFailed = 'Add Failed';\r\n  loadFailed = 'Load Failed';\r\n  saveSuccess = 'Successfully saved!';\r\n  saveFailed = 'Save failed!';\r\n  deleteSuccess = 'Successfully deleted!';\r\n  deleteFaild = 'Failed to delete!';\r\n  confirmDeletion = 'Confirm deletion?';\r\n  submitSuccess = 'Submit successfully!';\r\n  submitFaild = 'Submit failed!';\r\n  notifyTitle = 'System prompt';\r\n  httpError = 'HTTP request error! Please check the server error!';\r\n  gridDataNotSave = 'The current page data is not saved. Turning the page will result in data loss. Do you want to continue turning the page?';\r\n  exitWithoutSave = 'There is unsaved data. Do you want to continue closing?';\r\n  notSupportMenuType = 'Not supported menu type!';\r\n  cancelWithoutSave = 'Exist unsaved change,Confirm to cancel?';\r\n  plsSelectDeleteData = 'Please select the data to delete!';\r\n  errorHierarchyKey = 'Incorrect ierarchy key';\r\n  plsSelectParentNode = 'Please select parent node!';\r\n  deleteChildFirst = 'Please delete the child nodes first!';\r\n  incorrectHierarchyConfig = 'Hierarchy config is incorrect!';\r\n  operationFailed = 'The operation failed.';\r\n  plsSelectEditData = 'Please select the data you want to edit!';\r\n  plsSelectViewData = 'Please select the data you want to view!';\r\n  plsUploadFirst = 'Please upload attachment first!';\r\n  defaultDialogTitle = 'Dialog';\r\n  public changeToFirst = 'The first data.';\r\n  public changeToLast = 'The last data.';\r\n  public noProcessInstanceId = 'Please provide the process instance id.';\r\n  public noDataExist = 'Data does not exist to access the edit state!';\r\n  public noAttachment = 'There are no attachments to preview.';\r\n  public confirm = 'Confirm';\r\n  public cancel = 'Cancel';\r\n  public plsSelectCopyData = 'Please select the data you want to copy!';\r\n  public copyFieldsRequired = 'The copy fields can`t be empty!';\r\n  public pathIsRequired = 'The request url can`t be empty!';\r\n  public propsIsEmpty = 'The material has no props!';\r\n  public historyAttachment = 'The history attachment can`t be delete!';\r\n  public plsSelectDownloadAtt = 'Please select the attachment you want to download!';\r\n  public noDownloadAtt = 'There are no attachments to download!';\r\n  public plsCheckBatchEditRows = 'Please check the rows you want to edit!';\r\n  public plsSelectDetailFormData = 'Please select a detail form data first!';\r\n  public dataAndStateChanged = 'Are you sure you want to load the new data and switch to $1 state?';\r\n  public dataChanged = 'Are you sure you want to load the data and discards the current modification?';\r\n  public stateChanged = 'Are you sure you want to switch $1 state?';\r\n  public defaultStateName = 'init';\r\n  public copy = 'Copy detail message';\r\n  public copySuccess = 'Copy success';\r\n  public copyFailed = 'Copy failed';\r\n  public roger = 'Roger';\r\n  public appOrFuncIdRequired = 'No menu or application parameters are configured, please configure them in the designer.';\r\n  public tableCanNotEmpty = 'can not empty.';\r\n  public plsSelectRemoveAtt = 'Please select the attachment to delete!';\r\n  public plsSelectUpdateRow = 'Please select the row where you want to update the attachment!';\r\n}\r\n\r\nexport { LanguageMessageForEn };\r\n","import { LanguageMessage } from './language-message';\r\n\r\n/**\r\n * è±æè¯­è¨æ¶æ¯\r\n */\r\nclass LanguageMessageForZh implements LanguageMessage {\r\n  public yes = 'æ¯';\r\n  public no = 'å¦';\r\n  public unsaveNotifyTitle = 'å­å¨æªä¿å­è®°å½ãæ¯å¦è¦ä¿å­ï¼';\r\n  public clientNotifyTitle = 'åç«¯å¼å¸¸æç¤º';\r\n  public serverNotifyTitle = 'æå¡å¨ç«¯å¼å¸¸æç¤º';\r\n  public cancelApproveSuccess = 'åæ¶æäº¤æåï¼';\r\n  public cancelApproveFailed = 'åæ¶æäº¤å¤±è´¥ï¼';\r\n  public unallowEmptyProcessInstanceName = 'æµç¨å®ä¾åç§°ä¸è½ä¸ºç©º';\r\n  public unallowEmptyBizBillId = 'è¯·éæ©ä¸æ¡æ°æ®';\r\n  public bizDefKeyRequired = 'å¥å£åæ®ä¸è½ä¸ºç©º';\r\n  public unallowEmptyChildBizBillId = 'ä»è¡¨ä¸å¡åæ®ç¼å·ä¸è½ä¸ºç©ºï¼';\r\n  public procInsIdRequired = 'æµç¨å®ä¾Idä¸è½ä¸ºç©ºï¼';\r\n  public addChildFailed = 'æ°å¢å­çº§å¤±è´¥';\r\n  public addSiblingFailed = 'æ°å¢åçº§å¤±è´¥';\r\n  public addSubChildFailed = 'æ°å¢ä»è¡¨å­çº§å¤±è´¥';\r\n  public addSubSiblingFailed = 'æ°å¢ä»è¡¨åçº§å¤±è´¥';\r\n  public deleteFailed = 'å é¤å¤±è´¥';\r\n  public multiSaveFailed = 'æ¹éä¿å­å¤±è´¥';\r\n  public appendFailed = 'è¿½å å¤±è´¥';\r\n  public queryFailed = 'æ¥è¯¢å¤±è´¥';\r\n  public cancelFailed = 'åæ¶å¤±è´¥';\r\n  public updateFailed = 'æ´æ°å¤±è´¥';\r\n  public addFailed = 'æ°å¢å¤±è´¥';\r\n  public loadFailed = 'å è½½å¤±è´¥';\r\n  public saveSuccess = 'ä¿å­æåï¼';\r\n  public saveFailed = 'ä¿å­å¤±è´¥ï¼';\r\n  public deleteSuccess = 'å é¤æåï¼';\r\n  public deleteFaild = 'å é¤å¤±è´¥ï¼';\r\n  public confirmDeletion = 'ç¡®è®¤å é¤ï¼';\r\n  public submitSuccess = 'æäº¤å®¡æ¹æåï¼';\r\n  public submitFaild = 'æäº¤å®¡æ¹å¤±è´¥ï¼';\r\n  public notifyTitle = 'ç³»ç»æç¤º';\r\n  public httpError = 'HTTPè¯·æ±éè¯¯ï¼è¯·æ£æ¥Serverç«¯éè¯¯ï¼';\r\n  public gridDataNotSave = 'å½åé¡µæ°æ®æªä¿å­ï¼ç¿»é¡µå°å¯¼è´æ°æ®ä¸¢å¤±ï¼æ¯å¦ç»§ç»­ç¿»é¡µï¼';\r\n  public exitWithoutSave = 'å­å¨æªä¿å­çæ°æ®ï¼æ¯å¦ç»§ç»­å³é­ï¼';\r\n  public notSupportMenuType = 'å³é­çæ¢ä¸æ¯èåä¹ä¸æ¯åºç¨ã';\r\n  public cancelWithoutSave = 'å­å¨æªä¿å­çåæ´ï¼ç¡®è®¤åæ¶ï¼';\r\n  public plsSelectDeleteData = 'è¯·éæ©è¦å é¤çæ°æ®ï¼';\r\n  public errorHierarchyKey = 'éè¯¯çåçº§ç ';\r\n  public plsSelectParentNode = 'è¯·éæ©ç¶èç¹';\r\n  public deleteChildFirst = 'è¯·åå é¤å­èç¹';\r\n  public incorrectHierarchyConfig = 'åçº§ç éç½®ä¿¡æ¯éè¯¯';\r\n  public operationFailed = 'æä½æ§è¡å¤±è´¥ã';\r\n  public plsSelectEditData = 'è¯·éæ©è¦ç¼è¾çæ°æ®ï¼';\r\n  public plsSelectViewData = 'è¯·éæ©è¦æ¥ççæ°æ®ï¼';\r\n  public plsUploadFirst = 'è¯·åä¸ä¼ éä»¶ï¼';\r\n  public defaultDialogTitle = 'å¼¹çª';\r\n  public changeToFirst = 'å·²å°è¾¾ç¬¬ä¸æ¡æ°æ®';\r\n  public changeToLast = 'å·²å°è¾¾æåä¸æ¡æ°æ®';\r\n  public noProcessInstanceId = 'è¯·æå®æµç¨å®ä¾æ è¯ã';\r\n  public noDataExist = 'è¦ç¼è¾çæ°æ®ä¸å­å¨ï¼æ æ³è¿å¥ç¼è¾ç¶æï¼';\r\n  public noAttachment = 'æ²¡æå¯ä»¥é¢è§çéä»¶ã';\r\n  public confirm = 'ç¡®å®';\r\n  public cancel = 'åæ¶';\r\n  public plsSelectCopyData = 'è¯·éæ©è¦å¤å¶çæ°æ®ï¼';\r\n  public copyFieldsRequired = 'è¦å¤å¶çå­æ®µä¸è½ä¸ºç©ºï¼';\r\n  public pathIsRequired = 'è¯·æ±è·¯å¾ä¸è½ä¸ºç©ºï¼';\r\n  public propsIsEmpty = 'æ²¡æå¯ä»¥ç¼è¾çç©æç¹å¾ï¼';\r\n  public historyAttachment = 'åå²çæ¬éä»¶ç¦æ­¢å é¤ï¼';\r\n  public plsSelectDownloadAtt = 'è¯·éæ©è¦ä¸è½½çéä»¶!';\r\n  public noDownloadAtt = 'æ¾ä¸å°è¦ä¸è½½çéä»¶!'\r\n  public plsCheckBatchEditRows = 'è¯·å¾éè¦æ¹éç¼è¾çè¡ï¼';\r\n  public plsSelectDetailFormData = 'è¯·åéæ©ä¸æ¡ä»è¡¨æ°æ®ï¼';\r\n  public dataAndStateChanged = 'ç¡®å®è¦å è½½æ°æ®å¹¶åæ¢å°$1ç¶æï¼';\r\n  public dataChanged = 'ç¡®å®è¦å è½½æ°æ®å¹¶æ¾å¼å½åä¿®æ¹ï¼';\r\n  public stateChanged = 'ç¡®å®è¦åæ¢å°$1ç¶æï¼';\r\n  public defaultStateName = 'åå§';\r\n  public copy = 'å¤å¶è¯¦ç»ä¿¡æ¯';\r\n  public copySuccess = 'å¤å¶æå';\r\n  public copyFailed = 'å¤å¶å¤±è´¥';\r\n  public roger = 'ç¥éäº';\r\n  public appOrFuncIdRequired = 'æªéç½®èåæåºç¨åæ°ï¼è¯·å¨è®¾è®¡å¨ä¸­éç½®ã';\r\n  public tableCanNotEmpty = 'ä¸è½ä¸ºç©ºã';\r\n  public plsSelectRemoveAtt = 'è¯·éæ©è¦å é¤çéä»¶!';\r\n  public plsSelectUpdateRow = 'è¯·éæ©è¦æ´æ°éä»¶çè¡ï¼';\r\n}\r\n\r\nexport { LanguageMessageForZh };\r\n","import { LanguageMessage } from './language-message';\r\n\r\n/**\r\n * ç¹ä½ä¸­æè¯­è¨æ¶æ¯\r\n */\r\nclass LanguageMessageForZhft implements LanguageMessage {\r\n  public yes = 'æ¯';\r\n  public no = 'å¦';\r\n  public unsaveNotifyTitle = 'å­å¨æªä¿å­è¨éãæ¯å¦è¦ä¿å­ï¼';\r\n  public clientNotifyTitle = 'åç«¯ç°å¸¸æç¤º';\r\n  public serverNotifyTitle = 'æåå¨ç«¯ç°å¸¸æç¤º';\r\n  public cancelApproveSuccess = 'åæ¶æäº¤æåï¼';\r\n  public cancelApproveFailed = 'åæ¶æäº¤å¤±æï¼';\r\n  public unallowEmptyProcessInstanceName = 'æµç¨å¯¦ä¾åç¨±ä¸è½çºç©º';\r\n  public unallowEmptyBizBillId = 'è«é¸æå£¹æ¢æ¸æ';\r\n  public bizDefKeyRequired = 'å¥å£å®æä¸è½çºç©º';\r\n  public unallowEmptyChildBizBillId = 'å¾è¡¨æ¥­åå®æç·¨èä¸è½çºç©ºï¼';\r\n  public procInsIdRequired = 'æµç¨å¯¦ä¾idä¸è½çºç©ºï¼';\r\n  public addChildFailed = 'æ°å¢å­ç´å¤±æ';\r\n  public addSiblingFailed = 'æ°å¢åç´å¤±æ';\r\n  public addSubChildFailed = 'æ°å¢å¾è¡¨å­ç´å¤±æ';\r\n  public addSubSiblingFailed = 'æ°å¢å¾è¡¨åç´å¤±æ';\r\n  public deleteFailed = 'åªé¤å¤±æ';\r\n  public multiSaveFailed = 'æ¹éä¿å­å¤±æ';\r\n  public appendFailed = 'è¿½å å¤±æ';\r\n  public queryFailed = 'æ¥è©¢å¤±æ';\r\n  public cancelFailed = 'åæ¶å¤±æ';\r\n  public updateFailed = 'æ´æ°å¤±æ';\r\n  public addFailed = 'æ°å¢å¤±æ';\r\n  public loadFailed = 'å è¼å¤±æ';\r\n  public saveSuccess = 'ä¿å­æåï¼';\r\n  public saveFailed = 'ä¿å­å¤±æï¼';\r\n  public deleteSuccess = 'åªé¤æåï¼';\r\n  public deleteFaild = 'åªé¤å¤±æï¼';\r\n  public confirmDeletion = 'ç¢ºèªåªé¤ï¼';\r\n  public submitSuccess = 'æäº¤å¯©æ¹æåï¼';\r\n  public submitFaild = 'æäº¤å¯©æ¹å¤±æï¼';\r\n  public notifyTitle = 'ç³»çµ±æç¤º';\r\n  public httpError = 'HTTPè«æ±é¯èª¤ï¼è«æª¢æ¥Serverç«¯é¯èª¤ï¼';\r\n  public gridDataNotSave = 'ç¶åé æ¸ææªä¿å­ï¼ç¿»é å°å°è´æ¸æä¸å¤±ï¼æ¯å¦ç¹¼çºç¿»é ï¼';\r\n  public exitWithoutSave = 'å­å¨æªä¿å­çæ¸æï¼æ¯å¦ç¹¼çºééï¼';\r\n  public notSupportMenuType = 'ééçæ¢ä¸æ¯èå®ä¹ä¸æ¯æç¨ã';\r\n  public cancelWithoutSave = 'å­å¨æªä¿å­çè®æ´ï¼ç¢ºèªåæ¶ï¼';\r\n  public plsSelectDeleteData = 'è«é¸æè¦åªé¤çæ¸æï¼';\r\n  public errorHierarchyKey = 'é¯èª¤çåç´ç¢¼';\r\n  public plsSelectParentNode = 'è«é¸æç¶ç¯é»';\r\n  public deleteChildFirst = 'è«ååªé¤å­ç¯é»';\r\n  public incorrectHierarchyConfig = 'åç´ç¢¼éç½®ä¿¡æ¯é¯èª¤';\r\n  public operationFailed = 'æä½å·è¡å¤±æã';\r\n  public plsSelectEditData = 'è«é¸æè¦ç·¨è¼¯çæ¸æï¼';\r\n  public plsSelectViewData = 'è«é¸æè¦æ¥ççæ¸æï¼';\r\n  public plsUploadFirst = 'è«åä¸å³éä»¶ï¼';\r\n  public defaultDialogTitle = 'å½çª';\r\n  public changeToFirst = 'å·²å°éç¬¬å£¹æ¢æ¸æ';\r\n  public changeToLast = 'å·²å°éæå¾å£¹æ¢æ¸æ';\r\n  public noProcessInstanceId = 'è«æå®æµç¨å¯¦ä¾æ¨è­ã';\r\n  public noDataExist = 'è¦ç·¨è¼¯çæ¸æä¸å­å¨ï¼ç¡æ³é²å¥ç·¨è¼¯çæï¼';\r\n  public noAttachment = 'æ²æå¯ä»¥é è¦½çéä»¶ã';\r\n  public confirm = 'ç¢ºå®';\r\n  public cancel = 'åæ¶';\r\n  public plsSelectCopyData = 'è«é¸æè¦å¾©å¶çæ¸æï¼';\r\n  public copyFieldsRequired = 'è¦å¾©å¶çå­æ®µä¸è½çºç©ºï¼';\r\n  public pathIsRequired = 'è«æ±è·¯å¾ä¸è½çºç©ºï¼';\r\n  public propsIsEmpty = 'æ²æå¯ä»¥ç·¨è¼¯çç©æç¹å¾ï¼';\r\n  public historyAttachment = 'æå²çæ¬éä»¶ç¦æ­¢åªé¤ï¼';\r\n  public plsSelectDownloadAtt = 'è«é¸æè¦ä¸è¼çéä»¶!';\r\n  public noDownloadAtt = 'æ¾ä¸å°è¦ä¸è¼çéä»¶ï¼';\r\n  public plsCheckBatchEditRows = 'è«å¾é¸è¦æ¹éç·¨è¼¯çè¡ï¼';\r\n  public plsSelectDetailFormData = 'è«åé¸æä¸æ¢å¾è¡¨æ¸æï¼';\r\n  public dataAndStateChanged = 'ç¢ºå®è¦å è¼æ¸æä¸¦åæå°$1çæï¼';\r\n  public dataChanged = 'ç¢ºå®è¦å è¼æ¸æä¸¦æ¾æ£ç¶åä¿®æ¹ï¼';\r\n  public stateChanged = 'ç¢ºå®è¦åæå°$1çæï¼';\r\n  public defaultStateName = 'åå§';\r\n  public copy = 'å¾©å¶è©³ç´°ä¿¡æ¯';\r\n  public copySuccess = 'å¾©å¶æå';\r\n  public copyFailed = 'å¾©å¶å¤±æ';\r\n  public roger = 'ç¥éäº';\r\n  public appOrFuncIdRequired = 'æªéç½®èå®ææç¨åæ¸ï¼è«å¨è¨­è¨å¨ä¸­éç½®ã';\r\n  public tableCanNotEmpty = 'ä¸è½çºç©ºã';\r\n  public plsSelectRemoveAtt = 'è«é¸æè¦åªé¤çéä»¶!';\r\n  public plsSelectUpdateRow = 'è«é¸ææ´æ°éä»¶çè¡ï¼';\r\n}\r\n\r\nexport { LanguageMessageForZhft };\r\n","import { LanguageMessage } from './language-message';\r\nimport { LanguageMessageForZh } from './language-message-zh';\r\nimport { LanguageMessageForEn } from './language-message-en';\r\nimport { LanguageMessageForZhft } from './language-message-zhft';\r\nclass LanguageMessageFactory {\r\n\r\n  private static languageMessageMap: Map<string, LanguageMessage> = new Map<string, LanguageMessage>();\r\n\r\n  /**\r\n   * Create an instance by language\r\n   */\r\n  public static create(language: string): LanguageMessage {\r\n    if (this.languageMessageMap.has(language) === true) {\r\n      return this.languageMessageMap.get(language);\r\n    }\r\n\r\n    let languageMessage: LanguageMessage;\r\n    switch (language) {\r\n      case 'zh-CHS':\r\n        languageMessage = new LanguageMessageForZh();\r\n        break;\r\n      case 'en':\r\n        languageMessage = new LanguageMessageForEn();\r\n        break;\r\n      case 'zh-CHT':\r\n        languageMessage = new LanguageMessageForZhft();\r\n        break;\r\n      default:\r\n        languageMessage = new LanguageMessageForZh();\r\n        break;\r\n    }\r\n    this.languageMessageMap.set(language, languageMessage);\r\n\r\n    return languageMessage;\r\n  }\r\n}\r\n\r\nexport { LanguageMessageFactory };\r\n","import { Injectable, LOCALE_ID, Optional, Inject } from '@angular/core';\r\nimport { LanguageMessage, LanguageMessageFactory } from './languages/index';\r\n\r\n\r\n/**\r\n * å¤è¯­è¨æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass LanguageService implements LanguageMessage {\r\n\r\n  /**\r\n   * åä¾å¯¹è±¡\r\n   */\r\n  private static innerInstance: LanguageService = null;\r\n\r\n  // #region å®ç°LanguageMessageæ¥å£ï¼æ¹ä¾¿ä¹¦å\r\n  public yes: string;\r\n  public no: string;\r\n  public unsaveNotifyTitle: string;\r\n  public clientNotifyTitle: string;\r\n  public serverNotifyTitle: string;\r\n  public cancelApproveSuccess: string;\r\n  public cancelApproveFailed: string;\r\n  public unallowEmptyProcessInstanceName: string;\r\n  public unallowEmptyBizBillId: string;\r\n  public unallowEmptyChildBizBillId: string;\r\n  public bizDefKeyRequired: string;\r\n  public procInsIdRequired: string;\r\n  public addChildFailed: string;\r\n  public addSiblingFailed: string;\r\n  public addSubChildFailed: string;\r\n  public addSubSiblingFailed: string;\r\n  public deleteFailed: string;\r\n  public multiSaveFailed: string;\r\n  public appendFailed: string;\r\n  public queryFailed: string;\r\n  public cancelFailed: string;\r\n  public updateFailed: string;\r\n  public addFailed: string;\r\n  public loadFailed: string;\r\n  public saveSuccess: string;\r\n  public saveFailed: string;\r\n  public deleteSuccess: string;\r\n  public deleteFaild: string;\r\n  public confirmDeletion: string;\r\n  public submitSuccess: string;\r\n  public submitFaild: string;\r\n  public notifyTitle: string;\r\n  public httpError: string;\r\n  public gridDataNotSave: string;\r\n  public exitWithoutSave: string;\r\n  public notSupportMenuType: string;\r\n  public cancelWithoutSave: string;\r\n  public plsSelectDeleteData: string;\r\n  public errorHierarchyKey: string;\r\n  public plsSelectParentNode: string;\r\n  public deleteChildFirst: string;\r\n  public incorrectHierarchyConfig: string;\r\n  public operationFailed: string;\r\n  public plsSelectEditData: string;\r\n  public plsSelectViewData: string;\r\n  public plsUploadFirst: string;\r\n  public defaultDialogTitle: string;\r\n  public changeToFirst: string;\r\n  public changeToLast: string;\r\n  public noProcessInstanceId: string;\r\n  public noDataExist: string;\r\n  public noAttachment: string;\r\n  public confirm: string;\r\n  public cancel: string;\r\n  public plsSelectCopyData: string;\r\n  public copyFieldsRequired: string;\r\n  public pathIsRequired: string;\r\n  public propsIsEmpty: string;\r\n  public historyAttachment: string;\r\n  public plsSelectDownloadAtt: string;\r\n  public noDownloadAtt: string;\r\n  public plsCheckBatchEditRows: string;\r\n  public plsSelectDetailFormData: string;\r\n  public dataAndStateChanged: string;\r\n  public dataChanged: string;\r\n  public stateChanged: string;\r\n  public defaultStateName: string;\r\n  public copy: string;\r\n  public copySuccess: string;\r\n  public copyFailed: string;\r\n  public roger: string;\r\n  public appOrFuncIdRequired: string;\r\n  public tableCanNotEmpty: string;\r\n  public plsSelectRemoveAtt: string;\r\n  public plsSelectUpdateRow: string;\r\n  // #endregion\r\n\r\n  /**\r\n   * å½åè¯­è¨\r\n   */\r\n  protected language = 'zh-CHS';\r\n\r\n  /**\r\n   * å½åè¯­è¨å\r\n   */\r\n  protected get languageMessage(): LanguageMessage {\r\n    return LanguageMessageFactory.create(this.language);\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(@Optional() @Inject(LOCALE_ID) localeId?: string) {\r\n    this.language = localeId || 'zh-CHS';\r\n    this.extendProperties();\r\n    LanguageService.innerInstance = this;\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä¾\r\n   */\r\n  public static getInstance() {\r\n    if (this.innerInstance) {\r\n      return this.innerInstance;\r\n    }\r\n    const instance = new LanguageService('zh-CHS');\r\n    LanguageService.innerInstance = instance;\r\n    return instance;\r\n  }\r\n\r\n  /**\r\n   * æ©å±å±æ§\r\n   */\r\n  private extendProperties() {\r\n    Object.keys(this.languageMessage).forEach((propName: string) => {\r\n      Object.defineProperty(this, propName, {\r\n        get: () => {\r\n          return this.languageMessage[propName];\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport { LanguageService };\r\n","\r\n/**\r\n * æå¡å¨ç«¯å¼å¸¸å®ä½\r\n */\r\nclass ServerExceptionEntity {\r\n\r\n  Code: string;\r\n\r\n  Level: ExceptionLevel;\r\n\r\n  Message: string;\r\n\r\n  Detail: string;\r\n\r\n  RequestId: string;\r\n\r\n  date?: string;\r\n\r\n  innerMessage?: string;\r\n\r\n}\r\n\r\n/**\r\n * æå¡å¨ç«¯å¼å¸¸ç­çº§\r\n */\r\nconst enum ExceptionLevel {\r\n\r\n  /**\r\n   * æç¤ºä¿¡æ¯\r\n   */\r\n  Info = 0,\r\n\r\n  /**\r\n   * è­¦å\r\n   */\r\n  Warning,\r\n\r\n  /**\r\n   * éè¯¯\r\n   */\r\n  Error,\r\n\r\n  /**\r\n   * è´å½éè¯¯\r\n   */\r\n  Fatal\r\n}\r\n\r\nexport { ServerExceptionEntity, ExceptionLevel };\r\n","export class DeviceAbility {\r\n  /**\r\n   * å¤å¶å°ç²è´´æ¿\r\n   * @param text \r\n   * @returns \r\n   */\r\n  public static copyToClipboard(text): boolean {\r\n    const windowRef: any = window;\r\n    if (windowRef.clipboardData && windowRef.clipboardData.setData) {\r\n      return windowRef.clipboardData.setData(\"Text\", text);\r\n    } else if (document.queryCommandSupported && document.queryCommandSupported(\"copy\")) {\r\n      var textarea = document.createElement(\"textarea\");\r\n      textarea.textContent = text;\r\n      textarea.style.position = \"fixed\";\r\n      document.body.appendChild(textarea);\r\n      textarea.select();\r\n      try {\r\n        return document.execCommand(\"copy\");\r\n      } catch (ex) {\r\n      } finally {\r\n        document.body.removeChild(textarea);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}","\r\nimport { Optional } from '@angular/core';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { LanguageService } from '../languag.service';\r\nimport { ServerExceptionEntity } from './types';\r\nimport { DeviceAbility } from '../util/device-ability';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport moment from 'moment';\r\n/**\r\n * å¼å¸¸å¤çæ¥å£\r\n */\r\nexport interface IExceptionStrategy {\r\n  handleException(error: ServerExceptionEntity): void;\r\n}\r\n\r\n\r\n/**\r\n * å¼å¸¸å¤çåºç±»\r\n */\r\nexport class ExceptionStrategy {\r\n  constructor(\r\n    public messagerService: MessagerService,\r\n    @Optional() public languageService: LanguageService) {\r\n  }\r\n}\r\n\r\n/**\r\n * ä¿¡æ¯çº§å«å¼å¸¸å¤ç\r\n */\r\nexport class InfoExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.messagerService.info(error.Message);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * è­¦åçº§å«å¼å¸¸å¤ç\r\n */\r\nexport class WarningExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.messagerService.warning(error.Message);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * éè¯¯çº§å«å¼å¸¸å¤ç\r\n */\r\nexport class ErrorExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  private langService: LanguageService = null;\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n    this.langService = languageService;\r\n    if (!this.langService) {\r\n      this.langService = new LanguageService();\r\n    }\r\n\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.handleErrorLevel(error);\r\n  }\r\n\r\n  private handleErrorLevel(error: ServerExceptionEntity): void {\r\n    const exceptionMsg = error.Message || '';\r\n    const date = error.date || new Date();\r\n    const localDate = moment(date).format('YYYY-MM-DD HH:mm:ss');\r\n    const detail = error.Detail || `${error.Message}\\r\\nåçæ¶é´ï¼${localDate}\\r\\nè¯¦ç»ä¿¡æ¯ï¼${error.innerMessage}` || '';\r\n\r\n    const innerMessage = error.innerMessage || null;\r\n    let bsModalRef: BsModalRef;\r\n    const options = {\r\n      // title: this.languageService.serverNotifyTitle,\r\n      showMaxButton: false,\r\n      buttons: [\r\n        {\r\n          text: this.langService.roger,\r\n          cls: 'btn btn-primary btn-lg',\r\n          handle: () => {\r\n            bsModalRef.close();\r\n          }\r\n        }\r\n      ],\r\n      // showHeader: false,\r\n      width: 440,\r\n      height: 200,\r\n      safeHtml: false,\r\n      exception: {\r\n        date: localDate,\r\n        message: innerMessage,\r\n        copyButton: {\r\n          text: this.langService.copy,\r\n          onClick: (e) => {\r\n            const result = DeviceAbility.copyToClipboard(detail);\r\n            const text = result ? this.langService.copySuccess : this.langService.copyFailed;\r\n            bsModalRef.content.showMiniNotify(text, 1500);\r\n          }\r\n        }\r\n      }\r\n    };\r\n    this.displayError(error);\r\n    bsModalRef = this.messagerService.show('exception', exceptionMsg, options);\r\n  }\r\n  /**\r\n   * å¨æ§å¶å°ä¸­æ¾ç¤ºéè¯¯ä¿¡æ¯\r\n   */\r\n  private displayError(error: ServerExceptionEntity) {\r\n    if (!error) {\r\n      return;\r\n    }\r\n    if (!console || !console.error) {\r\n      return;\r\n    }\r\n    console.error(error);\r\n  }\r\n}\r\n\r\n/**\r\n * è´å½éè¯¯çº§å«å¼å¸¸å¤ç\r\n */\r\nexport class FatalExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.messagerService.error(error.Message);\r\n  }\r\n}\r\n","import { Optional, Injectable } from '@angular/core';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { LanguageService } from '../languag.service';\r\nimport { ServerExceptionEntity, ExceptionLevel } from './types';\r\nimport {\r\n  IExceptionStrategy, InfoExceptionStrategy, WarningExceptionStrategy, ErrorExceptionStrategy, FatalExceptionStrategy\r\n} from './exception_strategy';\r\n\r\n\r\n@Injectable()\r\nexport class ExceptionFactory {\r\n\r\n  /**\r\n   * å¼å¸¸å·¥åå®ä¾\r\n   */\r\n  private static exceptionFactory: ExceptionFactory = null;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param messagerService æ¶æ¯æå¡\r\n   * @param languageService å¤è¯­è¨æå¡\r\n   */\r\n  private constructor(\r\n    public messagerService: MessagerService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n\r\n  }\r\n\r\n  /**\r\n   * è·åå·¥åå®ä¾\r\n   * @param messagerService æ¶æ¯æå¡\r\n   * @param languageService å¤è¯­è¨æå¡\r\n   */\r\n  public static getInstance(messagerService: MessagerService, languageService: LanguageService): ExceptionFactory {\r\n    if (!this.exceptionFactory) {\r\n      this.exceptionFactory = new ExceptionFactory(messagerService, languageService);\r\n    }\r\n\r\n    return this.exceptionFactory;\r\n  }\r\n\r\n  /**\r\n   * è·åå¼å¸¸å¤çç­ç¥\r\n   * @param exceptionLevel å¼å¸¸ç­çº§\r\n   */\r\n  public getExceptionHandleStrategy(exceptionLevel: ExceptionLevel): IExceptionStrategy {\r\n    let exceptionStrategy: IExceptionStrategy;\r\n\r\n    switch (exceptionLevel) {\r\n      case ExceptionLevel.Info:\r\n        exceptionStrategy = new InfoExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      case ExceptionLevel.Warning:\r\n        exceptionStrategy = new WarningExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      case ExceptionLevel.Error:\r\n        exceptionStrategy = new ErrorExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      case ExceptionLevel.Fatal:\r\n        exceptionStrategy = new FatalExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      default:\r\n\r\n        // é»è®¤å¼å¸¸ç­çº§æ¯éè¯¯\r\n        exceptionStrategy = new ErrorExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n    }\r\n\r\n    return exceptionStrategy;\r\n  }\r\n}\r\n","// https://github.com/typeslick/status-code-enum\r\nenum HttpStatusType {\r\n    Info = 1,\r\n    Success,\r\n    Redirect,\r\n    ClientError,\r\n    ServerError\r\n}\r\n\r\n/**\r\n * httpéç¨ç±»\r\n */\r\nclass HttpUtil {\r\n\r\n    /**\r\n     * åºäºhttpç¶æç è¿åç¶æç±»å\r\n     * @param httpResponseSatus httpè¯·æ±è¿åç¶æç \r\n     * @returns null | HttpStatusType\r\n     */\r\n    public static getHttpStatusType(httpResponseSatus: number): any {\r\n        if (!httpResponseSatus) {\r\n            return null;\r\n        }\r\n        \r\n        let statusType = null; // é»è®¤å¼ä¸ºç©º\r\n        \r\n        if (httpResponseSatus < 100 || httpResponseSatus > 600) {\r\n            statusType = null; // ä¸åçç¶æç \r\n        } else if (httpResponseSatus >= 100 && httpResponseSatus < 200) {\r\n            statusType = HttpStatusType.Info;\r\n        } else if (httpResponseSatus >= 200 && httpResponseSatus < 300) {\r\n            statusType = HttpStatusType.Success;\r\n        } else if (httpResponseSatus >= 300 && httpResponseSatus < 400) {\r\n            statusType = HttpStatusType.Redirect;\r\n        } else if (httpResponseSatus >= 400 && httpResponseSatus < 500) {\r\n            statusType = HttpStatusType.ClientError;\r\n        } else if (httpResponseSatus >= 500 && httpResponseSatus < 600) {\r\n            statusType = HttpStatusType.ServerError;\r\n        }\r\n\r\n        return statusType;\r\n    }\r\n}\r\n\r\nexport { HttpUtil, HttpStatusType };","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { HttpUtil, HttpStatusType } from '../util/http';\r\n\r\n/**\r\n * è¡¨åéè¯¯æç¤ºæå¡\r\n * @description ç»ä¸å¤çååç«¯å¼å¸¸\r\n */\r\n@Injectable()\r\nclass FormErrorService {\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * å¼å¸¸è·¯ç±æ¹æ³\r\n   */\r\n  public exception(message: string, error: any) {\r\n    // éå¯¹sessionå¤±æåç¹æ®å¤ç\r\n    if (error && error.hasOwnProperty('expired') && error['expired'] === true) {\r\n      return;\r\n    }\r\n    if (error && this.isHttpErrorResponse(error)) {\r\n      this.httpErrorHandler(error);\r\n    } else {\r\n      // todo: ç»åå¼å¸¸å¤çåï¼ç»§ç»­æè§£è¯¥æ¹æ³\r\n      this.commonErrorHandler(message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * httpè¯·æ±å¼å¸¸å¤çå¨\r\n   */\r\n  public httpErrorHandler(httpError: HttpErrorResponse): void {\r\n    if (!httpError) {\r\n      return;\r\n    }\r\n\r\n    const statusType = HttpUtil.getHttpStatusType(httpError.status);\r\n\r\n    switch (statusType) {\r\n      case HttpStatusType.ClientError:\r\n        if (httpError.status === 401) {\r\n          this.msgService.http401Error(httpError);\r\n          break;\r\n        }\r\n\r\n        this.msgService.httpErrorInClient(httpError);\r\n        break;\r\n      case HttpStatusType.ServerError:\r\n        this.msgService.httpErrorInServer(httpError);\r\n        break;\r\n      default:\r\n        throw new Error('Get invalid status code when using httpErrorHandler method.');\r\n    }\r\n  }\r\n\r\n  private commonErrorHandler(errorMsg: string): void {\r\n    if (!errorMsg) {\r\n      return;\r\n    }\r\n    this.msgService.error(errorMsg);\r\n  }\r\n  /**\r\n   * httpErrorResponse like\r\n   * @param error å¼å¸¸\r\n   */\r\n  private isHttpErrorResponse(error) {\r\n    if (!error) {\r\n      return false;\r\n    }\r\n    if (typeof error !== 'object') {\r\n      return false;\r\n    }\r\n    if (error.name === 'HttpErrorResponse' && error.hasOwnProperty('status') && error.hasOwnProperty('error')) {\r\n      return true;\r\n    }\r\n    if (error instanceof HttpErrorResponse) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nexport { FormErrorService };\r\n\r\n","import { Inject, Injectable, LOCALE_ID, Optional } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, Subject, of, from } from 'rxjs';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { fromPromise } from 'rxjs/observable/fromPromise';\r\nimport { LanguageService } from './languag.service';\r\nimport { ServerExceptionEntity, ExceptionFactory, IExceptionStrategy } from './error/index';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\n\r\n/**\r\n * è¡¨åæ¶æ¯æå¡\r\n * @scope FormModule\r\n * @summary\r\n * 1ãåè£@farris/uiçæ¶æ¯æå¡ï¼\r\n * 2ãæä¾éå¯¹è¡¨åçå¿«æ·æ¹æ³ï¼\r\n */\r\n@Injectable()\r\nclass FormMessageService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * æ³¨å¥@farris/uiçLoadingService\r\n   */\r\n  constructor(\r\n    private messagerService: MessagerService,\r\n    @Optional() private languageService: LanguageService,\r\n    @Inject(LOCALE_ID) private curLanguage: string, // ä¸ºäºç¬ç«å¼¹åºéæ°ç»å½æç¤ºæ¡ï¼åæ¢å°è¿è¡æ¡æ¶httpæå¡åå¯ä»¥å é¤\r\n  ) {\r\n    this.languageService = this.languageService || LanguageService.getInstance();\r\n  }\r\n  /**\r\n   * questionå¼¹çª\r\n   */\r\n  public question(content: string): Observable<boolean> {\r\n    const confirmResult$: Promise<boolean> = this.confirmPromise(content);\r\n    return from(confirmResult$);\r\n  }\r\n\r\n  /**\r\n   * å¸¦é»è®¤ç¦ç¹çå¼¹åºæç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public question2(content: string): Observable<boolean> {\r\n    const promise$: Promise<boolean> = new Promise((resolve, reject) => {\r\n      const dialogRef = this.messagerService.question2(\r\n        content,\r\n        [\r\n          {\r\n            text: this.languageService.no,\r\n            cls: 'btn btn-secondary',\r\n            handle: () => {\r\n              resolve(false);\r\n              dialogRef.close();\r\n            }\r\n          },\r\n          {\r\n            text: this.languageService.yes,\r\n            cls: 'btn btn-primary',\r\n            defaultFocus: true,\r\n            handle: () => {\r\n              resolve(true);\r\n              dialogRef.close();\r\n            }\r\n          }\r\n        ]);\r\n    });\r\n    return from(promise$);\r\n  }\r\n\r\n  /**\r\n   * å¼¹åºè¾å¥å¯¹è¯æ¡\r\n   * @param title æ é¢\r\n   */\r\n  public prompt(title: string): Observable<any> {\r\n    return this.messagerService.prompt(title);\r\n  }\r\n\r\n  /**\r\n   * ä½¿ç¨Promiseå®ä¾åè£åè°æ¹æ³ï¼ä»¥åæ­¥åè°æ¹æ³æ§è¡åç»æ\r\n   * @param content\r\n   */\r\n  private confirmPromise(content: string): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      this.messagerService.question(\r\n        content,\r\n        () => { resolve(true); },\r\n        () => { resolve(false); }\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ç¡®è®¤å¼¹æ¡\r\n   * @param content å¼¹åºåå®¹æç¤º\r\n   */\r\n  public confirm(content: string): Observable<boolean> {\r\n    return this.messagerService.confirm(content);\r\n  }\r\n\r\n  /**\r\n   * æ¶æ¯å¼¹æ¡\r\n   */\r\n  public info(content: string) {\r\n    this.messagerService.info(content);\r\n  }\r\n\r\n  /**\r\n   * éè¯¯å¼¹æ¡\r\n   */\r\n  public error(content: string) {\r\n    this.messagerService.error(content);\r\n  }\r\n\r\n  /**\r\n   * è­¦åå¼¹æ¡\r\n   */\r\n  public warning(content: string) {\r\n    this.messagerService.warning(content);\r\n  }\r\n\r\n  /**\r\n   * æå¡å¨ç«¯å¼å¸¸æç¤ºå¼¹æ¡\r\n   */\r\n  public httpErrorInServer(httpError: HttpErrorResponse): void {\r\n    let error: ServerExceptionEntity = httpError.error;\r\n    if (typeof (error) === 'string') {\r\n      try {\r\n        error = JSON.parse(error);\r\n      } catch (e) { }\r\n    }\r\n    if (!error || error.Level == null || error.Level == undefined) { // æªå°è£errorææªè®¾ç½®å¼å¸¸ç­çº§\r\n      this.messagerService.error(httpError.message);\r\n      return;\r\n    }\r\n    const exceptionStrategy: IExceptionStrategy = ExceptionFactory.getInstance(this.messagerService, this.languageService).getExceptionHandleStrategy(error.Level);\r\n    exceptionStrategy.handleException(error);\r\n  }\r\n\r\n  /**\r\n   * å®¢æ·ç«¯å¼å¸¸æç¤ºå¼¹æ¡\r\n   */\r\n  public httpErrorInClient(httpError: HttpErrorResponse): void {\r\n    if (!httpError) {\r\n      return;\r\n    }\r\n    const message = httpError.error && httpError.error.error && httpError.error.error.message;\r\n    const exceptionMsg = message || httpError.message && httpError.message.replace(/http:\\/\\/[a-zA-Z0-9.:]{1,}/, '');\r\n    const options = {\r\n      // title: this.languageService.clientNotifyTitle,\r\n      // showMaxButton: true,\r\n      showHeader: false,\r\n      width: 400,\r\n      height: 200,\r\n      safeHtml: false\r\n    };\r\n\r\n    this.messagerService.show('error', exceptionMsg, options);\r\n  }\r\n\r\n  /**\r\n   * 401å¼å¸¸å¤ç\r\n   * ä¸ºäºç¬ç«å¼¹åºéæ°ç»å½æç¤ºæ¡ï¼åæ¢å°è¿è¡æ¡æ¶httpæå¡åå¯ä»¥å é¤\r\n   * @param httpError å¼å¸¸\r\n   */\r\n  public http401Error(httpError: HttpErrorResponse): void {\r\n    const dialogShownKey = '401ErrorShownFlag';\r\n\r\n    if (!httpError || window[dialogShownKey]) {\r\n      return;\r\n    }\r\n\r\n    const i18n = {\r\n      en: {\r\n        title: 'Warning',\r\n        sessionInvalid: 'Your login has expired, please login again.',\r\n        ok: 'ok',\r\n        cancel: 'cancel'\r\n      },\r\n      'zh-CHS': {\r\n        title: 'æç¤º',\r\n        sessionInvalid: 'ç¨æ·ç»å½ä¿¡æ¯å·²å¤±æï¼æ¯å¦éæ°ç»å½?',\r\n        ok: 'ç¡®è®¤',\r\n        cancel: 'åæ¶'\r\n      }\r\n    };\r\n    this.curLanguage = this.curLanguage || 'zh-CHS';\r\n\r\n    const messageOptions = {\r\n      title: i18n[this.curLanguage].title,\r\n      initialState: {\r\n        okText: i18n[this.curLanguage].ok,\r\n        okHandle: () => {\r\n          modalRef.close();\r\n          window[dialogShownKey] = false;\r\n          const eventResult = httpError && httpError.error || {};\r\n          const redirectUri = eventResult.redirect_uri || '/login.html';\r\n          window.location.href = `/logout.html#?logout-before-redirect=true&loginUri=${redirectUri}`;\r\n        },\r\n        cancelText: i18n[this.curLanguage].cancel,\r\n        cancelHandle: () => {\r\n          modalRef.close();\r\n          window[dialogShownKey] = false;\r\n        }\r\n      },\r\n      showHeader: true,\r\n      width: 420,\r\n      height: 180,\r\n      fitContent: false\r\n    };\r\n    const modalRef = this.messagerService.show('question', i18n[this.curLanguage].sessionInvalid, messageOptions);\r\n    window[dialogShownKey] = true;\r\n    if (modalRef && modalRef.dialog && modalRef.dialog.instance.closed) {\r\n      modalRef.dialog.instance.closed.subscribe(() => {\r\n        window[dialogShownKey] = false;\r\n      });\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport { FormMessageService };\r\n\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { NotifyService, NotifyOptions } from '@farris/ui-notify';\r\nimport { LanguageService } from './languag.service';\r\n\r\n/**\r\n * éç¥æå¡\r\n * @scope FormModule\r\n * @description\r\n * æ¶æ¯æç¤ºä½¿ç¨ç­ç¥ï¼æåä½¿ç¨successï¼å¤±è´¥ä½¿ç¨errorï¼è­¦åä½¿ç¨warningï¼å¶ä»åºæ¯ä½¿ç¨info\r\n */\r\n@Injectable()\r\nclass FormNotifyService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * æ³¨å¥@farris/uiçNotifyService\r\n   */\r\n  constructor(private notifyService: NotifyService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä¿¡æ¯æç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public default(content: string) {\r\n    return this.notifyService.default(<NotifyOptions>{\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ä¿¡æ¯æç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public info(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    return this.notifyService.info(notifyOptions);\r\n  }\r\n\r\n  /**\r\n   * æåæç¤º\r\n   * @param content åå®¹\r\n   * @param options? éé¡¹ {shorTitle: false}\r\n   */\r\n  public success(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    this.notifyService.success(notifyOptions);\r\n  }\r\n\r\n  /**\r\n   * è­¦åæç¤º\r\n   * @param content åå®¹\r\n   * @param options éé¡¹\r\n   */\r\n  public warning(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    this.notifyService.warning(notifyOptions);\r\n  }\r\n\r\n  /**\r\n   * éè¯¯æç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public error(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    this.notifyService.error(notifyOptions);\r\n  }\r\n}\r\n\r\nexport { FormNotifyService };\r\n","import { Injectable } from '@angular/core';\r\nimport { WizardService, WizardEventType } from '@farris/ui-wizard';\r\nimport { FrameContext } from '@farris/devkit';\r\n\r\n@Injectable()\r\nexport class FormWizardService {\r\n    constructor(\r\n        private wizardSer: WizardService\r\n    ) { }\r\n\r\n    public preStep() {\r\n        const currentPageId = this.wizardSer.getCurrentPageId();\r\n        this.wizardSer.updateWizardState(WizardEventType.Prev, currentPageId);\r\n    }\r\n    public nextStep() {\r\n        const currentPageId = this.wizardSer.getCurrentPageId();\r\n        this.wizardSer.updateWizardState(WizardEventType.Next, currentPageId);\r\n    }\r\n    public cancelWizard() {\r\n        this.wizardSer.cancelWizard();\r\n    }\r\n\r\n    public finishWizard() {\r\n        this.wizardSer.finishWizard();\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * æ£æ¥è§å\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass CheckService {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦ä¸ºç©º\r\n   */\r\n  public checkEmpty(value: any) {\r\n    return !!value;\r\n  }\r\n}\r\n\r\nexport { CheckService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, empty, of } from 'rxjs';\r\nimport { CommandContext } from '@farris/devkit';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\n\r\n/**\r\n * æ°æ®æ£æ¥æå¡\r\n */\r\n@Injectable()\r\nclass DataCheckService {\r\n\r\n  constructor(\r\n    private messageService: FormMessageService,\r\n    private formNotifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç¼è¾åæ£æ¥\r\n   */\r\n  public checkBeforeEdit(idToEdit: string): any {\r\n\r\n    const ifSkipCheck = this.ifSkipCheck(idToEdit);\r\n    if (ifSkipCheck === true) {\r\n      return true;\r\n    }\r\n\r\n    if (idToEdit) {\r\n      return true;\r\n    }\r\n\r\n    this.formNotifyService.warning(this.languageService.plsSelectEditData, { hideTitle: true });\r\n    return empty();\r\n  }\r\n\r\n  /**\r\n   * æ¥çåæ£æ¥\r\n   */\r\n  public checkBeforeView(idToView: string): any {\r\n    const ifSkipCheck = this.ifSkipCheck(idToView);\r\n    if (ifSkipCheck === true) {\r\n      return true;\r\n    }\r\n\r\n    if (idToView) {\r\n      return true;\r\n    }\r\n\r\n    this.formNotifyService.warning(this.languageService.plsSelectViewData, { hideTitle: true });\r\n    return empty();\r\n  }\r\n  /**\r\n   * èè¡¨åè·³è¿æ£æ¥\r\n   * @todoï¼å¾å é¤ï¼å¼å®¹èè¡¨å\r\n   */\r\n  public ifSkipCheck(id: string): boolean {\r\n    const context = this['context'] as CommandContext;\r\n    const params = context.command.params;\r\n\r\n    // è¡¨åæ²¡æéæ°ä¿å­è¿çæåµ\r\n    if (params.hasOwnProperty('idToEdit') === false && params.hasOwnProperty('idToView') === false) {\r\n      return true;\r\n    }\r\n\r\n    // ä¿å­è¿ä½æ²¡æå¡«åæ°çæåµ\r\n    // @todo: ä¼æ¼æç©ºä¸²çæåµï¼ç®åä¸»é®è§£æçè¿åå¼æ¯undefinedï¼æä¸èèç©ºä¸²åºæ¯\r\n    if (id === '') {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n\r\nexport { DataCheckService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameEventBus } from '@farris/devkit';\r\n\r\n/**\r\n * æ¡æ¶äºä»¶æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass EventService {\r\n\r\n  constructor(private eventBus: FrameEventBus) {\r\n  }\r\n\r\n  trigger(eventType: string, eventData?: any, frameIds?: string[]) {\r\n    this.eventBus.trigger(eventType, eventData, frameIds);\r\n  }\r\n}\r\n\r\nexport { EventService };\r\n","import { Injectable } from '@angular/core';\r\n// tslint:disable: no-unused-expression\r\n/**\r\n * èåç¶ææå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass MenuStateService {\r\n    private readonly COMMAND_SERVICE_LINK_STORAGE_KEY = 'COMMAND_SERVICE_LINK_STORAGE_KEY';\r\n    private getState() {\r\n        const data = !!sessionStorage && sessionStorage.getItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY) || null;\r\n        if (!!data) {\r\n            return JSON.parse(data);\r\n        }\r\n        return {};\r\n    }\r\n    private setState(links) {\r\n        !!sessionStorage && sessionStorage.setItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY, JSON.stringify(links));\r\n    }\r\n    public addMenuState(parentMenuId: string, childMenuId: string, status: boolean = true) {\r\n        if (!childMenuId) {\r\n            return;\r\n        }\r\n        const state = this.getState();\r\n        const isParentExist = !!state && state.hasOwnProperty(parentMenuId);\r\n        const childItem = { id: childMenuId, status };\r\n        if (isParentExist) {\r\n            const parent = state[parentMenuId];\r\n            const isChildItemExist = parent.find(item => item.id === childMenuId);\r\n            if (!isChildItemExist) {\r\n                state[parentMenuId].push(childItem);\r\n            }\r\n        } else {\r\n            state[parentMenuId] = [childItem];\r\n        }\r\n        this.setState(state);\r\n    }\r\n    public getMenuState(parentMenuId: string, childMenuId?: string) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return null;\r\n        }\r\n        const isParentExist = state.hasOwnProperty(parentMenuId);\r\n        if (!isParentExist) {\r\n            return null;\r\n        }\r\n        const parentMenu = state[parentMenuId];\r\n        const childMenu = parentMenu.filter(item => item.status === true);\r\n        if (typeof childMenuId === 'undefined' || childMenuId.length < 1) {\r\n            return childMenu;\r\n        }\r\n        return parentMenu.filter(item => item.status && item.id === childMenuId);\r\n    }\r\n    public updateMenuState(childMenuId: string, status: boolean) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return;\r\n        }\r\n        Object.keys(state).forEach(key => {\r\n            const childMenu = state[key].find(item => item.id === childMenuId);\r\n            if (!!childMenu) {\r\n                childMenu.status = status;\r\n            }\r\n        });\r\n        this.setState(state);\r\n    }\r\n    public removeMenu(menuId: string) {\r\n        this.removeParentMenu(menuId);\r\n        this.removeChildMenu(menuId);\r\n    }\r\n    private removeParentMenu(menuId: string) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return null;\r\n        }\r\n        Object.keys(state).forEach(item => {\r\n            if (item === menuId && state[menuId].length < 1) {\r\n                delete state[item];\r\n            }\r\n        });\r\n        this.setState(state);\r\n    }\r\n    private removeChildMenu(menuId: string) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return;\r\n        }\r\n        Object.keys(state).forEach(parentMenuId => {\r\n            const childMenus = state[parentMenuId];\r\n            if (childMenus && childMenus.length > 0) {\r\n                childMenus.forEach((child, index) => {\r\n                    if (child.id === menuId) {\r\n                        childMenus.splice(index, 1);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        this.setState(state);\r\n    }\r\n}\r\n\r\nexport { MenuStateService };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-11-15 15:56:11\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-07-09 16:23:04\r\n */\r\n\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { RouterParamService } from '@farris/devkit';\r\nimport { FrameworkService, AppService } from '@gsp-sys/rtf-common';\r\nimport { MenuStateService } from './menu-state.service';\r\nimport { Subject } from 'rxjs';\r\nimport { LanguageService } from './languag.service';\r\n\r\n// tslint:disable: no-string-literal\r\n/**\r\n * è·¯ç±æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass RouterService {\r\n  /**\r\n   * ä¸æ¬¡åæ¢çTabId\r\n   */\r\n  private lastSwitchId: string = null;\r\n  /**\r\n   * ä¸æ¬¡å³é­çTabId\r\n   */\r\n  private lastCloseId: string = null;\r\n  // private menuStateService: MenuStateService = null;\r\n  public onClosed: Subject<any> = null;\r\n  constructor(\r\n    private router: Router,\r\n    private routerParamService: RouterParamService,\r\n    private frameworkService: FrameworkService,\r\n    @Optional() private appService: AppService,\r\n    @Optional() private menuStateService: MenuStateService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.menuStateService) {\r\n      this.menuStateService = new MenuStateService();\r\n    }\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    this.onClosed = new Subject<any>();\r\n    this.registerEvent();\r\n  }\r\n\r\n  /**\r\n   * åæ¢è·¯ç±\r\n   * @param url èåID\r\n   * @param params è·¯ç±åæ°\r\n   */\r\n  public route(url: string, params: any) {\r\n    url = this.router.createUrlTree([url]).toString();\r\n    this.setParams(url, params);\r\n    this.router.navigateByUrl(url);\r\n  }\r\n  /**\r\n   * æ³¨åè¿è¡æ¡æ¶äºä»¶\r\n   */\r\n  public registerEvent() {\r\n    const params: any = this.getParams(window.location.hash);\r\n    const menuId = this.getAppId() || this.getFuncId();\r\n    this.frameworkService.eventListner(this.frameworkService.FuncSwitch, e => {\r\n      if (!e) {\r\n        return;\r\n      }\r\n      const id = this.getOriginalId(e.id) || e.tabId;\r\n      const menuState = this.menuStateService.getMenuState(id);\r\n      if (!!id && menuId === id && !!menuState && menuState.length > 0) {\r\n        this.formReload();\r\n        this.lastSwitchId = id;\r\n      }\r\n    }, params);\r\n\r\n    this.frameworkService.eventListner(this.frameworkService.FuncClosed, e => {\r\n      if (!e) {\r\n        return;\r\n      }\r\n      this.onClosed.next(e);\r\n      const id = this.getOriginalId(e.id) || e.tabId;\r\n      if (menuId === id) {\r\n        return;\r\n      }\r\n      const menuState = this.menuStateService.getMenuState(menuId, id);\r\n      // && id !== this.lastCloseId\r\n      if (!!id && !!menuState && menuState.length > 0) {\r\n        this.removeMenuState(id);\r\n        this.formReload();\r\n        this.lastCloseId = id;\r\n      }\r\n    }, params);\r\n  }\r\n\r\n  private removeMenuState(tabId: string) {\r\n    if (this['context']) {\r\n      this.menuStateService.removeMenu(tabId);\r\n    }\r\n  }\r\n  /**\r\n   * è·ååå§åè½id\r\n   * @param id id\r\n   */\r\n  private getOriginalId(id: string) {\r\n    if (!id) {\r\n      return id;\r\n    }\r\n    if (id.indexOf('_') !== -1) {\r\n      id = id.split('_')[0];\r\n    }\r\n    return id;\r\n  }\r\n  /**\r\n   * å·æ°ç»ä»¶æ°æ®\r\n   */\r\n  private formReload() {\r\n    try {\r\n      this['context']['frameContext']['appContext']['refresh']();\r\n    } catch{ }\r\n  }\r\n  /**\r\n   * æå¼åè½èå\r\n   * @param funcId èååç \r\n   * @param params è·¯ç±åæ°ï¼å½¢å¦ï¼ { key1: val1, key2: value2 }\r\n   */\r\n  public openMenu(funcId: string, params: any, reload?: boolean) {\r\n    if (typeof reload === 'undefined' || typeof reload !== 'boolean') {\r\n      reload = false;\r\n    }\r\n    const paramsMap = this.buildParamMap(params);\r\n    const parentMenuId = this.getFuncId() || this.getAppId();\r\n    this.menuStateService.addMenuState(parentMenuId, funcId);\r\n    paramsMap.set('WEB_FORM_ROUTER_PARENT_ID', parentMenuId);\r\n    this.frameworkService.openFuncWithParam(funcId, paramsMap, reload);\r\n  }\r\n\r\n  /**\r\n   * æå¼åºç¨\r\n   * @param appId åºç¨åç \r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params è·¯ç±åæ°ï¼å½¢å¦ï¼ { key1: val1, key2: value2 }\r\n   */\r\n  public openApp(appId: string, appEntrance: string, params: any, reload?: boolean) {\r\n    if (typeof reload === 'undefined' || typeof reload !== 'boolean') {\r\n      reload = false;\r\n    }\r\n    const paramMap = this.buildParamMap(params);\r\n    const parentMenuId = this.getAppId() || this.getFuncId();\r\n    this.menuStateService.addMenuState(parentMenuId, appId);\r\n    paramMap.set('WEB_FORM_ROUTER_PARENT_ID', parentMenuId);\r\n    if (!!this.appService) {\r\n      this.appService.openApp(appId, appEntrance, paramMap, reload);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æé åæ°\r\n   */\r\n  private buildParamMap(params: any): Map<string, string> {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (typeof params === 'object') {\r\n      params = JSON.stringify(params);\r\n    }\r\n    params = window['encodeURIComponent'](params);\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    return paramMap;\r\n  }\r\n\r\n  /**\r\n   * å³é­åè½èå\r\n   */\r\n  public closeMenu() {\r\n    const funcId: string | null = this.getFuncId();\r\n    const appId: string | null = this.getAppId();\r\n    const { isDialogComponent, rootComponent } = this.findDialog();\r\n    if (isDialogComponent) {\r\n      const modalRef = this.get(rootComponent, 'dialogRef');\r\n      modalRef['close']();\r\n      return;\r\n    }\r\n\r\n    if (funcId !== null && typeof funcId === 'string' && funcId.length > 0) {\r\n      this.closeFunc(funcId);\r\n    } else if (appId !== null && typeof appId === 'string' && appId.length > 0) {\r\n      const appEntrance = this.getAppEntrance();\r\n      this.closeApp(appId, appEntrance);\r\n    } else {\r\n      console.error(this.languageService['notSupportMenuType']);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ¥æ¾å¼¹çªç»ä»¶\r\n   */\r\n  private findDialog() {\r\n    let frameContext = this.get(this, 'context.frameContext');\r\n    let isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n\r\n    let parentFrameContext = this.get(frameContext, 'parent');\r\n    while (parentFrameContext != null && !isDialogComponent) {\r\n      frameContext = this.get(frameContext, 'parent');\r\n      parentFrameContext = this.get(parentFrameContext, 'parent');\r\n      isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n    }\r\n    const rootComponent = this.get(frameContext, 'frameComponent');\r\n    return { isDialogComponent, rootComponent };\r\n\r\n  }\r\n\r\n  /**\r\n   * loadsh get\r\n   * @param object å¯¹è±¡\r\n   * @param path è·¯å¾\r\n   * @param defaultVal é»è®¤å¼\r\n   */\r\n  private get(object: any, path: Array<string> | string, defaultVal: any = null) {\r\n    const PATH = Array.isArray(path)\r\n      ? path\r\n      : path.split('.').filter(i => i.length);\r\n    if (!PATH.length) {\r\n      return object === undefined ? defaultVal : object;\r\n    }\r\n\r\n    if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {\r\n      return defaultVal;\r\n    }\r\n\r\n    return this.get(object[PATH.shift()], PATH, defaultVal);\r\n  }\r\n\r\n  /**\r\n   * å³é­èå\r\n   * @param funcId èåid\r\n   */\r\n  public closeFunc(funcId?: string) {\r\n    if (!funcId) {\r\n      funcId = this.getFuncId();\r\n    }\r\n    if (!!this.frameworkService) {\r\n      this.frameworkService.closeFunc(funcId).subscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å³é­app\r\n   * @param appId åºç¨id\r\n   */\r\n  public closeApp(appId?: string, appEntrance?: string) {\r\n    if (!appId) {\r\n      appId = this.getAppId();\r\n    }\r\n    if (typeof appEntrance === 'undefined') {\r\n      appEntrance = this.getAppEntrance();\r\n    }\r\n    if (!!this.appService) {\r\n      this.appService.closeApp(appId, appEntrance).subscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®åæ°\r\n   * @param params è·¯ç±åæ°\r\n   */\r\n  private setParams(url: string, params: string | { [key: string]: any; }) {\r\n    let paramsObj;\r\n    if (typeof params === 'string' && params !== '') {\r\n      paramsObj = JSON.parse(params);\r\n    } else {\r\n      paramsObj = params || {};\r\n    }\r\n\r\n    // è®¾ç½®è·¯ç±åæ°\r\n    this.routerParamService.setParams(url, paramsObj);\r\n  }\r\n\r\n  /**\r\n   * è·åfuncId\r\n   */\r\n  private getFuncId() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('funcId')) {\r\n      return params.funcId;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åappId\r\n   */\r\n  private getAppId() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('appId')) {\r\n      return params.appId;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private getParentMenuId() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('WEB_FORM_ROUTER_PARENT_ID')) {\r\n      return params.WEB_FORM_ROUTER_PARENT_ID;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * è·ååºç¨å¥å£\r\n   */\r\n  private getAppEntrance() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('appEntrance')) {\r\n      return params.appEntrance;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * è§£ç åæ°\r\n   * @param query search|hash\r\n   */\r\n  private decodeURLParams(query: string): { [propName: string]: any } {\r\n    if (typeof query === 'undefined') {\r\n      query = window.location.hash || window.location.search;\r\n    }\r\n    const hashes = query.slice(query.indexOf('?') + 1).split('&');\r\n    return hashes.reduce((params, hash) => {\r\n      const split = hash.indexOf('=');\r\n      const key = hash.slice(0, split);\r\n      const val = hash.slice(split + 1);\r\n      return Object.assign(params, { [key]: decodeURIComponent(val) });\r\n    }, {});\r\n  }\r\n  private getParams(queryString: string): { [propName: string]: any } {\r\n    if (!queryString) {\r\n      return {};\r\n    }\r\n    const hashes = queryString.slice(queryString.indexOf('?') + 1).split('&');\r\n    return hashes.reduce((params, hash) => {\r\n      const split = hash.indexOf('=');\r\n      const key = hash.slice(0, split);\r\n      const val = hash.slice(split + 1);\r\n      return Object.assign(params, { [key]: decodeURIComponent(val) });\r\n    }, {});\r\n  }\r\n}\r\n\r\nexport { RouterService };\r\n","import { InjectionToken } from '@angular/core';\r\nimport { RequestInfo } from '@farris/bef';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\n// tslint:disable: unified-signatures\r\nexport const TAB_EVENT = {\r\n    /**\r\n     * Tabå³é­å\r\n     */\r\n    onTabClosed: 'FuncClosed',\r\n    /**\r\n     * Tabå³é­å\r\n     */\r\n    onTabClosing: 'beforeFuncCloseEvent',\r\n    /**\r\n     * Tabåæ¢\r\n     */\r\n    onTabSwitched: 'funcSwitchEvent'\r\n};\r\n\r\nexport const TAB_QUERY_STRING = {\r\n    TabId: 'tabId',\r\n    AppType: 'appType',\r\n    AppId: 'appId',\r\n    AppEntrance: 'appEntrance',\r\n    FuncId: 'funcId'\r\n};\r\n\r\n/**\r\n * å¸¦RequestInfoçbodyå¯¹è±¡\r\n */\r\nexport interface BodyWithRequestInfo {\r\n    requestInfo: RequestInfo;\r\n    [key: string]: any;\r\n}\r\n\r\nexport const WEB_FORM_ROUTE_PARAMS_KEY = 'WEB_FORM_ROUTE_PARAMS';\r\nexport const enum DataType{\r\n  map = '[object Map]'\r\n}\r\nexport type KeyObject<T = any> = { key: T };\r\n\r\nexport const INSIDE_DIALOG_TOKEN = new InjectionToken<boolean>('@farris/command-service-inside-dialog');\r\n\r\nexport const MODAL_REF = new InjectionToken<BsModalRef>('@farris/command-service-modal-ref');\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * æ¥è¯¢åæ°æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class QuerystringService {\r\n    /**\r\n     * è§£ç åæ°\r\n     * @param queryString search|hash\r\n     */\r\n    public parse(queryString: string): { [propName: string]: any } {\r\n        if (!queryString) {\r\n            return {};\r\n        }\r\n        const hashes = queryString.slice(queryString.indexOf('?') + 1).split('&');\r\n        return hashes.reduce((params, hash) => {\r\n            const split = hash.indexOf('=');\r\n            const key = hash.slice(0, split);\r\n            const val = hash.slice(split + 1);\r\n            return Object.assign(params, { [key]: decodeURIComponent(val) });\r\n        }, {});\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EMPTY, Observable, Subject } from 'rxjs';\r\nimport { UID } from '@farris/devkit';\r\nimport { switchMap } from 'rxjs/operators';\r\n/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-07-23 15:56:11 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-11-27 15:31:36\r\n */\r\n\r\n\r\n/**\r\n * RuntimeFrameworkService\r\n * @scope @FormModule\r\n */\r\n// tslint:disable: no-string-literal disable: max-line-length\r\n@Injectable()\r\nexport class RuntimeFrameworkService {\r\n  private rtfService: any;\r\n  constructor() {\r\n    this.rtfService = this.getService();\r\n  }\r\n  /**\r\n   * éåè·årtfæå¡\r\n   */\r\n  private getService() {\r\n    let env: Window = window;\r\n    while (!env['gspframeworkService'] && env !== window.top && this.isSameOrigin(env)) {\r\n      env = env.parent;\r\n    }\r\n    return env['gspframeworkService'] && env['gspframeworkService']['rtf'] || {};\r\n  }\r\n  // #region å¯¼èªæå¡\r\n  /**\r\n   * æå¼èåæåºç¨\r\n   * @param options options\r\n   */\r\n  openMenu(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['openMenu'] === 'function') {\r\n      this.rtfService.func.openMenu(options);\r\n    }\r\n  }\r\n  /**\r\n   * æå¼èåæåºç¨\r\n   * @param options options\r\n   */\r\n  openMenu$(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['openMenuByStream'] === 'function') {\r\n      return this.rtfService.func.openMenuByStream(options);\r\n    }\r\n    return EMPTY;\r\n  }\r\n  /**\r\n   * è·åå¯¼èªå®ä½æ°æ®\r\n   * @param tabId tabid\r\n   * @param callback callback\r\n   * @param once once\r\n   */\r\n  getEntityParam(tabId: string, callback: any, once: boolean = true) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['getEntityParam'] === 'function') {\r\n      this.rtfService.func.getEntityParam(tabId, callback, once);\r\n    }\r\n  }\r\n  /**\r\n   * å°è¯å³é­èåæåºç¨\r\n   * @param options optins\r\n   */\r\n  beforeCloseMenu(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['beforeClose'] === 'function') {\r\n      this.rtfService.func.beforeClose(options);\r\n    }\r\n  }\r\n  /**\r\n   * å³é­èå\r\n   * @param options options\r\n   */\r\n  closeMenu(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['close'] === 'function') {\r\n      this.rtfService.func.close(options);\r\n    }\r\n  }\r\n  /**\r\n   * è·åèåéæåæ°\r\n   * @param funcId èåid\r\n   * @param callback åè°\r\n   */\r\n  getMenuParams(funcId: string, callback: (params) => void) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['getMenuParams'] === 'function') {\r\n      this.rtfService.func.getMenuParams(funcId, callback);\r\n    }\r\n  }\r\n  /**\r\n   * æ·»å äºä»¶çå¬\r\n   */\r\n  addEventListener(token: string, handler: (value: any) => void, options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('frmEvent') && typeof this.rtfService['frmEvent']['eventListener'] === 'function') {\r\n      this.rtfService.frmEvent.eventListener(token, handler, options);\r\n    }\r\n  }\r\n  /**\r\n   * è·åè¿è¡æ¡æ¶èååæ¢æ§å¶äºä»¶\r\n   * @returns Observable<any>\r\n   */\r\n  public getMenuSwitchControlEvent(): Observable<any> {\r\n    const subject = new Subject<any>();\r\n    const frmEvent = this.rtfService && this.rtfService.frmEvent || null;\r\n    if (frmEvent) {\r\n      const tabId = this.tabId;\r\n      const options = this.params;\r\n      window.setTimeout(() => {\r\n        frmEvent.eventListener(tabId, (response: { menuSwitchControl: { key: any, value: any }, [prop: string]: any }) => {\r\n          const menuSwitchControl = response && response.menuSwitchControl || null;\r\n          if (menuSwitchControl && menuSwitchControl.key === tabId) {\r\n            subject.next(menuSwitchControl.value);\r\n          } else {\r\n            subject.next(null);\r\n          }\r\n        }, options);\r\n      }, 0);\r\n    }\r\n    return subject;\r\n  }\r\n  //#endregion\r\n\r\n  // #region ééå±å±æ§\r\n  public get params() {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('session') && typeof this.rtfService['session']['getCommonVariable'] === 'function') {\r\n      return this.rtfService['session']['getCommonVariable']();\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * è·åtabId\r\n   */\r\n  public get tabId() {\r\n    return this.params && this.params['tabId'] || null;\r\n  }\r\n  /**\r\n   * è·åformToken\r\n   */\r\n  public get formToken() {\r\n    return this.params && this.params['formToken'] || null;\r\n  }\r\n  /**\r\n   * è·åfuncId\r\n   */\r\n  public get funcId() {\r\n    return this.params && this.params['funcId'] || null;\r\n  }\r\n  // #endregion\r\n\r\n  // #region äºä»¶éä¿¡\r\n  /**\r\n   * æ³¨åä¸»é¢\r\n   * @param code ä¸»é¢çæ è¯\r\n   * @param options tokençæè§å\r\n   * @param subject èªå®ä¹ä¸»é¢ï¼é»è®¤ä½¿ç¨Subject\r\n   * @returns string æ³¨åæååè¿åä¸»é¢çå¯ä¸æ è¯\r\n   */\r\n  public subjectRegister(code: string, options: any, subject?: Subject<any>): string {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['subjectRegister'] === 'function') {\r\n      return this.rtfService.broadcast.subjectRegister(code, options, subject);\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * ç§»é¤ä¸»é¢\r\n   * @param token ä¸»é¢å¯ä¸æ è¯\r\n   */\r\n  public subjectRemove(token: string) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['subjectRemove'] === 'function') {\r\n      this.rtfService.broadcast.subjectRemove(token);\r\n    }\r\n  }\r\n  /**\r\n   * ç»ä¸»é¢åéæ¶æ¯\r\n   * @param token ä¸»é¢æ è¯\r\n   * @param info æ¶æ¯\r\n   */\r\n  public subjectNotify(token: string, info: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['notify'] === 'function') {\r\n      this.rtfService.broadcast.notify(token, info);\r\n    }\r\n  }\r\n  /**\r\n   * æ³¨åä¸»é¢çå¬å¨\r\n   * @param token ä¸»é¢æ è¯\r\n   * @param handler ä¸»é¢å¤çå¨\r\n   * @param observerToken çå¬å¨id(å¯é)\r\n   * @returns çå¬å¨Id\r\n   * @description çå¬ä¸»é¢æ¶æ¯ï¼çå¬æåè¿åå½åçå¬èçå¯ä¸æ è¯\r\n   */\r\n  public subjectResponse(token: string, handler: (data: any) => void, observerToken?: string): string {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['response'] === 'function') {\r\n      let code = observerToken;\r\n      if (typeof observerToken === 'undefined' || !observerToken || observerToken.length < 1) {\r\n        code = UID.create();\r\n      }\r\n      this.rtfService.broadcast.response(token, code, handler);\r\n      return code;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * åæ¶å¯¹ä¸»é¢ççå¬\r\n   * @param token ä¸»é¢æ è¯\r\n   * @param observerToken çå¬å¨æ è¯\r\n   */\r\n  public responseUnSubscribe(token: string, observerToken: string) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['responseUnSubscribe'] === 'function') {\r\n      this.rtfService.broadcast.responseUnSubscribe(token, observerToken);\r\n    }\r\n  }\r\n  // #endregion\r\n\r\n  // #region å·¥å·å½æ°\r\n  /**\r\n   * æ¯å¦åæº\r\n   * @param environment window\r\n   */\r\n  private isSameOrigin(environment: Window) {\r\n    const host = window.location.host;\r\n    try {\r\n      if (environment && environment.location && typeof environment.location.host !== 'undefined') {\r\n        return environment.location.host === host;\r\n      }\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n\r\n    return false;\r\n  }\r\n  // #endregion\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of, from, EMPTY } from 'rxjs';\r\nimport { every, concatMap, switchMap, take, tap } from 'rxjs/operators';\r\nimport { AppOptions } from '@gsp-sys/rtf-common';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { MenuStateService } from './menu-state.service';\r\nimport { TAB_EVENT } from './types';\r\nimport { QuerystringService } from './querystring';\r\nimport { FrameContext, UID } from '@farris/devkit';\r\n\r\n/**\r\n * å¯¼èªäºä»¶æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class NavigationEventService {\r\n  public frameContext: FrameContext;\r\n  /**\r\n   * å³é­åäºä»¶å¤çå¨\r\n   */\r\n  private onClosedListeners: Map<string, (options?: AppOptions) => void>;\r\n  /**\r\n   * å³é­åå¤çå¨\r\n   */\r\n  private onClosingListeners: Map<string, (options?: AppOptions) => Observable<boolean>>;\r\n  private onTabSwitchListeners: Map<string, (options?: AppOptions) => void>;\r\n  private params: { [propName: string]: any };\r\n\r\n  constructor(\r\n    private runtimeFrameworkService: RuntimeFrameworkService,\r\n    private menuStateService: MenuStateService,\r\n    private querystringService: QuerystringService\r\n  ) {\r\n    this.onClosedListeners = new Map<string, (options?: AppOptions) => void>();\r\n    this.onClosingListeners = new Map<string, (options?: AppOptions) => Observable<boolean>>();\r\n    this.onTabSwitchListeners = new Map<string, (options?: AppOptions) => void>();\r\n  }\r\n  private get querystrings() {\r\n    const params = this.querystringService.parse(window.location.hash);\r\n    // ä¿®æ­£formToken\r\n    if (params) {\r\n      params.formToken = this.runtimeFrameworkService.formToken;\r\n    }\r\n    return params;\r\n  }\r\n  /**\r\n   * æ³¨åäºä»¶\r\n   */\r\n  public registerEvent() {\r\n    const options = this.querystrings;\r\n    this.params = options;\r\n    // æ³¨åæ ç­¾é¡µåæ¢äºä»¶\r\n    this.runtimeFrameworkService.addEventListener(TAB_EVENT.onTabSwitched, (e) => this.handleTabSwitchEvent(e), options);\r\n    // æ³¨åæ ç­¾é¡µå³é­åäºä»¶\r\n    this.runtimeFrameworkService.addEventListener(TAB_EVENT.onTabClosed, (e) => this.handleTabClosedEvent(e), options);\r\n    // æ³¨åæ ç­¾é¡µå³é­åäºä»¶\r\n    this.runtimeFrameworkService.addEventListener(TAB_EVENT.onTabClosing, (e) => this.handleTabClosingEvent(e), options);\r\n  }\r\n  /**\r\n   * å¤çæ ç­¾é¡µåæ¢äºä»¶\r\n   */\r\n  private handleTabSwitchEvent(e: any) {\r\n    if (!e) {\r\n      return;\r\n    }\r\n    // éä¸­çè¡¨åä¸ºç³»ç»è¡¨åï¼åªè½è¿åidï¼æ²¡ætabId\r\n    const eventTabId = e.tabId || e.id || null;\r\n    if (!eventTabId) {\r\n      return;\r\n    }\r\n    const options = this.params; // this.querystrings;\r\n    const tabId = options.tabId || options.funcId || options.appId;\r\n    const menuState = this.menuStateService.getMenuState(eventTabId);\r\n    if (!!tabId && tabId === eventTabId && !!menuState && menuState.length > 0) {\r\n      this.formReload();\r\n    }\r\n    this.fireTabSwitchEvent(e);\r\n  }\r\n  /**\r\n   * è§¦åtabåæ¢äºä»¶\r\n   * @param e e\r\n   */\r\n  private fireTabSwitchEvent(e: any) {\r\n    if (!this.onTabSwitchListeners || this.onTabSwitchListeners.size < 1) {\r\n      return;\r\n    }\r\n    this.onTabSwitchListeners.forEach((handle, key, map) => {\r\n      if (typeof handle === 'function') {\r\n        handle(e);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * æ ç­¾é¡µå³é­åäºä»¶\r\n   */\r\n  private handleTabClosingEvent(e: any) {\r\n    if (!e) {\r\n      return;\r\n    }\r\n    // è¦å³é­çè¡¨åä¸ºç³»ç»è¡¨åï¼åªè½è¿åidï¼æ²¡ætabId\r\n    const eventTabId = e.tabId || e.id || null;\r\n    const options = this.params; // this.querystrings;\r\n    const tabId = options.tabId || options.funcId || options.appId;\r\n    if (!!eventTabId && !!tabId && tabId === eventTabId) {\r\n      this.fireTabClosingEvent(e).subscribe((result) => {\r\n        if (result) {\r\n          setTimeout(() => this.removeMenuState(eventTabId), 500);\r\n          const formEventServices: Map<string, any> = window['formEventServices'];\r\n          if (formEventServices.has(eventTabId)) {\r\n            formEventServices.delete(eventTabId);\r\n            window['formEventServices'] = formEventServices;\r\n          }\r\n          if (!(e && e.hasOwnProperty('token'))) {\r\n            e = Object.assign({}, e, { token: options.formToken });\r\n          }\r\n          // TODO:ä¸åä¸»å¨éæ¯appContextï¼å¯è½å­å¨åå­æ³æ¼é®é¢\r\n          // if (this.frameContext && this.frameContext.appContext) {\r\n          //   this.frameContext.appContext.dispose();\r\n          // }\r\n          this.runtimeFrameworkService.closeMenu(e);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * è§¦åå³é­åäºä»¶\r\n   */\r\n  private fireTabClosingEvent(e: any): Observable<boolean> {\r\n    if (!this.onClosingListeners || this.onClosingListeners.size < 1) {\r\n      return of(true);\r\n    }\r\n    const listeners = this.onClosingListeners.values();\r\n    const result$ = from(listeners);\r\n    // ç¨æ·æç»\r\n    let userRejected = false;\r\n    return result$.pipe(\r\n      concatMap((handle) => {\r\n        if (userRejected) {\r\n          return EMPTY;\r\n        }\r\n        return handle(e).pipe(\r\n          take(1),\r\n          tap((result) => userRejected = !result),\r\n          switchMap((result) => of(result))\r\n        );\r\n      }),\r\n      every((result) => result)\r\n    );\r\n  }\r\n  /**\r\n   * æ ç­¾é¡µå³é­åäºä»¶\r\n   */\r\n  private handleTabClosedEvent(e: any) {\r\n    if (!e) {\r\n      return;\r\n    }\r\n    const options = this.params; // this.querystrings;\r\n    const tabId = options.tabId || options.funcId || options.appId;\r\n    const eventTabId = e.tabId || e.id || null;\r\n    if (tabId === eventTabId) {\r\n      return;\r\n    }\r\n    const menuState = this.menuStateService.getMenuState(tabId, eventTabId);\r\n    if (!!eventTabId && !!menuState && menuState.length > 0) {\r\n      this.removeMenuState(eventTabId);\r\n      this.formReload();\r\n    }\r\n    this.fireTabClosedEvent(e);\r\n  }\r\n  private removeMenuState(tabId: string) {\r\n    if (this['context']) {\r\n      this.menuStateService.removeMenu(tabId);\r\n    }\r\n  }\r\n  /**\r\n   * è§¦åå³é­åäºä»¶\r\n   * @param e event\r\n   */\r\n  private fireTabClosedEvent(e: any) {\r\n    if (!this.onClosedListeners || this.onClosedListeners.size < 1) {\r\n      return;\r\n    }\r\n    this.onClosedListeners.forEach((handle, key, map) => {\r\n      if (typeof handle === 'function') {\r\n        handle(e);\r\n      }\r\n    });\r\n  }\r\n  // #endregion\r\n  /**\r\n   * æ³¨åäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å onTabClosed\r\n   * @param handler å¤çå¨\r\n   */\r\n  public addEventListener(eventType: string, handler: (options: AppOptions) => any): string {\r\n    const key = UID.create();\r\n    if (eventType === TAB_EVENT.onTabClosed) {\r\n      this.onClosedListeners.set(key, handler);\r\n      return key;\r\n    } else if (eventType === TAB_EVENT.onTabClosing) {\r\n      this.onClosingListeners.set(key, handler);\r\n      return key;\r\n    } else if (eventType === TAB_EVENT.onTabSwitched) {\r\n      this.onTabSwitchListeners.set(key, handler);\r\n      return key;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * ç§»é¤äºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å\r\n   * @param key äºä»¶æ è¯\r\n   */\r\n  public removeEventListener(eventType: string, key: string) {\r\n    if (eventType === TAB_EVENT.onTabClosed) {\r\n      return this.onClosedListeners.delete(key);\r\n    } else if (eventType === TAB_EVENT.onTabClosing) {\r\n      return this.onClosingListeners.delete(key);\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * æ¸ç©ºäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å\r\n   */\r\n  public clearEventListener(eventType: string): void {\r\n    if (eventType === TAB_EVENT.onTabClosed) {\r\n      this.onClosedListeners.clear();\r\n    } else if (eventType === TAB_EVENT.onTabClosing) {\r\n      this.onClosingListeners.clear();\r\n    }\r\n  }\r\n  /**\r\n   * å·æ°ç»ä»¶æ°æ®\r\n   */\r\n  private formReload() {\r\n    try {\r\n      // tslint:disable-next-line: no-string-literal\r\n      this['context']['frameContext']['appContext']['refresh']();\r\n    } catch { }\r\n  }\r\n}\r\n","import { Injectable, InjectionToken, Inject, Optional } from '@angular/core';\r\nexport const FARRIS_FORM_COMPONENTS = new InjectionToken<{[key: string]: any}>('è¡¨åå¼¹åºçªå£æéèç»ä»¶åè¡¨');\r\n\r\n/**\r\n * è¡¨åæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class FarrisFormService {\r\n\r\n    private controls: { [key: string]: any} = {};\r\n\r\n    constructor(@Optional()@Inject(FARRIS_FORM_COMPONENTS) initCtrls: any = {}) {\r\n      if (!initCtrls) {\r\n        initCtrls = {};\r\n      }\r\n      this.controls = { ...initCtrls };\r\n    }\r\n\r\n    append(key: string, cmpIns: any) {\r\n        this.controls[key] = cmpIns;\r\n    }\r\n\r\n    getControls(key: string) {\r\n        if (this.controls[key]) {\r\n            return this.controls[key];\r\n        } else {\r\n            console.warn(`æªæ¾å°Keyä¸º${key}çç»ä»¶ï¼`);\r\n            return null;\r\n        }\r\n    }\r\n\r\n}\r\n","/*\r\n * @Author: aalizzwell\r\n * @Date: 2019-08-02 15:31:34\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2020-03-03 09:33:43\r\n */\r\nimport { Injectable, Optional, Injector, ComponentFactoryResolver, ReflectiveInjector } from '@angular/core';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { AppOptions, AppType } from '@gsp-sys/rtf-common';\r\nimport { MenuStateService } from './menu-state.service';\r\nimport { NavigationEventService } from './navigation-event.service';\r\nimport { QuerystringService } from './querystring';\r\nimport { FrameContext, TranslateToken, Translate, FrameComponent } from '@farris/devkit';\r\nimport { FEPageModalService } from '@farris/extend-page-modal';\r\nimport lodash from 'lodash-es';\r\nimport { FarrisFormService } from './farris-form.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { map, switchMap } from 'rxjs/operators';\r\nimport { EMPTY, Observable, of } from 'rxjs';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { INSIDE_DIALOG_TOKEN, MODAL_REF } from './types';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\ndeclare const System: any;\r\n// tslint:disable: no-string-literal max-line-length\r\nconst APP_CONTEXT_MANAGER = 'DEVKIT_APP_CONTEXT_MANAGER';\r\n/**\r\n * å¯¼èªæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class NavigationService {\r\n\r\n  constructor(\r\n    private runtimeFrameworkService: RuntimeFrameworkService,\r\n    private menuStateService: MenuStateService,\r\n    private navigationEventService: NavigationEventService,\r\n    private querystringService: QuerystringService,\r\n    @Optional() private frameContext: FrameContext,\r\n    @Optional() private injector: Injector,\r\n    @Optional() private languageService: LanguageService\r\n    // @Optional() private pageModalService: FEPageModalService,\r\n    // @Optional() private farrisFormService: FarrisFormService,\r\n    // @Optional() private languageService: LanguageService\r\n  ) {\r\n    // appIdä¸åäºtabIdï¼æ¯æ¬¡è¡¨åå®ä¾åæ¶é½ä¼éæ°çæ\r\n    const appId = this.formAppContext && this.formAppContext.ApplicationId;\r\n    let tabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    // å·²ç»ç¼è¯çè¡¨åï¼ä½¿ç¨appIdè®°å½hash\r\n    if (appId) {\r\n      const appContextManager = window[APP_CONTEXT_MANAGER] || new Map<string, any>();\r\n      if (appContextManager && !appContextManager.has(appId)) {\r\n        appContextManager.set(appId, { hash: window.location.hash });\r\n        window[APP_CONTEXT_MANAGER] = appContextManager;\r\n      }\r\n    }\r\n    if (tabId) {\r\n      const formEventServices: Map<string, any> = window['formEventServices'] || new Map<string, any>();\r\n      // tabIdãappIdé½å­å¨æ¶ï¼ä½¿ç¨appIdæ¿æ¢tabId\r\n      if (appId) {\r\n        tabId = appId;\r\n      }\r\n      if (formEventServices && formEventServices.has(tabId)) {\r\n        this.navigationEventService = formEventServices.get(tabId);\r\n      } else {\r\n        this.navigationEventService.registerEvent();\r\n        formEventServices.set(tabId, this.navigationEventService);\r\n        this.navigationEventService.frameContext = this.frameContext;\r\n        window['formEventServices'] = formEventServices;\r\n        this.registerDestroyEvent(tabId);\r\n      }\r\n    }\r\n    if (!languageService) {\r\n      this.languageService = new LanguageService();\r\n    }\r\n  }\r\n  public set context(context) {\r\n    this.navigationEventService['context'] = context;\r\n    this['commandContext'] = context;\r\n  }\r\n  /**\r\n   * è·åæ´ä¸ªè¡¨åçappcontextï¼é¤moduleä¸çappcontextï¼\r\n   */\r\n  private get formAppContext() {\r\n    if (this.frameContext) {\r\n      let appContext = this.frameContext.appContext;\r\n      // tslint:disable-next-line: max-line-length\r\n      while (appContext && appContext.parent && appContext.parent.injector && appContext.parent.injector.get(FrameContext, null) !== null) {\r\n        appContext = appContext.parent;\r\n      }\r\n      return appContext;\r\n    }\r\n    return null;\r\n  }\r\n  private get querystrings() {\r\n    let hash = window.location.hash;\r\n    const appId = this.formAppContext && this.formAppContext.ApplicationId;\r\n    if (appId) {\r\n      const appContextManager = window[APP_CONTEXT_MANAGER];\r\n      const appContext = appContextManager && appContextManager.get(appId);\r\n      hash = appContext && appContext.hash || hash;\r\n    }\r\n    const params = this.querystringService.parse(hash);\r\n    if (params) {\r\n      params.formToken = this.runtimeFrameworkService.formToken;\r\n    }\r\n    return params;\r\n  }\r\n  /**\r\n   * æç¤ºæå¡\r\n   */\r\n  private get formNotifyService() {\r\n    return this.injector && this.injector.get<FormNotifyService>(FormNotifyService, null);\r\n  }\r\n  /**\r\n   * æ³¨åéæ¯äºä»¶\r\n   * @param tabId\r\n   */\r\n  private registerDestroyEvent(tabId: string) {\r\n    if (this.frameContext && this.frameContext.destorySignal) {\r\n      this.frameContext.destorySignal.subscribe(() => {\r\n        this.navigationEventService = null;\r\n      });\r\n    }\r\n    if (this.frameContext && this.frameContext.appContext && this.frameContext.appContext.destorySignal) {\r\n      this.frameContext.appContext.destorySignal.subscribe(() => {\r\n        const formEventServices = window['formEventServices'] as Map<string, any>;\r\n        if (formEventServices) {\r\n          formEventServices.delete(tabId);\r\n        }\r\n        const appContextManager = window[APP_CONTEXT_MANAGER] as Map<string, any>;\r\n        if (appContextManager) {\r\n          appContextManager.delete(tabId);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  // #region æ¥å£\r\n\r\n  /**\r\n   * æå¼èå\r\n   * @param tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param funcId èåId\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param tabName tabæ é¢\r\n   * @param destructuring æ¯å¦è§£æåæ°\r\n   */\r\n  public openMenu(tabId: string, funcId: string, params: any, reload?: boolean, enableRefresh?: any, tabName?: string, destructuring?: any) {\r\n    if (!funcId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      funcId,\r\n      appType: AppType.Menu,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      appId: undefined,\r\n      appEntrance: undefined,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    // å¯ç¨æ°æ®å·æ°åæ°ä¸ºtrueæèæ²¡æå®ä¹ï¼åæå·æ°å¤ç\r\n    // æ²¡æä¼ éè¯¥åæ°æè¯¥åæ°ä¸ºç©ºï¼åè®¤ä¸ºæç§ä¹åçé»è¾å¤çï¼é»è®¤å·æ°\r\n    // null false \"false\" \"true\" undefined\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${funcId}_${tabId}` : funcId;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    this.runtimeFrameworkService.openMenu(options);\r\n  }\r\n  /**\r\n   * æå¼èåï¼æµï¼\r\n   * @param tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param funcId èåId\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n  public openMenu$(tabId: string, funcId: string, params: any, reload?: boolean, enableRefresh?: any, tabName?: string, destructuring?: any) {\r\n    if (!funcId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      funcId,\r\n      appType: AppType.Menu,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      appId: undefined,\r\n      appEntrance: undefined,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    // å¯ç¨æ°æ®å·æ°åæ°ä¸ºtrueæèæ²¡æå®ä¹ï¼åæå·æ°å¤ç\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${funcId}_${tabId}` : funcId;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    return this.runtimeFrameworkService.openMenu$(options);\r\n  }\r\n  /**\r\n   * æå¼èå(å¸¦ç»´åº¦)\r\n   * @param tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param funcId èåId\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param dim1 dim1\r\n   * @param dim2 dim2\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n  public openMenuWithDimension(tabId: string, funcId: string, params: any, enableRefresh?: any, dim1?: any, dim2?: any, tabName?: string, metadataId?: string, destructuring?: any) {\r\n    if (!funcId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    if (metadataId === undefined || metadataId === null) {\r\n      metadataId = '';\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n\r\n    // const paramsMap = this.buildParamMap(params);\r\n    queryStringParams.set('dim1', dim1 ? dim1 : 'public');\r\n    queryStringParams.set('dim2', dim2 ? dim2 : 'public');\r\n    queryStringParams.set('metadataId', metadataId);\r\n    queryStringParams.set('isRtc', '1');\r\n    queryStringParams.set('isRootMetadata', 'true');\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      funcId,\r\n      appType: AppType.Menu,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      appId: undefined,\r\n      appEntrance: undefined,\r\n      isReload: false,\r\n      tabName: tabName || null\r\n    };\r\n    // å¯ç¨æ°æ®å·æ°åæ°ä¸ºtrueæèæ²¡æå®ä¹ï¼åæå·æ°å¤ç\r\n    // æ²¡æä¼ éè¯¥åæ°æè¯¥åæ°ä¸ºç©ºï¼åè®¤ä¸ºæç§ä¹åçé»è¾å¤çï¼é»è®¤å·æ°\r\n    // null false \"false\" \"true\" undefined\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${funcId}_${tabId}` : funcId;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    this.runtimeFrameworkService.openMenu(options);\r\n  }\r\n  /**\r\n   * æå¼åºç¨\r\n   * @param tabId tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param appId åºç¨Id\r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param tabName tabæ é¢\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n\r\n  public openApp(tabId: string, appId: string, appEntrance: string, params: any, reload?: boolean, tabName?: string, enableRefresh?: any, destructuring?: any) {\r\n    if (!appId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      appId,\r\n      appEntrance,\r\n      funcId: undefined,\r\n      appType: AppType.App,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${appId}_${appEntrance}_${tabId}` : `${appId}_${appEntrance}`;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    this.runtimeFrameworkService.openMenu(options);\r\n  }\r\n  /**\r\n   * æå¼åºç¨(æµå¼)\r\n   * @param tabId tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param appId åºç¨Id\r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param tabName tabæ é¢\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n  public openApp$(tabId: string, appId: string, appEntrance: string, params: any, reload?: boolean, tabName?: string, enableRefresh?: any, destructuring?: any) {\r\n    if (!appId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      appId,\r\n      appEntrance,\r\n      funcId: undefined,\r\n      appType: AppType.App,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${appId}_${appEntrance}_${tabId}` : `${appId}_${appEntrance}`;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    return this.runtimeFrameworkService.openMenu$(options);\r\n  }\r\n  /**\r\n   * å³é­\r\n   * @param onCloseing å³é­åäºä»¶å¤çå¨\r\n   */\r\n  public close() {\r\n    const options = this.querystrings;\r\n    const { isDialogComponent: isInDialog, rootComponent } = this.findDialog();\r\n    if (isInDialog) {\r\n      const modalRefFactory = this.get(rootComponent, 'dialogRef');\r\n      let modalRef = null;\r\n      if (typeof modalRefFactory === 'function') {\r\n        const refs = modalRefFactory();\r\n        modalRef = refs && refs.modalRef;\r\n      } else {\r\n        modalRef = modalRefFactory;\r\n      }\r\n      modalRef && modalRef['close']();\r\n      return;\r\n    }\r\n    options.token = options.formToken;\r\n    this.runtimeFrameworkService.beforeCloseMenu(options);\r\n  }\r\n  /**\r\n   * å¼ºå¶å³é­\r\n   */\r\n  public destory() {\r\n    const options = this.querystrings;\r\n    options.token = options.formToken;\r\n    this.runtimeFrameworkService.closeMenu(options);\r\n  }\r\n  /**\r\n   *\r\n   * @param params params\r\n   * @deprecated å¾åºå¼ï¼ä¸buildParamMapéå¤\r\n   */\r\n  private parseParams(params: any) {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (typeof params === 'object') {\r\n      params = JSON.stringify(params);\r\n    }\r\n    params = window['encodeURIComponent'](params);\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    return paramMap;\r\n  }\r\n  /**\r\n   * æ³¨åäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å onTabClosed\r\n   * @param handler å¤çå¨\r\n   * @returns string è¿åäºä»¶æ è¯\r\n   */\r\n  public addEventListener(eventType: string, handler: (options: AppOptions) => any): string {\r\n    return this.navigationEventService.addEventListener(eventType, handler);\r\n  }\r\n  /**\r\n   * ç§»é¤äºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å onTabClosed | onTabCloseing\r\n   * @param key äºä»¶æ è¯\r\n   */\r\n  public removeEventListener(eventType: string, key: string): boolean {\r\n    return this.navigationEventService.removeEventListener(eventType, key);\r\n  }\r\n  /**\r\n   * æ¸ç©ºäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å\r\n   */\r\n  public clearEventListener(eventType: string): void {\r\n    this.navigationEventService.clearEventListener(eventType);\r\n  }\r\n  /**\r\n   * ä»¥å¼¹æ¡ãä¾§è¾¹æ ææ°æ ç­¾é¡µæ¹å¼æå¼è¡¨å\r\n   * @param mode æå¼æ¹å¼ï¼æ¯æ`modal`å¼¹çªã`sidebar`ä¾§è¾¹æ ã`tab`æ°æ ç­¾é¡µ\r\n   * @param modalId å¼¹çªidï¼å¦æmode=`modal`ä¸æ²¡æurlï¼\r\n   * @param configs å¼¹çªéç½®\r\n   * @param url è¿ç«¯è¡¨åurl\r\n   * @param tabId æ ç­¾é¡µidï¼modal=tabæ¶å¿å¡«\r\n   * @param tabType æ ç­¾é¡µç±»åï¼`menu` æ`app`\r\n   * @param funcOrAppId èåæåºç¨id\r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params åæ°\r\n   * @param tabName æ°æ ç­¾é¡µåç§°\r\n   * @param enableRefresh å¯ç¨å¯å¨å·æ°\r\n   * @param destructuring æ¯å¦è§£æ\r\n   */\r\n  public open(mode: 'modal' | 'sidebar' | 'tab', modalId?: string, url?: string, configs?: any, tabId?: string, tabType?: 'menu' | 'app', funcOrAppId?: string, appEntrance?: string, params?: any, tabName?: string, enableRefresh?: any, destructuring?: any) {\r\n    const pageModalService = this.injector.get<FEPageModalService>(FEPageModalService, null);\r\n    if (!pageModalService) {\r\n      throw new Error('get FEPageModalService failed.');\r\n    }\r\n    // æ ¡éªåæ°æ¯å¦åæ³\r\n    if (!mode) {\r\n      throw new Error('[NavigationService]->open,modeåæ°ä¸è½ä¸ºç©ºï¼');\r\n    }\r\n    if (mode === 'modal' || mode === 'sidebar') {\r\n      if (!modalId && !url) {\r\n        throw new Error('å¼¹çªåä¾§è¾¹æ æ¨¡å¼æ¶å¼¹çªå®¹å¨idåè¡¨åè·¯å¾ä¸è½åæ¶ä¸ºç©ºï¼');\r\n      }\r\n      if (modalId && url) {\r\n        throw new Error('å¼¹çªåä¾§è¾¹æ æ¨¡å¼æ¶å¼¹çªå®¹å¨idåè¡¨åè·¯å¾ä¸è½åæ¶å­å¨ï¼');\r\n      }\r\n      const uiStateConfig = this.getObjectTypeConfig(params);\r\n      const modalConfig = this.buildConfigs(configs);\r\n      if (mode === 'sidebar') {\r\n        modalConfig.dialogType = mode;\r\n      }\r\n      let pageModalRef = null;\r\n      if (modalId) {\r\n        const farrisFormService = this.injector.get<FarrisFormService>(FarrisFormService, null);\r\n        if (!farrisFormService) {\r\n          return;\r\n        }\r\n        const componentType = farrisFormService.getControls(modalId);\r\n        const componentRef = this.createComponentRef(componentType, uiStateConfig);\r\n        pageModalRef = pageModalService.show(componentRef, modalConfig);\r\n      } else if (url) {\r\n        pageModalRef = pageModalService.showByUrl(url, modalConfig);\r\n      }\r\n      if (pageModalRef && !!pageModalRef.content) {\r\n        pageModalRef.content.isDialogRootComponent = true;\r\n        pageModalRef.content.dialogRef = pageModalRef;\r\n        const header = pageModalRef.dialog && pageModalRef.dialog.instance && pageModalRef.dialog.instance.el && pageModalRef.dialog.instance.el.nativeElement && pageModalRef.dialog.instance.el.nativeElement.querySelector(\".f-page-header\");\r\n        if (header && pageModalRef.dialog.instance.draggbar) {\r\n          pageModalRef.dialog.instance.draggbar.handle = header;\r\n          header.style.cursor = 'move';\r\n        }\r\n      }\r\n    } else if (mode === 'tab') {\r\n      if (!tabId || !tabType || !funcOrAppId) {\r\n        if (this.formNotifyService) {\r\n          this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n        }\r\n        throw new Error('æ°æ ç­¾æ¨¡å¼æ¶æ ç­¾é¡µidãæ ç­¾ç±»åãèåæåºç¨idåä¸è½ä¸ºç©ºï¼');\r\n      }\r\n      if (tabType === 'app' && !appEntrance) {\r\n        throw new Error('ä»¥åºç¨æ¹å¼æå¼æ¶å¥å£åºç¨ä¸è½ä¸ºç©ºï¼');\r\n      }\r\n      if (tabType == 'app') {\r\n        this.openApp(tabId, funcOrAppId, appEntrance, params, false, tabName, enableRefresh, destructuring);\r\n      } else if (tabType === 'menu') {\r\n        this.openMenu(tabId, funcOrAppId, params, false, enableRefresh, tabName, destructuring);\r\n      }\r\n    } else {\r\n      throw new Error('ä¸æ¯æçæ¨¡å¼ï¼');\r\n    }\r\n    // this.pageModalService.\r\n  }\r\n  /**\r\n   * in app navigate\r\n   * @param commands commands\r\n   */\r\n  // public navigate(commands: any[]);\r\n  /**\r\n   * in app navigate\r\n   * @param commands commands\r\n   * @param options options\r\n   * @description options:{ relativeTo: this.activatedRoute, queryParams:{a:1,b:2},etc:...}\r\n   */\r\n  public navigate(commands: any[], options?: any): Promise<boolean> {\r\n    const router = this.injector && this.injector.get<Router>(Router, null);\r\n    const activatedRoute = this.injector && this.injector.get<ActivatedRoute>(ActivatedRoute, null);\r\n    const queryParams = lodash.merge({}, this.querystrings, options && options.queryParams || {});\r\n    if (options && options.hasOwnProperty('queryParams')) {\r\n      delete options.queryParams;\r\n    }\r\n    const extras = lodash.merge({ skipLocationChange: false, relativeTo: activatedRoute, queryParams }, options || {});\r\n    if (router) {\r\n      return router.navigate(commands, extras);\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  // #endregion\r\n\r\n  // #region ç§ææ¹æ³\r\n\r\n  /**\r\n   * å°è£è·¯ç±åæ°\r\n   * @param params åæ°\r\n   * @param options éç½®åæ°\r\n   */\r\n  private buildParamMap(params: any, options?: any): Map<string, string> {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (options && Object.keys(options).length > 0) {\r\n      if (typeof params !== 'object') {\r\n        params = JSON.parse(params);\r\n      }\r\n      params = lodash.merge(params, options);\r\n    }\r\n    if (typeof params === 'object') {\r\n      params = JSON.stringify(params);\r\n    }\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    params = window['encodeURIComponent'](params);\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);\r\n    return paramMap;\r\n  }\r\n  private buildParam(params, options?: any): Map<string, string> {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (options && Object.keys(options).length > 0) {\r\n      if (typeof params !== 'object') {\r\n        params = JSON.parse(params);\r\n      }\r\n      params = lodash.merge(params, options);\r\n    }\r\n    if (typeof params !== 'object') {\r\n      params = JSON.parse(params);\r\n    }\r\n    Object.keys(params).forEach(key => {\r\n      paramMap.set(key, params[key]);\r\n    });\r\n\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    params = window['encodeURIComponent'](JSON.stringify(params));\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);\r\n    return paramMap;\r\n  }\r\n  /**\r\n   * æ¥æ¾å¼¹çªç»ä»¶\r\n   */\r\n  private findDialog() {\r\n    let frameContext = this.get(this, 'commandContext.frameContext');\r\n    let isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n    let rootComponent = null;\r\n    let parentFrameContext = this.get(frameContext, 'parent');\r\n    while (parentFrameContext != null && !isDialogComponent) {\r\n      frameContext = this.get(frameContext, 'parent');\r\n      parentFrameContext = this.get(parentFrameContext, 'parent');\r\n      isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n    }\r\n    rootComponent = this.get(frameContext, 'frameComponent');\r\n    if (!isDialogComponent) {\r\n      isDialogComponent = this.frameContext.injector.get<boolean>(INSIDE_DIALOG_TOKEN, false);\r\n      if (isDialogComponent) {\r\n        const modalRef = this.frameContext.injector.get<BsModalRef>(MODAL_REF, null);\r\n        rootComponent = { dialogRef: modalRef };\r\n      }\r\n    }\r\n    return { isDialogComponent, rootComponent };\r\n  }\r\n\r\n  /**\r\n   * loadsh get\r\n   * @param object å¯¹è±¡\r\n   * @param path è·¯å¾\r\n   * @param defaultVal é»è®¤å¼\r\n   */\r\n  private get(object: any, path: Array<string> | string, defaultVal: any = null) {\r\n    const PATH = Array.isArray(path)\r\n      ? path\r\n      : path.split('.').filter(i => i.length);\r\n    if (!PATH.length) {\r\n      return object === undefined ? defaultVal : object;\r\n    }\r\n\r\n    if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {\r\n      return defaultVal;\r\n    }\r\n\r\n    return this.get(object[PATH.shift()], PATH, defaultVal);\r\n  }\r\n  private convertToBoolean(value: any, defaultVal: boolean = false) {\r\n    if (typeof value === 'undefined' || value === null) {\r\n      value = defaultVal;\r\n    }\r\n    if (typeof value === 'string') {\r\n      value = value || String(defaultVal);\r\n      value = value === 'true' ? true : false;\r\n    }\r\n    return value;\r\n  }\r\n  /**\r\n   * ç¿»è¯èµæºé¡¹\r\n   * @param key èµæºé¡¹key\r\n   */\r\n  private translate(key: string) {\r\n    const translateService = this.injector && this.injector.get<Translate>(TranslateToken, null) || null;\r\n    if (translateService && key && key.startsWith('{{') && key.endsWith('}}')) {\r\n      key = key.replace('{{', '').replace('}}', '').trim();\r\n      return translateService.transform(key, null);\r\n    }\r\n    return key;\r\n  }\r\n  // #endregion\r\n\r\n  //#region å¼¹çªç¸å³æ¹æ³\r\n  private buildConfigs(config: any): { [prop: string]: any } {\r\n    let languageService = this.injector.get<LanguageService>(LanguageService, null);\r\n    if (!languageService) {\r\n      languageService = LanguageService.getInstance();\r\n    }\r\n\r\n    const defaultConfigs: any = {\r\n      title: languageService && languageService.defaultDialogTitle || '',\r\n      width: 800,\r\n      height: 500,\r\n      showButtons: false\r\n    };\r\n    const objectTypeConfig = this.getObjectTypeConfig(config);\r\n    const configs = Object.assign(defaultConfigs, objectTypeConfig);\r\n    const onClosingHandler = configs.beforeClose;\r\n    const refresh = configs['refresh'] || {};\r\n    const refreshCommandName = refresh && refresh.commandName || null;\r\n    const refreshFrameId = refresh && refresh.frameId || null;\r\n    // tslint:disable: no-string-literal\r\n    const cancelChanges = configs['cancelChanges'] || false;\r\n    configs.beforeClose = (ref) => {\r\n      if (!!onClosingHandler && typeof onClosingHandler === 'function') {\r\n        return onClosingHandler(ref).pipe(\r\n          switchMap(result => {\r\n            if (result) {\r\n              if (cancelChanges) {\r\n                return this.cancelChanges(ref).pipe(\r\n                  switchMap(() => this.refreshForm(refreshCommandName, refreshFrameId))\r\n                );\r\n              }\r\n            }\r\n            return of(result);\r\n          })\r\n        );\r\n      } else {\r\n        if (cancelChanges) {\r\n          return this.cancelChanges(ref).pipe(\r\n            switchMap(() => this.refreshForm(refreshCommandName, refreshFrameId))\r\n          );\r\n        } else {\r\n          return of(true);\r\n        }\r\n      }\r\n\r\n    };\r\n    return configs;\r\n  }\r\n  private getObjectTypeConfig(config: any) {\r\n    let objectTypeConfig: any\r\n    if (typeof config === 'undefined') {\r\n      config = {};\r\n    }\r\n    if (typeof config === 'string') {\r\n      if (config.length) {\r\n        try {\r\n          objectTypeConfig = JSON.parse(config);\r\n        } catch {\r\n          throw new Error(config + 'ä¸æ¯åæ³çjsonå­ç¬¦ä¸²');\r\n        }\r\n      } else {\r\n        objectTypeConfig = {};\r\n      }\r\n    } else if (typeof config === 'object') {\r\n      objectTypeConfig = Object.assign({}, config);\r\n    } else {\r\n      throw new Error('å¡«åå¯¹è±¡æ ¼å¼æjsonå­ç¬¦ä¸²');\r\n    }\r\n    return objectTypeConfig;\r\n  }\r\n  /**\r\n   * åæ¶æå¡å¨åæ´é\r\n   */\r\n  private cancelChanges(ref: any): Observable<boolean> {\r\n    if (ref && ref.modalRef && ref.modalRef.content) {\r\n      const component: FrameComponent = ref.modalRef.content as FrameComponent;\r\n      if (component && component.context) {\r\n        const repository = component.context.repository || null;\r\n        if (repository) {\r\n          return repository.cancelChanges().pipe(switchMap(() => of(true)));\r\n        }\r\n      }\r\n    }\r\n    return of(true);\r\n  }\r\n  private refreshForm(refreshCommandName: string, refreshFrameId: string): Observable<any> {\r\n    if (refreshCommandName && refreshFrameId) {\r\n      const frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(refreshFrameId);\r\n      if (frameContext) {\r\n        const viewModel = frameContext.viewModel;\r\n        return viewModel[refreshCommandName]().pipe(\r\n          map(() => true)\r\n        );\r\n      }\r\n    }\r\n    return of(true);\r\n  }\r\n  private createComponentRef(componentType: any, uiStateObject: any) {\r\n    let componentRef: any;\r\n    const frameContext = this.getFrameContext();\r\n    const componentFactoryResolver = this.getComponentFactoryResolver();\r\n    if (frameContext && componentFactoryResolver) {\r\n      const contentCmptFactory = componentFactoryResolver.resolveComponentFactory(componentType);\r\n      const modalContentInjector = ReflectiveInjector.resolveAndCreate([], frameContext.injector);\r\n      componentRef = contentCmptFactory.create(modalContentInjector);\r\n      if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {\r\n        if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {\r\n          Object.keys(uiStateObject).forEach(item => {\r\n            componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);\r\n          });\r\n        }\r\n        // éå isDialogåæ°\r\n        componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n      }\r\n    }\r\n    return componentRef;\r\n  }\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åframeContext\r\n   */\r\n  private getFrameContext() {\r\n    if (this.frameContext) {\r\n      return this.frameContext\r\n    }\r\n    if (this['context'] && this['context']['frameContext']) {\r\n      return this['context']['frameContext'];\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åComponentFactoryResolver\r\n   */\r\n  private getComponentFactoryResolver() {\r\n    const frameContext = this.getFrameContext();\r\n    let componentFactoryResolver: any;\r\n    if (frameContext) {\r\n      componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);\r\n    }\r\n    return componentFactoryResolver;\r\n  }\r\n  //#endregion\r\n}\r\n","import { FrameContext } from '@farris/devkit';\r\nimport { AppParamUtil } from './app-param.util';\r\n\r\nconst IS_ADD = 'IS_ADD';\r\nconst LAST_MODIFIED_ID = 'LAST_MODIFIED_ID';\r\n\r\n/**\r\n * è¡¨åç¶æå·¥å·ç±»\r\n * @internal\r\n */\r\nclass EditStateUtil {\r\n\r\n    /**\r\n     * è·åå½åè¡id\r\n     */\r\n    public static getLastModifiedId(frameContext: FrameContext): string {\r\n        // const lastModifiedId = AppParamUtil.get(frameContext, LAST_MODIFIED_ID);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        let lastModifiedId = null;\r\n        if (virtualRootFrameContext) {\r\n            lastModifiedId = virtualRootFrameContext.getParam(LAST_MODIFIED_ID);\r\n            return lastModifiedId ? lastModifiedId : null;\r\n        }\r\n        return lastModifiedId;\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®æåä¿®æ¹çid\r\n     */\r\n    public static setLastModifiedId(frameContext: FrameContext, lastModifiedId: string): void {\r\n        // AppParamUtil.set(frameContext, LAST_MODIFIED_ID, lastModifiedId);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(LAST_MODIFIED_ID, lastModifiedId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è·åæ°å¢ç¶æ\r\n     */\r\n    public static getAddState(frameContext: FrameContext, ): boolean {\r\n        // return AppParamUtil.get(frameContext, IS_ADD);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            return virtualRootFrameContext.getParam(IS_ADD);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®æ°å¢ç¶æ\r\n     */\r\n    public static setAddState(frameContext: FrameContext, lastModifiedId: string): void {\r\n        // AppParamUtil.set(frameContext, IS_ADD, true);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(IS_ADD, true);\r\n        }\r\n        this.setLastModifiedId(frameContext, lastModifiedId);\r\n    }\r\n\r\n    /**\r\n     * åæ¶æ°å¢ç¶æ\r\n     */\r\n    public static cancelAddState(frameContext: FrameContext) {\r\n        // AppParamUtil.set(frameContext, IS_ADD, false);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(IS_ADD, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®ç¼è¾ç¶æ\r\n     */\r\n    public static setEditState(frameContext: FrameContext, id: string) {\r\n        // AppParamUtil.set(frameContext, IS_ADD, false);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(IS_ADD, false);\r\n        }\r\n        this.setLastModifiedId(frameContext, id);\r\n    }\r\n}\r\n\r\nexport { EditStateUtil };\r\n","import { FrameContext  } from '@farris/devkit';\r\n\r\n/**\r\n * åºç¨ä¸ä¸æåéå·¥å·ç±»\r\n * @internal\r\n */\r\nclass AppParamUtil {\r\n\r\n  /**\r\n   * è·ååºç¨ä¸ä¸æåæ°\r\n   */\r\n  public static get(frameContext: FrameContext, name: string): any {\r\n    const appContext = frameContext.appContext;\r\n    return appContext.getParam(name);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®åºç¨ä¸ä¸æåæ°\r\n   */\r\n  public static set(frameContext: FrameContext, name: string, value: any) {\r\n    const appContext = frameContext.appContext;\r\n    return appContext.setParam(name, value);\r\n  }\r\n}\r\n\r\nexport { AppParamUtil };\r\n","import { FormNotifyService } from './form-notify.service';\r\n\r\nclass FormNotifyStrategyService {\r\n  /**\r\n   * æ¶æ¯æç¤º\r\n   * @param formNotifyService formNotifyService\r\n   * @param content content\r\n   */\r\n  public static info(formNotifyService: FormNotifyService, content: string) {\r\n    const search = window.location.hash;\r\n    const { odocDisableNotification = '' } = FormNotifyStrategyService.querystring(search);\r\n    if (odocDisableNotification && odocDisableNotification.toLowerCase() === 'true') {\r\n      return;\r\n    }\r\n    formNotifyService.info(content, { hideTitle: true });\r\n  }\r\n  /**\r\n   * æåæç¤º\r\n   * @param formNotifyService formNotifyService\r\n   * @param content content\r\n   */\r\n  public static success(formNotifyService: FormNotifyService, content: string) {\r\n    const search = window.location.hash;\r\n    const { odocDisableNotification = '' } = FormNotifyStrategyService.querystring(search);\r\n    if (odocDisableNotification && odocDisableNotification.toLowerCase() === 'true') {\r\n      return;\r\n    }\r\n    formNotifyService.success(content, { hideTitle: true });\r\n  }\r\n  private static querystring(querystring: string): any {\r\n    const urlSearchParams = new URLSearchParams(querystring);\r\n    const result = {};\r\n    urlSearchParams.forEach((value: string, key: string) => {\r\n      result[key] = value;\r\n    });\r\n    return result;\r\n  }\r\n}\r\nexport { FormNotifyStrategyService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { filter, take } from 'rxjs/operators';\r\nimport { AppContext, ViewModel, CommandContext, Entity, FrameContext } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\n\r\n/**\r\n * å½ä»¤æå¡\r\n * @scope FrameConmponent\r\n */\r\n@Injectable()\r\nclass CommandService {\r\n\r\n  /**\r\n   * åé¨cotnext\r\n   */\r\n  private innerContext: CommandContext;\r\n\r\n  /**\r\n   * contextåå¼æ¹æ³\r\n   */\r\n  public get context(): CommandContext {\r\n    return this.innerContext;\r\n  }\r\n\r\n  /**\r\n   * contextè®¾å¼æ¹æ³\r\n   */\r\n  public set context(context: CommandContext) {\r\n    this.innerContext = context;\r\n  }\r\n\r\n  constructor(\r\n    private viewModel: ViewModel,\r\n    private appContext: AppContext\r\n  ) { }\r\n\r\n  /**\r\n   * æ§è¡å½ä»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   * @param frameId æ¡æ¶ID\r\n   */\r\n  public execute(commandName: string, frameId?: string): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return;\r\n    }\r\n    let viewModel = this.viewModel;\r\n    if (frameId) {\r\n      const targetContext = this.appContext.frameContextManager.getFrameContextById(frameId);\r\n      viewModel = targetContext.viewModel;\r\n    }\r\n    return viewModel[commandName]();\r\n  }\r\n\r\n  /**\r\n   * ç­å¾BeSessionåå»º\r\n   * @returns ææ°åå»ºåºæ¥çBeSession\r\n   */\r\n  public waitForBeSession(): Observable<string> {\r\n    const frameContext = this.context.frameContext;\r\n    const befRepository = frameContext.repository as BefRepository<Entity>;\r\n    const sessionService = befRepository.restService.sessionService;\r\n    return sessionService.getBeSessionId().pipe(\r\n      filter((beSessionId: string) => {\r\n        return beSessionId !== null;\r\n      }),\r\n      take(1)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æåæä¸ªä»»å¡çæ§è¡ç»æ\r\n   * @param taskName ä»»å¡åç§°\r\n   * @reutrn è¿åtaskNameå¯¹åºä»»å¡çæ§è¡ç»æ\r\n   */\r\n  public extractResult(taskName: string) {\r\n    const results = this.context.results;\r\n    return results[taskName];\r\n  }\r\n  /**\r\n   * æåå½åç»ä»¶çè¡åæ¢äºä»¶æåº\r\n   */\r\n  public suspendFrameContextRowSelectedEvent(frameId?: string) {\r\n    let frameContext: FrameContext = this.viewModel.frameContext;\r\n    if (frameId) {\r\n      frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    }\r\n    if (frameContext) {\r\n      frameContext.bindingData.rowSelectedEventSuspend = true;\r\n    }\r\n\r\n  }\r\n  public resumeFrameContextRowSelectedEvent(frameId?: string) {\r\n    let frameContext: FrameContext = this.viewModel.frameContext;\r\n    if (frameId) {\r\n      frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    }\r\n    if (frameContext) {\r\n      frameContext.bindingData.rowSelectedEventSuspend = false;\r\n    }\r\n  }\r\n}\r\n\r\nexport { CommandService };\r\n","import { ElementRef } from \"@angular/core\";\r\n\r\nexport class VerifyService {\r\n  public static focusElement(selector: string, elementRef?: ElementRef) {\r\n    const nativeElement = elementRef && elementRef.nativeElement || document;\r\n    let target = nativeElement.ownerDocument.getElementById(selector);\r\n    if (target) {\r\n      if (target.tagName !== 'INPUT') {\r\n        const input = target.getElementsByTagName('input');\r\n        if (input.length) {\r\n          target = input[0];\r\n        }\r\n      }\r\n      target.focus();\r\n    }\r\n  }\r\n}","// tslint:disable: max-line-length\r\nimport { ElementRef, InjectFlags, Injectable, Optional, Self } from '@angular/core';\r\nimport { Repository, Entity, FrameContext, PARENT_CLASS, ChangeType, ValidationResult, ValidationError, ValidateRule, ViewModel, DataTypeInfo, DataPropGroup, DataPropInfo, BindingList, ComponentType } from '@farris/devkit';\r\nimport { tap, switchMap } from 'rxjs/operators';\r\nimport { EMPTY, Observable, Subject } from 'rxjs';\r\nimport { zip } from 'rxjs/observable/zip';\r\nimport { empty } from 'rxjs/observable/empty';\r\nimport { of } from 'rxjs/observable/of';\r\nimport { VerifyDetailService } from '@farris/ui-verify-detail';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { VerifyService } from './verify.service';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\n\r\n/**\r\n * è¡¨åéªè¯æå¡\r\n * @scope FrameComponent\r\n */\r\n\r\n@Injectable()\r\nclass ValidationService {\r\n\r\n  private validationResults = new Subject<any>();\r\n  private validationAllResult = new Subject<any>();\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private frameContext: FrameContext,\r\n    @Optional() private notifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = new LanguageService();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * éªè¯è¡¨ååçææè¡¨å\r\n   */\r\n  public validate() {\r\n    this.repository.getList().subscribe(\r\n      (result: Entity[]) => {\r\n        for (const entity of result) {\r\n          entity.validate().subscribe((result: ValidationResult) => {\r\n            if (!result.isValid) {\r\n              alert(result.message);\r\n              this.validationResults.next(result);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    );\r\n    return this.validationResults;\r\n  }\r\n  /**\r\n   * æ ¡éªå½åè¡\r\n   */\r\n  public validateCurrentRow(): Observable<any> {\r\n    const entityTypeInfo = this.repository.entityTypeInfo;\r\n    // ç»åè¡¨ååªæ ¡éªå½åæé®æå¨çè¡¨å\r\n    const primaryValue = this.frameContext.bindingData.list.currentId;\r\n    if (!primaryValue) {\r\n      return of(true);\r\n    }\r\n    // é¦åæ ¡éªå®ä½ä¸è½ä¸ºç©ºè§å\r\n    const entity = this.repository.entityCollection.getEntityById(primaryValue);\r\n    if (!entity) {\r\n      return of(true);\r\n    }\r\n\r\n    const entities: Entity[] = [entity];\r\n    const namespace = this.frameContext.namespace;\r\n    let frameContexts = [];\r\n    // ä¿®å¤ä½¿ç¨ç¸åbeåå»ºçvoçç»åè¡¨åæ ¡éªæ¶å¤ä¸ªè¡¨åæ ¡éªè§åè¢«åå¹¶çé®é¢\r\n    // TODO: ç®åæªèèç»åè¡¨åç»ä¸ä¿å­çåºæ¯ï¼åç»­æ¯æç»åè¡¨åç»ä¸ä¿å­æ¶åä¿®æ¹\r\n    if (namespace !== null) {\r\n      // å­å¨å½åç©ºé´ï¼è¯´æè¡¨åè¾æ°ï¼å¯ä»¥ä¾èµè¯¥ç¹æ§\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);\r\n    } else {\r\n      // è¡¨åè¾èï¼è·åææçä¸ä¸æï¼å¨æ ¡éªé¶æ®µè¿æ»¤è§å\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    }\r\n\r\n    const isModal = this.isInDialog();\r\n    const hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();\r\n    let rootViewModel = this.frameContext.root.viewModel;\r\n    if (isModal && hasOwnVerifyDetailService) {\r\n      rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;\r\n    }\r\n\r\n    let toValidate = false;\r\n    const formErrors = [];\r\n    frameContexts.forEach((frameContext: FrameContext) => {\r\n      if (frameContext.form && frameContext.form.enableValidate) {\r\n        toValidate = true;\r\n      }\r\n    });\r\n    if (!toValidate || entities.length < 1) {\r\n      return of(true);\r\n    }\r\n    rootViewModel.verifyInformations = [];\r\n    let formValid = true;\r\n    let entityValid = true;\r\n    const formValidationRules = new Map<string, ValidateRule[]>();\r\n    frameContexts.forEach((formContext: FrameContext) => {\r\n      const bindingObject = formContext.bindingData.getObject();\r\n      // éç¥ææbindingData,\r\n      bindingObject && bindingObject.setShowValidationMsg(true);\r\n      if (formContext.form && formContext.form.enableValidate) {\r\n        // è·åå½åè¡¨åä¸çææéªè¯è§å\r\n        const currentFormValidationRules = formContext.form.getValidationRules();\r\n        currentFormValidationRules.forEach((rules, path) => {\r\n          if (formValidationRules.has(path)) {\r\n            rules.forEach(rule => formValidationRules.get(path).push(rule));\r\n          } else {\r\n            formValidationRules.set(path, [...rules]);\r\n          }\r\n        });\r\n        formContext.form.setShowValidationMsg(true);\r\n        // éä¸ªè°ç¨è¡¨åçéªè¯ï¼éªè¯åç«¯è¡¨åè§å\r\n        if (!formContext.form.isFormValid()) {\r\n          formErrors.push(formContext.form);\r\n          formValid = false;\r\n        }\r\n      }\r\n    });\r\n\r\n    // éªè¯ææå®ä½\r\n    const observableList = entities.map((entity: Entity) => {\r\n      const index = this.frameContext.bindingData.list.getIndexById(entity.primaryValue);\r\n      return entity.validate(undefined, undefined, formValidationRules, null, this.frameContext);\r\n    });\r\n    const result$ = zip(...observableList).pipe(\r\n      tap((resultList) => {\r\n        frameContexts.forEach((formContext: FrameContext) => {\r\n          if (!formContext.form.enableValidate) {\r\n            return;\r\n          }\r\n          const handleErrors = (errors: ValidationError[]) => {\r\n            errors.forEach((validationError: ValidationError) => {\r\n              if (validationError.children && validationError.children.length) {\r\n                handleErrors(validationError.children);\r\n              }\r\n              const errMsgObj = {};\r\n              let id = '';\r\n              const findId = (target: any) => {\r\n                if (target && target.data && target.data.id) {\r\n                  id = target.data.id;\r\n                  return;\r\n                } else if (target[PARENT_CLASS]) {\r\n                  findId(target[PARENT_CLASS]);\r\n                }\r\n              };\r\n              findId(validationError.target);\r\n\r\n              // å®ä½éªè¯åºéï¼éè¦å°éè¯¯å±ç¤ºå°çé¢ä¸\r\n              // å®ä½ä¸ä¸å®æ¯å½åè¡\r\n              let parentPathData = {\r\n                path: [],\r\n                isUdt: false,\r\n                isGrid: false\r\n              };\r\n              if (validationError.target) {\r\n                parentPathData = validationError.target.getPaths();\r\n              }\r\n              const bindingPath = '/' + parentPathData.path.join('/');\r\n              if (validationError.constraints) {\r\n                Object.keys(validationError.constraints).forEach(key => {\r\n                  errMsgObj[key] = {\r\n                    name: validationError.constraints[key]\r\n                  };\r\n                  // if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n                  //   rootViewModel['verifyInformations'].push({\r\n                  //     id: id,\r\n                  //     title: key,\r\n                  //     msg: validationError.constraints[key],\r\n                  //     type: 'warn'\r\n                  //   })\r\n                  // }\r\n                });\r\n              }\r\n              const paths = parentPathData.path.concat(validationError.property);\r\n\r\n              //if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n              // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n              formContext.bindingData.changes.next({\r\n                type: ChangeType.UpdateErrors,\r\n                id,\r\n                path: paths,\r\n                isUdt: parentPathData.isUdt,\r\n                isGrid: parentPathData.isGrid,\r\n                value: validationError.value,\r\n                errors: errMsgObj\r\n              });\r\n              //}\r\n            });\r\n          };\r\n          // å±å¼éªè¯ç»æ\r\n          const isValidList = resultList.map((result: ValidationResult) => result.isValid);\r\n          // ä¿å­ååè°ç¨å®ä½ä¸çéªè¯è§åï¼å¨é¨éè¿ä¹åæä¿å­\r\n          // å®ä½éªè¯éè¿\r\n          if (isValidList.filter(x => x).length === observableList.length) {\r\n            // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n            formContext.bindingData.changes.next({\r\n              type: ChangeType.UpdateErrors,\r\n              path: []\r\n            });\r\n            // éªè¯æååéèè¾å¥æ¶çéªè¯\r\n            if (formValid) {\r\n              const bindingObject = formContext.bindingData.getObject();\r\n              bindingObject && bindingObject.setShowValidationMsg(false);\r\n              const form = formContext.form;\r\n              if (form) {\r\n                form.setShowValidationMsg(false);\r\n              }\r\n            }\r\n          } else {\r\n            // å®ä½éªè¯æéè¯¯\r\n            entityValid = false;\r\n            resultList.forEach((result: ValidationResult) => {\r\n              if (result.isValid) {\r\n                // æ¸é¤éªè¯éè¿çéè¯¯\r\n                formContext.bindingData.changes.next({\r\n                  type: ChangeType.UpdateErrors,\r\n                  path: []\r\n                });\r\n              } else {\r\n                handleErrors(result.errors);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }),\r\n      switchMap((resultList) => {\r\n        let isValidated = true;\r\n        const errors = [];\r\n        resultList.forEach((result: ValidationResult) => {\r\n          if (!result.isValid) {\r\n            isValidated = false;\r\n          }\r\n          errors.push(...result.errors);\r\n        });\r\n        if (errors.length > 0) {\r\n          this.collectValidationErrors(rootViewModel, errors, this.frameContext.namespace);\r\n        }\r\n        // rootViewModel.verifycationChanged.next(rootViewModel.verifyInformations);\r\n        let verifyInformations = rootViewModel.verifyInformations;\r\n        if (isModal && hasOwnVerifyDetailService) {\r\n          verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace === namespace);\r\n        }\r\n        rootViewModel.verifycationChanged.next(verifyInformations);\r\n        this.handleErrorClickEvent();\r\n        if (isValidated && !formValid) {\r\n          // å®ä½æ ¡éªéè¿ä½è¡¨åæ ¡éªä¸éè¿ï¼æ­¤æ¶å®ä½åè¡¨åå­å¨æ ¡éªè§åä¸ä¸è´çæåµ\r\n          console.warn('å®ä½åæ§ä»¶æ ¡éªè§åä¸ä¸è´ï¼è¯·ç¡®è®¤å®ä½æ ¡éªè§åéç½®ä¸æ§ä»¶ä¸è´ãå¦æéç½®ä¸ä¸è´å¯è½ä¼å¯¼è´æ ¡éªå¤±æï¼');\r\n        }\r\n        // å®ä½æ ¡éªéè¿ï¼å®ä½æ ¡éªä½¿ç¨çè§åæ¯æ§ä»¶+å®ä½ï¼æ­£å¸¸å®ä½æ ¡éªéè¿åæ§ä»¶æ ¡éªä¸å®ä¹ä¼éè¿\r\n        if (isValidated) {\r\n          const isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);\r\n          if (!isEntityValid) {\r\n            return EMPTY;\r\n          }\r\n          return of(true);\r\n        } else {\r\n          return empty();\r\n        }\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * è°ç¨è¡¨ååå®ä½ä¸çéªè¯è§å, éè¿åè°ç¨åè°cb\r\n   */\r\n  validateAll(): Observable<any> {\r\n    const entityTypeInfo = this.repository.entityTypeInfo;\r\n    // ç»åè¡¨ååªæ ¡éªå½åæé®æå¨çè¡¨å\r\n    const entities: Entity[] = this.repository.entityCollection.getAllEntities();\r\n    const namespace = this.frameContext.namespace;\r\n    let frameContexts = [];\r\n    if (namespace !== null) {\r\n      // å­å¨å½åç©ºé´ï¼è¯´æè¡¨åè¾æ°ï¼å¯ä»¥ä¾èµè¯¥ç¹æ§\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);\r\n    } else {\r\n      // è¡¨åè¾èï¼è·åææçä¸ä¸æï¼å¨æ ¡éªé¶æ®µè¿æ»¤è§å\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    }\r\n\r\n    let toValidate = false;\r\n    const formErrors = [];\r\n    frameContexts.forEach((frameContext: FrameContext) => {\r\n      if (frameContext.form && frameContext.form.enableValidate) {\r\n        toValidate = true;\r\n      }\r\n    });\r\n    if (!toValidate || entities.length < 1) {\r\n      return of(true);\r\n    }\r\n    const isModal = this.isInDialog();\r\n    const hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();\r\n    let rootViewModel = this.frameContext.root.viewModel;\r\n    if (isModal && hasOwnVerifyDetailService) {\r\n      rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;\r\n    }\r\n\r\n    let formValid = true;\r\n    let entityValid = true;\r\n    const formValidationRules = new Map<string, ValidateRule[]>();\r\n    frameContexts.forEach((formContext: FrameContext) => {\r\n      const bindingObject = formContext.bindingData.getObject();\r\n      // éç¥ææbindingData,\r\n      bindingObject && bindingObject.setShowValidationMsg(true);\r\n      if (formContext.form && formContext.form.enableValidate) {\r\n        // è·åå½åè¡¨åä¸çææéªè¯è§å\r\n        const currentFormValidationRules = formContext.form.getValidationRules();\r\n        currentFormValidationRules.forEach((rules, path) => {\r\n          if (formValidationRules.has(path)) {\r\n            rules.forEach(rule => formValidationRules.get(path).push(rule));\r\n          } else {\r\n            formValidationRules.set(path, [...rules]);\r\n          }\r\n        });\r\n        formContext.form.setShowValidationMsg(true);\r\n        // éä¸ªè°ç¨è¡¨åçéªè¯ï¼éªè¯åç«¯è¡¨åè§å\r\n        if (!formContext.form.isFormValid()) {\r\n          formErrors.push(formContext.form);\r\n          formValid = false;\r\n        }\r\n      }\r\n    });\r\n    // è§¦åææå®ä½çvalidateäºä»¶\r\n    const isMultiEntityValiate = entities.length > 0;\r\n\r\n    // éªè¯ææå®ä½\r\n    const observableList = entities.map((entity: Entity, index: number) =>\r\n      entity.validate(undefined, undefined, formValidationRules, isMultiEntityValiate ? index : null, this.frameContext));\r\n    const result$ = zip(...observableList).pipe(\r\n      tap((resultList) => {\r\n        frameContexts.forEach((formContext: FrameContext) => {\r\n          if (!formContext.form.enableValidate) {\r\n            return;\r\n          }\r\n          const handleErrors = (errors: ValidationError[]) => {\r\n            errors.forEach((validationError: ValidationError) => {\r\n              if (validationError.children && validationError.children.length) {\r\n                handleErrors(validationError.children);\r\n              }\r\n              const errMsgObj = {};\r\n              let id = '';\r\n              const findId = (target: any) => {\r\n                if (target && target.data && target.data.id) {\r\n                  id = target.data.id;\r\n                  return;\r\n                } else if (target[PARENT_CLASS]) {\r\n                  findId(target[PARENT_CLASS]);\r\n                }\r\n              };\r\n              findId(validationError.target);\r\n\r\n              // å®ä½éªè¯åºéï¼éè¦å°éè¯¯å±ç¤ºå°çé¢ä¸\r\n              // å®ä½ä¸ä¸å®æ¯å½åè¡\r\n              let parentPathData = {\r\n                path: [],\r\n                isUdt: false,\r\n                isGrid: false\r\n              };\r\n              if (validationError.target) {\r\n                parentPathData = validationError.target.getPaths();\r\n              }\r\n              const bindingPath = '/' + parentPathData.path.join('/');\r\n              if (validationError.constraints) {\r\n                Object.keys(validationError.constraints).forEach(key => {\r\n                  errMsgObj[key] = {\r\n                    name: validationError.constraints[key]\r\n                  };\r\n                  // if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n                  //   rootViewModel['verifyInformations'].push({\r\n                  //     id: id,\r\n                  //     title: key,\r\n                  //     msg: validationError.constraints[key],\r\n                  //     type: 'warn'\r\n                  //   })\r\n                  // }\r\n                });\r\n              }\r\n              const paths = parentPathData.path.concat(validationError.property);\r\n\r\n              //if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n              // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n              formContext.bindingData.changes.next({\r\n                type: ChangeType.UpdateErrors,\r\n                id,\r\n                path: paths,\r\n                isUdt: parentPathData.isUdt,\r\n                isGrid: parentPathData.isGrid,\r\n                value: validationError.value,\r\n                errors: errMsgObj\r\n              });\r\n              //}\r\n            });\r\n          };\r\n          // å±å¼éªè¯ç»æ\r\n          const isValidList = resultList.map((result: ValidationResult) => result.isValid);\r\n          // ä¿å­ååè°ç¨å®ä½ä¸çéªè¯è§åï¼å¨é¨éè¿ä¹åæä¿å­\r\n          // å®ä½éªè¯éè¿\r\n          if (isValidList.filter(x => x).length === observableList.length) {\r\n            // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n            formContext.bindingData.changes.next({\r\n              type: ChangeType.UpdateErrors,\r\n              path: []\r\n            });\r\n            // éªè¯æååéèè¾å¥æ¶çéªè¯\r\n            if (formValid) {\r\n              const bindingObject = formContext.bindingData.getObject();\r\n              bindingObject && bindingObject.setShowValidationMsg(false);\r\n              const form = formContext.form;\r\n              if (form) {\r\n                form.setShowValidationMsg(false);\r\n              }\r\n            }\r\n          } else {\r\n            // å®ä½éªè¯æéè¯¯\r\n            entityValid = false;\r\n            resultList.forEach((result: ValidationResult) => {\r\n              if (result.isValid) {\r\n                // æ¸é¤éªè¯éè¿çéè¯¯\r\n                formContext.bindingData.changes.next({\r\n                  type: ChangeType.UpdateErrors,\r\n                  path: []\r\n                });\r\n              } else {\r\n                handleErrors(result.errors);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }),\r\n      switchMap((resultList) => {\r\n        let isValidated = true;\r\n        const errors = [];\r\n        resultList.forEach((result: ValidationResult) => {\r\n          if (!result.isValid) {\r\n            isValidated = false;\r\n          }\r\n          errors.push(...result.errors);\r\n        });\r\n        if (errors.length > 0) {\r\n          this.collectValidationErrors(rootViewModel, errors, this.frameContext.namespace);\r\n        }\r\n        let verifyInformations = rootViewModel.verifyInformations;\r\n        if (isModal && hasOwnVerifyDetailService) {\r\n          verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace === namespace);\r\n        }\r\n        // å ä¸ºæ ¡éªç´¯å çç¼æï¼å¯¼è´ä¹åçæ ¡éªä¿¡æ¯ä¸ç´å­å¨ï¼åªè½éè¿æ ¡éªç»ææ¥ç¡®å®æ¯å¦è¿æéè¯¯ä¿¡æ¯\r\n        if (isValidated && formValid) {\r\n          verifyInformations = rootViewModel.verifyInformations = [];\r\n        }\r\n        rootViewModel.verifycationChanged.next(verifyInformations);\r\n        this.handleErrorClickEvent();\r\n        if (isValidated) {\r\n          const isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);\r\n          if (!isEntityValid) {\r\n            return EMPTY;\r\n          }\r\n          return of(true);\r\n        } else {\r\n          return empty();\r\n        }\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * æ ¡éªå®ä½æ¯å¦æ»¡è¶³ä¸è½ä¸ºç©ºçè§å\r\n   * @param entity ä¸»å®ä½\r\n   */\r\n  private validateEntityAllowEmptyRule(entityTypeInfo: DataTypeInfo) {\r\n    // ç¡®è®¤å®ä½åä¸ªå±çº§ä¸­æ¯å¦å­å¨ä¸è½ä¸ºç©ºçè§å\r\n    const paths = this.getNotAllowEmptyBindingPaths(entityTypeInfo);\r\n    if (!paths || paths.length < 1) {\r\n      return true;\r\n    }\r\n    // æ¾å°ææä¸åæ³çbindingPaths\r\n    const invalidPaths = paths.filter((path: string) => {\r\n      const bindingPaths = path.split('/').filter(p => p);\r\n      const bindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n      if (!bindingList || bindingList.length < 1) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    // æå®ä½å¿å¡«ï¼ä½å®ä½æ°æ®ä¸ºç©º\r\n    if (invalidPaths.length > 0) {\r\n      const tableNames = [];\r\n      invalidPaths.forEach((path: string) => {\r\n        //const frameContexts = this.getFrameContextByBindingPath(path.split('/'));\r\n        //const frameComponents = frameContexts.map(frameContext => frameContext.frameComponent);\r\n        // æ¾å°ææå®¹å¨ç±»ç»ä»¶\r\n        //const containerComponents = frameComponents.filter(frameComponent => [ComponentType.farrisDataGridComponent, ComponentType.farrisTreeTalbeComponent, ComponentType.kendoGridComponent, ComponentType.primengTreeComponent].includes(frameComponent.componentType));\r\n        //if (!(!containerComponents || containerComponents.length < 1)) {\r\n        const viewModelName = this.getViewModelNameByBindingPaths(path.split('/')) || `ç»å®è·¯å¾${path}`;\r\n        tableNames.push(viewModelName);\r\n        //}\r\n      });\r\n      if (this.notifyService) {\r\n        this.notifyService.error(`${tableNames.join('ï¼')} ${this.languageService.tableCanNotEmpty}`, { hideTitle: true });\r\n      }\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  /**\r\n   * \r\n   * @param bindingPaths pathä¸è½ä¸ºç©ºæ/ï¼ä¸æ¯æä¸»è¡¨\r\n   */\r\n  private getViewModelNameByBindingPaths(bindingPaths: string[]) {\r\n    const namespace = this.frameContext.namespace;\r\n    let frameContexts: FrameContext[] = null;\r\n    if (namespace !== null) {\r\n      // å­å¨å½åç©ºé´ï¼è¯´æè¡¨åè¾æ°ï¼å¯ä»¥ä¾èµè¯¥ç¹æ§\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);\r\n    } else {\r\n      // è¡¨åè¾èï¼è·åææçä¸ä¸æï¼å¨æ ¡éªé¶æ®µè¿æ»¤è§å\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    }\r\n    const bindingPath = bindingPaths.filter(p => p).join('/');\r\n    const frameContext = frameContexts.find((frameContext: FrameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);\r\n    const viewModelName = frameContext && frameContext.form && frameContext.form.formGroupName || '';\r\n    return viewModelName;\r\n  }\r\n  /**\r\n   * éåè·åææä¸è½ä¸ºç©ºçå®ä½çç»å®è·¯å¾\r\n   * @param entityTypeInfo \r\n   * @param results \r\n   * @returns \r\n   */\r\n  private getNotAllowEmptyBindingPaths(entityTypeInfo: DataTypeInfo, results: string[] = []): string[] {\r\n    if (!entityTypeInfo) {\r\n      return;\r\n    }\r\n    this.deepFirstTraversalEntityTypeInfo(entityTypeInfo, results);\r\n    return results;\r\n  }\r\n  private deepFirstTraversalEntityTypeInfo(entityTypeInfo: DataTypeInfo, result: string[] = [], previousValue: string[] = []) {\r\n    // ç¡®è®¤å½åå®ä½æ¯å¦å¿å¡«\r\n    const isAllowEmpty = this.isAllowEmpty(entityTypeInfo.entityInfo.allowEmpty, previousValue);\r\n    if (isAllowEmpty === false) {\r\n      if (previousValue.length < 1) {\r\n        result.push('');\r\n      } else {\r\n        result.push(previousValue.join('/'));\r\n      }\r\n    }\r\n    // è·åææå­è¡¨\r\n    const list = entityTypeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n    if (list && list.length > 0) {\r\n      list.forEach((propInfo: DataPropInfo) => {\r\n        const typeInfo = propInfo.typeInfo;\r\n        if (typeInfo && typeInfo.entityInfo) {\r\n          previousValue.push(typeInfo.entityInfo.nodeCode);\r\n          this.deepFirstTraversalEntityTypeInfo(typeInfo, result, previousValue);\r\n        }\r\n      });\r\n    }\r\n    // æ²¡æä¸çº§äºï¼æ­¤æ¶åºè¯¥æ¸ç©ºæ¸¸æ ï¼å°æ¶éå°çè·¯å¾æ¾å°ç»æéä¸­\r\n    if (previousValue && previousValue.length > 0) {\r\n      previousValue.pop();\r\n    }\r\n  }\r\n  private isAllowEmpty(value: string | boolean, paths: string[]) {\r\n    if (value === undefined || value === true || value === '') {\r\n      return true;\r\n    }\r\n    // å¼åèå®ä¹äºä¸è½ä¸ºç©ºçè§å\r\n    const frameContexts = this.getFrameContextByBindingPath(paths);\r\n    let caller = this.frameContext.frameComponent;\r\n    if (!frameContexts || frameContexts.length < 1) {\r\n      // å®ä¹äºè§åä½å¯¹åºçFrameæ²¡ææ¸²æ\r\n      console.warn(`ç»å®è·¯å¾ ${paths.join('/')} å®ä¹äºä¸è½ä¸ºç©ºçè§åï¼ä½æ¾ä¸å°è¯¥ç»å®è·¯å¾å¯¹åºçç»ä»¶ãè¯·ç¡®ä¿ç»ä»¶æ¾éä¸å¿å¡«ä¸è´ã`);\r\n    } else {\r\n      caller = frameContexts.pop().frameComponent;\r\n    }\r\n    if (typeof value === 'boolean') {\r\n      return value;\r\n    } else if (typeof value === 'string') {\r\n      value = value.trim().startsWith('return') ? value : `return ${value}`;\r\n      const factory = new Function(`\r\n        var viewModel = this.viewModel;\r\n        var bindingData = this.bindingData;\r\n        var context = this.context;\r\n        ${value}\r\n      `);\r\n      return factory.apply(caller);\r\n    } else {\r\n      console.warn(`æ æçå¿å¡«è§åã`);\r\n    }\r\n  }\r\n  collectValidationErrors(rootViewModel: ViewModel, errors: ValidationError[], namespace: string, filter: boolean = true) {\r\n    if (filter) {\r\n      rootViewModel.verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace !== namespace);\r\n    }\r\n    errors.forEach((validationError: ValidationError) => {\r\n      if (validationError.children && validationError.children.length) {\r\n        this.collectValidationErrors(rootViewModel, validationError.children, namespace, false);\r\n      }\r\n      let id = '';\r\n      const findId = (target: any) => {\r\n        if (target && target.data && target.data.id) {\r\n          id = target.data.id;\r\n          return;\r\n        } else if (target[PARENT_CLASS]) {\r\n          findId(target[PARENT_CLASS]);\r\n        }\r\n      };\r\n      findId(validationError.target);\r\n      if (validationError.constraints) {\r\n        const validationResultTypes = Object.keys(validationError.constraints);\r\n        if (validationResultTypes.length) {\r\n          const offset = rootViewModel.verifyInformations.filter(item => item.namespace === namespace).length;\r\n          let index = rootViewModel.verifyInformations.findIndex(item => item.namespace === namespace);\r\n          index = index === -1 ? 0 : index + offset;\r\n          rootViewModel.verifyInformations.splice(index, 0, {\r\n            id: id,\r\n            namespace,\r\n            targetField: validationError.field,\r\n            index: validationError.index,\r\n            title: validationError.propertyName,\r\n            msg: validationError.constraints[validationResultTypes[0]],\r\n            frameContext: validationError.frameContext,\r\n            fullPath: validationError.fullPath,\r\n            type: validationResultTypes[0] === 'required' ? 'empty' : 'error'\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * éç½®æ ¡éªä¿¡æ¯ï¼ä»å½åè¡¨åï¼\r\n   */\r\n  public resetValidation(): Observable<any> {\r\n    const isDialog = this.isInDialog();\r\n    let rootViewModel = this.frameContext.root.viewModel;\r\n    if (isDialog) {\r\n      rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;\r\n    }\r\n    let verifyInformations = rootViewModel.verifyInformations;\r\n    if (verifyInformations.length) {\r\n      const namespace = this.frameContext.namespace;\r\n      if (namespace !== null) {\r\n        verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace !== namespace);\r\n      }\r\n      rootViewModel.verifyInformations = verifyInformations;\r\n      //rootViewModel.verifyInformations.splice(0, rootViewModel.verifyInformations.length);\r\n    }\r\n    if (rootViewModel && rootViewModel.verifycationChanged) {\r\n      rootViewModel.verifycationChanged.next(verifyInformations);\r\n    }\r\n    return of(null);\r\n  }\r\n  /**\r\n   * æ¯å¦å¨å¼¹çªåé¨\r\n   */\r\n  private isInDialog() {\r\n    return this.frameContext && this.frameContext.getVirtualRootFrameContext() && this.frameContext.getVirtualRootFrameContext().frameComponent && this.frameContext.getVirtualRootFrameContext().frameComponent['isDialogRootComponent'] || false;\r\n  }\r\n  /**\r\n   * æ¥æç¬èªçæ ¡éªæç¤ºæå¡\r\n   */\r\n  private hasOwnVerifyDetailService() {\r\n    return this.frameContext.injector.get<VerifyDetailService>(VerifyDetailService, null) !== this.frameContext.root.appContext.injector.get<VerifyDetailService>(VerifyDetailService, null);;\r\n  }\r\n  /**\r\n   * éè¿bindingPathè·åææå¹éçframeContext\r\n   * @param bindingPath \r\n   * @returns \r\n   */\r\n  private getFrameContextByBindingPath(bindingPaths: string[]): FrameContext[] {\r\n    const bindingPath = bindingPaths.filter(p => p).join('/');\r\n    return this.frameContext.appContext.frameContextManager.getFrameContexts().filter(frameContext => frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);\r\n  }\r\n  private get verifyDetailService() {\r\n    return this.frameContext.injector.get<VerifyDetailService>(VerifyDetailService, null, InjectFlags.Self);\r\n  }\r\n  private handleErrorClickEvent() {\r\n    if (this.verifyDetailService && this.verifyDetailService.verifyContainer && this.verifyDetailService.verifyContainer.instance) {\r\n      this.verifyDetailService.verifyContainer.instance.validatorClick.subscribe((item: any) => {\r\n        this.onErrorItemClick(item);\r\n      });\r\n    }\r\n  }\r\n  private onErrorItemClick(item: { frameContext: FrameContext, id: string, targetField: string, fullPath: string } = { frameContext: null, id: null, targetField: null, fullPath: null }) {\r\n    const { frameContext, id, targetField, fullPath } = item;\r\n    const isGridComponent = frameContext && frameContext.frameComponent.isGridComponent || false;\r\n    if (!isGridComponent) {\r\n      if (!targetField) { }\r\n      const elementRef = frameContext.injector.get(ElementRef, null, InjectFlags.Self) || frameContext.injector.get(ElementRef, null);\r\n      VerifyService.focusElement(targetField, elementRef);\r\n      this.verifyDetailService.verifyContainer.instance.showList = false;\r\n    } else {\r\n      // find grid component\r\n      const grid: DatagridComponent = frameContext.componentRefManager.getComponentByType(DatagridComponent);\r\n      if (grid && targetField && id) {\r\n        grid.editCell(id, targetField);\r\n        this.verifyDetailService.verifyContainer.instance.showList = false;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { ValidationService };\r\n","import { BefRepository, BefRepositoryUtil, ResponseInfo } from \"@farris/bef\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { Observable, of } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\n\r\nexport class DataChangeDetectionService {\r\n    public static hasChange(frameContext: FrameContext): Observable<boolean> {\r\n        const befRepository = frameContext && frameContext.repository as BefRepository<any>;\r\n        const hasLocalChanges = BefRepositoryUtil.isExistUnsaveData(befRepository);\r\n        if (hasLocalChanges) {\r\n            return of(true);\r\n        }\r\n        // æ¬å°æ²¡æåæ´ï¼ç¡®è®¤æå¡å¨ç«¯æ¯å¦ææªä¿å­çåæ´\r\n        const virtualRootFrameContext = frameContext && frameContext.getVirtualRootFrameContext();\r\n        const serverSideChangeDetectionEnabled = virtualRootFrameContext && virtualRootFrameContext.enableServerSideChangeDetection;\r\n        if (!serverSideChangeDetectionEnabled) {\r\n            return of(false);\r\n        } else {\r\n            // å¯ç¨äºåç«¯åæ´æ£æµ\r\n            return frameContext.repository.hasChanges().pipe(map((response: ResponseInfo) => {\r\n                return response.returnValue;\r\n            }));\r\n        }\r\n    }\r\n}","import { Injectable, Optional } from '@angular/core';\r\nimport { Entity, BindingData, FrameContext, ViewModel } from '@farris/devkit';\r\nimport { BefRepository, BefRepositoryUtil } from '@farris/bef';\r\nimport { Observable, of, empty, EMPTY, concat, zip, from, Subject } from 'rxjs';\r\nimport { tap, switchMap, concatMap, concatAll, takeLast, last } from 'rxjs/operators';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { EditStateUtil } from './utils/index';\r\nimport { FormNotifyStrategyService } from '../form-notify-strategy.service';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { DataType, WEB_FORM_ROUTE_PARAMS_KEY } from '../types';\r\nimport { CommandService } from '../command-service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { DataChangeDetectionService } from '../data-change-detection.service';\r\n// tslint:disable: no-string-literal\r\n// tslint:disable: max-line-length\r\n/**\r\n * å¡çä»åºæå¡\r\n */\r\n@Injectable()\r\nclass CardDataService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private bindingData: BindingData;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private formMessageService: FormMessageService,\r\n    private frameContext: FrameContext,\r\n    private loadingService: FormLoadingService,\r\n    private formNotifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService,\r\n    private formErrorService: FormErrorService,\r\n    private runtimeFrameworkService: RuntimeFrameworkService,\r\n    private commandService: CommandService\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    this.repository = this.frameContext.repository as BefRepository<Entity>;\r\n    this.bindingData = this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * å è½½æ°æ®\r\n   * @param id ä¸»å®ä½id\r\n   * @param enableChildrenPagination å¯ç¨å­è¡¨åé¡µ\r\n   */\r\n  public load(id: string): Observable<Entity> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    this.frameContext.appContext.params.set(\"retrieveing\", true);\r\n    this.frameContext.appContext.params.delete('queryChild');\r\n    const get$ = this.repository.getById(id);\r\n    return get$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å è½½å\r\n   * @param id id\r\n   * @param transitionActionParamName ç¶æè¿ç§»å¨ä½åæ°ç¼å·\r\n   * @returns\r\n   */\r\n  public onLoading(transitionActionParamName: string) {\r\n    const tabId = this.runtimeFrameworkService && this.runtimeFrameworkService.tabId || null;\r\n    if (!tabId) {\r\n      return;\r\n    }\r\n    let skip = true;\r\n    const listening = this.frameContext.appContext.params.get(tabId) || false;\r\n    transitionActionParamName = transitionActionParamName || 'transitionAction';\r\n    if (!listening) {\r\n      this.frameContext.appContext.params.set(tabId, true);\r\n      this.runtimeFrameworkService.getEntityParam(tabId, (options: any) => {\r\n        if (skip) {\r\n          skip = false;\r\n          return;\r\n        }\r\n        const params = this.parseParams(options);\r\n        if (params && params.sync) {\r\n          const action = params.action;\r\n          const id = params.id;\r\n          const ngCommand = this.frameContext && this.frameContext.viewModel && this.frameContext.viewModel.metadatas && this.frameContext.viewModel.metadatas[action];\r\n          const actionName = ngCommand.params && ngCommand.params[transitionActionParamName] || null;\r\n          const formPrimaryValue = this.frameContext.bindingData.list.currentId;\r\n          const formState = this.frameContext.stateMachine.context.state;\r\n          let state = null;\r\n          let stateName: string;\r\n          if (!actionName) {\r\n            // å¯è½æ¯ç¨æ·èªå·±éç½®çå½ä»¤ï¼æ²¡æç¶ææºåæ¢ï¼æ­¤æ¶ä¸åå¤æ­ç¶ææº\r\n            state = formState;\r\n          }\r\n          else {\r\n            const ngAction = this.frameContext && this.frameContext.stateMachine && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas.actions && this.frameContext.stateMachine.metadatas.actions[actionName];\r\n            state = ngAction && ngAction.transitTo || formState;\r\n            stateName = this.frameContext && this.frameContext.stateMachine && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas.states[state] && this.frameContext.stateMachine.metadatas.states[state].name || this.languageService.defaultStateName;\r\n            if (stateName && stateName.startsWith('{{') && stateName.endsWith('}}')) {\r\n              const key = stateName.replace('{{', '').replace('}}', '');\r\n              stateName = this.frameContext.translate.transform(key, null);\r\n            }\r\n          }\r\n          const primaryValueChanged = formPrimaryValue !== id;\r\n          const stateChanged = formState !== state;\r\n\r\n          if (primaryValueChanged && stateChanged) {\r\n            // ååçåå\r\n            const message = this.languageService.dataAndStateChanged.replace(/\\$1/g, stateName);\r\n            this.showLoadingConfirm(message).pipe(switchMap(() => {\r\n              return this.resetForm(action);\r\n            })).subscribe();\r\n          } else if (primaryValueChanged) {\r\n            // ä¸»é®åçåå\r\n            this.showLoadingConfirm(this.languageService.dataChanged).pipe(switchMap(() => {\r\n              return this.resetForm(action);\r\n            })).subscribe();\r\n          } else if (stateChanged) {\r\n            // ç¶æåçåå\r\n            const message = this.languageService.stateChanged.replace(/\\$1/g, stateName);\r\n            this.showLoadingConfirm(message).pipe(switchMap(() => {\r\n              return this.resetForm(action);\r\n            })).subscribe();\r\n          } else {\r\n            // æ°æ®åç¶æåæªåçåå\r\n            return of(true);\r\n          }\r\n        }\r\n      }, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ°å¢\r\n   */\r\n  public add(): Observable<any> {\r\n    const lastModifiedId = this.bindingData.list.currentId;\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const create$ = this.repository.create();\r\n    return create$.pipe(\r\n      tap(\r\n        () => {\r\n          EditStateUtil.setEditState(this.frameContext, lastModifiedId);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.addFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * çº§èæ°å¢\r\n   */\r\n  public cascadeAdd(): Observable<any> {\r\n    const subject = new Subject<any>();\r\n    // æ¾å°ææviewmodel,æ¿å°äºææçframeContextï¼å¯è½æç»åè¡¨åç\r\n    const frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    // æ¾å°å½åframeContextçå¬å±namespace\r\n    const currentNamespace = this.frameContext.getVirtualRootFrameContext().namespace;\r\n    // æ¿å°å½åå½ä»¤æå¨frameçè¡¨åçææframeContext\r\n    const currentFormFrameContexts = frameContexts.filter((context: FrameContext) => context.namespace === currentNamespace) || [];\r\n    let bindingPaths = [];\r\n    if (currentFormFrameContexts && currentFormFrameContexts.length > 0) {\r\n      // æ¾å°ææä¸çº§frameContext\r\n      const childFrameContexts = currentFormFrameContexts.filter((context: FrameContext) => context.viewModel.bindingPath && context.viewModel.bindingPath !== '/');\r\n      if (childFrameContexts && childFrameContexts.length > 0) {\r\n        let childBindingPaths = childFrameContexts.map((context: FrameContext) => context.viewModel.bindingPath);\r\n        childBindingPaths = childBindingPaths.filter((item, index) => childBindingPaths.indexOf(item) === index);\r\n        if (childBindingPaths && childBindingPaths.length > 0) {\r\n          bindingPaths = childBindingPaths.map((path) => path.split('/').filter((p) => p)).sort((a, b) => a.length - b.length);\r\n        }\r\n      }\r\n    }\r\n    this.loadingService.show();\r\n    this.repository.create().pipe(\r\n      switchMap((entity: Entity) => {\r\n        const rid = entity.primaryValue;\r\n        if (bindingPaths && bindingPaths.length > 0) {\r\n          return from(bindingPaths).pipe(\r\n            concatMap((bindingPath: Array<any>) => {\r\n              const fpath = this.getPath(this.frameContext.viewModel, '/' + bindingPath.join('/'), rid);\r\n              return this.repository.appendByPath(fpath);\r\n            })\r\n          );\r\n        } else {\r\n          return of(entity);\r\n        }\r\n      })\r\n    ).pipe(last()).subscribe(\r\n      () => {\r\n        this.loadingService.hide();\r\n        subject.next();\r\n      },\r\n      (error: any) => {\r\n        this.loadingService.hide();\r\n        this.formErrorService.exception(this.languageService.addFailed, error);\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * ç¼è¾ï¼æ´æ°æ°æ®å¹¶æ è®°ç¼è¾ç¶æï¼\r\n   */\r\n  public edit(id?: string): Observable<Entity> {\r\n    const update$ = this.update();\r\n    return update$.pipe(\r\n      tap(() => {\r\n        const currentId = this.bindingData.list.currentId\r\n        EditStateUtil.setEditState(this.frameContext, currentId);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ´æ°\r\n   * @param id ä¸»å®ä½id\r\n   * @param enableChildrenPagination å¯ç¨å­è¡¨åé¡µ\r\n   */\r\n  public update(id?: string): Observable<Entity> {\r\n    // è·åid\r\n    id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return empty();\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const update$ = this.repository.updateById(id);\r\n    this.frameContext.appContext.params.set(\"retrieveing\", true);\r\n    return update$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.updateFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  public updateWithoutEmpty() {\r\n    // è·åid\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return of(null);\r\n    } else {\r\n      return this.update();\r\n    }\r\n  }\r\n  /**\r\n   * æ ¡éªå½åè¡æ¯å¦å­å¨\r\n   * @returns\r\n   */\r\n  public checkBeforeUpdate(): Observable<boolean> {\r\n    const bindingList = this.frameContext.bindingData.list;\r\n    const id = bindingList && bindingList.currentId;\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.noDataExist, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * å·²åºå¼\r\n   * @returns\r\n   */\r\n  public updateWithNotify() {\r\n    // è·åid\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.noDataExist, { hideTitle: true });\r\n      return EMPTY;\r\n    } else {\r\n      return this.update();\r\n    }\r\n  }\r\n  /**\r\n   * å è½½å¡çæ°æ®ï¼åé¡µå è½½å­è¡¨æ°æ®ï¼\r\n   * @deprecated æ¹æ³å·²åºå¼ï¼è¯·å¿ä½¿ç¨\r\n   */\r\n  public loadPaged(filter?: string, sort?: string) {\r\n    // è·åid\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    // this.frameContext.root.params.set('updateWithPaging', true);\r\n    const update$ = of(null);//this.repository.updateEntityById(id, true);\r\n    return update$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.updateFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * ä¿å­\r\n   */\r\n  public save(successMsg?: string): Observable<boolean> {\r\n    // è·åå½åè¡\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return of(false);\r\n    }\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const update$ = this.repository.updateChangesById(id);\r\n    const save$ = this.repository.applyChangesById(id);\r\n    const result$ = update$.pipe(\r\n\r\n      // update$ => save$\r\n      switchMap((updateResult: boolean) => {\r\n        if (updateResult === false) {\r\n          return of(false);\r\n        } else {\r\n          return save$;\r\n        }\r\n      }),\r\n\r\n      // éèloading\r\n      tap(() => {\r\n\r\n        // åæ¶æ°å¢ç¶æ\r\n        EditStateUtil.setEditState(this.frameContext, id);\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n        // this.formNotifyService.info(this.languageService.saveSuccess);\r\n        if (successMsg && successMsg.trim()) {\r\n          let showMessage: boolean = true;\r\n          if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n            try {\r\n              const options = JSON.parse(successMsg);\r\n              if (options.showMessage === false) {\r\n                showMessage = false;\r\n              }\r\n            } catch { }\r\n          }\r\n          if (showMessage !== false) {\r\n            this.formNotifyService.success(successMsg, { hideTitle: true });\r\n          }\r\n        } else {\r\n          FormNotifyStrategyService.success(this.formNotifyService, this.languageService.saveSuccess);\r\n        }\r\n        // FormNotifyStrategyService.success(this.formNotifyService, this.languageService.saveSuccess);\r\n      },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.saveFailed, error);\r\n        }\r\n      )\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n\r\n  // #region åæ¶ç¸å³æ¹æ³\r\n\r\n  /**\r\n   * åæ¶ï¼é»è®¤åæ¶ï¼\r\n   */\r\n  public cancel(): Observable<any> {\r\n    return this.cancelWithCheck();\r\n  }\r\n\r\n  /**\r\n   * è¿ååæ´é\r\n   * @description ä¸å¸¦åæ´æ£æµæç¤º\r\n   */\r\n  public revert(options?: any): Observable<any> {\r\n    return this.cancelWithoutCheck(options);\r\n  }\r\n\r\n  /**\r\n   * åæ¶ï¼åæ¶åæ£æ¥æªä¿å­çåæ´ï¼\r\n   * @summary\r\n   * 1ãç¨æ·è¯¯æä½ï¼åªéè¦åä¸ªæç¤ºå°±å¯ä»¥äºï¼\r\n   * 2ãç¨æ·ææåæ¶ï¼ç¹å»åæ¶å°±æ¯è¦æ¾å¼ææåæ´ï¼è¿æ¶åè¯¢é®äººå®¶æ¯å¦è¦ä¿å­æèæç¤ºå­å¨åæ´æç¹å¤æ­¤ä¸ä¸¾ï¼ç¡®è®¤ä¸æå³å¯ã\r\n   * 3ãç¨æ·è¯¯æä½ï¼æ²¡æåæ´çæåµä¸ç´æ¥ç»åæ¶äºï¼ç¨æ·ä¼äº§çææï¼å ä¸ºç¨æ·ææ¶åå¹¶ä¸ç¡®å®æ¯å¦æåæ´ï¼åºè¯¥ä¹ç¡®è®¤ä¸æã\r\n   * @todo\r\n   * 1ãç±äºäº§åé¨å¾å¤ä»£ç è¯¯ç¨äºè¯¥æ¹æ³ï¼ä¾èµäºæ²¡æåæ´çæ¶åç´æ¥åæ¶ï¼ç°å¨å¼¹çªç¡®è®¤æ¡æ¥ï¼ä¸å¤ªåéï¼\r\n   * 2ãäº§åé¨éè¦ç¨cancelWithoutCheckæ¹æ³ä»£æ¿ï¼ç®ååç»å¼å®¹çï¼å¾å é¤ã\r\n   */\r\n  public cancelWithCheck() {\r\n    const hasChange$ = DataChangeDetectionService.hasChange(this.frameContext);\r\n    return hasChange$.pipe(\r\n      switchMap((changed: boolean) => {\r\n        if (!changed) {\r\n          return this.cancelChanges();\r\n        } else {\r\n          // ç¡®è®¤æ¯å¦åæ¶\r\n          const confirm$ = this.formMessageService.question(this.languageService['cancelWithoutSave']);\r\n          const result$ = confirm$.pipe(\r\n            switchMap((ifCancel: boolean) => {\r\n              if (ifCancel === false) {\r\n                return EMPTY;\r\n              }\r\n              return this.cancelChanges();\r\n            })\r\n          );\r\n          return result$;\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åæ¶ï¼ç´æ¥åæ¶ï¼ä¸æ§è¡æ£æ¥ï¼\r\n   */\r\n  public cancelWithoutCheck(options?: any) {\r\n    return this.cancelChanges(options);\r\n  }\r\n\r\n  /**\r\n   * åæ¶\r\n   */\r\n  private cancelChanges(options?: any): Observable<any> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const cancel$ = this.repository.cancelChanges(options);\r\n    return cancel$.pipe(\r\n      tap(\r\n        () => {\r\n          EditStateUtil.setEditState(this.frameContext, '');\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.cancelFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  /**\r\n   * éæ°å è½½ï¼ä»ä¾å¡çåæ¶åéæ°å è½½æ°æ®ï¼å¶ä»åºæ¯è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public reload() {\r\n    const isAdd = EditStateUtil.getAddState(this.frameContext);\r\n    let id;\r\n    if (isAdd === true) {\r\n      id = EditStateUtil.getLastModifiedId(this.frameContext);\r\n    } else {\r\n      id = this.bindingData.list.currentId as string;\r\n    }\r\n\r\n    if (!id) {\r\n      this.repository.entityCollection.loadEntities([]);\r\n      return;\r\n    }\r\n\r\n    return this.load(id);\r\n  }\r\n  private getPath(viewModel: ViewModel, bindingPath: string, rid: string): string {\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n  private resetForm(action: string) {\r\n    const validationService = this.frameContext.injector.get<ValidationService>(ValidationService, null);\r\n    return this.frameContext.repository.cancelChanges().pipe(\r\n      switchMap(() => this.commandService.execute(action).pipe(switchMap(() => {\r\n        return validationService && validationService.resetValidation() || of(null);\r\n      }))));\r\n  }\r\n  private parseParams(options: any): { action: string, id: string, sync: boolean } | null {\r\n    if (options && Object.prototype.toString.call(options) === DataType.map) {\r\n      let params = options.get(WEB_FORM_ROUTE_PARAMS_KEY);\r\n      if (params && typeof params === 'string') {\r\n        params = decodeURIComponent(params);\r\n        if (params.startsWith('{') && params.endsWith('}')) {\r\n          params = JSON.parse(params);\r\n        }\r\n        return {\r\n          action: params.action,\r\n          id: params.idToView || params.idToEdit || params.id,\r\n          sync: params.sync || false\r\n        };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  private showLoadingConfirm(message: string) {\r\n    return this.formMessageService.confirm(message).pipe(\r\n      switchMap((result: boolean) => {\r\n        if (result === true) {\r\n          return of(true);\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\nexport { CardDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { EMPTY, Observable, of } from 'rxjs';\r\nimport { switchMap, throwIfEmpty } from 'rxjs/operators';\r\nimport { INSIDE_DIALOG_TOKEN, TAB_EVENT } from './types';\r\nimport { NavigationService } from './navigation.service';\r\nimport { AppContext, FrameContext, Repository, UID } from '@farris/devkit';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { CardDataService } from './data-services/card-data.service';\r\nimport { DataChangeDetectionService } from './data-change-detection.service';\r\n/**\r\n * å¯¼èªä¸­é´ä»¶æå¡\r\n * @scope FrameComponent\r\n */\r\n// tslint:disable: no-string-literal\r\n@Injectable()\r\nexport class NavigationMiddlewareService {\r\n  private repository: Repository<any>;\r\n\r\n  private appContext: AppContext;\r\n  constructor(\r\n    private navigationService: NavigationService,\r\n    private frameContext: FrameContext,\r\n    private msgService: FormMessageService,\r\n    @Optional() private languageService: LanguageService,\r\n    private cardDataService: CardDataService\r\n  ) {\r\n    this.repository = frameContext.repository;\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    if (this.frameContext) {\r\n      this.appContext = this.frameContext.getFormAppContext() || null;\r\n    }\r\n  }\r\n  /**\r\n   * å³é­åå¤ç\r\n   */\r\n  public onClosing() {\r\n    if (this.isInDialog()) {\r\n      return;\r\n    }\r\n    this.navigationService.addEventListener(TAB_EVENT.onTabClosing, (options) => {\r\n      if (!this.frameContext || this.frameContext.isDisposed) {\r\n        return of(true);\r\n      }\r\n      return this.isChanged.pipe(switchMap((changed: boolean) => {\r\n        if (changed && !this.appContext.opened) {\r\n          // å¦æéè¦ç¨æ·ç¡®è®¤å°±åæ¢å°å½åtab\r\n          if (options && options.beforeCloseHandle && typeof options.beforeCloseHandle === 'function') {\r\n            options.beforeCloseHandle({ selectedChange: true });\r\n          }\r\n          const conform = this.msgService.question(this.languageService['exitWithoutSave']);\r\n          /*è®°å½å¼¹çªå·²æå¼*/\r\n          this.appContext.opened = true;\r\n          return conform.pipe(\r\n            switchMap((result: boolean) => {\r\n              this.appContext.opened = false;\r\n              if (result) {\r\n                /*è®°å½ç¨æ·å³é­å¼¹çª*/\r\n                if (!!this.cardDataService) {\r\n                  const revert$ = this.cardDataService.revert(options);\r\n                  return revert$.pipe(\r\n                    switchMap(() => of(result))\r\n                  );\r\n                }\r\n              }\r\n              return of(result);\r\n            })\r\n          );\r\n        } else if (changed && this.appContext.opened) {\r\n          return of(false);\r\n        } else {\r\n          return of(true);\r\n        }\r\n      }));\r\n    });\r\n  }\r\n  /**\r\n   * æ¯å¦å¨æ¯å¼¹çªçªå£å\r\n   */\r\n  private isInDialog() {\r\n    let frameContext = this.frameContext;\r\n    let isDialogRootComponent = frameContext.frameComponent['isDialogRootComponent'] || false;\r\n    while (frameContext.parent !== null && !isDialogRootComponent) {\r\n      frameContext = frameContext.parent;\r\n      isDialogRootComponent = frameContext.frameComponent['isDialogRootComponent'];\r\n    }\r\n    if (!isDialogRootComponent) {\r\n      isDialogRootComponent = this.frameContext.injector.get<boolean>(INSIDE_DIALOG_TOKEN, false);\r\n    }\r\n    return isDialogRootComponent;\r\n  }\r\n  /**\r\n   * è·åtabid,å¦ætargetIdå­å¨åç´æ¥ä½¿ç¨targetId\r\n   * @description å°ç¨æ·è¦æ¥ççæ°æ®idè½¬æ¢ä¸ºè¿è¡æ¡æ¶éè¦çtabId\r\n   * @param params - routeråæ°\r\n   * @param targetId - è¦ç¼è¾/æ¥ççæ°æ®id\r\n   */\r\n  public getTabId(params: string, targetId: string): any {\r\n    if (!!targetId) {\r\n      return targetId;\r\n    }\r\n    let paramsObj: any = null;\r\n    if (!!params && params.startsWith('{') && params.endsWith('}')) {\r\n      paramsObj = JSON.parse(params);\r\n    }\r\n    let paramId = null;\r\n    if (paramsObj && paramsObj.hasOwnProperty('id') && !!paramsObj.id) {\r\n      paramId = paramsObj.id;\r\n    } else {\r\n      paramId = UID.create();\r\n    }\r\n    return paramId;\r\n  }\r\n  /**\r\n   * æ¯å¦ææªä¿å­çåæ´\r\n   */\r\n  private get isChanged(): Observable<boolean> {\r\n    return DataChangeDetectionService.hasChange(this.frameContext).pipe(throwIfEmpty(()=>EMPTY));\r\n  }\r\n}\r\n","/*\r\n * @Author: aalizzwell\r\n * @Date: 2019-08-05 11:48:27\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-08-06 15:01:53\r\n */\r\n\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { EMPTY, of } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { FrameContext, Repository, ViewModel } from '@farris/devkit';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { BefRepositoryUtil, BefRepository } from '@farris/bef';\r\nimport { CommandService } from './command-service';\r\n\r\n// tslint:disable: no-string-literal\r\n/**\r\n * Gridä¸­é´ä»¶æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nexport class GridMiddlewareService {\r\n  private repository: Repository<any>;\r\n\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private msgService: FormMessageService,\r\n    @Optional() private languageService: LanguageService,\r\n    private viewModel: ViewModel,\r\n    private commandService: CommandService\r\n  ) {\r\n    this.repository = this.frameContext.repository;\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n  /**\r\n   * é¡µç åæ¢å\r\n   */\r\n  public onPageChanging() {\r\n    if (this.isChanged) {\r\n      return this.msgService.question(this.languageService['gridDataNotSave']).pipe(\r\n        switchMap((result: boolean) => {\r\n          if (!result) {\r\n            return EMPTY;\r\n          } else {\r\n            return of(true);\r\n          }\r\n        })\r\n      );\r\n    } else {\r\n      return of(true);\r\n    }\r\n  }\r\n  /**\r\n   * è¡¨æ ¼è¿æ»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   * @param frameId frameId\r\n   * @returns \r\n   */\r\n  public filter(commandName: string, frameId: string) {\r\n    const self: any = this;\r\n    let filters = self.context && self.context.eventParam || [];\r\n    if (typeof (filters) === 'string') {\r\n      filters = JSON.parse(filters);\r\n    }\r\n    // æ¥è¯¢æ¶éç½®é¡µç ä¸ºç¬¬ä¸é¡µ\r\n    this.viewModel.frameContext.repository.entityCollection.pageIndex = 1;\r\n    this.viewModel.frameContext.repository.filterConditionManager.setConditions(this.viewModel.bindingPath, filters);\r\n    return this.commandService.execute(commandName, frameId);\r\n  }\r\n  /**\r\n   * æ¯å¦ææªä¿å­çåæ´\r\n   */\r\n  private get isChanged(): boolean {\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    return BefRepositoryUtil.isExistUnsaveData(befRepository);\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\nimport { QuerystringService } from './querystring';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { of, Observable, BehaviorSubject, Subject } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n// tslint:disable: no-string-literal\r\n/**\r\n * åæ°æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class ParamService {\r\n  constructor(\r\n    private querystringService: QuerystringService,\r\n    private runtimeFrameworkService: RuntimeFrameworkService\r\n  ) { }\r\n  /**\r\n   * ééè·åææåæ°\r\n   */\r\n  public get params(): Observable<{ [propName: string]: any }> {\r\n    // åä»hashä¸­è·ååæ°\r\n    const hash = window.location.hash;\r\n    const params = this.querystringService.parse(hash);\r\n    /*\r\n    const appMode = params.appMode;\r\n    // appModeæ²¡æå®ä¹ï¼è®¤ä¸ºæ¯èè¡¨å,appMode = mdi æ spa\r\n    if (typeof appMode === 'undefined' || appMode === null) {\r\n        return of(params);\r\n    }\r\n    // appModeå­å¨ï¼ä½ä¸ºç©ºï¼ä¹è®¤ä¸ºæ¯èè¡¨å\r\n    if (appMode.length < 1) {\r\n        return of(params);\r\n    }\r\n    // æ°è¡¨åï¼ä½¿ç¨iframeæ¨¡å¼\r\n    if (appMode.toLowerCase() === 'mdi') {\r\n        return of(params);\r\n    }\r\n    */\r\n    // è·åtabIdï¼ææ°çæ¬ä¸å®ætabIdï¼å¦æåä¸å°tabIdåè®¤ä¸ºæ¯èè¡¨åï¼ç´æ¥ä»urlè·ååæ°\r\n    const tabId = params.tabId;\r\n    if (!tabId) {\r\n      // throw new Error('TabId can`t be empty!');\r\n      return of(params);\r\n    }\r\n    const subject = new Subject<any>();\r\n    // ç®¡éåæ°eå¯è½ä¸ºobjectãMapç±»å\r\n    this.runtimeFrameworkService.addEventListener(tabId, (e: any) => {\r\n      let map = {};\r\n      if (e instanceof Map || (e && typeof (e['get']) === 'function' && typeof e['entries'] === 'function')) {\r\n        map = this.parseMapParams(e);\r\n      }\r\n      let args = {};\r\n      if (e instanceof Map || (e && typeof (e['get']) === 'function' && typeof e['entries'] === 'function')) {\r\n        args = new Map(e);\r\n      } else {\r\n        args = Object.assign({}, e);\r\n      }\r\n      setTimeout(() => {\r\n        subject.next(Object.assign({}, args, map, params));\r\n      }, 0);\r\n    }, params);\r\n    return subject.asObservable();\r\n  }\r\n  /**\r\n   * è§£æmapç±»åçåæ°\r\n   * @param params params\r\n   */\r\n  private parseMapParams(params: Map<any, any>) {\r\n    const map = {};\r\n    map['WEB_FORM_ROUTE_PARAMS'] = decodeURIComponent(params.get('WEB_FORM_ROUTE_PARAMS'));\r\n    params.forEach((value, key) => {\r\n      if (key !== 'WEB_FORM_ROUTE_PARAMS') {\r\n        map[key] = value;\r\n      }\r\n    });\r\n    return map;\r\n  }\r\n  /**\r\n   * è·åparamåæ°\r\n   * @param param key\r\n   */\r\n  public get(param: string): Observable<any> {\r\n    return this.params.pipe(\r\n      switchMap(options => {\r\n        if (!!options && options.hasOwnProperty(param)) {\r\n          return of(options.param);\r\n        } else {\r\n          return of(undefined);\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * åæ°è½¬ä¸ºå¯¹è±¡\r\n   */\r\n  public parse(): Observable<any> {\r\n    return this.params.pipe(\r\n      switchMap(options => {\r\n        return of(options);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Keybinding, ViewModel } from '@farris/devkit'\r\nimport * as Mousetrap from 'mousetrap';\r\nimport { Observable } from 'rxjs';\r\n\r\nconst enum CharCode {\r\n\r\n  Digit0 = 48,\r\n  Digit1 = 49,\r\n  Digit2 = 50,\r\n  Digit3 = 51,\r\n  Digit4 = 52,\r\n  Digit5 = 53,\r\n  Digit6 = 54,\r\n  Digit7 = 55,\r\n  Digit8 = 56,\r\n  Digit9 = 57,\r\n\r\n  A = 65,\r\n  B = 66,\r\n  C = 67,\r\n  D = 68,\r\n  E = 69,\r\n  F = 70,\r\n  G = 71,\r\n  H = 72,\r\n  I = 73,\r\n  J = 74,\r\n  K = 75,\r\n  L = 76,\r\n  M = 77,\r\n  N = 78,\r\n  O = 79,\r\n  P = 80,\r\n  Q = 81,\r\n  R = 82,\r\n  S = 83,\r\n  T = 84,\r\n  U = 85,\r\n  V = 86,\r\n  W = 87,\r\n  X = 88,\r\n  Y = 89,\r\n  Z = 90,\r\n\r\n  a = 97,\r\n  b = 98,\r\n  c = 99,\r\n  d = 100,\r\n  e = 101,\r\n  f = 102,\r\n  g = 103,\r\n  h = 104,\r\n  i = 105,\r\n  j = 106,\r\n  k = 107,\r\n  l = 108,\r\n  m = 109,\r\n  n = 110,\r\n  o = 111,\r\n  p = 112,\r\n  q = 113,\r\n  r = 114,\r\n  s = 115,\r\n  t = 116,\r\n  u = 117,\r\n  v = 118,\r\n  w = 119,\r\n  x = 120,\r\n  y = 121,\r\n  z = 122\r\n}\r\n\r\n/**\r\n * å¿«æ·é®æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class KeybindingService {\r\n  private keyMap: Map<String, () => Observable<any>>;\r\n  private bindingProvider: Mousetrap;\r\n  private ready: boolean;\r\n\r\n  constructor() {\r\n    this.keyMap = new Map<String, () => Observable<any>>();\r\n    this.bindingProvider = Mousetrap.default;\r\n    this.ready = true;\r\n  }\r\n\r\n  /**\r\n   * å¯¹è§å¾æ¨¡åè®¾ç½®çå¿«æ·é®è¿è¡ç»å®å¤ç\r\n   * @param viewModel è§å¾æ¨¡å\r\n   */\r\n  public bind(viewModel: ViewModel) {\r\n    viewModel.keybindingMap.forEach((keyBinding, method) => {\r\n      this.register(keyBinding, () => {\r\n        return viewModel[method]();\r\n      });\r\n    });\r\n  }\r\n\r\n\t/**\r\n\t * æ³¨åå¿«æ·é®\r\n\t * @param binding é®çç»å®ä¿¡æ¯\r\n\t * @param handler ååºäºä»¶\r\n\t */\r\n  public register(binding: Keybinding, handler: () => Observable<any>) {\r\n    var combo = this._getCombo(binding);\r\n    if (combo) {\r\n      this.keyMap.set(combo, handler);\r\n      if (binding.ctrlKey && binding.altKey && !binding.shiftKey) {\r\n        // å®éåç°ï¼ctrl+altç»åï¼åªè½è§¦åkeyupäºä»¶\r\n        this.bindingProvider.bind(combo, this._dispatch.bind(this), 'keyup');\r\n      } else {\r\n        this.bindingProvider.bind(combo, this._dispatch.bind(this));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åæ¶å¿«æ·é®æ³¨å\r\n   * @param binding é®çç»å®ä¿¡æ¯ \r\n   */\r\n  public unregister(binding: Keybinding) {\r\n    var combo = this._getCombo(binding);\r\n    if (combo) {\r\n      this.keyMap.delete(combo);\r\n      this.bindingProvider.unbind(combo);\r\n    }\r\n  }\r\n\r\n  private _dispatch(e: KeyboardEvent): boolean {\r\n    if (e.repeat) return false;\r\n    if (this.ready) {\r\n      var combo = this._getCombo(e);\r\n      if (combo && this.keyMap.has(combo)) {\r\n        this.ready = false;\r\n        this.keyMap.get(combo)().subscribe(() => {\r\n          this.ready = true;\r\n        }, (error) => {\r\n          this.ready = true;\r\n        }, () => {\r\n          this.ready = true;\r\n        });\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n\t/**\r\n\t * è¿åctrl+shift+alt+aå½¢å¼çç»åå­ç¬¦ä¸²ï¼å¨é¨ä¸ºå°å\r\n\t * @param keyInfo \r\n\t */\r\n  private _getCombo(keyInfo: Keybinding | KeyboardEvent): String | null {\r\n    var key = keyInfo.key.toLowerCase();\r\n    if (key.length != 1 || key.charCodeAt(0) < CharCode.a || key.charCodeAt(0) > CharCode.z) {\r\n      console.warn(\"å¿«æ·é®å­æ¯å½¢å¼ä¸ºa-z\");\r\n      return null;\r\n    }\r\n    var combo = (keyInfo.ctrlKey ? 'ctrl+' : '')\r\n      + (keyInfo.shiftKey ? 'shift+' : '')\r\n      + (keyInfo.altKey ? 'alt+' : '')\r\n      + (keyInfo.metaKey ? 'meta+' : '')\r\n      + key;\r\n\r\n    if (combo.length == 1) {\r\n      console.warn(\"å¿«æ·é®è³å°åå«ä¸ä¸ªModifieré®\");\r\n      return null;\r\n    }\r\n\r\n    return combo;\r\n  }\r\n}","// tslint:disable: max-line-length\r\nimport { Injectable } from '@angular/core';\r\n\r\n/**\r\n * @deprecated å·²åºé¤\r\n */\r\n@Injectable()\r\nclass FilterConditionService {\r\n}\r\nexport { FilterConditionService };\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * UIç¶ææå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass UIStateService {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  getState(componentId: string, stateName: string) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  setState(componentId: string, stateName: string, value: any) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n}\r\n\r\nexport { UIStateService };\r\n","import { Injectable, ElementRef } from '@angular/core';\r\nimport { StateMachine, FrameContext, AppContext } from '@farris/devkit';\r\n// tslint:disable: max-line-length\r\n/**\r\n * ç¶ææºæå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass StateMachineService {\r\n\r\n  constructor(\r\n    private stateMachine: StateMachine\r\n  ) {\r\n    if (this.stateMachine.initialState.name === 'init') {\r\n      window.setTimeout(() => {\r\n        this.initFormState();\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  private _clsDefaultName = 'f-form-state-default';\r\n  private _initLoad = true;\r\n  private _currentFrameContext: any\r\n\r\n  transit(action: string) {\r\n    if (action && typeof this.stateMachine[action] === 'function') {\r\n      this.stateMachine[action]();\r\n      this._currentFrameContext = this['context'] && this['context']['frameContext'];\r\n      if (this._initLoad) {\r\n        this.initFormState();\r\n        this._initLoad = false;\r\n      }\r\n      if (!this._currentFrameContext) {\r\n        return;\r\n      }\r\n      const currentRootFrameContext = this.getCurrentRootFrameContext(this._currentFrameContext);\r\n      if (!!currentRootFrameContext) {\r\n        this.toggleFormState(action, currentRootFrameContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  private getCurrentRootFrameContext(currentFrameContext: FrameContext): FrameContext {\r\n    let currentRootFrameContext: FrameContext;\r\n    this.getAllRootFrameContext().forEach((rootFc: FrameContext) => {\r\n      if (currentFrameContext.namespace === rootFc.namespace) {\r\n        currentRootFrameContext = rootFc;\r\n      }\r\n    })\r\n    return currentRootFrameContext;\r\n  }\r\n\r\n  private getFrameContextManagerMap() {\r\n    if (this.stateMachine && this.stateMachine.frameContext) {\r\n      const appContext = this.stateMachine.frameContext.appContext as AppContext;\r\n      if (appContext) {\r\n        const frameContextManager = appContext.frameContextManager;\r\n        return frameContextManager.getFrameContextMap();\r\n      }\r\n    }\r\n    return null;\r\n    // return this.stateMachine && this.stateMachine.frameContext && this.stateMachine.frameContext.appContext && this.stateMachine.frameContext.appContext.frameContextManager && this.stateMachine.frameContext.appContext.frameContextManager.getFrameContextMap();\r\n  }\r\n\r\n  private getAllRootFrameContext(): any[] {\r\n    const rootFrameContextArr = [];\r\n    const frameContexts = this.getFrameContextManagerMap();\r\n    if (frameContexts) {\r\n      frameContexts.forEach(item => {\r\n        if ((item['namespace'] === '' && item['parent'] === null) || (item['parent'] !== null && item['namespace'] !== item['parent']['namespace'])) {\r\n          rootFrameContextArr.push(item);\r\n        }\r\n      })\r\n    }\r\n    return rootFrameContextArr;\r\n  }\r\n\r\n  private initFormState() {\r\n    if (!this.getFrameContextManagerMap()) {\r\n      return;\r\n    }\r\n    this.getAllRootFrameContext().forEach((rootFc: FrameContext) => {\r\n      const rootComponent = rootFc.injector.get<ElementRef>(ElementRef, null) || null;\r\n      if (!rootComponent || !rootComponent.nativeElement) {\r\n        return;\r\n      }\r\n      if (!rootComponent.nativeElement.className.includes(this._clsDefaultName) && !rootComponent.nativeElement.className.includes('f-form-state-create') && !rootComponent.nativeElement.className.includes('f-form-state-edit')) {\r\n        this.addCssClass(rootComponent, this._clsDefaultName);\r\n      }\r\n    })\r\n  }\r\n\r\n  private toggleFormState(action: string, frameContext: FrameContext) {\r\n    const rootComponent = frameContext.injector.get<ElementRef>(ElementRef, null) || null;\r\n    if (!rootComponent || !rootComponent.nativeElement || !action) {\r\n      return;\r\n    }\r\n    action = action.toLowerCase();\r\n    if (action && ['create', 'edit'].includes(action)) {\r\n      if (action === 'create') {\r\n        this.addCssClass(rootComponent, 'f-form-state-create');\r\n      } else if (action === 'edit') {\r\n        this.addCssClass(rootComponent, 'f-form-state-edit');\r\n      }\r\n      this.removeCssClass(rootComponent, this._clsDefaultName);\r\n    } else {\r\n      ['f-form-state-create', 'f-form-state-edit'].forEach(item => this.removeCssClass(rootComponent, item));\r\n      this.addCssClass(rootComponent, this._clsDefaultName);\r\n    }\r\n  }\r\n  private addCssClass(elementRef: ElementRef, className: string) {\r\n    if (!elementRef || !className || !elementRef.nativeElement) {\r\n      return;\r\n    }\r\n    const originalClassName: string = elementRef.nativeElement.className || '';\r\n    if (!originalClassName.includes(className)) {\r\n      elementRef.nativeElement.className = `${originalClassName} ${className}`;\r\n    }\r\n  }\r\n  private removeCssClass(elementRef: ElementRef, className: string) {\r\n    if (!elementRef || !className || !elementRef.nativeElement) {\r\n      return;\r\n    }\r\n    const originalClassName: string = elementRef.nativeElement.className || '';\r\n    if (originalClassName.includes(className)) {\r\n      elementRef.nativeElement.className = originalClassName.split(' ').filter(p => p && p !== className).join(' ');\r\n    }\r\n  }\r\n  private getFormRootComponent() {\r\n    if (this.stateMachine && this.stateMachine.frameContext) {\r\n      const viewContext = this.stateMachine.frameContext;\r\n      if (viewContext) {\r\n        const virtualRootContext = viewContext.getVirtualRootFrameContext();\r\n        if (virtualRootContext) {\r\n          const injector = virtualRootContext.injector;\r\n          if (typeof injector.get === 'function') {\r\n            return injector.get<ElementRef>(ElementRef, null);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n    // return this.stateMachine && this.stateMachine.frameContext && this.stateMachine.frameContext.getVirtualRootFrameContext() && this.stateMachine.frameContext.getVirtualRootFrameContext().injector && typeof this.stateMachine.frameContext.getVirtualRootFrameContext().injector.get === 'function' && this.stateMachine.frameContext.getVirtualRootFrameContext().injector.get<ElementRef>(ElementRef, null) || null;\r\n  }\r\n}\r\n\r\nexport { StateMachineService };\r\n","import { Injectable } from '@angular/core';\r\nimport { AppContext, BindingData, FrameContext } from '@farris/devkit';\r\n\r\n/**\r\n * å®ä½æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass BindingDataService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private bindingData: BindingData,\r\n    private appContext: AppContext\r\n  ) { }\r\n\r\n  /**\r\n   * è®¾ç½®å½åæ¡æ¶çå½åè¡\r\n   */\r\n  setCurrentId(id: string, frameId: string) {\r\n    // let bindingData = this.bindingData;\r\n    // if (frameId) {\r\n    //   const targetContext = this.appContext.getFrameContext(frameId);\r\n    //   bindingData = targetContext.bindingData;\r\n    // }\r\n    // bindingData.list.setCurrentId(id);\r\n\r\n    // @todoï¼å¨é¨éæ°è®¾ç½®ä¸é\r\n    const frameContexts = Array.from(this.appContext.getAllFrameContexts().values());\r\n    frameContexts.forEach((frameContext: FrameContext) => {\r\n      const bindingData = frameContext.bindingData;\r\n      bindingData.list.setCurrentId(id, true, false);\r\n    });\r\n  }\r\n  public setCurrentRow(id: string, frameId: string) {\r\n    let bindingData = this.bindingData;\r\n    if (frameId) {\r\n      const targetContext = this.appContext.getFrameContext(frameId);\r\n      bindingData = targetContext.bindingData;\r\n    }\r\n    bindingData.getList().setCurrentId(id);\r\n  }\r\n}\r\n\r\nexport { BindingDataService };\r\n","import { ActivatedRoute, ParamMap } from '@angular/router';\r\nimport { take } from 'rxjs/operators';\r\nimport { FrameworkService } from '@gsp-sys/rtf-common';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { ParamService } from './param.service';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { isObservable } from 'rxjs';\r\n\r\n/**\r\n * åºç¨åæ°æå¡\r\n * @scope FormModule\r\n */\r\n\r\n@Injectable()\r\nexport class ApplicationParamService {\r\n  private params: any;\r\n  constructor(\r\n    @Optional() private paramService: ParamService,\r\n    @Optional() private runtimeFrameworkService: RuntimeFrameworkService,\r\n  ) {\r\n    if (!this.runtimeFrameworkService) {\r\n      this.runtimeFrameworkService = new RuntimeFrameworkService();\r\n    }\r\n  }\r\n  /**\r\n   * è§£æåæ°\r\n   */\r\n  public parseParams(route: ActivatedRoute, frameworkService: FrameworkService, viewModel: ViewModel, callback: () => void) {\r\n    const highOrderInvoke = this.highOrderInvoke(callback);\r\n    if (!this.paramService) {\r\n      route.queryParams.pipe(take(1)).subscribe((params: any) => {\r\n        this.params = params;\r\n        this.setupParams(params, frameworkService, viewModel, highOrderInvoke);\r\n      });\r\n    } else {\r\n      this.paramService.parse().pipe(take(1)).subscribe(params => {\r\n        this.params = params;\r\n        this.setupParams(params, frameworkService, viewModel, highOrderInvoke);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®åæ°\r\n   */\r\n  private setupParams(params, frameworkService: FrameworkService, viewModel: ViewModel, callback: () => void) {\r\n    if (viewModel && viewModel.frameContext && viewModel.frameContext.appContext && params.tabId) {\r\n      viewModel.frameContext.appContext.tabId = params.tabId;\r\n    }\r\n    const queryParams = this.getParams(params);\r\n    if (!queryParams) {\r\n      callback();\r\n      return;\r\n    }\r\n\r\n    // åè®¾ç½®åæ°ï¼ä¿è¯æ®éè·¯ç±ä¹è½æ­£å¸¸æ§è¡ã\r\n    this.setQueryParams(queryParams, viewModel);\r\n\r\n    const funcId = this.getFuncId(queryParams);\r\n    const appId = this.getAppId(queryParams);\r\n    if (!funcId && !appId) {\r\n      callback();\r\n      return;\r\n    }\r\n\r\n    if (funcId) {\r\n      this.setStaticParams(funcId, queryParams, frameworkService, viewModel, callback);\r\n    } else {\r\n      callback();\r\n    }\r\n  }\r\n  /**\r\n   * è®¾ç½®æ¥è¯¢åæ°\r\n   */\r\n  private setQueryParams(queryParams: any, viewModel: ViewModel): any {\r\n    const parsedQueryParams = {};\r\n    // è®¾ç½®è¡¨ååæ°\r\n    // é¦åå¤æ­æ¯å¦ä¸ºå¼¹çª\r\n    const isInDialog = this.isInDialog(viewModel);\r\n    const uiState = viewModel && viewModel.uiState && viewModel.uiState.innerData || {};\r\n    // å¦ææ¯å¼¹çªï¼å¼¹çªå¤çåæ°ï¼æ è®ºè¡¨ååæ°æéæåæ°ï¼ä¸åºè¯¥è¦çå¼¹çªçåæ°ãå¼¹çªæå¼æ¶ä¼ éçåæ°ç¸å½äºå±é¨åéï¼ä¸åºè¢«è¦ç\r\n    Object.keys(queryParams).forEach((paramName: string) => {\r\n      if (!isInDialog) {\r\n        parsedQueryParams[paramName] = queryParams[paramName];\r\n      } else {\r\n        if (!uiState.hasOwnProperty(paramName)) {\r\n          parsedQueryParams[paramName] = queryParams[paramName];\r\n        }\r\n      }\r\n    });\r\n    this.updateUIState(viewModel, parsedQueryParams);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®éæåæ°\r\n   */\r\n  private setStaticParams(\r\n    funcId: string, queryParams: any, frameworkService: FrameworkService, viewModel: ViewModel, callback: () => void\r\n  ) {\r\n    this.runtimeFrameworkService.getMenuParams(funcId, (staicParams) => {\r\n      const staticParamsObj = this.mapStaticParamsToObject(staicParams, queryParams, viewModel);\r\n      if (!staticParamsObj) {\r\n        callback();\r\n        return;\r\n      }\r\n      this.updateUIState(viewModel, staticParamsObj);\r\n      callback();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å°staticParamsè½¬æ¢ä¸ºæ®éå¯¹è±¡\r\n   * @param staticParamsï¼å½¢å¦ï¼[{'name': 'key1', 'value': 'val1'}, {'name': 'key2', 'value': 'val2'}]\r\n   * @return å½¢å¦ï¼{key1: val1, key2: value2 }\r\n   */\r\n  private mapStaticParamsToObject(staticParams: Map<any, any>, queryParams: any, viewModel?: ViewModel): any {\r\n    if (!staticParams) {\r\n      return;\r\n    }\r\n    const inDialog = this.isInDialog(viewModel);\r\n    const uiState = viewModel && viewModel.uiState && viewModel.uiState.innerData || {};\r\n    const result = {};\r\n    staticParams.forEach((value, key, map) => {\r\n      if (!inDialog) {\r\n        // éæåæ°ä¸è½è¦çæ¥è¯¢åæ°\r\n        if (!queryParams.hasOwnProperty(key)) {\r\n          result[key] = value;\r\n        }\r\n      } else {\r\n        if (!queryParams.hasOwnProperty(key) && !uiState.hasOwnProperty(key)) {\r\n          result[key] = value;\r\n        }\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  /**\r\n   * æ¯å¦å¨å¼¹çªå\r\n   * @param viewModel viewmodel\r\n   */\r\n  private isInDialog(viewModel: ViewModel) {\r\n    let isInDialog = false;\r\n    if (viewModel && viewModel.uiState) {\r\n      // tslint:disable-next-line: max-line-length\r\n      if (viewModel.uiState.innerData && viewModel.uiState.innerData.hasOwnProperty('DEVKIT_DIALOG') || viewModel.uiState['DEVKIT_DIALOG']) {\r\n        isInDialog = true;\r\n      }\r\n    }\r\n    return isInDialog;\r\n  }\r\n  /**\r\n   * æ´æ°UIState\r\n   */\r\n  private updateUIState(viewModel: ViewModel, params: any) {\r\n    if (!viewModel || !params) {\r\n      return;\r\n    }\r\n    const uiState = viewModel.uiState;\r\n\r\n    // å¼å®¹ä½¿ç¨stringä¼ éparamså¯¹è±¡çåºæ¯\r\n    if (typeof params === 'string' && params !== '') {\r\n      params = JSON.parse(params);\r\n    }\r\n\r\n    // å¨UIStateä¸ºåæ°åå»ºå±æ§\r\n    Object.keys(params).forEach((propName: string) => {\r\n      uiState.setPropertyValue(propName, params[propName]);\r\n      if (propName && propName === 'union_session') {\r\n        let sessionInfo = params[propName];\r\n        this.setSessionInfo(viewModel, sessionInfo);\r\n      }\r\n    });\r\n  }\r\n  private setSessionInfo(viewModel: ViewModel, sessionInfo: any) {\r\n    if (!viewModel || !sessionInfo) {\r\n      return;\r\n    }\r\n    if (sessionInfo && typeof sessionInfo === 'string' && sessionInfo.startsWith('{') && sessionInfo.endsWith('}')) {\r\n      sessionInfo = JSON.parse(sessionInfo);\r\n    }\r\n    const token = sessionInfo && sessionInfo.token || null;\r\n    const sessionId = sessionInfo && sessionInfo.sessionId || null;\r\n    if (token) {\r\n      viewModel.frameContext.appContext.Token = token;\r\n    }\r\n    if (sessionId) {\r\n      const befRepository = viewModel.frameContext.repository as BefRepository<any>;\r\n      if (befRepository) {\r\n        befRepository.restService.sessionService.setBeSessionId(sessionId);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·ååè½èåid\r\n   */\r\n  private getFuncId(queryParams: any): any {\r\n    if (!queryParams) {\r\n      return;\r\n    }\r\n    return queryParams['funcId'];\r\n  }\r\n\r\n  /**\r\n   * è·ååºç¨id\r\n   */\r\n  private getAppId(queryParams: any): any {\r\n    if (!queryParams) {\r\n      return;\r\n    }\r\n    return queryParams['appId'];\r\n  }\r\n  private getTabId(queryParams: any) {\r\n    if (!queryParams) {\r\n      return;\r\n    }\r\n    return queryParams['tabId'];\r\n  }\r\n  /**\r\n   * è·åurlåæ°å¯¹è±¡\r\n   * @param queryParams urlåæ°\r\n   */\r\n  private getParams(queryParams: any): { [propName: string]: any } {\r\n    if (!queryParams) {\r\n      return {};\r\n    }\r\n    let result = {};\r\n    if (queryParams.hasOwnProperty('WEB_FORM_ROUTE_PARAMS')) {\r\n      let webFormRouteParams: string = queryParams['WEB_FORM_ROUTE_PARAMS'];\r\n      if (webFormRouteParams && webFormRouteParams.startsWith('{') && webFormRouteParams.endsWith('}')) {\r\n        webFormRouteParams = decodeURI(encodeURI(webFormRouteParams).replace(/%0A/g, '\\\\n').replace(/%09/g, '\\\\t').replace(/%0D/g, '\\\\r'));\r\n        result = JSON.parse(webFormRouteParams);\r\n      }\r\n      Object.keys(queryParams).forEach(prop => {\r\n        if (prop !== 'WEB_FORM_ROUTE_PARAMS') {\r\n          result[prop] = queryParams[prop];\r\n        }\r\n      });\r\n      return result;\r\n    }\r\n    return queryParams;\r\n  }\r\n  private highOrderInvoke(callback) {\r\n    return () => {\r\n      try {\r\n        const queryParams = this.getParams(this.params);\r\n        const tabId = this.getTabId(queryParams);\r\n        if (tabId) {\r\n          const controlEvent = this.runtimeFrameworkService.getMenuSwitchControlEvent();\r\n          if (controlEvent && isObservable(controlEvent)) {\r\n            controlEvent.subscribe((event: any) => {\r\n              if (event) {\r\n                event.next('ok');\r\n              }\r\n            });\r\n          }\r\n        }\r\n      } catch (e) { console.warn(e); }\r\n      if (callback && typeof callback === 'function') {\r\n        callback();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, BindingData, BindingList, BindingObject } from '@farris/devkit';\r\n\r\n/**\r\n * å®ä½éåæå¡\r\n * @todo\r\n * å®ä½å±æ²¡æå°è£ç¸å³æ¹æ³ï¼ä¸´æ¶éè¿BindingDataæ¥è·åæ°æ®\r\n */\r\n@Injectable()\r\nclass EntityTraversingService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n  }\r\n\r\n  /**\r\n   * è·åå¼\r\n   */\r\n  public getPropValue(path: string[]): any {\r\n    return this.bindingData.getValue(path);\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä½æ°æ®\r\n   */\r\n  public getEntityData(path: string[]): any {\r\n    let bindingObj: BindingObject;\r\n    const bindingListOrObject = this.bindingData.getValue(path);\r\n    if (bindingListOrObject instanceof BindingList === true) {\r\n      bindingObj = bindingListOrObject.currentItem;\r\n    } else {\r\n      bindingObj = bindingListOrObject;\r\n    }\r\n    return bindingObj.toJSON();\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä½åè¡¨æ°æ®\r\n   */\r\n  public getEntityListData(path: string[]): any[] {\r\n    const bindingList = this.bindingData.getValue(path) as BindingList;\r\n    return bindingList.toJSON();\r\n  }\r\n\r\n}\r\n\r\nexport { EntityTraversingService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, BindingData } from '@farris/devkit';\r\n\r\n@Injectable()\r\nclass EntityManipulationService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçå­æ®µå¼\r\n   */\r\n  public setPropValue(path: string[], value: any): any {\r\n\r\n    // å®ä½å±è¿æ²¡æå°è£ï¼ä¸´æ¶ç¨BindingDataç¸å³æ¹æ³ä»£æ¿\r\n    this.bindingData.setValue(path, value, true, true);\r\n  }\r\n\r\n}\r\n\r\nexport { EntityManipulationService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, BindingData, BindingList, BindingObject } from '@farris/devkit';\r\nimport { EntityTraversingService } from './entity-traversing.service';\r\n\r\ninterface SplitedPath {\r\n  listPath: string[];\r\n  propPath: string[];\r\n}\r\n\r\n/**\r\n * å®ä½èåæå¡\r\n */\r\n@Injectable()\r\nclass EntityAggregationService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  private traversingService: EntityTraversingService;\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n    this.traversingService   = this.frameContext.injector.get<EntityTraversingService>(EntityTraversingService);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºåè¡¨è®°å½çæ¡æ°\r\n   */\r\n  public count(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n    return entityListData.length;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçå\r\n   */\r\n  public sum(path: string[]) {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const total = entityListData.reduce((accTotal: number, entityData: any) => {\r\n      let propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      propValue = isNaN(propValue) ? 0 : propValue;\r\n      accTotal += propValue;\r\n      return accTotal;\r\n    }, 0);\r\n    return total;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçå¹³åå¼\r\n   */\r\n  public avg(path: string[]) {\r\n    const count = this.count(path);\r\n    const total = this.sum(path);\r\n    return count !== 0 ? total / count : 0;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçæå¤§å¼\r\n   */\r\n  public max(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const max =  entityListData.reduce((accMax: number, entityData: any) => {\r\n      const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      if (isNaN(propValue) === false && ( !accMax || propValue > accMax)) {\r\n        accMax = propValue;\r\n      }\r\n      return accMax;\r\n    }, null);\r\n    return max ? max : 0;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçæå°å¼\r\n   */\r\n  public min(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const min = entityListData.reduce((accMin: number, entityData: any) => {\r\n      const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      if (isNaN(propValue) === false && ( !accMin || propValue < accMin)) {\r\n        accMin = propValue;\r\n      }\r\n      return accMin;\r\n    }, null);\r\n    return min ? min : 0;\r\n  }\r\n\r\n  /**\r\n   * è·åå±æ§å¼\r\n   */\r\n  private getPropValue(entityData: any, path: string[]) {\r\n    let currentData = entityData;\r\n    path.forEach((pathItem: string) => {\r\n\r\n      // æåéåºçé½éç½®ä¸ºnullï¼ä¸»è¦éå¯¹å³èå¯¹è±¡æªèµå¼åºæ¯\r\n      if (!currentData) {\r\n        currentData = null;\r\n        return;\r\n      }\r\n      currentData = currentData[pathItem];\r\n    });\r\n\r\n    return currentData;\r\n  }\r\n\r\n  /**\r\n   * åéè·¯å¾ï¼åéç¬¦åè¡¨è·¯å¾åå±æ§è·¯å¾\r\n   * @return å½¢å¦ {parentListPath: [], propertyPath: []}\r\n   */\r\n  private splitPath(path: string[]): SplitedPath {\r\n    const listPath = path.concat([]);\r\n    const propPath = [];\r\n    let currentNode = this.bindingData.getValue(listPath);\r\n    while (currentNode instanceof BindingList !== true) {\r\n      const propPathItem = listPath.pop();\r\n      if (!propPathItem) {\r\n        return;\r\n      }\r\n      propPath.unshift(propPathItem);\r\n      currentNode = this.bindingData.getValue(listPath);\r\n    }\r\n\r\n    return {\r\n      listPath: listPath,\r\n      propPath: propPath\r\n    };\r\n  }\r\n\r\n}\r\n\r\nexport { EntityAggregationService };\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-29 19:07:30 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-05-29 19:31:19\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport { BindingData } from '@farris/devkit';\r\n\r\n/**\r\n * EntityListæå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass EntityListService {\r\n\r\n  constructor(private bindingData: BindingData) {}\r\n\r\n    /**\r\n     * è·åå½åé¡µç \r\n     */\r\n    public get pageIndex() {\r\n        return this.bindingData.list.pageIndex;\r\n    }\r\n\r\n    /**\r\n     * è·åå½ååé¡µå¤§å°\r\n     */\r\n    public get pageSize() {\r\n        return this.bindingData.list.pageSize;\r\n    }\r\n}\r\n\r\nexport { EntityListService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { EntityTraversingService } from './entity-traversing.service';\r\nimport { EntityManipulationService } from './entity-manipulation.service';\r\nimport { EntityAggregationService} from './entity-aggregation.service';\r\n\r\n/**\r\n * å®ä½æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass EntityService {\r\n\r\n  private traversingService: EntityTraversingService;\r\n\r\n  private manipulationService: EntityManipulationService;\r\n\r\n  private aggregationService: EntityAggregationService;\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n    const injector = this.frameContext.injector;\r\n    this.traversingService   = injector.get<EntityTraversingService>(EntityTraversingService);\r\n    this.manipulationService = injector.get<EntityManipulationService>(EntityManipulationService);\r\n    this.aggregationService  = injector.get<EntityAggregationService>(EntityAggregationService);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºçå±æ§å¼\r\n   */\r\n  public getPropValue(path: string[]): any {\r\n    return this.traversingService.getPropValue(path);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçå±æ§å¼\r\n   */\r\n  public setPropValue(path: string[], value: any): void {\r\n    return this.manipulationService.setPropValue(path, value);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçEntityæ°æ®\r\n   */\r\n  public getEntityData(path: string[]): any {\r\n    return this.traversingService.getEntityData(path);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçEntityListæ°æ®\r\n   */\r\n  public getEntityListData(path: string[]): any {\r\n    return this.traversingService.getEntityListData(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºEntityListè®°å½æ°\r\n   */\r\n  public count(path: string[]): number {\r\n    return this.aggregationService.count(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çåè®¡å¼\r\n   */\r\n  public sum(path: string[]): number {\r\n    return this.aggregationService.sum(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çå¹³åå¼\r\n   */\r\n  public avg(path: string[]): number {\r\n    return this.aggregationService.avg(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çæå¤§å¼\r\n   */\r\n  public max(path: string[]): number {\r\n    return this.aggregationService.max(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çæå°å¼\r\n   */\r\n  public min(path: string[]): number {\r\n    return this.aggregationService.min(path);\r\n  }\r\n}\r\n\r\nexport { EntityService };\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, DataTypeInfo, Entity, FrameContext, Repository } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class BindingPathService {\r\n  constructor(private injector: Injector, private appContext: AppContext, private repository: Repository<Entity>) { }\r\n  /**\r\n   * è·åç»ä»¶ä¸ä¸æçç»å®è·¯å¾\r\n   * @param frameContext ç»ä»¶ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public getBindingPathsByFrameContext(frameContext: FrameContext): string[] {\r\n    return frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath && frameContext.viewModel.bindingPath.split('/').filter(p => p) || null;\r\n  }\r\n  /**\r\n   * éè¿BEè¡¨åè·åbindingPath\r\n   * @param dataTypeInfo \r\n   * @param tableName \r\n   * @param paths \r\n   * @param level\r\n   * @returns \r\n   */\r\n  public getBindingPathsByTableName(dataTypeInfo: DataTypeInfo, tableName: string, paths: string[] = [], level: number = 0): string[] {\r\n    level++;\r\n    if (dataTypeInfo.entityInfo && (dataTypeInfo.entityInfo.nodeCode === tableName || dataTypeInfo.entityInfo.originalCode === tableName)) {\r\n      if (level !== 1) {\r\n        paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n      }\r\n      return paths;\r\n    }\r\n    const props = Array.from(dataTypeInfo.propInfoMap.values()).filter(p => p.typeInfo);\r\n    if (props.length < 1) {\r\n      paths = [];\r\n      return paths;\r\n    }\r\n    if (dataTypeInfo.entityInfo) {\r\n      if (level !== 1) {\r\n        paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n      }\r\n    }\r\n\r\n    for (let idx = 0; idx < props.length; idx++) {\r\n      const dataTypeInfo = props[idx].typeInfo;\r\n      const path = this.getBindingPathsByTableName(dataTypeInfo, tableName, paths, level);\r\n      if (!path || path.length < 1) {\r\n        continue;\r\n      } else {\r\n        paths = paths.concat(path);\r\n        return paths;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * è·åå±æ§è·¯å¾ä¸­çç»å®è·¯å¾\r\n   * @param paths paths\r\n   * @param entityTypeInfo \r\n   * @returns \r\n   */\r\n  public getBindingPathsByPath(paths: string[] | string, entityTypeInfo: DataTypeInfo): string[] {\r\n    let nodeCodes = [];\r\n    if (typeof paths === 'string') {\r\n      paths = paths.split('/').filter(p => p);\r\n    }\r\n    paths = paths.concat([]);\r\n    while (paths.length > 0) {\r\n      const dataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n      if (dataPropInfo.group === 'List') {\r\n        nodeCodes = paths;\r\n        break;\r\n      }\r\n      paths.pop();\r\n    }\r\n    return nodeCodes;\r\n  }\r\n  /**\r\n   * è·åå±æ§è·¯å¾ä¿¡æ¯\r\n   * @param path å±æ§è·¯å¾\r\n   * @returns \r\n   */\r\n  public getPathInfo(path: string): { bindingPath: string, propertyName: string, bindingPaths: string[], propertyNames: string[] } {\r\n    const paths = path.split('/').filter(p => p);\r\n    // è·åæå¤§å®ä½å±çº§ï¼å¶ä½ä¸ºå±æ§ï¼ç®åå±æ§ãudtãå³èãå³èåµå¥å³èï¼\r\n    const entityPath = this.getBindingPathsByPath(paths, this.repository.entityTypeInfo);\r\n    const propertyName = paths.slice(entityPath.length).join('/');\r\n    return { bindingPath: entityPath.join('/'), propertyName, bindingPaths: entityPath, propertyNames: propertyName.split('/').filter(p => p) };\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { FrameContext, NgFormControl } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class FormControlService {\r\n  constructor() { }\r\n  public getFormControlsByFrameContext(frameContext: FrameContext): { [propertyName: string]: NgFormControl } | null {\r\n    return frameContext && frameContext.form && frameContext.form.ngFormControls || null;\r\n  }\r\n  /**\r\n   * éè¿bindingåæ°æ®è·åNgFormControl\r\n   * @param frameContext \r\n   * @param binding binding\r\n   * @returns \r\n   */\r\n  public getFormControlByBinding(frameContext: FrameContext, binding: string): NgFormControl {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    return Object.values(ngFormControls).find((ngFormControl: NgFormControl) => ngFormControl && ngFormControl.binding === binding);\r\n\r\n  }\r\n  /**\r\n   * \r\n   * @param frameContext frameContext\r\n   * @param fullPath \r\n   * @returns \r\n   */\r\n  public getFormControlIndexByFullPath(frameContext: FrameContext, fullPath: string): number {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    const bindings = fullPath.split('/').filter(p => p);\r\n    return Object.values(ngFormControls).findIndex((ngFormControl: NgFormControl) => {\r\n      if (!ngFormControl) {\r\n        return false;\r\n      }\r\n      const bindingPath = frameContext.viewModel.bindingPath;\r\n      const bindingPaths = bindingPath.split('/').filter(p => p);\r\n      const formControlBindingPaths = ngFormControl.binding.split('.').filter(p => p);\r\n      const fullPath = bindingPaths.concat(formControlBindingPaths);\r\n      return fullPath.join('/') === bindings.join('/');\r\n    });\r\n  }\r\n  /**\r\n   * éè¿bindingåæ°æ®è·åNgFormControlä½ç½®\r\n   * @param frameContext \r\n   * @param binding binding\r\n   * @returns ä»0å¼å§\r\n   */\r\n  public getFormControlIndexByBinding(frameContext: FrameContext, binding: string): number {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    return Object.values(ngFormControls).findIndex((ngFormControl: NgFormControl) => ngFormControl && ngFormControl.binding === binding);\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, DataPropInfo, Entity, FrameContext, Repository } from \"@farris/devkit\";\r\nimport { BindingPathService } from \"./binding-path.service\";\r\nimport { FormControlService } from './form-control.service';\r\n\r\n@Injectable()\r\nexport class FrameContextService {\r\n  constructor(\r\n    private injector: Injector, \r\n    private appContext: AppContext, \r\n    private frameContext: FrameContext, \r\n    private repository: Repository<Entity>,\r\n    private bindingPathService: BindingPathService,\r\n    private formControlService: FormControlService\r\n    ) { }\r\n  /**\r\n     * éè¿BEè¡¨åè·åå¯¹åºçframeContext\r\n     * @param tableName \r\n     * @returns \r\n     */\r\n  public getFrameContextsByTableName(tableName: string): null | FrameContext[] {\r\n    if (!tableName) {\r\n      throw new Error('tableName ä¸è½ä¸ºç©ºã');\r\n    }\r\n    const dataTypeInfo = this.repository && this.repository.entityTypeInfo || null;\r\n    if (!dataTypeInfo) {\r\n      return null;\r\n    }\r\n    const bindingPaths = [];\r\n    this.bindingPathService.getBindingPathsByTableName(dataTypeInfo, tableName, bindingPaths);\r\n    const frameContexts = this.appContext && this.appContext.frameContextManager.getFrameContexts() || [];\r\n    if (!frameContexts || frameContexts.length === 0) {\r\n      return null;\r\n    }\r\n    return frameContexts.filter((frameContext: FrameContext) => frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPaths.join('/'));\r\n  }\r\n  /**\r\n   * æ ¹æ®å­æ®µå®æ´è·¯å¾è·åæå¨çä¸ä¸æ\r\n   * @param propertyPath \r\n   * @param separtor \r\n   * @returns \r\n   */\r\n  public getFrameContextsByPropertyPath(propertyPath: string, separtor: string = '/'): FrameContext[] {\r\n    if (!propertyPath) {\r\n      throw new Error('propertyPath ä¸è½ä¸ºç©ºã');\r\n    }\r\n    const frameContexts = this.appContext && this.appContext.frameContextManager.getFrameContexts() || [];\r\n    return frameContexts.filter((frameContext: FrameContext) => {\r\n      const formControls = frameContext && frameContext.form && frameContext.form.ngFormControls || {};\r\n      const bindingPath = frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath || '';\r\n      if (formControls && Object.keys(formControls).length > 0) {\r\n        const key = Object.keys(formControls).find((key: string) => {\r\n          const formControl = formControls[key];\r\n          if (!formControl || !formControl.binding) {\r\n            return false;\r\n          }\r\n          const bindings = formControl.binding.split('.').filter(p => p);\r\n          const bindingPaths = bindingPath.split('/').filter(p => p);\r\n          const fullPath = bindingPaths.concat(bindings);\r\n          return propertyPath.split(separtor).filter(p => p).join('/') === fullPath.join('/');\r\n        });\r\n        return key ? true : false;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  /**\r\n   * éè¿BEå­æ®µåè·åå­æ®µçbindingPath\r\n   * @param bindingPaths ç»å®è·¯å¾\r\n   * @param columnName BEå­æ®µå\r\n   * @returns \r\n   */\r\n  public getFrameContextsByColumnName(bindingPaths: string[], columnName: string): FrameContext[] | null {\r\n    if (!bindingPaths) {\r\n      throw new Error('bindingPath ä¸è½ä¸ºç©ºã');\r\n    }\r\n    if (!columnName) {\r\n      throw new Error('columnName ä¸è½ä¸ºç©ºã');\r\n    }\r\n    bindingPaths = bindingPaths.filter(p => p);\r\n    const entityTypeInfo = this.repository && this.repository.entityTypeInfo || null;\r\n    if (!entityTypeInfo) {\r\n      return null;\r\n    }\r\n    const dataTypeInfo = entityTypeInfo.getTypeInfoByPath(bindingPaths);\r\n    const dataPropInfos = dataTypeInfo && dataTypeInfo.getPropInfos() || [];\r\n    const columnPropInfo = dataPropInfos.find((dataPropInfo: DataPropInfo) => dataPropInfo.metadataInfo && (dataPropInfo.metadataInfo.originalDataField === columnName || dataPropInfo.metadataInfo.dataField === columnName));\r\n    if (!columnPropInfo || !columnPropInfo.metadataInfo) {\r\n      return null;\r\n    }\r\n    const frameContexts = this.appContext.frameContextManager.getFrameContexts();\r\n    return frameContexts.filter((frameContext: FrameContext) => {\r\n      const ngFormControls = this.formControlService.getFormControlsByFrameContext(frameContext);\r\n      if (!ngFormControls || Object.keys(ngFormControls).length < 1) {\r\n        return false;\r\n      }\r\n      const currentBindingPaths = this.bindingPathService.getBindingPathsByFrameContext(frameContext) || [];\r\n      const isValidFrameContext = currentBindingPaths.join('/') === bindingPaths.join('/');\r\n      if (!isValidFrameContext) {\r\n        return false;\r\n      }\r\n      const ngFormControl = Object.values(frameContext.viewModel.form.ngFormControls).find(item => item.binding === columnPropInfo.metadataInfo.path);\r\n      return ngFormControl ? true : false;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * éè¿ç»å®è·¯å¾è·åå¯¹åºçç»ä»¶ä¸ä¸ææ°ç»\r\n   * @param bindingPath bindingPathå­ç¬¦ä¸²\r\n   * @param namespace ns,é»è®¤ä¸º''\r\n   */\r\n   public getFrameContextsByBindingPath(bindingPath: string | string[], namespace: string = ''): FrameContext[] {\r\n    if (Array.isArray(bindingPath)) {\r\n      bindingPath = bindingPath.join('/');\r\n    }\r\n    const frameContexts = this.appContext && this.appContext.frameContextManager.getFrameContexts() || [];\r\n    return frameContexts.filter((frameContext: FrameContext) => frameContext && frameContext.namespace === namespace && frameContext.viewModel.bindingPath === bindingPath);\r\n  }\r\n}","import { Injectable, ElementRef } from '@angular/core';\r\nimport { Repository, FrameContext, NgFormControl } from '@farris/devkit';\r\nimport { FrameContextService } from './frame-context.service';\r\nimport { FormControlService } from './form-control.service';\r\n\r\nconst FIXED_COLUMN_START_INDEX = 5000;\r\nconst GRID_COLUMN_START_INDEX = 10000;\r\ninterface FocusableInvalidationGrid {\r\n  editCell(rowId: any, field: string): void;\r\n  disabled: boolean;\r\n}\r\n\r\n/**\r\n * è¡¨åéªè¯æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass FocusInvalidService {\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private frameContext: FrameContext,\r\n    private frameContextService: FrameContextService,\r\n    private formControlService: FormControlService\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * åç¬¬ä¸ä¸ªéªè¯ä¸éè¿çå­æ®µè®¾ç½®ç¦ç¹\r\n   */\r\n  public focusInvalidInput(verifyInformations: any[], rootElement: ElementRef<any>) {\r\n    // æ éªè¯ä¸éè¿ä¿¡æ¯æ¶ï¼ç´æ¥è¿åã\r\n    if (!verifyInformations || !verifyInformations.length) {\r\n      return;\r\n    }\r\n    let targetField = null;\r\n    const firstVerifyInformation = this.selectFirstVerifyInformation(verifyInformations, rootElement);\r\n    if (firstVerifyInformation) {\r\n      targetField = firstVerifyInformation.targetField;\r\n      if (targetField) {\r\n        const canFocus = this.focusElement(targetField, rootElement);\r\n        if (canFocus) {\r\n          verifyInformations['focused'] = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®DataGridååæ ¼ç¦ç¹\r\n   */\r\n  public focusGridCell(verifyInformations: any[], focusableDataGrid: FocusableInvalidationGrid) {\r\n    if (!verifyInformations || !verifyInformations.length || verifyInformations['focused'] == true || focusableDataGrid.disabled === true) {\r\n      return;\r\n    }\r\n    let targetField = null;\r\n    let targetId = null;\r\n    const firstVerifyInformation = this.selectFirstVerifyInformation(verifyInformations);\r\n    if (firstVerifyInformation) {\r\n      targetField = firstVerifyInformation.targetField;\r\n      targetId = firstVerifyInformation.id;\r\n      verifyInformations['focused'] = true;\r\n      focusableDataGrid.editCell(targetId, targetField);\r\n    }\r\n  }\r\n  private updateVerifyInformationsIndex(verifyInformations: any[], rootElement?: ElementRef<any>) {\r\n    verifyInformations = verifyInformations.filter((verifyInformation: any) => {\r\n      const frameContexts = this.getFrameContextsByPropertyPath(verifyInformation.fullPath, '/');\r\n      const frameContext = frameContexts && frameContexts.filter(frameContext => frameContext && frameContext.frameId === this.frameContext.frameId);\r\n      return frameContext ? true : false;\r\n    });\r\n    return verifyInformations.map((verifyInformation: any) => {\r\n      let tabIndex = -1;\r\n      if (verifyInformation) {\r\n        if (rootElement && verifyInformation.targetField) {\r\n          const input = this.getInputElementById(verifyInformation.targetField, rootElement);\r\n          tabIndex = input && input.getAttribute('tabindex') || -1;\r\n          tabIndex = Number(tabIndex);\r\n        }\r\n        // const frameContexts = this.getFrameContextsByPropertyPath(verifyInformation.fullPath, '/');\r\n        const frameContext = this.frameContext;//frameContexts && frameContexts[0] || null;\r\n        const frameIndex = frameContext.index + 1;\r\n        verifyInformation.tabIndex = tabIndex;\r\n        verifyInformation.domIndex = -1;\r\n        verifyInformation.frameIndex = -1;\r\n        verifyInformation.position = tabIndex;\r\n        if (frameContext) {\r\n          const domIndex = verifyInformation.fullPath && this.getFieldIndex(frameContext, verifyInformation.fullPath) || 0;\r\n          if (domIndex > 0) {\r\n            const rowIndex = verifyInformation.index || 0;\r\n            verifyInformation.domIndex = domIndex;\r\n            verifyInformation.frameIndex = frameContext.index;\r\n            verifyInformation.position = tabIndex > 0 ? tabIndex : (frameIndex * 1000 + rowIndex * 1000 + domIndex);\r\n          }\r\n        }\r\n      }\r\n      return verifyInformation;\r\n    });\r\n  }\r\n  private isGridComponent(frameContext: FrameContext) {\r\n    if (frameContext) {\r\n      const dataGridColumnsName = frameContext.viewModel['dataGridColumnsName'] || null;\r\n      return dataGridColumnsName ? true : false;\r\n    }\r\n    return undefined;\r\n  }\r\n  private getColumnIndex(frameContext: FrameContext, binding: string) {\r\n    binding = binding.split('/').filter(p => p).join('/');\r\n    const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    const dataGridColumnsName = frameContext.viewModel['dataGridColumnsName'] || null;\r\n    const frameIndex = frameContext.index + 1;\r\n    if (!dataGridColumnsName) {\r\n      return undefined;\r\n    }\r\n    let columns: any[] = frameContext.viewModel[dataGridColumnsName];\r\n    if (!columns || columns.length < 1) {\r\n      return undefined;\r\n    }\r\n    // æå¹³columns\r\n    columns = columns.reduce((results: any[], item) => {\r\n      if (Array.isArray(item)) {\r\n        return results.concat(item);\r\n      }\r\n      return results.concat([item]);\r\n    }, []);\r\n    let position = -1;\r\n    for (let index = 0; index < columns.length; index++) {\r\n      const column: any | any[] = columns[index];\r\n      const fields = column && column.field && column.field.split('.').filter(p => p) || null;\r\n      if (!fields) {\r\n        continue;\r\n      }\r\n      if (bindingPaths.concat(fields).join('/') === binding) {\r\n        const fixed = column.fixed;\r\n        if (fixed) {\r\n          const fixedColumns = columns.filter(item => item.fixed === fixed);\r\n          const fixedColumnIndex = this.getIndexFromColumns(fixedColumns, binding);\r\n          if (fixed === 'left') {\r\n            position = frameIndex * FIXED_COLUMN_START_INDEX + fixedColumnIndex;\r\n          } else {\r\n            position = frameIndex * GRID_COLUMN_START_INDEX + 1000 + fixedColumnIndex;\r\n          }\r\n        } else {\r\n          position = frameIndex * GRID_COLUMN_START_INDEX + index;\r\n        }\r\n        break;\r\n      }\r\n    }\r\n    return position;\r\n  }\r\n  private getIndexFromColumns(columns: any[], binding: string) {\r\n    const bindingPaths = this.frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    return columns.findIndex(column => {\r\n      const fields = column && column.field && column.field.split('.').filter(p => p) || null;\r\n      if (!fields) {\r\n        return false;\r\n      }\r\n      if (bindingPaths.concat(fields).join('/') === binding) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  private selectFirstVerifyInformation(verifyInformations: any[], rootElement?: ElementRef<any>) {\r\n    verifyInformations = this.updateVerifyInformationsIndex(verifyInformations, rootElement);\r\n    verifyInformations.sort((v1: any, v2: any) => Number(v1.position) - Number(v2.position));\r\n    return verifyInformations && verifyInformations.length > 0 && verifyInformations[0] || null;\r\n  }\r\n  private getInputElementById(targetField: string, rootElement: ElementRef<any>) {\r\n    let element = rootElement.nativeElement.ownerDocument.getElementById(targetField) || null;\r\n    if (element && element.tagName !== 'INPUT') {\r\n      const inputs = element.getElementsByTagName('input');\r\n      if (inputs.length) {\r\n        element = inputs[0];\r\n      }\r\n    }\r\n    return element;\r\n  }\r\n  public getFrameContextsByPropertyPath(propertyPath: string, separtor: string = '/'): FrameContext[] {\r\n    if (!propertyPath) {\r\n      return [];\r\n    }\r\n    const frameContexts = this.frameContext && this.frameContext.appContext.frameContextManager.getFrameContexts() || [];\r\n    return frameContexts.filter((frameContext: FrameContext) => {\r\n      const formControls = frameContext && frameContext.form && frameContext.form.ngFormControls || {};\r\n      const bindingPath = frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath || '';\r\n      if (formControls && Object.keys(formControls).length > 0) {\r\n        const key = Object.keys(formControls).find((key: string) => {\r\n          const formControl = formControls[key];\r\n          if (!formControl || !formControl.binding) {\r\n            return false;\r\n          }\r\n          const bindings = formControl.binding.split('.').filter(p => p);\r\n          const bindingPaths = bindingPath.split('/').filter(p => p);\r\n          const fullPath = bindingPaths.concat(bindings);\r\n          return propertyPath.split(separtor).filter(p => p).join('/') === fullPath.join('/');\r\n        });\r\n        return key ? true : false;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  public getFormControlIndexByBindingPath(frameContext: FrameContext, binding: string): number {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    const bindings = binding.split('/').filter(p => p);\r\n    return Object.values(ngFormControls).findIndex((ngFormControl: NgFormControl) => {\r\n      if (!ngFormControl) {\r\n        return false;\r\n      }\r\n      const bindingPath = frameContext.viewModel.bindingPath;\r\n      const bindingPaths = bindingPath.split('/').filter(p => p);\r\n      const formControlBindingPaths = ngFormControl.binding.split('.').filter(p => p);\r\n      const fullPath = bindingPaths.concat(formControlBindingPaths);\r\n      return fullPath.join('/') === bindings.join('/');\r\n    });\r\n  }\r\n  public getFieldIndex(frameContext: FrameContext, binding: string) {\r\n    const isGridComponent = this.isGridComponent(frameContext);\r\n    if (isGridComponent) {\r\n      return this.getColumnIndex(frameContext, binding);\r\n    } else {\r\n      return this.getFormControlIndexByBindingPath(frameContext, binding);\r\n    }\r\n  }\r\n  public getFormControlsByFrameContext(frameContext: FrameContext): { [propertyName: string]: NgFormControl } | null {\r\n    return frameContext && frameContext.form && frameContext.form.ngFormControls || null;\r\n  }\r\n  public focusElement(elementId: string, rootElement: ElementRef<any>): boolean {\r\n    let focused = false;\r\n    let elementToFocus = rootElement.nativeElement.ownerDocument.getElementById(elementId);\r\n    // æªè·åå°æå®å­æ®µæ¶ï¼è¿åï¼ä¸åè®¾ç½®ç¦ç¹ã\r\n    if (elementToFocus) {\r\n      // å¦ææå¤ä¸ªidéå¤çåç´ ï¼åä¸å®ä½\r\n      const elements = rootElement.nativeElement.ownerDocument.querySelectorAll(`#${elementId}`);\r\n      if (elements && elements.length > 1) {\r\n        return focused;\r\n      }\r\n      // å¦æç»å®ç®æ å­æ®µçæ§ä»¶ä¸æ¯Inputåç´ ï¼åæ¥æ¾å¶ä¸çº§èç¹ã\r\n      if (elementToFocus.tagName !== 'INPUT') {\r\n        const subElements = elementToFocus.getElementsByTagName('input');\r\n        if (subElements.length) {\r\n          elementToFocus = subElements[0];\r\n        }\r\n      }\r\n      elementToFocus.focus();\r\n      focused = true;\r\n    }\r\n    return focused;\r\n  }\r\n  /**\r\n   * è®¾ç½®ç¦ç¹\r\n   * @param verifyInformation éè¯¯ä¿¡æ¯\r\n   * @param frameContext ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public focus(verifyInformation: any, frameContext: FrameContext) {\r\n    if (!verifyInformation) {\r\n      return;\r\n    }\r\n    const isGridValidation = verifyInformation.index !== null;\r\n    if (isGridValidation) {\r\n      const grid = this.getGridRef(frameContext);\r\n      if (grid) {\r\n        setTimeout(() => {\r\n          grid.editCell(verifyInformation.id, verifyInformation.targetField);\r\n        }, 0);\r\n      }\r\n    } else {\r\n      const frameElement = this.getComponentRef(frameContext);\r\n      const elementId = verifyInformation.targetField;\r\n      this.focusById(elementId, frameElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * éè¿æ§ä»¶idè®¾ç½®ç¦ç¹\r\n   * @param elementId \r\n   * @param elementRef \r\n   */\r\n  private focusById(elementId: string, elementRef?: ElementRef) {\r\n    const document: any = elementRef && elementRef.nativeElement.ownerDocument || window.document;\r\n    if (document) {\r\n      const element = document.getElementById(elementId);\r\n      if (element.tagName !== 'INPUT') {\r\n        const subElements = element.getElementsByTagName('input');\r\n        if (subElements.length) {\r\n          const input = subElements[0];\r\n          if (input && typeof input.focus === 'function') {\r\n            input.focus();\r\n          }\r\n        }\r\n      } else {\r\n        element.focus();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·åç»ä»¶å®ä¾\r\n   * @param frameContext \r\n   * @returns \r\n   */\r\n  private getComponentRef(frameContext: FrameContext) {\r\n    return this.frameContext && this.frameContext.injector.get<ElementRef>(ElementRef, null) || null;\r\n  }\r\n  /**\r\n   * è·ågridå®ä¾\r\n   * @param frameContext frameContext\r\n   * @returns \r\n   */\r\n  private getGridRef(frameContext: FrameContext): FocusableInvalidationGrid {\r\n    const namespace = frameContext.namespace;\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const frameContexts: FrameContext[] = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace) || [];\r\n    const matchedFrameContexts = frameContexts.filter((frameContext: FrameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).toString() === bindingPath.split('/').filter(p => p).toString());\r\n    let result = null;\r\n    if (matchedFrameContexts) {\r\n      matchedFrameContexts.every((frameContext: FrameContext) => {\r\n        const frameId = frameContext.frameId;\r\n        const componentsMap = this.frameContext.appContext.componentManager.getComponentsByFrameId(frameId);\r\n        if (!componentsMap) {\r\n          return true;\r\n        }\r\n        const datagridComponent = Array.from(componentsMap.values()).find((component: any) => component && component['__component_type__'] === 'DatagridComponent');\r\n        if (datagridComponent) {\r\n          result = datagridComponent;\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport { FocusableInvalidationGrid, FocusInvalidService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Repository, FrameContext } from '@farris/devkit';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { EMPTY, Observable, Subject, Subscriber } from 'rxjs';\r\nimport { of } from 'rxjs/observable/of';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\n\r\n\r\nconst POSTER = 'iframePoster';\r\nconst RECEIVER = 'iframeReceiver';\r\nconst REPOSITORY = 'repository';\r\n// window.hashä¸­funcIdçå±æ§å\r\nconst FUNC_ID = 'funcId=';\r\nconst TAB_ID = 'tabId=';\r\n/**\r\n * ChangeItemService\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass ChangeItemService {\r\n\r\n  public top = top;\r\n  private funcId: string;\r\n  private tabId: string;\r\n  public itemChangePoster = new Subject<any>();\r\n  public itemChangeReceiver = new Subject<any>();\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private frameContext: FrameContext,\r\n    private notifyService: FormNotifyService,\r\n    private languageService: LanguageService\r\n  ) {\r\n  }\r\n\r\n  init() {\r\n    this.top['topMap'] = this.top['topMap'] || {};\r\n    this.changeItem = this.changeItem.bind(this);\r\n  }\r\n\r\n  setBykey(key: string, value: any) {\r\n    this.top['topMap'] = this.top['topMap'] || {};\r\n    this.top['topMap'][this.tabId] = this.top['topMap'][this.tabId] || {};\r\n    const topObject = this.top['topMap'][this.tabId];\r\n    topObject[key] = value;\r\n  }\r\n\r\n  getByKey(key: string) {\r\n    const topObject = this.top['topMap'][this.tabId] || {};\r\n    return topObject[key];\r\n  }\r\n\r\n  // å»ºç«iframeéä¿¡\r\n  setIframePoster() {\r\n    if (this.getByKey[POSTER]) {\r\n      return;\r\n    } else {\r\n      this.setBykey(POSTER, this.itemChangePoster);\r\n    }\r\n  }\r\n\r\n  getIframePoster() {\r\n    this.itemChangePoster = this.getByKey(RECEIVER);\r\n    this.setBykey(RECEIVER, this.itemChangeReceiver);\r\n  }\r\n\r\n  changeItem(type: string, id: string, parentId: string) {\r\n    // æ ¹æ®æ¯å¦æ¯å¼¹åºå¼å¡çåä¸åçtabId\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    const virtualRootComponent = virtualRootFrameContext.frameComponent;\r\n    const isDialogComponent = virtualRootComponent['isDialogRootComponent'] || false;\r\n    if (isDialogComponent) {\r\n      this.tabId = window.location.hash.split(TAB_ID)[1].slice(0, window.location.hash.split(TAB_ID)[1].indexOf('&'));\r\n    } else {\r\n      this.tabId = parentId;\r\n    }\r\n    this.itemChangeReceiver = this.getByKey(RECEIVER);\r\n    return Observable.create((subscriber: Subscriber<any>) => {\r\n      this.getNextItemByCurrentId(id, type).subscribe((result: any) => {\r\n        subscriber.next(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  // å¨liståå§åæ¶è°ç¨ï¼ç¼å­listçrepository\r\n  setRepository() {\r\n    if (window.location.hash.includes(TAB_ID)) {\r\n      this.tabId = window.location.hash.split(TAB_ID)[1].slice(0, window.location.hash.split(TAB_ID)[1].indexOf('&'));\r\n      this.setBykey(REPOSITORY, this.frameContext.repository);\r\n      this.setIframePoster();\r\n      this.getIframePoster();\r\n    }\r\n  }\r\n\r\n  // æ ¹æ®ç±»ååidè·åç¸é»çæ°æ®\r\n  getNextItemByCurrentId(currentId: string, type: string) {\r\n    const repository = this.getByKey(REPOSITORY);\r\n    const { pageSize, pageIndex, total } = repository.entityCollection.paginationInfo;\r\n    let currentIdx = null;\r\n    const list = repository.entityCollection.getAllEntities();\r\n    list.find((x: any, idx: string) => {\r\n      if (x.id === currentId) {\r\n        currentIdx = idx;\r\n      }\r\n    });\r\n    // æ²¡æå¨åè¡¨ä¸­æ¾å°æ°æ®ï¼è¿åç©º\r\n    if (currentIdx === null) {\r\n      // æ°å¢åæ¶å½åæ æ°æ®æ¶ç¹ä¸ä¸æ¡ä¸ä¸æ¡\r\n      if (list.length) {\r\n        switch (type) {\r\n          case 'prev':\r\n            return of(list[list.length - 1].id);\r\n            break;\r\n          case 'next':\r\n            this.notifyService.info(this.languageService.changeToLast, { hideTitle: true });\r\n            return EMPTY;\r\n        }\r\n      }\r\n      return of(null);\r\n    }\r\n    let nextIdx = currentIdx;\r\n    switch (type) {\r\n      case 'prev':\r\n        // å½åé¡µç¬¬ä¸æ¡,ä¸éç¬¬ä¸é¡µ,åä¸ä¸é¡µæåä¸æ¡\r\n        if (currentIdx === 0 && pageIndex !== 1) {\r\n          return repository.getEntities([], [], pageSize, pageIndex - 1).pipe(\r\n            switchMap(result => {\r\n              nextIdx = pageSize - 1;\r\n              return of(result[nextIdx].id);\r\n            })\r\n          );\r\n        }\r\n        // ç¬¬ä¸é¡µç¬¬ä¸æ¡ï¼ä»è¿ååææ°æ®\r\n        else if (currentIdx === 0 && pageIndex === 1) {\r\n          this.notifyService.info(this.languageService.changeToFirst, { hideTitle: true });\r\n          return of(list[nextIdx].id);\r\n        }\r\n        // ä¸æ¯ç¬¬ä¸æ¡ï¼è¿åä¸ä¸æ¡\r\n        else {\r\n          nextIdx = currentIdx - 1;\r\n          return of(list[nextIdx].id);\r\n        }\r\n        break;\r\n      case 'next':\r\n        // è¶è¿å½åé¡µ\r\n        if (currentIdx + 1 + 1 > list.length) {\r\n          // ä¸éæåä¸æ¡æ°æ®,åä¸ä¸é¡µç¬¬ä¸æ¡æ°æ®\r\n          if (((pageIndex - 1) * pageSize + currentIdx + 1) < total) {\r\n            return repository.getEntities([], [], pageSize, pageIndex + 1).pipe(switchMap(result => {\r\n              return of(result[0].id);\r\n            }));\r\n          }\r\n          // æåä¸æ¡æ°æ®ï¼ä»è¿ååæ°æ®\r\n          else {\r\n            this.notifyService.info(this.languageService.changeToLast, { hideTitle: true });\r\n            return of(list[nextIdx].id);\r\n          }\r\n        } else {\r\n          nextIdx = currentIdx + 1;\r\n          return of(list[nextIdx].id);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\nexport { ChangeItemService };\r\n","import { CommandContext } from \"@farris/devkit\";\r\n\r\nexport abstract class Service {\r\n  public context: CommandContext;\r\n  /**\r\n   * å½ä»¤åæ°\r\n   */\r\n  public get eventParam(){\r\n    return this.context && this.context.eventParam || null;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { Service } from \"./service\";\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { QueryCondition } from '@farris/component-querycondition';\r\nimport { CommandContext, FrameContext } from \"@farris/devkit\";\r\n@Injectable()\r\nexport class DataGridService extends Service {\r\n  /**\r\n   * æ¸ç©ºææå¾éè¡\r\n   * @description åæ¶å¾éå½åè¡¨åææå¾éè¡\r\n   */\r\n  public clearChecks() {\r\n    // const params = this.eventParam;\r\n    // if (params && Array.isArray(params)) {\r\n    // const param = params[0];\r\n    // if (param instanceof QueryCondition) {\r\n    const gridComponents = this.getFormGridComponents(this.context);\r\n    if (gridComponents && gridComponents.length > 0) {\r\n      gridComponents.forEach((gridComponent: DatagridComponent) => {\r\n        let clearSelections = true;\r\n        if (gridComponent.hasOwnProperty('clearSelectionsWhenDataIsEmpty')) {\r\n          clearSelections = gridComponent['clearSelectionsWhenDataIsEmpty'];\r\n        }\r\n        if (clearSelections) {\r\n          gridComponent.clearCheckeds(true);\r\n        }\r\n      });\r\n    }\r\n    // }\r\n    // }\r\n  }\r\n  /**\r\n   * åæ¶å¾éå é¤çè¡\r\n   * @param ids ids\r\n   * @returns \r\n   * @description åæ¶å¾éå½åç»å®è·¯å¾ä¸æå®æ°æ®ï¼æ¸ç©ºä¸çº§è¡¨æ ¼ä¸­ææå¾éè¡ï¼ä»ä¾å é¤åºæ¯ä½¿ç¨\r\n   */\r\n  public uncheckDeletedRows(ids: any) {\r\n    if (typeof ids === 'string') {\r\n      if (ids.indexOf(',') !== -1) {\r\n        ids = ids.split(',').filter(p => p);\r\n      } else {\r\n        ids = [ids];\r\n      }\r\n    }\r\n    if (!ids || ids.length < 1) {\r\n      return;\r\n    }\r\n    // è·åbindingPathåns\r\n    const frameContext = this.context.frameContext;\r\n    if (!frameContext) {\r\n      return;\r\n    }\r\n    const appContext = frameContext.appContext;\r\n    const ns = frameContext.namespace;\r\n    const bindingPath = frameContext.viewModel && frameContext.viewModel.bindingPath;\r\n    if (!appContext) {\r\n      return;\r\n    }\r\n    // æ ¹æ®bindingPathè·åææå¯è½çframeContext\r\n    const frameContexts = appContext.frameContextManager.getFrameContextsByNamespace(ns);\r\n    const frameContextsInCurrentBindingPath = frameContexts.filter(frameContext => frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath === bindingPath);\r\n    // è·åè¿äºframeä¸­ææçè¡¨æ ¼ç»ä»¶map\r\n    const gridInCurrentFrame = this.getGridComponentByFrameContexts(frameContextsInCurrentBindingPath);\r\n    if (!gridInCurrentFrame) {\r\n      return;\r\n    }\r\n    // ä¸ä¸ªbindingPathä¸åºè¯¥åªæä¸ä¸ªgrid\r\n    const grid: DatagridComponent = gridInCurrentFrame.pop();\r\n    // æ¸ç©ºå½ä»¤æå¨çframeä¸è¡¨æ ¼çæå®å¾é\r\n    if(grid){\r\n      grid.unCheckRows(ids, true);\r\n    }\r\n    // æ¸ç©ºä¸çº§è¡¨æ ¼çææå¾éè¡æ°æ®\r\n    const childrenFrameContexts = frameContexts.filter(frameContext => frameContext.viewModel.bindingPath !== bindingPath && frameContext.viewModel.bindingPath.startsWith(bindingPath));\r\n    const childrenGridComponents = this.getGridComponentByFrameContexts(childrenFrameContexts);\r\n    // æ¸ç©ºå½ä»¤æå¨frame\r\n    if (childrenGridComponents && childrenGridComponents.length > 0) {\r\n      childrenGridComponents.forEach((gridComponent: DatagridComponent) => {\r\n        // æ¸ç©ºææå¾é\r\n        gridComponent.checkedRows = [];\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * åæ¶å¾éè¡\r\n   * @param ids ids\r\n   * @returns \r\n   */\r\n  public uncheckRows(ids: any) {\r\n    if (typeof ids === 'string') {\r\n      ids = [ids];\r\n    }\r\n    if (!ids || ids.length < 1) {\r\n      return;\r\n    }\r\n    const gridComponents = this.getFormGridComponents(this.context);\r\n    if (gridComponents && gridComponents.length > 0) {\r\n      gridComponents.forEach((gridComponent: DatagridComponent) => {\r\n        gridComponent.unCheckRows(ids, true);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®å½ä»¤ä¸ä¸æè·åå½åå½ä»¤æå¨ç»ä»¶çè¡¨æ ¼å®ä¾\r\n   * @param commandContext å½ä»¤ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  private getFormGridComponents(commandContext: CommandContext) {\r\n    let grids = [];\r\n    const frameContext = commandContext && commandContext.frameContext;\r\n    const appContext = frameContext && frameContext.appContext || null;\r\n    if (appContext) {\r\n      const componentRefs: Map<string, Map<string, any>> = appContext.componentRefs;\r\n      const collect = Array.from(componentRefs.values());// [Map<string,any>,Map<string,any>]\r\n      collect.forEach((item: Map<string, any>) => {\r\n        const components = Array.from(item.values());\r\n        const bindingPath = frameContext\r\n        const gridComponents = components.filter((component: any) => component instanceof DatagridComponent);\r\n        grids = grids.concat(gridComponents);\r\n      });\r\n    }\r\n    return grids;\r\n  }\r\n  private getGridComponentByFrameContexts(frameContexts: FrameContext[]) {\r\n    return frameContexts.reduce((result, frameContext) => {\r\n      const appContext = frameContext.appContext;\r\n      const frameId = frameContext.frameId;\r\n      // è·åå½åç»ä»¶ä¸ææçç»ä»¶å®ä¾\r\n      const componentsRef = appContext.componentRefs.get(frameId);\r\n      const grids = componentsRef && Array.from(componentsRef.values()).filter(component => component instanceof DatagridComponent);\r\n      if (grids && grids.length > 0) {\r\n        result = result.concat(grids);\r\n      }\r\n      return result;\r\n    }, []);\r\n  }\r\n}","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of, empty, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap, catchError } from 'rxjs/operators';\r\nimport { Repository, BindingData, Entity, ViewModel, BindingList, EntityPathConverter, BindingObject } from '@farris/devkit';\r\nimport { BefRepository, BefRepositoryUtil, BefDataPathUtil } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { CommandService } from '../command-service';\r\nimport { FilterConditionService } from '../filter-condition.service';\r\nimport { DataGridService } from '../data-grid.service';\r\nimport { DataChangeDetectionService } from '../data-change-detection.service';\r\n// tslint:disable: no-string-literal max-line-length\r\n\r\n/**\r\n * åè¡¨ä»åºæå¡\r\n */\r\n@Injectable()\r\nclass ListDataService {\r\n\r\n  /**\r\n   * æé \r\n   * @param msgService msgService\r\n   * @param repository repository\r\n   * @param bindingData bindingData\r\n   * @param loadingService loadingService\r\n   * @param languageService languageService\r\n   * @param formNotifyService formNotifyService\r\n   * @param formErrorService formErrorService\r\n   * ! @param viewModel viewModel,vmæ¯åææ³¨å¥çï¼èè¡¨åè·åä¸å°ï¼ä¸å®è¦åéç©ºå¤æ­\r\n   * @param filterConditionService filterConditionService\r\n   */\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    private repository: Repository<any>,\r\n    private bindingData: BindingData,\r\n    private loadingService: FormLoadingService,\r\n    @Optional() private languageService: LanguageService,\r\n    private formNotifyService: FormNotifyService,\r\n    private formErrorService: FormErrorService,\r\n    private viewModel: ViewModel,\r\n    private filterConditionService: FilterConditionService,\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n\r\n    // if (!filterConditionService) {\r\n    //   this.filterConditionService = new FilterConditionService();\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * å è½½\r\n   */\r\n  public load(filter?: string, sort?: string): Observable<Entity[]> {\r\n\r\n    // åæ°å¤ç\r\n    filter = !filter ? '[]' : filter;\r\n    sort = !sort ? '[]' : sort;\r\n    // åå¹¶è¿æ»¤æ¡ä»¶\r\n    filter = this.mergeFilterConditions(filter);\r\n    // åå¹¶æåºæ¡ä»¶\r\n    sort = this.mergeSortConditions(sort);\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(200);\r\n    const query$ = this.repository.getEntities(JSON.parse(filter), JSON.parse(sort), null, null);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          // è§¦åè¿ç«¯åè®¡äºä»¶\r\n          this.fireQueryEvent(filter);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * è¿æ»¤æ°æ®\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param sort æåºæ¡ä»¶\r\n   */\r\n  public filter(filter?: string, sort?: string): Observable<Entity[]> {\r\n    // åæ°å¤ç\r\n    filter = !filter ? '[]' : filter;\r\n    sort = !sort ? '[]' : sort;\r\n    // åå¹¶è¿æ»¤æ¡ä»¶\r\n    filter = this.mergeFilterConditions(filter);\r\n    // åå¹¶æåºæ¡ä»¶\r\n    sort = this.mergeSortConditions(sort);\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(200);\r\n    const query$ = this.repository.filter(JSON.parse(filter), JSON.parse(sort));\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          // è§¦åè¿ç«¯åè®¡äºä»¶\r\n          this.fireQueryEvent(filter);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢\r\n   */\r\n  public query(filter: string, sort: string, pageSize: number, pageIndex: number): Observable<Entity[]> {\r\n    // åæ°å¤ç\r\n    filter = (filter === '') ? '[]' : filter;\r\n    sort = (sort === '') ? '[]' : sort;\r\n    // åå¹¶è¿æ»¤æ¡ä»¶\r\n    filter = this.mergeFilterConditions(filter);\r\n    // åå¹¶æåºæ¡ä»¶\r\n    sort = this.mergeSortConditions(sort);\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(5);\r\n    const query$ = this.repository.getEntities(JSON.parse(filter), JSON.parse(sort), pageSize, pageIndex);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          // è§¦åè¿ç«¯åè®¡äºä»¶\r\n          this.fireQueryEvent(filter);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.queryFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  public queryChild(filter: string, sort: string) {\r\n    // const isUpdateWithPaging = this.viewModel.frameContext.root.params.get('updateWithPaging') || false;\r\n    // if (isUpdateWithPaging) {\r\n    //   return of(null);\r\n    // }\r\n    // tslint:disable-next-line: max-line-length\r\n    const fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);\r\n    const paths = fullPaths.slice(0, fullPaths.length - 1);\r\n    // debug\r\n    // tslint:disable-next-line: max-line-length\r\n    const bindingPaths = this.viewModel.bindingPath.split('/').filter(item => item);\r\n    const bindingData = this.viewModel.bindingData;\r\n    let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n    nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n    // è·åä¸çº§å®ä½\r\n    const parentPaths = bindingPaths.slice(0, bindingPaths.length - 1);\r\n    const BindingList = bindingData.getValue(parentPaths) as BindingList;\r\n    if (!BindingList) {\r\n      return;\r\n    }\r\n    this.viewModel.frameContext.appContext.params.delete(\"retrieveing\");\r\n    const configPath = `/${nodeCode}`;\r\n    const config = this.repository.entityCollection.getPaginationConfigByPath(configPath);\r\n    if (config) {\r\n      const { pageIndex = 1, pageSize = 0 } = config;\r\n      // pageSize = 0è¡¨ç¤ºæªåé¡µ\r\n      if (pageSize !== 0) {\r\n        this.viewModel.frameContext.appContext.params.set('queryChild', true);\r\n        const request$ = this.repository.queryChild(paths, pageIndex, pageSize);\r\n        return request$.pipe(\r\n          tap(() => { },\r\n            error => {\r\n              this.formErrorService.exception(this.languageService.queryFailed, error);\r\n            }\r\n          )\r\n        );\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * è·ååé¡µä¿¡æ¯\r\n   * @param nodeCode nodeCode\r\n   * @returns åé¡µä¿¡æ¯ï¼åæ¬ï¼åé¡µå¤§å°ãå½åé¡µç \r\n   * @description åºæ¬åé¡µä¿¡æ¯å¨åé¡µä¿¡æ¯ä¸­å­å¨æ¶keyä¸ºnodeCode\r\n   */\r\n  /*private getPagingInfo(nodeCode: string) {\r\n    const result: { pageIndex?: number, pageSize?: number } = {};\r\n    const nodeCodePath = `/${nodeCode}`;\r\n    const defaultPagingInfo = this.repository.entityCollection.getPaginationConfigByPath(nodeCodePath);\r\n    const pageSize = defaultPagingInfo && defaultPagingInfo.pageSize || 0;\r\n    const pageIndex = defaultPagingInfo && defaultPagingInfo.pageIndex || 1;\r\n    result.pageIndex = pageIndex;\r\n    result.pageSize = pageSize;\r\n    return result;\r\n  }*/\r\n  /**\r\n   * è¿½å ä¸æ¡æ°æ°æ®\r\n   */\r\n  public append(): Observable<Entity> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'append' });\r\n    }\r\n    const append$ = this.repository.append();\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.appendFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å½åè¡åæåæå¥æ°æ®\r\n   * @param position 1 | -1\r\n   */\r\n  public insert(position: 1 | -1 = -1) {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'insert' });\r\n    }\r\n    const append$ = this.repository.insert(position);\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.appendFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æäº¤åæ´ï¼æ¹éç¼è¾é¡µé¢ï¼è¡åæ¢æ¶æäº¤å¢éï¼\r\n   */\r\n  public updateChanges(): Observable<boolean> {\r\n    const update$ = this.repository.updateAllChanges();\r\n    return update$;\r\n  }\r\n\r\n  /**\r\n   * æ¹éä¿å­\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   */\r\n  public save(successMsg?: string): Observable<boolean> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'save' });\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const save$ = this.repository.applyChanges();\r\n    const result$ = save$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          if (successMsg && successMsg.trim()) {\r\n            let showMessage: boolean = true;\r\n            if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n              try {\r\n                const options = JSON.parse(successMsg);\r\n                if (options.showMessage === false) {\r\n                  showMessage = false;\r\n                }\r\n              } catch { }\r\n            }\r\n            if (showMessage !== false) {\r\n              this.formNotifyService.success(successMsg, { hideTitle: true });\r\n            }\r\n          } else {\r\n            this.formNotifyService.success(this.languageService.saveSuccess, { hideTitle: true });\r\n          }\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.multiSaveFailed, error);\r\n        }\r\n      )\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * å é¤\r\n   * @param id è¦å é¤çæ°æ®çid\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   * @param confirm æ¯å¦éè¦ç¡®è®¤\r\n   * @param breakable æ¯å¦å¯ä¸­æ­ï¼ifSaveä¸ºfalseæ¶æµä¼ä¸­æ­\r\n   */\r\n  public remove(id: string, ifSave?: boolean | string, successMsg?: string, confirm: boolean | string = true, breakable: boolean | string = true): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'delete' });\r\n    }\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n    confirm = (confirm === false || confirm === 'false') ? false : true;\r\n    breakable = (breakable === false || breakable === 'false') ? false : true;\r\n    const action$ = confirm ? this.msgService.question(this.languageService.confirmDeletion) : of(true);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n        ifSave = (ifSave === false || ifSave === 'false') ? false : true;\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeById(id, ifSave);\r\n        if (!remove$) {\r\n          return empty();\r\n        }\r\n        return remove$.pipe(\r\n          tap(\r\n            () => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              if (successMsg && successMsg.trim()) {\r\n                let showMessage: boolean = true;\r\n                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                  try {\r\n                    const options = JSON.parse(successMsg);\r\n                    if (options.showMessage === false) {\r\n                      showMessage = false;\r\n                    }\r\n                  } catch { }\r\n                }\r\n                if (showMessage !== false) {\r\n                  this.formNotifyService.success(successMsg, { hideTitle: true });\r\n                }\r\n              } else {\r\n                this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n              }\r\n            },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          ),\r\n          switchMap(() => {\r\n            if (ifSave === true || !breakable) {\r\n              // return this.load();\r\n              return of([]);\r\n            } else {\r\n              // æ¹éç¼è¾åè¡¨è¡¨æ ¼å¤äºç¼è¾æåºæ¯æ¶ï¼ä¸ºé²æ­¢æ§è¡åç»­å½ä»¤å¯¼è´æ°æ®éæ°å è½½ï¼æä»¥å¨æ­¤å°å½ä»¤ä¸­æ­äºãä½åæ¶ä¹å¯¼è´äºå é¤æ°æ®åå¾éè®°å½ä¾ç¶å­å¨ãæä»¥å¨è¿ééè¦åç¬è°ç¨ä¸æ¬¡æ¸ç©ºå¾éæ¹æ³ã\r\n              const datagridService = new DataGridService();\r\n              datagridService.context = this['context'];\r\n              datagridService.uncheckDeletedRows([id]);\r\n              return empty();\r\n            }\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¹éå é¤\r\n   * @param ids ids\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   * @param deleteCurrentRowIfNoChecks æ²¡æå¾éæ¶å é¤å½åè¡\r\n   */\r\n  public removeRows(ids: string[], ifSave?: boolean | string, successMsg?: string, deleteCurrentRowIfNoChecks: boolean | string = false): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'removeRows' });\r\n    }\r\n    deleteCurrentRowIfNoChecks = (deleteCurrentRowIfNoChecks === 'true' || deleteCurrentRowIfNoChecks === true) ? true : false;\r\n    if (!ids || ids.length === 0) {\r\n      const currentId = this.bindingData.list.currentId;\r\n      if (deleteCurrentRowIfNoChecks === true && currentId) {\r\n        ids = [this.bindingData.list.currentId];\r\n      } else {\r\n        this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n        return empty();\r\n      }\r\n    }\r\n    const action$ = this.msgService.confirm(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n        if (typeof ifSave === 'undefined') {\r\n          ifSave = true;\r\n        }\r\n        if (typeof ifSave === 'string') {\r\n          ifSave = ifSave.toLowerCase() === 'false' ? false : true;\r\n        }\r\n        ifSave = (ifSave === false) ? false : true;\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeByIds(ids, ifSave);\r\n\r\n        if (!remove$) {\r\n          return empty();\r\n        }\r\n\r\n        return remove$.pipe(\r\n          tap(\r\n            () => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              if (successMsg && successMsg.trim()) {\r\n                let showMessage: boolean = true;\r\n                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                  try {\r\n                    const options = JSON.parse(successMsg);\r\n                    if (options.showMessage === false) {\r\n                      showMessage = false;\r\n                    }\r\n                  } catch { }\r\n                }\r\n                if (showMessage !== false) {\r\n                  this.formNotifyService.success(successMsg, { hideTitle: true });\r\n                }\r\n              } else {\r\n                this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n              }\r\n              // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          ),\r\n          switchMap(() => {\r\n            return of([]);\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * å é¤åçå·æ°\r\n   */\r\n  public refreshAfterRemoving(loadCmdName: string, loadCmdFrameId: string): Observable<any> {\r\n    if (this.viewModel && loadCmdName && loadCmdFrameId) {\r\n      const commandService = this.viewModel.frameContext.injector.get<CommandService>(CommandService, null);\r\n      return commandService.execute(loadCmdName, loadCmdFrameId);\r\n    }\r\n    return this.load();\r\n  }\r\n\r\n  /**\r\n   * å·æ°\r\n   * @param loadCmdName å·æ°å½ä»¤\r\n   * @param loadCmdFrameId å·æ°å½ä»¤æå¨çframeId\r\n   */\r\n  public refresh(loadCmdName: string, loadCmdFrameId: string): Observable<any> {\r\n    if (this.viewModel && loadCmdName && loadCmdFrameId) {\r\n      const commandService = this.viewModel.frameContext.injector.get<CommandService>(CommandService, null);\r\n      return commandService.execute(loadCmdName, loadCmdFrameId);\r\n    }\r\n    return this.load();\r\n  }\r\n  /**\r\n   * åæ¶æ¶æ£æµæªä¿å­è®°å½\r\n   */\r\n  public cancel(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'cancel' });\r\n    }\r\n    const hasChange$ = DataChangeDetectionService.hasChange(this.viewModel.frameContext);\r\n    return hasChange$.pipe(\r\n      switchMap((changed: boolean) => {\r\n        if (!changed) {\r\n          return this._cancel();\r\n        } else {\r\n          return this.msgService.question(this.languageService['cancelWithoutSave']).pipe(\r\n            switchMap((ifCancel: boolean) => {\r\n              if (ifCancel === false) {\r\n                return EMPTY;\r\n              }\r\n              return this._cancel();\r\n            })\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * è¿ååæ´é\r\n   * @description ä¸å¸¦åæ´æ£æµæç¤º\r\n   */\r\n  public revert(): Observable<any> {\r\n    return this._cancel();\r\n  }\r\n  /**\r\n   * åæ¶ï¼åé¨åæ¶ï¼\r\n   */\r\n  private _cancel(): Observable<any> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const cancel$ = this.repository.cancelChanges();\r\n    return cancel$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.cancelFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * è·åæ ¹ç»ä»¶appContext\r\n   */\r\n  private get messagePipe() {\r\n    if (this.viewModel && this.viewModel.frameContext) {\r\n      const appContext = this.viewModel.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * è§¦åæ¥è¯¢äºä»¶\r\n   * @param filters è¿æ»¤æ¡ä»¶\r\n   */\r\n  private fireQueryEvent(filters: any) {\r\n    const messagePipe = this.messagePipe;\r\n    // const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId || null;\r\n    if (messagePipe) {\r\n      messagePipe.next({ type: 'query' });\r\n    }\r\n  }\r\n  /**\r\n   * åå¹¶è¿æ»¤æ¡ä»¶\r\n   * @param filter è¡¨åè¿æ»¤æ¡ä»¶\r\n   */\r\n  private mergeFilterConditions(filter: any) {\r\n    if (typeof filter === 'string') {\r\n      filter = JSON.parse(filter) || [];\r\n    }\r\n    const filters: Array<any> = filter;\r\n    const bindingPath = this.viewModel && this.viewModel.bindingPath || null;\r\n    if (bindingPath) {\r\n      const originalConditions = this.viewModel && this.viewModel.frameContext.repository.filterConditionManager.getFilters(bindingPath) || [];\r\n      // this.filterConditionService.getFilters(bindingPath) || [];\r\n      const conditions = Array.from(originalConditions);\r\n      if (conditions && conditions.length > 0) {\r\n        /* filters.forEach((item: any, index: number) => {\r\n          const field = item.FilterField || null;\r\n          if (field) {\r\n            const duplicateIndex = conditions.findIndex(condition => condition.FilterField === field);\r\n            if (duplicateIndex !== -1) {\r\n              filters[index] = conditions[duplicateIndex];\r\n              conditions.splice(duplicateIndex, 1);\r\n            }\r\n          }\r\n        });*/\r\n        // ä¿®æ¹å½ä»¤ä¸è¿æ»¤æ¡ä»¶çæåä¸ä¸ªæ¥è¯¢å³ç³»ä¸ºand\r\n        if (filters.length > 0) {\r\n          // æåä¸ä¸ªè¿æ»¤æ¡ä»¶\r\n          const lastFilter = filters[filters.length - 1];\r\n          if (lastFilter) {\r\n            if (lastFilter.hasOwnProperty('Relation')) {\r\n              delete lastFilter.Relation;\r\n            }\r\n            lastFilter.relation = 1;\r\n          }\r\n        }\r\n        // åå¹¶æ°çè¿æ»¤æ¡ä»¶ååæ¥å½ä»¤ä¸çè¿æ»¤æ¡ä»¶\r\n        filters.push(...conditions);\r\n      }\r\n    }\r\n\r\n    return JSON.stringify(filters);\r\n  }\r\n  /**\r\n   * åå¹¶æåºæ¡ä»¶\r\n   * @param sort æåºæ¡ä»¶\r\n   */\r\n  private mergeSortConditions(sort: any) {\r\n    if (typeof sort === 'string') {\r\n      sort = JSON.parse(sort) || [];\r\n    }\r\n    const sorts: Array<any> = sort;\r\n    const bindingPath = this.viewModel && this.viewModel.bindingPath || null;\r\n    if (bindingPath) {\r\n      // è·åå½åç»å®è·¯å¾çæææåºæ¡ä»¶\r\n      const originalConditions = this.viewModel && this.viewModel.frameContext.repository.sortConditionManager.getConditionsByBindingPath(bindingPath, (direction) => {\r\n        if (direction === 'asc') {\r\n          return 0;\r\n        } else { return 1; }\r\n      }) || [];\r\n      const conditions = Array.from(originalConditions);\r\n      // å¦æå½åç»å®è·¯å¾ææåºæ¡ä»¶ï¼åå¿½ç¥å½ä»¤ä¸é¢å¶çæåºæ¡ä»¶\r\n      if (conditions && conditions.length > 0) {\r\n        // éåå·²æçè¿æ»¤æ¡ä»¶ï¼å¦ææéå¤çfieldï¼ç¨åèçè¦çå·²æç\r\n        /* sorts.forEach((item: any, index: number) => {\r\n          const field = item.SortField || null;\r\n          if (field) {\r\n            const duplicateIndex = conditions.findIndex(condition => condition.SortField === field);\r\n            if (duplicateIndex !== -1) {\r\n              sorts[index] = conditions[duplicateIndex];\r\n              conditions.splice(duplicateIndex, 1);\r\n            }\r\n          }\r\n        });*/\r\n        return JSON.stringify(conditions);\r\n        // å°å¶ä½æåºæ¡ä»¶æ·»å å°æåºæ°ç»\r\n        // sorts.push(...conditions);\r\n      }\r\n    }\r\n    return JSON.stringify(sorts);\r\n  }\r\n}\r\nexport { ListDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, empty, of, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\nimport { BindingList, Repository, ViewModel } from '@farris/devkit';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\n\r\n/**\r\n * å­åè¡¨åæ°æå¡\r\n */\r\n@Injectable()\r\nclass SubListDataService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    private repository: Repository<any>,\r\n    private loadingService: FormLoadingService,\r\n    private viewModel: ViewModel,\r\n    @Optional() private languageService: LanguageService,\r\n    private formNotifyService: FormNotifyService,\r\n    private formErrorService: FormErrorService\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    this.viewModel = viewModel;\r\n  }\r\n\r\n  /**\r\n   * æ°å¢\r\n   */\r\n  add(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'add' });\r\n    }\r\n    const path = this.getPath();\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const append$ = this.repository.appendByPath(path);\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.addFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å¨æå®ä½ç½®æå¥\r\n   * @param position ä½ç½®\r\n   */\r\n  public insert(position: 1 | -1 = -1) {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'insert' });\r\n    }\r\n    const path = this.getPath();\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const append$ = this.repository.insertByPath(path, position);\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.addFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å é¤å­è¡¨æ°æ®\r\n   */\r\n  remove(id: string, successMsg?: string): Observable<any> {\r\n    const msg = successMsg ? successMsg : '';\r\n    return this.innerRemove(id, false, msg);\r\n  }\r\n\r\n  /**\r\n   * å é¤å­è¡¨æ°æ®ï¼ä¸ç¡®è®¤ï¼\r\n   */\r\n  removeWithoutConfirm(id: string): Observable<any> {\r\n    return this.innerRemove(id, true, '');\r\n  }\r\n\r\n  /**\r\n   * æ¹éå é¤å­è¡¨\r\n   * @param ids ids\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   */\r\n  removeChildrenByIds(ids: string, successMsg?: string): Observable<any> {\r\n    if (!ids) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const action$ = this.msgService.confirm(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return EMPTY;\r\n        }\r\n        const path = this.getPath();\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.batchRemoveByPath(path, ids);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * å é¤\r\n   */\r\n  innerRemove(id: string, isConfirm: boolean, successMsg: string): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'remove' });\r\n    }\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    let action$: Observable<boolean>;\r\n    if (isConfirm === false) {\r\n      action$ = this.msgService.question(this.languageService.confirmDeletion);\r\n    } else {\r\n      action$ = of(true);\r\n    }\r\n\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n        const path = this.getPath();\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeByPath(path, id);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * å é¤å¹¶ä¿å­\r\n   * @param id id\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   */\r\n  removeAndSave(id: string, successMsg?: string): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'removeAndSave' });\r\n    }\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectDeleteData, { hideTitle: true });\r\n      return empty();\r\n    }\r\n    const action$ = this.msgService.confirm(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n\r\n        // å é¤å­è¡¨æ°æ®\r\n        const path = this.getPath();\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeByPath(path, id);\r\n\r\n        return remove$.pipe(\r\n\r\n          // æ§è¡ä¸»è¡¨ä¿å­\r\n          switchMap(() => {\r\n            const fid = this.viewModel.bindingData.list.currentId as string;\r\n            return this.repository.applyChangesById(fid);\r\n          }),\r\n\r\n          // éèå è½½ä¸­\r\n          tap(() => {\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            })\r\n        );\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * ä¸ç§»æä¸ç§»æ°æ®\r\n   * @param direction æ¹åï¼up | down\r\n   * @param field æåºå­æ®µ\r\n   * @param targets è¦ç§»å¨çæ°æ®\r\n   * @description\r\n   * ä½¿ç¨è¯¥æ¹æ³æ¶æåºå­æ®µå¿é¡»æå¼ï¼å¦åæ æ³æåº\r\n   */\r\n  public move(direction: string | 'up' | 'down', field: string, targets: Array<any> | string) {\r\n    if (!targets) {\r\n      return;\r\n    }\r\n    if (typeof targets === 'string') {\r\n      targets = targets.split(',').filter(p => p);\r\n    }\r\n    const bindingPath = this.viewModel && this.viewModel.bindingPath || null;\r\n    if (!bindingPath) {\r\n      return;\r\n    }\r\n    const bindingList = this.viewModel.bindingData.getList() as BindingList;\r\n    if (!bindingList || bindingList.length < 1) {\r\n      return;\r\n    }\r\n    targets.forEach((target) => {\r\n      const index = bindingList.getIndexById(target);\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n      const item = bindingList.findById(target);\r\n      const position = item.getValue(field);\r\n      const base = direction === 'up' ? -1 : 1;\r\n      // å¾äº¤æ¢çè¡ä¿¡æ¯\r\n      const exchangeRowIndex = index + base;\r\n      if (exchangeRowIndex < 0 || exchangeRowIndex > bindingList.length) {\r\n        // ç¬¬ä¸è¡æ æ³ä¸ç§»ï¼æåä¸è¡æ æ³ä¸ç§»\r\n        return;\r\n      }\r\n      const exchangeRowId = bindingList.getIdByIndex(exchangeRowIndex);\r\n      const exchangeRow = bindingList.findById(exchangeRowId);\r\n      const exchangeRowPosition = exchangeRow[field];\r\n      // ç§»å¨è¡åäº¤æ¢è¡é½æ²¡ææåº\r\n      if (this.isNullOrEmpty(position) && this.isNullOrEmpty(exchangeRowPosition)) {\r\n        return;\r\n      }\r\n      bindingList.swapById(target, exchangeRowId);\r\n      exchangeRow.setValue(field, position, true, true);\r\n      item.setValue(field, exchangeRowPosition, true, true);\r\n    });\r\n\r\n  }\r\n  private isNullOrEmpty(value: any) {\r\n    return value === '' || value === null || value === undefined;\r\n  }\r\n  /**\r\n   * è·åå®æ´è·¯å¾\r\n   * @todoï¼å¼ºè¯å«å°ä»è¡¨è¿ä¸çº§\r\n   * fixed by justin: æ ¹æ®bindingPathï¼å¦ææ¯ä»ä»è¡¨ï¼éè¦è·åä¸»è¡¨æ°æ®idåä»è¡¨æ°æ®id\r\n   */\r\n  private getPath(): string {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const rid = this.viewModel.bindingData.list.currentId; // rootè¡¨æ°æ®id\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = this.viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          this.formNotifyService.warning(this.languageService['plsSelectDetailFormData'], { hideTitle: true });\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n  /**\r\n   * è·åæ ¹ç»ä»¶appContext\r\n   */\r\n  private get messagePipe() {\r\n    if (this.viewModel && this.viewModel.frameContext) {\r\n      const appContext = this.viewModel.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\nexport { SubListDataService };\r\n","\r\nimport { Entity, FrameContext, BindingData } from '@farris/devkit';\r\nimport { BefRepository, BefRestService } from '@farris/bef';\r\n\r\n/**\r\n * åºç¡æ°æ®æå¡\r\n */\r\nclass BaseDataService {\r\n\r\n  /**\r\n   * æ¡æ¶ä¸ä¸æ\r\n   */\r\n  protected frameContext: FrameContext;\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  protected get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * Restæå¡\r\n   */\r\n  protected get restService(): BefRestService {\r\n    return this.repository.restService;\r\n  }\r\n\r\n  /**\r\n   * æ°æ®ç»å®\r\n   */\r\n  protected get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(frameContext: FrameContext) {\r\n    this.frameContext = frameContext;\r\n  }\r\n\r\n}\r\n\r\nexport { BaseDataService };\r\n","import { BindingData, BindingList } from '@farris/devkit';\r\n\r\n/**\r\n * æ æ°æ®çå¸®å©ç±»\r\n */\r\nclass ParentTreeNodeUtil {\r\n\r\n  /**\r\n   * éä¸­ç¬¬ä¸ä¸ªæ ¹èç¹\r\n   */\r\n  public selectFirstRootNode(bindingData: BindingData, hierarchyInfoKey: string): string {\r\n\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    const firstRootNodeId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    this.selectedNode(bindingData, hierarchyInfoKey, firstRootNodeId);\r\n    return firstRootNodeId;\r\n  }\r\n  public selectNodeByBindingList(bindingList: BindingList, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingList.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n    setTimeout(() => {\r\n      bindingList.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n  /**\r\n   * éä¸­èç¹\r\n   */\r\n  public selectedNode(bindingData: BindingData, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n    if (bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    setTimeout(() => {\r\n      bindingData.list.currentId = null;\r\n      bindingData.list.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦æå­èç¹\r\n   */\r\n  public hasChildNodes(treeNodesData: any[], hierarchyInfoKey: string, fid: string): boolean {\r\n    const fNodeData = this.getNodeDataById(treeNodesData, fid);\r\n    // const fLayer = fNodeData[hierarchyInfoKey]['layer'];\r\n    const fIsDetail = fNodeData[hierarchyInfoKey]['isDetail'];\r\n\r\n    // éæç»èç¹ï¼è¿åtrue\r\n    if (fIsDetail === false) {\r\n      return true;\r\n    }\r\n    return false;\r\n\r\n    // const childNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fid);\r\n    // return childNodesData.length > 0;\r\n  }\r\n\r\n  /**\r\n   * è·åæ ¹èç¹ï¼å¤ä¸ªæ ¹èç¹æ¶è·åç¬¬ä¸ä¸ªï¼\r\n   * @return æ¾ä¸å°æ¶è¿ånull\r\n   */\r\n  private getFirstNodeId(treeNodesData: any[], hierarchyInfoKey: string): string {\r\n    let rootData = treeNodesData.find((itemData: any) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      return layer === 1;\r\n    });\r\n    if (!rootData) {\r\n      const rootLayer = this.getRootLayer(treeNodesData, hierarchyInfoKey);\r\n      rootData = treeNodesData.find((itemData: any) => {\r\n        const layer = itemData[hierarchyInfoKey]['layer'];\r\n        return layer === rootLayer;\r\n      });\r\n    }\r\n    return rootData ? rootData['id'] : '';\r\n  }\r\n  private getRootLayer(treeNodesData: any[], hierarchyInfoKey: string) {\r\n    let layer = null;\r\n    if (treeNodesData && Array.isArray(treeNodesData)) {\r\n      const layers = treeNodesData.map(item => {\r\n        const layer = item[hierarchyInfoKey]['layer'];\r\n        return layer;\r\n      });\r\n      const minLayer = Math.min.apply(Math, layers);\r\n      if (!isNaN(minLayer)) {\r\n        layer = minLayer;\r\n      }\r\n    }\r\n    return layer;\r\n  }\r\n  /**\r\n   * è·åä¸ä¸ä¸ªèç¹ï¼å é¤åï¼\r\n   */\r\n  public getNextNodeId(treeNodesData: any[], hierarchyInfoKey: string, currentId: string): string {\r\n\r\n    // å½åèç¹ä¿¡æ¯\r\n    const currentNodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n    const currentLayer = currentNodeData[hierarchyInfoKey]['layer'];\r\n\r\n    // ç¶èç¹ä¿¡æ¯\r\n    const fLayer = currentLayer - 1;\r\n    const fParentElement = currentNodeData[hierarchyInfoKey]['parentElement'];\r\n\r\n    // æ¥æ¾åå¼èç¹\r\n    const siblingtreeNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fParentElement);\r\n\r\n    // å¦ææ²¡æåå¼èç¹ï¼åä¸æ¥æ¾\r\n    if (siblingtreeNodesData.length === 1) {\r\n      const parentData = treeNodesData.find((itemData: any) => {\r\n        return itemData['id'] === fParentElement;\r\n      });\r\n\r\n      // å­å¨ç¶èç¹ï¼åè®¾ç½®ç¶èç¹ï¼\r\n      // ä¸å­å¨ç¶èç¹ï¼åè®¾ç½®ç¬¬ä¸ä¸ªæ ¹èç¹ã\r\n      if (!parentData) {\r\n        return this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n      }\r\n      return parentData['id'];\r\n    } else {\r\n      return this.getNextSiblingNodeId(siblingtreeNodesData, currentId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åä¸ä¸ªåå¼èç¹çid\r\n   */\r\n  public getNextSiblingNodeId(siblingtreeNodesData: any[], currentId: string): string {\r\n    if (siblingtreeNodesData.length <= 1) {\r\n      return '';\r\n    }\r\n\r\n    const currentIndex = siblingtreeNodesData.findIndex((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n\r\n    // æåä¸è¡ä¸ç§»ä¸è¡ï¼å¶ä»ä¸ç§»ä¸è¡\r\n    let nextIndex = -1;\r\n    if (currentIndex === siblingtreeNodesData.length - 1) {\r\n      nextIndex = currentIndex - 1;\r\n    } else {\r\n      nextIndex = currentIndex + 1;\r\n    }\r\n\r\n    return siblingtreeNodesData[nextIndex]['id'];\r\n  }\r\n\r\n  /**\r\n   * è·åä¸çº§èç¹çBindingObjectséå\r\n   */\r\n  public getChildNodesData(treeNodesData: any[], hierarchyInfoKey: string, fLayer: number, fParentElement: string): any[] {\r\n    const childtreeNodesData = treeNodesData.filter((itemData) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      const parentElement = itemData[hierarchyInfoKey]['parentElement'];\r\n      return (layer === fLayer + 1) && fParentElement == parentElement;\r\n    });\r\n    return childtreeNodesData;\r\n  }\r\n\r\n  /**\r\n   * è·åidè·åèç¹æ°æ®\r\n   */\r\n  public getNodeDataById(treeNodesData: any[], id: string): any {\r\n    const nodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === id;\r\n    });\r\n    return nodeData ? nodeData : null;\r\n  }\r\n}\r\n\r\nexport { ParentTreeNodeUtil };\r\n","import { BindingData, BindingList } from '@farris/devkit';\r\n\r\n/**\r\n * æ æ°æ®çå¸®å©ç±»\r\n */\r\nclass PathTreeNodeUtil {\r\n\r\n  /**\r\n   * éä¸­ç¬¬ä¸ä¸ªæ ¹èç¹\r\n   */\r\n  public selectFirstRootNode(bindingData: BindingData, hierarchyInfoKey: string): string {\r\n\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    const firstRootNodeId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    this.selectedNode(bindingData, hierarchyInfoKey, firstRootNodeId);\r\n    return firstRootNodeId;\r\n  }\r\n  public selectNodeByBindingList(bindingList: BindingList, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingList.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      bindingList.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n  /**\r\n   * éä¸­èç¹\r\n   */\r\n  public selectedNode(bindingData: BindingData, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n    if (bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    setTimeout(() => {\r\n      bindingData.list.currentId = null;\r\n      bindingData.list.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦æå­èç¹\r\n   */\r\n  public hasChildNodes(treeNodesData: any[], hierarchyInfoKey: string, fid: string): boolean {\r\n    const fNodeData = this.getNodeDataById(treeNodesData, fid);\r\n    // const fLayer = fNodeData[hierarchyInfoKey]['layer'];\r\n    // const fPath  = fNodeData[hierarchyInfoKey]['path'];\r\n    const fIsDetail = fNodeData[hierarchyInfoKey]['isDetail'];\r\n\r\n    // éæç»èç¹ï¼è¿åtrue\r\n    if (fIsDetail === false) {\r\n      return true;\r\n    }\r\n    return false;\r\n    // const childNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fPath);\r\n    // return childNodesData.length > 0;\r\n  }\r\n\r\n  /**\r\n   * è·åæ ¹èç¹ï¼å¤ä¸ªæ ¹èç¹æ¶è·åç¬¬ä¸ä¸ªï¼\r\n   * @return æ¾ä¸å°æ¶è¿ånull\r\n   */\r\n  private getFirstNodeId(treeNodesData: any[], hierarchyInfoKey: string): string {\r\n    let rootData = treeNodesData.find((itemData: any) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      return layer === 1;\r\n    });\r\n    if (!rootData) {\r\n      const rootLayer = this.getRootLayer(treeNodesData, hierarchyInfoKey);\r\n      rootData = treeNodesData.find((itemData: any) => {\r\n        const layer = itemData[hierarchyInfoKey]['layer'];\r\n        return layer === rootLayer;\r\n      });\r\n    }\r\n    return rootData ? rootData['id'] : '';\r\n  }\r\n  private getRootLayer(treeNodesData: any[], hierarchyInfoKey: string) {\r\n    let layer = null;\r\n    if (treeNodesData && Array.isArray(treeNodesData)) {\r\n      const layers = treeNodesData.map(item => {\r\n        const layer = item[hierarchyInfoKey]['layer'];\r\n        return layer;\r\n      });\r\n      const minLayer = Math.min.apply(Math, layers);\r\n      if (!isNaN(minLayer)) {\r\n        layer = minLayer;\r\n      }\r\n    }\r\n    return layer;\r\n  }\r\n  /**\r\n   * è·åä¸ä¸ä¸ªèç¹ï¼å é¤åï¼\r\n   */\r\n  public getNextNodeId(treeNodesData: any[], hierarchyInfoKey: string, currentId: string): string {\r\n\r\n    // å½åèç¹ä¿¡æ¯\r\n    const currentNodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n    const currentPath = currentNodeData[hierarchyInfoKey]['path'];\r\n    const currentLayer = currentNodeData[hierarchyInfoKey]['layer'];\r\n\r\n    // ç¶èç¹ä¿¡æ¯\r\n    const fLayer = currentLayer - 1;\r\n    const fPath = currentPath.substring(0, currentPath.length - 4);\r\n\r\n    // æ¥æ¾åå¼èç¹\r\n    const siblingtreeNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fPath);\r\n\r\n    // å¦ææ²¡æåå¼èç¹ï¼åä¸æ¥æ¾\r\n    if (siblingtreeNodesData.length === 1) {\r\n      const parentData = treeNodesData.find((itemData: any) => {\r\n        return itemData[hierarchyInfoKey]['path'] === fPath;\r\n      });\r\n\r\n      // å­å¨ç¶èç¹ï¼åè®¾ç½®ç¶èç¹ï¼\r\n      // ä¸å­å¨ç¶èç¹ï¼åè®¾ç½®ç¬¬ä¸ä¸ªæ ¹èç¹ã\r\n      if (!parentData) {\r\n        return this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n      }\r\n      return parentData['id'];\r\n    } else {\r\n      return this.getNextSiblingNodeId(siblingtreeNodesData, currentId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åä¸ä¸ªåå¼èç¹çid\r\n   */\r\n  public getNextSiblingNodeId(siblingtreeNodesData: any[], currentId: string): string {\r\n    if (siblingtreeNodesData.length <= 1) {\r\n      return '';\r\n    }\r\n\r\n    const currentIndex = siblingtreeNodesData.findIndex((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n\r\n    // æåä¸è¡ä¸ç§»ä¸è¡ï¼å¶ä»ä¸ç§»ä¸è¡\r\n    let nextIndex = -1;\r\n    if (currentIndex === siblingtreeNodesData.length - 1) {\r\n      nextIndex = currentIndex - 1;\r\n    } else {\r\n      nextIndex = currentIndex + 1;\r\n    }\r\n\r\n    return siblingtreeNodesData[nextIndex]['id'];\r\n  }\r\n\r\n  /**\r\n   * è·åä¸çº§èç¹çBindingObjectséå\r\n   */\r\n  public getChildNodesData(treeNodesData: any[], hierarchyInfoKey: string, fLayer: number, fPath: string): any[] {\r\n    const childtreeNodesData = treeNodesData.filter((itemData) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      const path = itemData[hierarchyInfoKey]['path'];\r\n      return (layer === fLayer + 1) && path.startsWith(fPath);\r\n    });\r\n    return childtreeNodesData;\r\n  }\r\n\r\n  /**\r\n   * è·åidè·åèç¹æ°æ®\r\n   */\r\n  public getNodeDataById(treeNodesData: any[], id: string): any {\r\n    const nodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === id;\r\n    });\r\n    return nodeData ? nodeData : null;\r\n  }\r\n}\r\n\r\nexport { PathTreeNodeUtil };\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-30 14:12:39 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-05-30 16:18:47\r\n */\r\nimport { ParentTreeNodeUtil } from './parent-tree.util';\r\nimport { PathTreeNodeUtil } from './path-tree.util';\r\n\r\nexport class TreeUtilFactory {\r\n  static getInstance(treeType: string) {\r\n    let util = null;\r\n    switch (treeType) {\r\n      case 'path':\r\n        util = new PathTreeNodeUtil();\r\n        break;\r\n      case 'parent':\r\n        util = new ParentTreeNodeUtil();\r\n        break;\r\n      default: break;\r\n    }\r\n    return util;\r\n  }\r\n}","import { HttpHeaders } from '@angular/common/http';\r\nimport { of, Observable } from 'rxjs';\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { Entity, FieldMetadataUtil, FrameContext, Repository } from '@farris/devkit';\r\nimport { ResponseInfo, BefRepository } from '@farris/bef';\r\n\r\n/**\r\n * ç¶å­æ ä»åº\r\n */\r\nclass ParentTreeRepository {\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addSibling(repository: BefRepository<Entity>, id: string): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSiblingUri = `${baseUri}/service/parenthierarchycreatesibling`;\r\n    const body = {\r\n      dataID: id,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addChild(repository: BefRepository<Entity>, parentId: string) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addChildUri = `${baseUri}/service/parenthierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      dataID: parentId,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å å­è¡¨åå¼èç¹\r\n   */\r\n  public addSubSibling(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubSiblingUri = `${baseUri}/service/childnodeparenthierarchycreatesibling`;\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let path = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(path, responseInfo.returnValue)\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å å­è¡¨å­èç¹\r\n   */\r\n  public addSubChild(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubChildUri = `${baseUri}/service/childnodeparenthierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let paths = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(paths, responseInfo.returnValue);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getPaths(nodes: string[], ids: string[]) {\r\n    let paths = '';\r\n    if (nodes && nodes.length > 0 && ids && ids.length > 0) {\r\n      for (let i = 0; i < ids.length; i++) {\r\n        if (nodes[i]) {\r\n          paths = paths + `/${ids[i]}`;\r\n          paths = paths + `/${nodes[i]}s`;\r\n        }\r\n      }\r\n    }\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * å è½½ç¶èç¹\r\n   */\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadByParentId(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, filters: any[], sorts: any[], frozenCurrentRow: boolean = false, pagination?: { pageSize: number, pageIndex: number }, frameContext?: FrameContext, reload: boolean = false): Observable<Entity[]> {\r\n    const localEntities = this.getChildren(repository, hierarchyInfoKey, parentId);\r\n    if (localEntities && localEntities.length > 0 && !reload) {\r\n      return of(localEntities);\r\n    }\r\n    const restService = repository.restService;\r\n    const parentHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const originalHierarchyInfoKey = this.getOriginalHierarchyInfoKey(repository, hierarchyInfoKey);\r\n    const filtersWithParent = this.buildFiltersWithParent(originalHierarchyInfoKey, parentHierarchyInfo, filters);\r\n    const isUsePagination = pagination && pagination.pageSize > 0 || false;\r\n    // ç»ç»EntityFilter\r\n    const entityFilter = {\r\n      FilterConditions: filtersWithParent,\r\n      SortConditions: sorts,\r\n      IsUsePagination: isUsePagination,\r\n      Pagination: { PageIndex: pagination && pagination.pageIndex || 0, PageSize: pagination && pagination.pageSize || 0, PageCount: 0, TotalCount: 0 }\r\n    };\r\n    const requestInfo = restService.buildRequestInfo();\r\n    return restService.extendQuery(entityFilter, requestInfo).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const paginationInfo = this.getPaginationInfo(responseInfo);\r\n        if (parentId) {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.params.set(`_NODE_${parentId}_PAGINATION_INFO_`, paginationInfo);\r\n          }\r\n        } else {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);\r\n          }\r\n        }\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, parentHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, { isTreeNodeLoadScene: true });\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, { isTreeNodeLoadScene: true });\r\n        }\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadFullTree(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, propertyName: string, fullTreeType: string, loadType: string, filters?: any[], context?: any): Observable<Entity[]> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const queryUrl = `${baseUri}/service/parentidfulltreequery`;\r\n    const parentHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const entityFilter = this.buildEntityFilter(filters, null, 0, 0);\r\n\r\n    const body = {\r\n      dataId: parentId || '',\r\n      isUsePagination: false,\r\n      virtualPropertyName: propertyName,\r\n      pagination: {},\r\n      fullTreeType,\r\n      loadType,\r\n      filter: entityFilter,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(queryUrl, 'PUT', null, options).pipe(\r\n      tap((responseInfo: ResponseInfo) => {\r\n        // ä¿å­å±å¼çèç¹\r\n        if (responseInfo.returnValue && responseInfo.returnValue.selectedRowId && context && context.frameContext) {\r\n          const frameContext = context.frameContext as FrameContext;\r\n          const virtualRootFrameContext = frameContext && frameContext.getVirtualRootFrameContext() || null;\r\n          if (virtualRootFrameContext) {\r\n            const list = responseInfo.returnValue.result as any[];\r\n            const selectedRowId = responseInfo.returnValue.selectedRowId;\r\n            // ä»é¡¶å±å¼å§è®¡ç®ææéè¦å±å¼çèç¹\r\n            const leafNodeInfo = list.find(item => item[repository.primaryKey] === selectedRowId);\r\n            const hierarchyInfo = leafNodeInfo[hierarchyInfoKey] as { isDetail: boolean, layer: number, parentElement: string };\r\n            const ids = this.getAllParentIds(hierarchyInfo, list, hierarchyInfoKey, repository);\r\n            virtualRootFrameContext.params.set('_DEVKIT_expandRowIds', ids.join(','));\r\n            virtualRootFrameContext.params.set('_DEVKIT_selectedRowId', selectedRowId);\r\n            virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', selectedRowId);\r\n          }\r\n        }\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const frozenCurrentRow = context && context.frozenCurrentRow || false;\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, parentHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, { isTreeNodeLoadScene: true });\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, { isTreeNodeLoadScene: true });\r\n        }\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æå¥å¯¹ç¶èç¹çè¿æ»¤\r\n   */\r\n  public buildFiltersWithParent(originalHierarchyInfoKey: string, parentHierarchyInfo: any, filterArray: any[]): any {\r\n    const relationType = filterArray && filterArray.length >= 1 ? 1 : 0;\r\n    const parentLayer = parentHierarchyInfo ? parentHierarchyInfo['layer'] : 0;\r\n    const parentElement = parentHierarchyInfo ? parentHierarchyInfo['id'] : '';\r\n\r\n    const parentFilterArray = [\r\n      {\r\n        \"FilterField\": `${originalHierarchyInfoKey}.Layer`,\r\n        \"Value\": parentLayer + 1,\r\n        \"Lbracket\": null,\r\n        \"Rbracket\": null,\r\n        \"Relation\": 1,\r\n        \"Expresstype\": 0,\r\n        \"Compare\": 0\r\n      }\r\n    ];\r\n    if (parentElement) {\r\n      parentFilterArray.push(\r\n        {\r\n          \"FilterField\": `${originalHierarchyInfoKey}.ParentElement`,\r\n          \"Value\": parentElement,\r\n          \"Lbracket\": null,\r\n          \"Rbracket\": null,\r\n          \"Relation\": relationType,\r\n          \"Expresstype\": 0,\r\n          \"Compare\": 0\r\n        }\r\n      );\r\n    } else {\r\n      parentFilterArray[0].Relation = relationType;\r\n    }\r\n    return parentFilterArray.concat(filterArray);\r\n  }\r\n  public buildEntityFilter(filter: any[], sort: any[], pageSize: number, pageIndex: number) {\r\n\r\n    // @todoï¼ä¸´æ¶å¼å®¹èä»£ç ï¼éä½æ¹å¨å¸¦æ¥çé£é©\r\n    if (!filter && !sort && !pageSize && !pageIndex) {\r\n      return null;\r\n    }\r\n    if (!filter) {\r\n      filter = [];\r\n    }\r\n    if (!sort) {\r\n      sort = [];\r\n    }\r\n    // çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n    if (filter && filter.length > 0) {\r\n      filter[filter.length - 1].Relation = 0;\r\n    }\r\n    const entityFilter = {\r\n      FilterConditions: filter,\r\n      SortConditions: sort,\r\n      IsUsePagination: pageSize === 0 ? false : true,\r\n      Pagination: {\r\n        PageIndex: pageIndex,\r\n        PageSize: pageSize,\r\n        PageCount: 0,\r\n        TotalCount: 0\r\n      }\r\n    };\r\n    return entityFilter;\r\n  }\r\n  /**\r\n   * æ¸ç©ºåä»£å®ä½\r\n   * @description parentHierarchyInfoä¸­layerä¸ºè¦æ¸ç©ºåä»£èç¹çlayerï¼ä½éé¢çparentElementä¸æ¯ç¶çº§çidï¼èæ¯è¦æ¸ç©ºåä»£èç¹çid\r\n   */\r\n  public clearDescendantEntities(repository: BefRepository<Entity>, hierarchyInfokey: string, parentHierarchyInfo: any, frozenCurrentRow: boolean = false): void {\r\n    // æ¸ç©ºæ ¹èç¹\r\n    if (!parentHierarchyInfo) {\r\n      repository.entityCollection.clear();\r\n      return;\r\n    }\r\n    const nodes = this.getChildNodes(repository, hierarchyInfokey, parentHierarchyInfo);\r\n    if (frozenCurrentRow) {\r\n      repository.entityCollection.removeEntities((entity: Entity) => {\r\n        const id = entity[entity.primaryKey];\r\n        return nodes.includes(id);\r\n      });\r\n    } else {\r\n      repository.entityCollection.removeData((entity: Entity) => {\r\n        const id = entity[entity.primaryKey];\r\n        return nodes.includes(id);\r\n      });\r\n    }\r\n\r\n  }\r\n  /**\r\n   * è·åæä¸ªèç¹çææå­èç¹\r\n   * @param repository repository\r\n   * @param hierarchyInfokey hierarchyInfokey\r\n   * @param parentHierarchyInfo parentHierarchyInfo\r\n   */\r\n  private getChildNodes(repository: BefRepository<Entity>, hierarchyInfokey: string, parentHierarchyInfo: any) {\r\n    const fparentElement = parentHierarchyInfo.id;\r\n    const flayer = parentHierarchyInfo.layer;\r\n    let nodes = [];\r\n    repository.entityCollection.getAllEntities().forEach(entity => {\r\n      const hierarchyInfo = entity[hierarchyInfokey];\r\n      const parentElement = hierarchyInfo.parentElement;\r\n      const layer = hierarchyInfo.layer;\r\n      const result = layer >= (flayer + 1) && parentElement === fparentElement;\r\n      if (result) {\r\n        const id = entity[entity.primaryKey];\r\n        nodes.push(id);\r\n        const childHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfokey, id);\r\n        const childs = this.getChildNodes(repository, hierarchyInfokey, childHierarchyInfo);\r\n        if (childs && childs.length > 0) {\r\n          nodes = nodes.concat(childs);\r\n        }\r\n      }\r\n    });\r\n    return nodes;\r\n  }\r\n  /**\r\n   * è·åå®ä½çåçº§ä¿¡æ¯\r\n   */\r\n  public getHierarchyInfoById(repository: BefRepository<Entity>, hierarchyInfokey: string, id: string): any {\r\n    if (!id) {\r\n      return null;\r\n    }\r\n    const entity: Entity = repository.entityCollection.getEntityById(id);\r\n    const hierarchyInfoEntity: Entity = entity[hierarchyInfokey];\r\n    const result = hierarchyInfoEntity.toJSON();\r\n    result['id'] = id;\r\n    return result;\r\n  }\r\n  public getHierarchyInfo(entity: Entity, hierarchyInfokey: string): { parentElement: string, layer: number, isDetail: boolean } {\r\n    return entity[hierarchyInfokey];\r\n  }\r\n  /**\r\n   * è·ååçº§ç çåå§çå­æ®µå\r\n   */\r\n  public getOriginalHierarchyInfoKey(repository: BefRepository<Entity>, hierarchyInfokey: string): string {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(repository.entityType);\r\n    const hierarchyInfoNgObject = ngObjects[hierarchyInfokey];\r\n    return hierarchyInfoNgObject.originalDataField as string;\r\n  }\r\n  private getPaginationInfo(responseInfo: ResponseInfo) {\r\n    return responseInfo && responseInfo.returnValue && responseInfo.returnValue.pagination || null;\r\n  }\r\n  private findParent(hierarchyInfo: { isDetail: boolean, layer: number, parentElement: string }, list: any[], hierarchyInfoKey: string) {\r\n    return list.find(item => {\r\n      const currentHierarchyInfo = item[hierarchyInfoKey] as { isDetail: boolean, layer: number, parentElement: string };\r\n      return currentHierarchyInfo.layer === hierarchyInfo.layer - 1 && hierarchyInfo.parentElement === currentHierarchyInfo.parentElement;\r\n    });\r\n  }\r\n  private getAllParentIds(hierarchyInfo: { isDetail: boolean, layer: number, parentElement: string }, list: any[], hierarchyInfoKey: string, repository: Repository<any>) {\r\n    let item = this.findParent(hierarchyInfo, list, hierarchyInfoKey);\r\n    const ids = [];\r\n    while (item) {\r\n      ids.push(item[repository.primaryKey]);\r\n      item = this.findParent(item[hierarchyInfoKey], list, hierarchyInfoKey);\r\n    }\r\n    return ids;\r\n  }\r\n  /**\r\n   * æ¥æ¾èç¹ä¸ææå­çº§ï¼ç¬¬ä¸çº§ï¼\r\n   * @param repository repository\r\n   * @param hierarchyInfoKey åçº§ç å­æ®µ\r\n   * @param id id\r\n   * @returns \r\n   */\r\n  private getChildren(repository: BefRepository<Entity>, hierarchyInfoKey: string, id: string): Entity[] {\r\n    const hierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, id);\r\n    if (!hierarchyInfo) {\r\n      return null;\r\n    }\r\n    const layer = hierarchyInfo.layer;\r\n    const parentElement = hierarchyInfo.parentElement;\r\n    const entities: Entity[] = repository.entityCollection.getEntities((entity: Entity) => {\r\n      const hierarchyInfo = this.getHierarchyInfo(entity, hierarchyInfoKey);\r\n      const matched = hierarchyInfo.layer === layer + 1 && (hierarchyInfo.parentElement === parentElement || !parentElement && !hierarchyInfo.parentElement);\r\n      if (matched) {\r\n        return entity;\r\n      } else {\r\n        return null;\r\n      }\r\n    });\r\n    return entities;\r\n  }\r\n}\r\n\r\nexport { ParentTreeRepository };\r\n","import { HttpHeaders } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { Entity, FieldMetadataUtil, FrameContext, Repository } from '@farris/devkit';\r\nimport { ResponseInfo, BefRepository } from '@farris/bef';\r\n\r\n/**\r\n * è·¯å¾æ ä»åº\r\n */\r\nclass PathTreeRepository {\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addSibling(repository: BefRepository<Entity>, id: string): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSiblingUri = `${baseUri}/service/pathhierarchycreatesibling`;\r\n    const body = {\r\n      dataID: id,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addChild(repository: BefRepository<Entity>, parentId: string) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addChildUri = `${baseUri}/service/pathhierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      dataID: parentId,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å å­è¡¨åå¼èç¹\r\n   */\r\n  public addSubSibling(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubSiblingUri = `${baseUri}/service/childnodepathhierarchycreatesibling`;\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let path = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(path, responseInfo.returnValue)\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n  * æ·»å å­è¡¨å­èç¹\r\n  */\r\n  public addSubChild(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubChildUri = `${baseUri}/service/childnodepathhierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let path = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(path, responseInfo.returnValue)\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getPaths(nodes: string[], ids: string[]) {\r\n    let paths = '';\r\n    if (nodes && nodes.length > 0 && ids && ids.length > 0) {\r\n      for (let i = 0; i < ids.length; i++) {\r\n        if (nodes[i]) {\r\n          paths = paths + `/${ids[i]}`;\r\n          paths = paths + `/${nodes[i]}s`;\r\n        }\r\n      }\r\n    }\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * å è½½ç¶èç¹\r\n   */\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadByParentId(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, filters: any[], sorts: any[], frozenCurrentRow: boolean = false, pagination?: { pageSize: number, pageIndex: number }, frameContext?: FrameContext, reload: boolean = false): Observable<Entity[]> {\r\n    const localEntities = this.getChildren(repository, hierarchyInfoKey, parentId);\r\n    if (localEntities && localEntities.length > 0 && !reload) {\r\n      return of(localEntities);\r\n    }\r\n    const restService = repository.restService;\r\n    const parentHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const originalHierarchyInfoKey = this.getOriginalHierarchyInfoKey(repository, hierarchyInfoKey);\r\n    const filtersWithParent = this.buildFiltersWithParent(originalHierarchyInfoKey, parentHierarchyInfo, filters);\r\n    const isUsePagination = pagination && pagination.pageSize > 0 || false;\r\n    // ç»ç»EntityFilter\r\n    const entityFilter = {\r\n      FilterConditions: filtersWithParent,\r\n      SortConditions: sorts,\r\n      IsUsePagination: isUsePagination,\r\n      Pagination: { PageIndex: pagination && pagination.pageIndex || 0, PageSize: pagination && pagination.pageSize || 0, PageCount: 0, TotalCount: 0 }\r\n    };\r\n    const requestInfo = restService.buildRequestInfo();\r\n    return restService.extendQuery(entityFilter, requestInfo).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const paginationInfo = this.getPaginationInfo(responseInfo);\r\n        if (parentId) {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.params.set(`_NODE_${parentId}_PAGINATION_INFO_`, paginationInfo);\r\n          }\r\n        } else {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);\r\n          }\r\n        }\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, parentHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, { isTreeNodeLoadScene: true });\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, { isTreeNodeLoadScene: true });\r\n        }\r\n\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadFullTree(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, propertyName: string, fullTreeType: string, loadType: string, filters?: any[], context?: any): Observable<Entity[]> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const queryUrl = `${baseUri}/service/parentidfulltreequery`;\r\n    const pathHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const entityFilter = this.buildEntityFilter(filters, null, 0, 0);\r\n    const body = {\r\n      dataId: parentId || '',\r\n      isUsePagination: false,\r\n      virtualPropertyName: propertyName,\r\n      pagination: {},\r\n      fullTreeType,\r\n      loadType,\r\n      filter: entityFilter,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(queryUrl, 'PUT', null, options).pipe(\r\n      tap((responseInfo: ResponseInfo) => {\r\n        // ä¿å­å±å¼çèç¹\r\n        if (responseInfo.returnValue && responseInfo.returnValue.selectedRowId && context && context.frameContext) {\r\n          const frameContext = context.frameContext as FrameContext;\r\n          const virtualRootFrameContext = frameContext && frameContext.getVirtualRootFrameContext() || null;\r\n          if (virtualRootFrameContext) {\r\n            const list = responseInfo.returnValue.result as any[];\r\n            const selectedRowId = responseInfo.returnValue.selectedRowId;\r\n            // ä»é¡¶å±å¼å§è®¡ç®ææéè¦å±å¼çèç¹\r\n            const leafNodeInfo = list.find(item => item[repository.primaryKey] === selectedRowId);\r\n            const hierarchyInfo = leafNodeInfo[hierarchyInfoKey] as { isDetail: boolean, layer: number, path: string };\r\n            const ids = this.getAllParentIds(hierarchyInfo, list, hierarchyInfoKey, repository);\r\n            virtualRootFrameContext.params.set('_DEVKIT_expandRowIds', ids.join(','));\r\n            virtualRootFrameContext.params.set('_DEVKIT_selectedRowId', selectedRowId);\r\n            virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', selectedRowId);\r\n          }\r\n        }\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const frozenCurrentRow: boolean = context && context.frozenCurrentRow || false;\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, pathHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, {isTreeNodeLoadScene: true});\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, {isTreeNodeLoadScene: true});\r\n        }\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æå¥å¯¹ç¶èç¹çè¿æ»¤\r\n   */\r\n  public buildFiltersWithParent(originalHierarchyInfoKey: string, parentHierarchyInfo: any, filterArray: any[]): any {\r\n    const relationType = filterArray && filterArray.length >= 1 ? 1 : 0;\r\n\r\n    const parentLayer = parentHierarchyInfo ? parentHierarchyInfo['layer'] : 0;\r\n    const parentFilterArray = [\r\n      {\r\n        \"FilterField\": `${originalHierarchyInfoKey}.Layer`,\r\n        \"Value\": parentLayer + 1,\r\n        \"Lbracket\": null,\r\n        \"Rbracket\": null,\r\n        \"Relation\": 1,\r\n        \"Expresstype\": 0,\r\n        \"Compare\": 0\r\n      }\r\n    ];\r\n\r\n    // ç¶è·¯å¾è¿æ»¤ï¼å¦æä¸ºç©ºï¼åä¸æ·»å ï¼å¼å®¹oracleåæ°ï¼\r\n    const parentPath = parentHierarchyInfo ? parentHierarchyInfo['path'] : '';\r\n    if (parentPath) {\r\n      parentFilterArray.push({\r\n        \"FilterField\": `${originalHierarchyInfoKey}.Path`,\r\n        \"Value\": parentPath,\r\n        \"Lbracket\": null,\r\n        \"Rbracket\": null,\r\n        \"Relation\": relationType,\r\n        \"Expresstype\": 0,\r\n        \"Compare\": 7\r\n      });\r\n    } else {\r\n      parentFilterArray[0].Relation = relationType;\r\n    }\r\n\r\n    return parentFilterArray.concat(filterArray);\r\n  }\r\n  public buildEntityFilter(filter: any[], sort: any[], pageSize: number, pageIndex: number) {\r\n\r\n    // @todoï¼ä¸´æ¶å¼å®¹èä»£ç ï¼éä½æ¹å¨å¸¦æ¥çé£é©\r\n    if (!filter && !sort && !pageSize && !pageIndex) {\r\n      return null;\r\n    }\r\n    if (!filter) {\r\n      filter = [];\r\n    }\r\n    if (!sort) {\r\n      sort = [];\r\n    }\r\n    // çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n    if (filter && filter.length > 0) {\r\n      filter[filter.length - 1].Relation = 0;\r\n    }\r\n    const entityFilter = {\r\n      FilterConditions: filter,\r\n      SortConditions: sort,\r\n      IsUsePagination: pageSize === 0 ? false : true,\r\n      Pagination: {\r\n        PageIndex: pageIndex,\r\n        PageSize: pageSize,\r\n        PageCount: 0,\r\n        TotalCount: 0\r\n      }\r\n    };\r\n    return entityFilter;\r\n  }\r\n  /**\r\n   * æ¸ç©ºåä»£å®ä½\r\n   */\r\n  public clearDescendantEntities(repository: BefRepository<Entity>, hierarchyInfokey: string, parentHierarchyInfo: any, frozenCurrentRow: boolean = false): void {\r\n\r\n    // æ¸ç©ºæ ¹èç¹\r\n    if (!parentHierarchyInfo) {\r\n      repository.entityCollection.clear();\r\n      return;\r\n    }\r\n    const fPath = parentHierarchyInfo.path;\r\n    const fLayer = parentHierarchyInfo.layer;\r\n    if (frozenCurrentRow) {\r\n      repository.entityCollection.removeData((entity: Entity) => {\r\n        const hierarchyInfo = entity[hierarchyInfokey];\r\n        const path = hierarchyInfo.path;\r\n        const layer = hierarchyInfo.layer;\r\n        return layer > fLayer && path.startsWith(fPath);\r\n      });\r\n    } else {\r\n      repository.entityCollection.removeEntities((entity: Entity) => {\r\n        const hierarchyInfo = entity[hierarchyInfokey];\r\n        const path = hierarchyInfo.path;\r\n        const layer = hierarchyInfo.layer;\r\n        return layer > fLayer && path.startsWith(fPath);\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä½çåçº§ä¿¡æ¯\r\n   */\r\n  public getHierarchyInfoById(repository: BefRepository<Entity>, hierarchyInfokey: string, id: string): any {\r\n    if (!id) {\r\n      return null;\r\n    }\r\n    const entity: Entity = repository.entityCollection.getEntityById(id);\r\n    const hierarchyInfoEntity: Entity = entity[hierarchyInfokey];\r\n    return hierarchyInfoEntity.toJSON();\r\n  }\r\n\r\n  /**\r\n   * è·ååçº§ç çåå§çå­æ®µå\r\n   */\r\n  public getOriginalHierarchyInfoKey(repository: BefRepository<Entity>, hierarchyInfokey: string): string {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(repository.entityType);\r\n    const hierarchyInfoNgObject = ngObjects[hierarchyInfokey];\r\n    return hierarchyInfoNgObject.originalDataField as string;\r\n  }\r\n  private getPaginationInfo(responseInfo: ResponseInfo) {\r\n    return responseInfo && responseInfo.returnValue && responseInfo.returnValue.pagination || null;\r\n  }\r\n  private findParent(hierarchyInfo: { isDetail: boolean, layer: number, path: string }, list: any[], hierarchyInfoKey: string) {\r\n    return list.find(item => {\r\n      const currentHierarchyInfo = item[hierarchyInfoKey] as { isDetail: boolean, layer: number, path: string };\r\n      return currentHierarchyInfo.layer === hierarchyInfo.layer - 1 && hierarchyInfo.path.startsWith(currentHierarchyInfo.path);\r\n    });\r\n  }\r\n  private getAllParentIds(hierarchyInfo: { isDetail: boolean, layer: number, path: string }, list: any[], hierarchyInfoKey: string, repository: Repository<any>) {\r\n    let item = this.findParent(hierarchyInfo, list, hierarchyInfoKey);\r\n    const ids = [];\r\n    while (item) {\r\n      ids.push(item[repository.primaryKey]);\r\n      item = this.findParent(item[hierarchyInfoKey], list, hierarchyInfoKey);\r\n    }\r\n    return ids;\r\n  }\r\n  private getHierarchyInfo(entity: Entity, hierarchyInfoKey: string): { path: string, layer: number, isDetail: boolean } {\r\n    return entity[hierarchyInfoKey];\r\n  }\r\n  /**\r\n   * æ¥æ¾èç¹ä¸ææå­çº§ï¼ç¬¬ä¸çº§ï¼\r\n   * @param repository repository\r\n   * @param hierarchyInfoKey åçº§ç å­æ®µ\r\n   * @param id id\r\n   * @returns \r\n   */\r\n  private getChildren(repository: BefRepository<Entity>, hierarchyInfoKey: string, id: string): Entity[] {\r\n    const hierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, id);\r\n    if (!hierarchyInfo) {\r\n      return null;\r\n    }\r\n    const layer = hierarchyInfo.layer;\r\n    const path = hierarchyInfo.path;\r\n    const entities: Entity[] = repository.entityCollection.getEntities((entity: Entity) => {\r\n      const hierarchyInfo = this.getHierarchyInfo(entity, hierarchyInfoKey);\r\n      const matched = hierarchyInfo.layer === layer + 1 && hierarchyInfo.path.startsWith(path);\r\n      if (matched) {\r\n        return entity;\r\n      } else {\r\n        return null;\r\n      }\r\n    });\r\n    return entities;\r\n  }\r\n}\r\n\r\nexport { PathTreeRepository };\r\n","import { ParentTreeRepository } from './parent-tree-repository';\r\nimport { PathTreeRepository } from './path-tree-repository';\r\n\r\nexport class TreeRepositoryFactory {\r\n    static getInstance(treeType: string){\r\n        let repository=null;\r\n        switch (treeType) {\r\n            case \"path\":\r\n                repository = new PathTreeRepository();\r\n                break;\r\n            case \"parent\":\r\n                repository = new ParentTreeRepository();\r\n                break;\r\n            default: break;\r\n        }\r\n        return repository;\r\n    }\r\n}","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of, empty, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\n\r\nimport { Entity, FrameContext, FieldMetadataUtil, NgFieldProperty } from '@farris/devkit';\r\nimport { BefRepository, BefRepositoryUtil } from '@farris/bef';\r\n\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\n\r\nimport { BaseDataService } from './base-data.service';\r\nimport { EditStateUtil } from './utils/index';\r\nimport { TreeUtilFactory } from './tree-table/util/tree-util-factory';\r\nimport { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';\r\nimport { DataChangeDetectionService } from '../data-change-detection.service';\r\n// tslint:disable: no-string-literal\r\n\r\n/**\r\n * æ æ°æ®æå¡\r\n */\r\n@Injectable()\r\nclass TreeDataService extends BaseDataService {\r\n\r\n  /**\r\n   * åçº§ä¿¡æ¯å­æ®µå\r\n   */\r\n  private get hierarchyInfoKey(): string {\r\n    return this.virtualRootFrameContext.getParam('hierarchyInfoKey');\r\n  }\r\n  private get virtualRootFrameContext() {\r\n    return this.frameContext.getVirtualRootFrameContext();\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    frameContext: FrameContext,\r\n    private messageService: FormMessageService,\r\n    private loadingService: FormLoadingService,\r\n    private notifyService: FormNotifyService,\r\n    private errorService: FormErrorService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    super(frameContext);\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å è½½æ°æ®\r\n   */\r\n  public load(filters?: string, sorts?: string): Observable<Entity[]> {\r\n    const filtersArray = this.parseConditions(filters);\r\n    const sortsArray = this.parseConditions(sorts);\r\n    const correctSelectedNode = this.repository.entityCollection.count() === 0;\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const query$ = this.repository.getEntities(filtersArray, sortsArray, null, null);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n\r\n          // çº æ­£éä¸­èç¹\r\n          if (correctSelectedNode === true) {\r\n            const hierarchyType = this.getHierarchyType();\r\n            const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n            if (treeNodeUtil !== null) {\r\n              treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n            }\r\n          }\r\n\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åå±å è½½æ°æ®\r\n   */\r\n  public loadByLevel(filters?: string, sorts?: string, frozenCurrentRow?: boolean | string): Observable<Entity[]> {\r\n    this.setLoadByLevelState(filters, sorts);\r\n    const filtersArray = this.parseConditions(filters);\r\n    const sortsArray = this.parseConditions(sorts);\r\n    // const parentId = this.bindingData.list.currentId;\r\n    const parentId = this.getIdToExpand();\r\n    const correctSelectedNode = this.repository.entityCollection.count() === 0;\r\n    if (frozenCurrentRow === undefined) {\r\n      frozenCurrentRow = false;\r\n    }\r\n    if (typeof frozenCurrentRow !== 'boolean') {\r\n      frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;\r\n    }\r\n    const hierarchyType = this.getHierarchyType();\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n\r\n    if (repository === null) {\r\n      return empty();\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    // æé åé¡µä¿¡æ¯\r\n    const pagination = this.buildPaginationInfo(parentId);\r\n    const reload = this.frameContext.params.get('_RELOAD_CHILDREN_') || false;\r\n    const query$ = repository.loadByParentId(this.repository, this.hierarchyInfoKey, parentId, filtersArray, sortsArray, frozenCurrentRow, pagination, this.frameContext, reload);\r\n    return query$.pipe(\r\n      tap(\r\n        (entities: Entity[]) => {\r\n          this.frameContext.params.delete('_RELOAD_CHILDREN_');\r\n          // çº æ­£éä¸­èç¹\r\n          if (correctSelectedNode === true) {\r\n            const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n            if (treeNodeUtil !== null) {\r\n              treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n            }\r\n          }\r\n          const currentRowId = this.bindingData.list.currentItem.primaryKeyValue;\r\n          if (frozenCurrentRow) {\r\n            // å¦æä¸ä¸æ¬¡éä¸­è¡ä¸ºæ¬æ¬¡å è½½æ°æ®ä¸­çä¸æ¡ï¼ååºè¯¥éæ°éä¸­è¯¥è¡\r\n            const containsCurrentRow = entities.find(item => item.primaryValue === currentRowId);\r\n            if (containsCurrentRow) {\r\n              this.setCurrentId(currentRowId);\r\n            }\r\n            // åæ¥çå½åè¡ä¸å¨å·²ç»å è½½çæ°æ®ä¸­ï¼å¦å±å¼å°ç¬¬ä¸çº§ï¼å°ç¬¬ä¸çº§çæè¡è®¾ä¸ºå½åè¡ï¼å¨é¨æ¶èµ·ï¼å±å¼ç¬¬ä¸çº§\r\n            if (!this.repository.entityCollection.getEntityById(currentRowId)) {\r\n              const firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;\r\n              if (firstChildId) {\r\n                this.setCurrentId(firstChildId);\r\n              }\r\n            }\r\n          }\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å è½½å®æ´æ \r\n   * @param virtualPropertyName èæå­æ®µ\r\n   * @param fullTreeType æ¯å¦æ¯å®æ´æ å è½½ 0ï¼å®æ´æ  1ï¼é¨åæ \r\n   * @param loadType æ¯å¦åçº§å è½½ 0ï¼å¨é¨å è½½ 1ï¼åçº§å è½½\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param frozenCurrentRow å»ç»å½åè¡\r\n   */\r\n  public loadFullTree(virtualPropertyName: string, fullTreeType: string, loadType: string, filters: string, frozenCurrentRow?: boolean | string): Observable<Entity[]> {\r\n    if (typeof fullTreeType !== 'string') {\r\n      throw new Error('ArgumentError: fullTreeType ä¸è½ä¸ºç©ºä¸å¿é¡»ä¸ºå­ç¬¦ä¸²ã');\r\n    }\r\n    if (typeof loadType !== 'string') {\r\n      throw new Error('ArgumentError: loadType ä¸è½ä¸ºç©ºä¸å¿é¡»ä¸ºå­ç¬¦ä¸²ã');\r\n    }\r\n    if (frozenCurrentRow === undefined) {\r\n      frozenCurrentRow = false;\r\n    }\r\n    if (typeof frozenCurrentRow !== 'boolean') {\r\n      frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;\r\n    }\r\n    const virtualRootFrameContext = this.virtualRootFrameContext;\r\n    // è¿åä¸æ¬¡è®¾ç½®çç»æé\r\n    virtualRootFrameContext.params.delete('_DEVKIT_expandRowIds');\r\n    virtualRootFrameContext.params.delete('_DEVKIT_selectedRowId');\r\n    virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', null);\r\n    const filtersArray = this.parseConditions(filters);\r\n    const parentId = this.getIdToExpand();\r\n    const correctSelectedNode = this.repository.entityCollection.count() === 0;\r\n    const hierarchyType = this.getHierarchyType();\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n\r\n    if (repository === null) {\r\n      return EMPTY;\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const context = {\r\n      frameContext: this.frameContext,\r\n      frozenCurrentRow\r\n    };\r\n    // tslint:disable-next-line: max-line-length\r\n    const query$ = repository.loadFullTree(this.repository, this.hierarchyInfoKey, parentId, virtualPropertyName, fullTreeType, loadType, filtersArray, context);\r\n    return query$.pipe(\r\n      tap(\r\n        (entities: Entity[]) => {\r\n          const selectedRowId = virtualRootFrameContext.params.get('_DEVKIT_selectedRowId');\r\n          // çº æ­£éä¸­èç¹\r\n          if (correctSelectedNode === true || !selectedRowId) {\r\n            const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n            if (treeNodeUtil !== null) {\r\n              const computedFirstRowId = treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n              if (computedFirstRowId) {\r\n                virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', computedFirstRowId);\r\n              }\r\n            }\r\n          }\r\n          const currentRowId = this.bindingData.list.currentItem.primaryKeyValue;\r\n          if (frozenCurrentRow) {\r\n            // å¦æä¸ä¸æ¬¡éä¸­è¡ä¸ºæ¬æ¬¡å è½½æ°æ®ä¸­çä¸æ¡ï¼ååºè¯¥éæ°éä¸­è¯¥è¡\r\n            const containsCurrentRow = entities.find(item => item.primaryValue === currentRowId);\r\n            if (containsCurrentRow) {\r\n              this.setCurrentId(currentRowId);\r\n            }\r\n            // åæ¥çå½åè¡ä¸å¨å·²ç»å è½½çæ°æ®ä¸­ï¼å¦å±å¼å°ç¬¬ä¸çº§ï¼å°ç¬¬ä¸çº§çæè¡è®¾ä¸ºå½åè¡ï¼å¨é¨æ¶èµ·ï¼å±å¼ç¬¬ä¸çº§\r\n            if (!this.repository.entityCollection.getEntityById(currentRowId) && entities && entities.length > 0) {\r\n              const firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;\r\n              if (firstChildId) {\r\n                this.setCurrentId(firstChildId);\r\n              }\r\n            }\r\n          }\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * è·åææ°å±å¼çèç¹\r\n   */\r\n  public getIdToExpand() {\r\n    const expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    const idToExpand = expandNodes.pop();\r\n    this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n    return idToExpand;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®ææ°å±å¼çèç¹\r\n   */\r\n  public setIdToExpand(idToExpand: string): void {\r\n    const expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    expandNodes.push(idToExpand);\r\n    this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n  }\r\n\r\n  /**\r\n   * è§£æè¿æ»¤æ¡ä»¶\r\n   */\r\n  public parseConditions(conditions?: string): any[] {\r\n    const conditionsString = (!conditions || conditions === '') ? '[]' : conditions;\r\n    return JSON.parse(conditionsString);\r\n  }\r\n\r\n  /**\r\n   * æ°å¢åçº§\r\n   */\r\n  public addSibling(id: string): Observable<any> {\r\n\r\n    // è®¾è®¡æ¶idçè·åæ¹ä¸ºä»å½ä»¤åæ°ä¸è·åï¼ä½è®¾è®¡æ¶æ²¡æåæ°å¿å¡«æ£æ¥ï¼\r\n    // å¦ææå¼è¡¨åä¿å­äºï¼å³æ´æ°äºææ°çå½ä»¤æä»¶ï¼ï¼ä½æ²¡æéç½®è¯¥åæ°ï¼å¯è½ä¼ä¼ éè¿æ¥ä¸ä¸ªç©ºå¼ï¼\r\n    // ä¸ºäºå¼å®¹æ­¤æåµï¼ä½¿ç¨å½åè¡idä½ä¸ºidçå¼\r\n    id = id ? id : this.bindingData.list.currentId;\r\n\r\n    // åæ°æ£æ¥\r\n    if (!id || id === 'undefined') {\r\n      id = '';\r\n    }\r\n\r\n    // è®°å½æè¿ä¸æ¬¡ä¿®æ¹çæ°æ®id\r\n    const lastModifiedId = this.bindingData.list.currentId;\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType: string = this.getHierarchyType();\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      // éè¯¯çåçº§ç \r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const result$ = repository.addSibling(this.repository, id);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.virtualRootFrameContext.setParam('IS_ADD', true);\r\n          this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.addSiblingFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ°å¢ä¸çº§\r\n   */\r\n  public addChild(id: string): Observable<any> {\r\n\r\n    // åå åaddSiblingçä¿®æ¹\r\n    id = id ? id : this.bindingData.list.currentId;\r\n\r\n    // åæ°æ£æ¥\r\n    if (!id) {\r\n      // è¯·éæ©ç¶èç¹\r\n      this.notifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    // è®°å½æè¿ä¸æ¬¡ä¿®æ¹çæ°æ®id\r\n    const lastModifiedId = this.bindingData.list.currentId;\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType = this.getHierarchyType();\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n\r\n    // æ°å¢çæ¶åï¼è¦å±å¼ç¶èç¹\r\n    this.setIdToExpand(id);\r\n    const reloadChild$ = this.reloadByLevel();\r\n\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const addChild$ = repository.addChild(this.repository, id);\r\n    const result$ = reloadChild$.pipe(\r\n      switchMap(() => {\r\n        return addChild$;\r\n      }),\r\n      tap(\r\n        () => {\r\n          this.virtualRootFrameContext.setParam('IS_ADD', true);\r\n          this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.addChildFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * æ¹éä¿å­\r\n   */\r\n  public save(): Observable<boolean> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'save' });\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const save$ = this.repository.applyChanges();\r\n    const result$ = save$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.notifyService.success(this.languageService.saveSuccess, { hideTitle: true });\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.multiSaveFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * å é¤\r\n   */\r\n  public remove(id: string, successMsg?: string): Observable<boolean> {\r\n\r\n    // åå åaddSibling\r\n    id = id ? id : this.bindingData.list.currentId;\r\n\r\n    // åæ°æ£æ¥\r\n    if (!id) {\r\n      this.notifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    // å­å¨å­èç¹ä¸åè®¸å é¤\r\n    const treeNodesData = this.repository.entityCollection.toJSON();\r\n    const hierarchyType = this.getHierarchyType();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil === null) {\r\n      return empty();\r\n    }\r\n    if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {\r\n      this.notifyService.warning(this.languageService['deleteChildFirst'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    // ç¡®è®¤å é¤\r\n    const action$ = this.messageService.question(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n\r\n        // è·åå é¤åè¦è®¾ç½®çèç¹id\r\n        const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, id);\r\n\r\n        // æ§è¡å é¤\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.frameContext.repository.removeById(id);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n\r\n            // è®¾ç½®éä¸­èç¹\r\n            treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);\r\n\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.notifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.errorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åæ¶æ¶æ£æµæªä¿å­è®°å½\r\n   */\r\n  public cancel(): Observable<any> {\r\n    const hasChange$ = DataChangeDetectionService.hasChange(this.frameContext);\r\n    return hasChange$.pipe(\r\n      switchMap((changed: boolean) => {\r\n        if (!changed) {\r\n          return this._cancel();\r\n        } else {\r\n          return this.messageService.question(this.languageService['cancelWithoutSave']).pipe(\r\n            switchMap((ifCancel: boolean) => {\r\n              if (ifCancel === false) {\r\n                return EMPTY;\r\n              }\r\n              return this._cancel();\r\n            })\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æé åé¡µä¿¡æ¯\r\n   * @param parentId parentId\r\n   * @returns\r\n   */\r\n  private buildPaginationInfo(parentId: any) {\r\n    const pagination: any = { pageIndex: 0, pageSize: 0 };\r\n    const enableNodePagination = this.frameContext.params.get('enableNodePagination');\r\n    if (!parentId) {\r\n      // ä¸çº§åé¡µ\r\n      const pageSize = this.repository.entityCollection.pageSize || 0;\r\n      const pageIndex = this.repository.entityCollection.pageIndex || 0;\r\n      // å¯ç¨äºä¸çº§åé¡µ\r\n      if (pageSize !== 0) {\r\n        pagination.pageSize = pageSize;\r\n        pagination.pageIndex = pageIndex;\r\n      }\r\n    } else {\r\n      // å¦ææªå¯ç¨èç¹åé¡µæå½åä¸ºé¡¶çº§èç¹å è½½ï¼åä¸å¤çèç¹åé¡µ\r\n      if (enableNodePagination) {\r\n        const nodePageSize = this.frameContext.params.get('nodePageSize') || 0;\r\n        let nodePageIndex = this.frameContext.params.get(`_NODE_${parentId}_PAGE_INDEX_`);\r\n        if (!nodePageIndex) {\r\n          this.frameContext.params.set(`_NODE_${parentId}_PAGE_INDEX_`, 1);\r\n          nodePageIndex = 1;\r\n        }\r\n        pagination.pageIndex = nodePageIndex;\r\n        pagination.pageSize = nodePageSize;\r\n      }\r\n    }\r\n    return pagination;\r\n  }\r\n\r\n  /**\r\n   * åæ¶åæ´\r\n   */\r\n  private _cancel(): Observable<any> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const cancel$ = this.repository.cancelChanges();\r\n    return cancel$.pipe(\r\n      switchMap(() => {\r\n        const isAdd = this.virtualRootFrameContext.getParam('IS_ADD');\r\n        const lastModifiedId = this.virtualRootFrameContext.getParam('LAST_MODIFIED_ID');\r\n        const currentId = this.bindingData.list.currentId;\r\n\r\n        if (isAdd === true) {\r\n          this.repository.entityCollection.removeEntityById(currentId);\r\n\r\n          // éç½®ç¼è¾ç¶æ\r\n          this.virtualRootFrameContext.setParam('IS_ADD', false);\r\n          if (lastModifiedId) {\r\n            setTimeout(() => {\r\n              this.bindingData.list.setCurrentId(lastModifiedId, true, true);\r\n            }, 0);\r\n          }\r\n          return of(null);\r\n        } else {\r\n          return this.repository.updateById(currentId);\r\n        }\r\n      }),\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.cancelFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦å­å¨ä¸çº§èç¹ï¼åé¨æ¹æ³ï¼è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public hasChildNodes(id: string, treeNodesData: any[]): boolean {\r\n    const treeNodeUtil = this.getTreeNodeUtil();\r\n    if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®å é¤åçå½åèç¹idï¼åé¨æ¹æ³ï¼è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public getNextNodeIdAfterRemoving(idToRemove: string, treeNodesData: any[]): string {\r\n    const treeNodeUtil = this.getTreeNodeUtil();\r\n    const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, idToRemove);\r\n    return nextNodeId;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®å é¤åçå½åèç¹èç¹ï¼åé¨æ¹æ³ï¼è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public setNextNodeAfterRemoving(nextNodeId: string): void {\r\n    const treeNodeUtil = this.getTreeNodeUtil();\r\n    treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);\r\n  }\r\n  /**\r\n   * è®¾ç½®æ çå½åè¡(ç»å®æ´æ ä½¿ç¨)\r\n   * @param id id\r\n   */\r\n  public setCurrentId(id: string) {\r\n    id = id || this.frameContext.getVirtualRootFrameContext().uiState['__DEVKIT__selectedRow'] || this.bindingData.list.currentItem.primaryKeyValue;\r\n    this.frameContext.bindingData.list.setCurrentId(id, true, true, true);\r\n  }\r\n  /**\r\n   * éä¸­æ çç¬¬ä¸ä¸ªèç¹\r\n   */\r\n  public selectFirstRow() {\r\n    const hierarchyType = this.getHierarchyType();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil !== null) {\r\n      treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n    }\r\n  }\r\n  /**\r\n   * è·åæ èç¹å·¥å·ç±»å®ä¾\r\n   */\r\n  private getTreeNodeUtil(): any {\r\n    const hierarchyType = this.getHierarchyType();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil === null) {\r\n      throw new Error(`ä¸æ¯æ${hierarchyType}ç±»åçåçº§`);\r\n    }\r\n    return treeNodeUtil;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * è®°å½å è½½ç¶æ\r\n   * @todoï¼å¾å é¤\r\n   */\r\n  private setLoadByLevelState(filters: string, sorts: string) {\r\n\r\n    // @todoï¼ä¸´æ¶å¤ç\r\n    this.virtualRootFrameContext.setParam('isLoadTreeByLevel', true);\r\n    this.virtualRootFrameContext.setParam('loadTreeByLevelFilter', filters);\r\n    this.virtualRootFrameContext.setParam('loadTreeByLevelSort', sorts);\r\n  }\r\n\r\n  /**\r\n   * å±å¼å½åèç¹\r\n   * @todoï¼å¾å é¤\r\n   */\r\n  private reloadByLevel(): Observable<Entity[]> {\r\n    const isLoadByLevel = this.virtualRootFrameContext.getParam('isLoadTreeByLevel');\r\n    if (isLoadByLevel === true) {\r\n      const filters = this.virtualRootFrameContext.getParam('loadTreeByLevelFilter');\r\n      const sorts = this.virtualRootFrameContext.getParam('loadTreeByLevelSort');\r\n      return this.loadByLevel(filters, sorts);\r\n    }\r\n    return of([]);\r\n  }\r\n\r\n  private getHierarchyType() {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.repository.entityType);\r\n    const hierarchyInfoNgObjectInfo = ngObjects[this.hierarchyInfoKey];\r\n    let hierarchyType = 'path'; // åçº§ç é»è®¤ä¸ºpathï¼å¼å®¹åè¡¨å\r\n    if (hierarchyInfoNgObjectInfo.hasOwnProperty('hierarchyType') && hierarchyInfoNgObjectInfo['hierarchyType'] != null) {\r\n      hierarchyType = hierarchyInfoNgObjectInfo['hierarchyType'] as string;\r\n    }\r\n    if (hierarchyType == null || hierarchyType.length < 1) {\r\n      // 'åçº§ç éç½®ä¿¡æ¯éè¯¯'\r\n      throw new Error(this.languageService['incorrectHierarchyConfig']);\r\n    }\r\n    return hierarchyType;\r\n  }\r\n  /**\r\n   * è·åæ ¹ç»ä»¶æ¶æ¯ç®¡é\r\n   */\r\n  private get messagePipe() {\r\n    if (this.frameContext) {\r\n      const appContext = this.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\nexport { TreeDataService };\r\n","import { Injectable } from '@angular/core';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { FilterConditionService } from '../filter-condition.service';\r\nimport { CommandService } from '../command-service';\r\n\r\n@Injectable()\r\nclass FilterConditionDataService {\r\n    constructor(\r\n        private viewModel: ViewModel,\r\n        private filterConditionService: FilterConditionService,\r\n        private commandService: CommandService\r\n    ) { }\r\n\r\n    /**\r\n     * æ§è¡è¿æ»¤\r\n     * @param commandName å½ä»¤åç§°\r\n     * @param frameId å½ä»¤æå¨çframeId\r\n     */\r\n    public filter(commandName: string, frameId: string) {\r\n        const self: any = this;\r\n        let filters = self.context && self.context.eventParam && self.context.eventParam.data || [];\r\n        if (typeof (filters) === 'string') {\r\n            filters = JSON.parse(filters);\r\n        }\r\n        // æ¥è¯¢æ¶éç½®é¡µç ä¸ºç¬¬ä¸é¡µ\r\n        this.viewModel.frameContext.repository.entityCollection.pageIndex = 1;\r\n        this.viewModel.frameContext.repository.filterConditionManager.setConditions(this.viewModel.bindingPath, filters);\r\n        return this.commandService.execute(commandName, frameId);\r\n    }\r\n}\r\nexport { FilterConditionDataService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Entity, BindingData, FrameContext } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { Observable, EMPTY } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { EditStateUtil } from './utils/index';\r\n\r\n\r\n/**\r\n * æ°æ®ç¼è¾æå¡\r\n */\r\n@Injectable()\r\nclass EditDataService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private bindingData: BindingData;\r\n\r\n  /**\r\n   * Loadingæå¡\r\n   */\r\n  private loadingService: FormLoadingService;\r\n\r\n  /**\r\n   * è¯­è¨æå¡\r\n   */\r\n  private languageService: LanguageService;\r\n\r\n  /**\r\n   * éè¯¯å¤çæå¡\r\n   */\r\n  private errorService: FormErrorService;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(private frameContext: FrameContext) {\r\n    this.repository = this.frameContext.repository as BefRepository<Entity>;\r\n    this.bindingData = this.frameContext.bindingData;\r\n    this.loadingService = this.frameContext.injector.get<FormLoadingService>(FormLoadingService, null);\r\n    this.languageService = this.frameContext.injector.get<LanguageService>(LanguageService, null);\r\n    this.errorService = this.frameContext.injector.get<FormErrorService>(FormErrorService, null);\r\n  }\r\n\r\n  /**\r\n   * ç¼è¾ï¼æ¯æå éï¼\r\n   */\r\n  public edit(id: string): Observable<Entity> {\r\n\r\n    id = id || this.bindingData.list.currentId;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const edit$ = this.repository.editEntityById(id);\r\n    const result$ = edit$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          EditStateUtil.setEditState(this.frameContext, id);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.updateFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n}\r\n\r\n\r\nexport { EditDataService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\nimport { FrameContext, Entity, } from '@farris/devkit';\r\nimport { BefRepository, } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { CommandService } from '../command-service';\r\nimport { ListDataService } from './list-data.service';\r\nimport { TreeDataService } from './tree-data.service';\r\n\r\n/**\r\n * å é¤æå¡\r\n */\r\n@Injectable()\r\nclass RemoveDataService {\r\n\r\n  private notifyService: FormNotifyService;\r\n\r\n  private messageService: FormMessageService;\r\n\r\n  private loadingService: FormLoadingService;\r\n\r\n  private errorService: FormErrorService;\r\n\r\n  private languageService: LanguageService;\r\n\r\n  private befRepository: BefRepository<any>;\r\n\r\n  private commandService: CommandService;\r\n\r\n  private listDataService: ListDataService;\r\n\r\n  private treeDataService: TreeDataService;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param frameContext ç»ä»¶ä¸ä¸æ\r\n   */\r\n  constructor(private frameContext: FrameContext) {\r\n    this.notifyService = this.frameContext.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    this.messageService = this.frameContext.injector.get<FormMessageService>(FormMessageService, null);\r\n    this.errorService = this.frameContext.injector.get<FormErrorService>(FormErrorService, null);\r\n    this.loadingService = this.frameContext.injector.get<FormLoadingService>(FormLoadingService, null);\r\n\r\n    this.languageService = this.frameContext.injector.get<LanguageService>(LanguageService, null);\r\n    this.commandService = this.frameContext.injector.get<CommandService>(CommandService, null);\r\n    this.listDataService = this.frameContext.injector.get<ListDataService>(ListDataService, null);\r\n    this.treeDataService = this.frameContext.injector.get<TreeDataService>(TreeDataService, null);\r\n    this.befRepository = this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * å é¤idå¯¹åºçå®ä½\r\n   * @param id è¦å é¤çæ°æ®id\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param enableRemoveAndSave æ¯å¦å¯ç¨å é¤å¹¶ä¿å­ï¼ä»ä¸ºå¼å®¹ï¼æ°è°ç¨è¯·å¿è®¾ç½®ï¼\r\n   * @summary\r\n   * enableRemoveAndSaveå­å¨çæä¹ï¼\r\n   * 1ãèè¡¨åçå¯è½æ²¡ædelAndSaveæ¹æ³ï¼\r\n   * 2ãä¸ºäºå°ListDataServiceä¸­çremoveæ¹æ³è¿ç§»å°æ­¤æ¹æ³ä¸ï¼æ¾ç¤ºè®¾ç½®ä¸ºfalseï¼ä¿æåä»¥åè¡ä¸ºä¸è´ï¼\r\n   * 3ãè¯¥åæ°é»è®¤ä¸ºtrueï¼å¹¶ä¸å¨WebComponentå±ä¸æ´é²ï¼æ°å½ä»¤ä¸éè¦ä¼ éï¼é»è®¤ä¸ºtrueï¼\r\n   */\r\n  public removeById(id: string, ifSave: boolean, enableRemoveAndSave: boolean = true, successMsg?: string): Observable<boolean> {\r\n    const msg = successMsg ? successMsg : '';\r\n    return this.innerRemoveById(id, ifSave, enableRemoveAndSave, msg);\r\n  }\r\n\r\n  public removeByIds(ids: string[]): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * å é¤idå¯¹åºçå®ä½ï¼å¹¶æ§è¡ä¿å­\r\n   */\r\n  public removeAndSaveById(id: string, successMsg?: string): Observable<boolean> {\r\n    const msg = successMsg ? successMsg : '';\r\n    return this.innerRemoveById(id, true, true, msg);\r\n  }\r\n\r\n  /**\r\n   * å é¤å¹¶ä¿å­æ èç¹æ°æ®\r\n   */\r\n  public removeAndSaveByIdForTree(id: string, successMsg?: string): Observable<boolean> {\r\n    const msg = successMsg ? successMsg : '';\r\n    // æ£æ¥è¦å é¤çidæ¯å¦å­å¨\r\n    if (this.checkIdsToRemove([id]) === false) {\r\n      this.notifyService.warning(this.languageService.plsSelectDeleteData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    // æ£æ¥æ¯å¦æå­èç¹\r\n    const treeNodesData = this.befRepository.entityCollection.toJSON();\r\n    if (this.treeDataService.hasChildNodes(id, treeNodesData) === true) {\r\n      this.messageService.warning(this.languageService.deleteChildFirst);\r\n      return EMPTY;\r\n    }\r\n\r\n    // æ§è¡å é¤\r\n    const remove$ = this.innerRemoveById(id, true, true, msg);\r\n    const nextNodeId = this.treeDataService.getNextNodeIdAfterRemoving(id, treeNodesData);;\r\n    const result$ = remove$.pipe(\r\n      tap(() => {\r\n        this.treeDataService.setNextNodeAfterRemoving(nextNodeId);\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n\r\n  /**\r\n   * æ¹éå é¤å¹¶ä¿å­\r\n   */\r\n  public removeAndSaveByIds() {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * å é¤åçå·æ°\r\n   */\r\n  public refreshAfterRemoving(loadCmdName: string, loadCmdFrameId: string): Observable<any> {\r\n    if (!this.frameContext || !loadCmdName || !loadCmdFrameId) {\r\n      return;\r\n    }\r\n    const commandService = this.frameContext.injector.get<CommandService>(CommandService, null);\r\n    return commandService.execute(loadCmdName, loadCmdFrameId);\r\n  }\r\n\r\n  /**\r\n   * å é¤idå¯¹åºçå®ä½\r\n   * @param id å®ä½id\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param enableRemoveAndSave æ¯å¦å¯ç¨å é¤å¹¶ä¿å­ï¼èEAPIä¸æ²¡ææ­¤æ¹æ³ï¼éè¿å¼å³è¿è¡å¼å®¹ï¼\r\n   * @summary\r\n   * enableRemoveAndSaveåæ°è¯´æï¼\r\n   * 1ãèEAPIä¸æ²¡ædelAndSaveæ¹æ³ï¼åªè½åä¸¤æ¬¡è¯·æ±ï¼å é¤åä¿å­ï¼ï¼\r\n   * 2ãæ­¤å¼å³ç¨äºéæ©ä½¿ç¨åªç§æ¹å¼ï¼å¼å®¹èè¡¨åã\r\n   */\r\n  private innerRemoveById(id: string, ifSave: boolean, enableRemoveAndSave: boolean, successMsg: string): Observable<boolean> {\r\n\r\n    // æ£æ¥è¦å é¤çidæ¯å¦å­å¨\r\n    if (this.checkIdsToRemove([id]) === false) {\r\n      this.notifyService.warning(this.languageService.plsSelectDeleteData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const confirm$ = this.confirmToRemove();\r\n    const remove$ = enableRemoveAndSave && ifSave ?\r\n      this.befRepository.removeEntityAndSaveById(id) :\r\n      this.befRepository.removeById(id, ifSave);\r\n\r\n    const result$ = confirm$.pipe(\r\n      concatMap((ifRemove: boolean) => {\r\n        if (ifRemove === false) {\r\n          return EMPTY;\r\n        }\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        return remove$.pipe(\r\n          tap(\r\n            () => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              if (successMsg && successMsg.trim()) {\r\n                let showMessage: boolean = true;\r\n                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                  try {\r\n                    const options = JSON.parse(successMsg);\r\n                    if (options.showMessage === false) {\r\n                      showMessage = false;\r\n                    }\r\n                  } catch { }\r\n                }\r\n                if (showMessage !== false) {\r\n                  this.notifyService.success(successMsg, { hideTitle: true });\r\n                }\r\n              } else {\r\n                this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n              }\r\n              // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            },\r\n            (error: any) => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.errorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          ),\r\n          switchMap(() => {\r\n            const saved = enableRemoveAndSave && ifSave;\r\n            if (!saved) {\r\n              return EMPTY;\r\n            } else {\r\n              return of(null);\r\n            }\r\n          })\r\n        );\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥è¦å é¤çidsæ¯å¦ä¸ºç©º\r\n   */\r\n  private checkIdsToRemove(ids: string[]): boolean {\r\n    if (!ids) {\r\n      return false;\r\n    }\r\n    const filteredIds = ids.filter((id: string) => {\r\n      return !!id;\r\n    });\r\n    if (filteredIds.length === 0) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * ç¡®è®¤å é¤\r\n   */\r\n  private confirmToRemove(): Observable<boolean> {\r\n    const confirm$ = this.messageService.question(this.languageService.confirmDeletion);\r\n    const result$ = confirm$.pipe(\r\n      concatMap((ifRemove: boolean) => {\r\n        if (ifRemove === false) {\r\n          return EMPTY;\r\n        } else {\r\n          return of(true);\r\n        }\r\n      }\r\n      ));\r\n    return result$;\r\n  }\r\n}\r\n\r\nexport { RemoveDataService };\r\n\r\n\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, Entity } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\n\r\n/**\r\n * å é¤æå¡\r\n */\r\n@Injectable()\r\nclass SaveDataService {\r\n\r\n  private notifyService: FormNotifyService;\r\n\r\n  private messageService: FormMessageService;\r\n\r\n  private loadingService: FormLoadingService;\r\n\r\n  private errorService: FormErrorService;\r\n\r\n  private languageService: LanguageService;\r\n\r\n  private befRepository: BefRepository<any>;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param frameContext ç»ä»¶ä¸ä¸æ\r\n   */\r\n  constructor(private frameContext: FrameContext) {\r\n    this.notifyService = this.frameContext.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    this.messageService = this.frameContext.injector.get<FormMessageService>(FormMessageService, null);\r\n    this.loadingService = this.frameContext.injector.get<FormLoadingService>(FormLoadingService, null);\r\n    this.languageService = this.frameContext.injector.get<LanguageService>(LanguageService, null);\r\n    this.befRepository = this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n}\r\n\r\nexport { SaveDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { EMPTY, Observable } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\n\r\nimport { BindingList, FrameContext, ViewModel } from '@farris/devkit';\r\nimport { BaseDataService } from './base-data.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';\r\nimport { TreeUtilFactory } from './tree-table/util/tree-util-factory';\r\n\r\n\r\n\r\n/**\r\n * æ æ°æ®æå¡\r\n */\r\n@Injectable()\r\nclass SubTreeDataService extends BaseDataService {\r\n\r\n  /**\r\n   * åçº§ç ä¿¡æ¯\r\n   */\r\n  private get hierarchyInfoKey(): string {\r\n    return this.virtualRootFrameContext.getParam('hierarchyInfoKey');\r\n  }\r\n  private get hierarchyInfoField(): string {\r\n    return this.hierarchyInfoKey.split('/').filter(p => p).pop();\r\n  }\r\n  private get virtualRootFrameContext() {\r\n    return this.frameContext.getVirtualRootFrameContext();\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    frameContext: FrameContext,\r\n    private viewModel: ViewModel,\r\n    private messageService: FormMessageService,\r\n    private loadingService: FormLoadingService,\r\n    private errorService: FormErrorService,\r\n    private formNotifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    super(frameContext);\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  private get messagePipe() {\r\n    if (this.viewModel && this.viewModel.frameContext) {\r\n      const appContext = this.viewModel.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * æ°å¢å­è¡¨åçº§\r\n   */\r\n  public addSubSibling(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'addSubSibling' });\r\n    }\r\n    let params: { nodeCodes: string[], ids: string[] } = this.getParams();\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType: string = this.getHierarchyType();\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      // éè¯¯çåçº§ç \r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const result$ = repository.addSubSibling(this.repository, params.nodeCodes, params.ids);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.errorService.exception(this.languageService.addSubSiblingFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ°å¢ä¸çº§\r\n   */\r\n  public addSubChild(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'addSubChild' });\r\n    }\r\n    let params: { nodeCodes: string[], ids: string[] } = this.getParams();\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType = this.getHierarchyType();\r\n\r\n    const currentList = this.frameContext && this.frameContext.bindingData && this.frameContext.bindingData.getList();\r\n    if (!currentList['currentId']) {\r\n      // è¯·éæ©ç¶èç¹\r\n      this.formNotifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const addSubChild$ = repository.addSubChild(this.repository, params.nodeCodes, params.ids);\r\n    const result$ = addSubChild$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.addSubChildFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * å é¤å­è¡¨æ èç¹\r\n   * @param id id\r\n   */\r\n  public remove(id: string, successMsg?: string): Observable<any> {\r\n    // åæ°æ£æ¥\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType = this.getHierarchyType();\r\n    // æå­èç¹æ¶ä¸åè®¸å é¤\r\n    const treeNodesData = this.frameContext.bindingData.getList().toJSON();\r\n    const bindingList = this.frameContext.bindingData.getList();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil === null) {\r\n      return EMPTY;\r\n    }\r\n    if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoField, id) === true) {\r\n      this.messageService.warning(this.languageService['deleteChildFirst']);\r\n      return EMPTY;\r\n    }\r\n    // ç¡®è®¤å é¤\r\n    const action$ = this.messageService.question(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return EMPTY;\r\n        }\r\n        // è·åå é¤åè¦è®¾ç½®çèç¹id\r\n        const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoField, id);\r\n\r\n        // æ§è¡å é¤\r\n        const loadingTimerId = this.loadingService.show();\r\n        const path = this.getPath();\r\n        const remove$ = this.frameContext.repository.removeByPath(path, id);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n            // è®¾ç½®éä¸­èç¹\r\n            treeNodeUtil.selectNodeByBindingList(bindingList, this.hierarchyInfoField, nextNodeId);\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.errorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  private getHierarchyType() {\r\n    const propInfo = this.repository.entityTypeInfo.getPropInfoByPath(this.hierarchyInfoKey.split('/'));\r\n    let hierarchyType = propInfo.metadataInfo['hierarchyType'] || null;\r\n    if (hierarchyType == null || hierarchyType.length < 1) {\r\n      // 'åçº§ç éç½®ä¿¡æ¯éè¯¯'\r\n      throw new Error(this.languageService['incorrectHierarchyConfig']);\r\n    }\r\n    return hierarchyType;\r\n  }\r\n\r\n  /**\r\n   * è·ååæ°\r\n   * /parentId/childCodes/childId/grandsonCodes\r\n   * [childCodes, grandsonCodes]\r\n   * [parntId, childId]\r\n   */\r\n  private getParams(): { nodeCodes: string[], ids: string[] } {\r\n    let nodeCodes = this.viewModel.bindingPath.substr(1).split('/');\r\n    let ids = [];\r\n    let nodeCodeArray = [];\r\n    const rid = this.viewModel.bindingData.list.currentId; // rootè¡¨æ°æ®id\r\n    ids.push(rid);\r\n    let subData: any = this.viewModel.bindingData;\r\n    if (nodeCodes.length > 0) {\r\n      nodeCodes.map(nodeCode => {\r\n        subData = subData[nodeCode];\r\n        if (subData && subData.currentId) {\r\n          ids.push(subData.currentId);\r\n        }\r\n        //å»é¤nodeCodeçs\r\n        nodeCode ? nodeCodeArray.push(nodeCode.substring(0, nodeCode.length - 1)) : nodeCodeArray.push(nodeCode);\r\n      })\r\n    }\r\n    return { nodeCodes: nodeCodeArray, ids: ids };\r\n  }\r\n  /**\r\n   * è·åå®æ´è·¯å¾\r\n   * fixed by justin: æ ¹æ®bindingPathï¼å¦ææ¯ä»ä»è¡¨ï¼éè¦è·åä¸»è¡¨æ°æ®idåä»è¡¨æ°æ®id\r\n   */\r\n  private getPath(): string {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const rid = this.viewModel.bindingData.list.currentId; // rootè¡¨æ°æ®id\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/').filter(p => p);\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['edus', 'grades']\r\n      let subData: any = this.viewModel.bindingData;\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        subData = subData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n}\r\nexport { SubTreeDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpHeaders, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Repository } from '@farris/devkit';\r\nimport { BefRepository, BefRestService, RequestInfo, ResponseInfo } from '@farris/bef';\r\nimport { BodyWithRequestInfo } from './types';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { FormErrorService } from './error/form-error.service';\r\nimport { LanguageService } from './languag.service';\r\n// tslint:disable: no-string-literal\r\n\r\n/**\r\n * åè¡¨ä»åºæå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass BeActionService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private loadingService: FormLoadingService,\r\n    private msgService: FormMessageService,\r\n    private notifyService: FormNotifyService,\r\n    private formErrorService: FormErrorService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ§è¡èªå®ä¹å¨ä½\r\n   */\r\n  public invokeAction(\r\n    actionUri: string, httpMethod: string, httpHeaders?: any, queryParams?: any, body?: BodyWithRequestInfo\r\n  ): Observable<ResponseInfo> {\r\n    return this.innerInvokeAction(actionUri, httpMethod, httpHeaders, queryParams, body, true);\r\n  }\r\n\r\n  /**\r\n   * å·²å¼ç¨ï¼è¯·ä½¿ç¨invokeActionä»£æ¿\r\n   * @deprecated\r\n   * @summary\r\n   * è¿ç§»æ¶è¯·æ³¨æï¼invokeActionä¸­bodyè¯·ä¼ éæ»¡è¶³BodyWithRequestInfoæ¥å£çæ ¼å¼ï¼å½¢å¦ï¼\r\n   * { requestInfo: reqeustInfoInstance, key1: value1, key2: value2 }\r\n   */\r\n  public executeAction(\r\n    actionUri: string, httpMethod: string, httpHeaders?: any, queryParams?: any, body?: any\r\n  ): Observable<any> {\r\n\r\n    // 1ãä¸ç¡®å®bodyä¸­æ¯å¦æRequestInfoå¯¹è±¡\r\n    // 2ãrestServiceçreqeustä¼æ ¹æ®bodyä¸­æ¯å¦ækeyä¸ºReqeustInfoï¼å¤§åå¼å¤´ï¼çåæ°æ¥ç¡®å®ï¼\r\n    // 3ãå¦æbodyä¸­æ²¡ækeyä¸ºReqeustInfoçåæ°ï¼ä¸ç´æ¥è¿åResponseInfoï¼èæ¯è¿ä¸æ­¥è§£æï¼è¿åå¶ä¸­çreturnValueã\r\n    return this.innerInvokeAction(actionUri, httpMethod, httpHeaders, queryParams, body, false);\r\n  }\r\n\r\n  /**\r\n   * æé æ¥è¯¢å­ç¬¦ä¸²\r\n   */\r\n  public buildQueryParams(queryParams: string): string {\r\n    if (typeof queryParams === 'string') {\r\n      queryParams = JSON.parse(queryParams);\r\n    }\r\n\r\n    let queryParamsString = '';\r\n    Object.keys(queryParams).forEach((key: string) => {\r\n      queryParamsString += `${key}=${queryParams[key]}`;\r\n    });\r\n\r\n    return queryParamsString;\r\n  }\r\n\r\n  /**\r\n   * è·åRestæå¡\r\n   */\r\n  public getRestService(): BefRestService {\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    return befRepository.restService;\r\n  }\r\n\r\n\r\n  /**\r\n   * è°ç¨èªå®ä¹å¨ä½\r\n   */\r\n  private innerInvokeAction(\r\n    actionUri: string, httpMethod: string, httpHeaders?: any, queryParams?: any, body?: any, hasRequestInfo?: boolean\r\n  ): Observable<any>  {\r\n    const options = {};\r\n    const restService = this.getRestService();\r\n    const baseUri = restService.baseUri;\r\n\r\n    // æé url\r\n    let fullActionUri = `${baseUri}/service/${actionUri}`;\r\n    if (queryParams && queryParams !== '') {\r\n      const queryParamsString = this.buildQueryParams(queryParams);\r\n      fullActionUri += queryParamsString;\r\n    }\r\n\r\n\r\n    // bodyæé \r\n    if (body && body !== '') {\r\n      if (typeof body === 'string' && body.startsWith('{') && body.endsWith('}')) {\r\n        body = JSON.parse(body);\r\n      }\r\n      options['body'] = body;\r\n    }\r\n\r\n    // httpå¤´æé \r\n    if (httpHeaders && httpHeaders !== '') {\r\n      httpHeaders = JSON.parse(httpHeaders);\r\n\r\n      // å¦ææ²¡æè®¾ç½®Content-Typeï¼é»è®¤ç¨jsonæ ¼å¼\r\n      if (!httpHeaders['Content-Type']) {\r\n        httpHeaders['Content-Type'] = 'application/json';\r\n      }\r\n      options['headers'] = new HttpHeaders(httpHeaders);\r\n    } else {\r\n      options['headers'] = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n    }\r\n\r\n    // æ§è¡æå¡å¨ç«¯è¯·æ±\r\n    this.loadingService.show();\r\n\r\n    // invokeæ¹æ³\r\n    // 1ãRequestInfo=>æ¥é\r\n    // 2ãrequestInfo=>ResponseInfo\r\n    // requestæ¹æ³\r\n    // 1ãRequestInfo=>ResponseInfo\r\n    // 2ãrequestInfo=>returnValue\r\n    const methodName = hasRequestInfo ? 'invoke' : 'request';\r\n    const result$ = restService[methodName](fullActionUri, httpMethod, null, options);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hide();\r\n          const errorMsg = fullActionUri + this.languageService['operationFailed'];\r\n          this.formErrorService.exception(errorMsg, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport { BeActionService };\r\n\r\n\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, empty, of, from, EMPTY } from 'rxjs';\r\nimport { tap, map, switchMap, catchError } from 'rxjs/operators';\r\nimport { BeActionService } from './be-action.service';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { FormErrorService } from './error/form-error.service';\r\nimport { WFSubmiteService, InteractionResponse, ExcutionResponse } from '@gsp-wf/rtdevkit';\r\nimport { WfTaskHandlerService } from '@gsp-wf/wf-task-handler';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { Entity, FrameContext } from '@farris/devkit';\r\nimport { WFFlowchartService } from '@gsp-wf/ui-flowchart';\r\nimport { FormNotifyStrategyService } from './form-notify-strategy.service';\r\nimport { BodyWithRequestInfo } from './../lib/types';\r\n// tslint:disable: max-line-length\r\n/**\r\n * å®¡æ¹æå¡\r\n * @Scope FrameComponent\r\n */\r\n@Injectable()\r\nclass ApproveService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private formLoadingService: FormLoadingService,\r\n    private beActionService: BeActionService,\r\n    private msgService: FormMessageService,\r\n    private notifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService,\r\n    private formErrorService: FormErrorService,\r\n    private frameContext: FrameContext,\r\n    @Optional() private submitter: WFSubmiteService,\r\n    @Optional() private flowchartService: WFFlowchartService,\r\n    @Optional() private wfTaskHandlerService: WfTaskHandlerService\r\n  ) {\r\n    if (this.frameContext) {\r\n      this.repository = this.frameContext.repository as BefRepository<Entity>;\r\n      if (!this.wfTaskHandlerService) {\r\n        this.wfTaskHandlerService = this.frameContext.injector.get(WfTaskHandlerService, null);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¸¦æäº¤äºçæäº¤å®¡æ¹\r\n   */\r\n  submitApproveWithInteraction(bizBillID: string) {\r\n    return this.submitApprove(bizBillID);\r\n  }\r\n\r\n  /**\r\n   * æäº¤å®¡æ¹\r\n   * @param bizBillID ä¸å¡åæ®id\r\n   * @param interactionResult åç«¯äº¤äºç»æ\r\n   * @deprecated å·²åºå¼ï¼æ¸ä½¿ç¨åå«å¥å£åæ®çå®¡æ¹\r\n   */\r\n  submitApprove(bizBillID: string, interactionResult?: InteractionResponse): Observable<any> {\r\n    if (!bizBillID) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.notifyService.info(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    const actionUri = 'submittoapprovevoaction';\r\n\r\n    const restService = this.beActionService.getRestService();\r\n\r\n    const body: BodyWithRequestInfo = {\r\n      requestInfo: restService.buildRequestInfo(),\r\n      bizInstID: bizBillID,\r\n      interactionResult: interactionResult ? {\r\n        procDefId: interactionResult.processDefinitionId\r\n      } : {}\r\n    };\r\n\r\n    this.formLoadingService.show();\r\n\r\n    // æ·»å æç¤º\r\n    const action$ = this.beActionService.invokeAction(actionUri, 'PUT', null, null, body);\r\n    // ç®ååå«ä¸ç§æåµï¼\r\n    // 1. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾id\r\n    // 2. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾idï¼å¹¶è¿åå¤ä¸ªåä¸èï¼äº¤äºæ¶æäº¤åä¸è\r\n    // 3. ç¬¬ä¸æ¬¡æäº¤æªæåï¼æå¡ç«¯è¿åå¤ä¸ªæµç¨å®ä¹ï¼éè¦äº¤äºåç¬¬äºæ¬¡æäº¤å®¡æ¹ï¼ç¬¬äºæ¬¡æäº¤ä¼åºç°æåµ1åæåµ2\r\n\r\n    return action$.pipe(\r\n      map((result): ExcutionResponse => {\r\n        if (result && result.returnValue && result.returnValue.excutionResponse) {\r\n          var wfResponse: ExcutionResponse = result.returnValue.excutionResponse;\r\n          return wfResponse;\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response && response.procInstId) {\r\n          if (this.repository) {\r\n            const updating$ = this.repository.updateById(bizBillID);\r\n            return updating$.pipe(tap(() => {\r\n              this.formLoadingService.hide();\r\n              // this.notifyService.info(this.languageService.submitSuccess);\r\n              FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            }), map(() => {\r\n              return response;\r\n            }));\r\n          } else {\r\n            this.formLoadingService.hide();\r\n            // this.notifyService.info(this.languageService.submitSuccess);\r\n            FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            return of(response);\r\n          }\r\n        } else {\r\n          return of(response);\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response.needInteraction) {\r\n          return from(new Promise((resolve) => {\r\n            this.submitter.excute(response, (interactionResponse: InteractionResponse) => {\r\n              // å¦ææ­¤æ¬¡æªæäº¤ï¼èéæ©åå¾å°äºæµç¨å®ä¹IDï¼åå¨æ­¤æäº¤å®¡æ¹\r\n              if (!response.procInstId && interactionResponse.processDefinitionId) {\r\n                this.submitApprove(bizBillID, interactionResponse).subscribe(() => {\r\n                  resolve();\r\n                });\r\n              } else {\r\n                resolve();\r\n              }\r\n            });\r\n          }));\r\n        } else {\r\n          return of(null);\r\n        }\r\n      }),\r\n      catchError(\r\n        error => {\r\n          this.formLoadingService.hide();\r\n          // this.formErrorService.exception(this.languageService.submitFaild, error);\r\n          return of(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * æäº¤å®¡æ¹(å¸¦å¥å£åæ®)\r\n   * @param bizBillID ä¸å¡åæ®Id\r\n   * @param bizDefKey å¥å£åæ®Id\r\n   * @param options options\r\n   * @param interactionResult äº¤äºç»æ\r\n   */\r\n\r\n  public submitApproveWithBizDefKey(bizBillID: string, bizDefKey: string, options?: any, interactionResult?: InteractionResponse): Observable<any> {\r\n    if (!bizBillID) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.warning(this.languageService.bizDefKeyRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    try {\r\n      if (options && typeof (options) === 'string') {\r\n        options = JSON.parse(options);\r\n      }\r\n    } catch (e) {\r\n      throw new Error('ArgumentError:options not a valid json string.');\r\n    }\r\n\r\n    const actionUri = 'submittoapprovewithpayload';\r\n\r\n    const restService = this.beActionService.getRestService();\r\n\r\n    const body: BodyWithRequestInfo = {\r\n      requestInfo: restService.buildRequestInfo(),\r\n      approvePayload: {\r\n        startProcessPayload: {\r\n          bizDefKey: bizDefKey,\r\n          dataId: bizBillID,\r\n          name: options && options.name || '',\r\n          variables: options && options.variables || {}\r\n        }\r\n      }\r\n    };\r\n    if (interactionResult) {\r\n      body.approvePayload.startProcessPayload.processDefinitionId = interactionResult.processDefinitionId;\r\n      body.approvePayload.startProcessPayload.processDefinitionKey = interactionResult['processDefinitionKey'];\r\n    }\r\n    this.formLoadingService.show();\r\n\r\n    // æ·»å æç¤º\r\n    const action$ = this.beActionService.invokeAction(actionUri, 'PUT', null, null, body);\r\n    // ç®ååå«ä¸ç§æåµï¼\r\n    // 1. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾id\r\n    // 2. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾idï¼å¹¶è¿åå¤ä¸ªåä¸èï¼äº¤äºæ¶æäº¤åä¸è\r\n    // 3. ç¬¬ä¸æ¬¡æäº¤æªæåï¼æå¡ç«¯è¿åå¤ä¸ªæµç¨å®ä¹ï¼éè¦äº¤äºåç¬¬äºæ¬¡æäº¤å®¡æ¹ï¼ç¬¬äºæ¬¡æäº¤ä¼åºç°æåµ1åæåµ2\r\n\r\n    return action$.pipe(\r\n      map((result): ExcutionResponse => {\r\n        if (result && result.returnValue && result.returnValue.excutionResponse) {\r\n          const wfResponse: ExcutionResponse = result.returnValue.excutionResponse;\r\n          return wfResponse;\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response && response.procInstId) {\r\n          if (this.repository) {\r\n            const updating$ = this.repository.updateById(bizBillID);\r\n            return updating$.pipe(tap(() => {\r\n              this.formLoadingService.hide();\r\n              // this.notifyService.info(this.languageService.submitSuccess);\r\n              FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            }), map(() => {\r\n              return response;\r\n            }));\r\n          } else {\r\n            this.formLoadingService.hide();\r\n            // this.notifyService.info(this.languageService.submitSuccess);\r\n            FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            return of(response);\r\n          }\r\n        } else {\r\n          return of(response);\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response.needInteraction) {\r\n          return from(new Promise((resolve) => {\r\n            this.submitter.excute(response, (interactionResponse: InteractionResponse) => {\r\n              // å¦ææ­¤æ¬¡æªæäº¤ï¼èéæ©åå¾å°äºæµç¨å®ä¹IDï¼åå¨æ­¤æäº¤å®¡æ¹\r\n              if (!response.procInstId && interactionResponse.processDefinitionId) {\r\n                this.submitApproveWithBizDefKey(bizBillID, bizDefKey, options, interactionResponse).subscribe(() => {\r\n                  resolve();\r\n                });\r\n              } else {\r\n                resolve();\r\n              }\r\n            });\r\n          }));\r\n        } else {\r\n          return of(null);\r\n        }\r\n      }),\r\n      catchError(\r\n        error => {\r\n          this.formLoadingService.hide();\r\n          // this.formErrorService.exception(this.languageService.submitFaild, error);\r\n          return of(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * æäº¤å®¡æ¹(å¸¦å¥å£åæ®ä½¿ç¨wfæ§ä»¶)\r\n   * @param bizBillID ä¸å¡åæ®Id\r\n   * @param bizDefKey å¥å£åæ®Id\r\n   * @param options ä¸ä¸æåæ°\r\n   * @param variables å¯éåæ°\r\n   */\r\n  public submitApproveWithBizDefKeyUseControl(bizBillID: string, bizDefKey: string, options: any = {}, variables?: any) {\r\n    if (!bizBillID) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.warning(this.languageService.bizDefKeyRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!options || typeof options !== 'object') {\r\n      options = {};\r\n    }\r\n    const payload: any = {\r\n      dataId: bizBillID,\r\n      bizDefKey,\r\n      ...options\r\n    };\r\n    // å¤çvariablesåæ°\r\n    if (variables) {\r\n      if (variables.startsWith('{') && variables.endsWith('}')) {\r\n        try {\r\n          variables = JSON.parse(variables);\r\n        } catch {\r\n          variables = {};\r\n        }\r\n      }\r\n      payload.variables = variables;\r\n    }\r\n    return this.wfTaskHandlerService && this.wfTaskHandlerService.startProcess(payload);\r\n  }\r\n  /**\r\n   * å­è¡¨æäº¤å®¡æ¹\r\n   * @param bizDefKey å¥å£åæ®Id\r\n   * @param bizId ä¸å¡åæ®Idï¼ä¸»è¡¨ï¼\r\n   * @param childBizId ä¸å¡åæ®Idï¼ä»è¡¨ï¼\r\n   * @param options ä¸ä¸æåæ°\r\n   * @param variables å¯éåæ°\r\n   */\r\n  public childSubmitApproveWithBizDefKey(bizDefKey: string, bizId: string, childBizId: string, options: any = {}, variables?: any): Observable<any> {\r\n    // å¥å£åæ®ä¸è½ä¸ºç©º\r\n    if (!bizDefKey) {\r\n      this.notifyService.warning(this.languageService.bizDefKeyRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // ä¸»ä¸å¡åæ®Idä¸è½ä¸ºç©º\r\n    if (!bizId) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // ä»è¡¨ä¸å¡åæ®Idä¸è½ä¸ºç©º\r\n    if (!childBizId) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyChildBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!options || typeof options !== 'object') {\r\n      options = {};\r\n    }\r\n    const payload: any = {\r\n      dataId: `${bizId},${childBizId}`,\r\n      bizDefKey,\r\n      ...options\r\n    };\r\n    // å¤çvariablesåæ°\r\n    if (variables) {\r\n      if (variables.startsWith('{') && variables.endsWith('}')) {\r\n        try {\r\n          variables = JSON.parse(variables);\r\n        } catch {\r\n          variables = {};\r\n        }\r\n      }\r\n      payload.variables = variables;\r\n    }\r\n    return this.wfTaskHandlerService && this.wfTaskHandlerService.startProcess(payload);\r\n  }\r\n  /**\r\n   * åæ¶å®¡æ¹\r\n   * @deprecated å·²åºå¼ï¼è¯·ä½¿ç¨cancelSubmit\r\n   */\r\n  public cancelApprove(bizBillID: string): Observable<any> {\r\n    if (!bizBillID) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    const actionUri = 'canceltosubmitvoaction';\r\n\r\n    const restService = this.beActionService.getRestService();\r\n\r\n    const body = {\r\n      requestInfo: restService.buildRequestInfo(),\r\n      bizInstID: bizBillID,\r\n    };\r\n\r\n    this.formLoadingService.show();\r\n\r\n    const action$ = this.beActionService.executeAction(actionUri, 'PUT', null, null, body);\r\n    return action$.pipe(\r\n      switchMap(() => {\r\n        if (this.repository) {\r\n          const updating$ = this.repository.updateById(bizBillID);\r\n          return updating$.pipe(tap(() => {\r\n            this.formLoadingService.hide();\r\n            // this.notifyService.info(this.languageService.cancelApproveSuccess);\r\n            FormNotifyStrategyService.success(this.notifyService, this.languageService.cancelApproveSuccess);\r\n          }));\r\n        } else {\r\n          this.formLoadingService.hide();\r\n          // this.notifyService.info(this.languageService.cancelApproveSuccess);\r\n          FormNotifyStrategyService.success(this.notifyService, this.languageService.cancelApproveSuccess);\r\n          return of();\r\n        }\r\n      }\r\n      ),\r\n      catchError(error => {\r\n        this.formLoadingService.hide();\r\n        // this.formErrorService.exception(this.languageService.cancelApproveFailed, error);\r\n        return of(error);\r\n      }));\r\n  }\r\n  /**\r\n   * åæ¶å®¡æ¹(æ¯æä¸»è¡¨ãå­è¡¨)\r\n   * @param procInstId æµç¨å®ä¾Id\r\n   */\r\n  public cancelSubmit(procInstId: string): Observable<any> {\r\n    if (!procInstId) {\r\n      this.notifyService.warning(this.languageService.procInsIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    return this.wfTaskHandlerService && this.wfTaskHandlerService.cancelSubmit({ procInstId: procInstId });\r\n  }\r\n  /**\r\n   * æ¥çæµç¨å¾\r\n   * @param procInstId æµç¨å®ä¾ID\r\n   */\r\n  viewProcess(procInstId: string) {\r\n    if (this.flowchartService) {\r\n      if (!procInstId) {\r\n        this.notifyService.warning(this.languageService.noProcessInstanceId, { hideTitle: true });\r\n        return;\r\n      }\r\n      return this.flowchartService.viewFlowChart(procInstId);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * è½¬æ¢éç½®å¤§å°å\r\n   * @param jsonObj Object\r\n   * @deprecated\r\n   */\r\n  private switchPrefixLetter(jsonObj: any, toUpper: boolean): any {\r\n    if (typeof (jsonObj) === 'object' && !!jsonObj) {\r\n      if (Array.isArray(jsonObj)) {\r\n        for (var i = 0; i < jsonObj.length; i++) {\r\n          this.switchPrefixLetter(jsonObj[i], toUpper);\r\n        }\r\n      } else {\r\n        for (const key of Object.keys(jsonObj)) {\r\n          var newKey = (toUpper ? key.substring(0, 1).toUpperCase() : key.substring(0, 1).toLowerCase()) + key.substring(1);\r\n          jsonObj[newKey] = jsonObj[key];\r\n          if (typeof jsonObj[key] === 'object') {\r\n            this.switchPrefixLetter(jsonObj[key], toUpper);\r\n          }\r\n          delete (jsonObj[key]);\r\n        }\r\n      }\r\n    }\r\n    return jsonObj;\r\n  }\r\n}\r\nexport { ApproveService };\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { EMPTY } from 'rxjs';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { CommandContext, Entity, FrameContext } from '@farris/devkit';\r\nimport { CloudprintService, OutputOptions, SourceOptions, OutputType, FileType, SourceFilterOptions, PrintType } from '@gsp-svc/cloudprint';\r\nimport { FormNotifyService } from './form-notify.service';\r\n// tslint:disable: unified-signatures\r\n// tslint:disable: max-line-length\r\n/**\r\n * æå°æå¡\r\n * @Scope FrameComponent\r\n */\r\n@Injectable()\r\nclass PrintService {\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    private languageService: LanguageService,\r\n    private printService: CloudprintService,\r\n    @Optional() private formNotifyService: FormNotifyService,\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * æå°åæ®\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param bizBillId ä¸å¡åæ®æ è¯\r\n   */\r\n  public printSingle(beMetaId: string, bizBillId: string) {\r\n    if (!bizBillId) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    return this.printArray(beMetaId, [bizBillId]);\r\n  }\r\n  /**\r\n   * æå°åæ®ï¼éè¿idæidsï¼\r\n   * @param beMetaId beåæ°æ®Id\r\n   * @param ids åæ®idæids\r\n   */\r\n  public printByIds(beMetaId: string, ids: string) {\r\n    if (!ids) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    const dataIds: Array<string> = ids.split(',').filter(item => item);\r\n    return this.printArray(beMetaId, dataIds);\r\n  }\r\n  /**\r\n   * æå°åæ®ï¼å¸¦ç»´åº¦ï¼\r\n   * @param beMetaId beåæ°æ®Id\r\n   * @param ids åæ®idæids\r\n   * @param dim1 ç»´åº¦1å¼\r\n   * @param dim2 ç»´åº¦2å¼\r\n   * @param billCategoryId åæ®ç±»åId\r\n   */\r\n  public printByIdsWithDimension(beMetaId: string, ids: string, dim1: string, dim2: string, billCategoryId?: string) {\r\n    if (!ids) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    const dataIds: Array<string> = ids.split(',').filter(item => item);\r\n    return this.printArray(beMetaId, dataIds, dim1, dim2, billCategoryId);\r\n  }\r\n  /**\r\n   * æå°å¤ä¸ªåæ®\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param dataIds ä¸å¡åæ®æ è¯æ°ç»\r\n   * @param dim1 ç»´åº¦1\r\n   * @param dim2 ç»´åº¦2\r\n   * @param billCategoryId ä¸å¡åæ®ç±»åId\r\n   */\r\n  public printArray(beMetaId: string, dataIds: string[], dim1?: any, dim2?: any, billCategoryId?: string) {\r\n    if (!dataIds || dataIds.length === 0) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    const sourceOptions: SourceOptions = this.buildSourceOptions({\r\n      dataIds: dataIds,\r\n      sourceId: beMetaId\r\n    });\r\n\r\n    const outputOptions: OutputOptions = this.buildOutputOptions();\r\n\r\n    if (typeof dim1 !== 'undefined') {\r\n      sourceOptions.FirstDimensionVal = dim1;\r\n    }\r\n    if (typeof dim2 !== 'undefined') {\r\n      sourceOptions.SecondDimensionVal = dim2;\r\n    }\r\n    if (typeof billCategoryId !== 'undefined') {\r\n      sourceOptions.billCategoryId = billCategoryId;\r\n    }\r\n    return this.printService.outputBEData(sourceOptions, outputOptions, 'tab');\r\n  }\r\n\r\n  /**\r\n   * æç§BEåæ°æ¹å¼æ¹éæå°åæ®\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param filterCondition è¿æ»¤æ¡ä»¶\r\n   * @param sortCondition æåºæ¡ä»¶\r\n   * @param includeChildData åå«å­è¡¨æ°æ®\r\n   */\r\n  public printMulti(beMetaId: string, filterCondition: string, sortCondition: string, includeChildData: boolean = true) {\r\n    const entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };\r\n    if (filterCondition) {\r\n      // ç»ä¸çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n      const filters = JSON.parse(filterCondition);\r\n      if (filters && filters.length > 0) {\r\n        filters[filters.length - 1].Relation = 0;\r\n      }\r\n      entryFilter.filterConditions = filters;\r\n    }\r\n\r\n    if (sortCondition) {\r\n      entryFilter.sortConditions = JSON.parse(sortCondition);\r\n    }\r\n    // sfo:SourceFilterOptions\r\n    const sourceFilterOptions: SourceFilterOptions = this.buildSourceFilterOptions({ sourceId: beMetaId, entryFilter, includeChildData });\r\n    const outputOptions: OutputOptions = this.buildOutputOptions();\r\n    return this.printService.outputBEDataWithFilter(sourceFilterOptions, outputOptions, 'tab');\r\n  }\r\n  /**\r\n   * æç§BEåæ°æ¹å¼æ¹éæå°åæ®(å¸¦ç»´åº¦)\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param filterCondition è¿æ»¤æ¡ä»¶\r\n   * @param sortCondition æåºæ¡ä»¶\r\n   * @param dim1 ç»´åº¦1value\r\n   * @param dim2 ç»´åº¦2value\r\n   * @param billCategoryId ä¸å¡åæ®ç±»åId\r\n   * @param includeChildData åå«å­è¡¨æ°æ®\r\n   */\r\n  public printMultiWithDimension(beMetaId: string, filterCondition: string, sortCondition: string, dim1: string, dim2: string, billCategoryId?: string, includeChildData: boolean = true) {\r\n    const entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };\r\n    if (filterCondition) {\r\n      // ç»ä¸çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n      const filters = JSON.parse(filterCondition);\r\n      if (filters && filters.length > 0) {\r\n        filters[filters.length - 1].Relation = 0;\r\n      }\r\n      entryFilter.filterConditions = filters;\r\n    }\r\n\r\n    if (sortCondition) {\r\n      entryFilter.sortConditions = JSON.parse(sortCondition);\r\n    }\r\n    const sfo: SourceFilterOptions = this.buildSourceFilterOptions({ sourceId: beMetaId, entryFilter, includeChildData });\r\n    if (typeof dim1 !== 'undefined') {\r\n      sfo.FirstDimensionVal = dim1;\r\n    }\r\n    if (typeof dim2 !== 'undefined') {\r\n      sfo.SecondDimensionVal = dim2;\r\n    }\r\n    if (typeof billCategoryId !== 'undefined') {\r\n      sfo.billCategoryId = billCategoryId;\r\n    }\r\n    const outputOptions: OutputOptions = this.buildOutputOptions();\r\n    return this.printService.outputBEDataWithFilter(sfo, outputOptions, 'tab');\r\n  }\r\n  /**\r\n   * æé SourceOptions\r\n   * @param options options\r\n   */\r\n  private buildSourceOptions(options: { dataIds: string[], sourceId: string, [prop: string]: any }): SourceOptions {\r\n    const so: SourceOptions = {\r\n      DataIds: options && options.dataIds || undefined,\r\n      SourceId: options && options.sourceId || undefined,\r\n      FirstDimensionVal: options && options.dim1 || undefined,\r\n      SecondDimensionVal: options && options.dim2 || undefined,\r\n      RetrieveParam: options && options.retrieveParam || undefined,\r\n      FormatId: options && options.formatId || undefined,\r\n      billCategoryId: options && options.billCategoryId || undefined,\r\n      ServiceUnit: options && options.serviceUnit || undefined,\r\n      currentPage: options && options.currentPage || undefined,\r\n      pageRowCount: options && options.pageRowCount || undefined,\r\n      queryType: options && options.queryType || undefined,\r\n      queryServiceId: options && options.queryServiceId || undefined,\r\n      queryParam: options && options.queryParam || undefined\r\n    };\r\n    return so;\r\n  }\r\n  /**\r\n   * æé OutputOptions\r\n   * @param options options\r\n   */\r\n  private buildOutputOptions(options?: { [prop: string]: any }): OutputOptions {\r\n    const oo: OutputOptions = {\r\n      OutputType: options && options.outputType || OutputType.PRINT,\r\n      FileType: options && options.fileType || FileType.Html5,\r\n      Path: options && options.path || undefined,\r\n      DeviceId: options && options.deviceId || undefined,\r\n      printJob: options && options.printJob || undefined,\r\n      printerName: options && options.printerName || undefined,\r\n      printSetting: options && options.printSetting || undefined,\r\n      printType: options && options.printType || PrintType.Form\r\n    };\r\n    return oo;\r\n  }\r\n  /**\r\n   * æé SourceFilterOptions\r\n   * @param options options\r\n   */\r\n  private buildSourceFilterOptions(options: { sourceId: string, [prop: string]: any }): SourceFilterOptions {\r\n    const entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };\r\n    const sfo: SourceFilterOptions & { [prop: string]: any } = {\r\n      SourceId: options.sourceId,\r\n      EntityFilter: options && options.entryFilter || entryFilter,\r\n      FirstDimensionVal: options && options.dim1 || undefined,\r\n      SecondDimensionVal: options && options.dim2 || undefined,\r\n      FormatId: options && options.formatId || undefined,\r\n      ServiceUnit: options && options.serviceUnit || undefined,\r\n      billCategoryId: options && options.billCategoryId || undefined,\r\n      currentPage: options && options.currentPage || undefined,\r\n      pageRowCount: options && options.pageRowCount || undefined,\r\n      queryParam: options && options.queryParam || undefined,\r\n      queryServiceId: options && options.queryServiceId || undefined,\r\n      queryType: options && options.queryType || undefined,\r\n      includeChildData: options && options.hasOwnProperty('includeChildData') ? options.includeChildData : true\r\n    };\r\n    return sfo;\r\n  }\r\n  /**\r\n   * å±ç¤ºéè¯¯æ¶æ¯\r\n   * @param message éè¯¯æ¶æ¯\r\n   */\r\n  private showWarning(message: string) {\r\n    if (this.notifyService) {\r\n      this.notifyService.warning(message, { hideTitle: true });\r\n    } else if (this.msgService) {\r\n      this.msgService.error(message);\r\n    }\r\n  }\r\n  private get notifyService(): FormNotifyService | null {\r\n    if (this.formNotifyService) {\r\n      return this.formNotifyService;\r\n    } else if (this.injector) {\r\n      return this.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    }\r\n    return null;\r\n  }\r\n  private get commandContext(): CommandContext | null {\r\n    return this['context'] || null;\r\n  }\r\n  private get frameContext(): FrameContext | null {\r\n    return this.commandContext && this.commandContext.frameContext || null;\r\n  }\r\n  private get injector(): Injector | null {\r\n    return this.frameContext && this.frameContext.injector || null;\r\n  }\r\n}\r\n\r\nexport { PrintService };\r\n","/**\r\n * éä»¶ä¿¡æ¯å®ä¹\r\n */\r\ninterface AttachmentInfo {\r\n\r\n  /**\r\n   * éä»¶id\r\n   */\r\n  attachmentId: string;\r\n\r\n  /**\r\n   * éä»¶åç§°\r\n   */\r\n  fileName: string;\r\n}\r\n\r\n\r\n/**\r\n * æå¡å¨ç«¯æéçéä»¶ä¿¡æ¯å®ä¹\r\n */\r\ninterface ServerAttachmentInfo {\r\n\r\n  /**\r\n   * è¡¨åè·¯å¾\r\n   */\r\n  NodeCodes: string[];\r\n\r\n  /**\r\n   * ä¸»é®è·¯å¾\r\n   */\r\n  HiretryIds: string[];\r\n\r\n  /**\r\n   * éä»¶idæ°ç»ï¼æ¹éæ°å¢æ¶ä½¿ç¨ï¼\r\n   */\r\n  AttachmentIds?: string[];\r\n\r\n  /**\r\n   * éä»¶idï¼æ´æ°æ¶ä½¿ç¨ï¼\r\n   */\r\n  AttachmentId?: string;\r\n}\r\n/**\r\n * éä»¶udtæåºå­æ®µ\r\n */\r\nconst ATTACHMENT_ORDER_FIELD = 'fileSortOrder';\r\n\r\nexport { AttachmentInfo, ServerAttachmentInfo, ATTACHMENT_ORDER_FIELD };\r\n","import { UploadFileInfo } from '@gsp-svc/formdoc-upload';\r\nimport { AttachmentInfo } from './types';\r\n\r\n/**\r\n * éä»¶ä¿¡æ¯å¤çå·¥å·ç±»\r\n */\r\nclass AttachmentUtil {\r\n\r\n  /**\r\n   * è½¬æ¢ä¸ºéä»¶ä¿¡æ¯æ°ç»\r\n   */\r\n  public static convertToAttachmentInfos(fileInfos: UploadFileInfo[]): AttachmentInfo[] {\r\n    if (!fileInfos) {\r\n      return [];\r\n    }\r\n    const attachmentInfos: AttachmentInfo[] = fileInfos.map((fileInfo: UploadFileInfo) => {\r\n      return this.convertToAttachmentInfo(fileInfo);\r\n    });\r\n    return attachmentInfos;\r\n  }\r\n\r\n  /**\r\n   * è½¬æ¢ä¸ºéä»¶ä¿¡æ¯\r\n   */\r\n  public static convertToAttachmentInfo(fileInfo: UploadFileInfo): AttachmentInfo {\r\n    const attachmentInfo: AttachmentInfo = {\r\n      attachmentId: fileInfo.metadataId,\r\n      fileName: fileInfo.fileName\r\n    };\r\n    return attachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * è·åéä»¶åè¡¨ä¸­çç¬¬ä¸ä¸ªéä»¶\r\n   */\r\n  public static getFirstAttachmentInfo(attachmentInfos: AttachmentInfo[]) {\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      return;\r\n    }\r\n    const firstAttachmentInfo = attachmentInfos[0];\r\n    return firstAttachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * æåéä»¶idæ°ç»\r\n   */\r\n  public static peekAttachmentIds(attachmentInfos: AttachmentInfo[]) {\r\n    if (!attachmentInfos) {\r\n      attachmentInfos = [];\r\n    }\r\n    const attachmentIds = attachmentInfos.map((attachmentInfo: AttachmentInfo) => {\r\n      return attachmentInfo.attachmentId;\r\n    });\r\n\r\n    return attachmentIds;\r\n  }\r\n\r\n}\r\n\r\nexport { AttachmentUtil };\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of } from 'rxjs';\r\nimport { tap, switchMap, map } from 'rxjs/operators';\r\nimport { FrameContext, Entity, BindingData, BindingPathConverter } from '@farris/devkit';\r\nimport { BefRepository, BefDataPathUtil, ResponseInfo } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { AttachmentInfo, ServerAttachmentInfo } from './types';\r\nimport { AttachmentUtil } from './attachment.util';\r\n\r\n/**\r\n * éä»¶è°ç¨\r\n */\r\n@Injectable()\r\nclass AttachmentDataService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  constructor(private frameContext: FrameContext, private loadingService: FormLoadingService) {\r\n  }\r\n\r\n  /**\r\n   * æ´æ°éä»¶ä¿¡æ¯\r\n   */\r\n  public updateRow(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/updateattachment`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const body = {\r\n      updateAttachInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * éè¿å±æ§åæ´æ°éä»¶ä¿¡æ¯\r\n   * @param attachmentInfoFieldPath éä»¶å­æ®µ\r\n   * @param attachmentInfo éä»¶ä¿¡æ¯\r\n   */\r\n  public updateRowWithPropertyName(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/updateattachmentwithproptyname`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const propertyName = attachmentInfoFieldPath.split('/').filter(p => p).pop();\r\n    const body = {\r\n      updateAttachInfo: serverAttachInfo,\r\n      propertyName,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * å é¤éä»¶\r\n   * @param attachmentInfoFieldPath \r\n   * @param attachmentInfo \r\n   * @returns \r\n   */\r\n  public removeAttachment(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo) {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/deleteattachment`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const propertyName = attachmentInfoFieldPath.split('/').filter(p => p).pop();\r\n    const body = {\r\n      deleteAttachInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo(),\r\n      propertyName,\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¹éåå»ºéä»¶è¡æ°æ®\r\n   */\r\n  public updateRows(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[]): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/batchuploadattachment`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.appendAttachmentInfosToClient(responseInfo.returnValue, isRootEntity);\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¹éåå»ºéä»¶è¡æ°æ®\r\n   */\r\n  public updateRowsWithConfigs(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[], configs: { [prop: string]: any }): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/batchuploadattachment`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    // const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.appendAttachmentInfos(responseInfo.returnValue, configs);\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ ¹æ®å±æ§åæ¹éåå»ºéä»¶è¡æ°æ®\r\n   */\r\n  public updateRowsWithPropertyName(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[]): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/batchuploadattachmentwithproptyname`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n    const propertyName = attachmentInfoFieldPath.split('/').filter(p => p).pop();\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo,\r\n      propertyName,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.appendAttachmentInfosToClient(responseInfo.returnValue, isRootEntity);\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åå»ºæå¡å¨ç«¯éè¦çæ´æ°ä¿¡æ¯\r\n   */\r\n  private createUpdateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): ServerAttachmentInfo {\r\n\r\n    const attachmentId = attachmentInfo.attachmentId;\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForUpdate(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo: ServerAttachmentInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: [attachmentId],\r\n      AttachmentId: attachmentId\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * åå»ºæå¡å¨ç«¯éè¦çæ¹éæ°å¢éä»¶ä¿¡æ¯\r\n   */\r\n  private createBatchCreateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo[]): ServerAttachmentInfo {\r\n    const attachmentIds = AttachmentUtil.peekAttachmentIds(attachmentInfo);\r\n\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForAdd(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: attachmentIds,\r\n      AttachmentId: null\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * åæ­¥æå¡å¨ç«¯ææ°ä¿¡æ¯å°å®¢æ·ç«¯\r\n   * @todo:\r\n   * 1ãä¸»å¯¹è±¡æ¹éæ°å¢æ¶ä¸æ¯æ\r\n   */\r\n  public syncAttachmentInfosToClient() {\r\n    const rootDataId = this.bindingData.list.currentId;\r\n    return this.repository.updateEntityById(rootDataId);\r\n  }\r\n\r\n  /**\r\n   * è¿½å ä¸»è¡¨æ°æ®å°å®¢æ·ç«¯\r\n   */\r\n  public appendAttachmentInfosToClient(listData: any[], isRootEntity: boolean): Observable<any[]> {\r\n    if (isRootEntity === true) {\r\n      const entities = this.repository.buildEntities(listData);\r\n      this.repository.entityCollection.addEntities(entities);\r\n      return of(listData);\r\n    } else {\r\n      const rootDataId = this.bindingData.list.currentId;\r\n      return this.repository.updateEntityById(rootDataId).pipe(\r\n        map(() => listData)\r\n      );\r\n    }\r\n  }\r\n  public appendAttachmentInfos(listData: any[], keyValues: { [prop: string]: any }): Observable<any[]> {\r\n    const entities = this.repository.buildEntities(listData);\r\n    this.repository.entityCollection.addEntities(entities);\r\n    // æ´æ°å®ä½ä½¿ä¹äº§çåæ´é\r\n    this.updateEntities(entities, keyValues);\r\n    return of(listData);\r\n  }\r\n  private updateEntities(entities: Entity[], keyValues: { [prop: string]: any }) {\r\n    entities.forEach((entity: Entity) => {\r\n      this.updateEntity(entity, keyValues);\r\n    });\r\n  }\r\n  private updateEntity(target: Entity, keyValues: { [prop: string]: any }) {\r\n    Object.keys(keyValues).forEach((key: string) => {\r\n      this.setValueByPath(target, key, keyValues[key]);\r\n    });\r\n  }\r\n  private setValueByPath(target: object, path: string, value: any) {\r\n    if (target) {\r\n      const paths = path.split('.');\r\n      if (paths.length <= 1) {\r\n        target[path] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport { AttachmentDataService };\r\n","import { Injectable, InjectFlags, Optional } from '@angular/core';\r\nimport { Observable, from, of, empty, EMPTY } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { UploadDialogService, UploadFileInfo, UploadLimit, DownloadService, FileState } from '@gsp-svc/formdoc-upload';\r\nimport { FileViewerService } from '@gsp-svc/file-viewer';\r\nimport { FrameContext, BindingData, BindingPathConverter, BindingList, DataPathUtil, DataPathCreator, EntityList, Entity } from '@farris/devkit';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { AttachmentUtil } from './attachment.util';\r\nimport { AttachmentDataService } from './attachment-data.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { BasePathService } from '@farris/rtf';\r\n\r\n// tslint:disable: max-line-length\r\n/**\r\n * éä»¶æå¡\r\n */\r\n@Injectable()\r\nclass AttachmentService {\r\n  /**\r\n   * é»è®¤æ ¹ç®å½\r\n   */\r\n  private defaultRootDirId = '';\r\n\r\n  /**\r\n   * é»è®¤ç¶è·¯å¾\r\n   */\r\n  private get defaultParentDirName(): string {\r\n    return this.frameContext.bindingData.list.currentId;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * å¤è¯­æå¡\r\n   */\r\n  private languageService: LanguageService;\r\n\r\n  /**\r\n   * éä»¶é¢è§æå¡\r\n   */\r\n  private fileViewerService: FileViewerService;\r\n\r\n  /**\r\n   * å®ä½æå¡\r\n   */\r\n  private entityService: EntityService;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private attachDataService: AttachmentDataService,\r\n    private notifyService: FormNotifyService,\r\n    private uploadDialogService: UploadDialogService,\r\n    @Optional() private downloadService: DownloadService\r\n  ) {\r\n    this.setLanguageService();\r\n    this.fileViewerService = this.frameContext.injector.get<FileViewerService>(FileViewerService, null, InjectFlags.Optional);\r\n    this.entityService = this.frameContext.injector.get<EntityService>(EntityService, null, InjectFlags.Optional);\r\n    if (!this.downloadService && typeof DownloadService !== 'undefined') {\r\n      this.downloadService = this.frameContext.injector.get<DownloadService>(DownloadService, null);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®è¯­è¨æå¡\r\n   */\r\n  private setLanguageService() {\r\n    const injector = this.frameContext.injector;\r\n    this.languageService = injector.get<LanguageService>(LanguageService, null, InjectFlags.Optional);\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä¸ä¼ åä¸ªæä»¶\r\n   * @param attachmentIdPath éä»¶åç å­æ®µçè·¯å¾ï¼å½¢å¦/attachInfo/attachmentIdï¼\r\n   * @param attachmentNamePath éä»¶åç§°å­æ®µçè·¯å¾\r\n   */\r\n  public uploadAndUpdateRow(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string, id?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    uploadLimit.fileCount = 1;\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n    // è·åèçéä»¶idæ°ç»\r\n    const attachmentIdList = [];\r\n    let currentItem = null;\r\n    if (id) {\r\n      // ä¿®æ­£å½åè¡\r\n      const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n      if (bindingList.currentId !== id) {\r\n        bindingList.setCurrentId(id, true, true);\r\n      }\r\n      // å¦ææå®äºidåè·åæå®idçè¡\r\n      currentItem = this.getSpecialRow(attachmentInfoFieldPath, id);\r\n    } else {\r\n      // æ²¡ææå®åä½¿ç¨å½åè¡ï¼å¯è½å­å¨å½åè¡åäºä»¶è¡ä¸ä¸è´çæåµï¼æ­¤æ¶åºè¯¥å¨å½ä»¤ä¸­ä¼ éidåæ°\r\n      currentItem = this.getCurrentRow(attachmentInfoFieldPath);\r\n    }\r\n    if (currentItem && currentItem.primaryKeyValue) {\r\n      const attachmentIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, [currentItem.primaryKeyValue]);\r\n      if (attachmentIds && attachmentIds.length > 0) {\r\n        attachmentIdList.push.apply(attachmentIdList, attachmentIds);\r\n      }\r\n    } else {\r\n      this.notifyService.warning(this.languageService.plsSelectUpdateRow, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit, attachmentIdList));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return empty();\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        // æ¯å¦ä¸ä¼ å¤æ­\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        const firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);\r\n        return this.attachDataService.updateRow(attachmentInfoFieldPath, firstAttachmentInfo);\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸ä¼ åä¸ªæä»¶ï¼æ¯æå¤åï¼\r\n   * @param attachmentInfoFieldPath éä»¶åç å­æ®µçè·¯å¾ï¼å½¢å¦/attachInfo/attachmentIdï¼\r\n   * @param rootDirId éä»¶å­å¨æ ¹ç®å½\r\n   * @param parentDirName éä»¶å­å¨ç®å½\r\n   * @param fileType æä»¶ç±»åï¼like .txt,.docx\r\n   */\r\n  public uploadAndUpdateRowWithPropertyName(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string, id?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    uploadLimit.fileCount = 1;\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n\r\n    // è·åèçéä»¶idæ°ç»\r\n    const attachmentIdList = [];\r\n    let currentItem = null;\r\n    if (id) {\r\n      // ä¿®æ­£å½åè¡\r\n      const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n      if (bindingList.currentId !== id) {\r\n        bindingList.setCurrentId(id, true, true);\r\n      }\r\n      // å¦ææå®äºidåè·åæå®idçè¡\r\n      currentItem = this.getSpecialRow(attachmentInfoFieldPath, id);\r\n    } else {\r\n      // æ²¡ææå®åä½¿ç¨å½åè¡ï¼å¯è½å­å¨å½åè¡åäºä»¶è¡ä¸ä¸è´çæåµï¼æ­¤æ¶åºè¯¥å¨å½ä»¤ä¸­ä¼ éidåæ°\r\n      currentItem = this.getCurrentRow(attachmentInfoFieldPath);\r\n    }\r\n    if (currentItem && currentItem.primaryKeyValue) {\r\n      const attachmentIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, [currentItem.primaryKeyValue]);\r\n      if (attachmentIds && attachmentIds.length > 0) {\r\n        attachmentIdList.push.apply(attachmentIdList, attachmentIds);\r\n      }\r\n    } else {\r\n      this.notifyService.warning(this.languageService.plsSelectUpdateRow, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit, attachmentIdList));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        // æ¯å¦ä¸ä¼ å¤æ­\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        const firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);\r\n        return this.attachDataService.updateRowWithPropertyName(attachmentInfoFieldPath, firstAttachmentInfo);\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸ä¼ å¤ä¸ªæä»¶\r\n   */\r\n  public uploadAndBatchAddRows(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        return this.attachDataService.updateRows(attachmentInfoFieldPath, attachmentInfos);\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸ä¼ å¤ä¸ªæä»¶\r\n   */\r\n  public uploadAndBatchAddRowsWithPropertyName(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string, id?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n    if (id) {\r\n      // ä¿®æ­£å½åè¡\r\n      const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n      if (bindingList.currentId !== id) {\r\n        bindingList.setCurrentId(id, true, true);\r\n      }\r\n    }\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        return this.attachDataService.updateRowsWithPropertyName(attachmentInfoFieldPath, attachmentInfos);\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸è½½éä»¶ï¼æ ¹æ®éä»¶idï¼\r\n   */\r\n  public download(attachId: string, rootId?: string): any {\r\n    if (!attachId) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    rootId = rootId || 'default-root';\r\n    const url = this.getDownloadUrl([attachId], rootId);\r\n    // let url = '';\r\n    // if (rootId) {\r\n    //   url = `/api/runtime/dfs/v1.0/formdoc/filecontent?metadataid=${attachId}&rootid=${rootId}`;\r\n    // } else {\r\n    //   url = `/api/runtime/dfs/v1.0/formdoc/download/${attachId}`;\r\n    // }\r\n    window.open(url);\r\n    return of(true);\r\n  }\r\n  /**\r\n   * æ¹éä¸è½½éä»¶ï¼æ ¹æ®éä»¶idæ°ç»ï¼\r\n   */\r\n  public batchDownload(attachIds: string[], rootId: string): any {\r\n    if (!attachIds || attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // åªéæ©ä¸ä¸ªéä»¶æ¶æåä¸ªéä»¶ä¸è½½å¤ç\r\n    if (attachIds.length === 1) {\r\n      return this.download(attachIds[0], rootId);\r\n    }\r\n    // const attachIdsString = JSON.stringify(attachIds);\r\n    // const url = `/api/runtime/dfs/v1.0/formdoc/multiple/download?metadataidlist=${attachIdsString}&rootid=${rootId}`;\r\n    const url = this.getDownloadUrl(attachIds, rootId);\r\n    window.open(url);\r\n    return of(true);\r\n  }\r\n  /**\r\n   * è·åä¸è½½è·¯å¾\r\n   * @param metadataidlist éä»¶idæ°ç»\r\n   * @param rootId rootId\r\n   */\r\n  private getDownloadUrl(metadataidlist: Array<string>, rootId: string): string {\r\n    rootId = rootId || 'default-root';\r\n    if (this.downloadService) {\r\n      if (metadataidlist.length === 1) {\r\n        return this.downloadService.getDownloadUrl(metadataidlist[0], rootId);\r\n      } else {\r\n        const attachIdsString = JSON.stringify(metadataidlist);\r\n        return this.downloadService.getMultipleDownloadUrl(attachIdsString, rootId);\r\n      }\r\n    } else {\r\n      console.warn('å å®å¨é®é¢ï¼éä»¶ä¸è½½æä¾å®å¨æ ¡éªæºå¶ï¼éä»¶ä¸è½½åè½ééæ°ç¼è¯ã');\r\n      if (metadataidlist.length === 1) {\r\n        return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/filecontent?metadataid=${metadataidlist[0]}&rootid=${rootId}`);\r\n      } else {\r\n        const attachIdsString = JSON.stringify(metadataidlist);\r\n        return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/multiple/download?metadataidlist=${attachIdsString}&rootid=${rootId}`);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * ä¸è½½ï¼æ ¹æ®æ°æ®idï¼\r\n   */\r\n  public downloadByDataId(dataId: string, attachmentInfoFieldPath: string, rootId: string): Observable<any> {\r\n    if (!dataId) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const dataIds = [dataId];\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, dataIds);\r\n    if (attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const attachId = attachIds[0];\r\n    return this.download(attachId);\r\n  }\r\n\r\n  /**\r\n   * æ¹éä¸è½½éä»¶\r\n   */\r\n  public batchDownloadByDataIds(dataIds: string[] | string, attachmentInfoFieldPath: string, rootId: string): Observable<any> {\r\n    if (typeof dataIds === 'string' && dataIds && dataIds.length > 0) {\r\n      dataIds = dataIds.split(',').filter(p => p);\r\n    }\r\n    if (!dataIds || Array.isArray(dataIds) === false || dataIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const ids = [].concat(dataIds);\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, ids);\r\n    if (attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    return this.batchDownload(attachIds, rootId);\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®éä»¶UDTå­æ®µçè·¯å¾é¢è§éä»¶\r\n   * @param attachmentInfoFieldPath éä»¶UDTå­æ®µpath\r\n   * @param rootDirId è·ç®å½id\r\n   * @param ids éä»¶id\r\n   */\r\n  public previewByAttachmentInfoFieldPath(attachmentInfoFieldPath: string, rootDirId: string, ids?: any) {\r\n    if (!attachmentInfoFieldPath || !rootDirId) {\r\n      throw new Error('attachmentInfoFieldPathårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    let attachIds = [];\r\n    let dataIds = [];\r\n    if (ids && ids.length > 0) {\r\n      if (typeof (ids) === 'string') {\r\n        dataIds.push(ids);\r\n      } else {\r\n        dataIds = ids;\r\n      }\r\n      attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, dataIds);\r\n    } else {\r\n      attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, null);\r\n    }\r\n    if (attachIds && attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    return this.previewByAttachmentIds(attachIds, rootDirId);\r\n  }\r\n  /**\r\n   * æ ¹æ®éä»¶UDTå­æ®µçè·¯å¾é¢è§å½åè¡çéä»¶\r\n   * @param attachmentInfoFieldPath éä»¶UDTå­æ®µpath\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewByAttachmentInfoFieldPathWithIndex(attachmentInfoFieldPath: string, rootDirId: string): Observable<any> {\r\n    if (!attachmentInfoFieldPath || !rootDirId) {\r\n      throw new Error('attachmentInfoFieldPathårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const currentRow = this.getCurrentRow(attachmentInfoFieldPath);\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentFieldName = parentBindingPathArray.pop();\r\n    if (!currentRow[attachmentFieldName] || !currentRow[attachmentFieldName]['attachmentId']) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, null);\r\n    if (attachIds && attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const attachmentId = this.getCurrentAttachmentId(attachmentInfoFieldPath);\r\n    if (!attachmentId) {\r\n      throw new Error('è¦é¢è§çéä»¶idä¸å­å¨ï¼è¯·ç¡®è®¤');\r\n    } else {\r\n      return this.previewFileListWithIndex(attachIds, rootDirId, attachmentId);\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®ç®å½é¢è§éä»¶\r\n   * @param subDirName ç¶ç®å½åç§°\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewBySubDirName(subDirName: string, rootDirId: string): Observable<any> {\r\n    if (!subDirName || !rootDirId) {\r\n      throw new Error('subDirNameårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const viewer$ = from(this.fileViewerService.viewerFormFile(subDirName, rootDirId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * æ ¹æ®ç®å½é¢è§æå®ç´¢å¼çéä»¶\r\n   * @param attachmentInfoFieldPath éä»¶UDTå­æ®µpath\r\n   * @param subDirName å­ç®å½åç§°\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewBySubDirNameWithIndex(attachmentInfoFieldPath: string, subDirName: string, rootDirId: string): Observable<any> {\r\n    if (!subDirName || !rootDirId) {\r\n      throw new Error('subDirNameårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    // const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, null);\r\n    const attachmentId = this.getCurrentAttachmentId(attachmentInfoFieldPath);\r\n    if (!attachmentId) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const viewer$ = from(this.fileViewerService.viewerFormFileWithIndex(subDirName, rootDirId, attachmentId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * æ ¹æ®éä»¶idæ°ç»é¢è§éä»¶\r\n   * @param attachmentIds éä»¶idæ°ç»\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewByAttachmentIds(attachmentIds: string[], rootDirId: string): Observable<any> {\r\n    const viewer$ = from(this.fileViewerService.viewerFileList(attachmentIds, rootDirId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * æ ¹æ®éä»¶idæ°ç»é¢è§æå®ç´¢å¼çéä»¶\r\n   * @param attachmentIds éä»¶idæ°ç»\r\n   * @param rootDirId æ ¹ç®å½id\r\n   * @param attachmentId éä»¶Id\r\n   */\r\n  public previewFileListWithIndex(attachmentIds: string[], rootDirId: string, attachmentId: string) {\r\n    const viewer$ = from(this.fileViewerService.viewerFileListWithIndex(attachmentIds, rootDirId, attachmentId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * çæçæ¬å·\r\n   * @param versions åå²çæ¬å·\r\n   * @description é»è®¤ç¼ç è§åv1.0 v2.0 ...\r\n   */\r\n  public genVersion(versions: string[]) {\r\n    if (!versions) {\r\n      versions = [];\r\n    }\r\n    const mainCode = versions.length + 1;\r\n    return `V${mainCode}.0`;\r\n  }\r\n  /**\r\n   * æ´æ°éä»¶çæ¬ä¿¡æ¯\r\n   * @param versionField éä»¶çæ¬å­æ®µ\r\n   * @param historyField æ¯å¦åå²çæ¬å­æ®µ\r\n   * @param attachmentFieldPath éä»¶udtå­æ®µè·¯å¾\r\n   */\r\n  public updateAttachmentVersion(versionField: string, historyField: string, attachmentFieldPath: string) {\r\n    /**\r\n     * éåææéä»¶è¡\r\n     * æ¾å°æææ²¡æéä»¶çæ¬çè¡\r\n     * éåè¿äºè¡\r\n     * éè¿æä»¶åå»æ¥æ¾ååçä¸æéä»¶çæ¬å·çè¡\r\n     * è¿äºè¡åå²çæ¬å­æ®µç½®ä¸ºtrue\r\n     * æ çæ¬å·çè¡ï¼çæ¬= ä¸è¡æ° + 1\r\n     *\r\n     */\r\n    const bindingPaths = attachmentFieldPath.split('/').filter(p => p);\r\n    // å¼¹åºéä»¶udtå­æ®µ\r\n    const attachmentField = bindingPaths.pop();\r\n    // è·åå°ææçéä»¶\r\n    const attachmentBindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    const befRepository = this.frameContext.repository as BefRepository<any>;\r\n    const entityManager = befRepository.entityManager;\r\n    const dataPath = DataPathCreator.createByShortPathFromRoot(bindingPaths, entityManager, this.frameContext.bindingData);\r\n    const paths = dataPath.toArray().map((path: string) => {\r\n      if (path.startsWith('PropName:')) {\r\n        return path.split(':')[1];\r\n      } else {\r\n        return path;\r\n      }\r\n    });\r\n    if (attachmentBindingList) {\r\n      const attachments = attachmentBindingList.toJSON();\r\n      // åªå¤çæéä»¶çæåµ\r\n      if (attachments) {\r\n        const versionLessRows = attachments.filter(item => !item[versionField]);\r\n        versionLessRows.forEach(item => {\r\n          const fileName = item[attachmentField]['fileName'];\r\n          const versionedRows = attachments.filter(row => row[attachmentField]['fileName'] === fileName && row[versionField]);\r\n          paths.pop();\r\n          paths.push(`DataId:${item[attachmentBindingList.primaryKey]}`);\r\n          let entity = this.frameContext.repository.entityCollection.getEntityByPath(paths);\r\n          const version = this.genVersion(versionedRows);\r\n          entity[versionField] = version;\r\n          entity[historyField] = false;\r\n          // å¤çåå²è®°å½\r\n          versionedRows.forEach(row => {\r\n            paths.pop();\r\n            paths.push(`DataId:${row[attachmentBindingList.primaryKey]}`);\r\n            entity = this.frameContext.repository.entityCollection.getEntityByPath(paths);\r\n            entity[historyField] = true;\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n  public isAttachmentCanDelete(historyField: string, attachmentFieldPath: string) {\r\n    const bindingPaths = attachmentFieldPath.split('/').filter(p => p);\r\n    // å¼¹åºéä»¶udtå­æ®µ\r\n    bindingPaths.pop();\r\n    const attachmentBindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    const bindingObject = attachmentBindingList.currentItem;\r\n    if (bindingObject[historyField] === true) {\r\n      this.notifyService.warning(this.languageService.historyAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n  }\r\n  public updateAttachmentHistory(versionField: string, historyField: string, attachmentFieldPath: string) {\r\n    const bindingPaths = attachmentFieldPath.split('/').filter(p => p);\r\n    // å¼¹åºéä»¶udtå­æ®µ\r\n    const attachmentField = bindingPaths.pop();\r\n    // è·åå°ææçéä»¶\r\n    const attachmentBindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    // const befRepository = this.frameContext.repository as BefRepository<any>;\r\n    // const entityManager = befRepository.entityManager;\r\n    if (attachmentBindingList) {\r\n      const attachments = attachmentBindingList.toJSON();\r\n      const versionedRows = attachments.filter(item => item[versionField]);\r\n      const fileNameMap = new Map<string, Array<any>>();\r\n      const befRepository = this.frameContext.repository as BefRepository<any>;\r\n      const entityManager = befRepository.entityManager;\r\n      const dataPath = DataPathCreator.createByShortPathFromRoot(bindingPaths, entityManager, this.frameContext.bindingData);\r\n      const paths = dataPath.toArray().map((path: string) => {\r\n        if (path.startsWith('PropName:')) {\r\n          return path.split(':')[1];\r\n        } else {\r\n          return path;\r\n        }\r\n      });\r\n      versionedRows.forEach(item => {\r\n        const fileName = item[attachmentField]['fileName'];\r\n        if (fileNameMap.has(fileName)) {\r\n          fileNameMap.get(fileName).push(item);\r\n        } else {\r\n          fileNameMap.set(fileName, [item]);\r\n        }\r\n      });\r\n      Array.from(fileNameMap.values()).forEach((array: Array<any>) => {\r\n        array.sort((x, y) => {\r\n          const xVersion = parseInt(x[versionField].replace(/[a-zA-Z\\.]/g, ''));\r\n          const yVersion = parseInt(y[versionField].replace(/[a-zA-Z\\.]/g, ''));\r\n          return yVersion - xVersion;\r\n        });\r\n        const row = array[0];\r\n        paths.pop();\r\n        paths.push(`DataId:${row[attachmentBindingList.primaryKey]}`);\r\n        const entity = this.frameContext.repository.entityCollection.getEntityByPath(paths);\r\n        entity[historyField] = false;\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * å é¤éä»¶\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µè·¯å¾\r\n   * @param id æ°æ®id\r\n   * @param rootDirId æ ¹ç®å½\r\n   * @returns\r\n   */\r\n  public removeAttachment(attachmentInfoFieldPath: string, id: string, rootDirId: string): Observable<any> {\r\n    const rootId = rootDirId;\r\n    if (!rootId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const dataIds = [id];\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, dataIds);\r\n    if (attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.plsSelectRemoveAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const attachmentId = attachIds[0];\r\n    return this.attachDataService.removeAttachment(attachmentInfoFieldPath, { attachmentId, fileName: null });\r\n  }\r\n  /**\r\n   * è·åå½åè§å¾æ¨¡åå½åè¡çéä»¶id\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µ\r\n   */\r\n  private getCurrentAttachmentId(attachmentInfoFieldPath: string) {\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentFieldName = parentBindingPathArray.pop();\r\n    const bindingList: BindingList = this.frameContext.bindingData.getValue(parentBindingPathArray) as BindingList;\r\n    const currentItem = bindingList.currentItem;\r\n    if (currentItem && currentItem.primaryKeyValue) {\r\n      return currentItem[attachmentFieldName] && currentItem[attachmentFieldName]['attachmentId'] || null;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * è·åå½åè¡\r\n   * @param attachmentInfoFieldPath udtå­æ®µ\r\n   */\r\n  private getCurrentRow(attachmentInfoFieldPath: string) {\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const bindingList: BindingList = this.frameContext.bindingData.getValue(parentBindingPathArray) as BindingList;\r\n    const currentItem = bindingList && bindingList.currentItem;\r\n    return currentItem;\r\n  }\r\n  /**\r\n   * è·åæå®éä»¶ä¿¡æ¯è¡¨çæå®è¡\r\n   * @param attachmentInfoFieldPath\r\n   * @param primaryValue\r\n   * @returns\r\n   */\r\n  private getSpecialRow(attachmentInfoFieldPath: string, primaryValue: string) {\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const bindingList: BindingList = this.frameContext.bindingData.getValue(parentBindingPathArray) as BindingList;\r\n    const currentItem = bindingList && bindingList.findById(primaryValue);\r\n    return currentItem;\r\n  }\r\n  /**\r\n   * è·ådataIdså¯¹åºEntityä¸çéä»¶idæ°ç»\r\n   */\r\n  private getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath: string, dataIds?: string[]): string[] {\r\n\r\n    // è§£æè·¯å¾\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentFieldName = parentBindingPathArray.pop();\r\n\r\n    // è·åéä»¶æå¨å®ä½çæ°æ®åè¡¨ï¼ä¸ä¼ édataIdsåæ°ï¼åè¿åå¨é¨\r\n    const entityListData = this.entityService.getEntityListData(parentBindingPathArray);\r\n    let filteredEntityListData = [];\r\n    if (dataIds && Array.isArray(dataIds) === true) {\r\n      filteredEntityListData = entityListData.filter((entityData: any) => {\r\n        return dataIds.indexOf(entityData.id) > -1;\r\n      });\r\n    } else {\r\n      filteredEntityListData = entityListData;\r\n    }\r\n\r\n    // è½¬æ¢ä¸ºéä»¶Idæ°ç»\r\n    const attachmentIds = [];\r\n    filteredEntityListData.forEach((entityData: any) => {\r\n      if (entityData[attachmentFieldName]) {\r\n        const attachmentId = entityData[attachmentFieldName]['attachmentId'];\r\n        if (attachmentId) {\r\n          attachmentIds.push(attachmentId);\r\n        }\r\n      }\r\n    });\r\n\r\n    return attachmentIds;\r\n  }\r\n}\r\n\r\nexport { AttachmentService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, forkJoin, Subject } from 'rxjs';\r\nimport { FUploadFileExtend } from '@farris/extend-file-upload';\r\nimport { FrameContext, CommandContext, BindingPathConverter, BindingList, BindingObject } from '@farris/devkit';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { AttachmentInfo, ATTACHMENT_ORDER_FIELD } from './types';\r\nimport { AttachmentDataService } from './attachment-data.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { ListDataService, SubListDataService } from '../data-services/index';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { debounceTime, tap } from 'rxjs/operators';\r\n\r\n/**\r\n * éä»¶ä¸ä¼ \r\n * @summary\r\n * fileExtendï¼å½åæä»¶ä¸ä¼ æé¢è§ç»ä»¶ä¼ éè¿æ¥çæ°æ®ï¼\r\n * fileExtendFieldPathï¼å½åéä»¶UDTçå­æ®µè·¯å¾ï¼\r\n * attachmentInfoï¼å½åéä»¶UDTæéçä¿¡æ¯ï¼\r\n */\r\n@Injectable()\r\nclass FileService {\r\n  private subject: Subject<{ fileInfoFieldPath: string, configs: string }>;\r\n  private attachmentInfos: AttachmentInfo[];\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private attachDataService: AttachmentDataService,\r\n    private entityService: EntityService,\r\n    private subListDataService: SubListDataService,\r\n    private notifyService: FormNotifyService,\r\n    private languageService: LanguageService,\r\n    private listDataService: ListDataService,\r\n    @Optional() private formLoadingService: FormLoadingService\r\n  ) {\r\n    this.subject = new Subject<{ fileInfoFieldPath: string, configs: string }>();\r\n    this.subject.pipe(debounceTime(500)).subscribe((data: { fileInfoFieldPath: string, configs: string }) => {\r\n      this.process(data.fileInfoFieldPath, data.configs);\r\n    });\r\n    this.attachmentInfos = [];\r\n  }\r\n\r\n  // #region ä¸ä¼ æä»¶\r\n\r\n  /**\r\n   * æ¹éæ·»å éä»¶è¡\r\n   */\r\n  public addFileRows(fileInfoFieldPath: string) {\r\n    const attachmentInfos = this.getAttachmentInfosToAddFromContext();\r\n    if (attachmentInfos.length === 0) {\r\n      this.notifyService.info('è¯·åä¸ä¼ éä»¶');\r\n    }\r\n    return this.attachDataService.updateRows(fileInfoFieldPath, attachmentInfos);\r\n  }\r\n  /**\r\n   * æ¹éæ·»å å¸¦éä»¶ç±»åçéä»¶è¡\r\n   * @param fileInfoFieldPath éä»¶udtå­æ®µ\r\n   * @param configs éä»¶æ©å±ä¿¡æ¯éç½® \r\n   * @description configséç½®å¦{\"billId\":\"{UISTATE~/root/billId}\",\"rowId\":\"{UISTATE~/root/rowId}\",\"attachmentType\":\"xueli\"}\r\n   */\r\n  public addFileRowsWithConfigs(fileInfoFieldPath: string, configs: string) {\r\n    const attachmentInfos = this.getAttachmentInfosToAddFromContext();\r\n    if (attachmentInfos.length === 0) {\r\n      this.notifyService.info('è¯·åä¸ä¼ éä»¶');\r\n    }\r\n    // let mapFields = null;\r\n    // if (typeof configs === 'string') {\r\n    //   // å»æé¦å°¾ç©ºæ ¼\r\n    //   configs = configs.trim();\r\n    // }\r\n    // if (configs.startsWith('{') && configs.endsWith('}')) {\r\n    //   try {\r\n    //     mapFields = JSON.parse(configs);\r\n    //   } catch {\r\n    //     throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n    //   }\r\n    // } else {\r\n    //   throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n    // }\r\n    this.attachmentInfos = this.attachmentInfos.concat(attachmentInfos);\r\n    this.subject.next({ fileInfoFieldPath, configs });\r\n    //return this.attachDataService.updateRowsWithConfigs(fileInfoFieldPath, attachmentInfos, mapFields);\r\n  }\r\n  private process(fileInfoFieldPath: string, configs: string) {\r\n    if (this.attachmentInfos && this.attachmentInfos.length > 0) {\r\n      const attachmentInfos = this.attachmentInfos.concat([]);\r\n      let mapFields = null;\r\n      if (typeof configs === 'string') {\r\n        // å»æé¦å°¾ç©ºæ ¼\r\n        configs = configs.trim();\r\n      }\r\n      if (configs.startsWith('{') && configs.endsWith('}')) {\r\n        try {\r\n          mapFields = JSON.parse(configs);\r\n        } catch {\r\n          throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n        }\r\n      } else {\r\n        throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n      }\r\n      this.attachDataService.updateRowsWithConfigs(fileInfoFieldPath, attachmentInfos, mapFields).pipe(\r\n        tap(() => {\r\n          this.attachmentInfos = this.attachmentInfos.filter(item => !attachmentInfos.find(attachmentInfo => attachmentInfo.attachmentId === item.attachmentId));\r\n          if (this.attachmentInfos.length > 0) {\r\n            this.process(fileInfoFieldPath, configs);\r\n          }\r\n        })\r\n      ).subscribe();\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * è·åè¦æ·»å çéä»¶ä¿¡æ¯æ°ç»\r\n   */\r\n  private getAttachmentInfosToAddFromContext(): AttachmentInfo[] {\r\n    const fileExtends = this.getFileExtendsFromContext();\r\n    const attachmentInfos = this.convertToAttachmentInfos(fileExtends);\r\n    return attachmentInfos;\r\n  }\r\n\r\n  /**\r\n   * å°éä»¶ä¸ä¼ ç»ä»¶è¿åçéä»¶ä¿¡æ¯è½¬æ¢ä¸ºæå¡å¨ç«¯éè¦çæ ¼å¼\r\n   */\r\n  private convertToAttachmentInfos(fileExtends: FUploadFileExtend[]): AttachmentInfo[] {\r\n    if (!fileExtends) {\r\n      return [];\r\n    }\r\n\r\n    const attachmentInfos: AttachmentInfo[] = [];\r\n    fileExtends.forEach((fUploadOutPut: FUploadFileExtend) => {\r\n      const attachmentInfo: AttachmentInfo = {\r\n        attachmentId: fUploadOutPut.extend.metadataId,\r\n        fileName: fUploadOutPut.extend.fileName,\r\n      };\r\n      attachmentInfos.push(attachmentInfo);\r\n    });\r\n    return attachmentInfos;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region å é¤æä»¶\r\n\r\n  /**\r\n   * å é¤éä»¶è¡\r\n   */\r\n  public removeFileRows(fileInfoFieldPath: string): Observable<any> {\r\n    const dataIds = this.getDataIdsToRemoveFromContext(fileInfoFieldPath);\r\n    if (dataIds.length === 0) {\r\n      this.notifyService.info('è¯·éæ©è¦å é¤çéä»¶');\r\n    }\r\n    const isSublist = fileInfoFieldPath.split('/').filter(p => p).length >= 2;\r\n    const removeObservables: Observable<any>[] = [];\r\n    if (isSublist) {\r\n      dataIds.forEach((dataId: string) => {\r\n        let removeObservable;\r\n        removeObservable = this.subListDataService.removeWithoutConfirm(dataId);\r\n        removeObservables.push(removeObservable);\r\n      });\r\n      return forkJoin(removeObservables);\r\n    } else {\r\n      return this.listDataService.removeRows(dataIds, false, null, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åè¦å é¤çæ°æ®\r\n   */\r\n  private getDataIdsToRemoveFromContext(fileExtendFieldPath: string): string[] {\r\n\r\n    // ä»ä¸ä¸æä¸­è·åè¦å¤ççéä»¶ä¿¡æ¯æ°ç»\r\n    const fileExtends = this.getFileExtendsFromContext();\r\n\r\n    // å°éä»¶æ°ç»è½¬æ¢ä¸ºå¯¹åºçæ°æ®id\r\n    const dataIds: string[] = [];\r\n    fileExtends.forEach((fileExtend: FUploadFileExtend) => {\r\n\r\n      // ä¸ä¼ å é¤åé¢è§å é¤ä¼ éè¿æ¥çfileIdçkeyå¯è½ä¸ä¸è´ï¼è¦åå¼å®¹\r\n      const fileId = fileExtend.extend.metadataId;\r\n      const dataId = this.convertFileIdToDataId(fileId, fileExtendFieldPath);\r\n      dataIds.push(dataId);\r\n    });\r\n    return dataIds;\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®è·¯å¾è·åéä»¶å­æ®µå¼æ°ç»\r\n   * @param fieldPath å­æ®µè·¯å¾\r\n   */\r\n  private convertFileIdToDataId(fileId: string, fileExtendFieldPath: string): string {\r\n\r\n    // è§£æè·¯å¾\r\n    const fileBindingPath = BindingPathConverter.toBindingPathArray(fileExtendFieldPath);\r\n    const fileFieldName = fileBindingPath.pop();\r\n    const fileListBindingPath = fileBindingPath;\r\n\r\n    // è·åéä»¶idæ°ç»\r\n    const entityListData = this.entityService.getEntityListData(fileListBindingPath);\r\n    const targetEntityData = entityListData.find((entityData: any) => {\r\n      if (entityData[fileFieldName]) {\r\n        const attachmentId = entityData[fileFieldName]['attachmentId'];\r\n        if (attachmentId === fileId) {\r\n          return true;\r\n        }\r\n      }\r\n    });\r\n\r\n    return targetEntityData.id;\r\n  }\r\n\r\n  // #endregion\r\n  //#region æä»¶æåº\r\n  /**\r\n   * æ´æ°éä»¶æåº\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µè·¯å¾\r\n   * @param ids éä»¶æåºåçéä»¶idæ°ç»\r\n   */\r\n  public updateOrder(attachmentInfoFieldPath: string, ids: string[]) {\r\n    if (!attachmentInfoFieldPath) {\r\n      throw new Error('éä»¶udtå­æ®µè·¯å¾åæ°ä¸è½ä¸ºç©º');\r\n    }\r\n    // æ¯æä»ä»£ç ä¸­ç´æ¥è°ç¨ï¼å¦æåæ°ä¸­ä¼ éäºidsåä½¿ç¨ï¼å¦åä½¿ç¨å½ä»¤ä¸ä¸æä¸­çäºä»¶åæ°\r\n    if (!ids) {\r\n      // è·åäºä»¶åæ°\r\n      const commandContext = this['context'] as CommandContext;\r\n      // ä¸ç»ä»¶çº¦å®äºä»¶åæ°ä¸ºæ°æ®ä¸»é®æ°ç»\r\n      ids = commandContext && commandContext.eventParam && commandContext.eventParam.data;\r\n    }\r\n    // å¯¹æ¶éçä¸»é®æ°ç»è¿è¡å¤æ­\r\n    if (!ids || !Array.isArray(ids)) {\r\n      return;\r\n    }\r\n    // å½åå½ä»¤æå¨ç»ä»¶çç»å®æ°æ®\r\n    const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n    // æ ç»å®æ°æ®æ¶ä¸å¤ç\r\n    if (!bindingList || bindingList.length < 1) {\r\n      return;\r\n    }\r\n    // ç»ä¸è·åéä»¶udtä¿¡æ¯\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentField = parentBindingPathArray.pop();\r\n    // åºç°udtå­æ®µä¸å­å¨çæåµï¼è¯´æå½ä»¤ä¸­éä»¶udtå­æ®µéç½®éè¯¯ævoä¸­æ²¡æéä»¶udtãæ§å¶å¨ä¸å¼å®¹éè¯¯ï¼æ­¤å¤å¤æ­åªä¸ºé»æ­¢åç»­çéå\r\n    if (!attachmentField) {\r\n      throw new Error('æ æ³è·åéä»¶udtå­æ®µï¼è¯·ç¡®è®¤å½ä»¤ä¸­éä»¶udtå­æ®µè·¯å¾éç½®æ­£ç¡®ï¼ä¸è§å¾æ¨¡åä¸­å­å¨éä»¶udtå­æ®µ');\r\n    }\r\n    const data = bindingList.toJSON();\r\n    // æ´æ°ç»å®æ°æ®ä¸­éä»¶udtå­æ®µä¸­æåºå­æ®µçå¼,ä»æ´æ°æéä»¶çè¡\r\n    ids.forEach((id: string, index: number) => {\r\n      const item = data.find(item => item && item[attachmentField] && item[attachmentField]['attachmentId'] === id);\r\n      const primaryKeyValue = item && item.id;\r\n      if (!primaryKeyValue) {\r\n        return;\r\n      }\r\n      const bindingObject = bindingList.findById(primaryKeyValue);\r\n      if (bindingObject) {\r\n        // éä»¶udtå¯¹è±¡\r\n        const attachment = bindingObject[attachmentField] as BindingObject;\r\n        if (attachment) {\r\n          // è·åæ§å¼\r\n          const order = attachment.getValue(ATTACHMENT_ORDER_FIELD);\r\n          if (order !== index) {\r\n            // æ´æ°æåº\r\n            attachment.setValue(ATTACHMENT_ORDER_FIELD, index, true, true);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n  //#endregion\r\n\r\n  // #region å¶ä»å·¥å·æ¹æ³\r\n\r\n  /**\r\n   * ä»ä¸ä¸æä¸­è·åè¦å¤ççéä»¶ä¿¡æ¯æ°ç»\r\n   * @summary\r\n   * ä¸ºäºç»ä¸åä¸ªåå¤ä¸ªéä»¶çå¤çæ¹å¼ï¼ç»ä¸åè£ä¸ºæ°ç»\r\n   */\r\n  private getFileExtendsFromContext(): FUploadFileExtend[] {\r\n\r\n    const commandContext = this['context'] as CommandContext;\r\n    const eventParam = commandContext.eventParam;\r\n    if (!eventParam) {\r\n      return [];\r\n    }\r\n\r\n    let fileExtends: any[];\r\n    if (Array.isArray(eventParam) === false) {\r\n      fileExtends = [eventParam];\r\n    } else {\r\n      fileExtends = eventParam.concat([]);\r\n    }\r\n\r\n    return fileExtends as FUploadFileExtend[];\r\n  }\r\n  // #endregion\r\n}\r\n\r\nexport { FileService };\r\n","import { Injectable, ComponentFactoryResolver, ReflectiveInjector, Provider, ComponentRef, InjectFlags, NgModuleFactory, Injector, Optional, forwardRef, NgModuleRef } from '@angular/core';\r\nimport { BsModalRef, BsModalService } from '@farris/ui-modal';\r\nimport { FarrisFormService } from './farris-form.service';\r\nimport { FrameContext, FrameComponent, BindingList } from '@farris/devkit';\r\nimport { of, Observable, Subject } from 'rxjs';\r\nimport { LanguageService } from './languag.service';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { INSIDE_DIALOG_TOKEN, MODAL_REF } from './types';\r\n\r\ndeclare const System: any;\r\n/**\r\n * å¼¹çªæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass DialogService {\r\n  private _providers: Provider[] = [];\r\n  /**\r\n   * å¤é¨å¼ç¨\r\n   */\r\n  private refs: any = {};\r\n  private languageService: LanguageService;\r\n  private modalRef: any;\r\n  private modals: any = {};\r\n\r\n  constructor(\r\n    private modalService: BsModalService,\r\n    private farrisFormService: FarrisFormService,\r\n    private _componentFactoryResolver: ComponentFactoryResolver,\r\n    private frameContext?: FrameContext,\r\n    @Optional() private injector?: Injector\r\n  ) {\r\n    this.setLanguageService();\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®è¯­è¨æå¡\r\n   */\r\n  private setLanguageService() {\r\n    // FrameContextä¸ä¸å®å­å¨ï¼ä¸è½ç´æ¥ç¨\r\n    const frameContext = this.getFrameContext();\r\n    if (frameContext) {\r\n      const injector = this.frameContext.injector;\r\n      this.languageService = injector.get<LanguageService>(LanguageService, null, InjectFlags.Optional);\r\n    }\r\n\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åframeContext\r\n   */\r\n  private getFrameContext() {\r\n    if (this.frameContext) {\r\n      return this.frameContext;\r\n    }\r\n    if (this['context'] && this['context']['frameContext']) {\r\n      return this['context']['frameContext'];\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åComponentFactoryResolver\r\n   */\r\n  private getComponentFactoryResolver() {\r\n    const frameContext = this.getFrameContext();\r\n    let componentFactoryResolver: any;\r\n    if (frameContext) {\r\n      componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);\r\n    }\r\n    return componentFactoryResolver;\r\n  }\r\n\r\n  /**\r\n   * è·åconfigè½¬æ¢æå¯¹è±¡ç±»åçéç½®\r\n   * @param config éç½®é¡¹\r\n   * @throws å¡«åå¯¹è±¡æ ¼å¼æjsonå­ç¬¦ä¸²\r\n   */\r\n  private getObjectTypeConfig(config: any) {\r\n    let objectTypeConfig: any\r\n    if (typeof config === 'string') {\r\n      if (config.length) {\r\n        try {\r\n          objectTypeConfig = JSON.parse(config);\r\n        } catch {\r\n          throw new Error(config + 'ä¸æ¯åæ³çjsonå­ç¬¦ä¸²');\r\n        }\r\n      } else {\r\n        objectTypeConfig = {};\r\n      }\r\n    } else if (typeof config === 'object') {\r\n      objectTypeConfig = Object.assign({}, config);\r\n    } else {\r\n      throw new Error('å¡«åå¯¹è±¡æ ¼å¼æjsonå­ç¬¦ä¸²');\r\n    }\r\n    return objectTypeConfig;\r\n  }\r\n\r\n  /**\r\n   * åå»ºæ¨¡ææ¡åç»ä»¶å®ä¾ï¼å¹¶è¿åæ¨¡ææ¡å®ä¾ï¼åäºå¼å®¹èè¡¨åå¤ç\r\n   * @param config å¼¹çªéç½®\r\n   * @param component å¼¹çªåç»ä»¶\r\n   * @param uiStateObject ç»å®å¼¹çªåç»ä»¶uiState\r\n   */\r\n  private createModalComponentRef(config: any, component: any, uiStateObject: any) {\r\n    let componentRef: any;\r\n    let modalRef: any;\r\n    const frameContext = this.getFrameContext();\r\n    const componentFactoryResolver = this.getComponentFactoryResolver();\r\n    if (frameContext && componentFactoryResolver) {\r\n      const contentCmptFactory = componentFactoryResolver.resolveComponentFactory(component);\r\n      const injector = this.createInjector(this.refs, this.frameContext.injector);\r\n      const modalContentInjector = ReflectiveInjector.resolveAndCreate([...this._providers], injector);\r\n      componentRef = contentCmptFactory.create(modalContentInjector);\r\n      if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {\r\n        if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {\r\n          Object.keys(uiStateObject).forEach((item) => {\r\n            componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);\r\n          });\r\n        }\r\n        // éå isDialogåæ°\r\n        componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n      }\r\n      modalRef = this.modalService.show(componentRef, config);\r\n    } else {\r\n      modalRef = this.modalService.show(component, config);\r\n    }\r\n    return modalRef;\r\n  }\r\n  /**\r\n   *æå¼å¼¹çª\r\n   * @param config æ¨¡ææ¡æ¬èº«éç½®\r\n   * @param modalId æ¨¡ææ¡åç»ä»¶çid\r\n   * @param uiStateConfig æ¨¡ææ¡åç»ä»¶uiStateä¸çå­æ®µåå¼\r\n   * @param callback åè°\r\n   */\r\n  public openModal(config: any = {}, modalId: string, uiStateConfig: any = {}, callback?: (modalRef: any) => any) {\r\n    const configObj = this.getObjectTypeConfig(config);\r\n    const uiStateObject = this.getObjectTypeConfig(uiStateConfig);\r\n    const innerCompopnent = this.farrisFormService.getControls(modalId);\r\n    let modalRef: any;\r\n    let modalConfig: any = {\r\n      title: this.languageService.defaultDialogTitle,\r\n      width: 760,\r\n      height: 450,\r\n      showButtons: false\r\n    };\r\n    modalConfig = Object.assign(modalConfig, configObj);\r\n    const onClosingHandler = modalConfig.beforeClose;\r\n    // tslint:disable: no-string-literal\r\n    const cancelChanges = modalConfig['cancelChanges'] || false;\r\n    modalConfig.beforeClose = (ref) => {\r\n      // if (ref && ref.modalRef && ref.modalRef.content) {\r\n      //   ref.modalRef.content.isDialogRootComponent = false;\r\n      // }\r\n      if (!!onClosingHandler && typeof onClosingHandler === 'function') {\r\n        return onClosingHandler(ref).pipe(\r\n          switchMap((result) => {\r\n            if (result) {\r\n              if (cancelChanges) {\r\n                return this.cancelChanges(ref);\r\n              }\r\n            }\r\n            return of(result);\r\n          })\r\n        );\r\n      }\r\n      if (cancelChanges) {\r\n        return this.cancelChanges(ref);\r\n      } else {\r\n        return of(true);\r\n      }\r\n    };\r\n    const remote = modalConfig.remote || false;\r\n    if (remote) {\r\n      this.createRemoteForm(modalConfig, uiStateObject).subscribe(\r\n        (modalRef: any) => {\r\n          this.modalRef = modalRef;\r\n          this.refs.modalRef = modalRef;\r\n          if (modalRef && !!modalRef.content) {\r\n            modalRef.content.isDialogRootComponent = true;\r\n            modalRef.content.dialogRef = modalRef;\r\n          }\r\n          callback(modalRef);\r\n        }\r\n      );\r\n    } else {\r\n      if (!innerCompopnent) {\r\n        console.error(`è·åæ§ä»¶å¤±è´¥ï¼modalId=${modalId}`);\r\n        return;\r\n      }\r\n      if (typeof innerCompopnent === 'string') {\r\n        modalConfig.dialogType = 'iframe';\r\n        modalRef = this.modalService.show(innerCompopnent, modalConfig);\r\n      } else if (typeof innerCompopnent === 'function') {\r\n        modalRef = this.createModalComponentRef(modalConfig, innerCompopnent, uiStateObject);\r\n      } else if (typeof innerCompopnent === 'object') {\r\n        // å¦ææ¯å¯¹è±¡ ä¸ä½¿ç¨ç¬ç«jså è½½\r\n        // {\"useIsolateJs\":true,\"modalInstance\":f()}\r\n        if (innerCompopnent.useIsolateJs) {\r\n          const injector = this.createInjector(this.refs);\r\n          const parameter = {\r\n            injector: injector,\r\n            uiState: uiStateObject,\r\n            modalService: this.modalService,\r\n            dialogServiceInstance: this,\r\n            eventBus: this.frameContext.getVirtualRootFrameContext().eventBus,\r\n            componentCallback: this.componentModify,\r\n            modalInstanceCallback: this.modalInstanceCallback.bind(this)\r\n          };\r\n          // ä¼å¨åé¨è¿è¡\r\n          const subject: Subject<any> = innerCompopnent['modalInstance'](modalConfig, parameter);\r\n          return subject;\r\n        } else {\r\n          modalRef = this.modalService.show(innerCompopnent, modalConfig);\r\n        }\r\n      }\r\n\r\n      this.modalRef = modalRef;\r\n      this.refs.modalRef = modalRef;\r\n      if (modalRef && !!modalRef.content) {\r\n        modalRef.content.isDialogRootComponent = true;\r\n        modalRef.content.dialogRef = modalRef;\r\n      }\r\n      return modalRef;\r\n    }\r\n  }\r\n  private componentModify(cmpRef: any, parameter: {\r\n    uistate: any\r\n  }) {\r\n    if (cmpRef && cmpRef.instance && cmpRef.instance.viewModel && cmpRef.instance.viewModel.uiState) {\r\n      if (parameter.uistate && typeof parameter.uistate === 'string') {\r\n        parameter.uistate = JSON.parse(parameter.uistate);\r\n      }\r\n      if (typeof parameter.uistate === 'object' && Object.keys(parameter.uistate).length) {\r\n        Object.keys(parameter.uistate).forEach((item) => {\r\n          cmpRef.instance.viewModel.uiState.setPropertyValue(item, parameter.uistate[item]);\r\n        });\r\n      }\r\n      // éå isDialogåæ°\r\n      cmpRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n    }\r\n  }\r\n\r\n  private modalInstanceCallback(cmpRef: any, options: any, parameter: any) {\r\n    if (parameter && parameter.modalService) {\r\n      const modalRef = parameter.modalService.show(cmpRef, options);\r\n      this.modalRef = modalRef;\r\n      this.refs.modalRef = modalRef;\r\n      if (modalRef && !!modalRef.content) {\r\n        modalRef.content.isDialogRootComponent = true;\r\n        modalRef.content.dialogRef = modalRef;\r\n      }\r\n      return modalRef;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æå¼ç±»å¸®å©è¡¨å\r\n   * @param frameId\r\n   * @param params\r\n   * @param configs\r\n   * @description å¼¹åºè¡¨ååå¼¹åºè¿ç«¯è¡¨ååºå«ä¸ºå¼¹åºè¡¨åéè¦éç½®å­æ®µæ å°\r\n   */\r\n  public openHelpModal(frameId: string, params: string, configs?: any) {\r\n    const events = this['context']['eventParam'] || {};\r\n    // å¡çåºæ¯ä¼ éè¿æ¥çäºä»¶æ¯èªå®ä¹å¯¹è±¡ï¼åå«eventåoptionsãåè¡¨åºæ¯ä¼ éè¿æ¥çäºä»¶åæ°æ¯æ®éäºä»¶åæ°ï¼å¨åæ°ä¸­æºå¸¦äºeditor.options\r\n    const event = events.event || events;\r\n    const options = events.options || events.editor && events.editor.options || {};\r\n    const context = events && events.context;\r\n    const subject = new Subject<any>();\r\n    // modalIdå¨ä¸¤ç§åºæ¯ä¸é½éè¦ï¼ç¨æ¥åºåå®ä¾\r\n    const { modalId = null } = options;\r\n    if (!configs) {\r\n      configs = '{}';\r\n    }\r\n    if (typeof configs === 'string' && configs.length > 0) {\r\n      configs = JSON.parse(configs);\r\n    }\r\n    const { remote = false, currentRow = false, areaResponse = undefined } = configs || {};\r\n    // æ¯æareaResponseéç½®\r\n    if (areaResponse !== undefined && options.areaResponse === undefined) {\r\n      options.areaResponse = areaResponse;\r\n    }\r\n    if (remote) {\r\n      const mapFields = configs.mapFields || {};\r\n      options.remote = remote + '?v=' + new Date().valueOf();\r\n      this.openModal(options, modalId, params, (dialogRef: any) => {\r\n        // æ°å¢eventåæ°ï¼ä¸ºäºä»¥åè°ç¨eventä¸­çformControlä»¥ééåè¡¨ä¸­çæºè½è¾å¥æ¡å¼¹åºè¡¨åï¼\r\n        this.modals[modalId] = { subject, frameId: frameId, mapFields, dialogRef, currentRow, event: event, context };\r\n      });\r\n    } else {\r\n      const dialogRef = this.openModal(options, modalId, params);\r\n      const mapFields = options.mapFields || {};\r\n      this.modals[modalId] = { subject, frameId: frameId, mapFields, dialogRef, currentRow, event: event, context };\r\n    }\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * æå¼å¸¦åè°çå¼¹çª\r\n   * @param frameId frameId\r\n   * @param params åæ°\r\n   * @param configs éç½®\r\n   * @returns\r\n   */\r\n  public openCallbackableModal(frameId: string, params?: string, configs?: any) {\r\n    if (!configs) {\r\n      configs = '{}';\r\n    }\r\n    if (typeof configs === 'string') {\r\n      configs = JSON.parse(configs);\r\n    }\r\n    const events = this['context'] && this['context']['eventParam'] || {};\r\n    const options = events.options;\r\n    options.showButtons = true;\r\n    options.buttons = [\r\n      { text: this.languageService.cancel, cls: 'btn', handle: (event: any) => this.cancel(options) },\r\n      {\r\n        text: this.languageService.confirm, cls: 'btn btn-primary', handle: (event: any) => {\r\n          const { modalId = null } = options || {};\r\n          if (modalId) {\r\n            const modal = this.modals[modalId];\r\n            const { subject = null, dialogRef = null, frameId = null, handle = null, currentRow = false } = modal || {};\r\n            const formCmp = dialogRef.content; // å¼¹çªè¡¨åå®ä¾\r\n            if (!formCmp) {\r\n              throw new Error('ä¸æ¯æçè¡¨åç±»å');\r\n            }\r\n            let selectedItems = [];\r\n            if (currentRow === true) {\r\n              let frameComtext: FrameContext;\r\n              if (formCmp.context) {\r\n                frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId) as FrameContext;\r\n              } else {\r\n                frameComtext = formCmp.appContext.frameContextManager.getFrameContextById(frameId) as FrameContext;\r\n              }\r\n\r\n              if (!frameComtext) {\r\n                throw new Error(`æ æçframeIdï¼${frameId}ï¼è¯·ç¡®è®¤å½ä»¤ä¸­frameIdæ­£ç¡®ã`);\r\n              }\r\n              const bindingList = frameComtext.bindingData.getList() as BindingList;\r\n              const item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();\r\n              selectedItems = [item];\r\n            } else {\r\n              let rows: Map<string, any>;\r\n              // å¦æcontextä¸ºç©º é£ä¹å°è¯ä»å¯¹åºçappcontextè¯»åï¼ä¸»è¦ç®çæ¯ä¸ºäºè§£æè¡¨åçå¼¹åº\r\n              if (formCmp.context) {\r\n                rows = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map<string, any>();\r\n              } else {\r\n                rows = formCmp.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map<string, any>();\r\n              }\r\n\r\n              selectedItems = Array.from(rows.values());\r\n            }\r\n            if (typeof handle === 'function') {\r\n              handle(selectedItems);\r\n            }\r\n            if (subject) {\r\n              subject.next();\r\n            }\r\n            dialogRef.close(options);\r\n          }\r\n        }\r\n      }\r\n    ];\r\n\r\n    const subject = new Subject<any>();\r\n    const { modalId = null } = options;\r\n    const { remote = null, currentRow = false, areaResponse = undefined } = configs;\r\n    const handle = options.handle;\r\n    // æ¯æareaResponseéç½®\r\n    if (areaResponse !== undefined && options.areaResponse === undefined) {\r\n      options.areaResponse = areaResponse;\r\n    }\r\n    if (remote) {\r\n      options.remote = remote + '?v=' + new Date().valueOf();\r\n      this.openModal(options, modalId, params, (dialogRef: any) => {\r\n        this.modals[modalId] = { subject, frameId: frameId, dialogRef, handle, currentRow, event: events.event };\r\n      });\r\n    } else {\r\n      const dialogRef = this.openModal(options, modalId, params);\r\n      this.modals[modalId] = { subject, frameId: frameId, dialogRef, handle, currentRow, event: events.event };\r\n    }\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * ç¡®è®¤æé®äºä»¶\r\n   * @throws frameId\r\n   */\r\n  public confirm() {\r\n    const events = this['context'] && this['context']['eventParam'] || {};\r\n    const { modalId = null } = events || {};\r\n    if (modalId) {\r\n      const modal = this.modals[modalId];\r\n      const { subject = null, dialogRef = null, mapFields = {}, frameId = null, currentRow = false, event = null, context = null } = modal || {};\r\n      const formCmp = dialogRef.content; // å¼¹çªè¡¨åå®ä¾\r\n      if (!formCmp) {\r\n        throw new Error('ä¸æ¯æçè¡¨åç±»å');\r\n      }\r\n      // const selectedIds = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.ids;\r\n\r\n      let selectedItems = [];\r\n      if (currentRow === true) {\r\n        const frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId) as FrameContext;\r\n        if (!frameComtext) {\r\n          throw new Error(`æ æçframeIdï¼${frameId}ï¼è¯·ç¡®è®¤å½ä»¤ä¸­frameIdæ­£ç¡®ã`);\r\n        }\r\n        const bindingList = frameComtext.bindingData.getList() as BindingList;\r\n        const item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();\r\n        if (item && Object.keys(item).length > 0) {\r\n          selectedItems = [item];\r\n        }\r\n      } else {\r\n        const rows: Map<string, any> = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map<string, any>();\r\n        selectedItems = Array.from(rows.values());\r\n      }\r\n\r\n      // æ å°å­æ®µæ°æ®\r\n      // è·åè§¦åå¼¹æ¡çç¼è¾å¨çå­æ®µåç§°\r\n      let editorField = undefined;\r\n      if (event && event.editor && event.editor.column) {\r\n        editorField = event.editor.column.field;\r\n      }\r\n      if (selectedItems && mapFields) {\r\n        Object.keys(mapFields).forEach((k) => {\r\n          const targetField: string = mapFields[k];\r\n          const sourceKeyArray = k.split('.').filter((p) => p) || [];\r\n          const targetValue = selectedItems.map((r) => {\r\n            return sourceKeyArray.reduce((target, key) => {\r\n              if (target && (target.hasOwnProperty(key) || target['__proto__'].hasOwnProperty(key))) {\r\n                return target[key];\r\n              } else {\r\n                return '';\r\n              }\r\n            }, r);\r\n          }).join(',');\r\n          if (targetField) {\r\n            const bindingPaths = this.frameContext.viewModel.bindingPath.split('/').filter((p) => p);\r\n            const targetFields = targetField.split(',').filter((p) => p);\r\n            targetFields.forEach((target) => {\r\n              if (context) {\r\n                this.setValueByPath(context, target, targetValue);\r\n              } else {\r\n                // ä¿®å¤è¡¨æ ¼æºè½è¾å¥æ¡éæ©å¼åæºè½è¾å¥æ¡å¼ä¸¢å¤±çé®é¢\r\n                if (event.formControl && event.formControl.setValue && event.editor && event.editor.column && event.editor.column.field === target) {\r\n                  event.formControl.setValue(targetValue);\r\n                }\r\n                const targetPath = target.split('.');\r\n                this.frameContext.bindingData.setValue(bindingPaths.concat(targetPath), targetValue, true, true);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      if (subject) {\r\n        subject.next();\r\n      }\r\n      dialogRef.close();\r\n    }\r\n  }\r\n  /**\r\n   * åæ¶æé®äºä»¶\r\n   * @param event\r\n   */\r\n  public cancel(event?: any) {\r\n    const events = event || this['context'] && this['context']['eventParam'] || {};\r\n    const { modalId = null } = events || {};\r\n    if (modalId) {\r\n      const modal = this.modals[modalId];\r\n      const { subject = null, dialogRef = null } = modal || {};\r\n      if (subject) {\r\n        subject.next();\r\n      }\r\n      if (dialogRef) {\r\n        dialogRef.close();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * åæ¶æå¡å¨åæ´é\r\n   * @param ref\r\n   */\r\n  private cancelChanges(ref: any): Observable<boolean> {\r\n    if (ref && ref.modalRef && ref.modalRef.content) {\r\n      const component: FrameComponent = ref.modalRef.content as FrameComponent;\r\n      if (component && component.context) {\r\n        const repository = component.context.repository || null;\r\n        if (repository) {\r\n          return repository.cancelChanges().pipe(switchMap(() => of(true)));\r\n        }\r\n      }\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * å³é­è¯¥å¼¹çª\r\n   */\r\n  closeModal() {\r\n    if (this.modalRef) {\r\n      this.modalRef.close();\r\n    }\r\n  }\r\n  /**\r\n   * åå»ºè¿ç¨è¡¨åå®ä¾\r\n   * @param options dialogéç½®\r\n   * @param uiState uistate\r\n   */\r\n  private createRemoteForm(options: any, uiState: any): Subject<any> {\r\n    const remote = options.remote || false;\r\n    const subject = new Subject<any>();\r\n    if (remote) {\r\n      let moduleName = options.moduleName || null;\r\n      System.import(remote).then((module: any) => {\r\n        if (!moduleName) {\r\n          moduleName = Object.keys(module).pop();\r\n        }\r\n        const moduleFactory = module[moduleName] as NgModuleFactory<any>;\r\n        const moduleRef: NgModuleRef<{ trans?: { resolve?: () => Observable<any> } }> = moduleFactory.create(this.injector);\r\n        const resolve = moduleRef && moduleRef.instance && moduleRef.instance.trans && typeof moduleRef.instance.trans.resolve === 'function' && moduleRef.instance.trans.resolve || (() => of(true));\r\n        resolve.apply(moduleRef.instance.trans).subscribe(() => {\r\n          const entryComponent = moduleRef['_bootstrapComponents'][0];\r\n          if (entryComponent) {\r\n            const compFactory = moduleRef.componentFactoryResolver.resolveComponentFactory(entryComponent);\r\n            const injector = this.createInjector(this.refs);\r\n            const componentRef: ComponentRef<any> = compFactory.create(injector);\r\n            if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {\r\n              if (typeof uiState === 'object' && Object.keys(uiState).length) {\r\n                Object.keys(uiState).forEach((item) => {\r\n                  componentRef.instance.viewModel.uiState.setPropertyValue(item, uiState[item]);\r\n                });\r\n              }\r\n              // éå isDialogåæ°\r\n              componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n            }\r\n            const modalRef = this.modalService.show(componentRef, options);\r\n            subject.next(modalRef);\r\n          } else {\r\n            throw new Error(`æ æ³æ¾å°å¥å£è¡¨åï¼`);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return subject;\r\n  }\r\n  private setValueByPath(target: object, path: string, value: any) {\r\n    if (target) {\r\n      const paths = path.split('.');\r\n      if (paths.length <= 1) {\r\n        target[path] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private createInjector(modalRef: BsModalRef, injector?: Injector) {\r\n    const providers = [\r\n      { provide: INSIDE_DIALOG_TOKEN, useValue: true },\r\n      {\r\n        provide: MODAL_REF, useValue: forwardRef(() => modalRef)\r\n      }\r\n    ];\r\n    return Injector.create({ providers, parent: injector || this.injector });\r\n  }\r\n}\r\n\r\nexport { DialogService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { FarrisSidebarService } from '@farris/ui-sidebar';\r\nimport { Entity, FrameContext } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\n\r\n\r\n/**\r\n * ä¾§è¾¹æ æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass SidebarService {\r\n\r\n  private get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private sidebarUIService: FarrisSidebarService,\r\n    private messageService: FormMessageService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  openSidebar() {\r\n    this.sidebarUIService.sendIsOpen(true);\r\n  }\r\n\r\n  closeSidebar() {\r\n    this.sidebarUIService.sendIsOpen(false);\r\n  }\r\n\r\n  /**\r\n   * å³é­åååæ¶åæ´\r\n   */\r\n  confirmBeforeClosingSidebar(): Observable<boolean> {\r\n\r\n    // æ£æ¥æ¯å¦æåæ´ï¼æ²¡æåæ´ç´æ¥å³é­\r\n    const ifChangesExist = this.repository.entityManager.checkAllEntityChanges();\r\n    if (!ifChangesExist) {\r\n      return of(true);\r\n    }\r\n\r\n    // ç¡®è®¤æ¯å¦å³é­\r\n    const confirm$ = this.messageService.question(this.languageService['exitWithoutSave']);\r\n    const result$ = confirm$.pipe(\r\n      switchMap((confirmResult: boolean) => {\r\n        if (confirmResult === false) {\r\n          return of(false);\r\n        } else {\r\n          return of(true);\r\n        }\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * ç»§ç»­å³é­ä¾§è¾¹æ \r\n   */\r\n  public continueClosingSidebar(): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  /**\r\n   * é»æ­¢ä¾§è¾¹æ å³é­\r\n   */\r\n  public stopClosingSidebar(): Observable<boolean> {\r\n    return of(false);\r\n  }\r\n}\r\n\r\nexport { SidebarService };\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * è¿æ»¤æ¡ä»¶æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass FilterService {\r\n\r\n  /**\r\n   * ç§»é¤åå«ç¹æ®å¼çè¿æ»¤æ¡ä»¶\r\n   * @todoï¼åå®filtersä¸ºå­ç¬¦ä¸²ï¼å¾è®¾è®¡æ¶æ¯ææ°ç»åæ°åä¸èµ·è°æ´\r\n   */\r\n  public stripFiltersWithSpecialValue(filters: string, specialValues: string): string {\r\n    if (!filters || !specialValues) {\r\n      return filters;\r\n    }\r\n\r\n    const filterArray: any[] = JSON.parse(filters);\r\n    const strippedFilterArray = filterArray.filter((filter: any) => {\r\n      const filterValue = this.getFilterValue(filter);\r\n      return specialValues.indexOf(filterValue) === -1;\r\n    });\r\n\r\n    return JSON.stringify(strippedFilterArray);\r\n  }\r\n\r\n  /**\r\n   * è·åè¿æ»¤æ¡ä»¶çå¼\r\n   * @todoï¼æ²¡æFilteræ¥å£å®ä¹ï¼ç®åäº§åé¨å¤§å°åä¸ä¸è´ã\r\n   */\r\n  private getFilterValue(filter: any) {\r\n    return filter.Value || filter.value;\r\n  }\r\n}\r\n\r\nexport { FilterService };\r\n","import { Injectable, InjectionToken, Inject, Optional } from '@angular/core';\r\nexport const FARRIS_FORM_COMPONENTS = new InjectionToken<{ [key: string]: any }>('è¡¨åå¼¹åºçªå£æéèç»ä»¶åè¡¨');\r\n\r\n/**\r\n * è¡¨åæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class ComponentManagerService {\r\n\r\n  private controls: { [key: string]: any } = {};\r\n\r\n  appendControl(key: string, cmpIns: any) {\r\n    this.controls[key] = cmpIns;\r\n  }\r\n\r\n  getControl(key: string) {\r\n    if (this.controls[key]) {\r\n      return this.controls[key];\r\n    } else {\r\n      console.warn(`æªæ¾å°Keyä¸º${key}çç»ä»¶ï¼`);\r\n      return null;\r\n    }\r\n  }\r\n  public clear(key?: string) {\r\n    if (key) {\r\n      this.controls[key] = null;\r\n      delete this.controls[key];\r\n    } else {\r\n      this.controls = {};\r\n    }\r\n  }\r\n}\r\n","import { Observable, of,Subject } from \"rxjs\";\r\n\r\nexport class AuthorityService {\r\n    queryOperationAuthority(operationIds: Array<string>): Observable<Map<string, boolean>>{\r\n        var queryResult = new Map<string, boolean>();\r\n        var i=0;\r\n        for(var j=0; j<operationIds.length; j++) {\r\n            queryResult.set(operationIds[j], i%2==0? true:false);\r\n            i++;            \r\n        }\r\n\r\n        var dummyResult = new Subject<Map<string, boolean>>();\r\n        setTimeout(() => {\r\n            dummyResult.next(queryResult);\r\n        }, 0);\r\n\r\n        return dummyResult;\r\n    }\r\n}\r\n","import { AuthorityService } from './authority.service';\r\nimport {Observable, empty} from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n/**\r\n * æé\r\n */\r\nexport class Authority {\r\n    \r\n    constructor() {\r\n        this.operationLabelMap = new Map<string, string>();\r\n        this.authOfLabel = new Map<string, boolean>();\r\n    }\r\n\r\n    /**\r\n     * ä»labelå°æä½æéIDçæ å°ï¼labelå¯ä»¥æ¯button idç­\r\n     */\r\n    private operationLabelMap: Map<string, string>;\r\n\r\n    /**\r\n     * è®°å½labelå¯¹äºçæä½æéï¼æ¯å¦éè¿\r\n     */\r\n    private authOfLabel: Map<string, boolean>;\r\n\r\n    /**\r\n     * è®¾ç½®labelå°operation idçæ å°\r\n     * @param labelMap \r\n     */\r\n    protected setLabelMap(labelMap: Object) {\r\n        for(var i in labelMap) {\r\n            this.operationLabelMap.set(i, labelMap[i]);\r\n        }\r\n        this.operationLabelMap.forEach((opId, label) => {\r\n            this[label] = false;\r\n        });        \r\n    }\r\n    \r\n    /**\r\n     * åå§åæéçå¼\r\n     */\r\n    initialize(authorityService: AuthorityService): Observable<void> {\r\n        if(this.operationLabelMap && this.operationLabelMap.size>0) {\r\n            return authorityService.queryOperationAuthority(Array.from(this.operationLabelMap.values())).pipe(\r\n                map((operationAuth) => {\r\n                    this.operationLabelMap.forEach((opId, label) => {\r\n                        this.authOfLabel.set(label, operationAuth.has(opId) ? operationAuth.get(opId) : false);\r\n                    });\r\n                })\r\n            );\r\n        }else{\r\n            return empty();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è¿åæä½æéï¼å³ç¨æ·æ¯å¦æ¥æLabelæå¯¹åºçæé\r\n     * @param label æ ç­¾ï¼å¯ä»¥æ¯button idç­\r\n     */\r\n    hasOperation(label:string) {        \r\n        return this.authOfLabel.has(label) && this.authOfLabel.get(label);\r\n    }\r\n\r\n    // è¿åå­æ®µæé\r\n    // hasField(field:string)\r\n}","/*\r\n * @Author: aalizzwell\r\n * @Date: 2019-05-30 10:35:09\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-15 19:22:13\r\n */\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormErrorService } from './error/form-error.service';\r\nimport { IExceptionHandler, AppContext } from '@farris/devkit';\r\n\r\n/**\r\n * é»è®¤å¼å¸¸å¤çå¨\r\n * @scope æ²¡ææä¾å¯¹åºProvider\r\n */\r\n@Injectable()\r\nclass ExceptionHandler implements IExceptionHandler {\r\n  private appContext: AppContext = null;\r\n  constructor(\r\n    private formErrorService: FormErrorService,\r\n    @Optional() private languageService: LanguageService,\r\n    private applicationContext: AppContext,\r\n  ) {\r\n    if (this.languageService == null) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n  public setContext(applicationContext: AppContext) {\r\n    this.appContext = applicationContext;\r\n  }\r\n  public handle(error: any) {\r\n    if (!!this.formErrorService) {\r\n      this.formErrorService.exception(this.languageService.loadFailed, error);\r\n    }\r\n  }\r\n}\r\n\r\nexport { ExceptionHandler };\r\n","import { Provider } from '@angular/core';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { HideEventService } from '../form-loading/hide-event.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { CheckService } from '../check.service';\r\nimport { DataCheckService } from '../data-check.service';\r\n\r\nimport { EventService } from '../event.service';\r\nimport { MenuStateService } from '../menu-state.service';\r\nimport { RouterService } from '../router.service';\r\nimport { UIStateService } from '../ui-state.service';\r\nimport { StateMachineService } from '../state-machine.service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { BindingDataService } from '../binding-data.service';\r\nimport { CommandService } from '../command-service';\r\n\r\nimport { QuerystringService } from '../querystring';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { NavigationMiddlewareService } from '../navigation-middleware.service';\r\nimport { GridMiddlewareService } from '../grid.middleware.service';\r\nimport { ParamService } from '../param.service';\r\n\r\nimport { BeActionService } from '../be-action.service';\r\nimport { ApproveService } from '../approve.service';\r\nimport { PrintService } from '../print.service';\r\nimport { AttachmentDataService, AttachmentService } from '../attachment/index';\r\nimport { ApplicationParamService } from '../application-param.service';\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityListService, EntityService\r\n} from '../entity-services/index';\r\nimport { LanguageService } from '../languag.service';\r\nimport { DialogService } from '../dialog.service';\r\nimport { SidebarService } from '../sidebar-service';\r\nimport { FarrisFormService } from '../farris-form.service';\r\nimport { FilterService } from '../filter-service';\r\nimport { ChangeItemService } from '../change-item.service';\r\n\r\n// data-services\r\nimport { ListDataService } from '../data-services/list-data.service';\r\nimport { TreeDataService } from '../data-services/tree-data.service';\r\nimport { CardDataService } from '../data-services/card-data.service';\r\nimport { SubListDataService } from '../data-services/sub-list-data.service';\r\nimport { KeybindingService } from '../keybinding-service';\r\nimport { FocusInvalidService } from '../focus-invalid.service';\r\nimport { SubTreeDataService } from '../data-services/sub-tree-data-service';\r\n\r\n/**\r\n * éççèProviders\r\n */\r\nconst FARRIS_COMMAND_SERVICE_PROVIDERS: Provider[] = [\r\n\r\n  // è¡¨åæ¨¡åæ³¨å¥ï¼18ä¸ªï¼\r\n  FormLoadingService,\r\n  FormMessageService,\r\n  FormNotifyService,\r\n  FormErrorService,\r\n  CheckService,\r\n  DataCheckService,\r\n  EventService,\r\n  FilterService,\r\n  KeybindingService,\r\n  LanguageService,\r\n  ParamService,\r\n  MenuStateService,\r\n  QuerystringService,\r\n  RuntimeFrameworkService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  RouterService,\r\n  ApplicationParamService,\r\n\r\n  // FrameComponentï¼20ä¸ªï¼\r\n  ValidationService,\r\n  FocusInvalidService,\r\n  ChangeItemService,\r\n  UIStateService,\r\n  StateMachineService,\r\n  BindingDataService,\r\n  CommandService,\r\n\r\n  // entity-services\r\n  EntityTraversingService,\r\n  EntityManipulationService,\r\n  EntityAggregationService,\r\n  EntityListService,\r\n  EntityService,\r\n\r\n  ListDataService,\r\n  TreeDataService,\r\n  SubTreeDataService,\r\n  CardDataService,\r\n  SubListDataService,\r\n\r\n  BeActionService,\r\n  ApproveService,\r\n  PrintService,\r\n  AttachmentDataService,\r\n  AttachmentService,\r\n  NavigationMiddlewareService,\r\n  GridMiddlewareService,\r\n  SidebarService,\r\n  FarrisFormService,\r\n  DialogService,\r\n];\r\n\r\nexport { FARRIS_COMMAND_SERVICE_PROVIDERS };\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { NumberFormat, UserSettings } from '@farris/devkit';\r\nimport { FrmI18nSettingService } from '@gsp-sys/rtf-common';\r\n\r\n@Injectable()\r\nexport class UserSettingsService implements UserSettings {\r\n  constructor(private injector: Injector, @Optional() private frmI18nSettingService: FrmI18nSettingService) { }\r\n\r\n  /**\r\n   * ç¨æ·æ¶åºå­ç¬¦ä¸²\r\n   */\r\n  public get timeZone(): string {\r\n    return this.timezone && this.timezone.id || null;\r\n  }\r\n  /**\r\n   * æ¶åºåç§»\r\n   */\r\n  public get timeZoneOffset(): number {\r\n    const offset = this.timezone && this.timezone.baseOffset;\r\n    if (offset !== null && offset !== undefined) {\r\n      return offset;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * é»è®¤è¯­è¨\r\n   */\r\n  public get defaultLanguage(): string {\r\n    return this.i18nSetting && this.i18nSetting.defaultLanguage || null;\r\n  }\r\n  /**\r\n   * æ¥ææ ¼å¼åå­ç¬¦ä¸²\r\n   * like: yyyy-MM-dd\r\n   */\r\n  public get dateFormat(): string {\r\n    return this.i18nSetting && this.i18nSetting.userDateFormat || null;\r\n  }\r\n  /**\r\n   * æ¶é´æ ¼å¼\r\n   * like: HH:MM:ss\r\n   */\r\n  public get timeFormat(): string {\r\n    return this.i18nSetting && this.i18nSetting.userTimeFormat || null;\r\n  }\r\n  public get dateTimeFormat(): string {\r\n    const dateFormat = this.i18nSetting && this.i18nSetting.userDateFormat || 'yyyy-MM-dd';\r\n    const timeFormat = this.i18nSetting && this.i18nSetting.userTimeFormat || 'HH:mm:ss';\r\n    return `${dateFormat} ${timeFormat}`;\r\n  }\r\n  /**\r\n   * å°åæ ¼å¼\r\n   */\r\n  public get addressFormat(): any {\r\n    return null;\r\n  }\r\n  /**\r\n   * æ°å­æ ¼å¼\r\n   */\r\n  public get numberFormat(): NumberFormat {\r\n    if (this.i18nSetting && this.i18nSetting.userNumberFormat) {\r\n      const userNumberFormat = this.i18nSetting.userNumberFormat;\r\n      const numberFormat: NumberFormat = {\r\n        negativeSign: userNumberFormat.negativeSign || '-',\r\n        numberDecimalDigits: userNumberFormat.numberDecimalDigits || 2,\r\n        numberDecimalSeparator: userNumberFormat.numberDecimalSeparator || '.',\r\n        numberGroupSeparator: userNumberFormat.numberGroupSeparator || ','\r\n      };\r\n      return numberFormat;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * åºåä»£ç \r\n   */\r\n  public get regionCode(): string {\r\n    return this.i18nSetting && this.i18nSetting.userRegionCode || null;\r\n  }\r\n  /**\r\n   * ç¨æ·éç½®\r\n   */\r\n  private get userSettings(): any {\r\n    const userSettings = this.frmI18nSettingService && this.frmI18nSettingService.getSetting();\r\n    return userSettings;\r\n  }\r\n  private get timezone() {\r\n    return this.i18nSetting && this.i18nSetting.timezone;\r\n  }\r\n  private get i18nSetting() {\r\n    return this.userSettings && this.userSettings.i18nSetting;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { WorkFlow } from \"./types\";\r\n\r\n@Injectable()\r\nexport class WorkFlowMessageService {\r\n  private messageHandler: (callback: (e: WorkFlow.IMessage) => void) => (event: any) => void;\r\n  private handler: (event: any) => void;\r\n  constructor() {\r\n    this.messageHandler = (callback: (e: WorkFlow.IMessage) => void) => {\r\n      return (event: any) => {\r\n        var message = event.data as WorkFlow.IMessage;\r\n        if (message) {\r\n          message.sender = event.source;\r\n        }\r\n        if (typeof callback === 'function') {\r\n          callback(message);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * çå¬å·¥ä½æµæ¶æ¯\r\n   * @param callback åè°\r\n   */\r\n  public listen(callback: (e: WorkFlow.IMessage) => void) {\r\n    this.handler = this.messageHandler(callback);\r\n    window.addEventListener('message', this.handler);\r\n  }\r\n  public destroy() {\r\n    if (this.handler) {\r\n      window.removeEventListener('message', this.handler);\r\n    }\r\n\r\n  }\r\n  /**\r\n   * ç»å·¥ä½æµè¡¨ååéæ¶æ¯\r\n   * @param message \r\n   */\r\n  public send(message: WorkFlow.IMessage): void {\r\n    if (!message) {\r\n      return;\r\n    }\r\n    let win: Window = window;\r\n    if (message.target) {\r\n      win = message.target as Window || window;\r\n      delete message.target;\r\n    }\r\n    if (win) {\r\n      win.postMessage(message, '*');\r\n    }\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { WorkFlow } from \"./types\";\r\nimport { WorkFlowMessageService } from \"./work-flow-message.service\";\r\n\r\n/**\r\n * å·¥ä½æµæ¶æ¯\r\n * @warning ç¦æ­¢ä½¿ç¨è¡¨åä¸ä¸æï¼ææä¸ä¸æå¿é¡»ä»å¤é¨ä¼ å¥\r\n */\r\n@Injectable()\r\nexport class WorkFlowMessage {\r\n  private listeners: Map<string, any>;\r\n  constructor(private injector: Injector, public workFlowMessageService: WorkFlowMessageService) {\r\n    this.listeners = new Map<string, any>();\r\n  }\r\n  public setup() {\r\n    if (!this.workFlowMessageService) {\r\n      return;\r\n    }\r\n    this.workFlowMessageService.listen((message: WorkFlow.IMessage) => {\r\n      if (!this.listeners || this.listeners.size < 1) {\r\n        return;\r\n      }\r\n      this.listeners.forEach((callback: any, key: string) => {\r\n        if (typeof callback === 'function') {\r\n          callback(message);\r\n        }\r\n      })\r\n    });\r\n  }\r\n  public addEventListener(callback: (event: MessageEvent) => void): string {\r\n    const id = `${new Date().valueOf().toString(16)}-${Math.ceil(Math.random() * 100)}`;\r\n    this.listeners.set(id, callback);\r\n    return id;\r\n  }\r\n  public removeEventListener(eventId: string): void {\r\n    if (!this.listeners || this.listeners.size < 1) {\r\n      return;\r\n    }\r\n    this.listeners.delete(eventId);\r\n    eventId = null;\r\n  }\r\n}\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, AppContextManager, FrameContext, onFrameComponentInit } from \"@farris/devkit\";\r\nimport { from, Observable, of } from \"rxjs\";\r\nimport { BefRepository, BefRepositoryUtil } from '@farris/bef';\r\nimport { concatMap, throwIfEmpty } from \"rxjs/operators\";\r\nimport { ValidationService } from \"../validation.service\";\r\nimport { WorkFlow } from \"./types\";\r\nimport { WorkFlowMessage } from \"./work-flow-message\";\r\nimport { WorkFlowMessageService } from \"./work-flow-message.service\";\r\n\r\n@Injectable()\r\nexport class WorkFlowMessageHandler implements onFrameComponentInit {\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private workFlowMessageService: WorkFlowMessageService, private workFlowMessage: WorkFlowMessage) {\r\n\r\n  }\r\n  public onComponentInit(frameContext: FrameContext) {\r\n    const eventId = this.workFlowMessage.addEventListener(this.handle.bind(this));\r\n    const frameContextDestroySignal = this.frameContext.destorySignal;\r\n    if (frameContextDestroySignal) {\r\n      frameContextDestroySignal.subscribe(() => {\r\n        this.workFlowMessage.removeEventListener(eventId);\r\n      });\r\n    }\r\n    const appContextDestroySignal = this.frameContext.appContext.destorySignal;\r\n    if (appContextDestroySignal) {\r\n      appContextDestroySignal.subscribe(() => {\r\n        this.workFlowMessage.workFlowMessageService.destroy();\r\n      });\r\n    }\r\n  }\r\n  public handle(message: WorkFlow.IMessage): void {\r\n    const source = message.sender as Window;\r\n    const data = message.data as WorkFlow.IMessageBody;\r\n    const commandName = data && data.command || null;\r\n    let resultTask: Observable<any> = null;\r\n    if (!commandName) {\r\n      return;\r\n    }\r\n    if (commandName == 'wf-required-verification') {\r\n      // å·¥ä½æµçå¿å¡«æ ¡éª\r\n      // å¦æ­¤è·åçæ¯å½åç»ä»¶çæ ¡éªæå¡ï¼åºè¯¥ænamespaceæ¥åºåï¼ä¸åçnamespaceéè¦åå«æ§è¡æ ¡éª\r\n      const formFrameContexts = this.getFormFrameContexts();\r\n      resultTask = from(formFrameContexts).pipe(\r\n        concatMap((frameContext: FrameContext) => {\r\n          var validation = frameContext.injector.get<ValidationService>(ValidationService, null);\r\n          if (validation) {\r\n            return validation.validateAll();\r\n          }\r\n          return of(true);\r\n        })\r\n      );\r\n    } else {\r\n      var command = this.frameContext.viewModel[commandName];\r\n      if (command) {\r\n        resultTask = command(data.arguments);\r\n      }\r\n    }\r\n    if (resultTask) {\r\n      const message: WorkFlow.IMessage = this.buildMessage(true, source, this.isChanged);\r\n      resultTask.pipe(throwIfEmpty()).subscribe((result) => {\r\n        // åæ¥æºæ¹åä¼ æ¶æ¯\r\n        this.workFlowMessageService.send(message);\r\n      }, () => {\r\n        message.data.result = false;\r\n        this.workFlowMessageService.send(message);\r\n      });\r\n    }\r\n  }\r\n  private buildMessage(result: boolean, target: any, dataChanged: boolean, type: string = 'message') {\r\n    const message: WorkFlow.IMessage = {\r\n      data: {\r\n        result,\r\n        dataChanged\r\n      },\r\n      type: type,\r\n      target: target,\r\n    };\r\n    return message;\r\n  }\r\n  private getFormFrameContexts(): FrameContext[] {\r\n    const appContextManager = this.injector.get<AppContextManager>(AppContextManager, null);\r\n    const formFrameContexts = [];\r\n    if (appContextManager) {\r\n      const appContexts: AppContext[] = appContextManager.getAppContexts();\r\n      if (appContexts && appContexts.length > 0) {\r\n        appContexts.forEach((appContext: AppContext) => {\r\n          const frameContexts: FrameContext[] = appContext.frameContextManager.getFrameContexts();\r\n          frameContexts.reduce((contexts: FrameContext[], frameContext: FrameContext) => {\r\n            const namespace = frameContext.namespace;\r\n            const index = contexts.findIndex((frame: FrameContext) => frame.namespace === namespace);\r\n            if (index === -1) {\r\n              const root = frameContext.getVirtualRootFrameContext();\r\n              contexts.push(root);\r\n            }\r\n            return contexts;\r\n          }, formFrameContexts);\r\n        });\r\n      }\r\n    }\r\n    return formFrameContexts;\r\n  }\r\n  /**\r\n   * æ¯å¦ææªä¿å­çåæ´\r\n   */\r\n  private get isChanged(): boolean {\r\n    const befRepository = this.frameContext.repository as BefRepository<any>;\r\n    return BefRepositoryUtil.isExistUnsaveData(befRepository);\r\n  }\r\n}","import { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { FormWizardService } from '../form-wizard.service';\r\n\r\nimport { CheckService } from '../check.service';\r\nimport { DataCheckService } from '../data-check.service';\r\nimport { EventService } from '../event.service';\r\nimport { ComponentManagerService } from '../component-manager.service';\r\nimport { FilterService } from '../filter-service';\r\nimport { KeybindingService } from '../keybinding-service';\r\nimport { LanguageService } from '../languag.service';\r\n\r\nimport { MenuStateService } from '../menu-state.service';\r\nimport { QuerystringService } from '../querystring';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { ParamService } from '../param.service';\r\nimport { RouterService } from '../router.service';\r\nimport { ApplicationParamService } from '../application-param.service';\r\nimport { FilterConditionService } from '../filter-condition.service';\r\nimport { UserSettingsService } from '../user-settings.service';\r\nimport { UserSettingsToken } from '@farris/devkit';\r\nimport { WorkFlowMessage, WorkFlowMessageService } from '../work-flow/index';\r\n/**\r\n * æ¨¡åçº§æ³¨å¥(å±20ä¸ª)\r\n */\r\nconst FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS = [\r\n  FormLoadingService,\r\n  FormMessageService,\r\n  FormNotifyService,\r\n  FormErrorService,\r\n  FormWizardService,\r\n  CheckService,\r\n  DataCheckService,\r\n  EventService,\r\n  ComponentManagerService,\r\n  FilterService,\r\n  KeybindingService,\r\n  LanguageService,\r\n  ParamService,\r\n  MenuStateService,\r\n  QuerystringService,\r\n  RuntimeFrameworkService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  RouterService,\r\n  ApplicationParamService,\r\n  FilterConditionService,\r\n  { provide: UserSettingsToken, useClass: UserSettingsService },\r\n  WorkFlowMessageService,\r\n  WorkFlowMessage\r\n];\r\n\r\nexport { FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS }\r\n","/**\r\n * æ¯è¾ç¬¦\r\n */\r\nexport enum CompareType{\r\n    Equal = 0,\r\n    NotEqual = 1,\r\n    Greater = 2,\r\n    GreaterOrEqual = 3,\r\n    Less = 4,\r\n    LessOrEqual = 5,\r\n    Like = 6,\r\n    LikeStartWith = 7,\r\n    LikeEndWith = 8,\r\n    NotLike = 9,\r\n    NotLikeStartWith = 10,\r\n    NotLikeEndWith = 11,\r\n    Is = 12,\r\n    IsNot = 13,\r\n    In = 14,\r\n    NotIn = 15\r\n}","export enum ValueType{\r\n\r\n    /**\r\n     *å¼ç±»å\r\n     */\r\n    Value = 0,\r\n\r\n    /**\r\n     * è¡¨è¾¾å¼\r\n     */\r\n    Express = 1\r\n}","export enum RelationType{\r\n\r\n    Empty = 0,\r\n\r\n    /**\r\n     * ä¸\r\n     */\r\n    // And=0,\r\n    And = 1,\r\n\r\n    /**\r\n     * æ\r\n     */\r\n    // Or=1\r\n    Or = 2\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, TextValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class TextHandler implements IQueryConditionHandler {\r\n  convert(qc: QueryCondition) {\r\n    const tv = (qc.value as TextValue);\r\n    return [{\r\n      'FilterField': qc.fieldCode,\r\n      'Compare':  (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Like,\r\n      'Value': tv.value, // jsonè½¬ä¹ä¸encodeUriComponentä¸åï¼ä¸åºå¨æ­¤è½¬ä¹ï¼ç±jsonåé¨è½¬ä¹å³å¯\r\n      'Relation': (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n      'Expresstype': ValueType.Value,\r\n      'Lbracket': qc.Lbracket || null,\r\n      'Rbracket': qc.Rbracket || null\r\n    }];\r\n  }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, DateRangeValue, DateRangeControl} from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class DateRangeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        let control:DateRangeControl = qc.control as DateRangeControl\r\n        const arr = [];\r\n        const drv = (qc.value as DateRangeValue);\r\n        drv.startTime && arr.push({\r\n            'FilterField' : control.startFieldCode ? control.startFieldCode : qc.fieldCode,\r\n            'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n            'Value' : drv.startTime,\r\n            'Relation' : RelationType.And, //and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n        drv.endTime && arr.push({\r\n            'FilterField' : control.endFieldCode ? control.endFieldCode : qc.fieldCode,\r\n            'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n            'Value' : drv.endTime,\r\n            'Relation' : RelationType.And,//and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, DropDownListValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class DropDownHandler implements IQueryConditionHandler{\r\n    //qc.comparetypeåªæç­äºãä¸ç­äº\r\n    convert(qc: QueryCondition) {\r\n        const ddv = (qc.value as DropDownListValue);\r\n        const arr = [];\r\n        ddv.value.forEach(dv => {\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                'Value' : dv.value,\r\n                'Relation' : qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n                'Expresstype':ValueType.Value\r\n            });\r\n        });\r\n        arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n        arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n        arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, NumberRangeValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class NumberRangeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = [];\r\n        const nrv = (qc.value as NumberRangeValue);\r\n        (nrv.startValue != null) && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n            'Value' : nrv.startValue,\r\n            'Relation' : RelationType.And, //and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n        (nrv.endValue != null) && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n            'Value' : nrv.endValue,\r\n            'Relation' : RelationType.And,//and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SmartHelpValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SmartHelpHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const shv = (qc.value as SmartHelpValue);\r\n        if(shv.value.length == 0) return [];\r\n\r\n        const arr = [];\r\n        if(shv.isInputText || shv.valueField == null){\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Like,\r\n                'Value' : shv.textValue,\r\n                'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And ,\r\n                'Expresstype':ValueType.Value\r\n            });\r\n            return arr;\r\n        }else{\r\n            shv.getOriginalValue().split(',').forEach(id => {\r\n                id && arr.push({\r\n                    'FilterField' : qc.fieldCode,\r\n                    'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                    'Value' : id,\r\n                    'Relation' : qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n                    'Expresstype':ValueType.Value\r\n                });\r\n            });\r\n            if(arr.length > 0){\r\n                arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n                arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n                arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n                return arr;\r\n            }else{\r\n                return [];\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleYearValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleYearHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const yv = (qc.value as SingleYearValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : yv.yearValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, CheckBoxValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class CheckBoxHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        //å¤éæ¡çqc.compareType åªæç­äº\r\n        const arr = [];\r\n        const tv = (qc.value as CheckBoxValue);\r\n        if(tv.value.length == 1)\r\n            return [{\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.Equal,\r\n                'Value' : tv.value[0],\r\n                'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n                'Expresstype':ValueType.Value,\r\n                'Lbracket': qc.Lbracket || null,\r\n                'Rbracket': qc.Rbracket || null\r\n            }];\r\n        tv.value.forEach(tvv => {\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.Equal,\r\n                'Value' : tvv,\r\n                'Relation' : RelationType.Or,\r\n                'Expresstype':ValueType.Value\r\n            });\r\n        });\r\n        arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n        arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n        arr[arr.length -1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleMonthValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleMonthHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const mv = (qc.value as SingleMonthValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' :(qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : mv.monthValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, MonthRangeValue} from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class MonthRangeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = [];\r\n        const mrv = (qc.value as MonthRangeValue);\r\n        mrv.startTime && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n            'Value' : mrv.startTime,\r\n            'Relation' : RelationType.And, //and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n        mrv.endTime && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n            'Value' : mrv.endTime,\r\n            'Relation' : RelationType.And,//and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleDateTimeValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleDateTimeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const dtv = (qc.value as SingleDateTimeValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : dtv.datetimeValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,//and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleNumberValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleNumberHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const dtv = (qc.value as SingleNumberValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : dtv.numValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleDateValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\nimport { format, addDays, addWeeks, addMonths, addYears, startOfMonth, endOfMonth, startOfYear, endOfYear, startOfWeek, endOfWeek, getDay } from 'date-fns'\r\nfunction getDate(dateValue, dtvFormat) {\r\n    let today = new Date()\r\n    // today.toLocaleString()\r\n    let result = []\r\n    //é¦åå¤æ­åªäºæ¯åä¸ªæ¥æï¼ä½¿ç¨equalå­å¥ä¸ä¸ªæ¥æå³å¯\r\n    if (dateValue.isFirstDay || dateValue.isLastDay) {\r\n\r\n        let switchValue = dateValue.dateType + '-' + (dateValue.isFirstDay ? 'first' : 'last')\r\n        switch (switchValue) {\r\n            case 'week-first':\r\n                if(getDay(today) === 0) {\r\n                    today = addDays(today, -1)\r\n                }\r\n                result.push(addDays(startOfWeek(today), 1))\r\n                break;\r\n            case 'week-last':\r\n                if(getDay(today) === 0) {\r\n                    today = addDays(today, -1)\r\n                }\r\n                result.push(addDays(endOfWeek(today), 1))\r\n                break;\r\n            case 'month-first':\r\n                result.push(startOfMonth(today))\r\n                break;\r\n            case 'month-last':\r\n                result.push(endOfMonth(today))\r\n                break;\r\n            case 'year-first':\r\n                result.push(startOfYear(today))\r\n                break;\r\n            case 'year-last':\r\n                result.push(endOfYear(today))\r\n                break;\r\n            default:\r\n                result.push(today)\r\n\r\n        }\r\n    } else if (dateValue.dateType === 'day' && dateValue.period === 'present') {\r\n        //ä»å¤©\r\n        result.push(today)\r\n    } else if (dateValue.dateType === 'day' && dateValue.count === 1) {\r\n        //æ¨å¤©ãæå¤©\r\n        let _date = addDays(today, dateValue.period === 'future' ? 1 : -1)\r\n        result.push(_date)\r\n    } else if (dateValue.period === 'present') {\r\n        //æ¬å¨ãæ¬æãæ¬å¹´\r\n        switch (dateValue.dateType) {\r\n            case 'week':\r\n                result.push(startOfWeek(today), endOfWeek(today))\r\n                break;\r\n            case 'month':\r\n                result.push(startOfMonth(today), endOfMonth(today))\r\n                break;\r\n            case 'year':\r\n                result.push(startOfYear(today), endOfYear(today))\r\n                break;\r\n            default:\r\n                result.push(today)\r\n        }\r\n\r\n    } else {\r\n        let switchValue = dateValue.dateType + '-' + dateValue.period\r\n        switch (switchValue) {\r\n            case 'day-previous':\r\n                result.push(addDays(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'day-future':\r\n                result.push(addDays(today, 1), addDays(today, dateValue.count))\r\n                break;\r\n            case 'week-previous':\r\n                result.push(addWeeks(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'week-future':\r\n                result.push(addDays(today, 1), addWeeks(today, dateValue.count))\r\n                break;\r\n            case 'month-previous':\r\n                result.push(addMonths(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'month-future':\r\n                result.push(addDays(today, 1), addMonths(today, dateValue.count))\r\n                break;\r\n            case 'year-previous':\r\n                result.push(addYears(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'year-future':\r\n                result.push(addDays(today, 1), addYears(today, dateValue.count))\r\n                break;\r\n            default:\r\n                result.push(today)\r\n        \r\n        }\r\n    }\r\n\r\n    result = result.map(item => format(item, dtvFormat.returnFormat || 'yyyy-MM-dd'))\r\n    return result\r\n\r\n};\r\nexport class SingleDateHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = []\r\n        const dtv = (qc.value as SingleDateValue);\r\n        if(typeof(dtv.dateValue) !== 'string') {\r\n            let _dateValue = getDate(dtv.dateValue, qc.control)\r\n            _dateValue.length === 1 && arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : qc.compareType ? CompareType[qc.compareType] : CompareType.Equal,\r\n                'Value' : _dateValue[0],\r\n                'Relation' : qc.relation ? RelationType[qc.relation] : RelationType.And, //and undefined\r\n                'Expresstype':ValueType.Value,\r\n                'Lbracket': qc.Lbracket || null,\r\n                'Rbracket': qc.Rbracket || null\r\n            })\r\n            _dateValue.length === 2 && arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n                'Value' : _dateValue[0],\r\n                'Relation' : RelationType.And, //and\r\n                'Expresstype': ValueType.Value,\r\n                'Lbracket': qc.Lbracket ? (qc.Lbracket + '(') :'('\r\n            }, {\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n                'Value' : _dateValue[1],\r\n                'Relation' : RelationType.And,//and\r\n                'Expresstype': ValueType.Value,\r\n                'Rbracket': qc.Rbracket ? (qc.Rbracket + ')') : ')'\r\n            });\r\n            \r\n        } else {\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                'Value' : dtv.dateValue,\r\n                'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n                'Expresstype':ValueType.Value,\r\n                'Lbracket': qc.Lbracket || null,\r\n                'Rbracket': qc.Rbracket || null\r\n            })\r\n        }\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, ComboLookUpValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class ComboLookUpHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        //å¸®å©çqc.comparetypeåªæç­äºãä¸ç­äº\r\n        const cluv = (qc.value as ComboLookUpValue);\r\n        if(cluv.value.length == 0 || !cluv.valueField){\r\n            return [];\r\n        }else{\r\n            const arr = [];\r\n            cluv.getOriginalValue().split(',').forEach(id => {\r\n                id && arr.push({\r\n                    'FilterField' : qc.fieldCode,\r\n                    'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                    'Value' : id,\r\n                    'Relation' : qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n                    'Expresstype':ValueType.Value\r\n                });\r\n            });\r\n            if(arr.length > 0){\r\n                arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n                arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n                arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n                return arr;\r\n            }else{\r\n                return [];\r\n            }\r\n        }\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, RadioValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class RadioHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = [];\r\n        const rv = (qc.value as RadioValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : rv.value,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, InputGroupValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class InputGroupHandler implements IQueryConditionHandler {\r\n  //qc.comparetypeåªæç­äºãç¸ä¼¼\r\n  convert(qc: QueryCondition) {\r\n    const igv = (qc.value as InputGroupValue);\r\n    const arr = [];\r\n\r\n    if (igv.isInputText || igv.textField == null) {\r\n      arr.push({\r\n        'FilterField': qc.fieldCode,\r\n        'Compare': (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Like,\r\n        'Value': igv.textValue,//encodeURIComponent(igv.textValue),\r\n        'Relation': (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n        'Expresstype': ValueType.Value,\r\n        'Lbracket': qc.Lbracket || null,\r\n        'Rbracket': qc.Rbracket || null\r\n      });\r\n      return arr;\r\n    }\r\n    else {\r\n      igv.getOriginalValue().split(',').forEach(itemValue => {\r\n        itemValue && arr.push({\r\n          'FilterField': qc.fieldCode,\r\n          'Compare': (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n          'Value': itemValue,\r\n          'Relation': qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n          'Expresstype': ValueType.Value\r\n        });\r\n      });\r\n      if (arr.length > 0) {\r\n        arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n        arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n        arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n        return arr;\r\n      } else {\r\n        return [];\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ControlType } from \"@farris/component-querycondition\";\r\nimport { IQueryConditionHandler } from \"./handlers/iquerycondition.handler\";\r\nimport { TextHandler } from \"./handlers/text.handler\";\r\nimport { DateRangeHandler } from \"./handlers/daterage.handler\";\r\nimport { DropDownHandler } from \"./handlers/dropdown.handler\";\r\nimport { NumberRangeHandler } from \"./handlers/numberrage.handler\";\r\nimport { SmartHelpHandler } from \"./handlers/smarthelp.handler\";\r\nimport { SingleYearHandler } from './handlers/single-year.handler';\r\nimport { CheckBoxHandler } from './handlers/checkbox.handler';\r\nimport { SingleMonthHandler } from './handlers/single-month.handler';\r\nimport { MonthRangeHandler } from './handlers/monthrange.handler';\r\nimport { SingleDateTimeHandler } from './handlers/single-date-time.handler';\r\nimport { SingleNumberHandler } from './handlers/single-number.handler';\r\nimport { SingleDateHandler } from './handlers/single-date.handler';\r\nimport { ComboLookUpHandler } from './handlers/combolookup.handler';\r\nimport { RadioHandler } from './handlers/radio.handler';\r\nimport { InputGroupHandler } from './handlers/inputgroup.handler';\r\n\r\nexport class QueryConditionHandlerFactory {\r\n\r\n    private static _instance: QueryConditionHandlerFactory = null;\r\n    private queryConditionHandlerMapping: Map<ControlType, IQueryConditionHandler> = new Map<ControlType, IQueryConditionHandler>();\r\n    private constructor(){\r\n        this.queryConditionHandlerMapping.set(ControlType.Text, new TextHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.InputGroup, new InputGroupHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.DateRange, new DateRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.DateTimeRange, new DateRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.DropDownList, new DropDownHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.NumberRange, new NumberRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SmartHelp, new SmartHelpHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleYear, new SingleYearHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.BoolCheck, new CheckBoxHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleMonth, new SingleMonthHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.MonthRange, new MonthRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleDateTime, new SingleDateTimeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleNumber, new SingleNumberHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleDate, new SingleDateHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.ComboLookUp, new ComboLookUpHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.Radio, new RadioHandler());\r\n    }\r\n    public static getInstance(){\r\n        if(!QueryConditionHandlerFactory._instance){\r\n            QueryConditionHandlerFactory._instance = new QueryConditionHandlerFactory();\r\n        }\r\n        return QueryConditionHandlerFactory._instance;\r\n    }\r\n\r\n    getHandler(controlType: ControlType): IQueryConditionHandler{\r\n        return this.queryConditionHandlerMapping.get(controlType);\r\n    }\r\n}","import { Injectable } from '@angular/core';\r\nimport { QueryCondition } from '@farris/component-querycondition';\r\nimport { IQueryConditionHandler } from './handlers/iquerycondition.handler';\r\nimport { QueryConditionHandlerFactory } from './querycondition.handler.factory';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { IQuerySolutionHandler,QuerySolutionComponent } from '@gsp-cmp/querysolution';\r\nimport { FrameworkSessionService } from '@farris/bef';\r\n\r\n@Injectable()\r\nexport class QuerySolutionService implements IQuerySolutionHandler {\r\n\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private frameworkSessionService: FrameworkSessionService\r\n  ) {\r\n\r\n  }\r\n\r\n  getUserSessionId(): string {\r\n    return this.frameworkSessionService.getUserSessionId();\r\n  }\r\n\r\n  public setFilterConditions(params: Array<QueryCondition>): void {\r\n    let queryConditionHandler: IQueryConditionHandler;\r\n    const filterConditionList = [];\r\n    params.forEach(qc => {\r\n      if (!qc.value.isEmpty()) {\r\n        queryConditionHandler = QueryConditionHandlerFactory.getInstance().getHandler(qc.control.getControlType());\r\n        queryConditionHandler && filterConditionList.push(...queryConditionHandler.convert(qc));\r\n      }\r\n    });\r\n    //è®¾ç½®å°NgCommand params.filterå±æ§ä¸ï¼{UISTATE~/root-component/filterConditionList}\r\n    this.frameContext.uiState['filterConditionList'] = JSON.stringify(filterConditionList);\r\n    // const originalConditions = this.getOriginalQueryConditions(filterConditionList);\r\n    this.frameContext.uiState['originalFilterConditionList'] = JSON.stringify(filterConditionList);\r\n  }\r\n\r\n  public setCurrentQueryConditions(conditions: QueryCondition[]): void {\r\n    this.frameContext.uiState['currentQueryConditions'] = conditions;\r\n  }\r\n  /**\r\n   * è¿åè¿æ»¤æ¡ä»¶ä¸­çencode\r\n   * @param conditions æ¥è¯¢æ¹æ¡æé å®çè¿æ»¤æ¡ä»¶\r\n   */\r\n  // private getOriginalQueryConditions(conditions: Array<any>): Array<any> {\r\n  //   conditions = JSON.parse(JSON.stringify(conditions));\r\n  //   if (conditions && Array.isArray(conditions) && conditions.length > 0) {\r\n  //     conditions = conditions.map((item) => {\r\n  //       if (item.hasOwnProperty('Value')) {\r\n  //         item.Value = decodeURIComponent(item.Value);\r\n  //       } else if (item.hasOwnProperty('value')) {\r\n  //         const value = item.value;\r\n  //         delete item.value;\r\n  //         item.Value = decodeURIComponent(value);\r\n  //       }\r\n  //       return item;\r\n  //     });\r\n  //   }\r\n  //   return conditions;\r\n  // }\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AppContext, FrameContext } from '@farris/devkit';\r\nimport { of } from 'rxjs';\r\nimport { tap, delay } from 'rxjs/operators';\r\n\r\n/**\r\n * ç»æè¡¨åç¼è¾ç¶ææå¡\r\n */\r\n@Injectable()\r\nclass EndEditService {\r\n  constructor(private frameContext: FrameContext) {\r\n  }\r\n  /**\r\n   * ç»æç¼è¾\r\n   */\r\n  public endEdit() {\r\n    const appContext: AppContext = this.frameContext && this.frameContext.getFormAppContext();\r\n    return of(null).pipe(\r\n      tap(() => {\r\n        if (appContext) {\r\n          appContext.messagePipe.next({ type: 'endEdit' });\r\n        }\r\n      }),\r\n      // todo: ä¸åºè¯¥ä½¿ç¨delayï¼åºè¯¥ä¸²æµ\r\n      delay(120)\r\n    );\r\n  }\r\n}\r\nexport { EndEditService };\r\n","import { Injectable } from '@angular/core';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { of, Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class RemoteSummaryService {\r\n  constructor(private viewModel: ViewModel) { }\r\n  /**\r\n   * æå¡å¨ç«¯åè®¡\r\n   * @param methodName æå¡å¨ç«¯åè®¡èªå®ä¹å¨ä½åç§°\r\n   * @param filters è¿æ»¤æ¡ä»¶\r\n   */\r\n  public summary(methodName: string, filters: any) {\r\n    const repository = this.viewModel.frameContext.repository as BefRepository<any> || null;\r\n    if (repository) {\r\n      const proxy = repository.proxy;\r\n      if (proxy && typeof proxy[methodName] === 'function') {\r\n        return proxy[methodName](filters) as Observable<any>;\r\n      }\r\n    }\r\n    return of(null);\r\n  }\r\n}\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { BindingList, ViewModel, BindingObject, Repository, Entity, FrameContext, BindingData, AppContext, BindingProperty, DataTypeInfo, createEntities, EntityList } from '@farris/devkit';\r\nimport { from, EMPTY, concat, of, Subject, Observable, throwError } from 'rxjs';\r\nimport { concatMap, catchError, tap, switchMap, last, map, delay, takeLast } from 'rxjs/operators';\r\nimport { BefRepository, ResponseInfo } from '@farris/bef';\r\nimport { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { ComponentManagerService } from './component-manager.service';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { UploadService } from '@gsp-svc/formdoc-upload';\r\nimport { FormErrorService } from './error';\r\n\r\n// tslint:disable: max-line-length\r\n/**\r\n * æ¹éç¼è¾æå¡\r\n */\r\n@Injectable()\r\nexport class BatchEditService {\r\n  private formLoadingService: FormLoadingService;\r\n  private onHelpClose: Subject<any>;\r\n  constructor(\r\n    private injector: Injector,\r\n    private componentManagerService: ComponentManagerService,\r\n    private viewModel: ViewModel,\r\n    private repository: Repository<any>,\r\n    private batchEditDialogService: BatchEditDialogService,\r\n    private dateService: DateTimeHelperService,\r\n    private languageService: LanguageService,\r\n    private formNotifyService: FormNotifyService,\r\n    private fileUploadService: UploadService\r\n  ) {\r\n    this.formLoadingService = this.injector.get<FormLoadingService>(FormLoadingService, null);\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    if (!this.formNotifyService) {\r\n      this.formNotifyService = this.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    }\r\n    this.onHelpClose = new Subject<any>();\r\n    this.onHelpClose.subscribe(result => {\r\n      const { frameId = '', mapFields = '', data = [] } = result || {};\r\n      this.onHelpCloseHandler(frameId, mapFields, data);\r\n    });\r\n  }\r\n  private get formErrorService() {\r\n    return this.injector && this.injector.get<FormErrorService>(FormErrorService, null);\r\n  }\r\n  /**\r\n   * æå¼æ¹éç¼è¾å¯¹è¯æ¡\r\n   * @param frameId frameId\r\n   */\r\n  public openBatchEditDialog(frameId: string, enableDictPicking: boolean | string = false) {\r\n    if (!frameId) {\r\n      throw new Error('frameId is required.');\r\n    }\r\n    if (typeof enableDictPicking === 'string') {\r\n      enableDictPicking = (enableDictPicking === 'true' ? true : false);\r\n    }\r\n    if (this.batchEditDialogService) {\r\n      let columns = [];\r\n      if (this.viewModel) {\r\n        const gridFrameContext: FrameContext = this.viewModel.frameContext.root.appContext.frameContextManager.getFrameContextById(frameId);\r\n        const gridViewModel = gridFrameContext.viewModel;\r\n        if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumnsName')) {\r\n          // tslint:disable-next-line: no-string-literal\r\n          const gridColumnsAttrName = gridViewModel['dataGridColumnsName'];\r\n          columns = gridViewModel[gridColumnsAttrName];\r\n        } else if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumns')) {\r\n          columns = gridViewModel['dataGridColumns'];\r\n        }\r\n        const ids: string[] = gridViewModel.uiState['ids'] || [];\r\n        if (!ids || ids.length < 1) {\r\n          this.formNotifyService.warning(this.languageService.plsCheckBatchEditRows, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        const dialogRef: any = this.batchEditDialogService.batchEdit(columns, {\r\n          rows: ids.length,\r\n          enableDictPicking,\r\n          onConfirm: (inputs: Array<any>) => {\r\n            if (Array.isArray(ids) && ids.length > 0) {\r\n              // console.log('openBatchEditDialog', inputs);\r\n              const appContext = this.viewModel.frameContext.appContext;\r\n              appContext.changeDetectionController.detach();\r\n              inputs.forEach(input => {\r\n                this.updateBindingData(input, ids);\r\n              });\r\n              appContext.changeDetectionController.reattach();\r\n            }\r\n            dialogRef.close();\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æå¼éèå¸®å©\r\n   * @param helpId å¸®å©id\r\n   */\r\n  public openHiddenHelp(helpId: string) {\r\n    if (!helpId) {\r\n      throw new Error('Argument error,helpId can`t be empty');\r\n    }\r\n    const componentManagerService = this.componentManagerService.getControl(helpId);\r\n    if (componentManagerService) {\r\n      componentManagerService.showDialog();\r\n    } else {\r\n      throw new Error(`the component which id is ${helpId} can't be found!`);\r\n    }\r\n  }\r\n  /**\r\n   * æ¸ç©ºå¸®å©å¾éï¼åªè½æè½½å°å¸®å©åäºä»¶ï¼\r\n   */\r\n  public clearHelpSelections() {\r\n    const self: any = this;\r\n    const helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;\r\n    if (helpElement) {\r\n      helpElement.displayValue = '';\r\n    }\r\n  }\r\n  /**\r\n   * å¾éå½åè¡\r\n   * @param frameId frameId\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param primaryKeyValue å¸®å©ä¸»é®å­æ®µ\r\n   */\r\n  public checkCurrentRow(frameId: string, mapFields: string, primaryKeyValue: string) {\r\n    const self: any = this;\r\n    const helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;\r\n    if (!primaryKeyValue) {\r\n      primaryKeyValue = 'id';\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    if (helpElement) {\r\n      frameId = frameId || this.viewModel.frameContext.frameId;\r\n      if (frameId) {\r\n        const frameContext = this.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          const bindingPath = frameContext.viewModel.bindingPath;\r\n          if (bindingPath) {\r\n            const bindingPaths = bindingPath.split('/').filter(p => p);\r\n            const bindingList = frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n            const currentRow = bindingList.currentItem;\r\n            const path = mappings[primaryKeyValue];\r\n            if (path) {\r\n              const value = this.getValueByPath(currentRow, path);\r\n              helpElement.displayValue = value;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä¸»è¡¨æ°æ®\r\n   * @param frameId ä¸»è¡¨æå¨frameçid\r\n   * @param mapFields å¸®å©å­æ®µä¸ä¸»è¡¨å­æ®µæ å°\r\n   * @description ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä¸»è¡¨æ°æ®\r\n   */\r\n  public batchAppend(frameId: string, mapFields: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    if (result && Array.isArray(result) && result.length > 0) {\r\n      const mappings = JSON.parse(mapFields);\r\n      // ä¸æ¯bindingPathåæframeIdå¤ç\r\n      let bindingPath = '/';\r\n      const appContext = this.injector.get<AppContext>(AppContext, null);\r\n      if (appContext) {\r\n        const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          bindingPath = frameContext.viewModel.bindingPath || '/';\r\n        } else {\r\n          throw new Error('frameId is invalid!');\r\n        }\r\n      }\r\n      const defaultValues = [];\r\n      result.forEach((item) => {\r\n        const defaultValue = {};\r\n        Object.keys(mappings).forEach((prop: string) => {\r\n          const value = this.getValueByPath(item, prop);\r\n          const fields = mappings[prop];\r\n          const groups: any[] = fields.split(',').filter(p => p);\r\n          groups.forEach(group => {\r\n            const paths = group.split('.').filter(p => p);\r\n            this.setValueByPath(defaultValue, paths.join('.'), value);\r\n          });\r\n        });\r\n        defaultValues.push(defaultValue);\r\n      });\r\n      this.formLoadingService.show();\r\n      return this.repository.batchAppend(defaultValues).pipe(\r\n        tap(() => this.formLoadingService.hide()),\r\n        map(() => true)\r\n      );\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä»è¡¨/ä»ä»è¡¨\r\n   * @param frameId ä»è¡¨/ä»ä»è¡¨æå¨frameçid\r\n   * @param mapFields å¸®å©å­æ®µä¸ä»è¡¨/ä»ä»è¡¨å­æ®µæ å°\r\n   * @description ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä»è¡¨/ä»ä»è¡¨\r\n   */\r\n  public batchAppendByPathBasedOnHelpSelections(frameId: string, mapFields: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    if (result && Array.isArray(result) && result.length > 0) {\r\n      const mappings = JSON.parse(mapFields);\r\n      // ä¸æ¯bindingPathåæframeIdå¤ç\r\n      let bindingPath = '/';\r\n      const appContext = this.injector.get<AppContext>(AppContext, null);\r\n      if (appContext) {\r\n        const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          bindingPath = frameContext.viewModel.bindingPath || '/';\r\n        } else {\r\n          throw new Error('frameId is invalid!');\r\n        }\r\n      }\r\n      const defaultValues = [];\r\n      result.forEach((item) => {\r\n        const defaultValue = {};\r\n        Object.keys(mappings).forEach((prop: string) => {\r\n          const value = this.getValueByPath(item, prop);\r\n          const fields = mappings[prop];\r\n          const groups: any[] = fields.split(',').filter(p => p);\r\n          groups.forEach(group => {\r\n            const paths = group.split('.').filter(p => p);\r\n            this.setValueByPath(defaultValue, paths.join('.'), value);\r\n          });\r\n        });\r\n        defaultValues.push(defaultValue);\r\n      });\r\n      this.formLoadingService.show();\r\n      const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n      return this.repository.batchAppendByPath(path, defaultValues).pipe(\r\n        tap(() => this.formLoadingService.hide()),\r\n        map(() => true)\r\n      );\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * æ¹éæ°å¢å¸¦éä»¶çä»è¡¨æä»ä»è¡¨æ°æ®\r\n   * @param frameId\r\n   * @param mapFields\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µè·¯å¾ï¼å¯æ¯æå¤ä¸ªï¼ä»¥éå·åé\r\n   * @param rootId éä»¶å­å¨æ ¹ç®å½\r\n   * @param path éä»¶å­å¨ç®å½\r\n   * @description æ¹éæ°å¢å¸¦éä»¶çä»è¡¨æä»ä»è¡¨æ°æ®ä¸æ¹éæ°å¢ä»è¡¨ä»ä»è¡¨æ°æ®ä¸è´ï¼å¨æ¹éæ°å¢æ°æ®çåºç¡ä¸å¢å äºéä»¶å¤å¶\r\n   * @todo ç®åéä»¶å¤å¶å¨åç«¯è°ç¨ï¼ä¼åèµ·å¤ä¸ªè¯·æ±ï¼ä¸å­å¨å®å¨é®é¢ï¼åç»­åºå¨voéæ\r\n   */\r\n  public batchAppendByPathWithAttachment(frameId: string, mapFields: string, attachmentInfoFieldPath: string, rootId: string, path: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    if (!attachmentInfoFieldPath) {\r\n      throw new Error('éä»¶udtå­æ®µè·¯å¾ä¸è½ä¸ºç©º');\r\n    }\r\n    if (result && Array.isArray(result) && result.length > 0) {\r\n      const mappings = JSON.parse(mapFields);\r\n      let bindingPath = '/';\r\n      const appContext = this.injector.get<AppContext>(AppContext, null);\r\n      // ä¿®æ­£bindingPath\r\n      if (appContext) {\r\n        const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          bindingPath = frameContext.viewModel.bindingPath || '/';\r\n        } else {\r\n          throw new Error('frameId is invalid!');\r\n        }\r\n      }\r\n      // å¤çéä»¶udtå­æ®µ\r\n      const attachmentFields = attachmentInfoFieldPath.split(',').filter(p => p).map(path => path.split('/').pop());\r\n      this.formLoadingService.show();\r\n      // åå¤å¶éä»¶\r\n      const copyFiles$ = from(result).pipe(concatMap((item => {\r\n        return this.copyRowFiles(item, attachmentFields, rootId, path).pipe(\r\n          catchError((error) => {\r\n            this.formLoadingService.hide();\r\n            let cafError = error.error;\r\n            if (typeof cafError === 'string') {\r\n              cafError = JSON.parse(cafError);\r\n            }\r\n            if (this.formErrorService) {\r\n              this.formErrorService.exception(cafError.message || this.languageService.copyFailed, error);\r\n            }\r\n            return throwError(error);\r\n          })\r\n        );\r\n      })));\r\n      return copyFiles$.pipe(takeLast(1)).pipe(switchMap(() => {\r\n        // æ¼è£é»è®¤å¼\r\n        const defaultValues = this.buildDefaultValues(result, mappings);\r\n        const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n        return this.repository.batchAppendByPath(path, defaultValues).pipe(\r\n          tap(() => this.formLoadingService.hide()),\r\n          map(() => true)\r\n        );\r\n      }));\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * æé é»è®¤å¼æ°ç»\r\n   * @param selectedValues\r\n   * @param mapFields\r\n   * @returns\r\n   */\r\n  private buildDefaultValues(selectedValues: any[], mapFields: { [prop: string]: any }): any[] {\r\n    const defaultValues = [];\r\n    selectedValues.forEach((item) => {\r\n      const defaultValue = {};\r\n      Object.keys(mapFields).forEach((prop: string) => {\r\n        // å¸®å©æ°æ®\r\n        const value = this.getValueByPath(item, prop);\r\n        // ç®æ å­æ®µ\r\n        const fields = mapFields[prop];\r\n        const groups: any[] = fields.split(',').filter(p => p);\r\n        groups.forEach(group => {\r\n          const paths = group.split('.').filter(p => p);\r\n          this.setValueByPath(defaultValue, paths.join('.'), value);\r\n        });\r\n      });\r\n      defaultValues.push(defaultValue);\r\n    });\r\n    return defaultValues;\r\n  }\r\n  /**\r\n   * å¤å¶è¡ä¸­ææéä»¶\r\n   * @param row\r\n   * @param attachmentFields\r\n   * @param rootId\r\n   * @param path\r\n   * @returns\r\n   */\r\n  private copyRowFiles(row: any, attachmentFields: string[], rootId: string, path: string) {\r\n    return from(attachmentFields).pipe(\r\n      concatMap((field: string) => {\r\n        const attachmentId = this.getValueByPath(row, `${field}.attachmentId`);\r\n        if (attachmentId) {\r\n          // åéå¤å¶éä»¶çè¯·æ±ï¼è·åéä»¶id\r\n          return this.fileUploadService.copyFile(attachmentId, rootId, path).pipe(\r\n            tap((attachmentId: string) => {\r\n              // å¤å¶æå\r\n              this.setValueByPath(row, [field, 'attachmentId'].join('.'), attachmentId);\r\n            }\r\n            ));\r\n        } else {\r\n          return of(null);\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * è¡åå¸®å©å¤éæ¹éæ°å¢ææ¿æ¢å­è¡¨æ°æ®\r\n   * @param frameId frameId, optional,ä¸ºç©ºæ¶ä½¿ç¨å½ä»¤æ§è¡æ¶æå¨çä¸ä¸æ\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param primaryKey å¸®å©ä¸»é®å­æ®µï¼é»è®¤ä¸ºid\r\n   * @returns\r\n   */\r\n  public batchAppendBasedOnRowHelpSelections(frameId: string, mapFields: string) {\r\n    const self: any = this;\r\n    let result: any[] = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      return of(true);\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    if (!mappings || !mappings.hasOwnProperty('id')) {\r\n      return of(true);\r\n    }\r\n    frameId = frameId || this.viewModel.frameContext.frameId;\r\n    if (!frameId) {\r\n      return of(true);\r\n    }\r\n    const frameContext = this.getFrameContextById(frameId);\r\n    if (!frameContext) {\r\n      return of(true);\r\n    }\r\n    setTimeout(() => {\r\n      this.endEdit(frameContext).subscribe(() => {\r\n        setTimeout(() => {\r\n          if (result && Array.isArray(result) && result.length > 0) {\r\n            const bindingPath = frameContext.viewModel.bindingPath || '/';\r\n            const bindingPaths = bindingPath.split('/').filter(p => p);\r\n            const defaultValues = [];\r\n            // è·åå½åè¡\r\n            const bindingList: BindingList = frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n            const currentRow = bindingList.currentItem;\r\n            const currentRowId = bindingList.currentId;\r\n            const currentEntity = this.getEntityByPath(frameContext, bindingPaths, currentRowId);\r\n            const headItem = result[0];\r\n            // å¦æä»å¾éä¸æ¡ï¼ååºæ¿æ¢å½åè¡çæ å°\r\n            if (result.length === 1) {\r\n              // this.mappingRow(headItem, mappings, currentEntity, bindingPath);\r\n              const data = headItem;\r\n              Object.keys(mappings).forEach((prop: string) => {\r\n                const value = this.getValueByPath(data, prop);\r\n                const fields = mappings[prop];\r\n                const groups: any[] = fields.split(',').filter(p => p);\r\n                groups.forEach(group => {\r\n                  const paths = group.split('.').filter(p => p);\r\n                  frameContext.bindingData.setValue(bindingPaths.concat(paths), value, true, true);\r\n                });\r\n              });\r\n              return of(true);\r\n            } else {\r\n              const idMapField = mappings['id'];\r\n              const sourceItemId = this.getValueByPath(currentEntity, idMapField);\r\n              // å¦æå½åè¡æ²¡ææ å°æå¾éç»æä¸­æ¾ä¸å°å½åè¡çæ å°\r\n              if (!sourceItemId || result.findIndex(item => item[bindingList.primaryKey] === sourceItemId) === -1) {\r\n                // éæ°æ å°å½åè¡\r\n                this.mappingRow(headItem, mappings, currentEntity, bindingPath);\r\n                result = result.slice(1);\r\n              } else if (sourceItemId) {\r\n                const index = result.findIndex(item => item[bindingList.primaryKey] === sourceItemId);\r\n                // éæ°æ å°å½åè¡\r\n                this.mappingRow(result[index], mappings, currentEntity, bindingPath);\r\n                result.splice(index, 1);\r\n              }\r\n              // å½åè¡å¤çå®æ\r\n              // å¤çæªæ å°çè¡\r\n              const emptyRows = bindingList.toArray().filter(bindingObject => {\r\n                const id = this.getValueByPath(bindingObject, mappings[bindingList.primaryKey]);\r\n                return !id;\r\n              });\r\n              if (emptyRows && emptyRows.length > 0) {\r\n                let rows = result;\r\n                if (result.length > emptyRows.length) {\r\n                  rows = result.slice(0, emptyRows.length);\r\n                  result = result.slice(emptyRows.length);\r\n                } else {\r\n                  result = [];\r\n                }\r\n                rows.forEach((item, index) => {\r\n                  const targetItem = emptyRows[index];\r\n                  const entity = this.getEntityByPath(frameContext, bindingPaths, targetItem.primaryKeyValue);\r\n                  this.mappingRow(item, mappings, entity, bindingPath);\r\n                });\r\n              }\r\n              // å¤çå©ä½å¾é\r\n              result.forEach((item) => {\r\n                const defaultValue = {};\r\n                Object.keys(mappings).forEach((prop: string) => {\r\n                  const value = this.getValueByPath(item, prop);\r\n                  const fields = mappings[prop];\r\n                  const groups: any[] = fields.split(',').filter(p => p);\r\n                  groups.forEach(group => {\r\n                    const paths = group.split('.').filter(p => p);\r\n                    this.setValueByPath(defaultValue, paths.join('.'), value);\r\n                  });\r\n                });\r\n                defaultValues.push(defaultValue);\r\n              });\r\n              if (defaultValues.length > 0) {\r\n                this.formLoadingService.show();\r\n                const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n                this.repository.batchAppendByPath(path, defaultValues).pipe(\r\n                  tap(() => this.formLoadingService.hide())\r\n                ).subscribe();\r\n              }\r\n            }\r\n          }\r\n        }, 350);\r\n      });\r\n    }, 50);\r\n    return of(true);\r\n  }\r\n  /**\r\n   * å¤å¶ä¸»è¡¨æ°æ®\r\n   * @param id è¦å¤å¶çæ°æ®id\r\n   * @param fields è¦å¤å¶çå­æ®µ\r\n   * @description ä»æ¯æå¤å¶ä¸»è¡¨æ°æ®\r\n   * @deprecated è¯¥æ¹æ³å·²è¢«åºå¼ï¼è¯·ä½¿ç¨cloneæ¹æ³æ¿ä»£ã\r\n   */\r\n  public copy(id: string): Observable<any> {\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const baseUri = befRepository.restService.baseUri;\r\n    const url = `${baseUri}/service/copymainobjvoaction`;\r\n    const requestInfo = befRepository.restService.buildRequestInfo();\r\n    const body = {\r\n      requestInfo,\r\n      dataID: id\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    this.formLoadingService.show();\r\n    return befRepository.proxy.request(url, 'PUT', null, options).pipe(\r\n      tap(() => {\r\n        this.formLoadingService.hide();\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const returnValue = responseInfo.returnValue;\r\n        const entity = this.repository.buildEntity(returnValue);\r\n        this.repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      }),\r\n    );\r\n  }\r\n  /**\r\n   * å¤å¶æ°æ®ï¼æ¯æä¸»è¡¨ãä»è¡¨ãä»ä»è¡¨ï¼\r\n   * @param id è¦å¤å¶çè¡\r\n   * @param path è¯·æ±è·¯å¾\r\n   * @returns\r\n   */\r\n  public clone(id: string, path: string) {\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!path) {\r\n      this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!path.startsWith('/')) {\r\n      path = '/' + path;\r\n    }\r\n    path = path.toLowerCase();\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const baseUri = befRepository.restService.baseUri;\r\n    const url = `${baseUri}${path}`;\r\n    const requestInfo = befRepository.restService.buildRequestInfo();\r\n    const ids = this.buildIds(bindingPath);\r\n    ids.push(id);\r\n    const body = {\r\n      requestInfo,\r\n      dataID: ids.join(',')\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    this.formLoadingService.show();\r\n    return befRepository.proxy.request(url, 'PUT', null, options).pipe(\r\n      tap(() => {\r\n        this.formLoadingService.hide();\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const returnValue = responseInfo.returnValue;\r\n        let entity = null;\r\n        if (bindingPath.split('/').filter(p => p).length === 0) {\r\n          entity = this.repository.buildEntity(returnValue);\r\n          this.repository.entityCollection.addEntity(entity, true);\r\n        } else {\r\n          const fpath = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          entity = befRepository.entityManager.appendEntityByPath(fpath, returnValue, returnValue, true);\r\n        }\r\n        return entity;\r\n      }),\r\n    );\r\n  }\r\n  /**\r\n   * å¸¦éä»¶çå¤å¶\r\n   * @param id\r\n   * @param url\r\n   * @param attachmentInfoFieldPath\r\n   * @param rootId\r\n   * @param path\r\n   * @returns\r\n   */\r\n  public cloneWithAttachment(id: string, url: string, attachmentInfoFieldPath: string, rootId: string, path: string) {\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!url) {\r\n      this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!attachmentInfoFieldPath) {\r\n      throw new Error('éä»¶udtå­æ®µè·¯å¾ä¸è½ä¸ºç©º');\r\n    }\r\n    if (!url.startsWith('/')) {\r\n      url = '/' + url;\r\n    }\r\n    url = url.toLowerCase();\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const baseUri = befRepository.restService.baseUri;\r\n    const uri = `${baseUri}${url}`;\r\n    const requestInfo = befRepository.restService.buildRequestInfo();\r\n    const ids = this.buildIds(bindingPath);\r\n    ids.push(id);\r\n    const body = {\r\n      requestInfo,\r\n      dataID: ids.join(',')\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    this.formLoadingService.show();\r\n    const attachmentFields = attachmentInfoFieldPath.split(',').filter((p) => p).map((path) => path.split('/').pop());\r\n    return befRepository.proxy.request(uri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        const entityData = responseInfo.returnValue;\r\n        let entity = null;\r\n        if (bindingPath.split('/').filter((p) => p).length === 0) {\r\n          entity = this.repository.buildEntity(entityData);\r\n          this.repository.entityCollection.addEntity(entity, true);\r\n        } else {\r\n          const fpath = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          entity = befRepository.entityManager.appendEntityByPath(fpath, entityData, entityData, true);\r\n        }\r\n        // å¤å¶éä»¶\r\n        return this.copyRowFiles(entity, attachmentFields, rootId, path).pipe(\r\n          switchMap(() => {\r\n            this.formLoadingService.hide();\r\n            return this.repository.updateAllChanges().pipe(map(() => {\r\n              return entity;\r\n            }));\r\n          }),\r\n          catchError((error) => {\r\n            this.formLoadingService.hide();\r\n            // æ¸ç©ºå®ä½éä»¶å±æ§\r\n            this.clearAttachmentInfo(entity, attachmentFields);\r\n            let cafError = error.error;\r\n            if (typeof cafError === 'string') {\r\n              cafError = JSON.parse(cafError);\r\n            }\r\n            if (this.formErrorService) {\r\n              this.formErrorService.exception(cafError.message || this.languageService.copyFailed, error);\r\n            }\r\n            return EMPTY;\r\n          })\r\n        );\r\n      }),\r\n    );\r\n  }\r\n  private clearAttachmentInfo(entity: Entity, attachmentFields: string[]) {\r\n    try {\r\n      attachmentFields.forEach((attachmentField: string) => {\r\n        this.setValueByPath(entity, [attachmentField, 'attachmentId'].join('.'), null);\r\n        this.setValueByPath(entity, [attachmentField, 'fileName'].join('.'), null);\r\n        this.setValueByPath(entity, [attachmentField, 'fileCreateTime'].join('.'), null);\r\n        this.setValueByPath(entity, [attachmentField, 'fileSize'].join('.'), null);\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  }\r\n  //#region æ§çå®ç°\r\n\r\n  /**\r\n   * å¤å¶è¡\r\n   * @param frameId frameId\r\n   * @param ignoreFields å¤å¶æ¶å¿½ç¥å­æ®µ\r\n   * @param repeat éå¤å¤å¶æ¬¡æ°ï¼é»è®¤ä¸º1\r\n   */\r\n  public copyRow(frameId: string, ignoreFields: string, repeat: number = 1) {\r\n    if (typeof repeat !== 'number') {\r\n      repeat = parseInt(repeat, 10);\r\n    }\r\n    if (repeat < 1) {\r\n      throw new Error('ArgumentError: repeat must >= 1');\r\n    }\r\n    // è·åå½åè¡\r\n    const frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    const primaryValue = frameContext.bindingData.list.currentId;\r\n    const bindingPath = frameContext.viewModel.bindingPath || '/';\r\n    let bindingData = null;\r\n    let currentItem: BindingObject = null;\r\n    if (bindingPath === '/') {\r\n      // ä¸»è¡¨ç´æ¥åå½åè¡\r\n      currentItem = frameContext.bindingData.list.currentItem;\r\n    } else {\r\n      // åä»è¡¨/ä»ä»è¡¨å½åè¡\r\n      const paths = bindingPath.split('/').filter(p => p);\r\n      currentItem = (frameContext.bindingData.getValue(paths) as BindingList).currentItem;\r\n    }\r\n    bindingData = currentItem.toJSON();\r\n    if (!currentItem.primaryKeyValue) {\r\n      if (this.formNotifyService) {\r\n        this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      }\r\n      return EMPTY;\r\n    }\r\n    const ignoreFieldsArray = ignoreFields.split(',').filter(item => item);\r\n\r\n    const sources = new Array(repeat);\r\n    return from(sources).pipe(\r\n      concatMap(() => {\r\n        let action$ = null;\r\n        if (bindingPath !== '/') {\r\n          const fullPath = this.buildPath(bindingPath, primaryValue);\r\n          action$ = this.repository.appendByPath(fullPath);\r\n        } else {\r\n          action$ = this.repository.append();\r\n        }\r\n        return action$.pipe(\r\n          tap((entity: Entity) => {\r\n            // ä¿®æ­£å®ä½ä¸»é®\r\n            bindingData[entity.primaryKey] = entity.primaryValue;\r\n            // å¿½ç¥æå®å­æ®µ\r\n            ignoreFieldsArray.forEach((field: string) => {\r\n              const extractedFields = field.split('.').filter(item => item);\r\n              if (extractedFields.length === 1) {\r\n                delete bindingData[field];\r\n              }\r\n              const parent = extractedFields.slice(0, -1).reduce((prev, current, index) => {\r\n                return prev[current];\r\n              }, bindingData);\r\n              delete parent[extractedFields[extractedFields.length - 1]];\r\n            });\r\n            bindingData = Object.assign({}, entity.toJSON(), bindingData);\r\n            entity.load(bindingData, { loadChild: false });\r\n          }),\r\n          catchError(() => {\r\n            return EMPTY;\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * å¢éå¤éå¸®å©æ¹éèµå¼å¸®å©åäºä»¶\r\n   * @param frameId frameId\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param associatedField å³èå­æ®µ\r\n   */\r\n  public afterIncrementalSelectHelpClose(frameId: string, mapFields: string, associatedField: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    // tslint:disable-next-line: max-line-length\r\n    // const mapping = '{\"id\":\"userRef.userRef\", \"name\":\"name\", \"sex\":\"sex\",\"age\":\"userRef.userRef_Age\",\"address\":\"userRef.userRef_Address\",\"birthday\":\"userRef.userRef_Birthday\",\"height\":\"userRef.userRef_Height\",\"isMarried\":\"userRef.userRef_IsMarried\"}';\r\n    if (!associatedField) {\r\n      throw new Error('associated field can`t be empty.');\r\n    }\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    const foreignKey = associatedField;\r\n    // å°éæ©äººåä¿å­å°uistateä¸­\r\n    const rootFrameContext = this.viewModel.frameContext.root;\r\n    // ä¸æ¯bindingPathåæframeIdå¤ç\r\n    let bindingPath = '/';\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      if (frameContext) {\r\n        bindingPath = frameContext.viewModel.bindingPath || '/';\r\n      } else {\r\n        throw new Error('frameId is invalid!');\r\n      }\r\n    }\r\n    // tslint:disable-next-line: no-string-literal\r\n    rootFrameContext.uiState['selections'] = result;\r\n    if (result && Array.isArray(result)) {\r\n      // æ ¹æ®bindingPathè·åbindingdataä¸­ç°ææ°æ®\r\n      const bindingPaths = bindingPath.split('/').filter(item => item);\r\n      const currentData: BindingList = this.viewModel.bindingData.getValue(bindingPaths);\r\n      const currentDataArray = currentData.toArray();\r\n      // æ¾å°resultä¸­æï¼ä½bindingDataä¸­æ²¡æçï¼ä¸ºå¾æ°å¢é¡¹\r\n      const appends = [];\r\n      result.reduce((prev: Array<any>, item) => {\r\n        const itemId = item && item[currentData.primaryKey] || null;\r\n        const isExist = currentDataArray.find((bindingObject: BindingObject) => bindingObject[foreignKey][foreignKey] === itemId);\r\n        if (!isExist) {\r\n          prev.push(item);\r\n        }\r\n        return prev;\r\n      }, appends);\r\n\r\n      // æ¾å°bindingDataä¸­æï¼resultä¸­æ²¡æçï¼ä¸ºå¾å é¤é¡¹\r\n      const removes = [];\r\n      currentDataArray.reduce((results: any, item: BindingObject) => {\r\n        const index = result.findIndex(selectItem => selectItem[currentData.primaryKey] === item[foreignKey][foreignKey]);\r\n        if (index === -1) {\r\n          results.push(item.primaryKeyValue);\r\n        }\r\n        return results;\r\n      }, removes);\r\n\r\n      // console.log('addItems', appends, 'removeItems', removes);\r\n      // è°ç¨åç«¯æ¥å£æ°å¢æ°æ®\r\n      const addAction$ = from(appends).pipe(\r\n        concatMap(item => {\r\n          const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          return this.repository.appendByPath(path).pipe(\r\n            tap((entity: Entity) => {\r\n              Object.keys(mappings).forEach(prop => {\r\n                const value = this.getValueByPath(item, prop);\r\n                const fields = mappings[prop];\r\n                const groups: any[] = fields.split(',').filter(p => p);\r\n                groups.forEach(group => {\r\n                  const paths = group.split('.').filter(p => p);\r\n                  this.setValueByPath(entity, paths.join('.'), value);\r\n                });\r\n              });\r\n            }),\r\n            catchError(() => {\r\n              return EMPTY;\r\n            })\r\n          );\r\n        })\r\n      );\r\n\r\n      const removeAction$ = from(removes).pipe(\r\n        concatMap(item => {\r\n          const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          return this.repository.removeByPath(path, item).pipe(\r\n            tap(() => {\r\n              const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n              befRepository.entityManager.removeEntityByPath(path, item);\r\n            }),\r\n            catchError(() => {\r\n              return EMPTY;\r\n            })\r\n          );\r\n        })\r\n      );\r\n      if (!appends && !removes || appends && appends.length < 1 && removes && removes.length < 1) {\r\n        return of(true);\r\n      }\r\n      return concat(addAction$, removeAction$).pipe(\r\n        catchError(() => EMPTY)\r\n      );\r\n    }\r\n    return of(true);\r\n  }\r\n  // todo:æ¨¡æç¨æ·æä½ï¼å¾åç«¯æ¥å£æ¯æä¸»è¡¨æ¹éæ°å¢åéå\r\n  /**\r\n   * å¤éå¸®å©æ¹éèµå¼å¸®å©åäºä»¶\r\n   */\r\n  public beforeMultiSelectHelpOpen() {\r\n    return this.clearHelpSelections();\r\n  }\r\n  /**\r\n   * å¤éå¸®å©æ¹éèµå¼å¸®å©åäºä»¶\r\n   * @param frameId ç»å®è·¯å¾\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param commandFrameId åè°å½ä»¤æå¨frameId\r\n   * @param commandName åè°å½ä»¤\r\n   * @deprecated æ¨¡æç¨æ·æä½ï¼å¾æ¹éèµå¼æ¯æä¸»è¡¨ååºå¼\r\n   */\r\n  public afterMultiSelectHelpClose(frameId: string, mapFields: string, commandFrameId?: string, commandName?: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (result && Array.isArray(result)) {\r\n      // è°ç¨åç«¯æ¥å£æ°å¢æ°æ®\r\n      if (!result || result.length < 1) {\r\n        return of(true);\r\n      }\r\n      this.onHelpClose.next({ frameId, mapFields, data: result, commandFrameId, commandName });\r\n      return of(true);\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n    * å¸®å©å³é­åå¤çå¨\r\n    * @param frameId frameid\r\n    * @param mapFields mapFields\r\n    * @param result å¸®å©æ°æ®ç»æ\r\n    */\r\n  private onHelpCloseHandler(frameId: string, mapFields: string, result: any[]) {\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    // ä¸æ¯bindingPathåæframeIdå¤ç\r\n    let bindingPath = '/';\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      if (frameContext) {\r\n        bindingPath = frameContext.viewModel.bindingPath || '/';\r\n      } else {\r\n        throw new Error('frameId is invalid!');\r\n      }\r\n    }\r\n    // å°éæ©äººåä¿å­å°uistateä¸­\r\n    const rootFrameContext = this.viewModel.frameContext.root;\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    // tslint:disable-next-line: no-string-literal\r\n    rootFrameContext.uiState['selections'] = result;\r\n    if (result && Array.isArray(result)) {\r\n      const addAction$ = from(result).pipe(\r\n        concatMap(item => {\r\n          const requestInfo = befRepository.restService.buildRequestInfo();\r\n          if (bindingPaths.length > 0) {\r\n            const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n            return befRepository.restService.createByPath(path, requestInfo).pipe(\r\n              tap((responseInfo: ResponseInfo) => {\r\n                const data = responseInfo.returnValue;\r\n                const newEntity = befRepository.entityManager.appendEntityByPath(path, data, data);\r\n                Object.keys(mappings).forEach(prop => {\r\n                  const value = this.getValueByPath(item, prop);\r\n                  const fields = mappings[prop];\r\n                  const groups: any[] = fields.split(',').filter(p => p);\r\n                  groups.forEach(group => {\r\n                    const paths = group.split('.').filter(p => p);\r\n                    this.setValueByPath(newEntity, paths.join('.'), value);\r\n                  });\r\n                });\r\n                return newEntity;\r\n              })\r\n            );\r\n          } else {\r\n            return befRepository.restService.create(null, requestInfo).pipe(\r\n              tap((responseInfo: ResponseInfo) => {\r\n                const data = responseInfo.returnValue;\r\n                const newEntity = this.repository.buildEntity(data);\r\n                Object.keys(mappings).forEach(prop => {\r\n                  const value = this.getValueByPath(item, prop);\r\n                  const fields = mappings[prop];\r\n                  const groups: any[] = fields.split(',').filter(p => p);\r\n                  groups.forEach(group => {\r\n                    const paths = group.split('.').filter(p => p);\r\n                    this.setValueByPath(newEntity, paths.join('.'), value);\r\n                  });\r\n                });\r\n                this.repository.entityCollection.addEntity(newEntity);\r\n                return newEntity;\r\n              })\r\n            );\r\n          }\r\n        })\r\n      );\r\n      // const formLoadingService = this.injector.get<FormLoadingService>(FormLoadingService, null);\r\n      if (this.formLoadingService) {\r\n        this.suspendFrameContextEvent(frameId);\r\n        this.formLoadingService.show();\r\n        this.formLoadingService.setSuspend(true);\r\n      }\r\n      return addAction$.pipe(\r\n        last(),\r\n      ).pipe(\r\n        switchMap(() => {\r\n          const primaryValue = this.viewModel.bindingData.list.currentId;\r\n          if (primaryValue) {\r\n            return befRepository.updateChangesById(primaryValue);\r\n          } else {\r\n            return of(null);\r\n          }\r\n        })\r\n      ).subscribe(() => {\r\n        if (this.formLoadingService) {\r\n          this.resumeFrameContextEvent(frameId);\r\n          this.formLoadingService.setSuspend(false);\r\n          this.formLoadingService.hide();\r\n        }\r\n      }, () => {\r\n        if (this.formLoadingService) {\r\n          this.resumeFrameContextEvent(frameId);\r\n          this.formLoadingService.setSuspend(false);\r\n          this.formLoadingService.hide();\r\n        }\r\n      });\r\n    }\r\n    return of(null);\r\n  }\r\n  private suspendFrameContextEvent(frameId: string) {\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      frameContext.suspend = true;\r\n    }\r\n  }\r\n  private resumeFrameContextEvent(frameId: string) {\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      frameContext.suspend = false;\r\n      frameContext.appContext.messagePipe.next('bindData');\r\n    }\r\n  }\r\n\r\n  //#endregion\r\n  private setValueByPath(target: object, path: string, value: any) {\r\n    if (target) {\r\n      const paths = path.split('.');\r\n      if (paths.length <= 1) {\r\n        target[path] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private getValueByPath(target: object, path: string) {\r\n    const paths = path.split('.');\r\n    if (paths.length < 1) {\r\n      return;\r\n    }\r\n    if (paths.length === 1) {\r\n      return target[path];\r\n    }\r\n    let result = null;\r\n    paths.forEach((prop, index) => {\r\n      if (index === 0) {\r\n        result = target && target[prop] || null;\r\n      } else {\r\n        result = result && result[prop] || null;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  /**\r\n   * æé å­è¡¨è·¯å¾\r\n   * @param bindingPath ç»å®è·¯å¾\r\n   * @param id id\r\n   */\r\n  private buildPath(bindingPath: string, id: any) {\r\n    let path = '/' + id;\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = this.viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n  /**\r\n   * è·åç»å®è·¯å¾çå½åè¡æ°ç»\r\n   * @param bindingPath bindingPath\r\n   * @returns\r\n   */\r\n  private buildIds(bindingPath: string): string[] {\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    const primaryValue = this.viewModel.bindingData.list.currentId;\r\n    const result = [];\r\n    const paths = [];\r\n    if (bindingPaths.length > 0) {\r\n      result.push(primaryValue);\r\n      // ä»è¡¨æä»ä»è¡¨è¦å¤å¶çè¡ä¸ä¸å®æ¯å½åè¡ï¼ç¨æ·å¯ä»¥æå®\r\n      bindingPaths.pop();\r\n      bindingPaths.forEach((path: string) => {\r\n        paths.push(path);\r\n        const bindingList = this.viewModel.bindingData.getValue(paths) as BindingList;\r\n        if (bindingList) {\r\n          result.push(bindingList.currentId);\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n  private updateBindingData(input: any, ids: Array<any>) {\r\n    const { controlType = null, value = null, options = {}, dataType = null } = input || {};\r\n    if (controlType) {\r\n      // å¯¹å¸®å©åç¹æ®å¤ç\r\n      if (controlType === 'lookup' || controlType === 'combo-lookup') {\r\n        const mapFields = options.mapFields;\r\n        this.updateLookupField(ids, value, mapFields);\r\n      } else {\r\n        this.updateSimpleField(ids, value, input);\r\n      }\r\n    }\r\n  }\r\n  private updateSimpleField(ids: Array<any>, value: any, column: any) {\r\n    if (!column) {\r\n      return;\r\n    }\r\n    const currentColumnType = column.dataType;\r\n    // å­å¨è¡ç¼è¾å¨\r\n    let result = value;\r\n    if (currentColumnType === 'date') {\r\n      let dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd');\r\n      if (!dateStr) {\r\n        dateStr = '0001-01-01T00:00:00';\r\n      }\r\n      result = dateStr;\r\n    } else if (currentColumnType === 'number') {\r\n      result = Number(value) || 0;\r\n    }\r\n    const field = column.field;\r\n    ids.forEach(id => {\r\n      this.updateBindingList(id, field, result);\r\n    });\r\n  }\r\n  private updateLookupField(ids: Array<any>, helpData: any, mapFields: any) {\r\n    if (!mapFields) {\r\n      return;\r\n    }\r\n    let helpFields = Object.keys(mapFields);\r\n    const idIndex = helpFields.findIndex(item => item === 'id');\r\n    if (helpFields.includes('id') && idIndex !== 0) {\r\n      helpFields.splice(idIndex, 1);\r\n      helpFields = ['id', ...helpFields];\r\n    }\r\n    if (!helpData) {\r\n      helpFields.reverse();\r\n    }\r\n    helpFields.forEach((helpField: any) => {\r\n      let helpValue: any = '';\r\n      if (helpData) {\r\n        if (helpData instanceof Array) {\r\n          helpValue = helpData.map((item: any) => {\r\n            return this.getValue(helpField, item);\r\n          }).join(',');\r\n        } else {\r\n          helpValue = this.getValue(helpField, helpData);\r\n        }\r\n      }\r\n      ids.forEach(id => {\r\n        this.updateBindingList(id, mapFields[helpField], helpValue);\r\n      });\r\n    });\r\n  }\r\n  private updateBindingList(primaryValue: any, propertyName: string, value: any) {\r\n    const viewModel = this.viewModel || null;\r\n    if (!viewModel || !propertyName) {\r\n      return;\r\n    }\r\n    // æ´æ°ä¸»è¡¨é¨åè¡çå­æ®µ\r\n    const propertyNames = propertyName.split('.').filter(item => item);\r\n    const bindingObject = this.bindingList.findById(primaryValue);\r\n\r\n    if (propertyNames.length < 2) {\r\n      bindingObject.setValue(propertyName, value, true, true);\r\n    } else {\r\n      let targetBindingObject = null;\r\n      const fpaths = propertyNames.slice(0, propertyNames.length - 1);\r\n      const targetPropertyName = propertyNames[propertyNames.length - 1];\r\n      fpaths.forEach(prop => {\r\n        targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];\r\n      });\r\n      // todo:éè¦æ·»å å¼ååäºä»¶\r\n      targetBindingObject.setValue(targetPropertyName, value, true, true);\r\n    }\r\n  }\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.viewModel.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter(n => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n  private getValue(f: string, data: any) {\r\n    let val = '';\r\n    if (f.indexOf('.') === -1) {\r\n      val = data[f];\r\n    } else {\r\n      val = f.split('.').reduce((a, b) => {\r\n        return a[b];\r\n      }, data);\r\n    }\r\n\r\n    return val;\r\n  }\r\n  protected get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.viewModel.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.viewModel.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * æ ¹æ®æ å°å°æ°æ®èµå¼ç»bindingData\r\n   * @param data\r\n   * @param mapFields\r\n   * @param bindingData\r\n   */\r\n  private mappingRow(data: any, mapFields: any, entity: Entity, bindingPath: string) {\r\n    Object.keys(mapFields).forEach((prop: string) => {\r\n      const value = this.getValueByPath(data, prop);\r\n      const fields = mapFields[prop];\r\n      const groups: any[] = fields.split(',').filter(p => p);\r\n      groups.forEach(group => {\r\n        const paths = group.split('.').filter(p => p);\r\n        this.setValueByPath(entity, paths.join('.'), value);\r\n      });\r\n    });\r\n  }\r\n  /**\r\n   * éè¿frameIdè·åå¯¹åºçç»ä»¶ä¸ä¸æ\r\n   * @param frameId frameId\r\n   * @returns\r\n   */\r\n  private getFrameContextById(frameId: string): FrameContext | null {\r\n    if (!frameId) {\r\n      return null;\r\n    }\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    let frameContext: FrameContext = null;\r\n    if (appContext) {\r\n      frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n    }\r\n    return frameContext;\r\n  }\r\n  private getEntityByPath(frameContext: FrameContext, bindingPaths: any[], currentId: string) {\r\n    bindingPaths = [...bindingPaths];\r\n    const id = frameContext.bindingData.list.currentId;\r\n    const entity: Entity = frameContext.repository.entityCollection.getEntityById(id) as Entity;\r\n    let item: Entity = entity;\r\n    const paths = [];\r\n    const tailPath = bindingPaths.pop();\r\n    const parent = bindingPaths.reduce((object: Entity, path: string) => {\r\n      paths.push(path);\r\n      if (object && (object.hasOwnProperty(path) || object['__proto__'].hasOwnProperty(path))) {\r\n        const value = object[path];\r\n        if (value && value instanceof EntityList) {\r\n          const bindingList = frameContext.bindingData.getValue(paths) as BindingList;\r\n          const currentItemId = bindingList.currentId;\r\n          return value.get(currentItemId);\r\n        } else {\r\n          return value;\r\n        }\r\n      } else {\r\n        return null;\r\n      }\r\n    }, item);\r\n    if (parent instanceof Entity) {\r\n      const list = parent[tailPath] as EntityList<any>;\r\n      if (list) {\r\n        return list.get(currentId);\r\n      } else {\r\n        throw new Error(`æ æçbindingPath.`);\r\n      }\r\n    } else {\r\n      throw new Error(`æ æçbindingPath.`);\r\n    }\r\n  }\r\n  private endEdit(frameContext: FrameContext) {\r\n    const appContext: AppContext = frameContext && frameContext.getFormAppContext();\r\n    return of(null).pipe(\r\n      tap(() => {\r\n        if (appContext) {\r\n          appContext.messagePipe.next({ type: 'endEdit' });\r\n        }\r\n      }),\r\n      // todo: ä¸åºè¯¥ä½¿ç¨delayï¼åºè¯¥ä¸²æµ\r\n      delay(5)\r\n    );\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { FrameContext, Entity } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Observable, of, EMPTY } from 'rxjs';\r\nimport { BasePathService } from '@farris/rtf';\r\n// tslint:disable: max-line-length\r\n@Injectable()\r\nexport class DiscussionGroupService {\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n  /**\r\n   * å½ä»¤åæ°\r\n   */\r\n  private get params() {\r\n    return this['context'] && this['context']['eventParam'] || {};\r\n  }\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private loadingService: FormLoadingService, private runtimeFrameworkService: RuntimeFrameworkService) {\r\n  }\r\n\r\n  public addComment(id?: string, summary?: string, configId?: string, text?: string, visibility?: string, parentId?: string): Observable<any> {\r\n    id = id || this.frameContext && this.frameContext.bindingData.list.currentId || null;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n    const params = this.buildAddCommentParam(id, text, parentId, summary, visibility, configId);\r\n    const restService = this.repository.restService;\r\n    const url = BasePathService.convertPath('/api/runtime/comment/v1.0/bill-comment/comment');\r\n    const requestInfo = restService.buildRequestInfo();\r\n    const options = {\r\n      body: {\r\n        requestInfo,\r\n        ...params\r\n      }\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'POST', null, options).pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢è¯è®º\r\n   * @param id id\r\n   */\r\n  public queryComments(id: string, configId: string, pageIndex?: number | null, pageSize?: number | null): Observable<any> {\r\n    id = id || this.frameContext && this.frameContext.bindingData.list.currentId || null;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const restService = this.repository.restService;\r\n\r\n    const url = this.buildQueryCommentsUrl(id, pageIndex, pageSize, configId);\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢ææé¨é¨ä¿¡æ¯\r\n   */\r\n  public queryAllOrgs() {\r\n    const restService = this.repository.restService;\r\n    const url = BasePathService.convertPath('/api/runtime/sys/v1.0/sysOrgs?param={\"layer\":\"1\"}');\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢å¸¸ç¨@ç¨æ·\r\n   * @param pageIndex\r\n   * @param pageSize\r\n   */\r\n  public queryFrequentAtUsers(pageIndex?: number | null, pageSize?: number | null) {\r\n    const restService = this.repository.restService;\r\n    const url = this.buildQueryFrequentAtUsersUrl(pageIndex, pageSize);\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * è·åatç¨æ·åè¡¨\r\n   * @param user ç¨æ·ç¼å·æèç¨æ·åç§°ï¼è¿æ»¤ä½¿ç¨ï¼\r\n   * @param pageIndex pageIndex\r\n   * @param pageSize pageSize\r\n   */\r\n  public queryAtUsers(user?: string, pageIndex?: number | null, pageSize?: number | null) {\r\n    const restService = this.repository.restService;\r\n    const url = this.buildQueryAtUsersUrl(user, pageIndex, pageSize);\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æé è·åè¯è®ºåè¡¨çurl\r\n   * @param id id\r\n   */\r\n  private buildQueryCommentsUrl(id: string, pageIndex: number | null, pageSize: number | null, configId: string) {\r\n    if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n      pageIndex = this.params.pageIndex || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined' || pageSize === null) {\r\n      pageSize = this.params.pageSize || 10;\r\n    }\r\n    const serverUri = this.repository.serverUri;\r\n    // const funcId = this.runtimeFrameworkService && this.runtimeFrameworkService.funcId || '';\r\n    return BasePathService.convertPath(`/api/runtime/comment/v1.0/bill-comment/comment/byBill?configId=${configId}&billId=${id}&pageSize=${pageSize}&pageIndex=${pageIndex}`);\r\n  }\r\n  /**\r\n   * æé è·å@ç¨æ·url\r\n   */\r\n  private buildQueryAtUsersUrl(user?: string, pageIndex?: number | null, pageSize?: number | null) {\r\n    const params: string[] = [];\r\n    if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n      pageIndex = this.params.pageIndex || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined' || pageSize === null) {\r\n      pageSize = this.params.pageSize || 1000;\r\n    }\r\n    if (user) {\r\n      params.push(`param=${user}`);\r\n    }\r\n    params.push(`pageSize=${pageSize}`);\r\n    params.push(`pageIndex=${pageIndex}`);\r\n    return BasePathService.convertPath(`/api/runtime/comment/v1.0/bill-comment/atUser?${params.join('&')}`);\r\n  }\r\n  private buildQueryFrequentAtUsersUrl(pageIndex?: number | null, pageSize?: number | null) {\r\n    const params: string[] = [];\r\n    if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n      pageIndex = this.params.pageIndex || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined' || pageSize === null) {\r\n      pageSize = this.params.pageSize || 6;\r\n    }\r\n    params.push(`pageSize=${pageSize}`);\r\n    params.push(`pageIndex=${pageIndex}`);\r\n    return BasePathService.convertPath(`/api/runtime/comment/v1.0/bill-comment/frequentAtUsers?${params.join('&')}`);\r\n  }\r\n  private buildAddCommentParam(id: string, text: string, parentId: string, summary: string, visibility: string, configId: string) {\r\n    if (typeof text === 'undefined') {\r\n      text = this.params.text;\r\n    }\r\n    if (typeof parentId === 'undefined') {\r\n      parentId = this.params.parentId;\r\n    }\r\n    if (typeof visibility === 'undefined') {\r\n      visibility = this.params.visibility;\r\n    }\r\n    return {\r\n      'bill': {\r\n        'billId': id,\r\n        'configId': configId,\r\n        'summary': summary\r\n      },\r\n      'comment': {\r\n        'billId': id,\r\n        'configId': configId,\r\n        'parentId': parentId || null,\r\n        'text': text,\r\n        'visibility': visibility\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { ListFilterHandler, QueryCondition } from '@farris/ui-list-filter';\r\n\r\n@Injectable()\r\nexport class ListFilterConditionsService implements ListFilterHandler {\r\n\r\n    constructor(private frameContext: FrameContext) { }\r\n\r\n    public setCurrentFilterConditions(conditions: QueryCondition[]): void {\r\n        this.frameContext.uiState['currentFilterConditions'] = conditions;\r\n    }\r\n\r\n}\r\n","import { HttpClient } from \"@angular/common/http\";\r\nimport { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { Observable } from \"rxjs\";\r\nimport { FORM_PATH_TOKEN, FormManifest, IFormManifestService } from \"@farris/devkit\";\r\nimport { share } from \"rxjs/operators\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FormManifestService implements IFormManifestService {\r\n  private static mainfests = new Map<string, Observable<FormManifest>>();\r\n  constructor(\r\n    private injector: Injector,\r\n    @Inject(FORM_PATH_TOKEN) private modulePath,\r\n    private httpClient: HttpClient\r\n  ) { }\r\n  public load(): Observable<FormManifest> {\r\n    if (this.modulePath.endsWith('\\/')) {\r\n      this.modulePath = this.modulePath.substring(0, this.modulePath.length - 1);\r\n    }\r\n    const formManifestPath = BasePathService.convertPath(`${this.modulePath}/expressions/form.manifest.json?version=${new Date().valueOf().toString()}`);\r\n    const request$ = FormManifestService.mainfests.get(this.modulePath);\r\n    if (request$) {\r\n      return request$;\r\n    } else {\r\n      const req$ = this.httpClient.get<FormManifest>(formManifestPath, { responseType: 'json' }).pipe(share());\r\n      FormManifestService.mainfests.set(this.modulePath, req$);\r\n      return req$;\r\n    }\r\n  }\r\n}\r\n","import { HttpClient } from \"@angular/common/http\";\r\nimport { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { Observable, of } from \"rxjs\";\r\nimport { share, switchMap } from \"rxjs/operators\";\r\nimport { FORM_PATH_TOKEN, FrameContext, FormExpressionsManifest, FormManifest, IFormExpressionManifestService, FORM_MANIFEST_SERVICE_TOKEN, IFormManifestService } from \"@farris/devkit\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FormExpressionManifestService implements IFormExpressionManifestService {\r\n  private static mainfests = new Map<string, Observable<any>>();\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    private httpClient: HttpClient,\r\n    @Inject(FORM_PATH_TOKEN) private modulePath,\r\n    @Inject(FORM_MANIFEST_SERVICE_TOKEN) private formManifestService: IFormManifestService) { }\r\n\r\n  public load(): Observable<any> {\r\n    if (this.modulePath.endsWith('\\/')) {\r\n      this.modulePath = this.modulePath.substring(0, this.modulePath.length - 1);\r\n    }\r\n\r\n    return this.formManifestService.load().pipe(\r\n      switchMap((formManifest: FormManifest) => {\r\n        const expressions = formManifest.expressions;\r\n        const expressionManifest = expressions.find((expressionManifest: FormExpressionsManifest) => expressionManifest.ns === this.frameContext.namespace);\r\n        if (expressionManifest) {\r\n          const expressionPath = BasePathService.convertPath(`${this.modulePath}/expressions/${expressionManifest.path}?version=${new Date().valueOf().toString()}`);\r\n          const key = BasePathService.convertPath(`${this.modulePath}/expressions/${expressionManifest.path}`);\r\n          const request$ = FormExpressionManifestService.mainfests.get(key);\r\n          if (request$) {\r\n            return request$;\r\n          } else {\r\n            const req$ = this.httpClient.get(expressionPath, { responseType: 'json' }).pipe(share());\r\n            FormExpressionManifestService.mainfests.set(key, req$);\r\n            return req$;\r\n          }\r\n        } else {\r\n          return of({});\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport moment from 'moment';\r\nimport { NumberFormat, UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class LocalizationService {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings) { }\r\n\r\n  /**\r\n   * ç¨æ·éç½®æ ¼å¼\r\n   */\r\n  public get formats(): { date: { dateFormat: string, timeFormat: string, dateTimeFormat: string }, number: { negativeSign: string, numberDecimalDigits: number, numberDecimalSeparator: string, numberGroupSeparator: string }, [prop: string]: any } {\r\n    const { dateFormat = null, timeFormat = null } = this.userSettings || {};\r\n    let dateTimeFormat = null;\r\n    if (dateFormat && timeFormat) {\r\n      dateTimeFormat = `${dateFormat} ${timeFormat}`;\r\n    }\r\n    const date = {\r\n      dateFormat,\r\n      timeFormat,\r\n      dateTimeFormat\r\n    };\r\n    const { negativeSign = null, numberDecimalDigits = null, numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat || {};\r\n    const number = {\r\n      negativeSign,\r\n      numberDecimalDigits,\r\n      numberDecimalSeparator,\r\n      numberGroupSeparator\r\n    };\r\n    return { date, number };\r\n  }\r\n  /**\r\n   * æ ¹æ®æ°æ®ç±»åæ¬å°åæ°æ®\r\n   * @param value value\r\n   * @param dataType æ°æ®ç±»å\r\n   * @returns string\r\n   */\r\n  public localize(value: any, dataType: string): string {\r\n    if (dataType && value) {\r\n      dataType = dataType.toLowerCase();\r\n      if (dataType === 'date') {\r\n        return this.transformDate(value);\r\n      } else if (dataType === 'datetime') {\r\n        return this.transformDateTime(value);\r\n      } else if (dataType === 'number') {\r\n        return this.transformNumber(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®å½éåç±»åè·åæ ¼å¼åå­ç¬¦ä¸²\r\n   * @param localizationType å½éåç±»å\r\n   * @returns \r\n   */\r\n  public getFormat(localizationType: string): string {\r\n    if (localizationType) {\r\n      localizationType = localizationType.toLowerCase();\r\n    }\r\n    if (localizationType === 'date') {\r\n      return this.formats.date.dateFormat;\r\n    } else if (localizationType === 'datetime') {\r\n      return this.formats.date.dateTimeFormat;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥æ\r\n   * @param value value\r\n   */\r\n  private transformDate(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    if (!dateFormat || !value) {\r\n      return value;\r\n    }\r\n    const date = moment(value);\r\n    const isValid = date.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    dateFormat = this.parseDateFormat(dateFormat);\r\n    return date.format(dateFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ¶é´\r\n   * @param value value\r\n   * todo: ç®åæ æ³å®ä¹æ¥ææ¶é´æ ¼å¼\r\n   */\r\n  private transformDateTime(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    let timeFormat = this.userSettings && this.userSettings.timeFormat || 'HH:mm:ss';\r\n    if (!dateFormat || !timeFormat) {\r\n      return value;\r\n    }\r\n    const dateTime = moment(value);\r\n    const isValid = dateTime.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    if (dateFormat) {\r\n      dateFormat = this.parseDateFormat(dateFormat);\r\n    }\r\n    if (timeFormat) {\r\n      timeFormat = this.parseTimeFormat(timeFormat);\r\n    }\r\n    const dateTimeFormat = dateFormat + ' ' + timeFormat;\r\n    return dateTime.format(dateTimeFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ°å­\r\n   * @param value value\r\n   */\r\n  private transformNumber(value): string {\r\n    if (value === null || value === undefined || value === '') {\r\n      return '';\r\n    }\r\n    const bigNumber = new BigNumber(value);\r\n    // å¦æä¸æ¯æ°å­ï¼ä¸åä»»ä½å¤ç\r\n    if (!BigNumber.isBigNumber(bigNumber)) {\r\n      return value;\r\n    }\r\n    const isNegative = bigNumber.isNegative();\r\n    const format = this.buildNumberFormat();\r\n    const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat || {};\r\n    if (isNegative) {\r\n      if (negativeSign !== null) {\r\n        format.prefix = negativeSign;\r\n        return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);\r\n      }\r\n    }\r\n    return bigNumber.toFormat(numberDecimalDigits, null, format);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseDateFormat(format: string) {\r\n    return format.replace(/y/g, 'Y').replace(/d/g, 'D');\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¶é´æ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseTimeFormat(format: string) {\r\n    return format.replace(/M/g, 'm');\r\n  }\r\n  /**\r\n   * æé bignumberæ°å­æ ¼å¼åéé¡¹\r\n   */\r\n  private buildNumberFormat() {\r\n    if (this.numberFormat) {\r\n      const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;\r\n      const format: any = {\r\n        groupSize: 3,\r\n      };\r\n      if (numberDecimalSeparator !== null) {\r\n        format.decimalSeparator = numberDecimalSeparator;\r\n      }\r\n      if (numberGroupSeparator !== null) {\r\n        format.groupSeparator = numberGroupSeparator;\r\n      }\r\n      return format;\r\n    }\r\n  }\r\n  private get numberFormat(): NumberFormat {\r\n    return this.userSettings && this.userSettings.numberFormat || null;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { EMPTY } from \"rxjs\";\r\nimport { AttentionService, AttentionElement } from '@farris/ui-tooltip';\r\n\r\n\r\n@Injectable()\r\nexport class FormAttentionService {\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private attentionService: AttentionService) { }\r\n  /**\r\n   * éªçæé®\r\n   * @param ids idå­ç¬¦ä¸²ææ°ç»\r\n   * @param duration æ¶é´é´é\r\n   * @returns \r\n   */\r\n  public blink(ids: string | string[], duration?: any) {\r\n    if (typeof ids === 'string') {\r\n      ids = ids.split(',').filter(p => p);\r\n    }\r\n    if (!Array.isArray(ids) || ids.length < 1) {\r\n      return EMPTY;\r\n    }\r\n    if (typeof duration === 'string') {\r\n      duration = duration.trim();\r\n    }\r\n    if (!duration) {\r\n      duration = 600;\r\n    }\r\n    duration = parseInt(duration);\r\n    if (isNaN(duration) || duration <= 0) {\r\n      duration = 600;\r\n    }\r\n    const elements: AttentionElement[] = ids.map((item: string) => {\r\n      return {\r\n        idOrEl: item,\r\n        // type:'',\r\n        // class:''\r\n      };\r\n    });\r\n    this.attentionService.catchAttention(elements, duration);\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { BefRepository, ResponseInfo } from \"@farris/bef\";\r\nimport { Repository } from '@farris/devkit';\r\nimport { Observable } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\nimport { Prop } from \"./types\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FeatureRepository {\r\n  constructor(\r\n    private injector: Injector,\r\n    private repository: Repository<any>,\r\n  ) { }\r\n  /**\r\n   * æ ¹æ®ç©æidè·åç©æç¹å¾é¡¹åç¹å¾å¼ï¼å¬å±é»è®¤å¼ï¼\r\n   * @param materialId ç©æid\r\n   */\r\n  public getFeaturesByMaterialId(materialId: string): Observable<ResponseInfo> {\r\n    const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/getmaterialprops');\r\n    const body = {\r\n      materialID: materialId\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    return befRepository.proxy.request(url, 'put', null, options);\r\n  }\r\n  /**\r\n   * æ ¹æ®ç©æidåç©æç¹å¾ä¿å­åçhashè·åè¯¥ç©æå·²ç»å­å¨çç¹å¾é¡¹å¼\r\n   * @param materialId ç©æId\r\n   * @param configID å¯¹åºè¯¥ç©æçç¹å¾é¡¹hash\r\n   * @returns\r\n   */\r\n  public getConfigedValueByFeatureId(materialId: string, configID: string, configType: string = 'Materials'): Observable<ResponseInfo> {\r\n    const url = BasePathService.convertPath('/api/bf/df/v1.0/charactconfigservice/service/getcharactconfiginfo');\r\n    const body = { objType: configType, objID: materialId, configID };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(url, 'put', null, options);\r\n  }\r\n  /**\r\n   * ä¿å­ç©æç¹å¾é¡¹\r\n   * @param materialId ç©æid\r\n   * @param charactValue ç¹å¾å¼\r\n   * @param configType éç½®ç±»å\r\n   * @returns\r\n   */\r\n  public applyFeatures(materialId: string, charactValue: any, configType: string = 'Materials') {\r\n    const body = { objType: configType, objID: materialId, charactValue };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(BasePathService.convertPath('/api/bf/df/v1.0/charactconfigservice/service/matchcharactconfigid'), 'put', null, options);\r\n  }\r\n  /**\r\n   * è·åå¸®å©ä¿¡æ¯\r\n   * @param helpid å¸®å©id\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param params åæ°\r\n   * @returns\r\n   */\r\n  public getHelpInfo(helpid: string, filter: string, params: any): Observable<any> {\r\n    const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata');\r\n    const httpParams: any = {};\r\n    if (params) {\r\n      if (params.pageIndex) {\r\n        httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);\r\n      }\r\n      if (params.pageSize) {\r\n        httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);\r\n      }\r\n      if (params.condition) {\r\n        httpParams['condition'] = JSON.stringify(params.condition);\r\n      }\r\n      if (params.searchValue) {\r\n        httpParams['search'] = params.searchValue;\r\n      }\r\n    }\r\n    const body = {\r\n      helpID: helpid,\r\n      queryParam: JSON.stringify(httpParams),\r\n      filterStr: filter\r\n    };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(url, 'put', null, options);\r\n  }\r\n}\r\n","export namespace Prop {\r\n  /**\r\n   * ç¹å¾é\r\n   */\r\n  export interface IPropSet {\r\n    id: string;\r\n    /**\r\n     * ç¹å¾éç¼å·\r\n     */\r\n    code: string;\r\n    /**\r\n     * å¨æå­æ®µï¼è¿åå¼ä¸­ä¸å­å¨ï¼ç¨äºå±ç¤ºå½åè¯­è¨çææ¬\r\n     */\r\n    name?: string;\r\n    /**\r\n     * ç¹å¾éåç§°-è±æ\r\n     */\r\n    name_en: string;\r\n    /**\r\n     * ç¹å¾éåç§°-ç®ä½\r\n     */\r\n    name_chs: string;\r\n    /**\r\n     * ç¹å¾éåç§°-ç¹ä½\r\n     */\r\n    name_cht: string;\r\n  }\r\n  /**\r\n   * ç¹å¾é¡¹\r\n   */\r\n  export interface IProp {\r\n    /**\r\n     * ç¹å¾é¡¹id\r\n     */\r\n    id: string;\r\n    /**\r\n     * ç¹å¾é¡¹ç¼å·\r\n     */\r\n    code: string;\r\n    /**\r\n     * ç¼å·å­æ®µï¼æä¸ä½¿ç¨ï¼\r\n     */\r\n    codefield: string;\r\n    /**\r\n     * å¨æå­æ®µ\r\n     */\r\n    name?: string;\r\n    /**\r\n     * ç¹å¾é¡¹åç§°-è±æ\r\n     */\r\n    name_en: string;\r\n    /**\r\n     * ç¹å¾é¡¹ç¼å·-ç®ä½\r\n     */\r\n    name_chs: string;\r\n    /**\r\n     * ç¹å¾é¡¹ç¼å·-ç¹ä½\r\n     */\r\n    name_cht: string;\r\n    /**\r\n     * ç¹å¾å¼\r\n     */\r\n    value: any;\r\n    /**\r\n     * å¼å­æ®µ\r\n     */\r\n    valuefield: string;\r\n    /**\r\n     * ç¹å¾é¡¹å¯¹åºçè¾å¥æ§ä»¶ç±»å\r\n     */\r\n    inputtype: string;\r\n    /**\r\n     * æ°å­ç²¾åº¦\r\n     */\r\n    digitalaccuracy: number;\r\n    /**\r\n     * ç¹å¾éid\r\n     */\r\n    setid: string;\r\n    helpid: string;\r\n    /**\r\n     * æä¸¾æ°æ®æº\r\n     * @attention æ¥å£è¿åç»æä¸ºå­ç¬¦ä¸²\r\n     */\r\n    enuminfo: string;\r\n    /**\r\n     * æä¸¾æ°æ®æº\r\n     */\r\n    data: IEnumInfo[];\r\n    /**\r\n     * æ åä»£ç éæ¯å¦ä¸ºæ \r\n     */\r\n    setistree: string;\r\n    /**\r\n     * æ åä»£ç éid\r\n     */\r\n    codesetid: string;\r\n    /**\r\n     * ææ¬å­æ®µ\r\n     */\r\n    textfield: string;\r\n    /**\r\n     * è¿æ»¤æ¡ä»¶\r\n     */\r\n    filtercondition: any;\r\n    /**\r\n     * å¿å¡«\r\n     */\r\n    isrequired: string | boolean;\r\n    /**\r\n     * åªè¯»\r\n     */\r\n    isreadonly: string | boolean;\r\n    /**\r\n     * æåº\r\n     */\r\n    sortorder: number;\r\n\r\n    timestamp_createdon: string;\r\n    timestamp_lastchangedon: string;\r\n\r\n    timestamp_createdby: string;\r\n    timestamp_lastchangedby: string;\r\n\r\n  }\r\n  /**\r\n   * æä¸¾æ°æ®æºæ ¼å¼\r\n   */\r\n  export interface IEnumInfo {\r\n    id: string;\r\n    text: string;\r\n  }\r\n  export interface IReturnValue {\r\n    propset: IPropSet[],\r\n    props: IProp[]\r\n  }\r\n  export enum InputType {\r\n    enum = 'Enum',\r\n    string = 'String',\r\n    help = 'Help',\r\n    number = 'Number',\r\n    date = 'Date'\r\n  }\r\n}\r\n","import { Inject, Injectable, Injector, LOCALE_ID, Optional } from \"@angular/core\";\r\nimport { BefRepository, ResponseInfo } from \"@farris/bef\";\r\nimport { FrameContext, RestfulService, Repository } from '@farris/devkit';\r\nimport { Observable } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\nimport { FeatureRepository } from \"./feature-repository\";\r\nimport { Prop } from \"./types\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FeatureDataService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private repository: FeatureRepository,\r\n    @Optional() @Inject(LOCALE_ID) private localeId?: string\r\n  ) {\r\n    this.localeId = this.localeId || 'zh-CHS';\r\n  }\r\n  /**\r\n   * æ ¹æ®ç©æidè·åç©æç¹å¾é¡¹åç¹å¾å¼ï¼å¬å±é»è®¤å¼ï¼\r\n   * @param materialId ç©æid\r\n   */\r\n  public getFeaturesByMaterialId(materialId: string): Observable<Prop.IReturnValue> {\r\n    return this.repository.getFeaturesByMaterialId(materialId).pipe(\r\n      map((response: ResponseInfo) => {\r\n        if (!response || !response.returnValue) {\r\n          return null;\r\n        }\r\n        const returnValue = JSON.parse(response.returnValue);\r\n        const result: Prop.IReturnValue = { propset: [], props: [] };\r\n        const propsets = returnValue.propset || null;\r\n        const props = returnValue.props || null;\r\n        if (propsets && Array.isArray(propsets)) {\r\n          propsets.map((propset: Prop.IPropSet) => {\r\n            propset.name = this.translateName(propset);\r\n            return propset;\r\n          });\r\n          result.propset = propsets;\r\n        }\r\n        if (props && Array.isArray(props) && props.length > 0) {\r\n          props.map((prop: Prop.IProp) => {\r\n            // å¤çå¤è¯­\r\n            prop.name = this.translateName(prop);\r\n            // å¤çæä¸¾\r\n            if (prop.inputtype === Prop.InputType.enum && prop.enuminfo) {\r\n              prop.data = JSON.parse(prop.enuminfo);\r\n            }\r\n            // å¤çå¿å¡«ååªè¯»\r\n            prop.isreadonly = prop.isreadonly === '1' ? true : false;\r\n            prop.isrequired = prop.isrequired === '1' ? true : false;\r\n            return prop;\r\n          });\r\n          result.props = props;\r\n        }\r\n        return result;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ ¹æ®ç©æidåç©æç¹å¾ä¿å­åçhashè·åè¯¥ç©æå·²ç»å­å¨çç¹å¾é¡¹å¼\r\n   * @param materialId ç©æId\r\n   * @param configID å¯¹åºè¯¥ç©æçç¹å¾é¡¹hash\r\n   * @returns\r\n   */\r\n  public getConfigedValueByFeatureId(materialId: string, configID: string, configType: string = 'Materials'): Observable<any> {\r\n    return this.repository.getConfigedValueByFeatureId(materialId, configID, configType).pipe(map((result: any) => {\r\n      return JSON.parse(result);\r\n    }));\r\n  }\r\n  /**\r\n   * ä¿å­ç©æç¹å¾é¡¹\r\n   * @param materialId ç©æid\r\n   * @param charactValue ç¹å¾å¼\r\n   * @param configType éç½®ç±»å\r\n   * @returns\r\n   */\r\n  public applyFeatures(materialId: string, charactValue: any, configType: string = 'Materials') {\r\n    return this.repository.applyFeatures(materialId, charactValue, configType).pipe(map((config: any) => {\r\n      return JSON.parse(config);\r\n    }));\r\n  }\r\n  /**\r\n   * è·åå¸®å©ä¿¡æ¯\r\n   * @param helpid å¸®å©id\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param params åæ°\r\n   * @returns\r\n   */\r\n  public getHelpInfo(helpid: string, filter: string, params: any): Observable<any> {\r\n    const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata');\r\n    const httpParams: any = {};\r\n    if (params) {\r\n      if (params.pageIndex) {\r\n        httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);\r\n      }\r\n      if (params.pageSize) {\r\n        httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);\r\n      }\r\n      if (params.condition) {\r\n        httpParams['condition'] = JSON.stringify(params.condition);\r\n      }\r\n      if (params.searchValue) {\r\n        httpParams['search'] = params.searchValue;\r\n      }\r\n    }\r\n    const body = {\r\n      helpID: helpid,\r\n      queryParam: JSON.stringify(httpParams),\r\n      filterStr: filter\r\n    };\r\n    const befRepository: BefRepository<any> = null;//this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(url, 'put', null, options).pipe(\r\n      map((result: any) => JSON.parse(result))\r\n    );\r\n  }\r\n  /**\r\n   * å½éåç¹å¾é¡¹æç¹å¾éåç§°\r\n   * @param object ç¹å¾éæç¹å¾é¡¹å¯¹è±¡\r\n   * @returns\r\n   */\r\n  private translateName(object: Prop.IPropSet | Prop.IProp): string {\r\n    if (!object) {\r\n      return null;\r\n    }\r\n    let name = null;\r\n    switch (this.localeId) {\r\n      case 'en': {\r\n        name = object['name_en'];\r\n      } break;\r\n      case 'zh-CHS': {\r\n        name = object['name_chs'];\r\n      } break;\r\n      case 'zh-CHT': {\r\n        name = object['name_cht'];\r\n      } break;\r\n      default: name = object['name_chs'];\r\n    }\r\n    return name;\r\n  }\r\n}\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { FeatureEditorService } from '@farris/ui-feature-editor';\r\nimport { FormNotifyService } from \"../form-notify.service\";\r\nimport { map, switchMap, tap } from \"rxjs/operators\";\r\nimport { FormLoadingService } from \"../form-loading/form-loading.service\";\r\nimport { FeatureDataService } from './feature-data.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { of } from \"rxjs\";\r\n\r\n@Injectable()\r\nexport class FeatureEditService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private featureEditorService: FeatureEditorService,\r\n    private featureDataService: FeatureDataService,\r\n    private loadingService: FormLoadingService,\r\n    private notifyService: FormNotifyService,\r\n    private languageService: LanguageService,\r\n  ) { }\r\n\r\n  public edit(materialId: string, materialFeatureId?: string, options?: any) {\r\n    if (!materialId) {\r\n      throw new Error('[FeatureEditService]ç©æidä¸è½ä¸ºç©ºï¼');\r\n    }\r\n    if (!options) {\r\n      options = {};\r\n    }\r\n    if (typeof options === 'string' && options.startsWith('{') && options.endsWith('}')) {\r\n      options = JSON.parse(options);\r\n    }\r\n    options.getHelpInfo = this.featureDataService.getHelpInfo;\r\n    this.loadingService.show();\r\n    return this.featureDataService.getFeaturesByMaterialId(materialId).pipe(\r\n      tap((result: any) => {\r\n        this.loadingService.hide();\r\n        const returnValue = result || null;\r\n        if (returnValue) {\r\n          const featureInfo = JSON.parse(returnValue);\r\n          const props = featureInfo.props || null;\r\n          if (!props || props.length < 1) {\r\n            this.notifyService.warning(this.languageService.propsIsEmpty);\r\n            return;\r\n          }\r\n          this.featureEditorService.show(props, options);\r\n        } else {\r\n          this.notifyService.error(this.languageService.propsIsEmpty);\r\n        }\r\n      })\r\n    );\r\n  }\r\n  private buildFeatures(materialId: string, materialFeatureId?: string) {\r\n    const features$ = this.featureDataService.getFeaturesByMaterialId(materialId);\r\n    return features$.pipe(\r\n      switchMap(featureSet => {\r\n        if (materialFeatureId) {\r\n          const configedFeatures$ = this.featureDataService.getConfigedValueByFeatureId(materialFeatureId, materialFeatureId);\r\n          return configedFeatures$.pipe(\r\n            map(defaultConfigs => {\r\n              const featureTemplate = featureSet.props;\r\n              const features = this.mergeFeatures(featureTemplate, defaultConfigs);\r\n              return features;\r\n            })\r\n          );\r\n        } else {\r\n          return of(featureSet.props);\r\n        }\r\n      })\r\n    );\r\n\r\n  }\r\n  private mergeFeatures(featureTemplate: any, defaultConfigs: any) {\r\n    return null;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { AppContext, FrameContext, Repository, ENTITY_TEMPLATE, ResolveService, ExpressionUtil, ExpressionExecutor } from \"@farris/devkit\";\r\nimport { Observable, of } from \"rxjs\";\r\n\r\n@Injectable()\r\nexport class ExpressionService {\r\n  constructor(private injector: Injector, private resolveService: ResolveService, private frameContext: FrameContext, private expressionExecutor: ExpressionExecutor) { }\r\n  /**\r\n   * æ§è¡è¡¨è¾¾å¼è®¡ç®\r\n   * @param expression è¡¨è¾¾å¼\r\n   * @param customContext èªå®ä¹ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public execute(expression: string, customContext?: { [prop: string]: any }): any {\r\n    const deps = this.resolveService.resolve(expression);\r\n    const groupDependencies = ExpressionUtil.getGroupFunctionDependency(expression, this.frameContext.repository.entityTypeInfo);\r\n    const entityContext = this.buildEntityContext(deps, groupDependencies);\r\n    const stateContext = this.buildStateContext();\r\n    const context = {\r\n      [this.entityOriginalNodeCode]: entityContext,\r\n      ...stateContext,\r\n      BigNumber,\r\n      frameContext: this.frameContext,\r\n      bindingData: this.frameContext.bindingData,\r\n      repository: this.frameContext.repository,\r\n      ...customContext\r\n    }\r\n    return this.expressionExecutor.eval(expression, context);\r\n  }\r\n  /**\r\n   * æ§è¡è¡¨è¾¾å¼ï¼è¿åå¯è§å¯å¯¹è±¡ï¼\r\n   * @param expression è¡¨è¾¾å¼\r\n   * @param customContext èªå®ä¹ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public executeAsync(expression: string, customContext?: { [prop: string]: any }): Observable<any> {\r\n    const result = this.execute(expression, customContext);\r\n    return of(result);\r\n  }\r\n  /**\r\n   * æé å®ä½ä¸ä¸æ\r\n   * @param deps \r\n   * @param groupDependencies \r\n   * @param context \r\n   * @returns \r\n   */\r\n  private buildEntityContext(deps: string[], groupDependencies: string[], context?: { [prop: string]: any }) {\r\n    let isGroupdMainEntity = false;\r\n    deps.forEach((dep: string) => {\r\n      const isEntityDependency = this.isEntityDependency(dep);\r\n      const isGroupDependency = groupDependencies.findIndex(item => item === dep) !== -1;\r\n      // å¦æä¾èµçæ¯stateï¼æ éå¤çï¼ç°å¨éè¦ç¡®å®çæ¯è¿åå¤å°å®ä½çé®é¢ï¼åstateæ²¡æå³ç³»\r\n      // è¡¨è¾¾å¼ä¾èµäºå®ä½\r\n      if (isEntityDependency) {\r\n        // æ¯èåä¾èµ\r\n        if (isGroupDependency) {\r\n          const dependencyLength = dep.split('/').filter(p => p).length - 1;\r\n          if (dependencyLength === 1) {\r\n            // èåäºä¸»è¡¨å­æ®µï¼ææä¸»è¡¨æ°æ®é½éè¦åä¸è¿ç®ï¼æ­¤æ¶å·²ç»ç¡®å®è®¡ç®çå®ä½ä¸ä¸æäºã\r\n            isGroupdMainEntity = true;\r\n          } else {\r\n            // èåäºå­è¡¨å­æ®µï¼åªéè¦ä¼ éå½åå®ä½\r\n          }\r\n        } else {\r\n          // å½åä¾èµä¸æ¯èåï¼åªéè¦ä¼ éå½åå®ä½\r\n        }\r\n      }\r\n    });\r\n    const data = this.getEntity();\r\n    if (isGroupdMainEntity) {\r\n      const collection = this.frameContext.repository.entityCollection.toJSON();\r\n      data['__type__'] = 'List';\r\n      data['__items__'] = collection;\r\n    }\r\n    return data;\r\n  }\r\n  /**\r\n   * æ¯å¦ä¸ºå®ä½ä¾èµ\r\n   * @param dep \r\n   * @returns \r\n   */\r\n  private isEntityDependency(dep: string) {\r\n    return dep.startsWith(ENTITY_TEMPLATE);\r\n  }\r\n  /**\r\n   * è·åå®ä½\r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getEntity() {\r\n    const entityTypeInfo = this.frameContext.repository.entityTypeInfo;\r\n    const bindingData = this.frameContext.bindingData;\r\n    const childrenEntityPaths = [];\r\n    ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);\r\n    const entity = this.frameContext.bindingData.list.currentItem.toJSON();\r\n    entity['__type__'] = 'Entity';\r\n    if (!childrenEntityPaths || childrenEntityPaths.length < 1) {\r\n      return entity;\r\n    }\r\n    // æ¾å°ææå­è¡¨\r\n    childrenEntityPaths.forEach((paths: string[]) => {\r\n      const row = ExpressionUtil.getCurrentRowByPaths(paths, bindingData);\r\n      if (row) {\r\n        const propertyName = paths.pop();\r\n        let parent = paths.reduce((object: any, path: string) => {\r\n          return object && object[path] || null;\r\n        }, entity);\r\n        const node = { __items__: [...parent[propertyName]], ...row, __type__: 'List' };\r\n        parent[propertyName] = node;\r\n      }\r\n    });\r\n    return entity;\r\n  }\r\n  /**\r\n   * è·åä¸»å®ä½åå§å­æ®µå\r\n   */\r\n  protected get entityOriginalNodeCode(): string {\r\n    const repository = this.injector.get(Repository);\r\n    return repository && repository.entityTypeInfo && repository.entityTypeInfo.entityInfo && repository.entityTypeInfo.entityInfo.originalCode || null;\r\n  }\r\n  /**\r\n   * æé åéä¸ä¸æ\r\n   * @param event \r\n   * @returns \r\n   */\r\n  public buildStateContext() {\r\n    const ns = this.frameContext.namespace;\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    const frameContexts = appContext.frameContextManager.getFrameContextsByNamespace(ns);\r\n    const result = {};\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      const anonymousFrameContext = frameContexts[0];\r\n      const rootFrameContext = anonymousFrameContext.getVirtualRootFrameContext();\r\n      if (rootFrameContext) {\r\n        const uiState = rootFrameContext.viewModel.uiState;\r\n        const propertyNames = Object.getOwnPropertyNames(uiState) || [];\r\n        propertyNames.forEach((prop: string) => {\r\n          if (prop.match(/^[a-zA-Z0-9_\\$]+$/g) !== null) {\r\n            result[prop] = uiState[prop];\r\n          }\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}","import { ApplicationRef, ChangeDetectorRef, Injectable, Injector } from \"@angular/core\";\r\n\r\n/**\r\n * angular èå¼æ£æ¥æå¡\r\n */\r\n@Injectable()\r\nexport class DirtyCheckingService {\r\n  constructor(public injector: Injector, private cd: ChangeDetectorRef, private appRef: ApplicationRef) {\r\n  }\r\n  /**\r\n   * Checks this view and its children. \r\n   * @param global æ¯å¦å¨å±æ£æ¥\r\n   */\r\n  public detectChanges(global?: boolean | string) {\r\n    global = (global === true || global === 'true') ? true : false;\r\n    if (global && this.appRef) {\r\n      this.appRef.tick();\r\n    } else if (this.cd) {\r\n      this.cd.detectChanges();\r\n    }\r\n  }\r\n  /**\r\n   * å¨æå®æ¶é´ï¼msï¼åè§¦åAngularèå¼æ£æ¥\r\n   * @param duration è¶æ¶æ¶é´(ms)\r\n   * @param global æ¯å¦å¨å±æ£æ¥\r\n   */\r\n  public detectChangesAfter(duration: number, global?: boolean | string) {\r\n    global = (global === true || global === 'true') ? true : false;\r\n    if (isNaN(duration)) {\r\n      return;\r\n    }\r\n    if (global && this.appRef) {\r\n      window.setTimeout(() => {\r\n        this.appRef.tick();\r\n      }, duration);\r\n    } else if (this.cd) {\r\n      window.setTimeout(() => {\r\n        this.cd.detectChanges();\r\n      }, duration);\r\n    }\r\n  }\r\n}","import { Injectable, Injector } from '@angular/core';\r\nimport { EMPTY, of } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FrameContext, DataPathCreator, Repository, DataPath, EntityList, BindingList, Entity } from '@farris/devkit';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormMessageService } from './form-message.service';\r\n\r\n@Injectable()\r\nexport class PopUpService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    private repository: Repository<any>,\r\n    private languageService: LanguageService,\r\n    private messageService: FormMessageService\r\n  ) { }\r\n  public confirm() { }\r\n  /**\r\n   * åæ¶åæ´\r\n   * @param frameId\r\n   * @param id\r\n   * @returns\r\n   * @throws invalid frameid\r\n   */\r\n  public cancel(frameId: string, id?: string) {\r\n    const frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    if (!frameContext) {\r\n      throw new Error(`[PopUpService]Invalid frameId ${frameId}`);\r\n    }\r\n    const primaryValue = this.frameContext.bindingData.list.currentId;\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    if (!id) {\r\n      const bindingList = this.frameContext.bindingData.getList() as BindingList;\r\n      id = bindingList.currentId;\r\n    }\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const longPaths = (DataPathCreator.createByShortPathFromRoot(bindingPaths, befRepository.entityManager, this.frameContext.bindingData) as DataPath).toArray().map((path: string) => path.split(':')[1]);\r\n    const entityListPaths = Array.from(longPaths);\r\n    // èå¼å½åè¡¨å½åè¡\r\n    entityListPaths.pop();\r\n    const dialogRef = this.frameContext.frameComponent['dialogRef'];\r\n    if (entityListPaths.length < 1) {\r\n      // ä¸»è¡¨\r\n      const entity = this.repository.entityCollection.getEntityById(id) as Entity;\r\n      const originalData = entity['originalData'];\r\n      entity.load(originalData, { loadChild: false });\r\n    } else {\r\n      const entityList = befRepository.entityManager.getEntityNodeByPath(entityListPaths) as EntityList<any>;\r\n      if (entityList) {\r\n        const originalData: any[] = entityList['originalData'];\r\n        const item = originalData.find((item) => item.id === id);\r\n        if (item) {\r\n          // å·²ææ°æ®ï¼è¿ååæ´\r\n          const entity: Entity = befRepository.entityManager.getEntityByPath(longPaths) as Entity;\r\n          if (entity.changes && entity.changes.length > 0) {\r\n            return this.messageService.confirm(this.languageService.cancelWithoutSave).pipe(\r\n              tap((result: boolean) => {\r\n                if (result) {\r\n                  entity.load(item, { loadChild: false });\r\n                  entity.changes.splice(0, entity.changes.length);\r\n                }\r\n              })\r\n            );\r\n          } else {\r\n            // æ²¡æä¿®æ¹ï¼ç´æ¥å³é­\r\n            if (dialogRef) {\r\n              dialogRef.close();\r\n            }\r\n          }\r\n        } else {\r\n          // æ°å¢çæ°æ®ï¼å é¤\r\n          const paths = this.buildPath(bindingPath, primaryValue);\r\n          return this.messageService.confirm(this.languageService.cancelWithoutSave).pipe(\r\n            switchMap((result) => {\r\n              if (result) {\r\n                return befRepository.removeEntityByPath(paths, id).pipe(\r\n                  tap(() => {\r\n                    befRepository.entityManager.removeEntityByPath(paths, id);\r\n\r\n                    if (entityList.count() === 0 && dialogRef) {\r\n                      dialogRef.close();\r\n                    }\r\n                  })\r\n                );\r\n              } else {\r\n                return EMPTY;\r\n              }\r\n            })\r\n          );\r\n        }\r\n      }\r\n    }\r\n    return of([]);\r\n  }\r\n  /**\r\n   * åæ­¥å½åè¡\r\n   * @param id å½åè¡\r\n   */\r\n  public updateCurrentRow(id?: string) {\r\n    const bindingPath = this.frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    // const frameId = this.frameContext.frameId;\r\n    const root = this.frameContext.getVirtualRootFrameContext();\r\n    const primaryKeyValue = root.bindingData.list.currentId;\r\n    this.frameContext.bindingData.list.setCurrentId(primaryKeyValue);\r\n    if (bindingPaths.length > 0) {\r\n      const paths = [];\r\n      bindingPaths.forEach((path: string, index: number, array) => {\r\n        paths.push(path);\r\n        const bindingList = root.bindingData.getValue(paths) as BindingList;\r\n        if (bindingList) {\r\n          const currentId = bindingList.currentId;\r\n          const modalBindingList = this.frameContext.bindingData.getValue(paths) as BindingList;\r\n          if (index === bindingPath.length - 1 && id) {\r\n            modalBindingList.setCurrentId(id);\r\n          } else if (modalBindingList) {\r\n            modalBindingList.setCurrentId(currentId);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  public closeCheck() {\r\n    const frameContext = this.frameContext;\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const longPaths = (DataPathCreator.createByShortPathFromRoot(bindingPaths, befRepository.entityManager, this.frameContext.bindingData) as DataPath).toArray().map((path: string) => path.split(':')[1]);\r\n    const entityListPaths = Array.from(longPaths);\r\n    entityListPaths.pop();\r\n    const entityList = befRepository.entityManager.getEntityNodeByPath(entityListPaths) as EntityList<any>;\r\n    const dialogRef = this.frameContext.frameComponent['dialogRef'];\r\n    if (entityList.count() === 0 && dialogRef) {\r\n      dialogRef.close();\r\n    }\r\n  }\r\n  /**\r\n   * å é¤å¼¹çªä¸­çå½åè¡æ°æ®\r\n   * @param frameId -å¯éï¼è¦å é¤æ°æ®æå¨ç»ä»¶çidï¼é»è®¤ä¸ºå½ä»¤æå¨çç»ä»¶\r\n   * @param id -å¯éï¼è¦å é¤æ°æ®çidï¼é»è®¤ä¸ºå½ä»¤æå¨ç»ä»¶çå½åè¡æ°æ®id\r\n   * @param showConfirm -å¯éï¼å é¤æ°æ®æ¶æ¯å¦è¿è¡å é¤åçç¡®è®¤ï¼é»è®¤ä¸º`true`\r\n   * @returns\r\n   * @throws ç»ä»¶idéè¯¯æ¶æåºéè¯¯\r\n   */\r\n  public removeRow(frameId?: string, id?: string, showConfirm: string | boolean = true) {\r\n    const frameContext = frameId ? this.frameContext.appContext.frameContextManager.getFrameContextById(frameId) : this.frameContext;\r\n    if (!frameContext) {\r\n      throw new Error(`æ æçç»ä»¶idï¼${frameId}`);\r\n    }\r\n    // çº æ­£ä¸»é®\r\n    if (!id) {\r\n      const bindingList = frameContext.bindingData.getList() as BindingList;\r\n      id = bindingList.currentId;\r\n    }\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    const paths = this.buildPath(bindingPath, this.frameContext.bindingData.list.currentId);\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    // è½¬æ¢showConfirmä¸ºå¸å°\r\n    if (typeof showConfirm == 'string') {\r\n      showConfirm = showConfirm.trim() === 'false' ? false : true;\r\n    }\r\n    let confirm$ = of(true);\r\n    if (showConfirm) {\r\n      confirm$ = this.messageService.confirm(this.languageService.confirmDeletion);\r\n    }\r\n    return confirm$.pipe(\r\n      switchMap((result) => {\r\n        if (result) {\r\n          if (bindingPaths.length === 0) {\r\n            // ä¸»è¡¨å é¤ï¼ä¸ç«å³ä¿å­\r\n            return befRepository.removeEntityById(id, false);\r\n          } else {\r\n            return befRepository.removeEntityByPath(paths, id).pipe(\r\n              tap(() => {\r\n                befRepository.entityManager.removeEntityByPath(paths, id);\r\n              })\r\n            );\r\n          }\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * å³é­å¼¹çª\r\n   * @param frameId -å¯éï¼ç»ä»¶idï¼ä¸æå®æ¶ä½¿ç¨å½ä»¤æå¨çä¸ä¸æç»ä»¶\r\n   * @throws ä½¿ç¨æå®çç»ä»¶idæ æ³è·åç»ä»¶åå¼¹çªç»ä»¶å®ä¾è·åå¤±è´¥æ¶ä¼æåºå¼å¸¸\r\n   */\r\n  public closeDialog(frameId?: string) {\r\n    let frameContext = this.frameContext;\r\n    let dialogRef = null;\r\n    // å¼åèæå®äºç»ä»¶id\r\n    if (frameId) {\r\n      frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n      if (!frameContext) {\r\n        throw new Error('æå®äºæ æçç»ä»¶id');\r\n      }\r\n      dialogRef = frameContext.frameComponent['dialogRef'];\r\n    } else {\r\n      // å°è¯ä»å½åç»ä»¶ä¸ä¸æä¸­è·åå¼¹çªå¼ç¨\r\n      dialogRef = frameContext.frameComponent['dialogRef'];\r\n      if (!dialogRef) {\r\n        // å¦æå½ä»¤æè½½å°äºåå®¹ç»ä»¶ä¸\r\n        dialogRef = this.frameContext.parent.frameComponent['dialogRef'];\r\n      }\r\n    }\r\n    if (!dialogRef) {\r\n      throw new Error(`æ æ³è·åå¼¹çªç»ä»¶å®ä¾`);\r\n    }\r\n    dialogRef.close();\r\n  }\r\n  /**\r\n   * è¿åèªä¸æ¬¡æä¹åä»¥åäº§ççåæ´\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @param showConfirm - æ¯å¦å±ç¤ºæç¤ºä¿¡æ¯\r\n   */\r\n  public cancelChanges(frameId?: string, id?: string, showConfirm: boolean | string = true) {\r\n    const frameContext = this.getFrameContext(frameId);\r\n    // çº æ­£ä¸»é®\r\n    id = this.getPrimaryValue(frameId, id);\r\n    const data = this.getPersisteData(frameId, id);\r\n    if (typeof showConfirm === 'string') {\r\n      showConfirm = showConfirm.trim().toLowerCase() === 'false' ? false : true;\r\n    }\r\n    const isDataChanged = this.isDataChanged(data, frameId, id);\r\n    let result$ = of(true);\r\n    if (showConfirm && isDataChanged) {\r\n      result$ = this.messageService.confirm(this.languageService.cancelWithoutSave);\r\n    }\r\n    return result$.pipe(\r\n      switchMap((result: boolean) => {\r\n        if (result) {\r\n          const befRepository = frameContext.repository as BefRepository<any>;\r\n          const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter((p) => p);\r\n          const longPaths = (DataPathCreator.createByShortPathFromRoot(bindingPaths, befRepository.entityManager, this.frameContext.bindingData) as DataPath).toArray().map((path: string) => path.split(':')[1]);\r\n          const entityPaths = Array.from(longPaths);\r\n          const entity = befRepository.entityManager.getEntityNodeByPath(entityPaths) as Entity;\r\n          if (entity) {\r\n            entity.load(data);\r\n          }\r\n          return of(true);\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æä¹åæ°æ®\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   */\r\n  public persiste(frameId?: string, id?: string) {\r\n    // æä¹åæ°æ®\r\n    const bindingObject = this.getBindingObject(frameId, id);\r\n    bindingObject['__PSESISTE__DATA'] = bindingObject.toJSON();\r\n  }\r\n  /**\r\n   * è·åæä¹åæ°æ®\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @returns\r\n   */\r\n  private getPersisteData(frameId?: string, id?: string) {\r\n    const bindingObject = this.getBindingObject(frameId, id);\r\n    return bindingObject['__PSESISTE__DATA'];\r\n  }\r\n  private isDataChanged(data: { [prop: string]: any }, frameId?: string, id?: string) {\r\n    const bindingObject = this.getBindingObject(frameId, id);\r\n    const value = bindingObject.toJSON();\r\n    return JSON.stringify(value) !== JSON.stringify(data);\r\n  }\r\n  /**\r\n   * è·åå½åè¡\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @returns\r\n   * @throws æ¾ä¸å°å¯¹åºæ°æ®æ¶æåºæ æ³æ¾å°å¯¹åºæ°æ®çå¼å¸¸\r\n   */\r\n  private getBindingObject(frameId?: string, id?: string) {\r\n    const frameContext = this.getFrameContext(frameId);\r\n    // çº æ­£ä¸»é®\r\n    id = this.getPrimaryValue(frameId, id);\r\n    const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter((p) => p);\r\n    // æ¿å°å½åè¡\r\n    const bindingList: BindingList = frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    if (!bindingList || bindingList.length < 1) {\r\n      throw new Error(`æ æ³æ¾å°idä¸º:${id}çæ°æ®`);\r\n    }\r\n    return bindingList.currentItem;\r\n  }\r\n  /**\r\n   * æé å­è¡¨è·¯å¾\r\n   * @param bindingPath - ç»å®è·¯å¾\r\n   * @param id - id\r\n   * @throws å­è¡¨è·¯å¾éè¯¯\r\n   */\r\n  private buildPath(bindingPath: string, id: any) {\r\n    let path = '/' + id;\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = this.frameContext.viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n    return path;\r\n  }\r\n  /**\r\n   * æ ¹æ®ç»ä»¶idè·åç»ä»¶ä¸ä¸æ\r\n   * @param frameId - ç»ä»¶id\r\n   * @returns\r\n   * @throws æ æçç»ä»¶id\r\n   */\r\n  private getFrameContext(frameId?: string) {\r\n    const frameContext = frameId ? this.frameContext.appContext.frameContextManager.getFrameContextById(frameId) : this.frameContext;\r\n    if (!frameContext) {\r\n      throw new Error(`æ æçç»ä»¶idï¼${frameId}`);\r\n    }\r\n    return frameContext;\r\n  }\r\n  /**\r\n   * è·åä¸»é®\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @returns\r\n   * @throws ç»ä»¶idæ ææ¶æåºå¼å¸¸\r\n   */\r\n  private getPrimaryValue(frameId?: string, id?: string) {\r\n    if (!id) {\r\n      const frameContext = this.getFrameContext(frameId);\r\n      if (!frameContext) {\r\n        throw new Error(`æ æçç»ä»¶idï¼${frameId}`);\r\n      }\r\n      const bindingList = frameContext.bindingData.getList() as BindingList;\r\n      if (!bindingList || bindingList.length < 1) {\r\n        throw new Error(`æ æçä¸»é®:${id}`);\r\n      }\r\n      id = bindingList.currentId;\r\n    }\r\n    return id;\r\n  }\r\n}\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, DataPropInfo, DataTypeInfo, Entity, FrameContext, NgFormControl, Repository } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class FormService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private appContext: AppContext,\r\n    private repository: Repository<Entity>\r\n  ) {\r\n  }\r\n  /**\r\n   * æ ¹æ®å­æ®µè·¯å¾è·åè¯¥å­æ®µå¨å¡çæè¡¨æ ¼ä¸­çç´¢å¼\r\n   * @param source ngFormControlsæany[][]\r\n   * @param propertyPath å­æ®µé¤bindingPathä¹å¤çå®æ´è·¯å¾\r\n   * @returns \r\n   */\r\n  public getIndex(source: { [propertyName: string]: NgFormControl } | any[], propertyPath: string) {\r\n    if (Array.isArray(source)) {\r\n      const combine: any[] = source.reduce((result: any[], group: any[]) => {\r\n        return result.concat(group);\r\n      }, []);\r\n      return combine.findIndex((item: any) => item.field === propertyPath);\r\n    } else if (Object.prototype.toString.call(source) === '[object Object]') {\r\n      return Object.keys(source).findIndex(key => source[key].binding === propertyPath);\r\n    }\r\n  }\r\n  \r\n}","import { Injectable } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class ViewModelService {\r\n  constructor() { }\r\n  public getGridColumns(frameContext: FrameContext): any[] {\r\n    const dataGridColumnsName = frameContext && frameContext.viewModel && frameContext.viewModel['dataGridColumnsName'] || null;\r\n    return dataGridColumnsName && frameContext.viewModel[dataGridColumnsName] || [];\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { DataPropGroup, FrameContext } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class PaginationService {\r\n  constructor(private injector: Injector, private frameContext: FrameContext) { }\r\n  /**\r\n   * éç½®å­è¡¨åé¡µä¿¡æ¯\r\n   */\r\n  public resetChildrenPagination() {\r\n    const paginationInfo = this.frameContext.repository.entityCollection.paginationInfo || {};\r\n    const childrenEntityCodes = this.frameContext.repository.entityTypeInfo.getPropNamesByGroup(DataPropGroup.List) || [];\r\n    if (paginationInfo && Object.keys(paginationInfo).length > 0) {\r\n      const keys = Object.keys(paginationInfo);\r\n      keys.forEach((key: string) => {\r\n        const value = paginationInfo[key];\r\n        if (Object.prototype.toString.apply(value) !== '[object Object]') {\r\n          return;\r\n        }\r\n        const rowPagination = childrenEntityCodes.find((nodeCode: string) => {\r\n          // å»æs\r\n          nodeCode = nodeCode.slice(0, -1);\r\n          return key.startsWith(`${nodeCode}_`);\r\n        });\r\n        if (rowPagination) {\r\n          delete paginationInfo[key];\r\n        } else {\r\n          paginationInfo[key].pageIndex = 1;\r\n          delete paginationInfo[key].total;\r\n          delete paginationInfo[key].pageCount;\r\n        }\r\n      });\r\n      this.frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);\r\n    }\r\n  }\r\n}","import { Provider } from '@angular/core';\r\n\r\nimport { UIStateService } from '../ui-state.service';\r\nimport { StateMachineService } from '../state-machine.service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { BindingDataService } from '../binding-data.service';\r\nimport { CommandService } from '../command-service';\r\nimport { NavigationMiddlewareService } from '../navigation-middleware.service';\r\nimport { GridMiddlewareService } from '../grid.middleware.service';\r\nimport { BeActionService } from '../be-action.service';\r\nimport { ApproveService } from '../approve.service';\r\nimport { PrintService } from '../print.service';\r\nimport { AttachmentDataService, AttachmentService, FileService } from '../attachment/index';\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityListService, EntityService\r\n} from '../entity-services/index';\r\nimport { SidebarService } from '../sidebar-service';\r\nimport { ChangeItemService } from '../change-item.service';\r\n\r\nimport {\r\n  ListDataService, CardDataService, SubListDataService, TreeDataService,\r\n  RemoveDataService, SaveDataService, EditDataService, SubTreeDataService\r\n} from '../data-services/index';\r\n\r\nimport { FarrisFormService } from '../farris-form.service';\r\nimport { DialogService } from '../dialog.service';\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { RouterService } from '../router.service';\r\nimport { AuthorityService } from '../authority/authority.service';\r\n\r\nimport { QuerySolutionService } from '../query-solution/query-solution.service';\r\nimport { QUERYSOLUTION_HANDLER_TOKEN } from '@gsp-cmp/querysolution';\r\nimport { FilterConditionDataService } from '../data-services/filter-condition-data.service';\r\nimport { FocusInvalidService } from '../focus-invalid.service';\r\nimport { EndEditService } from '../end-edit.service';\r\nimport { RemoteSummaryService } from '../remote-summary.service';\r\nimport { BatchEditService } from '../batch-edit.service';\r\nimport { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';\r\nimport { FeatureEditorService } from '@farris/ui-feature-editor';\r\nimport { DiscussionGroupService } from '../discussion-group.service';\r\nimport { ListFilterConditionsService } from '../list-filter/list-filter.service';\r\nimport { LISTFILTER_HANDLER_TOKEN } from '@farris/ui-list-filter';\r\nimport { FORM_MANIFEST_SERVICE_TOKEN, FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, MESSAGE_SERVICE_TOKEN, NOTIFY_SERVICE_TOKEN, FRAME_COMPONENT_INIT_HANDLER_TOKEN } from '@farris/devkit';\r\nimport { FormManifestService, FormExpressionManifestService } from '../manifest/index';\r\nimport { LocalizationService } from '../localization.service';\r\nimport { DataGridService } from '../data-grid.service';\r\nimport { FormAttentionService } from '../form-attention.service';\r\nimport { FeatureDataService, FeatureEditService } from '../feature-edit/index';\r\nimport { ExpressionService } from '../expression_service';\r\nimport { DirtyCheckingService } from '../dirty-checking.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { PopUpService } from '../pop_up.service';\r\nimport { WorkFlowMessageHandler } from '../work-flow/index';\r\nimport { FormService } from '../form.service';\r\nimport { FormControlService } from '../form-control.service';\r\nimport { BindingPathService } from '../binding-path.service';\r\nimport { FrameContextService } from '../frame-context.service';\r\nimport { ViewModelService } from '../view-model.service';\r\nimport { PaginationService } from '../pagination.service';\r\n/**\r\n * ç»ä»¶çº§æ³¨å¥æ³¨å¥(å±23ä¸ª)\r\n */\r\nconst FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS: Provider[] = [\r\n  ValidationService,\r\n  FocusInvalidService,\r\n  ChangeItemService,\r\n  UIStateService,\r\n  StateMachineService,\r\n  BindingDataService,\r\n  CommandService,\r\n\r\n  // entity-services\r\n  EntityTraversingService,\r\n  EntityManipulationService,\r\n  EntityAggregationService,\r\n  EntityListService,\r\n  EntityService,\r\n\r\n  // data-services\r\n  ListDataService,\r\n  TreeDataService,\r\n  SubTreeDataService,\r\n  CardDataService,\r\n  SubListDataService,\r\n  RemoveDataService,\r\n  SaveDataService,\r\n  EditDataService,\r\n  FilterConditionDataService,\r\n  RemoteSummaryService,\r\n\r\n  BeActionService,\r\n  ApproveService,\r\n  PrintService,\r\n  AttachmentDataService,\r\n  AttachmentService,\r\n  FileService,\r\n  NavigationMiddlewareService,\r\n  GridMiddlewareService,\r\n  SidebarService,\r\n  FarrisFormService,\r\n  DialogService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  RouterService,\r\n  AuthorityService,\r\n  {\r\n    provide: QUERYSOLUTION_HANDLER_TOKEN,\r\n    useClass: QuerySolutionService\r\n  },\r\n  {\r\n    provide: LISTFILTER_HANDLER_TOKEN,\r\n    useClass: ListFilterConditionsService\r\n  },\r\n  EndEditService,\r\n  BatchEditDialogService,\r\n  BatchEditService,\r\n  DiscussionGroupService,\r\n  LocalizationService,\r\n  DataGridService,\r\n  FormAttentionService,\r\n  FeatureEditorService,\r\n  FeatureDataService,\r\n  FeatureEditService,\r\n  ExpressionService,\r\n  PopUpService,\r\n  DirtyCheckingService,\r\n  FormService,\r\n  FormControlService,\r\n  BindingPathService,\r\n  FrameContextService,\r\n  ViewModelService,\r\n  PaginationService,\r\n  // è¡¨è¾¾å¼\r\n  { provide: FORM_MANIFEST_SERVICE_TOKEN, useClass: FormManifestService },\r\n  { provide: FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, useClass: FormExpressionManifestService },\r\n  { provide: MESSAGE_SERVICE_TOKEN, useClass: FormMessageService },\r\n  { provide: NOTIFY_SERVICE_TOKEN, useClass: FormNotifyService },\r\n  { provide: FRAME_COMPONENT_INIT_HANDLER_TOKEN, useClass: WorkFlowMessageHandler, multi: true }\r\n];\r\n\r\nexport { FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS };\r\n","import { Provider } from '@angular/core';\r\n\r\nimport { RouterService } from '../router.service';\r\nimport { UIStateService } from '../ui-state.service';\r\nimport { StateMachineService } from '../state-machine.service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { BindingDataService } from '../binding-data.service';\r\nimport { CommandService } from '../command-service';\r\n\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { NavigationMiddlewareService } from '../navigation-middleware.service';\r\nimport { GridMiddlewareService } from '../grid.middleware.service';\r\n\r\nimport { BeActionService } from '../be-action.service';\r\nimport { ApproveService } from '../approve.service';\r\nimport { PrintService } from '../print.service';\r\nimport { AttachmentDataService, AttachmentService, FileService } from '../attachment/index';\r\nimport {\r\n    EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n    EntityListService, EntityService\r\n} from '../entity-services/index';\r\nimport { DialogService } from '../dialog.service';\r\nimport { SidebarService } from '../sidebar-service';\r\nimport { FarrisFormService } from '../farris-form.service';\r\nimport { ChangeItemService } from '../change-item.service';\r\n\r\n// data-services\r\nimport { ListDataService } from '../data-services/list-data.service';\r\nimport { TreeDataService } from '../data-services/tree-data.service';\r\nimport { CardDataService } from '../data-services/card-data.service';\r\nimport { SubListDataService } from '../data-services/sub-list-data.service';\r\nimport { FocusInvalidService } from '../focus-invalid.service';\r\nimport { SubTreeDataService } from '../data-services/sub-tree-data-service';\r\nimport { RemoveDataService } from '../data-services/remove-data.service';\r\nimport { SaveDataService } from '../data-services/save-data.service';\r\nimport { EditDataService } from '../data-services/edit-data.service';\r\nimport { FilterConditionDataService } from '../data-services/filter-condition-data.service';\r\nimport { RemoteSummaryService } from '../remote-summary.service';\r\nimport { AuthorityService } from '../authority/authority.service';\r\nimport { EndEditService } from '../end-edit.service';\r\nimport { BatchEditService } from '../batch-edit.service';\r\nimport { DiscussionGroupService } from '../discussion-group.service';\r\nimport { LocalizationService } from '../localization.service';\r\nimport { DataGridService } from '../data-grid.service';\r\nimport { FormAttentionService } from '../form-attention.service';\r\nimport { FormManifestService } from '../manifest/form_manifest_service';\r\nimport { FormExpressionManifestService } from '../manifest/form_expression_manifest_service';\r\nimport { ListFilterConditionsService } from '../list-filter/list-filter.service';\r\nimport { QuerySolutionService } from '../query-solution/query-solution.service';\r\nimport { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';\r\nimport { FORM_MANIFEST_SERVICE_TOKEN, FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN } from '@farris/devkit';\r\nimport { QUERYSOLUTION_HANDLER_TOKEN } from '@gsp-cmp/querysolution';\r\nimport { LISTFILTER_HANDLER_TOKEN } from '@farris/ui-list-filter';\r\n\r\n/**\r\n * ç»ä»¶çº§æ³¨å¥æ³¨å¥(å±23ä¸ª)\r\n */\r\nconst DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS: Provider[] = [\r\n    { provide: 'ValidationService', useClass: ValidationService },\r\n    { provide: 'FocusInvalidService', useClass: FocusInvalidService },\r\n    { provide: 'ChangeItemService', useClass: ChangeItemService },\r\n    { provide: 'UIStateService', useClass: UIStateService },\r\n    { provide: 'StateMachineService', useClass: StateMachineService },\r\n    { provide: 'BindingDataService', useClass: BindingDataService },\r\n    { provide: 'CommandService', useClass: CommandService },\r\n\r\n    // entity-services\r\n    { provide: 'EntityTraversingService', useClass: EntityTraversingService },\r\n    { provide: 'EntityManipulationService', useClass: EntityManipulationService },\r\n    { provide: 'EntityAggregationService', useClass: EntityAggregationService },\r\n    { provide: 'EntityListService', useClass: EntityListService },\r\n    { provide: 'EntityService', useClass: EntityService },\r\n\r\n    // data-services\r\n    { provide: 'ListDataService', useClass: ListDataService },\r\n    { provide: 'TreeDataService', useClass: TreeDataService },\r\n    { provide: 'SubTreeDataService', useClass: SubTreeDataService },\r\n    { provide: 'CardDataService', useClass: CardDataService },\r\n    { provide: 'SubListDataService', useClass: SubListDataService },\r\n    { provide: 'RemoveDataService', useClass: RemoveDataService },\r\n    { provide: 'SaveDataService', useClass: SaveDataService },\r\n    { provide: 'EditDataService', useClass: EditDataService },\r\n    { provide: 'FilterConditionDataService', useClass: FilterConditionDataService },\r\n    { provide: 'RemoteSummaryService', useClass: RemoteSummaryService },\r\n\r\n    { provide: 'BeActionService', useClass: BeActionService },\r\n    { provide: 'ApproveService', useClass: ApproveService },\r\n    { provide: 'PrintService', useClass: PrintService },\r\n    { provide: 'AttachmentDataService', useClass: AttachmentDataService },\r\n    { provide: 'AttachmentService', useClass: AttachmentService },\r\n    { provide: 'FileService', useClass: FileService },\r\n    { provide: 'NavigationMiddlewareService', useClass: NavigationMiddlewareService },\r\n    { provide: 'GridMiddlewareService', useClass: GridMiddlewareService },\r\n    { provide: 'SidebarService', useClass: SidebarService },\r\n    { provide: 'FarrisFormService', useClass: FarrisFormService },\r\n    { provide: 'DialogService', useClass: DialogService },\r\n    { provide: 'NavigationEventService', useClass: NavigationEventService },\r\n    { provide: 'NavigationService', useClass: NavigationService },\r\n    { provide: 'RouterService', useClass: RouterService },\r\n    { provide: 'AuthorityService', useClass: AuthorityService },\r\n    {\r\n        provide: QUERYSOLUTION_HANDLER_TOKEN,\r\n        useClass: QuerySolutionService\r\n    },\r\n    {\r\n        provide: LISTFILTER_HANDLER_TOKEN,\r\n        useClass: ListFilterConditionsService\r\n    },\r\n    { provide: 'EndEditService', useClass: EndEditService },\r\n    { provide: 'BatchEditDialogService', useClass: BatchEditDialogService },\r\n    { provide: 'BatchEditService', useClass: BatchEditService },\r\n    { provide: 'DiscussionGroupService', useClass: DiscussionGroupService },\r\n    { provide: 'LocalizationService', useClass: LocalizationService },\r\n    { provide: 'DataGridService', useClass: DataGridService },\r\n    { provide: 'FormAttentionService', useClass: FormAttentionService },\r\n    // è¡¨è¾¾å¼\r\n    { provide: FORM_MANIFEST_SERVICE_TOKEN, useClass: FormManifestService },\r\n    { provide: FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, useClass: FormExpressionManifestService }\r\n];\r\n\r\n\r\nexport { DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS };\r\n","import { NgModule } from '@angular/core';\r\nimport { FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS } from './providers/index';\r\nimport { WfTaskHandlerModule } from '@gsp-wf/wf-task-handler';\r\nimport { WorkFlowMessage } from './work-flow/index';\r\n\r\n@NgModule({\r\n  providers: FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS,\r\n  imports: [\r\n    WfTaskHandlerModule\r\n  ],\r\n  exports: [\r\n    WfTaskHandlerModule\r\n  ]\r\n})\r\nclass CommandServicesModule {\r\n  constructor(private workFlowMessage: WorkFlowMessage) {\r\n    if (this.workFlowMessage) {\r\n      this.workFlowMessage.setup();\r\n    }\r\n  }\r\n}\r\n\r\nexport { CommandServicesModule };\r\n","import { RuntimeFrameworkService } from '../rtf-service';\r\nimport { UID } from '@farris/devkit';\r\n\r\nexport class MessagePipe {\r\n    constructor(public token: string, private rtfService: RuntimeFrameworkService) { }\r\n    /**\r\n     * åç®¡éåéæ¶æ¯\r\n     * @param message æ¶æ¯\r\n     */\r\n    public sendMessage(message: any) {\r\n        this.rtfService.subjectNotify(this.token, message);\r\n        return this;\r\n    }\r\n    /**\r\n     * çå¬ç®¡éæ¶æ¯\r\n     * @param handler æ¶æ¯å¤çå¨\r\n     */\r\n    public listen(handler: (data: any) => void): () => void {\r\n        const observerToken = UID.create();\r\n        this.rtfService.subjectResponse(this.token, handler, observerToken);\r\n        const unListen = () => {\r\n            this.rtfService.responseUnSubscribe(this.token, observerToken);\r\n        };\r\n        return unListen;\r\n    }\r\n    /**\r\n     * éæ¯ç®¡é\r\n     */\r\n    public destory() {\r\n        this.rtfService.subjectRemove(this.token);\r\n    }\r\n}\r\n","import { MessagePipe } from './message-pipe';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { Subject } from 'rxjs';\r\nimport { QuerystringService } from '../querystring';\r\n\r\nexport class MessagePipeService {\r\n  private static rtfService: RuntimeFrameworkService = new RuntimeFrameworkService();\r\n  private static querystringService: QuerystringService = new QuerystringService();\r\n  /**\r\n   * éè¿tokenè·åæ¶æ¯ç®¡é\r\n   * @param token æ¶æ¯ç®¡éæ è¯\r\n   */\r\n  public static get(token: string): MessagePipe {\r\n    const pipe = new MessagePipe(token, this.rtfService);\r\n    return pipe;\r\n  }\r\n  /**\r\n   * åå»ºæ¶æ¯ç®¡é\r\n   * @param pipeName ç®¡éåç§°\r\n   * @param useFormContext æ¯å¦ä½¿ç¨è¡¨åä¸ä¸æåå»ºç®¡éæ è¯\r\n   * @param pipeType ç®¡éç±»å(å¯é)ï¼é»è®¤Subject<any>\r\n   */\r\n  public static create(pipeName: string, useFormContext: boolean, pipeType?: Subject<any>): MessagePipe {\r\n    let options = null;\r\n    if (useFormContext) {\r\n      const params = this.querystringService.parse(window.location.hash);\r\n      const { funcId, appId, appEntrance } = params;\r\n      options = { funcId, appId, appEntrance };\r\n    }\r\n    const token = this.rtfService.subjectRegister(pipeName, options, pipeType);\r\n    if (!token) {\r\n      return null;\r\n    }\r\n    const pipe = new MessagePipe(token, this.rtfService);\r\n    return pipe;\r\n  }\r\n}\r\n","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { AppContext, BackEndMessage, BindingList, DataPropInfo, EventBus, FrameComponent, FrameContext, NgFormControl, Translate, TranslateToken } from '@farris/devkit';\r\n/**\r\n * åç«¯æ¶æ¯å¤çæå¡\r\n * @description\r\n * ### æå¡æ³¨å¥ä½ç½®\r\n *  1ãæ´ä¸ªè¡¨åçroot-component \r\n *  2ãå¼¹åºçªå£çroot-component \r\n */\r\n@Injectable()\r\nexport class BackEndMessageHandler implements BackEndMessage.IBackEndMessageHandler {\r\n  constructor(private injector: Injector, private frameContext: FrameContext, @Inject(TranslateToken) private translate: Translate) { }\r\n  /**\r\n   * å¤çåç«¯è¿åçæ¶æ¯æéè¯¯\r\n   * @param message æ¶æ¯æéè¯¯\r\n   */\r\n  public handle(message: BackEndMessage.IMessage, context: any) {\r\n    const isException = context && context.isException || false;\r\n    const hasThrowError = context && context.hasThrowError || false;\r\n    const eventBus = context && context.eventBus || null;\r\n    const error = context && context.error || null;\r\n    const formAppContext = context && context.formAppContext || null;\r\n    const result = this.collect(message, isException, hasThrowError, eventBus, error, formAppContext);\r\n    if (result && result.form && result.form.length > 0) {\r\n      result.form.forEach((item: { frameContext: FrameContext, message: any }) => {\r\n        item.frameContext.viewModel.form.updateFormErrors(item.message, true, 'backend');\r\n      });\r\n    } else {\r\n      this.resetFormMessage(message.context.appContext, message.context.ns);\r\n    }\r\n    const targetFrameContext: FrameContext = this.findTargetFrameContext(this.frameContext);\r\n    if (result && result.all && result.all.length > 0) {\r\n      targetFrameContext.viewModel.verifycationChanged.next(result.all);\r\n    } else {\r\n      if (result !== null) {\r\n        targetFrameContext.viewModel.verifycationChanged.next([]);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æ¶éæ±æ»ä¿¡æ¯åformä¿¡æ¯\r\n   * @param backEndMessage \r\n   */\r\n  private collect(backEndMessage: BackEndMessage.IMessage, isException: boolean = false, hasThrowError: boolean = false, eventBus: EventBus = null, error: any = null, formAppContext: AppContext = null): { form: { frameContext: FrameContext, message: any }[], all: any[] } {\r\n    const bizMessages = backEndMessage && backEndMessage.bizMessages || null;\r\n    const appContext = backEndMessage && backEndMessage.context.appContext;\r\n    const ns = backEndMessage.context.ns;\r\n    if (!bizMessages || bizMessages.length < 1) {\r\n      return null;\r\n    }\r\n    const result = {\r\n      form: [],\r\n      all: []\r\n    };\r\n    let hasFormlessError = false;\r\n    for (let bizMessage of bizMessages) {\r\n      const message = bizMessage.message;\r\n      const location = bizMessage.location || null;\r\n      const columns = location && location.columns || null;\r\n      const nodeCode = location && location.nodeCode || null;\r\n      const rows = location && location.rows;\r\n      const bindingPath = this.getBindingPath(appContext, ns, nodeCode);\r\n      const bindingPaths = bindingPath && bindingPath.split('/').filter(p => p);\r\n\r\n      // ç®åä»å¤çælocationï¼ä¸æidãååãè¡¨åçã\r\n      if (!location || !columns || columns.length < 1 || !nodeCode || !rows || rows.length < 1) {\r\n        continue;\r\n      }\r\n      // éåæ°æ®è¡\r\n      for (let row of rows) {\r\n        for (let column of columns) {\r\n          // è·åå°ææç»å®è¯¥åæ°æ®çframeContext\r\n          let frameContexts = this.getFrameContextsByBindingPathAndColumnName(appContext, ns, bindingPath, column);\r\n          if (!frameContexts || frameContexts.length < 1) {\r\n            // æ²¡æä»»ä½ä¸ä¸ªç»ä»¶ç»å®è¯¥åçæ°æ®\r\n            hasFormlessError = true;\r\n            continue;\r\n          }\r\n          // æé¤æåªè¯»datagrid\r\n          frameContexts = frameContexts.filter((frameContext: FrameContext) => {\r\n            const isDataGridComponent = this.isDataGridComponent(frameContext.frameComponent);\r\n            if (isDataGridComponent) {\r\n              const isReadonlyDataGrid = this.isReadonlyDataGrid(frameContext.frameComponent);\r\n              if (isReadonlyDataGrid) {\r\n                return false;\r\n              } else {\r\n                return true;\r\n              }\r\n            }\r\n            return true;\r\n          });\r\n          // éåçè¡æ¯å¦ä¸ºå½åè¡\r\n          const isCurrentRow = this.isCurrentRow(appContext, ns, bindingPath, row);\r\n          // å¦ææ¯å½åè¡çè¯éè¦å°éè¯¯ä¿¡æ¯æ¾å°formä¸­\r\n          if (isCurrentRow) {\r\n            // å¿½ç¥grid\r\n            // const formFrameContexts = frameContexts.filter(frameContext => !this.isGridComponent(frameContext.frameComponent));\r\n            if (frameContexts && frameContexts.length > 0) {\r\n              frameContexts.forEach((frameContext: FrameContext) => {\r\n                // åªå¤çäºä¸ä¸ªç»ä»¶ä¸­ååªç»å®å°ä¸ä¸ªåç«¯æ§ä»¶çåºæ¯\r\n                const formControls = this.getFormControlByColumnName(frameContext, column);\r\n                if (formControls && formControls.length > 0) {\r\n                  formControls.forEach(([domPropertyName, formControl]) => {\r\n                    //const domPropertyName = formControl && formControl. || null;\r\n                    this.mergeMessage(result.form, frameContext, domPropertyName, message);\r\n                  });\r\n                }\r\n\r\n                //if (formControl && domPropertyName) {\r\n\r\n                //}\r\n              });\r\n            } else {\r\n            }\r\n          }\r\n          // å°éè¯¯ä¿¡æ¯æ¾å°æ±æ»ä¸­\r\n          frameContexts.forEach((frameContext: FrameContext) => {\r\n            const viewModelName = frameContext.viewModel.form.formGroupName;\r\n            const formControls = this.getFormControlByColumnName(frameContext, column);\r\n            if (formControls && formControls.length > 0) {\r\n              const [domPropertyName, formControl] = formControls.find(([propertyName, formControl]) => propertyName && propertyName.length > 0);\r\n              // const domPropertyName = domProperty && domProperty.propertyName;\r\n              const bindingList = frameContext.viewModel.bindingData.getValue(bindingPaths) as BindingList;\r\n              let index = bindingList.getIndexById(row);\r\n              const primary = `${row}_${column}_${message}`;\r\n              // TODO:è½ç¶è½çº æ­£æ±æ»æ¶æ¯æ¾ç¤ºéå¤çé®é¢ï¼ä½å¯è½å¯¼è´ç¹å»éè¯¯æ æ³å®ä½å°å¯¹åºæ§ä»¶çé®é¢ï¼å¾åç»­ä¼å\r\n              if (index >= 0 && result.all.findIndex(p => p.id === primary) === -1) {\r\n                // æ°æ®æºä¸­æå¤äº1è¡æ¶æ¾ç¤ºç´¢å¼\r\n                const position = (bindingList && bindingList.length > 1) ? (index + 1) : -1;\r\n                const title = this.buildItemTitle(viewModelName, formControl.name || formControl.defaultI18nValue || domPropertyName, position);\r\n                const item = {\r\n                  id: primary,\r\n                  index,\r\n                  targetField: formControl.id,\r\n                  title,\r\n                  msg: message,\r\n                  namespace: ns,\r\n                  bindingPath,\r\n                  type: 'error'\r\n                };\r\n                result.all.push(item);\r\n              }\r\n            }\r\n\r\n          });\r\n        }\r\n      }\r\n    }\r\n    if (hasFormlessError && isException && !hasThrowError && eventBus) {\r\n      eventBus.post('Exception', '', 'onException', error, formAppContext);\r\n    }\r\n    return result;\r\n  }\r\n  private mergeMessage(formItems: { frameContext: FrameContext, message: { [domPropertyName: string]: { errors: { [messageType: string]: { name: string } } } } }[], frameContext: FrameContext, domPropertyName: string, message: string) {\r\n    const targetItem = formItems.find(item => item.frameContext.frameId === frameContext.frameId);\r\n    if (targetItem) {\r\n      const isPropertyExist = targetItem.message && Object.keys(targetItem.message).includes(domPropertyName);\r\n      const messageType = `backend-message-${Object.keys(targetItem.message).length + 1}`;\r\n      if (isPropertyExist) {\r\n        targetItem.message[domPropertyName]['errors'][messageType] = { name: message };\r\n      } else {\r\n        targetItem.message[domPropertyName] = { errors: { [messageType]: { name: message } } };\r\n      }\r\n    } else {\r\n      formItems.push({\r\n        frameContext: frameContext,\r\n        message: {\r\n          [domPropertyName]: {\r\n            errors: {\r\n              'backend-message-1': { name: message }\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  private buildItemTitle(viewModelName: string, propertyName: string, index: any) {\r\n    const template = {\r\n      'zh-CHS': {\r\n        viewModelName: `$viewModel`,\r\n        index: `ç¬¬ $index è¡`,\r\n        propertyName: `- $propertyName`\r\n      },\r\n      'en': {\r\n        viewModelName: `$viewModel`,\r\n        index: `row $index`,\r\n        propertyName: `- $propertyName`\r\n      },\r\n      'zh-CHT': {\r\n        viewModelName: `$viewModel`,\r\n        index: `ç¬¬ $index è¡`,\r\n        propertyName: `- $propertyName`\r\n      }\r\n    };\r\n    const currentLanguage = this.translate.getCurrentLanguage() || 'zh-CHS';\r\n    const message = [];\r\n    if (viewModelName) {\r\n      message.push(template[currentLanguage]['viewModelName'].replace('$viewModel', viewModelName));\r\n    }\r\n    if (index > 0) {\r\n      message.push(template[currentLanguage]['index'].replace('$index', index));\r\n    }\r\n    if (propertyName) {\r\n      message.push(template[currentLanguage]['propertyName'].replace('$propertyName', propertyName));\r\n    }\r\n    return message.join(' ');\r\n  }\r\n  /**\r\n   * æ ¹æ®è¡¨åænodeCodeè·åç»å®è·¯å¾\r\n   * @param appContext appContext\r\n   * @param ns ns\r\n   * @param nodeCode è¡¨å\r\n   */\r\n  private getBindingPath(appContext: AppContext, ns: string, nodeCode: string) {\r\n    const frameContext = this.getFrameContext(appContext, ns);\r\n    return frameContext.repository.entityTypeInfo.getBindingPathByTableName(nodeCode);\r\n  }\r\n  /**\r\n   * éè¿ç»å®è·¯å¾åååæ¾å°ææç¬¦åæ¡ä»¶çè§å¾æ¨¡å(åæ¬gridåform)\r\n   * @param appContext appContext\r\n   * @param ns namespace\r\n   * @param bindingPath ç»å®è·¯å¾\r\n   * @param columnName åå\r\n   */\r\n  private getFrameContextsByBindingPathAndColumnName(appContext: AppContext, ns: string, bindingPath: string, columnName: string): FrameContext[] {\r\n    let frameContexts = appContext.frameContextManager.getFrameContexts();\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      // æ¾å°formä¸­ææ§ä»¶çframeContext\r\n      frameContexts = frameContexts.filter((frameContext: FrameContext) => {\r\n        // åºæ¬æ¡ä»¶æ¯å¦æ»¡è¶³\r\n        let isValidFrameContext = frameContext.namespace === ns && frameContext.viewModel.bindingPath === bindingPath && frameContext.viewModel.form && frameContext.viewModel.form.controls && Object.keys(frameContext.viewModel.form.controls).length > 0;\r\n        if (!isValidFrameContext) {\r\n          return false;\r\n        }\r\n        // åéè¿ååè¿æ»¤\r\n        const bindingPaths = bindingPath.split('/').filter(p => p);\r\n        const dataTypeInfo = frameContext.repository.entityTypeInfo.getTypeInfoByPath(bindingPaths);\r\n        if (dataTypeInfo) {\r\n          const dataPropInfos = Array.from(dataTypeInfo.propInfoMap.values());\r\n          // ä»å½åå®ä½å±æ§ä¸­æ¾å°æ°æ®å­æ®µä¸ºååçå±æ§\r\n          const entityPropertyInfo = dataPropInfos.find((propInfo: DataPropInfo) => propInfo.metadataInfo && (propInfo.metadataInfo.originalDataField === columnName || propInfo.metadataInfo.dataField === columnName));\r\n          if (entityPropertyInfo) {\r\n            const entityPropertyName = entityPropertyInfo.name;\r\n            const ngFormControl = Object.values(frameContext.viewModel.form.ngFormControls).find(item => item.binding === entityPropertyName);\r\n            if (ngFormControl) {\r\n              return true;\r\n            } else {\r\n              const item = Object.keys(frameContext.viewModel.form.ngFormControls).find(key => key === entityPropertyName);\r\n              return item ? true : false;\r\n            }\r\n          } else {\r\n            return false;\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n      return frameContexts;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * æ¯å¦ä¸ºdatagridç»ä»¶\r\n   * @param frameComponent component\r\n   */\r\n  private isDataGridComponent(frameComponent: FrameComponent) {\r\n    const columnNames = frameComponent.context.viewModel['dataGridColumnsName'] || null;\r\n    return columnNames ? true : false;\r\n  }\r\n  /**\r\n   * gridç»ä»¶æ¯å¦æ¯åªè¯»ç\r\n   * @param frameComponent frameComponent\r\n   * @returns \r\n   */\r\n  private isReadonlyDataGrid(frameComponent: FrameComponent) {\r\n    const frameContext = frameComponent.context;\r\n    const dataGridColumnsName = frameContext.viewModel['dataGridColumnsName'] || null;\r\n    if (dataGridColumnsName) {\r\n      const datagridColumns: any[] = frameContext.viewModel[dataGridColumnsName];\r\n      return datagridColumns.every((group: Array<any>) => {\r\n        return group.every(item => !item.editor);\r\n      });\r\n    } else {\r\n      throw new Error(`ä¼ å¥çç»ä»¶ä¸æ¯ä¸ä¸ªè¡¨æ ¼ï¼`);\r\n    }\r\n  }\r\n  /**\r\n   * idæ¯å¦ä¸ºå½åè¡\r\n   * @param appContext appContext\r\n   * @param ns namespace\r\n   * @param bindingPath bindingPath\r\n   * @param id id\r\n   */\r\n  private isCurrentRow(appContext: AppContext, ns: string, bindingPath: string, id: string) {\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    const frameContext = this.getFrameContext(appContext, ns);\r\n    const bindingData = frameContext.bindingData;\r\n    const bindingList = bindingData.getValue(bindingPaths) as BindingList;\r\n    return bindingList.currentItem.primaryKeyValue === id;\r\n  }\r\n  /**\r\n   * è·åå½ånsä¸çrootFrameContext\r\n   * @param appContext appcontext\r\n   * @param ns namespace\r\n   */\r\n  private getFrameContext(appContext: AppContext, ns: string) {\r\n    const frameContexts = appContext.frameContextManager.getFrameContexts();\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      const randomFrameContext = frameContexts.find(frameContext => frameContext.namespace === ns);\r\n      if (randomFrameContext) {\r\n        const virtualRootFrameContext = randomFrameContext.getVirtualRootFrameContext();\r\n        return virtualRootFrameContext;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * éè¿ç»å®è·¯å¾åååè·åç»å®å°è¯¥åçformControl\r\n   */\r\n  private getFormControlByColumnName(frameContext: FrameContext, columnName: string): Array<[string, NgFormControl]> {\r\n    const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    // éè¿bindingPathæ¾å°å¯¹åºçå®ä½ä¿¡æ¯\r\n    const typeInfo = frameContext.repository.entityTypeInfo.getTypeInfoByPath(bindingPaths);\r\n\r\n    const propsInfo = Array.from(typeInfo.propInfoMap.values());\r\n    const propInfo = propsInfo.find((propInfo: DataPropInfo) => propInfo.metadataInfo && (propInfo.metadataInfo.originalDataField === columnName || propInfo.metadataInfo.dataField === columnName));\r\n    if (propInfo) {\r\n      const mappingName = propInfo.name;\r\n      const formControls: Array<[string, NgFormControl]> = Object.entries(frameContext.viewModel.form.ngFormControls).filter((item) => item[1].binding === mappingName || item[0] === mappingName);\r\n      // const ngFormControl = Object.values(frameContext.viewModel.form.ngFormControls).find(item => item.binding === mappingName);\r\n      if (formControls) {\r\n        return formControls;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  private resetFormMessage(appContext: AppContext, ns: string) {\r\n    const frameContexts = appContext.frameContextManager.getFrameContexts().filter(frameContext => frameContext.namespace === ns);\r\n    frameContexts.forEach(frameContext => frameContext && frameContext.viewModel && frameContext.viewModel.form && frameContext.viewModel.form.clearBackendError());\r\n  }\r\n  /**\r\n   * éå½æ¾å°å±ç¤ºæ¶æ¯çç»ä»¶ä¸ä¸æ\r\n   * @param frameContext frameContext\r\n   */\r\n  private findTargetFrameContext(frameContext: FrameContext): FrameContext {\r\n    const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n    const virtualRootComponent = virtualRootFrameContext.frameComponent;\r\n    const isDialogComponent = virtualRootComponent && virtualRootComponent['isDialogRootComponent'] || false;\r\n    if (isDialogComponent) {\r\n      // å¦ææ¶æ¯å¤çæå¡æ¯å¼¹çªåçï¼åæ¶æ¯æç¤ºå±ç¤ºå¨å¼¹çªå\r\n      return virtualRootFrameContext;\r\n    } else {\r\n      // å½åæ¶æ¯æå¡ä¸å¨å¼¹çªåï¼éå½åä¸æ¥æ¾ï¼æ¾å°ç¬¬ä¸ä¸ªå¼¹çªï¼å¦ææ¾ä¸å°åæ¾å°æä¸çroot-component\r\n      const parentFrameContext = virtualRootFrameContext.parent;\r\n      if (parentFrameContext) {\r\n        return this.findTargetFrameContext(parentFrameContext);\r\n      } else {\r\n        return virtualRootFrameContext;\r\n      }\r\n    }\r\n  }\r\n}","import { FormLoadingService } from './lib/form-loading/form-loading.service';\r\nimport { FormMessageService } from './lib/form-message.service';\r\nimport { HideEventService } from './lib/form-loading/hide-event.service';\r\nimport { FormNotifyService } from './lib/form-notify.service';\r\nimport { FormErrorService } from './lib/error/form-error.service';\r\nimport { FormWizardService } from './lib/form-wizard.service';\r\n\r\nimport { CheckService } from './lib/check.service';\r\nimport { DataCheckService } from './lib/data-check.service';\r\nimport { EventService } from './lib/event.service';\r\nimport { MenuStateService } from './lib/menu-state.service';\r\nimport { RouterService } from './lib/router.service';\r\nimport { LanguageService } from './lib/languag.service';\r\nimport { TAB_EVENT, TAB_QUERY_STRING, BodyWithRequestInfo } from './lib/types';\r\nimport { QuerystringService } from './lib/querystring';\r\nimport { RuntimeFrameworkService } from './lib/rtf-service';\r\nimport { NavigationEventService } from './lib/navigation-event.service';\r\nimport { NavigationService } from './lib/navigation.service';\r\nimport { NavigationMiddlewareService } from './lib/navigation-middleware.service';\r\nimport { GridMiddlewareService } from './lib/grid.middleware.service';\r\nimport { ParamService } from './lib/param.service';\r\nimport { KeybindingService } from './lib/keybinding-service';\r\nimport { FilterConditionService } from './lib/filter-condition.service';\r\n\r\nimport { UIStateService } from './lib/ui-state.service';\r\nimport { StateMachineService } from './lib/state-machine.service';\r\nimport { BindingDataService } from './lib/binding-data.service';\r\nimport { CommandService } from './lib/command-service';\r\nimport { ApplicationParamService } from './lib/application-param.service';\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityListService, EntityService\r\n} from './lib/entity-services/index';\r\nimport { ValidationService } from './lib/validation.service';\r\nimport { FocusInvalidService, FocusableInvalidationGrid } from './lib/focus-invalid.service';\r\nimport { ChangeItemService } from './lib/change-item.service';\r\n\r\n// data-services\r\nimport {\r\n  ListDataService, CardDataService, SubListDataService, TreeDataService,\r\n  RemoveDataService, SaveDataService, EditDataService, FilterConditionDataService, SubTreeDataService\r\n} from './lib/data-services/index';\r\n\r\nimport { BeActionService } from './lib/be-action.service';\r\nimport { ApproveService } from './lib/approve.service';\r\nimport { PrintService } from './lib/print.service';\r\nimport { AttachmentDataService, AttachmentService, FileService } from './lib/attachment/index';\r\nimport { DialogService } from './lib/dialog.service';\r\nimport { SidebarService } from './lib/sidebar-service';\r\nimport { FarrisFormService, FARRIS_FORM_COMPONENTS } from './lib/farris-form.service';\r\nimport { FilterService } from './lib/filter-service';\r\nimport { ComponentManagerService } from './lib/component-manager.service';\r\nimport { AuthorityService } from './lib/authority/authority.service';\r\nimport { Authority } from './lib/authority/authority';\r\n\r\n// exception_handler\r\nimport { ExceptionHandler } from './lib/exception.handler';\r\nimport {\r\n  FARRIS_COMMAND_SERVICE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS,\r\n  DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS\r\n} from './lib/providers/index';\r\nimport { CommandServicesModule } from './lib/command-services-module';\r\nimport { MessagePipeService, MessagePipe } from './lib/rtf-message/index';\r\nimport { EndEditService } from './lib/end-edit.service';\r\nimport { RemoteSummaryService } from './lib/remote-summary.service';\r\nimport { BatchEditService } from './lib/batch-edit.service';\r\nimport { DiscussionGroupService } from './lib/discussion-group.service';\r\nimport { FormManifestService, FormExpressionManifestService } from './lib/manifest/index';\r\nimport { UserSettingsService } from './lib/user-settings.service';\r\nimport { LocalizationService } from './lib/localization.service';\r\nimport { DataGridService } from './lib/data-grid.service';\r\nimport { BackEndMessageHandler } from './lib/back_end_message_handler';\r\nimport { FormAttentionService } from './lib/form-attention.service';\r\nimport { FormNotifyStrategyService } from './lib/form-notify-strategy.service';\r\nimport { FeatureDataService, FeatureEditService, FeatureRepository } from './lib/feature-edit/index';\r\nimport { ExpressionService } from './lib/expression_service';\r\nimport { DirtyCheckingService } from './lib/dirty-checking.service';\r\nimport { PopUpService } from './lib/pop_up.service';\r\nimport { WorkFlowMessage, WorkFlowMessageService, WorkFlowMessageHandler, WorkFlow } from './lib/work-flow/index';\r\nimport { FormControlService } from './lib/form-control.service';\r\nimport { BindingPathService } from './lib/binding-path.service';\r\nimport { FrameContextService } from './lib/frame-context.service';\r\nimport { ViewModelService } from './lib/view-model.service';\r\nimport { FormService } from './lib/form.service';\r\nimport { PaginationService } from './lib/pagination.service';\r\n\r\nexport {\r\n  FormLoadingService,\r\n  FormMessageService,\r\n  HideEventService,\r\n  FormNotifyService,\r\n  FormErrorService,\r\n  FormWizardService,\r\n  CheckService,\r\n  DataCheckService,\r\n  EventService,\r\n  MenuStateService,\r\n  RouterService,\r\n  LanguageService,\r\n  TAB_EVENT,\r\n  TAB_QUERY_STRING,\r\n  BodyWithRequestInfo,\r\n  QuerystringService,\r\n  RuntimeFrameworkService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  NavigationMiddlewareService,\r\n  GridMiddlewareService,\r\n  ParamService,\r\n  FilterConditionService,\r\n  FilterConditionDataService,\r\n\r\n  // devkit\r\n  UIStateService,\r\n  StateMachineService,\r\n  BindingDataService,\r\n  CommandService,\r\n  ValidationService,\r\n  FocusInvalidService,\r\n  FocusableInvalidationGrid,\r\n  ApplicationParamService,\r\n  ChangeItemService,\r\n\r\n  // entity-services\r\n  EntityTraversingService,\r\n  EntityManipulationService,\r\n  EntityAggregationService,\r\n  EntityListService,\r\n  EntityService,\r\n\r\n  // data-services\r\n  ListDataService,\r\n  CardDataService,\r\n  SubListDataService,\r\n  TreeDataService,\r\n  RemoveDataService,\r\n  SaveDataService,\r\n  EditDataService,\r\n  RemoteSummaryService,\r\n  SubTreeDataService,\r\n  BeActionService,\r\n  ApproveService,\r\n  PrintService,\r\n  AttachmentDataService,\r\n  AttachmentService,\r\n  FileService,\r\n  DialogService,\r\n  SidebarService,\r\n  FilterService,\r\n  AuthorityService,\r\n  Authority,\r\n\r\n  FarrisFormService,\r\n  FARRIS_FORM_COMPONENTS,\r\n  ExceptionHandler,\r\n  KeybindingService,\r\n\r\n  FARRIS_COMMAND_SERVICE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS,\r\n  DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS,\r\n  CommandServicesModule,\r\n  ComponentManagerService,\r\n  MessagePipeService,\r\n  MessagePipe,\r\n  EndEditService,\r\n  BatchEditService,\r\n  DiscussionGroupService,\r\n  FormManifestService,\r\n  FormExpressionManifestService,\r\n  UserSettingsService,\r\n  LocalizationService,\r\n  DataGridService,\r\n  BackEndMessageHandler,\r\n  FormAttentionService,\r\n  FormNotifyStrategyService,\r\n  FeatureDataService,\r\n  FeatureEditService,\r\n  FeatureRepository,\r\n  ExpressionService,\r\n  PopUpService,\r\n  DirtyCheckingService,\r\n  WorkFlowMessage,\r\n  WorkFlowMessageService,\r\n  WorkFlowMessageHandler,\r\n  WorkFlow,\r\n  FormControlService,\r\n  BindingPathService,\r\n  FrameContextService,\r\n  ViewModelService,\r\n  FormService,\r\n  PaginationService\r\n};\r\n\r\n// export * from './public-api-common';\r\n// export * from './public-api-extend';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {BaseDataService as Éµa} from './lib/data-services/base-data.service';\nexport {ListFilterConditionsService as Éµc} from './lib/list-filter/list-filter.service';\nexport {QuerySolutionService as Éµb} from './lib/query-solution/query-solution.service';\nexport {Service as Éµd} from './lib/service';"],"names":["map","of","empty","filter","Mousetrap.default","BindingList","FARRIS_FORM_COMPONENTS","format"],"mappings":"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"}

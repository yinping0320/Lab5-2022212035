import { Injectable } from "@angular/core";
export class WorkFlowMessageService {
    constructor() {
        this.messageHandler = (callback) => {
            return (event) => {
                var message = event.data;
                if (message) {
                    message.sender = event.source;
                }
                if (typeof callback === 'function') {
                    callback(message);
                }
            };
        };
    }
    /**
     * 监听工作流消息
     * @param callback 回调
     */
    listen(callback) {
        this.handler = this.messageHandler(callback);
        window.addEventListener('message', this.handler);
    }
    destroy() {
        if (this.handler) {
            window.removeEventListener('message', this.handler);
        }
    }
    /**
     * 给工作流表单发送消息
     * @param message
     */
    send(message) {
        if (!message) {
            return;
        }
        let win = window;
        if (message.target) {
            win = message.target || window;
            delete message.target;
        }
        if (win) {
            win.postMessage(message, '*');
        }
    }
}
WorkFlowMessageService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
WorkFlowMessageService.ctorParameters = () => [];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29yay1mbG93LW1lc3NhZ2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi93b3JrLWZsb3cvd29yay1mbG93LW1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSTNDLE1BQU0sT0FBTyxzQkFBc0I7SUFHakM7UUFDRSxJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsUUFBd0MsRUFBRSxFQUFFO1lBQ2pFLE9BQU8sQ0FBQyxLQUFVLEVBQUUsRUFBRTtnQkFDcEIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQXlCLENBQUM7Z0JBQzlDLElBQUksT0FBTyxFQUFFO29CQUNYLE9BQU8sQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztpQkFDL0I7Z0JBQ0QsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUU7b0JBQ2xDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDbkI7WUFDSCxDQUFDLENBQUE7UUFDSCxDQUFDLENBQUE7SUFDSCxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksTUFBTSxDQUFDLFFBQXdDO1FBQ3BELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBQ00sT0FBTztRQUNaLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNyRDtJQUVILENBQUM7SUFDRDs7O09BR0c7SUFDSSxJQUFJLENBQUMsT0FBMEI7UUFDcEMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNaLE9BQU87U0FDUjtRQUNELElBQUksR0FBRyxHQUFXLE1BQU0sQ0FBQztRQUN6QixJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDbEIsR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFnQixJQUFJLE1BQU0sQ0FBQztZQUN6QyxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUM7U0FDdkI7UUFDRCxJQUFJLEdBQUcsRUFBRTtZQUNQLEdBQUcsQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQy9CO0lBQ0gsQ0FBQzs7O1lBL0NGLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgV29ya0Zsb3cgfSBmcm9tIFwiLi90eXBlc1wiO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgV29ya0Zsb3dNZXNzYWdlU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBtZXNzYWdlSGFuZGxlcjogKGNhbGxiYWNrOiAoZTogV29ya0Zsb3cuSU1lc3NhZ2UpID0+IHZvaWQpID0+IChldmVudDogYW55KSA9PiB2b2lkO1xyXG4gIHByaXZhdGUgaGFuZGxlcjogKGV2ZW50OiBhbnkpID0+IHZvaWQ7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyID0gKGNhbGxiYWNrOiAoZTogV29ya0Zsb3cuSU1lc3NhZ2UpID0+IHZvaWQpID0+IHtcclxuICAgICAgcmV0dXJuIChldmVudDogYW55KSA9PiB7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBldmVudC5kYXRhIGFzIFdvcmtGbG93LklNZXNzYWdlO1xyXG4gICAgICAgIGlmIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICBtZXNzYWdlLnNlbmRlciA9IGV2ZW50LnNvdXJjZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgY2FsbGJhY2sobWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOebkeWQrOW3peS9nOa1gea2iOaBr1xyXG4gICAqIEBwYXJhbSBjYWxsYmFjayDlm57osINcclxuICAgKi9cclxuICBwdWJsaWMgbGlzdGVuKGNhbGxiYWNrOiAoZTogV29ya0Zsb3cuSU1lc3NhZ2UpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuaGFuZGxlciA9IHRoaXMubWVzc2FnZUhhbmRsZXIoY2FsbGJhY2spO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmhhbmRsZXIpO1xyXG4gIH1cclxuICBwdWJsaWMgZGVzdHJveSgpIHtcclxuICAgIGlmICh0aGlzLmhhbmRsZXIpIHtcclxuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmhhbmRsZXIpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgLyoqXHJcbiAgICog57uZ5bel5L2c5rWB6KGo5Y2V5Y+R6YCB5raI5oGvXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgXHJcbiAgICovXHJcbiAgcHVibGljIHNlbmQobWVzc2FnZTogV29ya0Zsb3cuSU1lc3NhZ2UpOiB2b2lkIHtcclxuICAgIGlmICghbWVzc2FnZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgd2luOiBXaW5kb3cgPSB3aW5kb3c7XHJcbiAgICBpZiAobWVzc2FnZS50YXJnZXQpIHtcclxuICAgICAgd2luID0gbWVzc2FnZS50YXJnZXQgYXMgV2luZG93IHx8IHdpbmRvdztcclxuICAgICAgZGVsZXRlIG1lc3NhZ2UudGFyZ2V0O1xyXG4gICAgfVxyXG4gICAgaWYgKHdpbikge1xyXG4gICAgICB3aW4ucG9zdE1lc3NhZ2UobWVzc2FnZSwgJyonKTtcclxuICAgIH1cclxuICB9XHJcbn0iXX0=
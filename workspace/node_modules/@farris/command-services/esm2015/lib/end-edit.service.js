import { Injectable } from '@angular/core';
import { FrameContext } from '@farris/devkit';
import { of } from 'rxjs';
import { tap, delay } from 'rxjs/operators';
/**
 * 结束表单编辑状态服务
 */
class EndEditService {
    constructor(frameContext) {
        this.frameContext = frameContext;
    }
    /**
     * 结束编辑
     */
    endEdit() {
        const appContext = this.frameContext && this.frameContext.getFormAppContext();
        return of(null).pipe(tap(() => {
            if (appContext) {
                appContext.messagePipe.next({ type: 'endEdit' });
            }
        }), 
        // todo: 不应该使用delay，应该串流
        delay(120));
    }
}
EndEditService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
EndEditService.ctorParameters = () => [
    { type: FrameContext }
];
export { EndEditService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5kLWVkaXQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9lbmQtZWRpdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFELE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUIsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU1Qzs7R0FFRztBQUNILE1BQ00sY0FBYztJQUNsQixZQUFvQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztJQUM5QyxDQUFDO0lBQ0Q7O09BRUc7SUFDSSxPQUFPO1FBQ1osTUFBTSxVQUFVLEdBQWUsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDMUYsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUNsQixHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ1AsSUFBSSxVQUFVLEVBQUU7Z0JBQ2QsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQzthQUNsRDtRQUNILENBQUMsQ0FBQztRQUNGLHdCQUF3QjtRQUN4QixLQUFLLENBQUMsR0FBRyxDQUFDLENBQ1gsQ0FBQztJQUNKLENBQUM7OztZQWxCRixVQUFVOzs7O1lBUFUsWUFBWTs7QUEyQmpDLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQXBwQ29udGV4dCwgRnJhbWVDb250ZXh0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YXAsIGRlbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuLyoqXHJcbiAqIOe7k+adn+ihqOWNlee8lui+keeKtuaAgeacjeWKoVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBFbmRFZGl0U2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnu5PmnZ/nvJbovpFcclxuICAgKi9cclxuICBwdWJsaWMgZW5kRWRpdCgpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQ6IEFwcENvbnRleHQgPSB0aGlzLmZyYW1lQ29udGV4dCAmJiB0aGlzLmZyYW1lQ29udGV4dC5nZXRGb3JtQXBwQ29udGV4dCgpO1xyXG4gICAgcmV0dXJuIG9mKG51bGwpLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKGFwcENvbnRleHQpIHtcclxuICAgICAgICAgIGFwcENvbnRleHQubWVzc2FnZVBpcGUubmV4dCh7IHR5cGU6ICdlbmRFZGl0JyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG4gICAgICAvLyB0b2RvOiDkuI3lupTor6Xkvb/nlKhkZWxhee+8jOW6lOivpeS4sua1gVxyXG4gICAgICBkZWxheSgxMjApXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5leHBvcnQgeyBFbmRFZGl0U2VydmljZSB9O1xyXG4iXX0=
import { Injectable } from '@angular/core';
import { EMPTY, Subject } from 'rxjs';
import { UID } from '@farris/devkit';
/*
 * @Author: aalizzwell
 * @Date: 2019-07-23 15:56:11
 * @Last Modified by: aalizzwell
 * @Last Modified time: 2019-11-27 15:31:36
 */
/**
 * RuntimeFrameworkService
 * @scope @FormModule
 */
// tslint:disable: no-string-literal disable: max-line-length
export class RuntimeFrameworkService {
    constructor() {
        this.rtfService = this.getService();
    }
    /**
     * 遍历获取rtf服务
     */
    getService() {
        let env = window;
        while (!env['gspframeworkService'] && env !== window.top && this.isSameOrigin(env)) {
            env = env.parent;
        }
        return env['gspframeworkService'] && env['gspframeworkService']['rtf'] || {};
    }
    // #region 导航服务
    /**
     * 打开菜单或应用
     * @param options options
     */
    openMenu(options) {
        if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['openMenu'] === 'function') {
            this.rtfService.func.openMenu(options);
        }
    }
    /**
     * 打开菜单或应用
     * @param options options
     */
    openMenu$(options) {
        if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['openMenuByStream'] === 'function') {
            return this.rtfService.func.openMenuByStream(options);
        }
        return EMPTY;
    }
    /**
     * 获取导航实体数据
     * @param tabId tabid
     * @param callback callback
     * @param once once
     */
    getEntityParam(tabId, callback, once = true) {
        if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['getEntityParam'] === 'function') {
            this.rtfService.func.getEntityParam(tabId, callback, once);
        }
    }
    /**
     * 尝试关闭菜单或应用
     * @param options optins
     */
    beforeCloseMenu(options) {
        if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['beforeClose'] === 'function') {
            this.rtfService.func.beforeClose(options);
        }
    }
    /**
     * 关闭菜单
     * @param options options
     */
    closeMenu(options) {
        if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['close'] === 'function') {
            this.rtfService.func.close(options);
        }
    }
    /**
     * 获取菜单静态参数
     * @param funcId 菜单id
     * @param callback 回调
     */
    getMenuParams(funcId, callback) {
        if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['getMenuParams'] === 'function') {
            this.rtfService.func.getMenuParams(funcId, callback);
        }
    }
    /**
     * 添加事件监听
     */
    addEventListener(token, handler, options) {
        if (this.rtfService && this.rtfService.hasOwnProperty('frmEvent') && typeof this.rtfService['frmEvent']['eventListener'] === 'function') {
            this.rtfService.frmEvent.eventListener(token, handler, options);
        }
    }
    /**
     * 获取运行框架菜单切换控制事件
     * @returns Observable<any>
     */
    getMenuSwitchControlEvent() {
        const subject = new Subject();
        const frmEvent = this.rtfService && this.rtfService.frmEvent || null;
        if (frmEvent) {
            const tabId = this.tabId;
            const options = this.params;
            window.setTimeout(() => {
                frmEvent.eventListener(tabId, (response) => {
                    const menuSwitchControl = response && response.menuSwitchControl || null;
                    if (menuSwitchControl && menuSwitchControl.key === tabId) {
                        subject.next(menuSwitchControl.value);
                    }
                    else {
                        subject.next(null);
                    }
                }, options);
            }, 0);
        }
        return subject;
    }
    //#endregion
    // #region 适配层属性
    get params() {
        if (this.rtfService && this.rtfService.hasOwnProperty('session') && typeof this.rtfService['session']['getCommonVariable'] === 'function') {
            return this.rtfService['session']['getCommonVariable']();
        }
        return null;
    }
    /**
     * 获取tabId
     */
    get tabId() {
        return this.params && this.params['tabId'] || null;
    }
    /**
     * 获取formToken
     */
    get formToken() {
        return this.params && this.params['formToken'] || null;
    }
    /**
     * 获取funcId
     */
    get funcId() {
        return this.params && this.params['funcId'] || null;
    }
    // #endregion
    // #region 事件通信
    /**
     * 注册主题
     * @param code 主题的标识
     * @param options token生成规则
     * @param subject 自定义主题，默认使用Subject
     * @returns string 注册成功后返回主题的唯一标识
     */
    subjectRegister(code, options, subject) {
        if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['subjectRegister'] === 'function') {
            return this.rtfService.broadcast.subjectRegister(code, options, subject);
        }
        return null;
    }
    /**
     * 移除主题
     * @param token 主题唯一标识
     */
    subjectRemove(token) {
        if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['subjectRemove'] === 'function') {
            this.rtfService.broadcast.subjectRemove(token);
        }
    }
    /**
     * 给主题发送消息
     * @param token 主题标识
     * @param info 消息
     */
    subjectNotify(token, info) {
        if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['notify'] === 'function') {
            this.rtfService.broadcast.notify(token, info);
        }
    }
    /**
     * 注册主题监听器
     * @param token 主题标识
     * @param handler 主题处理器
     * @param observerToken 监听器id(可选)
     * @returns 监听器Id
     * @description 监听主题消息，监听成功返回当前监听者的唯一标识
     */
    subjectResponse(token, handler, observerToken) {
        if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['response'] === 'function') {
            let code = observerToken;
            if (typeof observerToken === 'undefined' || !observerToken || observerToken.length < 1) {
                code = UID.create();
            }
            this.rtfService.broadcast.response(token, code, handler);
            return code;
        }
        return null;
    }
    /**
     * 取消对主题的监听
     * @param token 主题标识
     * @param observerToken 监听器标识
     */
    responseUnSubscribe(token, observerToken) {
        if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['responseUnSubscribe'] === 'function') {
            this.rtfService.broadcast.responseUnSubscribe(token, observerToken);
        }
    }
    // #endregion
    // #region 工具函数
    /**
     * 是否同源
     * @param environment window
     */
    isSameOrigin(environment) {
        const host = window.location.host;
        try {
            if (environment && environment.location && typeof environment.location.host !== 'undefined') {
                return environment.location.host === host;
            }
        }
        catch (e) {
            return false;
        }
        return false;
    }
}
RuntimeFrameworkService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
RuntimeFrameworkService.ctorParameters = () => [];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnRmLXNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvcnRmLXNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsS0FBSyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsRCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckM7Ozs7O0dBS0c7QUFHSDs7O0dBR0c7QUFDSCw2REFBNkQ7QUFFN0QsTUFBTSxPQUFPLHVCQUF1QjtJQUVsQztRQUNFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3RDLENBQUM7SUFDRDs7T0FFRztJQUNLLFVBQVU7UUFDaEIsSUFBSSxHQUFHLEdBQVcsTUFBTSxDQUFDO1FBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsSUFBSSxHQUFHLEtBQUssTUFBTSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ2xGLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO1NBQ2xCO1FBQ0QsT0FBTyxHQUFHLENBQUMscUJBQXFCLENBQUMsSUFBSSxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDL0UsQ0FBQztJQUNELGVBQWU7SUFDZjs7O09BR0c7SUFDSCxRQUFRLENBQUMsT0FBWTtRQUNuQixJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLElBQUksT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLFVBQVUsRUFBRTtZQUMxSCxJQUFJLENB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QVUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLFVBQVUsRUFBRTtZQUMvSSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7U0FDckU7SUFDSCxDQUFDO0lBQ0QsYUFBYTtJQUViLGVBQWU7SUFDZjs7O09BR0c7SUFDSyxZQUFZLENBQUMsV0FBbUI7UUFDdEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDbEMsSUFBSTtZQUNGLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxRQUFRLElBQUksT0FBTyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxXQUFXLEVBQUU7Z0JBQzNGLE9BQU8sV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDO2FBQzNDO1NBQ0Y7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7OztZQXZORixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBFTVBUWSwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBVSUQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuLypcclxuICogQEF1dGhvcjogYWFsaXp6d2VsbCBcclxuICogQERhdGU6IDIwMTktMDctMjMgMTU6NTY6MTEgXHJcbiAqIEBMYXN0IE1vZGlmaWVkIGJ5OiBhYWxpenp3ZWxsXHJcbiAqIEBMYXN0IE1vZGlmaWVkIHRpbWU6IDIwMTktMTEtMjcgMTU6MzE6MzZcclxuICovXHJcblxyXG5cclxuLyoqXHJcbiAqIFJ1bnRpbWVGcmFtZXdvcmtTZXJ2aWNlXHJcbiAqIEBzY29wZSBARm9ybU1vZHVsZVxyXG4gKi9cclxuLy8gdHNsaW50OmRpc2FibGU6IG5vLXN0cmluZy1saXRlcmFsIGRpc2FibGU6IG1heC1saW5lLWxlbmd0aFxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBSdW50aW1lRnJhbWV3b3JrU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBydGZTZXJ2aWNlOiBhbnk7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnJ0ZlNlcnZpY2UgPSB0aGlzLmdldFNlcnZpY2UoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YGN5Y6G6I635Y+WcnRm5pyN5YqhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRTZXJ2aWNlKCkge1xyXG4gICAgbGV0IGVudjogV2luZG93ID0gd2luZG93O1xyXG4gICAgd2hpbGUgKCFlbnZbJ2dzcGZyYW1ld29ya1NlcnZpY2UnXSAmJiBlbnYgIT09IHdpbmRvdy50b3AgJiYgdGhpcy5pc1NhbWVPcmlnaW4oZW52KSkge1xyXG4gICAgICBlbnYgPSBlbnYucGFyZW50O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVudlsnZ3NwZnJhbWV3b3JrU2VydmljZSddICYmIGVudlsnZ3NwZnJhbWV3b3JrU2VydmljZSddWydydGYnXSB8fCB7fTtcclxuICB9XHJcbiAgLy8gI3JlZ2lvbiDlr7zoiKrmnI3liqFcclxuICAvKipcclxuICAgKiDmiZPlvIDoj5zljZXmiJblupTnlKhcclxuICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zXHJcbiAgICovXHJcbiAgb3Blbk1lbnUob3B0aW9uczogYW55KSB7XHJcbiAgICBpZiAodGhpcy5ydGZTZXJ2aWNlICYmIHRoaXMucnRmU2VydmljZS5oYXNPd25Qcm9wZXJ0eSgnZnVuYycpICYmIHR5cGVvZiB0aGlzLnJ0ZlNlcnZpY2VbJ2Z1bmMnXVsnb3Blbk1lbnUnXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ0ZlNlcnZpY2UuZnVuYy5vcGVuTWVudShvcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5omT5byA6I+c5Y2V5oiW5bqU55SoXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW9uc1xyXG4gICAqL1xyXG4gIG9wZW5NZW51JChvcHRpb25zOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLnJ0ZlNlcnZpY2UgJiYgdGhpcy5ydGZTZXJ2aWNlLmhhc093blByb3BlcnR5KCdmdW5jJykgJiYgdHlwZW9mIHRoaXMucnRmU2VydmljZVsnZnVuYyddWydvcGVuTWVudUJ5U3RyZWFtJ10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucnRmU2VydmljZS5mdW5jLm9wZW5NZW51QnlTdHJlYW0ob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gRU1QVFk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWvvOiIquWunuS9k+aVsOaNrlxyXG4gICAqIEBwYXJhbSB0YWJJZCB0YWJpZFxyXG4gICAqIEBwYXJhbSBjYWxsYmFjayBjYWxsYmFja1xyXG4gICAqIEBwYXJhbSBvbmNlIG9uY2VcclxuICAgKi9cclxuICBnZXRFbnRpdHlQYXJhbSh0YWJJZDogc3RyaW5nLCBjYWxsYmFjazogYW55LCBvbmNlOiBib29sZWFuID0gdHJ1ZSkge1xyXG4gICAgaWYgKHRoaXMucnRmU2VydmljZSAmJiB0aGlzLnJ0ZlNlcnZpY2UuaGFzT3duUHJvcGVydHkoJ2Z1bmMnKSAmJiB0eXBlb2YgdGhpcy5ydGZTZXJ2aWNlWydmdW5jJ11bJ2dldEVudGl0eVBhcmFtJ10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5ydGZTZXJ2aWNlLmZ1bmMuZ2V0RW50aXR5UGFyYW0odGFiSWQsIGNhbGxiYWNrLCBvbmNlKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5bCd6K+V5YWz6Zet6I+c5Y2V5oiW5bqU55SoXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgb3B0aW5zXHJcbiAgICovXHJcbiAgYmVmb3JlQ2xvc2VNZW51KG9wdGlvbnM6IGFueSkge1xyXG4gICAgaWYgKHRoaXMucnRmU2VydmljZSAmJiB0aGlzLnJ0ZlNlcnZpY2UuaGFzT3duUHJvcGVydHkoJ2Z1bmMnKSAmJiB0eXBlb2YgdGhpcy5ydGZTZXJ2aWNlWydmdW5jJ11bJ2JlZm9yZUNsb3NlJ10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5ydGZTZXJ2aWNlLmZ1bmMuYmVmb3JlQ2xvc2Uob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWFs+mXreiPnOWNlVxyXG4gICAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbnNcclxuICAgKi9cclxuICBjbG9zZU1lbnUob3B0aW9uczogYW55KSB7XHJcbiAgICBpZiAodGhpcy5ydGZTZXJ2aWNlICYmIHRoaXMucnRmU2VydmljZS5oYXNPd25Qcm9wZXJ0eSgnZnVuYycpICYmIHR5cGVvZiB0aGlzLnJ0ZlNlcnZpY2VbJ2Z1bmMnXVsnY2xvc2UnXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ0ZlNlcnZpY2UuZnVuYy5jbG9zZShvcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W6I+c5Y2V6Z2Z5oCB5Y+C5pWwXHJcbiAgICogQHBhcmFtIGZ1bmNJZCDoj5zljZVpZFxyXG4gICAqIEBwYXJhbSBjYWxsYmFjayDlm57osINcclxuICAgKi9cclxuICBnZXRNZW51UGFyYW1zKGZ1bmNJZDogc3RyaW5nLCBjYWxsYmFjazogKHBhcmFtcykgPT4gdm9pZCkge1xyXG4gICAgaWYgKHRoaXMucnRmU2VydmljZSAmJiB0aGlzLnJ0ZlNlcnZpY2UuaGFzT3duUHJvcGVydHkoJ2Z1bmMnKSAmJiB0eXBlb2YgdGhpcy5ydGZTZXJ2aWNlWydmdW5jJ11bJ2dldE1lbnVQYXJhbXMnXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ0ZlNlcnZpY2UuZnVuYy5nZXRNZW51UGFyYW1zKGZ1bmNJZCwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDmt7vliqDkuovku7bnm5HlkKxcclxuICAgKi9cclxuICBhZGRFdmVudExpc3RlbmVyKHRva2VuOiBzdHJpbmcsIGhhbmRsZXI6ICh2YWx1ZTogYW55KSA9PiB2b2lkLCBvcHRpb25zOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLnJ0ZlNlcnZpY2UgJiYgdGhpcy5ydGZTZXJ2aWNlLmhhc093blByb3BlcnR5KCdmcm1FdmVudCcpICYmIHR5cGVvZiB0aGlzLnJ0ZlNlcnZpY2VbJ2ZybUV2ZW50J11bJ2V2ZW50TGlzdGVuZXInXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ0ZlNlcnZpY2UuZnJtRXZlbnQuZXZlbnRMaXN0ZW5lcih0b2tlbiwgaGFuZGxlciwgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlui/kOihjOahhuaetuiPnOWNleWIh+aNouaOp+WItuS6i+S7tlxyXG4gICAqIEByZXR1cm5zIE9ic2VydmFibGU8YW55PlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRNZW51U3dpdGNoQ29udHJvbEV2ZW50KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgY29uc3QgZnJtRXZlbnQgPSB0aGlzLnJ0ZlNlcnZpY2UgJiYgdGhpcy5ydGZTZXJ2aWNlLmZybUV2ZW50IHx8IG51bGw7XHJcbiAgICBpZiAoZnJtRXZlbnQpIHtcclxuICAgICAgY29uc3QgdGFiSWQgPSB0aGlzLnRhYklkO1xyXG4gICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5wYXJhbXM7XHJcbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBmcm1FdmVudC5ldmVudExpc3RlbmVyKHRhYklkLCAocmVzcG9uc2U6IHsgbWVudVN3aXRjaENvbnRyb2w6IHsga2V5OiBhbnksIHZhbHVlOiBhbnkgfSwgW3Byb3A6IHN0cmluZ106IGFueSB9KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBtZW51U3dpdGNoQ29udHJvbCA9IHJlc3BvbnNlICYmIHJlc3BvbnNlLm1lbnVTd2l0Y2hDb250cm9sIHx8IG51bGw7XHJcbiAgICAgICAgICBpZiAobWVudVN3aXRjaENvbnRyb2wgJiYgbWVudVN3aXRjaENvbnRyb2wua2V5ID09PSB0YWJJZCkge1xyXG4gICAgICAgICAgICBzdWJqZWN0Lm5leHQobWVudVN3aXRjaENvbnRyb2wudmFsdWUpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc3ViamVjdC5uZXh0KG51bGwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sIG9wdGlvbnMpO1xyXG4gICAgICB9LCAwKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdWJqZWN0O1xyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiDpgILphY3lsYLlsZ7mgKdcclxuICBwdWJsaWMgZ2V0IHBhcmFtcygpIHtcclxuICAgIGlmICh0aGlzLnJ0ZlNlcnZpY2UgJiYgdGhpcy5ydGZTZXJ2aWNlLmhhc093blByb3BlcnR5KCdzZXNzaW9uJykgJiYgdHlwZW9mIHRoaXMucnRmU2VydmljZVsnc2Vzc2lvbiddWydnZXRDb21tb25WYXJpYWJsZSddID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJ0ZlNlcnZpY2VbJ3Nlc3Npb24nXVsnZ2V0Q29tbW9uVmFyaWFibGUnXSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlnRhYklkXHJcbiAgICovXHJcbiAgcHVibGljIGdldCB0YWJJZCgpIHtcclxuICAgIHJldHVybiB0aGlzLnBhcmFtcyAmJiB0aGlzLnBhcmFtc1sndGFiSWQnXSB8fCBudWxsO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5Zmb3JtVG9rZW5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGZvcm1Ub2tlbigpIHtcclxuICAgIHJldHVybiB0aGlzLnBhcmFtcyAmJiB0aGlzLnBhcmFtc1snZm9ybVRva2VuJ10gfHwgbnVsbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+WZnVuY0lkXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBmdW5jSWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJhbXMgJiYgdGhpcy5wYXJhbXNbJ2Z1bmNJZCddIHx8IG51bGw7XHJcbiAgfVxyXG4gIC8vICNlbmRyZWdpb25cclxuXHJcbiAgLy8gI3JlZ2lvbiDkuovku7bpgJrkv6FcclxuICAvKipcclxuICAgKiDms6jlhozkuLvpophcclxuICAgKiBAcGFyYW0gY29kZSDkuLvpopjnmoTmoIfor4ZcclxuICAgKiBAcGFyYW0gb3B0aW9ucyB0b2tlbueUn+aIkOinhOWImVxyXG4gICAqIEBwYXJhbSBzdWJqZWN0IOiHquWumuS5ieS4u+mimO+8jOm7mOiupOS9v+eUqFN1YmplY3RcclxuICAgKiBAcmV0dXJucyBzdHJpbmcg5rOo5YaM5oiQ5Yqf5ZCO6L+U5Zue5Li76aKY55qE5ZSv5LiA5qCH6K+GXHJcbiAgICovXHJcbiAgcHVibGljIHN1YmplY3RSZWdpc3Rlcihjb2RlOiBzdHJpbmcsIG9wdGlvbnM6IGFueSwgc3ViamVjdD86IFN1YmplY3Q8YW55Pik6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5ydGZTZXJ2aWNlICYmIHRoaXMucnRmU2VydmljZS5oYXNPd25Qcm9wZXJ0eSgnYnJvYWRjYXN0JykgJiYgdHlwZW9mIHRoaXMucnRmU2VydmljZVsnYnJvYWRjYXN0J11bJ3N1YmplY3RSZWdpc3RlciddID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJ0ZlNlcnZpY2UuYnJvYWRjYXN0LnN1YmplY3RSZWdpc3Rlcihjb2RlLCBvcHRpb25zLCBzdWJqZWN0KTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDnp7vpmaTkuLvpophcclxuICAgKiBAcGFyYW0gdG9rZW4g5Li76aKY5ZSv5LiA5qCH6K+GXHJcbiAgICovXHJcbiAgcHVibGljIHN1YmplY3RSZW1vdmUodG9rZW46IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMucnRmU2VydmljZSAmJiB0aGlzLnJ0ZlNlcnZpY2UuaGFzT3duUHJvcGVydHkoJ2Jyb2FkY2FzdCcpICYmIHR5cGVvZiB0aGlzLnJ0ZlNlcnZpY2VbJ2Jyb2FkY2FzdCddWydzdWJqZWN0UmVtb3ZlJ10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5ydGZTZXJ2aWNlLmJyb2FkY2FzdC5zdWJqZWN0UmVtb3ZlKHRva2VuKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog57uZ5Li76aKY5Y+R6YCB5raI5oGvXHJcbiAgICogQHBhcmFtIHRva2VuIOS4u+mimOagh+ivhlxyXG4gICAqIEBwYXJhbSBpbmZvIOa2iOaBr1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdWJqZWN0Tm90aWZ5KHRva2VuOiBzdHJpbmcsIGluZm86IGFueSkge1xyXG4gICAgaWYgKHRoaXMucnRmU2VydmljZSAmJiB0aGlzLnJ0ZlNlcnZpY2UuaGFzT3duUHJvcGVydHkoJ2Jyb2FkY2FzdCcpICYmIHR5cGVvZiB0aGlzLnJ0ZlNlcnZpY2VbJ2Jyb2FkY2FzdCddWydub3RpZnknXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICB0aGlzLnJ0ZlNlcnZpY2UuYnJvYWRjYXN0Lm5vdGlmeSh0b2tlbiwgaW5mbyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOazqOWGjOS4u+mimOebkeWQrOWZqFxyXG4gICAqIEBwYXJhbSB0b2tlbiDkuLvpopjmoIfor4ZcclxuICAgKiBAcGFyYW0gaGFuZGxlciDkuLvpopjlpITnkIblmahcclxuICAgKiBAcGFyYW0gb2JzZXJ2ZXJUb2tlbiDnm5HlkKzlmahpZCjlj6/pgIkpXHJcbiAgICogQHJldHVybnMg55uR5ZCs5ZmoSWRcclxuICAgKiBAZGVzY3JpcHRpb24g55uR5ZCs5Li76aKY5raI5oGv77yM55uR5ZCs5oiQ5Yqf6L+U5Zue5b2T5YmN55uR5ZCs6ICF55qE5ZSv5LiA5qCH6K+GXHJcbiAgICovXHJcbiAgcHVibGljIHN1YmplY3RSZXNwb25zZSh0b2tlbjogc3RyaW5nLCBoYW5kbGVyOiAoZGF0YTogYW55KSA9PiB2b2lkLCBvYnNlcnZlclRva2VuPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlmICh0aGlzLnJ0ZlNlcnZpY2UgJiYgdGhpcy5ydGZTZXJ2aWNlLmhhc093blByb3BlcnR5KCdicm9hZGNhc3QnKSAmJiB0eXBlb2YgdGhpcy5ydGZTZXJ2aWNlWydicm9hZGNhc3QnXVsncmVzcG9uc2UnXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBsZXQgY29kZSA9IG9ic2VydmVyVG9rZW47XHJcbiAgICAgIGlmICh0eXBlb2Ygb2JzZXJ2ZXJUb2tlbiA9PT0gJ3VuZGVmaW5lZCcgfHwgIW9ic2VydmVyVG9rZW4gfHwgb2JzZXJ2ZXJUb2tlbi5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgY29kZSA9IFVJRC5jcmVhdGUoKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnJ0ZlNlcnZpY2UuYnJvYWRjYXN0LnJlc3BvbnNlKHRva2VuLCBjb2RlLCBoYW5kbGVyKTtcclxuICAgICAgcmV0dXJuIGNvZGU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+W5raI5a+55Li76aKY55qE55uR5ZCsXHJcbiAgICogQHBhcmFtIHRva2VuIOS4u+mimOagh+ivhlxyXG4gICAqIEBwYXJhbSBvYnNlcnZlclRva2VuIOebkeWQrOWZqOagh+ivhlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNwb25zZVVuU3Vic2NyaWJlKHRva2VuOiBzdHJpbmcsIG9ic2VydmVyVG9rZW46IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMucnRmU2VydmljZSAmJiB0aGlzLnJ0ZlNlcnZpY2UuaGFzT3duUHJvcGVydHkoJ2Jyb2FkY2FzdCcpICYmIHR5cGVvZiB0aGlzLnJ0ZlNlcnZpY2VbJ2Jyb2FkY2FzdCddWydyZXNwb25zZVVuU3Vic2NyaWJlJ10gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgdGhpcy5ydGZTZXJ2aWNlLmJyb2FkY2FzdC5yZXNwb25zZVVuU3Vic2NyaWJlKHRva2VuLCBvYnNlcnZlclRva2VuKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAvLyAjcmVnaW9uIOW3peWFt+WHveaVsFxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuWQjOa6kFxyXG4gICAqIEBwYXJhbSBlbnZpcm9ubWVudCB3aW5kb3dcclxuICAgKi9cclxuICBwcml2YXRlIGlzU2FtZU9yaWdpbihlbnZpcm9ubWVudDogV2luZG93KSB7XHJcbiAgICBjb25zdCBob3N0ID0gd2luZG93LmxvY2F0aW9uLmhvc3Q7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoZW52aXJvbm1lbnQgJiYgZW52aXJvbm1lbnQubG9jYXRpb24gJiYgdHlwZW9mIGVudmlyb25tZW50LmxvY2F0aW9uLmhvc3QgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIGVudmlyb25tZW50LmxvY2F0aW9uLmhvc3QgPT09IGhvc3Q7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgLy8gI2VuZHJlZ2lvblxyXG59XHJcbiJdfQ==
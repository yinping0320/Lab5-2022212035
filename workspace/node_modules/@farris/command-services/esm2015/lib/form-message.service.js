import { Inject, Injectable, LOCALE_ID, Optional } from '@angular/core';
import { from } from 'rxjs';
import { MessagerService } from '@farris/ui-messager';
import { LanguageService } from './languag.service';
import { ExceptionFactory } from './error/index';
/**
 * 表单消息服务
 * @scope FormModule
 * @summary
 * 1、包装@farris/ui的消息服务；
 * 2、提供针对表单的快捷方法；
 */
class FormMessageService {
    /**
     * 构造函数
     * 注入@farris/ui的LoadingService
     */
    constructor(messagerService, languageService, curLanguage) {
        this.messagerService = messagerService;
        this.languageService = languageService;
        this.curLanguage = curLanguage;
        this.languageService = this.languageService || LanguageService.getInstance();
    }
    /**
     * question弹窗
     */
    question(content) {
        const confirmResult$ = this.confirmPromise(content);
        return from(confirmResult$);
    }
    /**
     * 带默认焦点的弹出提示
     * @param content 内容
     */
    question2(content) {
        const promise$ = new Promise((resolve, reject) => {
            const dialogRef = this.messagerService.question2(content, [
                {
                    text: this.languageService.no,
                    cls: 'btn btn-secondary',
                    handle: () => {
                        resolve(false);
                        dialogRef.close();
                    }
                },
                {
                    text: this.languageService.yes,
                    cls: 'btn btn-primary',
                    defaultFocus: true,
                    handle: () => {
                        resolve(true);
                        dialogRef.close();
                    }
                }
            ]);
        });
        return from(promise$);
    }
    /**
     * 弹出输入对话框
     * @param title 标题
     */
    prompt(title) {
        return this.messagerService.prompt(title);
    }
    /**
     * 使用Promise实例包装回调方法，以同步回调方法执行后结果
     * @param content
     */
    confirmPromise(content) {
        return new Promise((resolve, reject) => {
            this.messagerService.question(content, () => { resolve(true); }, () => { resolve(false); });
        });
    }
    /**
     * 确认弹框
     * @param content 弹出内容提示
     */
    confirm(content) {
        return this.messagerService.confirm(content);
    }
    /**
     * 消息弹框
     */
    info(content) {
        this.messagerService.info(content);
    }
    /**
     * 错误弹框
     */
    error(content) {
        this.messagerService.error(content);
    }
    /**
     * 警告弹框
     */
    warning(content) {
        this.messagerService.warning(content);
    }
    /**
     * 服务器端异常提示弹框
     */
    httpErrorInServer(httpError) {
        let error = httpError.error;
        if (typeof (error) === 'string') {
            try {
                error = JSON.parse(error);
            }
            catch (e) { }
        }
        if (!error || error.Level == null || error.Level == undefined) { // 未封装error或未设置异常等级
            this.messagerService.error(httpError.message);
            return;
        }
        const exceptionStrategy = ExceptionFactory.getInstance(this.messagerService, this.languageService).getExceptionHandleStrategy(error.Level);
        exceptionStrategy.handleException(error);
    }
    /**
     * 客户端异常提示弹框
     */
    httpErrorInClient(httpError) {
        if (!httpError) {
            return;
        }
        const message = httpError.error && httpError.error.error && httpError.error.error.message;
        const exceptionMsg = message || httpError.message && httpError.message.replace(/http:\/\/[a-zA-Z0-9.:]{1,}/, '');
        const options = {
            // title: this.languageService.clientNotifyTitle,
            // showMaxButton: true,
            showHeader: false,
            width: 400,
            height: 200,
            safeHtml: false
        };
        this.messagerService.show('error', exceptionMsg, options);
    }
    /**
     * 401异常处理
     * 为了独立弹出重新登录提示框，切换到运行框架http服务后可以删除
     * @param httpError 异常
     */
    http401Error(httpError) {
        const dialogShownKey = '401ErrorShownFlag';
        if (!httpError || window[dialogShownKey]) {
            return;
        }
        const i18n = {
            en: {
                title: 'Warning',
                sessionInvalid: 'Your login has expired, please login again.',
                ok: 'ok',
                cancel: 'cancel'
            },
            'zh-CHS': {
                title: '提示',
                sessionInvalid: '用户登录信息已失效，是否重新登录?',
                ok: '确认',
                cancel: '取消'
            }
        };
        this.curLanguage = this.curLanguage || 'zh-CHS';
        const messageOptions = {
            title: i18n[this.curLanguage].title,
            initialState: {
                okText: i18n[this.curLanguage].ok,
                okHandle: () => {
                    modalRef.close();
                    window[dialogShownKey] = false;
                    const eventResult = httpError && httpError.error || {};
                    const redirectUri = eventResult.redirect_uri || '/login.html';
                    window.location.href = `/logout.html#?logout-before-redirect=true&loginUri=${redirectUri}`;
                },
                cancelText: i18n[this.curLanguage].cancel,
                cancelHandle: () => {
                    modalRef.close();
                    window[dialogShownKey] = false;
                }
            },
            showHeader: true,
            width: 420,
            height: 180,
            fitContent: false
        };
        const modalRef = this.messagerService.show('question', i18n[this.curLanguage].sessionInvalid, messageOptions);
        window[dialogShownKey] = true;
        if (modalRef && modalRef.dialog && modalRef.dialog.instance.closed) {
            modalRef.dialog.instance.closed.subscribe(() => {
                window[dialogShownKey] = false;
            });
        }
    }
}
FormMessageService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FormMessageService.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] }
];
export { FormMessageService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1tZXNzYWdlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZm9ybS1tZXNzYWdlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4RSxPQUFPLEVBQTJCLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBeUIsZ0JBQWdCLEVBQXNCLE1BQU0sZUFBZSxDQUFDO0FBRzVGOzs7Ozs7R0FNRztBQUNILE1BQ00sa0JBQWtCO0lBRXRCOzs7T0FHRztJQUNILFlBQ1UsZUFBZ0MsRUFDcEIsZUFBZ0MsRUFDekIsV0FBbUI7UUFGdEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ3BCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUN6QixnQkFBVyxHQUFYLFdBQVcsQ0FBUTtRQUU5QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLElBQUksZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQy9FLENBQUM7SUFDRDs7T0FFRztJQUNJLFFBQVEsQ0FBQyxPQUFlO1FBQzdCLE1BQU0sY0FBYyxHQUFxQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3RFLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRDs7O09BR0c7SUFDSSxTQUFTLENBQUMsT0FBZTtRQUM5QixNQUFNLFFBQVEsR0FBcUIsSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7WUFDakUsTUFBTSxTQUFT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QUFDLENBQUM7UUFDOUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUM5QixJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRTtZQUNsRSxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtnQkFDN0MsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUNqQyxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7O1lBeE1GLFVBQVU7Ozs7WUFiRixlQUFlO1lBRWYsZUFBZSx1QkFvQm5CLFFBQVE7eUNBQ1IsTUFBTSxTQUFDLFNBQVM7O0FBa01yQixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgTE9DQUxFX0lELCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IGZyb21Qcm9taXNlIH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL2Zyb21Qcm9taXNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi9sYW5ndWFnLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTZXJ2ZXJFeGNlcHRpb25FbnRpdHksIEV4Y2VwdGlvbkZhY3RvcnksIElFeGNlcHRpb25TdHJhdGVneSB9IGZyb20gJy4vZXJyb3IvaW5kZXgnO1xyXG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG4vKipcclxuICog6KGo5Y2V5raI5oGv5pyN5YqhXHJcbiAqIEBzY29wZSBGb3JtTW9kdWxlXHJcbiAqIEBzdW1tYXJ5XHJcbiAqIDHjgIHljIXoo4VAZmFycmlzL3Vp55qE5raI5oGv5pyN5Yqh77ybXHJcbiAqIDLjgIHmj5Dkvpvpkojlr7nooajljZXnmoTlv6vmjbfmlrnms5XvvJtcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuY2xhc3MgRm9ybU1lc3NhZ2VTZXJ2aWNlIHtcclxuXHJcbiAgLyoqXHJcbiAgICog5p6E6YCg5Ye95pWwXHJcbiAgICog5rOo5YWlQGZhcnJpcy91aeeahExvYWRpbmdTZXJ2aWNlXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSxcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGN1ckxhbmd1YWdlOiBzdHJpbmcsIC8vIOS4uuS6hueLrOeri+W8ueWHuumHjeaWsOeZu+W9leaPkOekuuahhu+8jOWIh+aNouWIsOi/kOihjOahhuaetmh0dHDmnI3liqHlkI7lj6/ku6XliKDpmaRcclxuICApIHtcclxuICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gdGhpcy5sYW5ndWFnZVNlcnZpY2UgfHwgTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIHF1ZXN0aW9u5by556qXXHJcbiAgICovXHJcbiAgcHVibGljIHF1ZXN0aW9uKGNvbnRlbnQ6IHN0cmluZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3QgY29uZmlybVJlc3VsdCQ6IFByb21pc2U8Ym9vbGVhbj4gPSB0aGlzLmNvbmZpcm1Qcm9taXNlKGNvbnRlbnQpO1xyXG4gICAgcmV0dXJuIGZyb20oY29uZmlybVJlc3VsdCQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bim6buY6K6k54Sm54K555qE5by55Ye65o+Q56S6XHJcbiAgICogQHBhcmFtIGNvbnRlbnQg5YaF5a65XHJcbiAgICovXHJcbiAgcHVibGljIHF1ZXN0aW9uMihjb250ZW50OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHByb21pc2UkOiBQcm9taXNlPGJvb2xlYW4+ID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm1lc3NhZ2VyU2VydmljZS5xdWVzdGlvbjIoXHJcbiAgICAgICAgY29udGVudCxcclxuICAgICAgICBbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHRleHQ6IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLm5vLFxyXG4gICAgICAgICAgICBjbHM6ICdidG4gYnRuLXNlY29uZGFyeScsXHJcbiAgICAgICAgICAgIGhhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIGRpYWxvZ1JlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmd1YWdlU2VydmljZS55ZXMsXHJcbiAgICAgICAgICAgIGNsczogJ2J0biBidG4tcHJpbWFyeScsXHJcbiAgICAgICAgICAgIGRlZmF1bHRGb2N1czogdHJ1ZSxcclxuICAgICAgICAgICAgaGFuZGxlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgICBkaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIF0pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gZnJvbShwcm9taXNlJCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlvLnlh7rovpPlhaXlr7nor53moYZcclxuICAgKiBAcGFyYW0gdGl0bGUg5qCH6aKYXHJcbiAgICovXHJcbiAgcHVibGljIHByb21wdCh0aXRsZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLm1lc3NhZ2VyU2VydmljZS5wcm9tcHQodGl0bGUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5L2/55SoUHJvbWlzZeWunuS+i+WMheijheWbnuiwg+aWueazle+8jOS7peWQjOatpeWbnuiwg+aWueazleaJp+ihjOWQjue7k+aenFxyXG4gICAqIEBwYXJhbSBjb250ZW50XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb25maXJtUHJvbWlzZShjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLnF1ZXN0aW9uKFxyXG4gICAgICAgIGNvbnRlbnQsXHJcbiAgICAgICAgKCkgPT4geyByZXNvbHZlKHRydWUpOyB9LFxyXG4gICAgICAgICgpID0+IHsgcmVzb2x2ZShmYWxzZSk7IH1cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog56Gu6K6k5by55qGGXHJcbiAgICogQHBhcmFtIGNvbnRlbnQg5by55Ye65YaF5a655o+Q56S6XHJcbiAgICovXHJcbiAgcHVibGljIGNvbmZpcm0oY29udGVudDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdlclNlcnZpY2UuY29uZmlybShjb250ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOa2iOaBr+W8ueahhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbmZvKGNvbnRlbnQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuaW5mbyhjb250ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmUmeivr+W8ueahhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBlcnJvcihjb250ZW50OiBzdHJpbmcpIHtcclxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmVycm9yKGNvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6K2m5ZGK5by55qGGXHJcbiAgICovXHJcbiAgcHVibGljIHdhcm5pbmcoY29udGVudDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS53YXJuaW5nKGNvbnRlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pyN5Yqh5Zmo56uv5byC5bi45o+Q56S65by55qGGXHJcbiAgICovXHJcbiAgcHVibGljIGh0dHBFcnJvckluU2VydmVyKGh0dHBFcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpOiB2b2lkIHtcclxuICAgIGxldCBlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5ID0gaHR0cEVycm9yLmVycm9yO1xyXG4gICAgaWYgKHR5cGVvZiAoZXJyb3IpID09PSAnc3RyaW5nJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGVycm9yID0gSlNPTi5wYXJzZShlcnJvcik7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFlcnJvciB8fCBlcnJvci5MZXZlbCA9PSBudWxsIHx8IGVycm9yLkxldmVsID09IHVuZGVmaW5lZCkgeyAvLyDmnKrlsIHoo4VlcnJvcuaIluacquiuvue9ruW8guW4uOetiee6p1xyXG4gICAgICB0aGlzLm1lc3NhZ2VyU2VydmljZS5lcnJvcihodHRwRXJyb3IubWVzc2FnZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGV4Y2VwdGlvblN0cmF0ZWd5OiBJRXhjZXB0aW9uU3RyYXRlZ3kgPSBFeGNlcHRpb25GYWN0b3J5LmdldEluc3RhbmNlKHRoaXMubWVzc2FnZXJTZXJ2aWNlLCB0aGlzLmxhbmd1YWdlU2VydmljZSkuZ2V0RXhjZXB0aW9uSGFuZGxlU3RyYXRlZ3koZXJyb3IuTGV2ZWwpO1xyXG4gICAgZXhjZXB0aW9uU3RyYXRlZ3kuaGFuZGxlRXhjZXB0aW9uKGVycm9yKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWuouaIt+err+W8guW4uOaPkOekuuW8ueahhlxyXG4gICAqL1xyXG4gIHB1YmxpYyBodHRwRXJyb3JJbkNsaWVudChodHRwRXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogdm9pZCB7XHJcbiAgICBpZiAoIWh0dHBFcnJvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBtZXNzYWdlID0gaHR0cEVycm9yLmVycm9yICYmIGh0dHBFcnJvci5lcnJvci5lcnJvciAmJiBodHRwRXJyb3IuZXJyb3IuZXJyb3IubWVzc2FnZTtcclxuICAgIGNvbnN0IGV4Y2VwdGlvbk1zZyA9IG1lc3NhZ2UgfHwgaHR0cEVycm9yLm1lc3NhZ2UgJiYgaHR0cEVycm9yLm1lc3NhZ2UucmVwbGFjZSgvaHR0cDpcXC9cXC9bYS16QS1aMC05LjpdezEsfS8sICcnKTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgIC8vIHRpdGxlOiB0aGlzLmxhbmd1YWdlU2VydmljZS5jbGllbnROb3RpZnlUaXRsZSxcclxuICAgICAgLy8gc2hvd01heEJ1dHRvbjogdHJ1ZSxcclxuICAgICAgc2hvd0hlYWRlcjogZmFsc2UsXHJcbiAgICAgIHdpZHRoOiA0MDAsXHJcbiAgICAgIGhlaWdodDogMjAwLFxyXG4gICAgICBzYWZlSHRtbDogZmFsc2VcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2Uuc2hvdygnZXJyb3InLCBleGNlcHRpb25Nc2csIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogNDAx5byC5bi45aSE55CGXHJcbiAgICog5Li65LqG54us56uL5by55Ye66YeN5paw55m75b2V5o+Q56S65qGG77yM5YiH5o2i5Yiw6L+Q6KGM5qGG5p62aHR0cOacjeWKoeWQjuWPr+S7peWIoOmZpFxyXG4gICAqIEBwYXJhbSBodHRwRXJyb3Ig5byC5bi4XHJcbiAgICovXHJcbiAgcHVibGljIGh0dHA0MDFFcnJvcihodHRwRXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogdm9pZCB7XHJcbiAgICBjb25zdCBkaWFsb2dTaG93bktleSA9ICc0MDFFcnJvclNob3duRmxhZyc7XHJcblxyXG4gICAgaWYgKCFodHRwRXJyb3IgfHwgd2luZG93W2RpYWxvZ1Nob3duS2V5XSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaTE4biA9IHtcclxuICAgICAgZW46IHtcclxuICAgICAgICB0aXRsZTogJ1dhcm5pbmcnLFxyXG4gICAgICAgIHNlc3Npb25JbnZhbGlkOiAnWW91ciBsb2dpbiBoYXMgZXhwaXJlZCwgcGxlYXNlIGxvZ2luIGFnYWluLicsXHJcbiAgICAgICAgb2s6ICdvaycsXHJcbiAgICAgICAgY2FuY2VsOiAnY2FuY2VsJ1xyXG4gICAgICB9LFxyXG4gICAgICAnemgtQ0hTJzoge1xyXG4gICAgICAgIHRpdGxlOiAn5o+Q56S6JyxcclxuICAgICAgICBzZXNzaW9uSW52YWxpZDogJ+eUqOaIt+eZu+W9leS/oeaBr+W3suWkseaViO+8jOaYr+WQpumHjeaWsOeZu+W9lT8nLFxyXG4gICAgICAgIG9rOiAn56Gu6K6kJyxcclxuICAgICAgICBjYW5jZWw6ICflj5bmtognXHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLmN1ckxhbmd1YWdlID0gdGhpcy5jdXJMYW5ndWFnZSB8fCAnemgtQ0hTJztcclxuXHJcbiAgICBjb25zdCBtZXNzYWdlT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IGkxOG5bdGhpcy5jdXJMYW5ndWFnZV0udGl0bGUsXHJcbiAgICAgIGluaXRpYWxTdGF0ZToge1xyXG4gICAgICAgIG9rVGV4dDogaTE4blt0aGlzLmN1ckxhbmd1YWdlXS5vayxcclxuICAgICAgICBva0hhbmRsZTogKCkgPT4ge1xyXG4gICAgICAgICAgbW9kYWxSZWYuY2xvc2UoKTtcclxuICAgICAgICAgIHdpbmRvd1tkaWFsb2dTaG93bktleV0gPSBmYWxzZTtcclxuICAgICAgICAgIGNvbnN0IGV2ZW50UmVzdWx0ID0gaHR0cEVycm9yICYmIGh0dHBFcnJvci5lcnJvciB8fCB7fTtcclxuICAgICAgICAgIGNvbnN0IHJlZGlyZWN0VXJpID0gZXZlbnRSZXN1bHQucmVkaXJlY3RfdXJpIHx8ICcvbG9naW4uaHRtbCc7XHJcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGAvbG9nb3V0Lmh0bWwjP2xvZ291dC1iZWZvcmUtcmVkaXJlY3Q9dHJ1ZSZsb2dpblVyaT0ke3JlZGlyZWN0VXJpfWA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjYW5jZWxUZXh0OiBpMThuW3RoaXMuY3VyTGFuZ3VhZ2VdLmNhbmNlbCxcclxuICAgICAgICBjYW5jZWxIYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgIG1vZGFsUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICB3aW5kb3dbZGlhbG9nU2hvd25LZXldID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBzaG93SGVhZGVyOiB0cnVlLFxyXG4gICAgICB3aWR0aDogNDIwLFxyXG4gICAgICBoZWlnaHQ6IDE4MCxcclxuICAgICAgZml0Q29udGVudDogZmFsc2VcclxuICAgIH07XHJcbiAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMubWVzc2FnZXJTZXJ2aWNlLnNob3coJ3F1ZXN0aW9uJywgaTE4blt0aGlzLmN1ckxhbmd1YWdlXS5zZXNzaW9uSW52YWxpZCwgbWVzc2FnZU9wdGlvbnMpO1xyXG4gICAgd2luZG93W2RpYWxvZ1Nob3duS2V5XSA9IHRydWU7XHJcbiAgICBpZiAobW9kYWxSZWYgJiYgbW9kYWxSZWYuZGlhbG9nICYmIG1vZGFsUmVmLmRpYWxvZy5pbnN0YW5jZS5jbG9zZWQpIHtcclxuICAgICAgbW9kYWxSZWYuZGlhbG9nLmluc3RhbmNlLmNsb3NlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIHdpbmRvd1tkaWFsb2dTaG93bktleV0gPSBmYWxzZTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IHsgRm9ybU1lc3NhZ2VTZXJ2aWNlIH07XHJcblxyXG4iXX0=
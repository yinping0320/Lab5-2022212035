import { Inject, Injectable, Injector, LOCALE_ID, Optional } from "@angular/core";
import { map } from "rxjs/operators";
import { FeatureRepository } from "./feature-repository";
import { Prop } from "./types";
import { BasePathService } from "@farris/rtf";
export class FeatureDataService {
    constructor(injector, repository, localeId) {
        this.injector = injector;
        this.repository = repository;
        this.localeId = localeId;
        this.localeId = this.localeId || 'zh-CHS';
    }
    /**
     * 根据物料id获取物料特征项及特征值（公共默认值）
     * @param materialId 物料id
     */
    getFeaturesByMaterialId(materialId) {
        return this.repository.getFeaturesByMaterialId(materialId).pipe(map((response) => {
            if (!response || !response.returnValue) {
                return null;
            }
            const returnValue = JSON.parse(response.returnValue);
            const result = { propset: [], props: [] };
            const propsets = returnValue.propset || null;
            const props = returnValue.props || null;
            if (propsets && Array.isArray(propsets)) {
                propsets.map((propset) => {
                    propset.name = this.translateName(propset);
                    return propset;
                });
                result.propset = propsets;
            }
            if (props && Array.isArray(props) && props.length > 0) {
                props.map((prop) => {
                    // 处理多语
                    prop.name = this.translateName(prop);
                    // 处理枚举
                    if (prop.inputtype === Prop.InputType.enum && prop.enuminfo) {
                        prop.data = JSON.parse(prop.enuminfo);
                    }
                    // 处理必填和只读
                    prop.isreadonly = prop.isreadonly === '1' ? true : false;
                    prop.isrequired = prop.isrequired === '1' ? true : false;
                    return prop;
                });
                result.props = props;
            }
            return result;
        }));
    }
    /**
     * 根据物料id及物料特征保存后的hash获取该物料已经存储的特征项值
     * @param materialId 物料Id
     * @param configID 对应该物料的特征项hash
     * @returns
     */
    getConfigedValueByFeatureId(materialId, configID, configType = 'Materials') {
        return this.repository.getConfigedValueByFeatureId(materialId, configID, configType).pipe(map((result) => {
            return JSON.parse(result);
        }));
    }
    /**
     * 保存物料特征项
     * @param materialId 物料id
     * @param charactValue 特征值
     * @param configType 配置类型
     * @returns
     */
    applyFeatures(materialId, charactValue, configType = 'Materials') {
        return this.repository.applyFeatures(materialId, charactValue, configType).pipe(map((config) => {
            return JSON.parse(config);
        }));
    }
    /**
     * 获取帮助信息
     * @param helpid 帮助id
     * @param filter 过滤条件
     * @param params 参数
     * @returns
     */
    getHelpInfo(helpid, filter, params) {
        const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata');
        const httpParams = {};
        if (params) {
            if (params.pageIndex) {
                httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);
            }
            if (params.pageSize) {
                httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);
            }
            if (params.condition) {
                httpParams['condition'] = JSON.stringify(params.condition);
            }
            if (params.searchValue) {
                httpParams['search'] = params.searchValue;
            }
        }
        const body = {
            helpID: helpid,
            queryParam: JSON.stringify(httpParams),
            filterStr: filter
        };
        const befRepository = null; //this.repository as BefRepository<any>;
        const options = {
            body
        };
        return befRepository.proxy.request(url, 'put', null, options).pipe(map((result) => JSON.parse(result)));
    }
    /**
     * 国际化特征项或特征集名称
     * @param object 特征集或特征项对象
     * @returns
     */
    translateName(object) {
        if (!object) {
            return null;
        }
        let name = null;
        switch (this.localeId) {
            case 'en':
                {
                    name = object['name_en'];
                }
                break;
            case 'zh-CHS':
                {
                    name = object['name_chs'];
                }
                break;
            case 'zh-CHT':
                {
                    name = object['name_cht'];
                }
                break;
            default: name = object['name_chs'];
        }
        return name;
    }
}
FeatureDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FeatureDataService.ctorParameters = () => [
    { type: Injector },
    { type: FeatureRepository },
    { type: String, decorators: [{ type: Optional }, { type: Inject, args: [LOCALE_ID,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZmVhdHVyZS1lZGl0L2ZlYXR1cmUtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSWxGLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHOUMsTUFBTSxPQUFPLGtCQUFrQjtJQUM3QixZQUNVLFFBQWtCLEVBQ2xCLFVBQTZCLEVBQ0UsUUFBaUI7UUFGaEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixlQUFVLEdBQVYsVUFBVSxDQUFtQjtRQUNFLGFBQVEsR0FBUixRQUFRLENBQVM7UUFFeEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQztJQUM1QyxDQUFDO0lBQ0Q7OztPQUdHO0lBQ0ksdUJBQXVCLENBQUMsVUFBa0I7UUFDL0MsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLHVCQUF1QixDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FDN0QsR0FBRyxDQUFDLENBQUMsUUFBc0IsRUFBRSxFQUFFO1lBQzdCLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFO2dCQUN0QyxPQUFPLElBQUksQ0FBQzthQUNiO1lBQ0QsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFD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Q0ssYUFBYSxDQUFDLE1BQWtDO1FBQ3RELElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDWCxPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLFFBQVEsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNyQixLQUFLLElBQUk7Z0JBQUU7b0JBQ1QsSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDMUI7Z0JBQUMsTUFBTTtZQUNSLEtBQUssUUFBUTtnQkFBRTtvQkFDYixJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUMzQjtnQkFBQyxNQUFNO1lBQ1IsS0FBSyxRQUFRO2dCQUFFO29CQUNiLElBQUksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQzNCO2dCQUFDLE1BQU07WUFDUixPQUFPLENBQUMsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDOzs7WUFwSUYsVUFBVTs7OztZQVRrQixRQUFRO1lBSzVCLGlCQUFpQjt5Q0FTckIsUUFBUSxZQUFJLE1BQU0sU0FBQyxTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3RvciwgTE9DQUxFX0lELCBPcHRpb25hbCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEJlZlJlcG9zaXRvcnksIFJlc3BvbnNlSW5mbyB9IGZyb20gXCJAZmFycmlzL2JlZlwiO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQsIFJlc3RmdWxTZXJ2aWNlLCBSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcbmltcG9ydCB7IEZlYXR1cmVSZXBvc2l0b3J5IH0gZnJvbSBcIi4vZmVhdHVyZS1yZXBvc2l0b3J5XCI7XHJcbmltcG9ydCB7IFByb3AgfSBmcm9tIFwiLi90eXBlc1wiO1xyXG5pbXBvcnQgeyBCYXNlUGF0aFNlcnZpY2UgfSBmcm9tIFwiQGZhcnJpcy9ydGZcIjtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZlYXR1cmVEYXRhU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogRmVhdHVyZVJlcG9zaXRvcnksXHJcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZD86IHN0cmluZ1xyXG4gICkge1xyXG4gICAgdGhpcy5sb2NhbGVJZCA9IHRoaXMubG9jYWxlSWQgfHwgJ3poLUNIUyc7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNrueJqeaWmWlk6I635Y+W54mp5paZ54m55b6B6aG55Y+K54m55b6B5YC877yI5YWs5YWx6buY6K6k5YC877yJXHJcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZaWRcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RmVhdHVyZXNCeU1hdGVyaWFsSWQobWF0ZXJpYWxJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9wLklSZXR1cm5WYWx1ZT4ge1xyXG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5nZXRGZWF0dXJlc0J5TWF0ZXJpYWxJZChtYXRlcmlhbElkKS5waXBlKFxyXG4gICAgICBtYXAoKHJlc3BvbnNlOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5yZXR1cm5WYWx1ZSkge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJldHVyblZhbHVlID0gSlNPTi5wYXJzZShyZXNwb25zZS5yZXR1cm5WYWx1ZSk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0OiBQcm9wLklSZXR1cm5WYWx1ZSA9IHsgcHJvcHNldDogW10sIHByb3BzOiBbXSB9O1xyXG4gICAgICAgIGNvbnN0IHByb3BzZXRzID0gcmV0dXJuVmFsdWUucHJvcHNldCB8fCBudWxsO1xyXG4gICAgICAgIGNvbnN0IHByb3BzID0gcmV0dXJuVmFsdWUucHJvcHMgfHwgbnVsbDtcclxuICAgICAgICBpZiAocHJvcHNldHMgJiYgQXJyYXkuaXNBcnJheShwcm9wc2V0cykpIHtcclxuICAgICAgICAgIHByb3BzZXRzLm1hcCgocHJvcHNldDogUHJvcC5JUHJvcFNldCkgPT4ge1xyXG4gICAgICAgICAgICBwcm9wc2V0Lm5hbWUgPSB0aGlzLnRyYW5zbGF0ZU5hbWUocHJvcHNldCk7XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9wc2V0O1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXN1bHQucHJvcHNldCA9IHByb3BzZXRzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocHJvcHMgJiYgQXJyYXkuaXNBcnJheShwcm9wcykgJiYgcHJvcHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgcHJvcHMubWFwKChwcm9wOiBQcm9wLklQcm9wKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIOWkhOeQhuWkmuivrVxyXG4gICAgICAgICAgICBwcm9wLm5hbWUgPSB0aGlzLnRyYW5zbGF0ZU5hbWUocHJvcCk7XHJcbiAgICAgICAgICAgIC8vIOWkhOeQhuaemuS4vlxyXG4gICAgICAgICAgICBpZiAocHJvcC5pbnB1dHR5cGUgPT09IFByb3AuSW5wdXRUeXBlLmVudW0gJiYgcHJvcC5lbnVtaW5mbykge1xyXG4gICAgICAgICAgICAgIHByb3AuZGF0YSA9IEpTT04ucGFyc2UocHJvcC5lbnVtaW5mbyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5aSE55CG5b+F5aGr5ZKM5Y+q6K+7XHJcbiAgICAgICAgICAgIHByb3AuaXNyZWFkb25seSA9IHByb3AuaXNyZWFkb25seSA9PT0gJzEnID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICBwcm9wLmlzcmVxdWlyZWQgPSBwcm9wLmlzcmVxdWlyZWQgPT09ICcxJyA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuIHByb3A7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHJlc3VsdC5wcm9wcyA9IHByb3BzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5qC55o2u54mp5paZaWTlj4rnianmlpnnibnlvoHkv53lrZjlkI7nmoRoYXNo6I635Y+W6K+l54mp5paZ5bey57uP5a2Y5YKo55qE54m55b6B6aG55YC8XHJcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZSWRcclxuICAgKiBAcGFyYW0gY29uZmlnSUQg5a+55bqU6K+l54mp5paZ55qE54m55b6B6aG5aGFzaFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGdldENvbmZpZ2VkVmFsdWVCeUZlYXR1cmVJZChtYXRlcmlhbElkOiBzdHJpbmcsIGNvbmZpZ0lEOiBzdHJpbmcsIGNvbmZpZ1R5cGU6IHN0cmluZyA9ICdNYXRlcmlhbHMnKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuZ2V0Q29uZmlnZWRWYWx1ZUJ5RmVhdHVyZUlkKG1hdGVyaWFsSWQsIGNvbmZpZ0lELCBjb25maWdUeXBlKS5waXBlKG1hcCgocmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmVzdWx0KTtcclxuICAgIH0pKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5L+d5a2Y54mp5paZ54m55b6B6aG5XHJcbiAgICogQHBhcmFtIG1hdGVyaWFsSWQg54mp5paZaWRcclxuICAgKiBAcGFyYW0gY2hhcmFjdFZhbHVlIOeJueW+geWAvFxyXG4gICAqIEBwYXJhbSBjb25maWdUeXBlIOmFjee9ruexu+Wei1xyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5RmVhdHVyZXMobWF0ZXJpYWxJZDogc3RyaW5nLCBjaGFyYWN0VmFsdWU6IGFueSwgY29uZmlnVHlwZTogc3RyaW5nID0gJ01hdGVyaWFscycpIHtcclxuICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuYXBwbHlGZWF0dXJlcyhtYXRlcmlhbElkLCBjaGFyYWN0VmFsdWUsIGNvbmZpZ1R5cGUpLnBpcGUobWFwKChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShjb25maWcpO1xyXG4gICAgfSkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDojrflj5bluK7liqnkv6Hmga9cclxuICAgKiBAcGFyYW0gaGVscGlkIOW4ruWKqWlkXHJcbiAgICogQHBhcmFtIGZpbHRlciDov4fmu6TmnaHku7ZcclxuICAgKiBAcGFyYW0gcGFyYW1zIOWPguaVsFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGdldEhlbHBJbmZvKGhlbHBpZDogc3RyaW5nLCBmaWx0ZXI6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgdXJsID0gQmFzZVBhdGhTZXJ2aWNlLmNvbnZlcnRQYXRoKCcvYXBpL3NjbS9zY21mbmQvdjEuMC9zY21jb21tb25jbXBzZXJ2aWNlL3NlcnZpY2UvZ2V0aGVscGRhdGEnKTtcclxuICAgIGNvbnN0IGh0dHBQYXJhbXM6IGFueSA9IHt9O1xyXG4gICAgaWYgKHBhcmFtcykge1xyXG4gICAgICBpZiAocGFyYW1zLnBhZ2VJbmRleCkge1xyXG4gICAgICAgIGh0dHBQYXJhbXNbJ3BhZ2VJbmRleCddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLnBhZ2VJbmRleCAtIDApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChwYXJhbXMucGFnZVNpemUpIHtcclxuICAgICAgICBodHRwUGFyYW1zWydwYWdlU2l6ZSddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLnBhZ2VTaXplIC0gMCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHBhcmFtcy5jb25kaXRpb24pIHtcclxuICAgICAgICBodHRwUGFyYW1zWydjb25kaXRpb24nXSA9IEpTT04uc3RyaW5naWZ5KHBhcmFtcy5jb25kaXRpb24pO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChwYXJhbXMuc2VhcmNoVmFsdWUpIHtcclxuICAgICAgICBodHRwUGFyYW1zWydzZWFyY2gnXSA9IHBhcmFtcy5zZWFyY2hWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgaGVscElEOiBoZWxwaWQsXHJcbiAgICAgIHF1ZXJ5UGFyYW06IEpTT04uc3RyaW5naWZ5KGh0dHBQYXJhbXMpLFxyXG4gICAgICBmaWx0ZXJTdHI6IGZpbHRlclxyXG4gICAgfTtcclxuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnk6IEJlZlJlcG9zaXRvcnk8YW55PiA9IG51bGw7Ly90aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgYm9keVxyXG4gICAgfTtcclxuICAgIHJldHVybiBiZWZSZXBvc2l0b3J5LnByb3h5LnJlcXVlc3QodXJsLCAncHV0JywgbnVsbCwgb3B0aW9ucykucGlwZShcclxuICAgICAgbWFwKChyZXN1bHQ6IGFueSkgPT4gSlNPTi5wYXJzZShyZXN1bHQpKVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Zu96ZmF5YyW54m55b6B6aG55oiW54m55b6B6ZuG5ZCN56ewXHJcbiAgICogQHBhcmFtIG9iamVjdCDnibnlvoHpm4bmiJbnibnlvoHpobnlr7nosaFcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdHJhbnNsYXRlTmFtZShvYmplY3Q6IFByb3AuSVByb3BTZXQgfCBQcm9wLklQcm9wKTogc3RyaW5nIHtcclxuICAgIGlmICghb2JqZWN0KSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgbGV0IG5hbWUgPSBudWxsO1xyXG4gICAgc3dpdGNoICh0aGlzLmxvY2FsZUlkKSB7XHJcbiAgICAgIGNhc2UgJ2VuJzoge1xyXG4gICAgICAgIG5hbWUgPSBvYmplY3RbJ25hbWVfZW4nXTtcclxuICAgICAgfSBicmVhaztcclxuICAgICAgY2FzZSAnemgtQ0hTJzoge1xyXG4gICAgICAgIG5hbWUgPSBvYmplY3RbJ25hbWVfY2hzJ107XHJcbiAgICAgIH0gYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3poLUNIVCc6IHtcclxuICAgICAgICBuYW1lID0gb2JqZWN0WyduYW1lX2NodCddO1xyXG4gICAgICB9IGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OiBuYW1lID0gb2JqZWN0WyduYW1lX2NocyddO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5hbWU7XHJcbiAgfVxyXG59XHJcbiJdfQ==
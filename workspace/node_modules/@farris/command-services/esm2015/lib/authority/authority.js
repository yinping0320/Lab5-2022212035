import { empty } from 'rxjs';
import { map } from 'rxjs/operators';
/**
 * 权限
 */
export class Authority {
    constructor() {
        this.operationLabelMap = new Map();
        this.authOfLabel = new Map();
    }
    /**
     * 设置label到operation id的映射
     * @param labelMap
     */
    setLabelMap(labelMap) {
        for (var i in labelMap) {
            this.operationLabelMap.set(i, labelMap[i]);
        }
        this.operationLabelMap.forEach((opId, label) => {
            this[label] = false;
        });
    }
    /**
     * 初始化权限的值
     */
    initialize(authorityService) {
        if (this.operationLabelMap && this.operationLabelMap.size > 0) {
            return authorityService.queryOperationAuthority(Array.from(this.operationLabelMap.values())).pipe(map((operationAuth) => {
                this.operationLabelMap.forEach((opId, label) => {
                    this.authOfLabel.set(label, operationAuth.has(opId) ? operationAuth.get(opId) : false);
                });
            }));
        }
        else {
            return empty();
        }
    }
    /**
     * 返回操作权限，即用户是否拥有Label所对应的权限
     * @param label 标签，可以是button id等
     */
    hasOperation(label) {
        return this.authOfLabel.has(label) && this.authOfLabel.get(label);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aG9yaXR5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2F1dGhvcml0eS9hdXRob3JpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFhLEtBQUssRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUN2QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFckM7O0dBRUc7QUFDSCxNQUFNLE9BQU8sU0FBUztJQUVsQjtRQUNJLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztRQUNuRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxFQUFtQixDQUFDO0lBQ2xELENBQUM7SUFZRDs7O09BR0c7SUFDTyxXQUFXLENBQUMsUUFBZ0I7UUFDbEMsS0FBSSxJQUFJLENBQUMsSUFBSSxRQUFRLEVBQUU7WUFDbkIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUM7UUFDRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQzNDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVLENBQUMsZ0JBQWtDO1FBQ3pDLElBQUcsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEdBQUMsQ0FBQyxFQUFFO1lBQ3hELE9BQU8sZ0JBQWdCLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDN0YsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7b0JBQzNDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDM0YsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FDTCxDQUFDO1NBQ0w7YUFBSTtZQUNELE9BQU8sS0FBSyxFQUFFLENBQUM7U0FDbEI7SUFDTCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsWUFBWSxDQUFDLEtBQVk7UUFDckIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0RSxDQUFDO0NBSUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBdXRob3JpdHlTZXJ2aWNlIH0gZnJvbSAnLi9hdXRob3JpdHkuc2VydmljZSc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZSwgZW1wdHl9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG4vKipcclxuICog5p2D6ZmQXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQXV0aG9yaXR5IHtcclxuICAgIFxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25MYWJlbE1hcCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgdGhpcy5hdXRoT2ZMYWJlbCA9IG5ldyBNYXA8c3RyaW5nLCBib29sZWFuPigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5LuObGFiZWzliLDmk43kvZzmnYPpmZBJROeahOaYoOWwhO+8jGxhYmVs5Y+v5Lul5pivYnV0dG9uIGlk562JXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgb3BlcmF0aW9uTGFiZWxNYXA6IE1hcDxzdHJpbmcsIHN0cmluZz47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDorrDlvZVsYWJlbOWvueS6jueahOaTjeS9nOadg+mZkO+8jOaYr+WQpumAmui/h1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGF1dGhPZkxhYmVsOiBNYXA8c3RyaW5nLCBib29sZWFuPjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rmxhYmVs5Yiwb3BlcmF0aW9uIGlk55qE5pig5bCEXHJcbiAgICAgKiBAcGFyYW0gbGFiZWxNYXAgXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBzZXRMYWJlbE1hcChsYWJlbE1hcDogT2JqZWN0KSB7XHJcbiAgICAgICAgZm9yKHZhciBpIGluIGxhYmVsTWFwKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3BlcmF0aW9uTGFiZWxNYXAuc2V0KGksIGxhYmVsTWFwW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25MYWJlbE1hcC5mb3JFYWNoKChvcElkLCBsYWJlbCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzW2xhYmVsXSA9IGZhbHNlO1xyXG4gICAgICAgIH0pOyAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICog5Yid5aeL5YyW5p2D6ZmQ55qE5YC8XHJcbiAgICAgKi9cclxuICAgIGluaXRpYWxpemUoYXV0aG9yaXR5U2VydmljZTogQXV0aG9yaXR5U2VydmljZSk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgICAgIGlmKHRoaXMub3BlcmF0aW9uTGFiZWxNYXAgJiYgdGhpcy5vcGVyYXRpb25MYWJlbE1hcC5zaXplPjApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eVNlcnZpY2UucXVlcnlPcGVyYXRpb25BdXRob3JpdHkoQXJyYXkuZnJvbSh0aGlzLm9wZXJhdGlvbkxhYmVsTWFwLnZhbHVlcygpKSkucGlwZShcclxuICAgICAgICAgICAgICAgIG1hcCgob3BlcmF0aW9uQXV0aCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlcmF0aW9uTGFiZWxNYXAuZm9yRWFjaCgob3BJZCwgbGFiZWwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoT2ZMYWJlbC5zZXQobGFiZWwsIG9wZXJhdGlvbkF1dGguaGFzKG9wSWQpID8gb3BlcmF0aW9uQXV0aC5nZXQob3BJZCkgOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICByZXR1cm4gZW1wdHkoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57mk43kvZzmnYPpmZDvvIzljbPnlKjmiLfmmK/lkKbmi6XmnIlMYWJlbOaJgOWvueW6lOeahOadg+mZkFxyXG4gICAgICogQHBhcmFtIGxhYmVsIOagh+etvu+8jOWPr+S7peaYr2J1dHRvbiBpZOetiVxyXG4gICAgICovXHJcbiAgICBoYXNPcGVyYXRpb24obGFiZWw6c3RyaW5nKSB7ICAgICAgICBcclxuICAgICAgICByZXR1cm4gdGhpcy5hdXRoT2ZMYWJlbC5oYXMobGFiZWwpICYmIHRoaXMuYXV0aE9mTGFiZWwuZ2V0KGxhYmVsKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyDov5Tlm57lrZfmrrXmnYPpmZBcclxuICAgIC8vIGhhc0ZpZWxkKGZpZWxkOnN0cmluZylcclxufSJdfQ==
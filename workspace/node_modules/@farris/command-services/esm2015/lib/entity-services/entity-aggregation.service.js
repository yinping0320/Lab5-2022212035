import { Injectable } from '@angular/core';
import { FrameContext, BindingList } from '@farris/devkit';
import { EntityTraversingService } from './entity-traversing.service';
/**
 * 实体聚合服务
 */
class EntityAggregationService {
    constructor(frameContext) {
        this.frameContext = frameContext;
        this.traversingService = this.frameContext.injector.get(EntityTraversingService);
    }
    get bindingData() {
        return this.frameContext.bindingData;
    }
    /**
     * 获取path对应列表记录的条数
     */
    count(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        return entityListData.length;
    }
    /**
     * 获取path对应字段的和
     */
    sum(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        const total = entityListData.reduce((accTotal, entityData) => {
            let propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));
            propValue = isNaN(propValue) ? 0 : propValue;
            accTotal += propValue;
            return accTotal;
        }, 0);
        return total;
    }
    /**
     * 获取path对应字段的平均值
     */
    avg(path) {
        const count = this.count(path);
        const total = this.sum(path);
        return count !== 0 ? total / count : 0;
    }
    /**
     * 获取path对应字段的最大值
     */
    max(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        const max = entityListData.reduce((accMax, entityData) => {
            const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMax || propValue > accMax)) {
                accMax = propValue;
            }
            return accMax;
        }, null);
        return max ? max : 0;
    }
    /**
     * 获取path对应字段的最小值
     */
    min(path) {
        const splitedPath = this.splitPath(path);
        const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);
        const min = entityListData.reduce((accMin, entityData) => {
            const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));
            if (isNaN(propValue) === false && (!accMin || propValue < accMin)) {
                accMin = propValue;
            }
            return accMin;
        }, null);
        return min ? min : 0;
    }
    /**
     * 获取属性值
     */
    getPropValue(entityData, path) {
        let currentData = entityData;
        path.forEach((pathItem) => {
            // 提前退出的都重置为null，主要针对关联对象未赋值场景
            if (!currentData) {
                currentData = null;
                return;
            }
            currentData = currentData[pathItem];
        });
        return currentData;
    }
    /**
     * 分隔路径，分隔符列表路径和属性路径
     * @return 形如 {parentListPath: [], propertyPath: []}
     */
    splitPath(path) {
        const listPath = path.concat([]);
        const propPath = [];
        let currentNode = this.bindingData.getValue(listPath);
        while (currentNode instanceof BindingList !== true) {
            const propPathItem = listPath.pop();
            if (!propPathItem) {
                return;
            }
            propPath.unshift(propPathItem);
            currentNode = this.bindingData.getValue(listPath);
        }
        return {
            listPath: listPath,
            propPath: propPath
        };
    }
}
EntityAggregationService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
EntityAggregationService.ctorParameters = () => [
    { type: FrameContext }
];
export { EntityAggregationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LWFnZ3JlZ2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZW50aXR5LXNlcnZpY2VzL2VudGl0eS1hZ2dyZWdhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBZSxXQUFXLEVBQWlCLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFPdEU7O0dBRUc7QUFDSCxNQUNNLHdCQUF3QjtJQVE1QixZQUFvQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUM1QyxJQUFJLENBQUMsaUJBQWlCLEdBQUssSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUEwQix1QkFBdUIsQ0FBQyxDQUFDO0lBQzlHLENBQUM7SUFSRCxJQUFZLFdBQVc7UUFDckIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQztJQUN2QyxDQUFDO0lBUUQ7O09BRUc7SUFDSSxLQUFLLENBQUMsSUFBYztRQUN6QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEYsT0FBTyxjQUFjLENBQUMsTUFBTSxDQUFDO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNJLEdBQUcsQ0FBQyxJQUFjO1FBQ3ZCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFD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LFVBQWUsRUFBRSxJQUFjO1FBQ2xELElBQUksV0FBVyxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBZ0IsRUFBRSxFQUFFO1lBRWhDLDhCQUE4QjtZQUM5QixJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNoQixXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUNuQixPQUFPO2FBQ1I7WUFDRCxXQUFXLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVEOzs7T0FHRztJQUNLLFNBQVMsQ0FBQyxJQUFjO1FBQzlCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakMsTUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RELE9BQU8sV0FBVyxZQUFZLFdBQVcsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3BDLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQ2pCLE9BQU87YUFDUjtZQUNELFFBQVEsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDL0IsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsT0FBTztZQUNMLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFFBQVEsRUFBRSxRQUFRO1NBQ25CLENBQUM7SUFDSixDQUFDOzs7WUF4SEYsVUFBVTs7OztZQVhGLFlBQVk7O0FBdUlyQixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRnJhbWVDb250ZXh0LCBCaW5kaW5nRGF0YSwgQmluZGluZ0xpc3QsIEJpbmRpbmdPYmplY3QgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEVudGl0eVRyYXZlcnNpbmdTZXJ2aWNlIH0gZnJvbSAnLi9lbnRpdHktdHJhdmVyc2luZy5zZXJ2aWNlJztcclxuXHJcbmludGVyZmFjZSBTcGxpdGVkUGF0aCB7XHJcbiAgbGlzdFBhdGg6IHN0cmluZ1tdO1xyXG4gIHByb3BQYXRoOiBzdHJpbmdbXTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOWunuS9k+iBmuWQiOacjeWKoVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5jbGFzcyBFbnRpdHlBZ2dyZWdhdGlvblNlcnZpY2Uge1xyXG5cclxuICBwcml2YXRlIGdldCBiaW5kaW5nRGF0YSgpOiBCaW5kaW5nRGF0YSB7XHJcbiAgICByZXR1cm4gdGhpcy5mcmFtZUNvbnRleHQuYmluZGluZ0RhdGE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHRyYXZlcnNpbmdTZXJ2aWNlOiBFbnRpdHlUcmF2ZXJzaW5nU2VydmljZTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCkge1xyXG4gICAgdGhpcy50cmF2ZXJzaW5nU2VydmljZSAgID0gdGhpcy5mcmFtZUNvbnRleHQuaW5qZWN0b3IuZ2V0PEVudGl0eVRyYXZlcnNpbmdTZXJ2aWNlPihFbnRpdHlUcmF2ZXJzaW5nU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU5YiX6KGo6K6w5b2V55qE5p2h5pWwXHJcbiAgICovXHJcbiAgcHVibGljIGNvdW50KHBhdGg6IHN0cmluZ1tdKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XHJcbiAgICBjb25zdCBlbnRpdHlMaXN0RGF0YSA9IHRoaXMudHJhdmVyc2luZ1NlcnZpY2UuZ2V0RW50aXR5TGlzdERhdGEoc3BsaXRlZFBhdGgubGlzdFBhdGgpO1xyXG4gICAgcmV0dXJuIGVudGl0eUxpc3REYXRhLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTlkoxcclxuICAgKi9cclxuICBwdWJsaWMgc3VtKHBhdGg6IHN0cmluZ1tdKSB7XHJcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xyXG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcclxuXHJcbiAgICBjb25zdCB0b3RhbCA9IGVudGl0eUxpc3REYXRhLnJlZHVjZSgoYWNjVG90YWw6IG51bWJlciwgZW50aXR5RGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGxldCBwcm9wVmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMuZ2V0UHJvcFZhbHVlKGVudGl0eURhdGEsIHNwbGl0ZWRQYXRoLnByb3BQYXRoKSk7XHJcbiAgICAgIHByb3BWYWx1ZSA9IGlzTmFOKHByb3BWYWx1ZSkgPyAwIDogcHJvcFZhbHVlO1xyXG4gICAgICBhY2NUb3RhbCArPSBwcm9wVmFsdWU7XHJcbiAgICAgIHJldHVybiBhY2NUb3RhbDtcclxuICAgIH0sIDApO1xyXG4gICAgcmV0dXJuIHRvdGFsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+WcGF0aOWvueW6lOWtl+auteeahOW5s+Wdh+WAvFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhdmcocGF0aDogc3RyaW5nW10pIHtcclxuICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jb3VudChwYXRoKTtcclxuICAgIGNvbnN0IHRvdGFsID0gdGhpcy5zdW0ocGF0aCk7XHJcbiAgICByZXR1cm4gY291bnQgIT09IDAgPyB0b3RhbCAvIGNvdW50IDogMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlnBhdGjlr7nlupTlrZfmrrXnmoTmnIDlpKflgLxcclxuICAgKi9cclxuICBwdWJsaWMgbWF4KHBhdGg6IHN0cmluZ1tdKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHNwbGl0ZWRQYXRoID0gdGhpcy5zcGxpdFBhdGgocGF0aCk7XHJcbiAgICBjb25zdCBlbnRpdHlMaXN0RGF0YSA9IHRoaXMudHJhdmVyc2luZ1NlcnZpY2UuZ2V0RW50aXR5TGlzdERhdGEoc3BsaXRlZFBhdGgubGlzdFBhdGgpO1xyXG5cclxuICAgIGNvbnN0IG1heCA9ICBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY01heDogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xyXG4gICAgICBpZiAoaXNOYU4ocHJvcFZhbHVlKSA9PT0gZmFsc2UgJiYgKCAhYWNjTWF4IHx8IHByb3BWYWx1ZSA+IGFjY01heCkpIHtcclxuICAgICAgICBhY2NNYXggPSBwcm9wVmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGFjY01heDtcclxuICAgIH0sIG51bGwpO1xyXG4gICAgcmV0dXJuIG1heCA/IG1heCA6IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZwYXRo5a+55bqU5a2X5q6155qE5pyA5bCP5YC8XHJcbiAgICovXHJcbiAgcHVibGljIG1pbihwYXRoOiBzdHJpbmdbXSk6IG51bWJlciB7XHJcbiAgICBjb25zdCBzcGxpdGVkUGF0aCA9IHRoaXMuc3BsaXRQYXRoKHBhdGgpO1xyXG4gICAgY29uc3QgZW50aXR5TGlzdERhdGEgPSB0aGlzLnRyYXZlcnNpbmdTZXJ2aWNlLmdldEVudGl0eUxpc3REYXRhKHNwbGl0ZWRQYXRoLmxpc3RQYXRoKTtcclxuXHJcbiAgICBjb25zdCBtaW4gPSBlbnRpdHlMaXN0RGF0YS5yZWR1Y2UoKGFjY01pbjogbnVtYmVyLCBlbnRpdHlEYXRhOiBhbnkpID0+IHtcclxuICAgICAgY29uc3QgcHJvcFZhbHVlID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BWYWx1ZShlbnRpdHlEYXRhLCBzcGxpdGVkUGF0aC5wcm9wUGF0aCkpO1xyXG4gICAgICBpZiAoaXNOYU4ocHJvcFZhbHVlKSA9PT0gZmFsc2UgJiYgKCAhYWNjTWluIHx8IHByb3BWYWx1ZSA8IGFjY01pbikpIHtcclxuICAgICAgICBhY2NNaW4gPSBwcm9wVmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGFjY01pbjtcclxuICAgIH0sIG51bGwpO1xyXG4gICAgcmV0dXJuIG1pbiA/IG1pbiA6IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5blsZ7mgKflgLxcclxuICAgKi9cclxuICBwcml2YXRlIGdldFByb3BWYWx1ZShlbnRpdHlEYXRhOiBhbnksIHBhdGg6IHN0cmluZ1tdKSB7XHJcbiAgICBsZXQgY3VycmVudERhdGEgPSBlbnRpdHlEYXRhO1xyXG4gICAgcGF0aC5mb3JFYWNoKChwYXRoSXRlbTogc3RyaW5nKSA9PiB7XHJcblxyXG4gICAgICAvLyDmj5DliY3pgIDlh7rnmoTpg73ph43nva7kuLpudWxs77yM5Li76KaB6ZKI5a+55YWz6IGU5a+56LGh5pyq6LWL5YC85Zy65pmvXHJcbiAgICAgIGlmICghY3VycmVudERhdGEpIHtcclxuICAgICAgICBjdXJyZW50RGF0YSA9IG51bGw7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGN1cnJlbnREYXRhID0gY3VycmVudERhdGFbcGF0aEl0ZW1dO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGN1cnJlbnREYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5YiG6ZqU6Lev5b6E77yM5YiG6ZqU56ym5YiX6KGo6Lev5b6E5ZKM5bGe5oCn6Lev5b6EXHJcbiAgICogQHJldHVybiDlvaLlpoIge3BhcmVudExpc3RQYXRoOiBbXSwgcHJvcGVydHlQYXRoOiBbXX1cclxuICAgKi9cclxuICBwcml2YXRlIHNwbGl0UGF0aChwYXRoOiBzdHJpbmdbXSk6IFNwbGl0ZWRQYXRoIHtcclxuICAgIGNvbnN0IGxpc3RQYXRoID0gcGF0aC5jb25jYXQoW10pO1xyXG4gICAgY29uc3QgcHJvcFBhdGggPSBbXTtcclxuICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuYmluZGluZ0RhdGEuZ2V0VmFsdWUobGlzdFBhdGgpO1xyXG4gICAgd2hpbGUgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgQmluZGluZ0xpc3QgIT09IHRydWUpIHtcclxuICAgICAgY29uc3QgcHJvcFBhdGhJdGVtID0gbGlzdFBhdGgucG9wKCk7XHJcbiAgICAgIGlmICghcHJvcFBhdGhJdGVtKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHByb3BQYXRoLnVuc2hpZnQocHJvcFBhdGhJdGVtKTtcclxuICAgICAgY3VycmVudE5vZGUgPSB0aGlzLmJpbmRpbmdEYXRhLmdldFZhbHVlKGxpc3RQYXRoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsaXN0UGF0aDogbGlzdFBhdGgsXHJcbiAgICAgIHByb3BQYXRoOiBwcm9wUGF0aFxyXG4gICAgfTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgeyBFbnRpdHlBZ2dyZWdhdGlvblNlcnZpY2UgfTtcclxuIl19
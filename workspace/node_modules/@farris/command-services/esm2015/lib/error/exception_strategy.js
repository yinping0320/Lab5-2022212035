import { Optional } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { LanguageService } from '../languag.service';
import { DeviceAbility } from '../util/device-ability';
import moment from 'moment';
/**
 * 异常处理基类
 */
export class ExceptionStrategy {
    constructor(messagerService, languageService) {
        this.messagerService = messagerService;
        this.languageService = languageService;
    }
}
/** @nocollapse */
ExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 信息级别异常处理
 */
export class InfoExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.messagerService.info(error.Message);
    }
}
/** @nocollapse */
InfoExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 警告级别异常处理
 */
export class WarningExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.messagerService.warning(error.Message);
    }
}
/** @nocollapse */
WarningExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 错误级别异常处理
 */
export class ErrorExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
        this.langService = null;
        this.langService = languageService;
        if (!this.langService) {
            this.langService = new LanguageService();
        }
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.handleErrorLevel(error);
    }
    handleErrorLevel(error) {
        const exceptionMsg = error.Message || '';
        const date = error.date || new Date();
        const localDate = moment(date).format('YYYY-MM-DD HH:mm:ss');
        const detail = error.Detail || `${error.Message}\r\n发生时间：${localDate}\r\n详细信息：${error.innerMessage}` || '';
        const innerMessage = error.innerMessage || null;
        let bsModalRef;
        const options = {
            // title: this.languageService.serverNotifyTitle,
            showMaxButton: false,
            buttons: [
                {
                    text: this.langService.roger,
                    cls: 'btn btn-primary btn-lg',
                    handle: () => {
                        bsModalRef.close();
                    }
                }
            ],
            // showHeader: false,
            width: 440,
            height: 200,
            safeHtml: false,
            exception: {
                date: localDate,
                message: innerMessage,
                copyButton: {
                    text: this.langService.copy,
                    onClick: (e) => {
                        const result = DeviceAbility.copyToClipboard(detail);
                        const text = result ? this.langService.copySuccess : this.langService.copyFailed;
                        bsModalRef.content.showMiniNotify(text, 1500);
                    }
                }
            }
        };
        this.displayError(error);
        bsModalRef = this.messagerService.show('exception', exceptionMsg, options);
    }
    /**
     * 在控制台中显示错误信息
     */
    displayError(error) {
        if (!error) {
            return;
        }
        if (!console || !console.error) {
            return;
        }
        console.error(error);
    }
}
/** @nocollapse */
ErrorExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
/**
 * 致命错误级别异常处理
 */
export class FatalExceptionStrategy extends ExceptionStrategy {
    constructor(messagerService, languageService) {
        super(messagerService, languageService);
    }
    handleException(error) {
        if (!error) {
            return;
        }
        this.messagerService.error(error.Message);
    }
}
/** @nocollapse */
FatalExceptionStrategy.ctorParameters = () => [
    { type: MessagerService },
    { type: LanguageService, decorators: [{ type: Optional }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjZXB0aW9uX3N0cmF0ZWd5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2Vycm9yL2V4Y2VwdGlvbl9zdHJhdGVneS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFckQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBSXZELE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQVM1Qjs7R0FFRztBQUNILE1BQU0sT0FBTyxpQkFBaUI7SUFDNUIsWUFDUyxlQUFnQyxFQUNwQixlQUFnQztRQUQ1QyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFDcEIsb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBQ3JELENBQUM7Ozs7WUF2Qk0sZUFBZTtZQUNmLGVBQWUsdUJBcUJuQixRQUFROztBQUliOztHQUVHO0FBQ0gsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGlCQUFpQjtJQUMxRCxZQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO1FBQzVDLEtBQUssQ0FBQyxlQUFlLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVNLGVBQWUsQ0FBQyxLQUE0QjtRQUNqRCxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNDLENBQUM7Ozs7WUExQ00sZUFBZTtZQUNmLGVBQWUsdUJBK0JuQixRQUFROztBQWNiOztHQUVHO0FBQ0gsTUFBTSxPQUFPLHdCQUF5QixTQUFRLGlCQUFpQjtJQUM3RCxZQUNFLGVBQWdDLEVBQ3BCLGVBQWdDO1FB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LFdBQVcsRUFBRSxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUNEOztPQUVHO0lBQ0ssWUFBWSxDQUFDLEtBQTRCO1FBQy9DLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRTtZQUM5QixPQUFPO1NBQ1I7UUFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7Ozs7WUE3SU0sZUFBZTtZQUNmLGVBQWUsdUJBd0VuQixRQUFROztBQXVFYjs7R0FFRztBQUNILE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxpQkFBaUI7SUFDM0QsWUFDRSxlQUFnQyxFQUNwQixlQUFnQztRQUM1QyxLQUFLLENBQUMsZUFBZSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFTSxlQUFlLENBQUMsS0FBNEI7UUFDakQsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1QyxDQUFDOzs7O1lBaEtNLGVBQWU7WUFDZixlQUFlLHVCQXFKbkIsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vbGFuZ3VhZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU2VydmVyRXhjZXB0aW9uRW50aXR5IH0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB7IERldmljZUFiaWxpdHkgfSBmcm9tICcuLi91dGlsL2RldmljZS1hYmlsaXR5JztcclxuaW1wb3J0IHsgQnNNb2RhbFJlZiB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4uL2Zvcm0tbm90aWZ5LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGcmFtZUNvbnRleHQgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcclxuLyoqXHJcbiAqIOW8guW4uOWkhOeQhuaOpeWPo1xyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBJRXhjZXB0aW9uU3RyYXRlZ3kge1xyXG4gIGhhbmRsZUV4Y2VwdGlvbihlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5KTogdm9pZDtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiDlvILluLjlpITnkIbln7rnsbtcclxuICovXHJcbmV4cG9ydCBjbGFzcyBFeGNlcHRpb25TdHJhdGVneSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDkv6Hmga/nuqfliKvlvILluLjlpITnkIZcclxuICovXHJcbmV4cG9ydCBjbGFzcyBJbmZvRXhjZXB0aW9uU3RyYXRlZ3kgZXh0ZW5kcyBFeGNlcHRpb25TdHJhdGVneSBpbXBsZW1lbnRzIElFeGNlcHRpb25TdHJhdGVneSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBtZXNzYWdlclNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIGxhbmd1YWdlU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICBzdXBlcihtZXNzYWdlclNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFuZGxlRXhjZXB0aW9uKGVycm9yOiBTZXJ2ZXJFeGNlcHRpb25FbnRpdHkpOiB2b2lkIHtcclxuICAgIGlmICghZXJyb3IpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubWVzc2FnZXJTZXJ2aWNlLmluZm8oZXJyb3IuTWVzc2FnZSk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIOitpuWRiue6p+WIq+W8guW4uOWkhOeQhlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFdhcm5pbmdFeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgIHN1cGVyKG1lc3NhZ2VyU2VydmljZSwgbGFuZ3VhZ2VTZXJ2aWNlKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xyXG4gICAgaWYgKCFlcnJvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2Uud2FybmluZyhlcnJvci5NZXNzYWdlKTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4vKipcclxuICog6ZSZ6K+v57qn5Yir5byC5bi45aSE55CGXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRXJyb3JFeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcclxuICBwcml2YXRlIGxhbmdTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UgPSBudWxsO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSkge1xyXG4gICAgc3VwZXIobWVzc2FnZXJTZXJ2aWNlLCBsYW5ndWFnZVNlcnZpY2UpO1xyXG4gICAgdGhpcy5sYW5nU2VydmljZSA9IGxhbmd1YWdlU2VydmljZTtcclxuICAgIGlmICghdGhpcy5sYW5nU2VydmljZSkge1xyXG4gICAgICB0aGlzLmxhbmdTZXJ2aWNlID0gbmV3IExhbmd1YWdlU2VydmljZSgpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIHB1YmxpYyBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xyXG4gICAgaWYgKCFlcnJvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5oYW5kbGVFcnJvckxldmVsKGVycm9yKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlRXJyb3JMZXZlbChlcnJvcjogU2VydmVyRXhjZXB0aW9uRW50aXR5KTogdm9pZCB7XHJcbiAgICBjb25zdCBleGNlcHRpb25Nc2cgPSBlcnJvci5NZXNzYWdlIHx8ICcnO1xyXG4gICAgY29uc3QgZGF0ZSA9IGVycm9yLmRhdGUgfHwgbmV3IERhdGUoKTtcclxuICAgIGNvbnN0IGxvY2FsRGF0ZSA9IG1vbWVudChkYXRlKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKTtcclxuICAgIGNvbnN0IGRldGFpbCA9IGVycm9yLkRldGFpbCB8fCBgJHtlcnJvci5NZXNzYWdlfVxcclxcbuWPkeeUn+aXtumXtO+8miR7bG9jYWxEYXRlfVxcclxcbuivpue7huS/oeaBr++8miR7ZXJyb3IuaW5uZXJNZXNzYWdlfWAgfHwgJyc7XHJcblxyXG4gICAgY29uc3QgaW5uZXJNZXNzYWdlID0gZXJyb3IuaW5uZXJNZXNzYWdlIHx8IG51bGw7XHJcbiAgICBsZXQgYnNNb2RhbFJlZjogQnNNb2RhbFJlZjtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgIC8vIHRpdGxlOiB0aGlzLmxhbmd1YWdlU2VydmljZS5zZXJ2ZXJOb3RpZnlUaXRsZSxcclxuICAgICAgc2hvd01heEJ1dHRvbjogZmFsc2UsXHJcbiAgICAgIGJ1dHRvbnM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0ZXh0OiB0aGlzLmxhbmdTZXJ2aWNlLnJvZ2VyLFxyXG4gICAgICAgICAgY2xzOiAnYnRuIGJ0bi1wcmltYXJ5IGJ0bi1sZycsXHJcbiAgICAgICAgICBoYW5kbGU6ICgpID0+IHtcclxuICAgICAgICAgICAgYnNNb2RhbFJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXSxcclxuICAgICAgLy8gc2hvd0hlYWRlcjogZmFsc2UsXHJcbiAgICAgIHdpZHRoOiA0NDAsXHJcbiAgICAgIGhlaWdodDogMjAwLFxyXG4gICAgICBzYWZlSHRtbDogZmFsc2UsXHJcbiAgICAgIGV4Y2VwdGlvbjoge1xyXG4gICAgICAgIGRhdGU6IGxvY2FsRGF0ZSxcclxuICAgICAgICBtZXNzYWdlOiBpbm5lck1lc3NhZ2UsXHJcbiAgICAgICAgY29weUJ1dHRvbjoge1xyXG4gICAgICAgICAgdGV4dDogdGhpcy5sYW5nU2VydmljZS5jb3B5LFxyXG4gICAgICAgICAgb25DbGljazogKGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gRGV2aWNlQWJpbGl0eS5jb3B5VG9DbGlwYm9hcmQoZGV0YWlsKTtcclxuICAgICAgICAgICAgY29uc3QgdGV4dCA9IHJlc3VsdCA/IHRoaXMubGFuZ1NlcnZpY2UuY29weVN1Y2Nlc3MgOiB0aGlzLmxhbmdTZXJ2aWNlLmNvcHlGYWlsZWQ7XHJcbiAgICAgICAgICAgIGJzTW9kYWxSZWYuY29udGVudC5zaG93TWluaU5vdGlmeSh0ZXh0LCAxNTAwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICB0aGlzLmRpc3BsYXlFcnJvcihlcnJvcik7XHJcbiAgICBic01vZGFsUmVmID0gdGhpcy5tZXNzYWdlclNlcnZpY2Uuc2hvdygnZXhjZXB0aW9uJywgZXhjZXB0aW9uTXNnLCBvcHRpb25zKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Zyo5o6n5Yi25Y+w5Lit5pi+56S66ZSZ6K+v5L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkaXNwbGF5RXJyb3IoZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSkge1xyXG4gICAgaWYgKCFlcnJvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWNvbnNvbGUgfHwgIWNvbnNvbGUuZXJyb3IpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog6Ie05ZG96ZSZ6K+v57qn5Yir5byC5bi45aSE55CGXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRmF0YWxFeGNlcHRpb25TdHJhdGVneSBleHRlbmRzIEV4Y2VwdGlvblN0cmF0ZWd5IGltcGxlbWVudHMgSUV4Y2VwdGlvblN0cmF0ZWd5IHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIG1lc3NhZ2VyU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgbGFuZ3VhZ2VTZXJ2aWNlOiBMYW5ndWFnZVNlcnZpY2UpIHtcclxuICAgIHN1cGVyKG1lc3NhZ2VyU2VydmljZSwgbGFuZ3VhZ2VTZXJ2aWNlKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBoYW5kbGVFeGNlcHRpb24oZXJyb3I6IFNlcnZlckV4Y2VwdGlvbkVudGl0eSk6IHZvaWQge1xyXG4gICAgaWYgKCFlcnJvcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tZXNzYWdlclNlcnZpY2UuZXJyb3IoZXJyb3IuTWVzc2FnZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
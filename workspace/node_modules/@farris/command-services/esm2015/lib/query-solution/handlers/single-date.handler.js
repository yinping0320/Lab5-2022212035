import { CompareType } from '../enum/compare-type.enum';
import { ValueType } from '../enum/value-type.enum';
import { RelationType } from '../enum/relation-type.enum';
import { format, addDays, addWeeks, addMonths, addYears, startOfMonth, endOfMonth, startOfYear, endOfYear, startOfWeek, endOfWeek, getDay } from 'date-fns';
function getDate(dateValue, dtvFormat) {
    let today = new Date();
    // today.toLocaleString()
    let result = [];
    //首先判断哪些是单个日期，使用equal存入一个日期即可
    if (dateValue.isFirstDay || dateValue.isLastDay) {
        let switchValue = dateValue.dateType + '-' + (dateValue.isFirstDay ? 'first' : 'last');
        switch (switchValue) {
            case 'week-first':
                if (getDay(today) === 0) {
                    today = addDays(today, -1);
                }
                result.push(addDays(startOfWeek(today), 1));
                break;
            case 'week-last':
                if (getDay(today) === 0) {
                    today = addDays(today, -1);
                }
                result.push(addDays(endOfWeek(today), 1));
                break;
            case 'month-first':
                result.push(startOfMonth(today));
                break;
            case 'month-last':
                result.push(endOfMonth(today));
                break;
            case 'year-first':
                result.push(startOfYear(today));
                break;
            case 'year-last':
                result.push(endOfYear(today));
                break;
            default:
                result.push(today);
        }
    }
    else if (dateValue.dateType === 'day' && dateValue.period === 'present') {
        //今天
        result.push(today);
    }
    else if (dateValue.dateType === 'day' && dateValue.count === 1) {
        //昨天、明天
        let _date = addDays(today, dateValue.period === 'future' ? 1 : -1);
        result.push(_date);
    }
    else if (dateValue.period === 'present') {
        //本周、本月、本年
        switch (dateValue.dateType) {
            case 'week':
                result.push(startOfWeek(today), endOfWeek(today));
                break;
            case 'month':
                result.push(startOfMonth(today), endOfMonth(today));
                break;
            case 'year':
                result.push(startOfYear(today), endOfYear(today));
                break;
            default:
                result.push(today);
        }
    }
    else {
        let switchValue = dateValue.dateType + '-' + dateValue.period;
        switch (switchValue) {
            case 'day-previous':
                result.push(addDays(today, dateValue.count * -1), addDays(today, -1));
                break;
            case 'day-future':
                result.push(addDays(today, 1), addDays(today, dateValue.count));
                break;
            case 'week-previous':
                result.push(addWeeks(today, dateValue.count * -1), addDays(today, -1));
                break;
            case 'week-future':
                result.push(addDays(today, 1), addWeeks(today, dateValue.count));
                break;
            case 'month-previous':
                result.push(addMonths(today, dateValue.count * -1), addDays(today, -1));
                break;
            case 'month-future':
                result.push(addDays(today, 1), addMonths(today, dateValue.count));
                break;
            case 'year-previous':
                result.push(addYears(today, dateValue.count * -1), addDays(today, -1));
                break;
            case 'year-future':
                result.push(addDays(today, 1), addYears(today, dateValue.count));
                break;
            default:
                result.push(today);
        }
    }
    result = result.map(item => format(item, dtvFormat.returnFormat || 'yyyy-MM-dd'));
    return result;
}
;
export class SingleDateHandler {
    convert(qc) {
        const arr = [];
        const dtv = qc.value;
        if (typeof (dtv.dateValue) !== 'string') {
            let _dateValue = getDate(dtv.dateValue, qc.control);
            _dateValue.length === 1 && arr.push({
                'FilterField': qc.fieldCode,
                'Compare': qc.compareType ? CompareType[qc.compareType] : CompareType.Equal,
                'Value': _dateValue[0],
                'Relation': qc.relation ? RelationType[qc.relation] : RelationType.And,
                'Expresstype': ValueType.Value,
                'Lbracket': qc.Lbracket || null,
                'Rbracket': qc.Rbracket || null
            });
            _dateValue.length === 2 && arr.push({
                'FilterField': qc.fieldCode,
                'Compare': CompareType.GreaterOrEqual,
                'Value': _dateValue[0],
                'Relation': RelationType.And,
                'Expresstype': ValueType.Value,
                'Lbracket': qc.Lbracket ? (qc.Lbracket + '(') : '('
            }, {
                'FilterField': qc.fieldCode,
                'Compare': CompareType.LessOrEqual,
                'Value': _dateValue[1],
                'Relation': RelationType.And,
                'Expresstype': ValueType.Value,
                'Rbracket': qc.Rbracket ? (qc.Rbracket + ')') : ')'
            });
        }
        else {
            arr.push({
                'FilterField': qc.fieldCode,
                'Compare': (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,
                'Value': dtv.dateValue,
                'Relation': (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,
                'Expresstype': ValueType.Value,
                'Lbracket': qc.Lbracket || null,
                'Rbracket': qc.Rbracket || null
            });
        }
        return arr;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2luZ2xlLWRhdGUuaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9xdWVyeS1zb2x1dGlvbi9oYW5kbGVycy9zaW5nbGUtZGF0ZS5oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzFELE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUMzSixTQUFTLE9BQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUztJQUNqQyxJQUFJLEtBQUssR0FBRyxJQUFJLElBQUksRUFBRSxDQUFBO0lBQ3RCLHlCQUF5QjtJQUN6QixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDZiw2QkFBNkI7SUFDN0IsSUFBSSxTQUFTLENBQUMsVUFBVSxJQUFJLFNBQVMsQ0FBQyxTQUFTLEVBQUU7UUFFN0MsSUFBSSxXQUFXLEdBQUcsU0FBUyxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3RGLFFBQVEsV0FBVyxFQUFFO1lBQ2pCLEtBQUssWUFBWTtnQkFDYixJQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBQ3BCLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENB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V0FBVyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsS0FBSztnQkFDekYsT0FBTyxFQUFHLEdBQUcsQ0FBQyxTQUFTO2dCQUN2QixVQUFVLEVBQUcsQ0FBQyxFQUFFLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBQyxRQUFRLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHO2dCQUNoRixhQUFhLEVBQUMsU0FBUyxDQUFDLEtBQUs7Z0JBQzdCLFVBQVUsRUFBRSxFQUFFLENBQUMsUUFBUSxJQUFJLElBQUk7Z0JBQy9CLFVBQVUsRUFBRSxFQUFFLENBQUMsUUFBUSxJQUFJLElBQUk7YUFDbEMsQ0FBQyxDQUFBO1NBQ0w7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElRdWVyeUNvbmRpdGlvbkhhbmRsZXIgfSBmcm9tIFwiLi9pcXVlcnljb25kaXRpb24uaGFuZGxlclwiO1xyXG5pbXBvcnQgeyBRdWVyeUNvbmRpdGlvbiwgU2luZ2xlRGF0ZVZhbHVlIH0gZnJvbSBcIkBmYXJyaXMvY29tcG9uZW50LXF1ZXJ5Y29uZGl0aW9uXCI7XHJcbmltcG9ydCB7IENvbXBhcmVUeXBlIH0gZnJvbSAnLi4vZW51bS9jb21wYXJlLXR5cGUuZW51bSc7XHJcbmltcG9ydCB7IFZhbHVlVHlwZSB9IGZyb20gJy4uL2VudW0vdmFsdWUtdHlwZS5lbnVtJztcclxuaW1wb3J0IHsgUmVsYXRpb25UeXBlIH0gZnJvbSAnLi4vZW51bS9yZWxhdGlvbi10eXBlLmVudW0nO1xyXG5pbXBvcnQgeyBmb3JtYXQsIGFkZERheXMsIGFkZFdlZWtzLCBhZGRNb250aHMsIGFkZFllYXJzLCBzdGFydE9mTW9udGgsIGVuZE9mTW9udGgsIHN0YXJ0T2ZZZWFyLCBlbmRPZlllYXIsIHN0YXJ0T2ZXZWVrLCBlbmRPZldlZWssIGdldERheSB9IGZyb20gJ2RhdGUtZm5zJ1xyXG5mdW5jdGlvbiBnZXREYXRlKGRhdGVWYWx1ZSwgZHR2Rm9ybWF0KSB7XHJcbiAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpXHJcbiAgICAvLyB0b2RheS50b0xvY2FsZVN0cmluZygpXHJcbiAgICBsZXQgcmVzdWx0ID0gW11cclxuICAgIC8v6aaW5YWI5Yik5pat5ZOq5Lqb5piv5Y2V5Liq5pel5pyf77yM5L2/55SoZXF1YWzlrZjlhaXkuIDkuKrml6XmnJ/ljbPlj69cclxuICAgIGlmIChkYXRlVmFsdWUuaXNGaXJzdERheSB8fCBkYXRlVmFsdWUuaXNMYXN0RGF5KSB7XHJcblxyXG4gICAgICAgIGxldCBzd2l0Y2hWYWx1ZSA9IGRhdGVWYWx1ZS5kYXRlVHlwZSArICctJyArIChkYXRlVmFsdWUuaXNGaXJzdERheSA/ICdmaXJzdCcgOiAnbGFzdCcpXHJcbiAgICAgICAgc3dpdGNoIChzd2l0Y2hWYWx1ZSkge1xyXG4gICAgICAgICAgICBjYXNlICd3ZWVrLWZpcnN0JzpcclxuICAgICAgICAgICAgICAgIGlmKGdldERheSh0b2RheSkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0b2RheSA9IGFkZERheXModG9kYXksIC0xKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkRGF5cyhzdGFydE9mV2Vlayh0b2RheSksIDEpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3dlZWstbGFzdCc6XHJcbiAgICAgICAgICAgICAgICBpZihnZXREYXkodG9kYXkpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9kYXkgPSBhZGREYXlzKHRvZGF5LCAtMSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZERheXMoZW5kT2ZXZWVrKHRvZGF5KSwgMSkpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbW9udGgtZmlyc3QnOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3RhcnRPZk1vbnRoKHRvZGF5KSlcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdtb250aC1sYXN0JzpcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGVuZE9mTW9udGgodG9kYXkpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3llYXItZmlyc3QnOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3RhcnRPZlllYXIodG9kYXkpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3llYXItbGFzdCc6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChlbmRPZlllYXIodG9kYXkpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0b2RheSlcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChkYXRlVmFsdWUuZGF0ZVR5cGUgPT09ICdkYXknICYmIGRhdGVWYWx1ZS5wZXJpb2QgPT09ICdwcmVzZW50Jykge1xyXG4gICAgICAgIC8v5LuK5aSpXHJcbiAgICAgICAgcmVzdWx0LnB1c2godG9kYXkpXHJcbiAgICB9IGVsc2UgaWYgKGRhdGVWYWx1ZS5kYXRlVHlwZSA9PT0gJ2RheScgJiYgZGF0ZVZhbHVlLmNvdW50ID09PSAxKSB7XHJcbiAgICAgICAgLy/mmKjlpKnjgIHmmI7lpKlcclxuICAgICAgICBsZXQgX2RhdGUgPSBhZGREYXlzKHRvZGF5LCBkYXRlVmFsdWUucGVyaW9kID09PSAnZnV0dXJlJyA/IDEgOiAtMSlcclxuICAgICAgICByZXN1bHQucHVzaChfZGF0ZSlcclxuICAgIH0gZWxzZSBpZiAoZGF0ZVZhbHVlLnBlcmlvZCA9PT0gJ3ByZXNlbnQnKSB7XHJcbiAgICAgICAgLy/mnKzlkajjgIHmnKzmnIjjgIHmnKzlubRcclxuICAgICAgICBzd2l0Y2ggKGRhdGVWYWx1ZS5kYXRlVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICd3ZWVrJzpcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0YXJ0T2ZXZWVrKHRvZGF5KSwgZW5kT2ZXZWVrKHRvZGF5KSlcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdtb250aCc6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzdGFydE9mTW9udGgodG9kYXkpLCBlbmRPZk1vbnRoKHRvZGF5KSlcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd5ZWFyJzpcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0YXJ0T2ZZZWFyKHRvZGF5KSwgZW5kT2ZZZWFyKHRvZGF5KSlcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godG9kYXkpXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHN3aXRjaFZhbHVlID0gZGF0ZVZhbHVlLmRhdGVUeXBlICsgJy0nICsgZGF0ZVZhbHVlLnBlcmlvZFxyXG4gICAgICAgIHN3aXRjaCAoc3dpdGNoVmFsdWUpIHtcclxuICAgICAgICAgICAgY2FzZSAnZGF5LXByZXZpb3VzJzpcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZERheXModG9kYXksIGRhdGVWYWx1ZS5jb3VudCAqIC0xKSwgYWRkRGF5cyh0b2RheSwgLTEpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RheS1mdXR1cmUnOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkRGF5cyh0b2RheSwgMSksIGFkZERheXModG9kYXksIGRhdGVWYWx1ZS5jb3VudCkpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnd2Vlay1wcmV2aW91cyc6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhZGRXZWVrcyh0b2RheSwgZGF0ZVZhbHVlLmNvdW50ICogLTEpLCBhZGREYXlzKHRvZGF5LCAtMSkpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnd2Vlay1mdXR1cmUnOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkRGF5cyh0b2RheSwgMSksIGFkZFdlZWtzKHRvZGF5LCBkYXRlVmFsdWUuY291bnQpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoLXByZXZpb3VzJzpcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZE1vbnRocyh0b2RheSwgZGF0ZVZhbHVlLmNvdW50ICogLTEpLCBhZGREYXlzKHRvZGF5LCAtMSkpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbW9udGgtZnV0dXJlJzpcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZERheXModG9kYXksIDEpLCBhZGRNb250aHModG9kYXksIGRhdGVWYWx1ZS5jb3VudCkpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAneWVhci1wcmV2aW91cyc6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhZGRZZWFycyh0b2RheSwgZGF0ZVZhbHVlLmNvdW50ICogLTEpLCBhZGREYXlzKHRvZGF5LCAtMSkpXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAneWVhci1mdXR1cmUnOlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkRGF5cyh0b2RheSwgMSksIGFkZFllYXJzKHRvZGF5LCBkYXRlVmFsdWUuY291bnQpKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0b2RheSlcclxuICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzdWx0ID0gcmVzdWx0Lm1hcChpdGVtID0+IGZvcm1hdChpdGVtLCBkdHZGb3JtYXQucmV0dXJuRm9ybWF0IHx8ICd5eXl5LU1NLWRkJykpXHJcbiAgICByZXR1cm4gcmVzdWx0XHJcblxyXG59O1xyXG5leHBvcnQgY2xhc3MgU2luZ2xlRGF0ZUhhbmRsZXIgaW1wbGVtZW50cyBJUXVlcnlDb25kaXRpb25IYW5kbGVye1xyXG4gICAgY29udmVydChxYzogUXVlcnlDb25kaXRpb24pIHtcclxuICAgICAgICBjb25zdCBhcnIgPSBbXVxyXG4gICAgICAgIGNvbnN0IGR0diA9IChxYy52YWx1ZSBhcyBTaW5nbGVEYXRlVmFsdWUpO1xyXG4gICAgICAgIGlmKHR5cGVvZihkdHYuZGF0ZVZhbHVlKSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgbGV0IF9kYXRlVmFsdWUgPSBnZXREYXRlKGR0di5kYXRlVmFsdWUsIHFjLmNvbnRyb2wpXHJcbiAgICAgICAgICAgIF9kYXRlVmFsdWUubGVuZ3RoID09PSAxICYmIGFyci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICdGaWx0ZXJGaWVsZCcgOiBxYy5maWVsZENvZGUsXHJcbiAgICAgICAgICAgICAgICAnQ29tcGFyZScgOiBxYy5jb21wYXJlVHlwZSA/IENvbXBhcmVUeXBlW3FjLmNvbXBhcmVUeXBlXSA6IENvbXBhcmVUeXBlLkVxdWFsLFxyXG4gICAgICAgICAgICAgICAgJ1ZhbHVlJyA6IF9kYXRlVmFsdWVbMF0sXHJcbiAgICAgICAgICAgICAgICAnUmVsYXRpb24nIDogcWMucmVsYXRpb24gPyBSZWxhdGlvblR5cGVbcWMucmVsYXRpb25dIDogUmVsYXRpb25UeXBlLkFuZCwgLy9hbmQgdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAnRXhwcmVzc3R5cGUnOlZhbHVlVHlwZS5WYWx1ZSxcclxuICAgICAgICAgICAgICAgICdMYnJhY2tldCc6IHFjLkxicmFja2V0IHx8IG51bGwsXHJcbiAgICAgICAgICAgICAgICAnUmJyYWNrZXQnOiBxYy5SYnJhY2tldCB8fCBudWxsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF9kYXRlVmFsdWUubGVuZ3RoID09PSAyICYmIGFyci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICdGaWx0ZXJGaWVsZCcgOiBxYy5maWVsZENvZGUsXHJcbiAgICAgICAgICAgICAgICAnQ29tcGFyZScgOiBDb21wYXJlVHlwZS5HcmVhdGVyT3JFcXVhbCwgLy9HcmVhdGVyT3JFcXVhbFxyXG4gICAgICAgICAgICAgICAgJ1ZhbHVlJyA6IF9kYXRlVmFsdWVbMF0sXHJcbiAgICAgICAgICAgICAgICAnUmVsYXRpb24nIDogUmVsYXRpb25UeXBlLkFuZCwgLy9hbmRcclxuICAgICAgICAgICAgICAgICdFeHByZXNzdHlwZSc6IFZhbHVlVHlwZS5WYWx1ZSxcclxuICAgICAgICAgICAgICAgICdMYnJhY2tldCc6IHFjLkxicmFja2V0ID8gKHFjLkxicmFja2V0ICsgJygnKSA6JygnXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICdGaWx0ZXJGaWVsZCcgOiBxYy5maWVsZENvZGUsXHJcbiAgICAgICAgICAgICAgICAnQ29tcGFyZScgOiBDb21wYXJlVHlwZS5MZXNzT3JFcXVhbCwgLy9MZXNzT3JFcXVhbFxyXG4gICAgICAgICAgICAgICAgJ1ZhbHVlJyA6IF9kYXRlVmFsdWVbMV0sXHJcbiAgICAgICAgICAgICAgICAnUmVsYXRpb24nIDogUmVsYXRpb25UeXBlLkFuZCwvL2FuZFxyXG4gICAgICAgICAgICAgICAgJ0V4cHJlc3N0eXBlJzogVmFsdWVUeXBlLlZhbHVlLFxyXG4gICAgICAgICAgICAgICAgJ1JicmFja2V0JzogcWMuUmJyYWNrZXQgPyAocWMuUmJyYWNrZXQgKyAnKScpIDogJyknXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhcnIucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAnRmlsdGVyRmllbGQnIDogcWMuZmllbGRDb2RlLFxyXG4gICAgICAgICAgICAgICAgJ0NvbXBhcmUnIDogKHFjLmNvbXBhcmVUeXBlIHx8IHFjLmNvbXBhcmVUeXBlID09PSAwKSA/IHFjLmNvbXBhcmVUeXBlIDogQ29tcGFyZVR5cGUuRXF1YWwsXHJcbiAgICAgICAgICAgICAgICAnVmFsdWUnIDogZHR2LmRhdGVWYWx1ZSxcclxuICAgICAgICAgICAgICAgICdSZWxhdGlvbicgOiAocWMucmVsYXRpb24gfHwgcWMucmVsYXRpb24gPT09IDApID8gcWMucmVsYXRpb24gOiBSZWxhdGlvblR5cGUuQW5kLCAvL2FuZCB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICdFeHByZXNzdHlwZSc6VmFsdWVUeXBlLlZhbHVlLFxyXG4gICAgICAgICAgICAgICAgJ0xicmFja2V0JzogcWMuTGJyYWNrZXQgfHwgbnVsbCxcclxuICAgICAgICAgICAgICAgICdSYnJhY2tldCc6IHFjLlJicmFja2V0IHx8IG51bGxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFycjtcclxuICAgIH1cclxufSJdfQ==
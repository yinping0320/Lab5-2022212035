import { Injectable } from '@angular/core';
import { ViewModel } from '@farris/devkit';
import { FilterConditionService } from '../filter-condition.service';
import { CommandService } from '../command-service';
class FilterConditionDataService {
    constructor(viewModel, filterConditionService, commandService) {
        this.viewModel = viewModel;
        this.filterConditionService = filterConditionService;
        this.commandService = commandService;
    }
    /**
     * 执行过滤
     * @param commandName 命令名称
     * @param frameId 命令所在的frameId
     */
    filter(commandName, frameId) {
        const self = this;
        let filters = self.context && self.context.eventParam && self.context.eventParam.data || [];
        if (typeof (filters) === 'string') {
            filters = JSON.parse(filters);
        }
        // 查询时重置页码为第一页
        this.viewModel.frameContext.repository.entityCollection.pageIndex = 1;
        this.viewModel.frameContext.repository.filterConditionManager.setConditions(this.viewModel.bindingPath, filters);
        return this.commandService.execute(commandName, frameId);
    }
}
FilterConditionDataService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FilterConditionDataService.ctorParameters = () => [
    { type: ViewModel },
    { type: FilterConditionService },
    { type: CommandService }
];
export { FilterConditionDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWNvbmRpdGlvbi1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL2NvbW1hbmQtc2VydmljZXMvIiwic291cmNlcyI6WyJsaWIvZGF0YS1zZXJ2aWNlcy9maWx0ZXItY29uZGl0aW9uLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFcEQsTUFDTSwwQkFBMEI7SUFDNUIsWUFDWSxTQUFvQixFQUNwQixzQkFBOEMsRUFDOUMsY0FBOEI7UUFGOUIsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtJQUN0QyxDQUFDO0lBRUw7Ozs7T0FJRztJQUNJLE1BQU0sQ0FBQyxXQUFtQixFQUFFLE9BQWU7UUFDOUMsTUFBTSxJQUFJLEdBQVEsSUFBSSxDQUFDO1FBQ3ZCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUM1RixJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxRQUFRLEVBQUU7WUFDL0IsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDakM7UUFDRCxjQUFjO1FBQ2QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNqSCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM3RCxDQUFDOzs7WUF2QkosVUFBVTs7OztZQUpGLFNBQVM7WUFDVCxzQkFBc0I7WUFDdEIsY0FBYzs7QUEyQnZCLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZWwgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IEZpbHRlckNvbmRpdGlvblNlcnZpY2UgfSBmcm9tICcuLi9maWx0ZXItY29uZGl0aW9uLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDb21tYW5kU2VydmljZSB9IGZyb20gJy4uL2NvbW1hbmQtc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmNsYXNzIEZpbHRlckNvbmRpdGlvbkRhdGFTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgdmlld01vZGVsOiBWaWV3TW9kZWwsXHJcbiAgICAgICAgcHJpdmF0ZSBmaWx0ZXJDb25kaXRpb25TZXJ2aWNlOiBGaWx0ZXJDb25kaXRpb25TZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgY29tbWFuZFNlcnZpY2U6IENvbW1hbmRTZXJ2aWNlXHJcbiAgICApIHsgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5omn6KGM6L+H5rukXHJcbiAgICAgKiBAcGFyYW0gY29tbWFuZE5hbWUg5ZG95Luk5ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gZnJhbWVJZCDlkb3ku6TmiYDlnKjnmoRmcmFtZUlkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBmaWx0ZXIoY29tbWFuZE5hbWU6IHN0cmluZywgZnJhbWVJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcclxuICAgICAgICBsZXQgZmlsdGVycyA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbS5kYXRhIHx8IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgKGZpbHRlcnMpID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBmaWx0ZXJzID0gSlNPTi5wYXJzZShmaWx0ZXJzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5p+l6K+i5pe26YeN572u6aG156CB5Li656ys5LiA6aG1XHJcbiAgICAgICAgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5wYWdlSW5kZXggPSAxO1xyXG4gICAgICAgIHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5yZXBvc2l0b3J5LmZpbHRlckNvbmRpdGlvbk1hbmFnZXIuc2V0Q29uZGl0aW9ucyh0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aCwgZmlsdGVycyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWFuZFNlcnZpY2UuZXhlY3V0ZShjb21tYW5kTmFtZSwgZnJhbWVJZCk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IHsgRmlsdGVyQ29uZGl0aW9uRGF0YVNlcnZpY2UgfTtcclxuIl19
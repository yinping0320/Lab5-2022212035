import { Injectable, Injector } from '@angular/core';
import { ViewModel, Repository, Entity, AppContext, EntityList } from '@farris/devkit';
import { from, EMPTY, concat, of, Subject, throwError } from 'rxjs';
import { concatMap, catchError, tap, switchMap, last, map, delay, takeLast } from 'rxjs/operators';
import { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';
import { DateTimeHelperService } from '@farris/ui-common/date';
import { ComponentManagerService } from './component-manager.service';
import { FormLoadingService } from './form-loading/form-loading.service';
import { LanguageService } from './languag.service';
import { FormNotifyService } from './form-notify.service';
import { UploadService } from '@gsp-svc/formdoc-upload';
import { FormErrorService } from './error';
// tslint:disable: max-line-length
/**
 * 批量编辑服务
 */
export class BatchEditService {
    constructor(injector, componentManagerService, viewModel, repository, batchEditDialogService, dateService, languageService, formNotifyService, fileUploadService) {
        this.injector = injector;
        this.componentManagerService = componentManagerService;
        this.viewModel = viewModel;
        this.repository = repository;
        this.batchEditDialogService = batchEditDialogService;
        this.dateService = dateService;
        this.languageService = languageService;
        this.formNotifyService = formNotifyService;
        this.fileUploadService = fileUploadService;
        this.formLoadingService = this.injector.get(FormLoadingService, null);
        if (!this.languageService) {
            this.languageService = LanguageService.getInstance();
        }
        if (!this.formNotifyService) {
            this.formNotifyService = this.injector.get(FormNotifyService, null);
        }
        this.onHelpClose = new Subject();
        this.onHelpClose.subscribe(result => {
            const { frameId = '', mapFields = '', data = [] } = result || {};
            this.onHelpCloseHandler(frameId, mapFields, data);
        });
    }
    get formErrorService() {
        return this.injector && this.injector.get(FormErrorService, null);
    }
    /**
     * 打开批量编辑对话框
     * @param frameId frameId
     */
    openBatchEditDialog(frameId, enableDictPicking = false) {
        if (!frameId) {
            throw new Error('frameId is required.');
        }
        if (typeof enableDictPicking === 'string') {
            enableDictPicking = (enableDictPicking === 'true' ? true : false);
        }
        if (this.batchEditDialogService) {
            let columns = [];
            if (this.viewModel) {
                const gridFrameContext = this.viewModel.frameContext.root.appContext.frameContextManager.getFrameContextById(frameId);
                const gridViewModel = gridFrameContext.viewModel;
                if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumnsName')) {
                    // tslint:disable-next-line: no-string-literal
                    const gridColumnsAttrName = gridViewModel['dataGridColumnsName'];
                    columns = gridViewModel[gridColumnsAttrName];
                }
                else if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumns')) {
                    columns = gridViewModel['dataGridColumns'];
                }
                const ids = gridViewModel.uiState['ids'] || [];
                if (!ids || ids.length < 1) {
                    this.formNotifyService.warning(this.languageService.plsCheckBatchEditRows, { hideTitle: true });
                    return EMPTY;
                }
                const dialogRef = this.batchEditDialogService.batchEdit(columns, {
                    rows: ids.length,
                    enableDictPicking,
                    onConfirm: (inputs) => {
                        if (Array.isArray(ids) && ids.length > 0) {
                            // console.log('openBatchEditDialog', inputs);
                            const appContext = this.viewModel.frameContext.appContext;
                            appContext.changeDetectionController.detach();
                            inputs.forEach(input => {
                                this.updateBindingData(input, ids);
                            });
                            appContext.changeDetectionController.reattach();
                        }
                        dialogRef.close();
                    }
                });
            }
        }
    }
    /**
     * 打开隐藏帮助
     * @param helpId 帮助id
     */
    openHiddenHelp(helpId) {
        if (!helpId) {
            throw new Error('Argument error,helpId can`t be empty');
        }
        const componentManagerService = this.componentManagerService.getControl(helpId);
        if (componentManagerService) {
            componentManagerService.showDialog();
        }
        else {
            throw new Error(`the component which id is ${helpId} can't be found!`);
        }
    }
    /**
     * 清空帮助勾选（只能挂载到帮助前事件）
     */
    clearHelpSelections() {
        const self = this;
        const helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;
        if (helpElement) {
            helpElement.displayValue = '';
        }
    }
    /**
     * 勾选当前行
     * @param frameId frameId
     * @param mapFields 字段映射
     * @param primaryKeyValue 帮助主键字段
     */
    checkCurrentRow(frameId, mapFields, primaryKeyValue) {
        const self = this;
        const helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;
        if (!primaryKeyValue) {
            primaryKeyValue = 'id';
        }
        const mappings = JSON.parse(mapFields);
        if (helpElement) {
            frameId = frameId || this.viewModel.frameContext.frameId;
            if (frameId) {
                const frameContext = this.getFrameContextById(frameId);
                if (frameContext) {
                    const bindingPath = frameContext.viewModel.bindingPath;
                    if (bindingPath) {
                        const bindingPaths = bindingPath.split('/').filter(p => p);
                        const bindingList = frameContext.bindingData.getValue(bindingPaths);
                        const currentRow = bindingList.currentItem;
                        const path = mappings[primaryKeyValue];
                        if (path) {
                            const value = this.getValueByPath(currentRow, path);
                            helpElement.displayValue = value;
                        }
                    }
                }
            }
        }
    }
    /**
     * 以帮助勾选数据作为依据，批量新增主表数据
     * @param frameId 主表所在frame的id
     * @param mapFields 帮助字段与主表字段映射
     * @description 以帮助勾选数据作为依据，批量新增主表数据
     */
    batchAppend(frameId, mapFields) {
        const self = this;
        const result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        if (result && Array.isArray(result) && result.length > 0) {
            const mappings = JSON.parse(mapFields);
            // 不是bindingPath则按frameId处理
            let bindingPath = '/';
            const appContext = this.injector.get(AppContext, null);
            if (appContext) {
                const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
                if (frameContext) {
                    bindingPath = frameContext.viewModel.bindingPath || '/';
                }
                else {
                    throw new Error('frameId is invalid!');
                }
            }
            const defaultValues = [];
            result.forEach((item) => {
                const defaultValue = {};
                Object.keys(mappings).forEach((prop) => {
                    const value = this.getValueByPath(item, prop);
                    const fields = mappings[prop];
                    const groups = fields.split(',').filter(p => p);
                    groups.forEach(group => {
                        const paths = group.split('.').filter(p => p);
                        this.setValueByPath(defaultValue, paths.join('.'), value);
                    });
                });
                defaultValues.push(defaultValue);
            });
            this.formLoadingService.show();
            return this.repository.batchAppend(defaultValues).pipe(tap(() => this.formLoadingService.hide()), map(() => true));
        }
        return of(true);
    }
    /**
     * 以帮助勾选数据作为依据，批量新增从表/从从表
     * @param frameId 从表/从从表所在frame的id
     * @param mapFields 帮助字段与从表/从从表字段映射
     * @description 以帮助勾选数据作为依据，批量新增从表/从从表
     */
    batchAppendByPathBasedOnHelpSelections(frameId, mapFields) {
        const self = this;
        const result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        if (result && Array.isArray(result) && result.length > 0) {
            const mappings = JSON.parse(mapFields);
            // 不是bindingPath则按frameId处理
            let bindingPath = '/';
            const appContext = this.injector.get(AppContext, null);
            if (appContext) {
                const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
                if (frameContext) {
                    bindingPath = frameContext.viewModel.bindingPath || '/';
                }
                else {
                    throw new Error('frameId is invalid!');
                }
            }
            const defaultValues = [];
            result.forEach((item) => {
                const defaultValue = {};
                Object.keys(mappings).forEach((prop) => {
                    const value = this.getValueByPath(item, prop);
                    const fields = mappings[prop];
                    const groups = fields.split(',').filter(p => p);
                    groups.forEach(group => {
                        const paths = group.split('.').filter(p => p);
                        this.setValueByPath(defaultValue, paths.join('.'), value);
                    });
                });
                defaultValues.push(defaultValue);
            });
            this.formLoadingService.show();
            const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
            return this.repository.batchAppendByPath(path, defaultValues).pipe(tap(() => this.formLoadingService.hide()), map(() => true));
        }
        return of(true);
    }
    /**
     * 批量新增带附件的从表或从从表数据
     * @param frameId
     * @param mapFields
     * @param attachmentInfoFieldPath 附件udt字段路径，可支持多个，以逗号分隔
     * @param rootId 附件存储根目录
     * @param path 附件存储目录
     * @description 批量新增带附件的从表或从从表数据与批量新增从表从从表数据一致，在批量新增数据的基础上增加了附件复制
     * @todo 目前附件复制在前端调用，会发起多个请求，且存在安全问题，后续应在vo集成
     */
    batchAppendByPathWithAttachment(frameId, mapFields, attachmentInfoFieldPath, rootId, path) {
        const self = this;
        const result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        if (!attachmentInfoFieldPath) {
            throw new Error('附件udt字段路径不能为空');
        }
        if (result && Array.isArray(result) && result.length > 0) {
            const mappings = JSON.parse(mapFields);
            let bindingPath = '/';
            const appContext = this.injector.get(AppContext, null);
            // 修正bindingPath
            if (appContext) {
                const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
                if (frameContext) {
                    bindingPath = frameContext.viewModel.bindingPath || '/';
                }
                else {
                    throw new Error('frameId is invalid!');
                }
            }
            // 处理附件udt字段
            const attachmentFields = attachmentInfoFieldPath.split(',').filter(p => p).map(path => path.split('/').pop());
            this.formLoadingService.show();
            // 先复制附件
            const copyFiles$ = from(result).pipe(concatMap((item => {
                return this.copyRowFiles(item, attachmentFields, rootId, path).pipe(catchError((error) => {
                    this.formLoadingService.hide();
                    let cafError = error.error;
                    if (typeof cafError === 'string') {
                        cafError = JSON.parse(cafError);
                    }
                    if (this.formErrorService) {
                        this.formErrorService.exception(cafError.message || this.languageService.copyFailed, error);
                    }
                    return throwError(error);
                }));
            })));
            return copyFiles$.pipe(takeLast(1)).pipe(switchMap(() => {
                // 拼装默认值
                const defaultValues = this.buildDefaultValues(result, mappings);
                const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                return this.repository.batchAppendByPath(path, defaultValues).pipe(tap(() => this.formLoadingService.hide()), map(() => true));
            }));
        }
        return of(true);
    }
    /**
     * 构造默认值数组
     * @param selectedValues
     * @param mapFields
     * @returns
     */
    buildDefaultValues(selectedValues, mapFields) {
        const defaultValues = [];
        selectedValues.forEach((item) => {
            const defaultValue = {};
            Object.keys(mapFields).forEach((prop) => {
                // 帮助数据
                const value = this.getValueByPath(item, prop);
                // 目标字段
                const fields = mapFields[prop];
                const groups = fields.split(',').filter(p => p);
                groups.forEach(group => {
                    const paths = group.split('.').filter(p => p);
                    this.setValueByPath(defaultValue, paths.join('.'), value);
                });
            });
            defaultValues.push(defaultValue);
        });
        return defaultValues;
    }
    /**
     * 复制行中所有附件
     * @param row
     * @param attachmentFields
     * @param rootId
     * @param path
     * @returns
     */
    copyRowFiles(row, attachmentFields, rootId, path) {
        return from(attachmentFields).pipe(concatMap((field) => {
            const attachmentId = this.getValueByPath(row, `${field}.attachmentId`);
            if (attachmentId) {
                // 发送复制附件的请求，获取附件id
                return this.fileUploadService.copyFile(attachmentId, rootId, path).pipe(tap((attachmentId) => {
                    // 复制成功
                    this.setValueByPath(row, [field, 'attachmentId'].join('.'), attachmentId);
                }));
            }
            else {
                return of(null);
            }
        }));
    }
    /**
     * 行内帮助多选批量新增或替换子表数据
     * @param frameId frameId, optional,为空时使用命令执行时所在的上下文
     * @param mapFields 字段映射
     * @param primaryKey 帮助主键字段，默认为id
     * @returns
     */
    batchAppendBasedOnRowHelpSelections(frameId, mapFields) {
        const self = this;
        let result = self.context && self.context.eventParam || [];
        if (!mapFields) {
            return of(true);
        }
        const mappings = JSON.parse(mapFields);
        if (!mappings || !mappings.hasOwnProperty('id')) {
            return of(true);
        }
        frameId = frameId || this.viewModel.frameContext.frameId;
        if (!frameId) {
            return of(true);
        }
        const frameContext = this.getFrameContextById(frameId);
        if (!frameContext) {
            return of(true);
        }
        setTimeout(() => {
            this.endEdit(frameContext).subscribe(() => {
                setTimeout(() => {
                    if (result && Array.isArray(result) && result.length > 0) {
                        const bindingPath = frameContext.viewModel.bindingPath || '/';
                        const bindingPaths = bindingPath.split('/').filter(p => p);
                        const defaultValues = [];
                        // 获取当前行
                        const bindingList = frameContext.bindingData.getValue(bindingPaths);
                        const currentRow = bindingList.currentItem;
                        const currentRowId = bindingList.currentId;
                        const currentEntity = this.getEntityByPath(frameContext, bindingPaths, currentRowId);
                        const headItem = result[0];
                        // 如果仅勾选一条，则应替换当前行的映射
                        if (result.length === 1) {
                            // this.mappingRow(headItem, mappings, currentEntity, bindingPath);
                            const data = headItem;
                            Object.keys(mappings).forEach((prop) => {
                                const value = this.getValueByPath(data, prop);
                                const fields = mappings[prop];
                                const groups = fields.split(',').filter(p => p);
                                groups.forEach(group => {
                                    const paths = group.split('.').filter(p => p);
                                    frameContext.bindingData.setValue(bindingPaths.concat(paths), value, true, true);
                                });
                            });
                            return of(true);
                        }
                        else {
                            const idMapField = mappings['id'];
                            const sourceItemId = this.getValueByPath(currentEntity, idMapField);
                            // 如果当前行没有映射或勾选结果中找不到当前行的映射
                            if (!sourceItemId || result.findIndex(item => item[bindingList.primaryKey] === sourceItemId) === -1) {
                                // 重新映射当前行
                                this.mappingRow(headItem, mappings, currentEntity, bindingPath);
                                result = result.slice(1);
                            }
                            else if (sourceItemId) {
                                const index = result.findIndex(item => item[bindingList.primaryKey] === sourceItemId);
                                // 重新映射当前行
                                this.mappingRow(result[index], mappings, currentEntity, bindingPath);
                                result.splice(index, 1);
                            }
                            // 当前行处理完成
                            // 处理未映射的行
                            const emptyRows = bindingList.toArray().filter(bindingObject => {
                                const id = this.getValueByPath(bindingObject, mappings[bindingList.primaryKey]);
                                return !id;
                            });
                            if (emptyRows && emptyRows.length > 0) {
                                let rows = result;
                                if (result.length > emptyRows.length) {
                                    rows = result.slice(0, emptyRows.length);
                                    result = result.slice(emptyRows.length);
                                }
                                else {
                                    result = [];
                                }
                                rows.forEach((item, index) => {
                                    const targetItem = emptyRows[index];
                                    const entity = this.getEntityByPath(frameContext, bindingPaths, targetItem.primaryKeyValue);
                                    this.mappingRow(item, mappings, entity, bindingPath);
                                });
                            }
                            // 处理剩余勾选
                            result.forEach((item) => {
                                const defaultValue = {};
                                Object.keys(mappings).forEach((prop) => {
                                    const value = this.getValueByPath(item, prop);
                                    const fields = mappings[prop];
                                    const groups = fields.split(',').filter(p => p);
                                    groups.forEach(group => {
                                        const paths = group.split('.').filter(p => p);
                                        this.setValueByPath(defaultValue, paths.join('.'), value);
                                    });
                                });
                                defaultValues.push(defaultValue);
                            });
                            if (defaultValues.length > 0) {
                                this.formLoadingService.show();
                                const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                                this.repository.batchAppendByPath(path, defaultValues).pipe(tap(() => this.formLoadingService.hide())).subscribe();
                            }
                        }
                    }
                }, 350);
            });
        }, 50);
        return of(true);
    }
    /**
     * 复制主表数据
     * @param id 要复制的数据id
     * @param fields 要复制的字段
     * @description 仅支持复制主表数据
     * @deprecated 该方法已被废弃，请使用clone方法替代。
     */
    copy(id) {
        if (!id) {
            this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            return EMPTY;
        }
        const befRepository = this.repository;
        const baseUri = befRepository.restService.baseUri;
        const url = `${baseUri}/service/copymainobjvoaction`;
        const requestInfo = befRepository.restService.buildRequestInfo();
        const body = {
            requestInfo,
            dataID: id
        };
        const options = {
            body
        };
        this.formLoadingService.show();
        return befRepository.proxy.request(url, 'PUT', null, options).pipe(tap(() => {
            this.formLoadingService.hide();
        }), map((responseInfo) => {
            const returnValue = responseInfo.returnValue;
            const entity = this.repository.buildEntity(returnValue);
            this.repository.entityCollection.addEntity(entity);
            return entity;
        }));
    }
    /**
     * 复制数据（支持主表、从表、从从表）
     * @param id 要复制的行
     * @param path 请求路径
     * @returns
     */
    clone(id, path) {
        if (!id) {
            this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            return EMPTY;
        }
        if (!path) {
            this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });
            return EMPTY;
        }
        if (!path.startsWith('/')) {
            path = '/' + path;
        }
        path = path.toLowerCase();
        const bindingPath = this.viewModel.bindingPath;
        const befRepository = this.repository;
        const baseUri = befRepository.restService.baseUri;
        const url = `${baseUri}${path}`;
        const requestInfo = befRepository.restService.buildRequestInfo();
        const ids = this.buildIds(bindingPath);
        ids.push(id);
        const body = {
            requestInfo,
            dataID: ids.join(',')
        };
        const options = {
            body
        };
        this.formLoadingService.show();
        return befRepository.proxy.request(url, 'PUT', null, options).pipe(tap(() => {
            this.formLoadingService.hide();
        }), map((responseInfo) => {
            const returnValue = responseInfo.returnValue;
            let entity = null;
            if (bindingPath.split('/').filter(p => p).length === 0) {
                entity = this.repository.buildEntity(returnValue);
                this.repository.entityCollection.addEntity(entity, true);
            }
            else {
                const fpath = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                entity = befRepository.entityManager.appendEntityByPath(fpath, returnValue, returnValue, true);
            }
            return entity;
        }));
    }
    /**
     * 带附件的复制
     * @param id
     * @param url
     * @param attachmentInfoFieldPath
     * @param rootId
     * @param path
     * @returns
     */
    cloneWithAttachment(id, url, attachmentInfoFieldPath, rootId, path) {
        if (!id) {
            this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            return EMPTY;
        }
        if (!url) {
            this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });
            return EMPTY;
        }
        if (!attachmentInfoFieldPath) {
            throw new Error('附件udt字段路径不能为空');
        }
        if (!url.startsWith('/')) {
            url = '/' + url;
        }
        url = url.toLowerCase();
        const bindingPath = this.viewModel.bindingPath;
        const befRepository = this.repository;
        const baseUri = befRepository.restService.baseUri;
        const uri = `${baseUri}${url}`;
        const requestInfo = befRepository.restService.buildRequestInfo();
        const ids = this.buildIds(bindingPath);
        ids.push(id);
        const body = {
            requestInfo,
            dataID: ids.join(',')
        };
        const options = {
            body
        };
        this.formLoadingService.show();
        const attachmentFields = attachmentInfoFieldPath.split(',').filter((p) => p).map((path) => path.split('/').pop());
        return befRepository.proxy.request(uri, 'PUT', null, options).pipe(switchMap((responseInfo) => {
            const entityData = responseInfo.returnValue;
            let entity = null;
            if (bindingPath.split('/').filter((p) => p).length === 0) {
                entity = this.repository.buildEntity(entityData);
                this.repository.entityCollection.addEntity(entity, true);
            }
            else {
                const fpath = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                entity = befRepository.entityManager.appendEntityByPath(fpath, entityData, entityData, true);
            }
            // 复制附件
            return this.copyRowFiles(entity, attachmentFields, rootId, path).pipe(switchMap(() => {
                this.formLoadingService.hide();
                return this.repository.updateAllChanges().pipe(map(() => {
                    return entity;
                }));
            }), catchError((error) => {
                this.formLoadingService.hide();
                // 清空实体附件属性
                this.clearAttachmentInfo(entity, attachmentFields);
                let cafError = error.error;
                if (typeof cafError === 'string') {
                    cafError = JSON.parse(cafError);
                }
                if (this.formErrorService) {
                    this.formErrorService.exception(cafError.message || this.languageService.copyFailed, error);
                }
                return EMPTY;
            }));
        }));
    }
    clearAttachmentInfo(entity, attachmentFields) {
        try {
            attachmentFields.forEach((attachmentField) => {
                this.setValueByPath(entity, [attachmentField, 'attachmentId'].join('.'), null);
                this.setValueByPath(entity, [attachmentField, 'fileName'].join('.'), null);
                this.setValueByPath(entity, [attachmentField, 'fileCreateTime'].join('.'), null);
                this.setValueByPath(entity, [attachmentField, 'fileSize'].join('.'), null);
            });
        }
        catch (e) {
            console.log(e);
        }
    }
    //#region 旧的实现
    /**
     * 复制行
     * @param frameId frameId
     * @param ignoreFields 复制时忽略字段
     * @param repeat 重复复制次数，默认为1
     */
    copyRow(frameId, ignoreFields, repeat = 1) {
        if (typeof repeat !== 'number') {
            repeat = parseInt(repeat, 10);
        }
        if (repeat < 1) {
            throw new Error('ArgumentError: repeat must >= 1');
        }
        // 获取当前行
        const frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);
        const primaryValue = frameContext.bindingData.list.currentId;
        const bindingPath = frameContext.viewModel.bindingPath || '/';
        let bindingData = null;
        let currentItem = null;
        if (bindingPath === '/') {
            // 主表直接取当前行
            currentItem = frameContext.bindingData.list.currentItem;
        }
        else {
            // 取从表/从从表当前行
            const paths = bindingPath.split('/').filter(p => p);
            currentItem = frameContext.bindingData.getValue(paths).currentItem;
        }
        bindingData = currentItem.toJSON();
        if (!currentItem.primaryKeyValue) {
            if (this.formNotifyService) {
                this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });
            }
            return EMPTY;
        }
        const ignoreFieldsArray = ignoreFields.split(',').filter(item => item);
        const sources = new Array(repeat);
        return from(sources).pipe(concatMap(() => {
            let action$ = null;
            if (bindingPath !== '/') {
                const fullPath = this.buildPath(bindingPath, primaryValue);
                action$ = this.repository.appendByPath(fullPath);
            }
            else {
                action$ = this.repository.append();
            }
            return action$.pipe(tap((entity) => {
                // 修正实体主键
                bindingData[entity.primaryKey] = entity.primaryValue;
                // 忽略指定字段
                ignoreFieldsArray.forEach((field) => {
                    const extractedFields = field.split('.').filter(item => item);
                    if (extractedFields.length === 1) {
                        delete bindingData[field];
                    }
                    const parent = extractedFields.slice(0, -1).reduce((prev, current, index) => {
                        return prev[current];
                    }, bindingData);
                    delete parent[extractedFields[extractedFields.length - 1]];
                });
                bindingData = Object.assign({}, entity.toJSON(), bindingData);
                entity.load(bindingData, { loadChild: false });
            }), catchError(() => {
                return EMPTY;
            }));
        }));
    }
    /**
     * 增量多选帮助批量赋值帮助后事件
     * @param frameId frameId
     * @param mapFields 字段映射
     * @param associatedField 关联字段
     */
    afterIncrementalSelectHelpClose(frameId, mapFields, associatedField) {
        const self = this;
        const result = self.context && self.context.eventParam || [];
        // tslint:disable-next-line: max-line-length
        // const mapping = '{"id":"userRef.userRef", "name":"name", "sex":"sex","age":"userRef.userRef_Age","address":"userRef.userRef_Address","birthday":"userRef.userRef_Birthday","height":"userRef.userRef_Height","isMarried":"userRef.userRef_IsMarried"}';
        if (!associatedField) {
            throw new Error('associated field can`t be empty.');
        }
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        const mappings = JSON.parse(mapFields);
        const foreignKey = associatedField;
        // 将选择人员保存到uistate中
        const rootFrameContext = this.viewModel.frameContext.root;
        // 不是bindingPath则按frameId处理
        let bindingPath = '/';
        const appContext = this.injector.get(AppContext, null);
        if (appContext) {
            const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            if (frameContext) {
                bindingPath = frameContext.viewModel.bindingPath || '/';
            }
            else {
                throw new Error('frameId is invalid!');
            }
        }
        // tslint:disable-next-line: no-string-literal
        rootFrameContext.uiState['selections'] = result;
        if (result && Array.isArray(result)) {
            // 根据bindingPath获取bindingdata中现有数据
            const bindingPaths = bindingPath.split('/').filter(item => item);
            const currentData = this.viewModel.bindingData.getValue(bindingPaths);
            const currentDataArray = currentData.toArray();
            // 找到result中有，但bindingData中没有的，为待新增项
            const appends = [];
            result.reduce((prev, item) => {
                const itemId = item && item[currentData.primaryKey] || null;
                const isExist = currentDataArray.find((bindingObject) => bindingObject[foreignKey][foreignKey] === itemId);
                if (!isExist) {
                    prev.push(item);
                }
                return prev;
            }, appends);
            // 找到bindingData中有，result中没有的，为待删除项
            const removes = [];
            currentDataArray.reduce((results, item) => {
                const index = result.findIndex(selectItem => selectItem[currentData.primaryKey] === item[foreignKey][foreignKey]);
                if (index === -1) {
                    results.push(item.primaryKeyValue);
                }
                return results;
            }, removes);
            // console.log('addItems', appends, 'removeItems', removes);
            // 调用后端接口新增数据
            const addAction$ = from(appends).pipe(concatMap(item => {
                const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                return this.repository.appendByPath(path).pipe(tap((entity) => {
                    Object.keys(mappings).forEach(prop => {
                        const value = this.getValueByPath(item, prop);
                        const fields = mappings[prop];
                        const groups = fields.split(',').filter(p => p);
                        groups.forEach(group => {
                            const paths = group.split('.').filter(p => p);
                            this.setValueByPath(entity, paths.join('.'), value);
                        });
                    });
                }), catchError(() => {
                    return EMPTY;
                }));
            }));
            const removeAction$ = from(removes).pipe(concatMap(item => {
                const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                return this.repository.removeByPath(path, item).pipe(tap(() => {
                    const befRepository = this.repository;
                    befRepository.entityManager.removeEntityByPath(path, item);
                }), catchError(() => {
                    return EMPTY;
                }));
            }));
            if (!appends && !removes || appends && appends.length < 1 && removes && removes.length < 1) {
                return of(true);
            }
            return concat(addAction$, removeAction$).pipe(catchError(() => EMPTY));
        }
        return of(true);
    }
    // todo:模拟用户操作，待后端接口支持主表批量新增后重写
    /**
     * 多选帮助批量赋值帮助前事件
     */
    beforeMultiSelectHelpOpen() {
        return this.clearHelpSelections();
    }
    /**
     * 多选帮助批量赋值帮助后事件
     * @param frameId 绑定路径
     * @param mapFields 字段映射
     * @param commandFrameId 回调命令所在frameId
     * @param commandName 回调命令
     * @deprecated 模拟用户操作，待批量赋值支持主表后废弃
     */
    afterMultiSelectHelpClose(frameId, mapFields, commandFrameId, commandName) {
        const self = this;
        const result = self.context && self.context.eventParam || [];
        if (result && Array.isArray(result)) {
            // 调用后端接口新增数据
            if (!result || result.length < 1) {
                return of(true);
            }
            this.onHelpClose.next({ frameId, mapFields, data: result, commandFrameId, commandName });
            return of(true);
        }
        return of(true);
    }
    /**
      * 帮助关闭后处理器
      * @param frameId frameid
      * @param mapFields mapFields
      * @param result 帮助数据结果
      */
    onHelpCloseHandler(frameId, mapFields, result) {
        if (!mapFields) {
            throw new Error('mapFields can`t be empty.');
        }
        const mappings = JSON.parse(mapFields);
        // 不是bindingPath则按frameId处理
        let bindingPath = '/';
        const appContext = this.injector.get(AppContext, null);
        if (appContext) {
            const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            if (frameContext) {
                bindingPath = frameContext.viewModel.bindingPath || '/';
            }
            else {
                throw new Error('frameId is invalid!');
            }
        }
        // 将选择人员保存到uistate中
        const rootFrameContext = this.viewModel.frameContext.root;
        const befRepository = this.repository;
        const bindingPaths = bindingPath.split('/').filter(p => p);
        // tslint:disable-next-line: no-string-literal
        rootFrameContext.uiState['selections'] = result;
        if (result && Array.isArray(result)) {
            const addAction$ = from(result).pipe(concatMap(item => {
                const requestInfo = befRepository.restService.buildRequestInfo();
                if (bindingPaths.length > 0) {
                    const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);
                    return befRepository.restService.createByPath(path, requestInfo).pipe(tap((responseInfo) => {
                        const data = responseInfo.returnValue;
                        const newEntity = befRepository.entityManager.appendEntityByPath(path, data, data);
                        Object.keys(mappings).forEach(prop => {
                            const value = this.getValueByPath(item, prop);
                            const fields = mappings[prop];
                            const groups = fields.split(',').filter(p => p);
                            groups.forEach(group => {
                                const paths = group.split('.').filter(p => p);
                                this.setValueByPath(newEntity, paths.join('.'), value);
                            });
                        });
                        return newEntity;
                    }));
                }
                else {
                    return befRepository.restService.create(null, requestInfo).pipe(tap((responseInfo) => {
                        const data = responseInfo.returnValue;
                        const newEntity = this.repository.buildEntity(data);
                        Object.keys(mappings).forEach(prop => {
                            const value = this.getValueByPath(item, prop);
                            const fields = mappings[prop];
                            const groups = fields.split(',').filter(p => p);
                            groups.forEach(group => {
                                const paths = group.split('.').filter(p => p);
                                this.setValueByPath(newEntity, paths.join('.'), value);
                            });
                        });
                        this.repository.entityCollection.addEntity(newEntity);
                        return newEntity;
                    }));
                }
            }));
            // const formLoadingService = this.injector.get<FormLoadingService>(FormLoadingService, null);
            if (this.formLoadingService) {
                this.suspendFrameContextEvent(frameId);
                this.formLoadingService.show();
                this.formLoadingService.setSuspend(true);
            }
            return addAction$.pipe(last()).pipe(switchMap(() => {
                const primaryValue = this.viewModel.bindingData.list.currentId;
                if (primaryValue) {
                    return befRepository.updateChangesById(primaryValue);
                }
                else {
                    return of(null);
                }
            })).subscribe(() => {
                if (this.formLoadingService) {
                    this.resumeFrameContextEvent(frameId);
                    this.formLoadingService.setSuspend(false);
                    this.formLoadingService.hide();
                }
            }, () => {
                if (this.formLoadingService) {
                    this.resumeFrameContextEvent(frameId);
                    this.formLoadingService.setSuspend(false);
                    this.formLoadingService.hide();
                }
            });
        }
        return of(null);
    }
    suspendFrameContextEvent(frameId) {
        const appContext = this.injector.get(AppContext, null);
        if (appContext) {
            const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            frameContext.suspend = true;
        }
    }
    resumeFrameContextEvent(frameId) {
        const appContext = this.injector.get(AppContext, null);
        if (appContext) {
            const frameContext = appContext.frameContextManager.getFrameContextById(frameId);
            frameContext.suspend = false;
            frameContext.appContext.messagePipe.next('bindData');
        }
    }
    //#endregion
    setValueByPath(target, path, value) {
        if (target) {
            const paths = path.split('.');
            if (paths.length <= 1) {
                target[path] = value;
            }
            else {
                paths.slice(0, -1).reduce((prev, path) => {
                    if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {
                        prev[path] = {};
                    }
                    return prev[path];
                }, target)[paths[paths.length - 1]] = value;
            }
        }
    }
    getValueByPath(target, path) {
        const paths = path.split('.');
        if (paths.length < 1) {
            return;
        }
        if (paths.length === 1) {
            return target[path];
        }
        let result = null;
        paths.forEach((prop, index) => {
            if (index === 0) {
                result = target && target[prop] || null;
            }
            else {
                result = result && result[prop] || null;
            }
        });
        return result;
    }
    /**
     * 构造子表路径
     * @param bindingPath 绑定路径
     * @param id id
     */
    buildPath(bindingPath, id) {
        let path = '/' + id;
        const subPaths = bindingPath.split('/');
        if (subPaths.length > 0) {
            // eg:bindingPath形如/edus/grades,split后是['', 'edus', 'grades']
            // 因此index从1开始
            for (let index = 1; index < subPaths.length - 1; index++) {
                const subPath = subPaths[index];
                const subData = this.viewModel.bindingData[subPath];
                if (!subData || !subData.currentId) {
                    throw Error(`获取子表完整路径出错，找不到${subData}对应的子表，或对应子表没有当前行。`);
                }
                path += `/${subPath}/${subData.currentId}`;
            }
        }
        path += '/' + subPaths[subPaths.length - 1];
        return path;
    }
    /**
     * 获取绑定路径的当前行数组
     * @param bindingPath bindingPath
     * @returns
     */
    buildIds(bindingPath) {
        const bindingPaths = bindingPath.split('/').filter(p => p);
        const primaryValue = this.viewModel.bindingData.list.currentId;
        const result = [];
        const paths = [];
        if (bindingPaths.length > 0) {
            result.push(primaryValue);
            // 从表或从从表要复制的行不一定是当前行，用户可以指定
            bindingPaths.pop();
            bindingPaths.forEach((path) => {
                paths.push(path);
                const bindingList = this.viewModel.bindingData.getValue(paths);
                if (bindingList) {
                    result.push(bindingList.currentId);
                }
            });
        }
        return result;
    }
    updateBindingData(input, ids) {
        const { controlType = null, value = null, options = {}, dataType = null } = input || {};
        if (controlType) {
            // 对帮助做特殊处理
            if (controlType === 'lookup' || controlType === 'combo-lookup') {
                const mapFields = options.mapFields;
                this.updateLookupField(ids, value, mapFields);
            }
            else {
                this.updateSimpleField(ids, value, input);
            }
        }
    }
    updateSimpleField(ids, value, column) {
        if (!column) {
            return;
        }
        const currentColumnType = column.dataType;
        // 存在行编辑器
        let result = value;
        if (currentColumnType === 'date') {
            let dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd');
            if (!dateStr) {
                dateStr = '0001-01-01T00:00:00';
            }
            result = dateStr;
        }
        else if (currentColumnType === 'number') {
            result = Number(value) || 0;
        }
        const field = column.field;
        ids.forEach(id => {
            this.updateBindingList(id, field, result);
        });
    }
    updateLookupField(ids, helpData, mapFields) {
        if (!mapFields) {
            return;
        }
        let helpFields = Object.keys(mapFields);
        const idIndex = helpFields.findIndex(item => item === 'id');
        if (helpFields.includes('id') && idIndex !== 0) {
            helpFields.splice(idIndex, 1);
            helpFields = ['id', ...helpFields];
        }
        if (!helpData) {
            helpFields.reverse();
        }
        helpFields.forEach((helpField) => {
            let helpValue = '';
            if (helpData) {
                if (helpData instanceof Array) {
                    helpValue = helpData.map((item) => {
                        return this.getValue(helpField, item);
                    }).join(',');
                }
                else {
                    helpValue = this.getValue(helpField, helpData);
                }
            }
            ids.forEach(id => {
                this.updateBindingList(id, mapFields[helpField], helpValue);
            });
        });
    }
    updateBindingList(primaryValue, propertyName, value) {
        const viewModel = this.viewModel || null;
        if (!viewModel || !propertyName) {
            return;
        }
        // 更新主表部分行的字段
        const propertyNames = propertyName.split('.').filter(item => item);
        const bindingObject = this.bindingList.findById(primaryValue);
        if (propertyNames.length < 2) {
            bindingObject.setValue(propertyName, value, true, true);
        }
        else {
            let targetBindingObject = null;
            const fpaths = propertyNames.slice(0, propertyNames.length - 1);
            const targetPropertyName = propertyNames[propertyNames.length - 1];
            fpaths.forEach(prop => {
                targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];
            });
            // todo:需要添加值变化事件
            targetBindingObject.setValue(targetPropertyName, value, true, true);
        }
    }
    getBindingPathArray() {
        const path = this.viewModel.bindingPath;
        if (path) {
            return path.split('/').filter(n => n !== '');
        }
        return [];
    }
    getValue(f, data) {
        let val = '';
        if (f.indexOf('.') === -1) {
            val = data[f];
        }
        else {
            val = f.split('.').reduce((a, b) => {
                return a[b];
            }, data);
        }
        return val;
    }
    get bindingList() {
        // 根实体
        if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {
            return this.viewModel.bindingData.list;
        }
        // 子实体
        let bindingPath = this.viewModel.bindingPath.substr(1);
        bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);
        const paths = bindingPath.split('/');
        const filteredPaths = paths.filter((part) => {
            return part !== '';
        });
        return this.viewModel.bindingData.getValue(filteredPaths);
    }
    /**
     * 根据映射将数据赋值给bindingData
     * @param data
     * @param mapFields
     * @param bindingData
     */
    mappingRow(data, mapFields, entity, bindingPath) {
        Object.keys(mapFields).forEach((prop) => {
            const value = this.getValueByPath(data, prop);
            const fields = mapFields[prop];
            const groups = fields.split(',').filter(p => p);
            groups.forEach(group => {
                const paths = group.split('.').filter(p => p);
                this.setValueByPath(entity, paths.join('.'), value);
            });
        });
    }
    /**
     * 通过frameId获取对应的组件上下文
     * @param frameId frameId
     * @returns
     */
    getFrameContextById(frameId) {
        if (!frameId) {
            return null;
        }
        const appContext = this.injector.get(AppContext, null);
        let frameContext = null;
        if (appContext) {
            frameContext = appContext.frameContextManager.getFrameContextById(frameId);
        }
        return frameContext;
    }
    getEntityByPath(frameContext, bindingPaths, currentId) {
        bindingPaths = [...bindingPaths];
        const id = frameContext.bindingData.list.currentId;
        const entity = frameContext.repository.entityCollection.getEntityById(id);
        let item = entity;
        const paths = [];
        const tailPath = bindingPaths.pop();
        const parent = bindingPaths.reduce((object, path) => {
            paths.push(path);
            if (object && (object.hasOwnProperty(path) || object['__proto__'].hasOwnProperty(path))) {
                const value = object[path];
                if (value && value instanceof EntityList) {
                    const bindingList = frameContext.bindingData.getValue(paths);
                    const currentItemId = bindingList.currentId;
                    return value.get(currentItemId);
                }
                else {
                    return value;
                }
            }
            else {
                return null;
            }
        }, item);
        if (parent instanceof Entity) {
            const list = parent[tailPath];
            if (list) {
                return list.get(currentId);
            }
            else {
                throw new Error(`无效的bindingPath.`);
            }
        }
        else {
            throw new Error(`无效的bindingPath.`);
        }
    }
    endEdit(frameContext) {
        const appContext = frameContext && frameContext.getFormAppContext();
        return of(null).pipe(tap(() => {
            if (appContext) {
                appContext.messagePipe.next({ type: 'endEdit' });
            }
        }), 
        // todo: 不应该使用delay，应该串流
        delay(5));
    }
}
BatchEditService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
BatchEditService.ctorParameters = () => [
    { type: Injector },
    { type: ComponentManagerService },
    { type: ViewModel },
    { type: Repository },
    { type: BatchEditDialogService },
    { type: DateTimeHelperService },
    { type: LanguageService },
    { type: FormNotifyService },
    { type: UploadService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmF0Y2gtZWRpdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzLyIsInNvdXJjZXMiOlsibGliL2JhdGNoLWVkaXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUMvRCxPQUFPLEVBQWUsU0FBUyxFQUFpQixVQUFVLEVBQUUsTUFBTSxFQUE2QixVQUFVLEVBQWlELFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdMLE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFjLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRW5HLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRTNDLGtDQUFrQztBQUNsQzs7R0FFRztBQUVILE1BQU0sT0FBTyxnQkFBZ0I7SUFHM0Is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QXVCO1lBTlYsU0FBUztZQUFpQixVQUFVO1lBSWpELHNCQUFzQjtZQUN0QixxQkFBcUI7WUFHckIsZUFBZTtZQUNmLGlCQUFpQjtZQUNqQixhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEJpbmRpbmdMaXN0LCBWaWV3TW9kZWwsIEJpbmRpbmdPYmplY3QsIFJlcG9zaXRvcnksIEVudGl0eSwgRnJhbWVDb250ZXh0LCBCaW5kaW5nRGF0YSwgQXBwQ29udGV4dCwgQmluZGluZ1Byb3BlcnR5LCBEYXRhVHlwZUluZm8sIGNyZWF0ZUVudGl0aWVzLCBFbnRpdHlMaXN0IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBmcm9tLCBFTVBUWSwgY29uY2F0LCBvZiwgU3ViamVjdCwgT2JzZXJ2YWJsZSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBjb25jYXRNYXAsIGNhdGNoRXJyb3IsIHRhcCwgc3dpdGNoTWFwLCBsYXN0LCBtYXAsIGRlbGF5LCB0YWtlTGFzdCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQmVmUmVwb3NpdG9yeSwgUmVzcG9uc2VJbmZvIH0gZnJvbSAnQGZhcnJpcy9iZWYnO1xyXG5pbXBvcnQgeyBCYXRjaEVkaXREaWFsb2dTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1iYXRjaC1lZGl0LWRpYWxvZyc7XHJcbmltcG9ydCB7IERhdGVUaW1lSGVscGVyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL2RhdGUnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRNYW5hZ2VyU2VydmljZSB9IGZyb20gJy4vY29tcG9uZW50LW1hbmFnZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IEZvcm1Mb2FkaW5nU2VydmljZSB9IGZyb20gJy4vZm9ybS1sb2FkaW5nL2Zvcm0tbG9hZGluZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi9sYW5ndWFnLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGb3JtTm90aWZ5U2VydmljZSB9IGZyb20gJy4vZm9ybS1ub3RpZnkuc2VydmljZSc7XHJcbmltcG9ydCB7IFVwbG9hZFNlcnZpY2UgfSBmcm9tICdAZ3NwLXN2Yy9mb3JtZG9jLXVwbG9hZCc7XHJcbmltcG9ydCB7IEZvcm1FcnJvclNlcnZpY2UgfSBmcm9tICcuL2Vycm9yJztcclxuXHJcbi8vIHRzbGludDpkaXNhYmxlOiBtYXgtbGluZS1sZW5ndGhcclxuLyoqXHJcbiAqIOaJuemHj+e8lui+keacjeWKoVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQmF0Y2hFZGl0U2VydmljZSB7XHJcbiAgcHJpdmF0ZSBmb3JtTG9hZGluZ1NlcnZpY2U6IEZvcm1Mb2FkaW5nU2VydmljZTtcclxuICBwcml2YXRlIG9uSGVscENsb3NlOiBTdWJqZWN0PGFueT47XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgY29tcG9uZW50TWFuYWdlclNlcnZpY2U6IENvbXBvbmVudE1hbmFnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB2aWV3TW9kZWw6IFZpZXdNb2RlbCxcclxuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxhbnk+LFxyXG4gICAgcHJpdmF0ZSBiYXRjaEVkaXREaWFsb2dTZXJ2aWNlOiBCYXRjaEVkaXREaWFsb2dTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBkYXRlU2VydmljZTogRGF0ZVRpbWVIZWxwZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IExhbmd1YWdlU2VydmljZSxcclxuICAgIHByaXZhdGUgZm9ybU5vdGlmeVNlcnZpY2U6IEZvcm1Ob3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmaWxlVXBsb2FkU2VydmljZTogVXBsb2FkU2VydmljZVxyXG4gICkge1xyXG4gICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldDxGb3JtTG9hZGluZ1NlcnZpY2U+KEZvcm1Mb2FkaW5nU2VydmljZSwgbnVsbCk7XHJcbiAgICBpZiAoIXRoaXMubGFuZ3VhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlID0gTGFuZ3VhZ2VTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMuZm9ybU5vdGlmeVNlcnZpY2UpIHtcclxuICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0PEZvcm1Ob3RpZnlTZXJ2aWNlPihGb3JtTm90aWZ5U2VydmljZSwgbnVsbCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLm9uSGVscENsb3NlID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgdGhpcy5vbkhlbHBDbG9zZS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgY29uc3QgeyBmcmFtZUlkID0gJycsIG1hcEZpZWxkcyA9ICcnLCBkYXRhID0gW10gfSA9IHJlc3VsdCB8fCB7fTtcclxuICAgICAgdGhpcy5vbkhlbHBDbG9zZUhhbmRsZXIoZnJhbWVJZCwgbWFwRmllbGRzLCBkYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBwcml2YXRlIGdldCBmb3JtRXJyb3JTZXJ2aWNlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5qZWN0b3IgJiYgdGhpcy5pbmplY3Rvci5nZXQ8Rm9ybUVycm9yU2VydmljZT4oRm9ybUVycm9yU2VydmljZSwgbnVsbCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaJk+W8gOaJuemHj+e8lui+keWvueivneahhlxyXG4gICAqIEBwYXJhbSBmcmFtZUlkIGZyYW1lSWRcclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkJhdGNoRWRpdERpYWxvZyhmcmFtZUlkOiBzdHJpbmcsIGVuYWJsZURpY3RQaWNraW5nOiBib29sZWFuIHwgc3RyaW5nID0gZmFsc2UpIHtcclxuICAgIGlmICghZnJhbWVJZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZyYW1lSWQgaXMgcmVxdWlyZWQuJyk7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGVuYWJsZURpY3RQaWNraW5nID09PSAnc3RyaW5nJykge1xyXG4gICAgICBlbmFibGVEaWN0UGlja2luZyA9IChlbmFibGVEaWN0UGlja2luZyA9PT0gJ3RydWUnID8gdHJ1ZSA6IGZhbHNlKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmJhdGNoRWRpdERpYWxvZ1NlcnZpY2UpIHtcclxuICAgICAgbGV0IGNvbHVtbnMgPSBbXTtcclxuICAgICAgaWYgKHRoaXMudmlld01vZGVsKSB7XHJcbiAgICAgICAgY29uc3QgZ3JpZEZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJvb3QuYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XHJcbiAgICAgICAgY29uc3QgZ3JpZFZpZXdNb2RlbCA9IGdyaWRGcmFtZUNvbnRleHQudmlld01vZGVsO1xyXG4gICAgICAgIGlmIChncmlkVmlld01vZGVsICYmIGdyaWRWaWV3TW9kZWwuaGFzT3duUHJvcGVydHkoJ2RhdGFHcmlkQ29sdW1uc05hbWUnKSkge1xyXG4gICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1zdHJpbmctbGl0ZXJhbFxyXG4gICAgICAgICAgY29uc3QgZ3JpZENvbHVtbnNBdHRyTmFtZSA9IGdyaWRWaWV3TW9kZWxbJ2RhdGFHcmlkQ29sdW1uc05hbWUnXTtcclxuICAgICAgICAgIGNvbHVtbnMgPSBncmlkVmlld01vZGVsW2dyaWRDb2x1bW5zQXR0ck5hbWVdO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZ3JpZFZpZXdNb2RlbCAmJiBncmlkVmlld01vZGVsLmhhc093blByb3BlcnR5KCdkYXRhR3JpZENvbHVtbnMnKSkge1xyXG4gICAgICAgICAgY29sdW1ucyA9IGdyaWRWaWV3TW9kZWxbJ2RhdGFHcmlkQ29sdW1ucyddO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpZHM6IHN0cmluZ1tdID0gZ3JpZFZpZXdNb2RlbC51aVN0YXRlWydpZHMnXSB8fCBbXTtcclxuICAgICAgICBpZiAoIWlkcyB8fCBpZHMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnBsc0NoZWNrQmF0Y2hFZGl0Um93cywgeyBoaWRlVGl0bGU6IHRydWUgfSk7XHJcbiAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRpYWxvZ1JlZjogYW55ID0gdGhpcy5iYXRjaEVkaXREaWFsb2dTZXJ2aWNlLmJhdGNoRWRpdChjb2x1bW5zLCB7XHJcbiAgICAgICAgICByb3dzOiBpZHMubGVuZ3RoLFxyXG4gICAgICAgICAgZW5hYmxlRGljdFBpY2tpbmcsXHJcbiAgICAgICAgICBvbkNvbmZpcm06IChpbnB1dHM6IEFycmF5PGFueT4pID0+IHtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSAmJiBpZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdvcGVuQmF0Y2hFZGl0RGlhbG9nJywgaW5wdXRzKTtcclxuICAgICAgICAgICAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmFwcENvbnRleHQ7XHJcbiAgICAgICAgICAgICAgYXBwQ29udGV4dC5jaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyLmRldGFjaCgpO1xyXG4gICAgICAgICAgICAgIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQmluZGluZ0RhdGEoaW5wdXQsIGlkcyk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgYXBwQ29udGV4dC5jaGFuZ2VEZXRlY3Rpb25Db250cm9sbGVyLnJlYXR0YWNoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGlhbG9nUmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5omT5byA6ZqQ6JeP5biu5YqpXHJcbiAgICogQHBhcmFtIGhlbHBJZCDluK7liqlpZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvcGVuSGlkZGVuSGVscChoZWxwSWQ6IHN0cmluZykge1xyXG4gICAgaWYgKCFoZWxwSWQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudCBlcnJvcixoZWxwSWQgY2FuYHQgYmUgZW1wdHknKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbXBvbmVudE1hbmFnZXJTZXJ2aWNlID0gdGhpcy5jb21wb25lbnRNYW5hZ2VyU2VydmljZS5nZXRDb250cm9sKGhlbHBJZCk7XHJcbiAgICBpZiAoY29tcG9uZW50TWFuYWdlclNlcnZpY2UpIHtcclxuICAgICAgY29tcG9uZW50TWFuYWdlclNlcnZpY2Uuc2hvd0RpYWxvZygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGB0aGUgY29tcG9uZW50IHdoaWNoIGlkIGlzICR7aGVscElkfSBjYW4ndCBiZSBmb3VuZCFgKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5riF56m65biu5Yqp5Yu+6YCJ77yI5Y+q6IO95oyC6L295Yiw5biu5Yqp5YmN5LqL5Lu277yJXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFySGVscFNlbGVjdGlvbnMoKSB7XHJcbiAgICBjb25zdCBzZWxmOiBhbnkgPSB0aGlzO1xyXG4gICAgY29uc3QgaGVscEVsZW1lbnQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0uaW5zdGFuY2UgfHwgbnVsbDtcclxuICAgIGlmIChoZWxwRWxlbWVudCkge1xyXG4gICAgICBoZWxwRWxlbWVudC5kaXNwbGF5VmFsdWUgPSAnJztcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yu+6YCJ5b2T5YmN6KGMXHJcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZFxyXG4gICAqIEBwYXJhbSBtYXBGaWVsZHMg5a2X5q615pig5bCEXHJcbiAgICogQHBhcmFtIHByaW1hcnlLZXlWYWx1ZSDluK7liqnkuLvplK7lrZfmrrVcclxuICAgKi9cclxuICBwdWJsaWMgY2hlY2tDdXJyZW50Um93KGZyYW1lSWQ6IHN0cmluZywgbWFwRmllbGRzOiBzdHJpbmcsIHByaW1hcnlLZXlWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBzZWxmOiBhbnkgPSB0aGlzO1xyXG4gICAgY29uc3QgaGVscEVsZW1lbnQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0uaW5zdGFuY2UgfHwgbnVsbDtcclxuICAgIGlmICghcHJpbWFyeUtleVZhbHVlKSB7XHJcbiAgICAgIHByaW1hcnlLZXlWYWx1ZSA9ICdpZCc7XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwRmllbGRzKTtcclxuICAgIGlmIChoZWxwRWxlbWVudCkge1xyXG4gICAgICBmcmFtZUlkID0gZnJhbWVJZCB8fCB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQuZnJhbWVJZDtcclxuICAgICAgaWYgKGZyYW1lSWQpIHtcclxuICAgICAgICBjb25zdCBmcmFtZUNvbnRleHQgPSB0aGlzLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XHJcbiAgICAgICAgaWYgKGZyYW1lQ29udGV4dCkge1xyXG4gICAgICAgICAgY29uc3QgYmluZGluZ1BhdGggPSBmcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgICAgICAgaWYgKGJpbmRpbmdQYXRoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJpbmRpbmdMaXN0ID0gZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLmdldFZhbHVlKGJpbmRpbmdQYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3cgPSBiaW5kaW5nTGlzdC5jdXJyZW50SXRlbTtcclxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IG1hcHBpbmdzW3ByaW1hcnlLZXlWYWx1ZV07XHJcbiAgICAgICAgICAgIGlmIChwYXRoKSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGN1cnJlbnRSb3csIHBhdGgpO1xyXG4gICAgICAgICAgICAgIGhlbHBFbGVtZW50LmRpc3BsYXlWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7peW4ruWKqeWLvumAieaVsOaNruS9nOS4uuS+neaNru+8jOaJuemHj+aWsOWinuS4u+ihqOaVsOaNrlxyXG4gICAqIEBwYXJhbSBmcmFtZUlkIOS4u+ihqOaJgOWcqGZyYW1l55qEaWRcclxuICAgKiBAcGFyYW0gbWFwRmllbGRzIOW4ruWKqeWtl+auteS4juS4u+ihqOWtl+auteaYoOWwhFxyXG4gICAqIEBkZXNjcmlwdGlvbiDku6XluK7liqnli77pgInmlbDmja7kvZzkuLrkvp3mja7vvIzmibnph4/mlrDlop7kuLvooajmlbDmja5cclxuICAgKi9cclxuICBwdWJsaWMgYmF0Y2hBcHBlbmQoZnJhbWVJZDogc3RyaW5nLCBtYXBGaWVsZHM6IHN0cmluZykge1xyXG4gICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcclxuICAgIGNvbnN0IHJlc3VsdCA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSB8fCBbXTtcclxuICAgIGlmICghbWFwRmllbGRzKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWFwRmllbGRzIGNhbmB0IGJlIGVtcHR5LicpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlc3VsdCAmJiBBcnJheS5pc0FycmF5KHJlc3VsdCkgJiYgcmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgbWFwcGluZ3MgPSBKU09OLnBhcnNlKG1hcEZpZWxkcyk7XHJcbiAgICAgIC8vIOS4jeaYr2JpbmRpbmdQYXRo5YiZ5oyJZnJhbWVJZOWkhOeQhlxyXG4gICAgICBsZXQgYmluZGluZ1BhdGggPSAnLyc7XHJcbiAgICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmluamVjdG9yLmdldDxBcHBDb250ZXh0PihBcHBDb250ZXh0LCBudWxsKTtcclxuICAgICAgaWYgKGFwcENvbnRleHQpIHtcclxuICAgICAgICBjb25zdCBmcmFtZUNvbnRleHQgPSBhcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcclxuICAgICAgICBpZiAoZnJhbWVDb250ZXh0KSB7XHJcbiAgICAgICAgICBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZyYW1lSWQgaXMgaW52YWxpZCEnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgZGVmYXVsdFZhbHVlcyA9IFtdO1xyXG4gICAgICByZXN1bHQuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHt9O1xyXG4gICAgICAgIE9iamVjdC5rZXlzKG1hcHBpbmdzKS5mb3JFYWNoKChwcm9wOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wKTtcclxuICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IG1hcHBpbmdzW3Byb3BdO1xyXG4gICAgICAgICAgY29uc3QgZ3JvdXBzOiBhbnlbXSA9IGZpZWxkcy5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwYXRocyA9IGdyb3VwLnNwbGl0KCcuJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVCeVBhdGgoZGVmYXVsdFZhbHVlLCBwYXRocy5qb2luKCcuJyksIHZhbHVlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGRlZmF1bHRWYWx1ZXMucHVzaChkZWZhdWx0VmFsdWUpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LmJhdGNoQXBwZW5kKGRlZmF1bHRWYWx1ZXMpLnBpcGUoXHJcbiAgICAgICAgdGFwKCgpID0+IHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKSksXHJcbiAgICAgICAgbWFwKCgpID0+IHRydWUpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOS7peW4ruWKqeWLvumAieaVsOaNruS9nOS4uuS+neaNru+8jOaJuemHj+aWsOWinuS7juihqC/ku47ku47ooahcclxuICAgKiBAcGFyYW0gZnJhbWVJZCDku47ooagv5LuO5LuO6KGo5omA5ZyoZnJhbWXnmoRpZFxyXG4gICAqIEBwYXJhbSBtYXBGaWVsZHMg5biu5Yqp5a2X5q615LiO5LuO6KGoL+S7juS7juihqOWtl+auteaYoOWwhFxyXG4gICAqIEBkZXNjcmlwdGlvbiDku6XluK7liqnli77pgInmlbDmja7kvZzkuLrkvp3mja7vvIzmibnph4/mlrDlop7ku47ooagv5LuO5LuO6KGoXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoQXBwZW5kQnlQYXRoQmFzZWRPbkhlbHBTZWxlY3Rpb25zKGZyYW1lSWQ6IHN0cmluZywgbWFwRmllbGRzOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XHJcbiAgICBjb25zdCByZXN1bHQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gfHwgW107XHJcbiAgICBpZiAoIW1hcEZpZWxkcykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hcEZpZWxkcyBjYW5gdCBiZSBlbXB0eS4nKTtcclxuICAgIH1cclxuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpICYmIHJlc3VsdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG1hcHBpbmdzID0gSlNPTi5wYXJzZShtYXBGaWVsZHMpO1xyXG4gICAgICAvLyDkuI3mmK9iaW5kaW5nUGF0aOWImeaMiWZyYW1lSWTlpITnkIZcclxuICAgICAgbGV0IGJpbmRpbmdQYXRoID0gJy8nO1xyXG4gICAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy5pbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCwgbnVsbCk7XHJcbiAgICAgIGlmIChhcHBDb250ZXh0KSB7XHJcbiAgICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XHJcbiAgICAgICAgaWYgKGZyYW1lQ29udGV4dCkge1xyXG4gICAgICAgICAgYmluZGluZ1BhdGggPSBmcmFtZUNvbnRleHQudmlld01vZGVsLmJpbmRpbmdQYXRoIHx8ICcvJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdmcmFtZUlkIGlzIGludmFsaWQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZXMgPSBbXTtcclxuICAgICAgcmVzdWx0LmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB7fTtcclxuICAgICAgICBPYmplY3Qua2V5cyhtYXBwaW5ncykuZm9yRWFjaCgocHJvcDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoaXRlbSwgcHJvcCk7XHJcbiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcclxuICAgICAgICAgIGNvbnN0IGdyb3VwczogYW55W10gPSBmaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKGRlZmF1bHRWYWx1ZSwgcGF0aHMuam9pbignLicpLCB2YWx1ZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBkZWZhdWx0VmFsdWVzLnB1c2goZGVmYXVsdFZhbHVlKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgICAgY29uc3QgcGF0aCA9IHRoaXMuYnVpbGRQYXRoKGJpbmRpbmdQYXRoLCB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuYmF0Y2hBcHBlbmRCeVBhdGgocGF0aCwgZGVmYXVsdFZhbHVlcykucGlwZShcclxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UuaGlkZSgpKSxcclxuICAgICAgICBtYXAoKCkgPT4gdHJ1ZSlcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIHJldHVybiBvZih0cnVlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5om56YeP5paw5aKe5bim6ZmE5Lu255qE5LuO6KGo5oiW5LuO5LuO6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGZyYW1lSWRcclxuICAgKiBAcGFyYW0gbWFwRmllbGRzXHJcbiAgICogQHBhcmFtIGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoIOmZhOS7tnVkdOWtl+autei3r+W+hO+8jOWPr+aUr+aMgeWkmuS4qu+8jOS7pemAl+WPt+WIhumalFxyXG4gICAqIEBwYXJhbSByb290SWQg6ZmE5Lu25a2Y5YKo5qC555uu5b2VXHJcbiAgICogQHBhcmFtIHBhdGgg6ZmE5Lu25a2Y5YKo55uu5b2VXHJcbiAgICogQGRlc2NyaXB0aW9uIOaJuemHj+aWsOWinuW4pumZhOS7tueahOS7juihqOaIluS7juS7juihqOaVsOaNruS4juaJuemHj+aWsOWinuS7juihqOS7juS7juihqOaVsOaNruS4gOiHtO+8jOWcqOaJuemHj+aWsOWinuaVsOaNrueahOWfuuehgOS4iuWinuWKoOS6humZhOS7tuWkjeWItlxyXG4gICAqIEB0b2RvIOebruWJjemZhOS7tuWkjeWItuWcqOWJjeerr+iwg+eUqO+8jOS8muWPkei1t+WkmuS4quivt+axgu+8jOS4lOWtmOWcqOWuieWFqOmXrumimO+8jOWQjue7reW6lOWcqHZv6ZuG5oiQXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoQXBwZW5kQnlQYXRoV2l0aEF0dGFjaG1lbnQoZnJhbWVJZDogc3RyaW5nLCBtYXBGaWVsZHM6IHN0cmluZywgYXR0YWNobWVudEluZm9GaWVsZFBhdGg6IHN0cmluZywgcm9vdElkOiBzdHJpbmcsIHBhdGg6IHN0cmluZykge1xyXG4gICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcclxuICAgIGNvbnN0IHJlc3VsdCA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSB8fCBbXTtcclxuICAgIGlmICghbWFwRmllbGRzKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWFwRmllbGRzIGNhbmB0IGJlIGVtcHR5LicpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFhdHRhY2htZW50SW5mb0ZpZWxkUGF0aCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+mZhOS7tnVkdOWtl+autei3r+W+hOS4jeiDveS4uuepuicpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlc3VsdCAmJiBBcnJheS5pc0FycmF5KHJlc3VsdCkgJiYgcmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgbWFwcGluZ3MgPSBKU09OLnBhcnNlKG1hcEZpZWxkcyk7XHJcbiAgICAgIGxldCBiaW5kaW5nUGF0aCA9ICcvJztcclxuICAgICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xyXG4gICAgICAvLyDkv67mraNiaW5kaW5nUGF0aFxyXG4gICAgICBpZiAoYXBwQ29udGV4dCkge1xyXG4gICAgICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IGFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpO1xyXG4gICAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcclxuICAgICAgICAgIGJpbmRpbmdQYXRoID0gZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aCB8fCAnLyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZnJhbWVJZCBpcyBpbnZhbGlkIScpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICAvLyDlpITnkIbpmYTku7Z1ZHTlrZfmrrVcclxuICAgICAgY29uc3QgYXR0YWNobWVudEZpZWxkcyA9IGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCkubWFwKHBhdGggPT4gcGF0aC5zcGxpdCgnLycpLnBvcCgpKTtcclxuICAgICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgICAvLyDlhYjlpI3liLbpmYTku7ZcclxuICAgICAgY29uc3QgY29weUZpbGVzJCA9IGZyb20ocmVzdWx0KS5waXBlKGNvbmNhdE1hcCgoaXRlbSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29weVJvd0ZpbGVzKGl0ZW0sIGF0dGFjaG1lbnRGaWVsZHMsIHJvb3RJZCwgcGF0aCkucGlwZShcclxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICAgICAgbGV0IGNhZkVycm9yID0gZXJyb3IuZXJyb3I7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FmRXJyb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgY2FmRXJyb3IgPSBKU09OLnBhcnNlKGNhZkVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5mb3JtRXJyb3JTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihjYWZFcnJvci5tZXNzYWdlIHx8IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNvcHlGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvcik7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pKSk7XHJcbiAgICAgIHJldHVybiBjb3B5RmlsZXMkLnBpcGUodGFrZUxhc3QoMSkpLnBpcGUoc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAvLyDmi7zoo4Xpu5jorqTlgLxcclxuICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWVzID0gdGhpcy5idWlsZERlZmF1bHRWYWx1ZXMocmVzdWx0LCBtYXBwaW5ncyk7XHJcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuYnVpbGRQYXRoKGJpbmRpbmdQYXRoLCB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5iYXRjaEFwcGVuZEJ5UGF0aChwYXRoLCBkZWZhdWx0VmFsdWVzKS5waXBlKFxyXG4gICAgICAgICAgdGFwKCgpID0+IHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKSksXHJcbiAgICAgICAgICBtYXAoKCkgPT4gdHJ1ZSlcclxuICAgICAgICApO1xyXG4gICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOm7mOiupOWAvOaVsOe7hFxyXG4gICAqIEBwYXJhbSBzZWxlY3RlZFZhbHVlc1xyXG4gICAqIEBwYXJhbSBtYXBGaWVsZHNcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYnVpbGREZWZhdWx0VmFsdWVzKHNlbGVjdGVkVmFsdWVzOiBhbnlbXSwgbWFwRmllbGRzOiB7IFtwcm9wOiBzdHJpbmddOiBhbnkgfSk6IGFueVtdIHtcclxuICAgIGNvbnN0IGRlZmF1bHRWYWx1ZXMgPSBbXTtcclxuICAgIHNlbGVjdGVkVmFsdWVzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0ge307XHJcbiAgICAgIE9iamVjdC5rZXlzKG1hcEZpZWxkcykuZm9yRWFjaCgocHJvcDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgLy8g5biu5Yqp5pWw5o2uXHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGl0ZW0sIHByb3ApO1xyXG4gICAgICAgIC8vIOebruagh+Wtl+autVxyXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IG1hcEZpZWxkc1twcm9wXTtcclxuICAgICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgdGhpcy5zZXRWYWx1ZUJ5UGF0aChkZWZhdWx0VmFsdWUsIHBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgZGVmYXVsdFZhbHVlcy5wdXNoKGRlZmF1bHRWYWx1ZSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBkZWZhdWx0VmFsdWVzO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDlpI3liLbooYzkuK3miYDmnInpmYTku7ZcclxuICAgKiBAcGFyYW0gcm93XHJcbiAgICogQHBhcmFtIGF0dGFjaG1lbnRGaWVsZHNcclxuICAgKiBAcGFyYW0gcm9vdElkXHJcbiAgICogQHBhcmFtIHBhdGhcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY29weVJvd0ZpbGVzKHJvdzogYW55LCBhdHRhY2htZW50RmllbGRzOiBzdHJpbmdbXSwgcm9vdElkOiBzdHJpbmcsIHBhdGg6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGZyb20oYXR0YWNobWVudEZpZWxkcykucGlwZShcclxuICAgICAgY29uY2F0TWFwKChmaWVsZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXR0YWNobWVudElkID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChyb3csIGAke2ZpZWxkfS5hdHRhY2htZW50SWRgKTtcclxuICAgICAgICBpZiAoYXR0YWNobWVudElkKSB7XHJcbiAgICAgICAgICAvLyDlj5HpgIHlpI3liLbpmYTku7bnmoTor7fmsYLvvIzojrflj5bpmYTku7ZpZFxyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZVVwbG9hZFNlcnZpY2UuY29weUZpbGUoYXR0YWNobWVudElkLCByb290SWQsIHBhdGgpLnBpcGUoXHJcbiAgICAgICAgICAgIHRhcCgoYXR0YWNobWVudElkOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAvLyDlpI3liLbmiJDlip9cclxuICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKHJvdywgW2ZpZWxkLCAnYXR0YWNobWVudElkJ10uam9pbignLicpLCBhdHRhY2htZW50SWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6KGM5YaF5biu5Yqp5aSa6YCJ5om56YeP5paw5aKe5oiW5pu/5o2i5a2Q6KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGZyYW1lSWQgZnJhbWVJZCwgb3B0aW9uYWws5Li656m65pe25L2/55So5ZG95Luk5omn6KGM5pe25omA5Zyo55qE5LiK5LiL5paHXHJcbiAgICogQHBhcmFtIG1hcEZpZWxkcyDlrZfmrrXmmKDlsIRcclxuICAgKiBAcGFyYW0gcHJpbWFyeUtleSDluK7liqnkuLvplK7lrZfmrrXvvIzpu5jorqTkuLppZFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGJhdGNoQXBwZW5kQmFzZWRPblJvd0hlbHBTZWxlY3Rpb25zKGZyYW1lSWQ6IHN0cmluZywgbWFwRmllbGRzOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XHJcbiAgICBsZXQgcmVzdWx0OiBhbnlbXSA9IHNlbGYuY29udGV4dCAmJiBzZWxmLmNvbnRleHQuZXZlbnRQYXJhbSB8fCBbXTtcclxuICAgIGlmICghbWFwRmllbGRzKSB7XHJcbiAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG1hcHBpbmdzID0gSlNPTi5wYXJzZShtYXBGaWVsZHMpO1xyXG4gICAgaWYgKCFtYXBwaW5ncyB8fCAhbWFwcGluZ3MuaGFzT3duUHJvcGVydHkoJ2lkJykpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgZnJhbWVJZCA9IGZyYW1lSWQgfHwgdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LmZyYW1lSWQ7XHJcbiAgICBpZiAoIWZyYW1lSWQpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZnJhbWVDb250ZXh0ID0gdGhpcy5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpO1xyXG4gICAgaWYgKCFmcmFtZUNvbnRleHQpIHtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuZW5kRWRpdChmcmFtZUNvbnRleHQpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBpZiAocmVzdWx0ICYmIEFycmF5LmlzQXJyYXkocmVzdWx0KSAmJiByZXN1bHQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xyXG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWVzID0gW107XHJcbiAgICAgICAgICAgIC8vIOiOt+WPluW9k+WJjeihjFxyXG4gICAgICAgICAgICBjb25zdCBiaW5kaW5nTGlzdDogQmluZGluZ0xpc3QgPSBmcmFtZUNvbnRleHQuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGhzKSBhcyBCaW5kaW5nTGlzdDtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdyA9IGJpbmRpbmdMaXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Um93SWQgPSBiaW5kaW5nTGlzdC5jdXJyZW50SWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFbnRpdHkgPSB0aGlzLmdldEVudGl0eUJ5UGF0aChmcmFtZUNvbnRleHQsIGJpbmRpbmdQYXRocywgY3VycmVudFJvd0lkKTtcclxuICAgICAgICAgICAgY29uc3QgaGVhZEl0ZW0gPSByZXN1bHRbMF07XHJcbiAgICAgICAgICAgIC8vIOWmguaenOS7heWLvumAieS4gOadoe+8jOWImeW6lOabv+aNouW9k+WJjeihjOeahOaYoOWwhFxyXG4gICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgIC8vIHRoaXMubWFwcGluZ1JvdyhoZWFkSXRlbSwgbWFwcGluZ3MsIGN1cnJlbnRFbnRpdHksIGJpbmRpbmdQYXRoKTtcclxuICAgICAgICAgICAgICBjb25zdCBkYXRhID0gaGVhZEl0ZW07XHJcbiAgICAgICAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2goKHByb3A6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGRhdGEsIHByb3ApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gbWFwcGluZ3NbcHJvcF07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgICAgICAgICBncm91cHMuZm9yRWFjaChncm91cCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gZ3JvdXAuc3BsaXQoJy4nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgICAgICAgICAgZnJhbWVDb250ZXh0LmJpbmRpbmdEYXRhLnNldFZhbHVlKGJpbmRpbmdQYXRocy5jb25jYXQocGF0aHMpLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaWRNYXBGaWVsZCA9IG1hcHBpbmdzWydpZCddO1xyXG4gICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUl0ZW1JZCA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoY3VycmVudEVudGl0eSwgaWRNYXBGaWVsZCk7XHJcbiAgICAgICAgICAgICAgLy8g5aaC5p6c5b2T5YmN6KGM5rKh5pyJ5pig5bCE5oiW5Yu+6YCJ57uT5p6c5Lit5om+5LiN5Yiw5b2T5YmN6KGM55qE5pig5bCEXHJcbiAgICAgICAgICAgICAgaWYgKCFzb3VyY2VJdGVtSWQgfHwgcmVzdWx0LmZpbmRJbmRleChpdGVtID0+IGl0ZW1bYmluZGluZ0xpc3QucHJpbWFyeUtleV0gPT09IHNvdXJjZUl0ZW1JZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDph43mlrDmmKDlsITlvZPliY3ooYxcclxuICAgICAgICAgICAgICAgIHRoaXMubWFwcGluZ1JvdyhoZWFkSXRlbSwgbWFwcGluZ3MsIGN1cnJlbnRFbnRpdHksIGJpbmRpbmdQYXRoKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zbGljZSgxKTtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNvdXJjZUl0ZW1JZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSByZXN1bHQuZmluZEluZGV4KGl0ZW0gPT4gaXRlbVtiaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSA9PT0gc291cmNlSXRlbUlkKTtcclxuICAgICAgICAgICAgICAgIC8vIOmHjeaWsOaYoOWwhOW9k+WJjeihjFxyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXBwaW5nUm93KHJlc3VsdFtpbmRleF0sIG1hcHBpbmdzLCBjdXJyZW50RW50aXR5LCBiaW5kaW5nUGF0aCk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgLy8g5b2T5YmN6KGM5aSE55CG5a6M5oiQXHJcbiAgICAgICAgICAgICAgLy8g5aSE55CG5pyq5pig5bCE55qE6KGMXHJcbiAgICAgICAgICAgICAgY29uc3QgZW1wdHlSb3dzID0gYmluZGluZ0xpc3QudG9BcnJheSgpLmZpbHRlcihiaW5kaW5nT2JqZWN0ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChiaW5kaW5nT2JqZWN0LCBtYXBwaW5nc1tiaW5kaW5nTGlzdC5wcmltYXJ5S2V5XSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIWlkO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIGlmIChlbXB0eVJvd3MgJiYgZW1wdHlSb3dzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGxldCByb3dzID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiBlbXB0eVJvd3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJvd3MgPSByZXN1bHQuc2xpY2UoMCwgZW1wdHlSb3dzLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zbGljZShlbXB0eVJvd3MubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRJdGVtID0gZW1wdHlSb3dzW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgZW50aXR5ID0gdGhpcy5nZXRFbnRpdHlCeVBhdGgoZnJhbWVDb250ZXh0LCBiaW5kaW5nUGF0aHMsIHRhcmdldEl0ZW0ucHJpbWFyeUtleVZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5tYXBwaW5nUm93KGl0ZW0sIG1hcHBpbmdzLCBlbnRpdHksIGJpbmRpbmdQYXRoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAvLyDlpITnkIbliankvZnli77pgIlcclxuICAgICAgICAgICAgICByZXN1bHQuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0ge307XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhtYXBwaW5ncykuZm9yRWFjaCgocHJvcDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wKTtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gbWFwcGluZ3NbcHJvcF07XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwczogYW55W10gPSBmaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gZ3JvdXAuc3BsaXQoJy4nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKGRlZmF1bHRWYWx1ZSwgcGF0aHMuam9pbignLicpLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWVzLnB1c2goZGVmYXVsdFZhbHVlKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBpZiAoZGVmYXVsdFZhbHVlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5idWlsZFBhdGgoYmluZGluZ1BhdGgsIHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5iYXRjaEFwcGVuZEJ5UGF0aChwYXRoLCBkZWZhdWx0VmFsdWVzKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICB0YXAoKCkgPT4gdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UuaGlkZSgpKVxyXG4gICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCAzNTApO1xyXG4gICAgICB9KTtcclxuICAgIH0sIDUwKTtcclxuICAgIHJldHVybiBvZih0cnVlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5aSN5Yi25Li76KGo5pWw5o2uXHJcbiAgICogQHBhcmFtIGlkIOimgeWkjeWItueahOaVsOaNrmlkXHJcbiAgICogQHBhcmFtIGZpZWxkcyDopoHlpI3liLbnmoTlrZfmrrVcclxuICAgKiBAZGVzY3JpcHRpb24g5LuF5pSv5oyB5aSN5Yi25Li76KGo5pWw5o2uXHJcbiAgICogQGRlcHJlY2F0ZWQg6K+l5pa55rOV5bey6KKr5bqf5byD77yM6K+35L2/55SoY2xvbmXmlrnms5Xmm7/ku6PjgIJcclxuICAgKi9cclxuICBwdWJsaWMgY29weShpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghaWQpIHtcclxuICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnBsc1NlbGVjdENvcHlEYXRhLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGJlZlJlcG9zaXRvcnkgPSB0aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xyXG4gICAgY29uc3QgYmFzZVVyaSA9IGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuYmFzZVVyaTtcclxuICAgIGNvbnN0IHVybCA9IGAke2Jhc2VVcml9L3NlcnZpY2UvY29weW1haW5vYmp2b2FjdGlvbmA7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgcmVxdWVzdEluZm8sXHJcbiAgICAgIGRhdGFJRDogaWRcclxuICAgIH07XHJcbiAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICBib2R5XHJcbiAgICB9O1xyXG4gICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgcmV0dXJuIGJlZlJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh1cmwsICdQVVQnLCBudWxsLCBvcHRpb25zKS5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSB0aGlzLnJlcG9zaXRvcnkuYnVpbGRFbnRpdHkocmV0dXJuVmFsdWUpO1xyXG4gICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0eShlbnRpdHkpO1xyXG4gICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICAgIH0pLFxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5aSN5Yi25pWw5o2u77yI5pSv5oyB5Li76KGo44CB5LuO6KGo44CB5LuO5LuO6KGo77yJXHJcbiAgICogQHBhcmFtIGlkIOimgeWkjeWItueahOihjFxyXG4gICAqIEBwYXJhbSBwYXRoIOivt+axgui3r+W+hFxyXG4gICAqIEByZXR1cm5zXHJcbiAgICovXHJcbiAgcHVibGljIGNsb25lKGlkOiBzdHJpbmcsIHBhdGg6IHN0cmluZykge1xyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UucGxzU2VsZWN0Q29weURhdGEsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXBhdGgpIHtcclxuICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnBhdGhJc1JlcXVpcmVkLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgcmV0dXJuIEVNUFRZO1xyXG4gICAgfVxyXG4gICAgaWYgKCFwYXRoLnN0YXJ0c1dpdGgoJy8nKSkge1xyXG4gICAgICBwYXRoID0gJy8nICsgcGF0aDtcclxuICAgIH1cclxuICAgIHBhdGggPSBwYXRoLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAgICBjb25zdCBiYXNlVXJpID0gYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5iYXNlVXJpO1xyXG4gICAgY29uc3QgdXJsID0gYCR7YmFzZVVyaX0ke3BhdGh9YDtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5idWlsZFJlcXVlc3RJbmZvKCk7XHJcbiAgICBjb25zdCBpZHMgPSB0aGlzLmJ1aWxkSWRzKGJpbmRpbmdQYXRoKTtcclxuICAgIGlkcy5wdXNoKGlkKTtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgIHJlcXVlc3RJbmZvLFxyXG4gICAgICBkYXRhSUQ6IGlkcy5qb2luKCcsJylcclxuICAgIH07XHJcbiAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICBib2R5XHJcbiAgICB9O1xyXG4gICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgcmV0dXJuIGJlZlJlcG9zaXRvcnkucHJveHkucmVxdWVzdCh1cmwsICdQVVQnLCBudWxsLCBvcHRpb25zKS5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgfSksXHJcbiAgICAgIG1hcCgocmVzcG9uc2VJbmZvOiBSZXNwb25zZUluZm8pID0+IHtcclxuICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICBsZXQgZW50aXR5ID0gbnVsbDtcclxuICAgICAgICBpZiAoYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIocCA9PiBwKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShyZXR1cm5WYWx1ZSk7XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdHkoZW50aXR5LCB0cnVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgZnBhdGggPSB0aGlzLmJ1aWxkUGF0aChiaW5kaW5nUGF0aCwgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgICAgZW50aXR5ID0gYmVmUmVwb3NpdG9yeS5lbnRpdHlNYW5hZ2VyLmFwcGVuZEVudGl0eUJ5UGF0aChmcGF0aCwgcmV0dXJuVmFsdWUsIHJldHVyblZhbHVlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eTtcclxuICAgICAgfSksXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDluKbpmYTku7bnmoTlpI3liLZcclxuICAgKiBAcGFyYW0gaWRcclxuICAgKiBAcGFyYW0gdXJsXHJcbiAgICogQHBhcmFtIGF0dGFjaG1lbnRJbmZvRmllbGRQYXRoXHJcbiAgICogQHBhcmFtIHJvb3RJZFxyXG4gICAqIEBwYXJhbSBwYXRoXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwdWJsaWMgY2xvbmVXaXRoQXR0YWNobWVudChpZDogc3RyaW5nLCB1cmw6IHN0cmluZywgYXR0YWNobWVudEluZm9GaWVsZFBhdGg6IHN0cmluZywgcm9vdElkOiBzdHJpbmcsIHBhdGg6IHN0cmluZykge1xyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UucGxzU2VsZWN0Q29weURhdGEsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXVybCkge1xyXG4gICAgICB0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sYW5ndWFnZVNlcnZpY2UucGF0aElzUmVxdWlyZWQsIHsgaGlkZVRpdGxlOiB0cnVlIH0pO1xyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWF0dGFjaG1lbnRJbmZvRmllbGRQYXRoKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign6ZmE5Lu2dWR05a2X5q616Lev5b6E5LiN6IO95Li656m6Jyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXVybC5zdGFydHNXaXRoKCcvJykpIHtcclxuICAgICAgdXJsID0gJy8nICsgdXJsO1xyXG4gICAgfVxyXG4gICAgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aCA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoO1xyXG4gICAgY29uc3QgYmVmUmVwb3NpdG9yeSA9IHRoaXMucmVwb3NpdG9yeSBhcyBCZWZSZXBvc2l0b3J5PGFueT47XHJcbiAgICBjb25zdCBiYXNlVXJpID0gYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5iYXNlVXJpO1xyXG4gICAgY29uc3QgdXJpID0gYCR7YmFzZVVyaX0ke3VybH1gO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBiZWZSZXBvc2l0b3J5LnJlc3RTZXJ2aWNlLmJ1aWxkUmVxdWVzdEluZm8oKTtcclxuICAgIGNvbnN0IGlkcyA9IHRoaXMuYnVpbGRJZHMoYmluZGluZ1BhdGgpO1xyXG4gICAgaWRzLnB1c2goaWQpO1xyXG4gICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgcmVxdWVzdEluZm8sXHJcbiAgICAgIGRhdGFJRDogaWRzLmpvaW4oJywnKVxyXG4gICAgfTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgIGJvZHlcclxuICAgIH07XHJcbiAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zaG93KCk7XHJcbiAgICBjb25zdCBhdHRhY2htZW50RmllbGRzID0gYXR0YWNobWVudEluZm9GaWVsZFBhdGguc3BsaXQoJywnKS5maWx0ZXIoKHApID0+IHApLm1hcCgocGF0aCkgPT4gcGF0aC5zcGxpdCgnLycpLnBvcCgpKTtcclxuICAgIHJldHVybiBiZWZSZXBvc2l0b3J5LnByb3h5LnJlcXVlc3QodXJpLCAnUFVUJywgbnVsbCwgb3B0aW9ucykucGlwZShcclxuICAgICAgc3dpdGNoTWFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eURhdGEgPSByZXNwb25zZUluZm8ucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgbGV0IGVudGl0eSA9IG51bGw7XHJcbiAgICAgICAgaWYgKGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKChwKSA9PiBwKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIGVudGl0eSA9IHRoaXMucmVwb3NpdG9yeS5idWlsZEVudGl0eShlbnRpdHlEYXRhKTtcclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmFkZEVudGl0eShlbnRpdHksIHRydWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBmcGF0aCA9IHRoaXMuYnVpbGRQYXRoKGJpbmRpbmdQYXRoLCB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZCk7XHJcbiAgICAgICAgICBlbnRpdHkgPSBiZWZSZXBvc2l0b3J5LmVudGl0eU1hbmFnZXIuYXBwZW5kRW50aXR5QnlQYXRoKGZwYXRoLCBlbnRpdHlEYXRhLCBlbnRpdHlEYXRhLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5aSN5Yi26ZmE5Lu2XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29weVJvd0ZpbGVzKGVudGl0eSwgYXR0YWNobWVudEZpZWxkcywgcm9vdElkLCBwYXRoKS5waXBlKFxyXG4gICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UuaGlkZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZUFsbENoYW5nZXMoKS5waXBlKG1hcCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGVudGl0eTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5oaWRlKCk7XHJcbiAgICAgICAgICAgIC8vIOa4heepuuWunuS9k+mZhOS7tuWxnuaAp1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyQXR0YWNobWVudEluZm8oZW50aXR5LCBhdHRhY2htZW50RmllbGRzKTtcclxuICAgICAgICAgICAgbGV0IGNhZkVycm9yID0gZXJyb3IuZXJyb3I7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FmRXJyb3IgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgY2FmRXJyb3IgPSBKU09OLnBhcnNlKGNhZkVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5mb3JtRXJyb3JTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihjYWZFcnJvci5tZXNzYWdlIHx8IHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmNvcHlGYWlsZWQsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pLFxyXG4gICAgKTtcclxuICB9XHJcbiAgcHJpdmF0ZSBjbGVhckF0dGFjaG1lbnRJbmZvKGVudGl0eTogRW50aXR5LCBhdHRhY2htZW50RmllbGRzOiBzdHJpbmdbXSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXR0YWNobWVudEZpZWxkcy5mb3JFYWNoKChhdHRhY2htZW50RmllbGQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVCeVBhdGgoZW50aXR5LCBbYXR0YWNobWVudEZpZWxkLCAnYXR0YWNobWVudElkJ10uam9pbignLicpLCBudWxsKTtcclxuICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKGVudGl0eSwgW2F0dGFjaG1lbnRGaWVsZCwgJ2ZpbGVOYW1lJ10uam9pbignLicpLCBudWxsKTtcclxuICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKGVudGl0eSwgW2F0dGFjaG1lbnRGaWVsZCwgJ2ZpbGVDcmVhdGVUaW1lJ10uam9pbignLicpLCBudWxsKTtcclxuICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKGVudGl0eSwgW2F0dGFjaG1lbnRGaWVsZCwgJ2ZpbGVTaXplJ10uam9pbignLicpLCBudWxsKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyNyZWdpb24g5pen55qE5a6e546wXHJcblxyXG4gIC8qKlxyXG4gICAqIOWkjeWItuihjFxyXG4gICAqIEBwYXJhbSBmcmFtZUlkIGZyYW1lSWRcclxuICAgKiBAcGFyYW0gaWdub3JlRmllbGRzIOWkjeWItuaXtuW/veeVpeWtl+autVxyXG4gICAqIEBwYXJhbSByZXBlYXQg6YeN5aSN5aSN5Yi25qyh5pWw77yM6buY6K6k5Li6MVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb3B5Um93KGZyYW1lSWQ6IHN0cmluZywgaWdub3JlRmllbGRzOiBzdHJpbmcsIHJlcGVhdDogbnVtYmVyID0gMSkge1xyXG4gICAgaWYgKHR5cGVvZiByZXBlYXQgIT09ICdudW1iZXInKSB7XHJcbiAgICAgIHJlcGVhdCA9IHBhcnNlSW50KHJlcGVhdCwgMTApO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlcGVhdCA8IDEpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudEVycm9yOiByZXBlYXQgbXVzdCA+PSAxJyk7XHJcbiAgICB9XHJcbiAgICAvLyDojrflj5blvZPliY3ooYxcclxuICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IHRoaXMudmlld01vZGVsLmZyYW1lQ29udGV4dC5hcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcclxuICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRoID0gZnJhbWVDb250ZXh0LnZpZXdNb2RlbC5iaW5kaW5nUGF0aCB8fCAnLyc7XHJcbiAgICBsZXQgYmluZGluZ0RhdGEgPSBudWxsO1xyXG4gICAgbGV0IGN1cnJlbnRJdGVtOiBCaW5kaW5nT2JqZWN0ID0gbnVsbDtcclxuICAgIGlmIChiaW5kaW5nUGF0aCA9PT0gJy8nKSB7XHJcbiAgICAgIC8vIOS4u+ihqOebtOaOpeWPluW9k+WJjeihjFxyXG4gICAgICBjdXJyZW50SXRlbSA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJdGVtO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5Y+W5LuO6KGoL+S7juS7juihqOW9k+WJjeihjFxyXG4gICAgICBjb25zdCBwYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgIGN1cnJlbnRJdGVtID0gKGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3QpLmN1cnJlbnRJdGVtO1xyXG4gICAgfVxyXG4gICAgYmluZGluZ0RhdGEgPSBjdXJyZW50SXRlbS50b0pTT04oKTtcclxuICAgIGlmICghY3VycmVudEl0ZW0ucHJpbWFyeUtleVZhbHVlKSB7XHJcbiAgICAgIGlmICh0aGlzLmZvcm1Ob3RpZnlTZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtTm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnBsc1NlbGVjdENvcHlEYXRhLCB7IGhpZGVUaXRsZTogdHJ1ZSB9KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpZ25vcmVGaWVsZHNBcnJheSA9IGlnbm9yZUZpZWxkcy5zcGxpdCgnLCcpLmZpbHRlcihpdGVtID0+IGl0ZW0pO1xyXG5cclxuICAgIGNvbnN0IHNvdXJjZXMgPSBuZXcgQXJyYXkocmVwZWF0KTtcclxuICAgIHJldHVybiBmcm9tKHNvdXJjZXMpLnBpcGUoXHJcbiAgICAgIGNvbmNhdE1hcCgoKSA9PiB7XHJcbiAgICAgICAgbGV0IGFjdGlvbiQgPSBudWxsO1xyXG4gICAgICAgIGlmIChiaW5kaW5nUGF0aCAhPT0gJy8nKSB7XHJcbiAgICAgICAgICBjb25zdCBmdWxsUGF0aCA9IHRoaXMuYnVpbGRQYXRoKGJpbmRpbmdQYXRoLCBwcmltYXJ5VmFsdWUpO1xyXG4gICAgICAgICAgYWN0aW9uJCA9IHRoaXMucmVwb3NpdG9yeS5hcHBlbmRCeVBhdGgoZnVsbFBhdGgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhY3Rpb24kID0gdGhpcy5yZXBvc2l0b3J5LmFwcGVuZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYWN0aW9uJC5waXBlKFxyXG4gICAgICAgICAgdGFwKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICAgICAgICAvLyDkv67mraPlrp7kvZPkuLvplK5cclxuICAgICAgICAgICAgYmluZGluZ0RhdGFbZW50aXR5LnByaW1hcnlLZXldID0gZW50aXR5LnByaW1hcnlWYWx1ZTtcclxuICAgICAgICAgICAgLy8g5b+955Wl5oyH5a6a5a2X5q61XHJcbiAgICAgICAgICAgIGlnbm9yZUZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBleHRyYWN0ZWRGaWVsZHMgPSBmaWVsZC5zcGxpdCgnLicpLmZpbHRlcihpdGVtID0+IGl0ZW0pO1xyXG4gICAgICAgICAgICAgIGlmIChleHRyYWN0ZWRGaWVsZHMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgYmluZGluZ0RhdGFbZmllbGRdO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBleHRyYWN0ZWRGaWVsZHMuc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgY3VycmVudCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcmV2W2N1cnJlbnRdO1xyXG4gICAgICAgICAgICAgIH0sIGJpbmRpbmdEYXRhKTtcclxuICAgICAgICAgICAgICBkZWxldGUgcGFyZW50W2V4dHJhY3RlZEZpZWxkc1tleHRyYWN0ZWRGaWVsZHMubGVuZ3RoIC0gMV1dO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYmluZGluZ0RhdGEgPSBPYmplY3QuYXNzaWduKHt9LCBlbnRpdHkudG9KU09OKCksIGJpbmRpbmdEYXRhKTtcclxuICAgICAgICAgICAgZW50aXR5LmxvYWQoYmluZGluZ0RhdGEsIHsgbG9hZENoaWxkOiBmYWxzZSB9KTtcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBFTVBUWTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWinumHj+WkmumAieW4ruWKqeaJuemHj+i1i+WAvOW4ruWKqeWQjuS6i+S7tlxyXG4gICAqIEBwYXJhbSBmcmFtZUlkIGZyYW1lSWRcclxuICAgKiBAcGFyYW0gbWFwRmllbGRzIOWtl+auteaYoOWwhFxyXG4gICAqIEBwYXJhbSBhc3NvY2lhdGVkRmllbGQg5YWz6IGU5a2X5q61XHJcbiAgICovXHJcbiAgcHVibGljIGFmdGVySW5jcmVtZW50YWxTZWxlY3RIZWxwQ2xvc2UoZnJhbWVJZDogc3RyaW5nLCBtYXBGaWVsZHM6IHN0cmluZywgYXNzb2NpYXRlZEZpZWxkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XHJcbiAgICBjb25zdCByZXN1bHQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gfHwgW107XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgLy8gY29uc3QgbWFwcGluZyA9ICd7XCJpZFwiOlwidXNlclJlZi51c2VyUmVmXCIsIFwibmFtZVwiOlwibmFtZVwiLCBcInNleFwiOlwic2V4XCIsXCJhZ2VcIjpcInVzZXJSZWYudXNlclJlZl9BZ2VcIixcImFkZHJlc3NcIjpcInVzZXJSZWYudXNlclJlZl9BZGRyZXNzXCIsXCJiaXJ0aGRheVwiOlwidXNlclJlZi51c2VyUmVmX0JpcnRoZGF5XCIsXCJoZWlnaHRcIjpcInVzZXJSZWYudXNlclJlZl9IZWlnaHRcIixcImlzTWFycmllZFwiOlwidXNlclJlZi51c2VyUmVmX0lzTWFycmllZFwifSc7XHJcbiAgICBpZiAoIWFzc29jaWF0ZWRGaWVsZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Fzc29jaWF0ZWQgZmllbGQgY2FuYHQgYmUgZW1wdHkuJyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIW1hcEZpZWxkcykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hcEZpZWxkcyBjYW5gdCBiZSBlbXB0eS4nKTtcclxuICAgIH1cclxuICAgIGNvbnN0IG1hcHBpbmdzID0gSlNPTi5wYXJzZShtYXBGaWVsZHMpO1xyXG4gICAgY29uc3QgZm9yZWlnbktleSA9IGFzc29jaWF0ZWRGaWVsZDtcclxuICAgIC8vIOWwhumAieaLqeS6uuWRmOS/neWtmOWIsHVpc3RhdGXkuK1cclxuICAgIGNvbnN0IHJvb3RGcmFtZUNvbnRleHQgPSB0aGlzLnZpZXdNb2RlbC5mcmFtZUNvbnRleHQucm9vdDtcclxuICAgIC8vIOS4jeaYr2JpbmRpbmdQYXRo5YiZ5oyJZnJhbWVJZOWkhOeQhlxyXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gJy8nO1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xyXG4gICAgaWYgKGFwcENvbnRleHQpIHtcclxuICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XHJcbiAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcclxuICAgICAgICBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignZnJhbWVJZCBpcyBpbnZhbGlkIScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXN0cmluZy1saXRlcmFsXHJcbiAgICByb290RnJhbWVDb250ZXh0LnVpU3RhdGVbJ3NlbGVjdGlvbnMnXSA9IHJlc3VsdDtcclxuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XHJcbiAgICAgIC8vIOagueaNrmJpbmRpbmdQYXRo6I635Y+WYmluZGluZ2RhdGHkuK3njrDmnInmlbDmja5cclxuICAgICAgY29uc3QgYmluZGluZ1BhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKS5maWx0ZXIoaXRlbSA9PiBpdGVtKTtcclxuICAgICAgY29uc3QgY3VycmVudERhdGE6IEJpbmRpbmdMaXN0ID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEuZ2V0VmFsdWUoYmluZGluZ1BhdGhzKTtcclxuICAgICAgY29uc3QgY3VycmVudERhdGFBcnJheSA9IGN1cnJlbnREYXRhLnRvQXJyYXkoKTtcclxuICAgICAgLy8g5om+5YiwcmVzdWx05Lit5pyJ77yM5L2GYmluZGluZ0RhdGHkuK3msqHmnInnmoTvvIzkuLrlvoXmlrDlop7poblcclxuICAgICAgY29uc3QgYXBwZW5kcyA9IFtdO1xyXG4gICAgICByZXN1bHQucmVkdWNlKChwcmV2OiBBcnJheTxhbnk+LCBpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXRlbUlkID0gaXRlbSAmJiBpdGVtW2N1cnJlbnREYXRhLnByaW1hcnlLZXldIHx8IG51bGw7XHJcbiAgICAgICAgY29uc3QgaXNFeGlzdCA9IGN1cnJlbnREYXRhQXJyYXkuZmluZCgoYmluZGluZ09iamVjdDogQmluZGluZ09iamVjdCkgPT4gYmluZGluZ09iamVjdFtmb3JlaWduS2V5XVtmb3JlaWduS2V5XSA9PT0gaXRlbUlkKTtcclxuICAgICAgICBpZiAoIWlzRXhpc3QpIHtcclxuICAgICAgICAgIHByZXYucHVzaChpdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByZXY7XHJcbiAgICAgIH0sIGFwcGVuZHMpO1xyXG5cclxuICAgICAgLy8g5om+5YiwYmluZGluZ0RhdGHkuK3mnInvvIxyZXN1bHTkuK3msqHmnInnmoTvvIzkuLrlvoXliKDpmaTpoblcclxuICAgICAgY29uc3QgcmVtb3ZlcyA9IFtdO1xyXG4gICAgICBjdXJyZW50RGF0YUFycmF5LnJlZHVjZSgocmVzdWx0czogYW55LCBpdGVtOiBCaW5kaW5nT2JqZWN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSByZXN1bHQuZmluZEluZGV4KHNlbGVjdEl0ZW0gPT4gc2VsZWN0SXRlbVtjdXJyZW50RGF0YS5wcmltYXJ5S2V5XSA9PT0gaXRlbVtmb3JlaWduS2V5XVtmb3JlaWduS2V5XSk7XHJcbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0ucHJpbWFyeUtleVZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICAgIH0sIHJlbW92ZXMpO1xyXG5cclxuICAgICAgLy8gY29uc29sZS5sb2coJ2FkZEl0ZW1zJywgYXBwZW5kcywgJ3JlbW92ZUl0ZW1zJywgcmVtb3Zlcyk7XHJcbiAgICAgIC8vIOiwg+eUqOWQjuerr+aOpeWPo+aWsOWinuaVsOaNrlxyXG4gICAgICBjb25zdCBhZGRBY3Rpb24kID0gZnJvbShhcHBlbmRzKS5waXBlKFxyXG4gICAgICAgIGNvbmNhdE1hcChpdGVtID0+IHtcclxuICAgICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmJ1aWxkUGF0aChiaW5kaW5nUGF0aCwgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5hcHBlbmRCeVBhdGgocGF0aCkucGlwZShcclxuICAgICAgICAgICAgdGFwKChlbnRpdHk6IEVudGl0eSkgPT4ge1xyXG4gICAgICAgICAgICAgIE9iamVjdC5rZXlzKG1hcHBpbmdzKS5mb3JFYWNoKHByb3AgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGl0ZW0sIHByb3ApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gbWFwcGluZ3NbcHJvcF07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cHM6IGFueVtdID0gZmllbGRzLnNwbGl0KCcsJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAgICAgICAgICAgICBncm91cHMuZm9yRWFjaChncm91cCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gZ3JvdXAuc3BsaXQoJy4nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZUJ5UGF0aChlbnRpdHksIHBhdGhzLmpvaW4oJy4nKSwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCByZW1vdmVBY3Rpb24kID0gZnJvbShyZW1vdmVzKS5waXBlKFxyXG4gICAgICAgIGNvbmNhdE1hcChpdGVtID0+IHtcclxuICAgICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmJ1aWxkUGF0aChiaW5kaW5nUGF0aCwgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5yZW1vdmVCeVBhdGgocGF0aCwgaXRlbSkucGlwZShcclxuICAgICAgICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBiZWZSZXBvc2l0b3J5OiBCZWZSZXBvc2l0b3J5PGFueT4gPSB0aGlzLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxhbnk+O1xyXG4gICAgICAgICAgICAgIGJlZlJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5yZW1vdmVFbnRpdHlCeVBhdGgocGF0aCwgaXRlbSk7XHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICBjYXRjaEVycm9yKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gRU1QVFk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIGlmICghYXBwZW5kcyAmJiAhcmVtb3ZlcyB8fCBhcHBlbmRzICYmIGFwcGVuZHMubGVuZ3RoIDwgMSAmJiByZW1vdmVzICYmIHJlbW92ZXMubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gY29uY2F0KGFkZEFjdGlvbiQsIHJlbW92ZUFjdGlvbiQpLnBpcGUoXHJcbiAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiBFTVBUWSlcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIHJldHVybiBvZih0cnVlKTtcclxuICB9XHJcbiAgLy8gdG9kbzrmqKHmi5/nlKjmiLfmk43kvZzvvIzlvoXlkI7nq6/mjqXlj6PmlK/mjIHkuLvooajmibnph4/mlrDlop7lkI7ph43lhplcclxuICAvKipcclxuICAgKiDlpJrpgInluK7liqnmibnph4/otYvlgLzluK7liqnliY3kuovku7ZcclxuICAgKi9cclxuICBwdWJsaWMgYmVmb3JlTXVsdGlTZWxlY3RIZWxwT3BlbigpIHtcclxuICAgIHJldHVybiB0aGlzLmNsZWFySGVscFNlbGVjdGlvbnMoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5aSa6YCJ5biu5Yqp5om56YeP6LWL5YC85biu5Yqp5ZCO5LqL5Lu2XHJcbiAgICogQHBhcmFtIGZyYW1lSWQg57uR5a6a6Lev5b6EXHJcbiAgICogQHBhcmFtIG1hcEZpZWxkcyDlrZfmrrXmmKDlsIRcclxuICAgKiBAcGFyYW0gY29tbWFuZEZyYW1lSWQg5Zue6LCD5ZG95Luk5omA5ZyoZnJhbWVJZFxyXG4gICAqIEBwYXJhbSBjb21tYW5kTmFtZSDlm57osIPlkb3ku6RcclxuICAgKiBAZGVwcmVjYXRlZCDmqKHmi5/nlKjmiLfmk43kvZzvvIzlvoXmibnph4/otYvlgLzmlK/mjIHkuLvooajlkI7lup/lvINcclxuICAgKi9cclxuICBwdWJsaWMgYWZ0ZXJNdWx0aVNlbGVjdEhlbHBDbG9zZShmcmFtZUlkOiBzdHJpbmcsIG1hcEZpZWxkczogc3RyaW5nLCBjb21tYW5kRnJhbWVJZD86IHN0cmluZywgY29tbWFuZE5hbWU/OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XHJcbiAgICBjb25zdCByZXN1bHQgPSBzZWxmLmNvbnRleHQgJiYgc2VsZi5jb250ZXh0LmV2ZW50UGFyYW0gfHwgW107XHJcbiAgICBpZiAocmVzdWx0ICYmIEFycmF5LmlzQXJyYXkocmVzdWx0KSkge1xyXG4gICAgICAvLyDosIPnlKjlkI7nq6/mjqXlj6PmlrDlop7mlbDmja5cclxuICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA8IDEpIHtcclxuICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5vbkhlbHBDbG9zZS5uZXh0KHsgZnJhbWVJZCwgbWFwRmllbGRzLCBkYXRhOiByZXN1bHQsIGNvbW1hbmRGcmFtZUlkLCBjb21tYW5kTmFtZSB9KTtcclxuICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxuICAvKipcclxuICAgICog5biu5Yqp5YWz6Zet5ZCO5aSE55CG5ZmoXHJcbiAgICAqIEBwYXJhbSBmcmFtZUlkIGZyYW1laWRcclxuICAgICogQHBhcmFtIG1hcEZpZWxkcyBtYXBGaWVsZHNcclxuICAgICogQHBhcmFtIHJlc3VsdCDluK7liqnmlbDmja7nu5PmnpxcclxuICAgICovXHJcbiAgcHJpdmF0ZSBvbkhlbHBDbG9zZUhhbmRsZXIoZnJhbWVJZDogc3RyaW5nLCBtYXBGaWVsZHM6IHN0cmluZywgcmVzdWx0OiBhbnlbXSkge1xyXG4gICAgaWYgKCFtYXBGaWVsZHMpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXBGaWVsZHMgY2FuYHQgYmUgZW1wdHkuJyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXBwaW5ncyA9IEpTT04ucGFyc2UobWFwRmllbGRzKTtcclxuICAgIC8vIOS4jeaYr2JpbmRpbmdQYXRo5YiZ5oyJZnJhbWVJZOWkhOeQhlxyXG4gICAgbGV0IGJpbmRpbmdQYXRoID0gJy8nO1xyXG4gICAgY29uc3QgYXBwQ29udGV4dCA9IHRoaXMuaW5qZWN0b3IuZ2V0PEFwcENvbnRleHQ+KEFwcENvbnRleHQsIG51bGwpO1xyXG4gICAgaWYgKGFwcENvbnRleHQpIHtcclxuICAgICAgY29uc3QgZnJhbWVDb250ZXh0ID0gYXBwQ29udGV4dC5mcmFtZUNvbnRleHRNYW5hZ2VyLmdldEZyYW1lQ29udGV4dEJ5SWQoZnJhbWVJZCk7XHJcbiAgICAgIGlmIChmcmFtZUNvbnRleHQpIHtcclxuICAgICAgICBiaW5kaW5nUGF0aCA9IGZyYW1lQ29udGV4dC52aWV3TW9kZWwuYmluZGluZ1BhdGggfHwgJy8nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignZnJhbWVJZCBpcyBpbnZhbGlkIScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyDlsIbpgInmi6nkurrlkZjkv53lrZjliLB1aXN0YXRl5LitXHJcbiAgICBjb25zdCByb290RnJhbWVDb250ZXh0ID0gdGhpcy52aWV3TW9kZWwuZnJhbWVDb250ZXh0LnJvb3Q7XHJcbiAgICBjb25zdCBiZWZSZXBvc2l0b3J5ID0gdGhpcy5yZXBvc2l0b3J5IGFzIEJlZlJlcG9zaXRvcnk8YW55PjtcclxuICAgIGNvbnN0IGJpbmRpbmdQYXRocyA9IGJpbmRpbmdQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCk7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXN0cmluZy1saXRlcmFsXHJcbiAgICByb290RnJhbWVDb250ZXh0LnVpU3RhdGVbJ3NlbGVjdGlvbnMnXSA9IHJlc3VsdDtcclxuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XHJcbiAgICAgIGNvbnN0IGFkZEFjdGlvbiQgPSBmcm9tKHJlc3VsdCkucGlwZShcclxuICAgICAgICBjb25jYXRNYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICBjb25zdCByZXF1ZXN0SW5mbyA9IGJlZlJlcG9zaXRvcnkucmVzdFNlcnZpY2UuYnVpbGRSZXF1ZXN0SW5mbygpO1xyXG4gICAgICAgICAgaWYgKGJpbmRpbmdQYXRocy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmJ1aWxkUGF0aChiaW5kaW5nUGF0aCwgdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gYmVmUmVwb3NpdG9yeS5yZXN0U2VydmljZS5jcmVhdGVCeVBhdGgocGF0aCwgcmVxdWVzdEluZm8pLnBpcGUoXHJcbiAgICAgICAgICAgICAgdGFwKChyZXNwb25zZUluZm86IFJlc3BvbnNlSW5mbykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlSW5mby5yZXR1cm5WYWx1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0VudGl0eSA9IGJlZlJlcG9zaXRvcnkuZW50aXR5TWFuYWdlci5hcHBlbmRFbnRpdHlCeVBhdGgocGF0aCwgZGF0YSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhtYXBwaW5ncykuZm9yRWFjaChwcm9wID0+IHtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlQnlQYXRoKGl0ZW0sIHByb3ApO1xyXG4gICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBtYXBwaW5nc1twcm9wXTtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBzOiBhbnlbXSA9IGZpZWxkcy5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgICAgICAgICBncm91cHMuZm9yRWFjaChncm91cCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVCeVBhdGgobmV3RW50aXR5LCBwYXRocy5qb2luKCcuJyksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBiZWZSZXBvc2l0b3J5LnJlc3RTZXJ2aWNlLmNyZWF0ZShudWxsLCByZXF1ZXN0SW5mbykucGlwZShcclxuICAgICAgICAgICAgICB0YXAoKHJlc3BvbnNlSW5mbzogUmVzcG9uc2VJbmZvKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2VJbmZvLnJldHVyblZhbHVlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RW50aXR5ID0gdGhpcy5yZXBvc2l0b3J5LmJ1aWxkRW50aXR5KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5UGF0aChpdGVtLCBwcm9wKTtcclxuICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gbWFwcGluZ3NbcHJvcF07XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwczogYW55W10gPSBmaWVsZHMuc3BsaXQoJywnKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhzID0gZ3JvdXAuc3BsaXQoJy4nKS5maWx0ZXIocCA9PiBwKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlQnlQYXRoKG5ld0VudGl0eSwgcGF0aHMuam9pbignLicpLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5hZGRFbnRpdHkobmV3RW50aXR5KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdFbnRpdHk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICAvLyBjb25zdCBmb3JtTG9hZGluZ1NlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldDxGb3JtTG9hZGluZ1NlcnZpY2U+KEZvcm1Mb2FkaW5nU2VydmljZSwgbnVsbCk7XHJcbiAgICAgIGlmICh0aGlzLmZvcm1Mb2FkaW5nU2VydmljZSkge1xyXG4gICAgICAgIHRoaXMuc3VzcGVuZEZyYW1lQ29udGV4dEV2ZW50KGZyYW1lSWQpO1xyXG4gICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zZXRTdXNwZW5kKHRydWUpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBhZGRBY3Rpb24kLnBpcGUoXHJcbiAgICAgICAgbGFzdCgpLFxyXG4gICAgICApLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhLmxpc3QuY3VycmVudElkO1xyXG4gICAgICAgICAgaWYgKHByaW1hcnlWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYmVmUmVwb3NpdG9yeS51cGRhdGVDaGFuZ2VzQnlJZChwcmltYXJ5VmFsdWUpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UpIHtcclxuICAgICAgICAgIHRoaXMucmVzdW1lRnJhbWVDb250ZXh0RXZlbnQoZnJhbWVJZCk7XHJcbiAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zZXRTdXNwZW5kKGZhbHNlKTtcclxuICAgICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sICgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtTG9hZGluZ1NlcnZpY2UpIHtcclxuICAgICAgICAgIHRoaXMucmVzdW1lRnJhbWVDb250ZXh0RXZlbnQoZnJhbWVJZCk7XHJcbiAgICAgICAgICB0aGlzLmZvcm1Mb2FkaW5nU2VydmljZS5zZXRTdXNwZW5kKGZhbHNlKTtcclxuICAgICAgICAgIHRoaXMuZm9ybUxvYWRpbmdTZXJ2aWNlLmhpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gIH1cclxuICBwcml2YXRlIHN1c3BlbmRGcmFtZUNvbnRleHRFdmVudChmcmFtZUlkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmluamVjdG9yLmdldDxBcHBDb250ZXh0PihBcHBDb250ZXh0LCBudWxsKTtcclxuICAgIGlmIChhcHBDb250ZXh0KSB7XHJcbiAgICAgIGNvbnN0IGZyYW1lQ29udGV4dCA9IGFwcENvbnRleHQuZnJhbWVDb250ZXh0TWFuYWdlci5nZXRGcmFtZUNvbnRleHRCeUlkKGZyYW1lSWQpO1xyXG4gICAgICBmcmFtZUNvbnRleHQuc3VzcGVuZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgcmVzdW1lRnJhbWVDb250ZXh0RXZlbnQoZnJhbWVJZDogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBhcHBDb250ZXh0ID0gdGhpcy5pbmplY3Rvci5nZXQ8QXBwQ29udGV4dD4oQXBwQ29udGV4dCwgbnVsbCk7XHJcbiAgICBpZiAoYXBwQ29udGV4dCkge1xyXG4gICAgICBjb25zdCBmcmFtZUNvbnRleHQgPSBhcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcclxuICAgICAgZnJhbWVDb250ZXh0LnN1c3BlbmQgPSBmYWxzZTtcclxuICAgICAgZnJhbWVDb250ZXh0LmFwcENvbnRleHQubWVzc2FnZVBpcGUubmV4dCgnYmluZERhdGEnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vI2VuZHJlZ2lvblxyXG4gIHByaXZhdGUgc2V0VmFsdWVCeVBhdGgodGFyZ2V0OiBvYmplY3QsIHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgaWYgKHRhcmdldCkge1xyXG4gICAgICBjb25zdCBwYXRocyA9IHBhdGguc3BsaXQoJy4nKTtcclxuICAgICAgaWYgKHBhdGhzLmxlbmd0aCA8PSAxKSB7XHJcbiAgICAgICAgdGFyZ2V0W3BhdGhdID0gdmFsdWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGF0aHMuc2xpY2UoMCwgLTEpLnJlZHVjZSgocHJldiwgcGF0aCkgPT4ge1xyXG4gICAgICAgICAgaWYgKCEocHJldi5oYXNPd25Qcm9wZXJ0eShwYXRoKSB8fCBwcmV2WydfX3Byb3RvX18nXS5oYXNPd25Qcm9wZXJ0eShwYXRoKSkpIHtcclxuICAgICAgICAgICAgcHJldltwYXRoXSA9IHt9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHByZXZbcGF0aF07XHJcbiAgICAgICAgfSwgdGFyZ2V0KVtwYXRoc1twYXRocy5sZW5ndGggLSAxXV0gPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGdldFZhbHVlQnlQYXRoKHRhcmdldDogb2JqZWN0LCBwYXRoOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHBhdGhzID0gcGF0aC5zcGxpdCgnLicpO1xyXG4gICAgaWYgKHBhdGhzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhdGhzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gdGFyZ2V0W3BhdGhdO1xyXG4gICAgfVxyXG4gICAgbGV0IHJlc3VsdCA9IG51bGw7XHJcbiAgICBwYXRocy5mb3JFYWNoKChwcm9wLCBpbmRleCkgPT4ge1xyXG4gICAgICBpZiAoaW5kZXggPT09IDApIHtcclxuICAgICAgICByZXN1bHQgPSB0YXJnZXQgJiYgdGFyZ2V0W3Byb3BdIHx8IG51bGw7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0ICYmIHJlc3VsdFtwcm9wXSB8fCBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoOWtkOihqOi3r+W+hFxyXG4gICAqIEBwYXJhbSBiaW5kaW5nUGF0aCDnu5Hlrprot6/lvoRcclxuICAgKiBAcGFyYW0gaWQgaWRcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkUGF0aChiaW5kaW5nUGF0aDogc3RyaW5nLCBpZDogYW55KSB7XHJcbiAgICBsZXQgcGF0aCA9ICcvJyArIGlkO1xyXG4gICAgY29uc3Qgc3ViUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpO1xyXG4gICAgaWYgKHN1YlBhdGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gZWc6YmluZGluZ1BhdGjlvaLlpoIvZWR1cy9ncmFkZXMsc3BsaXTlkI7mmK9bJycsICdlZHVzJywgJ2dyYWRlcyddXHJcbiAgICAgIC8vIOWboOatpGluZGV45LuOMeW8gOWni1xyXG4gICAgICBmb3IgKGxldCBpbmRleCA9IDE7IGluZGV4IDwgc3ViUGF0aHMubGVuZ3RoIC0gMTsgaW5kZXgrKykge1xyXG4gICAgICAgIGNvbnN0IHN1YlBhdGggPSBzdWJQYXRoc1tpbmRleF07XHJcbiAgICAgICAgY29uc3Qgc3ViRGF0YSA9IHRoaXMudmlld01vZGVsLmJpbmRpbmdEYXRhW3N1YlBhdGhdO1xyXG4gICAgICAgIGlmICghc3ViRGF0YSB8fCAhc3ViRGF0YS5jdXJyZW50SWQpIHtcclxuICAgICAgICAgIHRocm93IEVycm9yKGDojrflj5blrZDooajlrozmlbTot6/lvoTlh7rplJnvvIzmib7kuI3liLAke3N1YkRhdGF95a+55bqU55qE5a2Q6KGo77yM5oiW5a+55bqU5a2Q6KGo5rKh5pyJ5b2T5YmN6KGM44CCYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhdGggKz0gYC8ke3N1YlBhdGh9LyR7c3ViRGF0YS5jdXJyZW50SWR9YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcGF0aCArPSAnLycgKyBzdWJQYXRoc1tzdWJQYXRocy5sZW5ndGggLSAxXTtcclxuXHJcbiAgICByZXR1cm4gcGF0aDtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W57uR5a6a6Lev5b6E55qE5b2T5YmN6KGM5pWw57uEXHJcbiAgICogQHBhcmFtIGJpbmRpbmdQYXRoIGJpbmRpbmdQYXRoXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcml2YXRlIGJ1aWxkSWRzKGJpbmRpbmdQYXRoOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBiaW5kaW5nUGF0aHMgPSBiaW5kaW5nUGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHApO1xyXG4gICAgY29uc3QgcHJpbWFyeVZhbHVlID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEubGlzdC5jdXJyZW50SWQ7XHJcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgIGNvbnN0IHBhdGhzID0gW107XHJcbiAgICBpZiAoYmluZGluZ1BhdGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmVzdWx0LnB1c2gocHJpbWFyeVZhbHVlKTtcclxuICAgICAgLy8g5LuO6KGo5oiW5LuO5LuO6KGo6KaB5aSN5Yi255qE6KGM5LiN5LiA5a6a5piv5b2T5YmN6KGM77yM55So5oi35Y+v5Lul5oyH5a6aXHJcbiAgICAgIGJpbmRpbmdQYXRocy5wb3AoKTtcclxuICAgICAgYmluZGluZ1BhdGhzLmZvckVhY2goKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHBhdGhzLnB1c2gocGF0aCk7XHJcbiAgICAgICAgY29uc3QgYmluZGluZ0xpc3QgPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgICAgaWYgKGJpbmRpbmdMaXN0KSB7XHJcbiAgICAgICAgICByZXN1bHQucHVzaChiaW5kaW5nTGlzdC5jdXJyZW50SWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUJpbmRpbmdEYXRhKGlucHV0OiBhbnksIGlkczogQXJyYXk8YW55Pikge1xyXG4gICAgY29uc3QgeyBjb250cm9sVHlwZSA9IG51bGwsIHZhbHVlID0gbnVsbCwgb3B0aW9ucyA9IHt9LCBkYXRhVHlwZSA9IG51bGwgfSA9IGlucHV0IHx8IHt9O1xyXG4gICAgaWYgKGNvbnRyb2xUeXBlKSB7XHJcbiAgICAgIC8vIOWvueW4ruWKqeWBmueJueauiuWkhOeQhlxyXG4gICAgICBpZiAoY29udHJvbFR5cGUgPT09ICdsb29rdXAnIHx8IGNvbnRyb2xUeXBlID09PSAnY29tYm8tbG9va3VwJykge1xyXG4gICAgICAgIGNvbnN0IG1hcEZpZWxkcyA9IG9wdGlvbnMubWFwRmllbGRzO1xyXG4gICAgICAgIHRoaXMudXBkYXRlTG9va3VwRmllbGQoaWRzLCB2YWx1ZSwgbWFwRmllbGRzKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVNpbXBsZUZpZWxkKGlkcywgdmFsdWUsIGlucHV0KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZVNpbXBsZUZpZWxkKGlkczogQXJyYXk8YW55PiwgdmFsdWU6IGFueSwgY29sdW1uOiBhbnkpIHtcclxuICAgIGlmICghY29sdW1uKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGN1cnJlbnRDb2x1bW5UeXBlID0gY29sdW1uLmRhdGFUeXBlO1xyXG4gICAgLy8g5a2Y5Zyo6KGM57yW6L6R5ZmoXHJcbiAgICBsZXQgcmVzdWx0ID0gdmFsdWU7XHJcbiAgICBpZiAoY3VycmVudENvbHVtblR5cGUgPT09ICdkYXRlJykge1xyXG4gICAgICBsZXQgZGF0ZVN0ciA9IHRoaXMuZGF0ZVNlcnZpY2UuZm9ybWF0VG8odmFsdWUsICd5eXl5LU1NLWRkJyk7XHJcbiAgICAgIGlmICghZGF0ZVN0cikge1xyXG4gICAgICAgIGRhdGVTdHIgPSAnMDAwMS0wMS0wMVQwMDowMDowMCc7XHJcbiAgICAgIH1cclxuICAgICAgcmVzdWx0ID0gZGF0ZVN0cjtcclxuICAgIH0gZWxzZSBpZiAoY3VycmVudENvbHVtblR5cGUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgIHJlc3VsdCA9IE51bWJlcih2YWx1ZSkgfHwgMDtcclxuICAgIH1cclxuICAgIGNvbnN0IGZpZWxkID0gY29sdW1uLmZpZWxkO1xyXG4gICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUJpbmRpbmdMaXN0KGlkLCBmaWVsZCwgcmVzdWx0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUxvb2t1cEZpZWxkKGlkczogQXJyYXk8YW55PiwgaGVscERhdGE6IGFueSwgbWFwRmllbGRzOiBhbnkpIHtcclxuICAgIGlmICghbWFwRmllbGRzKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBoZWxwRmllbGRzID0gT2JqZWN0LmtleXMobWFwRmllbGRzKTtcclxuICAgIGNvbnN0IGlkSW5kZXggPSBoZWxwRmllbGRzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0gPT09ICdpZCcpO1xyXG4gICAgaWYgKGhlbHBGaWVsZHMuaW5jbHVkZXMoJ2lkJykgJiYgaWRJbmRleCAhPT0gMCkge1xyXG4gICAgICBoZWxwRmllbGRzLnNwbGljZShpZEluZGV4LCAxKTtcclxuICAgICAgaGVscEZpZWxkcyA9IFsnaWQnLCAuLi5oZWxwRmllbGRzXTtcclxuICAgIH1cclxuICAgIGlmICghaGVscERhdGEpIHtcclxuICAgICAgaGVscEZpZWxkcy5yZXZlcnNlKCk7XHJcbiAgICB9XHJcbiAgICBoZWxwRmllbGRzLmZvckVhY2goKGhlbHBGaWVsZDogYW55KSA9PiB7XHJcbiAgICAgIGxldCBoZWxwVmFsdWU6IGFueSA9ICcnO1xyXG4gICAgICBpZiAoaGVscERhdGEpIHtcclxuICAgICAgICBpZiAoaGVscERhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgaGVscFZhbHVlID0gaGVscERhdGEubWFwKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoaGVscEZpZWxkLCBpdGVtKTtcclxuICAgICAgICAgIH0pLmpvaW4oJywnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaGVscFZhbHVlID0gdGhpcy5nZXRWYWx1ZShoZWxwRmllbGQsIGhlbHBEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWRzLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgIHRoaXMudXBkYXRlQmluZGluZ0xpc3QoaWQsIG1hcEZpZWxkc1toZWxwRmllbGRdLCBoZWxwVmFsdWUpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBwcml2YXRlIHVwZGF0ZUJpbmRpbmdMaXN0KHByaW1hcnlWYWx1ZTogYW55LCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgY29uc3Qgdmlld01vZGVsID0gdGhpcy52aWV3TW9kZWwgfHwgbnVsbDtcclxuICAgIGlmICghdmlld01vZGVsIHx8ICFwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8g5pu05paw5Li76KGo6YOo5YiG6KGM55qE5a2X5q61XHJcbiAgICBjb25zdCBwcm9wZXJ0eU5hbWVzID0gcHJvcGVydHlOYW1lLnNwbGl0KCcuJykuZmlsdGVyKGl0ZW0gPT4gaXRlbSk7XHJcbiAgICBjb25zdCBiaW5kaW5nT2JqZWN0ID0gdGhpcy5iaW5kaW5nTGlzdC5maW5kQnlJZChwcmltYXJ5VmFsdWUpO1xyXG5cclxuICAgIGlmIChwcm9wZXJ0eU5hbWVzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgYmluZGluZ09iamVjdC5zZXRWYWx1ZShwcm9wZXJ0eU5hbWUsIHZhbHVlLCB0cnVlLCB0cnVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCB0YXJnZXRCaW5kaW5nT2JqZWN0ID0gbnVsbDtcclxuICAgICAgY29uc3QgZnBhdGhzID0gcHJvcGVydHlOYW1lcy5zbGljZSgwLCBwcm9wZXJ0eU5hbWVzLmxlbmd0aCAtIDEpO1xyXG4gICAgICBjb25zdCB0YXJnZXRQcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWVzW3Byb3BlcnR5TmFtZXMubGVuZ3RoIC0gMV07XHJcbiAgICAgIGZwYXRocy5mb3JFYWNoKHByb3AgPT4ge1xyXG4gICAgICAgIHRhcmdldEJpbmRpbmdPYmplY3QgPSB0YXJnZXRCaW5kaW5nT2JqZWN0ICYmIHRhcmdldEJpbmRpbmdPYmplY3RbcHJvcF0gfHwgYmluZGluZ09iamVjdFtwcm9wXTtcclxuICAgICAgfSk7XHJcbiAgICAgIC8vIHRvZG866ZyA6KaB5re75Yqg5YC85Y+Y5YyW5LqL5Lu2XHJcbiAgICAgIHRhcmdldEJpbmRpbmdPYmplY3Quc2V0VmFsdWUodGFyZ2V0UHJvcGVydHlOYW1lLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0QmluZGluZ1BhdGhBcnJheSgpOiBhbnlbXSB7XHJcbiAgICBjb25zdCBwYXRoID0gdGhpcy52aWV3TW9kZWwuYmluZGluZ1BhdGg7XHJcbiAgICBpZiAocGF0aCkge1xyXG4gICAgICByZXR1cm4gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihuID0+IG4gIT09ICcnKTtcclxuICAgIH1cclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXRWYWx1ZShmOiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgbGV0IHZhbCA9ICcnO1xyXG4gICAgaWYgKGYuaW5kZXhPZignLicpID09PSAtMSkge1xyXG4gICAgICB2YWwgPSBkYXRhW2ZdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFsID0gZi5zcGxpdCgnLicpLnJlZHVjZSgoYSwgYikgPT4ge1xyXG4gICAgICAgIHJldHVybiBhW2JdO1xyXG4gICAgICB9LCBkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdmFsO1xyXG4gIH1cclxuICBwcm90ZWN0ZWQgZ2V0IGJpbmRpbmdMaXN0KCk6IEJpbmRpbmdMaXN0IHtcclxuICAgIC8vIOagueWunuS9k1xyXG4gICAgaWYgKHRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoID09PSAnLycgfHwgIXRoaXMudmlld01vZGVsLmJpbmRpbmdQYXRoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nRGF0YS5saXN0O1xyXG4gICAgfVxyXG4gICAgLy8g5a2Q5a6e5L2TXHJcbiAgICBsZXQgYmluZGluZ1BhdGggPSB0aGlzLnZpZXdNb2RlbC5iaW5kaW5nUGF0aC5zdWJzdHIoMSk7XHJcbiAgICBiaW5kaW5nUGF0aCA9IGJpbmRpbmdQYXRoWzBdLnRvTG93ZXJDYXNlKCkgKyBiaW5kaW5nUGF0aC5zdWJzdHJpbmcoMSwgYmluZGluZ1BhdGgubGVuZ3RoKTtcclxuICAgIGNvbnN0IHBhdGhzID0gYmluZGluZ1BhdGguc3BsaXQoJy8nKTtcclxuXHJcbiAgICBjb25zdCBmaWx0ZXJlZFBhdGhzID0gcGF0aHMuZmlsdGVyKChwYXJ0OiBzdHJpbmcpID0+IHtcclxuICAgICAgcmV0dXJuIHBhcnQgIT09ICcnO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy52aWV3TW9kZWwuYmluZGluZ0RhdGEuZ2V0VmFsdWUoZmlsdGVyZWRQYXRocyk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOagueaNruaYoOWwhOWwhuaVsOaNrui1i+WAvOe7mWJpbmRpbmdEYXRhXHJcbiAgICogQHBhcmFtIGRhdGFcclxuICAgKiBAcGFyYW0gbWFwRmllbGRzXHJcbiAgICogQHBhcmFtIGJpbmRpbmdEYXRhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBtYXBwaW5nUm93KGRhdGE6IGFueSwgbWFwRmllbGRzOiBhbnksIGVudGl0eTogRW50aXR5LCBiaW5kaW5nUGF0aDogc3RyaW5nKSB7XHJcbiAgICBPYmplY3Qua2V5cyhtYXBGaWVsZHMpLmZvckVhY2goKHByb3A6IHN0cmluZykgPT4ge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeVBhdGgoZGF0YSwgcHJvcCk7XHJcbiAgICAgIGNvbnN0IGZpZWxkcyA9IG1hcEZpZWxkc1twcm9wXTtcclxuICAgICAgY29uc3QgZ3JvdXBzOiBhbnlbXSA9IGZpZWxkcy5zcGxpdCgnLCcpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICBncm91cHMuZm9yRWFjaChncm91cCA9PiB7XHJcbiAgICAgICAgY29uc3QgcGF0aHMgPSBncm91cC5zcGxpdCgnLicpLmZpbHRlcihwID0+IHApO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWVCeVBhdGgoZW50aXR5LCBwYXRocy5qb2luKCcuJyksIHZhbHVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YCa6L+HZnJhbWVJZOiOt+WPluWvueW6lOeahOe7hOS7tuS4iuS4i+aWh1xyXG4gICAqIEBwYXJhbSBmcmFtZUlkIGZyYW1lSWRcclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkOiBzdHJpbmcpOiBGcmFtZUNvbnRleHQgfCBudWxsIHtcclxuICAgIGlmICghZnJhbWVJZCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGFwcENvbnRleHQgPSB0aGlzLmluamVjdG9yLmdldDxBcHBDb250ZXh0PihBcHBDb250ZXh0LCBudWxsKTtcclxuICAgIGxldCBmcmFtZUNvbnRleHQ6IEZyYW1lQ29udGV4dCA9IG51bGw7XHJcbiAgICBpZiAoYXBwQ29udGV4dCkge1xyXG4gICAgICBmcmFtZUNvbnRleHQgPSBhcHBDb250ZXh0LmZyYW1lQ29udGV4dE1hbmFnZXIuZ2V0RnJhbWVDb250ZXh0QnlJZChmcmFtZUlkKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmcmFtZUNvbnRleHQ7XHJcbiAgfVxyXG4gIHByaXZhdGUgZ2V0RW50aXR5QnlQYXRoKGZyYW1lQ29udGV4dDogRnJhbWVDb250ZXh0LCBiaW5kaW5nUGF0aHM6IGFueVtdLCBjdXJyZW50SWQ6IHN0cmluZykge1xyXG4gICAgYmluZGluZ1BhdGhzID0gWy4uLmJpbmRpbmdQYXRoc107XHJcbiAgICBjb25zdCBpZCA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5saXN0LmN1cnJlbnRJZDtcclxuICAgIGNvbnN0IGVudGl0eTogRW50aXR5ID0gZnJhbWVDb250ZXh0LnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRFbnRpdHlCeUlkKGlkKSBhcyBFbnRpdHk7XHJcbiAgICBsZXQgaXRlbTogRW50aXR5ID0gZW50aXR5O1xyXG4gICAgY29uc3QgcGF0aHMgPSBbXTtcclxuICAgIGNvbnN0IHRhaWxQYXRoID0gYmluZGluZ1BhdGhzLnBvcCgpO1xyXG4gICAgY29uc3QgcGFyZW50ID0gYmluZGluZ1BhdGhzLnJlZHVjZSgob2JqZWN0OiBFbnRpdHksIHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICBwYXRocy5wdXNoKHBhdGgpO1xyXG4gICAgICBpZiAob2JqZWN0ICYmIChvYmplY3QuaGFzT3duUHJvcGVydHkocGF0aCkgfHwgb2JqZWN0WydfX3Byb3RvX18nXS5oYXNPd25Qcm9wZXJ0eShwYXRoKSkpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtwYXRoXTtcclxuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUgaW5zdGFuY2VvZiBFbnRpdHlMaXN0KSB7XHJcbiAgICAgICAgICBjb25zdCBiaW5kaW5nTGlzdCA9IGZyYW1lQ29udGV4dC5iaW5kaW5nRGF0YS5nZXRWYWx1ZShwYXRocykgYXMgQmluZGluZ0xpc3Q7XHJcbiAgICAgICAgICBjb25zdCBjdXJyZW50SXRlbUlkID0gYmluZGluZ0xpc3QuY3VycmVudElkO1xyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlLmdldChjdXJyZW50SXRlbUlkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSwgaXRlbSk7XHJcbiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgRW50aXR5KSB7XHJcbiAgICAgIGNvbnN0IGxpc3QgPSBwYXJlbnRbdGFpbFBhdGhdIGFzIEVudGl0eUxpc3Q8YW55PjtcclxuICAgICAgaWYgKGxpc3QpIHtcclxuICAgICAgICByZXR1cm4gbGlzdC5nZXQoY3VycmVudElkKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOaXoOaViOeahGJpbmRpbmdQYXRoLmApO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOaXoOaViOeahGJpbmRpbmdQYXRoLmApO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGVuZEVkaXQoZnJhbWVDb250ZXh0OiBGcmFtZUNvbnRleHQpIHtcclxuICAgIGNvbnN0IGFwcENvbnRleHQ6IEFwcENvbnRleHQgPSBmcmFtZUNvbnRleHQgJiYgZnJhbWVDb250ZXh0LmdldEZvcm1BcHBDb250ZXh0KCk7XHJcbiAgICByZXR1cm4gb2YobnVsbCkucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICBpZiAoYXBwQ29udGV4dCkge1xyXG4gICAgICAgICAgYXBwQ29udGV4dC5tZXNzYWdlUGlwZS5uZXh0KHsgdHlwZTogJ2VuZEVkaXQnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIC8vIHRvZG86IOS4jeW6lOivpeS9v+eUqGRlbGF577yM5bqU6K+l5Liy5rWBXHJcbiAgICAgIGRlbGF5KDUpXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=
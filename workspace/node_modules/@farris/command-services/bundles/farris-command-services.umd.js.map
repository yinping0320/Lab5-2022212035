{"version":3,"file":"farris-command-services.umd.js.map","sources":["ng://@farris/command-services/lib/form-loading/hide-event.service.ts","ng://@farris/command-services/lib/form-loading/form-loading.service.ts","ng://@farris/command-services/lib/languages/language-message-en.ts","ng://@farris/command-services/lib/languages/language-message-zh.ts","ng://@farris/command-services/lib/languages/language-message-zhft.ts","ng://@farris/command-services/lib/languages/language-message-factory.ts","ng://@farris/command-services/lib/languag.service.ts","ng://@farris/command-services/lib/error/types.ts","node_modules/tslib/tslib.es6.js","ng://@farris/command-services/lib/util/device-ability.ts","ng://@farris/command-services/lib/error/exception_strategy.ts","ng://@farris/command-services/lib/error/exception_strategy_factory.ts","ng://@farris/command-services/lib/util/http.ts","ng://@farris/command-services/lib/error/form-error.service.ts","ng://@farris/command-services/lib/form-message.service.ts","ng://@farris/command-services/lib/form-notify.service.ts","ng://@farris/command-services/lib/form-wizard.service.ts","ng://@farris/command-services/lib/check.service.ts","ng://@farris/command-services/lib/data-check.service.ts","ng://@farris/command-services/lib/event.service.ts","ng://@farris/command-services/lib/menu-state.service.ts","ng://@farris/command-services/lib/router.service.ts","ng://@farris/command-services/lib/types.ts","ng://@farris/command-services/lib/querystring.ts","ng://@farris/command-services/lib/rtf-service.ts","ng://@farris/command-services/lib/navigation-event.service.ts","ng://@farris/command-services/lib/farris-form.service.ts","ng://@farris/command-services/lib/navigation.service.ts","ng://@farris/command-services/lib/data-services/utils/edit-state.util.ts","ng://@farris/command-services/lib/data-services/utils/app-param.util.ts","ng://@farris/command-services/lib/form-notify-strategy.service.ts","ng://@farris/command-services/lib/command-service.ts","ng://@farris/command-services/lib/verify.service.ts","ng://@farris/command-services/lib/validation.service.ts","ng://@farris/command-services/lib/data-change-detection.service.ts","ng://@farris/command-services/lib/data-services/card-data.service.ts","ng://@farris/command-services/lib/navigation-middleware.service.ts","ng://@farris/command-services/lib/grid.middleware.service.ts","ng://@farris/command-services/lib/param.service.ts","ng://@farris/command-services/lib/keybinding-service.ts","ng://@farris/command-services/lib/filter-condition.service.ts","ng://@farris/command-services/lib/ui-state.service.ts","ng://@farris/command-services/lib/state-machine.service.ts","ng://@farris/command-services/lib/binding-data.service.ts","ng://@farris/command-services/lib/application-param.service.ts","ng://@farris/command-services/lib/entity-services/entity-traversing.service.ts","ng://@farris/command-services/lib/entity-services/entity-manipulation.service.ts","ng://@farris/command-services/lib/entity-services/entity-aggregation.service.ts","ng://@farris/command-services/lib/entity-services/entity-list.service.ts","ng://@farris/command-services/lib/entity-services/entity.service.ts","ng://@farris/command-services/lib/binding-path.service.ts","ng://@farris/command-services/lib/form-control.service.ts","ng://@farris/command-services/lib/frame-context.service.ts","ng://@farris/command-services/lib/focus-invalid.service.ts","ng://@farris/command-services/lib/change-item.service.ts","ng://@farris/command-services/lib/service.ts","ng://@farris/command-services/lib/data-grid.service.ts","ng://@farris/command-services/lib/data-services/list-data.service.ts","ng://@farris/command-services/lib/data-services/sub-list-data.service.ts","ng://@farris/command-services/lib/data-services/base-data.service.ts","ng://@farris/command-services/lib/data-services/tree-table/util/parent-tree.util.ts","ng://@farris/command-services/lib/data-services/tree-table/util/path-tree.util.ts","ng://@farris/command-services/lib/data-services/tree-table/util/tree-util-factory.ts","ng://@farris/command-services/lib/data-services/tree-table/repository/parent-tree-repository.ts","ng://@farris/command-services/lib/data-services/tree-table/repository/path-tree-repository.ts","ng://@farris/command-services/lib/data-services/tree-table/repository/tree-repository-factory.ts","ng://@farris/command-services/lib/data-services/tree-data.service.ts","ng://@farris/command-services/lib/data-services/filter-condition-data.service.ts","ng://@farris/command-services/lib/data-services/edit-data.service.ts","ng://@farris/command-services/lib/data-services/remove-data.service.ts","ng://@farris/command-services/lib/data-services/save-data.service.ts","ng://@farris/command-services/lib/data-services/sub-tree-data-service.ts","ng://@farris/command-services/lib/be-action.service.ts","ng://@farris/command-services/lib/approve.service.ts","ng://@farris/command-services/lib/print.service.ts","ng://@farris/command-services/lib/attachment/types.ts","ng://@farris/command-services/lib/attachment/attachment.util.ts","ng://@farris/command-services/lib/attachment/attachment-data.service.ts","ng://@farris/command-services/lib/attachment/attachment.service.ts","ng://@farris/command-services/lib/attachment/file.service.ts","ng://@farris/command-services/lib/dialog.service.ts","ng://@farris/command-services/lib/sidebar-service.ts","ng://@farris/command-services/lib/filter-service.ts","ng://@farris/command-services/lib/component-manager.service.ts","ng://@farris/command-services/lib/authority/authority.service.ts","ng://@farris/command-services/lib/authority/authority.ts","ng://@farris/command-services/lib/exception.handler.ts","ng://@farris/command-services/lib/providers/legacy_providers.ts","ng://@farris/command-services/lib/user-settings.service.ts","ng://@farris/command-services/lib/work-flow/work-flow-message.service.ts","ng://@farris/command-services/lib/work-flow/work-flow-message.ts","ng://@farris/command-services/lib/work-flow/work-flow-message.handler.ts","ng://@farris/command-services/lib/providers/module_providers.ts","ng://@farris/command-services/lib/query-solution/enum/compare-type.enum.ts","ng://@farris/command-services/lib/query-solution/enum/value-type.enum.ts","ng://@farris/command-services/lib/query-solution/enum/relation-type.enum.ts","ng://@farris/command-services/lib/query-solution/handlers/text.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/daterage.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/dropdown.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/numberrage.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/smarthelp.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-year.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/checkbox.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-month.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/monthrange.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-date-time.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-number.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/single-date.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/combolookup.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/radio.handler.ts","ng://@farris/command-services/lib/query-solution/handlers/inputgroup.handler.ts","ng://@farris/command-services/lib/query-solution/querycondition.handler.factory.ts","ng://@farris/command-services/lib/query-solution/query-solution.service.ts","ng://@farris/command-services/lib/end-edit.service.ts","ng://@farris/command-services/lib/remote-summary.service.ts","ng://@farris/command-services/lib/batch-edit.service.ts","ng://@farris/command-services/lib/discussion-group.service.ts","ng://@farris/command-services/lib/list-filter/list-filter.service.ts","ng://@farris/command-services/lib/manifest/form_manifest_service.ts","ng://@farris/command-services/lib/manifest/form_expression_manifest_service.ts","ng://@farris/command-services/lib/localization.service.ts","ng://@farris/command-services/lib/form-attention.service.ts","ng://@farris/command-services/lib/feature-edit/feature-repository.ts","ng://@farris/command-services/lib/feature-edit/types.ts","ng://@farris/command-services/lib/feature-edit/feature-data.service.ts","ng://@farris/command-services/lib/feature-edit/feature-edit.service.ts","ng://@farris/command-services/lib/expression_service.ts","ng://@farris/command-services/lib/dirty-checking.service.ts","ng://@farris/command-services/lib/pop_up.service.ts","ng://@farris/command-services/lib/form.service.ts","ng://@farris/command-services/lib/view-model.service.ts","ng://@farris/command-services/lib/pagination.service.ts","ng://@farris/command-services/lib/providers/frame_providers.ts","ng://@farris/command-services/lib/providers/dynamic_providers.ts","ng://@farris/command-services/lib/command-services-module.ts","ng://@farris/command-services/lib/rtf-message/message-pipe.ts","ng://@farris/command-services/lib/rtf-message/message-pipe-service.ts","ng://@farris/command-services/lib/back_end_message_handler.ts","ng://@farris/command-services/public-api.ts","ng://@farris/command-services/farris-command-services.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\n\r\n/**\r\n * åéæ¶æ¯ç»FormLoadingServiceï¼\r\n * ä½¿å¶æ¥æ¶åè°ç¨hide()å½æ°\r\n * æ­¤æå¡ä»ç¨äºå¤çHttpå¼å¸¸\r\n */\r\n@Injectable()\r\nclass HideEventService {\r\n    public hideEvent = new Subject<any>();\r\n}\r\n\r\nexport { HideEventService };","import { Injectable, SkipSelf, Optional } from '@angular/core';\r\nimport { LoadingService, LoadingConfig, LoadingComponent } from '@farris/ui-loading';\r\nimport { HideEventService } from './hide-event.service';\r\nimport { AppContext, FrameContext } from '@farris/devkit';\r\n// tslint:disable: no-string-literal\r\n/**\r\n * å è½½æç¤ºHelper\r\n * 1ãåè£@farris/uiçLoadingServiceï¼\r\n * 2ãæä¾éå¯¹è¡¨åçå¿«æ·æ¹æ³ï¼\r\n */\r\n@Injectable()\r\nclass FormLoadingService {\r\n  private static isSuspend = false;\r\n  /**\r\n   * å è½½ä¸­ç»ä»¶å®ä¾\r\n   */\r\n  private loadingCmp: LoadingComponent;\r\n\r\n  /**\r\n   * å»¶è¿loadingå®æ¶å¨\r\n   */\r\n  private loadingTimerIds: any[] = [];\r\n\r\n  /**\r\n   * å¼ºå¶æ¾ç¤ºï¼ä¸è½éè\r\n   */\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * æ³¨å¥@farris/uiçLoadingService\r\n   */\r\n  constructor(\r\n    private loadingService: LoadingService,\r\n    @Optional() private hideEventService: HideEventService,\r\n    @Optional() private applicationContext: AppContext,\r\n  ) {\r\n    if (hideEventService) {\r\n      this.hideEventService.hideEvent.subscribe(\r\n        result => {\r\n          this.hide();\r\n        }\r\n      );\r\n    }\r\n  }\r\n  public setSuspend(flag: boolean) {\r\n    FormLoadingService.isSuspend = flag;\r\n  }\r\n  /**\r\n   * æ¾ç¤ºå è½½ä¸­\r\n   */\r\n  public show(configOrMessage?: any): LoadingComponent {\r\n    if (FormLoadingService.isSuspend === true) {\r\n      return;\r\n    }\r\n    if (this.loadingCmp) {\r\n      this.loadingCmp.close();\r\n      this.loadingCmp = null;\r\n    }\r\n    this.registerService();\r\n    const loadingConfig = this.buildLoadingConfig(configOrMessage);\r\n    this.loadingCmp = this.loadingService.show(loadingConfig);\r\n    return this.loadingCmp;\r\n  }\r\n\r\n  /**\r\n   * å»¶è¿æ¾ç¤ºLoading\r\n   */\r\n  public showLoadingWithDelay(delayTime: number, configOrMessage?: any): any {\r\n    // this.show(configOrMessage);\r\n    const timerId = setTimeout(() => {\r\n      this.show(configOrMessage);\r\n    }, delayTime);\r\n    this.loadingTimerIds.push(timerId);\r\n    this.registerService();\r\n    return timerId;\r\n  }\r\n\r\n  /**\r\n   * éèå»¶è¿çLoading\r\n   */\r\n  public hideDelayLoading(timerIdToClear: any) {\r\n    this.clearLoadingTimer(timerIdToClear);\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * æé LoadingConfig\r\n   * @param configOrMessage éç½®å¯¹è±¡ææ¶æ¯å­ç¬¦ä¸²\r\n   */\r\n  private buildLoadingConfig(configOrMessage: any): LoadingConfig {\r\n    let loadingConfig: LoadingConfig;\r\n    if (!!configOrMessage) {\r\n      if (typeof configOrMessage === 'object') {\r\n        loadingConfig = configOrMessage;\r\n      } else {\r\n        loadingConfig = { 'message': configOrMessage };\r\n      }\r\n    } else {\r\n      loadingConfig = {};\r\n    }\r\n    if (!loadingConfig.hasOwnProperty('delay')) {\r\n      loadingConfig.delay = 0;\r\n    }\r\n    return loadingConfig;\r\n  }\r\n\r\n  /**\r\n   * å³é­ææloading\r\n   */\r\n  public clearAll() {\r\n    FormLoadingService.isSuspend = false;\r\n    window.setTimeout(() => {\r\n      this.loadingService.clearAll();\r\n    }, 350);\r\n    this.loadingCmp = null;\r\n    this.clearAllLoadingTimers();\r\n    this.destroy();\r\n  }\r\n\r\n  /**\r\n   * æ¸ç©ºLoadingå®æ¶å¨\r\n   */\r\n  private clearLoadingTimer(timerIdToClear: any) {\r\n    clearTimeout(timerIdToClear);\r\n    this.loadingTimerIds = this.loadingTimerIds.filter((timerId: any) => {\r\n      return timerId !== timerIdToClear;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * æ¸ç©ºææLoadingå®æ¶å¨\r\n   */\r\n  private clearAllLoadingTimers() {\r\n    this.loadingTimerIds.forEach((timerId: any) => {\r\n      this.clearLoadingTimer(timerId);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * éèå è½½ä¸­\r\n   */\r\n  public hide() {\r\n    if (!this.loadingCmp) {\r\n      this.destroy();\r\n      return;\r\n    }\r\n    if (FormLoadingService.isSuspend === true) {\r\n      return;\r\n    }\r\n    this.loadingCmp.close();\r\n    this.loadingCmp = null;\r\n    this.destroy();\r\n  }\r\n  /**\r\n   * éæ¯loadingService\r\n   */\r\n  public destroy() {\r\n    if (FormLoadingService.isSuspend === true) {\r\n      return;\r\n    }\r\n    const services: any[] = window['DEVKIT_LOADING_SERVICE'] || [];\r\n    if (services && Array.isArray(services) && services.length > 0) {\r\n      services.forEach((service: FormLoadingService) => {\r\n        if (service) {\r\n          service.clearAllLoadingTimers();\r\n          if (service.loadingCmp) {\r\n            service.loadingCmp.close();\r\n            service.loadingCmp = null;\r\n        }\r\n        }\r\n      });\r\n    }\r\n    window['DEVKIT_LOADING_SERVICE'] = [];\r\n  }\r\n\r\n  /**\r\n   * æ³¨åææçLoadingServiceå®ä¾\r\n   */\r\n  private registerService() {\r\n    const services: any[] = window['DEVKIT_LOADING_SERVICE'] || [];\r\n    services.push(this);\r\n    window['DEVKIT_LOADING_SERVICE'] = services;\r\n  }\r\n}\r\n\r\n\r\nexport { FormLoadingService };\r\n","\r\nimport { LanguageMessage } from './language-message';\r\n\r\n/**\r\n * è±æè¯­è¨æ¶æ¯\r\n */\r\nclass LanguageMessageForEn implements LanguageMessage {\r\n  yes = 'Yes';\r\n  no = 'No';\r\n  unsaveNotifyTitle = 'Exist unsave record. Do save operation or not?';\r\n  clientNotifyTitle = 'System Prompt In The Frontend';\r\n  serverNotifyTitle = 'System Prompt In The Backend';\r\n  cancelApproveSuccess = 'Cancel Approve Success';\r\n  cancelApproveFailed = 'Cancel Approve Failed';\r\n  unallowEmptyProcessInstanceName = 'Process Instance Name Can Not Be Empty';\r\n  unallowEmptyBizBillId = 'Biz Bill Id Can Not Be Empty';\r\n  unallowEmptyChildBizBillId = 'Child Biz Bill Id Can Not Be Empty';\r\n  bizDefKeyRequired = 'Biz Def Key can\\'t be empty.';\r\n  procInsIdRequired = 'Process instance Id can\\'t be empty.';\r\n  addChildFailed = 'Add Child Failed';\r\n  addSiblingFailed = 'Add Sibling Failed';\r\n  addSubChildFailed = 'Add Sub Child Failed';\r\n  addSubSiblingFailed = 'Add Sub Sibling Failed';\r\n  deleteFailed = 'Delete Failed';\r\n  multiSaveFailed = 'MultiSave Failed';\r\n  appendFailed = 'Append Failed';\r\n  queryFailed = 'Query Failed';\r\n  cancelFailed = 'Cancel Failed';\r\n  updateFailed = 'Update Failed';\r\n  addFailed = 'Add Failed';\r\n  loadFailed = 'Load Failed';\r\n  saveSuccess = 'Successfully saved!';\r\n  saveFailed = 'Save failed!';\r\n  deleteSuccess = 'Successfully deleted!';\r\n  deleteFaild = 'Failed to delete!';\r\n  confirmDeletion = 'Confirm deletion?';\r\n  submitSuccess = 'Submit successfully!';\r\n  submitFaild = 'Submit failed!';\r\n  notifyTitle = 'System prompt';\r\n  httpError = 'HTTP request error! Please check the server error!';\r\n  gridDataNotSave = 'The current page data is not saved. Turning the page will result in data loss. Do you want to continue turning the page?';\r\n  exitWithoutSave = 'There is unsaved data. Do you want to continue closing?';\r\n  notSupportMenuType = 'Not supported menu type!';\r\n  cancelWithoutSave = 'Exist unsaved change,Confirm to cancel?';\r\n  plsSelectDeleteData = 'Please select the data to delete!';\r\n  errorHierarchyKey = 'Incorrect ierarchy key';\r\n  plsSelectParentNode = 'Please select parent node!';\r\n  deleteChildFirst = 'Please delete the child nodes first!';\r\n  incorrectHierarchyConfig = 'Hierarchy config is incorrect!';\r\n  operationFailed = 'The operation failed.';\r\n  plsSelectEditData = 'Please select the data you want to edit!';\r\n  plsSelectViewData = 'Please select the data you want to view!';\r\n  plsUploadFirst = 'Please upload attachment first!';\r\n  defaultDialogTitle = 'Dialog';\r\n  public changeToFirst = 'The first data.';\r\n  public changeToLast = 'The last data.';\r\n  public noProcessInstanceId = 'Please provide the process instance id.';\r\n  public noDataExist = 'Data does not exist to access the edit state!';\r\n  public noAttachment = 'There are no attachments to preview.';\r\n  public confirm = 'Confirm';\r\n  public cancel = 'Cancel';\r\n  public plsSelectCopyData = 'Please select the data you want to copy!';\r\n  public copyFieldsRequired = 'The copy fields can`t be empty!';\r\n  public pathIsRequired = 'The request url can`t be empty!';\r\n  public propsIsEmpty = 'The material has no props!';\r\n  public historyAttachment = 'The history attachment can`t be delete!';\r\n  public plsSelectDownloadAtt = 'Please select the attachment you want to download!';\r\n  public noDownloadAtt = 'There are no attachments to download!';\r\n  public plsCheckBatchEditRows = 'Please check the rows you want to edit!';\r\n  public plsSelectDetailFormData = 'Please select a detail form data first!';\r\n  public dataAndStateChanged = 'Are you sure you want to load the new data and switch to $1 state?';\r\n  public dataChanged = 'Are you sure you want to load the data and discards the current modification?';\r\n  public stateChanged = 'Are you sure you want to switch $1 state?';\r\n  public defaultStateName = 'init';\r\n  public copy = 'Copy detail message';\r\n  public copySuccess = 'Copy success';\r\n  public copyFailed = 'Copy failed';\r\n  public roger = 'Roger';\r\n  public appOrFuncIdRequired = 'No menu or application parameters are configured, please configure them in the designer.';\r\n  public tableCanNotEmpty = 'can not empty.';\r\n  public plsSelectRemoveAtt = 'Please select the attachment to delete!';\r\n  public plsSelectUpdateRow = 'Please select the row where you want to update the attachment!';\r\n}\r\n\r\nexport { LanguageMessageForEn };\r\n","import { LanguageMessage } from './language-message';\r\n\r\n/**\r\n * è±æè¯­è¨æ¶æ¯\r\n */\r\nclass LanguageMessageForZh implements LanguageMessage {\r\n  public yes = 'æ¯';\r\n  public no = 'å¦';\r\n  public unsaveNotifyTitle = 'å­å¨æªä¿å­è®°å½ãæ¯å¦è¦ä¿å­ï¼';\r\n  public clientNotifyTitle = 'åç«¯å¼å¸¸æç¤º';\r\n  public serverNotifyTitle = 'æå¡å¨ç«¯å¼å¸¸æç¤º';\r\n  public cancelApproveSuccess = 'åæ¶æäº¤æåï¼';\r\n  public cancelApproveFailed = 'åæ¶æäº¤å¤±è´¥ï¼';\r\n  public unallowEmptyProcessInstanceName = 'æµç¨å®ä¾åç§°ä¸è½ä¸ºç©º';\r\n  public unallowEmptyBizBillId = 'è¯·éæ©ä¸æ¡æ°æ®';\r\n  public bizDefKeyRequired = 'å¥å£åæ®ä¸è½ä¸ºç©º';\r\n  public unallowEmptyChildBizBillId = 'ä»è¡¨ä¸å¡åæ®ç¼å·ä¸è½ä¸ºç©ºï¼';\r\n  public procInsIdRequired = 'æµç¨å®ä¾Idä¸è½ä¸ºç©ºï¼';\r\n  public addChildFailed = 'æ°å¢å­çº§å¤±è´¥';\r\n  public addSiblingFailed = 'æ°å¢åçº§å¤±è´¥';\r\n  public addSubChildFailed = 'æ°å¢ä»è¡¨å­çº§å¤±è´¥';\r\n  public addSubSiblingFailed = 'æ°å¢ä»è¡¨åçº§å¤±è´¥';\r\n  public deleteFailed = 'å é¤å¤±è´¥';\r\n  public multiSaveFailed = 'æ¹éä¿å­å¤±è´¥';\r\n  public appendFailed = 'è¿½å å¤±è´¥';\r\n  public queryFailed = 'æ¥è¯¢å¤±è´¥';\r\n  public cancelFailed = 'åæ¶å¤±è´¥';\r\n  public updateFailed = 'æ´æ°å¤±è´¥';\r\n  public addFailed = 'æ°å¢å¤±è´¥';\r\n  public loadFailed = 'å è½½å¤±è´¥';\r\n  public saveSuccess = 'ä¿å­æåï¼';\r\n  public saveFailed = 'ä¿å­å¤±è´¥ï¼';\r\n  public deleteSuccess = 'å é¤æåï¼';\r\n  public deleteFaild = 'å é¤å¤±è´¥ï¼';\r\n  public confirmDeletion = 'ç¡®è®¤å é¤ï¼';\r\n  public submitSuccess = 'æäº¤å®¡æ¹æåï¼';\r\n  public submitFaild = 'æäº¤å®¡æ¹å¤±è´¥ï¼';\r\n  public notifyTitle = 'ç³»ç»æç¤º';\r\n  public httpError = 'HTTPè¯·æ±éè¯¯ï¼è¯·æ£æ¥Serverç«¯éè¯¯ï¼';\r\n  public gridDataNotSave = 'å½åé¡µæ°æ®æªä¿å­ï¼ç¿»é¡µå°å¯¼è´æ°æ®ä¸¢å¤±ï¼æ¯å¦ç»§ç»­ç¿»é¡µï¼';\r\n  public exitWithoutSave = 'å­å¨æªä¿å­çæ°æ®ï¼æ¯å¦ç»§ç»­å³é­ï¼';\r\n  public notSupportMenuType = 'å³é­çæ¢ä¸æ¯èåä¹ä¸æ¯åºç¨ã';\r\n  public cancelWithoutSave = 'å­å¨æªä¿å­çåæ´ï¼ç¡®è®¤åæ¶ï¼';\r\n  public plsSelectDeleteData = 'è¯·éæ©è¦å é¤çæ°æ®ï¼';\r\n  public errorHierarchyKey = 'éè¯¯çåçº§ç ';\r\n  public plsSelectParentNode = 'è¯·éæ©ç¶èç¹';\r\n  public deleteChildFirst = 'è¯·åå é¤å­èç¹';\r\n  public incorrectHierarchyConfig = 'åçº§ç éç½®ä¿¡æ¯éè¯¯';\r\n  public operationFailed = 'æä½æ§è¡å¤±è´¥ã';\r\n  public plsSelectEditData = 'è¯·éæ©è¦ç¼è¾çæ°æ®ï¼';\r\n  public plsSelectViewData = 'è¯·éæ©è¦æ¥ççæ°æ®ï¼';\r\n  public plsUploadFirst = 'è¯·åä¸ä¼ éä»¶ï¼';\r\n  public defaultDialogTitle = 'å¼¹çª';\r\n  public changeToFirst = 'å·²å°è¾¾ç¬¬ä¸æ¡æ°æ®';\r\n  public changeToLast = 'å·²å°è¾¾æåä¸æ¡æ°æ®';\r\n  public noProcessInstanceId = 'è¯·æå®æµç¨å®ä¾æ è¯ã';\r\n  public noDataExist = 'è¦ç¼è¾çæ°æ®ä¸å­å¨ï¼æ æ³è¿å¥ç¼è¾ç¶æï¼';\r\n  public noAttachment = 'æ²¡æå¯ä»¥é¢è§çéä»¶ã';\r\n  public confirm = 'ç¡®å®';\r\n  public cancel = 'åæ¶';\r\n  public plsSelectCopyData = 'è¯·éæ©è¦å¤å¶çæ°æ®ï¼';\r\n  public copyFieldsRequired = 'è¦å¤å¶çå­æ®µä¸è½ä¸ºç©ºï¼';\r\n  public pathIsRequired = 'è¯·æ±è·¯å¾ä¸è½ä¸ºç©ºï¼';\r\n  public propsIsEmpty = 'æ²¡æå¯ä»¥ç¼è¾çç©æç¹å¾ï¼';\r\n  public historyAttachment = 'åå²çæ¬éä»¶ç¦æ­¢å é¤ï¼';\r\n  public plsSelectDownloadAtt = 'è¯·éæ©è¦ä¸è½½çéä»¶!';\r\n  public noDownloadAtt = 'æ¾ä¸å°è¦ä¸è½½çéä»¶!'\r\n  public plsCheckBatchEditRows = 'è¯·å¾éè¦æ¹éç¼è¾çè¡ï¼';\r\n  public plsSelectDetailFormData = 'è¯·åéæ©ä¸æ¡ä»è¡¨æ°æ®ï¼';\r\n  public dataAndStateChanged = 'ç¡®å®è¦å è½½æ°æ®å¹¶åæ¢å°$1ç¶æï¼';\r\n  public dataChanged = 'ç¡®å®è¦å è½½æ°æ®å¹¶æ¾å¼å½åä¿®æ¹ï¼';\r\n  public stateChanged = 'ç¡®å®è¦åæ¢å°$1ç¶æï¼';\r\n  public defaultStateName = 'åå§';\r\n  public copy = 'å¤å¶è¯¦ç»ä¿¡æ¯';\r\n  public copySuccess = 'å¤å¶æå';\r\n  public copyFailed = 'å¤å¶å¤±è´¥';\r\n  public roger = 'ç¥éäº';\r\n  public appOrFuncIdRequired = 'æªéç½®èåæåºç¨åæ°ï¼è¯·å¨è®¾è®¡å¨ä¸­éç½®ã';\r\n  public tableCanNotEmpty = 'ä¸è½ä¸ºç©ºã';\r\n  public plsSelectRemoveAtt = 'è¯·éæ©è¦å é¤çéä»¶!';\r\n  public plsSelectUpdateRow = 'è¯·éæ©è¦æ´æ°éä»¶çè¡ï¼';\r\n}\r\n\r\nexport { LanguageMessageForZh };\r\n","import { LanguageMessage } from './language-message';\r\n\r\n/**\r\n * ç¹ä½ä¸­æè¯­è¨æ¶æ¯\r\n */\r\nclass LanguageMessageForZhft implements LanguageMessage {\r\n  public yes = 'æ¯';\r\n  public no = 'å¦';\r\n  public unsaveNotifyTitle = 'å­å¨æªä¿å­è¨éãæ¯å¦è¦ä¿å­ï¼';\r\n  public clientNotifyTitle = 'åç«¯ç°å¸¸æç¤º';\r\n  public serverNotifyTitle = 'æåå¨ç«¯ç°å¸¸æç¤º';\r\n  public cancelApproveSuccess = 'åæ¶æäº¤æåï¼';\r\n  public cancelApproveFailed = 'åæ¶æäº¤å¤±æï¼';\r\n  public unallowEmptyProcessInstanceName = 'æµç¨å¯¦ä¾åç¨±ä¸è½çºç©º';\r\n  public unallowEmptyBizBillId = 'è«é¸æå£¹æ¢æ¸æ';\r\n  public bizDefKeyRequired = 'å¥å£å®æä¸è½çºç©º';\r\n  public unallowEmptyChildBizBillId = 'å¾è¡¨æ¥­åå®æç·¨èä¸è½çºç©ºï¼';\r\n  public procInsIdRequired = 'æµç¨å¯¦ä¾idä¸è½çºç©ºï¼';\r\n  public addChildFailed = 'æ°å¢å­ç´å¤±æ';\r\n  public addSiblingFailed = 'æ°å¢åç´å¤±æ';\r\n  public addSubChildFailed = 'æ°å¢å¾è¡¨å­ç´å¤±æ';\r\n  public addSubSiblingFailed = 'æ°å¢å¾è¡¨åç´å¤±æ';\r\n  public deleteFailed = 'åªé¤å¤±æ';\r\n  public multiSaveFailed = 'æ¹éä¿å­å¤±æ';\r\n  public appendFailed = 'è¿½å å¤±æ';\r\n  public queryFailed = 'æ¥è©¢å¤±æ';\r\n  public cancelFailed = 'åæ¶å¤±æ';\r\n  public updateFailed = 'æ´æ°å¤±æ';\r\n  public addFailed = 'æ°å¢å¤±æ';\r\n  public loadFailed = 'å è¼å¤±æ';\r\n  public saveSuccess = 'ä¿å­æåï¼';\r\n  public saveFailed = 'ä¿å­å¤±æï¼';\r\n  public deleteSuccess = 'åªé¤æåï¼';\r\n  public deleteFaild = 'åªé¤å¤±æï¼';\r\n  public confirmDeletion = 'ç¢ºèªåªé¤ï¼';\r\n  public submitSuccess = 'æäº¤å¯©æ¹æåï¼';\r\n  public submitFaild = 'æäº¤å¯©æ¹å¤±æï¼';\r\n  public notifyTitle = 'ç³»çµ±æç¤º';\r\n  public httpError = 'HTTPè«æ±é¯èª¤ï¼è«æª¢æ¥Serverç«¯é¯èª¤ï¼';\r\n  public gridDataNotSave = 'ç¶åé æ¸ææªä¿å­ï¼ç¿»é å°å°è´æ¸æä¸å¤±ï¼æ¯å¦ç¹¼çºç¿»é ï¼';\r\n  public exitWithoutSave = 'å­å¨æªä¿å­çæ¸æï¼æ¯å¦ç¹¼çºééï¼';\r\n  public notSupportMenuType = 'ééçæ¢ä¸æ¯èå®ä¹ä¸æ¯æç¨ã';\r\n  public cancelWithoutSave = 'å­å¨æªä¿å­çè®æ´ï¼ç¢ºèªåæ¶ï¼';\r\n  public plsSelectDeleteData = 'è«é¸æè¦åªé¤çæ¸æï¼';\r\n  public errorHierarchyKey = 'é¯èª¤çåç´ç¢¼';\r\n  public plsSelectParentNode = 'è«é¸æç¶ç¯é»';\r\n  public deleteChildFirst = 'è«ååªé¤å­ç¯é»';\r\n  public incorrectHierarchyConfig = 'åç´ç¢¼éç½®ä¿¡æ¯é¯èª¤';\r\n  public operationFailed = 'æä½å·è¡å¤±æã';\r\n  public plsSelectEditData = 'è«é¸æè¦ç·¨è¼¯çæ¸æï¼';\r\n  public plsSelectViewData = 'è«é¸æè¦æ¥ççæ¸æï¼';\r\n  public plsUploadFirst = 'è«åä¸å³éä»¶ï¼';\r\n  public defaultDialogTitle = 'å½çª';\r\n  public changeToFirst = 'å·²å°éç¬¬å£¹æ¢æ¸æ';\r\n  public changeToLast = 'å·²å°éæå¾å£¹æ¢æ¸æ';\r\n  public noProcessInstanceId = 'è«æå®æµç¨å¯¦ä¾æ¨è­ã';\r\n  public noDataExist = 'è¦ç·¨è¼¯çæ¸æä¸å­å¨ï¼ç¡æ³é²å¥ç·¨è¼¯çæï¼';\r\n  public noAttachment = 'æ²æå¯ä»¥é è¦½çéä»¶ã';\r\n  public confirm = 'ç¢ºå®';\r\n  public cancel = 'åæ¶';\r\n  public plsSelectCopyData = 'è«é¸æè¦å¾©å¶çæ¸æï¼';\r\n  public copyFieldsRequired = 'è¦å¾©å¶çå­æ®µä¸è½çºç©ºï¼';\r\n  public pathIsRequired = 'è«æ±è·¯å¾ä¸è½çºç©ºï¼';\r\n  public propsIsEmpty = 'æ²æå¯ä»¥ç·¨è¼¯çç©æç¹å¾ï¼';\r\n  public historyAttachment = 'æå²çæ¬éä»¶ç¦æ­¢åªé¤ï¼';\r\n  public plsSelectDownloadAtt = 'è«é¸æè¦ä¸è¼çéä»¶!';\r\n  public noDownloadAtt = 'æ¾ä¸å°è¦ä¸è¼çéä»¶ï¼';\r\n  public plsCheckBatchEditRows = 'è«å¾é¸è¦æ¹éç·¨è¼¯çè¡ï¼';\r\n  public plsSelectDetailFormData = 'è«åé¸æä¸æ¢å¾è¡¨æ¸æï¼';\r\n  public dataAndStateChanged = 'ç¢ºå®è¦å è¼æ¸æä¸¦åæå°$1çæï¼';\r\n  public dataChanged = 'ç¢ºå®è¦å è¼æ¸æä¸¦æ¾æ£ç¶åä¿®æ¹ï¼';\r\n  public stateChanged = 'ç¢ºå®è¦åæå°$1çæï¼';\r\n  public defaultStateName = 'åå§';\r\n  public copy = 'å¾©å¶è©³ç´°ä¿¡æ¯';\r\n  public copySuccess = 'å¾©å¶æå';\r\n  public copyFailed = 'å¾©å¶å¤±æ';\r\n  public roger = 'ç¥éäº';\r\n  public appOrFuncIdRequired = 'æªéç½®èå®ææç¨åæ¸ï¼è«å¨è¨­è¨å¨ä¸­éç½®ã';\r\n  public tableCanNotEmpty = 'ä¸è½çºç©ºã';\r\n  public plsSelectRemoveAtt = 'è«é¸æè¦åªé¤çéä»¶!';\r\n  public plsSelectUpdateRow = 'è«é¸ææ´æ°éä»¶çè¡ï¼';\r\n}\r\n\r\nexport { LanguageMessageForZhft };\r\n","import { LanguageMessage } from './language-message';\r\nimport { LanguageMessageForZh } from './language-message-zh';\r\nimport { LanguageMessageForEn } from './language-message-en';\r\nimport { LanguageMessageForZhft } from './language-message-zhft';\r\nclass LanguageMessageFactory {\r\n\r\n  private static languageMessageMap: Map<string, LanguageMessage> = new Map<string, LanguageMessage>();\r\n\r\n  /**\r\n   * Create an instance by language\r\n   */\r\n  public static create(language: string): LanguageMessage {\r\n    if (this.languageMessageMap.has(language) === true) {\r\n      return this.languageMessageMap.get(language);\r\n    }\r\n\r\n    let languageMessage: LanguageMessage;\r\n    switch (language) {\r\n      case 'zh-CHS':\r\n        languageMessage = new LanguageMessageForZh();\r\n        break;\r\n      case 'en':\r\n        languageMessage = new LanguageMessageForEn();\r\n        break;\r\n      case 'zh-CHT':\r\n        languageMessage = new LanguageMessageForZhft();\r\n        break;\r\n      default:\r\n        languageMessage = new LanguageMessageForZh();\r\n        break;\r\n    }\r\n    this.languageMessageMap.set(language, languageMessage);\r\n\r\n    return languageMessage;\r\n  }\r\n}\r\n\r\nexport { LanguageMessageFactory };\r\n","import { Injectable, LOCALE_ID, Optional, Inject } from '@angular/core';\r\nimport { LanguageMessage, LanguageMessageFactory } from './languages/index';\r\n\r\n\r\n/**\r\n * å¤è¯­è¨æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass LanguageService implements LanguageMessage {\r\n\r\n  /**\r\n   * åä¾å¯¹è±¡\r\n   */\r\n  private static innerInstance: LanguageService = null;\r\n\r\n  // #region å®ç°LanguageMessageæ¥å£ï¼æ¹ä¾¿ä¹¦å\r\n  public yes: string;\r\n  public no: string;\r\n  public unsaveNotifyTitle: string;\r\n  public clientNotifyTitle: string;\r\n  public serverNotifyTitle: string;\r\n  public cancelApproveSuccess: string;\r\n  public cancelApproveFailed: string;\r\n  public unallowEmptyProcessInstanceName: string;\r\n  public unallowEmptyBizBillId: string;\r\n  public unallowEmptyChildBizBillId: string;\r\n  public bizDefKeyRequired: string;\r\n  public procInsIdRequired: string;\r\n  public addChildFailed: string;\r\n  public addSiblingFailed: string;\r\n  public addSubChildFailed: string;\r\n  public addSubSiblingFailed: string;\r\n  public deleteFailed: string;\r\n  public multiSaveFailed: string;\r\n  public appendFailed: string;\r\n  public queryFailed: string;\r\n  public cancelFailed: string;\r\n  public updateFailed: string;\r\n  public addFailed: string;\r\n  public loadFailed: string;\r\n  public saveSuccess: string;\r\n  public saveFailed: string;\r\n  public deleteSuccess: string;\r\n  public deleteFaild: string;\r\n  public confirmDeletion: string;\r\n  public submitSuccess: string;\r\n  public submitFaild: string;\r\n  public notifyTitle: string;\r\n  public httpError: string;\r\n  public gridDataNotSave: string;\r\n  public exitWithoutSave: string;\r\n  public notSupportMenuType: string;\r\n  public cancelWithoutSave: string;\r\n  public plsSelectDeleteData: string;\r\n  public errorHierarchyKey: string;\r\n  public plsSelectParentNode: string;\r\n  public deleteChildFirst: string;\r\n  public incorrectHierarchyConfig: string;\r\n  public operationFailed: string;\r\n  public plsSelectEditData: string;\r\n  public plsSelectViewData: string;\r\n  public plsUploadFirst: string;\r\n  public defaultDialogTitle: string;\r\n  public changeToFirst: string;\r\n  public changeToLast: string;\r\n  public noProcessInstanceId: string;\r\n  public noDataExist: string;\r\n  public noAttachment: string;\r\n  public confirm: string;\r\n  public cancel: string;\r\n  public plsSelectCopyData: string;\r\n  public copyFieldsRequired: string;\r\n  public pathIsRequired: string;\r\n  public propsIsEmpty: string;\r\n  public historyAttachment: string;\r\n  public plsSelectDownloadAtt: string;\r\n  public noDownloadAtt: string;\r\n  public plsCheckBatchEditRows: string;\r\n  public plsSelectDetailFormData: string;\r\n  public dataAndStateChanged: string;\r\n  public dataChanged: string;\r\n  public stateChanged: string;\r\n  public defaultStateName: string;\r\n  public copy: string;\r\n  public copySuccess: string;\r\n  public copyFailed: string;\r\n  public roger: string;\r\n  public appOrFuncIdRequired: string;\r\n  public tableCanNotEmpty: string;\r\n  public plsSelectRemoveAtt: string;\r\n  public plsSelectUpdateRow: string;\r\n  // #endregion\r\n\r\n  /**\r\n   * å½åè¯­è¨\r\n   */\r\n  protected language = 'zh-CHS';\r\n\r\n  /**\r\n   * å½åè¯­è¨å\r\n   */\r\n  protected get languageMessage(): LanguageMessage {\r\n    return LanguageMessageFactory.create(this.language);\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(@Optional() @Inject(LOCALE_ID) localeId?: string) {\r\n    this.language = localeId || 'zh-CHS';\r\n    this.extendProperties();\r\n    LanguageService.innerInstance = this;\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä¾\r\n   */\r\n  public static getInstance() {\r\n    if (this.innerInstance) {\r\n      return this.innerInstance;\r\n    }\r\n    const instance = new LanguageService('zh-CHS');\r\n    LanguageService.innerInstance = instance;\r\n    return instance;\r\n  }\r\n\r\n  /**\r\n   * æ©å±å±æ§\r\n   */\r\n  private extendProperties() {\r\n    Object.keys(this.languageMessage).forEach((propName: string) => {\r\n      Object.defineProperty(this, propName, {\r\n        get: () => {\r\n          return this.languageMessage[propName];\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport { LanguageService };\r\n","\r\n/**\r\n * æå¡å¨ç«¯å¼å¸¸å®ä½\r\n */\r\nclass ServerExceptionEntity {\r\n\r\n  Code: string;\r\n\r\n  Level: ExceptionLevel;\r\n\r\n  Message: string;\r\n\r\n  Detail: string;\r\n\r\n  RequestId: string;\r\n\r\n  date?: string;\r\n\r\n  innerMessage?: string;\r\n\r\n}\r\n\r\n/**\r\n * æå¡å¨ç«¯å¼å¸¸ç­çº§\r\n */\r\nconst enum ExceptionLevel {\r\n\r\n  /**\r\n   * æç¤ºä¿¡æ¯\r\n   */\r\n  Info = 0,\r\n\r\n  /**\r\n   * è­¦å\r\n   */\r\n  Warning,\r\n\r\n  /**\r\n   * éè¯¯\r\n   */\r\n  Error,\r\n\r\n  /**\r\n   * è´å½éè¯¯\r\n   */\r\n  Fatal\r\n}\r\n\r\nexport { ServerExceptionEntity, ExceptionLevel };\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export class DeviceAbility {\r\n  /**\r\n   * å¤å¶å°ç²è´´æ¿\r\n   * @param text \r\n   * @returns \r\n   */\r\n  public static copyToClipboard(text): boolean {\r\n    const windowRef: any = window;\r\n    if (windowRef.clipboardData && windowRef.clipboardData.setData) {\r\n      return windowRef.clipboardData.setData(\"Text\", text);\r\n    } else if (document.queryCommandSupported && document.queryCommandSupported(\"copy\")) {\r\n      var textarea = document.createElement(\"textarea\");\r\n      textarea.textContent = text;\r\n      textarea.style.position = \"fixed\";\r\n      document.body.appendChild(textarea);\r\n      textarea.select();\r\n      try {\r\n        return document.execCommand(\"copy\");\r\n      } catch (ex) {\r\n      } finally {\r\n        document.body.removeChild(textarea);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}","\r\nimport { Optional } from '@angular/core';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { LanguageService } from '../languag.service';\r\nimport { ServerExceptionEntity } from './types';\r\nimport { DeviceAbility } from '../util/device-ability';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport moment from 'moment';\r\n/**\r\n * å¼å¸¸å¤çæ¥å£\r\n */\r\nexport interface IExceptionStrategy {\r\n  handleException(error: ServerExceptionEntity): void;\r\n}\r\n\r\n\r\n/**\r\n * å¼å¸¸å¤çåºç±»\r\n */\r\nexport class ExceptionStrategy {\r\n  constructor(\r\n    public messagerService: MessagerService,\r\n    @Optional() public languageService: LanguageService) {\r\n  }\r\n}\r\n\r\n/**\r\n * ä¿¡æ¯çº§å«å¼å¸¸å¤ç\r\n */\r\nexport class InfoExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.messagerService.info(error.Message);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * è­¦åçº§å«å¼å¸¸å¤ç\r\n */\r\nexport class WarningExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.messagerService.warning(error.Message);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * éè¯¯çº§å«å¼å¸¸å¤ç\r\n */\r\nexport class ErrorExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  private langService: LanguageService = null;\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n    this.langService = languageService;\r\n    if (!this.langService) {\r\n      this.langService = new LanguageService();\r\n    }\r\n\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.handleErrorLevel(error);\r\n  }\r\n\r\n  private handleErrorLevel(error: ServerExceptionEntity): void {\r\n    const exceptionMsg = error.Message || '';\r\n    const date = error.date || new Date();\r\n    const localDate = moment(date).format('YYYY-MM-DD HH:mm:ss');\r\n    const detail = error.Detail || `${error.Message}\\r\\nåçæ¶é´ï¼${localDate}\\r\\nè¯¦ç»ä¿¡æ¯ï¼${error.innerMessage}` || '';\r\n\r\n    const innerMessage = error.innerMessage || null;\r\n    let bsModalRef: BsModalRef;\r\n    const options = {\r\n      // title: this.languageService.serverNotifyTitle,\r\n      showMaxButton: false,\r\n      buttons: [\r\n        {\r\n          text: this.langService.roger,\r\n          cls: 'btn btn-primary btn-lg',\r\n          handle: () => {\r\n            bsModalRef.close();\r\n          }\r\n        }\r\n      ],\r\n      // showHeader: false,\r\n      width: 440,\r\n      height: 200,\r\n      safeHtml: false,\r\n      exception: {\r\n        date: localDate,\r\n        message: innerMessage,\r\n        copyButton: {\r\n          text: this.langService.copy,\r\n          onClick: (e) => {\r\n            const result = DeviceAbility.copyToClipboard(detail);\r\n            const text = result ? this.langService.copySuccess : this.langService.copyFailed;\r\n            bsModalRef.content.showMiniNotify(text, 1500);\r\n          }\r\n        }\r\n      }\r\n    };\r\n    this.displayError(error);\r\n    bsModalRef = this.messagerService.show('exception', exceptionMsg, options);\r\n  }\r\n  /**\r\n   * å¨æ§å¶å°ä¸­æ¾ç¤ºéè¯¯ä¿¡æ¯\r\n   */\r\n  private displayError(error: ServerExceptionEntity) {\r\n    if (!error) {\r\n      return;\r\n    }\r\n    if (!console || !console.error) {\r\n      return;\r\n    }\r\n    console.error(error);\r\n  }\r\n}\r\n\r\n/**\r\n * è´å½éè¯¯çº§å«å¼å¸¸å¤ç\r\n */\r\nexport class FatalExceptionStrategy extends ExceptionStrategy implements IExceptionStrategy {\r\n  constructor(\r\n    messagerService: MessagerService,\r\n    @Optional() languageService: LanguageService) {\r\n    super(messagerService, languageService);\r\n  }\r\n\r\n  public handleException(error: ServerExceptionEntity): void {\r\n    if (!error) {\r\n      return;\r\n    }\r\n\r\n    this.messagerService.error(error.Message);\r\n  }\r\n}\r\n","import { Optional, Injectable } from '@angular/core';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { LanguageService } from '../languag.service';\r\nimport { ServerExceptionEntity, ExceptionLevel } from './types';\r\nimport {\r\n  IExceptionStrategy, InfoExceptionStrategy, WarningExceptionStrategy, ErrorExceptionStrategy, FatalExceptionStrategy\r\n} from './exception_strategy';\r\n\r\n\r\n@Injectable()\r\nexport class ExceptionFactory {\r\n\r\n  /**\r\n   * å¼å¸¸å·¥åå®ä¾\r\n   */\r\n  private static exceptionFactory: ExceptionFactory = null;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param messagerService æ¶æ¯æå¡\r\n   * @param languageService å¤è¯­è¨æå¡\r\n   */\r\n  private constructor(\r\n    public messagerService: MessagerService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n\r\n  }\r\n\r\n  /**\r\n   * è·åå·¥åå®ä¾\r\n   * @param messagerService æ¶æ¯æå¡\r\n   * @param languageService å¤è¯­è¨æå¡\r\n   */\r\n  public static getInstance(messagerService: MessagerService, languageService: LanguageService): ExceptionFactory {\r\n    if (!this.exceptionFactory) {\r\n      this.exceptionFactory = new ExceptionFactory(messagerService, languageService);\r\n    }\r\n\r\n    return this.exceptionFactory;\r\n  }\r\n\r\n  /**\r\n   * è·åå¼å¸¸å¤çç­ç¥\r\n   * @param exceptionLevel å¼å¸¸ç­çº§\r\n   */\r\n  public getExceptionHandleStrategy(exceptionLevel: ExceptionLevel): IExceptionStrategy {\r\n    let exceptionStrategy: IExceptionStrategy;\r\n\r\n    switch (exceptionLevel) {\r\n      case ExceptionLevel.Info:\r\n        exceptionStrategy = new InfoExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      case ExceptionLevel.Warning:\r\n        exceptionStrategy = new WarningExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      case ExceptionLevel.Error:\r\n        exceptionStrategy = new ErrorExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      case ExceptionLevel.Fatal:\r\n        exceptionStrategy = new FatalExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n      default:\r\n\r\n        // é»è®¤å¼å¸¸ç­çº§æ¯éè¯¯\r\n        exceptionStrategy = new ErrorExceptionStrategy(this.messagerService, this.languageService);\r\n        break;\r\n    }\r\n\r\n    return exceptionStrategy;\r\n  }\r\n}\r\n","// https://github.com/typeslick/status-code-enum\r\nenum HttpStatusType {\r\n    Info = 1,\r\n    Success,\r\n    Redirect,\r\n    ClientError,\r\n    ServerError\r\n}\r\n\r\n/**\r\n * httpéç¨ç±»\r\n */\r\nclass HttpUtil {\r\n\r\n    /**\r\n     * åºäºhttpç¶æç è¿åç¶æç±»å\r\n     * @param httpResponseSatus httpè¯·æ±è¿åç¶æç \r\n     * @returns null | HttpStatusType\r\n     */\r\n    public static getHttpStatusType(httpResponseSatus: number): any {\r\n        if (!httpResponseSatus) {\r\n            return null;\r\n        }\r\n        \r\n        let statusType = null; // é»è®¤å¼ä¸ºç©º\r\n        \r\n        if (httpResponseSatus < 100 || httpResponseSatus > 600) {\r\n            statusType = null; // ä¸åçç¶æç \r\n        } else if (httpResponseSatus >= 100 && httpResponseSatus < 200) {\r\n            statusType = HttpStatusType.Info;\r\n        } else if (httpResponseSatus >= 200 && httpResponseSatus < 300) {\r\n            statusType = HttpStatusType.Success;\r\n        } else if (httpResponseSatus >= 300 && httpResponseSatus < 400) {\r\n            statusType = HttpStatusType.Redirect;\r\n        } else if (httpResponseSatus >= 400 && httpResponseSatus < 500) {\r\n            statusType = HttpStatusType.ClientError;\r\n        } else if (httpResponseSatus >= 500 && httpResponseSatus < 600) {\r\n            statusType = HttpStatusType.ServerError;\r\n        }\r\n\r\n        return statusType;\r\n    }\r\n}\r\n\r\nexport { HttpUtil, HttpStatusType };","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { HttpUtil, HttpStatusType } from '../util/http';\r\n\r\n/**\r\n * è¡¨åéè¯¯æç¤ºæå¡\r\n * @description ç»ä¸å¤çååç«¯å¼å¸¸\r\n */\r\n@Injectable()\r\nclass FormErrorService {\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * å¼å¸¸è·¯ç±æ¹æ³\r\n   */\r\n  public exception(message: string, error: any) {\r\n    // éå¯¹sessionå¤±æåç¹æ®å¤ç\r\n    if (error && error.hasOwnProperty('expired') && error['expired'] === true) {\r\n      return;\r\n    }\r\n    if (error && this.isHttpErrorResponse(error)) {\r\n      this.httpErrorHandler(error);\r\n    } else {\r\n      // todo: ç»åå¼å¸¸å¤çåï¼ç»§ç»­æè§£è¯¥æ¹æ³\r\n      this.commonErrorHandler(message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * httpè¯·æ±å¼å¸¸å¤çå¨\r\n   */\r\n  public httpErrorHandler(httpError: HttpErrorResponse): void {\r\n    if (!httpError) {\r\n      return;\r\n    }\r\n\r\n    const statusType = HttpUtil.getHttpStatusType(httpError.status);\r\n\r\n    switch (statusType) {\r\n      case HttpStatusType.ClientError:\r\n        if (httpError.status === 401) {\r\n          this.msgService.http401Error(httpError);\r\n          break;\r\n        }\r\n\r\n        this.msgService.httpErrorInClient(httpError);\r\n        break;\r\n      case HttpStatusType.ServerError:\r\n        this.msgService.httpErrorInServer(httpError);\r\n        break;\r\n      default:\r\n        throw new Error('Get invalid status code when using httpErrorHandler method.');\r\n    }\r\n  }\r\n\r\n  private commonErrorHandler(errorMsg: string): void {\r\n    if (!errorMsg) {\r\n      return;\r\n    }\r\n    this.msgService.error(errorMsg);\r\n  }\r\n  /**\r\n   * httpErrorResponse like\r\n   * @param error å¼å¸¸\r\n   */\r\n  private isHttpErrorResponse(error) {\r\n    if (!error) {\r\n      return false;\r\n    }\r\n    if (typeof error !== 'object') {\r\n      return false;\r\n    }\r\n    if (error.name === 'HttpErrorResponse' && error.hasOwnProperty('status') && error.hasOwnProperty('error')) {\r\n      return true;\r\n    }\r\n    if (error instanceof HttpErrorResponse) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nexport { FormErrorService };\r\n\r\n","import { Inject, Injectable, LOCALE_ID, Optional } from '@angular/core';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, Subject, of, from } from 'rxjs';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { fromPromise } from 'rxjs/observable/fromPromise';\r\nimport { LanguageService } from './languag.service';\r\nimport { ServerExceptionEntity, ExceptionFactory, IExceptionStrategy } from './error/index';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\n\r\n/**\r\n * è¡¨åæ¶æ¯æå¡\r\n * @scope FormModule\r\n * @summary\r\n * 1ãåè£@farris/uiçæ¶æ¯æå¡ï¼\r\n * 2ãæä¾éå¯¹è¡¨åçå¿«æ·æ¹æ³ï¼\r\n */\r\n@Injectable()\r\nclass FormMessageService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * æ³¨å¥@farris/uiçLoadingService\r\n   */\r\n  constructor(\r\n    private messagerService: MessagerService,\r\n    @Optional() private languageService: LanguageService,\r\n    @Inject(LOCALE_ID) private curLanguage: string, // ä¸ºäºç¬ç«å¼¹åºéæ°ç»å½æç¤ºæ¡ï¼åæ¢å°è¿è¡æ¡æ¶httpæå¡åå¯ä»¥å é¤\r\n  ) {\r\n    this.languageService = this.languageService || LanguageService.getInstance();\r\n  }\r\n  /**\r\n   * questionå¼¹çª\r\n   */\r\n  public question(content: string): Observable<boolean> {\r\n    const confirmResult$: Promise<boolean> = this.confirmPromise(content);\r\n    return from(confirmResult$);\r\n  }\r\n\r\n  /**\r\n   * å¸¦é»è®¤ç¦ç¹çå¼¹åºæç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public question2(content: string): Observable<boolean> {\r\n    const promise$: Promise<boolean> = new Promise((resolve, reject) => {\r\n      const dialogRef = this.messagerService.question2(\r\n        content,\r\n        [\r\n          {\r\n            text: this.languageService.no,\r\n            cls: 'btn btn-secondary',\r\n            handle: () => {\r\n              resolve(false);\r\n              dialogRef.close();\r\n            }\r\n          },\r\n          {\r\n            text: this.languageService.yes,\r\n            cls: 'btn btn-primary',\r\n            defaultFocus: true,\r\n            handle: () => {\r\n              resolve(true);\r\n              dialogRef.close();\r\n            }\r\n          }\r\n        ]);\r\n    });\r\n    return from(promise$);\r\n  }\r\n\r\n  /**\r\n   * å¼¹åºè¾å¥å¯¹è¯æ¡\r\n   * @param title æ é¢\r\n   */\r\n  public prompt(title: string): Observable<any> {\r\n    return this.messagerService.prompt(title);\r\n  }\r\n\r\n  /**\r\n   * ä½¿ç¨Promiseå®ä¾åè£åè°æ¹æ³ï¼ä»¥åæ­¥åè°æ¹æ³æ§è¡åç»æ\r\n   * @param content\r\n   */\r\n  private confirmPromise(content: string): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      this.messagerService.question(\r\n        content,\r\n        () => { resolve(true); },\r\n        () => { resolve(false); }\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ç¡®è®¤å¼¹æ¡\r\n   * @param content å¼¹åºåå®¹æç¤º\r\n   */\r\n  public confirm(content: string): Observable<boolean> {\r\n    return this.messagerService.confirm(content);\r\n  }\r\n\r\n  /**\r\n   * æ¶æ¯å¼¹æ¡\r\n   */\r\n  public info(content: string) {\r\n    this.messagerService.info(content);\r\n  }\r\n\r\n  /**\r\n   * éè¯¯å¼¹æ¡\r\n   */\r\n  public error(content: string) {\r\n    this.messagerService.error(content);\r\n  }\r\n\r\n  /**\r\n   * è­¦åå¼¹æ¡\r\n   */\r\n  public warning(content: string) {\r\n    this.messagerService.warning(content);\r\n  }\r\n\r\n  /**\r\n   * æå¡å¨ç«¯å¼å¸¸æç¤ºå¼¹æ¡\r\n   */\r\n  public httpErrorInServer(httpError: HttpErrorResponse): void {\r\n    let error: ServerExceptionEntity = httpError.error;\r\n    if (typeof (error) === 'string') {\r\n      try {\r\n        error = JSON.parse(error);\r\n      } catch (e) { }\r\n    }\r\n    if (!error || error.Level == null || error.Level == undefined) { // æªå°è£errorææªè®¾ç½®å¼å¸¸ç­çº§\r\n      this.messagerService.error(httpError.message);\r\n      return;\r\n    }\r\n    const exceptionStrategy: IExceptionStrategy = ExceptionFactory.getInstance(this.messagerService, this.languageService).getExceptionHandleStrategy(error.Level);\r\n    exceptionStrategy.handleException(error);\r\n  }\r\n\r\n  /**\r\n   * å®¢æ·ç«¯å¼å¸¸æç¤ºå¼¹æ¡\r\n   */\r\n  public httpErrorInClient(httpError: HttpErrorResponse): void {\r\n    if (!httpError) {\r\n      return;\r\n    }\r\n    const message = httpError.error && httpError.error.error && httpError.error.error.message;\r\n    const exceptionMsg = message || httpError.message && httpError.message.replace(/http:\\/\\/[a-zA-Z0-9.:]{1,}/, '');\r\n    const options = {\r\n      // title: this.languageService.clientNotifyTitle,\r\n      // showMaxButton: true,\r\n      showHeader: false,\r\n      width: 400,\r\n      height: 200,\r\n      safeHtml: false\r\n    };\r\n\r\n    this.messagerService.show('error', exceptionMsg, options);\r\n  }\r\n\r\n  /**\r\n   * 401å¼å¸¸å¤ç\r\n   * ä¸ºäºç¬ç«å¼¹åºéæ°ç»å½æç¤ºæ¡ï¼åæ¢å°è¿è¡æ¡æ¶httpæå¡åå¯ä»¥å é¤\r\n   * @param httpError å¼å¸¸\r\n   */\r\n  public http401Error(httpError: HttpErrorResponse): void {\r\n    const dialogShownKey = '401ErrorShownFlag';\r\n\r\n    if (!httpError || window[dialogShownKey]) {\r\n      return;\r\n    }\r\n\r\n    const i18n = {\r\n      en: {\r\n        title: 'Warning',\r\n        sessionInvalid: 'Your login has expired, please login again.',\r\n        ok: 'ok',\r\n        cancel: 'cancel'\r\n      },\r\n      'zh-CHS': {\r\n        title: 'æç¤º',\r\n        sessionInvalid: 'ç¨æ·ç»å½ä¿¡æ¯å·²å¤±æï¼æ¯å¦éæ°ç»å½?',\r\n        ok: 'ç¡®è®¤',\r\n        cancel: 'åæ¶'\r\n      }\r\n    };\r\n    this.curLanguage = this.curLanguage || 'zh-CHS';\r\n\r\n    const messageOptions = {\r\n      title: i18n[this.curLanguage].title,\r\n      initialState: {\r\n        okText: i18n[this.curLanguage].ok,\r\n        okHandle: () => {\r\n          modalRef.close();\r\n          window[dialogShownKey] = false;\r\n          const eventResult = httpError && httpError.error || {};\r\n          const redirectUri = eventResult.redirect_uri || '/login.html';\r\n          window.location.href = `/logout.html#?logout-before-redirect=true&loginUri=${redirectUri}`;\r\n        },\r\n        cancelText: i18n[this.curLanguage].cancel,\r\n        cancelHandle: () => {\r\n          modalRef.close();\r\n          window[dialogShownKey] = false;\r\n        }\r\n      },\r\n      showHeader: true,\r\n      width: 420,\r\n      height: 180,\r\n      fitContent: false\r\n    };\r\n    const modalRef = this.messagerService.show('question', i18n[this.curLanguage].sessionInvalid, messageOptions);\r\n    window[dialogShownKey] = true;\r\n    if (modalRef && modalRef.dialog && modalRef.dialog.instance.closed) {\r\n      modalRef.dialog.instance.closed.subscribe(() => {\r\n        window[dialogShownKey] = false;\r\n      });\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport { FormMessageService };\r\n\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { NotifyService, NotifyOptions } from '@farris/ui-notify';\r\nimport { LanguageService } from './languag.service';\r\n\r\n/**\r\n * éç¥æå¡\r\n * @scope FormModule\r\n * @description\r\n * æ¶æ¯æç¤ºä½¿ç¨ç­ç¥ï¼æåä½¿ç¨successï¼å¤±è´¥ä½¿ç¨errorï¼è­¦åä½¿ç¨warningï¼å¶ä»åºæ¯ä½¿ç¨info\r\n */\r\n@Injectable()\r\nclass FormNotifyService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * æ³¨å¥@farris/uiçNotifyService\r\n   */\r\n  constructor(private notifyService: NotifyService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä¿¡æ¯æç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public default(content: string) {\r\n    return this.notifyService.default(<NotifyOptions>{\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ä¿¡æ¯æç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public info(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    return this.notifyService.info(notifyOptions);\r\n  }\r\n\r\n  /**\r\n   * æåæç¤º\r\n   * @param content åå®¹\r\n   * @param options? éé¡¹ {shorTitle: false}\r\n   */\r\n  public success(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    this.notifyService.success(notifyOptions);\r\n  }\r\n\r\n  /**\r\n   * è­¦åæç¤º\r\n   * @param content åå®¹\r\n   * @param options éé¡¹\r\n   */\r\n  public warning(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    this.notifyService.warning(notifyOptions);\r\n  }\r\n\r\n  /**\r\n   * éè¯¯æç¤º\r\n   * @param content åå®¹\r\n   */\r\n  public error(content: string, options?: { [prop: string]: any }) {\r\n    const notifyOptions: NotifyOptions = {\r\n      title: this.languageService.notifyTitle,\r\n      msg: content,\r\n      timeout: 3000\r\n    } as NotifyOptions;\r\n    if (options && options.hideTitle) {\r\n      delete notifyOptions.title;\r\n    }\r\n    this.notifyService.error(notifyOptions);\r\n  }\r\n}\r\n\r\nexport { FormNotifyService };\r\n","import { Injectable } from '@angular/core';\r\nimport { WizardService, WizardEventType } from '@farris/ui-wizard';\r\nimport { FrameContext } from '@farris/devkit';\r\n\r\n@Injectable()\r\nexport class FormWizardService {\r\n    constructor(\r\n        private wizardSer: WizardService\r\n    ) { }\r\n\r\n    public preStep() {\r\n        const currentPageId = this.wizardSer.getCurrentPageId();\r\n        this.wizardSer.updateWizardState(WizardEventType.Prev, currentPageId);\r\n    }\r\n    public nextStep() {\r\n        const currentPageId = this.wizardSer.getCurrentPageId();\r\n        this.wizardSer.updateWizardState(WizardEventType.Next, currentPageId);\r\n    }\r\n    public cancelWizard() {\r\n        this.wizardSer.cancelWizard();\r\n    }\r\n\r\n    public finishWizard() {\r\n        this.wizardSer.finishWizard();\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * æ£æ¥è§å\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass CheckService {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦ä¸ºç©º\r\n   */\r\n  public checkEmpty(value: any) {\r\n    return !!value;\r\n  }\r\n}\r\n\r\nexport { CheckService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, empty, of } from 'rxjs';\r\nimport { CommandContext } from '@farris/devkit';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\n\r\n/**\r\n * æ°æ®æ£æ¥æå¡\r\n */\r\n@Injectable()\r\nclass DataCheckService {\r\n\r\n  constructor(\r\n    private messageService: FormMessageService,\r\n    private formNotifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç¼è¾åæ£æ¥\r\n   */\r\n  public checkBeforeEdit(idToEdit: string): any {\r\n\r\n    const ifSkipCheck = this.ifSkipCheck(idToEdit);\r\n    if (ifSkipCheck === true) {\r\n      return true;\r\n    }\r\n\r\n    if (idToEdit) {\r\n      return true;\r\n    }\r\n\r\n    this.formNotifyService.warning(this.languageService.plsSelectEditData, { hideTitle: true });\r\n    return empty();\r\n  }\r\n\r\n  /**\r\n   * æ¥çåæ£æ¥\r\n   */\r\n  public checkBeforeView(idToView: string): any {\r\n    const ifSkipCheck = this.ifSkipCheck(idToView);\r\n    if (ifSkipCheck === true) {\r\n      return true;\r\n    }\r\n\r\n    if (idToView) {\r\n      return true;\r\n    }\r\n\r\n    this.formNotifyService.warning(this.languageService.plsSelectViewData, { hideTitle: true });\r\n    return empty();\r\n  }\r\n  /**\r\n   * èè¡¨åè·³è¿æ£æ¥\r\n   * @todoï¼å¾å é¤ï¼å¼å®¹èè¡¨å\r\n   */\r\n  public ifSkipCheck(id: string): boolean {\r\n    const context = this['context'] as CommandContext;\r\n    const params = context.command.params;\r\n\r\n    // è¡¨åæ²¡æéæ°ä¿å­è¿çæåµ\r\n    if (params.hasOwnProperty('idToEdit') === false && params.hasOwnProperty('idToView') === false) {\r\n      return true;\r\n    }\r\n\r\n    // ä¿å­è¿ä½æ²¡æå¡«åæ°çæåµ\r\n    // @todo: ä¼æ¼æç©ºä¸²çæåµï¼ç®åä¸»é®è§£æçè¿åå¼æ¯undefinedï¼æä¸èèç©ºä¸²åºæ¯\r\n    if (id === '') {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n\r\nexport { DataCheckService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameEventBus } from '@farris/devkit';\r\n\r\n/**\r\n * æ¡æ¶äºä»¶æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass EventService {\r\n\r\n  constructor(private eventBus: FrameEventBus) {\r\n  }\r\n\r\n  trigger(eventType: string, eventData?: any, frameIds?: string[]) {\r\n    this.eventBus.trigger(eventType, eventData, frameIds);\r\n  }\r\n}\r\n\r\nexport { EventService };\r\n","import { Injectable } from '@angular/core';\r\n// tslint:disable: no-unused-expression\r\n/**\r\n * èåç¶ææå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass MenuStateService {\r\n    private readonly COMMAND_SERVICE_LINK_STORAGE_KEY = 'COMMAND_SERVICE_LINK_STORAGE_KEY';\r\n    private getState() {\r\n        const data = !!sessionStorage && sessionStorage.getItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY) || null;\r\n        if (!!data) {\r\n            return JSON.parse(data);\r\n        }\r\n        return {};\r\n    }\r\n    private setState(links) {\r\n        !!sessionStorage && sessionStorage.setItem(this.COMMAND_SERVICE_LINK_STORAGE_KEY, JSON.stringify(links));\r\n    }\r\n    public addMenuState(parentMenuId: string, childMenuId: string, status: boolean = true) {\r\n        if (!childMenuId) {\r\n            return;\r\n        }\r\n        const state = this.getState();\r\n        const isParentExist = !!state && state.hasOwnProperty(parentMenuId);\r\n        const childItem = { id: childMenuId, status };\r\n        if (isParentExist) {\r\n            const parent = state[parentMenuId];\r\n            const isChildItemExist = parent.find(item => item.id === childMenuId);\r\n            if (!isChildItemExist) {\r\n                state[parentMenuId].push(childItem);\r\n            }\r\n        } else {\r\n            state[parentMenuId] = [childItem];\r\n        }\r\n        this.setState(state);\r\n    }\r\n    public getMenuState(parentMenuId: string, childMenuId?: string) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return null;\r\n        }\r\n        const isParentExist = state.hasOwnProperty(parentMenuId);\r\n        if (!isParentExist) {\r\n            return null;\r\n        }\r\n        const parentMenu = state[parentMenuId];\r\n        const childMenu = parentMenu.filter(item => item.status === true);\r\n        if (typeof childMenuId === 'undefined' || childMenuId.length < 1) {\r\n            return childMenu;\r\n        }\r\n        return parentMenu.filter(item => item.status && item.id === childMenuId);\r\n    }\r\n    public updateMenuState(childMenuId: string, status: boolean) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return;\r\n        }\r\n        Object.keys(state).forEach(key => {\r\n            const childMenu = state[key].find(item => item.id === childMenuId);\r\n            if (!!childMenu) {\r\n                childMenu.status = status;\r\n            }\r\n        });\r\n        this.setState(state);\r\n    }\r\n    public removeMenu(menuId: string) {\r\n        this.removeParentMenu(menuId);\r\n        this.removeChildMenu(menuId);\r\n    }\r\n    private removeParentMenu(menuId: string) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return null;\r\n        }\r\n        Object.keys(state).forEach(item => {\r\n            if (item === menuId && state[menuId].length < 1) {\r\n                delete state[item];\r\n            }\r\n        });\r\n        this.setState(state);\r\n    }\r\n    private removeChildMenu(menuId: string) {\r\n        const state = this.getState();\r\n        if (state === null) {\r\n            return;\r\n        }\r\n        Object.keys(state).forEach(parentMenuId => {\r\n            const childMenus = state[parentMenuId];\r\n            if (childMenus && childMenus.length > 0) {\r\n                childMenus.forEach((child, index) => {\r\n                    if (child.id === menuId) {\r\n                        childMenus.splice(index, 1);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        this.setState(state);\r\n    }\r\n}\r\n\r\nexport { MenuStateService };\r\n","/*\r\n * @Author: Witt\r\n * @Date: 2018-11-15 15:56:11\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-07-09 16:23:04\r\n */\r\n\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { RouterParamService } from '@farris/devkit';\r\nimport { FrameworkService, AppService } from '@gsp-sys/rtf-common';\r\nimport { MenuStateService } from './menu-state.service';\r\nimport { Subject } from 'rxjs';\r\nimport { LanguageService } from './languag.service';\r\n\r\n// tslint:disable: no-string-literal\r\n/**\r\n * è·¯ç±æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass RouterService {\r\n  /**\r\n   * ä¸æ¬¡åæ¢çTabId\r\n   */\r\n  private lastSwitchId: string = null;\r\n  /**\r\n   * ä¸æ¬¡å³é­çTabId\r\n   */\r\n  private lastCloseId: string = null;\r\n  // private menuStateService: MenuStateService = null;\r\n  public onClosed: Subject<any> = null;\r\n  constructor(\r\n    private router: Router,\r\n    private routerParamService: RouterParamService,\r\n    private frameworkService: FrameworkService,\r\n    @Optional() private appService: AppService,\r\n    @Optional() private menuStateService: MenuStateService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.menuStateService) {\r\n      this.menuStateService = new MenuStateService();\r\n    }\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    this.onClosed = new Subject<any>();\r\n    this.registerEvent();\r\n  }\r\n\r\n  /**\r\n   * åæ¢è·¯ç±\r\n   * @param url èåID\r\n   * @param params è·¯ç±åæ°\r\n   */\r\n  public route(url: string, params: any) {\r\n    url = this.router.createUrlTree([url]).toString();\r\n    this.setParams(url, params);\r\n    this.router.navigateByUrl(url);\r\n  }\r\n  /**\r\n   * æ³¨åè¿è¡æ¡æ¶äºä»¶\r\n   */\r\n  public registerEvent() {\r\n    const params: any = this.getParams(window.location.hash);\r\n    const menuId = this.getAppId() || this.getFuncId();\r\n    this.frameworkService.eventListner(this.frameworkService.FuncSwitch, e => {\r\n      if (!e) {\r\n        return;\r\n      }\r\n      const id = this.getOriginalId(e.id) || e.tabId;\r\n      const menuState = this.menuStateService.getMenuState(id);\r\n      if (!!id && menuId === id && !!menuState && menuState.length > 0) {\r\n        this.formReload();\r\n        this.lastSwitchId = id;\r\n      }\r\n    }, params);\r\n\r\n    this.frameworkService.eventListner(this.frameworkService.FuncClosed, e => {\r\n      if (!e) {\r\n        return;\r\n      }\r\n      this.onClosed.next(e);\r\n      const id = this.getOriginalId(e.id) || e.tabId;\r\n      if (menuId === id) {\r\n        return;\r\n      }\r\n      const menuState = this.menuStateService.getMenuState(menuId, id);\r\n      // && id !== this.lastCloseId\r\n      if (!!id && !!menuState && menuState.length > 0) {\r\n        this.removeMenuState(id);\r\n        this.formReload();\r\n        this.lastCloseId = id;\r\n      }\r\n    }, params);\r\n  }\r\n\r\n  private removeMenuState(tabId: string) {\r\n    if (this['context']) {\r\n      this.menuStateService.removeMenu(tabId);\r\n    }\r\n  }\r\n  /**\r\n   * è·ååå§åè½id\r\n   * @param id id\r\n   */\r\n  private getOriginalId(id: string) {\r\n    if (!id) {\r\n      return id;\r\n    }\r\n    if (id.indexOf('_') !== -1) {\r\n      id = id.split('_')[0];\r\n    }\r\n    return id;\r\n  }\r\n  /**\r\n   * å·æ°ç»ä»¶æ°æ®\r\n   */\r\n  private formReload() {\r\n    try {\r\n      this['context']['frameContext']['appContext']['refresh']();\r\n    } catch{ }\r\n  }\r\n  /**\r\n   * æå¼åè½èå\r\n   * @param funcId èååç \r\n   * @param params è·¯ç±åæ°ï¼å½¢å¦ï¼ { key1: val1, key2: value2 }\r\n   */\r\n  public openMenu(funcId: string, params: any, reload?: boolean) {\r\n    if (typeof reload === 'undefined' || typeof reload !== 'boolean') {\r\n      reload = false;\r\n    }\r\n    const paramsMap = this.buildParamMap(params);\r\n    const parentMenuId = this.getFuncId() || this.getAppId();\r\n    this.menuStateService.addMenuState(parentMenuId, funcId);\r\n    paramsMap.set('WEB_FORM_ROUTER_PARENT_ID', parentMenuId);\r\n    this.frameworkService.openFuncWithParam(funcId, paramsMap, reload);\r\n  }\r\n\r\n  /**\r\n   * æå¼åºç¨\r\n   * @param appId åºç¨åç \r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params è·¯ç±åæ°ï¼å½¢å¦ï¼ { key1: val1, key2: value2 }\r\n   */\r\n  public openApp(appId: string, appEntrance: string, params: any, reload?: boolean) {\r\n    if (typeof reload === 'undefined' || typeof reload !== 'boolean') {\r\n      reload = false;\r\n    }\r\n    const paramMap = this.buildParamMap(params);\r\n    const parentMenuId = this.getAppId() || this.getFuncId();\r\n    this.menuStateService.addMenuState(parentMenuId, appId);\r\n    paramMap.set('WEB_FORM_ROUTER_PARENT_ID', parentMenuId);\r\n    if (!!this.appService) {\r\n      this.appService.openApp(appId, appEntrance, paramMap, reload);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æé åæ°\r\n   */\r\n  private buildParamMap(params: any): Map<string, string> {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (typeof params === 'object') {\r\n      params = JSON.stringify(params);\r\n    }\r\n    params = window['encodeURIComponent'](params);\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    return paramMap;\r\n  }\r\n\r\n  /**\r\n   * å³é­åè½èå\r\n   */\r\n  public closeMenu() {\r\n    const funcId: string | null = this.getFuncId();\r\n    const appId: string | null = this.getAppId();\r\n    const { isDialogComponent, rootComponent } = this.findDialog();\r\n    if (isDialogComponent) {\r\n      const modalRef = this.get(rootComponent, 'dialogRef');\r\n      modalRef['close']();\r\n      return;\r\n    }\r\n\r\n    if (funcId !== null && typeof funcId === 'string' && funcId.length > 0) {\r\n      this.closeFunc(funcId);\r\n    } else if (appId !== null && typeof appId === 'string' && appId.length > 0) {\r\n      const appEntrance = this.getAppEntrance();\r\n      this.closeApp(appId, appEntrance);\r\n    } else {\r\n      console.error(this.languageService['notSupportMenuType']);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ¥æ¾å¼¹çªç»ä»¶\r\n   */\r\n  private findDialog() {\r\n    let frameContext = this.get(this, 'context.frameContext');\r\n    let isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n\r\n    let parentFrameContext = this.get(frameContext, 'parent');\r\n    while (parentFrameContext != null && !isDialogComponent) {\r\n      frameContext = this.get(frameContext, 'parent');\r\n      parentFrameContext = this.get(parentFrameContext, 'parent');\r\n      isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n    }\r\n    const rootComponent = this.get(frameContext, 'frameComponent');\r\n    return { isDialogComponent, rootComponent };\r\n\r\n  }\r\n\r\n  /**\r\n   * loadsh get\r\n   * @param object å¯¹è±¡\r\n   * @param path è·¯å¾\r\n   * @param defaultVal é»è®¤å¼\r\n   */\r\n  private get(object: any, path: Array<string> | string, defaultVal: any = null) {\r\n    const PATH = Array.isArray(path)\r\n      ? path\r\n      : path.split('.').filter(i => i.length);\r\n    if (!PATH.length) {\r\n      return object === undefined ? defaultVal : object;\r\n    }\r\n\r\n    if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {\r\n      return defaultVal;\r\n    }\r\n\r\n    return this.get(object[PATH.shift()], PATH, defaultVal);\r\n  }\r\n\r\n  /**\r\n   * å³é­èå\r\n   * @param funcId èåid\r\n   */\r\n  public closeFunc(funcId?: string) {\r\n    if (!funcId) {\r\n      funcId = this.getFuncId();\r\n    }\r\n    if (!!this.frameworkService) {\r\n      this.frameworkService.closeFunc(funcId).subscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å³é­app\r\n   * @param appId åºç¨id\r\n   */\r\n  public closeApp(appId?: string, appEntrance?: string) {\r\n    if (!appId) {\r\n      appId = this.getAppId();\r\n    }\r\n    if (typeof appEntrance === 'undefined') {\r\n      appEntrance = this.getAppEntrance();\r\n    }\r\n    if (!!this.appService) {\r\n      this.appService.closeApp(appId, appEntrance).subscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®åæ°\r\n   * @param params è·¯ç±åæ°\r\n   */\r\n  private setParams(url: string, params: string | { [key: string]: any; }) {\r\n    let paramsObj;\r\n    if (typeof params === 'string' && params !== '') {\r\n      paramsObj = JSON.parse(params);\r\n    } else {\r\n      paramsObj = params || {};\r\n    }\r\n\r\n    // è®¾ç½®è·¯ç±åæ°\r\n    this.routerParamService.setParams(url, paramsObj);\r\n  }\r\n\r\n  /**\r\n   * è·åfuncId\r\n   */\r\n  private getFuncId() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('funcId')) {\r\n      return params.funcId;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åappId\r\n   */\r\n  private getAppId() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('appId')) {\r\n      return params.appId;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private getParentMenuId() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('WEB_FORM_ROUTER_PARENT_ID')) {\r\n      return params.WEB_FORM_ROUTER_PARENT_ID;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * è·ååºç¨å¥å£\r\n   */\r\n  private getAppEntrance() {\r\n    const hash = window.location.hash;\r\n    if (!hash) {\r\n      return null;\r\n    }\r\n    const params = this.decodeURLParams(hash);\r\n    if (params && params.hasOwnProperty('appEntrance')) {\r\n      return params.appEntrance;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * è§£ç åæ°\r\n   * @param query search|hash\r\n   */\r\n  private decodeURLParams(query: string): { [propName: string]: any } {\r\n    if (typeof query === 'undefined') {\r\n      query = window.location.hash || window.location.search;\r\n    }\r\n    const hashes = query.slice(query.indexOf('?') + 1).split('&');\r\n    return hashes.reduce((params, hash) => {\r\n      const split = hash.indexOf('=');\r\n      const key = hash.slice(0, split);\r\n      const val = hash.slice(split + 1);\r\n      return Object.assign(params, { [key]: decodeURIComponent(val) });\r\n    }, {});\r\n  }\r\n  private getParams(queryString: string): { [propName: string]: any } {\r\n    if (!queryString) {\r\n      return {};\r\n    }\r\n    const hashes = queryString.slice(queryString.indexOf('?') + 1).split('&');\r\n    return hashes.reduce((params, hash) => {\r\n      const split = hash.indexOf('=');\r\n      const key = hash.slice(0, split);\r\n      const val = hash.slice(split + 1);\r\n      return Object.assign(params, { [key]: decodeURIComponent(val) });\r\n    }, {});\r\n  }\r\n}\r\n\r\nexport { RouterService };\r\n","import { InjectionToken } from '@angular/core';\r\nimport { RequestInfo } from '@farris/bef';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\n// tslint:disable: unified-signatures\r\nexport const TAB_EVENT = {\r\n    /**\r\n     * Tabå³é­å\r\n     */\r\n    onTabClosed: 'FuncClosed',\r\n    /**\r\n     * Tabå³é­å\r\n     */\r\n    onTabClosing: 'beforeFuncCloseEvent',\r\n    /**\r\n     * Tabåæ¢\r\n     */\r\n    onTabSwitched: 'funcSwitchEvent'\r\n};\r\n\r\nexport const TAB_QUERY_STRING = {\r\n    TabId: 'tabId',\r\n    AppType: 'appType',\r\n    AppId: 'appId',\r\n    AppEntrance: 'appEntrance',\r\n    FuncId: 'funcId'\r\n};\r\n\r\n/**\r\n * å¸¦RequestInfoçbodyå¯¹è±¡\r\n */\r\nexport interface BodyWithRequestInfo {\r\n    requestInfo: RequestInfo;\r\n    [key: string]: any;\r\n}\r\n\r\nexport const WEB_FORM_ROUTE_PARAMS_KEY = 'WEB_FORM_ROUTE_PARAMS';\r\nexport const enum DataType{\r\n  map = '[object Map]'\r\n}\r\nexport type KeyObject<T = any> = { key: T };\r\n\r\nexport const INSIDE_DIALOG_TOKEN = new InjectionToken<boolean>('@farris/command-service-inside-dialog');\r\n\r\nexport const MODAL_REF = new InjectionToken<BsModalRef>('@farris/command-service-modal-ref');\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * æ¥è¯¢åæ°æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class QuerystringService {\r\n    /**\r\n     * è§£ç åæ°\r\n     * @param queryString search|hash\r\n     */\r\n    public parse(queryString: string): { [propName: string]: any } {\r\n        if (!queryString) {\r\n            return {};\r\n        }\r\n        const hashes = queryString.slice(queryString.indexOf('?') + 1).split('&');\r\n        return hashes.reduce((params, hash) => {\r\n            const split = hash.indexOf('=');\r\n            const key = hash.slice(0, split);\r\n            const val = hash.slice(split + 1);\r\n            return Object.assign(params, { [key]: decodeURIComponent(val) });\r\n        }, {});\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { EMPTY, Observable, Subject } from 'rxjs';\r\nimport { UID } from '@farris/devkit';\r\nimport { switchMap } from 'rxjs/operators';\r\n/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-07-23 15:56:11 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-11-27 15:31:36\r\n */\r\n\r\n\r\n/**\r\n * RuntimeFrameworkService\r\n * @scope @FormModule\r\n */\r\n// tslint:disable: no-string-literal disable: max-line-length\r\n@Injectable()\r\nexport class RuntimeFrameworkService {\r\n  private rtfService: any;\r\n  constructor() {\r\n    this.rtfService = this.getService();\r\n  }\r\n  /**\r\n   * éåè·årtfæå¡\r\n   */\r\n  private getService() {\r\n    let env: Window = window;\r\n    while (!env['gspframeworkService'] && env !== window.top && this.isSameOrigin(env)) {\r\n      env = env.parent;\r\n    }\r\n    return env['gspframeworkService'] && env['gspframeworkService']['rtf'] || {};\r\n  }\r\n  // #region å¯¼èªæå¡\r\n  /**\r\n   * æå¼èåæåºç¨\r\n   * @param options options\r\n   */\r\n  openMenu(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['openMenu'] === 'function') {\r\n      this.rtfService.func.openMenu(options);\r\n    }\r\n  }\r\n  /**\r\n   * æå¼èåæåºç¨\r\n   * @param options options\r\n   */\r\n  openMenu$(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['openMenuByStream'] === 'function') {\r\n      return this.rtfService.func.openMenuByStream(options);\r\n    }\r\n    return EMPTY;\r\n  }\r\n  /**\r\n   * è·åå¯¼èªå®ä½æ°æ®\r\n   * @param tabId tabid\r\n   * @param callback callback\r\n   * @param once once\r\n   */\r\n  getEntityParam(tabId: string, callback: any, once: boolean = true) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['getEntityParam'] === 'function') {\r\n      this.rtfService.func.getEntityParam(tabId, callback, once);\r\n    }\r\n  }\r\n  /**\r\n   * å°è¯å³é­èåæåºç¨\r\n   * @param options optins\r\n   */\r\n  beforeCloseMenu(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['beforeClose'] === 'function') {\r\n      this.rtfService.func.beforeClose(options);\r\n    }\r\n  }\r\n  /**\r\n   * å³é­èå\r\n   * @param options options\r\n   */\r\n  closeMenu(options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['close'] === 'function') {\r\n      this.rtfService.func.close(options);\r\n    }\r\n  }\r\n  /**\r\n   * è·åèåéæåæ°\r\n   * @param funcId èåid\r\n   * @param callback åè°\r\n   */\r\n  getMenuParams(funcId: string, callback: (params) => void) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('func') && typeof this.rtfService['func']['getMenuParams'] === 'function') {\r\n      this.rtfService.func.getMenuParams(funcId, callback);\r\n    }\r\n  }\r\n  /**\r\n   * æ·»å äºä»¶çå¬\r\n   */\r\n  addEventListener(token: string, handler: (value: any) => void, options: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('frmEvent') && typeof this.rtfService['frmEvent']['eventListener'] === 'function') {\r\n      this.rtfService.frmEvent.eventListener(token, handler, options);\r\n    }\r\n  }\r\n  /**\r\n   * è·åè¿è¡æ¡æ¶èååæ¢æ§å¶äºä»¶\r\n   * @returns Observable<any>\r\n   */\r\n  public getMenuSwitchControlEvent(): Observable<any> {\r\n    const subject = new Subject<any>();\r\n    const frmEvent = this.rtfService && this.rtfService.frmEvent || null;\r\n    if (frmEvent) {\r\n      const tabId = this.tabId;\r\n      const options = this.params;\r\n      window.setTimeout(() => {\r\n        frmEvent.eventListener(tabId, (response: { menuSwitchControl: { key: any, value: any }, [prop: string]: any }) => {\r\n          const menuSwitchControl = response && response.menuSwitchControl || null;\r\n          if (menuSwitchControl && menuSwitchControl.key === tabId) {\r\n            subject.next(menuSwitchControl.value);\r\n          } else {\r\n            subject.next(null);\r\n          }\r\n        }, options);\r\n      }, 0);\r\n    }\r\n    return subject;\r\n  }\r\n  //#endregion\r\n\r\n  // #region ééå±å±æ§\r\n  public get params() {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('session') && typeof this.rtfService['session']['getCommonVariable'] === 'function') {\r\n      return this.rtfService['session']['getCommonVariable']();\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * è·åtabId\r\n   */\r\n  public get tabId() {\r\n    return this.params && this.params['tabId'] || null;\r\n  }\r\n  /**\r\n   * è·åformToken\r\n   */\r\n  public get formToken() {\r\n    return this.params && this.params['formToken'] || null;\r\n  }\r\n  /**\r\n   * è·åfuncId\r\n   */\r\n  public get funcId() {\r\n    return this.params && this.params['funcId'] || null;\r\n  }\r\n  // #endregion\r\n\r\n  // #region äºä»¶éä¿¡\r\n  /**\r\n   * æ³¨åä¸»é¢\r\n   * @param code ä¸»é¢çæ è¯\r\n   * @param options tokençæè§å\r\n   * @param subject èªå®ä¹ä¸»é¢ï¼é»è®¤ä½¿ç¨Subject\r\n   * @returns string æ³¨åæååè¿åä¸»é¢çå¯ä¸æ è¯\r\n   */\r\n  public subjectRegister(code: string, options: any, subject?: Subject<any>): string {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['subjectRegister'] === 'function') {\r\n      return this.rtfService.broadcast.subjectRegister(code, options, subject);\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * ç§»é¤ä¸»é¢\r\n   * @param token ä¸»é¢å¯ä¸æ è¯\r\n   */\r\n  public subjectRemove(token: string) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['subjectRemove'] === 'function') {\r\n      this.rtfService.broadcast.subjectRemove(token);\r\n    }\r\n  }\r\n  /**\r\n   * ç»ä¸»é¢åéæ¶æ¯\r\n   * @param token ä¸»é¢æ è¯\r\n   * @param info æ¶æ¯\r\n   */\r\n  public subjectNotify(token: string, info: any) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['notify'] === 'function') {\r\n      this.rtfService.broadcast.notify(token, info);\r\n    }\r\n  }\r\n  /**\r\n   * æ³¨åä¸»é¢çå¬å¨\r\n   * @param token ä¸»é¢æ è¯\r\n   * @param handler ä¸»é¢å¤çå¨\r\n   * @param observerToken çå¬å¨id(å¯é)\r\n   * @returns çå¬å¨Id\r\n   * @description çå¬ä¸»é¢æ¶æ¯ï¼çå¬æåè¿åå½åçå¬èçå¯ä¸æ è¯\r\n   */\r\n  public subjectResponse(token: string, handler: (data: any) => void, observerToken?: string): string {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['response'] === 'function') {\r\n      let code = observerToken;\r\n      if (typeof observerToken === 'undefined' || !observerToken || observerToken.length < 1) {\r\n        code = UID.create();\r\n      }\r\n      this.rtfService.broadcast.response(token, code, handler);\r\n      return code;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * åæ¶å¯¹ä¸»é¢ççå¬\r\n   * @param token ä¸»é¢æ è¯\r\n   * @param observerToken çå¬å¨æ è¯\r\n   */\r\n  public responseUnSubscribe(token: string, observerToken: string) {\r\n    if (this.rtfService && this.rtfService.hasOwnProperty('broadcast') && typeof this.rtfService['broadcast']['responseUnSubscribe'] === 'function') {\r\n      this.rtfService.broadcast.responseUnSubscribe(token, observerToken);\r\n    }\r\n  }\r\n  // #endregion\r\n\r\n  // #region å·¥å·å½æ°\r\n  /**\r\n   * æ¯å¦åæº\r\n   * @param environment window\r\n   */\r\n  private isSameOrigin(environment: Window) {\r\n    const host = window.location.host;\r\n    try {\r\n      if (environment && environment.location && typeof environment.location.host !== 'undefined') {\r\n        return environment.location.host === host;\r\n      }\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n\r\n    return false;\r\n  }\r\n  // #endregion\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of, from, EMPTY } from 'rxjs';\r\nimport { every, concatMap, switchMap, take, tap } from 'rxjs/operators';\r\nimport { AppOptions } from '@gsp-sys/rtf-common';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { MenuStateService } from './menu-state.service';\r\nimport { TAB_EVENT } from './types';\r\nimport { QuerystringService } from './querystring';\r\nimport { FrameContext, UID } from '@farris/devkit';\r\n\r\n/**\r\n * å¯¼èªäºä»¶æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class NavigationEventService {\r\n  public frameContext: FrameContext;\r\n  /**\r\n   * å³é­åäºä»¶å¤çå¨\r\n   */\r\n  private onClosedListeners: Map<string, (options?: AppOptions) => void>;\r\n  /**\r\n   * å³é­åå¤çå¨\r\n   */\r\n  private onClosingListeners: Map<string, (options?: AppOptions) => Observable<boolean>>;\r\n  private onTabSwitchListeners: Map<string, (options?: AppOptions) => void>;\r\n  private params: { [propName: string]: any };\r\n\r\n  constructor(\r\n    private runtimeFrameworkService: RuntimeFrameworkService,\r\n    private menuStateService: MenuStateService,\r\n    private querystringService: QuerystringService\r\n  ) {\r\n    this.onClosedListeners = new Map<string, (options?: AppOptions) => void>();\r\n    this.onClosingListeners = new Map<string, (options?: AppOptions) => Observable<boolean>>();\r\n    this.onTabSwitchListeners = new Map<string, (options?: AppOptions) => void>();\r\n  }\r\n  private get querystrings() {\r\n    const params = this.querystringService.parse(window.location.hash);\r\n    // ä¿®æ­£formToken\r\n    if (params) {\r\n      params.formToken = this.runtimeFrameworkService.formToken;\r\n    }\r\n    return params;\r\n  }\r\n  /**\r\n   * æ³¨åäºä»¶\r\n   */\r\n  public registerEvent() {\r\n    const options = this.querystrings;\r\n    this.params = options;\r\n    // æ³¨åæ ç­¾é¡µåæ¢äºä»¶\r\n    this.runtimeFrameworkService.addEventListener(TAB_EVENT.onTabSwitched, (e) => this.handleTabSwitchEvent(e), options);\r\n    // æ³¨åæ ç­¾é¡µå³é­åäºä»¶\r\n    this.runtimeFrameworkService.addEventListener(TAB_EVENT.onTabClosed, (e) => this.handleTabClosedEvent(e), options);\r\n    // æ³¨åæ ç­¾é¡µå³é­åäºä»¶\r\n    this.runtimeFrameworkService.addEventListener(TAB_EVENT.onTabClosing, (e) => this.handleTabClosingEvent(e), options);\r\n  }\r\n  /**\r\n   * å¤çæ ç­¾é¡µåæ¢äºä»¶\r\n   */\r\n  private handleTabSwitchEvent(e: any) {\r\n    if (!e) {\r\n      return;\r\n    }\r\n    // éä¸­çè¡¨åä¸ºç³»ç»è¡¨åï¼åªè½è¿åidï¼æ²¡ætabId\r\n    const eventTabId = e.tabId || e.id || null;\r\n    if (!eventTabId) {\r\n      return;\r\n    }\r\n    const options = this.params; // this.querystrings;\r\n    const tabId = options.tabId || options.funcId || options.appId;\r\n    const menuState = this.menuStateService.getMenuState(eventTabId);\r\n    if (!!tabId && tabId === eventTabId && !!menuState && menuState.length > 0) {\r\n      this.formReload();\r\n    }\r\n    this.fireTabSwitchEvent(e);\r\n  }\r\n  /**\r\n   * è§¦åtabåæ¢äºä»¶\r\n   * @param e e\r\n   */\r\n  private fireTabSwitchEvent(e: any) {\r\n    if (!this.onTabSwitchListeners || this.onTabSwitchListeners.size < 1) {\r\n      return;\r\n    }\r\n    this.onTabSwitchListeners.forEach((handle, key, map) => {\r\n      if (typeof handle === 'function') {\r\n        handle(e);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * æ ç­¾é¡µå³é­åäºä»¶\r\n   */\r\n  private handleTabClosingEvent(e: any) {\r\n    if (!e) {\r\n      return;\r\n    }\r\n    // è¦å³é­çè¡¨åä¸ºç³»ç»è¡¨åï¼åªè½è¿åidï¼æ²¡ætabId\r\n    const eventTabId = e.tabId || e.id || null;\r\n    const options = this.params; // this.querystrings;\r\n    const tabId = options.tabId || options.funcId || options.appId;\r\n    if (!!eventTabId && !!tabId && tabId === eventTabId) {\r\n      this.fireTabClosingEvent(e).subscribe((result) => {\r\n        if (result) {\r\n          setTimeout(() => this.removeMenuState(eventTabId), 500);\r\n          const formEventServices: Map<string, any> = window['formEventServices'];\r\n          if (formEventServices.has(eventTabId)) {\r\n            formEventServices.delete(eventTabId);\r\n            window['formEventServices'] = formEventServices;\r\n          }\r\n          if (!(e && e.hasOwnProperty('token'))) {\r\n            e = Object.assign({}, e, { token: options.formToken });\r\n          }\r\n          // TODO:ä¸åä¸»å¨éæ¯appContextï¼å¯è½å­å¨åå­æ³æ¼é®é¢\r\n          // if (this.frameContext && this.frameContext.appContext) {\r\n          //   this.frameContext.appContext.dispose();\r\n          // }\r\n          this.runtimeFrameworkService.closeMenu(e);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * è§¦åå³é­åäºä»¶\r\n   */\r\n  private fireTabClosingEvent(e: any): Observable<boolean> {\r\n    if (!this.onClosingListeners || this.onClosingListeners.size < 1) {\r\n      return of(true);\r\n    }\r\n    const listeners = this.onClosingListeners.values();\r\n    const result$ = from(listeners);\r\n    // ç¨æ·æç»\r\n    let userRejected = false;\r\n    return result$.pipe(\r\n      concatMap((handle) => {\r\n        if (userRejected) {\r\n          return EMPTY;\r\n        }\r\n        return handle(e).pipe(\r\n          take(1),\r\n          tap((result) => userRejected = !result),\r\n          switchMap((result) => of(result))\r\n        );\r\n      }),\r\n      every((result) => result)\r\n    );\r\n  }\r\n  /**\r\n   * æ ç­¾é¡µå³é­åäºä»¶\r\n   */\r\n  private handleTabClosedEvent(e: any) {\r\n    if (!e) {\r\n      return;\r\n    }\r\n    const options = this.params; // this.querystrings;\r\n    const tabId = options.tabId || options.funcId || options.appId;\r\n    const eventTabId = e.tabId || e.id || null;\r\n    if (tabId === eventTabId) {\r\n      return;\r\n    }\r\n    const menuState = this.menuStateService.getMenuState(tabId, eventTabId);\r\n    if (!!eventTabId && !!menuState && menuState.length > 0) {\r\n      this.removeMenuState(eventTabId);\r\n      this.formReload();\r\n    }\r\n    this.fireTabClosedEvent(e);\r\n  }\r\n  private removeMenuState(tabId: string) {\r\n    if (this['context']) {\r\n      this.menuStateService.removeMenu(tabId);\r\n    }\r\n  }\r\n  /**\r\n   * è§¦åå³é­åäºä»¶\r\n   * @param e event\r\n   */\r\n  private fireTabClosedEvent(e: any) {\r\n    if (!this.onClosedListeners || this.onClosedListeners.size < 1) {\r\n      return;\r\n    }\r\n    this.onClosedListeners.forEach((handle, key, map) => {\r\n      if (typeof handle === 'function') {\r\n        handle(e);\r\n      }\r\n    });\r\n  }\r\n  // #endregion\r\n  /**\r\n   * æ³¨åäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å onTabClosed\r\n   * @param handler å¤çå¨\r\n   */\r\n  public addEventListener(eventType: string, handler: (options: AppOptions) => any): string {\r\n    const key = UID.create();\r\n    if (eventType === TAB_EVENT.onTabClosed) {\r\n      this.onClosedListeners.set(key, handler);\r\n      return key;\r\n    } else if (eventType === TAB_EVENT.onTabClosing) {\r\n      this.onClosingListeners.set(key, handler);\r\n      return key;\r\n    } else if (eventType === TAB_EVENT.onTabSwitched) {\r\n      this.onTabSwitchListeners.set(key, handler);\r\n      return key;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * ç§»é¤äºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å\r\n   * @param key äºä»¶æ è¯\r\n   */\r\n  public removeEventListener(eventType: string, key: string) {\r\n    if (eventType === TAB_EVENT.onTabClosed) {\r\n      return this.onClosedListeners.delete(key);\r\n    } else if (eventType === TAB_EVENT.onTabClosing) {\r\n      return this.onClosingListeners.delete(key);\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * æ¸ç©ºäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å\r\n   */\r\n  public clearEventListener(eventType: string): void {\r\n    if (eventType === TAB_EVENT.onTabClosed) {\r\n      this.onClosedListeners.clear();\r\n    } else if (eventType === TAB_EVENT.onTabClosing) {\r\n      this.onClosingListeners.clear();\r\n    }\r\n  }\r\n  /**\r\n   * å·æ°ç»ä»¶æ°æ®\r\n   */\r\n  private formReload() {\r\n    try {\r\n      // tslint:disable-next-line: no-string-literal\r\n      this['context']['frameContext']['appContext']['refresh']();\r\n    } catch { }\r\n  }\r\n}\r\n","import { Injectable, InjectionToken, Inject, Optional } from '@angular/core';\r\nexport const FARRIS_FORM_COMPONENTS = new InjectionToken<{[key: string]: any}>('è¡¨åå¼¹åºçªå£æéèç»ä»¶åè¡¨');\r\n\r\n/**\r\n * è¡¨åæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class FarrisFormService {\r\n\r\n    private controls: { [key: string]: any} = {};\r\n\r\n    constructor(@Optional()@Inject(FARRIS_FORM_COMPONENTS) initCtrls: any = {}) {\r\n      if (!initCtrls) {\r\n        initCtrls = {};\r\n      }\r\n      this.controls = { ...initCtrls };\r\n    }\r\n\r\n    append(key: string, cmpIns: any) {\r\n        this.controls[key] = cmpIns;\r\n    }\r\n\r\n    getControls(key: string) {\r\n        if (this.controls[key]) {\r\n            return this.controls[key];\r\n        } else {\r\n            console.warn(`æªæ¾å°Keyä¸º${key}çç»ä»¶ï¼`);\r\n            return null;\r\n        }\r\n    }\r\n\r\n}\r\n","/*\r\n * @Author: aalizzwell\r\n * @Date: 2019-08-02 15:31:34\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2020-03-03 09:33:43\r\n */\r\nimport { Injectable, Optional, Injector, ComponentFactoryResolver, ReflectiveInjector } from '@angular/core';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { AppOptions, AppType } from '@gsp-sys/rtf-common';\r\nimport { MenuStateService } from './menu-state.service';\r\nimport { NavigationEventService } from './navigation-event.service';\r\nimport { QuerystringService } from './querystring';\r\nimport { FrameContext, TranslateToken, Translate, FrameComponent } from '@farris/devkit';\r\nimport { FEPageModalService } from '@farris/extend-page-modal';\r\nimport lodash from 'lodash-es';\r\nimport { FarrisFormService } from './farris-form.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { map, switchMap } from 'rxjs/operators';\r\nimport { EMPTY, Observable, of } from 'rxjs';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { INSIDE_DIALOG_TOKEN, MODAL_REF } from './types';\r\nimport { BsModalRef } from '@farris/ui-modal';\r\ndeclare const System: any;\r\n// tslint:disable: no-string-literal max-line-length\r\nconst APP_CONTEXT_MANAGER = 'DEVKIT_APP_CONTEXT_MANAGER';\r\n/**\r\n * å¯¼èªæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class NavigationService {\r\n\r\n  constructor(\r\n    private runtimeFrameworkService: RuntimeFrameworkService,\r\n    private menuStateService: MenuStateService,\r\n    private navigationEventService: NavigationEventService,\r\n    private querystringService: QuerystringService,\r\n    @Optional() private frameContext: FrameContext,\r\n    @Optional() private injector: Injector,\r\n    @Optional() private languageService: LanguageService\r\n    // @Optional() private pageModalService: FEPageModalService,\r\n    // @Optional() private farrisFormService: FarrisFormService,\r\n    // @Optional() private languageService: LanguageService\r\n  ) {\r\n    // appIdä¸åäºtabIdï¼æ¯æ¬¡è¡¨åå®ä¾åæ¶é½ä¼éæ°çæ\r\n    const appId = this.formAppContext && this.formAppContext.ApplicationId;\r\n    let tabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    // å·²ç»ç¼è¯çè¡¨åï¼ä½¿ç¨appIdè®°å½hash\r\n    if (appId) {\r\n      const appContextManager = window[APP_CONTEXT_MANAGER] || new Map<string, any>();\r\n      if (appContextManager && !appContextManager.has(appId)) {\r\n        appContextManager.set(appId, { hash: window.location.hash });\r\n        window[APP_CONTEXT_MANAGER] = appContextManager;\r\n      }\r\n    }\r\n    if (tabId) {\r\n      const formEventServices: Map<string, any> = window['formEventServices'] || new Map<string, any>();\r\n      // tabIdãappIdé½å­å¨æ¶ï¼ä½¿ç¨appIdæ¿æ¢tabId\r\n      if (appId) {\r\n        tabId = appId;\r\n      }\r\n      if (formEventServices && formEventServices.has(tabId)) {\r\n        this.navigationEventService = formEventServices.get(tabId);\r\n      } else {\r\n        this.navigationEventService.registerEvent();\r\n        formEventServices.set(tabId, this.navigationEventService);\r\n        this.navigationEventService.frameContext = this.frameContext;\r\n        window['formEventServices'] = formEventServices;\r\n        this.registerDestroyEvent(tabId);\r\n      }\r\n    }\r\n    if (!languageService) {\r\n      this.languageService = new LanguageService();\r\n    }\r\n  }\r\n  public set context(context) {\r\n    this.navigationEventService['context'] = context;\r\n    this['commandContext'] = context;\r\n  }\r\n  /**\r\n   * è·åæ´ä¸ªè¡¨åçappcontextï¼é¤moduleä¸çappcontextï¼\r\n   */\r\n  private get formAppContext() {\r\n    if (this.frameContext) {\r\n      let appContext = this.frameContext.appContext;\r\n      // tslint:disable-next-line: max-line-length\r\n      while (appContext && appContext.parent && appContext.parent.injector && appContext.parent.injector.get(FrameContext, null) !== null) {\r\n        appContext = appContext.parent;\r\n      }\r\n      return appContext;\r\n    }\r\n    return null;\r\n  }\r\n  private get querystrings() {\r\n    let hash = window.location.hash;\r\n    const appId = this.formAppContext && this.formAppContext.ApplicationId;\r\n    if (appId) {\r\n      const appContextManager = window[APP_CONTEXT_MANAGER];\r\n      const appContext = appContextManager && appContextManager.get(appId);\r\n      hash = appContext && appContext.hash || hash;\r\n    }\r\n    const params = this.querystringService.parse(hash);\r\n    if (params) {\r\n      params.formToken = this.runtimeFrameworkService.formToken;\r\n    }\r\n    return params;\r\n  }\r\n  /**\r\n   * æç¤ºæå¡\r\n   */\r\n  private get formNotifyService() {\r\n    return this.injector && this.injector.get<FormNotifyService>(FormNotifyService, null);\r\n  }\r\n  /**\r\n   * æ³¨åéæ¯äºä»¶\r\n   * @param tabId\r\n   */\r\n  private registerDestroyEvent(tabId: string) {\r\n    if (this.frameContext && this.frameContext.destorySignal) {\r\n      this.frameContext.destorySignal.subscribe(() => {\r\n        this.navigationEventService = null;\r\n      });\r\n    }\r\n    if (this.frameContext && this.frameContext.appContext && this.frameContext.appContext.destorySignal) {\r\n      this.frameContext.appContext.destorySignal.subscribe(() => {\r\n        const formEventServices = window['formEventServices'] as Map<string, any>;\r\n        if (formEventServices) {\r\n          formEventServices.delete(tabId);\r\n        }\r\n        const appContextManager = window[APP_CONTEXT_MANAGER] as Map<string, any>;\r\n        if (appContextManager) {\r\n          appContextManager.delete(tabId);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  // #region æ¥å£\r\n\r\n  /**\r\n   * æå¼èå\r\n   * @param tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param funcId èåId\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param tabName tabæ é¢\r\n   * @param destructuring æ¯å¦è§£æåæ°\r\n   */\r\n  public openMenu(tabId: string, funcId: string, params: any, reload?: boolean, enableRefresh?: any, tabName?: string, destructuring?: any) {\r\n    if (!funcId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      funcId,\r\n      appType: AppType.Menu,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      appId: undefined,\r\n      appEntrance: undefined,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    // å¯ç¨æ°æ®å·æ°åæ°ä¸ºtrueæèæ²¡æå®ä¹ï¼åæå·æ°å¤ç\r\n    // æ²¡æä¼ éè¯¥åæ°æè¯¥åæ°ä¸ºç©ºï¼åè®¤ä¸ºæç§ä¹åçé»è¾å¤çï¼é»è®¤å·æ°\r\n    // null false \"false\" \"true\" undefined\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${funcId}_${tabId}` : funcId;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    this.runtimeFrameworkService.openMenu(options);\r\n  }\r\n  /**\r\n   * æå¼èåï¼æµï¼\r\n   * @param tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param funcId èåId\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n  public openMenu$(tabId: string, funcId: string, params: any, reload?: boolean, enableRefresh?: any, tabName?: string, destructuring?: any) {\r\n    if (!funcId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      funcId,\r\n      appType: AppType.Menu,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      appId: undefined,\r\n      appEntrance: undefined,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    // å¯ç¨æ°æ®å·æ°åæ°ä¸ºtrueæèæ²¡æå®ä¹ï¼åæå·æ°å¤ç\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${funcId}_${tabId}` : funcId;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    return this.runtimeFrameworkService.openMenu$(options);\r\n  }\r\n  /**\r\n   * æå¼èå(å¸¦ç»´åº¦)\r\n   * @param tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param funcId èåId\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param dim1 dim1\r\n   * @param dim2 dim2\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n  public openMenuWithDimension(tabId: string, funcId: string, params: any, enableRefresh?: any, dim1?: any, dim2?: any, tabName?: string, metadataId?: string, destructuring?: any) {\r\n    if (!funcId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    if (metadataId === undefined || metadataId === null) {\r\n      metadataId = '';\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n\r\n    // const paramsMap = this.buildParamMap(params);\r\n    queryStringParams.set('dim1', dim1 ? dim1 : 'public');\r\n    queryStringParams.set('dim2', dim2 ? dim2 : 'public');\r\n    queryStringParams.set('metadataId', metadataId);\r\n    queryStringParams.set('isRtc', '1');\r\n    queryStringParams.set('isRootMetadata', 'true');\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      funcId,\r\n      appType: AppType.Menu,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      appId: undefined,\r\n      appEntrance: undefined,\r\n      isReload: false,\r\n      tabName: tabName || null\r\n    };\r\n    // å¯ç¨æ°æ®å·æ°åæ°ä¸ºtrueæèæ²¡æå®ä¹ï¼åæå·æ°å¤ç\r\n    // æ²¡æä¼ éè¯¥åæ°æè¯¥åæ°ä¸ºç©ºï¼åè®¤ä¸ºæç§ä¹åçé»è¾å¤çï¼é»è®¤å·æ°\r\n    // null false \"false\" \"true\" undefined\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${funcId}_${tabId}` : funcId;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    this.runtimeFrameworkService.openMenu(options);\r\n  }\r\n  /**\r\n   * æå¼åºç¨\r\n   * @param tabId tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param appId åºç¨Id\r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param tabName tabæ é¢\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n\r\n  public openApp(tabId: string, appId: string, appEntrance: string, params: any, reload?: boolean, tabName?: string, enableRefresh?: any, destructuring?: any) {\r\n    if (!appId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      appId,\r\n      appEntrance,\r\n      funcId: undefined,\r\n      appType: AppType.App,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${appId}_${appEntrance}_${tabId}` : `${appId}_${appEntrance}`;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    this.runtimeFrameworkService.openMenu(options);\r\n  }\r\n  /**\r\n   * æå¼åºç¨(æµå¼)\r\n   * @param tabId tabId æ ¹æ®TabIdå³å®æå¼æ°æ ç­¾é¡µæå®ä½ä¹åæå¼çæ ç­¾é¡µ\r\n   * @param appId åºç¨Id\r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params åæ°\r\n   * @param reload æ¯å¦éæ°å·æ°\r\n   * @param tabName tabæ é¢\r\n   * @param enableRefresh å¯ç¨æ°æ®å·æ°\r\n   * @param destructuring è§£æåæ°\r\n   */\r\n  public openApp$(tabId: string, appId: string, appEntrance: string, params: any, reload?: boolean, tabName?: string, enableRefresh?: any, destructuring?: any) {\r\n    if (!appId && this.formNotifyService) {\r\n      this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (tabName) {\r\n      tabName = this.translate(tabName);\r\n    }\r\n    let queryStringParams = this.buildParamMap(params);\r\n    destructuring = this.convertToBoolean(destructuring, false);\r\n    if (destructuring === true) {\r\n      queryStringParams = this.buildParam(params);\r\n    }\r\n    // const paramsMap = this.buildParamMap(params);\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    const options: AppOptions = {\r\n      tabId,\r\n      appId,\r\n      appEntrance,\r\n      funcId: undefined,\r\n      appType: AppType.App,\r\n      queryStringParams: queryStringParams,\r\n      entityParams: queryStringParams,\r\n      isReload: reload,\r\n      tabName: tabName || null\r\n    };\r\n    enableRefresh = this.convertToBoolean(enableRefresh, true);\r\n    if (enableRefresh === true) {\r\n      const frameworkTabId = tabId ? `${appId}_${appEntrance}_${tabId}` : `${appId}_${appEntrance}`;\r\n      this.menuStateService.addMenuState(currentTabId, frameworkTabId);\r\n    }\r\n    return this.runtimeFrameworkService.openMenu$(options);\r\n  }\r\n  /**\r\n   * å³é­\r\n   * @param onCloseing å³é­åäºä»¶å¤çå¨\r\n   */\r\n  public close() {\r\n    const options = this.querystrings;\r\n    const { isDialogComponent: isInDialog, rootComponent } = this.findDialog();\r\n    if (isInDialog) {\r\n      const modalRefFactory = this.get(rootComponent, 'dialogRef');\r\n      let modalRef = null;\r\n      if (typeof modalRefFactory === 'function') {\r\n        const refs = modalRefFactory();\r\n        modalRef = refs && refs.modalRef;\r\n      } else {\r\n        modalRef = modalRefFactory;\r\n      }\r\n      modalRef && modalRef['close']();\r\n      return;\r\n    }\r\n    options.token = options.formToken;\r\n    this.runtimeFrameworkService.beforeCloseMenu(options);\r\n  }\r\n  /**\r\n   * å¼ºå¶å³é­\r\n   */\r\n  public destory() {\r\n    const options = this.querystrings;\r\n    options.token = options.formToken;\r\n    this.runtimeFrameworkService.closeMenu(options);\r\n  }\r\n  /**\r\n   *\r\n   * @param params params\r\n   * @deprecated å¾åºå¼ï¼ä¸buildParamMapéå¤\r\n   */\r\n  private parseParams(params: any) {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (typeof params === 'object') {\r\n      params = JSON.stringify(params);\r\n    }\r\n    params = window['encodeURIComponent'](params);\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    return paramMap;\r\n  }\r\n  /**\r\n   * æ³¨åäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å onTabClosed\r\n   * @param handler å¤çå¨\r\n   * @returns string è¿åäºä»¶æ è¯\r\n   */\r\n  public addEventListener(eventType: string, handler: (options: AppOptions) => any): string {\r\n    return this.navigationEventService.addEventListener(eventType, handler);\r\n  }\r\n  /**\r\n   * ç§»é¤äºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å onTabClosed | onTabCloseing\r\n   * @param key äºä»¶æ è¯\r\n   */\r\n  public removeEventListener(eventType: string, key: string): boolean {\r\n    return this.navigationEventService.removeEventListener(eventType, key);\r\n  }\r\n  /**\r\n   * æ¸ç©ºäºä»¶çå¬å¨\r\n   * @param eventType äºä»¶ç±»å\r\n   */\r\n  public clearEventListener(eventType: string): void {\r\n    this.navigationEventService.clearEventListener(eventType);\r\n  }\r\n  /**\r\n   * ä»¥å¼¹æ¡ãä¾§è¾¹æ ææ°æ ç­¾é¡µæ¹å¼æå¼è¡¨å\r\n   * @param mode æå¼æ¹å¼ï¼æ¯æ`modal`å¼¹çªã`sidebar`ä¾§è¾¹æ ã`tab`æ°æ ç­¾é¡µ\r\n   * @param modalId å¼¹çªidï¼å¦æmode=`modal`ä¸æ²¡æurlï¼\r\n   * @param configs å¼¹çªéç½®\r\n   * @param url è¿ç«¯è¡¨åurl\r\n   * @param tabId æ ç­¾é¡µidï¼modal=tabæ¶å¿å¡«\r\n   * @param tabType æ ç­¾é¡µç±»åï¼`menu` æ`app`\r\n   * @param funcOrAppId èåæåºç¨id\r\n   * @param appEntrance åºç¨å¥å£\r\n   * @param params åæ°\r\n   * @param tabName æ°æ ç­¾é¡µåç§°\r\n   * @param enableRefresh å¯ç¨å¯å¨å·æ°\r\n   * @param destructuring æ¯å¦è§£æ\r\n   */\r\n  public open(mode: 'modal' | 'sidebar' | 'tab', modalId?: string, url?: string, configs?: any, tabId?: string, tabType?: 'menu' | 'app', funcOrAppId?: string, appEntrance?: string, params?: any, tabName?: string, enableRefresh?: any, destructuring?: any) {\r\n    const pageModalService = this.injector.get<FEPageModalService>(FEPageModalService, null);\r\n    if (!pageModalService) {\r\n      throw new Error('get FEPageModalService failed.');\r\n    }\r\n    // æ ¡éªåæ°æ¯å¦åæ³\r\n    if (!mode) {\r\n      throw new Error('[NavigationService]->open,modeåæ°ä¸è½ä¸ºç©ºï¼');\r\n    }\r\n    if (mode === 'modal' || mode === 'sidebar') {\r\n      if (!modalId && !url) {\r\n        throw new Error('å¼¹çªåä¾§è¾¹æ æ¨¡å¼æ¶å¼¹çªå®¹å¨idåè¡¨åè·¯å¾ä¸è½åæ¶ä¸ºç©ºï¼');\r\n      }\r\n      if (modalId && url) {\r\n        throw new Error('å¼¹çªåä¾§è¾¹æ æ¨¡å¼æ¶å¼¹çªå®¹å¨idåè¡¨åè·¯å¾ä¸è½åæ¶å­å¨ï¼');\r\n      }\r\n      const uiStateConfig = this.getObjectTypeConfig(params);\r\n      const modalConfig = this.buildConfigs(configs);\r\n      if (mode === 'sidebar') {\r\n        modalConfig.dialogType = mode;\r\n      }\r\n      let pageModalRef = null;\r\n      if (modalId) {\r\n        const farrisFormService = this.injector.get<FarrisFormService>(FarrisFormService, null);\r\n        if (!farrisFormService) {\r\n          return;\r\n        }\r\n        const componentType = farrisFormService.getControls(modalId);\r\n        const componentRef = this.createComponentRef(componentType, uiStateConfig);\r\n        pageModalRef = pageModalService.show(componentRef, modalConfig);\r\n      } else if (url) {\r\n        pageModalRef = pageModalService.showByUrl(url, modalConfig);\r\n      }\r\n      if (pageModalRef && !!pageModalRef.content) {\r\n        pageModalRef.content.isDialogRootComponent = true;\r\n        pageModalRef.content.dialogRef = pageModalRef;\r\n        const header = pageModalRef.dialog && pageModalRef.dialog.instance && pageModalRef.dialog.instance.el && pageModalRef.dialog.instance.el.nativeElement && pageModalRef.dialog.instance.el.nativeElement.querySelector(\".f-page-header\");\r\n        if (header && pageModalRef.dialog.instance.draggbar) {\r\n          pageModalRef.dialog.instance.draggbar.handle = header;\r\n          header.style.cursor = 'move';\r\n        }\r\n      }\r\n    } else if (mode === 'tab') {\r\n      if (!tabId || !tabType || !funcOrAppId) {\r\n        if (this.formNotifyService) {\r\n          this.formNotifyService.warning(this.languageService.appOrFuncIdRequired, { hideTitle: true });\r\n        }\r\n        throw new Error('æ°æ ç­¾æ¨¡å¼æ¶æ ç­¾é¡µidãæ ç­¾ç±»åãèåæåºç¨idåä¸è½ä¸ºç©ºï¼');\r\n      }\r\n      if (tabType === 'app' && !appEntrance) {\r\n        throw new Error('ä»¥åºç¨æ¹å¼æå¼æ¶å¥å£åºç¨ä¸è½ä¸ºç©ºï¼');\r\n      }\r\n      if (tabType == 'app') {\r\n        this.openApp(tabId, funcOrAppId, appEntrance, params, false, tabName, enableRefresh, destructuring);\r\n      } else if (tabType === 'menu') {\r\n        this.openMenu(tabId, funcOrAppId, params, false, enableRefresh, tabName, destructuring);\r\n      }\r\n    } else {\r\n      throw new Error('ä¸æ¯æçæ¨¡å¼ï¼');\r\n    }\r\n    // this.pageModalService.\r\n  }\r\n  /**\r\n   * in app navigate\r\n   * @param commands commands\r\n   */\r\n  // public navigate(commands: any[]);\r\n  /**\r\n   * in app navigate\r\n   * @param commands commands\r\n   * @param options options\r\n   * @description options:{ relativeTo: this.activatedRoute, queryParams:{a:1,b:2},etc:...}\r\n   */\r\n  public navigate(commands: any[], options?: any): Promise<boolean> {\r\n    const router = this.injector && this.injector.get<Router>(Router, null);\r\n    const activatedRoute = this.injector && this.injector.get<ActivatedRoute>(ActivatedRoute, null);\r\n    const queryParams = lodash.merge({}, this.querystrings, options && options.queryParams || {});\r\n    if (options && options.hasOwnProperty('queryParams')) {\r\n      delete options.queryParams;\r\n    }\r\n    const extras = lodash.merge({ skipLocationChange: false, relativeTo: activatedRoute, queryParams }, options || {});\r\n    if (router) {\r\n      return router.navigate(commands, extras);\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  // #endregion\r\n\r\n  // #region ç§ææ¹æ³\r\n\r\n  /**\r\n   * å°è£è·¯ç±åæ°\r\n   * @param params åæ°\r\n   * @param options éç½®åæ°\r\n   */\r\n  private buildParamMap(params: any, options?: any): Map<string, string> {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (options && Object.keys(options).length > 0) {\r\n      if (typeof params !== 'object') {\r\n        params = JSON.parse(params);\r\n      }\r\n      params = lodash.merge(params, options);\r\n    }\r\n    if (typeof params === 'object') {\r\n      params = JSON.stringify(params);\r\n    }\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    params = window['encodeURIComponent'](params);\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);\r\n    return paramMap;\r\n  }\r\n  private buildParam(params, options?: any): Map<string, string> {\r\n    if (typeof params === 'undefined' || params === null || (typeof params === 'string' && params.length < 1)) {\r\n      params = {};\r\n    }\r\n    const paramMap = new Map<string, any>();\r\n    if (options && Object.keys(options).length > 0) {\r\n      if (typeof params !== 'object') {\r\n        params = JSON.parse(params);\r\n      }\r\n      params = lodash.merge(params, options);\r\n    }\r\n    if (typeof params !== 'object') {\r\n      params = JSON.parse(params);\r\n    }\r\n    Object.keys(params).forEach(key => {\r\n      paramMap.set(key, params[key]);\r\n    });\r\n\r\n    const currentTabId = this.querystrings.tabId || this.querystrings.funcId || this.querystrings.appId;\r\n    params = window['encodeURIComponent'](JSON.stringify(params));\r\n    paramMap.set('WEB_FORM_ROUTE_PARAMS', params);\r\n    paramMap.set('WEB_FORM_ROUTER_PARENT_ID', currentTabId);\r\n    return paramMap;\r\n  }\r\n  /**\r\n   * æ¥æ¾å¼¹çªç»ä»¶\r\n   */\r\n  private findDialog() {\r\n    let frameContext = this.get(this, 'commandContext.frameContext');\r\n    let isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n    let rootComponent = null;\r\n    let parentFrameContext = this.get(frameContext, 'parent');\r\n    while (parentFrameContext != null && !isDialogComponent) {\r\n      frameContext = this.get(frameContext, 'parent');\r\n      parentFrameContext = this.get(parentFrameContext, 'parent');\r\n      isDialogComponent = this.get(frameContext, 'frameComponent.isDialogRootComponent', false);\r\n    }\r\n    rootComponent = this.get(frameContext, 'frameComponent');\r\n    if (!isDialogComponent) {\r\n      isDialogComponent = this.frameContext.injector.get<boolean>(INSIDE_DIALOG_TOKEN, false);\r\n      if (isDialogComponent) {\r\n        const modalRef = this.frameContext.injector.get<BsModalRef>(MODAL_REF, null);\r\n        rootComponent = { dialogRef: modalRef };\r\n      }\r\n    }\r\n    return { isDialogComponent, rootComponent };\r\n  }\r\n\r\n  /**\r\n   * loadsh get\r\n   * @param object å¯¹è±¡\r\n   * @param path è·¯å¾\r\n   * @param defaultVal é»è®¤å¼\r\n   */\r\n  private get(object: any, path: Array<string> | string, defaultVal: any = null) {\r\n    const PATH = Array.isArray(path)\r\n      ? path\r\n      : path.split('.').filter(i => i.length);\r\n    if (!PATH.length) {\r\n      return object === undefined ? defaultVal : object;\r\n    }\r\n\r\n    if (object === null || object === undefined || typeof (object[PATH[0]]) === 'undefined') {\r\n      return defaultVal;\r\n    }\r\n\r\n    return this.get(object[PATH.shift()], PATH, defaultVal);\r\n  }\r\n  private convertToBoolean(value: any, defaultVal: boolean = false) {\r\n    if (typeof value === 'undefined' || value === null) {\r\n      value = defaultVal;\r\n    }\r\n    if (typeof value === 'string') {\r\n      value = value || String(defaultVal);\r\n      value = value === 'true' ? true : false;\r\n    }\r\n    return value;\r\n  }\r\n  /**\r\n   * ç¿»è¯èµæºé¡¹\r\n   * @param key èµæºé¡¹key\r\n   */\r\n  private translate(key: string) {\r\n    const translateService = this.injector && this.injector.get<Translate>(TranslateToken, null) || null;\r\n    if (translateService && key && key.startsWith('{{') && key.endsWith('}}')) {\r\n      key = key.replace('{{', '').replace('}}', '').trim();\r\n      return translateService.transform(key, null);\r\n    }\r\n    return key;\r\n  }\r\n  // #endregion\r\n\r\n  //#region å¼¹çªç¸å³æ¹æ³\r\n  private buildConfigs(config: any): { [prop: string]: any } {\r\n    let languageService = this.injector.get<LanguageService>(LanguageService, null);\r\n    if (!languageService) {\r\n      languageService = LanguageService.getInstance();\r\n    }\r\n\r\n    const defaultConfigs: any = {\r\n      title: languageService && languageService.defaultDialogTitle || '',\r\n      width: 800,\r\n      height: 500,\r\n      showButtons: false\r\n    };\r\n    const objectTypeConfig = this.getObjectTypeConfig(config);\r\n    const configs = Object.assign(defaultConfigs, objectTypeConfig);\r\n    const onClosingHandler = configs.beforeClose;\r\n    const refresh = configs['refresh'] || {};\r\n    const refreshCommandName = refresh && refresh.commandName || null;\r\n    const refreshFrameId = refresh && refresh.frameId || null;\r\n    // tslint:disable: no-string-literal\r\n    const cancelChanges = configs['cancelChanges'] || false;\r\n    configs.beforeClose = (ref) => {\r\n      if (!!onClosingHandler && typeof onClosingHandler === 'function') {\r\n        return onClosingHandler(ref).pipe(\r\n          switchMap(result => {\r\n            if (result) {\r\n              if (cancelChanges) {\r\n                return this.cancelChanges(ref).pipe(\r\n                  switchMap(() => this.refreshForm(refreshCommandName, refreshFrameId))\r\n                );\r\n              }\r\n            }\r\n            return of(result);\r\n          })\r\n        );\r\n      } else {\r\n        if (cancelChanges) {\r\n          return this.cancelChanges(ref).pipe(\r\n            switchMap(() => this.refreshForm(refreshCommandName, refreshFrameId))\r\n          );\r\n        } else {\r\n          return of(true);\r\n        }\r\n      }\r\n\r\n    };\r\n    return configs;\r\n  }\r\n  private getObjectTypeConfig(config: any) {\r\n    let objectTypeConfig: any\r\n    if (typeof config === 'undefined') {\r\n      config = {};\r\n    }\r\n    if (typeof config === 'string') {\r\n      if (config.length) {\r\n        try {\r\n          objectTypeConfig = JSON.parse(config);\r\n        } catch {\r\n          throw new Error(config + 'ä¸æ¯åæ³çjsonå­ç¬¦ä¸²');\r\n        }\r\n      } else {\r\n        objectTypeConfig = {};\r\n      }\r\n    } else if (typeof config === 'object') {\r\n      objectTypeConfig = Object.assign({}, config);\r\n    } else {\r\n      throw new Error('å¡«åå¯¹è±¡æ ¼å¼æjsonå­ç¬¦ä¸²');\r\n    }\r\n    return objectTypeConfig;\r\n  }\r\n  /**\r\n   * åæ¶æå¡å¨åæ´é\r\n   */\r\n  private cancelChanges(ref: any): Observable<boolean> {\r\n    if (ref && ref.modalRef && ref.modalRef.content) {\r\n      const component: FrameComponent = ref.modalRef.content as FrameComponent;\r\n      if (component && component.context) {\r\n        const repository = component.context.repository || null;\r\n        if (repository) {\r\n          return repository.cancelChanges().pipe(switchMap(() => of(true)));\r\n        }\r\n      }\r\n    }\r\n    return of(true);\r\n  }\r\n  private refreshForm(refreshCommandName: string, refreshFrameId: string): Observable<any> {\r\n    if (refreshCommandName && refreshFrameId) {\r\n      const frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(refreshFrameId);\r\n      if (frameContext) {\r\n        const viewModel = frameContext.viewModel;\r\n        return viewModel[refreshCommandName]().pipe(\r\n          map(() => true)\r\n        );\r\n      }\r\n    }\r\n    return of(true);\r\n  }\r\n  private createComponentRef(componentType: any, uiStateObject: any) {\r\n    let componentRef: any;\r\n    const frameContext = this.getFrameContext();\r\n    const componentFactoryResolver = this.getComponentFactoryResolver();\r\n    if (frameContext && componentFactoryResolver) {\r\n      const contentCmptFactory = componentFactoryResolver.resolveComponentFactory(componentType);\r\n      const modalContentInjector = ReflectiveInjector.resolveAndCreate([], frameContext.injector);\r\n      componentRef = contentCmptFactory.create(modalContentInjector);\r\n      if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {\r\n        if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {\r\n          Object.keys(uiStateObject).forEach(item => {\r\n            componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);\r\n          });\r\n        }\r\n        // éå isDialogåæ°\r\n        componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n      }\r\n    }\r\n    return componentRef;\r\n  }\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åframeContext\r\n   */\r\n  private getFrameContext() {\r\n    if (this.frameContext) {\r\n      return this.frameContext\r\n    }\r\n    if (this['context'] && this['context']['frameContext']) {\r\n      return this['context']['frameContext'];\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åComponentFactoryResolver\r\n   */\r\n  private getComponentFactoryResolver() {\r\n    const frameContext = this.getFrameContext();\r\n    let componentFactoryResolver: any;\r\n    if (frameContext) {\r\n      componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);\r\n    }\r\n    return componentFactoryResolver;\r\n  }\r\n  //#endregion\r\n}\r\n","import { FrameContext } from '@farris/devkit';\r\nimport { AppParamUtil } from './app-param.util';\r\n\r\nconst IS_ADD = 'IS_ADD';\r\nconst LAST_MODIFIED_ID = 'LAST_MODIFIED_ID';\r\n\r\n/**\r\n * è¡¨åç¶æå·¥å·ç±»\r\n * @internal\r\n */\r\nclass EditStateUtil {\r\n\r\n    /**\r\n     * è·åå½åè¡id\r\n     */\r\n    public static getLastModifiedId(frameContext: FrameContext): string {\r\n        // const lastModifiedId = AppParamUtil.get(frameContext, LAST_MODIFIED_ID);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        let lastModifiedId = null;\r\n        if (virtualRootFrameContext) {\r\n            lastModifiedId = virtualRootFrameContext.getParam(LAST_MODIFIED_ID);\r\n            return lastModifiedId ? lastModifiedId : null;\r\n        }\r\n        return lastModifiedId;\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®æåä¿®æ¹çid\r\n     */\r\n    public static setLastModifiedId(frameContext: FrameContext, lastModifiedId: string): void {\r\n        // AppParamUtil.set(frameContext, LAST_MODIFIED_ID, lastModifiedId);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(LAST_MODIFIED_ID, lastModifiedId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è·åæ°å¢ç¶æ\r\n     */\r\n    public static getAddState(frameContext: FrameContext, ): boolean {\r\n        // return AppParamUtil.get(frameContext, IS_ADD);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            return virtualRootFrameContext.getParam(IS_ADD);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®æ°å¢ç¶æ\r\n     */\r\n    public static setAddState(frameContext: FrameContext, lastModifiedId: string): void {\r\n        // AppParamUtil.set(frameContext, IS_ADD, true);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(IS_ADD, true);\r\n        }\r\n        this.setLastModifiedId(frameContext, lastModifiedId);\r\n    }\r\n\r\n    /**\r\n     * åæ¶æ°å¢ç¶æ\r\n     */\r\n    public static cancelAddState(frameContext: FrameContext) {\r\n        // AppParamUtil.set(frameContext, IS_ADD, false);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(IS_ADD, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è®¾ç½®ç¼è¾ç¶æ\r\n     */\r\n    public static setEditState(frameContext: FrameContext, id: string) {\r\n        // AppParamUtil.set(frameContext, IS_ADD, false);\r\n        const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n        if (virtualRootFrameContext) {\r\n            virtualRootFrameContext.setParam(IS_ADD, false);\r\n        }\r\n        this.setLastModifiedId(frameContext, id);\r\n    }\r\n}\r\n\r\nexport { EditStateUtil };\r\n","import { FrameContext  } from '@farris/devkit';\r\n\r\n/**\r\n * åºç¨ä¸ä¸æåéå·¥å·ç±»\r\n * @internal\r\n */\r\nclass AppParamUtil {\r\n\r\n  /**\r\n   * è·ååºç¨ä¸ä¸æåæ°\r\n   */\r\n  public static get(frameContext: FrameContext, name: string): any {\r\n    const appContext = frameContext.appContext;\r\n    return appContext.getParam(name);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®åºç¨ä¸ä¸æåæ°\r\n   */\r\n  public static set(frameContext: FrameContext, name: string, value: any) {\r\n    const appContext = frameContext.appContext;\r\n    return appContext.setParam(name, value);\r\n  }\r\n}\r\n\r\nexport { AppParamUtil };\r\n","import { FormNotifyService } from './form-notify.service';\r\n\r\nclass FormNotifyStrategyService {\r\n  /**\r\n   * æ¶æ¯æç¤º\r\n   * @param formNotifyService formNotifyService\r\n   * @param content content\r\n   */\r\n  public static info(formNotifyService: FormNotifyService, content: string) {\r\n    const search = window.location.hash;\r\n    const { odocDisableNotification = '' } = FormNotifyStrategyService.querystring(search);\r\n    if (odocDisableNotification && odocDisableNotification.toLowerCase() === 'true') {\r\n      return;\r\n    }\r\n    formNotifyService.info(content, { hideTitle: true });\r\n  }\r\n  /**\r\n   * æåæç¤º\r\n   * @param formNotifyService formNotifyService\r\n   * @param content content\r\n   */\r\n  public static success(formNotifyService: FormNotifyService, content: string) {\r\n    const search = window.location.hash;\r\n    const { odocDisableNotification = '' } = FormNotifyStrategyService.querystring(search);\r\n    if (odocDisableNotification && odocDisableNotification.toLowerCase() === 'true') {\r\n      return;\r\n    }\r\n    formNotifyService.success(content, { hideTitle: true });\r\n  }\r\n  private static querystring(querystring: string): any {\r\n    const urlSearchParams = new URLSearchParams(querystring);\r\n    const result = {};\r\n    urlSearchParams.forEach((value: string, key: string) => {\r\n      result[key] = value;\r\n    });\r\n    return result;\r\n  }\r\n}\r\nexport { FormNotifyStrategyService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { filter, take } from 'rxjs/operators';\r\nimport { AppContext, ViewModel, CommandContext, Entity, FrameContext } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\n\r\n/**\r\n * å½ä»¤æå¡\r\n * @scope FrameConmponent\r\n */\r\n@Injectable()\r\nclass CommandService {\r\n\r\n  /**\r\n   * åé¨cotnext\r\n   */\r\n  private innerContext: CommandContext;\r\n\r\n  /**\r\n   * contextåå¼æ¹æ³\r\n   */\r\n  public get context(): CommandContext {\r\n    return this.innerContext;\r\n  }\r\n\r\n  /**\r\n   * contextè®¾å¼æ¹æ³\r\n   */\r\n  public set context(context: CommandContext) {\r\n    this.innerContext = context;\r\n  }\r\n\r\n  constructor(\r\n    private viewModel: ViewModel,\r\n    private appContext: AppContext\r\n  ) { }\r\n\r\n  /**\r\n   * æ§è¡å½ä»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   * @param frameId æ¡æ¶ID\r\n   */\r\n  public execute(commandName: string, frameId?: string): Observable<any> {\r\n    if (!commandName || commandName === '' || commandName === 'undefined') {\r\n      return;\r\n    }\r\n    let viewModel = this.viewModel;\r\n    if (frameId) {\r\n      const targetContext = this.appContext.frameContextManager.getFrameContextById(frameId);\r\n      viewModel = targetContext.viewModel;\r\n    }\r\n    return viewModel[commandName]();\r\n  }\r\n\r\n  /**\r\n   * ç­å¾BeSessionåå»º\r\n   * @returns ææ°åå»ºåºæ¥çBeSession\r\n   */\r\n  public waitForBeSession(): Observable<string> {\r\n    const frameContext = this.context.frameContext;\r\n    const befRepository = frameContext.repository as BefRepository<Entity>;\r\n    const sessionService = befRepository.restService.sessionService;\r\n    return sessionService.getBeSessionId().pipe(\r\n      filter((beSessionId: string) => {\r\n        return beSessionId !== null;\r\n      }),\r\n      take(1)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æåæä¸ªä»»å¡çæ§è¡ç»æ\r\n   * @param taskName ä»»å¡åç§°\r\n   * @reutrn è¿åtaskNameå¯¹åºä»»å¡çæ§è¡ç»æ\r\n   */\r\n  public extractResult(taskName: string) {\r\n    const results = this.context.results;\r\n    return results[taskName];\r\n  }\r\n  /**\r\n   * æåå½åç»ä»¶çè¡åæ¢äºä»¶æåº\r\n   */\r\n  public suspendFrameContextRowSelectedEvent(frameId?: string) {\r\n    let frameContext: FrameContext = this.viewModel.frameContext;\r\n    if (frameId) {\r\n      frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    }\r\n    if (frameContext) {\r\n      frameContext.bindingData.rowSelectedEventSuspend = true;\r\n    }\r\n\r\n  }\r\n  public resumeFrameContextRowSelectedEvent(frameId?: string) {\r\n    let frameContext: FrameContext = this.viewModel.frameContext;\r\n    if (frameId) {\r\n      frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    }\r\n    if (frameContext) {\r\n      frameContext.bindingData.rowSelectedEventSuspend = false;\r\n    }\r\n  }\r\n}\r\n\r\nexport { CommandService };\r\n","import { ElementRef } from \"@angular/core\";\r\n\r\nexport class VerifyService {\r\n  public static focusElement(selector: string, elementRef?: ElementRef) {\r\n    const nativeElement = elementRef && elementRef.nativeElement || document;\r\n    let target = nativeElement.ownerDocument.getElementById(selector);\r\n    if (target) {\r\n      if (target.tagName !== 'INPUT') {\r\n        const input = target.getElementsByTagName('input');\r\n        if (input.length) {\r\n          target = input[0];\r\n        }\r\n      }\r\n      target.focus();\r\n    }\r\n  }\r\n}","// tslint:disable: max-line-length\r\nimport { ElementRef, InjectFlags, Injectable, Optional, Self } from '@angular/core';\r\nimport { Repository, Entity, FrameContext, PARENT_CLASS, ChangeType, ValidationResult, ValidationError, ValidateRule, ViewModel, DataTypeInfo, DataPropGroup, DataPropInfo, BindingList, ComponentType } from '@farris/devkit';\r\nimport { tap, switchMap } from 'rxjs/operators';\r\nimport { EMPTY, Observable, Subject } from 'rxjs';\r\nimport { zip } from 'rxjs/observable/zip';\r\nimport { empty } from 'rxjs/observable/empty';\r\nimport { of } from 'rxjs/observable/of';\r\nimport { VerifyDetailService } from '@farris/ui-verify-detail';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { VerifyService } from './verify.service';\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\n\r\n/**\r\n * è¡¨åéªè¯æå¡\r\n * @scope FrameComponent\r\n */\r\n\r\n@Injectable()\r\nclass ValidationService {\r\n\r\n  private validationResults = new Subject<any>();\r\n  private validationAllResult = new Subject<any>();\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private frameContext: FrameContext,\r\n    @Optional() private notifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = new LanguageService();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * éªè¯è¡¨ååçææè¡¨å\r\n   */\r\n  public validate() {\r\n    this.repository.getList().subscribe(\r\n      (result: Entity[]) => {\r\n        for (const entity of result) {\r\n          entity.validate().subscribe((result: ValidationResult) => {\r\n            if (!result.isValid) {\r\n              alert(result.message);\r\n              this.validationResults.next(result);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    );\r\n    return this.validationResults;\r\n  }\r\n  /**\r\n   * æ ¡éªå½åè¡\r\n   */\r\n  public validateCurrentRow(): Observable<any> {\r\n    const entityTypeInfo = this.repository.entityTypeInfo;\r\n    // ç»åè¡¨ååªæ ¡éªå½åæé®æå¨çè¡¨å\r\n    const primaryValue = this.frameContext.bindingData.list.currentId;\r\n    if (!primaryValue) {\r\n      return of(true);\r\n    }\r\n    // é¦åæ ¡éªå®ä½ä¸è½ä¸ºç©ºè§å\r\n    const entity = this.repository.entityCollection.getEntityById(primaryValue);\r\n    if (!entity) {\r\n      return of(true);\r\n    }\r\n\r\n    const entities: Entity[] = [entity];\r\n    const namespace = this.frameContext.namespace;\r\n    let frameContexts = [];\r\n    // ä¿®å¤ä½¿ç¨ç¸åbeåå»ºçvoçç»åè¡¨åæ ¡éªæ¶å¤ä¸ªè¡¨åæ ¡éªè§åè¢«åå¹¶çé®é¢\r\n    // TODO: ç®åæªèèç»åè¡¨åç»ä¸ä¿å­çåºæ¯ï¼åç»­æ¯æç»åè¡¨åç»ä¸ä¿å­æ¶åä¿®æ¹\r\n    if (namespace !== null) {\r\n      // å­å¨å½åç©ºé´ï¼è¯´æè¡¨åè¾æ°ï¼å¯ä»¥ä¾èµè¯¥ç¹æ§\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);\r\n    } else {\r\n      // è¡¨åè¾èï¼è·åææçä¸ä¸æï¼å¨æ ¡éªé¶æ®µè¿æ»¤è§å\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    }\r\n\r\n    const isModal = this.isInDialog();\r\n    const hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();\r\n    let rootViewModel = this.frameContext.root.viewModel;\r\n    if (isModal && hasOwnVerifyDetailService) {\r\n      rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;\r\n    }\r\n\r\n    let toValidate = false;\r\n    const formErrors = [];\r\n    frameContexts.forEach((frameContext: FrameContext) => {\r\n      if (frameContext.form && frameContext.form.enableValidate) {\r\n        toValidate = true;\r\n      }\r\n    });\r\n    if (!toValidate || entities.length < 1) {\r\n      return of(true);\r\n    }\r\n    rootViewModel.verifyInformations = [];\r\n    let formValid = true;\r\n    let entityValid = true;\r\n    const formValidationRules = new Map<string, ValidateRule[]>();\r\n    frameContexts.forEach((formContext: FrameContext) => {\r\n      const bindingObject = formContext.bindingData.getObject();\r\n      // éç¥ææbindingData,\r\n      bindingObject && bindingObject.setShowValidationMsg(true);\r\n      if (formContext.form && formContext.form.enableValidate) {\r\n        // è·åå½åè¡¨åä¸çææéªè¯è§å\r\n        const currentFormValidationRules = formContext.form.getValidationRules();\r\n        currentFormValidationRules.forEach((rules, path) => {\r\n          if (formValidationRules.has(path)) {\r\n            rules.forEach(rule => formValidationRules.get(path).push(rule));\r\n          } else {\r\n            formValidationRules.set(path, [...rules]);\r\n          }\r\n        });\r\n        formContext.form.setShowValidationMsg(true);\r\n        // éä¸ªè°ç¨è¡¨åçéªè¯ï¼éªè¯åç«¯è¡¨åè§å\r\n        if (!formContext.form.isFormValid()) {\r\n          formErrors.push(formContext.form);\r\n          formValid = false;\r\n        }\r\n      }\r\n    });\r\n\r\n    // éªè¯ææå®ä½\r\n    const observableList = entities.map((entity: Entity) => {\r\n      const index = this.frameContext.bindingData.list.getIndexById(entity.primaryValue);\r\n      return entity.validate(undefined, undefined, formValidationRules, null, this.frameContext);\r\n    });\r\n    const result$ = zip(...observableList).pipe(\r\n      tap((resultList) => {\r\n        frameContexts.forEach((formContext: FrameContext) => {\r\n          if (!formContext.form.enableValidate) {\r\n            return;\r\n          }\r\n          const handleErrors = (errors: ValidationError[]) => {\r\n            errors.forEach((validationError: ValidationError) => {\r\n              if (validationError.children && validationError.children.length) {\r\n                handleErrors(validationError.children);\r\n              }\r\n              const errMsgObj = {};\r\n              let id = '';\r\n              const findId = (target: any) => {\r\n                if (target && target.data && target.data.id) {\r\n                  id = target.data.id;\r\n                  return;\r\n                } else if (target[PARENT_CLASS]) {\r\n                  findId(target[PARENT_CLASS]);\r\n                }\r\n              };\r\n              findId(validationError.target);\r\n\r\n              // å®ä½éªè¯åºéï¼éè¦å°éè¯¯å±ç¤ºå°çé¢ä¸\r\n              // å®ä½ä¸ä¸å®æ¯å½åè¡\r\n              let parentPathData = {\r\n                path: [],\r\n                isUdt: false,\r\n                isGrid: false\r\n              };\r\n              if (validationError.target) {\r\n                parentPathData = validationError.target.getPaths();\r\n              }\r\n              const bindingPath = '/' + parentPathData.path.join('/');\r\n              if (validationError.constraints) {\r\n                Object.keys(validationError.constraints).forEach(key => {\r\n                  errMsgObj[key] = {\r\n                    name: validationError.constraints[key]\r\n                  };\r\n                  // if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n                  //   rootViewModel['verifyInformations'].push({\r\n                  //     id: id,\r\n                  //     title: key,\r\n                  //     msg: validationError.constraints[key],\r\n                  //     type: 'warn'\r\n                  //   })\r\n                  // }\r\n                });\r\n              }\r\n              const paths = parentPathData.path.concat(validationError.property);\r\n\r\n              //if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n              // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n              formContext.bindingData.changes.next({\r\n                type: ChangeType.UpdateErrors,\r\n                id,\r\n                path: paths,\r\n                isUdt: parentPathData.isUdt,\r\n                isGrid: parentPathData.isGrid,\r\n                value: validationError.value,\r\n                errors: errMsgObj\r\n              });\r\n              //}\r\n            });\r\n          };\r\n          // å±å¼éªè¯ç»æ\r\n          const isValidList = resultList.map((result: ValidationResult) => result.isValid);\r\n          // ä¿å­ååè°ç¨å®ä½ä¸çéªè¯è§åï¼å¨é¨éè¿ä¹åæä¿å­\r\n          // å®ä½éªè¯éè¿\r\n          if (isValidList.filter(x => x).length === observableList.length) {\r\n            // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n            formContext.bindingData.changes.next({\r\n              type: ChangeType.UpdateErrors,\r\n              path: []\r\n            });\r\n            // éªè¯æååéèè¾å¥æ¶çéªè¯\r\n            if (formValid) {\r\n              const bindingObject = formContext.bindingData.getObject();\r\n              bindingObject && bindingObject.setShowValidationMsg(false);\r\n              const form = formContext.form;\r\n              if (form) {\r\n                form.setShowValidationMsg(false);\r\n              }\r\n            }\r\n          } else {\r\n            // å®ä½éªè¯æéè¯¯\r\n            entityValid = false;\r\n            resultList.forEach((result: ValidationResult) => {\r\n              if (result.isValid) {\r\n                // æ¸é¤éªè¯éè¿çéè¯¯\r\n                formContext.bindingData.changes.next({\r\n                  type: ChangeType.UpdateErrors,\r\n                  path: []\r\n                });\r\n              } else {\r\n                handleErrors(result.errors);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }),\r\n      switchMap((resultList) => {\r\n        let isValidated = true;\r\n        const errors = [];\r\n        resultList.forEach((result: ValidationResult) => {\r\n          if (!result.isValid) {\r\n            isValidated = false;\r\n          }\r\n          errors.push(...result.errors);\r\n        });\r\n        if (errors.length > 0) {\r\n          this.collectValidationErrors(rootViewModel, errors, this.frameContext.namespace);\r\n        }\r\n        // rootViewModel.verifycationChanged.next(rootViewModel.verifyInformations);\r\n        let verifyInformations = rootViewModel.verifyInformations;\r\n        if (isModal && hasOwnVerifyDetailService) {\r\n          verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace === namespace);\r\n        }\r\n        rootViewModel.verifycationChanged.next(verifyInformations);\r\n        this.handleErrorClickEvent();\r\n        if (isValidated && !formValid) {\r\n          // å®ä½æ ¡éªéè¿ä½è¡¨åæ ¡éªä¸éè¿ï¼æ­¤æ¶å®ä½åè¡¨åå­å¨æ ¡éªè§åä¸ä¸è´çæåµ\r\n          console.warn('å®ä½åæ§ä»¶æ ¡éªè§åä¸ä¸è´ï¼è¯·ç¡®è®¤å®ä½æ ¡éªè§åéç½®ä¸æ§ä»¶ä¸è´ãå¦æéç½®ä¸ä¸è´å¯è½ä¼å¯¼è´æ ¡éªå¤±æï¼');\r\n        }\r\n        // å®ä½æ ¡éªéè¿ï¼å®ä½æ ¡éªä½¿ç¨çè§åæ¯æ§ä»¶+å®ä½ï¼æ­£å¸¸å®ä½æ ¡éªéè¿åæ§ä»¶æ ¡éªä¸å®ä¹ä¼éè¿\r\n        if (isValidated) {\r\n          const isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);\r\n          if (!isEntityValid) {\r\n            return EMPTY;\r\n          }\r\n          return of(true);\r\n        } else {\r\n          return empty();\r\n        }\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * è°ç¨è¡¨ååå®ä½ä¸çéªè¯è§å, éè¿åè°ç¨åè°cb\r\n   */\r\n  validateAll(): Observable<any> {\r\n    const entityTypeInfo = this.repository.entityTypeInfo;\r\n    // ç»åè¡¨ååªæ ¡éªå½åæé®æå¨çè¡¨å\r\n    const entities: Entity[] = this.repository.entityCollection.getAllEntities();\r\n    const namespace = this.frameContext.namespace;\r\n    let frameContexts = [];\r\n    if (namespace !== null) {\r\n      // å­å¨å½åç©ºé´ï¼è¯´æè¡¨åè¾æ°ï¼å¯ä»¥ä¾èµè¯¥ç¹æ§\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);\r\n    } else {\r\n      // è¡¨åè¾èï¼è·åææçä¸ä¸æï¼å¨æ ¡éªé¶æ®µè¿æ»¤è§å\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    }\r\n\r\n    let toValidate = false;\r\n    const formErrors = [];\r\n    frameContexts.forEach((frameContext: FrameContext) => {\r\n      if (frameContext.form && frameContext.form.enableValidate) {\r\n        toValidate = true;\r\n      }\r\n    });\r\n    if (!toValidate || entities.length < 1) {\r\n      return of(true);\r\n    }\r\n    const isModal = this.isInDialog();\r\n    const hasOwnVerifyDetailService = this.hasOwnVerifyDetailService();\r\n    let rootViewModel = this.frameContext.root.viewModel;\r\n    if (isModal && hasOwnVerifyDetailService) {\r\n      rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;\r\n    }\r\n\r\n    let formValid = true;\r\n    let entityValid = true;\r\n    const formValidationRules = new Map<string, ValidateRule[]>();\r\n    frameContexts.forEach((formContext: FrameContext) => {\r\n      const bindingObject = formContext.bindingData.getObject();\r\n      // éç¥ææbindingData,\r\n      bindingObject && bindingObject.setShowValidationMsg(true);\r\n      if (formContext.form && formContext.form.enableValidate) {\r\n        // è·åå½åè¡¨åä¸çææéªè¯è§å\r\n        const currentFormValidationRules = formContext.form.getValidationRules();\r\n        currentFormValidationRules.forEach((rules, path) => {\r\n          if (formValidationRules.has(path)) {\r\n            rules.forEach(rule => formValidationRules.get(path).push(rule));\r\n          } else {\r\n            formValidationRules.set(path, [...rules]);\r\n          }\r\n        });\r\n        formContext.form.setShowValidationMsg(true);\r\n        // éä¸ªè°ç¨è¡¨åçéªè¯ï¼éªè¯åç«¯è¡¨åè§å\r\n        if (!formContext.form.isFormValid()) {\r\n          formErrors.push(formContext.form);\r\n          formValid = false;\r\n        }\r\n      }\r\n    });\r\n    // è§¦åææå®ä½çvalidateäºä»¶\r\n    const isMultiEntityValiate = entities.length > 0;\r\n\r\n    // éªè¯ææå®ä½\r\n    const observableList = entities.map((entity: Entity, index: number) =>\r\n      entity.validate(undefined, undefined, formValidationRules, isMultiEntityValiate ? index : null, this.frameContext));\r\n    const result$ = zip(...observableList).pipe(\r\n      tap((resultList) => {\r\n        frameContexts.forEach((formContext: FrameContext) => {\r\n          if (!formContext.form.enableValidate) {\r\n            return;\r\n          }\r\n          const handleErrors = (errors: ValidationError[]) => {\r\n            errors.forEach((validationError: ValidationError) => {\r\n              if (validationError.children && validationError.children.length) {\r\n                handleErrors(validationError.children);\r\n              }\r\n              const errMsgObj = {};\r\n              let id = '';\r\n              const findId = (target: any) => {\r\n                if (target && target.data && target.data.id) {\r\n                  id = target.data.id;\r\n                  return;\r\n                } else if (target[PARENT_CLASS]) {\r\n                  findId(target[PARENT_CLASS]);\r\n                }\r\n              };\r\n              findId(validationError.target);\r\n\r\n              // å®ä½éªè¯åºéï¼éè¦å°éè¯¯å±ç¤ºå°çé¢ä¸\r\n              // å®ä½ä¸ä¸å®æ¯å½åè¡\r\n              let parentPathData = {\r\n                path: [],\r\n                isUdt: false,\r\n                isGrid: false\r\n              };\r\n              if (validationError.target) {\r\n                parentPathData = validationError.target.getPaths();\r\n              }\r\n              const bindingPath = '/' + parentPathData.path.join('/');\r\n              if (validationError.constraints) {\r\n                Object.keys(validationError.constraints).forEach(key => {\r\n                  errMsgObj[key] = {\r\n                    name: validationError.constraints[key]\r\n                  };\r\n                  // if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n                  //   rootViewModel['verifyInformations'].push({\r\n                  //     id: id,\r\n                  //     title: key,\r\n                  //     msg: validationError.constraints[key],\r\n                  //     type: 'warn'\r\n                  //   })\r\n                  // }\r\n                });\r\n              }\r\n              const paths = parentPathData.path.concat(validationError.property);\r\n\r\n              //if (this.frameContext.viewModel.bindingPath === bindingPath) {\r\n              // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n              formContext.bindingData.changes.next({\r\n                type: ChangeType.UpdateErrors,\r\n                id,\r\n                path: paths,\r\n                isUdt: parentPathData.isUdt,\r\n                isGrid: parentPathData.isGrid,\r\n                value: validationError.value,\r\n                errors: errMsgObj\r\n              });\r\n              //}\r\n            });\r\n          };\r\n          // å±å¼éªè¯ç»æ\r\n          const isValidList = resultList.map((result: ValidationResult) => result.isValid);\r\n          // ä¿å­ååè°ç¨å®ä½ä¸çéªè¯è§åï¼å¨é¨éè¿ä¹åæä¿å­\r\n          // å®ä½éªè¯éè¿\r\n          if (isValidList.filter(x => x).length === observableList.length) {\r\n            // å°éè¯¯ä¿¡æ¯æ´æ°å°formControlä¸\r\n            formContext.bindingData.changes.next({\r\n              type: ChangeType.UpdateErrors,\r\n              path: []\r\n            });\r\n            // éªè¯æååéèè¾å¥æ¶çéªè¯\r\n            if (formValid) {\r\n              const bindingObject = formContext.bindingData.getObject();\r\n              bindingObject && bindingObject.setShowValidationMsg(false);\r\n              const form = formContext.form;\r\n              if (form) {\r\n                form.setShowValidationMsg(false);\r\n              }\r\n            }\r\n          } else {\r\n            // å®ä½éªè¯æéè¯¯\r\n            entityValid = false;\r\n            resultList.forEach((result: ValidationResult) => {\r\n              if (result.isValid) {\r\n                // æ¸é¤éªè¯éè¿çéè¯¯\r\n                formContext.bindingData.changes.next({\r\n                  type: ChangeType.UpdateErrors,\r\n                  path: []\r\n                });\r\n              } else {\r\n                handleErrors(result.errors);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }),\r\n      switchMap((resultList) => {\r\n        let isValidated = true;\r\n        const errors = [];\r\n        resultList.forEach((result: ValidationResult) => {\r\n          if (!result.isValid) {\r\n            isValidated = false;\r\n          }\r\n          errors.push(...result.errors);\r\n        });\r\n        if (errors.length > 0) {\r\n          this.collectValidationErrors(rootViewModel, errors, this.frameContext.namespace);\r\n        }\r\n        let verifyInformations = rootViewModel.verifyInformations;\r\n        if (isModal && hasOwnVerifyDetailService) {\r\n          verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace === namespace);\r\n        }\r\n        // å ä¸ºæ ¡éªç´¯å çç¼æï¼å¯¼è´ä¹åçæ ¡éªä¿¡æ¯ä¸ç´å­å¨ï¼åªè½éè¿æ ¡éªç»ææ¥ç¡®å®æ¯å¦è¿æéè¯¯ä¿¡æ¯\r\n        if (isValidated && formValid) {\r\n          verifyInformations = rootViewModel.verifyInformations = [];\r\n        }\r\n        rootViewModel.verifycationChanged.next(verifyInformations);\r\n        this.handleErrorClickEvent();\r\n        if (isValidated) {\r\n          const isEntityValid = this.validateEntityAllowEmptyRule(entityTypeInfo);\r\n          if (!isEntityValid) {\r\n            return EMPTY;\r\n          }\r\n          return of(true);\r\n        } else {\r\n          return empty();\r\n        }\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * æ ¡éªå®ä½æ¯å¦æ»¡è¶³ä¸è½ä¸ºç©ºçè§å\r\n   * @param entity ä¸»å®ä½\r\n   */\r\n  private validateEntityAllowEmptyRule(entityTypeInfo: DataTypeInfo) {\r\n    // ç¡®è®¤å®ä½åä¸ªå±çº§ä¸­æ¯å¦å­å¨ä¸è½ä¸ºç©ºçè§å\r\n    const paths = this.getNotAllowEmptyBindingPaths(entityTypeInfo);\r\n    if (!paths || paths.length < 1) {\r\n      return true;\r\n    }\r\n    // æ¾å°ææä¸åæ³çbindingPaths\r\n    const invalidPaths = paths.filter((path: string) => {\r\n      const bindingPaths = path.split('/').filter(p => p);\r\n      const bindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n      if (!bindingList || bindingList.length < 1) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    // æå®ä½å¿å¡«ï¼ä½å®ä½æ°æ®ä¸ºç©º\r\n    if (invalidPaths.length > 0) {\r\n      const tableNames = [];\r\n      invalidPaths.forEach((path: string) => {\r\n        //const frameContexts = this.getFrameContextByBindingPath(path.split('/'));\r\n        //const frameComponents = frameContexts.map(frameContext => frameContext.frameComponent);\r\n        // æ¾å°ææå®¹å¨ç±»ç»ä»¶\r\n        //const containerComponents = frameComponents.filter(frameComponent => [ComponentType.farrisDataGridComponent, ComponentType.farrisTreeTalbeComponent, ComponentType.kendoGridComponent, ComponentType.primengTreeComponent].includes(frameComponent.componentType));\r\n        //if (!(!containerComponents || containerComponents.length < 1)) {\r\n        const viewModelName = this.getViewModelNameByBindingPaths(path.split('/')) || `ç»å®è·¯å¾${path}`;\r\n        tableNames.push(viewModelName);\r\n        //}\r\n      });\r\n      if (this.notifyService) {\r\n        this.notifyService.error(`${tableNames.join('ï¼')} ${this.languageService.tableCanNotEmpty}`, { hideTitle: true });\r\n      }\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  /**\r\n   * \r\n   * @param bindingPaths pathä¸è½ä¸ºç©ºæ/ï¼ä¸æ¯æä¸»è¡¨\r\n   */\r\n  private getViewModelNameByBindingPaths(bindingPaths: string[]) {\r\n    const namespace = this.frameContext.namespace;\r\n    let frameContexts: FrameContext[] = null;\r\n    if (namespace !== null) {\r\n      // å­å¨å½åç©ºé´ï¼è¯´æè¡¨åè¾æ°ï¼å¯ä»¥ä¾èµè¯¥ç¹æ§\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace);\r\n    } else {\r\n      // è¡¨åè¾èï¼è·åææçä¸ä¸æï¼å¨æ ¡éªé¶æ®µè¿æ»¤è§å\r\n      frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    }\r\n    const bindingPath = bindingPaths.filter(p => p).join('/');\r\n    const frameContext = frameContexts.find((frameContext: FrameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);\r\n    const viewModelName = frameContext && frameContext.form && frameContext.form.formGroupName || '';\r\n    return viewModelName;\r\n  }\r\n  /**\r\n   * éåè·åææä¸è½ä¸ºç©ºçå®ä½çç»å®è·¯å¾\r\n   * @param entityTypeInfo \r\n   * @param results \r\n   * @returns \r\n   */\r\n  private getNotAllowEmptyBindingPaths(entityTypeInfo: DataTypeInfo, results: string[] = []): string[] {\r\n    if (!entityTypeInfo) {\r\n      return;\r\n    }\r\n    this.deepFirstTraversalEntityTypeInfo(entityTypeInfo, results);\r\n    return results;\r\n  }\r\n  private deepFirstTraversalEntityTypeInfo(entityTypeInfo: DataTypeInfo, result: string[] = [], previousValue: string[] = []) {\r\n    // ç¡®è®¤å½åå®ä½æ¯å¦å¿å¡«\r\n    const isAllowEmpty = this.isAllowEmpty(entityTypeInfo.entityInfo.allowEmpty, previousValue);\r\n    if (isAllowEmpty === false) {\r\n      if (previousValue.length < 1) {\r\n        result.push('');\r\n      } else {\r\n        result.push(previousValue.join('/'));\r\n      }\r\n    }\r\n    // è·åææå­è¡¨\r\n    const list = entityTypeInfo.getPropInfosByGroup(DataPropGroup.List);\r\n    if (list && list.length > 0) {\r\n      list.forEach((propInfo: DataPropInfo) => {\r\n        const typeInfo = propInfo.typeInfo;\r\n        if (typeInfo && typeInfo.entityInfo) {\r\n          previousValue.push(typeInfo.entityInfo.nodeCode);\r\n          this.deepFirstTraversalEntityTypeInfo(typeInfo, result, previousValue);\r\n        }\r\n      });\r\n    }\r\n    // æ²¡æä¸çº§äºï¼æ­¤æ¶åºè¯¥æ¸ç©ºæ¸¸æ ï¼å°æ¶éå°çè·¯å¾æ¾å°ç»æéä¸­\r\n    if (previousValue && previousValue.length > 0) {\r\n      previousValue.pop();\r\n    }\r\n  }\r\n  private isAllowEmpty(value: string | boolean, paths: string[]) {\r\n    if (value === undefined || value === true || value === '') {\r\n      return true;\r\n    }\r\n    // å¼åèå®ä¹äºä¸è½ä¸ºç©ºçè§å\r\n    const frameContexts = this.getFrameContextByBindingPath(paths);\r\n    let caller = this.frameContext.frameComponent;\r\n    if (!frameContexts || frameContexts.length < 1) {\r\n      // å®ä¹äºè§åä½å¯¹åºçFrameæ²¡ææ¸²æ\r\n      console.warn(`ç»å®è·¯å¾ ${paths.join('/')} å®ä¹äºä¸è½ä¸ºç©ºçè§åï¼ä½æ¾ä¸å°è¯¥ç»å®è·¯å¾å¯¹åºçç»ä»¶ãè¯·ç¡®ä¿ç»ä»¶æ¾éä¸å¿å¡«ä¸è´ã`);\r\n    } else {\r\n      caller = frameContexts.pop().frameComponent;\r\n    }\r\n    if (typeof value === 'boolean') {\r\n      return value;\r\n    } else if (typeof value === 'string') {\r\n      value = value.trim().startsWith('return') ? value : `return ${value}`;\r\n      const factory = new Function(`\r\n        var viewModel = this.viewModel;\r\n        var bindingData = this.bindingData;\r\n        var context = this.context;\r\n        ${value}\r\n      `);\r\n      return factory.apply(caller);\r\n    } else {\r\n      console.warn(`æ æçå¿å¡«è§åã`);\r\n    }\r\n  }\r\n  collectValidationErrors(rootViewModel: ViewModel, errors: ValidationError[], namespace: string, filter: boolean = true) {\r\n    if (filter) {\r\n      rootViewModel.verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace !== namespace);\r\n    }\r\n    errors.forEach((validationError: ValidationError) => {\r\n      if (validationError.children && validationError.children.length) {\r\n        this.collectValidationErrors(rootViewModel, validationError.children, namespace, false);\r\n      }\r\n      let id = '';\r\n      const findId = (target: any) => {\r\n        if (target && target.data && target.data.id) {\r\n          id = target.data.id;\r\n          return;\r\n        } else if (target[PARENT_CLASS]) {\r\n          findId(target[PARENT_CLASS]);\r\n        }\r\n      };\r\n      findId(validationError.target);\r\n      if (validationError.constraints) {\r\n        const validationResultTypes = Object.keys(validationError.constraints);\r\n        if (validationResultTypes.length) {\r\n          const offset = rootViewModel.verifyInformations.filter(item => item.namespace === namespace).length;\r\n          let index = rootViewModel.verifyInformations.findIndex(item => item.namespace === namespace);\r\n          index = index === -1 ? 0 : index + offset;\r\n          rootViewModel.verifyInformations.splice(index, 0, {\r\n            id: id,\r\n            namespace,\r\n            targetField: validationError.field,\r\n            index: validationError.index,\r\n            title: validationError.propertyName,\r\n            msg: validationError.constraints[validationResultTypes[0]],\r\n            frameContext: validationError.frameContext,\r\n            fullPath: validationError.fullPath,\r\n            type: validationResultTypes[0] === 'required' ? 'empty' : 'error'\r\n          });\r\n        }\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * éç½®æ ¡éªä¿¡æ¯ï¼ä»å½åè¡¨åï¼\r\n   */\r\n  public resetValidation(): Observable<any> {\r\n    const isDialog = this.isInDialog();\r\n    let rootViewModel = this.frameContext.root.viewModel;\r\n    if (isDialog) {\r\n      rootViewModel = this.frameContext.getVirtualRootFrameContext().viewModel;\r\n    }\r\n    let verifyInformations = rootViewModel.verifyInformations;\r\n    if (verifyInformations.length) {\r\n      const namespace = this.frameContext.namespace;\r\n      if (namespace !== null) {\r\n        verifyInformations = rootViewModel.verifyInformations.filter(item => item.namespace !== namespace);\r\n      }\r\n      rootViewModel.verifyInformations = verifyInformations;\r\n      //rootViewModel.verifyInformations.splice(0, rootViewModel.verifyInformations.length);\r\n    }\r\n    if (rootViewModel && rootViewModel.verifycationChanged) {\r\n      rootViewModel.verifycationChanged.next(verifyInformations);\r\n    }\r\n    return of(null);\r\n  }\r\n  /**\r\n   * æ¯å¦å¨å¼¹çªåé¨\r\n   */\r\n  private isInDialog() {\r\n    return this.frameContext && this.frameContext.getVirtualRootFrameContext() && this.frameContext.getVirtualRootFrameContext().frameComponent && this.frameContext.getVirtualRootFrameContext().frameComponent['isDialogRootComponent'] || false;\r\n  }\r\n  /**\r\n   * æ¥æç¬èªçæ ¡éªæç¤ºæå¡\r\n   */\r\n  private hasOwnVerifyDetailService() {\r\n    return this.frameContext.injector.get<VerifyDetailService>(VerifyDetailService, null) !== this.frameContext.root.appContext.injector.get<VerifyDetailService>(VerifyDetailService, null);;\r\n  }\r\n  /**\r\n   * éè¿bindingPathè·åææå¹éçframeContext\r\n   * @param bindingPath \r\n   * @returns \r\n   */\r\n  private getFrameContextByBindingPath(bindingPaths: string[]): FrameContext[] {\r\n    const bindingPath = bindingPaths.filter(p => p).join('/');\r\n    return this.frameContext.appContext.frameContextManager.getFrameContexts().filter(frameContext => frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPath);\r\n  }\r\n  private get verifyDetailService() {\r\n    return this.frameContext.injector.get<VerifyDetailService>(VerifyDetailService, null, InjectFlags.Self);\r\n  }\r\n  private handleErrorClickEvent() {\r\n    if (this.verifyDetailService && this.verifyDetailService.verifyContainer && this.verifyDetailService.verifyContainer.instance) {\r\n      this.verifyDetailService.verifyContainer.instance.validatorClick.subscribe((item: any) => {\r\n        this.onErrorItemClick(item);\r\n      });\r\n    }\r\n  }\r\n  private onErrorItemClick(item: { frameContext: FrameContext, id: string, targetField: string, fullPath: string } = { frameContext: null, id: null, targetField: null, fullPath: null }) {\r\n    const { frameContext, id, targetField, fullPath } = item;\r\n    const isGridComponent = frameContext && frameContext.frameComponent.isGridComponent || false;\r\n    if (!isGridComponent) {\r\n      if (!targetField) { }\r\n      const elementRef = frameContext.injector.get(ElementRef, null, InjectFlags.Self) || frameContext.injector.get(ElementRef, null);\r\n      VerifyService.focusElement(targetField, elementRef);\r\n      this.verifyDetailService.verifyContainer.instance.showList = false;\r\n    } else {\r\n      // find grid component\r\n      const grid: DatagridComponent = frameContext.componentRefManager.getComponentByType(DatagridComponent);\r\n      if (grid && targetField && id) {\r\n        grid.editCell(id, targetField);\r\n        this.verifyDetailService.verifyContainer.instance.showList = false;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { ValidationService };\r\n","import { BefRepository, BefRepositoryUtil, ResponseInfo } from \"@farris/bef\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { Observable, of } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\n\r\nexport class DataChangeDetectionService {\r\n    public static hasChange(frameContext: FrameContext): Observable<boolean> {\r\n        const befRepository = frameContext && frameContext.repository as BefRepository<any>;\r\n        const hasLocalChanges = BefRepositoryUtil.isExistUnsaveData(befRepository);\r\n        if (hasLocalChanges) {\r\n            return of(true);\r\n        }\r\n        // æ¬å°æ²¡æåæ´ï¼ç¡®è®¤æå¡å¨ç«¯æ¯å¦ææªä¿å­çåæ´\r\n        const virtualRootFrameContext = frameContext && frameContext.getVirtualRootFrameContext();\r\n        const serverSideChangeDetectionEnabled = virtualRootFrameContext && virtualRootFrameContext.enableServerSideChangeDetection;\r\n        if (!serverSideChangeDetectionEnabled) {\r\n            return of(false);\r\n        } else {\r\n            // å¯ç¨äºåç«¯åæ´æ£æµ\r\n            return frameContext.repository.hasChanges().pipe(map((response: ResponseInfo) => {\r\n                return response.returnValue;\r\n            }));\r\n        }\r\n    }\r\n}","import { Injectable, Optional } from '@angular/core';\r\nimport { Entity, BindingData, FrameContext, ViewModel } from '@farris/devkit';\r\nimport { BefRepository, BefRepositoryUtil } from '@farris/bef';\r\nimport { Observable, of, empty, EMPTY, concat, zip, from, Subject } from 'rxjs';\r\nimport { tap, switchMap, concatMap, concatAll, takeLast, last } from 'rxjs/operators';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { EditStateUtil } from './utils/index';\r\nimport { FormNotifyStrategyService } from '../form-notify-strategy.service';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { DataType, WEB_FORM_ROUTE_PARAMS_KEY } from '../types';\r\nimport { CommandService } from '../command-service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { DataChangeDetectionService } from '../data-change-detection.service';\r\n// tslint:disable: no-string-literal\r\n// tslint:disable: max-line-length\r\n/**\r\n * å¡çä»åºæå¡\r\n */\r\n@Injectable()\r\nclass CardDataService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private bindingData: BindingData;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private formMessageService: FormMessageService,\r\n    private frameContext: FrameContext,\r\n    private loadingService: FormLoadingService,\r\n    private formNotifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService,\r\n    private formErrorService: FormErrorService,\r\n    private runtimeFrameworkService: RuntimeFrameworkService,\r\n    private commandService: CommandService\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    this.repository = this.frameContext.repository as BefRepository<Entity>;\r\n    this.bindingData = this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * å è½½æ°æ®\r\n   * @param id ä¸»å®ä½id\r\n   * @param enableChildrenPagination å¯ç¨å­è¡¨åé¡µ\r\n   */\r\n  public load(id: string): Observable<Entity> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    this.frameContext.appContext.params.set(\"retrieveing\", true);\r\n    this.frameContext.appContext.params.delete('queryChild');\r\n    const get$ = this.repository.getById(id);\r\n    return get$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å è½½å\r\n   * @param id id\r\n   * @param transitionActionParamName ç¶æè¿ç§»å¨ä½åæ°ç¼å·\r\n   * @returns\r\n   */\r\n  public onLoading(transitionActionParamName: string) {\r\n    const tabId = this.runtimeFrameworkService && this.runtimeFrameworkService.tabId || null;\r\n    if (!tabId) {\r\n      return;\r\n    }\r\n    let skip = true;\r\n    const listening = this.frameContext.appContext.params.get(tabId) || false;\r\n    transitionActionParamName = transitionActionParamName || 'transitionAction';\r\n    if (!listening) {\r\n      this.frameContext.appContext.params.set(tabId, true);\r\n      this.runtimeFrameworkService.getEntityParam(tabId, (options: any) => {\r\n        if (skip) {\r\n          skip = false;\r\n          return;\r\n        }\r\n        const params = this.parseParams(options);\r\n        if (params && params.sync) {\r\n          const action = params.action;\r\n          const id = params.id;\r\n          const ngCommand = this.frameContext && this.frameContext.viewModel && this.frameContext.viewModel.metadatas && this.frameContext.viewModel.metadatas[action];\r\n          const actionName = ngCommand.params && ngCommand.params[transitionActionParamName] || null;\r\n          const formPrimaryValue = this.frameContext.bindingData.list.currentId;\r\n          const formState = this.frameContext.stateMachine.context.state;\r\n          let state = null;\r\n          let stateName: string;\r\n          if (!actionName) {\r\n            // å¯è½æ¯ç¨æ·èªå·±éç½®çå½ä»¤ï¼æ²¡æç¶ææºåæ¢ï¼æ­¤æ¶ä¸åå¤æ­ç¶ææº\r\n            state = formState;\r\n          }\r\n          else {\r\n            const ngAction = this.frameContext && this.frameContext.stateMachine && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas.actions && this.frameContext.stateMachine.metadatas.actions[actionName];\r\n            state = ngAction && ngAction.transitTo || formState;\r\n            stateName = this.frameContext && this.frameContext.stateMachine && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas && this.frameContext.stateMachine.metadatas.states[state] && this.frameContext.stateMachine.metadatas.states[state].name || this.languageService.defaultStateName;\r\n            if (stateName && stateName.startsWith('{{') && stateName.endsWith('}}')) {\r\n              const key = stateName.replace('{{', '').replace('}}', '');\r\n              stateName = this.frameContext.translate.transform(key, null);\r\n            }\r\n          }\r\n          const primaryValueChanged = formPrimaryValue !== id;\r\n          const stateChanged = formState !== state;\r\n\r\n          if (primaryValueChanged && stateChanged) {\r\n            // ååçåå\r\n            const message = this.languageService.dataAndStateChanged.replace(/\\$1/g, stateName);\r\n            this.showLoadingConfirm(message).pipe(switchMap(() => {\r\n              return this.resetForm(action);\r\n            })).subscribe();\r\n          } else if (primaryValueChanged) {\r\n            // ä¸»é®åçåå\r\n            this.showLoadingConfirm(this.languageService.dataChanged).pipe(switchMap(() => {\r\n              return this.resetForm(action);\r\n            })).subscribe();\r\n          } else if (stateChanged) {\r\n            // ç¶æåçåå\r\n            const message = this.languageService.stateChanged.replace(/\\$1/g, stateName);\r\n            this.showLoadingConfirm(message).pipe(switchMap(() => {\r\n              return this.resetForm(action);\r\n            })).subscribe();\r\n          } else {\r\n            // æ°æ®åç¶æåæªåçåå\r\n            return of(true);\r\n          }\r\n        }\r\n      }, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ°å¢\r\n   */\r\n  public add(): Observable<any> {\r\n    const lastModifiedId = this.bindingData.list.currentId;\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const create$ = this.repository.create();\r\n    return create$.pipe(\r\n      tap(\r\n        () => {\r\n          EditStateUtil.setEditState(this.frameContext, lastModifiedId);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.addFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * çº§èæ°å¢\r\n   */\r\n  public cascadeAdd(): Observable<any> {\r\n    const subject = new Subject<any>();\r\n    // æ¾å°ææviewmodel,æ¿å°äºææçframeContextï¼å¯è½æç»åè¡¨åç\r\n    const frameContexts = this.frameContext.appContext.frameContextManager.getFrameContexts();\r\n    // æ¾å°å½åframeContextçå¬å±namespace\r\n    const currentNamespace = this.frameContext.getVirtualRootFrameContext().namespace;\r\n    // æ¿å°å½åå½ä»¤æå¨frameçè¡¨åçææframeContext\r\n    const currentFormFrameContexts = frameContexts.filter((context: FrameContext) => context.namespace === currentNamespace) || [];\r\n    let bindingPaths = [];\r\n    if (currentFormFrameContexts && currentFormFrameContexts.length > 0) {\r\n      // æ¾å°ææä¸çº§frameContext\r\n      const childFrameContexts = currentFormFrameContexts.filter((context: FrameContext) => context.viewModel.bindingPath && context.viewModel.bindingPath !== '/');\r\n      if (childFrameContexts && childFrameContexts.length > 0) {\r\n        let childBindingPaths = childFrameContexts.map((context: FrameContext) => context.viewModel.bindingPath);\r\n        childBindingPaths = childBindingPaths.filter((item, index) => childBindingPaths.indexOf(item) === index);\r\n        if (childBindingPaths && childBindingPaths.length > 0) {\r\n          bindingPaths = childBindingPaths.map((path) => path.split('/').filter((p) => p)).sort((a, b) => a.length - b.length);\r\n        }\r\n      }\r\n    }\r\n    this.loadingService.show();\r\n    this.repository.create().pipe(\r\n      switchMap((entity: Entity) => {\r\n        const rid = entity.primaryValue;\r\n        if (bindingPaths && bindingPaths.length > 0) {\r\n          return from(bindingPaths).pipe(\r\n            concatMap((bindingPath: Array<any>) => {\r\n              const fpath = this.getPath(this.frameContext.viewModel, '/' + bindingPath.join('/'), rid);\r\n              return this.repository.appendByPath(fpath);\r\n            })\r\n          );\r\n        } else {\r\n          return of(entity);\r\n        }\r\n      })\r\n    ).pipe(last()).subscribe(\r\n      () => {\r\n        this.loadingService.hide();\r\n        subject.next();\r\n      },\r\n      (error: any) => {\r\n        this.loadingService.hide();\r\n        this.formErrorService.exception(this.languageService.addFailed, error);\r\n      });\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * ç¼è¾ï¼æ´æ°æ°æ®å¹¶æ è®°ç¼è¾ç¶æï¼\r\n   */\r\n  public edit(id?: string): Observable<Entity> {\r\n    const update$ = this.update();\r\n    return update$.pipe(\r\n      tap(() => {\r\n        const currentId = this.bindingData.list.currentId\r\n        EditStateUtil.setEditState(this.frameContext, currentId);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ´æ°\r\n   * @param id ä¸»å®ä½id\r\n   * @param enableChildrenPagination å¯ç¨å­è¡¨åé¡µ\r\n   */\r\n  public update(id?: string): Observable<Entity> {\r\n    // è·åid\r\n    id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return empty();\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const update$ = this.repository.updateById(id);\r\n    this.frameContext.appContext.params.set(\"retrieveing\", true);\r\n    return update$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.updateFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  public updateWithoutEmpty() {\r\n    // è·åid\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return of(null);\r\n    } else {\r\n      return this.update();\r\n    }\r\n  }\r\n  /**\r\n   * æ ¡éªå½åè¡æ¯å¦å­å¨\r\n   * @returns\r\n   */\r\n  public checkBeforeUpdate(): Observable<boolean> {\r\n    const bindingList = this.frameContext.bindingData.list;\r\n    const id = bindingList && bindingList.currentId;\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.noDataExist, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * å·²åºå¼\r\n   * @returns\r\n   */\r\n  public updateWithNotify() {\r\n    // è·åid\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.noDataExist, { hideTitle: true });\r\n      return EMPTY;\r\n    } else {\r\n      return this.update();\r\n    }\r\n  }\r\n  /**\r\n   * å è½½å¡çæ°æ®ï¼åé¡µå è½½å­è¡¨æ°æ®ï¼\r\n   * @deprecated æ¹æ³å·²åºå¼ï¼è¯·å¿ä½¿ç¨\r\n   */\r\n  public loadPaged(filter?: string, sort?: string) {\r\n    // è·åid\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    // this.frameContext.root.params.set('updateWithPaging', true);\r\n    const update$ = of(null);//this.repository.updateEntityById(id, true);\r\n    return update$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.updateFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * ä¿å­\r\n   */\r\n  public save(successMsg?: string): Observable<boolean> {\r\n    // è·åå½åè¡\r\n    const id = this.bindingData.list.currentId as string;\r\n    if (!id) {\r\n      return of(false);\r\n    }\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const update$ = this.repository.updateChangesById(id);\r\n    const save$ = this.repository.applyChangesById(id);\r\n    const result$ = update$.pipe(\r\n\r\n      // update$ => save$\r\n      switchMap((updateResult: boolean) => {\r\n        if (updateResult === false) {\r\n          return of(false);\r\n        } else {\r\n          return save$;\r\n        }\r\n      }),\r\n\r\n      // éèloading\r\n      tap(() => {\r\n\r\n        // åæ¶æ°å¢ç¶æ\r\n        EditStateUtil.setEditState(this.frameContext, id);\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n        // this.formNotifyService.info(this.languageService.saveSuccess);\r\n        if (successMsg && successMsg.trim()) {\r\n          let showMessage: boolean = true;\r\n          if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n            try {\r\n              const options = JSON.parse(successMsg);\r\n              if (options.showMessage === false) {\r\n                showMessage = false;\r\n              }\r\n            } catch { }\r\n          }\r\n          if (showMessage !== false) {\r\n            this.formNotifyService.success(successMsg, { hideTitle: true });\r\n          }\r\n        } else {\r\n          FormNotifyStrategyService.success(this.formNotifyService, this.languageService.saveSuccess);\r\n        }\r\n        // FormNotifyStrategyService.success(this.formNotifyService, this.languageService.saveSuccess);\r\n      },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.saveFailed, error);\r\n        }\r\n      )\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n\r\n  // #region åæ¶ç¸å³æ¹æ³\r\n\r\n  /**\r\n   * åæ¶ï¼é»è®¤åæ¶ï¼\r\n   */\r\n  public cancel(): Observable<any> {\r\n    return this.cancelWithCheck();\r\n  }\r\n\r\n  /**\r\n   * è¿ååæ´é\r\n   * @description ä¸å¸¦åæ´æ£æµæç¤º\r\n   */\r\n  public revert(options?: any): Observable<any> {\r\n    return this.cancelWithoutCheck(options);\r\n  }\r\n\r\n  /**\r\n   * åæ¶ï¼åæ¶åæ£æ¥æªä¿å­çåæ´ï¼\r\n   * @summary\r\n   * 1ãç¨æ·è¯¯æä½ï¼åªéè¦åä¸ªæç¤ºå°±å¯ä»¥äºï¼\r\n   * 2ãç¨æ·ææåæ¶ï¼ç¹å»åæ¶å°±æ¯è¦æ¾å¼ææåæ´ï¼è¿æ¶åè¯¢é®äººå®¶æ¯å¦è¦ä¿å­æèæç¤ºå­å¨åæ´æç¹å¤æ­¤ä¸ä¸¾ï¼ç¡®è®¤ä¸æå³å¯ã\r\n   * 3ãç¨æ·è¯¯æä½ï¼æ²¡æåæ´çæåµä¸ç´æ¥ç»åæ¶äºï¼ç¨æ·ä¼äº§çææï¼å ä¸ºç¨æ·ææ¶åå¹¶ä¸ç¡®å®æ¯å¦æåæ´ï¼åºè¯¥ä¹ç¡®è®¤ä¸æã\r\n   * @todo\r\n   * 1ãç±äºäº§åé¨å¾å¤ä»£ç è¯¯ç¨äºè¯¥æ¹æ³ï¼ä¾èµäºæ²¡æåæ´çæ¶åç´æ¥åæ¶ï¼ç°å¨å¼¹çªç¡®è®¤æ¡æ¥ï¼ä¸å¤ªåéï¼\r\n   * 2ãäº§åé¨éè¦ç¨cancelWithoutCheckæ¹æ³ä»£æ¿ï¼ç®ååç»å¼å®¹çï¼å¾å é¤ã\r\n   */\r\n  public cancelWithCheck() {\r\n    const hasChange$ = DataChangeDetectionService.hasChange(this.frameContext);\r\n    return hasChange$.pipe(\r\n      switchMap((changed: boolean) => {\r\n        if (!changed) {\r\n          return this.cancelChanges();\r\n        } else {\r\n          // ç¡®è®¤æ¯å¦åæ¶\r\n          const confirm$ = this.formMessageService.question(this.languageService['cancelWithoutSave']);\r\n          const result$ = confirm$.pipe(\r\n            switchMap((ifCancel: boolean) => {\r\n              if (ifCancel === false) {\r\n                return EMPTY;\r\n              }\r\n              return this.cancelChanges();\r\n            })\r\n          );\r\n          return result$;\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åæ¶ï¼ç´æ¥åæ¶ï¼ä¸æ§è¡æ£æ¥ï¼\r\n   */\r\n  public cancelWithoutCheck(options?: any) {\r\n    return this.cancelChanges(options);\r\n  }\r\n\r\n  /**\r\n   * åæ¶\r\n   */\r\n  private cancelChanges(options?: any): Observable<any> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const cancel$ = this.repository.cancelChanges(options);\r\n    return cancel$.pipe(\r\n      tap(\r\n        () => {\r\n          EditStateUtil.setEditState(this.frameContext, '');\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.cancelFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  /**\r\n   * éæ°å è½½ï¼ä»ä¾å¡çåæ¶åéæ°å è½½æ°æ®ï¼å¶ä»åºæ¯è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public reload() {\r\n    const isAdd = EditStateUtil.getAddState(this.frameContext);\r\n    let id;\r\n    if (isAdd === true) {\r\n      id = EditStateUtil.getLastModifiedId(this.frameContext);\r\n    } else {\r\n      id = this.bindingData.list.currentId as string;\r\n    }\r\n\r\n    if (!id) {\r\n      this.repository.entityCollection.loadEntities([]);\r\n      return;\r\n    }\r\n\r\n    return this.load(id);\r\n  }\r\n  private getPath(viewModel: ViewModel, bindingPath: string, rid: string): string {\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n  private resetForm(action: string) {\r\n    const validationService = this.frameContext.injector.get<ValidationService>(ValidationService, null);\r\n    return this.frameContext.repository.cancelChanges().pipe(\r\n      switchMap(() => this.commandService.execute(action).pipe(switchMap(() => {\r\n        return validationService && validationService.resetValidation() || of(null);\r\n      }))));\r\n  }\r\n  private parseParams(options: any): { action: string, id: string, sync: boolean } | null {\r\n    if (options && Object.prototype.toString.call(options) === DataType.map) {\r\n      let params = options.get(WEB_FORM_ROUTE_PARAMS_KEY);\r\n      if (params && typeof params === 'string') {\r\n        params = decodeURIComponent(params);\r\n        if (params.startsWith('{') && params.endsWith('}')) {\r\n          params = JSON.parse(params);\r\n        }\r\n        return {\r\n          action: params.action,\r\n          id: params.idToView || params.idToEdit || params.id,\r\n          sync: params.sync || false\r\n        };\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  private showLoadingConfirm(message: string) {\r\n    return this.formMessageService.confirm(message).pipe(\r\n      switchMap((result: boolean) => {\r\n        if (result === true) {\r\n          return of(true);\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\nexport { CardDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { EMPTY, Observable, of } from 'rxjs';\r\nimport { switchMap, throwIfEmpty } from 'rxjs/operators';\r\nimport { INSIDE_DIALOG_TOKEN, TAB_EVENT } from './types';\r\nimport { NavigationService } from './navigation.service';\r\nimport { AppContext, FrameContext, Repository, UID } from '@farris/devkit';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { CardDataService } from './data-services/card-data.service';\r\nimport { DataChangeDetectionService } from './data-change-detection.service';\r\n/**\r\n * å¯¼èªä¸­é´ä»¶æå¡\r\n * @scope FrameComponent\r\n */\r\n// tslint:disable: no-string-literal\r\n@Injectable()\r\nexport class NavigationMiddlewareService {\r\n  private repository: Repository<any>;\r\n\r\n  private appContext: AppContext;\r\n  constructor(\r\n    private navigationService: NavigationService,\r\n    private frameContext: FrameContext,\r\n    private msgService: FormMessageService,\r\n    @Optional() private languageService: LanguageService,\r\n    private cardDataService: CardDataService\r\n  ) {\r\n    this.repository = frameContext.repository;\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    if (this.frameContext) {\r\n      this.appContext = this.frameContext.getFormAppContext() || null;\r\n    }\r\n  }\r\n  /**\r\n   * å³é­åå¤ç\r\n   */\r\n  public onClosing() {\r\n    if (this.isInDialog()) {\r\n      return;\r\n    }\r\n    this.navigationService.addEventListener(TAB_EVENT.onTabClosing, (options) => {\r\n      if (!this.frameContext || this.frameContext.isDisposed) {\r\n        return of(true);\r\n      }\r\n      return this.isChanged.pipe(switchMap((changed: boolean) => {\r\n        if (changed && !this.appContext.opened) {\r\n          // å¦æéè¦ç¨æ·ç¡®è®¤å°±åæ¢å°å½åtab\r\n          if (options && options.beforeCloseHandle && typeof options.beforeCloseHandle === 'function') {\r\n            options.beforeCloseHandle({ selectedChange: true });\r\n          }\r\n          const conform = this.msgService.question(this.languageService['exitWithoutSave']);\r\n          /*è®°å½å¼¹çªå·²æå¼*/\r\n          this.appContext.opened = true;\r\n          return conform.pipe(\r\n            switchMap((result: boolean) => {\r\n              this.appContext.opened = false;\r\n              if (result) {\r\n                /*è®°å½ç¨æ·å³é­å¼¹çª*/\r\n                if (!!this.cardDataService) {\r\n                  const revert$ = this.cardDataService.revert(options);\r\n                  return revert$.pipe(\r\n                    switchMap(() => of(result))\r\n                  );\r\n                }\r\n              }\r\n              return of(result);\r\n            })\r\n          );\r\n        } else if (changed && this.appContext.opened) {\r\n          return of(false);\r\n        } else {\r\n          return of(true);\r\n        }\r\n      }));\r\n    });\r\n  }\r\n  /**\r\n   * æ¯å¦å¨æ¯å¼¹çªçªå£å\r\n   */\r\n  private isInDialog() {\r\n    let frameContext = this.frameContext;\r\n    let isDialogRootComponent = frameContext.frameComponent['isDialogRootComponent'] || false;\r\n    while (frameContext.parent !== null && !isDialogRootComponent) {\r\n      frameContext = frameContext.parent;\r\n      isDialogRootComponent = frameContext.frameComponent['isDialogRootComponent'];\r\n    }\r\n    if (!isDialogRootComponent) {\r\n      isDialogRootComponent = this.frameContext.injector.get<boolean>(INSIDE_DIALOG_TOKEN, false);\r\n    }\r\n    return isDialogRootComponent;\r\n  }\r\n  /**\r\n   * è·åtabid,å¦ætargetIdå­å¨åç´æ¥ä½¿ç¨targetId\r\n   * @description å°ç¨æ·è¦æ¥ççæ°æ®idè½¬æ¢ä¸ºè¿è¡æ¡æ¶éè¦çtabId\r\n   * @param params - routeråæ°\r\n   * @param targetId - è¦ç¼è¾/æ¥ççæ°æ®id\r\n   */\r\n  public getTabId(params: string, targetId: string): any {\r\n    if (!!targetId) {\r\n      return targetId;\r\n    }\r\n    let paramsObj: any = null;\r\n    if (!!params && params.startsWith('{') && params.endsWith('}')) {\r\n      paramsObj = JSON.parse(params);\r\n    }\r\n    let paramId = null;\r\n    if (paramsObj && paramsObj.hasOwnProperty('id') && !!paramsObj.id) {\r\n      paramId = paramsObj.id;\r\n    } else {\r\n      paramId = UID.create();\r\n    }\r\n    return paramId;\r\n  }\r\n  /**\r\n   * æ¯å¦ææªä¿å­çåæ´\r\n   */\r\n  private get isChanged(): Observable<boolean> {\r\n    return DataChangeDetectionService.hasChange(this.frameContext).pipe(throwIfEmpty(()=>EMPTY));\r\n  }\r\n}\r\n","/*\r\n * @Author: aalizzwell\r\n * @Date: 2019-08-05 11:48:27\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-08-06 15:01:53\r\n */\r\n\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { EMPTY, of } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { FrameContext, Repository, ViewModel } from '@farris/devkit';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { BefRepositoryUtil, BefRepository } from '@farris/bef';\r\nimport { CommandService } from './command-service';\r\n\r\n// tslint:disable: no-string-literal\r\n/**\r\n * Gridä¸­é´ä»¶æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nexport class GridMiddlewareService {\r\n  private repository: Repository<any>;\r\n\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private msgService: FormMessageService,\r\n    @Optional() private languageService: LanguageService,\r\n    private viewModel: ViewModel,\r\n    private commandService: CommandService\r\n  ) {\r\n    this.repository = this.frameContext.repository;\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n  /**\r\n   * é¡µç åæ¢å\r\n   */\r\n  public onPageChanging() {\r\n    if (this.isChanged) {\r\n      return this.msgService.question(this.languageService['gridDataNotSave']).pipe(\r\n        switchMap((result: boolean) => {\r\n          if (!result) {\r\n            return EMPTY;\r\n          } else {\r\n            return of(true);\r\n          }\r\n        })\r\n      );\r\n    } else {\r\n      return of(true);\r\n    }\r\n  }\r\n  /**\r\n   * è¡¨æ ¼è¿æ»¤\r\n   * @param commandName å½ä»¤åç§°\r\n   * @param frameId frameId\r\n   * @returns \r\n   */\r\n  public filter(commandName: string, frameId: string) {\r\n    const self: any = this;\r\n    let filters = self.context && self.context.eventParam || [];\r\n    if (typeof (filters) === 'string') {\r\n      filters = JSON.parse(filters);\r\n    }\r\n    // æ¥è¯¢æ¶éç½®é¡µç ä¸ºç¬¬ä¸é¡µ\r\n    this.viewModel.frameContext.repository.entityCollection.pageIndex = 1;\r\n    this.viewModel.frameContext.repository.filterConditionManager.setConditions(this.viewModel.bindingPath, filters);\r\n    return this.commandService.execute(commandName, frameId);\r\n  }\r\n  /**\r\n   * æ¯å¦ææªä¿å­çåæ´\r\n   */\r\n  private get isChanged(): boolean {\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    return BefRepositoryUtil.isExistUnsaveData(befRepository);\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\nimport { QuerystringService } from './querystring';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { of, Observable, BehaviorSubject, Subject } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n// tslint:disable: no-string-literal\r\n/**\r\n * åæ°æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class ParamService {\r\n  constructor(\r\n    private querystringService: QuerystringService,\r\n    private runtimeFrameworkService: RuntimeFrameworkService\r\n  ) { }\r\n  /**\r\n   * ééè·åææåæ°\r\n   */\r\n  public get params(): Observable<{ [propName: string]: any }> {\r\n    // åä»hashä¸­è·ååæ°\r\n    const hash = window.location.hash;\r\n    const params = this.querystringService.parse(hash);\r\n    /*\r\n    const appMode = params.appMode;\r\n    // appModeæ²¡æå®ä¹ï¼è®¤ä¸ºæ¯èè¡¨å,appMode = mdi æ spa\r\n    if (typeof appMode === 'undefined' || appMode === null) {\r\n        return of(params);\r\n    }\r\n    // appModeå­å¨ï¼ä½ä¸ºç©ºï¼ä¹è®¤ä¸ºæ¯èè¡¨å\r\n    if (appMode.length < 1) {\r\n        return of(params);\r\n    }\r\n    // æ°è¡¨åï¼ä½¿ç¨iframeæ¨¡å¼\r\n    if (appMode.toLowerCase() === 'mdi') {\r\n        return of(params);\r\n    }\r\n    */\r\n    // è·åtabIdï¼ææ°çæ¬ä¸å®ætabIdï¼å¦æåä¸å°tabIdåè®¤ä¸ºæ¯èè¡¨åï¼ç´æ¥ä»urlè·ååæ°\r\n    const tabId = params.tabId;\r\n    if (!tabId) {\r\n      // throw new Error('TabId can`t be empty!');\r\n      return of(params);\r\n    }\r\n    const subject = new Subject<any>();\r\n    // ç®¡éåæ°eå¯è½ä¸ºobjectãMapç±»å\r\n    this.runtimeFrameworkService.addEventListener(tabId, (e: any) => {\r\n      let map = {};\r\n      if (e instanceof Map || (e && typeof (e['get']) === 'function' && typeof e['entries'] === 'function')) {\r\n        map = this.parseMapParams(e);\r\n      }\r\n      let args = {};\r\n      if (e instanceof Map || (e && typeof (e['get']) === 'function' && typeof e['entries'] === 'function')) {\r\n        args = new Map(e);\r\n      } else {\r\n        args = Object.assign({}, e);\r\n      }\r\n      setTimeout(() => {\r\n        subject.next(Object.assign({}, args, map, params));\r\n      }, 0);\r\n    }, params);\r\n    return subject.asObservable();\r\n  }\r\n  /**\r\n   * è§£æmapç±»åçåæ°\r\n   * @param params params\r\n   */\r\n  private parseMapParams(params: Map<any, any>) {\r\n    const map = {};\r\n    map['WEB_FORM_ROUTE_PARAMS'] = decodeURIComponent(params.get('WEB_FORM_ROUTE_PARAMS'));\r\n    params.forEach((value, key) => {\r\n      if (key !== 'WEB_FORM_ROUTE_PARAMS') {\r\n        map[key] = value;\r\n      }\r\n    });\r\n    return map;\r\n  }\r\n  /**\r\n   * è·åparamåæ°\r\n   * @param param key\r\n   */\r\n  public get(param: string): Observable<any> {\r\n    return this.params.pipe(\r\n      switchMap(options => {\r\n        if (!!options && options.hasOwnProperty(param)) {\r\n          return of(options.param);\r\n        } else {\r\n          return of(undefined);\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * åæ°è½¬ä¸ºå¯¹è±¡\r\n   */\r\n  public parse(): Observable<any> {\r\n    return this.params.pipe(\r\n      switchMap(options => {\r\n        return of(options);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Keybinding, ViewModel } from '@farris/devkit'\r\nimport * as Mousetrap from 'mousetrap';\r\nimport { Observable } from 'rxjs';\r\n\r\nconst enum CharCode {\r\n\r\n  Digit0 = 48,\r\n  Digit1 = 49,\r\n  Digit2 = 50,\r\n  Digit3 = 51,\r\n  Digit4 = 52,\r\n  Digit5 = 53,\r\n  Digit6 = 54,\r\n  Digit7 = 55,\r\n  Digit8 = 56,\r\n  Digit9 = 57,\r\n\r\n  A = 65,\r\n  B = 66,\r\n  C = 67,\r\n  D = 68,\r\n  E = 69,\r\n  F = 70,\r\n  G = 71,\r\n  H = 72,\r\n  I = 73,\r\n  J = 74,\r\n  K = 75,\r\n  L = 76,\r\n  M = 77,\r\n  N = 78,\r\n  O = 79,\r\n  P = 80,\r\n  Q = 81,\r\n  R = 82,\r\n  S = 83,\r\n  T = 84,\r\n  U = 85,\r\n  V = 86,\r\n  W = 87,\r\n  X = 88,\r\n  Y = 89,\r\n  Z = 90,\r\n\r\n  a = 97,\r\n  b = 98,\r\n  c = 99,\r\n  d = 100,\r\n  e = 101,\r\n  f = 102,\r\n  g = 103,\r\n  h = 104,\r\n  i = 105,\r\n  j = 106,\r\n  k = 107,\r\n  l = 108,\r\n  m = 109,\r\n  n = 110,\r\n  o = 111,\r\n  p = 112,\r\n  q = 113,\r\n  r = 114,\r\n  s = 115,\r\n  t = 116,\r\n  u = 117,\r\n  v = 118,\r\n  w = 119,\r\n  x = 120,\r\n  y = 121,\r\n  z = 122\r\n}\r\n\r\n/**\r\n * å¿«æ·é®æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class KeybindingService {\r\n  private keyMap: Map<String, () => Observable<any>>;\r\n  private bindingProvider: Mousetrap;\r\n  private ready: boolean;\r\n\r\n  constructor() {\r\n    this.keyMap = new Map<String, () => Observable<any>>();\r\n    this.bindingProvider = Mousetrap.default;\r\n    this.ready = true;\r\n  }\r\n\r\n  /**\r\n   * å¯¹è§å¾æ¨¡åè®¾ç½®çå¿«æ·é®è¿è¡ç»å®å¤ç\r\n   * @param viewModel è§å¾æ¨¡å\r\n   */\r\n  public bind(viewModel: ViewModel) {\r\n    viewModel.keybindingMap.forEach((keyBinding, method) => {\r\n      this.register(keyBinding, () => {\r\n        return viewModel[method]();\r\n      });\r\n    });\r\n  }\r\n\r\n\t/**\r\n\t * æ³¨åå¿«æ·é®\r\n\t * @param binding é®çç»å®ä¿¡æ¯\r\n\t * @param handler ååºäºä»¶\r\n\t */\r\n  public register(binding: Keybinding, handler: () => Observable<any>) {\r\n    var combo = this._getCombo(binding);\r\n    if (combo) {\r\n      this.keyMap.set(combo, handler);\r\n      if (binding.ctrlKey && binding.altKey && !binding.shiftKey) {\r\n        // å®éåç°ï¼ctrl+altç»åï¼åªè½è§¦åkeyupäºä»¶\r\n        this.bindingProvider.bind(combo, this._dispatch.bind(this), 'keyup');\r\n      } else {\r\n        this.bindingProvider.bind(combo, this._dispatch.bind(this));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åæ¶å¿«æ·é®æ³¨å\r\n   * @param binding é®çç»å®ä¿¡æ¯ \r\n   */\r\n  public unregister(binding: Keybinding) {\r\n    var combo = this._getCombo(binding);\r\n    if (combo) {\r\n      this.keyMap.delete(combo);\r\n      this.bindingProvider.unbind(combo);\r\n    }\r\n  }\r\n\r\n  private _dispatch(e: KeyboardEvent): boolean {\r\n    if (e.repeat) return false;\r\n    if (this.ready) {\r\n      var combo = this._getCombo(e);\r\n      if (combo && this.keyMap.has(combo)) {\r\n        this.ready = false;\r\n        this.keyMap.get(combo)().subscribe(() => {\r\n          this.ready = true;\r\n        }, (error) => {\r\n          this.ready = true;\r\n        }, () => {\r\n          this.ready = true;\r\n        });\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n\t/**\r\n\t * è¿åctrl+shift+alt+aå½¢å¼çç»åå­ç¬¦ä¸²ï¼å¨é¨ä¸ºå°å\r\n\t * @param keyInfo \r\n\t */\r\n  private _getCombo(keyInfo: Keybinding | KeyboardEvent): String | null {\r\n    var key = keyInfo.key.toLowerCase();\r\n    if (key.length != 1 || key.charCodeAt(0) < CharCode.a || key.charCodeAt(0) > CharCode.z) {\r\n      console.warn(\"å¿«æ·é®å­æ¯å½¢å¼ä¸ºa-z\");\r\n      return null;\r\n    }\r\n    var combo = (keyInfo.ctrlKey ? 'ctrl+' : '')\r\n      + (keyInfo.shiftKey ? 'shift+' : '')\r\n      + (keyInfo.altKey ? 'alt+' : '')\r\n      + (keyInfo.metaKey ? 'meta+' : '')\r\n      + key;\r\n\r\n    if (combo.length == 1) {\r\n      console.warn(\"å¿«æ·é®è³å°åå«ä¸ä¸ªModifieré®\");\r\n      return null;\r\n    }\r\n\r\n    return combo;\r\n  }\r\n}","// tslint:disable: max-line-length\r\nimport { Injectable } from '@angular/core';\r\n\r\n/**\r\n * @deprecated å·²åºé¤\r\n */\r\n@Injectable()\r\nclass FilterConditionService {\r\n}\r\nexport { FilterConditionService };\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * UIç¶ææå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass UIStateService {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  getState(componentId: string, stateName: string) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  setState(componentId: string, stateName: string, value: any) {\r\n    throw new Error('Not Implemented');\r\n  }\r\n}\r\n\r\nexport { UIStateService };\r\n","import { Injectable, ElementRef } from '@angular/core';\r\nimport { StateMachine, FrameContext, AppContext } from '@farris/devkit';\r\n// tslint:disable: max-line-length\r\n/**\r\n * ç¶ææºæå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass StateMachineService {\r\n\r\n  constructor(\r\n    private stateMachine: StateMachine\r\n  ) {\r\n    if (this.stateMachine.initialState.name === 'init') {\r\n      window.setTimeout(() => {\r\n        this.initFormState();\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  private _clsDefaultName = 'f-form-state-default';\r\n  private _initLoad = true;\r\n  private _currentFrameContext: any\r\n\r\n  transit(action: string) {\r\n    if (action && typeof this.stateMachine[action] === 'function') {\r\n      this.stateMachine[action]();\r\n      this._currentFrameContext = this['context'] && this['context']['frameContext'];\r\n      if (this._initLoad) {\r\n        this.initFormState();\r\n        this._initLoad = false;\r\n      }\r\n      if (!this._currentFrameContext) {\r\n        return;\r\n      }\r\n      const currentRootFrameContext = this.getCurrentRootFrameContext(this._currentFrameContext);\r\n      if (!!currentRootFrameContext) {\r\n        this.toggleFormState(action, currentRootFrameContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  private getCurrentRootFrameContext(currentFrameContext: FrameContext): FrameContext {\r\n    let currentRootFrameContext: FrameContext;\r\n    this.getAllRootFrameContext().forEach((rootFc: FrameContext) => {\r\n      if (currentFrameContext.namespace === rootFc.namespace) {\r\n        currentRootFrameContext = rootFc;\r\n      }\r\n    })\r\n    return currentRootFrameContext;\r\n  }\r\n\r\n  private getFrameContextManagerMap() {\r\n    if (this.stateMachine && this.stateMachine.frameContext) {\r\n      const appContext = this.stateMachine.frameContext.appContext as AppContext;\r\n      if (appContext) {\r\n        const frameContextManager = appContext.frameContextManager;\r\n        return frameContextManager.getFrameContextMap();\r\n      }\r\n    }\r\n    return null;\r\n    // return this.stateMachine && this.stateMachine.frameContext && this.stateMachine.frameContext.appContext && this.stateMachine.frameContext.appContext.frameContextManager && this.stateMachine.frameContext.appContext.frameContextManager.getFrameContextMap();\r\n  }\r\n\r\n  private getAllRootFrameContext(): any[] {\r\n    const rootFrameContextArr = [];\r\n    const frameContexts = this.getFrameContextManagerMap();\r\n    if (frameContexts) {\r\n      frameContexts.forEach(item => {\r\n        if ((item['namespace'] === '' && item['parent'] === null) || (item['parent'] !== null && item['namespace'] !== item['parent']['namespace'])) {\r\n          rootFrameContextArr.push(item);\r\n        }\r\n      })\r\n    }\r\n    return rootFrameContextArr;\r\n  }\r\n\r\n  private initFormState() {\r\n    if (!this.getFrameContextManagerMap()) {\r\n      return;\r\n    }\r\n    this.getAllRootFrameContext().forEach((rootFc: FrameContext) => {\r\n      const rootComponent = rootFc.injector.get<ElementRef>(ElementRef, null) || null;\r\n      if (!rootComponent || !rootComponent.nativeElement) {\r\n        return;\r\n      }\r\n      if (!rootComponent.nativeElement.className.includes(this._clsDefaultName) && !rootComponent.nativeElement.className.includes('f-form-state-create') && !rootComponent.nativeElement.className.includes('f-form-state-edit')) {\r\n        this.addCssClass(rootComponent, this._clsDefaultName);\r\n      }\r\n    })\r\n  }\r\n\r\n  private toggleFormState(action: string, frameContext: FrameContext) {\r\n    const rootComponent = frameContext.injector.get<ElementRef>(ElementRef, null) || null;\r\n    if (!rootComponent || !rootComponent.nativeElement || !action) {\r\n      return;\r\n    }\r\n    action = action.toLowerCase();\r\n    if (action && ['create', 'edit'].includes(action)) {\r\n      if (action === 'create') {\r\n        this.addCssClass(rootComponent, 'f-form-state-create');\r\n      } else if (action === 'edit') {\r\n        this.addCssClass(rootComponent, 'f-form-state-edit');\r\n      }\r\n      this.removeCssClass(rootComponent, this._clsDefaultName);\r\n    } else {\r\n      ['f-form-state-create', 'f-form-state-edit'].forEach(item => this.removeCssClass(rootComponent, item));\r\n      this.addCssClass(rootComponent, this._clsDefaultName);\r\n    }\r\n  }\r\n  private addCssClass(elementRef: ElementRef, className: string) {\r\n    if (!elementRef || !className || !elementRef.nativeElement) {\r\n      return;\r\n    }\r\n    const originalClassName: string = elementRef.nativeElement.className || '';\r\n    if (!originalClassName.includes(className)) {\r\n      elementRef.nativeElement.className = `${originalClassName} ${className}`;\r\n    }\r\n  }\r\n  private removeCssClass(elementRef: ElementRef, className: string) {\r\n    if (!elementRef || !className || !elementRef.nativeElement) {\r\n      return;\r\n    }\r\n    const originalClassName: string = elementRef.nativeElement.className || '';\r\n    if (originalClassName.includes(className)) {\r\n      elementRef.nativeElement.className = originalClassName.split(' ').filter(p => p && p !== className).join(' ');\r\n    }\r\n  }\r\n  private getFormRootComponent() {\r\n    if (this.stateMachine && this.stateMachine.frameContext) {\r\n      const viewContext = this.stateMachine.frameContext;\r\n      if (viewContext) {\r\n        const virtualRootContext = viewContext.getVirtualRootFrameContext();\r\n        if (virtualRootContext) {\r\n          const injector = virtualRootContext.injector;\r\n          if (typeof injector.get === 'function') {\r\n            return injector.get<ElementRef>(ElementRef, null);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n    // return this.stateMachine && this.stateMachine.frameContext && this.stateMachine.frameContext.getVirtualRootFrameContext() && this.stateMachine.frameContext.getVirtualRootFrameContext().injector && typeof this.stateMachine.frameContext.getVirtualRootFrameContext().injector.get === 'function' && this.stateMachine.frameContext.getVirtualRootFrameContext().injector.get<ElementRef>(ElementRef, null) || null;\r\n  }\r\n}\r\n\r\nexport { StateMachineService };\r\n","import { Injectable } from '@angular/core';\r\nimport { AppContext, BindingData, FrameContext } from '@farris/devkit';\r\n\r\n/**\r\n * å®ä½æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass BindingDataService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private bindingData: BindingData,\r\n    private appContext: AppContext\r\n  ) { }\r\n\r\n  /**\r\n   * è®¾ç½®å½åæ¡æ¶çå½åè¡\r\n   */\r\n  setCurrentId(id: string, frameId: string) {\r\n    // let bindingData = this.bindingData;\r\n    // if (frameId) {\r\n    //   const targetContext = this.appContext.getFrameContext(frameId);\r\n    //   bindingData = targetContext.bindingData;\r\n    // }\r\n    // bindingData.list.setCurrentId(id);\r\n\r\n    // @todoï¼å¨é¨éæ°è®¾ç½®ä¸é\r\n    const frameContexts = Array.from(this.appContext.getAllFrameContexts().values());\r\n    frameContexts.forEach((frameContext: FrameContext) => {\r\n      const bindingData = frameContext.bindingData;\r\n      bindingData.list.setCurrentId(id, true, false);\r\n    });\r\n  }\r\n  public setCurrentRow(id: string, frameId: string) {\r\n    let bindingData = this.bindingData;\r\n    if (frameId) {\r\n      const targetContext = this.appContext.getFrameContext(frameId);\r\n      bindingData = targetContext.bindingData;\r\n    }\r\n    bindingData.getList().setCurrentId(id);\r\n  }\r\n}\r\n\r\nexport { BindingDataService };\r\n","import { ActivatedRoute, ParamMap } from '@angular/router';\r\nimport { take } from 'rxjs/operators';\r\nimport { FrameworkService } from '@gsp-sys/rtf-common';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { ParamService } from './param.service';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { isObservable } from 'rxjs';\r\n\r\n/**\r\n * åºç¨åæ°æå¡\r\n * @scope FormModule\r\n */\r\n\r\n@Injectable()\r\nexport class ApplicationParamService {\r\n  private params: any;\r\n  constructor(\r\n    @Optional() private paramService: ParamService,\r\n    @Optional() private runtimeFrameworkService: RuntimeFrameworkService,\r\n  ) {\r\n    if (!this.runtimeFrameworkService) {\r\n      this.runtimeFrameworkService = new RuntimeFrameworkService();\r\n    }\r\n  }\r\n  /**\r\n   * è§£æåæ°\r\n   */\r\n  public parseParams(route: ActivatedRoute, frameworkService: FrameworkService, viewModel: ViewModel, callback: () => void) {\r\n    const highOrderInvoke = this.highOrderInvoke(callback);\r\n    if (!this.paramService) {\r\n      route.queryParams.pipe(take(1)).subscribe((params: any) => {\r\n        this.params = params;\r\n        this.setupParams(params, frameworkService, viewModel, highOrderInvoke);\r\n      });\r\n    } else {\r\n      this.paramService.parse().pipe(take(1)).subscribe(params => {\r\n        this.params = params;\r\n        this.setupParams(params, frameworkService, viewModel, highOrderInvoke);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®åæ°\r\n   */\r\n  private setupParams(params, frameworkService: FrameworkService, viewModel: ViewModel, callback: () => void) {\r\n    if (viewModel && viewModel.frameContext && viewModel.frameContext.appContext && params.tabId) {\r\n      viewModel.frameContext.appContext.tabId = params.tabId;\r\n    }\r\n    const queryParams = this.getParams(params);\r\n    if (!queryParams) {\r\n      callback();\r\n      return;\r\n    }\r\n\r\n    // åè®¾ç½®åæ°ï¼ä¿è¯æ®éè·¯ç±ä¹è½æ­£å¸¸æ§è¡ã\r\n    this.setQueryParams(queryParams, viewModel);\r\n\r\n    const funcId = this.getFuncId(queryParams);\r\n    const appId = this.getAppId(queryParams);\r\n    if (!funcId && !appId) {\r\n      callback();\r\n      return;\r\n    }\r\n\r\n    if (funcId) {\r\n      this.setStaticParams(funcId, queryParams, frameworkService, viewModel, callback);\r\n    } else {\r\n      callback();\r\n    }\r\n  }\r\n  /**\r\n   * è®¾ç½®æ¥è¯¢åæ°\r\n   */\r\n  private setQueryParams(queryParams: any, viewModel: ViewModel): any {\r\n    const parsedQueryParams = {};\r\n    // è®¾ç½®è¡¨ååæ°\r\n    // é¦åå¤æ­æ¯å¦ä¸ºå¼¹çª\r\n    const isInDialog = this.isInDialog(viewModel);\r\n    const uiState = viewModel && viewModel.uiState && viewModel.uiState.innerData || {};\r\n    // å¦ææ¯å¼¹çªï¼å¼¹çªå¤çåæ°ï¼æ è®ºè¡¨ååæ°æéæåæ°ï¼ä¸åºè¯¥è¦çå¼¹çªçåæ°ãå¼¹çªæå¼æ¶ä¼ éçåæ°ç¸å½äºå±é¨åéï¼ä¸åºè¢«è¦ç\r\n    Object.keys(queryParams).forEach((paramName: string) => {\r\n      if (!isInDialog) {\r\n        parsedQueryParams[paramName] = queryParams[paramName];\r\n      } else {\r\n        if (!uiState.hasOwnProperty(paramName)) {\r\n          parsedQueryParams[paramName] = queryParams[paramName];\r\n        }\r\n      }\r\n    });\r\n    this.updateUIState(viewModel, parsedQueryParams);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®éæåæ°\r\n   */\r\n  private setStaticParams(\r\n    funcId: string, queryParams: any, frameworkService: FrameworkService, viewModel: ViewModel, callback: () => void\r\n  ) {\r\n    this.runtimeFrameworkService.getMenuParams(funcId, (staicParams) => {\r\n      const staticParamsObj = this.mapStaticParamsToObject(staicParams, queryParams, viewModel);\r\n      if (!staticParamsObj) {\r\n        callback();\r\n        return;\r\n      }\r\n      this.updateUIState(viewModel, staticParamsObj);\r\n      callback();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å°staticParamsè½¬æ¢ä¸ºæ®éå¯¹è±¡\r\n   * @param staticParamsï¼å½¢å¦ï¼[{'name': 'key1', 'value': 'val1'}, {'name': 'key2', 'value': 'val2'}]\r\n   * @return å½¢å¦ï¼{key1: val1, key2: value2 }\r\n   */\r\n  private mapStaticParamsToObject(staticParams: Map<any, any>, queryParams: any, viewModel?: ViewModel): any {\r\n    if (!staticParams) {\r\n      return;\r\n    }\r\n    const inDialog = this.isInDialog(viewModel);\r\n    const uiState = viewModel && viewModel.uiState && viewModel.uiState.innerData || {};\r\n    const result = {};\r\n    staticParams.forEach((value, key, map) => {\r\n      if (!inDialog) {\r\n        // éæåæ°ä¸è½è¦çæ¥è¯¢åæ°\r\n        if (!queryParams.hasOwnProperty(key)) {\r\n          result[key] = value;\r\n        }\r\n      } else {\r\n        if (!queryParams.hasOwnProperty(key) && !uiState.hasOwnProperty(key)) {\r\n          result[key] = value;\r\n        }\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  /**\r\n   * æ¯å¦å¨å¼¹çªå\r\n   * @param viewModel viewmodel\r\n   */\r\n  private isInDialog(viewModel: ViewModel) {\r\n    let isInDialog = false;\r\n    if (viewModel && viewModel.uiState) {\r\n      // tslint:disable-next-line: max-line-length\r\n      if (viewModel.uiState.innerData && viewModel.uiState.innerData.hasOwnProperty('DEVKIT_DIALOG') || viewModel.uiState['DEVKIT_DIALOG']) {\r\n        isInDialog = true;\r\n      }\r\n    }\r\n    return isInDialog;\r\n  }\r\n  /**\r\n   * æ´æ°UIState\r\n   */\r\n  private updateUIState(viewModel: ViewModel, params: any) {\r\n    if (!viewModel || !params) {\r\n      return;\r\n    }\r\n    const uiState = viewModel.uiState;\r\n\r\n    // å¼å®¹ä½¿ç¨stringä¼ éparamså¯¹è±¡çåºæ¯\r\n    if (typeof params === 'string' && params !== '') {\r\n      params = JSON.parse(params);\r\n    }\r\n\r\n    // å¨UIStateä¸ºåæ°åå»ºå±æ§\r\n    Object.keys(params).forEach((propName: string) => {\r\n      uiState.setPropertyValue(propName, params[propName]);\r\n      if (propName && propName === 'union_session') {\r\n        let sessionInfo = params[propName];\r\n        this.setSessionInfo(viewModel, sessionInfo);\r\n      }\r\n    });\r\n  }\r\n  private setSessionInfo(viewModel: ViewModel, sessionInfo: any) {\r\n    if (!viewModel || !sessionInfo) {\r\n      return;\r\n    }\r\n    if (sessionInfo && typeof sessionInfo === 'string' && sessionInfo.startsWith('{') && sessionInfo.endsWith('}')) {\r\n      sessionInfo = JSON.parse(sessionInfo);\r\n    }\r\n    const token = sessionInfo && sessionInfo.token || null;\r\n    const sessionId = sessionInfo && sessionInfo.sessionId || null;\r\n    if (token) {\r\n      viewModel.frameContext.appContext.Token = token;\r\n    }\r\n    if (sessionId) {\r\n      const befRepository = viewModel.frameContext.repository as BefRepository<any>;\r\n      if (befRepository) {\r\n        befRepository.restService.sessionService.setBeSessionId(sessionId);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·ååè½èåid\r\n   */\r\n  private getFuncId(queryParams: any): any {\r\n    if (!queryParams) {\r\n      return;\r\n    }\r\n    return queryParams['funcId'];\r\n  }\r\n\r\n  /**\r\n   * è·ååºç¨id\r\n   */\r\n  private getAppId(queryParams: any): any {\r\n    if (!queryParams) {\r\n      return;\r\n    }\r\n    return queryParams['appId'];\r\n  }\r\n  private getTabId(queryParams: any) {\r\n    if (!queryParams) {\r\n      return;\r\n    }\r\n    return queryParams['tabId'];\r\n  }\r\n  /**\r\n   * è·åurlåæ°å¯¹è±¡\r\n   * @param queryParams urlåæ°\r\n   */\r\n  private getParams(queryParams: any): { [propName: string]: any } {\r\n    if (!queryParams) {\r\n      return {};\r\n    }\r\n    let result = {};\r\n    if (queryParams.hasOwnProperty('WEB_FORM_ROUTE_PARAMS')) {\r\n      let webFormRouteParams: string = queryParams['WEB_FORM_ROUTE_PARAMS'];\r\n      if (webFormRouteParams && webFormRouteParams.startsWith('{') && webFormRouteParams.endsWith('}')) {\r\n        webFormRouteParams = decodeURI(encodeURI(webFormRouteParams).replace(/%0A/g, '\\\\n').replace(/%09/g, '\\\\t').replace(/%0D/g, '\\\\r'));\r\n        result = JSON.parse(webFormRouteParams);\r\n      }\r\n      Object.keys(queryParams).forEach(prop => {\r\n        if (prop !== 'WEB_FORM_ROUTE_PARAMS') {\r\n          result[prop] = queryParams[prop];\r\n        }\r\n      });\r\n      return result;\r\n    }\r\n    return queryParams;\r\n  }\r\n  private highOrderInvoke(callback) {\r\n    return () => {\r\n      try {\r\n        const queryParams = this.getParams(this.params);\r\n        const tabId = this.getTabId(queryParams);\r\n        if (tabId) {\r\n          const controlEvent = this.runtimeFrameworkService.getMenuSwitchControlEvent();\r\n          if (controlEvent && isObservable(controlEvent)) {\r\n            controlEvent.subscribe((event: any) => {\r\n              if (event) {\r\n                event.next('ok');\r\n              }\r\n            });\r\n          }\r\n        }\r\n      } catch (e) { console.warn(e); }\r\n      if (callback && typeof callback === 'function') {\r\n        callback();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, BindingData, BindingList, BindingObject } from '@farris/devkit';\r\n\r\n/**\r\n * å®ä½éåæå¡\r\n * @todo\r\n * å®ä½å±æ²¡æå°è£ç¸å³æ¹æ³ï¼ä¸´æ¶éè¿BindingDataæ¥è·åæ°æ®\r\n */\r\n@Injectable()\r\nclass EntityTraversingService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n  }\r\n\r\n  /**\r\n   * è·åå¼\r\n   */\r\n  public getPropValue(path: string[]): any {\r\n    return this.bindingData.getValue(path);\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä½æ°æ®\r\n   */\r\n  public getEntityData(path: string[]): any {\r\n    let bindingObj: BindingObject;\r\n    const bindingListOrObject = this.bindingData.getValue(path);\r\n    if (bindingListOrObject instanceof BindingList === true) {\r\n      bindingObj = bindingListOrObject.currentItem;\r\n    } else {\r\n      bindingObj = bindingListOrObject;\r\n    }\r\n    return bindingObj.toJSON();\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä½åè¡¨æ°æ®\r\n   */\r\n  public getEntityListData(path: string[]): any[] {\r\n    const bindingList = this.bindingData.getValue(path) as BindingList;\r\n    return bindingList.toJSON();\r\n  }\r\n\r\n}\r\n\r\nexport { EntityTraversingService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, BindingData } from '@farris/devkit';\r\n\r\n@Injectable()\r\nclass EntityManipulationService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçå­æ®µå¼\r\n   */\r\n  public setPropValue(path: string[], value: any): any {\r\n\r\n    // å®ä½å±è¿æ²¡æå°è£ï¼ä¸´æ¶ç¨BindingDataç¸å³æ¹æ³ä»£æ¿\r\n    this.bindingData.setValue(path, value, true, true);\r\n  }\r\n\r\n}\r\n\r\nexport { EntityManipulationService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, BindingData, BindingList, BindingObject } from '@farris/devkit';\r\nimport { EntityTraversingService } from './entity-traversing.service';\r\n\r\ninterface SplitedPath {\r\n  listPath: string[];\r\n  propPath: string[];\r\n}\r\n\r\n/**\r\n * å®ä½èåæå¡\r\n */\r\n@Injectable()\r\nclass EntityAggregationService {\r\n\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  private traversingService: EntityTraversingService;\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n    this.traversingService   = this.frameContext.injector.get<EntityTraversingService>(EntityTraversingService);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºåè¡¨è®°å½çæ¡æ°\r\n   */\r\n  public count(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n    return entityListData.length;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçå\r\n   */\r\n  public sum(path: string[]) {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const total = entityListData.reduce((accTotal: number, entityData: any) => {\r\n      let propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      propValue = isNaN(propValue) ? 0 : propValue;\r\n      accTotal += propValue;\r\n      return accTotal;\r\n    }, 0);\r\n    return total;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçå¹³åå¼\r\n   */\r\n  public avg(path: string[]) {\r\n    const count = this.count(path);\r\n    const total = this.sum(path);\r\n    return count !== 0 ? total / count : 0;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçæå¤§å¼\r\n   */\r\n  public max(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const max =  entityListData.reduce((accMax: number, entityData: any) => {\r\n      const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      if (isNaN(propValue) === false && ( !accMax || propValue > accMax)) {\r\n        accMax = propValue;\r\n      }\r\n      return accMax;\r\n    }, null);\r\n    return max ? max : 0;\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå­æ®µçæå°å¼\r\n   */\r\n  public min(path: string[]): number {\r\n    const splitedPath = this.splitPath(path);\r\n    const entityListData = this.traversingService.getEntityListData(splitedPath.listPath);\r\n\r\n    const min = entityListData.reduce((accMin: number, entityData: any) => {\r\n      const propValue = parseFloat(this.getPropValue(entityData, splitedPath.propPath));\r\n      if (isNaN(propValue) === false && ( !accMin || propValue < accMin)) {\r\n        accMin = propValue;\r\n      }\r\n      return accMin;\r\n    }, null);\r\n    return min ? min : 0;\r\n  }\r\n\r\n  /**\r\n   * è·åå±æ§å¼\r\n   */\r\n  private getPropValue(entityData: any, path: string[]) {\r\n    let currentData = entityData;\r\n    path.forEach((pathItem: string) => {\r\n\r\n      // æåéåºçé½éç½®ä¸ºnullï¼ä¸»è¦éå¯¹å³èå¯¹è±¡æªèµå¼åºæ¯\r\n      if (!currentData) {\r\n        currentData = null;\r\n        return;\r\n      }\r\n      currentData = currentData[pathItem];\r\n    });\r\n\r\n    return currentData;\r\n  }\r\n\r\n  /**\r\n   * åéè·¯å¾ï¼åéç¬¦åè¡¨è·¯å¾åå±æ§è·¯å¾\r\n   * @return å½¢å¦ {parentListPath: [], propertyPath: []}\r\n   */\r\n  private splitPath(path: string[]): SplitedPath {\r\n    const listPath = path.concat([]);\r\n    const propPath = [];\r\n    let currentNode = this.bindingData.getValue(listPath);\r\n    while (currentNode instanceof BindingList !== true) {\r\n      const propPathItem = listPath.pop();\r\n      if (!propPathItem) {\r\n        return;\r\n      }\r\n      propPath.unshift(propPathItem);\r\n      currentNode = this.bindingData.getValue(listPath);\r\n    }\r\n\r\n    return {\r\n      listPath: listPath,\r\n      propPath: propPath\r\n    };\r\n  }\r\n\r\n}\r\n\r\nexport { EntityAggregationService };\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-29 19:07:30 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-05-29 19:31:19\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport { BindingData } from '@farris/devkit';\r\n\r\n/**\r\n * EntityListæå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass EntityListService {\r\n\r\n  constructor(private bindingData: BindingData) {}\r\n\r\n    /**\r\n     * è·åå½åé¡µç \r\n     */\r\n    public get pageIndex() {\r\n        return this.bindingData.list.pageIndex;\r\n    }\r\n\r\n    /**\r\n     * è·åå½ååé¡µå¤§å°\r\n     */\r\n    public get pageSize() {\r\n        return this.bindingData.list.pageSize;\r\n    }\r\n}\r\n\r\nexport { EntityListService };\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { EntityTraversingService } from './entity-traversing.service';\r\nimport { EntityManipulationService } from './entity-manipulation.service';\r\nimport { EntityAggregationService} from './entity-aggregation.service';\r\n\r\n/**\r\n * å®ä½æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass EntityService {\r\n\r\n  private traversingService: EntityTraversingService;\r\n\r\n  private manipulationService: EntityManipulationService;\r\n\r\n  private aggregationService: EntityAggregationService;\r\n\r\n  constructor(private frameContext: FrameContext) {\r\n    const injector = this.frameContext.injector;\r\n    this.traversingService   = injector.get<EntityTraversingService>(EntityTraversingService);\r\n    this.manipulationService = injector.get<EntityManipulationService>(EntityManipulationService);\r\n    this.aggregationService  = injector.get<EntityAggregationService>(EntityAggregationService);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºçå±æ§å¼\r\n   */\r\n  public getPropValue(path: string[]): any {\r\n    return this.traversingService.getPropValue(path);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçå±æ§å¼\r\n   */\r\n  public setPropValue(path: string[], value: any): void {\r\n    return this.manipulationService.setPropValue(path, value);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçEntityæ°æ®\r\n   */\r\n  public getEntityData(path: string[]): any {\r\n    return this.traversingService.getEntityData(path);\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®pathå¯¹åºçEntityListæ°æ®\r\n   */\r\n  public getEntityListData(path: string[]): any {\r\n    return this.traversingService.getEntityListData(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºEntityListè®°å½æ°\r\n   */\r\n  public count(path: string[]): number {\r\n    return this.aggregationService.count(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çåè®¡å¼\r\n   */\r\n  public sum(path: string[]): number {\r\n    return this.aggregationService.sum(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çå¹³åå¼\r\n   */\r\n  public avg(path: string[]): number {\r\n    return this.aggregationService.avg(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çæå¤§å¼\r\n   */\r\n  public max(path: string[]): number {\r\n    return this.aggregationService.max(path);\r\n  }\r\n\r\n  /**\r\n   * è·åpathå¯¹åºå±æ§çæå°å¼\r\n   */\r\n  public min(path: string[]): number {\r\n    return this.aggregationService.min(path);\r\n  }\r\n}\r\n\r\nexport { EntityService };\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, DataTypeInfo, Entity, FrameContext, Repository } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class BindingPathService {\r\n  constructor(private injector: Injector, private appContext: AppContext, private repository: Repository<Entity>) { }\r\n  /**\r\n   * è·åç»ä»¶ä¸ä¸æçç»å®è·¯å¾\r\n   * @param frameContext ç»ä»¶ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public getBindingPathsByFrameContext(frameContext: FrameContext): string[] {\r\n    return frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath && frameContext.viewModel.bindingPath.split('/').filter(p => p) || null;\r\n  }\r\n  /**\r\n   * éè¿BEè¡¨åè·åbindingPath\r\n   * @param dataTypeInfo \r\n   * @param tableName \r\n   * @param paths \r\n   * @param level\r\n   * @returns \r\n   */\r\n  public getBindingPathsByTableName(dataTypeInfo: DataTypeInfo, tableName: string, paths: string[] = [], level: number = 0): string[] {\r\n    level++;\r\n    if (dataTypeInfo.entityInfo && (dataTypeInfo.entityInfo.nodeCode === tableName || dataTypeInfo.entityInfo.originalCode === tableName)) {\r\n      if (level !== 1) {\r\n        paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n      }\r\n      return paths;\r\n    }\r\n    const props = Array.from(dataTypeInfo.propInfoMap.values()).filter(p => p.typeInfo);\r\n    if (props.length < 1) {\r\n      paths = [];\r\n      return paths;\r\n    }\r\n    if (dataTypeInfo.entityInfo) {\r\n      if (level !== 1) {\r\n        paths.push(dataTypeInfo.entityInfo.nodeCode);\r\n      }\r\n    }\r\n\r\n    for (let idx = 0; idx < props.length; idx++) {\r\n      const dataTypeInfo = props[idx].typeInfo;\r\n      const path = this.getBindingPathsByTableName(dataTypeInfo, tableName, paths, level);\r\n      if (!path || path.length < 1) {\r\n        continue;\r\n      } else {\r\n        paths = paths.concat(path);\r\n        return paths;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * è·åå±æ§è·¯å¾ä¸­çç»å®è·¯å¾\r\n   * @param paths paths\r\n   * @param entityTypeInfo \r\n   * @returns \r\n   */\r\n  public getBindingPathsByPath(paths: string[] | string, entityTypeInfo: DataTypeInfo): string[] {\r\n    let nodeCodes = [];\r\n    if (typeof paths === 'string') {\r\n      paths = paths.split('/').filter(p => p);\r\n    }\r\n    paths = paths.concat([]);\r\n    while (paths.length > 0) {\r\n      const dataPropInfo = entityTypeInfo.getPropInfoByPath(paths);\r\n      if (dataPropInfo.group === 'List') {\r\n        nodeCodes = paths;\r\n        break;\r\n      }\r\n      paths.pop();\r\n    }\r\n    return nodeCodes;\r\n  }\r\n  /**\r\n   * è·åå±æ§è·¯å¾ä¿¡æ¯\r\n   * @param path å±æ§è·¯å¾\r\n   * @returns \r\n   */\r\n  public getPathInfo(path: string): { bindingPath: string, propertyName: string, bindingPaths: string[], propertyNames: string[] } {\r\n    const paths = path.split('/').filter(p => p);\r\n    // è·åæå¤§å®ä½å±çº§ï¼å¶ä½ä¸ºå±æ§ï¼ç®åå±æ§ãudtãå³èãå³èåµå¥å³èï¼\r\n    const entityPath = this.getBindingPathsByPath(paths, this.repository.entityTypeInfo);\r\n    const propertyName = paths.slice(entityPath.length).join('/');\r\n    return { bindingPath: entityPath.join('/'), propertyName, bindingPaths: entityPath, propertyNames: propertyName.split('/').filter(p => p) };\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { FrameContext, NgFormControl } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class FormControlService {\r\n  constructor() { }\r\n  public getFormControlsByFrameContext(frameContext: FrameContext): { [propertyName: string]: NgFormControl } | null {\r\n    return frameContext && frameContext.form && frameContext.form.ngFormControls || null;\r\n  }\r\n  /**\r\n   * éè¿bindingåæ°æ®è·åNgFormControl\r\n   * @param frameContext \r\n   * @param binding binding\r\n   * @returns \r\n   */\r\n  public getFormControlByBinding(frameContext: FrameContext, binding: string): NgFormControl {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    return Object.values(ngFormControls).find((ngFormControl: NgFormControl) => ngFormControl && ngFormControl.binding === binding);\r\n\r\n  }\r\n  /**\r\n   * \r\n   * @param frameContext frameContext\r\n   * @param fullPath \r\n   * @returns \r\n   */\r\n  public getFormControlIndexByFullPath(frameContext: FrameContext, fullPath: string): number {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    const bindings = fullPath.split('/').filter(p => p);\r\n    return Object.values(ngFormControls).findIndex((ngFormControl: NgFormControl) => {\r\n      if (!ngFormControl) {\r\n        return false;\r\n      }\r\n      const bindingPath = frameContext.viewModel.bindingPath;\r\n      const bindingPaths = bindingPath.split('/').filter(p => p);\r\n      const formControlBindingPaths = ngFormControl.binding.split('.').filter(p => p);\r\n      const fullPath = bindingPaths.concat(formControlBindingPaths);\r\n      return fullPath.join('/') === bindings.join('/');\r\n    });\r\n  }\r\n  /**\r\n   * éè¿bindingåæ°æ®è·åNgFormControlä½ç½®\r\n   * @param frameContext \r\n   * @param binding binding\r\n   * @returns ä»0å¼å§\r\n   */\r\n  public getFormControlIndexByBinding(frameContext: FrameContext, binding: string): number {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    return Object.values(ngFormControls).findIndex((ngFormControl: NgFormControl) => ngFormControl && ngFormControl.binding === binding);\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, DataPropInfo, Entity, FrameContext, Repository } from \"@farris/devkit\";\r\nimport { BindingPathService } from \"./binding-path.service\";\r\nimport { FormControlService } from './form-control.service';\r\n\r\n@Injectable()\r\nexport class FrameContextService {\r\n  constructor(\r\n    private injector: Injector, \r\n    private appContext: AppContext, \r\n    private frameContext: FrameContext, \r\n    private repository: Repository<Entity>,\r\n    private bindingPathService: BindingPathService,\r\n    private formControlService: FormControlService\r\n    ) { }\r\n  /**\r\n     * éè¿BEè¡¨åè·åå¯¹åºçframeContext\r\n     * @param tableName \r\n     * @returns \r\n     */\r\n  public getFrameContextsByTableName(tableName: string): null | FrameContext[] {\r\n    if (!tableName) {\r\n      throw new Error('tableName ä¸è½ä¸ºç©ºã');\r\n    }\r\n    const dataTypeInfo = this.repository && this.repository.entityTypeInfo || null;\r\n    if (!dataTypeInfo) {\r\n      return null;\r\n    }\r\n    const bindingPaths = [];\r\n    this.bindingPathService.getBindingPathsByTableName(dataTypeInfo, tableName, bindingPaths);\r\n    const frameContexts = this.appContext && this.appContext.frameContextManager.getFrameContexts() || [];\r\n    if (!frameContexts || frameContexts.length === 0) {\r\n      return null;\r\n    }\r\n    return frameContexts.filter((frameContext: FrameContext) => frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).join('/') === bindingPaths.join('/'));\r\n  }\r\n  /**\r\n   * æ ¹æ®å­æ®µå®æ´è·¯å¾è·åæå¨çä¸ä¸æ\r\n   * @param propertyPath \r\n   * @param separtor \r\n   * @returns \r\n   */\r\n  public getFrameContextsByPropertyPath(propertyPath: string, separtor: string = '/'): FrameContext[] {\r\n    if (!propertyPath) {\r\n      throw new Error('propertyPath ä¸è½ä¸ºç©ºã');\r\n    }\r\n    const frameContexts = this.appContext && this.appContext.frameContextManager.getFrameContexts() || [];\r\n    return frameContexts.filter((frameContext: FrameContext) => {\r\n      const formControls = frameContext && frameContext.form && frameContext.form.ngFormControls || {};\r\n      const bindingPath = frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath || '';\r\n      if (formControls && Object.keys(formControls).length > 0) {\r\n        const key = Object.keys(formControls).find((key: string) => {\r\n          const formControl = formControls[key];\r\n          if (!formControl || !formControl.binding) {\r\n            return false;\r\n          }\r\n          const bindings = formControl.binding.split('.').filter(p => p);\r\n          const bindingPaths = bindingPath.split('/').filter(p => p);\r\n          const fullPath = bindingPaths.concat(bindings);\r\n          return propertyPath.split(separtor).filter(p => p).join('/') === fullPath.join('/');\r\n        });\r\n        return key ? true : false;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  /**\r\n   * éè¿BEå­æ®µåè·åå­æ®µçbindingPath\r\n   * @param bindingPaths ç»å®è·¯å¾\r\n   * @param columnName BEå­æ®µå\r\n   * @returns \r\n   */\r\n  public getFrameContextsByColumnName(bindingPaths: string[], columnName: string): FrameContext[] | null {\r\n    if (!bindingPaths) {\r\n      throw new Error('bindingPath ä¸è½ä¸ºç©ºã');\r\n    }\r\n    if (!columnName) {\r\n      throw new Error('columnName ä¸è½ä¸ºç©ºã');\r\n    }\r\n    bindingPaths = bindingPaths.filter(p => p);\r\n    const entityTypeInfo = this.repository && this.repository.entityTypeInfo || null;\r\n    if (!entityTypeInfo) {\r\n      return null;\r\n    }\r\n    const dataTypeInfo = entityTypeInfo.getTypeInfoByPath(bindingPaths);\r\n    const dataPropInfos = dataTypeInfo && dataTypeInfo.getPropInfos() || [];\r\n    const columnPropInfo = dataPropInfos.find((dataPropInfo: DataPropInfo) => dataPropInfo.metadataInfo && (dataPropInfo.metadataInfo.originalDataField === columnName || dataPropInfo.metadataInfo.dataField === columnName));\r\n    if (!columnPropInfo || !columnPropInfo.metadataInfo) {\r\n      return null;\r\n    }\r\n    const frameContexts = this.appContext.frameContextManager.getFrameContexts();\r\n    return frameContexts.filter((frameContext: FrameContext) => {\r\n      const ngFormControls = this.formControlService.getFormControlsByFrameContext(frameContext);\r\n      if (!ngFormControls || Object.keys(ngFormControls).length < 1) {\r\n        return false;\r\n      }\r\n      const currentBindingPaths = this.bindingPathService.getBindingPathsByFrameContext(frameContext) || [];\r\n      const isValidFrameContext = currentBindingPaths.join('/') === bindingPaths.join('/');\r\n      if (!isValidFrameContext) {\r\n        return false;\r\n      }\r\n      const ngFormControl = Object.values(frameContext.viewModel.form.ngFormControls).find(item => item.binding === columnPropInfo.metadataInfo.path);\r\n      return ngFormControl ? true : false;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * éè¿ç»å®è·¯å¾è·åå¯¹åºçç»ä»¶ä¸ä¸ææ°ç»\r\n   * @param bindingPath bindingPathå­ç¬¦ä¸²\r\n   * @param namespace ns,é»è®¤ä¸º''\r\n   */\r\n   public getFrameContextsByBindingPath(bindingPath: string | string[], namespace: string = ''): FrameContext[] {\r\n    if (Array.isArray(bindingPath)) {\r\n      bindingPath = bindingPath.join('/');\r\n    }\r\n    const frameContexts = this.appContext && this.appContext.frameContextManager.getFrameContexts() || [];\r\n    return frameContexts.filter((frameContext: FrameContext) => frameContext && frameContext.namespace === namespace && frameContext.viewModel.bindingPath === bindingPath);\r\n  }\r\n}","import { Injectable, ElementRef } from '@angular/core';\r\nimport { Repository, FrameContext, NgFormControl } from '@farris/devkit';\r\nimport { FrameContextService } from './frame-context.service';\r\nimport { FormControlService } from './form-control.service';\r\n\r\nconst FIXED_COLUMN_START_INDEX = 5000;\r\nconst GRID_COLUMN_START_INDEX = 10000;\r\ninterface FocusableInvalidationGrid {\r\n  editCell(rowId: any, field: string): void;\r\n  disabled: boolean;\r\n}\r\n\r\n/**\r\n * è¡¨åéªè¯æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass FocusInvalidService {\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private frameContext: FrameContext,\r\n    private frameContextService: FrameContextService,\r\n    private formControlService: FormControlService\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * åç¬¬ä¸ä¸ªéªè¯ä¸éè¿çå­æ®µè®¾ç½®ç¦ç¹\r\n   */\r\n  public focusInvalidInput(verifyInformations: any[], rootElement: ElementRef<any>) {\r\n    // æ éªè¯ä¸éè¿ä¿¡æ¯æ¶ï¼ç´æ¥è¿åã\r\n    if (!verifyInformations || !verifyInformations.length) {\r\n      return;\r\n    }\r\n    let targetField = null;\r\n    const firstVerifyInformation = this.selectFirstVerifyInformation(verifyInformations, rootElement);\r\n    if (firstVerifyInformation) {\r\n      targetField = firstVerifyInformation.targetField;\r\n      if (targetField) {\r\n        const canFocus = this.focusElement(targetField, rootElement);\r\n        if (canFocus) {\r\n          verifyInformations['focused'] = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®DataGridååæ ¼ç¦ç¹\r\n   */\r\n  public focusGridCell(verifyInformations: any[], focusableDataGrid: FocusableInvalidationGrid) {\r\n    if (!verifyInformations || !verifyInformations.length || verifyInformations['focused'] == true || focusableDataGrid.disabled === true) {\r\n      return;\r\n    }\r\n    let targetField = null;\r\n    let targetId = null;\r\n    const firstVerifyInformation = this.selectFirstVerifyInformation(verifyInformations);\r\n    if (firstVerifyInformation) {\r\n      targetField = firstVerifyInformation.targetField;\r\n      targetId = firstVerifyInformation.id;\r\n      verifyInformations['focused'] = true;\r\n      focusableDataGrid.editCell(targetId, targetField);\r\n    }\r\n  }\r\n  private updateVerifyInformationsIndex(verifyInformations: any[], rootElement?: ElementRef<any>) {\r\n    verifyInformations = verifyInformations.filter((verifyInformation: any) => {\r\n      const frameContexts = this.getFrameContextsByPropertyPath(verifyInformation.fullPath, '/');\r\n      const frameContext = frameContexts && frameContexts.filter(frameContext => frameContext && frameContext.frameId === this.frameContext.frameId);\r\n      return frameContext ? true : false;\r\n    });\r\n    return verifyInformations.map((verifyInformation: any) => {\r\n      let tabIndex = -1;\r\n      if (verifyInformation) {\r\n        if (rootElement && verifyInformation.targetField) {\r\n          const input = this.getInputElementById(verifyInformation.targetField, rootElement);\r\n          tabIndex = input && input.getAttribute('tabindex') || -1;\r\n          tabIndex = Number(tabIndex);\r\n        }\r\n        // const frameContexts = this.getFrameContextsByPropertyPath(verifyInformation.fullPath, '/');\r\n        const frameContext = this.frameContext;//frameContexts && frameContexts[0] || null;\r\n        const frameIndex = frameContext.index + 1;\r\n        verifyInformation.tabIndex = tabIndex;\r\n        verifyInformation.domIndex = -1;\r\n        verifyInformation.frameIndex = -1;\r\n        verifyInformation.position = tabIndex;\r\n        if (frameContext) {\r\n          const domIndex = verifyInformation.fullPath && this.getFieldIndex(frameContext, verifyInformation.fullPath) || 0;\r\n          if (domIndex > 0) {\r\n            const rowIndex = verifyInformation.index || 0;\r\n            verifyInformation.domIndex = domIndex;\r\n            verifyInformation.frameIndex = frameContext.index;\r\n            verifyInformation.position = tabIndex > 0 ? tabIndex : (frameIndex * 1000 + rowIndex * 1000 + domIndex);\r\n          }\r\n        }\r\n      }\r\n      return verifyInformation;\r\n    });\r\n  }\r\n  private isGridComponent(frameContext: FrameContext) {\r\n    if (frameContext) {\r\n      const dataGridColumnsName = frameContext.viewModel['dataGridColumnsName'] || null;\r\n      return dataGridColumnsName ? true : false;\r\n    }\r\n    return undefined;\r\n  }\r\n  private getColumnIndex(frameContext: FrameContext, binding: string) {\r\n    binding = binding.split('/').filter(p => p).join('/');\r\n    const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    const dataGridColumnsName = frameContext.viewModel['dataGridColumnsName'] || null;\r\n    const frameIndex = frameContext.index + 1;\r\n    if (!dataGridColumnsName) {\r\n      return undefined;\r\n    }\r\n    let columns: any[] = frameContext.viewModel[dataGridColumnsName];\r\n    if (!columns || columns.length < 1) {\r\n      return undefined;\r\n    }\r\n    // æå¹³columns\r\n    columns = columns.reduce((results: any[], item) => {\r\n      if (Array.isArray(item)) {\r\n        return results.concat(item);\r\n      }\r\n      return results.concat([item]);\r\n    }, []);\r\n    let position = -1;\r\n    for (let index = 0; index < columns.length; index++) {\r\n      const column: any | any[] = columns[index];\r\n      const fields = column && column.field && column.field.split('.').filter(p => p) || null;\r\n      if (!fields) {\r\n        continue;\r\n      }\r\n      if (bindingPaths.concat(fields).join('/') === binding) {\r\n        const fixed = column.fixed;\r\n        if (fixed) {\r\n          const fixedColumns = columns.filter(item => item.fixed === fixed);\r\n          const fixedColumnIndex = this.getIndexFromColumns(fixedColumns, binding);\r\n          if (fixed === 'left') {\r\n            position = frameIndex * FIXED_COLUMN_START_INDEX + fixedColumnIndex;\r\n          } else {\r\n            position = frameIndex * GRID_COLUMN_START_INDEX + 1000 + fixedColumnIndex;\r\n          }\r\n        } else {\r\n          position = frameIndex * GRID_COLUMN_START_INDEX + index;\r\n        }\r\n        break;\r\n      }\r\n    }\r\n    return position;\r\n  }\r\n  private getIndexFromColumns(columns: any[], binding: string) {\r\n    const bindingPaths = this.frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    return columns.findIndex(column => {\r\n      const fields = column && column.field && column.field.split('.').filter(p => p) || null;\r\n      if (!fields) {\r\n        return false;\r\n      }\r\n      if (bindingPaths.concat(fields).join('/') === binding) {\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  private selectFirstVerifyInformation(verifyInformations: any[], rootElement?: ElementRef<any>) {\r\n    verifyInformations = this.updateVerifyInformationsIndex(verifyInformations, rootElement);\r\n    verifyInformations.sort((v1: any, v2: any) => Number(v1.position) - Number(v2.position));\r\n    return verifyInformations && verifyInformations.length > 0 && verifyInformations[0] || null;\r\n  }\r\n  private getInputElementById(targetField: string, rootElement: ElementRef<any>) {\r\n    let element = rootElement.nativeElement.ownerDocument.getElementById(targetField) || null;\r\n    if (element && element.tagName !== 'INPUT') {\r\n      const inputs = element.getElementsByTagName('input');\r\n      if (inputs.length) {\r\n        element = inputs[0];\r\n      }\r\n    }\r\n    return element;\r\n  }\r\n  public getFrameContextsByPropertyPath(propertyPath: string, separtor: string = '/'): FrameContext[] {\r\n    if (!propertyPath) {\r\n      return [];\r\n    }\r\n    const frameContexts = this.frameContext && this.frameContext.appContext.frameContextManager.getFrameContexts() || [];\r\n    return frameContexts.filter((frameContext: FrameContext) => {\r\n      const formControls = frameContext && frameContext.form && frameContext.form.ngFormControls || {};\r\n      const bindingPath = frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath || '';\r\n      if (formControls && Object.keys(formControls).length > 0) {\r\n        const key = Object.keys(formControls).find((key: string) => {\r\n          const formControl = formControls[key];\r\n          if (!formControl || !formControl.binding) {\r\n            return false;\r\n          }\r\n          const bindings = formControl.binding.split('.').filter(p => p);\r\n          const bindingPaths = bindingPath.split('/').filter(p => p);\r\n          const fullPath = bindingPaths.concat(bindings);\r\n          return propertyPath.split(separtor).filter(p => p).join('/') === fullPath.join('/');\r\n        });\r\n        return key ? true : false;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  public getFormControlIndexByBindingPath(frameContext: FrameContext, binding: string): number {\r\n    const ngFormControls = this.getFormControlsByFrameContext(frameContext);\r\n    if (!ngFormControls) {\r\n      return null;\r\n    }\r\n    const bindings = binding.split('/').filter(p => p);\r\n    return Object.values(ngFormControls).findIndex((ngFormControl: NgFormControl) => {\r\n      if (!ngFormControl) {\r\n        return false;\r\n      }\r\n      const bindingPath = frameContext.viewModel.bindingPath;\r\n      const bindingPaths = bindingPath.split('/').filter(p => p);\r\n      const formControlBindingPaths = ngFormControl.binding.split('.').filter(p => p);\r\n      const fullPath = bindingPaths.concat(formControlBindingPaths);\r\n      return fullPath.join('/') === bindings.join('/');\r\n    });\r\n  }\r\n  public getFieldIndex(frameContext: FrameContext, binding: string) {\r\n    const isGridComponent = this.isGridComponent(frameContext);\r\n    if (isGridComponent) {\r\n      return this.getColumnIndex(frameContext, binding);\r\n    } else {\r\n      return this.getFormControlIndexByBindingPath(frameContext, binding);\r\n    }\r\n  }\r\n  public getFormControlsByFrameContext(frameContext: FrameContext): { [propertyName: string]: NgFormControl } | null {\r\n    return frameContext && frameContext.form && frameContext.form.ngFormControls || null;\r\n  }\r\n  public focusElement(elementId: string, rootElement: ElementRef<any>): boolean {\r\n    let focused = false;\r\n    let elementToFocus = rootElement.nativeElement.ownerDocument.getElementById(elementId);\r\n    // æªè·åå°æå®å­æ®µæ¶ï¼è¿åï¼ä¸åè®¾ç½®ç¦ç¹ã\r\n    if (elementToFocus) {\r\n      // å¦ææå¤ä¸ªidéå¤çåç´ ï¼åä¸å®ä½\r\n      const elements = rootElement.nativeElement.ownerDocument.querySelectorAll(`#${elementId}`);\r\n      if (elements && elements.length > 1) {\r\n        return focused;\r\n      }\r\n      // å¦æç»å®ç®æ å­æ®µçæ§ä»¶ä¸æ¯Inputåç´ ï¼åæ¥æ¾å¶ä¸çº§èç¹ã\r\n      if (elementToFocus.tagName !== 'INPUT') {\r\n        const subElements = elementToFocus.getElementsByTagName('input');\r\n        if (subElements.length) {\r\n          elementToFocus = subElements[0];\r\n        }\r\n      }\r\n      elementToFocus.focus();\r\n      focused = true;\r\n    }\r\n    return focused;\r\n  }\r\n  /**\r\n   * è®¾ç½®ç¦ç¹\r\n   * @param verifyInformation éè¯¯ä¿¡æ¯\r\n   * @param frameContext ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public focus(verifyInformation: any, frameContext: FrameContext) {\r\n    if (!verifyInformation) {\r\n      return;\r\n    }\r\n    const isGridValidation = verifyInformation.index !== null;\r\n    if (isGridValidation) {\r\n      const grid = this.getGridRef(frameContext);\r\n      if (grid) {\r\n        setTimeout(() => {\r\n          grid.editCell(verifyInformation.id, verifyInformation.targetField);\r\n        }, 0);\r\n      }\r\n    } else {\r\n      const frameElement = this.getComponentRef(frameContext);\r\n      const elementId = verifyInformation.targetField;\r\n      this.focusById(elementId, frameElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * éè¿æ§ä»¶idè®¾ç½®ç¦ç¹\r\n   * @param elementId \r\n   * @param elementRef \r\n   */\r\n  private focusById(elementId: string, elementRef?: ElementRef) {\r\n    const document: any = elementRef && elementRef.nativeElement.ownerDocument || window.document;\r\n    if (document) {\r\n      const element = document.getElementById(elementId);\r\n      if (element.tagName !== 'INPUT') {\r\n        const subElements = element.getElementsByTagName('input');\r\n        if (subElements.length) {\r\n          const input = subElements[0];\r\n          if (input && typeof input.focus === 'function') {\r\n            input.focus();\r\n          }\r\n        }\r\n      } else {\r\n        element.focus();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * è·åç»ä»¶å®ä¾\r\n   * @param frameContext \r\n   * @returns \r\n   */\r\n  private getComponentRef(frameContext: FrameContext) {\r\n    return this.frameContext && this.frameContext.injector.get<ElementRef>(ElementRef, null) || null;\r\n  }\r\n  /**\r\n   * è·ågridå®ä¾\r\n   * @param frameContext frameContext\r\n   * @returns \r\n   */\r\n  private getGridRef(frameContext: FrameContext): FocusableInvalidationGrid {\r\n    const namespace = frameContext.namespace;\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const frameContexts: FrameContext[] = this.frameContext.appContext.frameContextManager.getFrameContextsByNamespace(namespace) || [];\r\n    const matchedFrameContexts = frameContexts.filter((frameContext: FrameContext) => frameContext.viewModel && frameContext.viewModel.bindingPath.split('/').filter(p => p).toString() === bindingPath.split('/').filter(p => p).toString());\r\n    let result = null;\r\n    if (matchedFrameContexts) {\r\n      matchedFrameContexts.every((frameContext: FrameContext) => {\r\n        const frameId = frameContext.frameId;\r\n        const componentsMap = this.frameContext.appContext.componentManager.getComponentsByFrameId(frameId);\r\n        if (!componentsMap) {\r\n          return true;\r\n        }\r\n        const datagridComponent = Array.from(componentsMap.values()).find((component: any) => component && component['__component_type__'] === 'DatagridComponent');\r\n        if (datagridComponent) {\r\n          result = datagridComponent;\r\n          return false;\r\n        } else {\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport { FocusableInvalidationGrid, FocusInvalidService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Repository, FrameContext } from '@farris/devkit';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { EMPTY, Observable, Subject, Subscriber } from 'rxjs';\r\nimport { of } from 'rxjs/observable/of';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\n\r\n\r\nconst POSTER = 'iframePoster';\r\nconst RECEIVER = 'iframeReceiver';\r\nconst REPOSITORY = 'repository';\r\n// window.hashä¸­funcIdçå±æ§å\r\nconst FUNC_ID = 'funcId=';\r\nconst TAB_ID = 'tabId=';\r\n/**\r\n * ChangeItemService\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass ChangeItemService {\r\n\r\n  public top = top;\r\n  private funcId: string;\r\n  private tabId: string;\r\n  public itemChangePoster = new Subject<any>();\r\n  public itemChangeReceiver = new Subject<any>();\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private frameContext: FrameContext,\r\n    private notifyService: FormNotifyService,\r\n    private languageService: LanguageService\r\n  ) {\r\n  }\r\n\r\n  init() {\r\n    this.top['topMap'] = this.top['topMap'] || {};\r\n    this.changeItem = this.changeItem.bind(this);\r\n  }\r\n\r\n  setBykey(key: string, value: any) {\r\n    this.top['topMap'] = this.top['topMap'] || {};\r\n    this.top['topMap'][this.tabId] = this.top['topMap'][this.tabId] || {};\r\n    const topObject = this.top['topMap'][this.tabId];\r\n    topObject[key] = value;\r\n  }\r\n\r\n  getByKey(key: string) {\r\n    const topObject = this.top['topMap'][this.tabId] || {};\r\n    return topObject[key];\r\n  }\r\n\r\n  // å»ºç«iframeéä¿¡\r\n  setIframePoster() {\r\n    if (this.getByKey[POSTER]) {\r\n      return;\r\n    } else {\r\n      this.setBykey(POSTER, this.itemChangePoster);\r\n    }\r\n  }\r\n\r\n  getIframePoster() {\r\n    this.itemChangePoster = this.getByKey(RECEIVER);\r\n    this.setBykey(RECEIVER, this.itemChangeReceiver);\r\n  }\r\n\r\n  changeItem(type: string, id: string, parentId: string) {\r\n    // æ ¹æ®æ¯å¦æ¯å¼¹åºå¼å¡çåä¸åçtabId\r\n    const virtualRootFrameContext = this.frameContext.getVirtualRootFrameContext();\r\n    const virtualRootComponent = virtualRootFrameContext.frameComponent;\r\n    const isDialogComponent = virtualRootComponent['isDialogRootComponent'] || false;\r\n    if (isDialogComponent) {\r\n      this.tabId = window.location.hash.split(TAB_ID)[1].slice(0, window.location.hash.split(TAB_ID)[1].indexOf('&'));\r\n    } else {\r\n      this.tabId = parentId;\r\n    }\r\n    this.itemChangeReceiver = this.getByKey(RECEIVER);\r\n    return Observable.create((subscriber: Subscriber<any>) => {\r\n      this.getNextItemByCurrentId(id, type).subscribe((result: any) => {\r\n        subscriber.next(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  // å¨liståå§åæ¶è°ç¨ï¼ç¼å­listçrepository\r\n  setRepository() {\r\n    if (window.location.hash.includes(TAB_ID)) {\r\n      this.tabId = window.location.hash.split(TAB_ID)[1].slice(0, window.location.hash.split(TAB_ID)[1].indexOf('&'));\r\n      this.setBykey(REPOSITORY, this.frameContext.repository);\r\n      this.setIframePoster();\r\n      this.getIframePoster();\r\n    }\r\n  }\r\n\r\n  // æ ¹æ®ç±»ååidè·åç¸é»çæ°æ®\r\n  getNextItemByCurrentId(currentId: string, type: string) {\r\n    const repository = this.getByKey(REPOSITORY);\r\n    const { pageSize, pageIndex, total } = repository.entityCollection.paginationInfo;\r\n    let currentIdx = null;\r\n    const list = repository.entityCollection.getAllEntities();\r\n    list.find((x: any, idx: string) => {\r\n      if (x.id === currentId) {\r\n        currentIdx = idx;\r\n      }\r\n    });\r\n    // æ²¡æå¨åè¡¨ä¸­æ¾å°æ°æ®ï¼è¿åç©º\r\n    if (currentIdx === null) {\r\n      // æ°å¢åæ¶å½åæ æ°æ®æ¶ç¹ä¸ä¸æ¡ä¸ä¸æ¡\r\n      if (list.length) {\r\n        switch (type) {\r\n          case 'prev':\r\n            return of(list[list.length - 1].id);\r\n            break;\r\n          case 'next':\r\n            this.notifyService.info(this.languageService.changeToLast, { hideTitle: true });\r\n            return EMPTY;\r\n        }\r\n      }\r\n      return of(null);\r\n    }\r\n    let nextIdx = currentIdx;\r\n    switch (type) {\r\n      case 'prev':\r\n        // å½åé¡µç¬¬ä¸æ¡,ä¸éç¬¬ä¸é¡µ,åä¸ä¸é¡µæåä¸æ¡\r\n        if (currentIdx === 0 && pageIndex !== 1) {\r\n          return repository.getEntities([], [], pageSize, pageIndex - 1).pipe(\r\n            switchMap(result => {\r\n              nextIdx = pageSize - 1;\r\n              return of(result[nextIdx].id);\r\n            })\r\n          );\r\n        }\r\n        // ç¬¬ä¸é¡µç¬¬ä¸æ¡ï¼ä»è¿ååææ°æ®\r\n        else if (currentIdx === 0 && pageIndex === 1) {\r\n          this.notifyService.info(this.languageService.changeToFirst, { hideTitle: true });\r\n          return of(list[nextIdx].id);\r\n        }\r\n        // ä¸æ¯ç¬¬ä¸æ¡ï¼è¿åä¸ä¸æ¡\r\n        else {\r\n          nextIdx = currentIdx - 1;\r\n          return of(list[nextIdx].id);\r\n        }\r\n        break;\r\n      case 'next':\r\n        // è¶è¿å½åé¡µ\r\n        if (currentIdx + 1 + 1 > list.length) {\r\n          // ä¸éæåä¸æ¡æ°æ®,åä¸ä¸é¡µç¬¬ä¸æ¡æ°æ®\r\n          if (((pageIndex - 1) * pageSize + currentIdx + 1) < total) {\r\n            return repository.getEntities([], [], pageSize, pageIndex + 1).pipe(switchMap(result => {\r\n              return of(result[0].id);\r\n            }));\r\n          }\r\n          // æåä¸æ¡æ°æ®ï¼ä»è¿ååæ°æ®\r\n          else {\r\n            this.notifyService.info(this.languageService.changeToLast, { hideTitle: true });\r\n            return of(list[nextIdx].id);\r\n          }\r\n        } else {\r\n          nextIdx = currentIdx + 1;\r\n          return of(list[nextIdx].id);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\nexport { ChangeItemService };\r\n","import { CommandContext } from \"@farris/devkit\";\r\n\r\nexport abstract class Service {\r\n  public context: CommandContext;\r\n  /**\r\n   * å½ä»¤åæ°\r\n   */\r\n  public get eventParam(){\r\n    return this.context && this.context.eventParam || null;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { Service } from \"./service\";\r\nimport { DatagridComponent } from '@farris/ui-datagrid';\r\nimport { QueryCondition } from '@farris/component-querycondition';\r\nimport { CommandContext, FrameContext } from \"@farris/devkit\";\r\n@Injectable()\r\nexport class DataGridService extends Service {\r\n  /**\r\n   * æ¸ç©ºææå¾éè¡\r\n   * @description åæ¶å¾éå½åè¡¨åææå¾éè¡\r\n   */\r\n  public clearChecks() {\r\n    // const params = this.eventParam;\r\n    // if (params && Array.isArray(params)) {\r\n    // const param = params[0];\r\n    // if (param instanceof QueryCondition) {\r\n    const gridComponents = this.getFormGridComponents(this.context);\r\n    if (gridComponents && gridComponents.length > 0) {\r\n      gridComponents.forEach((gridComponent: DatagridComponent) => {\r\n        let clearSelections = true;\r\n        if (gridComponent.hasOwnProperty('clearSelectionsWhenDataIsEmpty')) {\r\n          clearSelections = gridComponent['clearSelectionsWhenDataIsEmpty'];\r\n        }\r\n        if (clearSelections) {\r\n          gridComponent.clearCheckeds(true);\r\n        }\r\n      });\r\n    }\r\n    // }\r\n    // }\r\n  }\r\n  /**\r\n   * åæ¶å¾éå é¤çè¡\r\n   * @param ids ids\r\n   * @returns \r\n   * @description åæ¶å¾éå½åç»å®è·¯å¾ä¸æå®æ°æ®ï¼æ¸ç©ºä¸çº§è¡¨æ ¼ä¸­ææå¾éè¡ï¼ä»ä¾å é¤åºæ¯ä½¿ç¨\r\n   */\r\n  public uncheckDeletedRows(ids: any) {\r\n    if (typeof ids === 'string') {\r\n      if (ids.indexOf(',') !== -1) {\r\n        ids = ids.split(',').filter(p => p);\r\n      } else {\r\n        ids = [ids];\r\n      }\r\n    }\r\n    if (!ids || ids.length < 1) {\r\n      return;\r\n    }\r\n    // è·åbindingPathåns\r\n    const frameContext = this.context.frameContext;\r\n    if (!frameContext) {\r\n      return;\r\n    }\r\n    const appContext = frameContext.appContext;\r\n    const ns = frameContext.namespace;\r\n    const bindingPath = frameContext.viewModel && frameContext.viewModel.bindingPath;\r\n    if (!appContext) {\r\n      return;\r\n    }\r\n    // æ ¹æ®bindingPathè·åææå¯è½çframeContext\r\n    const frameContexts = appContext.frameContextManager.getFrameContextsByNamespace(ns);\r\n    const frameContextsInCurrentBindingPath = frameContexts.filter(frameContext => frameContext && frameContext.viewModel && frameContext.viewModel.bindingPath === bindingPath);\r\n    // è·åè¿äºframeä¸­ææçè¡¨æ ¼ç»ä»¶map\r\n    const gridInCurrentFrame = this.getGridComponentByFrameContexts(frameContextsInCurrentBindingPath);\r\n    if (!gridInCurrentFrame) {\r\n      return;\r\n    }\r\n    // ä¸ä¸ªbindingPathä¸åºè¯¥åªæä¸ä¸ªgrid\r\n    const grid: DatagridComponent = gridInCurrentFrame.pop();\r\n    // æ¸ç©ºå½ä»¤æå¨çframeä¸è¡¨æ ¼çæå®å¾é\r\n    if(grid){\r\n      grid.unCheckRows(ids, true);\r\n    }\r\n    // æ¸ç©ºä¸çº§è¡¨æ ¼çææå¾éè¡æ°æ®\r\n    const childrenFrameContexts = frameContexts.filter(frameContext => frameContext.viewModel.bindingPath !== bindingPath && frameContext.viewModel.bindingPath.startsWith(bindingPath));\r\n    const childrenGridComponents = this.getGridComponentByFrameContexts(childrenFrameContexts);\r\n    // æ¸ç©ºå½ä»¤æå¨frame\r\n    if (childrenGridComponents && childrenGridComponents.length > 0) {\r\n      childrenGridComponents.forEach((gridComponent: DatagridComponent) => {\r\n        // æ¸ç©ºææå¾é\r\n        gridComponent.checkedRows = [];\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * åæ¶å¾éè¡\r\n   * @param ids ids\r\n   * @returns \r\n   */\r\n  public uncheckRows(ids: any) {\r\n    if (typeof ids === 'string') {\r\n      ids = [ids];\r\n    }\r\n    if (!ids || ids.length < 1) {\r\n      return;\r\n    }\r\n    const gridComponents = this.getFormGridComponents(this.context);\r\n    if (gridComponents && gridComponents.length > 0) {\r\n      gridComponents.forEach((gridComponent: DatagridComponent) => {\r\n        gridComponent.unCheckRows(ids, true);\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®å½ä»¤ä¸ä¸æè·åå½åå½ä»¤æå¨ç»ä»¶çè¡¨æ ¼å®ä¾\r\n   * @param commandContext å½ä»¤ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  private getFormGridComponents(commandContext: CommandContext) {\r\n    let grids = [];\r\n    const frameContext = commandContext && commandContext.frameContext;\r\n    const appContext = frameContext && frameContext.appContext || null;\r\n    if (appContext) {\r\n      const componentRefs: Map<string, Map<string, any>> = appContext.componentRefs;\r\n      const collect = Array.from(componentRefs.values());// [Map<string,any>,Map<string,any>]\r\n      collect.forEach((item: Map<string, any>) => {\r\n        const components = Array.from(item.values());\r\n        const bindingPath = frameContext\r\n        const gridComponents = components.filter((component: any) => component instanceof DatagridComponent);\r\n        grids = grids.concat(gridComponents);\r\n      });\r\n    }\r\n    return grids;\r\n  }\r\n  private getGridComponentByFrameContexts(frameContexts: FrameContext[]) {\r\n    return frameContexts.reduce((result, frameContext) => {\r\n      const appContext = frameContext.appContext;\r\n      const frameId = frameContext.frameId;\r\n      // è·åå½åç»ä»¶ä¸ææçç»ä»¶å®ä¾\r\n      const componentsRef = appContext.componentRefs.get(frameId);\r\n      const grids = componentsRef && Array.from(componentsRef.values()).filter(component => component instanceof DatagridComponent);\r\n      if (grids && grids.length > 0) {\r\n        result = result.concat(grids);\r\n      }\r\n      return result;\r\n    }, []);\r\n  }\r\n}","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of, empty, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap, catchError } from 'rxjs/operators';\r\nimport { Repository, BindingData, Entity, ViewModel, BindingList, EntityPathConverter, BindingObject } from '@farris/devkit';\r\nimport { BefRepository, BefRepositoryUtil, BefDataPathUtil } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { CommandService } from '../command-service';\r\nimport { FilterConditionService } from '../filter-condition.service';\r\nimport { DataGridService } from '../data-grid.service';\r\nimport { DataChangeDetectionService } from '../data-change-detection.service';\r\n// tslint:disable: no-string-literal max-line-length\r\n\r\n/**\r\n * åè¡¨ä»åºæå¡\r\n */\r\n@Injectable()\r\nclass ListDataService {\r\n\r\n  /**\r\n   * æé \r\n   * @param msgService msgService\r\n   * @param repository repository\r\n   * @param bindingData bindingData\r\n   * @param loadingService loadingService\r\n   * @param languageService languageService\r\n   * @param formNotifyService formNotifyService\r\n   * @param formErrorService formErrorService\r\n   * ! @param viewModel viewModel,vmæ¯åææ³¨å¥çï¼èè¡¨åè·åä¸å°ï¼ä¸å®è¦åéç©ºå¤æ­\r\n   * @param filterConditionService filterConditionService\r\n   */\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    private repository: Repository<any>,\r\n    private bindingData: BindingData,\r\n    private loadingService: FormLoadingService,\r\n    @Optional() private languageService: LanguageService,\r\n    private formNotifyService: FormNotifyService,\r\n    private formErrorService: FormErrorService,\r\n    private viewModel: ViewModel,\r\n    private filterConditionService: FilterConditionService,\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n\r\n    // if (!filterConditionService) {\r\n    //   this.filterConditionService = new FilterConditionService();\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * å è½½\r\n   */\r\n  public load(filter?: string, sort?: string): Observable<Entity[]> {\r\n\r\n    // åæ°å¤ç\r\n    filter = !filter ? '[]' : filter;\r\n    sort = !sort ? '[]' : sort;\r\n    // åå¹¶è¿æ»¤æ¡ä»¶\r\n    filter = this.mergeFilterConditions(filter);\r\n    // åå¹¶æåºæ¡ä»¶\r\n    sort = this.mergeSortConditions(sort);\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(200);\r\n    const query$ = this.repository.getEntities(JSON.parse(filter), JSON.parse(sort), null, null);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          // è§¦åè¿ç«¯åè®¡äºä»¶\r\n          this.fireQueryEvent(filter);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * è¿æ»¤æ°æ®\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param sort æåºæ¡ä»¶\r\n   */\r\n  public filter(filter?: string, sort?: string): Observable<Entity[]> {\r\n    // åæ°å¤ç\r\n    filter = !filter ? '[]' : filter;\r\n    sort = !sort ? '[]' : sort;\r\n    // åå¹¶è¿æ»¤æ¡ä»¶\r\n    filter = this.mergeFilterConditions(filter);\r\n    // åå¹¶æåºæ¡ä»¶\r\n    sort = this.mergeSortConditions(sort);\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(200);\r\n    const query$ = this.repository.filter(JSON.parse(filter), JSON.parse(sort));\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          // è§¦åè¿ç«¯åè®¡äºä»¶\r\n          this.fireQueryEvent(filter);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢\r\n   */\r\n  public query(filter: string, sort: string, pageSize: number, pageIndex: number): Observable<Entity[]> {\r\n    // åæ°å¤ç\r\n    filter = (filter === '') ? '[]' : filter;\r\n    sort = (sort === '') ? '[]' : sort;\r\n    // åå¹¶è¿æ»¤æ¡ä»¶\r\n    filter = this.mergeFilterConditions(filter);\r\n    // åå¹¶æåºæ¡ä»¶\r\n    sort = this.mergeSortConditions(sort);\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(5);\r\n    const query$ = this.repository.getEntities(JSON.parse(filter), JSON.parse(sort), pageSize, pageIndex);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n          // è§¦åè¿ç«¯åè®¡äºä»¶\r\n          this.fireQueryEvent(filter);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.queryFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  public queryChild(filter: string, sort: string) {\r\n    // const isUpdateWithPaging = this.viewModel.frameContext.root.params.get('updateWithPaging') || false;\r\n    // if (isUpdateWithPaging) {\r\n    //   return of(null);\r\n    // }\r\n    // tslint:disable-next-line: max-line-length\r\n    const fullPaths = EntityPathConverter.toEntityPathArray(this.viewModel.bindingPath, this.bindingData);\r\n    const paths = fullPaths.slice(0, fullPaths.length - 1);\r\n    // debug\r\n    // tslint:disable-next-line: max-line-length\r\n    const bindingPaths = this.viewModel.bindingPath.split('/').filter(item => item);\r\n    const bindingData = this.viewModel.bindingData;\r\n    let nodeCode = bindingPaths[bindingPaths.length - 1];\r\n    nodeCode = nodeCode.substr(0, nodeCode.length - 1);\r\n    // è·åä¸çº§å®ä½\r\n    const parentPaths = bindingPaths.slice(0, bindingPaths.length - 1);\r\n    const BindingList = bindingData.getValue(parentPaths) as BindingList;\r\n    if (!BindingList) {\r\n      return;\r\n    }\r\n    this.viewModel.frameContext.appContext.params.delete(\"retrieveing\");\r\n    const configPath = `/${nodeCode}`;\r\n    const config = this.repository.entityCollection.getPaginationConfigByPath(configPath);\r\n    if (config) {\r\n      const { pageIndex = 1, pageSize = 0 } = config;\r\n      // pageSize = 0è¡¨ç¤ºæªåé¡µ\r\n      if (pageSize !== 0) {\r\n        this.viewModel.frameContext.appContext.params.set('queryChild', true);\r\n        const request$ = this.repository.queryChild(paths, pageIndex, pageSize);\r\n        return request$.pipe(\r\n          tap(() => { },\r\n            error => {\r\n              this.formErrorService.exception(this.languageService.queryFailed, error);\r\n            }\r\n          )\r\n        );\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * è·ååé¡µä¿¡æ¯\r\n   * @param nodeCode nodeCode\r\n   * @returns åé¡µä¿¡æ¯ï¼åæ¬ï¼åé¡µå¤§å°ãå½åé¡µç \r\n   * @description åºæ¬åé¡µä¿¡æ¯å¨åé¡µä¿¡æ¯ä¸­å­å¨æ¶keyä¸ºnodeCode\r\n   */\r\n  /*private getPagingInfo(nodeCode: string) {\r\n    const result: { pageIndex?: number, pageSize?: number } = {};\r\n    const nodeCodePath = `/${nodeCode}`;\r\n    const defaultPagingInfo = this.repository.entityCollection.getPaginationConfigByPath(nodeCodePath);\r\n    const pageSize = defaultPagingInfo && defaultPagingInfo.pageSize || 0;\r\n    const pageIndex = defaultPagingInfo && defaultPagingInfo.pageIndex || 1;\r\n    result.pageIndex = pageIndex;\r\n    result.pageSize = pageSize;\r\n    return result;\r\n  }*/\r\n  /**\r\n   * è¿½å ä¸æ¡æ°æ°æ®\r\n   */\r\n  public append(): Observable<Entity> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'append' });\r\n    }\r\n    const append$ = this.repository.append();\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.appendFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å½åè¡åæåæå¥æ°æ®\r\n   * @param position 1 | -1\r\n   */\r\n  public insert(position: 1 | -1 = -1) {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'insert' });\r\n    }\r\n    const append$ = this.repository.insert(position);\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.appendFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æäº¤åæ´ï¼æ¹éç¼è¾é¡µé¢ï¼è¡åæ¢æ¶æäº¤å¢éï¼\r\n   */\r\n  public updateChanges(): Observable<boolean> {\r\n    const update$ = this.repository.updateAllChanges();\r\n    return update$;\r\n  }\r\n\r\n  /**\r\n   * æ¹éä¿å­\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   */\r\n  public save(successMsg?: string): Observable<boolean> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'save' });\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const save$ = this.repository.applyChanges();\r\n    const result$ = save$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          if (successMsg && successMsg.trim()) {\r\n            let showMessage: boolean = true;\r\n            if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n              try {\r\n                const options = JSON.parse(successMsg);\r\n                if (options.showMessage === false) {\r\n                  showMessage = false;\r\n                }\r\n              } catch { }\r\n            }\r\n            if (showMessage !== false) {\r\n              this.formNotifyService.success(successMsg, { hideTitle: true });\r\n            }\r\n          } else {\r\n            this.formNotifyService.success(this.languageService.saveSuccess, { hideTitle: true });\r\n          }\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.multiSaveFailed, error);\r\n        }\r\n      )\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * å é¤\r\n   * @param id è¦å é¤çæ°æ®çid\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   * @param confirm æ¯å¦éè¦ç¡®è®¤\r\n   * @param breakable æ¯å¦å¯ä¸­æ­ï¼ifSaveä¸ºfalseæ¶æµä¼ä¸­æ­\r\n   */\r\n  public remove(id: string, ifSave?: boolean | string, successMsg?: string, confirm: boolean | string = true, breakable: boolean | string = true): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'delete' });\r\n    }\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n    confirm = (confirm === false || confirm === 'false') ? false : true;\r\n    breakable = (breakable === false || breakable === 'false') ? false : true;\r\n    const action$ = confirm ? this.msgService.question(this.languageService.confirmDeletion) : of(true);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n        ifSave = (ifSave === false || ifSave === 'false') ? false : true;\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeById(id, ifSave);\r\n        if (!remove$) {\r\n          return empty();\r\n        }\r\n        return remove$.pipe(\r\n          tap(\r\n            () => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              if (successMsg && successMsg.trim()) {\r\n                let showMessage: boolean = true;\r\n                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                  try {\r\n                    const options = JSON.parse(successMsg);\r\n                    if (options.showMessage === false) {\r\n                      showMessage = false;\r\n                    }\r\n                  } catch { }\r\n                }\r\n                if (showMessage !== false) {\r\n                  this.formNotifyService.success(successMsg, { hideTitle: true });\r\n                }\r\n              } else {\r\n                this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n              }\r\n            },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          ),\r\n          switchMap(() => {\r\n            if (ifSave === true || !breakable) {\r\n              // return this.load();\r\n              return of([]);\r\n            } else {\r\n              // æ¹éç¼è¾åè¡¨è¡¨æ ¼å¤äºç¼è¾æåºæ¯æ¶ï¼ä¸ºé²æ­¢æ§è¡åç»­å½ä»¤å¯¼è´æ°æ®éæ°å è½½ï¼æä»¥å¨æ­¤å°å½ä»¤ä¸­æ­äºãä½åæ¶ä¹å¯¼è´äºå é¤æ°æ®åå¾éè®°å½ä¾ç¶å­å¨ãæä»¥å¨è¿ééè¦åç¬è°ç¨ä¸æ¬¡æ¸ç©ºå¾éæ¹æ³ã\r\n              const datagridService = new DataGridService();\r\n              datagridService.context = this['context'];\r\n              datagridService.uncheckDeletedRows([id]);\r\n              return empty();\r\n            }\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¹éå é¤\r\n   * @param ids ids\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   * @param deleteCurrentRowIfNoChecks æ²¡æå¾éæ¶å é¤å½åè¡\r\n   */\r\n  public removeRows(ids: string[], ifSave?: boolean | string, successMsg?: string, deleteCurrentRowIfNoChecks: boolean | string = false): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'removeRows' });\r\n    }\r\n    deleteCurrentRowIfNoChecks = (deleteCurrentRowIfNoChecks === 'true' || deleteCurrentRowIfNoChecks === true) ? true : false;\r\n    if (!ids || ids.length === 0) {\r\n      const currentId = this.bindingData.list.currentId;\r\n      if (deleteCurrentRowIfNoChecks === true && currentId) {\r\n        ids = [this.bindingData.list.currentId];\r\n      } else {\r\n        this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n        return empty();\r\n      }\r\n    }\r\n    const action$ = this.msgService.confirm(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n        if (typeof ifSave === 'undefined') {\r\n          ifSave = true;\r\n        }\r\n        if (typeof ifSave === 'string') {\r\n          ifSave = ifSave.toLowerCase() === 'false' ? false : true;\r\n        }\r\n        ifSave = (ifSave === false) ? false : true;\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeByIds(ids, ifSave);\r\n\r\n        if (!remove$) {\r\n          return empty();\r\n        }\r\n\r\n        return remove$.pipe(\r\n          tap(\r\n            () => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              if (successMsg && successMsg.trim()) {\r\n                let showMessage: boolean = true;\r\n                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                  try {\r\n                    const options = JSON.parse(successMsg);\r\n                    if (options.showMessage === false) {\r\n                      showMessage = false;\r\n                    }\r\n                  } catch { }\r\n                }\r\n                if (showMessage !== false) {\r\n                  this.formNotifyService.success(successMsg, { hideTitle: true });\r\n                }\r\n              } else {\r\n                this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n              }\r\n              // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          ),\r\n          switchMap(() => {\r\n            return of([]);\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * å é¤åçå·æ°\r\n   */\r\n  public refreshAfterRemoving(loadCmdName: string, loadCmdFrameId: string): Observable<any> {\r\n    if (this.viewModel && loadCmdName && loadCmdFrameId) {\r\n      const commandService = this.viewModel.frameContext.injector.get<CommandService>(CommandService, null);\r\n      return commandService.execute(loadCmdName, loadCmdFrameId);\r\n    }\r\n    return this.load();\r\n  }\r\n\r\n  /**\r\n   * å·æ°\r\n   * @param loadCmdName å·æ°å½ä»¤\r\n   * @param loadCmdFrameId å·æ°å½ä»¤æå¨çframeId\r\n   */\r\n  public refresh(loadCmdName: string, loadCmdFrameId: string): Observable<any> {\r\n    if (this.viewModel && loadCmdName && loadCmdFrameId) {\r\n      const commandService = this.viewModel.frameContext.injector.get<CommandService>(CommandService, null);\r\n      return commandService.execute(loadCmdName, loadCmdFrameId);\r\n    }\r\n    return this.load();\r\n  }\r\n  /**\r\n   * åæ¶æ¶æ£æµæªä¿å­è®°å½\r\n   */\r\n  public cancel(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'cancel' });\r\n    }\r\n    const hasChange$ = DataChangeDetectionService.hasChange(this.viewModel.frameContext);\r\n    return hasChange$.pipe(\r\n      switchMap((changed: boolean) => {\r\n        if (!changed) {\r\n          return this._cancel();\r\n        } else {\r\n          return this.msgService.question(this.languageService['cancelWithoutSave']).pipe(\r\n            switchMap((ifCancel: boolean) => {\r\n              if (ifCancel === false) {\r\n                return EMPTY;\r\n              }\r\n              return this._cancel();\r\n            })\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * è¿ååæ´é\r\n   * @description ä¸å¸¦åæ´æ£æµæç¤º\r\n   */\r\n  public revert(): Observable<any> {\r\n    return this._cancel();\r\n  }\r\n  /**\r\n   * åæ¶ï¼åé¨åæ¶ï¼\r\n   */\r\n  private _cancel(): Observable<any> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const cancel$ = this.repository.cancelChanges();\r\n    return cancel$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.cancelFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * è·åæ ¹ç»ä»¶appContext\r\n   */\r\n  private get messagePipe() {\r\n    if (this.viewModel && this.viewModel.frameContext) {\r\n      const appContext = this.viewModel.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * è§¦åæ¥è¯¢äºä»¶\r\n   * @param filters è¿æ»¤æ¡ä»¶\r\n   */\r\n  private fireQueryEvent(filters: any) {\r\n    const messagePipe = this.messagePipe;\r\n    // const frameId = this.viewModel && this.viewModel.frameContext && this.viewModel.frameContext.frameId || null;\r\n    if (messagePipe) {\r\n      messagePipe.next({ type: 'query' });\r\n    }\r\n  }\r\n  /**\r\n   * åå¹¶è¿æ»¤æ¡ä»¶\r\n   * @param filter è¡¨åè¿æ»¤æ¡ä»¶\r\n   */\r\n  private mergeFilterConditions(filter: any) {\r\n    if (typeof filter === 'string') {\r\n      filter = JSON.parse(filter) || [];\r\n    }\r\n    const filters: Array<any> = filter;\r\n    const bindingPath = this.viewModel && this.viewModel.bindingPath || null;\r\n    if (bindingPath) {\r\n      const originalConditions = this.viewModel && this.viewModel.frameContext.repository.filterConditionManager.getFilters(bindingPath) || [];\r\n      // this.filterConditionService.getFilters(bindingPath) || [];\r\n      const conditions = Array.from(originalConditions);\r\n      if (conditions && conditions.length > 0) {\r\n        /* filters.forEach((item: any, index: number) => {\r\n          const field = item.FilterField || null;\r\n          if (field) {\r\n            const duplicateIndex = conditions.findIndex(condition => condition.FilterField === field);\r\n            if (duplicateIndex !== -1) {\r\n              filters[index] = conditions[duplicateIndex];\r\n              conditions.splice(duplicateIndex, 1);\r\n            }\r\n          }\r\n        });*/\r\n        // ä¿®æ¹å½ä»¤ä¸è¿æ»¤æ¡ä»¶çæåä¸ä¸ªæ¥è¯¢å³ç³»ä¸ºand\r\n        if (filters.length > 0) {\r\n          // æåä¸ä¸ªè¿æ»¤æ¡ä»¶\r\n          const lastFilter = filters[filters.length - 1];\r\n          if (lastFilter) {\r\n            if (lastFilter.hasOwnProperty('Relation')) {\r\n              delete lastFilter.Relation;\r\n            }\r\n            lastFilter.relation = 1;\r\n          }\r\n        }\r\n        // åå¹¶æ°çè¿æ»¤æ¡ä»¶ååæ¥å½ä»¤ä¸çè¿æ»¤æ¡ä»¶\r\n        filters.push(...conditions);\r\n      }\r\n    }\r\n\r\n    return JSON.stringify(filters);\r\n  }\r\n  /**\r\n   * åå¹¶æåºæ¡ä»¶\r\n   * @param sort æåºæ¡ä»¶\r\n   */\r\n  private mergeSortConditions(sort: any) {\r\n    if (typeof sort === 'string') {\r\n      sort = JSON.parse(sort) || [];\r\n    }\r\n    const sorts: Array<any> = sort;\r\n    const bindingPath = this.viewModel && this.viewModel.bindingPath || null;\r\n    if (bindingPath) {\r\n      // è·åå½åç»å®è·¯å¾çæææåºæ¡ä»¶\r\n      const originalConditions = this.viewModel && this.viewModel.frameContext.repository.sortConditionManager.getConditionsByBindingPath(bindingPath, (direction) => {\r\n        if (direction === 'asc') {\r\n          return 0;\r\n        } else { return 1; }\r\n      }) || [];\r\n      const conditions = Array.from(originalConditions);\r\n      // å¦æå½åç»å®è·¯å¾ææåºæ¡ä»¶ï¼åå¿½ç¥å½ä»¤ä¸é¢å¶çæåºæ¡ä»¶\r\n      if (conditions && conditions.length > 0) {\r\n        // éåå·²æçè¿æ»¤æ¡ä»¶ï¼å¦ææéå¤çfieldï¼ç¨åèçè¦çå·²æç\r\n        /* sorts.forEach((item: any, index: number) => {\r\n          const field = item.SortField || null;\r\n          if (field) {\r\n            const duplicateIndex = conditions.findIndex(condition => condition.SortField === field);\r\n            if (duplicateIndex !== -1) {\r\n              sorts[index] = conditions[duplicateIndex];\r\n              conditions.splice(duplicateIndex, 1);\r\n            }\r\n          }\r\n        });*/\r\n        return JSON.stringify(conditions);\r\n        // å°å¶ä½æåºæ¡ä»¶æ·»å å°æåºæ°ç»\r\n        // sorts.push(...conditions);\r\n      }\r\n    }\r\n    return JSON.stringify(sorts);\r\n  }\r\n}\r\nexport { ListDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, empty, of, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\nimport { BindingList, Repository, ViewModel } from '@farris/devkit';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\n\r\n/**\r\n * å­åè¡¨åæ°æå¡\r\n */\r\n@Injectable()\r\nclass SubListDataService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    private repository: Repository<any>,\r\n    private loadingService: FormLoadingService,\r\n    private viewModel: ViewModel,\r\n    @Optional() private languageService: LanguageService,\r\n    private formNotifyService: FormNotifyService,\r\n    private formErrorService: FormErrorService\r\n  ) {\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    this.viewModel = viewModel;\r\n  }\r\n\r\n  /**\r\n   * æ°å¢\r\n   */\r\n  add(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'add' });\r\n    }\r\n    const path = this.getPath();\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const append$ = this.repository.appendByPath(path);\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.addFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å¨æå®ä½ç½®æå¥\r\n   * @param position ä½ç½®\r\n   */\r\n  public insert(position: 1 | -1 = -1) {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'insert' });\r\n    }\r\n    const path = this.getPath();\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const append$ = this.repository.insertByPath(path, position);\r\n    return append$.pipe(\r\n      tap(() => {\r\n        this.loadingService.hideDelayLoading(loadingTimerId);\r\n      },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.formErrorService.exception(this.languageService.addFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å é¤å­è¡¨æ°æ®\r\n   */\r\n  remove(id: string, successMsg?: string): Observable<any> {\r\n    const msg = successMsg ? successMsg : '';\r\n    return this.innerRemove(id, false, msg);\r\n  }\r\n\r\n  /**\r\n   * å é¤å­è¡¨æ°æ®ï¼ä¸ç¡®è®¤ï¼\r\n   */\r\n  removeWithoutConfirm(id: string): Observable<any> {\r\n    return this.innerRemove(id, true, '');\r\n  }\r\n\r\n  /**\r\n   * æ¹éå é¤å­è¡¨\r\n   * @param ids ids\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   */\r\n  removeChildrenByIds(ids: string, successMsg?: string): Observable<any> {\r\n    if (!ids) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const action$ = this.msgService.confirm(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return EMPTY;\r\n        }\r\n        const path = this.getPath();\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.batchRemoveByPath(path, ids);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * å é¤\r\n   */\r\n  innerRemove(id: string, isConfirm: boolean, successMsg: string): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'remove' });\r\n    }\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    let action$: Observable<boolean>;\r\n    if (isConfirm === false) {\r\n      action$ = this.msgService.question(this.languageService.confirmDeletion);\r\n    } else {\r\n      action$ = of(true);\r\n    }\r\n\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n        const path = this.getPath();\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeByPath(path, id);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * å é¤å¹¶ä¿å­\r\n   * @param id id\r\n   * @param successMsg èªå®ä¹æç¤ºä¿¡æ¯\r\n   */\r\n  removeAndSave(id: string, successMsg?: string): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'removeAndSave' });\r\n    }\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectDeleteData, { hideTitle: true });\r\n      return empty();\r\n    }\r\n    const action$ = this.msgService.confirm(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n\r\n        // å é¤å­è¡¨æ°æ®\r\n        const path = this.getPath();\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.repository.removeByPath(path, id);\r\n\r\n        return remove$.pipe(\r\n\r\n          // æ§è¡ä¸»è¡¨ä¿å­\r\n          switchMap(() => {\r\n            const fid = this.viewModel.bindingData.list.currentId as string;\r\n            return this.repository.applyChangesById(fid);\r\n          }),\r\n\r\n          // éèå è½½ä¸­\r\n          tap(() => {\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.formErrorService.exception(this.languageService.deleteFailed, error);\r\n            })\r\n        );\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * ä¸ç§»æä¸ç§»æ°æ®\r\n   * @param direction æ¹åï¼up | down\r\n   * @param field æåºå­æ®µ\r\n   * @param targets è¦ç§»å¨çæ°æ®\r\n   * @description\r\n   * ä½¿ç¨è¯¥æ¹æ³æ¶æåºå­æ®µå¿é¡»æå¼ï¼å¦åæ æ³æåº\r\n   */\r\n  public move(direction: string | 'up' | 'down', field: string, targets: Array<any> | string) {\r\n    if (!targets) {\r\n      return;\r\n    }\r\n    if (typeof targets === 'string') {\r\n      targets = targets.split(',').filter(p => p);\r\n    }\r\n    const bindingPath = this.viewModel && this.viewModel.bindingPath || null;\r\n    if (!bindingPath) {\r\n      return;\r\n    }\r\n    const bindingList = this.viewModel.bindingData.getList() as BindingList;\r\n    if (!bindingList || bindingList.length < 1) {\r\n      return;\r\n    }\r\n    targets.forEach((target) => {\r\n      const index = bindingList.getIndexById(target);\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n      const item = bindingList.findById(target);\r\n      const position = item.getValue(field);\r\n      const base = direction === 'up' ? -1 : 1;\r\n      // å¾äº¤æ¢çè¡ä¿¡æ¯\r\n      const exchangeRowIndex = index + base;\r\n      if (exchangeRowIndex < 0 || exchangeRowIndex > bindingList.length) {\r\n        // ç¬¬ä¸è¡æ æ³ä¸ç§»ï¼æåä¸è¡æ æ³ä¸ç§»\r\n        return;\r\n      }\r\n      const exchangeRowId = bindingList.getIdByIndex(exchangeRowIndex);\r\n      const exchangeRow = bindingList.findById(exchangeRowId);\r\n      const exchangeRowPosition = exchangeRow[field];\r\n      // ç§»å¨è¡åäº¤æ¢è¡é½æ²¡ææåº\r\n      if (this.isNullOrEmpty(position) && this.isNullOrEmpty(exchangeRowPosition)) {\r\n        return;\r\n      }\r\n      bindingList.swapById(target, exchangeRowId);\r\n      exchangeRow.setValue(field, position, true, true);\r\n      item.setValue(field, exchangeRowPosition, true, true);\r\n    });\r\n\r\n  }\r\n  private isNullOrEmpty(value: any) {\r\n    return value === '' || value === null || value === undefined;\r\n  }\r\n  /**\r\n   * è·åå®æ´è·¯å¾\r\n   * @todoï¼å¼ºè¯å«å°ä»è¡¨è¿ä¸çº§\r\n   * fixed by justin: æ ¹æ®bindingPathï¼å¦ææ¯ä»ä»è¡¨ï¼éè¦è·åä¸»è¡¨æ°æ®idåä»è¡¨æ°æ®id\r\n   */\r\n  private getPath(): string {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const rid = this.viewModel.bindingData.list.currentId; // rootè¡¨æ°æ®id\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = this.viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          this.formNotifyService.warning(this.languageService['plsSelectDetailFormData'], { hideTitle: true });\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n  /**\r\n   * è·åæ ¹ç»ä»¶appContext\r\n   */\r\n  private get messagePipe() {\r\n    if (this.viewModel && this.viewModel.frameContext) {\r\n      const appContext = this.viewModel.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\nexport { SubListDataService };\r\n","\r\nimport { Entity, FrameContext, BindingData } from '@farris/devkit';\r\nimport { BefRepository, BefRestService } from '@farris/bef';\r\n\r\n/**\r\n * åºç¡æ°æ®æå¡\r\n */\r\nclass BaseDataService {\r\n\r\n  /**\r\n   * æ¡æ¶ä¸ä¸æ\r\n   */\r\n  protected frameContext: FrameContext;\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  protected get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * Restæå¡\r\n   */\r\n  protected get restService(): BefRestService {\r\n    return this.repository.restService;\r\n  }\r\n\r\n  /**\r\n   * æ°æ®ç»å®\r\n   */\r\n  protected get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(frameContext: FrameContext) {\r\n    this.frameContext = frameContext;\r\n  }\r\n\r\n}\r\n\r\nexport { BaseDataService };\r\n","import { BindingData, BindingList } from '@farris/devkit';\r\n\r\n/**\r\n * æ æ°æ®çå¸®å©ç±»\r\n */\r\nclass ParentTreeNodeUtil {\r\n\r\n  /**\r\n   * éä¸­ç¬¬ä¸ä¸ªæ ¹èç¹\r\n   */\r\n  public selectFirstRootNode(bindingData: BindingData, hierarchyInfoKey: string): string {\r\n\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    const firstRootNodeId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    this.selectedNode(bindingData, hierarchyInfoKey, firstRootNodeId);\r\n    return firstRootNodeId;\r\n  }\r\n  public selectNodeByBindingList(bindingList: BindingList, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingList.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n    setTimeout(() => {\r\n      bindingList.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n  /**\r\n   * éä¸­èç¹\r\n   */\r\n  public selectedNode(bindingData: BindingData, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n    if (bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    setTimeout(() => {\r\n      bindingData.list.currentId = null;\r\n      bindingData.list.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦æå­èç¹\r\n   */\r\n  public hasChildNodes(treeNodesData: any[], hierarchyInfoKey: string, fid: string): boolean {\r\n    const fNodeData = this.getNodeDataById(treeNodesData, fid);\r\n    // const fLayer = fNodeData[hierarchyInfoKey]['layer'];\r\n    const fIsDetail = fNodeData[hierarchyInfoKey]['isDetail'];\r\n\r\n    // éæç»èç¹ï¼è¿åtrue\r\n    if (fIsDetail === false) {\r\n      return true;\r\n    }\r\n    return false;\r\n\r\n    // const childNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fid);\r\n    // return childNodesData.length > 0;\r\n  }\r\n\r\n  /**\r\n   * è·åæ ¹èç¹ï¼å¤ä¸ªæ ¹èç¹æ¶è·åç¬¬ä¸ä¸ªï¼\r\n   * @return æ¾ä¸å°æ¶è¿ånull\r\n   */\r\n  private getFirstNodeId(treeNodesData: any[], hierarchyInfoKey: string): string {\r\n    let rootData = treeNodesData.find((itemData: any) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      return layer === 1;\r\n    });\r\n    if (!rootData) {\r\n      const rootLayer = this.getRootLayer(treeNodesData, hierarchyInfoKey);\r\n      rootData = treeNodesData.find((itemData: any) => {\r\n        const layer = itemData[hierarchyInfoKey]['layer'];\r\n        return layer === rootLayer;\r\n      });\r\n    }\r\n    return rootData ? rootData['id'] : '';\r\n  }\r\n  private getRootLayer(treeNodesData: any[], hierarchyInfoKey: string) {\r\n    let layer = null;\r\n    if (treeNodesData && Array.isArray(treeNodesData)) {\r\n      const layers = treeNodesData.map(item => {\r\n        const layer = item[hierarchyInfoKey]['layer'];\r\n        return layer;\r\n      });\r\n      const minLayer = Math.min.apply(Math, layers);\r\n      if (!isNaN(minLayer)) {\r\n        layer = minLayer;\r\n      }\r\n    }\r\n    return layer;\r\n  }\r\n  /**\r\n   * è·åä¸ä¸ä¸ªèç¹ï¼å é¤åï¼\r\n   */\r\n  public getNextNodeId(treeNodesData: any[], hierarchyInfoKey: string, currentId: string): string {\r\n\r\n    // å½åèç¹ä¿¡æ¯\r\n    const currentNodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n    const currentLayer = currentNodeData[hierarchyInfoKey]['layer'];\r\n\r\n    // ç¶èç¹ä¿¡æ¯\r\n    const fLayer = currentLayer - 1;\r\n    const fParentElement = currentNodeData[hierarchyInfoKey]['parentElement'];\r\n\r\n    // æ¥æ¾åå¼èç¹\r\n    const siblingtreeNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fParentElement);\r\n\r\n    // å¦ææ²¡æåå¼èç¹ï¼åä¸æ¥æ¾\r\n    if (siblingtreeNodesData.length === 1) {\r\n      const parentData = treeNodesData.find((itemData: any) => {\r\n        return itemData['id'] === fParentElement;\r\n      });\r\n\r\n      // å­å¨ç¶èç¹ï¼åè®¾ç½®ç¶èç¹ï¼\r\n      // ä¸å­å¨ç¶èç¹ï¼åè®¾ç½®ç¬¬ä¸ä¸ªæ ¹èç¹ã\r\n      if (!parentData) {\r\n        return this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n      }\r\n      return parentData['id'];\r\n    } else {\r\n      return this.getNextSiblingNodeId(siblingtreeNodesData, currentId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åä¸ä¸ªåå¼èç¹çid\r\n   */\r\n  public getNextSiblingNodeId(siblingtreeNodesData: any[], currentId: string): string {\r\n    if (siblingtreeNodesData.length <= 1) {\r\n      return '';\r\n    }\r\n\r\n    const currentIndex = siblingtreeNodesData.findIndex((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n\r\n    // æåä¸è¡ä¸ç§»ä¸è¡ï¼å¶ä»ä¸ç§»ä¸è¡\r\n    let nextIndex = -1;\r\n    if (currentIndex === siblingtreeNodesData.length - 1) {\r\n      nextIndex = currentIndex - 1;\r\n    } else {\r\n      nextIndex = currentIndex + 1;\r\n    }\r\n\r\n    return siblingtreeNodesData[nextIndex]['id'];\r\n  }\r\n\r\n  /**\r\n   * è·åä¸çº§èç¹çBindingObjectséå\r\n   */\r\n  public getChildNodesData(treeNodesData: any[], hierarchyInfoKey: string, fLayer: number, fParentElement: string): any[] {\r\n    const childtreeNodesData = treeNodesData.filter((itemData) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      const parentElement = itemData[hierarchyInfoKey]['parentElement'];\r\n      return (layer === fLayer + 1) && fParentElement == parentElement;\r\n    });\r\n    return childtreeNodesData;\r\n  }\r\n\r\n  /**\r\n   * è·åidè·åèç¹æ°æ®\r\n   */\r\n  public getNodeDataById(treeNodesData: any[], id: string): any {\r\n    const nodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === id;\r\n    });\r\n    return nodeData ? nodeData : null;\r\n  }\r\n}\r\n\r\nexport { ParentTreeNodeUtil };\r\n","import { BindingData, BindingList } from '@farris/devkit';\r\n\r\n/**\r\n * æ æ°æ®çå¸®å©ç±»\r\n */\r\nclass PathTreeNodeUtil {\r\n\r\n  /**\r\n   * éä¸­ç¬¬ä¸ä¸ªæ ¹èç¹\r\n   */\r\n  public selectFirstRootNode(bindingData: BindingData, hierarchyInfoKey: string): string {\r\n\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    const firstRootNodeId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    this.selectedNode(bindingData, hierarchyInfoKey, firstRootNodeId);\r\n    return firstRootNodeId;\r\n  }\r\n  public selectNodeByBindingList(bindingList: BindingList, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingList.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      bindingList.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n  /**\r\n   * éä¸­èç¹\r\n   */\r\n  public selectedNode(bindingData: BindingData, hierarchyInfoKey: string, selectedNodeId: string): void {\r\n    const treeNodesData = bindingData.list.toJSON();\r\n    // å¦æè¦è®¾ç½®çèç¹ä¸å­å¨ï¼åè®¾ç½®ç¬¬1ä¸ªæ ¹èç¹\r\n    const selectedNodeData = this.getNodeDataById(treeNodesData, selectedNodeId);\r\n    let currentId = selectedNodeId;\r\n    if (!selectedNodeData) {\r\n      currentId = this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n    }\r\n    if (bindingData.rowSelectedEventSuspend === true) {\r\n      return;\r\n    }\r\n    setTimeout(() => {\r\n      bindingData.list.currentId = null;\r\n      bindingData.list.setCurrentId(currentId, true, true);\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦æå­èç¹\r\n   */\r\n  public hasChildNodes(treeNodesData: any[], hierarchyInfoKey: string, fid: string): boolean {\r\n    const fNodeData = this.getNodeDataById(treeNodesData, fid);\r\n    // const fLayer = fNodeData[hierarchyInfoKey]['layer'];\r\n    // const fPath  = fNodeData[hierarchyInfoKey]['path'];\r\n    const fIsDetail = fNodeData[hierarchyInfoKey]['isDetail'];\r\n\r\n    // éæç»èç¹ï¼è¿åtrue\r\n    if (fIsDetail === false) {\r\n      return true;\r\n    }\r\n    return false;\r\n    // const childNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fPath);\r\n    // return childNodesData.length > 0;\r\n  }\r\n\r\n  /**\r\n   * è·åæ ¹èç¹ï¼å¤ä¸ªæ ¹èç¹æ¶è·åç¬¬ä¸ä¸ªï¼\r\n   * @return æ¾ä¸å°æ¶è¿ånull\r\n   */\r\n  private getFirstNodeId(treeNodesData: any[], hierarchyInfoKey: string): string {\r\n    let rootData = treeNodesData.find((itemData: any) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      return layer === 1;\r\n    });\r\n    if (!rootData) {\r\n      const rootLayer = this.getRootLayer(treeNodesData, hierarchyInfoKey);\r\n      rootData = treeNodesData.find((itemData: any) => {\r\n        const layer = itemData[hierarchyInfoKey]['layer'];\r\n        return layer === rootLayer;\r\n      });\r\n    }\r\n    return rootData ? rootData['id'] : '';\r\n  }\r\n  private getRootLayer(treeNodesData: any[], hierarchyInfoKey: string) {\r\n    let layer = null;\r\n    if (treeNodesData && Array.isArray(treeNodesData)) {\r\n      const layers = treeNodesData.map(item => {\r\n        const layer = item[hierarchyInfoKey]['layer'];\r\n        return layer;\r\n      });\r\n      const minLayer = Math.min.apply(Math, layers);\r\n      if (!isNaN(minLayer)) {\r\n        layer = minLayer;\r\n      }\r\n    }\r\n    return layer;\r\n  }\r\n  /**\r\n   * è·åä¸ä¸ä¸ªèç¹ï¼å é¤åï¼\r\n   */\r\n  public getNextNodeId(treeNodesData: any[], hierarchyInfoKey: string, currentId: string): string {\r\n\r\n    // å½åèç¹ä¿¡æ¯\r\n    const currentNodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n    const currentPath = currentNodeData[hierarchyInfoKey]['path'];\r\n    const currentLayer = currentNodeData[hierarchyInfoKey]['layer'];\r\n\r\n    // ç¶èç¹ä¿¡æ¯\r\n    const fLayer = currentLayer - 1;\r\n    const fPath = currentPath.substring(0, currentPath.length - 4);\r\n\r\n    // æ¥æ¾åå¼èç¹\r\n    const siblingtreeNodesData = this.getChildNodesData(treeNodesData, hierarchyInfoKey, fLayer, fPath);\r\n\r\n    // å¦ææ²¡æåå¼èç¹ï¼åä¸æ¥æ¾\r\n    if (siblingtreeNodesData.length === 1) {\r\n      const parentData = treeNodesData.find((itemData: any) => {\r\n        return itemData[hierarchyInfoKey]['path'] === fPath;\r\n      });\r\n\r\n      // å­å¨ç¶èç¹ï¼åè®¾ç½®ç¶èç¹ï¼\r\n      // ä¸å­å¨ç¶èç¹ï¼åè®¾ç½®ç¬¬ä¸ä¸ªæ ¹èç¹ã\r\n      if (!parentData) {\r\n        return this.getFirstNodeId(treeNodesData, hierarchyInfoKey);\r\n      }\r\n      return parentData['id'];\r\n    } else {\r\n      return this.getNextSiblingNodeId(siblingtreeNodesData, currentId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åä¸ä¸ªåå¼èç¹çid\r\n   */\r\n  public getNextSiblingNodeId(siblingtreeNodesData: any[], currentId: string): string {\r\n    if (siblingtreeNodesData.length <= 1) {\r\n      return '';\r\n    }\r\n\r\n    const currentIndex = siblingtreeNodesData.findIndex((itemData: any) => {\r\n      return itemData['id'] === currentId;\r\n    });\r\n\r\n    // æåä¸è¡ä¸ç§»ä¸è¡ï¼å¶ä»ä¸ç§»ä¸è¡\r\n    let nextIndex = -1;\r\n    if (currentIndex === siblingtreeNodesData.length - 1) {\r\n      nextIndex = currentIndex - 1;\r\n    } else {\r\n      nextIndex = currentIndex + 1;\r\n    }\r\n\r\n    return siblingtreeNodesData[nextIndex]['id'];\r\n  }\r\n\r\n  /**\r\n   * è·åä¸çº§èç¹çBindingObjectséå\r\n   */\r\n  public getChildNodesData(treeNodesData: any[], hierarchyInfoKey: string, fLayer: number, fPath: string): any[] {\r\n    const childtreeNodesData = treeNodesData.filter((itemData) => {\r\n      const layer = itemData[hierarchyInfoKey]['layer'];\r\n      const path = itemData[hierarchyInfoKey]['path'];\r\n      return (layer === fLayer + 1) && path.startsWith(fPath);\r\n    });\r\n    return childtreeNodesData;\r\n  }\r\n\r\n  /**\r\n   * è·åidè·åèç¹æ°æ®\r\n   */\r\n  public getNodeDataById(treeNodesData: any[], id: string): any {\r\n    const nodeData = treeNodesData.find((itemData: any) => {\r\n      return itemData['id'] === id;\r\n    });\r\n    return nodeData ? nodeData : null;\r\n  }\r\n}\r\n\r\nexport { PathTreeNodeUtil };\r\n","/*\r\n * @Author: aalizzwell \r\n * @Date: 2019-05-30 14:12:39 \r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-05-30 16:18:47\r\n */\r\nimport { ParentTreeNodeUtil } from './parent-tree.util';\r\nimport { PathTreeNodeUtil } from './path-tree.util';\r\n\r\nexport class TreeUtilFactory {\r\n  static getInstance(treeType: string) {\r\n    let util = null;\r\n    switch (treeType) {\r\n      case 'path':\r\n        util = new PathTreeNodeUtil();\r\n        break;\r\n      case 'parent':\r\n        util = new ParentTreeNodeUtil();\r\n        break;\r\n      default: break;\r\n    }\r\n    return util;\r\n  }\r\n}","import { HttpHeaders } from '@angular/common/http';\r\nimport { of, Observable } from 'rxjs';\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { Entity, FieldMetadataUtil, FrameContext, Repository } from '@farris/devkit';\r\nimport { ResponseInfo, BefRepository } from '@farris/bef';\r\n\r\n/**\r\n * ç¶å­æ ä»åº\r\n */\r\nclass ParentTreeRepository {\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addSibling(repository: BefRepository<Entity>, id: string): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSiblingUri = `${baseUri}/service/parenthierarchycreatesibling`;\r\n    const body = {\r\n      dataID: id,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addChild(repository: BefRepository<Entity>, parentId: string) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addChildUri = `${baseUri}/service/parenthierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      dataID: parentId,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å å­è¡¨åå¼èç¹\r\n   */\r\n  public addSubSibling(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubSiblingUri = `${baseUri}/service/childnodeparenthierarchycreatesibling`;\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let path = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(path, responseInfo.returnValue)\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å å­è¡¨å­èç¹\r\n   */\r\n  public addSubChild(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubChildUri = `${baseUri}/service/childnodeparenthierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let paths = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(paths, responseInfo.returnValue);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getPaths(nodes: string[], ids: string[]) {\r\n    let paths = '';\r\n    if (nodes && nodes.length > 0 && ids && ids.length > 0) {\r\n      for (let i = 0; i < ids.length; i++) {\r\n        if (nodes[i]) {\r\n          paths = paths + `/${ids[i]}`;\r\n          paths = paths + `/${nodes[i]}s`;\r\n        }\r\n      }\r\n    }\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * å è½½ç¶èç¹\r\n   */\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadByParentId(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, filters: any[], sorts: any[], frozenCurrentRow: boolean = false, pagination?: { pageSize: number, pageIndex: number }, frameContext?: FrameContext, reload: boolean = false): Observable<Entity[]> {\r\n    const localEntities = this.getChildren(repository, hierarchyInfoKey, parentId);\r\n    if (localEntities && localEntities.length > 0 && !reload) {\r\n      return of(localEntities);\r\n    }\r\n    const restService = repository.restService;\r\n    const parentHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const originalHierarchyInfoKey = this.getOriginalHierarchyInfoKey(repository, hierarchyInfoKey);\r\n    const filtersWithParent = this.buildFiltersWithParent(originalHierarchyInfoKey, parentHierarchyInfo, filters);\r\n    const isUsePagination = pagination && pagination.pageSize > 0 || false;\r\n    // ç»ç»EntityFilter\r\n    const entityFilter = {\r\n      FilterConditions: filtersWithParent,\r\n      SortConditions: sorts,\r\n      IsUsePagination: isUsePagination,\r\n      Pagination: { PageIndex: pagination && pagination.pageIndex || 0, PageSize: pagination && pagination.pageSize || 0, PageCount: 0, TotalCount: 0 }\r\n    };\r\n    const requestInfo = restService.buildRequestInfo();\r\n    return restService.extendQuery(entityFilter, requestInfo).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const paginationInfo = this.getPaginationInfo(responseInfo);\r\n        if (parentId) {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.params.set(`_NODE_${parentId}_PAGINATION_INFO_`, paginationInfo);\r\n          }\r\n        } else {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);\r\n          }\r\n        }\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, parentHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, { isTreeNodeLoadScene: true });\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, { isTreeNodeLoadScene: true });\r\n        }\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadFullTree(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, propertyName: string, fullTreeType: string, loadType: string, filters?: any[], context?: any): Observable<Entity[]> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const queryUrl = `${baseUri}/service/parentidfulltreequery`;\r\n    const parentHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const entityFilter = this.buildEntityFilter(filters, null, 0, 0);\r\n\r\n    const body = {\r\n      dataId: parentId || '',\r\n      isUsePagination: false,\r\n      virtualPropertyName: propertyName,\r\n      pagination: {},\r\n      fullTreeType,\r\n      loadType,\r\n      filter: entityFilter,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(queryUrl, 'PUT', null, options).pipe(\r\n      tap((responseInfo: ResponseInfo) => {\r\n        // ä¿å­å±å¼çèç¹\r\n        if (responseInfo.returnValue && responseInfo.returnValue.selectedRowId && context && context.frameContext) {\r\n          const frameContext = context.frameContext as FrameContext;\r\n          const virtualRootFrameContext = frameContext && frameContext.getVirtualRootFrameContext() || null;\r\n          if (virtualRootFrameContext) {\r\n            const list = responseInfo.returnValue.result as any[];\r\n            const selectedRowId = responseInfo.returnValue.selectedRowId;\r\n            // ä»é¡¶å±å¼å§è®¡ç®ææéè¦å±å¼çèç¹\r\n            const leafNodeInfo = list.find(item => item[repository.primaryKey] === selectedRowId);\r\n            const hierarchyInfo = leafNodeInfo[hierarchyInfoKey] as { isDetail: boolean, layer: number, parentElement: string };\r\n            const ids = this.getAllParentIds(hierarchyInfo, list, hierarchyInfoKey, repository);\r\n            virtualRootFrameContext.params.set('_DEVKIT_expandRowIds', ids.join(','));\r\n            virtualRootFrameContext.params.set('_DEVKIT_selectedRowId', selectedRowId);\r\n            virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', selectedRowId);\r\n          }\r\n        }\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const frozenCurrentRow = context && context.frozenCurrentRow || false;\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, parentHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, { isTreeNodeLoadScene: true });\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, { isTreeNodeLoadScene: true });\r\n        }\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æå¥å¯¹ç¶èç¹çè¿æ»¤\r\n   */\r\n  public buildFiltersWithParent(originalHierarchyInfoKey: string, parentHierarchyInfo: any, filterArray: any[]): any {\r\n    const relationType = filterArray && filterArray.length >= 1 ? 1 : 0;\r\n    const parentLayer = parentHierarchyInfo ? parentHierarchyInfo['layer'] : 0;\r\n    const parentElement = parentHierarchyInfo ? parentHierarchyInfo['id'] : '';\r\n\r\n    const parentFilterArray = [\r\n      {\r\n        \"FilterField\": `${originalHierarchyInfoKey}.Layer`,\r\n        \"Value\": parentLayer + 1,\r\n        \"Lbracket\": null,\r\n        \"Rbracket\": null,\r\n        \"Relation\": 1,\r\n        \"Expresstype\": 0,\r\n        \"Compare\": 0\r\n      }\r\n    ];\r\n    if (parentElement) {\r\n      parentFilterArray.push(\r\n        {\r\n          \"FilterField\": `${originalHierarchyInfoKey}.ParentElement`,\r\n          \"Value\": parentElement,\r\n          \"Lbracket\": null,\r\n          \"Rbracket\": null,\r\n          \"Relation\": relationType,\r\n          \"Expresstype\": 0,\r\n          \"Compare\": 0\r\n        }\r\n      );\r\n    } else {\r\n      parentFilterArray[0].Relation = relationType;\r\n    }\r\n    return parentFilterArray.concat(filterArray);\r\n  }\r\n  public buildEntityFilter(filter: any[], sort: any[], pageSize: number, pageIndex: number) {\r\n\r\n    // @todoï¼ä¸´æ¶å¼å®¹èä»£ç ï¼éä½æ¹å¨å¸¦æ¥çé£é©\r\n    if (!filter && !sort && !pageSize && !pageIndex) {\r\n      return null;\r\n    }\r\n    if (!filter) {\r\n      filter = [];\r\n    }\r\n    if (!sort) {\r\n      sort = [];\r\n    }\r\n    // çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n    if (filter && filter.length > 0) {\r\n      filter[filter.length - 1].Relation = 0;\r\n    }\r\n    const entityFilter = {\r\n      FilterConditions: filter,\r\n      SortConditions: sort,\r\n      IsUsePagination: pageSize === 0 ? false : true,\r\n      Pagination: {\r\n        PageIndex: pageIndex,\r\n        PageSize: pageSize,\r\n        PageCount: 0,\r\n        TotalCount: 0\r\n      }\r\n    };\r\n    return entityFilter;\r\n  }\r\n  /**\r\n   * æ¸ç©ºåä»£å®ä½\r\n   * @description parentHierarchyInfoä¸­layerä¸ºè¦æ¸ç©ºåä»£èç¹çlayerï¼ä½éé¢çparentElementä¸æ¯ç¶çº§çidï¼èæ¯è¦æ¸ç©ºåä»£èç¹çid\r\n   */\r\n  public clearDescendantEntities(repository: BefRepository<Entity>, hierarchyInfokey: string, parentHierarchyInfo: any, frozenCurrentRow: boolean = false): void {\r\n    // æ¸ç©ºæ ¹èç¹\r\n    if (!parentHierarchyInfo) {\r\n      repository.entityCollection.clear();\r\n      return;\r\n    }\r\n    const nodes = this.getChildNodes(repository, hierarchyInfokey, parentHierarchyInfo);\r\n    if (frozenCurrentRow) {\r\n      repository.entityCollection.removeEntities((entity: Entity) => {\r\n        const id = entity[entity.primaryKey];\r\n        return nodes.includes(id);\r\n      });\r\n    } else {\r\n      repository.entityCollection.removeData((entity: Entity) => {\r\n        const id = entity[entity.primaryKey];\r\n        return nodes.includes(id);\r\n      });\r\n    }\r\n\r\n  }\r\n  /**\r\n   * è·åæä¸ªèç¹çææå­èç¹\r\n   * @param repository repository\r\n   * @param hierarchyInfokey hierarchyInfokey\r\n   * @param parentHierarchyInfo parentHierarchyInfo\r\n   */\r\n  private getChildNodes(repository: BefRepository<Entity>, hierarchyInfokey: string, parentHierarchyInfo: any) {\r\n    const fparentElement = parentHierarchyInfo.id;\r\n    const flayer = parentHierarchyInfo.layer;\r\n    let nodes = [];\r\n    repository.entityCollection.getAllEntities().forEach(entity => {\r\n      const hierarchyInfo = entity[hierarchyInfokey];\r\n      const parentElement = hierarchyInfo.parentElement;\r\n      const layer = hierarchyInfo.layer;\r\n      const result = layer >= (flayer + 1) && parentElement === fparentElement;\r\n      if (result) {\r\n        const id = entity[entity.primaryKey];\r\n        nodes.push(id);\r\n        const childHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfokey, id);\r\n        const childs = this.getChildNodes(repository, hierarchyInfokey, childHierarchyInfo);\r\n        if (childs && childs.length > 0) {\r\n          nodes = nodes.concat(childs);\r\n        }\r\n      }\r\n    });\r\n    return nodes;\r\n  }\r\n  /**\r\n   * è·åå®ä½çåçº§ä¿¡æ¯\r\n   */\r\n  public getHierarchyInfoById(repository: BefRepository<Entity>, hierarchyInfokey: string, id: string): any {\r\n    if (!id) {\r\n      return null;\r\n    }\r\n    const entity: Entity = repository.entityCollection.getEntityById(id);\r\n    const hierarchyInfoEntity: Entity = entity[hierarchyInfokey];\r\n    const result = hierarchyInfoEntity.toJSON();\r\n    result['id'] = id;\r\n    return result;\r\n  }\r\n  public getHierarchyInfo(entity: Entity, hierarchyInfokey: string): { parentElement: string, layer: number, isDetail: boolean } {\r\n    return entity[hierarchyInfokey];\r\n  }\r\n  /**\r\n   * è·ååçº§ç çåå§çå­æ®µå\r\n   */\r\n  public getOriginalHierarchyInfoKey(repository: BefRepository<Entity>, hierarchyInfokey: string): string {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(repository.entityType);\r\n    const hierarchyInfoNgObject = ngObjects[hierarchyInfokey];\r\n    return hierarchyInfoNgObject.originalDataField as string;\r\n  }\r\n  private getPaginationInfo(responseInfo: ResponseInfo) {\r\n    return responseInfo && responseInfo.returnValue && responseInfo.returnValue.pagination || null;\r\n  }\r\n  private findParent(hierarchyInfo: { isDetail: boolean, layer: number, parentElement: string }, list: any[], hierarchyInfoKey: string) {\r\n    return list.find(item => {\r\n      const currentHierarchyInfo = item[hierarchyInfoKey] as { isDetail: boolean, layer: number, parentElement: string };\r\n      return currentHierarchyInfo.layer === hierarchyInfo.layer - 1 && hierarchyInfo.parentElement === currentHierarchyInfo.parentElement;\r\n    });\r\n  }\r\n  private getAllParentIds(hierarchyInfo: { isDetail: boolean, layer: number, parentElement: string }, list: any[], hierarchyInfoKey: string, repository: Repository<any>) {\r\n    let item = this.findParent(hierarchyInfo, list, hierarchyInfoKey);\r\n    const ids = [];\r\n    while (item) {\r\n      ids.push(item[repository.primaryKey]);\r\n      item = this.findParent(item[hierarchyInfoKey], list, hierarchyInfoKey);\r\n    }\r\n    return ids;\r\n  }\r\n  /**\r\n   * æ¥æ¾èç¹ä¸ææå­çº§ï¼ç¬¬ä¸çº§ï¼\r\n   * @param repository repository\r\n   * @param hierarchyInfoKey åçº§ç å­æ®µ\r\n   * @param id id\r\n   * @returns \r\n   */\r\n  private getChildren(repository: BefRepository<Entity>, hierarchyInfoKey: string, id: string): Entity[] {\r\n    const hierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, id);\r\n    if (!hierarchyInfo) {\r\n      return null;\r\n    }\r\n    const layer = hierarchyInfo.layer;\r\n    const parentElement = hierarchyInfo.parentElement;\r\n    const entities: Entity[] = repository.entityCollection.getEntities((entity: Entity) => {\r\n      const hierarchyInfo = this.getHierarchyInfo(entity, hierarchyInfoKey);\r\n      const matched = hierarchyInfo.layer === layer + 1 && (hierarchyInfo.parentElement === parentElement || !parentElement && !hierarchyInfo.parentElement);\r\n      if (matched) {\r\n        return entity;\r\n      } else {\r\n        return null;\r\n      }\r\n    });\r\n    return entities;\r\n  }\r\n}\r\n\r\nexport { ParentTreeRepository };\r\n","import { HttpHeaders } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, tap } from 'rxjs/operators';\r\nimport { Entity, FieldMetadataUtil, FrameContext, Repository } from '@farris/devkit';\r\nimport { ResponseInfo, BefRepository } from '@farris/bef';\r\n\r\n/**\r\n * è·¯å¾æ ä»åº\r\n */\r\nclass PathTreeRepository {\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addSibling(repository: BefRepository<Entity>, id: string): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSiblingUri = `${baseUri}/service/pathhierarchycreatesibling`;\r\n    const body = {\r\n      dataID: id,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å åå¼èç¹\r\n   */\r\n  public addChild(repository: BefRepository<Entity>, parentId: string) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addChildUri = `${baseUri}/service/pathhierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      dataID: parentId,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const entity = repository.buildEntity(responseInfo.returnValue);\r\n        repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ·»å å­è¡¨åå¼èç¹\r\n   */\r\n  public addSubSibling(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>): Observable<Entity> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubSiblingUri = `${baseUri}/service/childnodepathhierarchycreatesibling`;\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubSiblingUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let path = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(path, responseInfo.returnValue)\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n  * æ·»å å­è¡¨å­èç¹\r\n  */\r\n  public addSubChild(repository: BefRepository<Entity>, nodes: Array<string>, ids: Array<string>) {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const addSubChildUri = `${baseUri}/service/childnodepathhierarchycreatechildlayer`;\r\n\r\n    const body = {\r\n      nodes: nodes,\r\n      ids: ids,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      headers: new HttpHeaders({ 'Content-Type': 'application/json' }),\r\n      body: body\r\n    };\r\n    return restService.invoke(addSubChildUri, 'PUT', null, options).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        let path = this.getPaths(nodes, ids);\r\n        const entity = repository.entityManager.appendEntityByPath(path, responseInfo.returnValue)\r\n        return entity;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getPaths(nodes: string[], ids: string[]) {\r\n    let paths = '';\r\n    if (nodes && nodes.length > 0 && ids && ids.length > 0) {\r\n      for (let i = 0; i < ids.length; i++) {\r\n        if (nodes[i]) {\r\n          paths = paths + `/${ids[i]}`;\r\n          paths = paths + `/${nodes[i]}s`;\r\n        }\r\n      }\r\n    }\r\n    return paths;\r\n  }\r\n\r\n  /**\r\n   * å è½½ç¶èç¹\r\n   */\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadByParentId(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, filters: any[], sorts: any[], frozenCurrentRow: boolean = false, pagination?: { pageSize: number, pageIndex: number }, frameContext?: FrameContext, reload: boolean = false): Observable<Entity[]> {\r\n    const localEntities = this.getChildren(repository, hierarchyInfoKey, parentId);\r\n    if (localEntities && localEntities.length > 0 && !reload) {\r\n      return of(localEntities);\r\n    }\r\n    const restService = repository.restService;\r\n    const parentHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const originalHierarchyInfoKey = this.getOriginalHierarchyInfoKey(repository, hierarchyInfoKey);\r\n    const filtersWithParent = this.buildFiltersWithParent(originalHierarchyInfoKey, parentHierarchyInfo, filters);\r\n    const isUsePagination = pagination && pagination.pageSize > 0 || false;\r\n    // ç»ç»EntityFilter\r\n    const entityFilter = {\r\n      FilterConditions: filtersWithParent,\r\n      SortConditions: sorts,\r\n      IsUsePagination: isUsePagination,\r\n      Pagination: { PageIndex: pagination && pagination.pageIndex || 0, PageSize: pagination && pagination.pageSize || 0, PageCount: 0, TotalCount: 0 }\r\n    };\r\n    const requestInfo = restService.buildRequestInfo();\r\n    return restService.extendQuery(entityFilter, requestInfo).pipe(\r\n      map((responseInfo: ResponseInfo) => {\r\n        const paginationInfo = this.getPaginationInfo(responseInfo);\r\n        if (parentId) {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.params.set(`_NODE_${parentId}_PAGINATION_INFO_`, paginationInfo);\r\n          }\r\n        } else {\r\n          if (paginationInfo && paginationInfo.pageSize !== 0 && frameContext) {\r\n            frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);\r\n          }\r\n        }\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, parentHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, { isTreeNodeLoadScene: true });\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, { isTreeNodeLoadScene: true });\r\n        }\r\n\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  // tslint:disable-next-line: max-line-length\r\n  public loadFullTree(repository: BefRepository<Entity>, hierarchyInfoKey: string, parentId: string, propertyName: string, fullTreeType: string, loadType: string, filters?: any[], context?: any): Observable<Entity[]> {\r\n    const restService = repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const queryUrl = `${baseUri}/service/parentidfulltreequery`;\r\n    const pathHierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, parentId);\r\n    const entityFilter = this.buildEntityFilter(filters, null, 0, 0);\r\n    const body = {\r\n      dataId: parentId || '',\r\n      isUsePagination: false,\r\n      virtualPropertyName: propertyName,\r\n      pagination: {},\r\n      fullTreeType,\r\n      loadType,\r\n      filter: entityFilter,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(queryUrl, 'PUT', null, options).pipe(\r\n      tap((responseInfo: ResponseInfo) => {\r\n        // ä¿å­å±å¼çèç¹\r\n        if (responseInfo.returnValue && responseInfo.returnValue.selectedRowId && context && context.frameContext) {\r\n          const frameContext = context.frameContext as FrameContext;\r\n          const virtualRootFrameContext = frameContext && frameContext.getVirtualRootFrameContext() || null;\r\n          if (virtualRootFrameContext) {\r\n            const list = responseInfo.returnValue.result as any[];\r\n            const selectedRowId = responseInfo.returnValue.selectedRowId;\r\n            // ä»é¡¶å±å¼å§è®¡ç®ææéè¦å±å¼çèç¹\r\n            const leafNodeInfo = list.find(item => item[repository.primaryKey] === selectedRowId);\r\n            const hierarchyInfo = leafNodeInfo[hierarchyInfoKey] as { isDetail: boolean, layer: number, path: string };\r\n            const ids = this.getAllParentIds(hierarchyInfo, list, hierarchyInfoKey, repository);\r\n            virtualRootFrameContext.params.set('_DEVKIT_expandRowIds', ids.join(','));\r\n            virtualRootFrameContext.params.set('_DEVKIT_selectedRowId', selectedRowId);\r\n            virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', selectedRowId);\r\n          }\r\n        }\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const frozenCurrentRow: boolean = context && context.frozenCurrentRow || false;\r\n        // åæ¸ç©ºä¸çº§å®ä½\r\n        this.clearDescendantEntities(repository, hierarchyInfoKey, pathHierarchyInfo, frozenCurrentRow);\r\n        // è¿½å ä¸çº§å®ä½\r\n        const listData = responseInfo.returnValue.result;\r\n        const entities = repository.buildEntities(listData);\r\n        if (frozenCurrentRow) {\r\n          repository.entityCollection.addData(entities, {isTreeNodeLoadScene: true});\r\n        } else {\r\n          repository.entityCollection.addEntities(entities, {isTreeNodeLoadScene: true});\r\n        }\r\n        return entities;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æå¥å¯¹ç¶èç¹çè¿æ»¤\r\n   */\r\n  public buildFiltersWithParent(originalHierarchyInfoKey: string, parentHierarchyInfo: any, filterArray: any[]): any {\r\n    const relationType = filterArray && filterArray.length >= 1 ? 1 : 0;\r\n\r\n    const parentLayer = parentHierarchyInfo ? parentHierarchyInfo['layer'] : 0;\r\n    const parentFilterArray = [\r\n      {\r\n        \"FilterField\": `${originalHierarchyInfoKey}.Layer`,\r\n        \"Value\": parentLayer + 1,\r\n        \"Lbracket\": null,\r\n        \"Rbracket\": null,\r\n        \"Relation\": 1,\r\n        \"Expresstype\": 0,\r\n        \"Compare\": 0\r\n      }\r\n    ];\r\n\r\n    // ç¶è·¯å¾è¿æ»¤ï¼å¦æä¸ºç©ºï¼åä¸æ·»å ï¼å¼å®¹oracleåæ°ï¼\r\n    const parentPath = parentHierarchyInfo ? parentHierarchyInfo['path'] : '';\r\n    if (parentPath) {\r\n      parentFilterArray.push({\r\n        \"FilterField\": `${originalHierarchyInfoKey}.Path`,\r\n        \"Value\": parentPath,\r\n        \"Lbracket\": null,\r\n        \"Rbracket\": null,\r\n        \"Relation\": relationType,\r\n        \"Expresstype\": 0,\r\n        \"Compare\": 7\r\n      });\r\n    } else {\r\n      parentFilterArray[0].Relation = relationType;\r\n    }\r\n\r\n    return parentFilterArray.concat(filterArray);\r\n  }\r\n  public buildEntityFilter(filter: any[], sort: any[], pageSize: number, pageIndex: number) {\r\n\r\n    // @todoï¼ä¸´æ¶å¼å®¹èä»£ç ï¼éä½æ¹å¨å¸¦æ¥çé£é©\r\n    if (!filter && !sort && !pageSize && !pageIndex) {\r\n      return null;\r\n    }\r\n    if (!filter) {\r\n      filter = [];\r\n    }\r\n    if (!sort) {\r\n      sort = [];\r\n    }\r\n    // çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n    if (filter && filter.length > 0) {\r\n      filter[filter.length - 1].Relation = 0;\r\n    }\r\n    const entityFilter = {\r\n      FilterConditions: filter,\r\n      SortConditions: sort,\r\n      IsUsePagination: pageSize === 0 ? false : true,\r\n      Pagination: {\r\n        PageIndex: pageIndex,\r\n        PageSize: pageSize,\r\n        PageCount: 0,\r\n        TotalCount: 0\r\n      }\r\n    };\r\n    return entityFilter;\r\n  }\r\n  /**\r\n   * æ¸ç©ºåä»£å®ä½\r\n   */\r\n  public clearDescendantEntities(repository: BefRepository<Entity>, hierarchyInfokey: string, parentHierarchyInfo: any, frozenCurrentRow: boolean = false): void {\r\n\r\n    // æ¸ç©ºæ ¹èç¹\r\n    if (!parentHierarchyInfo) {\r\n      repository.entityCollection.clear();\r\n      return;\r\n    }\r\n    const fPath = parentHierarchyInfo.path;\r\n    const fLayer = parentHierarchyInfo.layer;\r\n    if (frozenCurrentRow) {\r\n      repository.entityCollection.removeData((entity: Entity) => {\r\n        const hierarchyInfo = entity[hierarchyInfokey];\r\n        const path = hierarchyInfo.path;\r\n        const layer = hierarchyInfo.layer;\r\n        return layer > fLayer && path.startsWith(fPath);\r\n      });\r\n    } else {\r\n      repository.entityCollection.removeEntities((entity: Entity) => {\r\n        const hierarchyInfo = entity[hierarchyInfokey];\r\n        const path = hierarchyInfo.path;\r\n        const layer = hierarchyInfo.layer;\r\n        return layer > fLayer && path.startsWith(fPath);\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * è·åå®ä½çåçº§ä¿¡æ¯\r\n   */\r\n  public getHierarchyInfoById(repository: BefRepository<Entity>, hierarchyInfokey: string, id: string): any {\r\n    if (!id) {\r\n      return null;\r\n    }\r\n    const entity: Entity = repository.entityCollection.getEntityById(id);\r\n    const hierarchyInfoEntity: Entity = entity[hierarchyInfokey];\r\n    return hierarchyInfoEntity.toJSON();\r\n  }\r\n\r\n  /**\r\n   * è·ååçº§ç çåå§çå­æ®µå\r\n   */\r\n  public getOriginalHierarchyInfoKey(repository: BefRepository<Entity>, hierarchyInfokey: string): string {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(repository.entityType);\r\n    const hierarchyInfoNgObject = ngObjects[hierarchyInfokey];\r\n    return hierarchyInfoNgObject.originalDataField as string;\r\n  }\r\n  private getPaginationInfo(responseInfo: ResponseInfo) {\r\n    return responseInfo && responseInfo.returnValue && responseInfo.returnValue.pagination || null;\r\n  }\r\n  private findParent(hierarchyInfo: { isDetail: boolean, layer: number, path: string }, list: any[], hierarchyInfoKey: string) {\r\n    return list.find(item => {\r\n      const currentHierarchyInfo = item[hierarchyInfoKey] as { isDetail: boolean, layer: number, path: string };\r\n      return currentHierarchyInfo.layer === hierarchyInfo.layer - 1 && hierarchyInfo.path.startsWith(currentHierarchyInfo.path);\r\n    });\r\n  }\r\n  private getAllParentIds(hierarchyInfo: { isDetail: boolean, layer: number, path: string }, list: any[], hierarchyInfoKey: string, repository: Repository<any>) {\r\n    let item = this.findParent(hierarchyInfo, list, hierarchyInfoKey);\r\n    const ids = [];\r\n    while (item) {\r\n      ids.push(item[repository.primaryKey]);\r\n      item = this.findParent(item[hierarchyInfoKey], list, hierarchyInfoKey);\r\n    }\r\n    return ids;\r\n  }\r\n  private getHierarchyInfo(entity: Entity, hierarchyInfoKey: string): { path: string, layer: number, isDetail: boolean } {\r\n    return entity[hierarchyInfoKey];\r\n  }\r\n  /**\r\n   * æ¥æ¾èç¹ä¸ææå­çº§ï¼ç¬¬ä¸çº§ï¼\r\n   * @param repository repository\r\n   * @param hierarchyInfoKey åçº§ç å­æ®µ\r\n   * @param id id\r\n   * @returns \r\n   */\r\n  private getChildren(repository: BefRepository<Entity>, hierarchyInfoKey: string, id: string): Entity[] {\r\n    const hierarchyInfo = this.getHierarchyInfoById(repository, hierarchyInfoKey, id);\r\n    if (!hierarchyInfo) {\r\n      return null;\r\n    }\r\n    const layer = hierarchyInfo.layer;\r\n    const path = hierarchyInfo.path;\r\n    const entities: Entity[] = repository.entityCollection.getEntities((entity: Entity) => {\r\n      const hierarchyInfo = this.getHierarchyInfo(entity, hierarchyInfoKey);\r\n      const matched = hierarchyInfo.layer === layer + 1 && hierarchyInfo.path.startsWith(path);\r\n      if (matched) {\r\n        return entity;\r\n      } else {\r\n        return null;\r\n      }\r\n    });\r\n    return entities;\r\n  }\r\n}\r\n\r\nexport { PathTreeRepository };\r\n","import { ParentTreeRepository } from './parent-tree-repository';\r\nimport { PathTreeRepository } from './path-tree-repository';\r\n\r\nexport class TreeRepositoryFactory {\r\n    static getInstance(treeType: string){\r\n        let repository=null;\r\n        switch (treeType) {\r\n            case \"path\":\r\n                repository = new PathTreeRepository();\r\n                break;\r\n            case \"parent\":\r\n                repository = new ParentTreeRepository();\r\n                break;\r\n            default: break;\r\n        }\r\n        return repository;\r\n    }\r\n}","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of, empty, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\n\r\nimport { Entity, FrameContext, FieldMetadataUtil, NgFieldProperty } from '@farris/devkit';\r\nimport { BefRepository, BefRepositoryUtil } from '@farris/bef';\r\n\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\n\r\nimport { BaseDataService } from './base-data.service';\r\nimport { EditStateUtil } from './utils/index';\r\nimport { TreeUtilFactory } from './tree-table/util/tree-util-factory';\r\nimport { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';\r\nimport { DataChangeDetectionService } from '../data-change-detection.service';\r\n// tslint:disable: no-string-literal\r\n\r\n/**\r\n * æ æ°æ®æå¡\r\n */\r\n@Injectable()\r\nclass TreeDataService extends BaseDataService {\r\n\r\n  /**\r\n   * åçº§ä¿¡æ¯å­æ®µå\r\n   */\r\n  private get hierarchyInfoKey(): string {\r\n    return this.virtualRootFrameContext.getParam('hierarchyInfoKey');\r\n  }\r\n  private get virtualRootFrameContext() {\r\n    return this.frameContext.getVirtualRootFrameContext();\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    frameContext: FrameContext,\r\n    private messageService: FormMessageService,\r\n    private loadingService: FormLoadingService,\r\n    private notifyService: FormNotifyService,\r\n    private errorService: FormErrorService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    super(frameContext);\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å è½½æ°æ®\r\n   */\r\n  public load(filters?: string, sorts?: string): Observable<Entity[]> {\r\n    const filtersArray = this.parseConditions(filters);\r\n    const sortsArray = this.parseConditions(sorts);\r\n    const correctSelectedNode = this.repository.entityCollection.count() === 0;\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const query$ = this.repository.getEntities(filtersArray, sortsArray, null, null);\r\n    return query$.pipe(\r\n      tap(\r\n        () => {\r\n\r\n          // çº æ­£éä¸­èç¹\r\n          if (correctSelectedNode === true) {\r\n            const hierarchyType = this.getHierarchyType();\r\n            const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n            if (treeNodeUtil !== null) {\r\n              treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n            }\r\n          }\r\n\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åå±å è½½æ°æ®\r\n   */\r\n  public loadByLevel(filters?: string, sorts?: string, frozenCurrentRow?: boolean | string): Observable<Entity[]> {\r\n    this.setLoadByLevelState(filters, sorts);\r\n    const filtersArray = this.parseConditions(filters);\r\n    const sortsArray = this.parseConditions(sorts);\r\n    // const parentId = this.bindingData.list.currentId;\r\n    const parentId = this.getIdToExpand();\r\n    const correctSelectedNode = this.repository.entityCollection.count() === 0;\r\n    if (frozenCurrentRow === undefined) {\r\n      frozenCurrentRow = false;\r\n    }\r\n    if (typeof frozenCurrentRow !== 'boolean') {\r\n      frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;\r\n    }\r\n    const hierarchyType = this.getHierarchyType();\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n\r\n    if (repository === null) {\r\n      return empty();\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    // æé åé¡µä¿¡æ¯\r\n    const pagination = this.buildPaginationInfo(parentId);\r\n    const reload = this.frameContext.params.get('_RELOAD_CHILDREN_') || false;\r\n    const query$ = repository.loadByParentId(this.repository, this.hierarchyInfoKey, parentId, filtersArray, sortsArray, frozenCurrentRow, pagination, this.frameContext, reload);\r\n    return query$.pipe(\r\n      tap(\r\n        (entities: Entity[]) => {\r\n          this.frameContext.params.delete('_RELOAD_CHILDREN_');\r\n          // çº æ­£éä¸­èç¹\r\n          if (correctSelectedNode === true) {\r\n            const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n            if (treeNodeUtil !== null) {\r\n              treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n            }\r\n          }\r\n          const currentRowId = this.bindingData.list.currentItem.primaryKeyValue;\r\n          if (frozenCurrentRow) {\r\n            // å¦æä¸ä¸æ¬¡éä¸­è¡ä¸ºæ¬æ¬¡å è½½æ°æ®ä¸­çä¸æ¡ï¼ååºè¯¥éæ°éä¸­è¯¥è¡\r\n            const containsCurrentRow = entities.find(item => item.primaryValue === currentRowId);\r\n            if (containsCurrentRow) {\r\n              this.setCurrentId(currentRowId);\r\n            }\r\n            // åæ¥çå½åè¡ä¸å¨å·²ç»å è½½çæ°æ®ä¸­ï¼å¦å±å¼å°ç¬¬ä¸çº§ï¼å°ç¬¬ä¸çº§çæè¡è®¾ä¸ºå½åè¡ï¼å¨é¨æ¶èµ·ï¼å±å¼ç¬¬ä¸çº§\r\n            if (!this.repository.entityCollection.getEntityById(currentRowId)) {\r\n              const firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;\r\n              if (firstChildId) {\r\n                this.setCurrentId(firstChildId);\r\n              }\r\n            }\r\n          }\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * å è½½å®æ´æ \r\n   * @param virtualPropertyName èæå­æ®µ\r\n   * @param fullTreeType æ¯å¦æ¯å®æ´æ å è½½ 0ï¼å®æ´æ  1ï¼é¨åæ \r\n   * @param loadType æ¯å¦åçº§å è½½ 0ï¼å¨é¨å è½½ 1ï¼åçº§å è½½\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param frozenCurrentRow å»ç»å½åè¡\r\n   */\r\n  public loadFullTree(virtualPropertyName: string, fullTreeType: string, loadType: string, filters: string, frozenCurrentRow?: boolean | string): Observable<Entity[]> {\r\n    if (typeof fullTreeType !== 'string') {\r\n      throw new Error('ArgumentError: fullTreeType ä¸è½ä¸ºç©ºä¸å¿é¡»ä¸ºå­ç¬¦ä¸²ã');\r\n    }\r\n    if (typeof loadType !== 'string') {\r\n      throw new Error('ArgumentError: loadType ä¸è½ä¸ºç©ºä¸å¿é¡»ä¸ºå­ç¬¦ä¸²ã');\r\n    }\r\n    if (frozenCurrentRow === undefined) {\r\n      frozenCurrentRow = false;\r\n    }\r\n    if (typeof frozenCurrentRow !== 'boolean') {\r\n      frozenCurrentRow = frozenCurrentRow === 'true' ? true : false;\r\n    }\r\n    const virtualRootFrameContext = this.virtualRootFrameContext;\r\n    // è¿åä¸æ¬¡è®¾ç½®çç»æé\r\n    virtualRootFrameContext.params.delete('_DEVKIT_expandRowIds');\r\n    virtualRootFrameContext.params.delete('_DEVKIT_selectedRowId');\r\n    virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', null);\r\n    const filtersArray = this.parseConditions(filters);\r\n    const parentId = this.getIdToExpand();\r\n    const correctSelectedNode = this.repository.entityCollection.count() === 0;\r\n    const hierarchyType = this.getHierarchyType();\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n\r\n    if (repository === null) {\r\n      return EMPTY;\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const context = {\r\n      frameContext: this.frameContext,\r\n      frozenCurrentRow\r\n    };\r\n    // tslint:disable-next-line: max-line-length\r\n    const query$ = repository.loadFullTree(this.repository, this.hierarchyInfoKey, parentId, virtualPropertyName, fullTreeType, loadType, filtersArray, context);\r\n    return query$.pipe(\r\n      tap(\r\n        (entities: Entity[]) => {\r\n          const selectedRowId = virtualRootFrameContext.params.get('_DEVKIT_selectedRowId');\r\n          // çº æ­£éä¸­èç¹\r\n          if (correctSelectedNode === true || !selectedRowId) {\r\n            const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n            if (treeNodeUtil !== null) {\r\n              const computedFirstRowId = treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n              if (computedFirstRowId) {\r\n                virtualRootFrameContext.uiState.setPropertyValue('__DEVKIT__selectedRow', computedFirstRowId);\r\n              }\r\n            }\r\n          }\r\n          const currentRowId = this.bindingData.list.currentItem.primaryKeyValue;\r\n          if (frozenCurrentRow) {\r\n            // å¦æä¸ä¸æ¬¡éä¸­è¡ä¸ºæ¬æ¬¡å è½½æ°æ®ä¸­çä¸æ¡ï¼ååºè¯¥éæ°éä¸­è¯¥è¡\r\n            const containsCurrentRow = entities.find(item => item.primaryValue === currentRowId);\r\n            if (containsCurrentRow) {\r\n              this.setCurrentId(currentRowId);\r\n            }\r\n            // åæ¥çå½åè¡ä¸å¨å·²ç»å è½½çæ°æ®ä¸­ï¼å¦å±å¼å°ç¬¬ä¸çº§ï¼å°ç¬¬ä¸çº§çæè¡è®¾ä¸ºå½åè¡ï¼å¨é¨æ¶èµ·ï¼å±å¼ç¬¬ä¸çº§\r\n            if (!this.repository.entityCollection.getEntityById(currentRowId) && entities && entities.length > 0) {\r\n              const firstChildId = entities && Array.isArray(entities) && entities.length > 0 && entities[0].primaryValue || null;\r\n              if (firstChildId) {\r\n                this.setCurrentId(firstChildId);\r\n              }\r\n            }\r\n          }\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.loadFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * è·åææ°å±å¼çèç¹\r\n   */\r\n  public getIdToExpand() {\r\n    const expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    const idToExpand = expandNodes.pop();\r\n    this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n    return idToExpand;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®ææ°å±å¼çèç¹\r\n   */\r\n  public setIdToExpand(idToExpand: string): void {\r\n    const expandNodes = this.virtualRootFrameContext.getParam('TREE_LATEST_EXPANDED_ID') || [];\r\n    expandNodes.push(idToExpand);\r\n    this.virtualRootFrameContext.setParam('TREE_LATEST_EXPANDED_ID', expandNodes);\r\n  }\r\n\r\n  /**\r\n   * è§£æè¿æ»¤æ¡ä»¶\r\n   */\r\n  public parseConditions(conditions?: string): any[] {\r\n    const conditionsString = (!conditions || conditions === '') ? '[]' : conditions;\r\n    return JSON.parse(conditionsString);\r\n  }\r\n\r\n  /**\r\n   * æ°å¢åçº§\r\n   */\r\n  public addSibling(id: string): Observable<any> {\r\n\r\n    // è®¾è®¡æ¶idçè·åæ¹ä¸ºä»å½ä»¤åæ°ä¸è·åï¼ä½è®¾è®¡æ¶æ²¡æåæ°å¿å¡«æ£æ¥ï¼\r\n    // å¦ææå¼è¡¨åä¿å­äºï¼å³æ´æ°äºææ°çå½ä»¤æä»¶ï¼ï¼ä½æ²¡æéç½®è¯¥åæ°ï¼å¯è½ä¼ä¼ éè¿æ¥ä¸ä¸ªç©ºå¼ï¼\r\n    // ä¸ºäºå¼å®¹æ­¤æåµï¼ä½¿ç¨å½åè¡idä½ä¸ºidçå¼\r\n    id = id ? id : this.bindingData.list.currentId;\r\n\r\n    // åæ°æ£æ¥\r\n    if (!id || id === 'undefined') {\r\n      id = '';\r\n    }\r\n\r\n    // è®°å½æè¿ä¸æ¬¡ä¿®æ¹çæ°æ®id\r\n    const lastModifiedId = this.bindingData.list.currentId;\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType: string = this.getHierarchyType();\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      // éè¯¯çåçº§ç \r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const result$ = repository.addSibling(this.repository, id);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.virtualRootFrameContext.setParam('IS_ADD', true);\r\n          this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.addSiblingFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ°å¢ä¸çº§\r\n   */\r\n  public addChild(id: string): Observable<any> {\r\n\r\n    // åå åaddSiblingçä¿®æ¹\r\n    id = id ? id : this.bindingData.list.currentId;\r\n\r\n    // åæ°æ£æ¥\r\n    if (!id) {\r\n      // è¯·éæ©ç¶èç¹\r\n      this.notifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    // è®°å½æè¿ä¸æ¬¡ä¿®æ¹çæ°æ®id\r\n    const lastModifiedId = this.bindingData.list.currentId;\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType = this.getHierarchyType();\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n\r\n    // æ°å¢çæ¶åï¼è¦å±å¼ç¶èç¹\r\n    this.setIdToExpand(id);\r\n    const reloadChild$ = this.reloadByLevel();\r\n\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const addChild$ = repository.addChild(this.repository, id);\r\n    const result$ = reloadChild$.pipe(\r\n      switchMap(() => {\r\n        return addChild$;\r\n      }),\r\n      tap(\r\n        () => {\r\n          this.virtualRootFrameContext.setParam('IS_ADD', true);\r\n          this.virtualRootFrameContext.setParam('LAST_MODIFIED_ID', lastModifiedId);\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.addChildFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * æ¹éä¿å­\r\n   */\r\n  public save(): Observable<boolean> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'save' });\r\n    }\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const save$ = this.repository.applyChanges();\r\n    const result$ = save$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.notifyService.success(this.languageService.saveSuccess, { hideTitle: true });\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.multiSaveFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * å é¤\r\n   */\r\n  public remove(id: string, successMsg?: string): Observable<boolean> {\r\n\r\n    // åå åaddSibling\r\n    id = id ? id : this.bindingData.list.currentId;\r\n\r\n    // åæ°æ£æ¥\r\n    if (!id) {\r\n      this.notifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    // å­å¨å­èç¹ä¸åè®¸å é¤\r\n    const treeNodesData = this.repository.entityCollection.toJSON();\r\n    const hierarchyType = this.getHierarchyType();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil === null) {\r\n      return empty();\r\n    }\r\n    if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {\r\n      this.notifyService.warning(this.languageService['deleteChildFirst'], { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    // ç¡®è®¤å é¤\r\n    const action$ = this.messageService.question(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return empty();\r\n        }\r\n\r\n        // è·åå é¤åè¦è®¾ç½®çèç¹id\r\n        const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, id);\r\n\r\n        // æ§è¡å é¤\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        const remove$ = this.frameContext.repository.removeById(id);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n\r\n            // è®¾ç½®éä¸­èç¹\r\n            treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);\r\n\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.notifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.errorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åæ¶æ¶æ£æµæªä¿å­è®°å½\r\n   */\r\n  public cancel(): Observable<any> {\r\n    const hasChange$ = DataChangeDetectionService.hasChange(this.frameContext);\r\n    return hasChange$.pipe(\r\n      switchMap((changed: boolean) => {\r\n        if (!changed) {\r\n          return this._cancel();\r\n        } else {\r\n          return this.messageService.question(this.languageService['cancelWithoutSave']).pipe(\r\n            switchMap((ifCancel: boolean) => {\r\n              if (ifCancel === false) {\r\n                return EMPTY;\r\n              }\r\n              return this._cancel();\r\n            })\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æé åé¡µä¿¡æ¯\r\n   * @param parentId parentId\r\n   * @returns\r\n   */\r\n  private buildPaginationInfo(parentId: any) {\r\n    const pagination: any = { pageIndex: 0, pageSize: 0 };\r\n    const enableNodePagination = this.frameContext.params.get('enableNodePagination');\r\n    if (!parentId) {\r\n      // ä¸çº§åé¡µ\r\n      const pageSize = this.repository.entityCollection.pageSize || 0;\r\n      const pageIndex = this.repository.entityCollection.pageIndex || 0;\r\n      // å¯ç¨äºä¸çº§åé¡µ\r\n      if (pageSize !== 0) {\r\n        pagination.pageSize = pageSize;\r\n        pagination.pageIndex = pageIndex;\r\n      }\r\n    } else {\r\n      // å¦ææªå¯ç¨èç¹åé¡µæå½åä¸ºé¡¶çº§èç¹å è½½ï¼åä¸å¤çèç¹åé¡µ\r\n      if (enableNodePagination) {\r\n        const nodePageSize = this.frameContext.params.get('nodePageSize') || 0;\r\n        let nodePageIndex = this.frameContext.params.get(`_NODE_${parentId}_PAGE_INDEX_`);\r\n        if (!nodePageIndex) {\r\n          this.frameContext.params.set(`_NODE_${parentId}_PAGE_INDEX_`, 1);\r\n          nodePageIndex = 1;\r\n        }\r\n        pagination.pageIndex = nodePageIndex;\r\n        pagination.pageSize = nodePageSize;\r\n      }\r\n    }\r\n    return pagination;\r\n  }\r\n\r\n  /**\r\n   * åæ¶åæ´\r\n   */\r\n  private _cancel(): Observable<any> {\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const cancel$ = this.repository.cancelChanges();\r\n    return cancel$.pipe(\r\n      switchMap(() => {\r\n        const isAdd = this.virtualRootFrameContext.getParam('IS_ADD');\r\n        const lastModifiedId = this.virtualRootFrameContext.getParam('LAST_MODIFIED_ID');\r\n        const currentId = this.bindingData.list.currentId;\r\n\r\n        if (isAdd === true) {\r\n          this.repository.entityCollection.removeEntityById(currentId);\r\n\r\n          // éç½®ç¼è¾ç¶æ\r\n          this.virtualRootFrameContext.setParam('IS_ADD', false);\r\n          if (lastModifiedId) {\r\n            setTimeout(() => {\r\n              this.bindingData.list.setCurrentId(lastModifiedId, true, true);\r\n            }, 0);\r\n          }\r\n          return of(null);\r\n        } else {\r\n          return this.repository.updateById(currentId);\r\n        }\r\n      }),\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.cancelFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥æ¯å¦å­å¨ä¸çº§èç¹ï¼åé¨æ¹æ³ï¼è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public hasChildNodes(id: string, treeNodesData: any[]): boolean {\r\n    const treeNodeUtil = this.getTreeNodeUtil();\r\n    if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoKey, id) === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®å é¤åçå½åèç¹idï¼åé¨æ¹æ³ï¼è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public getNextNodeIdAfterRemoving(idToRemove: string, treeNodesData: any[]): string {\r\n    const treeNodeUtil = this.getTreeNodeUtil();\r\n    const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoKey, idToRemove);\r\n    return nextNodeId;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®å é¤åçå½åèç¹èç¹ï¼åé¨æ¹æ³ï¼è¯·å¿ä½¿ç¨ï¼\r\n   */\r\n  public setNextNodeAfterRemoving(nextNodeId: string): void {\r\n    const treeNodeUtil = this.getTreeNodeUtil();\r\n    treeNodeUtil.selectedNode(this.bindingData, this.hierarchyInfoKey, nextNodeId);\r\n  }\r\n  /**\r\n   * è®¾ç½®æ çå½åè¡(ç»å®æ´æ ä½¿ç¨)\r\n   * @param id id\r\n   */\r\n  public setCurrentId(id: string) {\r\n    id = id || this.frameContext.getVirtualRootFrameContext().uiState['__DEVKIT__selectedRow'] || this.bindingData.list.currentItem.primaryKeyValue;\r\n    this.frameContext.bindingData.list.setCurrentId(id, true, true, true);\r\n  }\r\n  /**\r\n   * éä¸­æ çç¬¬ä¸ä¸ªèç¹\r\n   */\r\n  public selectFirstRow() {\r\n    const hierarchyType = this.getHierarchyType();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil !== null) {\r\n      treeNodeUtil.selectFirstRootNode(this.bindingData, this.hierarchyInfoKey);\r\n    }\r\n  }\r\n  /**\r\n   * è·åæ èç¹å·¥å·ç±»å®ä¾\r\n   */\r\n  private getTreeNodeUtil(): any {\r\n    const hierarchyType = this.getHierarchyType();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil === null) {\r\n      throw new Error(`ä¸æ¯æ${hierarchyType}ç±»åçåçº§`);\r\n    }\r\n    return treeNodeUtil;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * è®°å½å è½½ç¶æ\r\n   * @todoï¼å¾å é¤\r\n   */\r\n  private setLoadByLevelState(filters: string, sorts: string) {\r\n\r\n    // @todoï¼ä¸´æ¶å¤ç\r\n    this.virtualRootFrameContext.setParam('isLoadTreeByLevel', true);\r\n    this.virtualRootFrameContext.setParam('loadTreeByLevelFilter', filters);\r\n    this.virtualRootFrameContext.setParam('loadTreeByLevelSort', sorts);\r\n  }\r\n\r\n  /**\r\n   * å±å¼å½åèç¹\r\n   * @todoï¼å¾å é¤\r\n   */\r\n  private reloadByLevel(): Observable<Entity[]> {\r\n    const isLoadByLevel = this.virtualRootFrameContext.getParam('isLoadTreeByLevel');\r\n    if (isLoadByLevel === true) {\r\n      const filters = this.virtualRootFrameContext.getParam('loadTreeByLevelFilter');\r\n      const sorts = this.virtualRootFrameContext.getParam('loadTreeByLevelSort');\r\n      return this.loadByLevel(filters, sorts);\r\n    }\r\n    return of([]);\r\n  }\r\n\r\n  private getHierarchyType() {\r\n    const ngObjects = FieldMetadataUtil.getNgObjects(this.repository.entityType);\r\n    const hierarchyInfoNgObjectInfo = ngObjects[this.hierarchyInfoKey];\r\n    let hierarchyType = 'path'; // åçº§ç é»è®¤ä¸ºpathï¼å¼å®¹åè¡¨å\r\n    if (hierarchyInfoNgObjectInfo.hasOwnProperty('hierarchyType') && hierarchyInfoNgObjectInfo['hierarchyType'] != null) {\r\n      hierarchyType = hierarchyInfoNgObjectInfo['hierarchyType'] as string;\r\n    }\r\n    if (hierarchyType == null || hierarchyType.length < 1) {\r\n      // 'åçº§ç éç½®ä¿¡æ¯éè¯¯'\r\n      throw new Error(this.languageService['incorrectHierarchyConfig']);\r\n    }\r\n    return hierarchyType;\r\n  }\r\n  /**\r\n   * è·åæ ¹ç»ä»¶æ¶æ¯ç®¡é\r\n   */\r\n  private get messagePipe() {\r\n    if (this.frameContext) {\r\n      const appContext = this.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n}\r\nexport { TreeDataService };\r\n","import { Injectable } from '@angular/core';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { FilterConditionService } from '../filter-condition.service';\r\nimport { CommandService } from '../command-service';\r\n\r\n@Injectable()\r\nclass FilterConditionDataService {\r\n    constructor(\r\n        private viewModel: ViewModel,\r\n        private filterConditionService: FilterConditionService,\r\n        private commandService: CommandService\r\n    ) { }\r\n\r\n    /**\r\n     * æ§è¡è¿æ»¤\r\n     * @param commandName å½ä»¤åç§°\r\n     * @param frameId å½ä»¤æå¨çframeId\r\n     */\r\n    public filter(commandName: string, frameId: string) {\r\n        const self: any = this;\r\n        let filters = self.context && self.context.eventParam && self.context.eventParam.data || [];\r\n        if (typeof (filters) === 'string') {\r\n            filters = JSON.parse(filters);\r\n        }\r\n        // æ¥è¯¢æ¶éç½®é¡µç ä¸ºç¬¬ä¸é¡µ\r\n        this.viewModel.frameContext.repository.entityCollection.pageIndex = 1;\r\n        this.viewModel.frameContext.repository.filterConditionManager.setConditions(this.viewModel.bindingPath, filters);\r\n        return this.commandService.execute(commandName, frameId);\r\n    }\r\n}\r\nexport { FilterConditionDataService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Entity, BindingData, FrameContext } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { Observable, EMPTY } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { EditStateUtil } from './utils/index';\r\n\r\n\r\n/**\r\n * æ°æ®ç¼è¾æå¡\r\n */\r\n@Injectable()\r\nclass EditDataService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private bindingData: BindingData;\r\n\r\n  /**\r\n   * Loadingæå¡\r\n   */\r\n  private loadingService: FormLoadingService;\r\n\r\n  /**\r\n   * è¯­è¨æå¡\r\n   */\r\n  private languageService: LanguageService;\r\n\r\n  /**\r\n   * éè¯¯å¤çæå¡\r\n   */\r\n  private errorService: FormErrorService;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(private frameContext: FrameContext) {\r\n    this.repository = this.frameContext.repository as BefRepository<Entity>;\r\n    this.bindingData = this.frameContext.bindingData;\r\n    this.loadingService = this.frameContext.injector.get<FormLoadingService>(FormLoadingService, null);\r\n    this.languageService = this.frameContext.injector.get<LanguageService>(LanguageService, null);\r\n    this.errorService = this.frameContext.injector.get<FormErrorService>(FormErrorService, null);\r\n  }\r\n\r\n  /**\r\n   * ç¼è¾ï¼æ¯æå éï¼\r\n   */\r\n  public edit(id: string): Observable<Entity> {\r\n\r\n    id = id || this.bindingData.list.currentId;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const edit$ = this.repository.editEntityById(id);\r\n    const result$ = edit$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          EditStateUtil.setEditState(this.frameContext, id);\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.updateFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n}\r\n\r\n\r\nexport { EditDataService };\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, EMPTY } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\nimport { FrameContext, Entity, } from '@farris/devkit';\r\nimport { BefRepository, } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { CommandService } from '../command-service';\r\nimport { ListDataService } from './list-data.service';\r\nimport { TreeDataService } from './tree-data.service';\r\n\r\n/**\r\n * å é¤æå¡\r\n */\r\n@Injectable()\r\nclass RemoveDataService {\r\n\r\n  private notifyService: FormNotifyService;\r\n\r\n  private messageService: FormMessageService;\r\n\r\n  private loadingService: FormLoadingService;\r\n\r\n  private errorService: FormErrorService;\r\n\r\n  private languageService: LanguageService;\r\n\r\n  private befRepository: BefRepository<any>;\r\n\r\n  private commandService: CommandService;\r\n\r\n  private listDataService: ListDataService;\r\n\r\n  private treeDataService: TreeDataService;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param frameContext ç»ä»¶ä¸ä¸æ\r\n   */\r\n  constructor(private frameContext: FrameContext) {\r\n    this.notifyService = this.frameContext.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    this.messageService = this.frameContext.injector.get<FormMessageService>(FormMessageService, null);\r\n    this.errorService = this.frameContext.injector.get<FormErrorService>(FormErrorService, null);\r\n    this.loadingService = this.frameContext.injector.get<FormLoadingService>(FormLoadingService, null);\r\n\r\n    this.languageService = this.frameContext.injector.get<LanguageService>(LanguageService, null);\r\n    this.commandService = this.frameContext.injector.get<CommandService>(CommandService, null);\r\n    this.listDataService = this.frameContext.injector.get<ListDataService>(ListDataService, null);\r\n    this.treeDataService = this.frameContext.injector.get<TreeDataService>(TreeDataService, null);\r\n    this.befRepository = this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * å é¤idå¯¹åºçå®ä½\r\n   * @param id è¦å é¤çæ°æ®id\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param enableRemoveAndSave æ¯å¦å¯ç¨å é¤å¹¶ä¿å­ï¼ä»ä¸ºå¼å®¹ï¼æ°è°ç¨è¯·å¿è®¾ç½®ï¼\r\n   * @summary\r\n   * enableRemoveAndSaveå­å¨çæä¹ï¼\r\n   * 1ãèè¡¨åçå¯è½æ²¡ædelAndSaveæ¹æ³ï¼\r\n   * 2ãä¸ºäºå°ListDataServiceä¸­çremoveæ¹æ³è¿ç§»å°æ­¤æ¹æ³ä¸ï¼æ¾ç¤ºè®¾ç½®ä¸ºfalseï¼ä¿æåä»¥åè¡ä¸ºä¸è´ï¼\r\n   * 3ãè¯¥åæ°é»è®¤ä¸ºtrueï¼å¹¶ä¸å¨WebComponentå±ä¸æ´é²ï¼æ°å½ä»¤ä¸éè¦ä¼ éï¼é»è®¤ä¸ºtrueï¼\r\n   */\r\n  public removeById(id: string, ifSave: boolean, enableRemoveAndSave: boolean = true, successMsg?: string): Observable<boolean> {\r\n    const msg = successMsg ? successMsg : '';\r\n    return this.innerRemoveById(id, ifSave, enableRemoveAndSave, msg);\r\n  }\r\n\r\n  public removeByIds(ids: string[]): Observable<boolean> {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * å é¤idå¯¹åºçå®ä½ï¼å¹¶æ§è¡ä¿å­\r\n   */\r\n  public removeAndSaveById(id: string, successMsg?: string): Observable<boolean> {\r\n    const msg = successMsg ? successMsg : '';\r\n    return this.innerRemoveById(id, true, true, msg);\r\n  }\r\n\r\n  /**\r\n   * å é¤å¹¶ä¿å­æ èç¹æ°æ®\r\n   */\r\n  public removeAndSaveByIdForTree(id: string, successMsg?: string): Observable<boolean> {\r\n    const msg = successMsg ? successMsg : '';\r\n    // æ£æ¥è¦å é¤çidæ¯å¦å­å¨\r\n    if (this.checkIdsToRemove([id]) === false) {\r\n      this.notifyService.warning(this.languageService.plsSelectDeleteData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    // æ£æ¥æ¯å¦æå­èç¹\r\n    const treeNodesData = this.befRepository.entityCollection.toJSON();\r\n    if (this.treeDataService.hasChildNodes(id, treeNodesData) === true) {\r\n      this.messageService.warning(this.languageService.deleteChildFirst);\r\n      return EMPTY;\r\n    }\r\n\r\n    // æ§è¡å é¤\r\n    const remove$ = this.innerRemoveById(id, true, true, msg);\r\n    const nextNodeId = this.treeDataService.getNextNodeIdAfterRemoving(id, treeNodesData);;\r\n    const result$ = remove$.pipe(\r\n      tap(() => {\r\n        this.treeDataService.setNextNodeAfterRemoving(nextNodeId);\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n\r\n  /**\r\n   * æ¹éå é¤å¹¶ä¿å­\r\n   */\r\n  public removeAndSaveByIds() {\r\n    throw new Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * å é¤åçå·æ°\r\n   */\r\n  public refreshAfterRemoving(loadCmdName: string, loadCmdFrameId: string): Observable<any> {\r\n    if (!this.frameContext || !loadCmdName || !loadCmdFrameId) {\r\n      return;\r\n    }\r\n    const commandService = this.frameContext.injector.get<CommandService>(CommandService, null);\r\n    return commandService.execute(loadCmdName, loadCmdFrameId);\r\n  }\r\n\r\n  /**\r\n   * å é¤idå¯¹åºçå®ä½\r\n   * @param id å®ä½id\r\n   * @param ifSave æ¯å¦ä¿å­\r\n   * @param enableRemoveAndSave æ¯å¦å¯ç¨å é¤å¹¶ä¿å­ï¼èEAPIä¸æ²¡ææ­¤æ¹æ³ï¼éè¿å¼å³è¿è¡å¼å®¹ï¼\r\n   * @summary\r\n   * enableRemoveAndSaveåæ°è¯´æï¼\r\n   * 1ãèEAPIä¸æ²¡ædelAndSaveæ¹æ³ï¼åªè½åä¸¤æ¬¡è¯·æ±ï¼å é¤åä¿å­ï¼ï¼\r\n   * 2ãæ­¤å¼å³ç¨äºéæ©ä½¿ç¨åªç§æ¹å¼ï¼å¼å®¹èè¡¨åã\r\n   */\r\n  private innerRemoveById(id: string, ifSave: boolean, enableRemoveAndSave: boolean, successMsg: string): Observable<boolean> {\r\n\r\n    // æ£æ¥è¦å é¤çidæ¯å¦å­å¨\r\n    if (this.checkIdsToRemove([id]) === false) {\r\n      this.notifyService.warning(this.languageService.plsSelectDeleteData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const confirm$ = this.confirmToRemove();\r\n    const remove$ = enableRemoveAndSave && ifSave ?\r\n      this.befRepository.removeEntityAndSaveById(id) :\r\n      this.befRepository.removeById(id, ifSave);\r\n\r\n    const result$ = confirm$.pipe(\r\n      concatMap((ifRemove: boolean) => {\r\n        if (ifRemove === false) {\r\n          return EMPTY;\r\n        }\r\n        const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n        return remove$.pipe(\r\n          tap(\r\n            () => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              if (successMsg && successMsg.trim()) {\r\n                let showMessage: boolean = true;\r\n                if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                  try {\r\n                    const options = JSON.parse(successMsg);\r\n                    if (options.showMessage === false) {\r\n                      showMessage = false;\r\n                    }\r\n                  } catch { }\r\n                }\r\n                if (showMessage !== false) {\r\n                  this.notifyService.success(successMsg, { hideTitle: true });\r\n                }\r\n              } else {\r\n                this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n              }\r\n              // this.notifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            },\r\n            (error: any) => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.errorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          ),\r\n          switchMap(() => {\r\n            const saved = enableRemoveAndSave && ifSave;\r\n            if (!saved) {\r\n              return EMPTY;\r\n            } else {\r\n              return of(null);\r\n            }\r\n          })\r\n        );\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * æ£æ¥è¦å é¤çidsæ¯å¦ä¸ºç©º\r\n   */\r\n  private checkIdsToRemove(ids: string[]): boolean {\r\n    if (!ids) {\r\n      return false;\r\n    }\r\n    const filteredIds = ids.filter((id: string) => {\r\n      return !!id;\r\n    });\r\n    if (filteredIds.length === 0) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * ç¡®è®¤å é¤\r\n   */\r\n  private confirmToRemove(): Observable<boolean> {\r\n    const confirm$ = this.messageService.question(this.languageService.confirmDeletion);\r\n    const result$ = confirm$.pipe(\r\n      concatMap((ifRemove: boolean) => {\r\n        if (ifRemove === false) {\r\n          return EMPTY;\r\n        } else {\r\n          return of(true);\r\n        }\r\n      }\r\n      ));\r\n    return result$;\r\n  }\r\n}\r\n\r\nexport { RemoveDataService };\r\n\r\n\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext, Entity } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\n\r\n/**\r\n * å é¤æå¡\r\n */\r\n@Injectable()\r\nclass SaveDataService {\r\n\r\n  private notifyService: FormNotifyService;\r\n\r\n  private messageService: FormMessageService;\r\n\r\n  private loadingService: FormLoadingService;\r\n\r\n  private errorService: FormErrorService;\r\n\r\n  private languageService: LanguageService;\r\n\r\n  private befRepository: BefRepository<any>;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   * @param frameContext ç»ä»¶ä¸ä¸æ\r\n   */\r\n  constructor(private frameContext: FrameContext) {\r\n    this.notifyService = this.frameContext.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    this.messageService = this.frameContext.injector.get<FormMessageService>(FormMessageService, null);\r\n    this.loadingService = this.frameContext.injector.get<FormLoadingService>(FormLoadingService, null);\r\n    this.languageService = this.frameContext.injector.get<LanguageService>(LanguageService, null);\r\n    this.befRepository = this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n}\r\n\r\nexport { SaveDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { EMPTY, Observable } from 'rxjs';\r\nimport { tap, switchMap, concatMap } from 'rxjs/operators';\r\n\r\nimport { BindingList, FrameContext, ViewModel } from '@farris/devkit';\r\nimport { BaseDataService } from './base-data.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { TreeRepositoryFactory } from './tree-table/repository/tree-repository-factory';\r\nimport { TreeUtilFactory } from './tree-table/util/tree-util-factory';\r\n\r\n\r\n\r\n/**\r\n * æ æ°æ®æå¡\r\n */\r\n@Injectable()\r\nclass SubTreeDataService extends BaseDataService {\r\n\r\n  /**\r\n   * åçº§ç ä¿¡æ¯\r\n   */\r\n  private get hierarchyInfoKey(): string {\r\n    return this.virtualRootFrameContext.getParam('hierarchyInfoKey');\r\n  }\r\n  private get hierarchyInfoField(): string {\r\n    return this.hierarchyInfoKey.split('/').filter(p => p).pop();\r\n  }\r\n  private get virtualRootFrameContext() {\r\n    return this.frameContext.getVirtualRootFrameContext();\r\n  }\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    frameContext: FrameContext,\r\n    private viewModel: ViewModel,\r\n    private messageService: FormMessageService,\r\n    private loadingService: FormLoadingService,\r\n    private errorService: FormErrorService,\r\n    private formNotifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService\r\n  ) {\r\n    super(frameContext);\r\n    if (!languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  private get messagePipe() {\r\n    if (this.viewModel && this.viewModel.frameContext) {\r\n      const appContext = this.viewModel.frameContext.getFormAppContext() || null;\r\n      if (appContext) {\r\n        return appContext.messagePipe || null;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * æ°å¢å­è¡¨åçº§\r\n   */\r\n  public addSubSibling(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'addSubSibling' });\r\n    }\r\n    let params: { nodeCodes: string[], ids: string[] } = this.getParams();\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType: string = this.getHierarchyType();\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      // éè¯¯çåçº§ç \r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const result$ = repository.addSubSibling(this.repository, params.nodeCodes, params.ids);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.errorService.exception(this.languageService.addSubSiblingFailed, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * æ°å¢ä¸çº§\r\n   */\r\n  public addSubChild(): Observable<any> {\r\n    if (this.messagePipe) {\r\n      this.messagePipe.next({ messageType: 'addSubChild' });\r\n    }\r\n    let params: { nodeCodes: string[], ids: string[] } = this.getParams();\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType = this.getHierarchyType();\r\n\r\n    const currentList = this.frameContext && this.frameContext.bindingData && this.frameContext.bindingData.getList();\r\n    if (!currentList['currentId']) {\r\n      // è¯·éæ©ç¶èç¹\r\n      this.formNotifyService.warning(this.languageService['plsSelectParentNode'], { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // æ§è¡åæ°\r\n    const loadingTimerId = this.loadingService.showLoadingWithDelay(500);\r\n\r\n    const repository = TreeRepositoryFactory.getInstance(hierarchyType);\r\n    if (!repository) {\r\n      throw new Error(this.languageService['errorHierarchyKey']);\r\n    }\r\n    const addSubChild$ = repository.addSubChild(this.repository, params.nodeCodes, params.ids);\r\n    const result$ = addSubChild$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n        },\r\n        error => {\r\n          this.loadingService.hideDelayLoading(loadingTimerId);\r\n          this.errorService.exception(this.languageService.addSubChildFailed, error);\r\n        }\r\n      )\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * å é¤å­è¡¨æ èç¹\r\n   * @param id id\r\n   */\r\n  public remove(id: string, successMsg?: string): Observable<any> {\r\n    // åæ°æ£æ¥\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService['plsSelectDeleteData'], { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // è·ååçº§æ¹å¼\r\n    const hierarchyType = this.getHierarchyType();\r\n    // æå­èç¹æ¶ä¸åè®¸å é¤\r\n    const treeNodesData = this.frameContext.bindingData.getList().toJSON();\r\n    const bindingList = this.frameContext.bindingData.getList();\r\n    const treeNodeUtil = TreeUtilFactory.getInstance(hierarchyType);\r\n    if (treeNodeUtil === null) {\r\n      return EMPTY;\r\n    }\r\n    if (treeNodeUtil.hasChildNodes(treeNodesData, this.hierarchyInfoField, id) === true) {\r\n      this.messageService.warning(this.languageService['deleteChildFirst']);\r\n      return EMPTY;\r\n    }\r\n    // ç¡®è®¤å é¤\r\n    const action$ = this.messageService.question(this.languageService.confirmDeletion);\r\n    return action$.pipe(\r\n      concatMap(result => {\r\n        if (!result) {\r\n          return EMPTY;\r\n        }\r\n        // è·åå é¤åè¦è®¾ç½®çèç¹id\r\n        const nextNodeId = treeNodeUtil.getNextNodeId(treeNodesData, this.hierarchyInfoField, id);\r\n\r\n        // æ§è¡å é¤\r\n        const loadingTimerId = this.loadingService.show();\r\n        const path = this.getPath();\r\n        const remove$ = this.frameContext.repository.removeByPath(path, id);\r\n        return remove$.pipe(\r\n          tap(() => {\r\n            // è®¾ç½®éä¸­èç¹\r\n            treeNodeUtil.selectNodeByBindingList(bindingList, this.hierarchyInfoField, nextNodeId);\r\n            this.loadingService.hideDelayLoading(loadingTimerId);\r\n            if (successMsg && successMsg.trim()) {\r\n              let showMessage: boolean = true;\r\n              if (successMsg.startsWith('{') && successMsg.endsWith('}')) {\r\n                try {\r\n                  const options = JSON.parse(successMsg);\r\n                  if (options.showMessage === false) {\r\n                    showMessage = false;\r\n                  }\r\n                } catch { }\r\n              }\r\n              if (showMessage !== false) {\r\n                this.formNotifyService.success(successMsg, { hideTitle: true });\r\n              }\r\n            } else {\r\n              this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n            }\r\n            // this.formNotifyService.success(this.languageService.deleteSuccess, { hideTitle: true });\r\n          },\r\n            error => {\r\n              this.loadingService.hideDelayLoading(loadingTimerId);\r\n              this.errorService.exception(this.languageService.deleteFailed, error);\r\n            }\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  private getHierarchyType() {\r\n    const propInfo = this.repository.entityTypeInfo.getPropInfoByPath(this.hierarchyInfoKey.split('/'));\r\n    let hierarchyType = propInfo.metadataInfo['hierarchyType'] || null;\r\n    if (hierarchyType == null || hierarchyType.length < 1) {\r\n      // 'åçº§ç éç½®ä¿¡æ¯éè¯¯'\r\n      throw new Error(this.languageService['incorrectHierarchyConfig']);\r\n    }\r\n    return hierarchyType;\r\n  }\r\n\r\n  /**\r\n   * è·ååæ°\r\n   * /parentId/childCodes/childId/grandsonCodes\r\n   * [childCodes, grandsonCodes]\r\n   * [parntId, childId]\r\n   */\r\n  private getParams(): { nodeCodes: string[], ids: string[] } {\r\n    let nodeCodes = this.viewModel.bindingPath.substr(1).split('/');\r\n    let ids = [];\r\n    let nodeCodeArray = [];\r\n    const rid = this.viewModel.bindingData.list.currentId; // rootè¡¨æ°æ®id\r\n    ids.push(rid);\r\n    let subData: any = this.viewModel.bindingData;\r\n    if (nodeCodes.length > 0) {\r\n      nodeCodes.map(nodeCode => {\r\n        subData = subData[nodeCode];\r\n        if (subData && subData.currentId) {\r\n          ids.push(subData.currentId);\r\n        }\r\n        //å»é¤nodeCodeçs\r\n        nodeCode ? nodeCodeArray.push(nodeCode.substring(0, nodeCode.length - 1)) : nodeCodeArray.push(nodeCode);\r\n      })\r\n    }\r\n    return { nodeCodes: nodeCodeArray, ids: ids };\r\n  }\r\n  /**\r\n   * è·åå®æ´è·¯å¾\r\n   * fixed by justin: æ ¹æ®bindingPathï¼å¦ææ¯ä»ä»è¡¨ï¼éè¦è·åä¸»è¡¨æ°æ®idåä»è¡¨æ°æ®id\r\n   */\r\n  private getPath(): string {\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const rid = this.viewModel.bindingData.list.currentId; // rootè¡¨æ°æ®id\r\n    let path = '/' + rid;\r\n\r\n    const subPaths = bindingPath.split('/').filter(p => p);\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['edus', 'grades']\r\n      let subData: any = this.viewModel.bindingData;\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        subData = subData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n}\r\nexport { SubTreeDataService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { HttpHeaders, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Repository } from '@farris/devkit';\r\nimport { BefRepository, BefRestService, RequestInfo, ResponseInfo } from '@farris/bef';\r\nimport { BodyWithRequestInfo } from './types';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { FormErrorService } from './error/form-error.service';\r\nimport { LanguageService } from './languag.service';\r\n// tslint:disable: no-string-literal\r\n\r\n/**\r\n * åè¡¨ä»åºæå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass BeActionService {\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private repository: Repository<any>,\r\n    private loadingService: FormLoadingService,\r\n    private msgService: FormMessageService,\r\n    private notifyService: FormNotifyService,\r\n    private formErrorService: FormErrorService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ§è¡èªå®ä¹å¨ä½\r\n   */\r\n  public invokeAction(\r\n    actionUri: string, httpMethod: string, httpHeaders?: any, queryParams?: any, body?: BodyWithRequestInfo\r\n  ): Observable<ResponseInfo> {\r\n    return this.innerInvokeAction(actionUri, httpMethod, httpHeaders, queryParams, body, true);\r\n  }\r\n\r\n  /**\r\n   * å·²å¼ç¨ï¼è¯·ä½¿ç¨invokeActionä»£æ¿\r\n   * @deprecated\r\n   * @summary\r\n   * è¿ç§»æ¶è¯·æ³¨æï¼invokeActionä¸­bodyè¯·ä¼ éæ»¡è¶³BodyWithRequestInfoæ¥å£çæ ¼å¼ï¼å½¢å¦ï¼\r\n   * { requestInfo: reqeustInfoInstance, key1: value1, key2: value2 }\r\n   */\r\n  public executeAction(\r\n    actionUri: string, httpMethod: string, httpHeaders?: any, queryParams?: any, body?: any\r\n  ): Observable<any> {\r\n\r\n    // 1ãä¸ç¡®å®bodyä¸­æ¯å¦æRequestInfoå¯¹è±¡\r\n    // 2ãrestServiceçreqeustä¼æ ¹æ®bodyä¸­æ¯å¦ækeyä¸ºReqeustInfoï¼å¤§åå¼å¤´ï¼çåæ°æ¥ç¡®å®ï¼\r\n    // 3ãå¦æbodyä¸­æ²¡ækeyä¸ºReqeustInfoçåæ°ï¼ä¸ç´æ¥è¿åResponseInfoï¼èæ¯è¿ä¸æ­¥è§£æï¼è¿åå¶ä¸­çreturnValueã\r\n    return this.innerInvokeAction(actionUri, httpMethod, httpHeaders, queryParams, body, false);\r\n  }\r\n\r\n  /**\r\n   * æé æ¥è¯¢å­ç¬¦ä¸²\r\n   */\r\n  public buildQueryParams(queryParams: string): string {\r\n    if (typeof queryParams === 'string') {\r\n      queryParams = JSON.parse(queryParams);\r\n    }\r\n\r\n    let queryParamsString = '';\r\n    Object.keys(queryParams).forEach((key: string) => {\r\n      queryParamsString += `${key}=${queryParams[key]}`;\r\n    });\r\n\r\n    return queryParamsString;\r\n  }\r\n\r\n  /**\r\n   * è·åRestæå¡\r\n   */\r\n  public getRestService(): BefRestService {\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    return befRepository.restService;\r\n  }\r\n\r\n\r\n  /**\r\n   * è°ç¨èªå®ä¹å¨ä½\r\n   */\r\n  private innerInvokeAction(\r\n    actionUri: string, httpMethod: string, httpHeaders?: any, queryParams?: any, body?: any, hasRequestInfo?: boolean\r\n  ): Observable<any>  {\r\n    const options = {};\r\n    const restService = this.getRestService();\r\n    const baseUri = restService.baseUri;\r\n\r\n    // æé url\r\n    let fullActionUri = `${baseUri}/service/${actionUri}`;\r\n    if (queryParams && queryParams !== '') {\r\n      const queryParamsString = this.buildQueryParams(queryParams);\r\n      fullActionUri += queryParamsString;\r\n    }\r\n\r\n\r\n    // bodyæé \r\n    if (body && body !== '') {\r\n      if (typeof body === 'string' && body.startsWith('{') && body.endsWith('}')) {\r\n        body = JSON.parse(body);\r\n      }\r\n      options['body'] = body;\r\n    }\r\n\r\n    // httpå¤´æé \r\n    if (httpHeaders && httpHeaders !== '') {\r\n      httpHeaders = JSON.parse(httpHeaders);\r\n\r\n      // å¦ææ²¡æè®¾ç½®Content-Typeï¼é»è®¤ç¨jsonæ ¼å¼\r\n      if (!httpHeaders['Content-Type']) {\r\n        httpHeaders['Content-Type'] = 'application/json';\r\n      }\r\n      options['headers'] = new HttpHeaders(httpHeaders);\r\n    } else {\r\n      options['headers'] = new HttpHeaders({ 'Content-Type': 'application/json' });\r\n    }\r\n\r\n    // æ§è¡æå¡å¨ç«¯è¯·æ±\r\n    this.loadingService.show();\r\n\r\n    // invokeæ¹æ³\r\n    // 1ãRequestInfo=>æ¥é\r\n    // 2ãrequestInfo=>ResponseInfo\r\n    // requestæ¹æ³\r\n    // 1ãRequestInfo=>ResponseInfo\r\n    // 2ãrequestInfo=>returnValue\r\n    const methodName = hasRequestInfo ? 'invoke' : 'request';\r\n    const result$ = restService[methodName](fullActionUri, httpMethod, null, options);\r\n    return result$.pipe(\r\n      tap(\r\n        () => {\r\n          this.loadingService.hide();\r\n        },\r\n        (error: any) => {\r\n          this.loadingService.hide();\r\n          const errorMsg = fullActionUri + this.languageService['operationFailed'];\r\n          this.formErrorService.exception(errorMsg, error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport { BeActionService };\r\n\r\n\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, empty, of, from, EMPTY } from 'rxjs';\r\nimport { tap, map, switchMap, catchError } from 'rxjs/operators';\r\nimport { BeActionService } from './be-action.service';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { FormErrorService } from './error/form-error.service';\r\nimport { WFSubmiteService, InteractionResponse, ExcutionResponse } from '@gsp-wf/rtdevkit';\r\nimport { WfTaskHandlerService } from '@gsp-wf/wf-task-handler';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { Entity, FrameContext } from '@farris/devkit';\r\nimport { WFFlowchartService } from '@gsp-wf/ui-flowchart';\r\nimport { FormNotifyStrategyService } from './form-notify-strategy.service';\r\nimport { BodyWithRequestInfo } from './../lib/types';\r\n// tslint:disable: max-line-length\r\n/**\r\n * å®¡æ¹æå¡\r\n * @Scope FrameComponent\r\n */\r\n@Injectable()\r\nclass ApproveService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private formLoadingService: FormLoadingService,\r\n    private beActionService: BeActionService,\r\n    private msgService: FormMessageService,\r\n    private notifyService: FormNotifyService,\r\n    @Optional() private languageService: LanguageService,\r\n    private formErrorService: FormErrorService,\r\n    private frameContext: FrameContext,\r\n    @Optional() private submitter: WFSubmiteService,\r\n    @Optional() private flowchartService: WFFlowchartService,\r\n    @Optional() private wfTaskHandlerService: WfTaskHandlerService\r\n  ) {\r\n    if (this.frameContext) {\r\n      this.repository = this.frameContext.repository as BefRepository<Entity>;\r\n      if (!this.wfTaskHandlerService) {\r\n        this.wfTaskHandlerService = this.frameContext.injector.get(WfTaskHandlerService, null);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¸¦æäº¤äºçæäº¤å®¡æ¹\r\n   */\r\n  submitApproveWithInteraction(bizBillID: string) {\r\n    return this.submitApprove(bizBillID);\r\n  }\r\n\r\n  /**\r\n   * æäº¤å®¡æ¹\r\n   * @param bizBillID ä¸å¡åæ®id\r\n   * @param interactionResult åç«¯äº¤äºç»æ\r\n   * @deprecated å·²åºå¼ï¼æ¸ä½¿ç¨åå«å¥å£åæ®çå®¡æ¹\r\n   */\r\n  submitApprove(bizBillID: string, interactionResult?: InteractionResponse): Observable<any> {\r\n    if (!bizBillID) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.notifyService.info(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    const actionUri = 'submittoapprovevoaction';\r\n\r\n    const restService = this.beActionService.getRestService();\r\n\r\n    const body: BodyWithRequestInfo = {\r\n      requestInfo: restService.buildRequestInfo(),\r\n      bizInstID: bizBillID,\r\n      interactionResult: interactionResult ? {\r\n        procDefId: interactionResult.processDefinitionId\r\n      } : {}\r\n    };\r\n\r\n    this.formLoadingService.show();\r\n\r\n    // æ·»å æç¤º\r\n    const action$ = this.beActionService.invokeAction(actionUri, 'PUT', null, null, body);\r\n    // ç®ååå«ä¸ç§æåµï¼\r\n    // 1. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾id\r\n    // 2. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾idï¼å¹¶è¿åå¤ä¸ªåä¸èï¼äº¤äºæ¶æäº¤åä¸è\r\n    // 3. ç¬¬ä¸æ¬¡æäº¤æªæåï¼æå¡ç«¯è¿åå¤ä¸ªæµç¨å®ä¹ï¼éè¦äº¤äºåç¬¬äºæ¬¡æäº¤å®¡æ¹ï¼ç¬¬äºæ¬¡æäº¤ä¼åºç°æåµ1åæåµ2\r\n\r\n    return action$.pipe(\r\n      map((result): ExcutionResponse => {\r\n        if (result && result.returnValue && result.returnValue.excutionResponse) {\r\n          var wfResponse: ExcutionResponse = result.returnValue.excutionResponse;\r\n          return wfResponse;\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response && response.procInstId) {\r\n          if (this.repository) {\r\n            const updating$ = this.repository.updateById(bizBillID);\r\n            return updating$.pipe(tap(() => {\r\n              this.formLoadingService.hide();\r\n              // this.notifyService.info(this.languageService.submitSuccess);\r\n              FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            }), map(() => {\r\n              return response;\r\n            }));\r\n          } else {\r\n            this.formLoadingService.hide();\r\n            // this.notifyService.info(this.languageService.submitSuccess);\r\n            FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            return of(response);\r\n          }\r\n        } else {\r\n          return of(response);\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response.needInteraction) {\r\n          return from(new Promise((resolve) => {\r\n            this.submitter.excute(response, (interactionResponse: InteractionResponse) => {\r\n              // å¦ææ­¤æ¬¡æªæäº¤ï¼èéæ©åå¾å°äºæµç¨å®ä¹IDï¼åå¨æ­¤æäº¤å®¡æ¹\r\n              if (!response.procInstId && interactionResponse.processDefinitionId) {\r\n                this.submitApprove(bizBillID, interactionResponse).subscribe(() => {\r\n                  resolve();\r\n                });\r\n              } else {\r\n                resolve();\r\n              }\r\n            });\r\n          }));\r\n        } else {\r\n          return of(null);\r\n        }\r\n      }),\r\n      catchError(\r\n        error => {\r\n          this.formLoadingService.hide();\r\n          // this.formErrorService.exception(this.languageService.submitFaild, error);\r\n          return of(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * æäº¤å®¡æ¹(å¸¦å¥å£åæ®)\r\n   * @param bizBillID ä¸å¡åæ®Id\r\n   * @param bizDefKey å¥å£åæ®Id\r\n   * @param options options\r\n   * @param interactionResult äº¤äºç»æ\r\n   */\r\n\r\n  public submitApproveWithBizDefKey(bizBillID: string, bizDefKey: string, options?: any, interactionResult?: InteractionResponse): Observable<any> {\r\n    if (!bizBillID) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.warning(this.languageService.bizDefKeyRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    try {\r\n      if (options && typeof (options) === 'string') {\r\n        options = JSON.parse(options);\r\n      }\r\n    } catch (e) {\r\n      throw new Error('ArgumentError:options not a valid json string.');\r\n    }\r\n\r\n    const actionUri = 'submittoapprovewithpayload';\r\n\r\n    const restService = this.beActionService.getRestService();\r\n\r\n    const body: BodyWithRequestInfo = {\r\n      requestInfo: restService.buildRequestInfo(),\r\n      approvePayload: {\r\n        startProcessPayload: {\r\n          bizDefKey: bizDefKey,\r\n          dataId: bizBillID,\r\n          name: options && options.name || '',\r\n          variables: options && options.variables || {}\r\n        }\r\n      }\r\n    };\r\n    if (interactionResult) {\r\n      body.approvePayload.startProcessPayload.processDefinitionId = interactionResult.processDefinitionId;\r\n      body.approvePayload.startProcessPayload.processDefinitionKey = interactionResult['processDefinitionKey'];\r\n    }\r\n    this.formLoadingService.show();\r\n\r\n    // æ·»å æç¤º\r\n    const action$ = this.beActionService.invokeAction(actionUri, 'PUT', null, null, body);\r\n    // ç®ååå«ä¸ç§æåµï¼\r\n    // 1. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾id\r\n    // 2. ç¬¬ä¸æ¬¡æäº¤æåï¼æå¡ç«¯è¿åæµç¨å®ä¾idï¼å¹¶è¿åå¤ä¸ªåä¸èï¼äº¤äºæ¶æäº¤åä¸è\r\n    // 3. ç¬¬ä¸æ¬¡æäº¤æªæåï¼æå¡ç«¯è¿åå¤ä¸ªæµç¨å®ä¹ï¼éè¦äº¤äºåç¬¬äºæ¬¡æäº¤å®¡æ¹ï¼ç¬¬äºæ¬¡æäº¤ä¼åºç°æåµ1åæåµ2\r\n\r\n    return action$.pipe(\r\n      map((result): ExcutionResponse => {\r\n        if (result && result.returnValue && result.returnValue.excutionResponse) {\r\n          const wfResponse: ExcutionResponse = result.returnValue.excutionResponse;\r\n          return wfResponse;\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response && response.procInstId) {\r\n          if (this.repository) {\r\n            const updating$ = this.repository.updateById(bizBillID);\r\n            return updating$.pipe(tap(() => {\r\n              this.formLoadingService.hide();\r\n              // this.notifyService.info(this.languageService.submitSuccess);\r\n              FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            }), map(() => {\r\n              return response;\r\n            }));\r\n          } else {\r\n            this.formLoadingService.hide();\r\n            // this.notifyService.info(this.languageService.submitSuccess);\r\n            FormNotifyStrategyService.success(this.notifyService, this.languageService.submitSuccess);\r\n            return of(response);\r\n          }\r\n        } else {\r\n          return of(response);\r\n        }\r\n      }),\r\n      switchMap((response: ExcutionResponse) => {\r\n        if (response.needInteraction) {\r\n          return from(new Promise((resolve) => {\r\n            this.submitter.excute(response, (interactionResponse: InteractionResponse) => {\r\n              // å¦ææ­¤æ¬¡æªæäº¤ï¼èéæ©åå¾å°äºæµç¨å®ä¹IDï¼åå¨æ­¤æäº¤å®¡æ¹\r\n              if (!response.procInstId && interactionResponse.processDefinitionId) {\r\n                this.submitApproveWithBizDefKey(bizBillID, bizDefKey, options, interactionResponse).subscribe(() => {\r\n                  resolve();\r\n                });\r\n              } else {\r\n                resolve();\r\n              }\r\n            });\r\n          }));\r\n        } else {\r\n          return of(null);\r\n        }\r\n      }),\r\n      catchError(\r\n        error => {\r\n          this.formLoadingService.hide();\r\n          // this.formErrorService.exception(this.languageService.submitFaild, error);\r\n          return of(error);\r\n        }\r\n      )\r\n    );\r\n  }\r\n  /**\r\n   * æäº¤å®¡æ¹(å¸¦å¥å£åæ®ä½¿ç¨wfæ§ä»¶)\r\n   * @param bizBillID ä¸å¡åæ®Id\r\n   * @param bizDefKey å¥å£åæ®Id\r\n   * @param options ä¸ä¸æåæ°\r\n   * @param variables å¯éåæ°\r\n   */\r\n  public submitApproveWithBizDefKeyUseControl(bizBillID: string, bizDefKey: string, options: any = {}, variables?: any) {\r\n    if (!bizBillID) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!bizDefKey) {\r\n      this.notifyService.warning(this.languageService.bizDefKeyRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!options || typeof options !== 'object') {\r\n      options = {};\r\n    }\r\n    const payload: any = {\r\n      dataId: bizBillID,\r\n      bizDefKey,\r\n      ...options\r\n    };\r\n    // å¤çvariablesåæ°\r\n    if (variables) {\r\n      if (variables.startsWith('{') && variables.endsWith('}')) {\r\n        try {\r\n          variables = JSON.parse(variables);\r\n        } catch {\r\n          variables = {};\r\n        }\r\n      }\r\n      payload.variables = variables;\r\n    }\r\n    return this.wfTaskHandlerService && this.wfTaskHandlerService.startProcess(payload);\r\n  }\r\n  /**\r\n   * å­è¡¨æäº¤å®¡æ¹\r\n   * @param bizDefKey å¥å£åæ®Id\r\n   * @param bizId ä¸å¡åæ®Idï¼ä¸»è¡¨ï¼\r\n   * @param childBizId ä¸å¡åæ®Idï¼ä»è¡¨ï¼\r\n   * @param options ä¸ä¸æåæ°\r\n   * @param variables å¯éåæ°\r\n   */\r\n  public childSubmitApproveWithBizDefKey(bizDefKey: string, bizId: string, childBizId: string, options: any = {}, variables?: any): Observable<any> {\r\n    // å¥å£åæ®ä¸è½ä¸ºç©º\r\n    if (!bizDefKey) {\r\n      this.notifyService.warning(this.languageService.bizDefKeyRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // ä¸»ä¸å¡åæ®Idä¸è½ä¸ºç©º\r\n    if (!bizId) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // ä»è¡¨ä¸å¡åæ®Idä¸è½ä¸ºç©º\r\n    if (!childBizId) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyChildBizBillId, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!options || typeof options !== 'object') {\r\n      options = {};\r\n    }\r\n    const payload: any = {\r\n      dataId: `${bizId},${childBizId}`,\r\n      bizDefKey,\r\n      ...options\r\n    };\r\n    // å¤çvariablesåæ°\r\n    if (variables) {\r\n      if (variables.startsWith('{') && variables.endsWith('}')) {\r\n        try {\r\n          variables = JSON.parse(variables);\r\n        } catch {\r\n          variables = {};\r\n        }\r\n      }\r\n      payload.variables = variables;\r\n    }\r\n    return this.wfTaskHandlerService && this.wfTaskHandlerService.startProcess(payload);\r\n  }\r\n  /**\r\n   * åæ¶å®¡æ¹\r\n   * @deprecated å·²åºå¼ï¼è¯·ä½¿ç¨cancelSubmit\r\n   */\r\n  public cancelApprove(bizBillID: string): Observable<any> {\r\n    if (!bizBillID) {\r\n      this.notifyService.warning(this.languageService.unallowEmptyBizBillId, { hideTitle: true });\r\n      return empty();\r\n    }\r\n\r\n    const actionUri = 'canceltosubmitvoaction';\r\n\r\n    const restService = this.beActionService.getRestService();\r\n\r\n    const body = {\r\n      requestInfo: restService.buildRequestInfo(),\r\n      bizInstID: bizBillID,\r\n    };\r\n\r\n    this.formLoadingService.show();\r\n\r\n    const action$ = this.beActionService.executeAction(actionUri, 'PUT', null, null, body);\r\n    return action$.pipe(\r\n      switchMap(() => {\r\n        if (this.repository) {\r\n          const updating$ = this.repository.updateById(bizBillID);\r\n          return updating$.pipe(tap(() => {\r\n            this.formLoadingService.hide();\r\n            // this.notifyService.info(this.languageService.cancelApproveSuccess);\r\n            FormNotifyStrategyService.success(this.notifyService, this.languageService.cancelApproveSuccess);\r\n          }));\r\n        } else {\r\n          this.formLoadingService.hide();\r\n          // this.notifyService.info(this.languageService.cancelApproveSuccess);\r\n          FormNotifyStrategyService.success(this.notifyService, this.languageService.cancelApproveSuccess);\r\n          return of();\r\n        }\r\n      }\r\n      ),\r\n      catchError(error => {\r\n        this.formLoadingService.hide();\r\n        // this.formErrorService.exception(this.languageService.cancelApproveFailed, error);\r\n        return of(error);\r\n      }));\r\n  }\r\n  /**\r\n   * åæ¶å®¡æ¹(æ¯æä¸»è¡¨ãå­è¡¨)\r\n   * @param procInstId æµç¨å®ä¾Id\r\n   */\r\n  public cancelSubmit(procInstId: string): Observable<any> {\r\n    if (!procInstId) {\r\n      this.notifyService.warning(this.languageService.procInsIdRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    return this.wfTaskHandlerService && this.wfTaskHandlerService.cancelSubmit({ procInstId: procInstId });\r\n  }\r\n  /**\r\n   * æ¥çæµç¨å¾\r\n   * @param procInstId æµç¨å®ä¾ID\r\n   */\r\n  viewProcess(procInstId: string) {\r\n    if (this.flowchartService) {\r\n      if (!procInstId) {\r\n        this.notifyService.warning(this.languageService.noProcessInstanceId, { hideTitle: true });\r\n        return;\r\n      }\r\n      return this.flowchartService.viewFlowChart(procInstId);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * è½¬æ¢éç½®å¤§å°å\r\n   * @param jsonObj Object\r\n   * @deprecated\r\n   */\r\n  private switchPrefixLetter(jsonObj: any, toUpper: boolean): any {\r\n    if (typeof (jsonObj) === 'object' && !!jsonObj) {\r\n      if (Array.isArray(jsonObj)) {\r\n        for (var i = 0; i < jsonObj.length; i++) {\r\n          this.switchPrefixLetter(jsonObj[i], toUpper);\r\n        }\r\n      } else {\r\n        for (const key of Object.keys(jsonObj)) {\r\n          var newKey = (toUpper ? key.substring(0, 1).toUpperCase() : key.substring(0, 1).toLowerCase()) + key.substring(1);\r\n          jsonObj[newKey] = jsonObj[key];\r\n          if (typeof jsonObj[key] === 'object') {\r\n            this.switchPrefixLetter(jsonObj[key], toUpper);\r\n          }\r\n          delete (jsonObj[key]);\r\n        }\r\n      }\r\n    }\r\n    return jsonObj;\r\n  }\r\n}\r\nexport { ApproveService };\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { EMPTY } from 'rxjs';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { CommandContext, Entity, FrameContext } from '@farris/devkit';\r\nimport { CloudprintService, OutputOptions, SourceOptions, OutputType, FileType, SourceFilterOptions, PrintType } from '@gsp-svc/cloudprint';\r\nimport { FormNotifyService } from './form-notify.service';\r\n// tslint:disable: unified-signatures\r\n// tslint:disable: max-line-length\r\n/**\r\n * æå°æå¡\r\n * @Scope FrameComponent\r\n */\r\n@Injectable()\r\nclass PrintService {\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private repository: BefRepository<Entity>;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private msgService: FormMessageService,\r\n    private languageService: LanguageService,\r\n    private printService: CloudprintService,\r\n    @Optional() private formNotifyService: FormNotifyService,\r\n  ) {\r\n  }\r\n\r\n  /**\r\n   * æå°åæ®\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param bizBillId ä¸å¡åæ®æ è¯\r\n   */\r\n  public printSingle(beMetaId: string, bizBillId: string) {\r\n    if (!bizBillId) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    return this.printArray(beMetaId, [bizBillId]);\r\n  }\r\n  /**\r\n   * æå°åæ®ï¼éè¿idæidsï¼\r\n   * @param beMetaId beåæ°æ®Id\r\n   * @param ids åæ®idæids\r\n   */\r\n  public printByIds(beMetaId: string, ids: string) {\r\n    if (!ids) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    const dataIds: Array<string> = ids.split(',').filter(item => item);\r\n    return this.printArray(beMetaId, dataIds);\r\n  }\r\n  /**\r\n   * æå°åæ®ï¼å¸¦ç»´åº¦ï¼\r\n   * @param beMetaId beåæ°æ®Id\r\n   * @param ids åæ®idæids\r\n   * @param dim1 ç»´åº¦1å¼\r\n   * @param dim2 ç»´åº¦2å¼\r\n   * @param billCategoryId åæ®ç±»åId\r\n   */\r\n  public printByIdsWithDimension(beMetaId: string, ids: string, dim1: string, dim2: string, billCategoryId?: string) {\r\n    if (!ids) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    const dataIds: Array<string> = ids.split(',').filter(item => item);\r\n    return this.printArray(beMetaId, dataIds, dim1, dim2, billCategoryId);\r\n  }\r\n  /**\r\n   * æå°å¤ä¸ªåæ®\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param dataIds ä¸å¡åæ®æ è¯æ°ç»\r\n   * @param dim1 ç»´åº¦1\r\n   * @param dim2 ç»´åº¦2\r\n   * @param billCategoryId ä¸å¡åæ®ç±»åId\r\n   */\r\n  public printArray(beMetaId: string, dataIds: string[], dim1?: any, dim2?: any, billCategoryId?: string) {\r\n    if (!dataIds || dataIds.length === 0) {\r\n      // this.msgService.error(this.languageService.unallowEmptyBizBillId);\r\n      this.showWarning(this.languageService.unallowEmptyBizBillId);\r\n      return EMPTY;\r\n    }\r\n    const sourceOptions: SourceOptions = this.buildSourceOptions({\r\n      dataIds: dataIds,\r\n      sourceId: beMetaId\r\n    });\r\n\r\n    const outputOptions: OutputOptions = this.buildOutputOptions();\r\n\r\n    if (typeof dim1 !== 'undefined') {\r\n      sourceOptions.FirstDimensionVal = dim1;\r\n    }\r\n    if (typeof dim2 !== 'undefined') {\r\n      sourceOptions.SecondDimensionVal = dim2;\r\n    }\r\n    if (typeof billCategoryId !== 'undefined') {\r\n      sourceOptions.billCategoryId = billCategoryId;\r\n    }\r\n    return this.printService.outputBEData(sourceOptions, outputOptions, 'tab');\r\n  }\r\n\r\n  /**\r\n   * æç§BEåæ°æ¹å¼æ¹éæå°åæ®\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param filterCondition è¿æ»¤æ¡ä»¶\r\n   * @param sortCondition æåºæ¡ä»¶\r\n   * @param includeChildData åå«å­è¡¨æ°æ®\r\n   */\r\n  public printMulti(beMetaId: string, filterCondition: string, sortCondition: string, includeChildData: boolean = true) {\r\n    const entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };\r\n    if (filterCondition) {\r\n      // ç»ä¸çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n      const filters = JSON.parse(filterCondition);\r\n      if (filters && filters.length > 0) {\r\n        filters[filters.length - 1].Relation = 0;\r\n      }\r\n      entryFilter.filterConditions = filters;\r\n    }\r\n\r\n    if (sortCondition) {\r\n      entryFilter.sortConditions = JSON.parse(sortCondition);\r\n    }\r\n    // sfo:SourceFilterOptions\r\n    const sourceFilterOptions: SourceFilterOptions = this.buildSourceFilterOptions({ sourceId: beMetaId, entryFilter, includeChildData });\r\n    const outputOptions: OutputOptions = this.buildOutputOptions();\r\n    return this.printService.outputBEDataWithFilter(sourceFilterOptions, outputOptions, 'tab');\r\n  }\r\n  /**\r\n   * æç§BEåæ°æ¹å¼æ¹éæå°åæ®(å¸¦ç»´åº¦)\r\n   * @param beMetaId BEåæ°æ®æ è¯\r\n   * @param filterCondition è¿æ»¤æ¡ä»¶\r\n   * @param sortCondition æåºæ¡ä»¶\r\n   * @param dim1 ç»´åº¦1value\r\n   * @param dim2 ç»´åº¦2value\r\n   * @param billCategoryId ä¸å¡åæ®ç±»åId\r\n   * @param includeChildData åå«å­è¡¨æ°æ®\r\n   */\r\n  public printMultiWithDimension(beMetaId: string, filterCondition: string, sortCondition: string, dim1: string, dim2: string, billCategoryId?: string, includeChildData: boolean = true) {\r\n    const entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };\r\n    if (filterCondition) {\r\n      // ç»ä¸çº æ­£æåä¸ä¸ªè¿æ»¤æ¡ä»¶çRelation\r\n      const filters = JSON.parse(filterCondition);\r\n      if (filters && filters.length > 0) {\r\n        filters[filters.length - 1].Relation = 0;\r\n      }\r\n      entryFilter.filterConditions = filters;\r\n    }\r\n\r\n    if (sortCondition) {\r\n      entryFilter.sortConditions = JSON.parse(sortCondition);\r\n    }\r\n    const sfo: SourceFilterOptions = this.buildSourceFilterOptions({ sourceId: beMetaId, entryFilter, includeChildData });\r\n    if (typeof dim1 !== 'undefined') {\r\n      sfo.FirstDimensionVal = dim1;\r\n    }\r\n    if (typeof dim2 !== 'undefined') {\r\n      sfo.SecondDimensionVal = dim2;\r\n    }\r\n    if (typeof billCategoryId !== 'undefined') {\r\n      sfo.billCategoryId = billCategoryId;\r\n    }\r\n    const outputOptions: OutputOptions = this.buildOutputOptions();\r\n    return this.printService.outputBEDataWithFilter(sfo, outputOptions, 'tab');\r\n  }\r\n  /**\r\n   * æé SourceOptions\r\n   * @param options options\r\n   */\r\n  private buildSourceOptions(options: { dataIds: string[], sourceId: string, [prop: string]: any }): SourceOptions {\r\n    const so: SourceOptions = {\r\n      DataIds: options && options.dataIds || undefined,\r\n      SourceId: options && options.sourceId || undefined,\r\n      FirstDimensionVal: options && options.dim1 || undefined,\r\n      SecondDimensionVal: options && options.dim2 || undefined,\r\n      RetrieveParam: options && options.retrieveParam || undefined,\r\n      FormatId: options && options.formatId || undefined,\r\n      billCategoryId: options && options.billCategoryId || undefined,\r\n      ServiceUnit: options && options.serviceUnit || undefined,\r\n      currentPage: options && options.currentPage || undefined,\r\n      pageRowCount: options && options.pageRowCount || undefined,\r\n      queryType: options && options.queryType || undefined,\r\n      queryServiceId: options && options.queryServiceId || undefined,\r\n      queryParam: options && options.queryParam || undefined\r\n    };\r\n    return so;\r\n  }\r\n  /**\r\n   * æé OutputOptions\r\n   * @param options options\r\n   */\r\n  private buildOutputOptions(options?: { [prop: string]: any }): OutputOptions {\r\n    const oo: OutputOptions = {\r\n      OutputType: options && options.outputType || OutputType.PRINT,\r\n      FileType: options && options.fileType || FileType.Html5,\r\n      Path: options && options.path || undefined,\r\n      DeviceId: options && options.deviceId || undefined,\r\n      printJob: options && options.printJob || undefined,\r\n      printerName: options && options.printerName || undefined,\r\n      printSetting: options && options.printSetting || undefined,\r\n      printType: options && options.printType || PrintType.Form\r\n    };\r\n    return oo;\r\n  }\r\n  /**\r\n   * æé SourceFilterOptions\r\n   * @param options options\r\n   */\r\n  private buildSourceFilterOptions(options: { sourceId: string, [prop: string]: any }): SourceFilterOptions {\r\n    const entryFilter = { 'isUsePagination': false, 'filterConditions': [], 'sortConditions': [], 'pagination': null };\r\n    const sfo: SourceFilterOptions & { [prop: string]: any } = {\r\n      SourceId: options.sourceId,\r\n      EntityFilter: options && options.entryFilter || entryFilter,\r\n      FirstDimensionVal: options && options.dim1 || undefined,\r\n      SecondDimensionVal: options && options.dim2 || undefined,\r\n      FormatId: options && options.formatId || undefined,\r\n      ServiceUnit: options && options.serviceUnit || undefined,\r\n      billCategoryId: options && options.billCategoryId || undefined,\r\n      currentPage: options && options.currentPage || undefined,\r\n      pageRowCount: options && options.pageRowCount || undefined,\r\n      queryParam: options && options.queryParam || undefined,\r\n      queryServiceId: options && options.queryServiceId || undefined,\r\n      queryType: options && options.queryType || undefined,\r\n      includeChildData: options && options.hasOwnProperty('includeChildData') ? options.includeChildData : true\r\n    };\r\n    return sfo;\r\n  }\r\n  /**\r\n   * å±ç¤ºéè¯¯æ¶æ¯\r\n   * @param message éè¯¯æ¶æ¯\r\n   */\r\n  private showWarning(message: string) {\r\n    if (this.notifyService) {\r\n      this.notifyService.warning(message, { hideTitle: true });\r\n    } else if (this.msgService) {\r\n      this.msgService.error(message);\r\n    }\r\n  }\r\n  private get notifyService(): FormNotifyService | null {\r\n    if (this.formNotifyService) {\r\n      return this.formNotifyService;\r\n    } else if (this.injector) {\r\n      return this.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    }\r\n    return null;\r\n  }\r\n  private get commandContext(): CommandContext | null {\r\n    return this['context'] || null;\r\n  }\r\n  private get frameContext(): FrameContext | null {\r\n    return this.commandContext && this.commandContext.frameContext || null;\r\n  }\r\n  private get injector(): Injector | null {\r\n    return this.frameContext && this.frameContext.injector || null;\r\n  }\r\n}\r\n\r\nexport { PrintService };\r\n","/**\r\n * éä»¶ä¿¡æ¯å®ä¹\r\n */\r\ninterface AttachmentInfo {\r\n\r\n  /**\r\n   * éä»¶id\r\n   */\r\n  attachmentId: string;\r\n\r\n  /**\r\n   * éä»¶åç§°\r\n   */\r\n  fileName: string;\r\n}\r\n\r\n\r\n/**\r\n * æå¡å¨ç«¯æéçéä»¶ä¿¡æ¯å®ä¹\r\n */\r\ninterface ServerAttachmentInfo {\r\n\r\n  /**\r\n   * è¡¨åè·¯å¾\r\n   */\r\n  NodeCodes: string[];\r\n\r\n  /**\r\n   * ä¸»é®è·¯å¾\r\n   */\r\n  HiretryIds: string[];\r\n\r\n  /**\r\n   * éä»¶idæ°ç»ï¼æ¹éæ°å¢æ¶ä½¿ç¨ï¼\r\n   */\r\n  AttachmentIds?: string[];\r\n\r\n  /**\r\n   * éä»¶idï¼æ´æ°æ¶ä½¿ç¨ï¼\r\n   */\r\n  AttachmentId?: string;\r\n}\r\n/**\r\n * éä»¶udtæåºå­æ®µ\r\n */\r\nconst ATTACHMENT_ORDER_FIELD = 'fileSortOrder';\r\n\r\nexport { AttachmentInfo, ServerAttachmentInfo, ATTACHMENT_ORDER_FIELD };\r\n","import { UploadFileInfo } from '@gsp-svc/formdoc-upload';\r\nimport { AttachmentInfo } from './types';\r\n\r\n/**\r\n * éä»¶ä¿¡æ¯å¤çå·¥å·ç±»\r\n */\r\nclass AttachmentUtil {\r\n\r\n  /**\r\n   * è½¬æ¢ä¸ºéä»¶ä¿¡æ¯æ°ç»\r\n   */\r\n  public static convertToAttachmentInfos(fileInfos: UploadFileInfo[]): AttachmentInfo[] {\r\n    if (!fileInfos) {\r\n      return [];\r\n    }\r\n    const attachmentInfos: AttachmentInfo[] = fileInfos.map((fileInfo: UploadFileInfo) => {\r\n      return this.convertToAttachmentInfo(fileInfo);\r\n    });\r\n    return attachmentInfos;\r\n  }\r\n\r\n  /**\r\n   * è½¬æ¢ä¸ºéä»¶ä¿¡æ¯\r\n   */\r\n  public static convertToAttachmentInfo(fileInfo: UploadFileInfo): AttachmentInfo {\r\n    const attachmentInfo: AttachmentInfo = {\r\n      attachmentId: fileInfo.metadataId,\r\n      fileName: fileInfo.fileName\r\n    };\r\n    return attachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * è·åéä»¶åè¡¨ä¸­çç¬¬ä¸ä¸ªéä»¶\r\n   */\r\n  public static getFirstAttachmentInfo(attachmentInfos: AttachmentInfo[]) {\r\n    if (!attachmentInfos || attachmentInfos.length === 0) {\r\n      return;\r\n    }\r\n    const firstAttachmentInfo = attachmentInfos[0];\r\n    return firstAttachmentInfo;\r\n  }\r\n\r\n  /**\r\n   * æåéä»¶idæ°ç»\r\n   */\r\n  public static peekAttachmentIds(attachmentInfos: AttachmentInfo[]) {\r\n    if (!attachmentInfos) {\r\n      attachmentInfos = [];\r\n    }\r\n    const attachmentIds = attachmentInfos.map((attachmentInfo: AttachmentInfo) => {\r\n      return attachmentInfo.attachmentId;\r\n    });\r\n\r\n    return attachmentIds;\r\n  }\r\n\r\n}\r\n\r\nexport { AttachmentUtil };\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of } from 'rxjs';\r\nimport { tap, switchMap, map } from 'rxjs/operators';\r\nimport { FrameContext, Entity, BindingData, BindingPathConverter } from '@farris/devkit';\r\nimport { BefRepository, BefDataPathUtil, ResponseInfo } from '@farris/bef';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { AttachmentInfo, ServerAttachmentInfo } from './types';\r\nimport { AttachmentUtil } from './attachment.util';\r\n\r\n/**\r\n * éä»¶è°ç¨\r\n */\r\n@Injectable()\r\nclass AttachmentDataService {\r\n\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  constructor(private frameContext: FrameContext, private loadingService: FormLoadingService) {\r\n  }\r\n\r\n  /**\r\n   * æ´æ°éä»¶ä¿¡æ¯\r\n   */\r\n  public updateRow(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/updateattachment`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const body = {\r\n      updateAttachInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * éè¿å±æ§åæ´æ°éä»¶ä¿¡æ¯\r\n   * @param attachmentInfoFieldPath éä»¶å­æ®µ\r\n   * @param attachmentInfo éä»¶ä¿¡æ¯\r\n   */\r\n  public updateRowWithPropertyName(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/updateattachmentwithproptyname`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const propertyName = attachmentInfoFieldPath.split('/').filter(p => p).pop();\r\n    const body = {\r\n      updateAttachInfo: serverAttachInfo,\r\n      propertyName,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * å é¤éä»¶\r\n   * @param attachmentInfoFieldPath \r\n   * @param attachmentInfo \r\n   * @returns \r\n   */\r\n  public removeAttachment(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo) {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/deleteattachment`;\r\n    const serverAttachInfo = this.createUpdateAttachInfo(attachmentInfoFieldPath, attachmentInfo);\r\n    const propertyName = attachmentInfoFieldPath.split('/').filter(p => p).pop();\r\n    const body = {\r\n      deleteAttachInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo(),\r\n      propertyName,\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.syncAttachmentInfosToClient();\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¹éåå»ºéä»¶è¡æ°æ®\r\n   */\r\n  public updateRows(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[]): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/batchuploadattachment`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.appendAttachmentInfosToClient(responseInfo.returnValue, isRootEntity);\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¹éåå»ºéä»¶è¡æ°æ®\r\n   */\r\n  public updateRowsWithConfigs(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[], configs: { [prop: string]: any }): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/batchuploadattachment`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    // const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.appendAttachmentInfos(responseInfo.returnValue, configs);\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ ¹æ®å±æ§åæ¹éåå»ºéä»¶è¡æ°æ®\r\n   */\r\n  public updateRowsWithPropertyName(attachmentInfoFieldPath: string, attachmentInfos: AttachmentInfo[]): Observable<any> {\r\n    const restService = this.repository.restService;\r\n    const baseUri = restService.baseUri;\r\n    const updateUri = `${baseUri}/service/batchuploadattachmentwithproptyname`;\r\n    const serverAttachInfo = this.createBatchCreateAttachInfo(attachmentInfoFieldPath, attachmentInfos);\r\n    const isRootEntity = serverAttachInfo.NodeCodes.length === 0;\r\n    const propertyName = attachmentInfoFieldPath.split('/').filter(p => p).pop();\r\n\r\n    const body = {\r\n      batchUploadInfo: serverAttachInfo,\r\n      propertyName,\r\n      requestInfo: restService.buildRequestInfo()\r\n    };\r\n    const options = {\r\n      body: body\r\n    };\r\n    return restService.invoke(updateUri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        return this.appendAttachmentInfosToClient(responseInfo.returnValue, isRootEntity);\r\n      }),\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * åå»ºæå¡å¨ç«¯éè¦çæ´æ°ä¿¡æ¯\r\n   */\r\n  private createUpdateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo): ServerAttachmentInfo {\r\n\r\n    const attachmentId = attachmentInfo.attachmentId;\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForUpdate(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo: ServerAttachmentInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: [attachmentId],\r\n      AttachmentId: attachmentId\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * åå»ºæå¡å¨ç«¯éè¦çæ¹éæ°å¢éä»¶ä¿¡æ¯\r\n   */\r\n  private createBatchCreateAttachInfo(attachmentInfoFieldPath: string, attachmentInfo: AttachmentInfo[]): ServerAttachmentInfo {\r\n    const attachmentIds = AttachmentUtil.peekAttachmentIds(attachmentInfo);\r\n\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const nodeCodes = BefDataPathUtil.convertToObjectCodes(parentBindingPathArray, this.bindingData);\r\n    const hiretryIds = BefDataPathUtil.convertToDataIdsForAdd(parentBindingPathArray, this.bindingData);\r\n\r\n    const serverAttachInfo = {\r\n      NodeCodes: nodeCodes,\r\n      HiretryIds: hiretryIds,\r\n      AttachmentIds: attachmentIds,\r\n      AttachmentId: null\r\n    };\r\n\r\n    return serverAttachInfo;\r\n  }\r\n\r\n  /**\r\n   * åæ­¥æå¡å¨ç«¯ææ°ä¿¡æ¯å°å®¢æ·ç«¯\r\n   * @todo:\r\n   * 1ãä¸»å¯¹è±¡æ¹éæ°å¢æ¶ä¸æ¯æ\r\n   */\r\n  public syncAttachmentInfosToClient() {\r\n    const rootDataId = this.bindingData.list.currentId;\r\n    return this.repository.updateEntityById(rootDataId);\r\n  }\r\n\r\n  /**\r\n   * è¿½å ä¸»è¡¨æ°æ®å°å®¢æ·ç«¯\r\n   */\r\n  public appendAttachmentInfosToClient(listData: any[], isRootEntity: boolean): Observable<any[]> {\r\n    if (isRootEntity === true) {\r\n      const entities = this.repository.buildEntities(listData);\r\n      this.repository.entityCollection.addEntities(entities);\r\n      return of(listData);\r\n    } else {\r\n      const rootDataId = this.bindingData.list.currentId;\r\n      return this.repository.updateEntityById(rootDataId).pipe(\r\n        map(() => listData)\r\n      );\r\n    }\r\n  }\r\n  public appendAttachmentInfos(listData: any[], keyValues: { [prop: string]: any }): Observable<any[]> {\r\n    const entities = this.repository.buildEntities(listData);\r\n    this.repository.entityCollection.addEntities(entities);\r\n    // æ´æ°å®ä½ä½¿ä¹äº§çåæ´é\r\n    this.updateEntities(entities, keyValues);\r\n    return of(listData);\r\n  }\r\n  private updateEntities(entities: Entity[], keyValues: { [prop: string]: any }) {\r\n    entities.forEach((entity: Entity) => {\r\n      this.updateEntity(entity, keyValues);\r\n    });\r\n  }\r\n  private updateEntity(target: Entity, keyValues: { [prop: string]: any }) {\r\n    Object.keys(keyValues).forEach((key: string) => {\r\n      this.setValueByPath(target, key, keyValues[key]);\r\n    });\r\n  }\r\n  private setValueByPath(target: object, path: string, value: any) {\r\n    if (target) {\r\n      const paths = path.split('.');\r\n      if (paths.length <= 1) {\r\n        target[path] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport { AttachmentDataService };\r\n","import { Injectable, InjectFlags, Optional } from '@angular/core';\r\nimport { Observable, from, of, empty, EMPTY } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { UploadDialogService, UploadFileInfo, UploadLimit, DownloadService, FileState } from '@gsp-svc/formdoc-upload';\r\nimport { FileViewerService } from '@gsp-svc/file-viewer';\r\nimport { FrameContext, BindingData, BindingPathConverter, BindingList, DataPathUtil, DataPathCreator, EntityList, Entity } from '@farris/devkit';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { AttachmentUtil } from './attachment.util';\r\nimport { AttachmentDataService } from './attachment-data.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { BasePathService } from '@farris/rtf';\r\n\r\n// tslint:disable: max-line-length\r\n/**\r\n * éä»¶æå¡\r\n */\r\n@Injectable()\r\nclass AttachmentService {\r\n  /**\r\n   * é»è®¤æ ¹ç®å½\r\n   */\r\n  private defaultRootDirId = '';\r\n\r\n  /**\r\n   * é»è®¤ç¶è·¯å¾\r\n   */\r\n  private get defaultParentDirName(): string {\r\n    return this.frameContext.bindingData.list.currentId;\r\n  }\r\n\r\n  /**\r\n   * ç»å®æ°æ®\r\n   */\r\n  private get bindingData(): BindingData {\r\n    return this.frameContext.bindingData;\r\n  }\r\n\r\n  /**\r\n   * å¤è¯­æå¡\r\n   */\r\n  private languageService: LanguageService;\r\n\r\n  /**\r\n   * éä»¶é¢è§æå¡\r\n   */\r\n  private fileViewerService: FileViewerService;\r\n\r\n  /**\r\n   * å®ä½æå¡\r\n   */\r\n  private entityService: EntityService;\r\n\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private attachDataService: AttachmentDataService,\r\n    private notifyService: FormNotifyService,\r\n    private uploadDialogService: UploadDialogService,\r\n    @Optional() private downloadService: DownloadService\r\n  ) {\r\n    this.setLanguageService();\r\n    this.fileViewerService = this.frameContext.injector.get<FileViewerService>(FileViewerService, null, InjectFlags.Optional);\r\n    this.entityService = this.frameContext.injector.get<EntityService>(EntityService, null, InjectFlags.Optional);\r\n    if (!this.downloadService && typeof DownloadService !== 'undefined') {\r\n      this.downloadService = this.frameContext.injector.get<DownloadService>(DownloadService, null);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®è¯­è¨æå¡\r\n   */\r\n  private setLanguageService() {\r\n    const injector = this.frameContext.injector;\r\n    this.languageService = injector.get<LanguageService>(LanguageService, null, InjectFlags.Optional);\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ä¸ä¼ åä¸ªæä»¶\r\n   * @param attachmentIdPath éä»¶åç å­æ®µçè·¯å¾ï¼å½¢å¦/attachInfo/attachmentIdï¼\r\n   * @param attachmentNamePath éä»¶åç§°å­æ®µçè·¯å¾\r\n   */\r\n  public uploadAndUpdateRow(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string, id?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    uploadLimit.fileCount = 1;\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n    // è·åèçéä»¶idæ°ç»\r\n    const attachmentIdList = [];\r\n    let currentItem = null;\r\n    if (id) {\r\n      // ä¿®æ­£å½åè¡\r\n      const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n      if (bindingList.currentId !== id) {\r\n        bindingList.setCurrentId(id, true, true);\r\n      }\r\n      // å¦ææå®äºidåè·åæå®idçè¡\r\n      currentItem = this.getSpecialRow(attachmentInfoFieldPath, id);\r\n    } else {\r\n      // æ²¡ææå®åä½¿ç¨å½åè¡ï¼å¯è½å­å¨å½åè¡åäºä»¶è¡ä¸ä¸è´çæåµï¼æ­¤æ¶åºè¯¥å¨å½ä»¤ä¸­ä¼ éidåæ°\r\n      currentItem = this.getCurrentRow(attachmentInfoFieldPath);\r\n    }\r\n    if (currentItem && currentItem.primaryKeyValue) {\r\n      const attachmentIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, [currentItem.primaryKeyValue]);\r\n      if (attachmentIds && attachmentIds.length > 0) {\r\n        attachmentIdList.push.apply(attachmentIdList, attachmentIds);\r\n      }\r\n    } else {\r\n      this.notifyService.warning(this.languageService.plsSelectUpdateRow, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit, attachmentIdList));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return empty();\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        // æ¯å¦ä¸ä¼ å¤æ­\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        const firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);\r\n        return this.attachDataService.updateRow(attachmentInfoFieldPath, firstAttachmentInfo);\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸ä¼ åä¸ªæä»¶ï¼æ¯æå¤åï¼\r\n   * @param attachmentInfoFieldPath éä»¶åç å­æ®µçè·¯å¾ï¼å½¢å¦/attachInfo/attachmentIdï¼\r\n   * @param rootDirId éä»¶å­å¨æ ¹ç®å½\r\n   * @param parentDirName éä»¶å­å¨ç®å½\r\n   * @param fileType æä»¶ç±»åï¼like .txt,.docx\r\n   */\r\n  public uploadAndUpdateRowWithPropertyName(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string, id?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    uploadLimit.fileCount = 1;\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n\r\n    // è·åèçéä»¶idæ°ç»\r\n    const attachmentIdList = [];\r\n    let currentItem = null;\r\n    if (id) {\r\n      // ä¿®æ­£å½åè¡\r\n      const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n      if (bindingList.currentId !== id) {\r\n        bindingList.setCurrentId(id, true, true);\r\n      }\r\n      // å¦ææå®äºidåè·åæå®idçè¡\r\n      currentItem = this.getSpecialRow(attachmentInfoFieldPath, id);\r\n    } else {\r\n      // æ²¡ææå®åä½¿ç¨å½åè¡ï¼å¯è½å­å¨å½åè¡åäºä»¶è¡ä¸ä¸è´çæåµï¼æ­¤æ¶åºè¯¥å¨å½ä»¤ä¸­ä¼ éidåæ°\r\n      currentItem = this.getCurrentRow(attachmentInfoFieldPath);\r\n    }\r\n    if (currentItem && currentItem.primaryKeyValue) {\r\n      const attachmentIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, [currentItem.primaryKeyValue]);\r\n      if (attachmentIds && attachmentIds.length > 0) {\r\n        attachmentIdList.push.apply(attachmentIdList, attachmentIds);\r\n      }\r\n    } else {\r\n      this.notifyService.warning(this.languageService.plsSelectUpdateRow, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit, attachmentIdList));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        // æ¯å¦ä¸ä¼ å¤æ­\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        const firstAttachmentInfo = AttachmentUtil.getFirstAttachmentInfo(attachmentInfos);\r\n        return this.attachDataService.updateRowWithPropertyName(attachmentInfoFieldPath, firstAttachmentInfo);\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸ä¼ å¤ä¸ªæä»¶\r\n   */\r\n  public uploadAndBatchAddRows(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        return this.attachDataService.updateRows(attachmentInfoFieldPath, attachmentInfos);\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸ä¼ å¤ä¸ªæä»¶\r\n   */\r\n  public uploadAndBatchAddRowsWithPropertyName(attachmentInfoFieldPath: string, rootDirId?: string, parentDirName?: string, fileType?: string, id?: string): Observable<any> {\r\n    const rootId = rootDirId ? rootDirId : this.defaultRootDirId;\r\n    const formId = parentDirName ? parentDirName : this.defaultParentDirName;\r\n    if (!rootId || !formId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const uploadLimit: UploadLimit = new UploadLimit();\r\n    if (fileType) {\r\n      uploadLimit.fileType = fileType;\r\n    }\r\n    if (id) {\r\n      // ä¿®æ­£å½åè¡\r\n      const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n      if (bindingList.currentId !== id) {\r\n        bindingList.setCurrentId(id, true, true);\r\n      }\r\n    }\r\n    const dialog$ = from(this.uploadDialogService.uploadFileWithLimit(formId, rootId, uploadLimit));\r\n    const result$ = dialog$.pipe(\r\n      switchMap((fileInfos: UploadFileInfo[]) => {\r\n        if (!fileInfos || fileInfos.length === 0) {\r\n          this.notifyService.warning(this.languageService.plsUploadFirst, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        // è¿æ»¤åºstateä¸ºæ°å¢çéä»¶\r\n        fileInfos = fileInfos.filter((fileInfo: UploadFileInfo) => {\r\n          if (fileInfo.hasOwnProperty('state')) {\r\n            return fileInfo.state === FileState.New;\r\n          }\r\n          return true;\r\n        });\r\n        if (fileInfos.length === 0) {\r\n          return of(true);\r\n        }\r\n        const attachmentInfos = AttachmentUtil.convertToAttachmentInfos(fileInfos);\r\n        return this.attachDataService.updateRowsWithPropertyName(attachmentInfoFieldPath, attachmentInfos);\r\n      })\r\n    );\r\n    return result$;\r\n  }\r\n  /**\r\n   * ä¸è½½éä»¶ï¼æ ¹æ®éä»¶idï¼\r\n   */\r\n  public download(attachId: string, rootId?: string): any {\r\n    if (!attachId) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    rootId = rootId || 'default-root';\r\n    const url = this.getDownloadUrl([attachId], rootId);\r\n    // let url = '';\r\n    // if (rootId) {\r\n    //   url = `/api/runtime/dfs/v1.0/formdoc/filecontent?metadataid=${attachId}&rootid=${rootId}`;\r\n    // } else {\r\n    //   url = `/api/runtime/dfs/v1.0/formdoc/download/${attachId}`;\r\n    // }\r\n    window.open(url);\r\n    return of(true);\r\n  }\r\n  /**\r\n   * æ¹éä¸è½½éä»¶ï¼æ ¹æ®éä»¶idæ°ç»ï¼\r\n   */\r\n  public batchDownload(attachIds: string[], rootId: string): any {\r\n    if (!attachIds || attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    // åªéæ©ä¸ä¸ªéä»¶æ¶æåä¸ªéä»¶ä¸è½½å¤ç\r\n    if (attachIds.length === 1) {\r\n      return this.download(attachIds[0], rootId);\r\n    }\r\n    // const attachIdsString = JSON.stringify(attachIds);\r\n    // const url = `/api/runtime/dfs/v1.0/formdoc/multiple/download?metadataidlist=${attachIdsString}&rootid=${rootId}`;\r\n    const url = this.getDownloadUrl(attachIds, rootId);\r\n    window.open(url);\r\n    return of(true);\r\n  }\r\n  /**\r\n   * è·åä¸è½½è·¯å¾\r\n   * @param metadataidlist éä»¶idæ°ç»\r\n   * @param rootId rootId\r\n   */\r\n  private getDownloadUrl(metadataidlist: Array<string>, rootId: string): string {\r\n    rootId = rootId || 'default-root';\r\n    if (this.downloadService) {\r\n      if (metadataidlist.length === 1) {\r\n        return this.downloadService.getDownloadUrl(metadataidlist[0], rootId);\r\n      } else {\r\n        const attachIdsString = JSON.stringify(metadataidlist);\r\n        return this.downloadService.getMultipleDownloadUrl(attachIdsString, rootId);\r\n      }\r\n    } else {\r\n      console.warn('å å®å¨é®é¢ï¼éä»¶ä¸è½½æä¾å®å¨æ ¡éªæºå¶ï¼éä»¶ä¸è½½åè½ééæ°ç¼è¯ã');\r\n      if (metadataidlist.length === 1) {\r\n        return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/filecontent?metadataid=${metadataidlist[0]}&rootid=${rootId}`);\r\n      } else {\r\n        const attachIdsString = JSON.stringify(metadataidlist);\r\n        return BasePathService.convertPath(`/api/runtime/dfs/v1.0/formdoc/multiple/download?metadataidlist=${attachIdsString}&rootid=${rootId}`);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * ä¸è½½ï¼æ ¹æ®æ°æ®idï¼\r\n   */\r\n  public downloadByDataId(dataId: string, attachmentInfoFieldPath: string, rootId: string): Observable<any> {\r\n    if (!dataId) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const dataIds = [dataId];\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, dataIds);\r\n    if (attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const attachId = attachIds[0];\r\n    return this.download(attachId);\r\n  }\r\n\r\n  /**\r\n   * æ¹éä¸è½½éä»¶\r\n   */\r\n  public batchDownloadByDataIds(dataIds: string[] | string, attachmentInfoFieldPath: string, rootId: string): Observable<any> {\r\n    if (typeof dataIds === 'string' && dataIds && dataIds.length > 0) {\r\n      dataIds = dataIds.split(',').filter(p => p);\r\n    }\r\n    if (!dataIds || Array.isArray(dataIds) === false || dataIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.plsSelectDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const ids = [].concat(dataIds);\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, ids);\r\n    if (attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noDownloadAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    return this.batchDownload(attachIds, rootId);\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®éä»¶UDTå­æ®µçè·¯å¾é¢è§éä»¶\r\n   * @param attachmentInfoFieldPath éä»¶UDTå­æ®µpath\r\n   * @param rootDirId è·ç®å½id\r\n   * @param ids éä»¶id\r\n   */\r\n  public previewByAttachmentInfoFieldPath(attachmentInfoFieldPath: string, rootDirId: string, ids?: any) {\r\n    if (!attachmentInfoFieldPath || !rootDirId) {\r\n      throw new Error('attachmentInfoFieldPathårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    let attachIds = [];\r\n    let dataIds = [];\r\n    if (ids && ids.length > 0) {\r\n      if (typeof (ids) === 'string') {\r\n        dataIds.push(ids);\r\n      } else {\r\n        dataIds = ids;\r\n      }\r\n      attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, dataIds);\r\n    } else {\r\n      attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, null);\r\n    }\r\n    if (attachIds && attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    return this.previewByAttachmentIds(attachIds, rootDirId);\r\n  }\r\n  /**\r\n   * æ ¹æ®éä»¶UDTå­æ®µçè·¯å¾é¢è§å½åè¡çéä»¶\r\n   * @param attachmentInfoFieldPath éä»¶UDTå­æ®µpath\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewByAttachmentInfoFieldPathWithIndex(attachmentInfoFieldPath: string, rootDirId: string): Observable<any> {\r\n    if (!attachmentInfoFieldPath || !rootDirId) {\r\n      throw new Error('attachmentInfoFieldPathårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const currentRow = this.getCurrentRow(attachmentInfoFieldPath);\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentFieldName = parentBindingPathArray.pop();\r\n    if (!currentRow[attachmentFieldName] || !currentRow[attachmentFieldName]['attachmentId']) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, null);\r\n    if (attachIds && attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const attachmentId = this.getCurrentAttachmentId(attachmentInfoFieldPath);\r\n    if (!attachmentId) {\r\n      throw new Error('è¦é¢è§çéä»¶idä¸å­å¨ï¼è¯·ç¡®è®¤');\r\n    } else {\r\n      return this.previewFileListWithIndex(attachIds, rootDirId, attachmentId);\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®ç®å½é¢è§éä»¶\r\n   * @param subDirName ç¶ç®å½åç§°\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewBySubDirName(subDirName: string, rootDirId: string): Observable<any> {\r\n    if (!subDirName || !rootDirId) {\r\n      throw new Error('subDirNameårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const viewer$ = from(this.fileViewerService.viewerFormFile(subDirName, rootDirId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * æ ¹æ®ç®å½é¢è§æå®ç´¢å¼çéä»¶\r\n   * @param attachmentInfoFieldPath éä»¶UDTå­æ®µpath\r\n   * @param subDirName å­ç®å½åç§°\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewBySubDirNameWithIndex(attachmentInfoFieldPath: string, subDirName: string, rootDirId: string): Observable<any> {\r\n    if (!subDirName || !rootDirId) {\r\n      throw new Error('subDirNameårootDirIdä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    // const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, null);\r\n    const attachmentId = this.getCurrentAttachmentId(attachmentInfoFieldPath);\r\n    if (!attachmentId) {\r\n      this.notifyService.warning(this.languageService.noAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const viewer$ = from(this.fileViewerService.viewerFormFileWithIndex(subDirName, rootDirId, attachmentId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * æ ¹æ®éä»¶idæ°ç»é¢è§éä»¶\r\n   * @param attachmentIds éä»¶idæ°ç»\r\n   * @param rootDirId æ ¹ç®å½id\r\n   */\r\n  public previewByAttachmentIds(attachmentIds: string[], rootDirId: string): Observable<any> {\r\n    const viewer$ = from(this.fileViewerService.viewerFileList(attachmentIds, rootDirId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * æ ¹æ®éä»¶idæ°ç»é¢è§æå®ç´¢å¼çéä»¶\r\n   * @param attachmentIds éä»¶idæ°ç»\r\n   * @param rootDirId æ ¹ç®å½id\r\n   * @param attachmentId éä»¶Id\r\n   */\r\n  public previewFileListWithIndex(attachmentIds: string[], rootDirId: string, attachmentId: string) {\r\n    const viewer$ = from(this.fileViewerService.viewerFileListWithIndex(attachmentIds, rootDirId, attachmentId));\r\n    return viewer$;\r\n  }\r\n  /**\r\n   * çæçæ¬å·\r\n   * @param versions åå²çæ¬å·\r\n   * @description é»è®¤ç¼ç è§åv1.0 v2.0 ...\r\n   */\r\n  public genVersion(versions: string[]) {\r\n    if (!versions) {\r\n      versions = [];\r\n    }\r\n    const mainCode = versions.length + 1;\r\n    return `V${mainCode}.0`;\r\n  }\r\n  /**\r\n   * æ´æ°éä»¶çæ¬ä¿¡æ¯\r\n   * @param versionField éä»¶çæ¬å­æ®µ\r\n   * @param historyField æ¯å¦åå²çæ¬å­æ®µ\r\n   * @param attachmentFieldPath éä»¶udtå­æ®µè·¯å¾\r\n   */\r\n  public updateAttachmentVersion(versionField: string, historyField: string, attachmentFieldPath: string) {\r\n    /**\r\n     * éåææéä»¶è¡\r\n     * æ¾å°æææ²¡æéä»¶çæ¬çè¡\r\n     * éåè¿äºè¡\r\n     * éè¿æä»¶åå»æ¥æ¾ååçä¸æéä»¶çæ¬å·çè¡\r\n     * è¿äºè¡åå²çæ¬å­æ®µç½®ä¸ºtrue\r\n     * æ çæ¬å·çè¡ï¼çæ¬= ä¸è¡æ° + 1\r\n     *\r\n     */\r\n    const bindingPaths = attachmentFieldPath.split('/').filter(p => p);\r\n    // å¼¹åºéä»¶udtå­æ®µ\r\n    const attachmentField = bindingPaths.pop();\r\n    // è·åå°ææçéä»¶\r\n    const attachmentBindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    const befRepository = this.frameContext.repository as BefRepository<any>;\r\n    const entityManager = befRepository.entityManager;\r\n    const dataPath = DataPathCreator.createByShortPathFromRoot(bindingPaths, entityManager, this.frameContext.bindingData);\r\n    const paths = dataPath.toArray().map((path: string) => {\r\n      if (path.startsWith('PropName:')) {\r\n        return path.split(':')[1];\r\n      } else {\r\n        return path;\r\n      }\r\n    });\r\n    if (attachmentBindingList) {\r\n      const attachments = attachmentBindingList.toJSON();\r\n      // åªå¤çæéä»¶çæåµ\r\n      if (attachments) {\r\n        const versionLessRows = attachments.filter(item => !item[versionField]);\r\n        versionLessRows.forEach(item => {\r\n          const fileName = item[attachmentField]['fileName'];\r\n          const versionedRows = attachments.filter(row => row[attachmentField]['fileName'] === fileName && row[versionField]);\r\n          paths.pop();\r\n          paths.push(`DataId:${item[attachmentBindingList.primaryKey]}`);\r\n          let entity = this.frameContext.repository.entityCollection.getEntityByPath(paths);\r\n          const version = this.genVersion(versionedRows);\r\n          entity[versionField] = version;\r\n          entity[historyField] = false;\r\n          // å¤çåå²è®°å½\r\n          versionedRows.forEach(row => {\r\n            paths.pop();\r\n            paths.push(`DataId:${row[attachmentBindingList.primaryKey]}`);\r\n            entity = this.frameContext.repository.entityCollection.getEntityByPath(paths);\r\n            entity[historyField] = true;\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n  public isAttachmentCanDelete(historyField: string, attachmentFieldPath: string) {\r\n    const bindingPaths = attachmentFieldPath.split('/').filter(p => p);\r\n    // å¼¹åºéä»¶udtå­æ®µ\r\n    bindingPaths.pop();\r\n    const attachmentBindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    const bindingObject = attachmentBindingList.currentItem;\r\n    if (bindingObject[historyField] === true) {\r\n      this.notifyService.warning(this.languageService.historyAttachment, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n  }\r\n  public updateAttachmentHistory(versionField: string, historyField: string, attachmentFieldPath: string) {\r\n    const bindingPaths = attachmentFieldPath.split('/').filter(p => p);\r\n    // å¼¹åºéä»¶udtå­æ®µ\r\n    const attachmentField = bindingPaths.pop();\r\n    // è·åå°ææçéä»¶\r\n    const attachmentBindingList = this.frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    // const befRepository = this.frameContext.repository as BefRepository<any>;\r\n    // const entityManager = befRepository.entityManager;\r\n    if (attachmentBindingList) {\r\n      const attachments = attachmentBindingList.toJSON();\r\n      const versionedRows = attachments.filter(item => item[versionField]);\r\n      const fileNameMap = new Map<string, Array<any>>();\r\n      const befRepository = this.frameContext.repository as BefRepository<any>;\r\n      const entityManager = befRepository.entityManager;\r\n      const dataPath = DataPathCreator.createByShortPathFromRoot(bindingPaths, entityManager, this.frameContext.bindingData);\r\n      const paths = dataPath.toArray().map((path: string) => {\r\n        if (path.startsWith('PropName:')) {\r\n          return path.split(':')[1];\r\n        } else {\r\n          return path;\r\n        }\r\n      });\r\n      versionedRows.forEach(item => {\r\n        const fileName = item[attachmentField]['fileName'];\r\n        if (fileNameMap.has(fileName)) {\r\n          fileNameMap.get(fileName).push(item);\r\n        } else {\r\n          fileNameMap.set(fileName, [item]);\r\n        }\r\n      });\r\n      Array.from(fileNameMap.values()).forEach((array: Array<any>) => {\r\n        array.sort((x, y) => {\r\n          const xVersion = parseInt(x[versionField].replace(/[a-zA-Z\\.]/g, ''));\r\n          const yVersion = parseInt(y[versionField].replace(/[a-zA-Z\\.]/g, ''));\r\n          return yVersion - xVersion;\r\n        });\r\n        const row = array[0];\r\n        paths.pop();\r\n        paths.push(`DataId:${row[attachmentBindingList.primaryKey]}`);\r\n        const entity = this.frameContext.repository.entityCollection.getEntityByPath(paths);\r\n        entity[historyField] = false;\r\n      });\r\n    }\r\n  }\r\n  /**\r\n   * å é¤éä»¶\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µè·¯å¾\r\n   * @param id æ°æ®id\r\n   * @param rootDirId æ ¹ç®å½\r\n   * @returns\r\n   */\r\n  public removeAttachment(attachmentInfoFieldPath: string, id: string, rootDirId: string): Observable<any> {\r\n    const rootId = rootDirId;\r\n    if (!rootId) {\r\n      throw new Error('rootDirIdåparentDirNameä¸è½ä¸ºç©ºï¼è¯·å¡«å');\r\n    }\r\n    const dataIds = [id];\r\n    const attachIds = this.getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath, dataIds);\r\n    if (attachIds.length === 0) {\r\n      this.notifyService.warning(this.languageService.plsSelectRemoveAtt, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    const attachmentId = attachIds[0];\r\n    return this.attachDataService.removeAttachment(attachmentInfoFieldPath, { attachmentId, fileName: null });\r\n  }\r\n  /**\r\n   * è·åå½åè§å¾æ¨¡åå½åè¡çéä»¶id\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µ\r\n   */\r\n  private getCurrentAttachmentId(attachmentInfoFieldPath: string) {\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentFieldName = parentBindingPathArray.pop();\r\n    const bindingList: BindingList = this.frameContext.bindingData.getValue(parentBindingPathArray) as BindingList;\r\n    const currentItem = bindingList.currentItem;\r\n    if (currentItem && currentItem.primaryKeyValue) {\r\n      return currentItem[attachmentFieldName] && currentItem[attachmentFieldName]['attachmentId'] || null;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * è·åå½åè¡\r\n   * @param attachmentInfoFieldPath udtå­æ®µ\r\n   */\r\n  private getCurrentRow(attachmentInfoFieldPath: string) {\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const bindingList: BindingList = this.frameContext.bindingData.getValue(parentBindingPathArray) as BindingList;\r\n    const currentItem = bindingList && bindingList.currentItem;\r\n    return currentItem;\r\n  }\r\n  /**\r\n   * è·åæå®éä»¶ä¿¡æ¯è¡¨çæå®è¡\r\n   * @param attachmentInfoFieldPath\r\n   * @param primaryValue\r\n   * @returns\r\n   */\r\n  private getSpecialRow(attachmentInfoFieldPath: string, primaryValue: string) {\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    parentBindingPathArray.pop();\r\n    const bindingList: BindingList = this.frameContext.bindingData.getValue(parentBindingPathArray) as BindingList;\r\n    const currentItem = bindingList && bindingList.findById(primaryValue);\r\n    return currentItem;\r\n  }\r\n  /**\r\n   * è·ådataIdså¯¹åºEntityä¸çéä»¶idæ°ç»\r\n   */\r\n  private getAttachmentIdsByPathAndDataIds(attachmentInfoFieldPath: string, dataIds?: string[]): string[] {\r\n\r\n    // è§£æè·¯å¾\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentFieldName = parentBindingPathArray.pop();\r\n\r\n    // è·åéä»¶æå¨å®ä½çæ°æ®åè¡¨ï¼ä¸ä¼ édataIdsåæ°ï¼åè¿åå¨é¨\r\n    const entityListData = this.entityService.getEntityListData(parentBindingPathArray);\r\n    let filteredEntityListData = [];\r\n    if (dataIds && Array.isArray(dataIds) === true) {\r\n      filteredEntityListData = entityListData.filter((entityData: any) => {\r\n        return dataIds.indexOf(entityData.id) > -1;\r\n      });\r\n    } else {\r\n      filteredEntityListData = entityListData;\r\n    }\r\n\r\n    // è½¬æ¢ä¸ºéä»¶Idæ°ç»\r\n    const attachmentIds = [];\r\n    filteredEntityListData.forEach((entityData: any) => {\r\n      if (entityData[attachmentFieldName]) {\r\n        const attachmentId = entityData[attachmentFieldName]['attachmentId'];\r\n        if (attachmentId) {\r\n          attachmentIds.push(attachmentId);\r\n        }\r\n      }\r\n    });\r\n\r\n    return attachmentIds;\r\n  }\r\n}\r\n\r\nexport { AttachmentService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, forkJoin, Subject } from 'rxjs';\r\nimport { FUploadFileExtend } from '@farris/extend-file-upload';\r\nimport { FrameContext, CommandContext, BindingPathConverter, BindingList, BindingObject } from '@farris/devkit';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { AttachmentInfo, ATTACHMENT_ORDER_FIELD } from './types';\r\nimport { AttachmentDataService } from './attachment-data.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { EntityService } from '../entity-services/index';\r\nimport { ListDataService, SubListDataService } from '../data-services/index';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { debounceTime, tap } from 'rxjs/operators';\r\n\r\n/**\r\n * éä»¶ä¸ä¼ \r\n * @summary\r\n * fileExtendï¼å½åæä»¶ä¸ä¼ æé¢è§ç»ä»¶ä¼ éè¿æ¥çæ°æ®ï¼\r\n * fileExtendFieldPathï¼å½åéä»¶UDTçå­æ®µè·¯å¾ï¼\r\n * attachmentInfoï¼å½åéä»¶UDTæéçä¿¡æ¯ï¼\r\n */\r\n@Injectable()\r\nclass FileService {\r\n  private subject: Subject<{ fileInfoFieldPath: string, configs: string }>;\r\n  private attachmentInfos: AttachmentInfo[];\r\n  /**\r\n   * æé å½æ°\r\n   */\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private attachDataService: AttachmentDataService,\r\n    private entityService: EntityService,\r\n    private subListDataService: SubListDataService,\r\n    private notifyService: FormNotifyService,\r\n    private languageService: LanguageService,\r\n    private listDataService: ListDataService,\r\n    @Optional() private formLoadingService: FormLoadingService\r\n  ) {\r\n    this.subject = new Subject<{ fileInfoFieldPath: string, configs: string }>();\r\n    this.subject.pipe(debounceTime(500)).subscribe((data: { fileInfoFieldPath: string, configs: string }) => {\r\n      this.process(data.fileInfoFieldPath, data.configs);\r\n    });\r\n    this.attachmentInfos = [];\r\n  }\r\n\r\n  // #region ä¸ä¼ æä»¶\r\n\r\n  /**\r\n   * æ¹éæ·»å éä»¶è¡\r\n   */\r\n  public addFileRows(fileInfoFieldPath: string) {\r\n    const attachmentInfos = this.getAttachmentInfosToAddFromContext();\r\n    if (attachmentInfos.length === 0) {\r\n      this.notifyService.info('è¯·åä¸ä¼ éä»¶');\r\n    }\r\n    return this.attachDataService.updateRows(fileInfoFieldPath, attachmentInfos);\r\n  }\r\n  /**\r\n   * æ¹éæ·»å å¸¦éä»¶ç±»åçéä»¶è¡\r\n   * @param fileInfoFieldPath éä»¶udtå­æ®µ\r\n   * @param configs éä»¶æ©å±ä¿¡æ¯éç½® \r\n   * @description configséç½®å¦{\"billId\":\"{UISTATE~/root/billId}\",\"rowId\":\"{UISTATE~/root/rowId}\",\"attachmentType\":\"xueli\"}\r\n   */\r\n  public addFileRowsWithConfigs(fileInfoFieldPath: string, configs: string) {\r\n    const attachmentInfos = this.getAttachmentInfosToAddFromContext();\r\n    if (attachmentInfos.length === 0) {\r\n      this.notifyService.info('è¯·åä¸ä¼ éä»¶');\r\n    }\r\n    // let mapFields = null;\r\n    // if (typeof configs === 'string') {\r\n    //   // å»æé¦å°¾ç©ºæ ¼\r\n    //   configs = configs.trim();\r\n    // }\r\n    // if (configs.startsWith('{') && configs.endsWith('}')) {\r\n    //   try {\r\n    //     mapFields = JSON.parse(configs);\r\n    //   } catch {\r\n    //     throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n    //   }\r\n    // } else {\r\n    //   throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n    // }\r\n    this.attachmentInfos = this.attachmentInfos.concat(attachmentInfos);\r\n    this.subject.next({ fileInfoFieldPath, configs });\r\n    //return this.attachDataService.updateRowsWithConfigs(fileInfoFieldPath, attachmentInfos, mapFields);\r\n  }\r\n  private process(fileInfoFieldPath: string, configs: string) {\r\n    if (this.attachmentInfos && this.attachmentInfos.length > 0) {\r\n      const attachmentInfos = this.attachmentInfos.concat([]);\r\n      let mapFields = null;\r\n      if (typeof configs === 'string') {\r\n        // å»æé¦å°¾ç©ºæ ¼\r\n        configs = configs.trim();\r\n      }\r\n      if (configs.startsWith('{') && configs.endsWith('}')) {\r\n        try {\r\n          mapFields = JSON.parse(configs);\r\n        } catch {\r\n          throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n        }\r\n      } else {\r\n        throw new Error('éä»¶æ©å±ä¿¡æ¯éç½®ä¸æ¯åæ³çjsonå­ç¬¦ä¸²ã');\r\n      }\r\n      this.attachDataService.updateRowsWithConfigs(fileInfoFieldPath, attachmentInfos, mapFields).pipe(\r\n        tap(() => {\r\n          this.attachmentInfos = this.attachmentInfos.filter(item => !attachmentInfos.find(attachmentInfo => attachmentInfo.attachmentId === item.attachmentId));\r\n          if (this.attachmentInfos.length > 0) {\r\n            this.process(fileInfoFieldPath, configs);\r\n          }\r\n        })\r\n      ).subscribe();\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * è·åè¦æ·»å çéä»¶ä¿¡æ¯æ°ç»\r\n   */\r\n  private getAttachmentInfosToAddFromContext(): AttachmentInfo[] {\r\n    const fileExtends = this.getFileExtendsFromContext();\r\n    const attachmentInfos = this.convertToAttachmentInfos(fileExtends);\r\n    return attachmentInfos;\r\n  }\r\n\r\n  /**\r\n   * å°éä»¶ä¸ä¼ ç»ä»¶è¿åçéä»¶ä¿¡æ¯è½¬æ¢ä¸ºæå¡å¨ç«¯éè¦çæ ¼å¼\r\n   */\r\n  private convertToAttachmentInfos(fileExtends: FUploadFileExtend[]): AttachmentInfo[] {\r\n    if (!fileExtends) {\r\n      return [];\r\n    }\r\n\r\n    const attachmentInfos: AttachmentInfo[] = [];\r\n    fileExtends.forEach((fUploadOutPut: FUploadFileExtend) => {\r\n      const attachmentInfo: AttachmentInfo = {\r\n        attachmentId: fUploadOutPut.extend.metadataId,\r\n        fileName: fUploadOutPut.extend.fileName,\r\n      };\r\n      attachmentInfos.push(attachmentInfo);\r\n    });\r\n    return attachmentInfos;\r\n  }\r\n\r\n  // #endregion\r\n\r\n\r\n  // #region å é¤æä»¶\r\n\r\n  /**\r\n   * å é¤éä»¶è¡\r\n   */\r\n  public removeFileRows(fileInfoFieldPath: string): Observable<any> {\r\n    const dataIds = this.getDataIdsToRemoveFromContext(fileInfoFieldPath);\r\n    if (dataIds.length === 0) {\r\n      this.notifyService.info('è¯·éæ©è¦å é¤çéä»¶');\r\n    }\r\n    const isSublist = fileInfoFieldPath.split('/').filter(p => p).length >= 2;\r\n    const removeObservables: Observable<any>[] = [];\r\n    if (isSublist) {\r\n      dataIds.forEach((dataId: string) => {\r\n        let removeObservable;\r\n        removeObservable = this.subListDataService.removeWithoutConfirm(dataId);\r\n        removeObservables.push(removeObservable);\r\n      });\r\n      return forkJoin(removeObservables);\r\n    } else {\r\n      return this.listDataService.removeRows(dataIds, false, null, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·åè¦å é¤çæ°æ®\r\n   */\r\n  private getDataIdsToRemoveFromContext(fileExtendFieldPath: string): string[] {\r\n\r\n    // ä»ä¸ä¸æä¸­è·åè¦å¤ççéä»¶ä¿¡æ¯æ°ç»\r\n    const fileExtends = this.getFileExtendsFromContext();\r\n\r\n    // å°éä»¶æ°ç»è½¬æ¢ä¸ºå¯¹åºçæ°æ®id\r\n    const dataIds: string[] = [];\r\n    fileExtends.forEach((fileExtend: FUploadFileExtend) => {\r\n\r\n      // ä¸ä¼ å é¤åé¢è§å é¤ä¼ éè¿æ¥çfileIdçkeyå¯è½ä¸ä¸è´ï¼è¦åå¼å®¹\r\n      const fileId = fileExtend.extend.metadataId;\r\n      const dataId = this.convertFileIdToDataId(fileId, fileExtendFieldPath);\r\n      dataIds.push(dataId);\r\n    });\r\n    return dataIds;\r\n  }\r\n\r\n  /**\r\n   * æ ¹æ®è·¯å¾è·åéä»¶å­æ®µå¼æ°ç»\r\n   * @param fieldPath å­æ®µè·¯å¾\r\n   */\r\n  private convertFileIdToDataId(fileId: string, fileExtendFieldPath: string): string {\r\n\r\n    // è§£æè·¯å¾\r\n    const fileBindingPath = BindingPathConverter.toBindingPathArray(fileExtendFieldPath);\r\n    const fileFieldName = fileBindingPath.pop();\r\n    const fileListBindingPath = fileBindingPath;\r\n\r\n    // è·åéä»¶idæ°ç»\r\n    const entityListData = this.entityService.getEntityListData(fileListBindingPath);\r\n    const targetEntityData = entityListData.find((entityData: any) => {\r\n      if (entityData[fileFieldName]) {\r\n        const attachmentId = entityData[fileFieldName]['attachmentId'];\r\n        if (attachmentId === fileId) {\r\n          return true;\r\n        }\r\n      }\r\n    });\r\n\r\n    return targetEntityData.id;\r\n  }\r\n\r\n  // #endregion\r\n  //#region æä»¶æåº\r\n  /**\r\n   * æ´æ°éä»¶æåº\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µè·¯å¾\r\n   * @param ids éä»¶æåºåçéä»¶idæ°ç»\r\n   */\r\n  public updateOrder(attachmentInfoFieldPath: string, ids: string[]) {\r\n    if (!attachmentInfoFieldPath) {\r\n      throw new Error('éä»¶udtå­æ®µè·¯å¾åæ°ä¸è½ä¸ºç©º');\r\n    }\r\n    // æ¯æä»ä»£ç ä¸­ç´æ¥è°ç¨ï¼å¦æåæ°ä¸­ä¼ éäºidsåä½¿ç¨ï¼å¦åä½¿ç¨å½ä»¤ä¸ä¸æä¸­çäºä»¶åæ°\r\n    if (!ids) {\r\n      // è·åäºä»¶åæ°\r\n      const commandContext = this['context'] as CommandContext;\r\n      // ä¸ç»ä»¶çº¦å®äºä»¶åæ°ä¸ºæ°æ®ä¸»é®æ°ç»\r\n      ids = commandContext && commandContext.eventParam && commandContext.eventParam.data;\r\n    }\r\n    // å¯¹æ¶éçä¸»é®æ°ç»è¿è¡å¤æ­\r\n    if (!ids || !Array.isArray(ids)) {\r\n      return;\r\n    }\r\n    // å½åå½ä»¤æå¨ç»ä»¶çç»å®æ°æ®\r\n    const bindingList: BindingList = this.frameContext.bindingData.getList();\r\n    // æ ç»å®æ°æ®æ¶ä¸å¤ç\r\n    if (!bindingList || bindingList.length < 1) {\r\n      return;\r\n    }\r\n    // ç»ä¸è·åéä»¶udtä¿¡æ¯\r\n    const parentBindingPathArray = BindingPathConverter.toBindingPathArray(attachmentInfoFieldPath);\r\n    const attachmentField = parentBindingPathArray.pop();\r\n    // åºç°udtå­æ®µä¸å­å¨çæåµï¼è¯´æå½ä»¤ä¸­éä»¶udtå­æ®µéç½®éè¯¯ævoä¸­æ²¡æéä»¶udtãæ§å¶å¨ä¸å¼å®¹éè¯¯ï¼æ­¤å¤å¤æ­åªä¸ºé»æ­¢åç»­çéå\r\n    if (!attachmentField) {\r\n      throw new Error('æ æ³è·åéä»¶udtå­æ®µï¼è¯·ç¡®è®¤å½ä»¤ä¸­éä»¶udtå­æ®µè·¯å¾éç½®æ­£ç¡®ï¼ä¸è§å¾æ¨¡åä¸­å­å¨éä»¶udtå­æ®µ');\r\n    }\r\n    const data = bindingList.toJSON();\r\n    // æ´æ°ç»å®æ°æ®ä¸­éä»¶udtå­æ®µä¸­æåºå­æ®µçå¼,ä»æ´æ°æéä»¶çè¡\r\n    ids.forEach((id: string, index: number) => {\r\n      const item = data.find(item => item && item[attachmentField] && item[attachmentField]['attachmentId'] === id);\r\n      const primaryKeyValue = item && item.id;\r\n      if (!primaryKeyValue) {\r\n        return;\r\n      }\r\n      const bindingObject = bindingList.findById(primaryKeyValue);\r\n      if (bindingObject) {\r\n        // éä»¶udtå¯¹è±¡\r\n        const attachment = bindingObject[attachmentField] as BindingObject;\r\n        if (attachment) {\r\n          // è·åæ§å¼\r\n          const order = attachment.getValue(ATTACHMENT_ORDER_FIELD);\r\n          if (order !== index) {\r\n            // æ´æ°æåº\r\n            attachment.setValue(ATTACHMENT_ORDER_FIELD, index, true, true);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n  //#endregion\r\n\r\n  // #region å¶ä»å·¥å·æ¹æ³\r\n\r\n  /**\r\n   * ä»ä¸ä¸æä¸­è·åè¦å¤ççéä»¶ä¿¡æ¯æ°ç»\r\n   * @summary\r\n   * ä¸ºäºç»ä¸åä¸ªåå¤ä¸ªéä»¶çå¤çæ¹å¼ï¼ç»ä¸åè£ä¸ºæ°ç»\r\n   */\r\n  private getFileExtendsFromContext(): FUploadFileExtend[] {\r\n\r\n    const commandContext = this['context'] as CommandContext;\r\n    const eventParam = commandContext.eventParam;\r\n    if (!eventParam) {\r\n      return [];\r\n    }\r\n\r\n    let fileExtends: any[];\r\n    if (Array.isArray(eventParam) === false) {\r\n      fileExtends = [eventParam];\r\n    } else {\r\n      fileExtends = eventParam.concat([]);\r\n    }\r\n\r\n    return fileExtends as FUploadFileExtend[];\r\n  }\r\n  // #endregion\r\n}\r\n\r\nexport { FileService };\r\n","import { Injectable, ComponentFactoryResolver, ReflectiveInjector, Provider, ComponentRef, InjectFlags, NgModuleFactory, Injector, Optional, forwardRef, NgModuleRef } from '@angular/core';\r\nimport { BsModalRef, BsModalService } from '@farris/ui-modal';\r\nimport { FarrisFormService } from './farris-form.service';\r\nimport { FrameContext, FrameComponent, BindingList } from '@farris/devkit';\r\nimport { of, Observable, Subject } from 'rxjs';\r\nimport { LanguageService } from './languag.service';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { INSIDE_DIALOG_TOKEN, MODAL_REF } from './types';\r\n\r\ndeclare const System: any;\r\n/**\r\n * å¼¹çªæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass DialogService {\r\n  private _providers: Provider[] = [];\r\n  /**\r\n   * å¤é¨å¼ç¨\r\n   */\r\n  private refs: any = {};\r\n  private languageService: LanguageService;\r\n  private modalRef: any;\r\n  private modals: any = {};\r\n\r\n  constructor(\r\n    private modalService: BsModalService,\r\n    private farrisFormService: FarrisFormService,\r\n    private _componentFactoryResolver: ComponentFactoryResolver,\r\n    private frameContext?: FrameContext,\r\n    @Optional() private injector?: Injector\r\n  ) {\r\n    this.setLanguageService();\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®è¯­è¨æå¡\r\n   */\r\n  private setLanguageService() {\r\n    // FrameContextä¸ä¸å®å­å¨ï¼ä¸è½ç´æ¥ç¨\r\n    const frameContext = this.getFrameContext();\r\n    if (frameContext) {\r\n      const injector = this.frameContext.injector;\r\n      this.languageService = injector.get<LanguageService>(LanguageService, null, InjectFlags.Optional);\r\n    }\r\n\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åframeContext\r\n   */\r\n  private getFrameContext() {\r\n    if (this.frameContext) {\r\n      return this.frameContext;\r\n    }\r\n    if (this['context'] && this['context']['frameContext']) {\r\n      return this['context']['frameContext'];\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * å¼å®¹æ§å¼¹çªï¼è·åComponentFactoryResolver\r\n   */\r\n  private getComponentFactoryResolver() {\r\n    const frameContext = this.getFrameContext();\r\n    let componentFactoryResolver: any;\r\n    if (frameContext) {\r\n      componentFactoryResolver = frameContext.injector.get(ComponentFactoryResolver);\r\n    }\r\n    return componentFactoryResolver;\r\n  }\r\n\r\n  /**\r\n   * è·åconfigè½¬æ¢æå¯¹è±¡ç±»åçéç½®\r\n   * @param config éç½®é¡¹\r\n   * @throws å¡«åå¯¹è±¡æ ¼å¼æjsonå­ç¬¦ä¸²\r\n   */\r\n  private getObjectTypeConfig(config: any) {\r\n    let objectTypeConfig: any\r\n    if (typeof config === 'string') {\r\n      if (config.length) {\r\n        try {\r\n          objectTypeConfig = JSON.parse(config);\r\n        } catch {\r\n          throw new Error(config + 'ä¸æ¯åæ³çjsonå­ç¬¦ä¸²');\r\n        }\r\n      } else {\r\n        objectTypeConfig = {};\r\n      }\r\n    } else if (typeof config === 'object') {\r\n      objectTypeConfig = Object.assign({}, config);\r\n    } else {\r\n      throw new Error('å¡«åå¯¹è±¡æ ¼å¼æjsonå­ç¬¦ä¸²');\r\n    }\r\n    return objectTypeConfig;\r\n  }\r\n\r\n  /**\r\n   * åå»ºæ¨¡ææ¡åç»ä»¶å®ä¾ï¼å¹¶è¿åæ¨¡ææ¡å®ä¾ï¼åäºå¼å®¹èè¡¨åå¤ç\r\n   * @param config å¼¹çªéç½®\r\n   * @param component å¼¹çªåç»ä»¶\r\n   * @param uiStateObject ç»å®å¼¹çªåç»ä»¶uiState\r\n   */\r\n  private createModalComponentRef(config: any, component: any, uiStateObject: any) {\r\n    let componentRef: any;\r\n    let modalRef: any;\r\n    const frameContext = this.getFrameContext();\r\n    const componentFactoryResolver = this.getComponentFactoryResolver();\r\n    if (frameContext && componentFactoryResolver) {\r\n      const contentCmptFactory = componentFactoryResolver.resolveComponentFactory(component);\r\n      const injector = this.createInjector(this.refs, this.frameContext.injector);\r\n      const modalContentInjector = ReflectiveInjector.resolveAndCreate([...this._providers], injector);\r\n      componentRef = contentCmptFactory.create(modalContentInjector);\r\n      if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {\r\n        if (typeof uiStateObject === 'object' && Object.keys(uiStateObject).length) {\r\n          Object.keys(uiStateObject).forEach((item) => {\r\n            componentRef.instance.viewModel.uiState.setPropertyValue(item, uiStateObject[item]);\r\n          });\r\n        }\r\n        // éå isDialogåæ°\r\n        componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n      }\r\n      modalRef = this.modalService.show(componentRef, config);\r\n    } else {\r\n      modalRef = this.modalService.show(component, config);\r\n    }\r\n    return modalRef;\r\n  }\r\n  /**\r\n   *æå¼å¼¹çª\r\n   * @param config æ¨¡ææ¡æ¬èº«éç½®\r\n   * @param modalId æ¨¡ææ¡åç»ä»¶çid\r\n   * @param uiStateConfig æ¨¡ææ¡åç»ä»¶uiStateä¸çå­æ®µåå¼\r\n   * @param callback åè°\r\n   */\r\n  public openModal(config: any = {}, modalId: string, uiStateConfig: any = {}, callback?: (modalRef: any) => any) {\r\n    const configObj = this.getObjectTypeConfig(config);\r\n    const uiStateObject = this.getObjectTypeConfig(uiStateConfig);\r\n    const innerCompopnent = this.farrisFormService.getControls(modalId);\r\n    let modalRef: any;\r\n    let modalConfig: any = {\r\n      title: this.languageService.defaultDialogTitle,\r\n      width: 760,\r\n      height: 450,\r\n      showButtons: false\r\n    };\r\n    modalConfig = Object.assign(modalConfig, configObj);\r\n    const onClosingHandler = modalConfig.beforeClose;\r\n    // tslint:disable: no-string-literal\r\n    const cancelChanges = modalConfig['cancelChanges'] || false;\r\n    modalConfig.beforeClose = (ref) => {\r\n      // if (ref && ref.modalRef && ref.modalRef.content) {\r\n      //   ref.modalRef.content.isDialogRootComponent = false;\r\n      // }\r\n      if (!!onClosingHandler && typeof onClosingHandler === 'function') {\r\n        return onClosingHandler(ref).pipe(\r\n          switchMap((result) => {\r\n            if (result) {\r\n              if (cancelChanges) {\r\n                return this.cancelChanges(ref);\r\n              }\r\n            }\r\n            return of(result);\r\n          })\r\n        );\r\n      }\r\n      if (cancelChanges) {\r\n        return this.cancelChanges(ref);\r\n      } else {\r\n        return of(true);\r\n      }\r\n    };\r\n    const remote = modalConfig.remote || false;\r\n    if (remote) {\r\n      this.createRemoteForm(modalConfig, uiStateObject).subscribe(\r\n        (modalRef: any) => {\r\n          this.modalRef = modalRef;\r\n          this.refs.modalRef = modalRef;\r\n          if (modalRef && !!modalRef.content) {\r\n            modalRef.content.isDialogRootComponent = true;\r\n            modalRef.content.dialogRef = modalRef;\r\n          }\r\n          callback(modalRef);\r\n        }\r\n      );\r\n    } else {\r\n      if (!innerCompopnent) {\r\n        console.error(`è·åæ§ä»¶å¤±è´¥ï¼modalId=${modalId}`);\r\n        return;\r\n      }\r\n      if (typeof innerCompopnent === 'string') {\r\n        modalConfig.dialogType = 'iframe';\r\n        modalRef = this.modalService.show(innerCompopnent, modalConfig);\r\n      } else if (typeof innerCompopnent === 'function') {\r\n        modalRef = this.createModalComponentRef(modalConfig, innerCompopnent, uiStateObject);\r\n      } else if (typeof innerCompopnent === 'object') {\r\n        // å¦ææ¯å¯¹è±¡ ä¸ä½¿ç¨ç¬ç«jså è½½\r\n        // {\"useIsolateJs\":true,\"modalInstance\":f()}\r\n        if (innerCompopnent.useIsolateJs) {\r\n          const injector = this.createInjector(this.refs);\r\n          const parameter = {\r\n            injector: injector,\r\n            uiState: uiStateObject,\r\n            modalService: this.modalService,\r\n            dialogServiceInstance: this,\r\n            eventBus: this.frameContext.getVirtualRootFrameContext().eventBus,\r\n            componentCallback: this.componentModify,\r\n            modalInstanceCallback: this.modalInstanceCallback.bind(this)\r\n          };\r\n          // ä¼å¨åé¨è¿è¡\r\n          const subject: Subject<any> = innerCompopnent['modalInstance'](modalConfig, parameter);\r\n          return subject;\r\n        } else {\r\n          modalRef = this.modalService.show(innerCompopnent, modalConfig);\r\n        }\r\n      }\r\n\r\n      this.modalRef = modalRef;\r\n      this.refs.modalRef = modalRef;\r\n      if (modalRef && !!modalRef.content) {\r\n        modalRef.content.isDialogRootComponent = true;\r\n        modalRef.content.dialogRef = modalRef;\r\n      }\r\n      return modalRef;\r\n    }\r\n  }\r\n  private componentModify(cmpRef: any, parameter: {\r\n    uistate: any\r\n  }) {\r\n    if (cmpRef && cmpRef.instance && cmpRef.instance.viewModel && cmpRef.instance.viewModel.uiState) {\r\n      if (parameter.uistate && typeof parameter.uistate === 'string') {\r\n        parameter.uistate = JSON.parse(parameter.uistate);\r\n      }\r\n      if (typeof parameter.uistate === 'object' && Object.keys(parameter.uistate).length) {\r\n        Object.keys(parameter.uistate).forEach((item) => {\r\n          cmpRef.instance.viewModel.uiState.setPropertyValue(item, parameter.uistate[item]);\r\n        });\r\n      }\r\n      // éå isDialogåæ°\r\n      cmpRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n    }\r\n  }\r\n\r\n  private modalInstanceCallback(cmpRef: any, options: any, parameter: any) {\r\n    if (parameter && parameter.modalService) {\r\n      const modalRef = parameter.modalService.show(cmpRef, options);\r\n      this.modalRef = modalRef;\r\n      this.refs.modalRef = modalRef;\r\n      if (modalRef && !!modalRef.content) {\r\n        modalRef.content.isDialogRootComponent = true;\r\n        modalRef.content.dialogRef = modalRef;\r\n      }\r\n      return modalRef;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æå¼ç±»å¸®å©è¡¨å\r\n   * @param frameId\r\n   * @param params\r\n   * @param configs\r\n   * @description å¼¹åºè¡¨ååå¼¹åºè¿ç«¯è¡¨ååºå«ä¸ºå¼¹åºè¡¨åéè¦éç½®å­æ®µæ å°\r\n   */\r\n  public openHelpModal(frameId: string, params: string, configs?: any) {\r\n    const events = this['context']['eventParam'] || {};\r\n    // å¡çåºæ¯ä¼ éè¿æ¥çäºä»¶æ¯èªå®ä¹å¯¹è±¡ï¼åå«eventåoptionsãåè¡¨åºæ¯ä¼ éè¿æ¥çäºä»¶åæ°æ¯æ®éäºä»¶åæ°ï¼å¨åæ°ä¸­æºå¸¦äºeditor.options\r\n    const event = events.event || events;\r\n    const options = events.options || events.editor && events.editor.options || {};\r\n    const context = events && events.context;\r\n    const subject = new Subject<any>();\r\n    // modalIdå¨ä¸¤ç§åºæ¯ä¸é½éè¦ï¼ç¨æ¥åºåå®ä¾\r\n    const { modalId = null } = options;\r\n    if (!configs) {\r\n      configs = '{}';\r\n    }\r\n    if (typeof configs === 'string' && configs.length > 0) {\r\n      configs = JSON.parse(configs);\r\n    }\r\n    const { remote = false, currentRow = false, areaResponse = undefined } = configs || {};\r\n    // æ¯æareaResponseéç½®\r\n    if (areaResponse !== undefined && options.areaResponse === undefined) {\r\n      options.areaResponse = areaResponse;\r\n    }\r\n    if (remote) {\r\n      const mapFields = configs.mapFields || {};\r\n      options.remote = remote + '?v=' + new Date().valueOf();\r\n      this.openModal(options, modalId, params, (dialogRef: any) => {\r\n        // æ°å¢eventåæ°ï¼ä¸ºäºä»¥åè°ç¨eventä¸­çformControlä»¥ééåè¡¨ä¸­çæºè½è¾å¥æ¡å¼¹åºè¡¨åï¼\r\n        this.modals[modalId] = { subject, frameId: frameId, mapFields, dialogRef, currentRow, event: event, context };\r\n      });\r\n    } else {\r\n      const dialogRef = this.openModal(options, modalId, params);\r\n      const mapFields = options.mapFields || {};\r\n      this.modals[modalId] = { subject, frameId: frameId, mapFields, dialogRef, currentRow, event: event, context };\r\n    }\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * æå¼å¸¦åè°çå¼¹çª\r\n   * @param frameId frameId\r\n   * @param params åæ°\r\n   * @param configs éç½®\r\n   * @returns\r\n   */\r\n  public openCallbackableModal(frameId: string, params?: string, configs?: any) {\r\n    if (!configs) {\r\n      configs = '{}';\r\n    }\r\n    if (typeof configs === 'string') {\r\n      configs = JSON.parse(configs);\r\n    }\r\n    const events = this['context'] && this['context']['eventParam'] || {};\r\n    const options = events.options;\r\n    options.showButtons = true;\r\n    options.buttons = [\r\n      { text: this.languageService.cancel, cls: 'btn', handle: (event: any) => this.cancel(options) },\r\n      {\r\n        text: this.languageService.confirm, cls: 'btn btn-primary', handle: (event: any) => {\r\n          const { modalId = null } = options || {};\r\n          if (modalId) {\r\n            const modal = this.modals[modalId];\r\n            const { subject = null, dialogRef = null, frameId = null, handle = null, currentRow = false } = modal || {};\r\n            const formCmp = dialogRef.content; // å¼¹çªè¡¨åå®ä¾\r\n            if (!formCmp) {\r\n              throw new Error('ä¸æ¯æçè¡¨åç±»å');\r\n            }\r\n            let selectedItems = [];\r\n            if (currentRow === true) {\r\n              let frameComtext: FrameContext;\r\n              if (formCmp.context) {\r\n                frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId) as FrameContext;\r\n              } else {\r\n                frameComtext = formCmp.appContext.frameContextManager.getFrameContextById(frameId) as FrameContext;\r\n              }\r\n\r\n              if (!frameComtext) {\r\n                throw new Error(`æ æçframeIdï¼${frameId}ï¼è¯·ç¡®è®¤å½ä»¤ä¸­frameIdæ­£ç¡®ã`);\r\n              }\r\n              const bindingList = frameComtext.bindingData.getList() as BindingList;\r\n              const item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();\r\n              selectedItems = [item];\r\n            } else {\r\n              let rows: Map<string, any>;\r\n              // å¦æcontextä¸ºç©º é£ä¹å°è¯ä»å¯¹åºçappcontextè¯»åï¼ä¸»è¦ç®çæ¯ä¸ºäºè§£æè¡¨åçå¼¹åº\r\n              if (formCmp.context) {\r\n                rows = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map<string, any>();\r\n              } else {\r\n                rows = formCmp.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map<string, any>();\r\n              }\r\n\r\n              selectedItems = Array.from(rows.values());\r\n            }\r\n            if (typeof handle === 'function') {\r\n              handle(selectedItems);\r\n            }\r\n            if (subject) {\r\n              subject.next();\r\n            }\r\n            dialogRef.close(options);\r\n          }\r\n        }\r\n      }\r\n    ];\r\n\r\n    const subject = new Subject<any>();\r\n    const { modalId = null } = options;\r\n    const { remote = null, currentRow = false, areaResponse = undefined } = configs;\r\n    const handle = options.handle;\r\n    // æ¯æareaResponseéç½®\r\n    if (areaResponse !== undefined && options.areaResponse === undefined) {\r\n      options.areaResponse = areaResponse;\r\n    }\r\n    if (remote) {\r\n      options.remote = remote + '?v=' + new Date().valueOf();\r\n      this.openModal(options, modalId, params, (dialogRef: any) => {\r\n        this.modals[modalId] = { subject, frameId: frameId, dialogRef, handle, currentRow, event: events.event };\r\n      });\r\n    } else {\r\n      const dialogRef = this.openModal(options, modalId, params);\r\n      this.modals[modalId] = { subject, frameId: frameId, dialogRef, handle, currentRow, event: events.event };\r\n    }\r\n    return subject;\r\n  }\r\n\r\n  /**\r\n   * ç¡®è®¤æé®äºä»¶\r\n   * @throws frameId\r\n   */\r\n  public confirm() {\r\n    const events = this['context'] && this['context']['eventParam'] || {};\r\n    const { modalId = null } = events || {};\r\n    if (modalId) {\r\n      const modal = this.modals[modalId];\r\n      const { subject = null, dialogRef = null, mapFields = {}, frameId = null, currentRow = false, event = null, context = null } = modal || {};\r\n      const formCmp = dialogRef.content; // å¼¹çªè¡¨åå®ä¾\r\n      if (!formCmp) {\r\n        throw new Error('ä¸æ¯æçè¡¨åç±»å');\r\n      }\r\n      // const selectedIds = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.ids;\r\n\r\n      let selectedItems = [];\r\n      if (currentRow === true) {\r\n        const frameComtext = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId) as FrameContext;\r\n        if (!frameComtext) {\r\n          throw new Error(`æ æçframeIdï¼${frameId}ï¼è¯·ç¡®è®¤å½ä»¤ä¸­frameIdæ­£ç¡®ã`);\r\n        }\r\n        const bindingList = frameComtext.bindingData.getList() as BindingList;\r\n        const item = bindingList && bindingList.currentItem && bindingList.currentItem.toJSON();\r\n        if (item && Object.keys(item).length > 0) {\r\n          selectedItems = [item];\r\n        }\r\n      } else {\r\n        const rows: Map<string, any> = formCmp.context.appContext.frameContextManager.getFrameContextById(frameId).uiState.rows || new Map<string, any>();\r\n        selectedItems = Array.from(rows.values());\r\n      }\r\n\r\n      // æ å°å­æ®µæ°æ®\r\n      // è·åè§¦åå¼¹æ¡çç¼è¾å¨çå­æ®µåç§°\r\n      let editorField = undefined;\r\n      if (event && event.editor && event.editor.column) {\r\n        editorField = event.editor.column.field;\r\n      }\r\n      if (selectedItems && mapFields) {\r\n        Object.keys(mapFields).forEach((k) => {\r\n          const targetField: string = mapFields[k];\r\n          const sourceKeyArray = k.split('.').filter((p) => p) || [];\r\n          const targetValue = selectedItems.map((r) => {\r\n            return sourceKeyArray.reduce((target, key) => {\r\n              if (target && (target.hasOwnProperty(key) || target['__proto__'].hasOwnProperty(key))) {\r\n                return target[key];\r\n              } else {\r\n                return '';\r\n              }\r\n            }, r);\r\n          }).join(',');\r\n          if (targetField) {\r\n            const bindingPaths = this.frameContext.viewModel.bindingPath.split('/').filter((p) => p);\r\n            const targetFields = targetField.split(',').filter((p) => p);\r\n            targetFields.forEach((target) => {\r\n              if (context) {\r\n                this.setValueByPath(context, target, targetValue);\r\n              } else {\r\n                // ä¿®å¤è¡¨æ ¼æºè½è¾å¥æ¡éæ©å¼åæºè½è¾å¥æ¡å¼ä¸¢å¤±çé®é¢\r\n                if (event.formControl && event.formControl.setValue && event.editor && event.editor.column && event.editor.column.field === target) {\r\n                  event.formControl.setValue(targetValue);\r\n                }\r\n                const targetPath = target.split('.');\r\n                this.frameContext.bindingData.setValue(bindingPaths.concat(targetPath), targetValue, true, true);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      if (subject) {\r\n        subject.next();\r\n      }\r\n      dialogRef.close();\r\n    }\r\n  }\r\n  /**\r\n   * åæ¶æé®äºä»¶\r\n   * @param event\r\n   */\r\n  public cancel(event?: any) {\r\n    const events = event || this['context'] && this['context']['eventParam'] || {};\r\n    const { modalId = null } = events || {};\r\n    if (modalId) {\r\n      const modal = this.modals[modalId];\r\n      const { subject = null, dialogRef = null } = modal || {};\r\n      if (subject) {\r\n        subject.next();\r\n      }\r\n      if (dialogRef) {\r\n        dialogRef.close();\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * åæ¶æå¡å¨åæ´é\r\n   * @param ref\r\n   */\r\n  private cancelChanges(ref: any): Observable<boolean> {\r\n    if (ref && ref.modalRef && ref.modalRef.content) {\r\n      const component: FrameComponent = ref.modalRef.content as FrameComponent;\r\n      if (component && component.context) {\r\n        const repository = component.context.repository || null;\r\n        if (repository) {\r\n          return repository.cancelChanges().pipe(switchMap(() => of(true)));\r\n        }\r\n      }\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * å³é­è¯¥å¼¹çª\r\n   */\r\n  closeModal() {\r\n    if (this.modalRef) {\r\n      this.modalRef.close();\r\n    }\r\n  }\r\n  /**\r\n   * åå»ºè¿ç¨è¡¨åå®ä¾\r\n   * @param options dialogéç½®\r\n   * @param uiState uistate\r\n   */\r\n  private createRemoteForm(options: any, uiState: any): Subject<any> {\r\n    const remote = options.remote || false;\r\n    const subject = new Subject<any>();\r\n    if (remote) {\r\n      let moduleName = options.moduleName || null;\r\n      System.import(remote).then((module: any) => {\r\n        if (!moduleName) {\r\n          moduleName = Object.keys(module).pop();\r\n        }\r\n        const moduleFactory = module[moduleName] as NgModuleFactory<any>;\r\n        const moduleRef: NgModuleRef<{ trans?: { resolve?: () => Observable<any> } }> = moduleFactory.create(this.injector);\r\n        const resolve = moduleRef && moduleRef.instance && moduleRef.instance.trans && typeof moduleRef.instance.trans.resolve === 'function' && moduleRef.instance.trans.resolve || (() => of(true));\r\n        resolve.apply(moduleRef.instance.trans).subscribe(() => {\r\n          const entryComponent = moduleRef['_bootstrapComponents'][0];\r\n          if (entryComponent) {\r\n            const compFactory = moduleRef.componentFactoryResolver.resolveComponentFactory(entryComponent);\r\n            const injector = this.createInjector(this.refs);\r\n            const componentRef: ComponentRef<any> = compFactory.create(injector);\r\n            if (componentRef && componentRef.instance && componentRef.instance.viewModel && componentRef.instance.viewModel.uiState) {\r\n              if (typeof uiState === 'object' && Object.keys(uiState).length) {\r\n                Object.keys(uiState).forEach((item) => {\r\n                  componentRef.instance.viewModel.uiState.setPropertyValue(item, uiState[item]);\r\n                });\r\n              }\r\n              // éå isDialogåæ°\r\n              componentRef.instance.viewModel.uiState.setPropertyValue('DEVKIT_DIALOG', true);\r\n            }\r\n            const modalRef = this.modalService.show(componentRef, options);\r\n            subject.next(modalRef);\r\n          } else {\r\n            throw new Error(`æ æ³æ¾å°å¥å£è¡¨åï¼`);\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return subject;\r\n  }\r\n  private setValueByPath(target: object, path: string, value: any) {\r\n    if (target) {\r\n      const paths = path.split('.');\r\n      if (paths.length <= 1) {\r\n        target[path] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private createInjector(modalRef: BsModalRef, injector?: Injector) {\r\n    const providers = [\r\n      { provide: INSIDE_DIALOG_TOKEN, useValue: true },\r\n      {\r\n        provide: MODAL_REF, useValue: forwardRef(() => modalRef)\r\n      }\r\n    ];\r\n    return Injector.create({ providers, parent: injector || this.injector });\r\n  }\r\n}\r\n\r\nexport { DialogService };\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { Observable, of } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { FarrisSidebarService } from '@farris/ui-sidebar';\r\nimport { Entity, FrameContext } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FormMessageService } from './form-message.service';\r\nimport { LanguageService } from './languag.service';\r\n\r\n\r\n/**\r\n * ä¾§è¾¹æ æå¡\r\n * @scope FrameComponent\r\n */\r\n@Injectable()\r\nclass SidebarService {\r\n\r\n  private get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private sidebarUIService: FarrisSidebarService,\r\n    private messageService: FormMessageService,\r\n    @Optional() private languageService: LanguageService,\r\n  ) {\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n\r\n  openSidebar() {\r\n    this.sidebarUIService.sendIsOpen(true);\r\n  }\r\n\r\n  closeSidebar() {\r\n    this.sidebarUIService.sendIsOpen(false);\r\n  }\r\n\r\n  /**\r\n   * å³é­åååæ¶åæ´\r\n   */\r\n  confirmBeforeClosingSidebar(): Observable<boolean> {\r\n\r\n    // æ£æ¥æ¯å¦æåæ´ï¼æ²¡æåæ´ç´æ¥å³é­\r\n    const ifChangesExist = this.repository.entityManager.checkAllEntityChanges();\r\n    if (!ifChangesExist) {\r\n      return of(true);\r\n    }\r\n\r\n    // ç¡®è®¤æ¯å¦å³é­\r\n    const confirm$ = this.messageService.question(this.languageService['exitWithoutSave']);\r\n    const result$ = confirm$.pipe(\r\n      switchMap((confirmResult: boolean) => {\r\n        if (confirmResult === false) {\r\n          return of(false);\r\n        } else {\r\n          return of(true);\r\n        }\r\n      })\r\n    );\r\n\r\n    return result$;\r\n  }\r\n\r\n  /**\r\n   * ç»§ç»­å³é­ä¾§è¾¹æ \r\n   */\r\n  public continueClosingSidebar(): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  /**\r\n   * é»æ­¢ä¾§è¾¹æ å³é­\r\n   */\r\n  public stopClosingSidebar(): Observable<boolean> {\r\n    return of(false);\r\n  }\r\n}\r\n\r\nexport { SidebarService };\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * è¿æ»¤æ¡ä»¶æå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nclass FilterService {\r\n\r\n  /**\r\n   * ç§»é¤åå«ç¹æ®å¼çè¿æ»¤æ¡ä»¶\r\n   * @todoï¼åå®filtersä¸ºå­ç¬¦ä¸²ï¼å¾è®¾è®¡æ¶æ¯ææ°ç»åæ°åä¸èµ·è°æ´\r\n   */\r\n  public stripFiltersWithSpecialValue(filters: string, specialValues: string): string {\r\n    if (!filters || !specialValues) {\r\n      return filters;\r\n    }\r\n\r\n    const filterArray: any[] = JSON.parse(filters);\r\n    const strippedFilterArray = filterArray.filter((filter: any) => {\r\n      const filterValue = this.getFilterValue(filter);\r\n      return specialValues.indexOf(filterValue) === -1;\r\n    });\r\n\r\n    return JSON.stringify(strippedFilterArray);\r\n  }\r\n\r\n  /**\r\n   * è·åè¿æ»¤æ¡ä»¶çå¼\r\n   * @todoï¼æ²¡æFilteræ¥å£å®ä¹ï¼ç®åäº§åé¨å¤§å°åä¸ä¸è´ã\r\n   */\r\n  private getFilterValue(filter: any) {\r\n    return filter.Value || filter.value;\r\n  }\r\n}\r\n\r\nexport { FilterService };\r\n","import { Injectable, InjectionToken, Inject, Optional } from '@angular/core';\r\nexport const FARRIS_FORM_COMPONENTS = new InjectionToken<{ [key: string]: any }>('è¡¨åå¼¹åºçªå£æéèç»ä»¶åè¡¨');\r\n\r\n/**\r\n * è¡¨åæå¡\r\n * @scope FormModule\r\n */\r\n@Injectable()\r\nexport class ComponentManagerService {\r\n\r\n  private controls: { [key: string]: any } = {};\r\n\r\n  appendControl(key: string, cmpIns: any) {\r\n    this.controls[key] = cmpIns;\r\n  }\r\n\r\n  getControl(key: string) {\r\n    if (this.controls[key]) {\r\n      return this.controls[key];\r\n    } else {\r\n      console.warn(`æªæ¾å°Keyä¸º${key}çç»ä»¶ï¼`);\r\n      return null;\r\n    }\r\n  }\r\n  public clear(key?: string) {\r\n    if (key) {\r\n      this.controls[key] = null;\r\n      delete this.controls[key];\r\n    } else {\r\n      this.controls = {};\r\n    }\r\n  }\r\n}\r\n","import { Observable, of,Subject } from \"rxjs\";\r\n\r\nexport class AuthorityService {\r\n    queryOperationAuthority(operationIds: Array<string>): Observable<Map<string, boolean>>{\r\n        var queryResult = new Map<string, boolean>();\r\n        var i=0;\r\n        for(var j=0; j<operationIds.length; j++) {\r\n            queryResult.set(operationIds[j], i%2==0? true:false);\r\n            i++;            \r\n        }\r\n\r\n        var dummyResult = new Subject<Map<string, boolean>>();\r\n        setTimeout(() => {\r\n            dummyResult.next(queryResult);\r\n        }, 0);\r\n\r\n        return dummyResult;\r\n    }\r\n}\r\n","import { AuthorityService } from './authority.service';\r\nimport {Observable, empty} from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n/**\r\n * æé\r\n */\r\nexport class Authority {\r\n    \r\n    constructor() {\r\n        this.operationLabelMap = new Map<string, string>();\r\n        this.authOfLabel = new Map<string, boolean>();\r\n    }\r\n\r\n    /**\r\n     * ä»labelå°æä½æéIDçæ å°ï¼labelå¯ä»¥æ¯button idç­\r\n     */\r\n    private operationLabelMap: Map<string, string>;\r\n\r\n    /**\r\n     * è®°å½labelå¯¹äºçæä½æéï¼æ¯å¦éè¿\r\n     */\r\n    private authOfLabel: Map<string, boolean>;\r\n\r\n    /**\r\n     * è®¾ç½®labelå°operation idçæ å°\r\n     * @param labelMap \r\n     */\r\n    protected setLabelMap(labelMap: Object) {\r\n        for(var i in labelMap) {\r\n            this.operationLabelMap.set(i, labelMap[i]);\r\n        }\r\n        this.operationLabelMap.forEach((opId, label) => {\r\n            this[label] = false;\r\n        });        \r\n    }\r\n    \r\n    /**\r\n     * åå§åæéçå¼\r\n     */\r\n    initialize(authorityService: AuthorityService): Observable<void> {\r\n        if(this.operationLabelMap && this.operationLabelMap.size>0) {\r\n            return authorityService.queryOperationAuthority(Array.from(this.operationLabelMap.values())).pipe(\r\n                map((operationAuth) => {\r\n                    this.operationLabelMap.forEach((opId, label) => {\r\n                        this.authOfLabel.set(label, operationAuth.has(opId) ? operationAuth.get(opId) : false);\r\n                    });\r\n                })\r\n            );\r\n        }else{\r\n            return empty();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * è¿åæä½æéï¼å³ç¨æ·æ¯å¦æ¥æLabelæå¯¹åºçæé\r\n     * @param label æ ç­¾ï¼å¯ä»¥æ¯button idç­\r\n     */\r\n    hasOperation(label:string) {        \r\n        return this.authOfLabel.has(label) && this.authOfLabel.get(label);\r\n    }\r\n\r\n    // è¿åå­æ®µæé\r\n    // hasField(field:string)\r\n}","/*\r\n * @Author: aalizzwell\r\n * @Date: 2019-05-30 10:35:09\r\n * @Last Modified by: aalizzwell\r\n * @Last Modified time: 2019-06-15 19:22:13\r\n */\r\nimport { Injectable, Optional } from '@angular/core';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormErrorService } from './error/form-error.service';\r\nimport { IExceptionHandler, AppContext } from '@farris/devkit';\r\n\r\n/**\r\n * é»è®¤å¼å¸¸å¤çå¨\r\n * @scope æ²¡ææä¾å¯¹åºProvider\r\n */\r\n@Injectable()\r\nclass ExceptionHandler implements IExceptionHandler {\r\n  private appContext: AppContext = null;\r\n  constructor(\r\n    private formErrorService: FormErrorService,\r\n    @Optional() private languageService: LanguageService,\r\n    private applicationContext: AppContext,\r\n  ) {\r\n    if (this.languageService == null) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n  }\r\n  public setContext(applicationContext: AppContext) {\r\n    this.appContext = applicationContext;\r\n  }\r\n  public handle(error: any) {\r\n    if (!!this.formErrorService) {\r\n      this.formErrorService.exception(this.languageService.loadFailed, error);\r\n    }\r\n  }\r\n}\r\n\r\nexport { ExceptionHandler };\r\n","import { Provider } from '@angular/core';\r\nimport { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { HideEventService } from '../form-loading/hide-event.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { CheckService } from '../check.service';\r\nimport { DataCheckService } from '../data-check.service';\r\n\r\nimport { EventService } from '../event.service';\r\nimport { MenuStateService } from '../menu-state.service';\r\nimport { RouterService } from '../router.service';\r\nimport { UIStateService } from '../ui-state.service';\r\nimport { StateMachineService } from '../state-machine.service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { BindingDataService } from '../binding-data.service';\r\nimport { CommandService } from '../command-service';\r\n\r\nimport { QuerystringService } from '../querystring';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { NavigationMiddlewareService } from '../navigation-middleware.service';\r\nimport { GridMiddlewareService } from '../grid.middleware.service';\r\nimport { ParamService } from '../param.service';\r\n\r\nimport { BeActionService } from '../be-action.service';\r\nimport { ApproveService } from '../approve.service';\r\nimport { PrintService } from '../print.service';\r\nimport { AttachmentDataService, AttachmentService } from '../attachment/index';\r\nimport { ApplicationParamService } from '../application-param.service';\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityListService, EntityService\r\n} from '../entity-services/index';\r\nimport { LanguageService } from '../languag.service';\r\nimport { DialogService } from '../dialog.service';\r\nimport { SidebarService } from '../sidebar-service';\r\nimport { FarrisFormService } from '../farris-form.service';\r\nimport { FilterService } from '../filter-service';\r\nimport { ChangeItemService } from '../change-item.service';\r\n\r\n// data-services\r\nimport { ListDataService } from '../data-services/list-data.service';\r\nimport { TreeDataService } from '../data-services/tree-data.service';\r\nimport { CardDataService } from '../data-services/card-data.service';\r\nimport { SubListDataService } from '../data-services/sub-list-data.service';\r\nimport { KeybindingService } from '../keybinding-service';\r\nimport { FocusInvalidService } from '../focus-invalid.service';\r\nimport { SubTreeDataService } from '../data-services/sub-tree-data-service';\r\n\r\n/**\r\n * éççèProviders\r\n */\r\nconst FARRIS_COMMAND_SERVICE_PROVIDERS: Provider[] = [\r\n\r\n  // è¡¨åæ¨¡åæ³¨å¥ï¼18ä¸ªï¼\r\n  FormLoadingService,\r\n  FormMessageService,\r\n  FormNotifyService,\r\n  FormErrorService,\r\n  CheckService,\r\n  DataCheckService,\r\n  EventService,\r\n  FilterService,\r\n  KeybindingService,\r\n  LanguageService,\r\n  ParamService,\r\n  MenuStateService,\r\n  QuerystringService,\r\n  RuntimeFrameworkService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  RouterService,\r\n  ApplicationParamService,\r\n\r\n  // FrameComponentï¼20ä¸ªï¼\r\n  ValidationService,\r\n  FocusInvalidService,\r\n  ChangeItemService,\r\n  UIStateService,\r\n  StateMachineService,\r\n  BindingDataService,\r\n  CommandService,\r\n\r\n  // entity-services\r\n  EntityTraversingService,\r\n  EntityManipulationService,\r\n  EntityAggregationService,\r\n  EntityListService,\r\n  EntityService,\r\n\r\n  ListDataService,\r\n  TreeDataService,\r\n  SubTreeDataService,\r\n  CardDataService,\r\n  SubListDataService,\r\n\r\n  BeActionService,\r\n  ApproveService,\r\n  PrintService,\r\n  AttachmentDataService,\r\n  AttachmentService,\r\n  NavigationMiddlewareService,\r\n  GridMiddlewareService,\r\n  SidebarService,\r\n  FarrisFormService,\r\n  DialogService,\r\n];\r\n\r\nexport { FARRIS_COMMAND_SERVICE_PROVIDERS };\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { NumberFormat, UserSettings } from '@farris/devkit';\r\nimport { FrmI18nSettingService } from '@gsp-sys/rtf-common';\r\n\r\n@Injectable()\r\nexport class UserSettingsService implements UserSettings {\r\n  constructor(private injector: Injector, @Optional() private frmI18nSettingService: FrmI18nSettingService) { }\r\n\r\n  /**\r\n   * ç¨æ·æ¶åºå­ç¬¦ä¸²\r\n   */\r\n  public get timeZone(): string {\r\n    return this.timezone && this.timezone.id || null;\r\n  }\r\n  /**\r\n   * æ¶åºåç§»\r\n   */\r\n  public get timeZoneOffset(): number {\r\n    const offset = this.timezone && this.timezone.baseOffset;\r\n    if (offset !== null && offset !== undefined) {\r\n      return offset;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  /**\r\n   * é»è®¤è¯­è¨\r\n   */\r\n  public get defaultLanguage(): string {\r\n    return this.i18nSetting && this.i18nSetting.defaultLanguage || null;\r\n  }\r\n  /**\r\n   * æ¥ææ ¼å¼åå­ç¬¦ä¸²\r\n   * like: yyyy-MM-dd\r\n   */\r\n  public get dateFormat(): string {\r\n    return this.i18nSetting && this.i18nSetting.userDateFormat || null;\r\n  }\r\n  /**\r\n   * æ¶é´æ ¼å¼\r\n   * like: HH:MM:ss\r\n   */\r\n  public get timeFormat(): string {\r\n    return this.i18nSetting && this.i18nSetting.userTimeFormat || null;\r\n  }\r\n  public get dateTimeFormat(): string {\r\n    const dateFormat = this.i18nSetting && this.i18nSetting.userDateFormat || 'yyyy-MM-dd';\r\n    const timeFormat = this.i18nSetting && this.i18nSetting.userTimeFormat || 'HH:mm:ss';\r\n    return `${dateFormat} ${timeFormat}`;\r\n  }\r\n  /**\r\n   * å°åæ ¼å¼\r\n   */\r\n  public get addressFormat(): any {\r\n    return null;\r\n  }\r\n  /**\r\n   * æ°å­æ ¼å¼\r\n   */\r\n  public get numberFormat(): NumberFormat {\r\n    if (this.i18nSetting && this.i18nSetting.userNumberFormat) {\r\n      const userNumberFormat = this.i18nSetting.userNumberFormat;\r\n      const numberFormat: NumberFormat = {\r\n        negativeSign: userNumberFormat.negativeSign || '-',\r\n        numberDecimalDigits: userNumberFormat.numberDecimalDigits || 2,\r\n        numberDecimalSeparator: userNumberFormat.numberDecimalSeparator || '.',\r\n        numberGroupSeparator: userNumberFormat.numberGroupSeparator || ','\r\n      };\r\n      return numberFormat;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * åºåä»£ç \r\n   */\r\n  public get regionCode(): string {\r\n    return this.i18nSetting && this.i18nSetting.userRegionCode || null;\r\n  }\r\n  /**\r\n   * ç¨æ·éç½®\r\n   */\r\n  private get userSettings(): any {\r\n    const userSettings = this.frmI18nSettingService && this.frmI18nSettingService.getSetting();\r\n    return userSettings;\r\n  }\r\n  private get timezone() {\r\n    return this.i18nSetting && this.i18nSetting.timezone;\r\n  }\r\n  private get i18nSetting() {\r\n    return this.userSettings && this.userSettings.i18nSetting;\r\n  }\r\n}","import { Injectable } from \"@angular/core\";\r\nimport { WorkFlow } from \"./types\";\r\n\r\n@Injectable()\r\nexport class WorkFlowMessageService {\r\n  private messageHandler: (callback: (e: WorkFlow.IMessage) => void) => (event: any) => void;\r\n  private handler: (event: any) => void;\r\n  constructor() {\r\n    this.messageHandler = (callback: (e: WorkFlow.IMessage) => void) => {\r\n      return (event: any) => {\r\n        var message = event.data as WorkFlow.IMessage;\r\n        if (message) {\r\n          message.sender = event.source;\r\n        }\r\n        if (typeof callback === 'function') {\r\n          callback(message);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * çå¬å·¥ä½æµæ¶æ¯\r\n   * @param callback åè°\r\n   */\r\n  public listen(callback: (e: WorkFlow.IMessage) => void) {\r\n    this.handler = this.messageHandler(callback);\r\n    window.addEventListener('message', this.handler);\r\n  }\r\n  public destroy() {\r\n    if (this.handler) {\r\n      window.removeEventListener('message', this.handler);\r\n    }\r\n\r\n  }\r\n  /**\r\n   * ç»å·¥ä½æµè¡¨ååéæ¶æ¯\r\n   * @param message \r\n   */\r\n  public send(message: WorkFlow.IMessage): void {\r\n    if (!message) {\r\n      return;\r\n    }\r\n    let win: Window = window;\r\n    if (message.target) {\r\n      win = message.target as Window || window;\r\n      delete message.target;\r\n    }\r\n    if (win) {\r\n      win.postMessage(message, '*');\r\n    }\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { WorkFlow } from \"./types\";\r\nimport { WorkFlowMessageService } from \"./work-flow-message.service\";\r\n\r\n/**\r\n * å·¥ä½æµæ¶æ¯\r\n * @warning ç¦æ­¢ä½¿ç¨è¡¨åä¸ä¸æï¼ææä¸ä¸æå¿é¡»ä»å¤é¨ä¼ å¥\r\n */\r\n@Injectable()\r\nexport class WorkFlowMessage {\r\n  private listeners: Map<string, any>;\r\n  constructor(private injector: Injector, public workFlowMessageService: WorkFlowMessageService) {\r\n    this.listeners = new Map<string, any>();\r\n  }\r\n  public setup() {\r\n    if (!this.workFlowMessageService) {\r\n      return;\r\n    }\r\n    this.workFlowMessageService.listen((message: WorkFlow.IMessage) => {\r\n      if (!this.listeners || this.listeners.size < 1) {\r\n        return;\r\n      }\r\n      this.listeners.forEach((callback: any, key: string) => {\r\n        if (typeof callback === 'function') {\r\n          callback(message);\r\n        }\r\n      })\r\n    });\r\n  }\r\n  public addEventListener(callback: (event: MessageEvent) => void): string {\r\n    const id = `${new Date().valueOf().toString(16)}-${Math.ceil(Math.random() * 100)}`;\r\n    this.listeners.set(id, callback);\r\n    return id;\r\n  }\r\n  public removeEventListener(eventId: string): void {\r\n    if (!this.listeners || this.listeners.size < 1) {\r\n      return;\r\n    }\r\n    this.listeners.delete(eventId);\r\n    eventId = null;\r\n  }\r\n}\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, AppContextManager, FrameContext, onFrameComponentInit } from \"@farris/devkit\";\r\nimport { from, Observable, of } from \"rxjs\";\r\nimport { BefRepository, BefRepositoryUtil } from '@farris/bef';\r\nimport { concatMap, throwIfEmpty } from \"rxjs/operators\";\r\nimport { ValidationService } from \"../validation.service\";\r\nimport { WorkFlow } from \"./types\";\r\nimport { WorkFlowMessage } from \"./work-flow-message\";\r\nimport { WorkFlowMessageService } from \"./work-flow-message.service\";\r\n\r\n@Injectable()\r\nexport class WorkFlowMessageHandler implements onFrameComponentInit {\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private workFlowMessageService: WorkFlowMessageService, private workFlowMessage: WorkFlowMessage) {\r\n\r\n  }\r\n  public onComponentInit(frameContext: FrameContext) {\r\n    const eventId = this.workFlowMessage.addEventListener(this.handle.bind(this));\r\n    const frameContextDestroySignal = this.frameContext.destorySignal;\r\n    if (frameContextDestroySignal) {\r\n      frameContextDestroySignal.subscribe(() => {\r\n        this.workFlowMessage.removeEventListener(eventId);\r\n      });\r\n    }\r\n    const appContextDestroySignal = this.frameContext.appContext.destorySignal;\r\n    if (appContextDestroySignal) {\r\n      appContextDestroySignal.subscribe(() => {\r\n        this.workFlowMessage.workFlowMessageService.destroy();\r\n      });\r\n    }\r\n  }\r\n  public handle(message: WorkFlow.IMessage): void {\r\n    const source = message.sender as Window;\r\n    const data = message.data as WorkFlow.IMessageBody;\r\n    const commandName = data && data.command || null;\r\n    let resultTask: Observable<any> = null;\r\n    if (!commandName) {\r\n      return;\r\n    }\r\n    if (commandName == 'wf-required-verification') {\r\n      // å·¥ä½æµçå¿å¡«æ ¡éª\r\n      // å¦æ­¤è·åçæ¯å½åç»ä»¶çæ ¡éªæå¡ï¼åºè¯¥ænamespaceæ¥åºåï¼ä¸åçnamespaceéè¦åå«æ§è¡æ ¡éª\r\n      const formFrameContexts = this.getFormFrameContexts();\r\n      resultTask = from(formFrameContexts).pipe(\r\n        concatMap((frameContext: FrameContext) => {\r\n          var validation = frameContext.injector.get<ValidationService>(ValidationService, null);\r\n          if (validation) {\r\n            return validation.validateAll();\r\n          }\r\n          return of(true);\r\n        })\r\n      );\r\n    } else {\r\n      var command = this.frameContext.viewModel[commandName];\r\n      if (command) {\r\n        resultTask = command(data.arguments);\r\n      }\r\n    }\r\n    if (resultTask) {\r\n      const message: WorkFlow.IMessage = this.buildMessage(true, source, this.isChanged);\r\n      resultTask.pipe(throwIfEmpty()).subscribe((result) => {\r\n        // åæ¥æºæ¹åä¼ æ¶æ¯\r\n        this.workFlowMessageService.send(message);\r\n      }, () => {\r\n        message.data.result = false;\r\n        this.workFlowMessageService.send(message);\r\n      });\r\n    }\r\n  }\r\n  private buildMessage(result: boolean, target: any, dataChanged: boolean, type: string = 'message') {\r\n    const message: WorkFlow.IMessage = {\r\n      data: {\r\n        result,\r\n        dataChanged\r\n      },\r\n      type: type,\r\n      target: target,\r\n    };\r\n    return message;\r\n  }\r\n  private getFormFrameContexts(): FrameContext[] {\r\n    const appContextManager = this.injector.get<AppContextManager>(AppContextManager, null);\r\n    const formFrameContexts = [];\r\n    if (appContextManager) {\r\n      const appContexts: AppContext[] = appContextManager.getAppContexts();\r\n      if (appContexts && appContexts.length > 0) {\r\n        appContexts.forEach((appContext: AppContext) => {\r\n          const frameContexts: FrameContext[] = appContext.frameContextManager.getFrameContexts();\r\n          frameContexts.reduce((contexts: FrameContext[], frameContext: FrameContext) => {\r\n            const namespace = frameContext.namespace;\r\n            const index = contexts.findIndex((frame: FrameContext) => frame.namespace === namespace);\r\n            if (index === -1) {\r\n              const root = frameContext.getVirtualRootFrameContext();\r\n              contexts.push(root);\r\n            }\r\n            return contexts;\r\n          }, formFrameContexts);\r\n        });\r\n      }\r\n    }\r\n    return formFrameContexts;\r\n  }\r\n  /**\r\n   * æ¯å¦ææªä¿å­çåæ´\r\n   */\r\n  private get isChanged(): boolean {\r\n    const befRepository = this.frameContext.repository as BefRepository<any>;\r\n    return BefRepositoryUtil.isExistUnsaveData(befRepository);\r\n  }\r\n}","import { FormLoadingService } from '../form-loading/form-loading.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { FormErrorService } from '../error/form-error.service';\r\nimport { FormWizardService } from '../form-wizard.service';\r\n\r\nimport { CheckService } from '../check.service';\r\nimport { DataCheckService } from '../data-check.service';\r\nimport { EventService } from '../event.service';\r\nimport { ComponentManagerService } from '../component-manager.service';\r\nimport { FilterService } from '../filter-service';\r\nimport { KeybindingService } from '../keybinding-service';\r\nimport { LanguageService } from '../languag.service';\r\n\r\nimport { MenuStateService } from '../menu-state.service';\r\nimport { QuerystringService } from '../querystring';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { ParamService } from '../param.service';\r\nimport { RouterService } from '../router.service';\r\nimport { ApplicationParamService } from '../application-param.service';\r\nimport { FilterConditionService } from '../filter-condition.service';\r\nimport { UserSettingsService } from '../user-settings.service';\r\nimport { UserSettingsToken } from '@farris/devkit';\r\nimport { WorkFlowMessage, WorkFlowMessageService } from '../work-flow/index';\r\n/**\r\n * æ¨¡åçº§æ³¨å¥(å±20ä¸ª)\r\n */\r\nconst FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS = [\r\n  FormLoadingService,\r\n  FormMessageService,\r\n  FormNotifyService,\r\n  FormErrorService,\r\n  FormWizardService,\r\n  CheckService,\r\n  DataCheckService,\r\n  EventService,\r\n  ComponentManagerService,\r\n  FilterService,\r\n  KeybindingService,\r\n  LanguageService,\r\n  ParamService,\r\n  MenuStateService,\r\n  QuerystringService,\r\n  RuntimeFrameworkService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  RouterService,\r\n  ApplicationParamService,\r\n  FilterConditionService,\r\n  { provide: UserSettingsToken, useClass: UserSettingsService },\r\n  WorkFlowMessageService,\r\n  WorkFlowMessage\r\n];\r\n\r\nexport { FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS }\r\n","/**\r\n * æ¯è¾ç¬¦\r\n */\r\nexport enum CompareType{\r\n    Equal = 0,\r\n    NotEqual = 1,\r\n    Greater = 2,\r\n    GreaterOrEqual = 3,\r\n    Less = 4,\r\n    LessOrEqual = 5,\r\n    Like = 6,\r\n    LikeStartWith = 7,\r\n    LikeEndWith = 8,\r\n    NotLike = 9,\r\n    NotLikeStartWith = 10,\r\n    NotLikeEndWith = 11,\r\n    Is = 12,\r\n    IsNot = 13,\r\n    In = 14,\r\n    NotIn = 15\r\n}","export enum ValueType{\r\n\r\n    /**\r\n     *å¼ç±»å\r\n     */\r\n    Value = 0,\r\n\r\n    /**\r\n     * è¡¨è¾¾å¼\r\n     */\r\n    Express = 1\r\n}","export enum RelationType{\r\n\r\n    Empty = 0,\r\n\r\n    /**\r\n     * ä¸\r\n     */\r\n    // And=0,\r\n    And = 1,\r\n\r\n    /**\r\n     * æ\r\n     */\r\n    // Or=1\r\n    Or = 2\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, TextValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class TextHandler implements IQueryConditionHandler {\r\n  convert(qc: QueryCondition) {\r\n    const tv = (qc.value as TextValue);\r\n    return [{\r\n      'FilterField': qc.fieldCode,\r\n      'Compare':  (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Like,\r\n      'Value': tv.value, // jsonè½¬ä¹ä¸encodeUriComponentä¸åï¼ä¸åºå¨æ­¤è½¬ä¹ï¼ç±jsonåé¨è½¬ä¹å³å¯\r\n      'Relation': (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n      'Expresstype': ValueType.Value,\r\n      'Lbracket': qc.Lbracket || null,\r\n      'Rbracket': qc.Rbracket || null\r\n    }];\r\n  }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, DateRangeValue, DateRangeControl} from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class DateRangeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        let control:DateRangeControl = qc.control as DateRangeControl\r\n        const arr = [];\r\n        const drv = (qc.value as DateRangeValue);\r\n        drv.startTime && arr.push({\r\n            'FilterField' : control.startFieldCode ? control.startFieldCode : qc.fieldCode,\r\n            'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n            'Value' : drv.startTime,\r\n            'Relation' : RelationType.And, //and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n        drv.endTime && arr.push({\r\n            'FilterField' : control.endFieldCode ? control.endFieldCode : qc.fieldCode,\r\n            'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n            'Value' : drv.endTime,\r\n            'Relation' : RelationType.And,//and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, DropDownListValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class DropDownHandler implements IQueryConditionHandler{\r\n    //qc.comparetypeåªæç­äºãä¸ç­äº\r\n    convert(qc: QueryCondition) {\r\n        const ddv = (qc.value as DropDownListValue);\r\n        const arr = [];\r\n        ddv.value.forEach(dv => {\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                'Value' : dv.value,\r\n                'Relation' : qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n                'Expresstype':ValueType.Value\r\n            });\r\n        });\r\n        arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n        arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n        arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, NumberRangeValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class NumberRangeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = [];\r\n        const nrv = (qc.value as NumberRangeValue);\r\n        (nrv.startValue != null) && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n            'Value' : nrv.startValue,\r\n            'Relation' : RelationType.And, //and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n        (nrv.endValue != null) && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n            'Value' : nrv.endValue,\r\n            'Relation' : RelationType.And,//and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SmartHelpValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SmartHelpHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const shv = (qc.value as SmartHelpValue);\r\n        if(shv.value.length == 0) return [];\r\n\r\n        const arr = [];\r\n        if(shv.isInputText || shv.valueField == null){\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Like,\r\n                'Value' : shv.textValue,\r\n                'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And ,\r\n                'Expresstype':ValueType.Value\r\n            });\r\n            return arr;\r\n        }else{\r\n            shv.getOriginalValue().split(',').forEach(id => {\r\n                id && arr.push({\r\n                    'FilterField' : qc.fieldCode,\r\n                    'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                    'Value' : id,\r\n                    'Relation' : qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n                    'Expresstype':ValueType.Value\r\n                });\r\n            });\r\n            if(arr.length > 0){\r\n                arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n                arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n                arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n                return arr;\r\n            }else{\r\n                return [];\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleYearValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleYearHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const yv = (qc.value as SingleYearValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : yv.yearValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, CheckBoxValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class CheckBoxHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        //å¤éæ¡çqc.compareType åªæç­äº\r\n        const arr = [];\r\n        const tv = (qc.value as CheckBoxValue);\r\n        if(tv.value.length == 1)\r\n            return [{\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.Equal,\r\n                'Value' : tv.value[0],\r\n                'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n                'Expresstype':ValueType.Value,\r\n                'Lbracket': qc.Lbracket || null,\r\n                'Rbracket': qc.Rbracket || null\r\n            }];\r\n        tv.value.forEach(tvv => {\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.Equal,\r\n                'Value' : tvv,\r\n                'Relation' : RelationType.Or,\r\n                'Expresstype':ValueType.Value\r\n            });\r\n        });\r\n        arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n        arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n        arr[arr.length -1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleMonthValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleMonthHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const mv = (qc.value as SingleMonthValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' :(qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : mv.monthValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, MonthRangeValue} from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class MonthRangeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = [];\r\n        const mrv = (qc.value as MonthRangeValue);\r\n        mrv.startTime && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n            'Value' : mrv.startTime,\r\n            'Relation' : RelationType.And, //and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n        mrv.endTime && arr.push({\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n            'Value' : mrv.endTime,\r\n            'Relation' : RelationType.And,//and\r\n            'Expresstype': ValueType.Value\r\n        });\r\n\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleDateTimeValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleDateTimeHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const dtv = (qc.value as SingleDateTimeValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : dtv.datetimeValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,//and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleNumberValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class SingleNumberHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const dtv = (qc.value as SingleNumberValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : dtv.numValue,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, SingleDateValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\nimport { format, addDays, addWeeks, addMonths, addYears, startOfMonth, endOfMonth, startOfYear, endOfYear, startOfWeek, endOfWeek, getDay } from 'date-fns'\r\nfunction getDate(dateValue, dtvFormat) {\r\n    let today = new Date()\r\n    // today.toLocaleString()\r\n    let result = []\r\n    //é¦åå¤æ­åªäºæ¯åä¸ªæ¥æï¼ä½¿ç¨equalå­å¥ä¸ä¸ªæ¥æå³å¯\r\n    if (dateValue.isFirstDay || dateValue.isLastDay) {\r\n\r\n        let switchValue = dateValue.dateType + '-' + (dateValue.isFirstDay ? 'first' : 'last')\r\n        switch (switchValue) {\r\n            case 'week-first':\r\n                if(getDay(today) === 0) {\r\n                    today = addDays(today, -1)\r\n                }\r\n                result.push(addDays(startOfWeek(today), 1))\r\n                break;\r\n            case 'week-last':\r\n                if(getDay(today) === 0) {\r\n                    today = addDays(today, -1)\r\n                }\r\n                result.push(addDays(endOfWeek(today), 1))\r\n                break;\r\n            case 'month-first':\r\n                result.push(startOfMonth(today))\r\n                break;\r\n            case 'month-last':\r\n                result.push(endOfMonth(today))\r\n                break;\r\n            case 'year-first':\r\n                result.push(startOfYear(today))\r\n                break;\r\n            case 'year-last':\r\n                result.push(endOfYear(today))\r\n                break;\r\n            default:\r\n                result.push(today)\r\n\r\n        }\r\n    } else if (dateValue.dateType === 'day' && dateValue.period === 'present') {\r\n        //ä»å¤©\r\n        result.push(today)\r\n    } else if (dateValue.dateType === 'day' && dateValue.count === 1) {\r\n        //æ¨å¤©ãæå¤©\r\n        let _date = addDays(today, dateValue.period === 'future' ? 1 : -1)\r\n        result.push(_date)\r\n    } else if (dateValue.period === 'present') {\r\n        //æ¬å¨ãæ¬æãæ¬å¹´\r\n        switch (dateValue.dateType) {\r\n            case 'week':\r\n                result.push(startOfWeek(today), endOfWeek(today))\r\n                break;\r\n            case 'month':\r\n                result.push(startOfMonth(today), endOfMonth(today))\r\n                break;\r\n            case 'year':\r\n                result.push(startOfYear(today), endOfYear(today))\r\n                break;\r\n            default:\r\n                result.push(today)\r\n        }\r\n\r\n    } else {\r\n        let switchValue = dateValue.dateType + '-' + dateValue.period\r\n        switch (switchValue) {\r\n            case 'day-previous':\r\n                result.push(addDays(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'day-future':\r\n                result.push(addDays(today, 1), addDays(today, dateValue.count))\r\n                break;\r\n            case 'week-previous':\r\n                result.push(addWeeks(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'week-future':\r\n                result.push(addDays(today, 1), addWeeks(today, dateValue.count))\r\n                break;\r\n            case 'month-previous':\r\n                result.push(addMonths(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'month-future':\r\n                result.push(addDays(today, 1), addMonths(today, dateValue.count))\r\n                break;\r\n            case 'year-previous':\r\n                result.push(addYears(today, dateValue.count * -1), addDays(today, -1))\r\n                break;\r\n            case 'year-future':\r\n                result.push(addDays(today, 1), addYears(today, dateValue.count))\r\n                break;\r\n            default:\r\n                result.push(today)\r\n        \r\n        }\r\n    }\r\n\r\n    result = result.map(item => format(item, dtvFormat.returnFormat || 'yyyy-MM-dd'))\r\n    return result\r\n\r\n};\r\nexport class SingleDateHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = []\r\n        const dtv = (qc.value as SingleDateValue);\r\n        if(typeof(dtv.dateValue) !== 'string') {\r\n            let _dateValue = getDate(dtv.dateValue, qc.control)\r\n            _dateValue.length === 1 && arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : qc.compareType ? CompareType[qc.compareType] : CompareType.Equal,\r\n                'Value' : _dateValue[0],\r\n                'Relation' : qc.relation ? RelationType[qc.relation] : RelationType.And, //and undefined\r\n                'Expresstype':ValueType.Value,\r\n                'Lbracket': qc.Lbracket || null,\r\n                'Rbracket': qc.Rbracket || null\r\n            })\r\n            _dateValue.length === 2 && arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.GreaterOrEqual, //GreaterOrEqual\r\n                'Value' : _dateValue[0],\r\n                'Relation' : RelationType.And, //and\r\n                'Expresstype': ValueType.Value,\r\n                'Lbracket': qc.Lbracket ? (qc.Lbracket + '(') :'('\r\n            }, {\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : CompareType.LessOrEqual, //LessOrEqual\r\n                'Value' : _dateValue[1],\r\n                'Relation' : RelationType.And,//and\r\n                'Expresstype': ValueType.Value,\r\n                'Rbracket': qc.Rbracket ? (qc.Rbracket + ')') : ')'\r\n            });\r\n            \r\n        } else {\r\n            arr.push({\r\n                'FilterField' : qc.fieldCode,\r\n                'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                'Value' : dtv.dateValue,\r\n                'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And, //and undefined\r\n                'Expresstype':ValueType.Value,\r\n                'Lbracket': qc.Lbracket || null,\r\n                'Rbracket': qc.Rbracket || null\r\n            })\r\n        }\r\n        return arr;\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, ComboLookUpValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class ComboLookUpHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        //å¸®å©çqc.comparetypeåªæç­äºãä¸ç­äº\r\n        const cluv = (qc.value as ComboLookUpValue);\r\n        if(cluv.value.length == 0 || !cluv.valueField){\r\n            return [];\r\n        }else{\r\n            const arr = [];\r\n            cluv.getOriginalValue().split(',').forEach(id => {\r\n                id && arr.push({\r\n                    'FilterField' : qc.fieldCode,\r\n                    'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n                    'Value' : id,\r\n                    'Relation' : qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n                    'Expresstype':ValueType.Value\r\n                });\r\n            });\r\n            if(arr.length > 0){\r\n                arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n                arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n                arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n                return arr;\r\n            }else{\r\n                return [];\r\n            }\r\n        }\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, RadioValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class RadioHandler implements IQueryConditionHandler{\r\n    convert(qc: QueryCondition) {\r\n        const arr = [];\r\n        const rv = (qc.value as RadioValue);\r\n        return [{\r\n            'FilterField' : qc.fieldCode,\r\n            'Compare' : (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n            'Value' : rv.value,\r\n            'Relation' : (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n            'Expresstype':ValueType.Value,\r\n            'Lbracket': qc.Lbracket || null,\r\n            'Rbracket': qc.Rbracket || null\r\n        }];\r\n    }\r\n}","import { IQueryConditionHandler } from \"./iquerycondition.handler\";\r\nimport { QueryCondition, InputGroupValue } from \"@farris/component-querycondition\";\r\nimport { CompareType } from '../enum/compare-type.enum';\r\nimport { ValueType } from '../enum/value-type.enum';\r\nimport { RelationType } from '../enum/relation-type.enum';\r\n\r\nexport class InputGroupHandler implements IQueryConditionHandler {\r\n  //qc.comparetypeåªæç­äºãç¸ä¼¼\r\n  convert(qc: QueryCondition) {\r\n    const igv = (qc.value as InputGroupValue);\r\n    const arr = [];\r\n\r\n    if (igv.isInputText || igv.textField == null) {\r\n      arr.push({\r\n        'FilterField': qc.fieldCode,\r\n        'Compare': (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Like,\r\n        'Value': igv.textValue,//encodeURIComponent(igv.textValue),\r\n        'Relation': (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And,\r\n        'Expresstype': ValueType.Value,\r\n        'Lbracket': qc.Lbracket || null,\r\n        'Rbracket': qc.Rbracket || null\r\n      });\r\n      return arr;\r\n    }\r\n    else {\r\n      igv.getOriginalValue().split(',').forEach(itemValue => {\r\n        itemValue && arr.push({\r\n          'FilterField': qc.fieldCode,\r\n          'Compare': (qc.compareType || qc.compareType === 0) ? qc.compareType : CompareType.Equal,\r\n          'Value': itemValue,\r\n          'Relation': qc.compareType === CompareType.NotEqual ? RelationType.And : RelationType.Or,\r\n          'Expresstype': ValueType.Value\r\n        });\r\n      });\r\n      if (arr.length > 0) {\r\n        arr[0]['Lbracket'] = qc.Lbracket ? (qc.Lbracket + '(') :'(';\r\n        arr[arr.length -1]['Rbracket'] = qc.Rbracket ? (qc.Rbracket + ')') : ')';\r\n        arr[arr.length - 1]['Relation'] = (qc.relation || qc.relation === 0) ? qc.relation : RelationType.And;\r\n        return arr;\r\n      } else {\r\n        return [];\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ControlType } from \"@farris/component-querycondition\";\r\nimport { IQueryConditionHandler } from \"./handlers/iquerycondition.handler\";\r\nimport { TextHandler } from \"./handlers/text.handler\";\r\nimport { DateRangeHandler } from \"./handlers/daterage.handler\";\r\nimport { DropDownHandler } from \"./handlers/dropdown.handler\";\r\nimport { NumberRangeHandler } from \"./handlers/numberrage.handler\";\r\nimport { SmartHelpHandler } from \"./handlers/smarthelp.handler\";\r\nimport { SingleYearHandler } from './handlers/single-year.handler';\r\nimport { CheckBoxHandler } from './handlers/checkbox.handler';\r\nimport { SingleMonthHandler } from './handlers/single-month.handler';\r\nimport { MonthRangeHandler } from './handlers/monthrange.handler';\r\nimport { SingleDateTimeHandler } from './handlers/single-date-time.handler';\r\nimport { SingleNumberHandler } from './handlers/single-number.handler';\r\nimport { SingleDateHandler } from './handlers/single-date.handler';\r\nimport { ComboLookUpHandler } from './handlers/combolookup.handler';\r\nimport { RadioHandler } from './handlers/radio.handler';\r\nimport { InputGroupHandler } from './handlers/inputgroup.handler';\r\n\r\nexport class QueryConditionHandlerFactory {\r\n\r\n    private static _instance: QueryConditionHandlerFactory = null;\r\n    private queryConditionHandlerMapping: Map<ControlType, IQueryConditionHandler> = new Map<ControlType, IQueryConditionHandler>();\r\n    private constructor(){\r\n        this.queryConditionHandlerMapping.set(ControlType.Text, new TextHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.InputGroup, new InputGroupHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.DateRange, new DateRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.DateTimeRange, new DateRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.DropDownList, new DropDownHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.NumberRange, new NumberRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SmartHelp, new SmartHelpHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleYear, new SingleYearHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.BoolCheck, new CheckBoxHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleMonth, new SingleMonthHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.MonthRange, new MonthRangeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleDateTime, new SingleDateTimeHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleNumber, new SingleNumberHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.SingleDate, new SingleDateHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.ComboLookUp, new ComboLookUpHandler());\r\n        this.queryConditionHandlerMapping.set(ControlType.Radio, new RadioHandler());\r\n    }\r\n    public static getInstance(){\r\n        if(!QueryConditionHandlerFactory._instance){\r\n            QueryConditionHandlerFactory._instance = new QueryConditionHandlerFactory();\r\n        }\r\n        return QueryConditionHandlerFactory._instance;\r\n    }\r\n\r\n    getHandler(controlType: ControlType): IQueryConditionHandler{\r\n        return this.queryConditionHandlerMapping.get(controlType);\r\n    }\r\n}","import { Injectable } from '@angular/core';\r\nimport { QueryCondition } from '@farris/component-querycondition';\r\nimport { IQueryConditionHandler } from './handlers/iquerycondition.handler';\r\nimport { QueryConditionHandlerFactory } from './querycondition.handler.factory';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { IQuerySolutionHandler,QuerySolutionComponent } from '@gsp-cmp/querysolution';\r\nimport { FrameworkSessionService } from '@farris/bef';\r\n\r\n@Injectable()\r\nexport class QuerySolutionService implements IQuerySolutionHandler {\r\n\r\n  constructor(\r\n    private frameContext: FrameContext,\r\n    private frameworkSessionService: FrameworkSessionService\r\n  ) {\r\n\r\n  }\r\n\r\n  getUserSessionId(): string {\r\n    return this.frameworkSessionService.getUserSessionId();\r\n  }\r\n\r\n  public setFilterConditions(params: Array<QueryCondition>): void {\r\n    let queryConditionHandler: IQueryConditionHandler;\r\n    const filterConditionList = [];\r\n    params.forEach(qc => {\r\n      if (!qc.value.isEmpty()) {\r\n        queryConditionHandler = QueryConditionHandlerFactory.getInstance().getHandler(qc.control.getControlType());\r\n        queryConditionHandler && filterConditionList.push(...queryConditionHandler.convert(qc));\r\n      }\r\n    });\r\n    //è®¾ç½®å°NgCommand params.filterå±æ§ä¸ï¼{UISTATE~/root-component/filterConditionList}\r\n    this.frameContext.uiState['filterConditionList'] = JSON.stringify(filterConditionList);\r\n    // const originalConditions = this.getOriginalQueryConditions(filterConditionList);\r\n    this.frameContext.uiState['originalFilterConditionList'] = JSON.stringify(filterConditionList);\r\n  }\r\n\r\n  public setCurrentQueryConditions(conditions: QueryCondition[]): void {\r\n    this.frameContext.uiState['currentQueryConditions'] = conditions;\r\n  }\r\n  /**\r\n   * è¿åè¿æ»¤æ¡ä»¶ä¸­çencode\r\n   * @param conditions æ¥è¯¢æ¹æ¡æé å®çè¿æ»¤æ¡ä»¶\r\n   */\r\n  // private getOriginalQueryConditions(conditions: Array<any>): Array<any> {\r\n  //   conditions = JSON.parse(JSON.stringify(conditions));\r\n  //   if (conditions && Array.isArray(conditions) && conditions.length > 0) {\r\n  //     conditions = conditions.map((item) => {\r\n  //       if (item.hasOwnProperty('Value')) {\r\n  //         item.Value = decodeURIComponent(item.Value);\r\n  //       } else if (item.hasOwnProperty('value')) {\r\n  //         const value = item.value;\r\n  //         delete item.value;\r\n  //         item.Value = decodeURIComponent(value);\r\n  //       }\r\n  //       return item;\r\n  //     });\r\n  //   }\r\n  //   return conditions;\r\n  // }\r\n\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AppContext, FrameContext } from '@farris/devkit';\r\nimport { of } from 'rxjs';\r\nimport { tap, delay } from 'rxjs/operators';\r\n\r\n/**\r\n * ç»æè¡¨åç¼è¾ç¶ææå¡\r\n */\r\n@Injectable()\r\nclass EndEditService {\r\n  constructor(private frameContext: FrameContext) {\r\n  }\r\n  /**\r\n   * ç»æç¼è¾\r\n   */\r\n  public endEdit() {\r\n    const appContext: AppContext = this.frameContext && this.frameContext.getFormAppContext();\r\n    return of(null).pipe(\r\n      tap(() => {\r\n        if (appContext) {\r\n          appContext.messagePipe.next({ type: 'endEdit' });\r\n        }\r\n      }),\r\n      // todo: ä¸åºè¯¥ä½¿ç¨delayï¼åºè¯¥ä¸²æµ\r\n      delay(120)\r\n    );\r\n  }\r\n}\r\nexport { EndEditService };\r\n","import { Injectable } from '@angular/core';\r\nimport { ViewModel } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { of, Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class RemoteSummaryService {\r\n  constructor(private viewModel: ViewModel) { }\r\n  /**\r\n   * æå¡å¨ç«¯åè®¡\r\n   * @param methodName æå¡å¨ç«¯åè®¡èªå®ä¹å¨ä½åç§°\r\n   * @param filters è¿æ»¤æ¡ä»¶\r\n   */\r\n  public summary(methodName: string, filters: any) {\r\n    const repository = this.viewModel.frameContext.repository as BefRepository<any> || null;\r\n    if (repository) {\r\n      const proxy = repository.proxy;\r\n      if (proxy && typeof proxy[methodName] === 'function') {\r\n        return proxy[methodName](filters) as Observable<any>;\r\n      }\r\n    }\r\n    return of(null);\r\n  }\r\n}\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { BindingList, ViewModel, BindingObject, Repository, Entity, FrameContext, BindingData, AppContext, BindingProperty, DataTypeInfo, createEntities, EntityList } from '@farris/devkit';\r\nimport { from, EMPTY, concat, of, Subject, Observable, throwError } from 'rxjs';\r\nimport { concatMap, catchError, tap, switchMap, last, map, delay, takeLast } from 'rxjs/operators';\r\nimport { BefRepository, ResponseInfo } from '@farris/bef';\r\nimport { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';\r\nimport { DateTimeHelperService } from '@farris/ui-common/date';\r\nimport { ComponentManagerService } from './component-manager.service';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormNotifyService } from './form-notify.service';\r\nimport { UploadService } from '@gsp-svc/formdoc-upload';\r\nimport { FormErrorService } from './error';\r\n\r\n// tslint:disable: max-line-length\r\n/**\r\n * æ¹éç¼è¾æå¡\r\n */\r\n@Injectable()\r\nexport class BatchEditService {\r\n  private formLoadingService: FormLoadingService;\r\n  private onHelpClose: Subject<any>;\r\n  constructor(\r\n    private injector: Injector,\r\n    private componentManagerService: ComponentManagerService,\r\n    private viewModel: ViewModel,\r\n    private repository: Repository<any>,\r\n    private batchEditDialogService: BatchEditDialogService,\r\n    private dateService: DateTimeHelperService,\r\n    private languageService: LanguageService,\r\n    private formNotifyService: FormNotifyService,\r\n    private fileUploadService: UploadService\r\n  ) {\r\n    this.formLoadingService = this.injector.get<FormLoadingService>(FormLoadingService, null);\r\n    if (!this.languageService) {\r\n      this.languageService = LanguageService.getInstance();\r\n    }\r\n    if (!this.formNotifyService) {\r\n      this.formNotifyService = this.injector.get<FormNotifyService>(FormNotifyService, null);\r\n    }\r\n    this.onHelpClose = new Subject<any>();\r\n    this.onHelpClose.subscribe(result => {\r\n      const { frameId = '', mapFields = '', data = [] } = result || {};\r\n      this.onHelpCloseHandler(frameId, mapFields, data);\r\n    });\r\n  }\r\n  private get formErrorService() {\r\n    return this.injector && this.injector.get<FormErrorService>(FormErrorService, null);\r\n  }\r\n  /**\r\n   * æå¼æ¹éç¼è¾å¯¹è¯æ¡\r\n   * @param frameId frameId\r\n   */\r\n  public openBatchEditDialog(frameId: string, enableDictPicking: boolean | string = false) {\r\n    if (!frameId) {\r\n      throw new Error('frameId is required.');\r\n    }\r\n    if (typeof enableDictPicking === 'string') {\r\n      enableDictPicking = (enableDictPicking === 'true' ? true : false);\r\n    }\r\n    if (this.batchEditDialogService) {\r\n      let columns = [];\r\n      if (this.viewModel) {\r\n        const gridFrameContext: FrameContext = this.viewModel.frameContext.root.appContext.frameContextManager.getFrameContextById(frameId);\r\n        const gridViewModel = gridFrameContext.viewModel;\r\n        if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumnsName')) {\r\n          // tslint:disable-next-line: no-string-literal\r\n          const gridColumnsAttrName = gridViewModel['dataGridColumnsName'];\r\n          columns = gridViewModel[gridColumnsAttrName];\r\n        } else if (gridViewModel && gridViewModel.hasOwnProperty('dataGridColumns')) {\r\n          columns = gridViewModel['dataGridColumns'];\r\n        }\r\n        const ids: string[] = gridViewModel.uiState['ids'] || [];\r\n        if (!ids || ids.length < 1) {\r\n          this.formNotifyService.warning(this.languageService.plsCheckBatchEditRows, { hideTitle: true });\r\n          return EMPTY;\r\n        }\r\n        const dialogRef: any = this.batchEditDialogService.batchEdit(columns, {\r\n          rows: ids.length,\r\n          enableDictPicking,\r\n          onConfirm: (inputs: Array<any>) => {\r\n            if (Array.isArray(ids) && ids.length > 0) {\r\n              // console.log('openBatchEditDialog', inputs);\r\n              const appContext = this.viewModel.frameContext.appContext;\r\n              appContext.changeDetectionController.detach();\r\n              inputs.forEach(input => {\r\n                this.updateBindingData(input, ids);\r\n              });\r\n              appContext.changeDetectionController.reattach();\r\n            }\r\n            dialogRef.close();\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æå¼éèå¸®å©\r\n   * @param helpId å¸®å©id\r\n   */\r\n  public openHiddenHelp(helpId: string) {\r\n    if (!helpId) {\r\n      throw new Error('Argument error,helpId can`t be empty');\r\n    }\r\n    const componentManagerService = this.componentManagerService.getControl(helpId);\r\n    if (componentManagerService) {\r\n      componentManagerService.showDialog();\r\n    } else {\r\n      throw new Error(`the component which id is ${helpId} can't be found!`);\r\n    }\r\n  }\r\n  /**\r\n   * æ¸ç©ºå¸®å©å¾éï¼åªè½æè½½å°å¸®å©åäºä»¶ï¼\r\n   */\r\n  public clearHelpSelections() {\r\n    const self: any = this;\r\n    const helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;\r\n    if (helpElement) {\r\n      helpElement.displayValue = '';\r\n    }\r\n  }\r\n  /**\r\n   * å¾éå½åè¡\r\n   * @param frameId frameId\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param primaryKeyValue å¸®å©ä¸»é®å­æ®µ\r\n   */\r\n  public checkCurrentRow(frameId: string, mapFields: string, primaryKeyValue: string) {\r\n    const self: any = this;\r\n    const helpElement = self.context && self.context.eventParam && self.context.eventParam.instance || null;\r\n    if (!primaryKeyValue) {\r\n      primaryKeyValue = 'id';\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    if (helpElement) {\r\n      frameId = frameId || this.viewModel.frameContext.frameId;\r\n      if (frameId) {\r\n        const frameContext = this.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          const bindingPath = frameContext.viewModel.bindingPath;\r\n          if (bindingPath) {\r\n            const bindingPaths = bindingPath.split('/').filter(p => p);\r\n            const bindingList = frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n            const currentRow = bindingList.currentItem;\r\n            const path = mappings[primaryKeyValue];\r\n            if (path) {\r\n              const value = this.getValueByPath(currentRow, path);\r\n              helpElement.displayValue = value;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä¸»è¡¨æ°æ®\r\n   * @param frameId ä¸»è¡¨æå¨frameçid\r\n   * @param mapFields å¸®å©å­æ®µä¸ä¸»è¡¨å­æ®µæ å°\r\n   * @description ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä¸»è¡¨æ°æ®\r\n   */\r\n  public batchAppend(frameId: string, mapFields: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    if (result && Array.isArray(result) && result.length > 0) {\r\n      const mappings = JSON.parse(mapFields);\r\n      // ä¸æ¯bindingPathåæframeIdå¤ç\r\n      let bindingPath = '/';\r\n      const appContext = this.injector.get<AppContext>(AppContext, null);\r\n      if (appContext) {\r\n        const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          bindingPath = frameContext.viewModel.bindingPath || '/';\r\n        } else {\r\n          throw new Error('frameId is invalid!');\r\n        }\r\n      }\r\n      const defaultValues = [];\r\n      result.forEach((item) => {\r\n        const defaultValue = {};\r\n        Object.keys(mappings).forEach((prop: string) => {\r\n          const value = this.getValueByPath(item, prop);\r\n          const fields = mappings[prop];\r\n          const groups: any[] = fields.split(',').filter(p => p);\r\n          groups.forEach(group => {\r\n            const paths = group.split('.').filter(p => p);\r\n            this.setValueByPath(defaultValue, paths.join('.'), value);\r\n          });\r\n        });\r\n        defaultValues.push(defaultValue);\r\n      });\r\n      this.formLoadingService.show();\r\n      return this.repository.batchAppend(defaultValues).pipe(\r\n        tap(() => this.formLoadingService.hide()),\r\n        map(() => true)\r\n      );\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä»è¡¨/ä»ä»è¡¨\r\n   * @param frameId ä»è¡¨/ä»ä»è¡¨æå¨frameçid\r\n   * @param mapFields å¸®å©å­æ®µä¸ä»è¡¨/ä»ä»è¡¨å­æ®µæ å°\r\n   * @description ä»¥å¸®å©å¾éæ°æ®ä½ä¸ºä¾æ®ï¼æ¹éæ°å¢ä»è¡¨/ä»ä»è¡¨\r\n   */\r\n  public batchAppendByPathBasedOnHelpSelections(frameId: string, mapFields: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    if (result && Array.isArray(result) && result.length > 0) {\r\n      const mappings = JSON.parse(mapFields);\r\n      // ä¸æ¯bindingPathåæframeIdå¤ç\r\n      let bindingPath = '/';\r\n      const appContext = this.injector.get<AppContext>(AppContext, null);\r\n      if (appContext) {\r\n        const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          bindingPath = frameContext.viewModel.bindingPath || '/';\r\n        } else {\r\n          throw new Error('frameId is invalid!');\r\n        }\r\n      }\r\n      const defaultValues = [];\r\n      result.forEach((item) => {\r\n        const defaultValue = {};\r\n        Object.keys(mappings).forEach((prop: string) => {\r\n          const value = this.getValueByPath(item, prop);\r\n          const fields = mappings[prop];\r\n          const groups: any[] = fields.split(',').filter(p => p);\r\n          groups.forEach(group => {\r\n            const paths = group.split('.').filter(p => p);\r\n            this.setValueByPath(defaultValue, paths.join('.'), value);\r\n          });\r\n        });\r\n        defaultValues.push(defaultValue);\r\n      });\r\n      this.formLoadingService.show();\r\n      const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n      return this.repository.batchAppendByPath(path, defaultValues).pipe(\r\n        tap(() => this.formLoadingService.hide()),\r\n        map(() => true)\r\n      );\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * æ¹éæ°å¢å¸¦éä»¶çä»è¡¨æä»ä»è¡¨æ°æ®\r\n   * @param frameId\r\n   * @param mapFields\r\n   * @param attachmentInfoFieldPath éä»¶udtå­æ®µè·¯å¾ï¼å¯æ¯æå¤ä¸ªï¼ä»¥éå·åé\r\n   * @param rootId éä»¶å­å¨æ ¹ç®å½\r\n   * @param path éä»¶å­å¨ç®å½\r\n   * @description æ¹éæ°å¢å¸¦éä»¶çä»è¡¨æä»ä»è¡¨æ°æ®ä¸æ¹éæ°å¢ä»è¡¨ä»ä»è¡¨æ°æ®ä¸è´ï¼å¨æ¹éæ°å¢æ°æ®çåºç¡ä¸å¢å äºéä»¶å¤å¶\r\n   * @todo ç®åéä»¶å¤å¶å¨åç«¯è°ç¨ï¼ä¼åèµ·å¤ä¸ªè¯·æ±ï¼ä¸å­å¨å®å¨é®é¢ï¼åç»­åºå¨voéæ\r\n   */\r\n  public batchAppendByPathWithAttachment(frameId: string, mapFields: string, attachmentInfoFieldPath: string, rootId: string, path: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    if (!attachmentInfoFieldPath) {\r\n      throw new Error('éä»¶udtå­æ®µè·¯å¾ä¸è½ä¸ºç©º');\r\n    }\r\n    if (result && Array.isArray(result) && result.length > 0) {\r\n      const mappings = JSON.parse(mapFields);\r\n      let bindingPath = '/';\r\n      const appContext = this.injector.get<AppContext>(AppContext, null);\r\n      // ä¿®æ­£bindingPath\r\n      if (appContext) {\r\n        const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n        if (frameContext) {\r\n          bindingPath = frameContext.viewModel.bindingPath || '/';\r\n        } else {\r\n          throw new Error('frameId is invalid!');\r\n        }\r\n      }\r\n      // å¤çéä»¶udtå­æ®µ\r\n      const attachmentFields = attachmentInfoFieldPath.split(',').filter(p => p).map(path => path.split('/').pop());\r\n      this.formLoadingService.show();\r\n      // åå¤å¶éä»¶\r\n      const copyFiles$ = from(result).pipe(concatMap((item => {\r\n        return this.copyRowFiles(item, attachmentFields, rootId, path).pipe(\r\n          catchError((error) => {\r\n            this.formLoadingService.hide();\r\n            let cafError = error.error;\r\n            if (typeof cafError === 'string') {\r\n              cafError = JSON.parse(cafError);\r\n            }\r\n            if (this.formErrorService) {\r\n              this.formErrorService.exception(cafError.message || this.languageService.copyFailed, error);\r\n            }\r\n            return throwError(error);\r\n          })\r\n        );\r\n      })));\r\n      return copyFiles$.pipe(takeLast(1)).pipe(switchMap(() => {\r\n        // æ¼è£é»è®¤å¼\r\n        const defaultValues = this.buildDefaultValues(result, mappings);\r\n        const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n        return this.repository.batchAppendByPath(path, defaultValues).pipe(\r\n          tap(() => this.formLoadingService.hide()),\r\n          map(() => true)\r\n        );\r\n      }));\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n   * æé é»è®¤å¼æ°ç»\r\n   * @param selectedValues\r\n   * @param mapFields\r\n   * @returns\r\n   */\r\n  private buildDefaultValues(selectedValues: any[], mapFields: { [prop: string]: any }): any[] {\r\n    const defaultValues = [];\r\n    selectedValues.forEach((item) => {\r\n      const defaultValue = {};\r\n      Object.keys(mapFields).forEach((prop: string) => {\r\n        // å¸®å©æ°æ®\r\n        const value = this.getValueByPath(item, prop);\r\n        // ç®æ å­æ®µ\r\n        const fields = mapFields[prop];\r\n        const groups: any[] = fields.split(',').filter(p => p);\r\n        groups.forEach(group => {\r\n          const paths = group.split('.').filter(p => p);\r\n          this.setValueByPath(defaultValue, paths.join('.'), value);\r\n        });\r\n      });\r\n      defaultValues.push(defaultValue);\r\n    });\r\n    return defaultValues;\r\n  }\r\n  /**\r\n   * å¤å¶è¡ä¸­ææéä»¶\r\n   * @param row\r\n   * @param attachmentFields\r\n   * @param rootId\r\n   * @param path\r\n   * @returns\r\n   */\r\n  private copyRowFiles(row: any, attachmentFields: string[], rootId: string, path: string) {\r\n    return from(attachmentFields).pipe(\r\n      concatMap((field: string) => {\r\n        const attachmentId = this.getValueByPath(row, `${field}.attachmentId`);\r\n        if (attachmentId) {\r\n          // åéå¤å¶éä»¶çè¯·æ±ï¼è·åéä»¶id\r\n          return this.fileUploadService.copyFile(attachmentId, rootId, path).pipe(\r\n            tap((attachmentId: string) => {\r\n              // å¤å¶æå\r\n              this.setValueByPath(row, [field, 'attachmentId'].join('.'), attachmentId);\r\n            }\r\n            ));\r\n        } else {\r\n          return of(null);\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * è¡åå¸®å©å¤éæ¹éæ°å¢ææ¿æ¢å­è¡¨æ°æ®\r\n   * @param frameId frameId, optional,ä¸ºç©ºæ¶ä½¿ç¨å½ä»¤æ§è¡æ¶æå¨çä¸ä¸æ\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param primaryKey å¸®å©ä¸»é®å­æ®µï¼é»è®¤ä¸ºid\r\n   * @returns\r\n   */\r\n  public batchAppendBasedOnRowHelpSelections(frameId: string, mapFields: string) {\r\n    const self: any = this;\r\n    let result: any[] = self.context && self.context.eventParam || [];\r\n    if (!mapFields) {\r\n      return of(true);\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    if (!mappings || !mappings.hasOwnProperty('id')) {\r\n      return of(true);\r\n    }\r\n    frameId = frameId || this.viewModel.frameContext.frameId;\r\n    if (!frameId) {\r\n      return of(true);\r\n    }\r\n    const frameContext = this.getFrameContextById(frameId);\r\n    if (!frameContext) {\r\n      return of(true);\r\n    }\r\n    setTimeout(() => {\r\n      this.endEdit(frameContext).subscribe(() => {\r\n        setTimeout(() => {\r\n          if (result && Array.isArray(result) && result.length > 0) {\r\n            const bindingPath = frameContext.viewModel.bindingPath || '/';\r\n            const bindingPaths = bindingPath.split('/').filter(p => p);\r\n            const defaultValues = [];\r\n            // è·åå½åè¡\r\n            const bindingList: BindingList = frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n            const currentRow = bindingList.currentItem;\r\n            const currentRowId = bindingList.currentId;\r\n            const currentEntity = this.getEntityByPath(frameContext, bindingPaths, currentRowId);\r\n            const headItem = result[0];\r\n            // å¦æä»å¾éä¸æ¡ï¼ååºæ¿æ¢å½åè¡çæ å°\r\n            if (result.length === 1) {\r\n              // this.mappingRow(headItem, mappings, currentEntity, bindingPath);\r\n              const data = headItem;\r\n              Object.keys(mappings).forEach((prop: string) => {\r\n                const value = this.getValueByPath(data, prop);\r\n                const fields = mappings[prop];\r\n                const groups: any[] = fields.split(',').filter(p => p);\r\n                groups.forEach(group => {\r\n                  const paths = group.split('.').filter(p => p);\r\n                  frameContext.bindingData.setValue(bindingPaths.concat(paths), value, true, true);\r\n                });\r\n              });\r\n              return of(true);\r\n            } else {\r\n              const idMapField = mappings['id'];\r\n              const sourceItemId = this.getValueByPath(currentEntity, idMapField);\r\n              // å¦æå½åè¡æ²¡ææ å°æå¾éç»æä¸­æ¾ä¸å°å½åè¡çæ å°\r\n              if (!sourceItemId || result.findIndex(item => item[bindingList.primaryKey] === sourceItemId) === -1) {\r\n                // éæ°æ å°å½åè¡\r\n                this.mappingRow(headItem, mappings, currentEntity, bindingPath);\r\n                result = result.slice(1);\r\n              } else if (sourceItemId) {\r\n                const index = result.findIndex(item => item[bindingList.primaryKey] === sourceItemId);\r\n                // éæ°æ å°å½åè¡\r\n                this.mappingRow(result[index], mappings, currentEntity, bindingPath);\r\n                result.splice(index, 1);\r\n              }\r\n              // å½åè¡å¤çå®æ\r\n              // å¤çæªæ å°çè¡\r\n              const emptyRows = bindingList.toArray().filter(bindingObject => {\r\n                const id = this.getValueByPath(bindingObject, mappings[bindingList.primaryKey]);\r\n                return !id;\r\n              });\r\n              if (emptyRows && emptyRows.length > 0) {\r\n                let rows = result;\r\n                if (result.length > emptyRows.length) {\r\n                  rows = result.slice(0, emptyRows.length);\r\n                  result = result.slice(emptyRows.length);\r\n                } else {\r\n                  result = [];\r\n                }\r\n                rows.forEach((item, index) => {\r\n                  const targetItem = emptyRows[index];\r\n                  const entity = this.getEntityByPath(frameContext, bindingPaths, targetItem.primaryKeyValue);\r\n                  this.mappingRow(item, mappings, entity, bindingPath);\r\n                });\r\n              }\r\n              // å¤çå©ä½å¾é\r\n              result.forEach((item) => {\r\n                const defaultValue = {};\r\n                Object.keys(mappings).forEach((prop: string) => {\r\n                  const value = this.getValueByPath(item, prop);\r\n                  const fields = mappings[prop];\r\n                  const groups: any[] = fields.split(',').filter(p => p);\r\n                  groups.forEach(group => {\r\n                    const paths = group.split('.').filter(p => p);\r\n                    this.setValueByPath(defaultValue, paths.join('.'), value);\r\n                  });\r\n                });\r\n                defaultValues.push(defaultValue);\r\n              });\r\n              if (defaultValues.length > 0) {\r\n                this.formLoadingService.show();\r\n                const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n                this.repository.batchAppendByPath(path, defaultValues).pipe(\r\n                  tap(() => this.formLoadingService.hide())\r\n                ).subscribe();\r\n              }\r\n            }\r\n          }\r\n        }, 350);\r\n      });\r\n    }, 50);\r\n    return of(true);\r\n  }\r\n  /**\r\n   * å¤å¶ä¸»è¡¨æ°æ®\r\n   * @param id è¦å¤å¶çæ°æ®id\r\n   * @param fields è¦å¤å¶çå­æ®µ\r\n   * @description ä»æ¯æå¤å¶ä¸»è¡¨æ°æ®\r\n   * @deprecated è¯¥æ¹æ³å·²è¢«åºå¼ï¼è¯·ä½¿ç¨cloneæ¹æ³æ¿ä»£ã\r\n   */\r\n  public copy(id: string): Observable<any> {\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const baseUri = befRepository.restService.baseUri;\r\n    const url = `${baseUri}/service/copymainobjvoaction`;\r\n    const requestInfo = befRepository.restService.buildRequestInfo();\r\n    const body = {\r\n      requestInfo,\r\n      dataID: id\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    this.formLoadingService.show();\r\n    return befRepository.proxy.request(url, 'PUT', null, options).pipe(\r\n      tap(() => {\r\n        this.formLoadingService.hide();\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const returnValue = responseInfo.returnValue;\r\n        const entity = this.repository.buildEntity(returnValue);\r\n        this.repository.entityCollection.addEntity(entity);\r\n        return entity;\r\n      }),\r\n    );\r\n  }\r\n  /**\r\n   * å¤å¶æ°æ®ï¼æ¯æä¸»è¡¨ãä»è¡¨ãä»ä»è¡¨ï¼\r\n   * @param id è¦å¤å¶çè¡\r\n   * @param path è¯·æ±è·¯å¾\r\n   * @returns\r\n   */\r\n  public clone(id: string, path: string) {\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!path) {\r\n      this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!path.startsWith('/')) {\r\n      path = '/' + path;\r\n    }\r\n    path = path.toLowerCase();\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const baseUri = befRepository.restService.baseUri;\r\n    const url = `${baseUri}${path}`;\r\n    const requestInfo = befRepository.restService.buildRequestInfo();\r\n    const ids = this.buildIds(bindingPath);\r\n    ids.push(id);\r\n    const body = {\r\n      requestInfo,\r\n      dataID: ids.join(',')\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    this.formLoadingService.show();\r\n    return befRepository.proxy.request(url, 'PUT', null, options).pipe(\r\n      tap(() => {\r\n        this.formLoadingService.hide();\r\n      }),\r\n      map((responseInfo: ResponseInfo) => {\r\n        const returnValue = responseInfo.returnValue;\r\n        let entity = null;\r\n        if (bindingPath.split('/').filter(p => p).length === 0) {\r\n          entity = this.repository.buildEntity(returnValue);\r\n          this.repository.entityCollection.addEntity(entity, true);\r\n        } else {\r\n          const fpath = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          entity = befRepository.entityManager.appendEntityByPath(fpath, returnValue, returnValue, true);\r\n        }\r\n        return entity;\r\n      }),\r\n    );\r\n  }\r\n  /**\r\n   * å¸¦éä»¶çå¤å¶\r\n   * @param id\r\n   * @param url\r\n   * @param attachmentInfoFieldPath\r\n   * @param rootId\r\n   * @param path\r\n   * @returns\r\n   */\r\n  public cloneWithAttachment(id: string, url: string, attachmentInfoFieldPath: string, rootId: string, path: string) {\r\n    if (!id) {\r\n      this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!url) {\r\n      this.formNotifyService.warning(this.languageService.pathIsRequired, { hideTitle: true });\r\n      return EMPTY;\r\n    }\r\n    if (!attachmentInfoFieldPath) {\r\n      throw new Error('éä»¶udtå­æ®µè·¯å¾ä¸è½ä¸ºç©º');\r\n    }\r\n    if (!url.startsWith('/')) {\r\n      url = '/' + url;\r\n    }\r\n    url = url.toLowerCase();\r\n    const bindingPath = this.viewModel.bindingPath;\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const baseUri = befRepository.restService.baseUri;\r\n    const uri = `${baseUri}${url}`;\r\n    const requestInfo = befRepository.restService.buildRequestInfo();\r\n    const ids = this.buildIds(bindingPath);\r\n    ids.push(id);\r\n    const body = {\r\n      requestInfo,\r\n      dataID: ids.join(',')\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    this.formLoadingService.show();\r\n    const attachmentFields = attachmentInfoFieldPath.split(',').filter((p) => p).map((path) => path.split('/').pop());\r\n    return befRepository.proxy.request(uri, 'PUT', null, options).pipe(\r\n      switchMap((responseInfo: ResponseInfo) => {\r\n        const entityData = responseInfo.returnValue;\r\n        let entity = null;\r\n        if (bindingPath.split('/').filter((p) => p).length === 0) {\r\n          entity = this.repository.buildEntity(entityData);\r\n          this.repository.entityCollection.addEntity(entity, true);\r\n        } else {\r\n          const fpath = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          entity = befRepository.entityManager.appendEntityByPath(fpath, entityData, entityData, true);\r\n        }\r\n        // å¤å¶éä»¶\r\n        return this.copyRowFiles(entity, attachmentFields, rootId, path).pipe(\r\n          switchMap(() => {\r\n            this.formLoadingService.hide();\r\n            return this.repository.updateAllChanges().pipe(map(() => {\r\n              return entity;\r\n            }));\r\n          }),\r\n          catchError((error) => {\r\n            this.formLoadingService.hide();\r\n            // æ¸ç©ºå®ä½éä»¶å±æ§\r\n            this.clearAttachmentInfo(entity, attachmentFields);\r\n            let cafError = error.error;\r\n            if (typeof cafError === 'string') {\r\n              cafError = JSON.parse(cafError);\r\n            }\r\n            if (this.formErrorService) {\r\n              this.formErrorService.exception(cafError.message || this.languageService.copyFailed, error);\r\n            }\r\n            return EMPTY;\r\n          })\r\n        );\r\n      }),\r\n    );\r\n  }\r\n  private clearAttachmentInfo(entity: Entity, attachmentFields: string[]) {\r\n    try {\r\n      attachmentFields.forEach((attachmentField: string) => {\r\n        this.setValueByPath(entity, [attachmentField, 'attachmentId'].join('.'), null);\r\n        this.setValueByPath(entity, [attachmentField, 'fileName'].join('.'), null);\r\n        this.setValueByPath(entity, [attachmentField, 'fileCreateTime'].join('.'), null);\r\n        this.setValueByPath(entity, [attachmentField, 'fileSize'].join('.'), null);\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  }\r\n  //#region æ§çå®ç°\r\n\r\n  /**\r\n   * å¤å¶è¡\r\n   * @param frameId frameId\r\n   * @param ignoreFields å¤å¶æ¶å¿½ç¥å­æ®µ\r\n   * @param repeat éå¤å¤å¶æ¬¡æ°ï¼é»è®¤ä¸º1\r\n   */\r\n  public copyRow(frameId: string, ignoreFields: string, repeat: number = 1) {\r\n    if (typeof repeat !== 'number') {\r\n      repeat = parseInt(repeat, 10);\r\n    }\r\n    if (repeat < 1) {\r\n      throw new Error('ArgumentError: repeat must >= 1');\r\n    }\r\n    // è·åå½åè¡\r\n    const frameContext = this.viewModel.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    const primaryValue = frameContext.bindingData.list.currentId;\r\n    const bindingPath = frameContext.viewModel.bindingPath || '/';\r\n    let bindingData = null;\r\n    let currentItem: BindingObject = null;\r\n    if (bindingPath === '/') {\r\n      // ä¸»è¡¨ç´æ¥åå½åè¡\r\n      currentItem = frameContext.bindingData.list.currentItem;\r\n    } else {\r\n      // åä»è¡¨/ä»ä»è¡¨å½åè¡\r\n      const paths = bindingPath.split('/').filter(p => p);\r\n      currentItem = (frameContext.bindingData.getValue(paths) as BindingList).currentItem;\r\n    }\r\n    bindingData = currentItem.toJSON();\r\n    if (!currentItem.primaryKeyValue) {\r\n      if (this.formNotifyService) {\r\n        this.formNotifyService.warning(this.languageService.plsSelectCopyData, { hideTitle: true });\r\n      }\r\n      return EMPTY;\r\n    }\r\n    const ignoreFieldsArray = ignoreFields.split(',').filter(item => item);\r\n\r\n    const sources = new Array(repeat);\r\n    return from(sources).pipe(\r\n      concatMap(() => {\r\n        let action$ = null;\r\n        if (bindingPath !== '/') {\r\n          const fullPath = this.buildPath(bindingPath, primaryValue);\r\n          action$ = this.repository.appendByPath(fullPath);\r\n        } else {\r\n          action$ = this.repository.append();\r\n        }\r\n        return action$.pipe(\r\n          tap((entity: Entity) => {\r\n            // ä¿®æ­£å®ä½ä¸»é®\r\n            bindingData[entity.primaryKey] = entity.primaryValue;\r\n            // å¿½ç¥æå®å­æ®µ\r\n            ignoreFieldsArray.forEach((field: string) => {\r\n              const extractedFields = field.split('.').filter(item => item);\r\n              if (extractedFields.length === 1) {\r\n                delete bindingData[field];\r\n              }\r\n              const parent = extractedFields.slice(0, -1).reduce((prev, current, index) => {\r\n                return prev[current];\r\n              }, bindingData);\r\n              delete parent[extractedFields[extractedFields.length - 1]];\r\n            });\r\n            bindingData = Object.assign({}, entity.toJSON(), bindingData);\r\n            entity.load(bindingData, { loadChild: false });\r\n          }),\r\n          catchError(() => {\r\n            return EMPTY;\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * å¢éå¤éå¸®å©æ¹éèµå¼å¸®å©åäºä»¶\r\n   * @param frameId frameId\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param associatedField å³èå­æ®µ\r\n   */\r\n  public afterIncrementalSelectHelpClose(frameId: string, mapFields: string, associatedField: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    // tslint:disable-next-line: max-line-length\r\n    // const mapping = '{\"id\":\"userRef.userRef\", \"name\":\"name\", \"sex\":\"sex\",\"age\":\"userRef.userRef_Age\",\"address\":\"userRef.userRef_Address\",\"birthday\":\"userRef.userRef_Birthday\",\"height\":\"userRef.userRef_Height\",\"isMarried\":\"userRef.userRef_IsMarried\"}';\r\n    if (!associatedField) {\r\n      throw new Error('associated field can`t be empty.');\r\n    }\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    const foreignKey = associatedField;\r\n    // å°éæ©äººåä¿å­å°uistateä¸­\r\n    const rootFrameContext = this.viewModel.frameContext.root;\r\n    // ä¸æ¯bindingPathåæframeIdå¤ç\r\n    let bindingPath = '/';\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      if (frameContext) {\r\n        bindingPath = frameContext.viewModel.bindingPath || '/';\r\n      } else {\r\n        throw new Error('frameId is invalid!');\r\n      }\r\n    }\r\n    // tslint:disable-next-line: no-string-literal\r\n    rootFrameContext.uiState['selections'] = result;\r\n    if (result && Array.isArray(result)) {\r\n      // æ ¹æ®bindingPathè·åbindingdataä¸­ç°ææ°æ®\r\n      const bindingPaths = bindingPath.split('/').filter(item => item);\r\n      const currentData: BindingList = this.viewModel.bindingData.getValue(bindingPaths);\r\n      const currentDataArray = currentData.toArray();\r\n      // æ¾å°resultä¸­æï¼ä½bindingDataä¸­æ²¡æçï¼ä¸ºå¾æ°å¢é¡¹\r\n      const appends = [];\r\n      result.reduce((prev: Array<any>, item) => {\r\n        const itemId = item && item[currentData.primaryKey] || null;\r\n        const isExist = currentDataArray.find((bindingObject: BindingObject) => bindingObject[foreignKey][foreignKey] === itemId);\r\n        if (!isExist) {\r\n          prev.push(item);\r\n        }\r\n        return prev;\r\n      }, appends);\r\n\r\n      // æ¾å°bindingDataä¸­æï¼resultä¸­æ²¡æçï¼ä¸ºå¾å é¤é¡¹\r\n      const removes = [];\r\n      currentDataArray.reduce((results: any, item: BindingObject) => {\r\n        const index = result.findIndex(selectItem => selectItem[currentData.primaryKey] === item[foreignKey][foreignKey]);\r\n        if (index === -1) {\r\n          results.push(item.primaryKeyValue);\r\n        }\r\n        return results;\r\n      }, removes);\r\n\r\n      // console.log('addItems', appends, 'removeItems', removes);\r\n      // è°ç¨åç«¯æ¥å£æ°å¢æ°æ®\r\n      const addAction$ = from(appends).pipe(\r\n        concatMap(item => {\r\n          const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          return this.repository.appendByPath(path).pipe(\r\n            tap((entity: Entity) => {\r\n              Object.keys(mappings).forEach(prop => {\r\n                const value = this.getValueByPath(item, prop);\r\n                const fields = mappings[prop];\r\n                const groups: any[] = fields.split(',').filter(p => p);\r\n                groups.forEach(group => {\r\n                  const paths = group.split('.').filter(p => p);\r\n                  this.setValueByPath(entity, paths.join('.'), value);\r\n                });\r\n              });\r\n            }),\r\n            catchError(() => {\r\n              return EMPTY;\r\n            })\r\n          );\r\n        })\r\n      );\r\n\r\n      const removeAction$ = from(removes).pipe(\r\n        concatMap(item => {\r\n          const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n          return this.repository.removeByPath(path, item).pipe(\r\n            tap(() => {\r\n              const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n              befRepository.entityManager.removeEntityByPath(path, item);\r\n            }),\r\n            catchError(() => {\r\n              return EMPTY;\r\n            })\r\n          );\r\n        })\r\n      );\r\n      if (!appends && !removes || appends && appends.length < 1 && removes && removes.length < 1) {\r\n        return of(true);\r\n      }\r\n      return concat(addAction$, removeAction$).pipe(\r\n        catchError(() => EMPTY)\r\n      );\r\n    }\r\n    return of(true);\r\n  }\r\n  // todo:æ¨¡æç¨æ·æä½ï¼å¾åç«¯æ¥å£æ¯æä¸»è¡¨æ¹éæ°å¢åéå\r\n  /**\r\n   * å¤éå¸®å©æ¹éèµå¼å¸®å©åäºä»¶\r\n   */\r\n  public beforeMultiSelectHelpOpen() {\r\n    return this.clearHelpSelections();\r\n  }\r\n  /**\r\n   * å¤éå¸®å©æ¹éèµå¼å¸®å©åäºä»¶\r\n   * @param frameId ç»å®è·¯å¾\r\n   * @param mapFields å­æ®µæ å°\r\n   * @param commandFrameId åè°å½ä»¤æå¨frameId\r\n   * @param commandName åè°å½ä»¤\r\n   * @deprecated æ¨¡æç¨æ·æä½ï¼å¾æ¹éèµå¼æ¯æä¸»è¡¨ååºå¼\r\n   */\r\n  public afterMultiSelectHelpClose(frameId: string, mapFields: string, commandFrameId?: string, commandName?: string) {\r\n    const self: any = this;\r\n    const result = self.context && self.context.eventParam || [];\r\n    if (result && Array.isArray(result)) {\r\n      // è°ç¨åç«¯æ¥å£æ°å¢æ°æ®\r\n      if (!result || result.length < 1) {\r\n        return of(true);\r\n      }\r\n      this.onHelpClose.next({ frameId, mapFields, data: result, commandFrameId, commandName });\r\n      return of(true);\r\n    }\r\n    return of(true);\r\n  }\r\n  /**\r\n    * å¸®å©å³é­åå¤çå¨\r\n    * @param frameId frameid\r\n    * @param mapFields mapFields\r\n    * @param result å¸®å©æ°æ®ç»æ\r\n    */\r\n  private onHelpCloseHandler(frameId: string, mapFields: string, result: any[]) {\r\n    if (!mapFields) {\r\n      throw new Error('mapFields can`t be empty.');\r\n    }\r\n    const mappings = JSON.parse(mapFields);\r\n    // ä¸æ¯bindingPathåæframeIdå¤ç\r\n    let bindingPath = '/';\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      if (frameContext) {\r\n        bindingPath = frameContext.viewModel.bindingPath || '/';\r\n      } else {\r\n        throw new Error('frameId is invalid!');\r\n      }\r\n    }\r\n    // å°éæ©äººåä¿å­å°uistateä¸­\r\n    const rootFrameContext = this.viewModel.frameContext.root;\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    // tslint:disable-next-line: no-string-literal\r\n    rootFrameContext.uiState['selections'] = result;\r\n    if (result && Array.isArray(result)) {\r\n      const addAction$ = from(result).pipe(\r\n        concatMap(item => {\r\n          const requestInfo = befRepository.restService.buildRequestInfo();\r\n          if (bindingPaths.length > 0) {\r\n            const path = this.buildPath(bindingPath, this.viewModel.bindingData.list.currentId);\r\n            return befRepository.restService.createByPath(path, requestInfo).pipe(\r\n              tap((responseInfo: ResponseInfo) => {\r\n                const data = responseInfo.returnValue;\r\n                const newEntity = befRepository.entityManager.appendEntityByPath(path, data, data);\r\n                Object.keys(mappings).forEach(prop => {\r\n                  const value = this.getValueByPath(item, prop);\r\n                  const fields = mappings[prop];\r\n                  const groups: any[] = fields.split(',').filter(p => p);\r\n                  groups.forEach(group => {\r\n                    const paths = group.split('.').filter(p => p);\r\n                    this.setValueByPath(newEntity, paths.join('.'), value);\r\n                  });\r\n                });\r\n                return newEntity;\r\n              })\r\n            );\r\n          } else {\r\n            return befRepository.restService.create(null, requestInfo).pipe(\r\n              tap((responseInfo: ResponseInfo) => {\r\n                const data = responseInfo.returnValue;\r\n                const newEntity = this.repository.buildEntity(data);\r\n                Object.keys(mappings).forEach(prop => {\r\n                  const value = this.getValueByPath(item, prop);\r\n                  const fields = mappings[prop];\r\n                  const groups: any[] = fields.split(',').filter(p => p);\r\n                  groups.forEach(group => {\r\n                    const paths = group.split('.').filter(p => p);\r\n                    this.setValueByPath(newEntity, paths.join('.'), value);\r\n                  });\r\n                });\r\n                this.repository.entityCollection.addEntity(newEntity);\r\n                return newEntity;\r\n              })\r\n            );\r\n          }\r\n        })\r\n      );\r\n      // const formLoadingService = this.injector.get<FormLoadingService>(FormLoadingService, null);\r\n      if (this.formLoadingService) {\r\n        this.suspendFrameContextEvent(frameId);\r\n        this.formLoadingService.show();\r\n        this.formLoadingService.setSuspend(true);\r\n      }\r\n      return addAction$.pipe(\r\n        last(),\r\n      ).pipe(\r\n        switchMap(() => {\r\n          const primaryValue = this.viewModel.bindingData.list.currentId;\r\n          if (primaryValue) {\r\n            return befRepository.updateChangesById(primaryValue);\r\n          } else {\r\n            return of(null);\r\n          }\r\n        })\r\n      ).subscribe(() => {\r\n        if (this.formLoadingService) {\r\n          this.resumeFrameContextEvent(frameId);\r\n          this.formLoadingService.setSuspend(false);\r\n          this.formLoadingService.hide();\r\n        }\r\n      }, () => {\r\n        if (this.formLoadingService) {\r\n          this.resumeFrameContextEvent(frameId);\r\n          this.formLoadingService.setSuspend(false);\r\n          this.formLoadingService.hide();\r\n        }\r\n      });\r\n    }\r\n    return of(null);\r\n  }\r\n  private suspendFrameContextEvent(frameId: string) {\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      frameContext.suspend = true;\r\n    }\r\n  }\r\n  private resumeFrameContextEvent(frameId: string) {\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    if (appContext) {\r\n      const frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n      frameContext.suspend = false;\r\n      frameContext.appContext.messagePipe.next('bindData');\r\n    }\r\n  }\r\n\r\n  //#endregion\r\n  private setValueByPath(target: object, path: string, value: any) {\r\n    if (target) {\r\n      const paths = path.split('.');\r\n      if (paths.length <= 1) {\r\n        target[path] = value;\r\n      } else {\r\n        paths.slice(0, -1).reduce((prev, path) => {\r\n          if (!(prev.hasOwnProperty(path) || prev['__proto__'].hasOwnProperty(path))) {\r\n            prev[path] = {};\r\n          }\r\n          return prev[path];\r\n        }, target)[paths[paths.length - 1]] = value;\r\n      }\r\n    }\r\n  }\r\n  private getValueByPath(target: object, path: string) {\r\n    const paths = path.split('.');\r\n    if (paths.length < 1) {\r\n      return;\r\n    }\r\n    if (paths.length === 1) {\r\n      return target[path];\r\n    }\r\n    let result = null;\r\n    paths.forEach((prop, index) => {\r\n      if (index === 0) {\r\n        result = target && target[prop] || null;\r\n      } else {\r\n        result = result && result[prop] || null;\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n  /**\r\n   * æé å­è¡¨è·¯å¾\r\n   * @param bindingPath ç»å®è·¯å¾\r\n   * @param id id\r\n   */\r\n  private buildPath(bindingPath: string, id: any) {\r\n    let path = '/' + id;\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = this.viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n\r\n    return path;\r\n  }\r\n  /**\r\n   * è·åç»å®è·¯å¾çå½åè¡æ°ç»\r\n   * @param bindingPath bindingPath\r\n   * @returns\r\n   */\r\n  private buildIds(bindingPath: string): string[] {\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    const primaryValue = this.viewModel.bindingData.list.currentId;\r\n    const result = [];\r\n    const paths = [];\r\n    if (bindingPaths.length > 0) {\r\n      result.push(primaryValue);\r\n      // ä»è¡¨æä»ä»è¡¨è¦å¤å¶çè¡ä¸ä¸å®æ¯å½åè¡ï¼ç¨æ·å¯ä»¥æå®\r\n      bindingPaths.pop();\r\n      bindingPaths.forEach((path: string) => {\r\n        paths.push(path);\r\n        const bindingList = this.viewModel.bindingData.getValue(paths) as BindingList;\r\n        if (bindingList) {\r\n          result.push(bindingList.currentId);\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n  private updateBindingData(input: any, ids: Array<any>) {\r\n    const { controlType = null, value = null, options = {}, dataType = null } = input || {};\r\n    if (controlType) {\r\n      // å¯¹å¸®å©åç¹æ®å¤ç\r\n      if (controlType === 'lookup' || controlType === 'combo-lookup') {\r\n        const mapFields = options.mapFields;\r\n        this.updateLookupField(ids, value, mapFields);\r\n      } else {\r\n        this.updateSimpleField(ids, value, input);\r\n      }\r\n    }\r\n  }\r\n  private updateSimpleField(ids: Array<any>, value: any, column: any) {\r\n    if (!column) {\r\n      return;\r\n    }\r\n    const currentColumnType = column.dataType;\r\n    // å­å¨è¡ç¼è¾å¨\r\n    let result = value;\r\n    if (currentColumnType === 'date') {\r\n      let dateStr = this.dateService.formatTo(value, 'yyyy-MM-dd');\r\n      if (!dateStr) {\r\n        dateStr = '0001-01-01T00:00:00';\r\n      }\r\n      result = dateStr;\r\n    } else if (currentColumnType === 'number') {\r\n      result = Number(value) || 0;\r\n    }\r\n    const field = column.field;\r\n    ids.forEach(id => {\r\n      this.updateBindingList(id, field, result);\r\n    });\r\n  }\r\n  private updateLookupField(ids: Array<any>, helpData: any, mapFields: any) {\r\n    if (!mapFields) {\r\n      return;\r\n    }\r\n    let helpFields = Object.keys(mapFields);\r\n    const idIndex = helpFields.findIndex(item => item === 'id');\r\n    if (helpFields.includes('id') && idIndex !== 0) {\r\n      helpFields.splice(idIndex, 1);\r\n      helpFields = ['id', ...helpFields];\r\n    }\r\n    if (!helpData) {\r\n      helpFields.reverse();\r\n    }\r\n    helpFields.forEach((helpField: any) => {\r\n      let helpValue: any = '';\r\n      if (helpData) {\r\n        if (helpData instanceof Array) {\r\n          helpValue = helpData.map((item: any) => {\r\n            return this.getValue(helpField, item);\r\n          }).join(',');\r\n        } else {\r\n          helpValue = this.getValue(helpField, helpData);\r\n        }\r\n      }\r\n      ids.forEach(id => {\r\n        this.updateBindingList(id, mapFields[helpField], helpValue);\r\n      });\r\n    });\r\n  }\r\n  private updateBindingList(primaryValue: any, propertyName: string, value: any) {\r\n    const viewModel = this.viewModel || null;\r\n    if (!viewModel || !propertyName) {\r\n      return;\r\n    }\r\n    // æ´æ°ä¸»è¡¨é¨åè¡çå­æ®µ\r\n    const propertyNames = propertyName.split('.').filter(item => item);\r\n    const bindingObject = this.bindingList.findById(primaryValue);\r\n\r\n    if (propertyNames.length < 2) {\r\n      bindingObject.setValue(propertyName, value, true, true);\r\n    } else {\r\n      let targetBindingObject = null;\r\n      const fpaths = propertyNames.slice(0, propertyNames.length - 1);\r\n      const targetPropertyName = propertyNames[propertyNames.length - 1];\r\n      fpaths.forEach(prop => {\r\n        targetBindingObject = targetBindingObject && targetBindingObject[prop] || bindingObject[prop];\r\n      });\r\n      // todo:éè¦æ·»å å¼ååäºä»¶\r\n      targetBindingObject.setValue(targetPropertyName, value, true, true);\r\n    }\r\n  }\r\n  private getBindingPathArray(): any[] {\r\n    const path = this.viewModel.bindingPath;\r\n    if (path) {\r\n      return path.split('/').filter(n => n !== '');\r\n    }\r\n    return [];\r\n  }\r\n  private getValue(f: string, data: any) {\r\n    let val = '';\r\n    if (f.indexOf('.') === -1) {\r\n      val = data[f];\r\n    } else {\r\n      val = f.split('.').reduce((a, b) => {\r\n        return a[b];\r\n      }, data);\r\n    }\r\n\r\n    return val;\r\n  }\r\n  protected get bindingList(): BindingList {\r\n    // æ ¹å®ä½\r\n    if (this.viewModel.bindingPath === '/' || !this.viewModel.bindingPath) {\r\n      return this.viewModel.bindingData.list;\r\n    }\r\n    // å­å®ä½\r\n    let bindingPath = this.viewModel.bindingPath.substr(1);\r\n    bindingPath = bindingPath[0].toLowerCase() + bindingPath.substring(1, bindingPath.length);\r\n    const paths = bindingPath.split('/');\r\n\r\n    const filteredPaths = paths.filter((part: string) => {\r\n      return part !== '';\r\n    });\r\n    return this.viewModel.bindingData.getValue(filteredPaths);\r\n  }\r\n  /**\r\n   * æ ¹æ®æ å°å°æ°æ®èµå¼ç»bindingData\r\n   * @param data\r\n   * @param mapFields\r\n   * @param bindingData\r\n   */\r\n  private mappingRow(data: any, mapFields: any, entity: Entity, bindingPath: string) {\r\n    Object.keys(mapFields).forEach((prop: string) => {\r\n      const value = this.getValueByPath(data, prop);\r\n      const fields = mapFields[prop];\r\n      const groups: any[] = fields.split(',').filter(p => p);\r\n      groups.forEach(group => {\r\n        const paths = group.split('.').filter(p => p);\r\n        this.setValueByPath(entity, paths.join('.'), value);\r\n      });\r\n    });\r\n  }\r\n  /**\r\n   * éè¿frameIdè·åå¯¹åºçç»ä»¶ä¸ä¸æ\r\n   * @param frameId frameId\r\n   * @returns\r\n   */\r\n  private getFrameContextById(frameId: string): FrameContext | null {\r\n    if (!frameId) {\r\n      return null;\r\n    }\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    let frameContext: FrameContext = null;\r\n    if (appContext) {\r\n      frameContext = appContext.frameContextManager.getFrameContextById(frameId);\r\n    }\r\n    return frameContext;\r\n  }\r\n  private getEntityByPath(frameContext: FrameContext, bindingPaths: any[], currentId: string) {\r\n    bindingPaths = [...bindingPaths];\r\n    const id = frameContext.bindingData.list.currentId;\r\n    const entity: Entity = frameContext.repository.entityCollection.getEntityById(id) as Entity;\r\n    let item: Entity = entity;\r\n    const paths = [];\r\n    const tailPath = bindingPaths.pop();\r\n    const parent = bindingPaths.reduce((object: Entity, path: string) => {\r\n      paths.push(path);\r\n      if (object && (object.hasOwnProperty(path) || object['__proto__'].hasOwnProperty(path))) {\r\n        const value = object[path];\r\n        if (value && value instanceof EntityList) {\r\n          const bindingList = frameContext.bindingData.getValue(paths) as BindingList;\r\n          const currentItemId = bindingList.currentId;\r\n          return value.get(currentItemId);\r\n        } else {\r\n          return value;\r\n        }\r\n      } else {\r\n        return null;\r\n      }\r\n    }, item);\r\n    if (parent instanceof Entity) {\r\n      const list = parent[tailPath] as EntityList<any>;\r\n      if (list) {\r\n        return list.get(currentId);\r\n      } else {\r\n        throw new Error(`æ æçbindingPath.`);\r\n      }\r\n    } else {\r\n      throw new Error(`æ æçbindingPath.`);\r\n    }\r\n  }\r\n  private endEdit(frameContext: FrameContext) {\r\n    const appContext: AppContext = frameContext && frameContext.getFormAppContext();\r\n    return of(null).pipe(\r\n      tap(() => {\r\n        if (appContext) {\r\n          appContext.messagePipe.next({ type: 'endEdit' });\r\n        }\r\n      }),\r\n      // todo: ä¸åºè¯¥ä½¿ç¨delayï¼åºè¯¥ä¸²æµ\r\n      delay(5)\r\n    );\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { FrameContext, Entity } from '@farris/devkit';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FormLoadingService } from './form-loading/form-loading.service';\r\nimport { RuntimeFrameworkService } from './rtf-service';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Observable, of, EMPTY } from 'rxjs';\r\nimport { BasePathService } from '@farris/rtf';\r\n// tslint:disable: max-line-length\r\n@Injectable()\r\nexport class DiscussionGroupService {\r\n  /**\r\n   * å®ä½ä»åº\r\n   */\r\n  private get repository(): BefRepository<Entity> {\r\n    return this.frameContext.repository as BefRepository<Entity>;\r\n  }\r\n  /**\r\n   * å½ä»¤åæ°\r\n   */\r\n  private get params() {\r\n    return this['context'] && this['context']['eventParam'] || {};\r\n  }\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private loadingService: FormLoadingService, private runtimeFrameworkService: RuntimeFrameworkService) {\r\n  }\r\n\r\n  public addComment(id?: string, summary?: string, configId?: string, text?: string, visibility?: string, parentId?: string): Observable<any> {\r\n    id = id || this.frameContext && this.frameContext.bindingData.list.currentId || null;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n    const params = this.buildAddCommentParam(id, text, parentId, summary, visibility, configId);\r\n    const restService = this.repository.restService;\r\n    const url = BasePathService.convertPath('/api/runtime/comment/v1.0/bill-comment/comment');\r\n    const requestInfo = restService.buildRequestInfo();\r\n    const options = {\r\n      body: {\r\n        requestInfo,\r\n        ...params\r\n      }\r\n    };\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'POST', null, options).pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢è¯è®º\r\n   * @param id id\r\n   */\r\n  public queryComments(id: string, configId: string, pageIndex?: number | null, pageSize?: number | null): Observable<any> {\r\n    id = id || this.frameContext && this.frameContext.bindingData.list.currentId || null;\r\n    if (!id) {\r\n      return EMPTY;\r\n    }\r\n\r\n    const restService = this.repository.restService;\r\n\r\n    const url = this.buildQueryCommentsUrl(id, pageIndex, pageSize, configId);\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢ææé¨é¨ä¿¡æ¯\r\n   */\r\n  public queryAllOrgs() {\r\n    const restService = this.repository.restService;\r\n    const url = BasePathService.convertPath('/api/runtime/sys/v1.0/sysOrgs?param={\"layer\":\"1\"}');\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ¥è¯¢å¸¸ç¨@ç¨æ·\r\n   * @param pageIndex\r\n   * @param pageSize\r\n   */\r\n  public queryFrequentAtUsers(pageIndex?: number | null, pageSize?: number | null) {\r\n    const restService = this.repository.restService;\r\n    const url = this.buildQueryFrequentAtUsersUrl(pageIndex, pageSize);\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * è·åatç¨æ·åè¡¨\r\n   * @param user ç¨æ·ç¼å·æèç¨æ·åç§°ï¼è¿æ»¤ä½¿ç¨ï¼\r\n   * @param pageIndex pageIndex\r\n   * @param pageSize pageSize\r\n   */\r\n  public queryAtUsers(user?: string, pageIndex?: number | null, pageSize?: number | null) {\r\n    const restService = this.repository.restService;\r\n    const url = this.buildQueryAtUsersUrl(user, pageIndex, pageSize);\r\n    this.loadingService.show();\r\n    return restService.invoke(url, 'GET').pipe(\r\n      tap(() => {\r\n        this.loadingService.hide();\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æé è·åè¯è®ºåè¡¨çurl\r\n   * @param id id\r\n   */\r\n  private buildQueryCommentsUrl(id: string, pageIndex: number | null, pageSize: number | null, configId: string) {\r\n    if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n      pageIndex = this.params.pageIndex || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined' || pageSize === null) {\r\n      pageSize = this.params.pageSize || 10;\r\n    }\r\n    const serverUri = this.repository.serverUri;\r\n    // const funcId = this.runtimeFrameworkService && this.runtimeFrameworkService.funcId || '';\r\n    return BasePathService.convertPath(`/api/runtime/comment/v1.0/bill-comment/comment/byBill?configId=${configId}&billId=${id}&pageSize=${pageSize}&pageIndex=${pageIndex}`);\r\n  }\r\n  /**\r\n   * æé è·å@ç¨æ·url\r\n   */\r\n  private buildQueryAtUsersUrl(user?: string, pageIndex?: number | null, pageSize?: number | null) {\r\n    const params: string[] = [];\r\n    if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n      pageIndex = this.params.pageIndex || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined' || pageSize === null) {\r\n      pageSize = this.params.pageSize || 1000;\r\n    }\r\n    if (user) {\r\n      params.push(`param=${user}`);\r\n    }\r\n    params.push(`pageSize=${pageSize}`);\r\n    params.push(`pageIndex=${pageIndex}`);\r\n    return BasePathService.convertPath(`/api/runtime/comment/v1.0/bill-comment/atUser?${params.join('&')}`);\r\n  }\r\n  private buildQueryFrequentAtUsersUrl(pageIndex?: number | null, pageSize?: number | null) {\r\n    const params: string[] = [];\r\n    if (typeof pageIndex === 'undefined' || pageIndex === null) {\r\n      pageIndex = this.params.pageIndex || 0;\r\n    }\r\n    if (typeof pageSize === 'undefined' || pageSize === null) {\r\n      pageSize = this.params.pageSize || 6;\r\n    }\r\n    params.push(`pageSize=${pageSize}`);\r\n    params.push(`pageIndex=${pageIndex}`);\r\n    return BasePathService.convertPath(`/api/runtime/comment/v1.0/bill-comment/frequentAtUsers?${params.join('&')}`);\r\n  }\r\n  private buildAddCommentParam(id: string, text: string, parentId: string, summary: string, visibility: string, configId: string) {\r\n    if (typeof text === 'undefined') {\r\n      text = this.params.text;\r\n    }\r\n    if (typeof parentId === 'undefined') {\r\n      parentId = this.params.parentId;\r\n    }\r\n    if (typeof visibility === 'undefined') {\r\n      visibility = this.params.visibility;\r\n    }\r\n    return {\r\n      'bill': {\r\n        'billId': id,\r\n        'configId': configId,\r\n        'summary': summary\r\n      },\r\n      'comment': {\r\n        'billId': id,\r\n        'configId': configId,\r\n        'parentId': parentId || null,\r\n        'text': text,\r\n        'visibility': visibility\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { FrameContext } from '@farris/devkit';\r\nimport { ListFilterHandler, QueryCondition } from '@farris/ui-list-filter';\r\n\r\n@Injectable()\r\nexport class ListFilterConditionsService implements ListFilterHandler {\r\n\r\n    constructor(private frameContext: FrameContext) { }\r\n\r\n    public setCurrentFilterConditions(conditions: QueryCondition[]): void {\r\n        this.frameContext.uiState['currentFilterConditions'] = conditions;\r\n    }\r\n\r\n}\r\n","import { HttpClient } from \"@angular/common/http\";\r\nimport { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { Observable } from \"rxjs\";\r\nimport { FORM_PATH_TOKEN, FormManifest, IFormManifestService } from \"@farris/devkit\";\r\nimport { share } from \"rxjs/operators\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FormManifestService implements IFormManifestService {\r\n  private static mainfests = new Map<string, Observable<FormManifest>>();\r\n  constructor(\r\n    private injector: Injector,\r\n    @Inject(FORM_PATH_TOKEN) private modulePath,\r\n    private httpClient: HttpClient\r\n  ) { }\r\n  public load(): Observable<FormManifest> {\r\n    if (this.modulePath.endsWith('\\/')) {\r\n      this.modulePath = this.modulePath.substring(0, this.modulePath.length - 1);\r\n    }\r\n    const formManifestPath = BasePathService.convertPath(`${this.modulePath}/expressions/form.manifest.json?version=${new Date().valueOf().toString()}`);\r\n    const request$ = FormManifestService.mainfests.get(this.modulePath);\r\n    if (request$) {\r\n      return request$;\r\n    } else {\r\n      const req$ = this.httpClient.get<FormManifest>(formManifestPath, { responseType: 'json' }).pipe(share());\r\n      FormManifestService.mainfests.set(this.modulePath, req$);\r\n      return req$;\r\n    }\r\n  }\r\n}\r\n","import { HttpClient } from \"@angular/common/http\";\r\nimport { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { Observable, of } from \"rxjs\";\r\nimport { share, switchMap } from \"rxjs/operators\";\r\nimport { FORM_PATH_TOKEN, FrameContext, FormExpressionsManifest, FormManifest, IFormExpressionManifestService, FORM_MANIFEST_SERVICE_TOKEN, IFormManifestService } from \"@farris/devkit\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FormExpressionManifestService implements IFormExpressionManifestService {\r\n  private static mainfests = new Map<string, Observable<any>>();\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    private httpClient: HttpClient,\r\n    @Inject(FORM_PATH_TOKEN) private modulePath,\r\n    @Inject(FORM_MANIFEST_SERVICE_TOKEN) private formManifestService: IFormManifestService) { }\r\n\r\n  public load(): Observable<any> {\r\n    if (this.modulePath.endsWith('\\/')) {\r\n      this.modulePath = this.modulePath.substring(0, this.modulePath.length - 1);\r\n    }\r\n\r\n    return this.formManifestService.load().pipe(\r\n      switchMap((formManifest: FormManifest) => {\r\n        const expressions = formManifest.expressions;\r\n        const expressionManifest = expressions.find((expressionManifest: FormExpressionsManifest) => expressionManifest.ns === this.frameContext.namespace);\r\n        if (expressionManifest) {\r\n          const expressionPath = BasePathService.convertPath(`${this.modulePath}/expressions/${expressionManifest.path}?version=${new Date().valueOf().toString()}`);\r\n          const key = BasePathService.convertPath(`${this.modulePath}/expressions/${expressionManifest.path}`);\r\n          const request$ = FormExpressionManifestService.mainfests.get(key);\r\n          if (request$) {\r\n            return request$;\r\n          } else {\r\n            const req$ = this.httpClient.get(expressionPath, { responseType: 'json' }).pipe(share());\r\n            FormExpressionManifestService.mainfests.set(key, req$);\r\n            return req$;\r\n          }\r\n        } else {\r\n          return of({});\r\n        }\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Inject, Injectable, Injector } from \"@angular/core\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport moment from 'moment';\r\nimport { NumberFormat, UserSettings, UserSettingsToken } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class LocalizationService {\r\n  constructor(private injector: Injector, @Inject(UserSettingsToken) private userSettings: UserSettings) { }\r\n\r\n  /**\r\n   * ç¨æ·éç½®æ ¼å¼\r\n   */\r\n  public get formats(): { date: { dateFormat: string, timeFormat: string, dateTimeFormat: string }, number: { negativeSign: string, numberDecimalDigits: number, numberDecimalSeparator: string, numberGroupSeparator: string }, [prop: string]: any } {\r\n    const { dateFormat = null, timeFormat = null } = this.userSettings || {};\r\n    let dateTimeFormat = null;\r\n    if (dateFormat && timeFormat) {\r\n      dateTimeFormat = `${dateFormat} ${timeFormat}`;\r\n    }\r\n    const date = {\r\n      dateFormat,\r\n      timeFormat,\r\n      dateTimeFormat\r\n    };\r\n    const { negativeSign = null, numberDecimalDigits = null, numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat || {};\r\n    const number = {\r\n      negativeSign,\r\n      numberDecimalDigits,\r\n      numberDecimalSeparator,\r\n      numberGroupSeparator\r\n    };\r\n    return { date, number };\r\n  }\r\n  /**\r\n   * æ ¹æ®æ°æ®ç±»åæ¬å°åæ°æ®\r\n   * @param value value\r\n   * @param dataType æ°æ®ç±»å\r\n   * @returns string\r\n   */\r\n  public localize(value: any, dataType: string): string {\r\n    if (dataType && value) {\r\n      dataType = dataType.toLowerCase();\r\n      if (dataType === 'date') {\r\n        return this.transformDate(value);\r\n      } else if (dataType === 'datetime') {\r\n        return this.transformDateTime(value);\r\n      } else if (dataType === 'number') {\r\n        return this.transformNumber(value);\r\n      } else {\r\n        return value;\r\n      }\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n  /**\r\n   * æ ¹æ®å½éåç±»åè·åæ ¼å¼åå­ç¬¦ä¸²\r\n   * @param localizationType å½éåç±»å\r\n   * @returns \r\n   */\r\n  public getFormat(localizationType: string): string {\r\n    if (localizationType) {\r\n      localizationType = localizationType.toLowerCase();\r\n    }\r\n    if (localizationType === 'date') {\r\n      return this.formats.date.dateFormat;\r\n    } else if (localizationType === 'datetime') {\r\n      return this.formats.date.dateTimeFormat;\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥æ\r\n   * @param value value\r\n   */\r\n  private transformDate(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    if (!dateFormat || !value) {\r\n      return value;\r\n    }\r\n    const date = moment(value);\r\n    const isValid = date.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    dateFormat = this.parseDateFormat(dateFormat);\r\n    return date.format(dateFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ¶é´\r\n   * @param value value\r\n   * todo: ç®åæ æ³å®ä¹æ¥ææ¶é´æ ¼å¼\r\n   */\r\n  private transformDateTime(value: any) {\r\n    let dateFormat = this.userSettings && this.userSettings.dateFormat || 'YYYY-MM-DD';\r\n    let timeFormat = this.userSettings && this.userSettings.timeFormat || 'HH:mm:ss';\r\n    if (!dateFormat || !timeFormat) {\r\n      return value;\r\n    }\r\n    const dateTime = moment(value);\r\n    const isValid = dateTime.isValid();\r\n    if (!isValid) {\r\n      return value;\r\n    }\r\n    if (dateFormat) {\r\n      dateFormat = this.parseDateFormat(dateFormat);\r\n    }\r\n    if (timeFormat) {\r\n      timeFormat = this.parseTimeFormat(timeFormat);\r\n    }\r\n    const dateTimeFormat = dateFormat + ' ' + timeFormat;\r\n    return dateTime.format(dateTimeFormat);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ°å­\r\n   * @param value value\r\n   */\r\n  private transformNumber(value): string {\r\n    if (value === null || value === undefined || value === '') {\r\n      return '';\r\n    }\r\n    const bigNumber = new BigNumber(value);\r\n    // å¦æä¸æ¯æ°å­ï¼ä¸åä»»ä½å¤ç\r\n    if (!BigNumber.isBigNumber(bigNumber)) {\r\n      return value;\r\n    }\r\n    const isNegative = bigNumber.isNegative();\r\n    const format = this.buildNumberFormat();\r\n    const { negativeSign = null, numberDecimalDigits = null } = this.numberFormat || {};\r\n    if (isNegative) {\r\n      if (negativeSign !== null) {\r\n        format.prefix = negativeSign;\r\n        return bigNumber.absoluteValue().toFormat(numberDecimalDigits, null, format);\r\n      }\r\n    }\r\n    return bigNumber.toFormat(numberDecimalDigits, null, format);\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¥ææ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseDateFormat(format: string) {\r\n    return format.replace(/y/g, 'Y').replace(/d/g, 'D');\r\n  }\r\n  /**\r\n   * è½¬æ¢æ¶é´æ ¼å¼è§åä¸ºmomentçformatè§å\r\n   * @param format format\r\n   */\r\n  private parseTimeFormat(format: string) {\r\n    return format.replace(/M/g, 'm');\r\n  }\r\n  /**\r\n   * æé bignumberæ°å­æ ¼å¼åéé¡¹\r\n   */\r\n  private buildNumberFormat() {\r\n    if (this.numberFormat) {\r\n      const { numberDecimalSeparator = null, numberGroupSeparator = null } = this.numberFormat;\r\n      const format: any = {\r\n        groupSize: 3,\r\n      };\r\n      if (numberDecimalSeparator !== null) {\r\n        format.decimalSeparator = numberDecimalSeparator;\r\n      }\r\n      if (numberGroupSeparator !== null) {\r\n        format.groupSeparator = numberGroupSeparator;\r\n      }\r\n      return format;\r\n    }\r\n  }\r\n  private get numberFormat(): NumberFormat {\r\n    return this.userSettings && this.userSettings.numberFormat || null;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\nimport { EMPTY } from \"rxjs\";\r\nimport { AttentionService, AttentionElement } from '@farris/ui-tooltip';\r\n\r\n\r\n@Injectable()\r\nexport class FormAttentionService {\r\n  constructor(private injector: Injector, private frameContext: FrameContext, private attentionService: AttentionService) { }\r\n  /**\r\n   * éªçæé®\r\n   * @param ids idå­ç¬¦ä¸²ææ°ç»\r\n   * @param duration æ¶é´é´é\r\n   * @returns \r\n   */\r\n  public blink(ids: string | string[], duration?: any) {\r\n    if (typeof ids === 'string') {\r\n      ids = ids.split(',').filter(p => p);\r\n    }\r\n    if (!Array.isArray(ids) || ids.length < 1) {\r\n      return EMPTY;\r\n    }\r\n    if (typeof duration === 'string') {\r\n      duration = duration.trim();\r\n    }\r\n    if (!duration) {\r\n      duration = 600;\r\n    }\r\n    duration = parseInt(duration);\r\n    if (isNaN(duration) || duration <= 0) {\r\n      duration = 600;\r\n    }\r\n    const elements: AttentionElement[] = ids.map((item: string) => {\r\n      return {\r\n        idOrEl: item,\r\n        // type:'',\r\n        // class:''\r\n      };\r\n    });\r\n    this.attentionService.catchAttention(elements, duration);\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { BefRepository, ResponseInfo } from \"@farris/bef\";\r\nimport { Repository } from '@farris/devkit';\r\nimport { Observable } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\nimport { Prop } from \"./types\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FeatureRepository {\r\n  constructor(\r\n    private injector: Injector,\r\n    private repository: Repository<any>,\r\n  ) { }\r\n  /**\r\n   * æ ¹æ®ç©æidè·åç©æç¹å¾é¡¹åç¹å¾å¼ï¼å¬å±é»è®¤å¼ï¼\r\n   * @param materialId ç©æid\r\n   */\r\n  public getFeaturesByMaterialId(materialId: string): Observable<ResponseInfo> {\r\n    const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/getmaterialprops');\r\n    const body = {\r\n      materialID: materialId\r\n    };\r\n    const options = {\r\n      body\r\n    };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    return befRepository.proxy.request(url, 'put', null, options);\r\n  }\r\n  /**\r\n   * æ ¹æ®ç©æidåç©æç¹å¾ä¿å­åçhashè·åè¯¥ç©æå·²ç»å­å¨çç¹å¾é¡¹å¼\r\n   * @param materialId ç©æId\r\n   * @param configID å¯¹åºè¯¥ç©æçç¹å¾é¡¹hash\r\n   * @returns\r\n   */\r\n  public getConfigedValueByFeatureId(materialId: string, configID: string, configType: string = 'Materials'): Observable<ResponseInfo> {\r\n    const url = BasePathService.convertPath('/api/bf/df/v1.0/charactconfigservice/service/getcharactconfiginfo');\r\n    const body = { objType: configType, objID: materialId, configID };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(url, 'put', null, options);\r\n  }\r\n  /**\r\n   * ä¿å­ç©æç¹å¾é¡¹\r\n   * @param materialId ç©æid\r\n   * @param charactValue ç¹å¾å¼\r\n   * @param configType éç½®ç±»å\r\n   * @returns\r\n   */\r\n  public applyFeatures(materialId: string, charactValue: any, configType: string = 'Materials') {\r\n    const body = { objType: configType, objID: materialId, charactValue };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(BasePathService.convertPath('/api/bf/df/v1.0/charactconfigservice/service/matchcharactconfigid'), 'put', null, options);\r\n  }\r\n  /**\r\n   * è·åå¸®å©ä¿¡æ¯\r\n   * @param helpid å¸®å©id\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param params åæ°\r\n   * @returns\r\n   */\r\n  public getHelpInfo(helpid: string, filter: string, params: any): Observable<any> {\r\n    const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata');\r\n    const httpParams: any = {};\r\n    if (params) {\r\n      if (params.pageIndex) {\r\n        httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);\r\n      }\r\n      if (params.pageSize) {\r\n        httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);\r\n      }\r\n      if (params.condition) {\r\n        httpParams['condition'] = JSON.stringify(params.condition);\r\n      }\r\n      if (params.searchValue) {\r\n        httpParams['search'] = params.searchValue;\r\n      }\r\n    }\r\n    const body = {\r\n      helpID: helpid,\r\n      queryParam: JSON.stringify(httpParams),\r\n      filterStr: filter\r\n    };\r\n    const befRepository: BefRepository<any> = this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(url, 'put', null, options);\r\n  }\r\n}\r\n","export namespace Prop {\r\n  /**\r\n   * ç¹å¾é\r\n   */\r\n  export interface IPropSet {\r\n    id: string;\r\n    /**\r\n     * ç¹å¾éç¼å·\r\n     */\r\n    code: string;\r\n    /**\r\n     * å¨æå­æ®µï¼è¿åå¼ä¸­ä¸å­å¨ï¼ç¨äºå±ç¤ºå½åè¯­è¨çææ¬\r\n     */\r\n    name?: string;\r\n    /**\r\n     * ç¹å¾éåç§°-è±æ\r\n     */\r\n    name_en: string;\r\n    /**\r\n     * ç¹å¾éåç§°-ç®ä½\r\n     */\r\n    name_chs: string;\r\n    /**\r\n     * ç¹å¾éåç§°-ç¹ä½\r\n     */\r\n    name_cht: string;\r\n  }\r\n  /**\r\n   * ç¹å¾é¡¹\r\n   */\r\n  export interface IProp {\r\n    /**\r\n     * ç¹å¾é¡¹id\r\n     */\r\n    id: string;\r\n    /**\r\n     * ç¹å¾é¡¹ç¼å·\r\n     */\r\n    code: string;\r\n    /**\r\n     * ç¼å·å­æ®µï¼æä¸ä½¿ç¨ï¼\r\n     */\r\n    codefield: string;\r\n    /**\r\n     * å¨æå­æ®µ\r\n     */\r\n    name?: string;\r\n    /**\r\n     * ç¹å¾é¡¹åç§°-è±æ\r\n     */\r\n    name_en: string;\r\n    /**\r\n     * ç¹å¾é¡¹ç¼å·-ç®ä½\r\n     */\r\n    name_chs: string;\r\n    /**\r\n     * ç¹å¾é¡¹ç¼å·-ç¹ä½\r\n     */\r\n    name_cht: string;\r\n    /**\r\n     * ç¹å¾å¼\r\n     */\r\n    value: any;\r\n    /**\r\n     * å¼å­æ®µ\r\n     */\r\n    valuefield: string;\r\n    /**\r\n     * ç¹å¾é¡¹å¯¹åºçè¾å¥æ§ä»¶ç±»å\r\n     */\r\n    inputtype: string;\r\n    /**\r\n     * æ°å­ç²¾åº¦\r\n     */\r\n    digitalaccuracy: number;\r\n    /**\r\n     * ç¹å¾éid\r\n     */\r\n    setid: string;\r\n    helpid: string;\r\n    /**\r\n     * æä¸¾æ°æ®æº\r\n     * @attention æ¥å£è¿åç»æä¸ºå­ç¬¦ä¸²\r\n     */\r\n    enuminfo: string;\r\n    /**\r\n     * æä¸¾æ°æ®æº\r\n     */\r\n    data: IEnumInfo[];\r\n    /**\r\n     * æ åä»£ç éæ¯å¦ä¸ºæ \r\n     */\r\n    setistree: string;\r\n    /**\r\n     * æ åä»£ç éid\r\n     */\r\n    codesetid: string;\r\n    /**\r\n     * ææ¬å­æ®µ\r\n     */\r\n    textfield: string;\r\n    /**\r\n     * è¿æ»¤æ¡ä»¶\r\n     */\r\n    filtercondition: any;\r\n    /**\r\n     * å¿å¡«\r\n     */\r\n    isrequired: string | boolean;\r\n    /**\r\n     * åªè¯»\r\n     */\r\n    isreadonly: string | boolean;\r\n    /**\r\n     * æåº\r\n     */\r\n    sortorder: number;\r\n\r\n    timestamp_createdon: string;\r\n    timestamp_lastchangedon: string;\r\n\r\n    timestamp_createdby: string;\r\n    timestamp_lastchangedby: string;\r\n\r\n  }\r\n  /**\r\n   * æä¸¾æ°æ®æºæ ¼å¼\r\n   */\r\n  export interface IEnumInfo {\r\n    id: string;\r\n    text: string;\r\n  }\r\n  export interface IReturnValue {\r\n    propset: IPropSet[],\r\n    props: IProp[]\r\n  }\r\n  export enum InputType {\r\n    enum = 'Enum',\r\n    string = 'String',\r\n    help = 'Help',\r\n    number = 'Number',\r\n    date = 'Date'\r\n  }\r\n}\r\n","import { Inject, Injectable, Injector, LOCALE_ID, Optional } from \"@angular/core\";\r\nimport { BefRepository, ResponseInfo } from \"@farris/bef\";\r\nimport { FrameContext, RestfulService, Repository } from '@farris/devkit';\r\nimport { Observable } from \"rxjs\";\r\nimport { map } from \"rxjs/operators\";\r\nimport { FeatureRepository } from \"./feature-repository\";\r\nimport { Prop } from \"./types\";\r\nimport { BasePathService } from \"@farris/rtf\";\r\n\r\n@Injectable()\r\nexport class FeatureDataService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private repository: FeatureRepository,\r\n    @Optional() @Inject(LOCALE_ID) private localeId?: string\r\n  ) {\r\n    this.localeId = this.localeId || 'zh-CHS';\r\n  }\r\n  /**\r\n   * æ ¹æ®ç©æidè·åç©æç¹å¾é¡¹åç¹å¾å¼ï¼å¬å±é»è®¤å¼ï¼\r\n   * @param materialId ç©æid\r\n   */\r\n  public getFeaturesByMaterialId(materialId: string): Observable<Prop.IReturnValue> {\r\n    return this.repository.getFeaturesByMaterialId(materialId).pipe(\r\n      map((response: ResponseInfo) => {\r\n        if (!response || !response.returnValue) {\r\n          return null;\r\n        }\r\n        const returnValue = JSON.parse(response.returnValue);\r\n        const result: Prop.IReturnValue = { propset: [], props: [] };\r\n        const propsets = returnValue.propset || null;\r\n        const props = returnValue.props || null;\r\n        if (propsets && Array.isArray(propsets)) {\r\n          propsets.map((propset: Prop.IPropSet) => {\r\n            propset.name = this.translateName(propset);\r\n            return propset;\r\n          });\r\n          result.propset = propsets;\r\n        }\r\n        if (props && Array.isArray(props) && props.length > 0) {\r\n          props.map((prop: Prop.IProp) => {\r\n            // å¤çå¤è¯­\r\n            prop.name = this.translateName(prop);\r\n            // å¤çæä¸¾\r\n            if (prop.inputtype === Prop.InputType.enum && prop.enuminfo) {\r\n              prop.data = JSON.parse(prop.enuminfo);\r\n            }\r\n            // å¤çå¿å¡«ååªè¯»\r\n            prop.isreadonly = prop.isreadonly === '1' ? true : false;\r\n            prop.isrequired = prop.isrequired === '1' ? true : false;\r\n            return prop;\r\n          });\r\n          result.props = props;\r\n        }\r\n        return result;\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æ ¹æ®ç©æidåç©æç¹å¾ä¿å­åçhashè·åè¯¥ç©æå·²ç»å­å¨çç¹å¾é¡¹å¼\r\n   * @param materialId ç©æId\r\n   * @param configID å¯¹åºè¯¥ç©æçç¹å¾é¡¹hash\r\n   * @returns\r\n   */\r\n  public getConfigedValueByFeatureId(materialId: string, configID: string, configType: string = 'Materials'): Observable<any> {\r\n    return this.repository.getConfigedValueByFeatureId(materialId, configID, configType).pipe(map((result: any) => {\r\n      return JSON.parse(result);\r\n    }));\r\n  }\r\n  /**\r\n   * ä¿å­ç©æç¹å¾é¡¹\r\n   * @param materialId ç©æid\r\n   * @param charactValue ç¹å¾å¼\r\n   * @param configType éç½®ç±»å\r\n   * @returns\r\n   */\r\n  public applyFeatures(materialId: string, charactValue: any, configType: string = 'Materials') {\r\n    return this.repository.applyFeatures(materialId, charactValue, configType).pipe(map((config: any) => {\r\n      return JSON.parse(config);\r\n    }));\r\n  }\r\n  /**\r\n   * è·åå¸®å©ä¿¡æ¯\r\n   * @param helpid å¸®å©id\r\n   * @param filter è¿æ»¤æ¡ä»¶\r\n   * @param params åæ°\r\n   * @returns\r\n   */\r\n  public getHelpInfo(helpid: string, filter: string, params: any): Observable<any> {\r\n    const url = BasePathService.convertPath('/api/scm/scmfnd/v1.0/scmcommoncmpservice/service/gethelpdata');\r\n    const httpParams: any = {};\r\n    if (params) {\r\n      if (params.pageIndex) {\r\n        httpParams['pageIndex'] = JSON.stringify(params.pageIndex - 0);\r\n      }\r\n      if (params.pageSize) {\r\n        httpParams['pageSize'] = JSON.stringify(params.pageSize - 0);\r\n      }\r\n      if (params.condition) {\r\n        httpParams['condition'] = JSON.stringify(params.condition);\r\n      }\r\n      if (params.searchValue) {\r\n        httpParams['search'] = params.searchValue;\r\n      }\r\n    }\r\n    const body = {\r\n      helpID: helpid,\r\n      queryParam: JSON.stringify(httpParams),\r\n      filterStr: filter\r\n    };\r\n    const befRepository: BefRepository<any> = null;//this.repository as BefRepository<any>;\r\n    const options = {\r\n      body\r\n    };\r\n    return befRepository.proxy.request(url, 'put', null, options).pipe(\r\n      map((result: any) => JSON.parse(result))\r\n    );\r\n  }\r\n  /**\r\n   * å½éåç¹å¾é¡¹æç¹å¾éåç§°\r\n   * @param object ç¹å¾éæç¹å¾é¡¹å¯¹è±¡\r\n   * @returns\r\n   */\r\n  private translateName(object: Prop.IPropSet | Prop.IProp): string {\r\n    if (!object) {\r\n      return null;\r\n    }\r\n    let name = null;\r\n    switch (this.localeId) {\r\n      case 'en': {\r\n        name = object['name_en'];\r\n      } break;\r\n      case 'zh-CHS': {\r\n        name = object['name_chs'];\r\n      } break;\r\n      case 'zh-CHT': {\r\n        name = object['name_cht'];\r\n      } break;\r\n      default: name = object['name_chs'];\r\n    }\r\n    return name;\r\n  }\r\n}\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { FeatureEditorService } from '@farris/ui-feature-editor';\r\nimport { FormNotifyService } from \"../form-notify.service\";\r\nimport { map, switchMap, tap } from \"rxjs/operators\";\r\nimport { FormLoadingService } from \"../form-loading/form-loading.service\";\r\nimport { FeatureDataService } from './feature-data.service';\r\nimport { LanguageService } from '../languag.service';\r\nimport { of } from \"rxjs\";\r\n\r\n@Injectable()\r\nexport class FeatureEditService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private featureEditorService: FeatureEditorService,\r\n    private featureDataService: FeatureDataService,\r\n    private loadingService: FormLoadingService,\r\n    private notifyService: FormNotifyService,\r\n    private languageService: LanguageService,\r\n  ) { }\r\n\r\n  public edit(materialId: string, materialFeatureId?: string, options?: any) {\r\n    if (!materialId) {\r\n      throw new Error('[FeatureEditService]ç©æidä¸è½ä¸ºç©ºï¼');\r\n    }\r\n    if (!options) {\r\n      options = {};\r\n    }\r\n    if (typeof options === 'string' && options.startsWith('{') && options.endsWith('}')) {\r\n      options = JSON.parse(options);\r\n    }\r\n    options.getHelpInfo = this.featureDataService.getHelpInfo;\r\n    this.loadingService.show();\r\n    return this.featureDataService.getFeaturesByMaterialId(materialId).pipe(\r\n      tap((result: any) => {\r\n        this.loadingService.hide();\r\n        const returnValue = result || null;\r\n        if (returnValue) {\r\n          const featureInfo = JSON.parse(returnValue);\r\n          const props = featureInfo.props || null;\r\n          if (!props || props.length < 1) {\r\n            this.notifyService.warning(this.languageService.propsIsEmpty);\r\n            return;\r\n          }\r\n          this.featureEditorService.show(props, options);\r\n        } else {\r\n          this.notifyService.error(this.languageService.propsIsEmpty);\r\n        }\r\n      })\r\n    );\r\n  }\r\n  private buildFeatures(materialId: string, materialFeatureId?: string) {\r\n    const features$ = this.featureDataService.getFeaturesByMaterialId(materialId);\r\n    return features$.pipe(\r\n      switchMap(featureSet => {\r\n        if (materialFeatureId) {\r\n          const configedFeatures$ = this.featureDataService.getConfigedValueByFeatureId(materialFeatureId, materialFeatureId);\r\n          return configedFeatures$.pipe(\r\n            map(defaultConfigs => {\r\n              const featureTemplate = featureSet.props;\r\n              const features = this.mergeFeatures(featureTemplate, defaultConfigs);\r\n              return features;\r\n            })\r\n          );\r\n        } else {\r\n          return of(featureSet.props);\r\n        }\r\n      })\r\n    );\r\n\r\n  }\r\n  private mergeFeatures(featureTemplate: any, defaultConfigs: any) {\r\n    return null;\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { BigNumber } from 'bignumber.js';\r\nimport { AppContext, FrameContext, Repository, ENTITY_TEMPLATE, ResolveService, ExpressionUtil, ExpressionExecutor } from \"@farris/devkit\";\r\nimport { Observable, of } from \"rxjs\";\r\n\r\n@Injectable()\r\nexport class ExpressionService {\r\n  constructor(private injector: Injector, private resolveService: ResolveService, private frameContext: FrameContext, private expressionExecutor: ExpressionExecutor) { }\r\n  /**\r\n   * æ§è¡è¡¨è¾¾å¼è®¡ç®\r\n   * @param expression è¡¨è¾¾å¼\r\n   * @param customContext èªå®ä¹ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public execute(expression: string, customContext?: { [prop: string]: any }): any {\r\n    const deps = this.resolveService.resolve(expression);\r\n    const groupDependencies = ExpressionUtil.getGroupFunctionDependency(expression, this.frameContext.repository.entityTypeInfo);\r\n    const entityContext = this.buildEntityContext(deps, groupDependencies);\r\n    const stateContext = this.buildStateContext();\r\n    const context = {\r\n      [this.entityOriginalNodeCode]: entityContext,\r\n      ...stateContext,\r\n      BigNumber,\r\n      frameContext: this.frameContext,\r\n      bindingData: this.frameContext.bindingData,\r\n      repository: this.frameContext.repository,\r\n      ...customContext\r\n    }\r\n    return this.expressionExecutor.eval(expression, context);\r\n  }\r\n  /**\r\n   * æ§è¡è¡¨è¾¾å¼ï¼è¿åå¯è§å¯å¯¹è±¡ï¼\r\n   * @param expression è¡¨è¾¾å¼\r\n   * @param customContext èªå®ä¹ä¸ä¸æ\r\n   * @returns \r\n   */\r\n  public executeAsync(expression: string, customContext?: { [prop: string]: any }): Observable<any> {\r\n    const result = this.execute(expression, customContext);\r\n    return of(result);\r\n  }\r\n  /**\r\n   * æé å®ä½ä¸ä¸æ\r\n   * @param deps \r\n   * @param groupDependencies \r\n   * @param context \r\n   * @returns \r\n   */\r\n  private buildEntityContext(deps: string[], groupDependencies: string[], context?: { [prop: string]: any }) {\r\n    let isGroupdMainEntity = false;\r\n    deps.forEach((dep: string) => {\r\n      const isEntityDependency = this.isEntityDependency(dep);\r\n      const isGroupDependency = groupDependencies.findIndex(item => item === dep) !== -1;\r\n      // å¦æä¾èµçæ¯stateï¼æ éå¤çï¼ç°å¨éè¦ç¡®å®çæ¯è¿åå¤å°å®ä½çé®é¢ï¼åstateæ²¡æå³ç³»\r\n      // è¡¨è¾¾å¼ä¾èµäºå®ä½\r\n      if (isEntityDependency) {\r\n        // æ¯èåä¾èµ\r\n        if (isGroupDependency) {\r\n          const dependencyLength = dep.split('/').filter(p => p).length - 1;\r\n          if (dependencyLength === 1) {\r\n            // èåäºä¸»è¡¨å­æ®µï¼ææä¸»è¡¨æ°æ®é½éè¦åä¸è¿ç®ï¼æ­¤æ¶å·²ç»ç¡®å®è®¡ç®çå®ä½ä¸ä¸æäºã\r\n            isGroupdMainEntity = true;\r\n          } else {\r\n            // èåäºå­è¡¨å­æ®µï¼åªéè¦ä¼ éå½åå®ä½\r\n          }\r\n        } else {\r\n          // å½åä¾èµä¸æ¯èåï¼åªéè¦ä¼ éå½åå®ä½\r\n        }\r\n      }\r\n    });\r\n    const data = this.getEntity();\r\n    if (isGroupdMainEntity) {\r\n      const collection = this.frameContext.repository.entityCollection.toJSON();\r\n      data['__type__'] = 'List';\r\n      data['__items__'] = collection;\r\n    }\r\n    return data;\r\n  }\r\n  /**\r\n   * æ¯å¦ä¸ºå®ä½ä¾èµ\r\n   * @param dep \r\n   * @returns \r\n   */\r\n  private isEntityDependency(dep: string) {\r\n    return dep.startsWith(ENTITY_TEMPLATE);\r\n  }\r\n  /**\r\n   * è·åå®ä½\r\n   * @param event \r\n   * @returns \r\n   */\r\n  public getEntity() {\r\n    const entityTypeInfo = this.frameContext.repository.entityTypeInfo;\r\n    const bindingData = this.frameContext.bindingData;\r\n    const childrenEntityPaths = [];\r\n    ExpressionUtil.getChildrenEntityPaths(entityTypeInfo, childrenEntityPaths);\r\n    const entity = this.frameContext.bindingData.list.currentItem.toJSON();\r\n    entity['__type__'] = 'Entity';\r\n    if (!childrenEntityPaths || childrenEntityPaths.length < 1) {\r\n      return entity;\r\n    }\r\n    // æ¾å°ææå­è¡¨\r\n    childrenEntityPaths.forEach((paths: string[]) => {\r\n      const row = ExpressionUtil.getCurrentRowByPaths(paths, bindingData);\r\n      if (row) {\r\n        const propertyName = paths.pop();\r\n        let parent = paths.reduce((object: any, path: string) => {\r\n          return object && object[path] || null;\r\n        }, entity);\r\n        const node = { __items__: [...parent[propertyName]], ...row, __type__: 'List' };\r\n        parent[propertyName] = node;\r\n      }\r\n    });\r\n    return entity;\r\n  }\r\n  /**\r\n   * è·åä¸»å®ä½åå§å­æ®µå\r\n   */\r\n  protected get entityOriginalNodeCode(): string {\r\n    const repository = this.injector.get(Repository);\r\n    return repository && repository.entityTypeInfo && repository.entityTypeInfo.entityInfo && repository.entityTypeInfo.entityInfo.originalCode || null;\r\n  }\r\n  /**\r\n   * æé åéä¸ä¸æ\r\n   * @param event \r\n   * @returns \r\n   */\r\n  public buildStateContext() {\r\n    const ns = this.frameContext.namespace;\r\n    const appContext = this.injector.get<AppContext>(AppContext, null);\r\n    const frameContexts = appContext.frameContextManager.getFrameContextsByNamespace(ns);\r\n    const result = {};\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      const anonymousFrameContext = frameContexts[0];\r\n      const rootFrameContext = anonymousFrameContext.getVirtualRootFrameContext();\r\n      if (rootFrameContext) {\r\n        const uiState = rootFrameContext.viewModel.uiState;\r\n        const propertyNames = Object.getOwnPropertyNames(uiState) || [];\r\n        propertyNames.forEach((prop: string) => {\r\n          if (prop.match(/^[a-zA-Z0-9_\\$]+$/g) !== null) {\r\n            result[prop] = uiState[prop];\r\n          }\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}","import { ApplicationRef, ChangeDetectorRef, Injectable, Injector } from \"@angular/core\";\r\n\r\n/**\r\n * angular èå¼æ£æ¥æå¡\r\n */\r\n@Injectable()\r\nexport class DirtyCheckingService {\r\n  constructor(public injector: Injector, private cd: ChangeDetectorRef, private appRef: ApplicationRef) {\r\n  }\r\n  /**\r\n   * Checks this view and its children. \r\n   * @param global æ¯å¦å¨å±æ£æ¥\r\n   */\r\n  public detectChanges(global?: boolean | string) {\r\n    global = (global === true || global === 'true') ? true : false;\r\n    if (global && this.appRef) {\r\n      this.appRef.tick();\r\n    } else if (this.cd) {\r\n      this.cd.detectChanges();\r\n    }\r\n  }\r\n  /**\r\n   * å¨æå®æ¶é´ï¼msï¼åè§¦åAngularèå¼æ£æ¥\r\n   * @param duration è¶æ¶æ¶é´(ms)\r\n   * @param global æ¯å¦å¨å±æ£æ¥\r\n   */\r\n  public detectChangesAfter(duration: number, global?: boolean | string) {\r\n    global = (global === true || global === 'true') ? true : false;\r\n    if (isNaN(duration)) {\r\n      return;\r\n    }\r\n    if (global && this.appRef) {\r\n      window.setTimeout(() => {\r\n        this.appRef.tick();\r\n      }, duration);\r\n    } else if (this.cd) {\r\n      window.setTimeout(() => {\r\n        this.cd.detectChanges();\r\n      }, duration);\r\n    }\r\n  }\r\n}","import { Injectable, Injector } from '@angular/core';\r\nimport { EMPTY, of } from 'rxjs';\r\nimport { switchMap, tap } from 'rxjs/operators';\r\nimport { BefRepository } from '@farris/bef';\r\nimport { FrameContext, DataPathCreator, Repository, DataPath, EntityList, BindingList, Entity } from '@farris/devkit';\r\nimport { LanguageService } from './languag.service';\r\nimport { FormMessageService } from './form-message.service';\r\n\r\n@Injectable()\r\nexport class PopUpService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private frameContext: FrameContext,\r\n    private repository: Repository<any>,\r\n    private languageService: LanguageService,\r\n    private messageService: FormMessageService\r\n  ) { }\r\n  public confirm() { }\r\n  /**\r\n   * åæ¶åæ´\r\n   * @param frameId\r\n   * @param id\r\n   * @returns\r\n   * @throws invalid frameid\r\n   */\r\n  public cancel(frameId: string, id?: string) {\r\n    const frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n    if (!frameContext) {\r\n      throw new Error(`[PopUpService]Invalid frameId ${frameId}`);\r\n    }\r\n    const primaryValue = this.frameContext.bindingData.list.currentId;\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    if (!id) {\r\n      const bindingList = this.frameContext.bindingData.getList() as BindingList;\r\n      id = bindingList.currentId;\r\n    }\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const longPaths = (DataPathCreator.createByShortPathFromRoot(bindingPaths, befRepository.entityManager, this.frameContext.bindingData) as DataPath).toArray().map((path: string) => path.split(':')[1]);\r\n    const entityListPaths = Array.from(longPaths);\r\n    // èå¼å½åè¡¨å½åè¡\r\n    entityListPaths.pop();\r\n    const dialogRef = this.frameContext.frameComponent['dialogRef'];\r\n    if (entityListPaths.length < 1) {\r\n      // ä¸»è¡¨\r\n      const entity = this.repository.entityCollection.getEntityById(id) as Entity;\r\n      const originalData = entity['originalData'];\r\n      entity.load(originalData, { loadChild: false });\r\n    } else {\r\n      const entityList = befRepository.entityManager.getEntityNodeByPath(entityListPaths) as EntityList<any>;\r\n      if (entityList) {\r\n        const originalData: any[] = entityList['originalData'];\r\n        const item = originalData.find((item) => item.id === id);\r\n        if (item) {\r\n          // å·²ææ°æ®ï¼è¿ååæ´\r\n          const entity: Entity = befRepository.entityManager.getEntityByPath(longPaths) as Entity;\r\n          if (entity.changes && entity.changes.length > 0) {\r\n            return this.messageService.confirm(this.languageService.cancelWithoutSave).pipe(\r\n              tap((result: boolean) => {\r\n                if (result) {\r\n                  entity.load(item, { loadChild: false });\r\n                  entity.changes.splice(0, entity.changes.length);\r\n                }\r\n              })\r\n            );\r\n          } else {\r\n            // æ²¡æä¿®æ¹ï¼ç´æ¥å³é­\r\n            if (dialogRef) {\r\n              dialogRef.close();\r\n            }\r\n          }\r\n        } else {\r\n          // æ°å¢çæ°æ®ï¼å é¤\r\n          const paths = this.buildPath(bindingPath, primaryValue);\r\n          return this.messageService.confirm(this.languageService.cancelWithoutSave).pipe(\r\n            switchMap((result) => {\r\n              if (result) {\r\n                return befRepository.removeEntityByPath(paths, id).pipe(\r\n                  tap(() => {\r\n                    befRepository.entityManager.removeEntityByPath(paths, id);\r\n\r\n                    if (entityList.count() === 0 && dialogRef) {\r\n                      dialogRef.close();\r\n                    }\r\n                  })\r\n                );\r\n              } else {\r\n                return EMPTY;\r\n              }\r\n            })\r\n          );\r\n        }\r\n      }\r\n    }\r\n    return of([]);\r\n  }\r\n  /**\r\n   * åæ­¥å½åè¡\r\n   * @param id å½åè¡\r\n   */\r\n  public updateCurrentRow(id?: string) {\r\n    const bindingPath = this.frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    // const frameId = this.frameContext.frameId;\r\n    const root = this.frameContext.getVirtualRootFrameContext();\r\n    const primaryKeyValue = root.bindingData.list.currentId;\r\n    this.frameContext.bindingData.list.setCurrentId(primaryKeyValue);\r\n    if (bindingPaths.length > 0) {\r\n      const paths = [];\r\n      bindingPaths.forEach((path: string, index: number, array) => {\r\n        paths.push(path);\r\n        const bindingList = root.bindingData.getValue(paths) as BindingList;\r\n        if (bindingList) {\r\n          const currentId = bindingList.currentId;\r\n          const modalBindingList = this.frameContext.bindingData.getValue(paths) as BindingList;\r\n          if (index === bindingPath.length - 1 && id) {\r\n            modalBindingList.setCurrentId(id);\r\n          } else if (modalBindingList) {\r\n            modalBindingList.setCurrentId(currentId);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  public closeCheck() {\r\n    const frameContext = this.frameContext;\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    const longPaths = (DataPathCreator.createByShortPathFromRoot(bindingPaths, befRepository.entityManager, this.frameContext.bindingData) as DataPath).toArray().map((path: string) => path.split(':')[1]);\r\n    const entityListPaths = Array.from(longPaths);\r\n    entityListPaths.pop();\r\n    const entityList = befRepository.entityManager.getEntityNodeByPath(entityListPaths) as EntityList<any>;\r\n    const dialogRef = this.frameContext.frameComponent['dialogRef'];\r\n    if (entityList.count() === 0 && dialogRef) {\r\n      dialogRef.close();\r\n    }\r\n  }\r\n  /**\r\n   * å é¤å¼¹çªä¸­çå½åè¡æ°æ®\r\n   * @param frameId -å¯éï¼è¦å é¤æ°æ®æå¨ç»ä»¶çidï¼é»è®¤ä¸ºå½ä»¤æå¨çç»ä»¶\r\n   * @param id -å¯éï¼è¦å é¤æ°æ®çidï¼é»è®¤ä¸ºå½ä»¤æå¨ç»ä»¶çå½åè¡æ°æ®id\r\n   * @param showConfirm -å¯éï¼å é¤æ°æ®æ¶æ¯å¦è¿è¡å é¤åçç¡®è®¤ï¼é»è®¤ä¸º`true`\r\n   * @returns\r\n   * @throws ç»ä»¶idéè¯¯æ¶æåºéè¯¯\r\n   */\r\n  public removeRow(frameId?: string, id?: string, showConfirm: string | boolean = true) {\r\n    const frameContext = frameId ? this.frameContext.appContext.frameContextManager.getFrameContextById(frameId) : this.frameContext;\r\n    if (!frameContext) {\r\n      throw new Error(`æ æçç»ä»¶idï¼${frameId}`);\r\n    }\r\n    // çº æ­£ä¸»é®\r\n    if (!id) {\r\n      const bindingList = frameContext.bindingData.getList() as BindingList;\r\n      id = bindingList.currentId;\r\n    }\r\n    const bindingPath = frameContext.viewModel.bindingPath;\r\n    const bindingPaths = bindingPath.split('/').filter((p) => p);\r\n    const paths = this.buildPath(bindingPath, this.frameContext.bindingData.list.currentId);\r\n    const befRepository = this.repository as BefRepository<any>;\r\n    // è½¬æ¢showConfirmä¸ºå¸å°\r\n    if (typeof showConfirm == 'string') {\r\n      showConfirm = showConfirm.trim() === 'false' ? false : true;\r\n    }\r\n    let confirm$ = of(true);\r\n    if (showConfirm) {\r\n      confirm$ = this.messageService.confirm(this.languageService.confirmDeletion);\r\n    }\r\n    return confirm$.pipe(\r\n      switchMap((result) => {\r\n        if (result) {\r\n          if (bindingPaths.length === 0) {\r\n            // ä¸»è¡¨å é¤ï¼ä¸ç«å³ä¿å­\r\n            return befRepository.removeEntityById(id, false);\r\n          } else {\r\n            return befRepository.removeEntityByPath(paths, id).pipe(\r\n              tap(() => {\r\n                befRepository.entityManager.removeEntityByPath(paths, id);\r\n              })\r\n            );\r\n          }\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * å³é­å¼¹çª\r\n   * @param frameId -å¯éï¼ç»ä»¶idï¼ä¸æå®æ¶ä½¿ç¨å½ä»¤æå¨çä¸ä¸æç»ä»¶\r\n   * @throws ä½¿ç¨æå®çç»ä»¶idæ æ³è·åç»ä»¶åå¼¹çªç»ä»¶å®ä¾è·åå¤±è´¥æ¶ä¼æåºå¼å¸¸\r\n   */\r\n  public closeDialog(frameId?: string) {\r\n    let frameContext = this.frameContext;\r\n    let dialogRef = null;\r\n    // å¼åèæå®äºç»ä»¶id\r\n    if (frameId) {\r\n      frameContext = this.frameContext.appContext.frameContextManager.getFrameContextById(frameId);\r\n      if (!frameContext) {\r\n        throw new Error('æå®äºæ æçç»ä»¶id');\r\n      }\r\n      dialogRef = frameContext.frameComponent['dialogRef'];\r\n    } else {\r\n      // å°è¯ä»å½åç»ä»¶ä¸ä¸æä¸­è·åå¼¹çªå¼ç¨\r\n      dialogRef = frameContext.frameComponent['dialogRef'];\r\n      if (!dialogRef) {\r\n        // å¦æå½ä»¤æè½½å°äºåå®¹ç»ä»¶ä¸\r\n        dialogRef = this.frameContext.parent.frameComponent['dialogRef'];\r\n      }\r\n    }\r\n    if (!dialogRef) {\r\n      throw new Error(`æ æ³è·åå¼¹çªç»ä»¶å®ä¾`);\r\n    }\r\n    dialogRef.close();\r\n  }\r\n  /**\r\n   * è¿åèªä¸æ¬¡æä¹åä»¥åäº§ççåæ´\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @param showConfirm - æ¯å¦å±ç¤ºæç¤ºä¿¡æ¯\r\n   */\r\n  public cancelChanges(frameId?: string, id?: string, showConfirm: boolean | string = true) {\r\n    const frameContext = this.getFrameContext(frameId);\r\n    // çº æ­£ä¸»é®\r\n    id = this.getPrimaryValue(frameId, id);\r\n    const data = this.getPersisteData(frameId, id);\r\n    if (typeof showConfirm === 'string') {\r\n      showConfirm = showConfirm.trim().toLowerCase() === 'false' ? false : true;\r\n    }\r\n    const isDataChanged = this.isDataChanged(data, frameId, id);\r\n    let result$ = of(true);\r\n    if (showConfirm && isDataChanged) {\r\n      result$ = this.messageService.confirm(this.languageService.cancelWithoutSave);\r\n    }\r\n    return result$.pipe(\r\n      switchMap((result: boolean) => {\r\n        if (result) {\r\n          const befRepository = frameContext.repository as BefRepository<any>;\r\n          const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter((p) => p);\r\n          const longPaths = (DataPathCreator.createByShortPathFromRoot(bindingPaths, befRepository.entityManager, this.frameContext.bindingData) as DataPath).toArray().map((path: string) => path.split(':')[1]);\r\n          const entityPaths = Array.from(longPaths);\r\n          const entity = befRepository.entityManager.getEntityNodeByPath(entityPaths) as Entity;\r\n          if (entity) {\r\n            entity.load(data);\r\n          }\r\n          return of(true);\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    );\r\n  }\r\n  /**\r\n   * æä¹åæ°æ®\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   */\r\n  public persiste(frameId?: string, id?: string) {\r\n    // æä¹åæ°æ®\r\n    const bindingObject = this.getBindingObject(frameId, id);\r\n    bindingObject['__PSESISTE__DATA'] = bindingObject.toJSON();\r\n  }\r\n  /**\r\n   * è·åæä¹åæ°æ®\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @returns\r\n   */\r\n  private getPersisteData(frameId?: string, id?: string) {\r\n    const bindingObject = this.getBindingObject(frameId, id);\r\n    return bindingObject['__PSESISTE__DATA'];\r\n  }\r\n  private isDataChanged(data: { [prop: string]: any }, frameId?: string, id?: string) {\r\n    const bindingObject = this.getBindingObject(frameId, id);\r\n    const value = bindingObject.toJSON();\r\n    return JSON.stringify(value) !== JSON.stringify(data);\r\n  }\r\n  /**\r\n   * è·åå½åè¡\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @returns\r\n   * @throws æ¾ä¸å°å¯¹åºæ°æ®æ¶æåºæ æ³æ¾å°å¯¹åºæ°æ®çå¼å¸¸\r\n   */\r\n  private getBindingObject(frameId?: string, id?: string) {\r\n    const frameContext = this.getFrameContext(frameId);\r\n    // çº æ­£ä¸»é®\r\n    id = this.getPrimaryValue(frameId, id);\r\n    const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter((p) => p);\r\n    // æ¿å°å½åè¡\r\n    const bindingList: BindingList = frameContext.bindingData.getValue(bindingPaths) as BindingList;\r\n    if (!bindingList || bindingList.length < 1) {\r\n      throw new Error(`æ æ³æ¾å°idä¸º:${id}çæ°æ®`);\r\n    }\r\n    return bindingList.currentItem;\r\n  }\r\n  /**\r\n   * æé å­è¡¨è·¯å¾\r\n   * @param bindingPath - ç»å®è·¯å¾\r\n   * @param id - id\r\n   * @throws å­è¡¨è·¯å¾éè¯¯\r\n   */\r\n  private buildPath(bindingPath: string, id: any) {\r\n    let path = '/' + id;\r\n    const subPaths = bindingPath.split('/');\r\n    if (subPaths.length > 0) {\r\n      // eg:bindingPathå½¢å¦/edus/grades,splitåæ¯['', 'edus', 'grades']\r\n      // å æ­¤indexä»1å¼å§\r\n      for (let index = 1; index < subPaths.length - 1; index++) {\r\n        const subPath = subPaths[index];\r\n        const subData = this.frameContext.viewModel.bindingData[subPath];\r\n        if (!subData || !subData.currentId) {\r\n          throw Error(`è·åå­è¡¨å®æ´è·¯å¾åºéï¼æ¾ä¸å°${subData}å¯¹åºçå­è¡¨ï¼æå¯¹åºå­è¡¨æ²¡æå½åè¡ã`);\r\n        }\r\n        path += `/${subPath}/${subData.currentId}`;\r\n      }\r\n    }\r\n    path += '/' + subPaths[subPaths.length - 1];\r\n    return path;\r\n  }\r\n  /**\r\n   * æ ¹æ®ç»ä»¶idè·åç»ä»¶ä¸ä¸æ\r\n   * @param frameId - ç»ä»¶id\r\n   * @returns\r\n   * @throws æ æçç»ä»¶id\r\n   */\r\n  private getFrameContext(frameId?: string) {\r\n    const frameContext = frameId ? this.frameContext.appContext.frameContextManager.getFrameContextById(frameId) : this.frameContext;\r\n    if (!frameContext) {\r\n      throw new Error(`æ æçç»ä»¶idï¼${frameId}`);\r\n    }\r\n    return frameContext;\r\n  }\r\n  /**\r\n   * è·åä¸»é®\r\n   * @param frameId - ç»ä»¶id\r\n   * @param id - æ°æ®id\r\n   * @returns\r\n   * @throws ç»ä»¶idæ ææ¶æåºå¼å¸¸\r\n   */\r\n  private getPrimaryValue(frameId?: string, id?: string) {\r\n    if (!id) {\r\n      const frameContext = this.getFrameContext(frameId);\r\n      if (!frameContext) {\r\n        throw new Error(`æ æçç»ä»¶idï¼${frameId}`);\r\n      }\r\n      const bindingList = frameContext.bindingData.getList() as BindingList;\r\n      if (!bindingList || bindingList.length < 1) {\r\n        throw new Error(`æ æçä¸»é®:${id}`);\r\n      }\r\n      id = bindingList.currentId;\r\n    }\r\n    return id;\r\n  }\r\n}\r\n","import { Injectable, Injector } from \"@angular/core\";\r\nimport { AppContext, DataPropInfo, DataTypeInfo, Entity, FrameContext, NgFormControl, Repository } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class FormService {\r\n  constructor(\r\n    private injector: Injector,\r\n    private appContext: AppContext,\r\n    private repository: Repository<Entity>\r\n  ) {\r\n  }\r\n  /**\r\n   * æ ¹æ®å­æ®µè·¯å¾è·åè¯¥å­æ®µå¨å¡çæè¡¨æ ¼ä¸­çç´¢å¼\r\n   * @param source ngFormControlsæany[][]\r\n   * @param propertyPath å­æ®µé¤bindingPathä¹å¤çå®æ´è·¯å¾\r\n   * @returns \r\n   */\r\n  public getIndex(source: { [propertyName: string]: NgFormControl } | any[], propertyPath: string) {\r\n    if (Array.isArray(source)) {\r\n      const combine: any[] = source.reduce((result: any[], group: any[]) => {\r\n        return result.concat(group);\r\n      }, []);\r\n      return combine.findIndex((item: any) => item.field === propertyPath);\r\n    } else if (Object.prototype.toString.call(source) === '[object Object]') {\r\n      return Object.keys(source).findIndex(key => source[key].binding === propertyPath);\r\n    }\r\n  }\r\n  \r\n}","import { Injectable } from \"@angular/core\";\r\nimport { FrameContext } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class ViewModelService {\r\n  constructor() { }\r\n  public getGridColumns(frameContext: FrameContext): any[] {\r\n    const dataGridColumnsName = frameContext && frameContext.viewModel && frameContext.viewModel['dataGridColumnsName'] || null;\r\n    return dataGridColumnsName && frameContext.viewModel[dataGridColumnsName] || [];\r\n  }\r\n}","import { Injectable, Injector } from \"@angular/core\";\r\nimport { DataPropGroup, FrameContext } from \"@farris/devkit\";\r\n\r\n@Injectable()\r\nexport class PaginationService {\r\n  constructor(private injector: Injector, private frameContext: FrameContext) { }\r\n  /**\r\n   * éç½®å­è¡¨åé¡µä¿¡æ¯\r\n   */\r\n  public resetChildrenPagination() {\r\n    const paginationInfo = this.frameContext.repository.entityCollection.paginationInfo || {};\r\n    const childrenEntityCodes = this.frameContext.repository.entityTypeInfo.getPropNamesByGroup(DataPropGroup.List) || [];\r\n    if (paginationInfo && Object.keys(paginationInfo).length > 0) {\r\n      const keys = Object.keys(paginationInfo);\r\n      keys.forEach((key: string) => {\r\n        const value = paginationInfo[key];\r\n        if (Object.prototype.toString.apply(value) !== '[object Object]') {\r\n          return;\r\n        }\r\n        const rowPagination = childrenEntityCodes.find((nodeCode: string) => {\r\n          // å»æs\r\n          nodeCode = nodeCode.slice(0, -1);\r\n          return key.startsWith(`${nodeCode}_`);\r\n        });\r\n        if (rowPagination) {\r\n          delete paginationInfo[key];\r\n        } else {\r\n          paginationInfo[key].pageIndex = 1;\r\n          delete paginationInfo[key].total;\r\n          delete paginationInfo[key].pageCount;\r\n        }\r\n      });\r\n      this.frameContext.repository.entityCollection.updatePaginationInfoByPath('/', paginationInfo);\r\n    }\r\n  }\r\n}","import { Provider } from '@angular/core';\r\n\r\nimport { UIStateService } from '../ui-state.service';\r\nimport { StateMachineService } from '../state-machine.service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { BindingDataService } from '../binding-data.service';\r\nimport { CommandService } from '../command-service';\r\nimport { NavigationMiddlewareService } from '../navigation-middleware.service';\r\nimport { GridMiddlewareService } from '../grid.middleware.service';\r\nimport { BeActionService } from '../be-action.service';\r\nimport { ApproveService } from '../approve.service';\r\nimport { PrintService } from '../print.service';\r\nimport { AttachmentDataService, AttachmentService, FileService } from '../attachment/index';\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityListService, EntityService\r\n} from '../entity-services/index';\r\nimport { SidebarService } from '../sidebar-service';\r\nimport { ChangeItemService } from '../change-item.service';\r\n\r\nimport {\r\n  ListDataService, CardDataService, SubListDataService, TreeDataService,\r\n  RemoveDataService, SaveDataService, EditDataService, SubTreeDataService\r\n} from '../data-services/index';\r\n\r\nimport { FarrisFormService } from '../farris-form.service';\r\nimport { DialogService } from '../dialog.service';\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { RouterService } from '../router.service';\r\nimport { AuthorityService } from '../authority/authority.service';\r\n\r\nimport { QuerySolutionService } from '../query-solution/query-solution.service';\r\nimport { QUERYSOLUTION_HANDLER_TOKEN } from '@gsp-cmp/querysolution';\r\nimport { FilterConditionDataService } from '../data-services/filter-condition-data.service';\r\nimport { FocusInvalidService } from '../focus-invalid.service';\r\nimport { EndEditService } from '../end-edit.service';\r\nimport { RemoteSummaryService } from '../remote-summary.service';\r\nimport { BatchEditService } from '../batch-edit.service';\r\nimport { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';\r\nimport { FeatureEditorService } from '@farris/ui-feature-editor';\r\nimport { DiscussionGroupService } from '../discussion-group.service';\r\nimport { ListFilterConditionsService } from '../list-filter/list-filter.service';\r\nimport { LISTFILTER_HANDLER_TOKEN } from '@farris/ui-list-filter';\r\nimport { FORM_MANIFEST_SERVICE_TOKEN, FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, MESSAGE_SERVICE_TOKEN, NOTIFY_SERVICE_TOKEN, FRAME_COMPONENT_INIT_HANDLER_TOKEN } from '@farris/devkit';\r\nimport { FormManifestService, FormExpressionManifestService } from '../manifest/index';\r\nimport { LocalizationService } from '../localization.service';\r\nimport { DataGridService } from '../data-grid.service';\r\nimport { FormAttentionService } from '../form-attention.service';\r\nimport { FeatureDataService, FeatureEditService } from '../feature-edit/index';\r\nimport { ExpressionService } from '../expression_service';\r\nimport { DirtyCheckingService } from '../dirty-checking.service';\r\nimport { FormMessageService } from '../form-message.service';\r\nimport { FormNotifyService } from '../form-notify.service';\r\nimport { PopUpService } from '../pop_up.service';\r\nimport { WorkFlowMessageHandler } from '../work-flow/index';\r\nimport { FormService } from '../form.service';\r\nimport { FormControlService } from '../form-control.service';\r\nimport { BindingPathService } from '../binding-path.service';\r\nimport { FrameContextService } from '../frame-context.service';\r\nimport { ViewModelService } from '../view-model.service';\r\nimport { PaginationService } from '../pagination.service';\r\n/**\r\n * ç»ä»¶çº§æ³¨å¥æ³¨å¥(å±23ä¸ª)\r\n */\r\nconst FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS: Provider[] = [\r\n  ValidationService,\r\n  FocusInvalidService,\r\n  ChangeItemService,\r\n  UIStateService,\r\n  StateMachineService,\r\n  BindingDataService,\r\n  CommandService,\r\n\r\n  // entity-services\r\n  EntityTraversingService,\r\n  EntityManipulationService,\r\n  EntityAggregationService,\r\n  EntityListService,\r\n  EntityService,\r\n\r\n  // data-services\r\n  ListDataService,\r\n  TreeDataService,\r\n  SubTreeDataService,\r\n  CardDataService,\r\n  SubListDataService,\r\n  RemoveDataService,\r\n  SaveDataService,\r\n  EditDataService,\r\n  FilterConditionDataService,\r\n  RemoteSummaryService,\r\n\r\n  BeActionService,\r\n  ApproveService,\r\n  PrintService,\r\n  AttachmentDataService,\r\n  AttachmentService,\r\n  FileService,\r\n  NavigationMiddlewareService,\r\n  GridMiddlewareService,\r\n  SidebarService,\r\n  FarrisFormService,\r\n  DialogService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  RouterService,\r\n  AuthorityService,\r\n  {\r\n    provide: QUERYSOLUTION_HANDLER_TOKEN,\r\n    useClass: QuerySolutionService\r\n  },\r\n  {\r\n    provide: LISTFILTER_HANDLER_TOKEN,\r\n    useClass: ListFilterConditionsService\r\n  },\r\n  EndEditService,\r\n  BatchEditDialogService,\r\n  BatchEditService,\r\n  DiscussionGroupService,\r\n  LocalizationService,\r\n  DataGridService,\r\n  FormAttentionService,\r\n  FeatureEditorService,\r\n  FeatureDataService,\r\n  FeatureEditService,\r\n  ExpressionService,\r\n  PopUpService,\r\n  DirtyCheckingService,\r\n  FormService,\r\n  FormControlService,\r\n  BindingPathService,\r\n  FrameContextService,\r\n  ViewModelService,\r\n  PaginationService,\r\n  // è¡¨è¾¾å¼\r\n  { provide: FORM_MANIFEST_SERVICE_TOKEN, useClass: FormManifestService },\r\n  { provide: FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, useClass: FormExpressionManifestService },\r\n  { provide: MESSAGE_SERVICE_TOKEN, useClass: FormMessageService },\r\n  { provide: NOTIFY_SERVICE_TOKEN, useClass: FormNotifyService },\r\n  { provide: FRAME_COMPONENT_INIT_HANDLER_TOKEN, useClass: WorkFlowMessageHandler, multi: true }\r\n];\r\n\r\nexport { FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS };\r\n","import { Provider } from '@angular/core';\r\n\r\nimport { RouterService } from '../router.service';\r\nimport { UIStateService } from '../ui-state.service';\r\nimport { StateMachineService } from '../state-machine.service';\r\nimport { ValidationService } from '../validation.service';\r\nimport { BindingDataService } from '../binding-data.service';\r\nimport { CommandService } from '../command-service';\r\n\r\nimport { NavigationEventService } from '../navigation-event.service';\r\nimport { NavigationService } from '../navigation.service';\r\nimport { NavigationMiddlewareService } from '../navigation-middleware.service';\r\nimport { GridMiddlewareService } from '../grid.middleware.service';\r\n\r\nimport { BeActionService } from '../be-action.service';\r\nimport { ApproveService } from '../approve.service';\r\nimport { PrintService } from '../print.service';\r\nimport { AttachmentDataService, AttachmentService, FileService } from '../attachment/index';\r\nimport {\r\n    EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n    EntityListService, EntityService\r\n} from '../entity-services/index';\r\nimport { DialogService } from '../dialog.service';\r\nimport { SidebarService } from '../sidebar-service';\r\nimport { FarrisFormService } from '../farris-form.service';\r\nimport { ChangeItemService } from '../change-item.service';\r\n\r\n// data-services\r\nimport { ListDataService } from '../data-services/list-data.service';\r\nimport { TreeDataService } from '../data-services/tree-data.service';\r\nimport { CardDataService } from '../data-services/card-data.service';\r\nimport { SubListDataService } from '../data-services/sub-list-data.service';\r\nimport { FocusInvalidService } from '../focus-invalid.service';\r\nimport { SubTreeDataService } from '../data-services/sub-tree-data-service';\r\nimport { RemoveDataService } from '../data-services/remove-data.service';\r\nimport { SaveDataService } from '../data-services/save-data.service';\r\nimport { EditDataService } from '../data-services/edit-data.service';\r\nimport { FilterConditionDataService } from '../data-services/filter-condition-data.service';\r\nimport { RemoteSummaryService } from '../remote-summary.service';\r\nimport { AuthorityService } from '../authority/authority.service';\r\nimport { EndEditService } from '../end-edit.service';\r\nimport { BatchEditService } from '../batch-edit.service';\r\nimport { DiscussionGroupService } from '../discussion-group.service';\r\nimport { LocalizationService } from '../localization.service';\r\nimport { DataGridService } from '../data-grid.service';\r\nimport { FormAttentionService } from '../form-attention.service';\r\nimport { FormManifestService } from '../manifest/form_manifest_service';\r\nimport { FormExpressionManifestService } from '../manifest/form_expression_manifest_service';\r\nimport { ListFilterConditionsService } from '../list-filter/list-filter.service';\r\nimport { QuerySolutionService } from '../query-solution/query-solution.service';\r\nimport { BatchEditDialogService } from '@farris/ui-batch-edit-dialog';\r\nimport { FORM_MANIFEST_SERVICE_TOKEN, FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN } from '@farris/devkit';\r\nimport { QUERYSOLUTION_HANDLER_TOKEN } from '@gsp-cmp/querysolution';\r\nimport { LISTFILTER_HANDLER_TOKEN } from '@farris/ui-list-filter';\r\n\r\n/**\r\n * ç»ä»¶çº§æ³¨å¥æ³¨å¥(å±23ä¸ª)\r\n */\r\nconst DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS: Provider[] = [\r\n    { provide: 'ValidationService', useClass: ValidationService },\r\n    { provide: 'FocusInvalidService', useClass: FocusInvalidService },\r\n    { provide: 'ChangeItemService', useClass: ChangeItemService },\r\n    { provide: 'UIStateService', useClass: UIStateService },\r\n    { provide: 'StateMachineService', useClass: StateMachineService },\r\n    { provide: 'BindingDataService', useClass: BindingDataService },\r\n    { provide: 'CommandService', useClass: CommandService },\r\n\r\n    // entity-services\r\n    { provide: 'EntityTraversingService', useClass: EntityTraversingService },\r\n    { provide: 'EntityManipulationService', useClass: EntityManipulationService },\r\n    { provide: 'EntityAggregationService', useClass: EntityAggregationService },\r\n    { provide: 'EntityListService', useClass: EntityListService },\r\n    { provide: 'EntityService', useClass: EntityService },\r\n\r\n    // data-services\r\n    { provide: 'ListDataService', useClass: ListDataService },\r\n    { provide: 'TreeDataService', useClass: TreeDataService },\r\n    { provide: 'SubTreeDataService', useClass: SubTreeDataService },\r\n    { provide: 'CardDataService', useClass: CardDataService },\r\n    { provide: 'SubListDataService', useClass: SubListDataService },\r\n    { provide: 'RemoveDataService', useClass: RemoveDataService },\r\n    { provide: 'SaveDataService', useClass: SaveDataService },\r\n    { provide: 'EditDataService', useClass: EditDataService },\r\n    { provide: 'FilterConditionDataService', useClass: FilterConditionDataService },\r\n    { provide: 'RemoteSummaryService', useClass: RemoteSummaryService },\r\n\r\n    { provide: 'BeActionService', useClass: BeActionService },\r\n    { provide: 'ApproveService', useClass: ApproveService },\r\n    { provide: 'PrintService', useClass: PrintService },\r\n    { provide: 'AttachmentDataService', useClass: AttachmentDataService },\r\n    { provide: 'AttachmentService', useClass: AttachmentService },\r\n    { provide: 'FileService', useClass: FileService },\r\n    { provide: 'NavigationMiddlewareService', useClass: NavigationMiddlewareService },\r\n    { provide: 'GridMiddlewareService', useClass: GridMiddlewareService },\r\n    { provide: 'SidebarService', useClass: SidebarService },\r\n    { provide: 'FarrisFormService', useClass: FarrisFormService },\r\n    { provide: 'DialogService', useClass: DialogService },\r\n    { provide: 'NavigationEventService', useClass: NavigationEventService },\r\n    { provide: 'NavigationService', useClass: NavigationService },\r\n    { provide: 'RouterService', useClass: RouterService },\r\n    { provide: 'AuthorityService', useClass: AuthorityService },\r\n    {\r\n        provide: QUERYSOLUTION_HANDLER_TOKEN,\r\n        useClass: QuerySolutionService\r\n    },\r\n    {\r\n        provide: LISTFILTER_HANDLER_TOKEN,\r\n        useClass: ListFilterConditionsService\r\n    },\r\n    { provide: 'EndEditService', useClass: EndEditService },\r\n    { provide: 'BatchEditDialogService', useClass: BatchEditDialogService },\r\n    { provide: 'BatchEditService', useClass: BatchEditService },\r\n    { provide: 'DiscussionGroupService', useClass: DiscussionGroupService },\r\n    { provide: 'LocalizationService', useClass: LocalizationService },\r\n    { provide: 'DataGridService', useClass: DataGridService },\r\n    { provide: 'FormAttentionService', useClass: FormAttentionService },\r\n    // è¡¨è¾¾å¼\r\n    { provide: FORM_MANIFEST_SERVICE_TOKEN, useClass: FormManifestService },\r\n    { provide: FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN, useClass: FormExpressionManifestService }\r\n];\r\n\r\n\r\nexport { DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS };\r\n","import { NgModule } from '@angular/core';\r\nimport { FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS } from './providers/index';\r\nimport { WfTaskHandlerModule } from '@gsp-wf/wf-task-handler';\r\nimport { WorkFlowMessage } from './work-flow/index';\r\n\r\n@NgModule({\r\n  providers: FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS,\r\n  imports: [\r\n    WfTaskHandlerModule\r\n  ],\r\n  exports: [\r\n    WfTaskHandlerModule\r\n  ]\r\n})\r\nclass CommandServicesModule {\r\n  constructor(private workFlowMessage: WorkFlowMessage) {\r\n    if (this.workFlowMessage) {\r\n      this.workFlowMessage.setup();\r\n    }\r\n  }\r\n}\r\n\r\nexport { CommandServicesModule };\r\n","import { RuntimeFrameworkService } from '../rtf-service';\r\nimport { UID } from '@farris/devkit';\r\n\r\nexport class MessagePipe {\r\n    constructor(public token: string, private rtfService: RuntimeFrameworkService) { }\r\n    /**\r\n     * åç®¡éåéæ¶æ¯\r\n     * @param message æ¶æ¯\r\n     */\r\n    public sendMessage(message: any) {\r\n        this.rtfService.subjectNotify(this.token, message);\r\n        return this;\r\n    }\r\n    /**\r\n     * çå¬ç®¡éæ¶æ¯\r\n     * @param handler æ¶æ¯å¤çå¨\r\n     */\r\n    public listen(handler: (data: any) => void): () => void {\r\n        const observerToken = UID.create();\r\n        this.rtfService.subjectResponse(this.token, handler, observerToken);\r\n        const unListen = () => {\r\n            this.rtfService.responseUnSubscribe(this.token, observerToken);\r\n        };\r\n        return unListen;\r\n    }\r\n    /**\r\n     * éæ¯ç®¡é\r\n     */\r\n    public destory() {\r\n        this.rtfService.subjectRemove(this.token);\r\n    }\r\n}\r\n","import { MessagePipe } from './message-pipe';\r\nimport { RuntimeFrameworkService } from '../rtf-service';\r\nimport { Subject } from 'rxjs';\r\nimport { QuerystringService } from '../querystring';\r\n\r\nexport class MessagePipeService {\r\n  private static rtfService: RuntimeFrameworkService = new RuntimeFrameworkService();\r\n  private static querystringService: QuerystringService = new QuerystringService();\r\n  /**\r\n   * éè¿tokenè·åæ¶æ¯ç®¡é\r\n   * @param token æ¶æ¯ç®¡éæ è¯\r\n   */\r\n  public static get(token: string): MessagePipe {\r\n    const pipe = new MessagePipe(token, this.rtfService);\r\n    return pipe;\r\n  }\r\n  /**\r\n   * åå»ºæ¶æ¯ç®¡é\r\n   * @param pipeName ç®¡éåç§°\r\n   * @param useFormContext æ¯å¦ä½¿ç¨è¡¨åä¸ä¸æåå»ºç®¡éæ è¯\r\n   * @param pipeType ç®¡éç±»å(å¯é)ï¼é»è®¤Subject<any>\r\n   */\r\n  public static create(pipeName: string, useFormContext: boolean, pipeType?: Subject<any>): MessagePipe {\r\n    let options = null;\r\n    if (useFormContext) {\r\n      const params = this.querystringService.parse(window.location.hash);\r\n      const { funcId, appId, appEntrance } = params;\r\n      options = { funcId, appId, appEntrance };\r\n    }\r\n    const token = this.rtfService.subjectRegister(pipeName, options, pipeType);\r\n    if (!token) {\r\n      return null;\r\n    }\r\n    const pipe = new MessagePipe(token, this.rtfService);\r\n    return pipe;\r\n  }\r\n}\r\n","import { Inject, Injectable, Injector } from '@angular/core';\r\nimport { AppContext, BackEndMessage, BindingList, DataPropInfo, EventBus, FrameComponent, FrameContext, NgFormControl, Translate, TranslateToken } from '@farris/devkit';\r\n/**\r\n * åç«¯æ¶æ¯å¤çæå¡\r\n * @description\r\n * ### æå¡æ³¨å¥ä½ç½®\r\n *  1ãæ´ä¸ªè¡¨åçroot-component \r\n *  2ãå¼¹åºçªå£çroot-component \r\n */\r\n@Injectable()\r\nexport class BackEndMessageHandler implements BackEndMessage.IBackEndMessageHandler {\r\n  constructor(private injector: Injector, private frameContext: FrameContext, @Inject(TranslateToken) private translate: Translate) { }\r\n  /**\r\n   * å¤çåç«¯è¿åçæ¶æ¯æéè¯¯\r\n   * @param message æ¶æ¯æéè¯¯\r\n   */\r\n  public handle(message: BackEndMessage.IMessage, context: any) {\r\n    const isException = context && context.isException || false;\r\n    const hasThrowError = context && context.hasThrowError || false;\r\n    const eventBus = context && context.eventBus || null;\r\n    const error = context && context.error || null;\r\n    const formAppContext = context && context.formAppContext || null;\r\n    const result = this.collect(message, isException, hasThrowError, eventBus, error, formAppContext);\r\n    if (result && result.form && result.form.length > 0) {\r\n      result.form.forEach((item: { frameContext: FrameContext, message: any }) => {\r\n        item.frameContext.viewModel.form.updateFormErrors(item.message, true, 'backend');\r\n      });\r\n    } else {\r\n      this.resetFormMessage(message.context.appContext, message.context.ns);\r\n    }\r\n    const targetFrameContext: FrameContext = this.findTargetFrameContext(this.frameContext);\r\n    if (result && result.all && result.all.length > 0) {\r\n      targetFrameContext.viewModel.verifycationChanged.next(result.all);\r\n    } else {\r\n      if (result !== null) {\r\n        targetFrameContext.viewModel.verifycationChanged.next([]);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * æ¶éæ±æ»ä¿¡æ¯åformä¿¡æ¯\r\n   * @param backEndMessage \r\n   */\r\n  private collect(backEndMessage: BackEndMessage.IMessage, isException: boolean = false, hasThrowError: boolean = false, eventBus: EventBus = null, error: any = null, formAppContext: AppContext = null): { form: { frameContext: FrameContext, message: any }[], all: any[] } {\r\n    const bizMessages = backEndMessage && backEndMessage.bizMessages || null;\r\n    const appContext = backEndMessage && backEndMessage.context.appContext;\r\n    const ns = backEndMessage.context.ns;\r\n    if (!bizMessages || bizMessages.length < 1) {\r\n      return null;\r\n    }\r\n    const result = {\r\n      form: [],\r\n      all: []\r\n    };\r\n    let hasFormlessError = false;\r\n    for (let bizMessage of bizMessages) {\r\n      const message = bizMessage.message;\r\n      const location = bizMessage.location || null;\r\n      const columns = location && location.columns || null;\r\n      const nodeCode = location && location.nodeCode || null;\r\n      const rows = location && location.rows;\r\n      const bindingPath = this.getBindingPath(appContext, ns, nodeCode);\r\n      const bindingPaths = bindingPath && bindingPath.split('/').filter(p => p);\r\n\r\n      // ç®åä»å¤çælocationï¼ä¸æidãååãè¡¨åçã\r\n      if (!location || !columns || columns.length < 1 || !nodeCode || !rows || rows.length < 1) {\r\n        continue;\r\n      }\r\n      // éåæ°æ®è¡\r\n      for (let row of rows) {\r\n        for (let column of columns) {\r\n          // è·åå°ææç»å®è¯¥åæ°æ®çframeContext\r\n          let frameContexts = this.getFrameContextsByBindingPathAndColumnName(appContext, ns, bindingPath, column);\r\n          if (!frameContexts || frameContexts.length < 1) {\r\n            // æ²¡æä»»ä½ä¸ä¸ªç»ä»¶ç»å®è¯¥åçæ°æ®\r\n            hasFormlessError = true;\r\n            continue;\r\n          }\r\n          // æé¤æåªè¯»datagrid\r\n          frameContexts = frameContexts.filter((frameContext: FrameContext) => {\r\n            const isDataGridComponent = this.isDataGridComponent(frameContext.frameComponent);\r\n            if (isDataGridComponent) {\r\n              const isReadonlyDataGrid = this.isReadonlyDataGrid(frameContext.frameComponent);\r\n              if (isReadonlyDataGrid) {\r\n                return false;\r\n              } else {\r\n                return true;\r\n              }\r\n            }\r\n            return true;\r\n          });\r\n          // éåçè¡æ¯å¦ä¸ºå½åè¡\r\n          const isCurrentRow = this.isCurrentRow(appContext, ns, bindingPath, row);\r\n          // å¦ææ¯å½åè¡çè¯éè¦å°éè¯¯ä¿¡æ¯æ¾å°formä¸­\r\n          if (isCurrentRow) {\r\n            // å¿½ç¥grid\r\n            // const formFrameContexts = frameContexts.filter(frameContext => !this.isGridComponent(frameContext.frameComponent));\r\n            if (frameContexts && frameContexts.length > 0) {\r\n              frameContexts.forEach((frameContext: FrameContext) => {\r\n                // åªå¤çäºä¸ä¸ªç»ä»¶ä¸­ååªç»å®å°ä¸ä¸ªåç«¯æ§ä»¶çåºæ¯\r\n                const formControls = this.getFormControlByColumnName(frameContext, column);\r\n                if (formControls && formControls.length > 0) {\r\n                  formControls.forEach(([domPropertyName, formControl]) => {\r\n                    //const domPropertyName = formControl && formControl. || null;\r\n                    this.mergeMessage(result.form, frameContext, domPropertyName, message);\r\n                  });\r\n                }\r\n\r\n                //if (formControl && domPropertyName) {\r\n\r\n                //}\r\n              });\r\n            } else {\r\n            }\r\n          }\r\n          // å°éè¯¯ä¿¡æ¯æ¾å°æ±æ»ä¸­\r\n          frameContexts.forEach((frameContext: FrameContext) => {\r\n            const viewModelName = frameContext.viewModel.form.formGroupName;\r\n            const formControls = this.getFormControlByColumnName(frameContext, column);\r\n            if (formControls && formControls.length > 0) {\r\n              const [domPropertyName, formControl] = formControls.find(([propertyName, formControl]) => propertyName && propertyName.length > 0);\r\n              // const domPropertyName = domProperty && domProperty.propertyName;\r\n              const bindingList = frameContext.viewModel.bindingData.getValue(bindingPaths) as BindingList;\r\n              let index = bindingList.getIndexById(row);\r\n              const primary = `${row}_${column}_${message}`;\r\n              // TODO:è½ç¶è½çº æ­£æ±æ»æ¶æ¯æ¾ç¤ºéå¤çé®é¢ï¼ä½å¯è½å¯¼è´ç¹å»éè¯¯æ æ³å®ä½å°å¯¹åºæ§ä»¶çé®é¢ï¼å¾åç»­ä¼å\r\n              if (index >= 0 && result.all.findIndex(p => p.id === primary) === -1) {\r\n                // æ°æ®æºä¸­æå¤äº1è¡æ¶æ¾ç¤ºç´¢å¼\r\n                const position = (bindingList && bindingList.length > 1) ? (index + 1) : -1;\r\n                const title = this.buildItemTitle(viewModelName, formControl.name || formControl.defaultI18nValue || domPropertyName, position);\r\n                const item = {\r\n                  id: primary,\r\n                  index,\r\n                  targetField: formControl.id,\r\n                  title,\r\n                  msg: message,\r\n                  namespace: ns,\r\n                  bindingPath,\r\n                  type: 'error'\r\n                };\r\n                result.all.push(item);\r\n              }\r\n            }\r\n\r\n          });\r\n        }\r\n      }\r\n    }\r\n    if (hasFormlessError && isException && !hasThrowError && eventBus) {\r\n      eventBus.post('Exception', '', 'onException', error, formAppContext);\r\n    }\r\n    return result;\r\n  }\r\n  private mergeMessage(formItems: { frameContext: FrameContext, message: { [domPropertyName: string]: { errors: { [messageType: string]: { name: string } } } } }[], frameContext: FrameContext, domPropertyName: string, message: string) {\r\n    const targetItem = formItems.find(item => item.frameContext.frameId === frameContext.frameId);\r\n    if (targetItem) {\r\n      const isPropertyExist = targetItem.message && Object.keys(targetItem.message).includes(domPropertyName);\r\n      const messageType = `backend-message-${Object.keys(targetItem.message).length + 1}`;\r\n      if (isPropertyExist) {\r\n        targetItem.message[domPropertyName]['errors'][messageType] = { name: message };\r\n      } else {\r\n        targetItem.message[domPropertyName] = { errors: { [messageType]: { name: message } } };\r\n      }\r\n    } else {\r\n      formItems.push({\r\n        frameContext: frameContext,\r\n        message: {\r\n          [domPropertyName]: {\r\n            errors: {\r\n              'backend-message-1': { name: message }\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  private buildItemTitle(viewModelName: string, propertyName: string, index: any) {\r\n    const template = {\r\n      'zh-CHS': {\r\n        viewModelName: `$viewModel`,\r\n        index: `ç¬¬ $index è¡`,\r\n        propertyName: `- $propertyName`\r\n      },\r\n      'en': {\r\n        viewModelName: `$viewModel`,\r\n        index: `row $index`,\r\n        propertyName: `- $propertyName`\r\n      },\r\n      'zh-CHT': {\r\n        viewModelName: `$viewModel`,\r\n        index: `ç¬¬ $index è¡`,\r\n        propertyName: `- $propertyName`\r\n      }\r\n    };\r\n    const currentLanguage = this.translate.getCurrentLanguage() || 'zh-CHS';\r\n    const message = [];\r\n    if (viewModelName) {\r\n      message.push(template[currentLanguage]['viewModelName'].replace('$viewModel', viewModelName));\r\n    }\r\n    if (index > 0) {\r\n      message.push(template[currentLanguage]['index'].replace('$index', index));\r\n    }\r\n    if (propertyName) {\r\n      message.push(template[currentLanguage]['propertyName'].replace('$propertyName', propertyName));\r\n    }\r\n    return message.join(' ');\r\n  }\r\n  /**\r\n   * æ ¹æ®è¡¨åænodeCodeè·åç»å®è·¯å¾\r\n   * @param appContext appContext\r\n   * @param ns ns\r\n   * @param nodeCode è¡¨å\r\n   */\r\n  private getBindingPath(appContext: AppContext, ns: string, nodeCode: string) {\r\n    const frameContext = this.getFrameContext(appContext, ns);\r\n    return frameContext.repository.entityTypeInfo.getBindingPathByTableName(nodeCode);\r\n  }\r\n  /**\r\n   * éè¿ç»å®è·¯å¾åååæ¾å°ææç¬¦åæ¡ä»¶çè§å¾æ¨¡å(åæ¬gridåform)\r\n   * @param appContext appContext\r\n   * @param ns namespace\r\n   * @param bindingPath ç»å®è·¯å¾\r\n   * @param columnName åå\r\n   */\r\n  private getFrameContextsByBindingPathAndColumnName(appContext: AppContext, ns: string, bindingPath: string, columnName: string): FrameContext[] {\r\n    let frameContexts = appContext.frameContextManager.getFrameContexts();\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      // æ¾å°formä¸­ææ§ä»¶çframeContext\r\n      frameContexts = frameContexts.filter((frameContext: FrameContext) => {\r\n        // åºæ¬æ¡ä»¶æ¯å¦æ»¡è¶³\r\n        let isValidFrameContext = frameContext.namespace === ns && frameContext.viewModel.bindingPath === bindingPath && frameContext.viewModel.form && frameContext.viewModel.form.controls && Object.keys(frameContext.viewModel.form.controls).length > 0;\r\n        if (!isValidFrameContext) {\r\n          return false;\r\n        }\r\n        // åéè¿ååè¿æ»¤\r\n        const bindingPaths = bindingPath.split('/').filter(p => p);\r\n        const dataTypeInfo = frameContext.repository.entityTypeInfo.getTypeInfoByPath(bindingPaths);\r\n        if (dataTypeInfo) {\r\n          const dataPropInfos = Array.from(dataTypeInfo.propInfoMap.values());\r\n          // ä»å½åå®ä½å±æ§ä¸­æ¾å°æ°æ®å­æ®µä¸ºååçå±æ§\r\n          const entityPropertyInfo = dataPropInfos.find((propInfo: DataPropInfo) => propInfo.metadataInfo && (propInfo.metadataInfo.originalDataField === columnName || propInfo.metadataInfo.dataField === columnName));\r\n          if (entityPropertyInfo) {\r\n            const entityPropertyName = entityPropertyInfo.name;\r\n            const ngFormControl = Object.values(frameContext.viewModel.form.ngFormControls).find(item => item.binding === entityPropertyName);\r\n            if (ngFormControl) {\r\n              return true;\r\n            } else {\r\n              const item = Object.keys(frameContext.viewModel.form.ngFormControls).find(key => key === entityPropertyName);\r\n              return item ? true : false;\r\n            }\r\n          } else {\r\n            return false;\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n      return frameContexts;\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * æ¯å¦ä¸ºdatagridç»ä»¶\r\n   * @param frameComponent component\r\n   */\r\n  private isDataGridComponent(frameComponent: FrameComponent) {\r\n    const columnNames = frameComponent.context.viewModel['dataGridColumnsName'] || null;\r\n    return columnNames ? true : false;\r\n  }\r\n  /**\r\n   * gridç»ä»¶æ¯å¦æ¯åªè¯»ç\r\n   * @param frameComponent frameComponent\r\n   * @returns \r\n   */\r\n  private isReadonlyDataGrid(frameComponent: FrameComponent) {\r\n    const frameContext = frameComponent.context;\r\n    const dataGridColumnsName = frameContext.viewModel['dataGridColumnsName'] || null;\r\n    if (dataGridColumnsName) {\r\n      const datagridColumns: any[] = frameContext.viewModel[dataGridColumnsName];\r\n      return datagridColumns.every((group: Array<any>) => {\r\n        return group.every(item => !item.editor);\r\n      });\r\n    } else {\r\n      throw new Error(`ä¼ å¥çç»ä»¶ä¸æ¯ä¸ä¸ªè¡¨æ ¼ï¼`);\r\n    }\r\n  }\r\n  /**\r\n   * idæ¯å¦ä¸ºå½åè¡\r\n   * @param appContext appContext\r\n   * @param ns namespace\r\n   * @param bindingPath bindingPath\r\n   * @param id id\r\n   */\r\n  private isCurrentRow(appContext: AppContext, ns: string, bindingPath: string, id: string) {\r\n    const bindingPaths = bindingPath.split('/').filter(p => p);\r\n    const frameContext = this.getFrameContext(appContext, ns);\r\n    const bindingData = frameContext.bindingData;\r\n    const bindingList = bindingData.getValue(bindingPaths) as BindingList;\r\n    return bindingList.currentItem.primaryKeyValue === id;\r\n  }\r\n  /**\r\n   * è·åå½ånsä¸çrootFrameContext\r\n   * @param appContext appcontext\r\n   * @param ns namespace\r\n   */\r\n  private getFrameContext(appContext: AppContext, ns: string) {\r\n    const frameContexts = appContext.frameContextManager.getFrameContexts();\r\n    if (frameContexts && frameContexts.length > 0) {\r\n      const randomFrameContext = frameContexts.find(frameContext => frameContext.namespace === ns);\r\n      if (randomFrameContext) {\r\n        const virtualRootFrameContext = randomFrameContext.getVirtualRootFrameContext();\r\n        return virtualRootFrameContext;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * éè¿ç»å®è·¯å¾åååè·åç»å®å°è¯¥åçformControl\r\n   */\r\n  private getFormControlByColumnName(frameContext: FrameContext, columnName: string): Array<[string, NgFormControl]> {\r\n    const bindingPaths = frameContext.viewModel.bindingPath.split('/').filter(p => p);\r\n    // éè¿bindingPathæ¾å°å¯¹åºçå®ä½ä¿¡æ¯\r\n    const typeInfo = frameContext.repository.entityTypeInfo.getTypeInfoByPath(bindingPaths);\r\n\r\n    const propsInfo = Array.from(typeInfo.propInfoMap.values());\r\n    const propInfo = propsInfo.find((propInfo: DataPropInfo) => propInfo.metadataInfo && (propInfo.metadataInfo.originalDataField === columnName || propInfo.metadataInfo.dataField === columnName));\r\n    if (propInfo) {\r\n      const mappingName = propInfo.name;\r\n      const formControls: Array<[string, NgFormControl]> = Object.entries(frameContext.viewModel.form.ngFormControls).filter((item) => item[1].binding === mappingName || item[0] === mappingName);\r\n      // const ngFormControl = Object.values(frameContext.viewModel.form.ngFormControls).find(item => item.binding === mappingName);\r\n      if (formControls) {\r\n        return formControls;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  private resetFormMessage(appContext: AppContext, ns: string) {\r\n    const frameContexts = appContext.frameContextManager.getFrameContexts().filter(frameContext => frameContext.namespace === ns);\r\n    frameContexts.forEach(frameContext => frameContext && frameContext.viewModel && frameContext.viewModel.form && frameContext.viewModel.form.clearBackendError());\r\n  }\r\n  /**\r\n   * éå½æ¾å°å±ç¤ºæ¶æ¯çç»ä»¶ä¸ä¸æ\r\n   * @param frameContext frameContext\r\n   */\r\n  private findTargetFrameContext(frameContext: FrameContext): FrameContext {\r\n    const virtualRootFrameContext = frameContext.getVirtualRootFrameContext();\r\n    const virtualRootComponent = virtualRootFrameContext.frameComponent;\r\n    const isDialogComponent = virtualRootComponent && virtualRootComponent['isDialogRootComponent'] || false;\r\n    if (isDialogComponent) {\r\n      // å¦ææ¶æ¯å¤çæå¡æ¯å¼¹çªåçï¼åæ¶æ¯æç¤ºå±ç¤ºå¨å¼¹çªå\r\n      return virtualRootFrameContext;\r\n    } else {\r\n      // å½åæ¶æ¯æå¡ä¸å¨å¼¹çªåï¼éå½åä¸æ¥æ¾ï¼æ¾å°ç¬¬ä¸ä¸ªå¼¹çªï¼å¦ææ¾ä¸å°åæ¾å°æä¸çroot-component\r\n      const parentFrameContext = virtualRootFrameContext.parent;\r\n      if (parentFrameContext) {\r\n        return this.findTargetFrameContext(parentFrameContext);\r\n      } else {\r\n        return virtualRootFrameContext;\r\n      }\r\n    }\r\n  }\r\n}","import { FormLoadingService } from './lib/form-loading/form-loading.service';\r\nimport { FormMessageService } from './lib/form-message.service';\r\nimport { HideEventService } from './lib/form-loading/hide-event.service';\r\nimport { FormNotifyService } from './lib/form-notify.service';\r\nimport { FormErrorService } from './lib/error/form-error.service';\r\nimport { FormWizardService } from './lib/form-wizard.service';\r\n\r\nimport { CheckService } from './lib/check.service';\r\nimport { DataCheckService } from './lib/data-check.service';\r\nimport { EventService } from './lib/event.service';\r\nimport { MenuStateService } from './lib/menu-state.service';\r\nimport { RouterService } from './lib/router.service';\r\nimport { LanguageService } from './lib/languag.service';\r\nimport { TAB_EVENT, TAB_QUERY_STRING, BodyWithRequestInfo } from './lib/types';\r\nimport { QuerystringService } from './lib/querystring';\r\nimport { RuntimeFrameworkService } from './lib/rtf-service';\r\nimport { NavigationEventService } from './lib/navigation-event.service';\r\nimport { NavigationService } from './lib/navigation.service';\r\nimport { NavigationMiddlewareService } from './lib/navigation-middleware.service';\r\nimport { GridMiddlewareService } from './lib/grid.middleware.service';\r\nimport { ParamService } from './lib/param.service';\r\nimport { KeybindingService } from './lib/keybinding-service';\r\nimport { FilterConditionService } from './lib/filter-condition.service';\r\n\r\nimport { UIStateService } from './lib/ui-state.service';\r\nimport { StateMachineService } from './lib/state-machine.service';\r\nimport { BindingDataService } from './lib/binding-data.service';\r\nimport { CommandService } from './lib/command-service';\r\nimport { ApplicationParamService } from './lib/application-param.service';\r\nimport {\r\n  EntityTraversingService, EntityManipulationService, EntityAggregationService,\r\n  EntityListService, EntityService\r\n} from './lib/entity-services/index';\r\nimport { ValidationService } from './lib/validation.service';\r\nimport { FocusInvalidService, FocusableInvalidationGrid } from './lib/focus-invalid.service';\r\nimport { ChangeItemService } from './lib/change-item.service';\r\n\r\n// data-services\r\nimport {\r\n  ListDataService, CardDataService, SubListDataService, TreeDataService,\r\n  RemoveDataService, SaveDataService, EditDataService, FilterConditionDataService, SubTreeDataService\r\n} from './lib/data-services/index';\r\n\r\nimport { BeActionService } from './lib/be-action.service';\r\nimport { ApproveService } from './lib/approve.service';\r\nimport { PrintService } from './lib/print.service';\r\nimport { AttachmentDataService, AttachmentService, FileService } from './lib/attachment/index';\r\nimport { DialogService } from './lib/dialog.service';\r\nimport { SidebarService } from './lib/sidebar-service';\r\nimport { FarrisFormService, FARRIS_FORM_COMPONENTS } from './lib/farris-form.service';\r\nimport { FilterService } from './lib/filter-service';\r\nimport { ComponentManagerService } from './lib/component-manager.service';\r\nimport { AuthorityService } from './lib/authority/authority.service';\r\nimport { Authority } from './lib/authority/authority';\r\n\r\n// exception_handler\r\nimport { ExceptionHandler } from './lib/exception.handler';\r\nimport {\r\n  FARRIS_COMMAND_SERVICE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS,\r\n  DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS\r\n} from './lib/providers/index';\r\nimport { CommandServicesModule } from './lib/command-services-module';\r\nimport { MessagePipeService, MessagePipe } from './lib/rtf-message/index';\r\nimport { EndEditService } from './lib/end-edit.service';\r\nimport { RemoteSummaryService } from './lib/remote-summary.service';\r\nimport { BatchEditService } from './lib/batch-edit.service';\r\nimport { DiscussionGroupService } from './lib/discussion-group.service';\r\nimport { FormManifestService, FormExpressionManifestService } from './lib/manifest/index';\r\nimport { UserSettingsService } from './lib/user-settings.service';\r\nimport { LocalizationService } from './lib/localization.service';\r\nimport { DataGridService } from './lib/data-grid.service';\r\nimport { BackEndMessageHandler } from './lib/back_end_message_handler';\r\nimport { FormAttentionService } from './lib/form-attention.service';\r\nimport { FormNotifyStrategyService } from './lib/form-notify-strategy.service';\r\nimport { FeatureDataService, FeatureEditService, FeatureRepository } from './lib/feature-edit/index';\r\nimport { ExpressionService } from './lib/expression_service';\r\nimport { DirtyCheckingService } from './lib/dirty-checking.service';\r\nimport { PopUpService } from './lib/pop_up.service';\r\nimport { WorkFlowMessage, WorkFlowMessageService, WorkFlowMessageHandler, WorkFlow } from './lib/work-flow/index';\r\nimport { FormControlService } from './lib/form-control.service';\r\nimport { BindingPathService } from './lib/binding-path.service';\r\nimport { FrameContextService } from './lib/frame-context.service';\r\nimport { ViewModelService } from './lib/view-model.service';\r\nimport { FormService } from './lib/form.service';\r\nimport { PaginationService } from './lib/pagination.service';\r\n\r\nexport {\r\n  FormLoadingService,\r\n  FormMessageService,\r\n  HideEventService,\r\n  FormNotifyService,\r\n  FormErrorService,\r\n  FormWizardService,\r\n  CheckService,\r\n  DataCheckService,\r\n  EventService,\r\n  MenuStateService,\r\n  RouterService,\r\n  LanguageService,\r\n  TAB_EVENT,\r\n  TAB_QUERY_STRING,\r\n  BodyWithRequestInfo,\r\n  QuerystringService,\r\n  RuntimeFrameworkService,\r\n  NavigationEventService,\r\n  NavigationService,\r\n  NavigationMiddlewareService,\r\n  GridMiddlewareService,\r\n  ParamService,\r\n  FilterConditionService,\r\n  FilterConditionDataService,\r\n\r\n  // devkit\r\n  UIStateService,\r\n  StateMachineService,\r\n  BindingDataService,\r\n  CommandService,\r\n  ValidationService,\r\n  FocusInvalidService,\r\n  FocusableInvalidationGrid,\r\n  ApplicationParamService,\r\n  ChangeItemService,\r\n\r\n  // entity-services\r\n  EntityTraversingService,\r\n  EntityManipulationService,\r\n  EntityAggregationService,\r\n  EntityListService,\r\n  EntityService,\r\n\r\n  // data-services\r\n  ListDataService,\r\n  CardDataService,\r\n  SubListDataService,\r\n  TreeDataService,\r\n  RemoveDataService,\r\n  SaveDataService,\r\n  EditDataService,\r\n  RemoteSummaryService,\r\n  SubTreeDataService,\r\n  BeActionService,\r\n  ApproveService,\r\n  PrintService,\r\n  AttachmentDataService,\r\n  AttachmentService,\r\n  FileService,\r\n  DialogService,\r\n  SidebarService,\r\n  FilterService,\r\n  AuthorityService,\r\n  Authority,\r\n\r\n  FarrisFormService,\r\n  FARRIS_FORM_COMPONENTS,\r\n  ExceptionHandler,\r\n  KeybindingService,\r\n\r\n  FARRIS_COMMAND_SERVICE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_MODULE_PROVIDERS,\r\n  FARRIS_COMMAND_SERVICE_FRAME_PROVIDERS,\r\n  DYNAMIC_FARRIS_COMMAND_SERVICE_PROVIDERS,\r\n  CommandServicesModule,\r\n  ComponentManagerService,\r\n  MessagePipeService,\r\n  MessagePipe,\r\n  EndEditService,\r\n  BatchEditService,\r\n  DiscussionGroupService,\r\n  FormManifestService,\r\n  FormExpressionManifestService,\r\n  UserSettingsService,\r\n  LocalizationService,\r\n  DataGridService,\r\n  BackEndMessageHandler,\r\n  FormAttentionService,\r\n  FormNotifyStrategyService,\r\n  FeatureDataService,\r\n  FeatureEditService,\r\n  FeatureRepository,\r\n  ExpressionService,\r\n  PopUpService,\r\n  DirtyCheckingService,\r\n  WorkFlowMessage,\r\n  WorkFlowMessageService,\r\n  WorkFlowMessageHandler,\r\n  WorkFlow,\r\n  FormControlService,\r\n  BindingPathService,\r\n  FrameContextService,\r\n  ViewModelService,\r\n  FormService,\r\n  PaginationService\r\n};\r\n\r\n// export * from './public-api-common';\r\n// export * from './public-api-extend';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {BaseDataService as Éµa} from './lib/data-services/base-data.service';\nexport {ListFilterConditionsService as Éµc} from './lib/list-filter/list-filter.service';\nexport {QuerySolutionService as Éµb} from './lib/query-solution/query-solution.service';\nexport {Service as Éµd} from './lib/service';"],"names":["Subject","Injectable","LoadingService","Optional","AppContext","Inject","LOCALE_ID","MessagerService","tslib_1.__extends","date","HttpErrorResponse","from","NotifyService","WizardEventType","WizardService","empty","FrameEventBus","router","Router","RouterParamService","FrameworkService","AppService","InjectionToken","EMPTY","UID","of","concatMap","take","tap","switchMap","every","FrameContext","AppType","FEPageModalService","ActivatedRoute","TranslateToken","map","ReflectiveInjector","ComponentFactoryResolver","Injector","filter","ViewModel","tslib_1.__values","zip","PARENT_CLASS","ChangeType","DataPropGroup","VerifyDetailService","InjectFlags","ElementRef","DatagridComponent","Repository","BefRepositoryUtil","last","throwIfEmpty","Mousetrap.default","StateMachine","BindingData","isObservable","BindingList","Observable","EntityPathConverter","HttpHeaders","FieldMetadataUtil","WfTaskHandlerService","catchError","WFSubmiteService","WFFlowchartService","OutputType","FileType","PrintType","CloudprintService","BindingPathConverter","BefDataPathUtil","FileViewerService","DownloadService","UploadLimit","FileState","BasePathService","DataPathCreator","UploadDialogService","debounceTime","forkJoin","forwardRef","BsModalService","FarrisSidebarService","FARRIS_FORM_COMPONENTS","FrmI18nSettingService","AppContextManager","UserSettingsToken","getDay","addDays","startOfWeek","endOfWeek","startOfMonth","endOfMonth","startOfYear","endOfYear","addWeeks","addMonths","addYears","format","ControlType","FrameworkSessionService","delay","throwError","takeLast","concat","EntityList","Entity","BatchEditDialogService","DateTimeHelperService","UploadService","share","FORM_PATH_TOKEN","HttpClient","FORM_MANIFEST_SERVICE_TOKEN","BigNumber","AttentionService","FeatureEditorService","ExpressionUtil","ENTITY_TEMPLATE","ResolveService","ExpressionExecutor","ChangeDetectorRef","ApplicationRef","QUERYSOLUTION_HANDLER_TOKEN","LISTFILTER_HANDLER_TOKEN","FORM_EXPRESSION_MANIFEST_SERVICE_TOKEN","MESSAGE_SERVICE_TOKEN","NOTIFY_SERVICE_TOKEN","FRAME_COMPONENT_INIT_HANDLER_TOKEN","NgModule","WfTaskHandlerModule"],"mappings":"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"}

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * @Author: 疯狂秀才(lucas huang)
 * @Date: 2018-11-13 14:55:34
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-11-30 10:18:12
 * @Company: Inspur
 * @Version: v0.0.1
 */
import { Component, ElementRef, Renderer2, ViewChild, Input, EventEmitter, Output, ChangeDetectionStrategy } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { LeftBracket, RighttBracket, Relation, CompareOperators, Compare, FilterRelation, ExpressValueType } from '@farris/ui-common/types';
import { FilterService } from './../services/filter.service';
export class FilterGridComponent {
    /**
     * @param {?} el
     * @param {?} render
     * @param {?} filterService
     * @param {?} messagerService
     */
    constructor(el, render, filterService, messagerService) {
        this.el = el;
        this.render = render;
        this.filterService = filterService;
        this.messagerService = messagerService;
        this.LeftBracketData = LeftBracket;
        this.RighttBracketData = RighttBracket;
        this.relationData = Relation;
        this.operators = CompareOperators;
        this.columnSizeData = [60, 50, 120, 100, 60, 120, 50, 50];
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.conditions = [];
        this.columns = [];
        this.enableExpress = false;
        this.enableFrontExpress = false;
        /**
         * 当值类型为 value 时是否显示按钮，默认不显示
         */
        this.useCustomValue = false;
        this.insertType = 'below';
        this.defulatRelation = FilterRelation.And;
        this.showExpress = new EventEmitter();
        this.scrollContainer = null;
        // @ViewChild('ps') psRef: PerfectScrollbarComponent;
        this.currentCondition = null;
        this.newCondition = {
            filterField: '',
            value: '',
            lbracket: '',
            rbracket: '',
            relation: FilterRelation.Empty,
            compare: Compare.Equal,
            expresstype: ExpressValueType.Value
        };
        this.localeService = null;
        this.trackByValue = (/**
         * @param {?} index
         * @param {?} row
         * @return {?}
         */
        (index, row) => {
            return row ? row.value || row : index;
        });
        this.localeService = this.messagerService['localeService'];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.fieldEditor) {
            this.fieldEditor = { type: 'select', options: {} };
        }
        this.initRelationData();
        // this.newCondition.relation = this.defulatRelation || FilterRelation.And;
        if (!this.conditions || !this.conditions.length) {
            /** @type {?} */
            const firstCon = Object.assign({}, this.newCondition);
            this.conditions = [firstCon];
            this.changeConditionList();
        }
        // 默认选中第1行
        this.currentCondition = { index: 0, condition: this.conditions[0] };
    }
    /**
     * @private
     * @return {?}
     */
    initRelationData() {
        if (this.localeService) {
            /** @type {?} */
            const andStr = this.localeService.getValue('filterEditor.relationValue.and');
            /** @type {?} */
            const orStr = this.localeService.getValue('filterEditor.relationValue.or');
            this.relationData = [
                { label: '', value: 0 },
                { label: andStr, value: 1 },
                { label: orStr, value: 2 }
            ];
        }
    }
    // private psUpdate() {
    //     if (this.psRef && this.psRef.directiveRef) {
    //         this.psRef.directiveRef.update();
    //     }
    // }
    /**
     * @private
     * @return {?}
     */
    itemIntoView() {
        if (this.tablebodybox) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const tr = this.tablebodybox.nativeElement.querySelector('tr.selected');
                if (tr) {
                    if (tr.scrollIntoViewIfNeeded) {
                        tr.scrollIntoViewIfNeeded(false);
                    }
                    else {
                        tr.scrollIntoView({ block: 'nearest' });
                    }
                }
            }), 50);
        }
    }
    /**
     * @param {?} index
     * @param {?=} $event
     * @return {?}
     */
    insertCondition(index, $event) {
        if ($event) {
            $event.stopPropagation();
        }
        /** @type {?} */
        const _newCondition = Object.assign({}, this.newCondition, { relation: FilterRelation.And });
        if (this.insertType === 'above') {
            if (index === 0) {
                this.conditions.unshift(_newCondition);
            }
            else {
                this.conditions.splice(index, 0, _newCondition);
            }
        }
        else {
            this.conditions.splice(index + 1, 0, _newCondition);
        }
        this.changeConditionList();
    }
    /**
     * @param {?} index
     * @return {?}
     */
    removeCondition(index) {
        this.conditions.splice(index, 1);
        this.changeConditionList();
        if (this.currentCondition) {
            if (index === this.currentCondition.index) {
                if (this.conditions[index]) {
                    this.currentCondition = { index: index, condition: this.conditions[index] };
                }
                else {
                    if (this.conditions[index - 1]) {
                        this.currentCondition = { index: index - 1, condition: this.conditions[index - 1] };
                    }
                    else {
                        this.currentCondition = null;
                    }
                }
            }
            else {
                if (!this.conditions[this.currentCondition.index]) {
                    if (this.currentCondition.index > index) {
                        this.currentCondition.index = this.currentCondition.index - 1;
                    }
                    else {
                        this.currentCondition.index = this.currentCondition.index + 1;
                    }
                }
            }
        }
    }
    /**
     * @return {?}
     */
    onAddFilter() {
        /** @type {?} */
        const newItem = Object.assign({}, this.newCondition);
        this.conditions.forEach((/**
         * @param {?} n
         * @return {?}
         */
        n => {
            if (n.relation == FilterRelation.Empty || !n.relation) {
                n.relation = FilterRelation.And;
            }
        }));
        this.conditions = [...this.conditions, newItem];
        this.changeConditionList();
        /** @type {?} */
        const newIdx = this.conditions.length - 1;
        this.currentCondition = { index: newIdx, condition: newItem };
    }
    /**
     * @return {?}
     */
    onClear() {
        this.messagerService.question('确认要清空当前所有条件吗？', (/**
         * @return {?}
         */
        () => {
            this.conditions = [];
            this.changeConditionList();
        }));
    }
    /**
     * @return {?}
     */
    onMoveTop() {
        if (this.currentCondition) {
            this.conditions.unshift(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index + 1, 1);
            this.currentCondition.index = 0;
            this.changeConditionList();
        }
    }
    /**
     * @return {?}
     */
    onMovePrev() {
        if (this.currentCondition) {
            /** @type {?} */
            const index = this.currentCondition.index;
            /** @type {?} */
            const tempArr = this.conditions.splice(index, 1);
            this.conditions.splice(index - 1, 0, ...tempArr);
            this.currentCondition.index = index - 1;
            this.changeConditionList();
        }
    }
    /**
     * @return {?}
     */
    onMoveNext() {
        if (this.currentCondition) {
            /** @type {?} */
            const index = this.currentCondition.index;
            /** @type {?} */
            const tempArr = this.conditions.splice(index, 1);
            this.conditions.splice(index + 1, 0, ...tempArr);
            this.currentCondition.index = index + 1;
            this.changeConditionList();
        }
    }
    /**
     * @return {?}
     */
    onMoveBottom() {
        if (this.currentCondition) {
            this.conditions.push(this.currentCondition.condition);
            this.conditions.splice(this.currentCondition.index, 1);
            this.currentCondition.index = this.conditions.length - 1;
            this.changeConditionList();
        }
    }
    /**
     * @private
     * @return {?}
     */
    changeConditionList() {
        this.filterService.conditionsChanged.next(this.conditions);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.itemIntoView();
        }));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    selected($event) {
        this.currentCondition = $event;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    isSelected($event) {
        if (this.currentCondition) {
            return this.currentCondition.index === $event;
        }
        return false;
    }
    /**
     * @param {?} $event
     * @param {?} condition
     * @param {?} value
     * @return {?}
     */
    showExpressDialog($event, condition, value) {
        /** @type {?} */
        let type = 'value';
        if (condition.expresstype == 1) {
            type = 'express';
        }
        else if (condition.expresstype == 'frontExpress') {
            type = 'frontExpress';
        }
        this.showExpress.emit({ event: $event, condition, value, type });
    }
    /**
     * @param {?} $event
     * @param {?} condition
     * @return {?}
     */
    onComboSelectChange($event, condition) {
        if ($event) {
            const { data } = $event;
            if (data) {
                condition.filterField = data['value'];
            }
        }
    }
    /**
     * @return {?}
     */
    validation() {
        return this.filterService.isValid(this.conditions, this.localeService);
    }
}
FilterGridComponent.decorators = [
    { type: Component, args: [{
                selector: 'filter-grid',
                template: "<!-- <div class=\"table-header \">\r\n    <table class=\"table table-bordered\" style=\"margin-bottom: 0\">\r\n        <colgroup>\r\n            <col *ngFor=\"let s of columnSizeData\" [style.width]=\" s + 'px'\">\r\n        </colgroup>\r\n        <thead>\r\n            <tr>\r\n                <th></th>\r\n                <th><b>{{ 'filterEditor.leftBrackets' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.field' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.operator' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.valueType' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.value' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.rightBrackets' | locale }}</b></th>\r\n                <th><b>{{ 'filterEditor.relation' | locale }}</b></th>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</div> -->\r\n<div style=\"\r\n    border-top: 1px solid  white;\r\n    position: absolute;\r\n    top: 38px;\r\n    width: 100%;\r\n    z-index: 2;\r\n\"></div>\r\n<div class=\"table-body flex-fill win11Scroll show nobtn \" style=\"margin-left:14px; margin-right: 0; overflow-y: scroll;\" #tablebodybox>\r\n        <table class=\"table table-bordered\" style=\"margin-bottom: 0;\">\r\n            <thead  style=\"position: sticky; top: 0; z-index: 1;\">\r\n                <tr>\r\n                    <th style=\"width: 60px\"></th>\r\n                    <th style=\"width: 50px\"><b>{{ 'filterEditor.leftBrackets' | locale }}</b></th>\r\n                    <th style=\"width: 120px\"><b>{{ 'filterEditor.field' | locale }}</b></th>\r\n                    <th style=\"width: 100px\"><b>{{ 'filterEditor.operator' | locale }}</b></th>\r\n                    <th style=\"width: 60px\"><b>{{ 'filterEditor.valueType' | locale }}</b></th>\r\n                    <th style=\"width: 120px\"><b>{{ 'filterEditor.value' | locale }}</b></th>\r\n                    <th style=\"width: 50px\"><b>{{ 'filterEditor.rightBrackets' | locale }}</b></th>\r\n                    <th style=\"width: 50px\"><b>{{ 'filterEditor.relation' | locale }}</b></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr *ngFor=\"let condition of conditions; let index=index;\" (click)=\"selected({'index':index, 'condition': condition})\" [class.selected]=\"isSelected(index)\" >\r\n                    <td style=\"text-overflow: unset;\">\r\n                        <button type=\"button\" (click)=\"insertCondition(index, $event)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-plus\"></span></button>\r\n                        <button type=\"button\" (click)=\"removeCondition(index)\" class=\"k-button k-button-icon k-flat\"><span class=\"k-icon k-i-minus\"></span></button>\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <select class=\"form-control filter-select\" [(ngModel)]=\"condition.lbracket\" name=\"lbracket\"\r\n                        single-select [panelRef]=\"selectlbracketpanel\" [items]=\"LeftBracketData\" [container]=\"scrollContainer || tablebodybox \">\r\n                            <!-- <option *ngFor=\"let item of LeftBracketData\" [value]=\"item\">{{ item }}</option> -->\r\n                        </select>\r\n\r\n                        <div #selectlbracketpanel class=\"single-select-panel f-area-hide\">\r\n                            <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                <li class=\"dropdown-item p-0 px-1\" style=\"line-height:26px;height:26px\" *ngFor=\"let col of LeftBracketData; trackBy: trackByValue\" [attr.value]=\"col\" [class.active]=\"condition.lbracket === col\">{{ col }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <ng-container *ngIf=\"fieldEditor.type === 'select'\" >\r\n                            <select class=\"form-control filter-select\" [(ngModel)]=\"condition.filterField\" name=\"filterField\" single-select [panelRef]=\"selectcolpanel\" [items]=\"columns\" [container]=\"scrollContainer || tablebodybox \">\r\n                                <!-- <option *ngFor=\"let col of columns\" [value]=\"col.value\">{{ col.label }}</option> -->\r\n                            </select>\r\n\r\n                            <div #selectcolpanel class=\"single-select-panel f-area-hide\" style=\"max-height: 200px;overflow: auto;\">\r\n                                <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                    <li class=\"dropdown-item\" *ngFor=\"let col of columns; trackBy: trackByValue\" [attr.value]=\"col.value\" [class.active]=\"condition.filterField === col.value\">{{ col.label }}</li>\r\n                                </ul>\r\n                            </div>\r\n\r\n                        </ng-container>\r\n\r\n                        <farris-combo-lookup *ngIf=\"fieldEditor.type === 'combo-tree'\" name=\"filterField\"\r\n                            [idField]=\"fieldEditor?.options?.idField ||'value'\"\r\n                            [textField]=\"fieldEditor?.options?.textField ||'label'\"\r\n                            [displayType]=\"'LOOKUPTREELIST'\" [useValue]=\"true\"\r\n                            [useTreeView]=\"true\"\r\n                            [columns]=\"fieldEditor?.options?.columns || []\"\r\n                            [data]=\"columns\"\r\n                            [(ngModel)]=\"condition.filterField\"\r\n                            [remoteSearch]=\"false\"\r\n                            [autoWidth]=\"fieldEditor?.options?.autoWidth\"\r\n                            [panelWidth]=\"fieldEditor?.options?.panelWidth || 200\">\r\n                        </farris-combo-lookup>\r\n\r\n\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <select class=\"form-control filter-select\" name=\"compare\" [(ngModel)]=\"condition.compare\" single-select [panelRef]=\"selectcomparepanel\" [items]=\"operators\" [container]=\"scrollContainer || tablebodybox \">\r\n                            <!-- <option *ngFor=\"let item of operators\" [value]=\"item.value\">{{item.label}}</option> -->\r\n                        </select>\r\n                        <div #selectcomparepanel class=\"single-select-panel f-area-hide\" style=\"max-height: 200px;overflow: auto;\">\r\n                            <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                <li class=\"dropdown-item\" *ngFor=\"let col of operators; trackBy: trackByValue\" [attr.value]=\"col.value\" [class.active]=\"condition.compare === col.value\">{{ col.label }}</li>\r\n                            </ul>\r\n                        </div>\r\n\r\n\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <select class=\"form-control filter-select\" name=\"expresstype\" [(ngModel)]=\"condition.expresstype\" \r\n                        single-select [panelRef]=\"selectexpresstypepanel\" [container]=\"scrollContainer || tablebodybox \">\r\n                            <!-- <option [value]=\"0\">{{'filterEditor.expressType.value' | locale }}</option>\r\n                            <option [value]=\"1\" *ngIf=\"enableExpress\" >{{'filterEditor.expressType.express' | locale }}</option>\r\n                            <option [value]=\"'frontExpress'\" *ngIf=\"enableFrontExpress\" >{{'filterEditor.expressType.frontExpress' | locale }}</option> -->\r\n                        </select>\r\n                        <div #selectexpresstypepanel class=\"single-select-panel f-area-hide\">\r\n                            <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                <li style=\"line-height:26px;height:26px\"  class=\"dropdown-item p-0 px-1\" [value]=\"0\" [class.active]=\"condition.expresstype == 0\" >{{'filterEditor.expressType.value' | locale }}</li>\r\n                                <li style=\"line-height:26px;height:26px\"  class=\"dropdown-item p-0 px-1\" [value]=\"1\" [class.active]=\"condition.expresstype == 1\" *ngIf=\"enableExpress\" >{{'filterEditor.expressType.express' | locale }}</li>\r\n                                <li style=\"line-height:26px;height:26px\"  class=\"dropdown-item p-0 px-1\" [value]=\"'frontExpress'\" [class.active]=\"condition.expresstype === 'frontExpress'\" *ngIf=\"enableFrontExpress\" >{{'filterEditor.expressType.frontExpress' | locale }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <input-group name=\"value\" [(ngModel)]=\"condition.value\" [groupText]=\"condition.expresstype == 1||condition.expresstype==='frontExpress' || useCustomValue ?groupIcon: ''\"\r\n                        (clickHandle)=\"showExpressDialog($event, condition, condition.value)\"></input-group>\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <select class=\"form-control filter-select\"  [(ngModel)]=\"condition.rbracket\" name=\"rbracket\" single-select [panelRef]=\"selectrbracketpanel\" [items]=\"RighttBracketData\" [container]=\"scrollContainer || tablebodybox \">\r\n                            <!-- <option *ngFor=\"let item of RighttBracketData\" [value]=\"item\">{{ item }}</option> -->\r\n                        </select>\r\n\r\n                        <div #selectrbracketpanel class=\"single-select-panel f-area-hide\">\r\n                            <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                <li class=\"dropdown-item p-0 px-1\" style=\"line-height:26px;height:26px\" *ngFor=\"let col of RighttBracketData; trackBy: trackByValue\" [attr.value]=\"col\" [class.active]=\"condition.rbracket === col\">{{ col }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                    <td class=\"px-1\">\r\n                        <select class=\"form-control filter-select\" [(ngModel)]=\"condition.relation\" name=\"relation\" single-select [panelRef]=\"selectrelationpanel\" [items]=\"relationData\" [container]=\"scrollContainer || tablebodybox \">\r\n                            <!-- <option *ngFor=\"let item of relationData\" [value]=\"item.value\">{{ item.label }}</option> -->\r\n                        </select>\r\n\r\n                        <div #selectrelationpanel class=\"single-select-panel f-area-hide\">\r\n                            <ul class=\"dropdown-menu show\" style=\"position:relative;min-width: 100%;border:none; box-shadow: none;\">\r\n                                <li class=\"dropdown-item p-0 px-1\" style=\"line-height:26px;height:26px\" *ngFor=\"let col of relationData; trackBy: trackByValue\" [attr.value]=\"col.value\" [class.active]=\"condition.relation == col.value\">{{ col.label }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n</div>\r\n<div style=\"flex-shrink: 0; margin: 0 14px;\">\r\n<filter-footer\r\n(addFilter)=\"onAddFilter()\"\r\n(clearFilter)=\"onClear()\"\r\n(moveTop)=\"onMoveTop()\"\r\n(movePrev)=\"onMovePrev()\"\r\n(moveNext)=\"onMoveNext()\"\r\n(moveBottom)=\"onMoveBottom()\"></filter-footer>\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.Default,
                styles: [`
        .filter-select { width:100%; padding-left: 0; padding-right: 0; }
        .selected { background: #c2e4ff; }
        `]
            }] }
];
/** @nocollapse */
FilterGridComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: FilterService },
    { type: MessagerService }
];
FilterGridComponent.propDecorators = {
    conditions: [{ type: Input }],
    columns: [{ type: Input }],
    enableExpress: [{ type: Input }],
    enableFrontExpress: [{ type: Input }],
    height: [{ type: Input }],
    fieldEditor: [{ type: Input }],
    useCustomValue: [{ type: Input }],
    insertType: [{ type: Input }],
    defulatRelation: [{ type: Input }],
    showExpress: [{ type: Output }],
    scrollContainer: [{ type: Input }],
    tablebodybox: [{ type: ViewChild, args: ['tablebodybox',] }]
};
if (false) {
    /** @type {?} */
    FilterGridComponent.prototype.LeftBracketData;
    /** @type {?} */
    FilterGridComponent.prototype.RighttBracketData;
    /** @type {?} */
    FilterGridComponent.prototype.relationData;
    /** @type {?} */
    FilterGridComponent.prototype.operators;
    /** @type {?} */
    FilterGridComponent.prototype.columnSizeData;
    /** @type {?} */
    FilterGridComponent.prototype.groupIcon;
    /** @type {?} */
    FilterGridComponent.prototype.conditions;
    /** @type {?} */
    FilterGridComponent.prototype.columns;
    /** @type {?} */
    FilterGridComponent.prototype.enableExpress;
    /** @type {?} */
    FilterGridComponent.prototype.enableFrontExpress;
    /** @type {?} */
    FilterGridComponent.prototype.height;
    /** @type {?} */
    FilterGridComponent.prototype.fieldEditor;
    /**
     * 当值类型为 value 时是否显示按钮，默认不显示
     * @type {?}
     */
    FilterGridComponent.prototype.useCustomValue;
    /** @type {?} */
    FilterGridComponent.prototype.insertType;
    /** @type {?} */
    FilterGridComponent.prototype.defulatRelation;
    /** @type {?} */
    FilterGridComponent.prototype.showExpress;
    /** @type {?} */
    FilterGridComponent.prototype.scrollContainer;
    /** @type {?} */
    FilterGridComponent.prototype.tablebodybox;
    /** @type {?} */
    FilterGridComponent.prototype.currentCondition;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.newCondition;
    /** @type {?} */
    FilterGridComponent.prototype.localeService;
    /** @type {?} */
    FilterGridComponent.prototype.trackByValue;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    FilterGridComponent.prototype.messagerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWdyaWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZhcnJpcy91aS1maWx0ZXItZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZmlsdGVyLWdyaWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVVBLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLFNBQVMsRUFBZSxTQUFTLEVBQUUsS0FBSyxFQUNsRCxZQUFZLEVBQUUsTUFBTSxFQUFZLHVCQUF1QixFQUFHLE1BQU0sZUFBZSxDQUFDO0FBQzlHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsV0FBVyxFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFlN0QsTUFBTSxPQUFPLG1CQUFtQjs7Ozs7OztJQStDNUIsWUFDWSxFQUFjLEVBQVUsTUFBaUIsRUFBVSxhQUE0QixFQUMvRSxlQUFnQztRQURoQyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQy9FLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQWhENUMsb0JBQWUsR0FBRyxXQUFXLENBQUM7UUFDOUIsc0JBQWlCLEdBQUcsYUFBYSxDQUFDO1FBQ2xDLGlCQUFZLEdBQUcsUUFBUSxDQUFDO1FBQ3hCLGNBQVMsR0FBRyxnQkFBZ0IsQ0FBQztRQUU3QixtQkFBYyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELGNB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QXVFOzs7OztJQUV2RSwyQ0FRRTs7SUFHRiw0Q0FBb0M7O0lBcU5wQywyQ0FFQzs7Ozs7SUFwTkcsaUNBQXNCOzs7OztJQUFFLHFDQUF5Qjs7Ozs7SUFBRSw0Q0FBb0M7Ozs7O0lBQ3ZGLDhDQUF3QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLWxvY2FsZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShsdWNhcyBodWFuZylcclxuICogQERhdGU6IDIwMTgtMTEtMTMgMTQ6NTU6MzRcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMTEtMzAgMTA6MTg6MTJcclxuICogQENvbXBhbnk6IEluc3B1clxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEVsZW1lbnRSZWYsIFJlbmRlcmVyMiwgSG9zdEJpbmRpbmcsIFZpZXdDaGlsZCwgSW5wdXQsXHJcbiAgICBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBPcHRpb25hbCwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBMZWZ0QnJhY2tldCwgUmlnaHR0QnJhY2tldCwgUmVsYXRpb24sIENvbXBhcmVPcGVyYXRvcnMsIEZpbHRlckNvbmRpdGlvbixcclxuICAgICAgICBDb21wYXJlLCBGaWx0ZXJSZWxhdGlvbiwgRXhwcmVzc1ZhbHVlVHlwZSB9IGZyb20gJ0BmYXJyaXMvdWktY29tbW9uL3R5cGVzJztcclxuaW1wb3J0IHsgRmlsdGVyU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvZmlsdGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQZXJmZWN0U2Nyb2xsYmFyQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1wZXJmZWN0LXNjcm9sbGJhcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnZmlsdGVyLWdyaWQnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2ZpbHRlci1ncmlkLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlczogW1xyXG4gICAgICAgIGBcclxuICAgICAgICAuZmlsdGVyLXNlbGVjdCB7IHdpZHRoOjEwMCU7IHBhZGRpbmctbGVmdDogMDsgcGFkZGluZy1yaWdodDogMDsgfVxyXG4gICAgICAgIC5zZWxlY3RlZCB7IGJhY2tncm91bmQ6ICNjMmU0ZmY7IH1cclxuICAgICAgICBgXHJcbiAgICBdLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5EZWZhdWx0XHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgRmlsdGVyR3JpZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICAgIExlZnRCcmFja2V0RGF0YSA9IExlZnRCcmFja2V0O1xyXG4gICAgUmlnaHR0QnJhY2tldERhdGEgPSBSaWdodHRCcmFja2V0O1xyXG4gICAgcmVsYXRpb25EYXRhID0gUmVsYXRpb247XHJcbiAgICBvcGVyYXRvcnMgPSBDb21wYXJlT3BlcmF0b3JzO1xyXG5cclxuICAgIGNvbHVtblNpemVEYXRhID0gWzYwLCA1MCwgMTIwLCAxMDAsIDYwLCAxMjAsIDUwLCA1MF07XHJcbiAgICBncm91cEljb24gPSAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nO1xyXG5cclxuICAgIEBJbnB1dCgpIGNvbmRpdGlvbnM6IEZpbHRlckNvbmRpdGlvbltdID0gW107XHJcbiAgICBASW5wdXQoKSBjb2x1bW5zOiB7bGFiZWw6IHN0cmluZywgdmFsdWU6IHN0cmluZ31bXSA9IFtdO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRXhwcmVzcyA9IGZhbHNlO1xyXG4gICAgQElucHV0KCkgZW5hYmxlRnJvbnRFeHByZXNzID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBoZWlnaHQ6IG51bWJlcjtcclxuICAgIEBJbnB1dCgpIGZpZWxkRWRpdG9yO1xyXG4gICAgLyoqIOW9k+WAvOexu+Wei+S4uiB2YWx1ZSDml7bmmK/lkKbmmL7npLrmjInpkq7vvIzpu5jorqTkuI3mmL7npLogKi9cclxuICAgIEBJbnB1dCgpIHVzZUN1c3RvbVZhbHVlID0gZmFsc2U7XHJcblxyXG5cclxuICAgIEBJbnB1dCgpIGluc2VydFR5cGU6ICdhYm92ZSd8J2JlbG93JyA9ICdiZWxvdyc7XHJcblxyXG4gICAgQElucHV0KCkgZGVmdWxhdFJlbGF0aW9uID0gRmlsdGVyUmVsYXRpb24uQW5kO1xyXG5cclxuICAgIEBPdXRwdXQoKSBzaG93RXhwcmVzcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcblxyXG4gICAgQElucHV0KCkgc2Nyb2xsQ29udGFpbmVyOiBIVE1MRWxlbWVudCA9IG51bGw7XHJcblxyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3RhYmxlYm9keWJveCcpIHRhYmxlYm9keWJveDogRWxlbWVudFJlZjtcclxuICAgIC8vIEBWaWV3Q2hpbGQoJ3BzJykgcHNSZWY6IFBlcmZlY3RTY3JvbGxiYXJDb21wb25lbnQ7XHJcblxyXG4gICAgY3VycmVudENvbmRpdGlvbjogeyBpbmRleDogbnVtYmVyLCBjb25kaXRpb246IEZpbHRlckNvbmRpdGlvbiB9ID0gbnVsbDtcclxuXHJcbiAgICBwcml2YXRlIG5ld0NvbmRpdGlvbjogRmlsdGVyQ29uZGl0aW9uID0ge1xyXG4gICAgICAgIGZpbHRlckZpZWxkOiAnJyxcclxuICAgICAgICB2YWx1ZTogJycsXHJcbiAgICAgICAgbGJyYWNrZXQ6ICcnLFxyXG4gICAgICAgIHJicmFja2V0OiAnJyxcclxuICAgICAgICByZWxhdGlvbjogRmlsdGVyUmVsYXRpb24uRW1wdHksXHJcbiAgICAgICAgY29tcGFyZTogQ29tcGFyZS5FcXVhbCxcclxuICAgICAgICBleHByZXNzdHlwZTogRXhwcmVzc1ZhbHVlVHlwZS5WYWx1ZVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgbG9jYWxlU2VydmljZTogTG9jYWxlU2VydmljZSA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlOiBGaWx0ZXJTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgbWVzc2FnZXJTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NhbGVTZXJ2aWNlID0gdGhpcy5tZXNzYWdlclNlcnZpY2VbJ2xvY2FsZVNlcnZpY2UnXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmZpZWxkRWRpdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZmllbGRFZGl0b3IgPSB7IHR5cGU6ICdzZWxlY3QnLCBvcHRpb25zOiB7fX07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluaXRSZWxhdGlvbkRhdGEoKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy5uZXdDb25kaXRpb24ucmVsYXRpb24gPSB0aGlzLmRlZnVsYXRSZWxhdGlvbiB8fCBGaWx0ZXJSZWxhdGlvbi5BbmQ7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5jb25kaXRpb25zIHx8ICF0aGlzLmNvbmRpdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0Q29uID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5uZXdDb25kaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbZmlyc3RDb25dO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOm7mOiupOmAieS4reesrDHooYxcclxuICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSB7IGluZGV4OiAwLCBjb25kaXRpb246IHRoaXMuY29uZGl0aW9uc1swXX07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0UmVsYXRpb25EYXRhKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmxvY2FsZVNlcnZpY2UpIHtcclxuICAgICAgICAgICAgY29uc3QgYW5kU3RyID0gdGhpcy5sb2NhbGVTZXJ2aWNlLmdldFZhbHVlKCdmaWx0ZXJFZGl0b3IucmVsYXRpb25WYWx1ZS5hbmQnKTtcclxuICAgICAgICAgICAgY29uc3Qgb3JTdHIgPSB0aGlzLmxvY2FsZVNlcnZpY2UuZ2V0VmFsdWUoJ2ZpbHRlckVkaXRvci5yZWxhdGlvblZhbHVlLm9yJyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVsYXRpb25EYXRhID0gW1xyXG4gICAgICAgICAgICAgICAgeyBsYWJlbDogJycsIHZhbHVlOiAwfSxcclxuICAgICAgICAgICAgICAgIHsgbGFiZWw6IGFuZFN0ciwgdmFsdWU6IDF9LFxyXG4gICAgICAgICAgICAgICAgeyBsYWJlbDogb3JTdHIsIHZhbHVlOiAyfVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIHBzVXBkYXRlKCkge1xyXG4gICAgLy8gICAgIGlmICh0aGlzLnBzUmVmICYmIHRoaXMucHNSZWYuZGlyZWN0aXZlUmVmKSB7XHJcbiAgICAvLyAgICAgICAgIHRoaXMucHNSZWYuZGlyZWN0aXZlUmVmLnVwZGF0ZSgpO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICBwcml2YXRlIGl0ZW1JbnRvVmlldygpIHtcclxuICAgICAgICBpZiAodGhpcy50YWJsZWJvZHlib3gpIHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ciA9IHRoaXMudGFibGVib2R5Ym94Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcigndHIuc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgIGlmICh0cikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHIuc2Nyb2xsSW50b1ZpZXdJZk5lZWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHIuc2Nyb2xsSW50b1ZpZXdJZk5lZWRlZChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ci5zY3JvbGxJbnRvVmlldyh7YmxvY2s6ICduZWFyZXN0J30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluc2VydENvbmRpdGlvbihpbmRleDogbnVtYmVyLCAkZXZlbnQ/OiBNb3VzZUV2ZW50KSB7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBfbmV3Q29uZGl0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5uZXdDb25kaXRpb24sIHsgcmVsYXRpb246IEZpbHRlclJlbGF0aW9uLkFuZCAgfSk7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zZXJ0VHlwZSA9PT0gJ2Fib3ZlJykge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMudW5zaGlmdChfbmV3Q29uZGl0aW9uKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDAsIF9uZXdDb25kaXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zLnNwbGljZShpbmRleCArIDEsIDAsIF9uZXdDb25kaXRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVtb3ZlQ29uZGl0aW9uKGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCkge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMuY29uZGl0aW9uc1tpbmRleF0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uID0geyBpbmRleDogaW5kZXgsIGNvbmRpdGlvbjogdGhpcy5jb25kaXRpb25zW2luZGV4XSB9O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHRoaXMuY29uZGl0aW9uc1tpbmRleCAtIDFdICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSB7IGluZGV4OiBpbmRleCAtIDEsIGNvbmRpdGlvbjogdGhpcy5jb25kaXRpb25zW2luZGV4IC0gMV0gfTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb25kaXRpb25zW3RoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID4gaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4IC0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPSB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggKyAxIDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25BZGRGaWx0ZXIoKSB7XHJcbiAgICAgICAgY29uc3QgbmV3SXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMubmV3Q29uZGl0aW9uKTtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMuZm9yRWFjaChuID0+IHtcclxuICAgICAgICAgICAgaWYgKG4ucmVsYXRpb24gPT0gRmlsdGVyUmVsYXRpb24uRW1wdHkgfHwgIW4ucmVsYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIG4ucmVsYXRpb24gPSBGaWx0ZXJSZWxhdGlvbi5BbmQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvbnMgPSBbLi4udGhpcy5jb25kaXRpb25zLCBuZXdJdGVtXTtcclxuICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoKTtcclxuICAgICAgICBjb25zdCBuZXdJZHggPSB0aGlzLmNvbmRpdGlvbnMubGVuZ3RoIC0gMTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24gPSB7IGluZGV4OiBuZXdJZHgsIGNvbmRpdGlvbjogbmV3SXRlbSB9O1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlclNlcnZpY2UucXVlc3Rpb24oJ+ehruiupOimgea4heepuuW9k+WJjeaJgOacieadoeS7tuWQl++8nycsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW92ZVRvcCgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy51bnNoaWZ0KHRoaXMuY3VycmVudENvbmRpdGlvbi5jb25kaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCArIDEsIDEpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uLmluZGV4ID0gMDtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VDb25kaXRpb25MaXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uTW92ZVByZXYoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleDtcclxuICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKGluZGV4IC0gMSwgMCwgLi4udGVtcEFycik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPSBpbmRleCAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG9uTW92ZU5leHQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleDtcclxuICAgICAgICAgICAgY29uc3QgdGVtcEFyciA9IHRoaXMuY29uZGl0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKGluZGV4ICsgMSwgMCwgLi4udGVtcEFycik7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPSBpbmRleCArIDE7XHJcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29uZGl0aW9uTGlzdCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG9uTW92ZUJvdHRvbSgpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZGl0aW9ucy5wdXNoKHRoaXMuY3VycmVudENvbmRpdGlvbi5jb25kaXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmRpdGlvbnMuc3BsaWNlKHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbmRpdGlvbi5pbmRleCA9IHRoaXMuY29uZGl0aW9ucy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZUNvbmRpdGlvbkxpc3QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VDb25kaXRpb25MaXN0KCkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyU2VydmljZS5jb25kaXRpb25zQ2hhbmdlZC5uZXh0KHRoaXMuY29uZGl0aW9ucyk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbUludG9WaWV3KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0ZWQoJGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Q29uZGl0aW9uID0gJGV2ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGlzU2VsZWN0ZWQoJGV2ZW50OiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRDb25kaXRpb24uaW5kZXggPT09ICRldmVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNob3dFeHByZXNzRGlhbG9nKCRldmVudCwgY29uZGl0aW9uLCB2YWx1ZSkge1xyXG4gICAgICAgIGxldCB0eXBlID0gJ3ZhbHVlJztcclxuICAgICAgICBpZiAoY29uZGl0aW9uLmV4cHJlc3N0eXBlID09IDEgKSB7XHJcbiAgICAgICAgICAgIHR5cGUgPSAnZXhwcmVzcyc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChjb25kaXRpb24uZXhwcmVzc3R5cGUgPT0gJ2Zyb250RXhwcmVzcycpIHtcclxuICAgICAgICAgICAgdHlwZSA9ICdmcm9udEV4cHJlc3MnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNob3dFeHByZXNzLmVtaXQoeyBldmVudDogJGV2ZW50LCBjb25kaXRpb24sIHZhbHVlLCB0eXBlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ29tYm9TZWxlY3RDaGFuZ2UoJGV2ZW50LCAgY29uZGl0aW9uKSB7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICBjb25zdCB7IGRhdGEgfSA9ICRldmVudDtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbmRpdGlvbi5maWx0ZXJGaWVsZCA9IGRhdGFbJ3ZhbHVlJ107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJTZXJ2aWNlLmlzVmFsaWQodGhpcy5jb25kaXRpb25zLCB0aGlzLmxvY2FsZVNlcnZpY2UpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB0cmFja0J5VmFsdWUgPSAoaW5kZXg6IG51bWJlciwgcm93OiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gcm93ID8gcm93LnZhbHVlIHx8IHJvdyA6ICBpbmRleDtcclxuICAgIH1cclxufVxyXG4iXX0=
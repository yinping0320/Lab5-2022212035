!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/platform-browser"),require("rxjs"),require("lodash-es"),require("@farris/ui-modal"),require("@farris/ui-common/types"),require("@farris/ui-notify"),require("@angular/forms"),require("@angular/common"),require("@farris/ui-lookup"),require("@farris/ui-dialog"),require("@farris/ui-perfect-scrollbar"),require("@farris/ui-messager"),require("@farris/ui-common"),require("@farris/ui-input-group"),require("@angular/core"),require("@farris/ui-locale"),require("@farris/ui-combo-lookup"),require("@farris/ui-forms")):"function"==typeof define&&define.amd?define("@farris/ui-filter-editor",["exports","@angular/platform-browser","rxjs","lodash-es","@farris/ui-modal","@farris/ui-common/types","@farris/ui-notify","@angular/forms","@angular/common","@farris/ui-lookup","@farris/ui-dialog","@farris/ui-perfect-scrollbar","@farris/ui-messager","@farris/ui-common","@farris/ui-input-group","@angular/core","@farris/ui-locale","@farris/ui-combo-lookup","@farris/ui-forms"],e):e((t.farris=t.farris||{},t.farris["ui-filter-editor"]={}),t.ng.platformBrowser,t.rxjs,t.lodashEs,t.uiModal,t.types,t.uiNotify,t.ng.forms,t.ng.common,t.uiLookup,t.uiDialog,t.uiPerfectScrollbar,t.uiMessager,t.uiCommon,t.uiInputGroup,t.ng.core,t.uiLocale,t.uiComboLookup,t.uiForms)}(this,function(t,e,n,o,i,a,s,r,l,c,p,d,u,h,f,m,y,b,g){"use strict";var v=(x.prototype.buildSqlWhere=function(t){return this.commonUtils.buildSqlWhere(t)},x.prototype.isValid=function(n,t){if(n&&n.length){n[n.length-1].relation=a.FilterRelation.Empty;var e=!0;n.map(function(t,e){return t.relation==""+a.FilterRelation.Empty?{index:e,filter:t}:null}).filter(function(t,e){return t&&e!==n.length-1}).length&&(e=!1);for(var o=!0,i="",r=0;r<n.length;r++)i+=n[r].lbracket+n[r].rbracket;var s=i.length;if(0<s%2)o=!1;else{for(r=0;r<s;r++)i=i.replace("()","");o=!i.length}var l=0===n.filter(function(t){return!t.filterField}).length;return{bracket:{result:o,msg:t?t.getValue("filterEditor.validate.bracket"):"括号不匹配，请检查。"},relation:{result:e,msg:t?t.getValue("filterEditor.validate.relation"):"关系设置不完整，请检查。"},field:{result:l,msg:t?t.getValue("filterEditor.validate.field"):"字段不允许为空，请检查。"}}}return!0},x.decorators=[{type:m.Injectable}],x.ctorParameters=function(){return[{type:h.CommonUtils,decorators:[{type:m.Optional}]}]},x);function x(t){this.conditionsChanged=new n.Subject,this.commonUtils=t||new h.CommonUtils}var E=(C.prototype.ngOnInit=function(){this.conditions&&this.conditions.length&&(this.conditions=this.conditions.map(function(t){var e=parseInt(""+t.compare,10);return e!==a.Compare.In&&e!==a.Compare.NotIn||(t.value=t.value.replace(/\r\n/g,",")),t}))},C.prototype.onTabChange=function(t){this.tabIndex=t},C.prototype.onShowExpress=function(t){(t.instance=this).showExpress.emit(t)},C.prototype.validation=function(){return this.filterService.isValid(this.conditions,this.localeService)},C.decorators=[{type:m.Component,args:[{selector:"filter-editor",template:'\n        <filter-tabs\n            class="f-utils-fill-flex-column"\n            [showCode]="showCode"\n            [showSql]="showSql"\n            [columns]="columns"\n            [height]="height"\n            [enableExpress]="enableExpress"\n            [enableFrontExpress]="enableFrontExpress"\n            [conditions]="conditions"\n            [fieldEditor]="fieldEditor"\n            (showExpress)="onShowExpress($event)"\n            (selectTabChange)="onTabChange($event)"\n            [insertType]="insertType"\n            [useCustomValue]="useCustomValue">\n        </filter-tabs>\n    '}]}],C.ctorParameters=function(){return[{type:e.DomSanitizer},{type:v},{type:m.Injector,decorators:[{type:m.Optional}]}]},C.propDecorators={columns:[{type:m.Input}],conditions:[{type:m.Input}],height:[{type:m.Input}],showCode:[{type:m.Input}],showSql:[{type:m.Input}],enableExpress:[{type:m.Input}],enableFrontExpress:[{type:m.Input}],fieldEditor:[{type:m.Input}],insertType:[{type:m.Input}],useCustomValue:[{type:m.Input}],showExpress:[{type:m.Output}],cls:[{type:m.HostBinding,args:["class"]}]},C);function C(t,e,n){var o=this;this.sanitizer=t,this.filterService=e,this.injector=n,this.tabIndex=0,this.columns=[],this.conditions=[],this.showCode=!1,this.showSql=!1,this.enableExpress=!1,this.enableFrontExpress=!1,this.fieldEditor={type:"select",options:{}},this.insertType="below",this.useCustomValue=!1,this.showExpress=new m.EventEmitter,this.cls="f-utils-flex-column f-utils-absolute-all",this.localeService=null,this.filterService.conditionsChanged.subscribe(function(t){o.conditions=t}),this.injector&&(this.localeService=this.injector.get(y.LocaleService,null),this.cd=this.injector.get(m.ChangeDetectorRef))}var w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function k(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,r=n.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(o=r.next()).done;)s.push(o.value)}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(i)throw i.error}}return s}function I(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(k(arguments[e]));return t}var S=(F.prototype.ngOnChanges=function(t){},F.prototype.ngOnInit=function(){if(this.fieldEditor||(this.fieldEditor={type:"select",options:{}}),this.initRelationData(),!this.conditions||!this.conditions.length){var t=Object.assign({},this.newCondition);this.conditions=[t],this.changeConditionList()}this.currentCondition={index:0,condition:this.conditions[0]}},F.prototype.initRelationData=function(){if(this.localeService){var t=this.localeService.getValue("filterEditor.relationValue.and"),e=this.localeService.getValue("filterEditor.relationValue.or");this.relationData=[{label:"",value:0},{label:t,value:1},{label:e,value:2}]}},F.prototype.itemIntoView=function(){var e=this;this.tablebodybox&&setTimeout(function(){var t=e.tablebodybox.nativeElement.querySelector("tr.selected");t&&(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded(!1):t.scrollIntoView({block:"nearest"}))},50)},F.prototype.insertCondition=function(t,e){e&&e.stopPropagation();var n=Object.assign({},this.newCondition,{relation:a.FilterRelation.And});"above"===this.insertType?0===t?this.conditions.unshift(n):this.conditions.splice(t,0,n):this.conditions.splice(t+1,0,n),this.changeConditionList()},F.prototype.removeCondition=function(t){this.conditions.splice(t,1),this.changeConditionList(),this.currentCondition&&(t===this.currentCondition.index?this.conditions[t]?this.currentCondition={index:t,condition:this.conditions[t]}:this.conditions[t-1]?this.currentCondition={index:t-1,condition:this.conditions[t-1]}:this.currentCondition=null:this.conditions[this.currentCondition.index]||(this.currentCondition.index>t?this.currentCondition.index=this.currentCondition.index-1:this.currentCondition.index=this.currentCondition.index+1))},F.prototype.onAddFilter=function(){var t=Object.assign({},this.newCondition);this.conditions.forEach(function(t){t.relation!=a.FilterRelation.Empty&&t.relation||(t.relation=a.FilterRelation.And)}),this.conditions=I(this.conditions,[t]),this.changeConditionList();var e=this.conditions.length-1;this.currentCondition={index:e,condition:t}},F.prototype.onClear=function(){var t=this;this.messagerService.question("确认要清空当前所有条件吗？",function(){t.conditions=[],t.changeConditionList()})},F.prototype.onMoveTop=function(){this.currentCondition&&(this.conditions.unshift(this.currentCondition.condition),this.conditions.splice(this.currentCondition.index+1,1),this.currentCondition.index=0,this.changeConditionList())},F.prototype.onMovePrev=function(){var t;if(this.currentCondition){var e=this.currentCondition.index,n=this.conditions.splice(e,1);(t=this.conditions).splice.apply(t,I([e-1,0],n)),this.currentCondition.index=e-1,this.changeConditionList()}},F.prototype.onMoveNext=function(){var t;if(this.currentCondition){var e=this.currentCondition.index,n=this.conditions.splice(e,1);(t=this.conditions).splice.apply(t,I([e+1,0],n)),this.currentCondition.index=e+1,this.changeConditionList()}},F.prototype.onMoveBottom=function(){this.currentCondition&&(this.conditions.push(this.currentCondition.condition),this.conditions.splice(this.currentCondition.index,1),this.currentCondition.index=this.conditions.length-1,this.changeConditionList())},F.prototype.changeConditionList=function(){var t=this;this.filterService.conditionsChanged.next(this.conditions),setTimeout(function(){t.itemIntoView()})},F.prototype.selected=function(t){this.currentCondition=t},F.prototype.isSelected=function(t){return!!this.currentCondition&&this.currentCondition.index===t},F.prototype.showExpressDialog=function(t,e,n){var o="value";1==e.expresstype?o="express":"frontExpress"==e.expresstype&&(o="frontExpress"),this.showExpress.emit({event:t,condition:e,value:n,type:o})},F.prototype.onComboSelectChange=function(t,e){if(t){var n=t.data;n&&(e.filterField=n.value)}},F.prototype.validation=function(){return this.filterService.isValid(this.conditions,this.localeService)},F.decorators=[{type:m.Component,args:[{selector:"filter-grid",template:'\x3c!-- <div class="table-header ">\r\n    <table class="table table-bordered" style="margin-bottom: 0">\r\n        <colgroup>\r\n            <col *ngFor="let s of columnSizeData" [style.width]=" s + \'px\'">\r\n        </colgroup>\r\n        <thead>\r\n            <tr>\r\n                <th></th>\r\n                <th><b>{{ \'filterEditor.leftBrackets\' | locale }}</b></th>\r\n                <th><b>{{ \'filterEditor.field\' | locale }}</b></th>\r\n                <th><b>{{ \'filterEditor.operator\' | locale }}</b></th>\r\n                <th><b>{{ \'filterEditor.valueType\' | locale }}</b></th>\r\n                <th><b>{{ \'filterEditor.value\' | locale }}</b></th>\r\n                <th><b>{{ \'filterEditor.rightBrackets\' | locale }}</b></th>\r\n                <th><b>{{ \'filterEditor.relation\' | locale }}</b></th>\r\n            </tr>\r\n        </thead>\r\n    </table>\r\n</div> --\x3e\r\n<div style="\r\n    border-top: 1px solid  white;\r\n    position: absolute;\r\n    top: 38px;\r\n    width: 100%;\r\n    z-index: 2;\r\n"></div>\r\n<div class="table-body flex-fill win11Scroll show nobtn " style="margin-left:14px; margin-right: 0; overflow-y: scroll;" #tablebodybox>\r\n        <table class="table table-bordered" style="margin-bottom: 0;">\r\n            <thead  style="position: sticky; top: 0; z-index: 1;">\r\n                <tr>\r\n                    <th style="width: 60px"></th>\r\n                    <th style="width: 50px"><b>{{ \'filterEditor.leftBrackets\' | locale }}</b></th>\r\n                    <th style="width: 120px"><b>{{ \'filterEditor.field\' | locale }}</b></th>\r\n                    <th style="width: 100px"><b>{{ \'filterEditor.operator\' | locale }}</b></th>\r\n                    <th style="width: 60px"><b>{{ \'filterEditor.valueType\' | locale }}</b></th>\r\n                    <th style="width: 120px"><b>{{ \'filterEditor.value\' | locale }}</b></th>\r\n                    <th style="width: 50px"><b>{{ \'filterEditor.rightBrackets\' | locale }}</b></th>\r\n                    <th style="width: 50px"><b>{{ \'filterEditor.relation\' | locale }}</b></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr *ngFor="let condition of conditions; let index=index;" (click)="selected({\'index\':index, \'condition\': condition})" [class.selected]="isSelected(index)" >\r\n                    <td style="text-overflow: unset;">\r\n                        <button type="button" (click)="insertCondition(index, $event)" class="k-button k-button-icon k-flat"><span class="k-icon k-i-plus"></span></button>\r\n                        <button type="button" (click)="removeCondition(index)" class="k-button k-button-icon k-flat"><span class="k-icon k-i-minus"></span></button>\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <select class="form-control filter-select" [(ngModel)]="condition.lbracket" name="lbracket"\r\n                        single-select [panelRef]="selectlbracketpanel" [items]="LeftBracketData" [container]="scrollContainer || tablebodybox ">\r\n                            \x3c!-- <option *ngFor="let item of LeftBracketData" [value]="item">{{ item }}</option> --\x3e\r\n                        </select>\r\n\r\n                        <div #selectlbracketpanel class="single-select-panel f-area-hide">\r\n                            <ul class="dropdown-menu show" style="position:relative;min-width: 100%;border:none; box-shadow: none;">\r\n                                <li class="dropdown-item p-0 px-1" style="line-height:26px;height:26px" *ngFor="let col of LeftBracketData; trackBy: trackByValue" [attr.value]="col" [class.active]="condition.lbracket === col">{{ col }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <ng-container *ngIf="fieldEditor.type === \'select\'" >\r\n                            <select class="form-control filter-select" [(ngModel)]="condition.filterField" name="filterField" single-select [panelRef]="selectcolpanel" [items]="columns" [container]="scrollContainer || tablebodybox ">\r\n                                \x3c!-- <option *ngFor="let col of columns" [value]="col.value">{{ col.label }}</option> --\x3e\r\n                            </select>\r\n\r\n                            <div #selectcolpanel class="single-select-panel f-area-hide" style="max-height: 200px;overflow: auto;">\r\n                                <ul class="dropdown-menu show" style="position:relative;min-width: 100%;border:none; box-shadow: none;">\r\n                                    <li class="dropdown-item" *ngFor="let col of columns; trackBy: trackByValue" [attr.value]="col.value" [class.active]="condition.filterField === col.value">{{ col.label }}</li>\r\n                                </ul>\r\n                            </div>\r\n\r\n                        </ng-container>\r\n\r\n                        <farris-combo-lookup *ngIf="fieldEditor.type === \'combo-tree\'" name="filterField"\r\n                            [idField]="fieldEditor?.options?.idField ||\'value\'"\r\n                            [textField]="fieldEditor?.options?.textField ||\'label\'"\r\n                            [displayType]="\'LOOKUPTREELIST\'" [useValue]="true"\r\n                            [useTreeView]="true"\r\n                            [columns]="fieldEditor?.options?.columns || []"\r\n                            [data]="columns"\r\n                            [(ngModel)]="condition.filterField"\r\n                            [remoteSearch]="false"\r\n                            [autoWidth]="fieldEditor?.options?.autoWidth"\r\n                            [panelWidth]="fieldEditor?.options?.panelWidth || 200">\r\n                        </farris-combo-lookup>\r\n\r\n\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <select class="form-control filter-select" name="compare" [(ngModel)]="condition.compare" single-select [panelRef]="selectcomparepanel" [items]="operators" [container]="scrollContainer || tablebodybox ">\r\n                            \x3c!-- <option *ngFor="let item of operators" [value]="item.value">{{item.label}}</option> --\x3e\r\n                        </select>\r\n                        <div #selectcomparepanel class="single-select-panel f-area-hide" style="max-height: 200px;overflow: auto;">\r\n                            <ul class="dropdown-menu show" style="position:relative;min-width: 100%;border:none; box-shadow: none;">\r\n                                <li class="dropdown-item" *ngFor="let col of operators; trackBy: trackByValue" [attr.value]="col.value" [class.active]="condition.compare === col.value">{{ col.label }}</li>\r\n                            </ul>\r\n                        </div>\r\n\r\n\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <select class="form-control filter-select" name="expresstype" [(ngModel)]="condition.expresstype" \r\n                        single-select [panelRef]="selectexpresstypepanel" [container]="scrollContainer || tablebodybox ">\r\n                            \x3c!-- <option [value]="0">{{\'filterEditor.expressType.value\' | locale }}</option>\r\n                            <option [value]="1" *ngIf="enableExpress" >{{\'filterEditor.expressType.express\' | locale }}</option>\r\n                            <option [value]="\'frontExpress\'" *ngIf="enableFrontExpress" >{{\'filterEditor.expressType.frontExpress\' | locale }}</option> --\x3e\r\n                        </select>\r\n                        <div #selectexpresstypepanel class="single-select-panel f-area-hide">\r\n                            <ul class="dropdown-menu show" style="position:relative;min-width: 100%;border:none; box-shadow: none;">\r\n                                <li style="line-height:26px;height:26px"  class="dropdown-item p-0 px-1" [value]="0" [class.active]="condition.expresstype == 0" >{{\'filterEditor.expressType.value\' | locale }}</li>\r\n                                <li style="line-height:26px;height:26px"  class="dropdown-item p-0 px-1" [value]="1" [class.active]="condition.expresstype == 1" *ngIf="enableExpress" >{{\'filterEditor.expressType.express\' | locale }}</li>\r\n                                <li style="line-height:26px;height:26px"  class="dropdown-item p-0 px-1" [value]="\'frontExpress\'" [class.active]="condition.expresstype === \'frontExpress\'" *ngIf="enableFrontExpress" >{{\'filterEditor.expressType.frontExpress\' | locale }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <input-group name="value" [(ngModel)]="condition.value" [groupText]="condition.expresstype == 1||condition.expresstype===\'frontExpress\' || useCustomValue ?groupIcon: \'\'"\r\n                        (clickHandle)="showExpressDialog($event, condition, condition.value)"></input-group>\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <select class="form-control filter-select"  [(ngModel)]="condition.rbracket" name="rbracket" single-select [panelRef]="selectrbracketpanel" [items]="RighttBracketData" [container]="scrollContainer || tablebodybox ">\r\n                            \x3c!-- <option *ngFor="let item of RighttBracketData" [value]="item">{{ item }}</option> --\x3e\r\n                        </select>\r\n\r\n                        <div #selectrbracketpanel class="single-select-panel f-area-hide">\r\n                            <ul class="dropdown-menu show" style="position:relative;min-width: 100%;border:none; box-shadow: none;">\r\n                                <li class="dropdown-item p-0 px-1" style="line-height:26px;height:26px" *ngFor="let col of RighttBracketData; trackBy: trackByValue" [attr.value]="col" [class.active]="condition.rbracket === col">{{ col }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                    <td class="px-1">\r\n                        <select class="form-control filter-select" [(ngModel)]="condition.relation" name="relation" single-select [panelRef]="selectrelationpanel" [items]="relationData" [container]="scrollContainer || tablebodybox ">\r\n                            \x3c!-- <option *ngFor="let item of relationData" [value]="item.value">{{ item.label }}</option> --\x3e\r\n                        </select>\r\n\r\n                        <div #selectrelationpanel class="single-select-panel f-area-hide">\r\n                            <ul class="dropdown-menu show" style="position:relative;min-width: 100%;border:none; box-shadow: none;">\r\n                                <li class="dropdown-item p-0 px-1" style="line-height:26px;height:26px" *ngFor="let col of relationData; trackBy: trackByValue" [attr.value]="col.value" [class.active]="condition.relation == col.value">{{ col.label }}</li>\r\n                            </ul>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n</div>\r\n<div style="flex-shrink: 0; margin: 0 14px;">\r\n<filter-footer\r\n(addFilter)="onAddFilter()"\r\n(clearFilter)="onClear()"\r\n(moveTop)="onMoveTop()"\r\n(movePrev)="onMovePrev()"\r\n(moveNext)="onMoveNext()"\r\n(moveBottom)="onMoveBottom()"></filter-footer>\r\n</div>\r\n',changeDetection:m.ChangeDetectionStrategy.Default,styles:["\n        .filter-select { width:100%; padding-left: 0; padding-right: 0; }\n        .selected { background: #c2e4ff; }\n        "]}]}],F.ctorParameters=function(){return[{type:m.ElementRef},{type:m.Renderer2},{type:v},{type:u.MessagerService}]},F.propDecorators={conditions:[{type:m.Input}],columns:[{type:m.Input}],enableExpress:[{type:m.Input}],enableFrontExpress:[{type:m.Input}],height:[{type:m.Input}],fieldEditor:[{type:m.Input}],useCustomValue:[{type:m.Input}],insertType:[{type:m.Input}],defulatRelation:[{type:m.Input}],showExpress:[{type:m.Output}],scrollContainer:[{type:m.Input}],tablebodybox:[{type:m.ViewChild,args:["tablebodybox"]}]},F);function F(t,e,n,o){this.el=t,this.render=e,this.filterService=n,this.messagerService=o,this.LeftBracketData=a.LeftBracket,this.RighttBracketData=a.RighttBracket,this.relationData=a.Relation,this.operators=a.CompareOperators,this.columnSizeData=[60,50,120,100,60,120,50,50],this.groupIcon='<i class="f-icon f-icon-lookup"></i>',this.conditions=[],this.columns=[],this.enableExpress=!1,this.enableFrontExpress=!1,this.useCustomValue=!1,this.insertType="below",this.defulatRelation=a.FilterRelation.And,this.showExpress=new m.EventEmitter,this.scrollContainer=null,this.currentCondition=null,this.newCondition={filterField:"",value:"",lbracket:"",rbracket:"",relation:a.FilterRelation.Empty,compare:a.Compare.Equal,expresstype:a.ExpressValueType.Value},this.localeService=null,this.trackByValue=function(t,e){return e?e.value||e:t},this.localeService=this.messagerService.localeService}var T=(R.prototype.ngOnInit=function(){},R.prototype.onAddFilter=function(){this.addFilter.emit()},R.prototype.onClear=function(){this.clearFilter.emit()},R.prototype.onMoveTop=function(){this.moveTop.emit()},R.prototype.onMovePrev=function(){this.movePrev.emit()},R.prototype.onMoveNext=function(){this.moveNext.emit()},R.prototype.onMoveBottom=function(){this.moveBottom.emit()},R.prototype.canUse=function(){return!!this.grid.currentCondition&&1<this.grid.conditions.length},R.prototype.canMoveUp=function(){return!!this.canUse()&&0<this.grid.currentCondition.index},R.prototype.canMoveDown=function(){return!!this.canUse()&&this.grid.currentCondition.index<this.grid.conditions.length-1},R.decorators=[{type:m.Component,args:[{selector:"filter-footer",template:'\n    <div class="footer-container px-2" style="height: 36px;">\n        <button type="button" (click)="onAddFilter()"\n            class="k-button k-button-icontext k-flat "><span class="f-icon f-icon-add"></span> {{ \'filterEditor.addWhere\' | locale }}</button>\n        <button type="button" (click)="onClear()" [disabled]="!grid.conditions.length"\n            class="k-button k-button-icontext k-flat "><span class="f-icon f-icon-close"></span> {{ \'filterEditor.clear\' | locale }}</button>\n        <button type="button" [disabled]="!canMoveUp()" (click)="onMoveTop()"\n            class="k-button k-button-icontext k-flat "><span class="f-icon f-icon-arrow-end-up"></span>\n            {{\'filterEditor.moveTop\' | locale }}</button>\n        <button type="button" [disabled]="!canMoveUp()" (click)="onMovePrev()"\n            class="k-button k-button-icontext k-flat "><span class="f-icon f-icon-arrow-60-up"></span>\n            {{\'filterEditor.moveUp\' | locale }}</button>\n        <button type="button" [disabled]="!canMoveDown()" (click)="onMoveNext()"\n            class="k-button k-button-icontext k-flat "><span class="f-icon f-icon-arrow-60-down"></span>\n            {{\'filterEditor.moveDown\' | locale }}</button>\n        <button type="button" [disabled]="!canMoveDown()" (click)="onMoveBottom()"\n            class="k-button k-button-icontext k-flat"><span class="f-icon f-icon-arrow-end-down"></span>\n            {{\'filterEditor.moveBottom\' | locale }}</button>\n    </div>\n    '}]}],R.ctorParameters=function(){return[{type:S}]},R.propDecorators={cls:[{type:m.HostBinding,args:["class"]}],addFilter:[{type:m.Output}],clearFilter:[{type:m.Output}],moveTop:[{type:m.Output}],movePrev:[{type:m.Output}],moveNext:[{type:m.Output}],moveBottom:[{type:m.Output}]},R);function R(t){this.grid=t,this.cls="f-filter-footer",this.addFilter=new m.EventEmitter,this.clearFilter=new m.EventEmitter,this.moveTop=new m.EventEmitter,this.movePrev=new m.EventEmitter,this.moveNext=new m.EventEmitter,this.moveBottom=new m.EventEmitter}var D=(M.prototype.ngOnInit=function(){},M.prototype.showTab=function(t){this.currentTabIndex=t,this.selectTabChange.emit(t)},M.prototype.showExpressDialog=function(t){this.showExpress.emit(t)},M.decorators=[{type:m.Component,args:[{selector:"filter-tabs",template:'\n    <ul class="nav nav-tabs" style="min-height: 38px" *ngIf="showCode || showSql">\n        <li class="nav-item" style="    margin-left: 14px;">\n            <a class="nav-link" [class.active]="currentTabIndex === 0"  (click)="showTab(0)">{{ \'filterEditor.designTab\' | locale }}</a>\n        </li>\n        <li class="nav-item" *ngIf="showCode">\n            <a class="nav-link" [class.active]="currentTabIndex === 1" (click)="showTab(1)">{{ \'filterEditor.jsonTab\' | locale }}</a>\n        </li>\n        <li class="nav-item" *ngIf="showSql">\n            <a class="nav-link" [class.active]="currentTabIndex === 2" (click)="showTab(2)">{{ \'filterEditor.sqlTab\' | locale }}</a>\n        </li>\n    </ul>\n\n    <ng-container *ngIf="currentTabIndex === 0">\n        <filter-grid style="overflow: hidden;" [useCustomValue]="useCustomValue"\n          [enableExpress]="enableExpress" [enableFrontExpress]="enableFrontExpress"\n          class="d-flex flex-column flex-fill"  [fieldEditor]="fieldEditor" [insertType]="insertType"\n          [conditions]="conditions" [columns]="columns" (showExpress)="showExpressDialog($event)"></filter-grid>\n    </ng-container>\n    <ng-container *ngIf="currentTabIndex === 1 && showCode">\n        <filter-code [height]="height" [conditions]="conditions"></filter-code>\n    </ng-container>\n    <ng-container *ngIf="currentTabIndex === 2 && showSql">\n        <filter-sql [height]="height" [conditions]="conditions"></filter-sql>\n    </ng-container>\n\n    ',styles:[".nav-item { cursor: default;}\n        .nav-item a.active {font-weight: bold;}\n        "]}]}],M.ctorParameters=function(){return[]},M.propDecorators={columns:[{type:m.Input}],conditions:[{type:m.Input}],height:[{type:m.Input}],showCode:[{type:m.Input}],showSql:[{type:m.Input}],fieldEditor:[{type:m.Input}],selectTabChange:[{type:m.Output}],enableExpress:[{type:m.Input}],enableFrontExpress:[{type:m.Input}],showExpress:[{type:m.Output}],insertType:[{type:m.Input}],useCustomValue:[{type:m.Input}]},M);function M(){this.columns=[],this.conditions=[],this.showCode=!1,this.showSql=!1,this.fieldEditor={type:"select"},this.selectTabChange=new m.EventEmitter,this.enableExpress=!1,this.enableFrontExpress=!1,this.showExpress=new m.EventEmitter,this.insertType="below",this.useCustomValue=!1,this.currentTabIndex=0}var q,B={provide:r.NG_VALUE_ACCESSOR,useExisting:m.forwardRef(function(){return V}),multi:!0},V=(function W(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(O,q=c.LookupComponent),O.prototype.ngOnInit=function(){},O.prototype.onmouseover=function(t){this.showClearButton=!0},O.prototype.onmouseleave=function(t){this.showClearButton=!1},O.prototype.showDialog=function(){var e=this;if(!this.disabled){this.fieldEditor&&"combo-tree"===this.fieldEditor.type&&(this.fieldEditor.options=this.fieldEditor.options||{},this.fieldEditor.options.autoWidth===undefined&&(this.fieldEditor.options.autoWidth=!0),this.fieldEditor.options.columns||(this.fieldEditor.options.columns=[{field:"label",title:"label",width:100}]),this.fieldEditor.options.textField||(this.fieldEditor.options.textField="label"),this.fieldEditor.options.idField||(this.fieldEditor.options.idField="value"));var t=this.cfr.resolveComponentFactory(E);this.filterEditorRef=t.create(this.injector),this.filterEditorRef.instance.columns=this.columns,this.filterEditorRef.instance.conditions=this.conditions,this.filterEditorRef.instance.useCustomValue=this.useCustomValue,this.originalData=o.cloneDeep(this.conditions),this.dlgRef=this.modalService.show(this.filterEditorRef,{width:800,height:500,title:this.localeService.getValue("filterEditor.title"),enableScroll:!1,minHeight:398,minWidth:798,iconCls:"f-icon f-icon-filter",buttons:this.btnRef,buttonAlign:"right",initialState:{showCode:this.showCode,showSql:this.showSql,enableExpress:this.enableExpress,fieldEditor:this.fieldEditor,insertType:this.insertType},closed:function(t){t&&e.cancel()}}),this.filterEditorRef.instance.height=this.dlgRef.dialog.instance.getContainerSize().height,this.filterEditorRef.instance.showExpress.subscribe(function(t){e.showExpress.emit(t)}),this.dlgRef.dialog.instance.resized.subscribe(function(t){e.filterEditorRef.instance.height=t.containerHeight}),this.filterEditorRef.changeDetectorRef.detectChanges(),this.dlgRef.dialog.changeDetectorRef.reattach(),this.openDialog.emit()}},O.prototype.writeValue=function(t){t&&("string"==typeof t&&(t=JSON.parse(t)),this.conditions=t||[],this.text=this.commonUtils.buildSqlWhere(this.conditions))},O.prototype.checkSymbol=function(){return this.filterService.isValid(this.conditions,this.localeService)},O.prototype.save=function(){if(this.conditions.length){var t=this.checkSymbol();if("object"==typeof t){var e=t.bracket,n=t.relation,o=t.field;if(!e.result||!n.result||!o.result){var i="";if(e.result?n.result?o.result||(i=o.msg):i=n.msg:i=e.msg,i)return void(this.notifySer?this.notifySer.warning(i):alert(i))}}this.conditions=this.conditions.filter(function(t){return t.filterField}),this.conditions=this.conditions.map(function(t){var e=parseInt(""+t.compare,10);return e!==a.Compare.In&&e!==a.Compare.NotIn||(t.value=t.value.replace(/,/g,"\r\n")),t}),this.text=this.commonUtils.buildSqlWhere(this.conditions)}else this.text="";this.cd&&this.cd.detectChanges(),this.closeDialog()},O.prototype.cancel=function(){this.conditions=this.originalData,this.closeDialog()},O.prototype.closeDialog=function(){this.updateModel(),this.filterEditorRef=null,this.dlgRef.close()},O.prototype.clear=function(){this.text="",this.conditions=[],this.updateModel()},O.prototype.updateModel=function(){var t=this.conditions;"string"===this.returnType&&(t=JSON.stringify(this.conditions)),this.onModelChange(t),this.onModelTouched(t)},O.decorators=[{type:m.Component,args:[{selector:"filter,filter-textbox",template:'<div class="input-group">\r\n    <input #txtbox\r\n        class="form-control" \r\n        [value]="text"\r\n        [readonly]="!editable || readonly"\r\n        [class.f-state-disabled] = "disabled"\r\n        [class.f-state-readonly] = "readonly"\r\n        [class.f-state-editable] = "!editable"\r\n        [disabled]="disabled"/>\r\n    <div class="input-group-append" *ngIf="!readonly && !disabled">\r\n        <span *ngIf="showClearButton && enableClear" class="input-group-text input-group-clear" (click)="clear()">\r\n            <i class="f-icon modal_close"></i>\r\n        </span>\r\n        <span class="f-select input-group-text"  (click)="showDialog()">\r\n            <i class="f-icon f-icon-lookup"></i>\r\n        </span>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #defaultButtonRef>\r\n    <button class="btn btn-outline-secondary" (click)="cancel()"> {{ \'filterEditor.cancelButton\'|locale }} </button>&nbsp;\r\n    <button class="btn btn-primary" (click)="save()"> {{ \'filterEditor.okButton\'| locale }} </button>\r\n</ng-template>',providers:[B,v],styles:["\n            .lookup-clear {\n                cursor: pointer;\n                background: #fff !important;\n            }\n            .lookup-clear:hover {\n                background: #e9ecef !important;\n            }\n        "]}]}],O.ctorParameters=function(){return[{type:m.Injector},{type:m.ComponentFactoryResolver},{type:i.BsModalService},{type:m.ElementRef},{type:v}]},O.propDecorators={hostCls:[{type:m.HostBinding,args:["class"]}],columns:[{type:m.Input}],showCode:[{type:m.Input}],showSql:[{type:m.Input}],enableExpress:[{type:m.Input}],fieldEditor:[{type:m.Input}],enableClear:[{type:m.Input}],returnType:[{type:m.Input}],insertType:[{type:m.Input}],useCustomValue:[{type:m.Input}],openDialog:[{type:m.Output}],showExpress:[{type:m.Output}],btnRef:[{type:m.ViewChild,args:["defaultButtonRef"]}],textbox:[{type:m.ViewChild,args:["txtbox"]}],onmouseover:[{type:m.HostListener,args:["mouseover",["$event"]]}],onmouseleave:[{type:m.HostListener,args:["mouseleave",["$event"]]}]},O);function O(t,e,n,o,i){var r=q.call(this,t,o)||this;return r.cfr=e,r.modalService=n,r.el=o,r.filterService=i,r.hostCls="f-cmp-inputgroup",r.text="",r.conditions=[],r.originalData=[],r.columns=[],r.showCode=!1,r.showSql=!1,r.enableExpress=!1,r.fieldEditor={type:"select",options:{}},r.enableClear=!0,r.returnType="object",r.insertType="below",r.useCustomValue=!1,r.openDialog=new m.EventEmitter,r.showExpress=new m.EventEmitter,r.showClearButton=!1,r.cd=null,r.commonUtils=null,r.notifySer=null,r.filterService.conditionsChanged.subscribe(function(t){r.conditions=t}),r.notifySer=r.injector.get(s.NotifyService,null),r.localeService=r.injector.get(y.LocaleService),r.cd=r.injector.get(m.ChangeDetectorRef),r.commonUtils=r.injector.get(h.CommonUtils,null)||new h.CommonUtils,r}var L=(j.prototype.ngOnInit=function(){this.sql=this.filterService.buildSqlWhere(this.conditions)},j.prototype.ngOnChanges=function(t){t.conditions&&!t.conditions.isFirstChange()&&(this.sql=this.filterService.buildSqlWhere(this.conditions))},j.decorators=[{type:m.Component,args:[{selector:"filter-sql",template:'\n    <pre class="flex-fill" [style.height.px]="height - 38">\n<code>{{ sql  }}</code>\n    </pre>\n    ',styles:["\n        pre {\n            color: #d8d9d9;\n            background: #424242;\n            padding-left: 20px;\n            padding-top: 20px;\n            margin-bottom: 0;\n            font-size: 16px;\n        }\n        "]}]}],j.ctorParameters=function(){return[{type:v}]},j.propDecorators={height:[{type:m.Input}],cls:[{type:m.HostBinding,args:["class"]}],conditions:[{type:m.Input}]},j);function j(t){this.filterService=t,this.cls="d-flex flex-column flex-fill",this.conditions=[],this.sql=""}var P=(U.prototype.ngOnInit=function(){this.el.nativeElement.style.overflow="auto"},U.decorators=[{type:m.Component,args:[{selector:"filter-code",template:'\n    <div style="overflow:auto" [style.height.px]="height - 38">\n        <pre class="flex-fill">\n            <code>{{ conditions | json }}</code>\n        </pre>\n    </div>\n    ',styles:["\n        pre {\n            color: #d8d9d9;\n            background: #424242;\n            padding-left: 20px;\n            padding-top: 20px;\n            margin-bottom: 0;\n            font-size: 16px;\n        }\n        "]}]}],U.ctorParameters=function(){return[{type:m.ElementRef}]},U.propDecorators={cls:[{type:m.HostBinding,args:["class"]}],height:[{type:m.Input}],conditions:[{type:m.Input}]},U);function U(t){this.el=t,this.cls="d-flex flex-column flex-fill",this.conditions=[]}var N=(_.decorators=[{type:m.NgModule,args:[{imports:[l.CommonModule,r.FormsModule,h.FarrisCommonModule,u.MessagerModule.forRoot(),d.PerfectScrollbarModule,p.FarrisDialogModule,c.LookupModule,f.InputGroupModule,y.LocaleModule.forRoot(),b.ComboLookupModule,g.FarrisFormsModule],exports:[V,E,S,T],declarations:[D,S,T,E,P,L,V],providers:[],entryComponents:[E]}]}],_);function _(){}t.FilterCodeComponent=P,t.FilterSqlCodeComponent=L,t.FilterService=v,t.FilterEditorComponent=E,t.FilterFooterComponent=T,t.FilterGridComponent=S,t.FilterTabsComponent=D,t.FILTER_LOOKUPGRID_VALUE_ACCESSOR=B,t.FilterComponent=V,t.FilterModule=N,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-filter-editor.umd.min.js.map
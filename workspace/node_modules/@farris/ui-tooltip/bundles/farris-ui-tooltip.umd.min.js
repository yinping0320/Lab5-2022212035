!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/platform-browser"),require("@angular/core"),require("@angular/common"),require("@farris/ui-common")):"function"==typeof define&&define.amd?define("@farris/ui-tooltip",["exports","rxjs","@angular/platform-browser","@angular/core","@angular/common","@farris/ui-common"],t):t((e.farris=e.farris||{},e.farris["ui-tooltip"]={}),e.rxjs,e.ng.platformBrowser,e.ng.core,e.ng.common,e.uiCommon)}(this,function(e,t,i,n,o,r){"use strict";var s=(l.prototype.catchAttention=function(e,t){var i=this;if(void 0===t&&(t=600),e&&0<e.length){for(var n=[],o=0;o<e.length;o++){var r;(r="string"==typeof e[o].idOrEl?document.getElementById(e[o].idOrEl):e[o].idOrEl)&&(n.push(r),this.renderer.addClass(r,"f-catch-attention-debounce"))}this.ngZone.runOutsideAngular(function(){setTimeout(function(){for(var e=0;e<n.length;e++)i.renderer.removeClass(n[e],"f-catch-attention-debounce")},t)})}},l.prototype.ngOnInit=function(){},l.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],l.ctorParameters=function(){return[{type:n.RendererFactory2},{type:n.NgZone}]},l.ngInjectableDef=n.defineInjectable({factory:function(){return new l(n.inject(n.RendererFactory2),n.inject(n.NgZone))},token:l,providedIn:"root"}),l);function l(e,t){this.ngZone=t,this.renderer=e.createRenderer(null,null)}var a=(h.prototype.ngOnInit=function(){},h.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],h.ctorParameters=function(){return[]},h.ngInjectableDef=n.defineInjectable({factory:function(){return new h},token:h,providedIn:"root"}),h);function h(){this.placement$=new t.Subject,this.show$=new t.Subject,this.calPosition$=new t.Subject}var c=(Object.defineProperty(p.prototype,"content",{get:function(){return this.nfContent},set:function(e){e instanceof n.TemplateRef?(this.contentIsString=!1,this.contentViewf.createEmbeddedView(e)):(this.contentIsString=!0,this.nfContent=e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"tipWidth",{get:function(){return this._tipWidth},set:function(e){e!=this._tipWidth&&(e?(this.render.setStyle(this.innerNode.nativeElement,"width",e),this.render.setStyle(this.innerNode.nativeElement,"max-width","none")):(this.render.removeStyle(this.innerNode.nativeElement,"width"),this.render.removeStyle(this.innerNode.nativeElement,"max-width")),this._tipWidth=e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"tipCls",{get:function(){return this._tipCls},set:function(e){e!=this._tipCls&&(this._tipCls&&this.render.removeClass(this.el.nativeElement,this._tipCls),e&&this.render.addClass(this.el.nativeElement,e),this._tipCls=e)},enumerable:!0,configurable:!0}),p.prototype.ngOnInit=function(){},p.prototype.ngAfterViewInit=function(){this.hostBoundingClientRect&&(this.judgeWidth(),this.autoRectifyDirection(),this.calculatePosition(this.hostBoundingClientRect))},p.prototype.judgeWidth=function(){this.innerNode.nativeElement.scrollHeight>this.innerNode.nativeElement.clientHeight&&this.render.addClass(this.innerNode.nativeElement,"tooltip-inner-lg")},p.prototype.autoRectifyDirection=function(){this.rectifyPlacement=this.placement;var e=this.tooltipNode.nativeElement.getBoundingClientRect(),t=this.arrowNode.nativeElement.getBoundingClientRect();switch(this.placement){case"top":case"top-left":case"top-right":Math.abs(this.hostBoundingClientRect.top-this.referenceBoundingRect.top)<e.height+t.height&&(this.rectifyPlacement=this.rectifyPlacement.replace("top","bottom"));break;case"bottom":case"bottom-left":case"bottom-right":Math.abs(this.hostBoundingClientRect.bottom-this.referenceBoundingRect.bottom)<e.height+t.height&&(this.rectifyPlacement=this.rectifyPlacement.replace("bottom","top"));break;case"right":case"right-top":case"right-bottom":Math.abs(this.hostBoundingClientRect.right-this.referenceBoundingRect.right)<e.width+t.width&&(this.rectifyPlacement=this.rectifyPlacement.replace("right","left"));break;case"left":case"left-top":case"left-bottom":Math.abs(this.hostBoundingClientRect.left-this.referenceBoundingRect.left)<e.width+t.width&&(this.rectifyPlacement=this.rectifyPlacement.replace("left","right"))}this.rectifyPlacement!=this.placement&&(this.tooltipNode.nativeElement.classList.remove("bs-tooltip-"+this.offsetDirection(this.placement)),this.tooltipNode.nativeElement.classList.add("bs-tooltip-"+this.offsetDirection(this.rectifyPlacement)))},p.prototype.isOverBounding=function(e,t){var i=!1,n=0;switch(e){case"left":t<=this.referenceBoundingRect.left&&(i=!0,n=this.referenceBoundingRect.left+this.rectifyGutter);break;case"right":t>=this.referenceBoundingRect.right&&(i=!0,n=this.referenceBoundingRect.right-this.rectifyGutter);break;case"top":t<=this.referenceBoundingRect.top&&(i=!0,n=this.referenceBoundingRect.top+this.rectifyGutter);break;case"bottom":t>=this.referenceBoundingRect.bottom&&(i=!0,n=this.referenceBoundingRect.bottom-this.rectifyGutter)}return{isOver:i,newValue:n}},p.prototype.containsEl=function(e,t){void 0===t&&(t=""),t=t||this.rectifyPlacement;for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1},p.prototype.calculatePosition=function(e){var t,i=0,n=0,o=0,r=this.tooltipNode.nativeElement.getBoundingClientRect(),s=this.arrowNode.nativeElement.getBoundingClientRect();switch(this.rectifyPlacement){case"top":i=e.top-r.height-2,o=(n=e.left+(e.width-r.width)/2)+r.width;break;case"left":i=e.top+(e.height-r.height)/2,n=e.left-r.width-2;break;case"right":i=e.top+(e.height-r.height)/2,n=e.right+2;break;case"bottom":i=e.bottom+s.height+2,o=(n=e.left+(e.width-r.width)/2)+r.width;break;case"top-left":i=e.top-r.height-2,o=(n=e.left)+r.width;break;case"top-right":i=e.top-r.height-2,n=e.right-r.width,o=e.right;break;case"right-top":i=e.top,n=e.right+2,this.arrowNode.nativeElement.style.top="10%";break;case"right-bottom":i=e.bottom-r.height,n=e.right+2,this.arrowNode.nativeElement.style.bottom="10%";break;case"bottom-left":i=e.bottom+s.height+2,o=(n=e.left)+r.width;break;case"bottom-right":i=e.bottom+s.height+2,n=e.right-r.width,o=e.right;break;case"left-top":i=e.top,n=e.left-r.width-2,this.arrowNode.nativeElement.style.top="10%";break;case"left-bottom":i=e.bottom-r.height,n=e.left-r.width-2,this.arrowNode.nativeElement.style.bottom="10%"}var l=0,a=0;switch(this.rectifyPlacement){case"top":case"top-left":case"top-right":case"bottom":case"bottom-left":case"bottom-right":(t=this.isOverBounding("left",n)).isOver?n=t.newValue:(t=this.isOverBounding("right",o)).isOver&&(n=t.newValue-r.width),l=n-e.left-.5*e.width+.5*s.width,0<this.rectifyPlacement.indexOf("-left")?l+=.4*e.width:0<this.rectifyPlacement.indexOf("-right")&&(l-=.4*e.width),this.arrowNode.nativeElement.style.left=Math.abs(l)+"px";break;default:(t=this.isOverBounding("top",i)).isOver?i=t.newValue:(t=this.isOverBounding("bottom",0)).isOver&&(i=t.newValue-r.height),a=i-e.top-.5*e.height+.5*s.height,0<this.rectifyPlacement.indexOf("-top")?a+=.4*e.height:0<this.rectifyPlacement.indexOf("-bottom")&&(a-=.4*e.height),this.arrowNode.nativeElement.style.top=Math.abs(a)+"px"}this.tooltipNode.nativeElement.style.top=i+"px",this.tooltipNode.nativeElement.style.left=n+"px"},p.prototype.offsetDirection=function(e){if(void 0===e&&(e=""),-1===(e=e||this.placement).indexOf("-"))return e;var t=e.indexOf("-");return e.substring(0,t)},p.decorators=[{type:n.Component,args:[{selector:"farris-tooltip",template:'<div #tooltipEle [class]="(\'bs-tooltip-\'+offsetDirection())+\' tooltip show\'" [style.zIndex]="zIndex">\r\n    <div #arrowEle class="arrow"></div>\r\n    <div #innerEle class="tooltip-inner">\r\n        <div #contentViewf class="tooltip-tmpl">\r\n            <div *ngIf="contentIsString" class="tooltip-text" [innerHtml]="nfContent|tooltipHtml"></div>\r\n            <ng-container *ngIf="!contentIsString"> {{nfContent}}</ng-container>\r\n        </div>       \r\n    </div>\r\n</div>',encapsulation:n.ViewEncapsulation.None,styles:[".bs-tooltip-bottom .arrow,.bs-tooltip-top .arrow{left:50%}.bs-tooltip-left .arrow,.bs-tooltip-right .arrow{top:25%}"]}]}],p.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2}]},p.propDecorators={contentViewf:[{type:n.ViewChild,args:["contentViewf",{read:n.ViewContainerRef}]}],tooltipNode:[{type:n.ViewChild,args:["tooltipEle",{read:n.ElementRef}]}],arrowNode:[{type:n.ViewChild,args:["arrowEle",{read:n.ElementRef}]}],innerNode:[{type:n.ViewChild,args:["innerEle",{read:n.ElementRef}]}],zIndex:[{type:n.Input}],content:[{type:n.Input}],tipWidth:[{type:n.Input}],tipCls:[{type:n.Input}],placement:[{type:n.Input}]},p);function p(e,t){this.el=e,this.render=t,this.zIndex="1070",this.contentIsString=!0,this._tipWidth="",this._tipCls="",this.placement="top",this.rectifyPlacement="top",this.rectifyGutter=20,this.positionStyle={}}var d=(Object.defineProperty(u.prototype,"enableTooltip",{get:function(){return this.tooltipEnable},set:function(e){"string"==typeof e&&""==e?this.enableOrDisable(!0):this.enableOrDisable(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"trigger",{get:function(){return this.triggerMode},set:function(e){e&&e!==this.triggerMode&&(this.triggerMode=e,this.unbindEvent(),this.bindEvent())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"disable",{get:function(){return!this.tooltipEnable},set:function(e){this.enableOrDisable(!e)},enumerable:!0,configurable:!0}),u.prototype.ngOnInit=function(){this.bindEvent()},u.prototype.ngAfterViewInit=function(){},u.prototype.ngOnDestroy=function(){this.unbindEvent(),this.removeTooltip(),this.overLayService.destory(this.el.nativeElement),this.overLayService=null},u.prototype.enableOrDisable=function(e){this.tooltipEnable=e,this.tooltipEnable?this.bindEvent():this.unbindEvent()},u.prototype.bindEvent=function(){var t=this;this.tooltipEnable&&(this.hasBindEvent||("click"===this.trigger?this.clickEvent=this.render.listen(this.el.nativeElement,"click",function(e){e.stopPropagation(),t.appendTooltip(),t.clickOutEvent=t.render.listen(document,"click",function(){t.removeTooltip(),t.clickOutEvent()})}):"focus"===this.trigger?(this.focusDownEvent=this.render.listen(this.el.nativeElement,"mousedown",function(e){e.preventDefault(),t.appendTooltip()}),this.focusUpEvent=this.render.listen(this.el.nativeElement,"mouseup",function(e){e.stopPropagation(),t.removeTooltip()})):(this.mouseenterEvent=this.render.listen(this.el.nativeElement,"mouseenter",function(e){e.stopPropagation(),t.delay?(t.delayTimer&&clearTimeout(t.delayTimer),t.delayTimer=setTimeout(function(){t.appendTooltip(),clearTimeout(t.delayTimer)},t.delay)):t.appendTooltip()}),this.mouseleaveEvent=this.render.listen(this.el.nativeElement,"mouseleave",function(e){e.stopPropagation(),t.delayTimer&&clearTimeout(t.delayTimer),t.removeTooltip()})),this.hasBindEvent=!0))},u.prototype.unbindEvent=function(){this.mouseenterEvent&&this.mouseenterEvent(),this.mouseleaveEvent&&this.mouseleaveEvent(),this.clickEvent&&this.clickEvent(),this.clickOutEvent&&this.clickOutEvent(),this.focusDownEvent&&this.focusDownEvent(),this.focusUpEvent&&this.focusUpEvent(),this.hasBindEvent=!1},u.prototype.removeTooltip=function(){this.tooltip&&(this.render.removeChild(document.body,this.tooltip.el.nativeElement),this._componentRef.changeDetectorRef.markForCheck(),this._componentRef.changeDetectorRef.detectChanges(),this._componentRef.destroy(),this.viewContainerRef.clear(),this.tooltip=null,this._componentRef=null,this.overLayService.destory(this.el.nativeElement))},u.prototype.appendTooltip=function(){var t=this;this.showTip&&(this.generateTooltip(),this.updateViewProps(this.placement,this.content,this.el.nativeElement.getBoundingClientRect(),this.getReferencePosition()),this.overLayService.registerMouseEvent(this.el.nativeElement,function(e){t.removeTooltip()}))},u.prototype.updateViewProps=function(e,t,i,n){this.tooltip.placement=e,this.tooltip.content=t,this.tooltip.hostBoundingClientRect=i,this.tooltip.tipCls=this.tipCls,this.tooltip.tipWidth=this.tipWidth,this.tooltip.referenceBoundingRect=n,this._componentRef.changeDetectorRef.markForCheck(),this._componentRef.changeDetectorRef.detectChanges()},u.prototype.generateTooltip=function(){this._componentRef=this.viewContainerRef.createComponent(this.componentFactory),this.tooltip=this._componentRef.instance,this.tooltip.zIndex=""+this.commUtils.getFloatingLayerIndex(),this.render.removeChild(this.render.parentNode(this.el.nativeElement),this.tooltip.el.nativeElement),this.render.appendChild(document.body,this.tooltip.el.nativeElement)},u.prototype.getReferencePosition=function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,i=0,n=0;if(this.rectifyReferenceH){var o=this.getRectifyReferenceElement(this.rectifyReferenceH);e=o.getBoundingClientRect().right,n=o.getBoundingClientRect().left}if(this.rectifyReferenceV){var r=this.getRectifyReferenceElement(this.rectifyReferenceV);t=r.getBoundingClientRect().bottom,i=r.getBoundingClientRect().top}return{top:i,left:n,right:e,bottom:t}},u.prototype.getRectifyReferenceElement=function(e){return e instanceof n.ElementRef?e.nativeElement:"string"==typeof e?document.querySelector(e):e},u.decorators=[{type:n.Directive,args:[{selector:"[farrisTooltip]"}]}],u.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2},{type:n.ViewContainerRef},{type:n.ComponentFactoryResolver}]},u.propDecorators={enableTooltip:[{type:n.Input,args:["farrisTooltip"]}],text:[{type:n.Input}],tipCls:[{type:n.Input}],tipWidth:[{type:n.Input}],placement:[{type:n.Input}],zIndex:[{type:n.Input}],trigger:[{type:n.Input}],disable:[{type:n.Input}],showTip:[{type:n.Input}],rectifyReferenceH:[{type:n.Input}],rectifyReferenceV:[{type:n.Input}],delay:[{type:n.Input}],content:[{type:n.Input}]},u);function u(e,t,i,n){this.el=e,this.render=t,this.viewContainerRef=i,this.resolver=n,this.tooltipEnable=!0,this.text="",this.tipCls="",this.tipWidth="",this.placement="top",this.zIndex="",this.triggerMode="hover",this.showTip=!0,this.delay=0,this.hasBindEvent=!1,this.delayTimer=null,this.componentFactory=this.resolver.resolveComponentFactory(c),this.overLayService=new r.OverLayHiddenService,this.commUtils=new r.CommonUtils}var f=(Object.defineProperty(m.prototype,"enableTips",{get:function(){return this._enableTips},set:function(e){this._enableTips!==e&&(this._enableTips=e,this.changeEventBind())},enumerable:!0,configurable:!0}),m.prototype.createCloneEl=function(){var i=this;if(this.el.nativeElement){var n=window.getComputedStyle(this.el.nativeElement);this.cloneEl=this.render.createElement("span"),this.cloneEl.innerText=n.value,["line-height","letter-spacing","font-size","font-family","font-style","font-weight","border","padding","height"].forEach(function(e,t){i.cloneEl.style[e]=n.getPropertyValue(e)}),this.render.addClass(this.cloneEl,"f-dir-hidden-el"),this.render.appendChild(document.body,this.cloneEl)}},m.prototype.ngAfterViewInit=function(){this.changeEventBind()},m.prototype.changeEventBind=function(){var e=this;this.enableTips?this.ngzone.runOutsideAngular(function(){e.mouseEnterListener=e.onMouseEnterHandler.bind(e),e.el.nativeElement.addEventListener("mouseenter",e.mouseEnterListener),e.mouseLeaveListener=e.onMouseLeaveHandler.bind(e),e.el.nativeElement.addEventListener("mouseleave",e.mouseLeaveListener)}):this.mouseEnterListener&&(this.el.nativeElement.removeEventListener("mouseenter",this.mouseEnterListener),this.mouseEnterListener=null,this.el.nativeElement.removeEventListener("mouseleave",this.mouseLeaveListener),this.mouseLeaveListener=null)},m.prototype.ngOnDestroy=function(){this.cloneEl&&this.render.removeChild(document.body,this.cloneEl)},m.prototype.onMouseEnterHandler=function(){this.changeTitle()},m.prototype.onMouseLeaveHandler=function(){this.render.setAttribute(this.el.nativeElement,"title","")},m.prototype.changeTitle=function(){var e=this;this.cloneEl||this.createCloneEl(),this.tipsText=this.el.nativeElement.value,this.cloneEl.innerText=this.tipsText,this.ngzone.runOutsideAngular(function(){setTimeout(function(){e.cloneEl.getBoundingClientRect().width>e.el.nativeElement.getBoundingClientRect().width?e.render.setAttribute(e.el.nativeElement,"title",e.tipsText):e.onMouseLeaveHandler()},0)})},m.decorators=[{type:n.Directive,args:[{selector:"[f-input-tips]"}]}],m.ctorParameters=function(){return[{type:n.ElementRef},{type:n.NgZone},{type:n.Renderer2}]},m.propDecorators={enableTips:[{type:n.Input,args:["f-input-tips"]}]},m);function m(e,t,i){this.el=e,this.ngzone=t,this.render=i,this.cloneEl=null,this.tipsText="",this._enableTips=!0}var g=(v.prototype.transform=function(e){return this._sanitizer.sanitize(n.SecurityContext.HTML,this._sanitizer.bypassSecurityTrustHtml(e))},v.decorators=[{type:n.Pipe,args:[{name:"tooltipHtml"}]}],v.ctorParameters=function(){return[{type:i.DomSanitizer}]},v);function v(e){this._sanitizer=e}var y=(b.decorators=[{type:n.NgModule,args:[{declarations:[d,c,f,g],imports:[o.CommonModule,r.FarrisCommonModule],providers:[s],entryComponents:[c],exports:[d,c,f]}]}],b);function b(){}e.AttentionService=s,e.TooltipService=a,e.FarrisTooltipDirective=d,e.FInputTipsDirective=f,e.tooltipHtmlPipe=g,e.TooltipComponent=c,e.FarrisTooltipModule=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=farris-ui-tooltip.umd.min.js.map
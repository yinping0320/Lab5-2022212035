/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, ElementRef, Renderer2, ViewContainerRef, ComponentFactoryResolver, } from "@angular/core";
import { OverLayHiddenService, CommonUtils } from "@farris/ui-common";
import { TooltipComponent } from "./tooltip-component/tooltip.component";
var FarrisTooltipDirective = /** @class */ (function () {
    function FarrisTooltipDirective(el, render, viewContainerRef, resolver) {
        this.el = el;
        this.render = render;
        this.viewContainerRef = viewContainerRef;
        this.resolver = resolver;
        this.tooltipEnable = true;
        /* 提示文本 */
        this.text = "";
        // 提示框样式
        this.tipCls = "";
        // 提示框宽度
        this.tipWidth = "";
        /* 位置 */
        this.placement = "top";
        this.zIndex = '';
        this.triggerMode = "hover";
        this.showTip = true;
        this.delay = 0;
        // 是否绑定了事件
        this.hasBindEvent = false;
        this.delayTimer = null;
        /* 生成提示组件 */
        this.componentFactory = this.resolver.resolveComponentFactory(TooltipComponent);
        this.overLayService = new OverLayHiddenService();
        this.commUtils = new CommonUtils();
    }
    Object.defineProperty(FarrisTooltipDirective.prototype, "enableTooltip", {
        get: /**
         * @return {?}
         */
        function () {
            return this.tooltipEnable;
        },
        // 5月7日追加这种写法，控制禁用、启用
        // 原来的时候value是空字符串
        set: 
        // 5月7日追加这种写法，控制禁用、启用
        // 原来的时候value是空字符串
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (typeof value == "string" && value == "") {
                this.enableOrDisable(true);
            }
            else {
                this.enableOrDisable(value);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTooltipDirective.prototype, "trigger", {
        get: /**
         * @return {?}
         */
        function () {
            return this.triggerMode;
        },
        /* 触发方式 */
        set: /* 触发方式 */
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value) {
                if (value !== this.triggerMode) {
                    this.triggerMode = value;
                    this.unbindEvent();
                    this.bindEvent();
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FarrisTooltipDirective.prototype, "disable", {
        get: /**
         * @return {?}
         */
        function () {
            return !this.tooltipEnable;
        },
        /* 禁用---跟其他控件的属性容易冲突，逐渐废弃。
         * 比如按钮可以设置禁用不触发点击，但想给出点击提示，这样就冲突了
         */
        set: /* 禁用---跟其他控件的属性容易冲突，逐渐废弃。
             * 比如按钮可以设置禁用不触发点击，但想给出点击提示，这样就冲突了
             */
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.enableOrDisable(!value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.bindEvent();
    };
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.unbindEvent();
        this.removeTooltip();
        this.overLayService.destory(this.el.nativeElement);
        this.overLayService = null;
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    FarrisTooltipDirective.prototype.enableOrDisable = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.tooltipEnable = value;
        if (this.tooltipEnable) {
            this.bindEvent();
        }
        else {
            this.unbindEvent();
        }
    };
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.bindEvent = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.tooltipEnable) {
            return;
        }
        // 是否已绑定事件
        if (this.hasBindEvent) {
            return;
        }
        if (this.trigger === "click") {
            // 鼠标点击
            this.clickEvent = this.render.listen(this.el.nativeElement, "click", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                _this.appendTooltip();
                _this.clickOutEvent = _this.render.listen(document, "click", (/**
                 * @return {?}
                 */
                function () {
                    _this.removeTooltip();
                    _this.clickOutEvent();
                }));
            }));
        }
        else if (this.trigger === "focus") {
            // 聚焦
            // @Todo 需要把input等组件和普通组件分开
            this.focusDownEvent = this.render.listen(this.el.nativeElement, "mousedown", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.preventDefault();
                _this.appendTooltip();
            }));
            this.focusUpEvent = this.render.listen(this.el.nativeElement, "mouseup", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                _this.removeTooltip();
            }));
        }
        else {
            // 鼠标移动上去
            this.mouseenterEvent = this.render.listen(this.el.nativeElement, "mouseenter", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (_this.delay) {
                    if (_this.delayTimer) {
                        clearTimeout(_this.delayTimer);
                    }
                    _this.delayTimer = setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        _this.appendTooltip();
                        clearTimeout(_this.delayTimer);
                    }), _this.delay);
                }
                else {
                    _this.appendTooltip();
                }
            }));
            this.mouseleaveEvent = this.render.listen(this.el.nativeElement, "mouseleave", (/**
             * @param {?} e
             * @return {?}
             */
            function (e) {
                e.stopPropagation();
                if (_this.delayTimer) {
                    clearTimeout(_this.delayTimer);
                }
                _this.removeTooltip();
            }));
        }
        this.hasBindEvent = true;
    };
    /* 解绑事件 */
    /* 解绑事件 */
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.unbindEvent = /* 解绑事件 */
    /**
     * @return {?}
     */
    function () {
        // 鼠标移上去
        if (this.mouseenterEvent) {
            this.mouseenterEvent();
        }
        if (this.mouseleaveEvent) {
            this.mouseleaveEvent();
        }
        if (this.clickEvent) {
            this.clickEvent();
        }
        if (this.clickOutEvent) {
            this.clickOutEvent();
        }
        if (this.focusDownEvent) {
            this.focusDownEvent();
        }
        if (this.focusUpEvent) {
            this.focusUpEvent();
        }
        this.hasBindEvent = false;
    };
    /* body  移除tooltip */
    /* body  移除tooltip */
    /**
     * @return {?}
     */
    FarrisTooltipDirective.prototype.removeTooltip = /* body  移除tooltip */
    /**
     * @return {?}
     */
    function () {
        if (this.tooltip) {
            this.render.removeChild(document.body, this.tooltip.el.nativeElement);
            this._componentRef.changeDetectorRef.markForCheck();
            this._componentRef.changeDetectorRef.detectChanges();
            this._componentRef.destroy();
            this.viewContainerRef.clear();
            this.tooltip = null;
            this._componentRef = null;
            this.overLayService.destory(this.el.nativeElement);
        }
    };
    /**
     * @private
     * @return {?}
     */
    FarrisTooltipDirective.prototype.appendTooltip = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.showTip)
            return;
        this.generateTooltip();
        this.updateViewProps(this.placement, this.content, this.el.nativeElement.getBoundingClientRect(), this.getReferencePosition());
        this.overLayService.registerMouseEvent(this.el.nativeElement, (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.removeTooltip();
        }));
    };
    /* 更新tooltip组件属性 */
    /* 更新tooltip组件属性 */
    /**
     * @private
     * @param {?} placement
     * @param {?} content
     * @param {?} hostBoundingClientRect
     * @param {?} referenceBoundingRect
     * @return {?}
     */
    FarrisTooltipDirective.prototype.updateViewProps = /* 更新tooltip组件属性 */
    /**
     * @private
     * @param {?} placement
     * @param {?} content
     * @param {?} hostBoundingClientRect
     * @param {?} referenceBoundingRect
     * @return {?}
     */
    function (placement, content, hostBoundingClientRect, referenceBoundingRect) {
        this.tooltip.placement = placement;
        this.tooltip.content = content;
        this.tooltip.hostBoundingClientRect = hostBoundingClientRect;
        this.tooltip.tipCls = this.tipCls;
        this.tooltip.tipWidth = this.tipWidth;
        this.tooltip.referenceBoundingRect = referenceBoundingRect;
        this._componentRef.changeDetectorRef.markForCheck();
        this._componentRef.changeDetectorRef.detectChanges();
    };
    /* 构造tooltip结构 */
    /* 构造tooltip结构 */
    /**
     * @private
     * @return {?}
     */
    FarrisTooltipDirective.prototype.generateTooltip = /* 构造tooltip结构 */
    /**
     * @private
     * @return {?}
     */
    function () {
        this._componentRef = this.viewContainerRef.createComponent(this.componentFactory);
        this.tooltip = this._componentRef.instance;
        this.tooltip.zIndex = '' + this.commUtils.getFloatingLayerIndex();
        // 父元素中移除  添加到body中
        this.render.removeChild(this.render.parentNode(this.el.nativeElement), this.tooltip.el.nativeElement);
        this.render.appendChild(document.body, this.tooltip.el.nativeElement);
    };
    /**
     * 确认参照的边界
     */
    /**
     * 确认参照的边界
     * @private
     * @return {?}
     */
    FarrisTooltipDirective.prototype.getReferencePosition = /**
     * 确认参照的边界
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var rRight = document.documentElement.clientWidth;
        /** @type {?} */
        var rBottom = document.documentElement.clientHeight;
        /** @type {?} */
        var rTop = 0;
        /** @type {?} */
        var rLeft = 0;
        // 横向参照
        if (this.rectifyReferenceH) {
            /** @type {?} */
            var rectifyReferenceHEl = this.getRectifyReferenceElement(this.rectifyReferenceH);
            rRight = rectifyReferenceHEl.getBoundingClientRect().right;
            rLeft = rectifyReferenceHEl.getBoundingClientRect().left;
        }
        // 纵向参照
        if (this.rectifyReferenceV) {
            /** @type {?} */
            var rectifyReferenceVEl = this.getRectifyReferenceElement(this.rectifyReferenceV);
            rBottom = rectifyReferenceVEl.getBoundingClientRect().bottom;
            rTop = rectifyReferenceVEl.getBoundingClientRect().top;
        }
        return { top: rTop, left: rLeft, right: rRight, bottom: rBottom };
    };
    /**
     * 获取纠正元素
     */
    /**
     * 获取纠正元素
     * @private
     * @param {?} referenceEl
     * @return {?}
     */
    FarrisTooltipDirective.prototype.getRectifyReferenceElement = /**
     * 获取纠正元素
     * @private
     * @param {?} referenceEl
     * @return {?}
     */
    function (referenceEl) {
        if (referenceEl instanceof ElementRef) {
            return referenceEl.nativeElement;
        }
        else if (typeof referenceEl == "string") {
            return document.querySelector((/** @type {?} */ (referenceEl)));
        }
        return referenceEl;
    };
    FarrisTooltipDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[farrisTooltip]",
                },] }
    ];
    /** @nocollapse */
    FarrisTooltipDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: ViewContainerRef },
        { type: ComponentFactoryResolver }
    ]; };
    FarrisTooltipDirective.propDecorators = {
        enableTooltip: [{ type: Input, args: ["farrisTooltip",] }],
        text: [{ type: Input }],
        tipCls: [{ type: Input }],
        tipWidth: [{ type: Input }],
        placement: [{ type: Input }],
        zIndex: [{ type: Input }],
        trigger: [{ type: Input }],
        disable: [{ type: Input }],
        showTip: [{ type: Input }],
        rectifyReferenceH: [{ type: Input }],
        rectifyReferenceV: [{ type: Input }],
        delay: [{ type: Input }],
        content: [{ type: Input }]
    };
    return FarrisTooltipDirective;
}());
export { FarrisTooltipDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.tooltipEnable;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype._componentRef;
    /** @type {?} */
    FarrisTooltipDirective.prototype.text;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tipCls;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tipWidth;
    /** @type {?} */
    FarrisTooltipDirective.prototype.placement;
    /** @type {?} */
    FarrisTooltipDirective.prototype.zIndex;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.triggerMode;
    /** @type {?} */
    FarrisTooltipDirective.prototype.showTip;
    /** @type {?} */
    FarrisTooltipDirective.prototype.rectifyReferenceH;
    /** @type {?} */
    FarrisTooltipDirective.prototype.rectifyReferenceV;
    /** @type {?} */
    FarrisTooltipDirective.prototype.delay;
    /** @type {?} */
    FarrisTooltipDirective.prototype.content;
    /** @type {?} */
    FarrisTooltipDirective.prototype.mouseenterEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.mouseleaveEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.clickEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.clickOutEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.focusDownEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.focusUpEvent;
    /** @type {?} */
    FarrisTooltipDirective.prototype.docBody;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.hasBindEvent;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.delayTimer;
    /** @type {?} */
    FarrisTooltipDirective.prototype.componentFactory;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tooltipRef;
    /** @type {?} */
    FarrisTooltipDirective.prototype.tooltip;
    /** @type {?} */
    FarrisTooltipDirective.prototype.overLayService;
    /** @type {?} */
    FarrisTooltipDirective.prototype.commUtils;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.render;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    FarrisTooltipDirective.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZmFycmlzL3VpLXRvb2x0aXAvIiwic291cmNlcyI6WyJsaWIvdG9vbHRpcC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFFSCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFVBQVUsRUFFVixTQUFTLEVBSVQsZ0JBQWdCLEVBQ2hCLHdCQUF3QixHQUczQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDdEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDekU7SUEyRkksZ0NBQ1ksRUFBYyxFQUNkLE1BQWlCLEVBQ2pCLGdCQUFrQyxFQUNsQyxRQUFrQztRQUhsQyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNqQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBekZ0QyxrQkFBYSxHQUFZLElBQUksQ0FBQzs7UUFnQjdCLFNBQUksR0FBRyxFQUFFLENBQUM7O1FBRVYsV0FBTSxHQUFHLEVBQUUsQ0FBQzs7UUFFWixhQUFRLEdBQUcsRUFBRSxDQUFDOztRQUVkLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFFbEIsV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUViLGdCQUFXLEdBQUcsT0FBTyxDQUFDO1FBNEJyQixZQUFPLEdBQVksSUFBSSxDQUFDO1FBTXhCLFVBQUssR0FBRyxDQUFDLENBQUM7O1FBYVgsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFFckIsZUFBVSxHQUFHLElBQUksQ0FBQzs7UUFHMUIscUJBQWdCLEdBQ1osSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBWXhELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxvQkFBb0IsRUFBRSxDQUFDO1FBQ2pELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztJQUN2QyxDQUFDO0lBekZELHNCQUNJLGlEQUFhOzs7O1FBT2pCO1lBQ0ksT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzlCLENBQUM7UUFaRCxxQkFBcUI7UUFDckIsa0JBQWtCOzs7Ozs7OztRQUNsQixVQUNrQixLQUFVO1lBQ3hCLElBQUksT0FBTyxLQUFLLElBQUksUUFBUSxJQUFJLEtBQUssSUFBSSxFQUFFLEVBQUU7Z0JBQ3pDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDOUI7aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMvQjtRQUNMLENBQUM7OztPQUFBO0lBa0JELHNCQUNJLDJDQUFPOzs7O1FBU1g7WUFDSSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDNUIsQ0FBQztRQWJELFVBQVU7Ozs7OztRQUNWLFVBQ1ksS0FBSztZQUNiLElBQUksS0FBSyxFQUFFO2dCQUNQLElBQUksS0FBSyxLQUFLLElBQUksQ0FBQyxXQUFXLEVBQUU7b0JBQzVCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO29CQUN6QixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQ25CLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztpQkFDcEI7YUFDSjtRQUNMLENBQUM7OztPQUFBO0lBUUQsc0JBQ0ksMkNBQU87Ozs7UUFHWDtZQUNJLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQy9CLENBQUM7UUFURDs7V0FFRzs7Ozs7Ozs7UUFDSCxVQUNZLEtBQUs7WUFDYixJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakMsQ0FBQzs7O09BQUE7Ozs7SUE4Q0QseUNBQVE7OztJQUFSO1FBQ0ksSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3JCLENBQUM7Ozs7SUFFRCxnREFBZTs7O0lBQWYsY0FBeUIsQ0FBQzs7OztJQUUxQiw0Q0FBVzs7O0lBQVg7UUFDSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7SUFDL0IsQ0FBQzs7Ozs7O0lBQ08sZ0RBQWU7Ozs7O0lBQXZCLFVBQXdCLEtBQUs7UUFDekIsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7UUFDM0IsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztTQUNwQjthQUFNO1lBQ0gsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ3RCO0lBQ0wsQ0FBQzs7OztJQUVELDBDQUFTOzs7SUFBVDtRQUFBLGlCQThFQztRQTdFRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNyQixPQUFPO1NBQ1Y7UUFDRCxVQUFVO1FBQ1YsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ25CLE9BQU87U0FDVjtRQUNELElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxPQUFPLEVBQUU7WUFDMUIsT0FBTztZQUNQLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQ2hDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUNyQixPQUFPOzs7O1lBQ1AsVUFBQyxDQUFhO2dCQUNWLENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDcEIsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUNyQixLQUFJLENBQUMsYUFBYSxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUNuQyxRQUFRLEVBQ1IsT0FBTzs7O2dCQUNQO29CQUNJLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztvQkFDckIsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUN6QixDQUFDLEVBQ0osQ0FBQztZQUNOLENBQUMsRUFDSixDQUFDO1NBQ0w7YUFBTSxJQUFJLElBQUksQ0FBQyxPQUFPLEtBQUssT0FBTyxFQUFFO1lBQ2pDLEtBQUs7WUFDTCwyQkFBMkI7WUFDM0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQ3JCLFdBQVc7Ozs7WUFDWCxVQUFDLENBQWE7Z0JBQ1YsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUNuQixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDekIsQ0FBQyxFQUNKLENBQUM7WUFDRixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUNsQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFDckIsU0FBUzs7OztZQUNULFVBQUMsQ0FBYTtnQkFDVixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQ3BCLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN6QixDQUFDLEVBQ0osQ0FBQztTQUNMO2FBQU07WUFDSCxTQUFTO1lBQ1QsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FDckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQ3JCLFlBQVk7Ozs7WUFDWixVQUFDLENBQWE7Z0JBQ1YsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUNwQixJQUFJLEtBQUksQ0FBQyxLQUFLLEVBQUU7b0JBQ1osSUFBSSxLQUFJLENBQUMsVUFBVSxFQUFFO3dCQUNqQixZQUFZLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO3FCQUNqQztvQkFDRCxLQUFJLENBQUMsVUFBVSxHQUFHLFVBQVU7OztvQkFBQzt3QkFDekIsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO3dCQUNyQixZQUFZLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUNsQyxDQUFDLEdBQUUsS0FBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUNsQjtxQkFBTTtvQkFDSCxLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7aUJBQ3hCO1lBQ0wsQ0FBQyxFQUNKLENBQUM7WUFDRixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUNyQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFDckIsWUFBWTs7OztZQUNaLFVBQUMsQ0FBYTtnQkFDVixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQ3BCLElBQUksS0FBSSxDQUFDLFVBQVUsRUFBRTtvQkFDakIsWUFBWSxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztpQkFDakM7Z0JBQ0QsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ3pCLENBQUMsRUFDSixDQUFDO1NBQ0w7UUFDRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDO0lBRUQsVUFBVTs7Ozs7SUFDViw0Q0FBVzs7OztJQUFYO1FBQ0ksUUFBUTtRQUNSLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN0QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDMUI7UUFDRCxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDdEIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQzFCO1FBQ0QsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNyQjtRQUNELElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNwQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDeEI7UUFDRCxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDckIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3pCO1FBQ0QsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ25CLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO0lBQzlCLENBQUM7SUFFRCxxQkFBcUI7Ozs7O0lBQ3JCLDhDQUFhOzs7O0lBQWI7UUFDSSxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDZCxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FDbkIsUUFBUSxDQUFDLElBQUksRUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQ2hDLENBQUM7WUFDRixJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BELElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDckQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUM3QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDOUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDcEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7WUFFMUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUN0RDtJQUNMLENBQUM7Ozs7O0lBRU8sOENBQWE7Ozs7SUFBckI7UUFBQSxpQkFhQztRQVpHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTztZQUFFLE9BQU87UUFDMUIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxlQUFlLENBQ2hCLElBQUksQ0FBQyxTQUFTLEVBQ2QsSUFBSSxDQUFDLE9BQU8sRUFDWixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxFQUM3QyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FDOUIsQ0FBQztRQUVGLElBQUksQ0FBQyxjQUFjLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhOzs7O1FBQUUsVUFBQyxDQUFhO1lBQ3hFLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QixDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxtQkFBbUI7Ozs7Ozs7Ozs7SUFDWCxnREFBZTs7Ozs7Ozs7O0lBQXZCLFVBQ0ksU0FBaUIsRUFDakIsT0FBa0MsRUFDbEMsc0JBQThCLEVBQzlCLHFCQUFxQjtRQUVyQixJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQy9CLElBQUksQ0FBQyxPQUFPLENBQUMsc0JBQXNCLEdBQUcsc0JBQXNCLENBQUM7UUFDN0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxPQUFPLENBQUMscUJBQXFCLEdBQUcscUJBQXFCLENBQUM7UUFDM0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3pELENBQUM7SUFFRCxpQkFBaUI7Ozs7OztJQUNULGdEQUFlOzs7OztJQUF2QjtRQUNJLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FDdEQsSUFBSSxDQUFDLGdCQUFnQixDQUN4QixDQUFDO1FBQ0YsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQztRQUMzQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBR2xFLG1CQUFtQjtRQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUNoQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQ7O09BRUc7Ozs7OztJQUNLLHFEQUFvQjs7Ozs7SUFBNUI7O1lBQ1EsTUFBTSxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsV0FBVzs7WUFDN0MsT0FBTyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWTs7WUFDL0MsSUFBSSxHQUFHLENBQUM7O1lBQ1IsS0FBSyxHQUFHLENBQUM7UUFDYixPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7O2dCQUNwQixtQkFBbUIsR0FBRyxJQUFJLENBQUMsMEJBQTBCLENBQ3JELElBQUksQ0FBQyxpQkFBaUIsQ0FDekI7WUFDRCxNQUFNLEdBQUcsbUJBQW1CLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDM0QsS0FBSyxHQUFHLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFLENBQUMsSUFBSSxDQUFDO1NBQzVEO1FBQ0QsT0FBTztRQUNQLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFOztnQkFDcEIsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUNyRCxJQUFJLENBQUMsaUJBQWlCLENBQ3pCO1lBQ0QsT0FBTyxHQUFHLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFLENBQUMsTUFBTSxDQUFDO1lBQzdELElBQUksR0FBRyxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsQ0FBQztTQUMxRDtRQUNELE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7SUFDdEUsQ0FBQztJQUNEOztPQUVHOzs7Ozs7O0lBQ0ssMkRBQTBCOzs7Ozs7SUFBbEMsVUFBbUMsV0FBVztRQUMxQyxJQUFJLFdBQVcsWUFBWSxVQUFVLEVBQUU7WUFDbkMsT0FBTyxXQUFXLENBQUMsYUFBYSxDQUFDO1NBQ3BDO2FBQU0sSUFBSSxPQUFPLFdBQVcsSUFBSSxRQUFRLEVBQUU7WUFDdkMsT0FBTyxRQUFRLENBQUMsYUFBYSxDQUFDLG1CQUFBLFdBQVcsRUFBVSxDQUFDLENBQUM7U0FDeEQ7UUFDRCxPQUFPLFdBQVcsQ0FBQztJQUN2QixDQUFDOztnQkExVUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxpQkFBaUI7aUJBQzlCOzs7O2dCQWZHLFVBQVU7Z0JBRVYsU0FBUztnQkFJVCxnQkFBZ0I7Z0JBQ2hCLHdCQUF3Qjs7O2dDQWdCdkIsS0FBSyxTQUFDLGVBQWU7dUJBWXJCLEtBQUs7eUJBRUwsS0FBSzsyQkFFTCxLQUFLOzRCQUVMLEtBQUs7eUJBRUwsS0FBSzswQkFLTCxLQUFLOzBCQWlCTCxLQUFLOzBCQVFMLEtBQUs7b0NBRUwsS0FBSztvQ0FFTCxLQUFLO3dCQUVMLEtBQUs7MEJBR0wsS0FBSzs7SUFzUVYsNkJBQUM7Q0FBQSxBQTNVRCxJQTJVQztTQXhVWSxzQkFBc0I7Ozs7OztJQUcvQiwrQ0FBc0M7Ozs7O0lBQ3RDLCtDQUFzRDs7SUFldEQsc0NBQW1COztJQUVuQix3Q0FBcUI7O0lBRXJCLDBDQUF1Qjs7SUFFdkIsMkNBQTJCOztJQUUzQix3Q0FBcUI7Ozs7O0lBRXJCLDZDQUE4Qjs7SUE0QjlCLHlDQUFpQzs7SUFFakMsbURBQTBEOztJQUUxRCxtREFBMEQ7O0lBRTFELHVDQUFtQjs7SUFHbkIseUNBQTRDOztJQUU1QyxpREFBcUI7O0lBQ3JCLGlEQUFxQjs7SUFDckIsNENBQWdCOztJQUNoQiwrQ0FBbUI7O0lBQ25CLGdEQUFvQjs7SUFDcEIsOENBQWtCOztJQUNsQix5Q0FBYTs7Ozs7SUFFYiw4Q0FBNkI7Ozs7O0lBRTdCLDRDQUEwQjs7SUFHMUIsa0RBQzREOztJQUU1RCw0Q0FBZ0I7O0lBQ2hCLHlDQUEwQjs7SUFDMUIsZ0RBQXFDOztJQUNyQywyQ0FBdUI7Ozs7O0lBRW5CLG9DQUFzQjs7Ozs7SUFDdEIsd0NBQXlCOzs7OztJQUN6QixrREFBMEM7Ozs7O0lBQzFDLDBDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBPbkluaXQsXHJcbiAgICBEaXJlY3RpdmUsXHJcbiAgICBJbnB1dCxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgVGVtcGxhdGVSZWYsXHJcbiAgICBDb21wb25lbnRGYWN0b3J5LFxyXG4gICAgVmlld0NvbnRhaW5lclJlZixcclxuICAgIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIE5nWm9uZSxcclxuICAgIENvbXBvbmVudFJlZixcclxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBPdmVyTGF5SGlkZGVuU2VydmljZSwgQ29tbW9uVXRpbHMgfSBmcm9tIFwiQGZhcnJpcy91aS1jb21tb25cIjtcclxuaW1wb3J0IHsgVG9vbHRpcENvbXBvbmVudCB9IGZyb20gXCIuL3Rvb2x0aXAtY29tcG9uZW50L3Rvb2x0aXAuY29tcG9uZW50XCI7XHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6IFwiW2ZhcnJpc1Rvb2x0aXBdXCIsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGYXJyaXNUb29sdGlwRGlyZWN0aXZlXHJcbiAgICBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95XHJcbntcclxuICAgIHByaXZhdGUgdG9vbHRpcEVuYWJsZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgICBwcml2YXRlIF9jb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxUb29sdGlwQ29tcG9uZW50PjtcclxuICAgIC8vIDXmnIg35pel6L+95Yqg6L+Z56eN5YaZ5rOV77yM5o6n5Yi256aB55So44CB5ZCv55SoXHJcbiAgICAvLyDljp/mnaXnmoTml7blgJl2YWx1ZeaYr+epuuWtl+espuS4slxyXG4gICAgQElucHV0KFwiZmFycmlzVG9vbHRpcFwiKVxyXG4gICAgc2V0IGVuYWJsZVRvb2x0aXAodmFsdWU6IGFueSkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gXCJzdHJpbmdcIiAmJiB2YWx1ZSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlT3JEaXNhYmxlKHRydWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlT3JEaXNhYmxlKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXQgZW5hYmxlVG9vbHRpcCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50b29sdGlwRW5hYmxlO1xyXG4gICAgfVxyXG4gICAgLyog5o+Q56S65paH5pysICovXHJcbiAgICBASW5wdXQoKSB0ZXh0ID0gXCJcIjtcclxuICAgIC8vIOaPkOekuuahhuagt+W8j1xyXG4gICAgQElucHV0KCkgdGlwQ2xzID0gXCJcIjtcclxuICAgIC8vIOaPkOekuuahhuWuveW6plxyXG4gICAgQElucHV0KCkgdGlwV2lkdGggPSBcIlwiO1xyXG4gICAgLyog5L2N572uICovXHJcbiAgICBASW5wdXQoKSBwbGFjZW1lbnQgPSBcInRvcFwiO1xyXG5cclxuICAgIEBJbnB1dCgpIHpJbmRleCA9ICcnO1xyXG5cclxuICAgIHByaXZhdGUgdHJpZ2dlck1vZGUgPSBcImhvdmVyXCI7XHJcblxyXG4gICAgLyog6Kem5Y+R5pa55byPICovXHJcbiAgICBASW5wdXQoKVxyXG4gICAgc2V0IHRyaWdnZXIodmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLnRyaWdnZXJNb2RlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJNb2RlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRFdmVudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHRyaWdnZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlck1vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgLyog56aB55SoLS0t6Lef5YW25LuW5o6n5Lu255qE5bGe5oCn5a655piT5Yay56qB77yM6YCQ5riQ5bqf5byD44CCXHJcbiAgICAgKiDmr5TlpoLmjInpkq7lj6/ku6Xorr7nva7npoHnlKjkuI3op6blj5Hngrnlh7vvvIzkvYbmg7Pnu5nlh7rngrnlh7vmj5DnpLrvvIzov5nmoLflsLHlhrLnqoHkuoZcclxuICAgICAqL1xyXG4gICAgQElucHV0KClcclxuICAgIHNldCBkaXNhYmxlKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5lbmFibGVPckRpc2FibGUoIXZhbHVlKTtcclxuICAgIH1cclxuICAgIGdldCBkaXNhYmxlKCkge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy50b29sdGlwRW5hYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIHNob3dUaXA6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgLy8g5qiq5ZCR57qg5q2j55qE5Y+C54WnXHJcbiAgICBASW5wdXQoKSByZWN0aWZ5UmVmZXJlbmNlSDogRWxlbWVudCB8IEVsZW1lbnRSZWYgfCBzdHJpbmc7XHJcbiAgICAvLyDnurXlkJHnuqDmraPnmoTlj4LnhadcclxuICAgIEBJbnB1dCgpIHJlY3RpZnlSZWZlcmVuY2VWOiBFbGVtZW50IHwgRWxlbWVudFJlZiB8IHN0cmluZztcclxuXHJcbiAgICBASW5wdXQoKSBkZWxheSA9IDA7XHJcblxyXG4gICAgLyog5YaF5a655qih5p2/ICovXHJcbiAgICBASW5wdXQoKSBjb250ZW50OiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAgIG1vdXNlZW50ZXJFdmVudDogYW55O1xyXG4gICAgbW91c2VsZWF2ZUV2ZW50OiBhbnk7XHJcbiAgICBjbGlja0V2ZW50OiBhbnk7XHJcbiAgICBjbGlja091dEV2ZW50OiBhbnk7XHJcbiAgICBmb2N1c0Rvd25FdmVudDogYW55O1xyXG4gICAgZm9jdXNVcEV2ZW50OiBhbnk7XHJcbiAgICBkb2NCb2R5OiBhbnk7XHJcbiAgICAvLyDmmK/lkKbnu5Hlrprkuobkuovku7ZcclxuICAgIHByaXZhdGUgaGFzQmluZEV2ZW50ID0gZmFsc2U7XHJcblxyXG4gICAgcHJpdmF0ZSBkZWxheVRpbWVyID0gbnVsbDtcclxuXHJcbiAgICAvKiDnlJ/miJDmj5DnpLrnu4Tku7YgKi9cclxuICAgIGNvbXBvbmVudEZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8VG9vbHRpcENvbXBvbmVudD4gPVxyXG4gICAgICAgIHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVG9vbHRpcENvbXBvbmVudCk7XHJcblxyXG4gICAgdG9vbHRpcFJlZjogYW55O1xyXG4gICAgdG9vbHRpcDogVG9vbHRpcENvbXBvbmVudDtcclxuICAgIG92ZXJMYXlTZXJ2aWNlOiBPdmVyTGF5SGlkZGVuU2VydmljZTtcclxuICAgIGNvbW1VdGlsczogQ29tbW9uVXRpbHM7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIHByaXZhdGUgcmVuZGVyOiBSZW5kZXJlcjIsXHJcbiAgICAgICAgcHJpdmF0ZSB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZSA9IG5ldyBPdmVyTGF5SGlkZGVuU2VydmljZSgpO1xyXG4gICAgICAgIHRoaXMuY29tbVV0aWxzID0gbmV3IENvbW1vblV0aWxzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7fVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMudW5iaW5kRXZlbnQoKTtcclxuICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcclxuXHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZS5kZXN0b3J5KHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZSA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGVuYWJsZU9yRGlzYWJsZSh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMudG9vbHRpcEVuYWJsZSA9IHZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLnRvb2x0aXBFbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnVuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGJpbmRFdmVudCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMudG9vbHRpcEVuYWJsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOaYr+WQpuW3sue7keWumuS6i+S7tlxyXG4gICAgICAgIGlmICh0aGlzLmhhc0JpbmRFdmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnRyaWdnZXIgPT09IFwiY2xpY2tcIikge1xyXG4gICAgICAgICAgICAvLyDpvKDmoIfngrnlh7tcclxuICAgICAgICAgICAgdGhpcy5jbGlja0V2ZW50ID0gdGhpcy5yZW5kZXIubGlzdGVuKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgXCJjbGlja1wiLFxyXG4gICAgICAgICAgICAgICAgKGU6IE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpY2tPdXRFdmVudCA9IHRoaXMucmVuZGVyLmxpc3RlbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xpY2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVUb29sdGlwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrT3V0RXZlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRyaWdnZXIgPT09IFwiZm9jdXNcIikge1xyXG4gICAgICAgICAgICAvLyDogZrnhKZcclxuICAgICAgICAgICAgLy8gQFRvZG8g6ZyA6KaB5oqKaW5wdXTnrYnnu4Tku7blkozmma7pgJrnu4Tku7bliIblvIBcclxuICAgICAgICAgICAgdGhpcy5mb2N1c0Rvd25FdmVudCA9IHRoaXMucmVuZGVyLmxpc3RlbihcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudCxcclxuICAgICAgICAgICAgICAgIFwibW91c2Vkb3duXCIsXHJcbiAgICAgICAgICAgICAgICAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c1VwRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICBcIm1vdXNldXBcIixcclxuICAgICAgICAgICAgICAgIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDpvKDmoIfnp7vliqjkuIrljrtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZWVudGVyRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICBcIm1vdXNlZW50ZXJcIixcclxuICAgICAgICAgICAgICAgIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWxheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWxheVRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlbGF5VGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZGVsYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kVG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZWxlYXZlRXZlbnQgPSB0aGlzLnJlbmRlci5saXN0ZW4oXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICBcIm1vdXNlbGVhdmVcIixcclxuICAgICAgICAgICAgICAgIChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWxheVRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRlbGF5VGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5oYXNCaW5kRXZlbnQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOino+e7keS6i+S7tiAqL1xyXG4gICAgdW5iaW5kRXZlbnQoKSB7XHJcbiAgICAgICAgLy8g6byg5qCH56e75LiK5Y67XHJcbiAgICAgICAgaWYgKHRoaXMubW91c2VlbnRlckV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMubW91c2VlbnRlckV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1vdXNlbGVhdmVFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLm1vdXNlbGVhdmVFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jbGlja0V2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jbGlja091dEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xpY2tPdXRFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5mb2N1c0Rvd25FdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmZvY3VzRG93bkV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmZvY3VzVXBFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmZvY3VzVXBFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhhc0JpbmRFdmVudCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIGJvZHkgIOenu+mZpHRvb2x0aXAgKi9cclxuICAgIHJlbW92ZVRvb2x0aXAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudG9vbHRpcCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZChcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHksXHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXAuZWwubmF0aXZlRWxlbWVudFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2NvbXBvbmVudFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMudmlld0NvbnRhaW5lclJlZi5jbGVhcigpO1xyXG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZS5kZXN0b3J5KHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXBwZW5kVG9vbHRpcCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc2hvd1RpcCkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVUb29sdGlwKCk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVWaWV3UHJvcHMoXHJcbiAgICAgICAgICAgIHRoaXMucGxhY2VtZW50LFxyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQsXHJcbiAgICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcclxuICAgICAgICAgICAgdGhpcy5nZXRSZWZlcmVuY2VQb3NpdGlvbigpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5vdmVyTGF5U2VydmljZS5yZWdpc3Rlck1vdXNlRXZlbnQodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZVRvb2x0aXAoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiDmm7TmlrB0b29sdGlw57uE5Lu25bGe5oCnICovXHJcbiAgICBwcml2YXRlIHVwZGF0ZVZpZXdQcm9wcyhcclxuICAgICAgICBwbGFjZW1lbnQ6IHN0cmluZyxcclxuICAgICAgICBjb250ZW50OiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+LFxyXG4gICAgICAgIGhvc3RCb3VuZGluZ0NsaWVudFJlY3Q6IG9iamVjdCxcclxuICAgICAgICByZWZlcmVuY2VCb3VuZGluZ1JlY3RcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMudG9vbHRpcC5wbGFjZW1lbnQgPSBwbGFjZW1lbnQ7XHJcbiAgICAgICAgdGhpcy50b29sdGlwLmNvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgICAgIHRoaXMudG9vbHRpcC5ob3N0Qm91bmRpbmdDbGllbnRSZWN0ID0gaG9zdEJvdW5kaW5nQ2xpZW50UmVjdDtcclxuICAgICAgICB0aGlzLnRvb2x0aXAudGlwQ2xzID0gdGhpcy50aXBDbHM7XHJcbiAgICAgICAgdGhpcy50b29sdGlwLnRpcFdpZHRoID0gdGhpcy50aXBXaWR0aDtcclxuICAgICAgICB0aGlzLnRvb2x0aXAucmVmZXJlbmNlQm91bmRpbmdSZWN0ID0gcmVmZXJlbmNlQm91bmRpbmdSZWN0O1xyXG4gICAgICAgIHRoaXMuX2NvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgICB0aGlzLl9jb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qIOaehOmAoHRvb2x0aXDnu5PmnoQgKi9cclxuICAgIHByaXZhdGUgZ2VuZXJhdGVUb29sdGlwKCkge1xyXG4gICAgICAgIHRoaXMuX2NvbXBvbmVudFJlZiA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoXHJcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50RmFjdG9yeVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy50b29sdGlwID0gdGhpcy5fY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgICAgIHRoaXMudG9vbHRpcC56SW5kZXggPSAnJyArIHRoaXMuY29tbVV0aWxzLmdldEZsb2F0aW5nTGF5ZXJJbmRleCgpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICAvLyDniLblhYPntKDkuK3np7vpmaQgIOa3u+WKoOWIsGJvZHnkuK1cclxuICAgICAgICB0aGlzLnJlbmRlci5yZW1vdmVDaGlsZChcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIucGFyZW50Tm9kZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQpLFxyXG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAuZWwubmF0aXZlRWxlbWVudFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuYm9keSwgdGhpcy50b29sdGlwLmVsLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog56Gu6K6k5Y+C54Wn55qE6L6555WMXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0UmVmZXJlbmNlUG9zaXRpb24oKSB7XHJcbiAgICAgICAgbGV0IHJSaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgICAgICBsZXQgckJvdHRvbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgbGV0IHJUb3AgPSAwO1xyXG4gICAgICAgIGxldCByTGVmdCA9IDA7XHJcbiAgICAgICAgLy8g5qiq5ZCR5Y+C54WnXHJcbiAgICAgICAgaWYgKHRoaXMucmVjdGlmeVJlZmVyZW5jZUgpIHtcclxuICAgICAgICAgICAgbGV0IHJlY3RpZnlSZWZlcmVuY2VIRWwgPSB0aGlzLmdldFJlY3RpZnlSZWZlcmVuY2VFbGVtZW50KFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0aWZ5UmVmZXJlbmNlSFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByUmlnaHQgPSByZWN0aWZ5UmVmZXJlbmNlSEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0O1xyXG4gICAgICAgICAgICByTGVmdCA9IHJlY3RpZnlSZWZlcmVuY2VIRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g57q15ZCR5Y+C54WnXHJcbiAgICAgICAgaWYgKHRoaXMucmVjdGlmeVJlZmVyZW5jZVYpIHtcclxuICAgICAgICAgICAgbGV0IHJlY3RpZnlSZWZlcmVuY2VWRWwgPSB0aGlzLmdldFJlY3RpZnlSZWZlcmVuY2VFbGVtZW50KFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0aWZ5UmVmZXJlbmNlVlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByQm90dG9tID0gcmVjdGlmeVJlZmVyZW5jZVZFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b207XHJcbiAgICAgICAgICAgIHJUb3AgPSByZWN0aWZ5UmVmZXJlbmNlVkVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgdG9wOiByVG9wLCBsZWZ0OiByTGVmdCwgcmlnaHQ6IHJSaWdodCwgYm90dG9tOiByQm90dG9tIH07XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlue6oOato+WFg+e0oFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFJlY3RpZnlSZWZlcmVuY2VFbGVtZW50KHJlZmVyZW5jZUVsKSB7XHJcbiAgICAgICAgaWYgKHJlZmVyZW5jZUVsIGluc3RhbmNlb2YgRWxlbWVudFJlZikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVmZXJlbmNlRWwubmF0aXZlRWxlbWVudDtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZWZlcmVuY2VFbCA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHJlZmVyZW5jZUVsIGFzIHN0cmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZWZlcmVuY2VFbDtcclxuICAgIH1cclxufVxyXG4iXX0=
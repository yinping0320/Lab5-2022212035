/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injector, ViewEncapsulation, NgZone } from '@angular/core';
/*
 * @Author: 疯狂秀才(lucas huang)
 * @Date: 2018-11-24 15:58:04
 * @LastEditors: 疯狂秀才(Lucas Huang)
 * @LastEditTime: 2019-04-08 19:02:25
 * @Company: Inspur
 * @Version: v0.0.1
 */
import { Component, Input, HostBinding, ElementRef, Renderer2 } from '@angular/core';
export class LayoutComponent {
    /**
     * @param {?} el
     * @param {?} render2
     * @param {?} injector
     */
    constructor(el, render2, injector) {
        this.el = el;
        this.render2 = render2;
        this.injector = injector;
        this.showBorder = true;
        // h: 水平排列; v: 垂直排列
        this.direction = 'h';
        this.fill = false;
        this.myclass = 'd-flex';
        this.panels = [];
        this.ngZone = this.injector.get(NgZone);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init();
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.checkPanels();
        this.panels.forEach((/**
         * @param {?} p
         * @return {?}
         */
        p => {
            if (p.split) {
                /** @type {?} */
                let margin = '';
                switch (p.region) {
                    case 'north':
                        margin = 'marginTop';
                        break;
                    case 'south':
                        margin = 'marginBottom';
                        break;
                    case 'west':
                        margin = 'marginLeft';
                        break;
                    case 'east':
                        margin = 'marginRight';
                        break;
                }
                this.render2.setStyle(this.getPanel('center').el.nativeElement, margin, '5px');
            }
        }));
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            setTimeout((/**
             * @return {?}
             */
            () => this.setPanelMaxSize()));
        }));
    }
    /**
     * @private
     * @return {?}
     */
    init() {
        if (this.direction === 'h') {
            this.myclass += ' flex-row';
        }
        else {
            this.myclass += ' flex-column';
        }
        if (this.fill) {
            if (this.isInLayoutPanel()) {
                this.myclass += ' flex-fill';
                this.render2.addClass(this.el.nativeElement.parentElement, 'd-flex');
            }
            else {
                this.myclass += ' layout-fill';
            }
        }
        else {
            if (this.width) {
                this.render2.setStyle(this.el.nativeElement, 'width', this.width + 'px');
            }
            if (this.height) {
                this.render2.setStyle(this.el.nativeElement, 'height', this.height + 'px');
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    getLayoutSize() {
        /** @type {?} */
        const size = {
            width: this.el.nativeElement.clientWidth,
            height: this.el.nativeElement.clientHeight
        };
        return size;
    }
    /**
     * @return {?}
     */
    setPanelMaxSize() {
        /** @type {?} */
        const layoutSize = this.getLayoutSize();
        this.panels.forEach((/**
         * @param {?} p
         * @return {?}
         */
        p => {
            if (p.region !== 'center') {
                /** @type {?} */
                const minWidth = p.minWidth || 100;
                /** @type {?} */
                const minHeight = p.minHeight || 100;
                if (p.region === 'west' && layoutSize.width) {
                    /** @type {?} */
                    const east = this.getPanel('east');
                    if (!east) {
                        p.maxWidth = layoutSize.width - minWidth;
                    }
                    else {
                        p.maxWidth = layoutSize.width - east.width - minWidth;
                    }
                }
                if (p.region === 'east' && layoutSize.width) {
                    /** @type {?} */
                    const west = this.getPanel('west');
                    if (!west) {
                        p.maxWidth = layoutSize.width - minWidth;
                    }
                    else {
                        p.maxWidth = layoutSize.width - west.width - minWidth;
                    }
                }
                if (p.region === 'north' && layoutSize.height) {
                    /** @type {?} */
                    const south = this.getPanel('south');
                    if (!south) {
                        p.maxHeight = layoutSize.height - minHeight;
                    }
                    else {
                        p.maxHeight = layoutSize.height - south.height - minHeight;
                    }
                }
                if (p.region === 'south' && layoutSize.height) {
                    /** @type {?} */
                    const north = this.getPanel('north');
                    if (!north) {
                        p.maxHeight = layoutSize.height - minHeight;
                    }
                    else {
                        p.maxHeight = layoutSize.height - north.height - minHeight;
                    }
                }
            }
        }));
    }
    /**
     * @param {?} region
     * @return {?}
     */
    getPanel(region) {
        return this.panels.find((/**
         * @param {?} p
         * @return {?}
         */
        p => p.region === region));
    }
    /**
     * @private
     * @return {?}
     */
    checkPanels() {
        if (this.panels && this.panels.length) {
            /** @type {?} */
            const regions = this.panels.map((/**
             * @param {?} p
             * @return {?}
             */
            p => p.region));
            if (this.unique(regions).length === regions.length) {
                if (this.direction === 'h') {
                    if (regions.find((/**
                     * @param {?} r
                     * @return {?}
                     */
                    r => r === 'north' || r === 'south'))) {
                        throw new Error('水平方向排列时，只能包含 east 或者 west');
                    }
                }
                else {
                    if (regions.find((/**
                     * @param {?} r
                     * @return {?}
                     */
                    r => r === 'west' || r === 'east'))) {
                        throw new Error('水平方向排列时，只能包含 north 或者 south');
                    }
                }
                return true;
            }
            else {
                throw new Error('layout 布局容器中具有重复的panel。');
            }
        }
        return true;
    }
    /**
     * @private
     * @param {?} arr
     * @return {?}
     */
    unique(arr) {
        /** @type {?} */
        const tmp = new Set(arr);
        return Array.from(tmp);
    }
    /**
     * @private
     * @return {?}
     */
    isInLayoutPanel() {
        return !!this.el.nativeElement.parentElement.attributes['layout-panel'];
    }
}
LayoutComponent.decorators = [
    { type: Component, args: [{
                selector: 'farrisui-layout,farris-layout,layout',
                template: "<ng-container *ngIf=\"direction==='v'\">\r\n    <ng-content select=\"[region='north']\"></ng-content>\r\n</ng-container>\r\n<ng-container *ngIf=\"direction==='h'\">\r\n    <ng-content select=\"[region='west']\"></ng-content>\r\n</ng-container>\r\n\r\n\r\n<ng-content></ng-content>\r\n\r\n<ng-container  *ngIf=\"direction==='v'\">\r\n    <ng-content select=\"[region='south']\"></ng-content>\r\n</ng-container>\r\n<ng-container *ngIf=\"direction==='h'\">\r\n    <ng-content select=\"[region='east']\"></ng-content>\r\n</ng-container>",
                encapsulation: ViewEncapsulation.Emulated,
                styles: [`
        :host.layout-fill {position: absolute; top: 0; right: 0;bottom: 0;left: 0;}
        `]
            }] }
];
/** @nocollapse */
LayoutComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: Injector }
];
LayoutComponent.propDecorators = {
    width: [{ type: Input }],
    height: [{ type: Input }],
    showBorder: [{ type: Input }],
    direction: [{ type: Input }],
    fill: [{ type: Input }],
    myclass: [{ type: HostBinding, args: ['class',] }]
};
if (false) {
    /** @type {?} */
    LayoutComponent.prototype.width;
    /** @type {?} */
    LayoutComponent.prototype.height;
    /** @type {?} */
    LayoutComponent.prototype.showBorder;
    /** @type {?} */
    LayoutComponent.prototype.direction;
    /** @type {?} */
    LayoutComponent.prototype.fill;
    /** @type {?} */
    LayoutComponent.prototype.myclass;
    /** @type {?} */
    LayoutComponent.prototype.panels;
    /**
     * @type {?}
     * @private
     */
    LayoutComponent.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    LayoutComponent.prototype.el;
    /**
     * @type {?}
     * @private
     */
    LayoutComponent.prototype.render2;
    /**
     * @type {?}
     * @private
     */
    LayoutComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5b3V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmYXJyaXMvdWktbGF5b3V0LyIsInNvdXJjZXMiOlsibGliL2xheW91dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQW1CLGlCQUFpQixFQUE0QyxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7Ozs7OztBQVMvSCxPQUFPLEVBQ0gsU0FBUyxFQUFVLEtBQUssRUFBMkIsV0FBVyxFQUM5RCxVQUFVLEVBQUUsU0FBUyxFQUN4QixNQUFNLGVBQWUsQ0FBQztBQWF2QixNQUFNLE9BQU8sZUFBZTs7Ozs7O0lBaUJ4QixZQUFvQixFQUFjLEVBQVUsT0FBa0IsRUFBVSxRQUFrQjtRQUF0RSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBVztRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFiakYsZUFBVSxHQUFHLElBQUksQ0FBQzs7UUFHbEIsY0FBUyxHQUFjLEdBQUcsQ0FBQztRQUUzQixTQUFJLEdBQUcsS0FBSyxDQUFDO1FBRUEsWUFBTyxHQUFHLFFBQVEsQ0FBQztRQUV6QyxXQUFNLEdBQTJCLEVBQUUsQ0FBQztRQUtoQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVDLENBQUM7Ozs7SUFFRCxRQUFRO1FBQ0osSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFFRCxrQkFBa0I7UUFDZCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDcEIsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFOztvQkFDTCxNQUFNLEdBQUcsRUFBRTtnQkFDZixRQUFRLENBQUMsQ0FBQyxNQUFNLEVBQUU7b0JBQ2Qs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LElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7YUFDOUM7U0FDSjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7OztJQUVPLE1BQU0sQ0FBQyxHQUFhOztjQUNsQixHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDO1FBQ3hCLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMzQixDQUFDOzs7OztJQUVPLGVBQWU7UUFDbkIsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUM1RSxDQUFDOzs7WUE5S0osU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxzQ0FBc0M7Z0JBQ2hELGdpQkFBb0M7Z0JBTXBDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxRQUFRO3lCQUpyQzs7U0FFQzthQUdSOzs7O1lBYkcsVUFBVTtZQUFFLFNBQVM7WUFYaEIsUUFBUTs7O29CQTJCWixLQUFLO3FCQUNMLEtBQUs7eUJBQ0wsS0FBSzt3QkFHTCxLQUFLO21CQUVMLEtBQUs7c0JBRUwsV0FBVyxTQUFDLE9BQU87Ozs7SUFUcEIsZ0NBQXVCOztJQUN2QixpQ0FBd0I7O0lBQ3hCLHFDQUEyQjs7SUFHM0Isb0NBQW9DOztJQUVwQywrQkFBc0I7O0lBRXRCLGtDQUF5Qzs7SUFFekMsaUNBQW9DOzs7OztJQUVwQyxpQ0FBdUI7Ozs7O0lBRVgsNkJBQXNCOzs7OztJQUFFLGtDQUEwQjs7Ozs7SUFBRSxtQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMYXlvdXRQYW5lbENvbXBvbmVudCB9IGZyb20gJy4vcGFuZWxzL2xheW91dC1wYW5lbC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJbmplY3RvciwgQ29udGVudENoaWxkcmVuLCBWaWV3RW5jYXBzdWxhdGlvbiwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEluamVjdCwgZm9yd2FyZFJlZiwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbi8qXHJcbiAqIEBBdXRob3I6IOeWr+eLguengOaJjShsdWNhcyBodWFuZylcclxuICogQERhdGU6IDIwMTgtMTEtMjQgMTU6NTg6MDRcclxuICogQExhc3RFZGl0b3JzOiDnlq/ni4Lnp4DmiY0oTHVjYXMgSHVhbmcpXHJcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDQtMDggMTk6MDI6MjVcclxuICogQENvbXBhbnk6IEluc3B1clxyXG4gKiBAVmVyc2lvbjogdjAuMC4xXHJcbiAqL1xyXG5pbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBRdWVyeUxpc3QsIFZpZXdDaGlsZHJlbiwgSG9zdEJpbmRpbmcsXHJcbiAgICBFbGVtZW50UmVmLCBSZW5kZXJlcjIsIERpcmVjdGl2ZSwgQWZ0ZXJDb250ZW50SW5pdCwgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2ZhcnJpc3VpLWxheW91dCxmYXJyaXMtbGF5b3V0LGxheW91dCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ2xheW91dC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBgXHJcbiAgICAgICAgOmhvc3QubGF5b3V0LWZpbGwge3Bvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyByaWdodDogMDtib3R0b206IDA7bGVmdDogMDt9XHJcbiAgICAgICAgYFxyXG4gICAgXSxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLkVtdWxhdGVkXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBMYXlvdXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIHdpZHRoOiBudW1iZXI7XHJcbiAgICBASW5wdXQoKSBoZWlnaHQ6IG51bWJlcjtcclxuICAgIEBJbnB1dCgpIHNob3dCb3JkZXIgPSB0cnVlO1xyXG5cclxuICAgIC8vIGg6IOawtOW5s+aOkuWIlzsgdjog5Z6C55u05o6S5YiXXHJcbiAgICBASW5wdXQoKSBkaXJlY3Rpb246ICdoJyB8ICd2JyA9ICdoJztcclxuXHJcbiAgICBASW5wdXQoKSBmaWxsID0gZmFsc2U7XHJcblxyXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcycpIG15Y2xhc3MgPSAnZC1mbGV4JztcclxuXHJcbiAgICBwYW5lbHM6IExheW91dFBhbmVsQ29tcG9uZW50W10gPSBbXTtcclxuXHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyMjogUmVuZGVyZXIyLCBwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgICAgIHRoaXMubmdab25lID0gdGhpcy5pbmplY3Rvci5nZXQoTmdab25lKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja1BhbmVscygpO1xyXG5cclxuICAgICAgICB0aGlzLnBhbmVscy5mb3JFYWNoKHAgPT4ge1xyXG4gICAgICAgICAgICBpZiAocC5zcGxpdCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG1hcmdpbiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChwLnJlZ2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25vcnRoJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luID0gJ21hcmdpblRvcCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NvdXRoJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luID0gJ21hcmdpbkJvdHRvbSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3dlc3QnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW4gPSAnbWFyZ2luTGVmdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Vhc3QnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW4gPSAnbWFyZ2luUmlnaHQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyMi5zZXRTdHlsZSh0aGlzLmdldFBhbmVsKCdjZW50ZXInKS5lbC5uYXRpdmVFbGVtZW50LCBtYXJnaW4sICc1cHgnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnNldFBhbmVsTWF4U2l6ZSgpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSAnaCcpIHtcclxuICAgICAgICAgICAgdGhpcy5teWNsYXNzICs9ICcgZmxleC1yb3cnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubXljbGFzcyArPSAnIGZsZXgtY29sdW1uJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZpbGwpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbkxheW91dFBhbmVsKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXljbGFzcyArPSAnIGZsZXgtZmlsbCc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcjIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQsICdkLWZsZXgnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXljbGFzcyArPSAnIGxheW91dC1maWxsJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLndpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcjIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCB0aGlzLndpZHRoICsgJ3B4Jyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIyLnNldFN0eWxlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2hlaWdodCcsIHRoaXMuaGVpZ2h0ICsgJ3B4Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRMYXlvdXRTaXplKCkge1xyXG4gICAgICAgIGNvbnN0IHNpemUgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNpemU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UGFuZWxNYXhTaXplKCkge1xyXG4gICAgICAgIGNvbnN0IGxheW91dFNpemUgPSB0aGlzLmdldExheW91dFNpemUoKTtcclxuICAgICAgICB0aGlzLnBhbmVscy5mb3JFYWNoKHAgPT4ge1xyXG4gICAgICAgICAgICBpZiAocC5yZWdpb24gIT09ICdjZW50ZXInKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtaW5XaWR0aCA9IHAubWluV2lkdGggfHwgMTAwO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWluSGVpZ2h0ID0gcC5taW5IZWlnaHQgfHwgMTAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKHAucmVnaW9uID09PSAnd2VzdCcgJiYgbGF5b3V0U2l6ZS53aWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVhc3QgPSB0aGlzLmdldFBhbmVsKCdlYXN0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAubWF4V2lkdGggPSBsYXlvdXRTaXplLndpZHRoIC0gbWluV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcC5tYXhXaWR0aCA9IGxheW91dFNpemUud2lkdGggLSBlYXN0LndpZHRoIC0gbWluV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwLnJlZ2lvbiA9PT0gJ2Vhc3QnICYmIGxheW91dFNpemUud2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB3ZXN0ID0gdGhpcy5nZXRQYW5lbCgnd2VzdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghd2VzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwLm1heFdpZHRoID0gbGF5b3V0U2l6ZS53aWR0aCAtIG1pbldpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAubWF4V2lkdGggPSBsYXlvdXRTaXplLndpZHRoIC0gd2VzdC53aWR0aCAtIG1pbldpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocC5yZWdpb24gPT09ICdub3J0aCcgJiYgbGF5b3V0U2l6ZS5oZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3V0aCA9IHRoaXMuZ2V0UGFuZWwoJ3NvdXRoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzb3V0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwLm1heEhlaWdodCA9IGxheW91dFNpemUuaGVpZ2h0IC0gbWluSGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAubWF4SGVpZ2h0ID0gbGF5b3V0U2l6ZS5oZWlnaHQgLSBzb3V0aC5oZWlnaHQgLSBtaW5IZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwLnJlZ2lvbiA9PT0gJ3NvdXRoJyAmJiBsYXlvdXRTaXplLmhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vcnRoID0gdGhpcy5nZXRQYW5lbCgnbm9ydGgnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW5vcnRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAubWF4SGVpZ2h0ID0gbGF5b3V0U2l6ZS5oZWlnaHQgLSBtaW5IZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcC5tYXhIZWlnaHQgPSBsYXlvdXRTaXplLmhlaWdodCAtIG5vcnRoLmhlaWdodCAtIG1pbkhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQYW5lbChyZWdpb246IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhbmVscy5maW5kKHAgPT4gcC5yZWdpb24gPT09IHJlZ2lvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1BhbmVscygpIHtcclxuICAgICAgICBpZiAodGhpcy5wYW5lbHMgJiYgdGhpcy5wYW5lbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZ2lvbnMgPSB0aGlzLnBhbmVscy5tYXAocCA9PiBwLnJlZ2lvbik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVuaXF1ZShyZWdpb25zKS5sZW5ndGggPT09IHJlZ2lvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICdoJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWdpb25zLmZpbmQociA9PiByID09PSAnbm9ydGgnIHx8IHIgPT09ICdzb3V0aCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5rC05bmz5pa55ZCR5o6S5YiX5pe277yM5Y+q6IO95YyF5ZCrIGVhc3Qg5oiW6ICFIHdlc3QnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWdpb25zLmZpbmQociA9PiByID09PSAnd2VzdCcgfHwgciA9PT0gJ2Vhc3QnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+awtOW5s+aWueWQkeaOkuWIl+aXtu+8jOWPquiDveWMheWQqyBub3J0aCDmiJbogIUgc291dGgnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbGF5b3V0IOW4g+WxgOWuueWZqOS4reWFt+aciemHjeWkjeeahHBhbmVs44CCJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdW5pcXVlKGFycjogc3RyaW5nW10pIHtcclxuICAgICAgICBjb25zdCB0bXAgPSBuZXcgU2V0KGFycik7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odG1wKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGlzSW5MYXlvdXRQYW5lbCgpIHtcclxuICAgICAgICByZXR1cm4gISF0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5hdHRyaWJ1dGVzWydsYXlvdXQtcGFuZWwnXTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Input, Output, EventEmitter, ViewEncapsulation } from '@angular/core';
import { GridComponent } from '@progress/kendo-angular-grid';
import { AifDocumentsPropertyTextMap } from '../config/aif-documents-property-text.map';
import { TrackDirectionTypeMap } from '../config/track-direction-type.map';
import { process } from '@progress/kendo-data-query';
import { AifDocumentsTrackService } from '../service/aif-documents-track.service';
import { TrackType } from '../config/track-type.map';
/**
 * 单据追踪查询结果组件
 */
export class AifDocumentsTreeComponent {
    /**
     * @param {?} trackService
     */
    constructor(trackService) {
        this.trackService = trackService;
        /**
         * 单据记录Grid
         */
        this.stateOfDocuments = {
            skip: 0,
            take: 30,
        };
        this.checkboxOnly = false;
        this.disabledState = true;
        this.selectedByFieldOfDocuments = "";
        this.selectableSettings = {
            checkboxOnly: this.checkboxOnly,
            mode: "single"
        };
        this.documentProperties = [];
        this.gridDataOfDocuments = null;
        this.selectedKeysOfDocuments = new Array();
        /**
         * 单据分类导航
         */
        this.treeDataOfBeTypeCodes = [];
        this.selectedKeysOfTreeView = ['0'];
        this.gridDataOfBeTypes = [];
        this.selectedKeysOfBeTypes = new Array();
        this.disabledStateOfBeTypes = true;
        this.selectedByFieldOfBeTypes = "BeTypeCode";
        this.selectableSettingsOfBeTypes = {
            checkboxOnly: this.checkboxOnly,
            mode: "single"
        };
        this.selectBeType = "";
        /**
         * 常量映射
         */
        this.documentsPropertyTextMap = AifDocumentsPropertyTextMap;
        this.trackDirectionTypeMap = TrackDirectionTypeMap;
        this.trackDirectionType = TrackDirectionTypeMap.UnKnown;
        /**
         * 父子组件通信传值
         */
        this.trackClick = new EventEmitter();
        this._documents = {};
        this._beTypeCodes = [];
        this.beTypeNames = {};
    }
    /**
     * @param {?} documents
     * @return {?}
     */
    set documents(documents) {
        this._documents = documents;
    }
    /**
     * @return {?}
     */
    get documents() {
        return this._documents;
    }
    /**
     * @param {?} beTypeCodes
     * @return {?}
     */
    set beTypeCodes(beTypeCodes) {
        this._beTypeCodes = beTypeCodes;
        /**重置数据源 */
        this.treeDataOfBeTypeCodes = [];
        this.documentProperties = [];
        this.gridDataOfBeTypes = [];
        this.selectedKeysOfBeTypes = [];
        this.gridDataOfDocuments = process([], this.stateOfDocuments);
        if (this.isNullOrUndefined(beTypeCodes) == false && beTypeCodes.length > 0) {
            this.selectBeType = beTypeCodes[0];
            this.selectedKeysOfBeTypes.push(beTypeCodes[0]);
        }
        for (let item of beTypeCodes) {
            // this.data[0].items.push({text:item});
            this.gridDataOfBeTypes.push({ BeTypeCode: item, BeTypeName: this.beTypeNames[item], Number: this.documents[item].length });
            this.treeDataOfBeTypeCodes.push({ text: this.beTypeNames[item], value: item });
        }
        if (this.isNullOrUndefined(this.documents) == false && this.isNullOrUndefined(this.documents[this.selectBeType]) == false && this.documents[this.selectBeType].length > 0) {
            this.loadItems();
        }
    }
    /**
     * @return {?}
     */
    get beTypeCodes() {
        return this._beTypeCodes;
    }
    /**
     * @param {?} trackType
     * @return {?}
     */
    set trackType(trackType) {
        this._trackType = trackType;
        this.trackDirectionType = this.trackDirectionTypeMap[this._trackType];
    }
    /**
     * @return {?}
     */
    get trackType() {
        return this._trackType;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        console.log(changes);
        if (this.isNullOrUndefined(changes.beTypeCodes) == false) {
            this.beTypeCodes = changes.beTypeCodes.currentValue;
        }
        if (this.isNullOrUndefined(changes.documents) == false) {
            this.documents = changes.documents.currentValue;
            // this.gridDataOfDocuments=process(this.documents,this.stateOfDocuments);
        }
        if (this.isNullOrUndefined(changes.trackType) == false) {
            this.trackType = changes.trackType.currentValue;
        }
        if (this.isNullOrUndefined(changes.beTypeNames) == false) {
            this.beTypeNames = changes.beTypeNames.currentValue;
        }
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    clickNode(obj) {
        /** @type {?} */
        let item = obj.item.dataItem;
        if (this.isNullOrUndefined(item.items) == false) {
            return;
        }
        console.log(item.text);
        this.selectBeType = item.value;
        this.loadItems();
        this.selectedKeysOfDocuments.splice(0, this.selectedKeysOfDocuments.length);
    }
    /**
     * @return {?}
     */
    selectedKeysChangeOfDocuments() {
        if (this.selectedKeysOfDocuments.length > 0) {
            this.disabledState = false;
        }
        else {
            this.disabledState = true;
        }
    }
    /**
     * @return {?}
     */
    selectedKeysChangeOfBeTypes() {
        console.log(this.selectedKeysOfBeTypes);
        if (this.selectedKeysOfBeTypes.length > 0) {
            this.disabledStateOfBeTypes = false;
            this.selectBeType = this.selectedKeysOfBeTypes[0];
            //页数置为初始值0
            this.stateOfDocuments.skip = 0;
            this.loadItems();
            //清空已选中的行
            this.selectedKeysOfDocuments.splice(0, this.selectedKeysOfDocuments.length);
        }
        else {
            this.disabledStateOfBeTypes = true;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    pageChange(event) {
        this.stateOfDocuments.skip = event.skip;
        this.loadItems();
    }
    /**
     * @return {?}
     */
    loadItems() {
        // let temp = this.documents[this.selectBeType].slice(this.stateOfDocuments.skip, this.stateOfDocuments.skip + this.stateOfDocuments.take);
        this.documentProperties.splice(0, this.documentProperties.length);
        for (let index in this.documents[this.selectBeType][0]) {
            this.documentProperties.push(index);
        }
        this.selectedByFieldOfDocuments = this.documentProperties[0];
        this.gridDataOfDocuments = process(this.documents[this.selectBeType], this.stateOfDocuments);
        // this.fitColumns();
        // this.gridDataOfDocuments = {
        //   data: temp,
        //   total: this.documents[this.selectBeType].length
        // };
    }
    /**
     * @return {?}
     */
    getDocumentDetailInfo() {
        if (this.selectedKeysOfDocuments.length == 0) {
            alert("请选择一行数据");
            return;
        }
        console.log(this.selectedKeysOfDocuments);
        alert("详细信息窗口");
    }
    /**
     * @return {?}
     */
    track() {
        if (this.selectedKeysOfDocuments.length == 0) {
            alert("请选择一行数据");
            return;
        }
        this.trackService.showResultDialog(this.selectedKeysOfDocuments[0], this.selectBeType, this.trackType);
    }
    /**
     * @param {?} context
     * @return {?}
     */
    rowCallback(context) {
        /** @type {?} */
        const isEven = context.index % 2 == 0;
        return {
            even: isEven,
            odd: !isEven
        };
    }
    /**
     * @param {?} state
     * @return {?}
     */
    dataStateChangeOfDocuments(state) {
        this.stateOfDocuments = state;
        this.gridDataOfDocuments = process(this.documents[this.selectBeType], this.stateOfDocuments);
    }
    // 自动调整列宽
    // fitColumns(): void {
    //   this.ngZone.onStable.asObservable().pipe(take(1)).subscribe(() => {
    //     this.gridOfDocuments.autoFitColumns();
    //     // console.log("this.gridOfDocuments.autoFitColumns()");
    //   });
    // }
    /**
     * @private
     * @param {?} arg
     * @return {?}
     */
    isNullOrUndefined(arg) {
        return arg == null;
    }
}
AifDocumentsTreeComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-aif-documents-tree',
                encapsulation: ViewEncapsulation.None,
                template: "<!-- <div class=\"d-flex\" style=\"padding: 5px;\"> -->\r\n<!-- <div class=\"row\"> -->\r\n<kendo-splitter orientation=\"horizontal\" style=\"height:100%;\">\r\n  <kendo-splitter-pane [collapsible]=\"true\" size=\"16%\" style=\"padding:0 1rem 1rem 1rem;\">\r\n    <div class=\"k-button-group\" style=\"height:2.5rem;\">\r\n      <label for=\"\" style=\"margin:auto 0 auto 0;\">{{trackDirectionType}}</label>\r\n    </div>\r\n    <kendo-grid [data]=\"gridDataOfBeTypes\" [resizable]=\"true\" [selectable]=\"selectableSettingsOfBeTypes\"\r\n      [kendoGridSelectBy]=\"selectedByFieldOfBeTypes\" [selectedKeys]=\"selectedKeysOfBeTypes\" (selectedKeysChange)=\"selectedKeysChangeOfBeTypes()\">\r\n      <kendo-grid-column field=\"BeTypeName\" title=\"\u540D\u79F0\"></kendo-grid-column>\r\n      <!-- <kendo-grid-column field=\"BeTypeCode\" title=\"\u7F16\u53F7\"></kendo-grid-column> -->\r\n      <kendo-grid-column field=\"Number\" title=\"\u6570\u91CF\"></kendo-grid-column>\r\n    </kendo-grid>\r\n  </kendo-splitter-pane>\r\n  <kendo-splitter-pane style=\"padding:0 1rem 2rem 1rem;\">\r\n    <div class=\"k-button-group\" style=\"height:2.5rem;padding: 0.5rem 0 0.5rem 0;\">\r\n      <button hidden class=\"k-button btn btn-sm btn-default\" (click)=\"getDocumentDetailInfo()\">\u8BE6\u60C5</button>\r\n      <button class=\"k-button btn btn-sm ml-2 btn-default\" (click)=\"track()\">\u8FFD\u8E2A</button>\r\n    </div>\r\n\r\n    <kendo-grid class=\"\" #gridOfDocuments [data]=\"gridDataOfDocuments\" [pageable]=\"true\" [resizable]=\"true\" [pageSize]=\"stateOfDocuments.take\"\r\n      (pageChange)=\"pageChange($event)\" [skip]=\"stateOfDocuments.skip\" [selectable]=\"selectableSettings\"\r\n      [kendoGridSelectBy]=\"selectedByFieldOfDocuments\" [selectedKeys]=\"selectedKeysOfDocuments\" (selectedKeysChange)=\"selectedKeysChangeOfDocuments()\"\r\n      [sortable]=\"true\" [filterable]=\"true\" [sort]=\"stateOfDocuments.sort\" [filter]=\"stateOfDocuments.filter\"\r\n      (dataStateChange)=\"dataStateChangeOfDocuments($event)\">\r\n      <!-- <ng-template kendoGridToolbarTemplate>\r\n        <button type=\"button\" class=\"k-button btn btn-sm ml-2 btn-default\" kendoGridExcelCommand icon=\"file-excel\">Export\r\n          to Excel</button>\r\n      </ng-template> -->\r\n      <!-- <ng-template ngFor let-item [ngForOf]=\"documentProperties\" let-i=\"index\">\r\n        <kendo-grid-checkbox-column *ngIf=\"beTypeCodes&&beTypeCodes.length>0\" [width]=\"40\" [headerClass]=\"{'aif-grid-header': true}\"></kendo-grid-checkbox-column>\r\n        <kendo-grid-column [headerClass]=\"{'aif-grid-header': true}\" [field]=\"item\" [title]=\"documentsPropertyTextMap[item]||item\"></kendo-grid-column>\r\n      </ng-template> -->\r\n\r\n      <kendo-grid-checkbox-column [width]=\"40\" [headerClass]=\"{'aif-grid-header': true,'aif-grid-cell-border':true}\"></kendo-grid-checkbox-column>\r\n      <kendo-grid-column *ngFor=\"let item of documentProperties\" [headerClass]=\"{'aif-grid-header': true,'aif-grid-cell-border':true}\"\r\n        [field]=\"item\" [title]=\"documentsPropertyTextMap[item]||item\"></kendo-grid-column>\r\n      <!--<kendo-grid-excel fileName=\"Products.xlsx\"></kendo-grid-excel> -->\r\n    </kendo-grid>\r\n  </kendo-splitter-pane>\r\n</kendo-splitter>\r\n\r\n<!-- </div> -->\r\n<!-- </div> -->",
                styles: [".aif-border-green{border:1px solid green;border-radius:1rem}.aif-border-black{border:1px solid #000;border-radius:1rem}.aif-border-blue{border:1px solid #00f;border-radius:1rem}.aif-border{border:1px solid #919399;border-radius:1rem}.aif-background{background-color:#fafafa}.aif-document-tree-group{margin-top:10px;padding:1rem}.aif-margin-left{margin-left:1rem}.k-grid tr.even{background-color:#fafafa}.k-grid tr.odd{background-color:#9dc2f1}.k-grid .aif-grid-cell-border{border-right-width:1px}.aif-grid-header{background-color:#c9d7ea}.aif-min-height{height:-webkit-fill-available;height:-moz-available;height:fill-available}"]
            }] }
];
/** @nocollapse */
AifDocumentsTreeComponent.ctorParameters = () => [
    { type: AifDocumentsTrackService }
];
AifDocumentsTreeComponent.propDecorators = {
    trackClick: [{ type: Output }],
    documents: [{ type: Input }],
    beTypeCodes: [{ type: Input }],
    beTypeNames: [{ type: Input }],
    trackType: [{ type: Input }],
    gridOfDocuments: [{ type: ViewChild, args: ["gridOfDocuments",] }]
};
if (false) {
    /**
     * 单据记录Grid
     * @type {?}
     */
    AifDocumentsTreeComponent.prototype.stateOfDocuments;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.checkboxOnly;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.disabledState;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectedByFieldOfDocuments;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectableSettings;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.documentProperties;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.gridDataOfDocuments;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectedKeysOfDocuments;
    /**
     * 单据分类导航
     * @type {?}
     */
    AifDocumentsTreeComponent.prototype.treeDataOfBeTypeCodes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectedKeysOfTreeView;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.gridDataOfBeTypes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectedKeysOfBeTypes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.disabledStateOfBeTypes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectedByFieldOfBeTypes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectableSettingsOfBeTypes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.selectBeType;
    /**
     * 常量映射
     * @type {?}
     */
    AifDocumentsTreeComponent.prototype.documentsPropertyTextMap;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.trackDirectionTypeMap;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.trackDirectionType;
    /**
     * 父子组件通信传值
     * @type {?}
     */
    AifDocumentsTreeComponent.prototype.trackClick;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype._documents;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype._beTypeCodes;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.beTypeNames;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype._trackType;
    /** @type {?} */
    AifDocumentsTreeComponent.prototype.gridOfDocuments;
    /**
     * @type {?}
     * @private
     */
    AifDocumentsTreeComponent.prototype.trackService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlmLWRvY3VtZW50cy10cmVlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3AtYWlmL3J1bnRpbWUtYXBpLyIsInNvdXJjZXMiOlsibGliL2FpZi1kb2N1bWVudHMtdHJhY2svYWlmLWRvY3VtZW50cy10cmVlL2FpZi1kb2N1bWVudHMtdHJlZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUE0QixpQkFBaUIsRUFBOEMsTUFBTSxlQUFlLENBQUM7QUFDbkwsT0FBTyxFQUFxRCxhQUFhLEVBQXdDLE1BQU0sOEJBQThCLENBQUM7QUFDdEosT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDeEYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDM0UsT0FBTyxFQUFFLE9BQU8sRUFBUyxNQUFNLDRCQUE0QixDQUFDO0FBQzVELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7OztBQVlyRCxNQUFNLE9BQU8seUJBQXlCOzs7O0lBaUdwQyxZQUFvQixZQUFzQztRQUF0QyxpQkFBWSxHQUFaLFlBQVksQ0FBMEI7Ozs7UUE5RjFELHFCQUFnQixHQUFVO1lBQ3hCLElBQUksRUFBRSxDQUFDO1lBQ1AsSUFBSSxFQUFFLEVBQUU7U0FDVCxDQUFDO1FBRUYsaUJBQVksR0FBWSxLQUFLLENBQUM7UUFDOUIsa0JBQWEsR0FBWSxJQUFJLENBQUM7UUFDOUIsK0JBQTBCLEdBQVcsRUFBRSxDQUFDO1FBQ3hDLHVCQUFrQixHQUF1QjtZQUN2QyxZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7WUFDL0IsSUFBSSxFQUFFLFFBQVE7U0FDZixDQUFDO1FBQ0YsdUJBQWtCLEdBQWEs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TixLQUFLOzBCQVNMLEtBQUs7MEJBNEJMLEtBQUs7d0JBS0wsS0FBSzs4QkEwSEwsU0FBUyxTQUFDLGlCQUFpQjs7Ozs7OztJQTlNNUIscURBR0U7O0lBRUYsaURBQThCOztJQUM5QixrREFBOEI7O0lBQzlCLCtEQUF3Qzs7SUFDeEMsdURBR0U7O0lBQ0YsdURBQWtDOztJQUNsQyx3REFBMkM7O0lBQzNDLDREQUF3RDs7Ozs7SUFHeEQsMERBQWtDOztJQUNsQywyREFBc0M7O0lBQ3RDLHNEQUE0Qjs7SUFDNUIsMERBQXNEOztJQUN0RCwyREFBdUM7O0lBQ3ZDLDZEQUF3Qzs7SUFDeEMsZ0VBR0U7O0lBRUYsaURBQTBCOzs7OztJQUkxQiw2REFBdUQ7O0lBQ3ZELDBEQUE4Qzs7SUFDOUMsdURBQTJEOzs7OztJQUkzRCwrQ0FDcUM7O0lBRXJDLCtDQUE2Qzs7SUFTN0MsaURBQTRCOztJQTZCNUIsZ0RBQ21EOztJQUVuRCwrQ0FBc0I7O0lBNEh0QixvREFDK0I7Ozs7O0lBakhuQixpREFBOEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgVmlld0VuY2Fwc3VsYXRpb24sIE5nWm9uZSwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTZWxlY3RhYmxlU2V0dGluZ3MsIFBhZ2VDaGFuZ2VFdmVudCwgUm93Q2xhc3NBcmdzLCBHcmlkQ29tcG9uZW50LCBHcmlkRGF0YVJlc3VsdCwgRGF0YVN0YXRlQ2hhbmdlRXZlbnQgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1ncmlkJztcclxuaW1wb3J0IHsgQWlmRG9jdW1lbnRzUHJvcGVydHlUZXh0TWFwIH0gZnJvbSAnLi4vY29uZmlnL2FpZi1kb2N1bWVudHMtcHJvcGVydHktdGV4dC5tYXAnO1xyXG5pbXBvcnQgeyBUcmFja0RpcmVjdGlvblR5cGVNYXAgfSBmcm9tICcuLi9jb25maWcvdHJhY2stZGlyZWN0aW9uLXR5cGUubWFwJztcclxuaW1wb3J0IHsgcHJvY2VzcywgU3RhdGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tZGF0YS1xdWVyeSc7XHJcbmltcG9ydCB7IEFpZkRvY3VtZW50c1RyYWNrU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2UvYWlmLWRvY3VtZW50cy10cmFjay5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVHJhY2tUeXBlIH0gZnJvbSAnLi4vY29uZmlnL3RyYWNrLXR5cGUubWFwJztcclxuXHJcblxyXG4vKipcclxuICog5Y2V5o2u6L+96Liq5p+l6K+i57uT5p6c57uE5Lu2XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1haWYtZG9jdW1lbnRzLXRyZWUnLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2FpZi1kb2N1bWVudHMtdHJlZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYWlmLWRvY3VtZW50cy10cmVlLmNvbXBvbmVudC5jc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIEFpZkRvY3VtZW50c1RyZWVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gIC8qKuWNleaNruiusOW9lUdyaWQgKi9cclxuICBzdGF0ZU9mRG9jdW1lbnRzOiBTdGF0ZSA9IHtcclxuICAgIHNraXA6IDAsXHJcbiAgICB0YWtlOiAzMCxcclxuICB9O1xyXG5cclxuICBjaGVja2JveE9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBkaXNhYmxlZFN0YXRlOiBib29sZWFuID0gdHJ1ZTtcclxuICBzZWxlY3RlZEJ5RmllbGRPZkRvY3VtZW50czogc3RyaW5nID0gXCJcIjtcclxuICBzZWxlY3RhYmxlU2V0dGluZ3M6IFNlbGVjdGFibGVTZXR0aW5ncyA9IHtcclxuICAgIGNoZWNrYm94T25seTogdGhpcy5jaGVja2JveE9ubHksXHJcbiAgICBtb2RlOiBcInNpbmdsZVwiXHJcbiAgfTtcclxuICBkb2N1bWVudFByb3BlcnRpZXM6IHN0cmluZ1tdID0gW107XHJcbiAgZ3JpZERhdGFPZkRvY3VtZW50czogR3JpZERhdGFSZXN1bHQgPSBudWxsO1xyXG4gIHNlbGVjdGVkS2V5c09mRG9jdW1lbnRzOiBzdHJpbmdbXSA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XHJcblxyXG4gIC8qKuWNleaNruWIhuexu+WvvOiIqiAqL1xyXG4gIHRyZWVEYXRhT2ZCZVR5cGVDb2RlczogYW55W10gPSBbXTtcclxuICBzZWxlY3RlZEtleXNPZlRyZWVWaWV3OiBhbnlbXSA9IFsnMCddO1xyXG4gIGdyaWREYXRhT2ZCZVR5cGVzOiBhbnkgPSBbXTtcclxuICBzZWxlY3RlZEtleXNPZkJlVHlwZXM6IHN0cmluZ1tdID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuICBkaXNhYmxlZFN0YXRlT2ZCZVR5cGVzOiBib29sZWFuID0gdHJ1ZTtcclxuICBzZWxlY3RlZEJ5RmllbGRPZkJlVHlwZXMgPSBcIkJlVHlwZUNvZGVcIjtcclxuICBzZWxlY3RhYmxlU2V0dGluZ3NPZkJlVHlwZXM6IFNlbGVjdGFibGVTZXR0aW5ncyA9IHtcclxuICAgIGNoZWNrYm94T25seTogdGhpcy5jaGVja2JveE9ubHksXHJcbiAgICBtb2RlOiBcInNpbmdsZVwiXHJcbiAgfTtcclxuXHJcbiAgc2VsZWN0QmVUeXBlOiBzdHJpbmcgPSBcIlwiO1xyXG5cclxuXHJcbiAgLyoq5bi46YeP5pig5bCEICovXHJcbiAgZG9jdW1lbnRzUHJvcGVydHlUZXh0TWFwID0gQWlmRG9jdW1lbnRzUHJvcGVydHlUZXh0TWFwO1xyXG4gIHRyYWNrRGlyZWN0aW9uVHlwZU1hcCA9IFRyYWNrRGlyZWN0aW9uVHlwZU1hcDtcclxuICB0cmFja0RpcmVjdGlvblR5cGU6IHN0cmluZyA9IFRyYWNrRGlyZWN0aW9uVHlwZU1hcC5Vbktub3duO1xyXG5cclxuXHJcbiAgLyoq54i25a2Q57uE5Lu26YCa5L+h5Lyg5YC8ICovXHJcbiAgQE91dHB1dCgpXHJcbiAgdHJhY2tDbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBfZG9jdW1lbnRzOiB7IFtiZVR5cGU6IHN0cmluZ106IGFueVtdIH0gPSB7fTtcclxuICBASW5wdXQoKVxyXG4gIHNldCBkb2N1bWVudHMoZG9jdW1lbnRzOiBhbnkpIHtcclxuICAgIHRoaXMuX2RvY3VtZW50cyA9IGRvY3VtZW50cztcclxuICB9XHJcbiAgZ2V0IGRvY3VtZW50cygpIHtcclxuICAgIHJldHVybiB0aGlzLl9kb2N1bWVudHM7XHJcbiAgfVxyXG5cclxuICBfYmVUeXBlQ29kZXM6IHN0cmluZ1tdID0gW107XHJcbiAgQElucHV0KClcclxuICBzZXQgYmVUeXBlQ29kZXMoYmVUeXBlQ29kZXM6IGFueVtdKSB7XHJcbiAgICB0aGlzLl9iZVR5cGVDb2RlcyA9IGJlVHlwZUNvZGVzO1xyXG5cclxuICAgIC8qKumHjee9ruaVsOaNrua6kCAqL1xyXG4gICAgdGhpcy50cmVlRGF0YU9mQmVUeXBlQ29kZXMgPSBbXTtcclxuICAgIHRoaXMuZG9jdW1lbnRQcm9wZXJ0aWVzID0gW107XHJcbiAgICB0aGlzLmdyaWREYXRhT2ZCZVR5cGVzID0gW107XHJcbiAgICB0aGlzLnNlbGVjdGVkS2V5c09mQmVUeXBlcyA9IFtdO1xyXG4gICAgdGhpcy5ncmlkRGF0YU9mRG9jdW1lbnRzID0gcHJvY2VzcyhbXSwgdGhpcy5zdGF0ZU9mRG9jdW1lbnRzKTtcclxuXHJcbiAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZChiZVR5cGVDb2RlcykgPT0gZmFsc2UgJiYgYmVUeXBlQ29kZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLnNlbGVjdEJlVHlwZSA9IGJlVHlwZUNvZGVzWzBdO1xyXG4gICAgICB0aGlzLnNlbGVjdGVkS2V5c09mQmVUeXBlcy5wdXNoKGJlVHlwZUNvZGVzWzBdKTtcclxuICAgIH1cclxuICAgIGZvciAobGV0IGl0ZW0gb2YgYmVUeXBlQ29kZXMpIHtcclxuICAgICAgLy8gdGhpcy5kYXRhWzBdLml0ZW1zLnB1c2goe3RleHQ6aXRlbX0pO1xyXG4gICAgICB0aGlzLmdyaWREYXRhT2ZCZVR5cGVzLnB1c2goeyBCZVR5cGVDb2RlOiBpdGVtLCBCZVR5cGVOYW1lOiB0aGlzLmJlVHlwZU5hbWVzW2l0ZW1dLCBOdW1iZXI6IHRoaXMuZG9jdW1lbnRzW2l0ZW1dLmxlbmd0aCB9KTtcclxuICAgICAgdGhpcy50cmVlRGF0YU9mQmVUeXBlQ29kZXMucHVzaCh7IHRleHQ6IHRoaXMuYmVUeXBlTmFtZXNbaXRlbV0sIHZhbHVlOiBpdGVtIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5kb2N1bWVudHMpID09IGZhbHNlICYmIHRoaXMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5kb2N1bWVudHNbdGhpcy5zZWxlY3RCZVR5cGVdKSA9PSBmYWxzZSAmJiB0aGlzLmRvY3VtZW50c1t0aGlzLnNlbGVjdEJlVHlwZV0ubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgYmVUeXBlQ29kZXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fYmVUeXBlQ29kZXM7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIGJlVHlwZU5hbWVzOiB7IFtiZVR5cGVDb2RlOiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9O1xyXG5cclxuICBfdHJhY2tUeXBlOiBUcmFja1R5cGU7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHRyYWNrVHlwZSh0cmFja1R5cGU6IFRyYWNrVHlwZSkge1xyXG4gICAgdGhpcy5fdHJhY2tUeXBlID0gdHJhY2tUeXBlO1xyXG4gICAgdGhpcy50cmFja0RpcmVjdGlvblR5cGUgPSB0aGlzLnRyYWNrRGlyZWN0aW9uVHlwZU1hcFt0aGlzLl90cmFja1R5cGVdO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHRyYWNrVHlwZSgpOiBUcmFja1R5cGUge1xyXG4gICAgcmV0dXJuIHRoaXMuX3RyYWNrVHlwZTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdHJhY2tTZXJ2aWNlOiBBaWZEb2N1bWVudHNUcmFja1NlcnZpY2UpIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coY2hhbmdlcyk7XHJcbiAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZChjaGFuZ2VzLmJlVHlwZUNvZGVzKSA9PSBmYWxzZSkge1xyXG4gICAgICB0aGlzLmJlVHlwZUNvZGVzID0gY2hhbmdlcy5iZVR5cGVDb2Rlcy5jdXJyZW50VmFsdWU7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZChjaGFuZ2VzLmRvY3VtZW50cykgPT0gZmFsc2UpIHtcclxuICAgICAgdGhpcy5kb2N1bWVudHMgPSBjaGFuZ2VzLmRvY3VtZW50cy5jdXJyZW50VmFsdWU7XHJcbiAgICAgIC8vIHRoaXMuZ3JpZERhdGFPZkRvY3VtZW50cz1wcm9jZXNzKHRoaXMuZG9jdW1lbnRzLHRoaXMuc3RhdGVPZkRvY3VtZW50cyk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZChjaGFuZ2VzLnRyYWNrVHlwZSkgPT0gZmFsc2UpIHtcclxuICAgICAgdGhpcy50cmFja1R5cGUgPSBjaGFuZ2VzLnRyYWNrVHlwZS5jdXJyZW50VmFsdWU7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZChjaGFuZ2VzLmJlVHlwZU5hbWVzKSA9PSBmYWxzZSkge1xyXG4gICAgICB0aGlzLmJlVHlwZU5hbWVzID0gY2hhbmdlcy5iZVR5cGVOYW1lcy5jdXJyZW50VmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGlja05vZGUob2JqOiBhbnkpOiB2b2lkIHtcclxuICAgIGxldCBpdGVtID0gb2JqLml0ZW0uZGF0YUl0ZW07XHJcbiAgICBpZiAodGhpcy5pc051bGxPclVuZGVmaW5lZChpdGVtLml0ZW1zKSA9PSBmYWxzZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhpdGVtLnRleHQpO1xyXG4gICAgdGhpcy5zZWxlY3RCZVR5cGUgPSBpdGVtLnZhbHVlO1xyXG4gICAgdGhpcy5sb2FkSXRlbXMoKTtcclxuICAgIHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHMuc3BsaWNlKDAsIHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHMubGVuZ3RoKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdGVkS2V5c0NoYW5nZU9mRG9jdW1lbnRzKCkge1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLmRpc2FibGVkU3RhdGUgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmRpc2FibGVkU3RhdGUgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VsZWN0ZWRLZXlzQ2hhbmdlT2ZCZVR5cGVzKCkge1xyXG4gICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZEtleXNPZkJlVHlwZXMpO1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRLZXlzT2ZCZVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5kaXNhYmxlZFN0YXRlT2ZCZVR5cGVzID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuc2VsZWN0QmVUeXBlID0gdGhpcy5zZWxlY3RlZEtleXNPZkJlVHlwZXNbMF07XHJcbiAgICAgIC8v6aG15pWw572u5Li65Yid5aeL5YC8MFxyXG4gICAgICB0aGlzLnN0YXRlT2ZEb2N1bWVudHMuc2tpcCA9IDA7XHJcbiAgICAgIHRoaXMubG9hZEl0ZW1zKCk7XHJcbiAgICAgIC8v5riF56m65bey6YCJ5Lit55qE6KGMXHJcbiAgICAgIHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHMuc3BsaWNlKDAsIHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHMubGVuZ3RoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmRpc2FibGVkU3RhdGVPZkJlVHlwZXMgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcGFnZUNoYW5nZShldmVudDogUGFnZUNoYW5nZUV2ZW50KTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlT2ZEb2N1bWVudHMuc2tpcCA9IGV2ZW50LnNraXA7XHJcbiAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgbG9hZEl0ZW1zKCk6IGFueSB7XHJcbiAgICAvLyBsZXQgdGVtcCA9IHRoaXMuZG9jdW1lbnRzW3RoaXMuc2VsZWN0QmVUeXBlXS5zbGljZSh0aGlzLnN0YXRlT2ZEb2N1bWVudHMuc2tpcCwgdGhpcy5zdGF0ZU9mRG9jdW1lbnRzLnNraXAgKyB0aGlzLnN0YXRlT2ZEb2N1bWVudHMudGFrZSk7XHJcblxyXG4gICAgdGhpcy5kb2N1bWVudFByb3BlcnRpZXMuc3BsaWNlKDAsIHRoaXMuZG9jdW1lbnRQcm9wZXJ0aWVzLmxlbmd0aCk7XHJcbiAgICBmb3IgKGxldCBpbmRleCBpbiB0aGlzLmRvY3VtZW50c1t0aGlzLnNlbGVjdEJlVHlwZV1bMF0pIHtcclxuICAgICAgdGhpcy5kb2N1bWVudFByb3BlcnRpZXMucHVzaChpbmRleCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNlbGVjdGVkQnlGaWVsZE9mRG9jdW1lbnRzID0gdGhpcy5kb2N1bWVudFByb3BlcnRpZXNbMF07XHJcblxyXG4gICAgdGhpcy5ncmlkRGF0YU9mRG9jdW1lbnRzID0gcHJvY2Vzcyh0aGlzLmRvY3VtZW50c1t0aGlzLnNlbGVjdEJlVHlwZV0sIHRoaXMuc3RhdGVPZkRvY3VtZW50cyk7XHJcbiAgICAvLyB0aGlzLmZpdENvbHVtbnMoKTtcclxuICAgIC8vIHRoaXMuZ3JpZERhdGFPZkRvY3VtZW50cyA9IHtcclxuICAgIC8vICAgZGF0YTogdGVtcCxcclxuICAgIC8vICAgdG90YWw6IHRoaXMuZG9jdW1lbnRzW3RoaXMuc2VsZWN0QmVUeXBlXS5sZW5ndGhcclxuICAgIC8vIH07XHJcbiAgfVxyXG5cclxuICBnZXREb2N1bWVudERldGFpbEluZm8oKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zZWxlY3RlZEtleXNPZkRvY3VtZW50cy5sZW5ndGggPT0gMCkge1xyXG4gICAgICBhbGVydChcIuivt+mAieaLqeS4gOihjOaVsOaNrlwiKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZEtleXNPZkRvY3VtZW50cyk7XHJcbiAgICBhbGVydChcIuivpue7huS/oeaBr+eql+WPo1wiKTtcclxuICB9XHJcblxyXG4gIHRyYWNrKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHMubGVuZ3RoID09IDApIHtcclxuICAgICAgYWxlcnQoXCLor7fpgInmi6nkuIDooYzmlbDmja5cIik7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnRyYWNrU2VydmljZS5zaG93UmVzdWx0RGlhbG9nKHRoaXMuc2VsZWN0ZWRLZXlzT2ZEb2N1bWVudHNbMF0sIHRoaXMuc2VsZWN0QmVUeXBlLCB0aGlzLnRyYWNrVHlwZSk7XHJcbiAgfVxyXG5cclxuICByb3dDYWxsYmFjayhjb250ZXh0OiBSb3dDbGFzc0FyZ3MpIHtcclxuICAgIGNvbnN0IGlzRXZlbiA9IGNvbnRleHQuaW5kZXggJSAyID09IDA7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBldmVuOiBpc0V2ZW4sXHJcbiAgICAgIG9kZDogIWlzRXZlblxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGRhdGFTdGF0ZUNoYW5nZU9mRG9jdW1lbnRzKHN0YXRlOiBEYXRhU3RhdGVDaGFuZ2VFdmVudCkge1xyXG4gICAgdGhpcy5zdGF0ZU9mRG9jdW1lbnRzID0gc3RhdGU7XHJcbiAgICB0aGlzLmdyaWREYXRhT2ZEb2N1bWVudHMgPSBwcm9jZXNzKHRoaXMuZG9jdW1lbnRzW3RoaXMuc2VsZWN0QmVUeXBlXSwgdGhpcy5zdGF0ZU9mRG9jdW1lbnRzKTtcclxuICB9XHJcblxyXG4gIEBWaWV3Q2hpbGQoXCJncmlkT2ZEb2N1bWVudHNcIilcclxuICBncmlkT2ZEb2N1bWVudHM6IEdyaWRDb21wb25lbnQ7XHJcblxyXG4gIC8vIOiHquWKqOiwg+aVtOWIl+WuvVxyXG4gIC8vIGZpdENvbHVtbnMoKTogdm9pZCB7XHJcbiAgLy8gICB0aGlzLm5nWm9uZS5vblN0YWJsZS5hc09ic2VydmFibGUoKS5waXBlKHRha2UoMSkpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgLy8gICAgIHRoaXMuZ3JpZE9mRG9jdW1lbnRzLmF1dG9GaXRDb2x1bW5zKCk7XHJcbiAgLy8gICAgIC8vIGNvbnNvbGUubG9nKFwidGhpcy5ncmlkT2ZEb2N1bWVudHMuYXV0b0ZpdENvbHVtbnMoKVwiKTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgcHJpdmF0ZSBpc051bGxPclVuZGVmaW5lZChhcmc6YW55KTpib29sZWFue1xyXG4gICAgcmV0dXJuIGFyZz09bnVsbDtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==
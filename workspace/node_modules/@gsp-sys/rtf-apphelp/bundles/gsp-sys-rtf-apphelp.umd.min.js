!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@progress/kendo-angular-grid"),require("@progress/kendo-angular-layout"),require("@progress/kendo-angular-treeview"),require("rxjs"),require("@angular/core"),require("@angular/common/http"),require("@farris/ui-modal"),require("@farris/ui-messager")):"function"==typeof define&&define.amd?define("@gsp-sys/rtf-apphelp",["exports","@angular/common","@progress/kendo-angular-grid","@progress/kendo-angular-layout","@progress/kendo-angular-treeview","rxjs","@angular/core","@angular/common/http","@farris/ui-modal","@farris/ui-messager"],t):t((e["gsp-sys"]=e["gsp-sys"]||{},e["gsp-sys"]["rtf-apphelp"]={}),e.ng.common,e.kendoAngularGrid,e.kendoAngularLayout,e.kendoAngularTreeview,e.rxjs,e.ng.core,e.ng.common.http,e.uiModal,e.uiMessager)}(this,function(e,t,n,r,i,o,s,a,p,c){"use strict";var l=function(){function e(){this.appTreeData=[],this.selectKeys=[],this.appTreeChanged=new s.EventEmitter,this.expandedKeys=[]}return e.prototype.ngOnChanges=function(e){var t=this;e.appTreeData&&e.appTreeData.currentValue&&0!==e.appTreeData.currentValue.length&&o.from(this.appTreeData).subscribe(function(e){e.parentId&&"0"!==e.parentId||(e.parentId=undefined,1===e.layer&&t.expandedKeys.push(e.id))})},e.prototype.ngOnInit=function(){},e.prototype.selectChange=function(e){var t=e.dataItem;null==this.selectKeys||0===this.selectKeys.length?this.appTreeChanged.emit(t):this.selectKeys[0]!==t.id&&this.appTreeChanged.emit(t)},e.decorators=[{type:s.Component,args:[{selector:"app-module-tree",template:'<div class="d-flex flex-column flex-fill pt-2 pb-2" style="height: 100%">\r\n    <kendo-treeview [nodes]="appTreeData" textField="name" kendoTreeViewExpandable kendoTreeViewFlatDataBinding\r\n        idField="id" parentIdField="parentId" kendoTreeViewSelectable [selectBy]="\'id\'"\r\n        [(selectedKeys)]="this.selectKeys" [(expandedKeys)]="expandedKeys" [expandBy]="\'id\'"\r\n        (selectionChange)="selectChange($event)">\r\n    </kendo-treeview>\r\n</div>',styles:[""]}]}],e.ctorParameters=function(){return[]},e.propDecorators={appTreeData:[{type:s.Input}],bizObjectId:[{type:s.Input}],appTreeChanged:[{type:s.Output}]},e}(),d=function(){function e(){}return Object.defineProperty(e.prototype,"functionsApi",{get:function(){return"/api/runtime/sys/v1.0/gspapp/all"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"appsWithBOApi",{get:function(){return"/api/runtime/sys/v1.0/gspapp/allAppsBO"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bizObjectApi",{get:function(){return"/api/dev/main/v1.0/business-objects"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpHeader",{get:function(){return{headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",SessionId:this.sessionId},responseType:"json"}},enumerable:!0,configurable:!0}),e.decorators=[{type:s.Injectable}],e.ctorParameters=function(){return[]},e}(),u=function(){function e(e,t){this.rtfCommon=e,this.httpClient=t}return e.prototype.getAppList=function(){var e=this.rtfCommon.functionsApi,t=this.rtfCommon.httpHeader;return this.httpClient.get(e,t)},e.prototype.getAppListWithBizObjectData=function(){var e=this.rtfCommon.appsWithBOApi,t=this.rtfCommon.httpHeader;return this.httpClient.get(e,t)},e.prototype.getI18nJson=function(e){var t=this.rtfCommon.httpHeader;return this.httpClient.get(e,t)},e.decorators=[{type:s.Injectable}],e.ctorParameters=function(){return[{type:d},{type:a.HttpClient}]},e}(),f=function(){function e(e){this.rtfAppService=e}return e.prototype.getI18nJson=function(){if(this.i18nObj)return o.of(this.i18nObj);var e=this.getI18nJsonApi(null);return this.rtfAppService.getI18nJson(e)},e.prototype.getI18nJsonApi=function(e){return"/platform/runtime/sys/web/assets/i18n/apphelp/zh-CHS.json"},e.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:u}]},e.ngInjectableDef=s.defineInjectable({factory:function(){return new e(s.inject(u))},token:e,providedIn:"root"}),e}(),h={"zh-CHS":{TitleName:"应用帮助",EntranceList:"入口列表",Code:"编号",Name:"名称",Entrance:"入口",Confirm:"确认",Cancel:"取消"},"zh-CHT":{TitleName:"應用幫助",EntranceList:"入口列表",Code:"編號",Name:"名稱",Entrance:"入口",Confirm:"確認",Cancel:"取消"},en:{TitleName:"Application Help",EntranceList:"EntranceList",Code:"Code",Name:"Name",Entrance:"Entrance",Confirm:"Confirm",Cancel:"Cancel"}},g=function(){function e(e,t,n){this.rtfAppService=e,this.i18nService=t,this.farrisMsg=n,this.afterConfirm=new s.EventEmitter,this.afterCancle=new s.EventEmitter,this.dataarray=[],this.curSelectedKeys=[],this.title="",this.i18nEntity={},t||(this.i18nService=new f(e))}return e.prototype.ngOnInit=function(){var t=this;this.selectableSettings={checkboxOnly:!0,mode:this.gridSelectMode?this.gridSelectMode:"single",enabled:!0},this.rtfAppService.getAppListWithBizObjectData().subscribe(function(e){(t.treeData=e).filter(function(e){return"4"===e.layer||"5"===e.layer}).forEach(function(e){t.dataarray=t.dataarray.concat(e.appInvoks)})},function(e){t.farrisMsg.error("获取应用数据失败")})},e.prototype.searchData=function(e){if(null!==e&&""!==e){var t=e.toLowerCase();this.gridData=this.data.filter(function(e){return e.code.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)})}else this.gridData=this.data.concat()},e.prototype.leftAppTreeChanged=function(e){if("4"===(this.selectedTreeNode=e).layer||"5"===e.layer){var t=e&&e.id;this.gridData=this.dataarray.filter(function(e){return t&&e.appId===t})}else this.gridData=[]},e.prototype.getSelectedObject=function(){var e=this;return this.dataarray.filter(function(t){return e.curSelectedKeys&&0<=e.curSelectedKeys.findIndex(function(e){return e===t.id})})},e.prototype.confirm=function(){var t=this,e=this.getSelectedObject();this.selectedTreeNode&&e&&0<e.length&&(this.selectedTreeNode.selectedInvok=e.filter(function(e){return e&&e.appId===t.selectedTreeNode.id})),this.afterConfirm.next(this.selectedTreeNode),this.cancle()},e.prototype.cancle=function(){this.afterCancle.next()},e.prototype.i18nEntityInitBak=function(){var t=this;this.i18nService.getI18nJson().subscribe(function(e){e&&(t.title=e.TitleName,t.i18nEntity=e,t.i18nService.i18nObj=e)})},e.prototype.setCurrentLangCode=function(e){this.currentLangCode=e,this.title=this.getResOnCurrentLangeContext("TitleName")},e.prototype.getResOnCurrentLangeContext=function(e){return h[this.currentLangCode][e]},e.decorators=[{type:s.Component,args:[{selector:"app-rtf-app",template:'<div class="d-flex flex-row" style="\r\nwidth: 800px; \r\nborder:2px;\r\nposition:absolute;\r\ntop:0px;\r\nbottom: 0px;\r\nright:0px;\r\nleft:0px;\r\noverflow: hidden;\r\nheight: 100%;">\r\n    <div class="flex-fill">\r\n        <kendo-splitter style="height:100%" orientation="horizontal">\r\n            <kendo-splitter-pane size="40%" min="20%" max="50%">\r\n                <div class="d-flex flex-column flex-fill" style="height:100%">\r\n                    <div class="p-2" style="height: 35px;">\r\n                        <h5>{{this.getResOnCurrentLangeContext(\'TitleName\')}}</h5>\r\n                        <hr class="m-0 p-0" />\r\n                    </div>\r\n                    <div class="flex-fill" style="overflow: auto;">\r\n                        <app-module-tree [appTreeData]="this.treeData" [bizObjectId]="bizObjectId"\r\n                            (appTreeChanged)="leftAppTreeChanged($event)"></app-module-tree>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n            <kendo-splitter-pane style="flex:1 1 0px; order: 2;">\r\n                <div class="d-flex flex-column flex-fill" style="height:100%">\r\n                    <div class="p-2" style="height: 35px;">\r\n                        <h5>{{this.getResOnCurrentLangeContext(\'EntranceList\')}}</h5>\r\n                        <hr class="m-0 p-0" />\r\n                    </div>\r\n                    \r\n                    \x3c!-- <div class="clearfix mt-1 mb-1 ml-1">\r\n            <input #filter placeholder="输入编号或名称查找" type="text" />\r\n            <button class="btn btn-sm btn-default" (click)="searchData(filter.value)">查找</button>\r\n          </div> --\x3e\r\n                    <div class="d-flex flex-fill" style="position:relative;">\r\n                        <kendo-grid [class]="\'flex-fill\'" [selectable]="selectableSettings"\r\n                            [kendoGridBinding]="gridData" [kendoGridSelectBy]="\'id\'" [selectedKeys]="curSelectedKeys">\r\n                            <kendo-grid-checkbox-column width="50px"></kendo-grid-checkbox-column>\r\n                            <kendo-grid-column field="code" title="{{this.getResOnCurrentLangeContext( \'Code\')}}">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field="name" title="{{this.getResOnCurrentLangeContext( \'Name\')}}">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field="appEntrance"\r\n                                title="{{this.getResOnCurrentLangeContext( \'Entrance\')}}"></kendo-grid-column>\r\n                        </kendo-grid>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n        </kendo-splitter>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #btnOkAndCancle>\r\n    <button class="btn btn-sm btn-primary" (click)="confirm()">{{this.getResOnCurrentLangeContext(\'Confirm\')}}</button>\r\n    <button class="btn btn-sm btn-default" (click)="cancle()">{{this.getResOnCurrentLangeContext(\'Cancel\')}}</button>\r\n</ng-template>',styles:[""]}]}],e.ctorParameters=function(){return[{type:u},{type:f,decorators:[{type:s.Optional}]},{type:c.MessagerService}]},e.propDecorators={bizObjectId:[{type:s.Input}],gridSelectMode:[{type:s.Input}],afterConfirm:[{type:s.Output}],afterCancle:[{type:s.Output}],btnOkAndCancleRef:[{type:s.ViewChild,args:["btnOkAndCancle"]}]},e}(),m=function(){function e(e,t,n,r,i){this.rtfCommon=e,this.modalService=t,this.farrisMsg=n,this.injector=r,this.cfr=i,this.initSelectKeys=[],this.languageCode="zh-CHS",this.afterHelpConfirm=new s.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.showHelp=function(e){var t=this;this.rtfCommon.sessionId=" ";var n=this.cfr.resolveComponentFactory(g);this.funcOpComp=n.create(this.injector),this.funcOpComp.instance.setCurrentLangCode(this.languageCode),null!=this.initSelectKeys&&0<this.initSelectKeys.length&&this.funcOpComp.instance.curSelectedKeys.push(this.initSelectKeys[0]),this.bizObjectId&&""!==this.bizObjectId&&(this.funcOpComp.instance.bizObjectId=this.bizObjectId);var r={title:this.funcOpComp.instance.title,width:800,height:550,buttons:this.funcOpComp.instance.btnOkAndCancleRef,showButtons:!0,showMaxButton:!1,resizable:!1};this.funcOpDialog=this.modalService.show(this.funcOpComp,r),this.funcOpComp.instance.afterCancle.subscribe(function(e){t.funcOpDialog.close()}),this.funcOpComp.instance.afterConfirm.subscribe(function(e){t.afterHelpConfirm.next(e)})},e.decorators=[{type:s.Component,args:[{selector:"app-rtf-application-help",template:"",styles:[""]}]}],e.ctorParameters=function(){return[{type:d},{type:p.BsModalService},{type:c.MessagerService},{type:s.Injector},{type:s.ComponentFactoryResolver}]},e.propDecorators={bizObjectId:[{type:s.Input}],initSelectKeys:[{type:s.Input}],languageCode:[{type:s.Input}],afterHelpConfirm:[{type:s.Output}]},e}(),y=function(){function e(){}return e.decorators=[{type:s.NgModule,args:[{imports:[t.CommonModule,a.HttpClientModule,n.GridModule,r.LayoutModule,i.TreeViewModule,p.ModalModule.forRoot(),c.MessagerModule.forRoot()],declarations:[l,g,m],entryComponents:[g],providers:[d,u,f],exports:[g,m]}]}],e}();e.RtfAppHelpModule=y,e.RtfAppHelpComponent=m,e.RtfAppComponent=g,e.ɵc=d,e.ɵa=l,e.ɵd=f,e.ɵb=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-sys-rtf-apphelp.umd.min.js.map
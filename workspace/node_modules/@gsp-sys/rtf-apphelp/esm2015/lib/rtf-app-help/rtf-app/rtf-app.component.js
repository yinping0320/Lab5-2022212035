/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, TemplateRef, Input, Optional } from '@angular/core';
import { RtfAppService } from '../service/rtf-app.service';
import { I18NresourceService } from '../service/i18N/i18-nresource.service';
import { i18nAppHelpInfo } from '../../models/i18n-model/i18n-model';
import { MessagerService } from '@farris/ui-messager';
/**
 * 系统管理：功能操作左树有、右列表展示
 */
// tslint:disable
export class RtfAppComponent {
    /**
     * @param {?} rtfAppService
     * @param {?} i18nService
     * @param {?} farrisMsg
     */
    constructor(rtfAppService, i18nService, farrisMsg) {
        this.rtfAppService = rtfAppService;
        this.i18nService = i18nService;
        this.farrisMsg = farrisMsg;
        /**
         * 确认事件
         */
        this.afterConfirm = new EventEmitter();
        /**
         * 关闭事件
         */
        this.afterCancle = new EventEmitter();
        this.dataarray = [];
        /**
         * 当前选中数据
         */
        this.curSelectedKeys = [];
        this.title = '';
        this.i18nEntity = {};
        if (!i18nService) {
            this.i18nService = new I18NresourceService(rtfAppService);
        }
        // this.i18nEntityInit();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.selectableSettings = {
            checkboxOnly: true,
            // 默认单选
            mode: !this.gridSelectMode ? 'single' : this.gridSelectMode,
            enabled: true
        };
        /*this.rtfAppService.getAppList().subscribe(
            res => {
                // 左侧树
                this.treeData = res;
                // 菜单明细数据
                const info = res.filter(item => item.layer === '4');
                info.forEach(element => {
                    this.dataarray = this.dataarray.concat(element.appInvoks);
                });
                // this.gridData = this.dataarray;
            },
            error => {
                console.log('获取失败');
            }
        );*/
        // 获取所有应用数据
        this.rtfAppService.getAppListWithBizObjectData().subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            this.treeData = res;
            /** @type {?} */
            const appDetails = res.filter((/**
             * @param {?} item
             * @return {?}
             */
            (item) => item.layer === '4' || (item.layer === '5')));
            appDetails.forEach((/**
             * @param {?} ele
             * @return {?}
             */
            ele => {
                this.dataarray = this.dataarray.concat(ele.appInvoks);
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.farrisMsg.error("获取应用数据失败");
        }));
    }
    /**
     * 搜索
     * @param {?} filterValue 查询条件
     * @return {?}
     */
    searchData(filterValue) {
        // 空的搜索是全部数据
        if (filterValue === null || filterValue === '') {
            this.gridData = this.data.concat();
            return;
        }
        /** @type {?} */
        const filter = filterValue.toLowerCase();
        // 搜索到上级时
        this.gridData = this.data.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.code.toLowerCase().includes(filter) ||
            item.name.toLowerCase().includes(filter)));
    }
    /**
     * 左侧树切换
     * @param {?} arg 对象参数
     * @return {?}
     */
    leftAppTreeChanged(arg) {
        this.selectedTreeNode = arg;
        if (!('4' === arg.layer || '5' === arg.layer)) {
            this.gridData = [];
            return;
        }
        /** @type {?} */
        const selectedId = arg && arg.id;
        // 根据父子关系过滤当前界面数据，包含上下级
        this.gridData = this.dataarray.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => selectedId && item.appId === selectedId));
    }
    /**
     * 获取选中数据
     * @return {?}
     */
    getSelectedObject() {
        /** @type {?} */
        const result = this.dataarray.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => this.curSelectedKeys && this.curSelectedKeys.findIndex((/**
         * @param {?} select
         * @return {?}
         */
        select => select === item.id)) >= 0));
        return result;
    }
    /**
     * 确认
     * @return {?}
     */
    confirm() {
        /** @type {?} */
        const result = this.getSelectedObject();
        if (this.selectedTreeNode && result && result.length > 0) {
            this.selectedTreeNode.selectedInvok = result.filter((/**
             * @param {?} inv
             * @return {?}
             */
            inv => inv && inv.appId === this.selectedTreeNode.id));
        }
        this.afterConfirm.next(this.selectedTreeNode);
        // 取消-目的是在这里让模态框消失
        this.cancle();
    }
    /**
     * 取消
     * @return {?}
     */
    cancle() {
        this.afterCancle.next();
    }
    /**
     * @return {?}
     */
    i18nEntityInitBak() {
        this.i18nService.getI18nJson().subscribe((/**
         * @param {?} entity
         * @return {?}
         */
        entity => {
            if (entity) {
                this.title = entity.TitleName;
                this.i18nEntity = entity;
                this.i18nService.i18nObj = entity;
            }
        }));
    }
    /**
     * @param {?} langCode
     * @return {?}
     */
    setCurrentLangCode(langCode) {
        this.currentLangCode = langCode;
        this.title = this.getResOnCurrentLangeContext('TitleName');
    }
    /**
     * @param {?} resKey
     * @return {?}
     */
    getResOnCurrentLangeContext(resKey) {
        /** @type {?} */
        const resValue = i18nAppHelpInfo[this.currentLangCode][resKey];
        return resValue;
    }
}
RtfAppComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-rtf-app',
                template: "<div class=\"d-flex flex-row\" style=\"\r\nwidth: 800px; \r\nborder:2px;\r\nposition:absolute;\r\ntop:0px;\r\nbottom: 0px;\r\nright:0px;\r\nleft:0px;\r\noverflow: hidden;\r\nheight: 100%;\">\r\n    <div class=\"flex-fill\">\r\n        <kendo-splitter style=\"height:100%\" orientation=\"horizontal\">\r\n            <kendo-splitter-pane size=\"40%\" min=\"20%\" max=\"50%\">\r\n                <div class=\"d-flex flex-column flex-fill\" style=\"height:100%\">\r\n                    <div class=\"p-2\" style=\"height: 35px;\">\r\n                        <h5>{{this.getResOnCurrentLangeContext('TitleName')}}</h5>\r\n                        <hr class=\"m-0 p-0\" />\r\n                    </div>\r\n                    <div class=\"flex-fill\" style=\"overflow: auto;\">\r\n                        <app-module-tree [appTreeData]=\"this.treeData\" [bizObjectId]=\"bizObjectId\"\r\n                            (appTreeChanged)=\"leftAppTreeChanged($event)\"></app-module-tree>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n            <kendo-splitter-pane style=\"flex:1 1 0px; order: 2;\">\r\n                <div class=\"d-flex flex-column flex-fill\" style=\"height:100%\">\r\n                    <div class=\"p-2\" style=\"height: 35px;\">\r\n                        <h5>{{this.getResOnCurrentLangeContext('EntranceList')}}</h5>\r\n                        <hr class=\"m-0 p-0\" />\r\n                    </div>\r\n                    \r\n                    <!-- <div class=\"clearfix mt-1 mb-1 ml-1\">\r\n            <input #filter placeholder=\"\u8F93\u5165\u7F16\u53F7\u6216\u540D\u79F0\u67E5\u627E\" type=\"text\" />\r\n            <button class=\"btn btn-sm btn-default\" (click)=\"searchData(filter.value)\">\u67E5\u627E</button>\r\n          </div> -->\r\n                    <div class=\"d-flex flex-fill\" style=\"position:relative;\">\r\n                        <kendo-grid [class]=\"'flex-fill'\" [selectable]=\"selectableSettings\"\r\n                            [kendoGridBinding]=\"gridData\" [kendoGridSelectBy]=\"'id'\" [selectedKeys]=\"curSelectedKeys\">\r\n                            <kendo-grid-checkbox-column width=\"50px\"></kendo-grid-checkbox-column>\r\n                            <kendo-grid-column field=\"code\" title=\"{{this.getResOnCurrentLangeContext( 'Code')}}\">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field=\"name\" title=\"{{this.getResOnCurrentLangeContext( 'Name')}}\">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field=\"appEntrance\"\r\n                                title=\"{{this.getResOnCurrentLangeContext( 'Entrance')}}\"></kendo-grid-column>\r\n                        </kendo-grid>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n        </kendo-splitter>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #btnOkAndCancle>\r\n    <button class=\"btn btn-sm btn-primary\" (click)=\"confirm()\">{{this.getResOnCurrentLangeContext('Confirm')}}</button>\r\n    <button class=\"btn btn-sm btn-default\" (click)=\"cancle()\">{{this.getResOnCurrentLangeContext('Cancel')}}</button>\r\n</ng-template>",
                styles: [""]
            }] }
];
/** @nocollapse */
RtfAppComponent.ctorParameters = () => [
    { type: RtfAppService },
    { type: I18NresourceService, decorators: [{ type: Optional }] },
    { type: MessagerService }
];
RtfAppComponent.propDecorators = {
    bizObjectId: [{ type: Input }],
    gridSelectMode: [{ type: Input }],
    afterConfirm: [{ type: Output }],
    afterCancle: [{ type: Output }],
    btnOkAndCancleRef: [{ type: ViewChild, args: ['btnOkAndCancle',] }]
};
if (false) {
    /** @type {?} */
    RtfAppComponent.prototype.bizObjectId;
    /** @type {?} */
    RtfAppComponent.prototype.gridSelectMode;
    /**
     * 确认事件
     * @type {?}
     */
    RtfAppComponent.prototype.afterConfirm;
    /**
     * 关闭事件
     * @type {?}
     */
    RtfAppComponent.prototype.afterCancle;
    /** @type {?} */
    RtfAppComponent.prototype.btnOkAndCancleRef;
    /** @type {?} */
    RtfAppComponent.prototype.data;
    /** @type {?} */
    RtfAppComponent.prototype.dataarray;
    /** @type {?} */
    RtfAppComponent.prototype.gridData;
    /**
     * 左侧树列表数据
     * @type {?}
     */
    RtfAppComponent.prototype.treeData;
    /**
     * 当前选中数据
     * @type {?}
     */
    RtfAppComponent.prototype.curSelectedKeys;
    /** @type {?} */
    RtfAppComponent.prototype.selectableSettings;
    /** @type {?} */
    RtfAppComponent.prototype.selectedTreeNode;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.currentLangCode;
    /** @type {?} */
    RtfAppComponent.prototype.title;
    /** @type {?} */
    RtfAppComponent.prototype.i18nEntity;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.rtfAppService;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.i18nService;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.farrisMsg;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnRmLWFwcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9ydGYtYXBwaGVscC8iLCJzb3VyY2VzIjpbImxpYi9ydGYtYXBwLWhlbHAvcnRmLWFwcC9ydGYtYXBwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVqSCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFM0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDNUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7QUFXdEQsTUFBTSxPQUFPLGVBQWU7Ozs7OztJQXVDeEIsWUFDWSxhQUE0QixFQUNoQixXQUFnQyxFQUM1QyxTQUEwQjtRQUYxQixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUNoQixnQkFBVyxHQUFYLFdBQVcsQ0FBcUI7UUFDNUMsY0FBUyxHQUFULFNBQVMsQ0FBaUI7Ozs7UUFoQ3RDLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQVksQ0FBQzs7OztRQUs1QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFNdEMsY0FBUyxHQUFHLEVBQUUsQ0FBQzs7OztRQVVmLG9CQUFlLEdBQWEsRUFBRSxDQUFDO1FBSXhCLFVBQUssR0FBRyxFQUFFLENBQUM7UUFFbEIsZUFBVSxHQUFRLEVBQUUsQ0FBQztRQU9qQixJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2QsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQzdEO1FBQ0QseUJBQXlCO0lBQzdCLENBQUM7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QyxlQUFlLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDOUQsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQzs7O1lBakxKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsdXNHQUF1Qzs7YUFFMUM7Ozs7WUFkUSxhQUFhO1lBRWIsbUJBQW1CLHVCQXNEbkIsUUFBUTtZQXBEUixlQUFlOzs7MEJBYW5CLEtBQUs7NkJBRUwsS0FBSzsyQkFLTCxNQUFNOzBCQUtOLE1BQU07Z0NBR04sU0FBUyxTQUFDLGdCQUFnQjs7OztJQWYzQixzQ0FBNkI7O0lBRTdCLHlDQUNzQzs7Ozs7SUFJdEMsdUNBQzRDOzs7OztJQUk1QyxzQ0FDc0M7O0lBRXRDLDRDQUNvQzs7SUFFcEMsK0JBQWU7O0lBQ2Ysb0NBQWU7O0lBQ2YsbUNBQWM7Ozs7O0lBS2QsbUNBQW1COzs7OztJQUluQiwwQ0FBK0I7O0lBQy9CLDZDQUF1Qzs7SUFDdkMsMkNBQXNCOzs7OztJQUN0QiwwQ0FBZ0M7O0lBQ2hDLGdDQUFrQjs7SUFFbEIscUNBQXFCOzs7OztJQUdqQix3Q0FBb0M7Ozs7O0lBQ3BDLHNDQUFvRDs7Ozs7SUFDcEQsb0NBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBJbnB1dCwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU2VsZWN0YWJsZVNldHRpbmdzIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItZ3JpZCc7XHJcbmltcG9ydCB7IFJ0ZkFwcFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL3J0Zi1hcHAuc2VydmljZSc7XHJcbmltcG9ydCB7IFJ0ZkFwcCB9IGZyb20gJy4uL2VudGl0aWVzL3J0Zi1hcHAnO1xyXG5pbXBvcnQgeyBJMThOcmVzb3VyY2VTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9pMThOL2kxOC1ucmVzb3VyY2Uuc2VydmljZSc7XHJcbmltcG9ydCB7IGkxOG5BcHBIZWxwSW5mbyB9IGZyb20gJy4uLy4uL21vZGVscy9pMThuLW1vZGVsL2kxOG4tbW9kZWwnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuXHJcbi8qKlxyXG4gKiDns7vnu5/nrqHnkIbvvJrlip/og73mk43kvZzlt6bmoJHmnInjgIHlj7PliJfooajlsZXnpLpcclxuICovXHJcbi8vIHRzbGludDpkaXNhYmxlXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhcHAtcnRmLWFwcCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vcnRmLWFwcC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9ydGYtYXBwLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUnRmQXBwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICBASW5wdXQoKSBiaXpPYmplY3RJZDogc3RyaW5nO1xyXG5cclxuICAgIEBJbnB1dCgpXHJcbiAgICBncmlkU2VsZWN0TW9kZTogJ3NpbmdsZScgfCAnbXVsdGlwbGUnO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnoa7orqTkuovku7ZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpXHJcbiAgICBhZnRlckNvbmZpcm0gPSBuZXcgRXZlbnRFbWl0dGVyPFJ0ZkFwcFtdPigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhbPpl63kuovku7ZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpXHJcbiAgICBhZnRlckNhbmNsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgLy8g5rOo5YWl5Yiw5biu5Yqp55qE56Gu6K6k5ZKM5Y+W5raI5oyJ6ZKuXHJcbiAgICBAVmlld0NoaWxkKCdidG5Pa0FuZENhbmNsZScpXHJcbiAgICBidG5Pa0FuZENhbmNsZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgICBkYXRhOiBSdGZBcHBbXTtcclxuICAgIGRhdGFhcnJheSA9IFtdO1xyXG4gICAgZ3JpZERhdGE6IGFueTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOW3puS+p+agkeWIl+ihqOaVsOaNrlxyXG4gICAgICovXHJcbiAgICB0cmVlRGF0YTogUnRmQXBwW107XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjemAieS4reaVsOaNrlxyXG4gICAgICovXHJcbiAgICBjdXJTZWxlY3RlZEtleXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBzZWxlY3RhYmxlU2V0dGluZ3M6IFNlbGVjdGFibGVTZXR0aW5ncztcclxuICAgIHNlbGVjdGVkVHJlZU5vZGU6IGFueTtcclxuICAgIHByaXZhdGUgY3VycmVudExhbmdDb2RlOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgdGl0bGUgPSAnJztcclxuXHJcbiAgICBpMThuRW50aXR5OiBhbnkgPSB7fTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJ0ZkFwcFNlcnZpY2U6IFJ0ZkFwcFNlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpMThuU2VydmljZTogSTE4TnJlc291cmNlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGZhcnJpc01zZzogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgKSB7XHJcbiAgICAgICAgaWYgKCFpMThuU2VydmljZSkge1xyXG4gICAgICAgICAgICB0aGlzLmkxOG5TZXJ2aWNlID0gbmV3IEkxOE5yZXNvdXJjZVNlcnZpY2UocnRmQXBwU2VydmljZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMuaTE4bkVudGl0eUluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGFibGVTZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgY2hlY2tib3hPbmx5OiB0cnVlLFxyXG4gICAgICAgICAgICAvLyDpu5jorqTljZXpgIlcclxuICAgICAgICAgICAgbW9kZTogIXRoaXMuZ3JpZFNlbGVjdE1vZGUgPyAnc2luZ2xlJyA6IHRoaXMuZ3JpZFNlbGVjdE1vZGUsXHJcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qdGhpcy5ydGZBcHBTZXJ2aWNlLmdldEFwcExpc3QoKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyDlt6bkvqfmoJFcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZURhdGEgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAvLyDoj5zljZXmmI7nu4bmlbDmja5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSByZXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYXllciA9PT0gJzQnKTtcclxuICAgICAgICAgICAgICAgIGluZm8uZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFhcnJheSA9IHRoaXMuZGF0YWFycmF5LmNvbmNhdChlbGVtZW50LmFwcEludm9rcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmRhdGFhcnJheTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+iOt+WPluWksei0pScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTsqL1xyXG4gICAgICAgIC8vIOiOt+WPluaJgOacieW6lOeUqOaVsOaNrlxyXG4gICAgICAgIHRoaXMucnRmQXBwU2VydmljZS5nZXRBcHBMaXN0V2l0aEJpek9iamVjdERhdGEoKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYXBwRGV0YWlscyA9IHJlcy5maWx0ZXIoKGl0ZW06IGFueSkgPT4gaXRlbS5sYXllciA9PT0gJzQnIHx8IChpdGVtLmxheWVyID09PSAnNScpKTtcclxuICAgICAgICAgICAgICAgIGFwcERldGFpbHMuZm9yRWFjaChlbGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YWFycmF5ID0gdGhpcy5kYXRhYXJyYXkuY29uY2F0KGVsZS5hcHBJbnZva3MpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmFycmlzTXNnLmVycm9yKFwi6I635Y+W5bqU55So5pWw5o2u5aSx6LSlXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pCc57SiXHJcbiAgICAgKiBAcGFyYW0gZmlsdGVyVmFsdWUg5p+l6K+i5p2h5Lu2XHJcbiAgICAgKi9cclxuICAgIHNlYXJjaERhdGEoZmlsdGVyVmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIC8vIOepuueahOaQnOe0ouaYr+WFqOmDqOaVsOaNrlxyXG4gICAgICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gbnVsbCB8fCBmaWx0ZXJWYWx1ZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkRGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaWx0ZXIgPSBmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIOaQnOe0ouWIsOS4iue6p+aXtlxyXG4gICAgICAgIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmRhdGEuZmlsdGVyKGl0ZW0gPT5cclxuICAgICAgICAgICAgaXRlbS5jb2RlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyKSB8fFxyXG4gICAgICAgICAgICBpdGVtLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOW3puS+p+agkeWIh+aNolxyXG4gICAgICogQHBhcmFtIGFyZyDlr7nosaHlj4LmlbBcclxuICAgICAqL1xyXG4gICAgbGVmdEFwcFRyZWVDaGFuZ2VkKGFyZykge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRUcmVlTm9kZSA9IGFyZztcclxuICAgICAgICBpZiAoISgnNCcgPT09IGFyZy5sYXllciB8fCAnNScgPT09IGFyZy5sYXllcikpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkRGF0YSA9IFtdO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzZWxlY3RlZElkID0gYXJnICYmIGFyZy5pZDtcclxuICAgICAgICAvLyDmoLnmja7niLblrZDlhbPns7vov4fmu6TlvZPliY3nlYzpnaLmlbDmja7vvIzljIXlkKvkuIrkuIvnuqdcclxuICAgICAgICB0aGlzLmdyaWREYXRhID0gdGhpcy5kYXRhYXJyYXkuZmlsdGVyKFxyXG4gICAgICAgICAgICBpdGVtID0+IHNlbGVjdGVkSWQgJiYgaXRlbS5hcHBJZCA9PT0gc2VsZWN0ZWRJZFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6YCJ5Lit5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIGdldFNlbGVjdGVkT2JqZWN0KCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZGF0YWFycmF5LmZpbHRlcihcclxuICAgICAgICAgICAgaXRlbSA9PiB0aGlzLmN1clNlbGVjdGVkS2V5cyAmJiB0aGlzLmN1clNlbGVjdGVkS2V5cy5maW5kSW5kZXgoc2VsZWN0ID0+IHNlbGVjdCA9PT0gaXRlbS5pZCkgPj0gMFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOehruiupFxyXG4gICAgICovXHJcbiAgICBjb25maXJtKCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ2V0U2VsZWN0ZWRPYmplY3QoKTtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFRyZWVOb2RlICYmIHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkVHJlZU5vZGUuc2VsZWN0ZWRJbnZvayA9IHJlc3VsdC5maWx0ZXIoaW52ID0+IGludiAmJiBpbnYuYXBwSWQgPT09IHRoaXMuc2VsZWN0ZWRUcmVlTm9kZS5pZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWZ0ZXJDb25maXJtLm5leHQodGhpcy5zZWxlY3RlZFRyZWVOb2RlKTtcclxuICAgICAgICAvLyDlj5bmtogt55uu55qE5piv5Zyo6L+Z6YeM6K6p5qih5oCB5qGG5raI5aSxXHJcbiAgICAgICAgdGhpcy5jYW5jbGUoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Y+W5raIXHJcbiAgICAgKi9cclxuICAgIGNhbmNsZSgpIHtcclxuICAgICAgICB0aGlzLmFmdGVyQ2FuY2xlLm5leHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBpMThuRW50aXR5SW5pdEJhaygpIHtcclxuICAgICAgICB0aGlzLmkxOG5TZXJ2aWNlLmdldEkxOG5Kc29uKCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBlbnRpdHkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVudGl0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSBlbnRpdHkuVGl0bGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaTE4bkVudGl0eSA9IGVudGl0eTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmkxOG5TZXJ2aWNlLmkxOG5PYmogPSBlbnRpdHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRDdXJyZW50TGFuZ0NvZGUobGFuZ0NvZGU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuY3VycmVudExhbmdDb2RlID0gbGFuZ0NvZGU7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMuZ2V0UmVzT25DdXJyZW50TGFuZ2VDb250ZXh0KCdUaXRsZU5hbWUnKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0UmVzT25DdXJyZW50TGFuZ2VDb250ZXh0KHJlc0tleTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCByZXNWYWx1ZSA9IGkxOG5BcHBIZWxwSW5mb1t0aGlzLmN1cnJlbnRMYW5nQ29kZV1bcmVzS2V5XTtcclxuICAgICAgICByZXR1cm4gcmVzVmFsdWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==
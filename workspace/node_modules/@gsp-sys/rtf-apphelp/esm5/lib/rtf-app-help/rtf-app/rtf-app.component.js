/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, TemplateRef, Input, Optional } from '@angular/core';
import { RtfAppService } from '../service/rtf-app.service';
import { I18NresourceService } from '../service/i18N/i18-nresource.service';
import { i18nAppHelpInfo } from '../../models/i18n-model/i18n-model';
import { MessagerService } from '@farris/ui-messager';
/**
 * 系统管理：功能操作左树有、右列表展示
 */
// tslint:disable
var RtfAppComponent = /** @class */ (function () {
    function RtfAppComponent(rtfAppService, i18nService, farrisMsg) {
        this.rtfAppService = rtfAppService;
        this.i18nService = i18nService;
        this.farrisMsg = farrisMsg;
        /**
         * 确认事件
         */
        this.afterConfirm = new EventEmitter();
        /**
         * 关闭事件
         */
        this.afterCancle = new EventEmitter();
        this.dataarray = [];
        /**
         * 当前选中数据
         */
        this.curSelectedKeys = [];
        this.title = '';
        this.i18nEntity = {};
        if (!i18nService) {
            this.i18nService = new I18NresourceService(rtfAppService);
        }
        // this.i18nEntityInit();
    }
    /**
     * @return {?}
     */
    RtfAppComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.selectableSettings = {
            checkboxOnly: true,
            // 默认单选
            mode: !this.gridSelectMode ? 'single' : this.gridSelectMode,
            enabled: true
        };
        /*this.rtfAppService.getAppList().subscribe(
            res => {
                // 左侧树
                this.treeData = res;
                // 菜单明细数据
                const info = res.filter(item => item.layer === '4');
                info.forEach(element => {
                    this.dataarray = this.dataarray.concat(element.appInvoks);
                });
                // this.gridData = this.dataarray;
            },
            error => {
                console.log('获取失败');
            }
        );*/
        // 获取所有应用数据
        this.rtfAppService.getAppListWithBizObjectData().subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            _this.treeData = res;
            /** @type {?} */
            var appDetails = res.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.layer === '4' || (item.layer === '5'); }));
            appDetails.forEach((/**
             * @param {?} ele
             * @return {?}
             */
            function (ele) {
                _this.dataarray = _this.dataarray.concat(ele.appInvoks);
            }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.farrisMsg.error("获取应用数据失败");
        }));
    };
    /**
     * 搜索
     * @param filterValue 查询条件
     */
    /**
     * 搜索
     * @param {?} filterValue 查询条件
     * @return {?}
     */
    RtfAppComponent.prototype.searchData = /**
     * 搜索
     * @param {?} filterValue 查询条件
     * @return {?}
     */
    function (filterValue) {
        // 空的搜索是全部数据
        if (filterValue === null || filterValue === '') {
            this.gridData = this.data.concat();
            return;
        }
        /** @type {?} */
        var filter = filterValue.toLowerCase();
        // 搜索到上级时
        this.gridData = this.data.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item.code.toLowerCase().includes(filter) ||
                item.name.toLowerCase().includes(filter);
        }));
    };
    /**
     * 左侧树切换
     * @param arg 对象参数
     */
    /**
     * 左侧树切换
     * @param {?} arg 对象参数
     * @return {?}
     */
    RtfAppComponent.prototype.leftAppTreeChanged = /**
     * 左侧树切换
     * @param {?} arg 对象参数
     * @return {?}
     */
    function (arg) {
        this.selectedTreeNode = arg;
        if (!('4' === arg.layer || '5' === arg.layer)) {
            this.gridData = [];
            return;
        }
        /** @type {?} */
        var selectedId = arg && arg.id;
        // 根据父子关系过滤当前界面数据，包含上下级
        this.gridData = this.dataarray.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return selectedId && item.appId === selectedId; }));
    };
    /**
     * 获取选中数据
     */
    /**
     * 获取选中数据
     * @return {?}
     */
    RtfAppComponent.prototype.getSelectedObject = /**
     * 获取选中数据
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var result = this.dataarray.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return _this.curSelectedKeys && _this.curSelectedKeys.findIndex((/**
         * @param {?} select
         * @return {?}
         */
        function (select) { return select === item.id; })) >= 0; }));
        return result;
    };
    /**
     * 确认
     */
    /**
     * 确认
     * @return {?}
     */
    RtfAppComponent.prototype.confirm = /**
     * 确认
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var result = this.getSelectedObject();
        if (this.selectedTreeNode && result && result.length > 0) {
            this.selectedTreeNode.selectedInvok = result.filter((/**
             * @param {?} inv
             * @return {?}
             */
            function (inv) { return inv && inv.appId === _this.selectedTreeNode.id; }));
        }
        this.afterConfirm.next(this.selectedTreeNode);
        // 取消-目的是在这里让模态框消失
        this.cancle();
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @return {?}
     */
    RtfAppComponent.prototype.cancle = /**
     * 取消
     * @return {?}
     */
    function () {
        this.afterCancle.next();
    };
    /**
     * @return {?}
     */
    RtfAppComponent.prototype.i18nEntityInitBak = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.i18nService.getI18nJson().subscribe((/**
         * @param {?} entity
         * @return {?}
         */
        function (entity) {
            if (entity) {
                _this.title = entity.TitleName;
                _this.i18nEntity = entity;
                _this.i18nService.i18nObj = entity;
            }
        }));
    };
    /**
     * @param {?} langCode
     * @return {?}
     */
    RtfAppComponent.prototype.setCurrentLangCode = /**
     * @param {?} langCode
     * @return {?}
     */
    function (langCode) {
        this.currentLangCode = langCode;
        this.title = this.getResOnCurrentLangeContext('TitleName');
    };
    /**
     * @param {?} resKey
     * @return {?}
     */
    RtfAppComponent.prototype.getResOnCurrentLangeContext = /**
     * @param {?} resKey
     * @return {?}
     */
    function (resKey) {
        /** @type {?} */
        var resValue = i18nAppHelpInfo[this.currentLangCode][resKey];
        return resValue;
    };
    RtfAppComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-rtf-app',
                    template: "<div class=\"d-flex flex-row\" style=\"\r\nwidth: 800px; \r\nborder:2px;\r\nposition:absolute;\r\ntop:0px;\r\nbottom: 0px;\r\nright:0px;\r\nleft:0px;\r\noverflow: hidden;\r\nheight: 100%;\">\r\n    <div class=\"flex-fill\">\r\n        <kendo-splitter style=\"height:100%\" orientation=\"horizontal\">\r\n            <kendo-splitter-pane size=\"40%\" min=\"20%\" max=\"50%\">\r\n                <div class=\"d-flex flex-column flex-fill\" style=\"height:100%\">\r\n                    <div class=\"p-2\" style=\"height: 35px;\">\r\n                        <h5>{{this.getResOnCurrentLangeContext('TitleName')}}</h5>\r\n                        <hr class=\"m-0 p-0\" />\r\n                    </div>\r\n                    <div class=\"flex-fill\" style=\"overflow: auto;\">\r\n                        <app-module-tree [appTreeData]=\"this.treeData\" [bizObjectId]=\"bizObjectId\"\r\n                            (appTreeChanged)=\"leftAppTreeChanged($event)\"></app-module-tree>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n            <kendo-splitter-pane style=\"flex:1 1 0px; order: 2;\">\r\n                <div class=\"d-flex flex-column flex-fill\" style=\"height:100%\">\r\n                    <div class=\"p-2\" style=\"height: 35px;\">\r\n                        <h5>{{this.getResOnCurrentLangeContext('EntranceList')}}</h5>\r\n                        <hr class=\"m-0 p-0\" />\r\n                    </div>\r\n                    \r\n                    <!-- <div class=\"clearfix mt-1 mb-1 ml-1\">\r\n            <input #filter placeholder=\"\u8F93\u5165\u7F16\u53F7\u6216\u540D\u79F0\u67E5\u627E\" type=\"text\" />\r\n            <button class=\"btn btn-sm btn-default\" (click)=\"searchData(filter.value)\">\u67E5\u627E</button>\r\n          </div> -->\r\n                    <div class=\"d-flex flex-fill\" style=\"position:relative;\">\r\n                        <kendo-grid [class]=\"'flex-fill'\" [selectable]=\"selectableSettings\"\r\n                            [kendoGridBinding]=\"gridData\" [kendoGridSelectBy]=\"'id'\" [selectedKeys]=\"curSelectedKeys\">\r\n                            <kendo-grid-checkbox-column width=\"50px\"></kendo-grid-checkbox-column>\r\n                            <kendo-grid-column field=\"code\" title=\"{{this.getResOnCurrentLangeContext( 'Code')}}\">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field=\"name\" title=\"{{this.getResOnCurrentLangeContext( 'Name')}}\">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field=\"appEntrance\"\r\n                                title=\"{{this.getResOnCurrentLangeContext( 'Entrance')}}\"></kendo-grid-column>\r\n                        </kendo-grid>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n        </kendo-splitter>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #btnOkAndCancle>\r\n    <button class=\"btn btn-sm btn-primary\" (click)=\"confirm()\">{{this.getResOnCurrentLangeContext('Confirm')}}</button>\r\n    <button class=\"btn btn-sm btn-default\" (click)=\"cancle()\">{{this.getResOnCurrentLangeContext('Cancel')}}</button>\r\n</ng-template>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    RtfAppComponent.ctorParameters = function () { return [
        { type: RtfAppService },
        { type: I18NresourceService, decorators: [{ type: Optional }] },
        { type: MessagerService }
    ]; };
    RtfAppComponent.propDecorators = {
        bizObjectId: [{ type: Input }],
        gridSelectMode: [{ type: Input }],
        afterConfirm: [{ type: Output }],
        afterCancle: [{ type: Output }],
        btnOkAndCancleRef: [{ type: ViewChild, args: ['btnOkAndCancle',] }]
    };
    return RtfAppComponent;
}());
export { RtfAppComponent };
if (false) {
    /** @type {?} */
    RtfAppComponent.prototype.bizObjectId;
    /** @type {?} */
    RtfAppComponent.prototype.gridSelectMode;
    /**
     * 确认事件
     * @type {?}
     */
    RtfAppComponent.prototype.afterConfirm;
    /**
     * 关闭事件
     * @type {?}
     */
    RtfAppComponent.prototype.afterCancle;
    /** @type {?} */
    RtfAppComponent.prototype.btnOkAndCancleRef;
    /** @type {?} */
    RtfAppComponent.prototype.data;
    /** @type {?} */
    RtfAppComponent.prototype.dataarray;
    /** @type {?} */
    RtfAppComponent.prototype.gridData;
    /**
     * 左侧树列表数据
     * @type {?}
     */
    RtfAppComponent.prototype.treeData;
    /**
     * 当前选中数据
     * @type {?}
     */
    RtfAppComponent.prototype.curSelectedKeys;
    /** @type {?} */
    RtfAppComponent.prototype.selectableSettings;
    /** @type {?} */
    RtfAppComponent.prototype.selectedTreeNode;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.currentLangCode;
    /** @type {?} */
    RtfAppComponent.prototype.title;
    /** @type {?} */
    RtfAppComponent.prototype.i18nEntity;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.rtfAppService;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.i18nService;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.farrisMsg;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnRmLWFwcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9ydGYtYXBwaGVscC8iLCJzb3VyY2VzIjpbImxpYi9ydGYtYXBwLWhlbHAvcnRmLWFwcC9ydGYtYXBwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVqSCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFM0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDNUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7QUFNdEQ7SUE0Q0kseUJBQ1ksYUFBNEIsRUFDaEIsV0FBZ0MsRUFDNUMsU0FBMEI7UUFGMUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDaEIsZ0JBQVcsR0FBWCxXQUFXLENBQXFCO1FBQzVDLGNBQVMsR0FBVCxTQUFTLENBQWlCOzs7O1FBaEN0QyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFZLENBQUM7Ozs7UUFLNUMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBTXRDLGNBQVMsR0FBRyxFQUFFLENBQUM7Ozs7UUFVZixvQkFBZSxHQUFhLEVBQUUsQ0FBQztRQUl4QixVQUFLLEdBQUcsRUFBRSxDQUFDO1FBRWxCLGVBQVUsR0FBUSxFQUFFLENBQUM7UUFPakIsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNkLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUM3RDtRQUNELHlCQUF5QjtJQUM3QixDQUFDOzs7O0lBRUQsa0NBQVE7OztJQUFSO1FBQUEsaUJBbUNDO1FBbENHLElBQUksQ0FBQyxrQkFBa0IsR0FBRztZQUN0QixZQUFZLEVBQUUsSUFBSTs7WUFFbEIsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYztZQUMzRCxPQUFPLEVBQUUsSUFBSTtTQUNoQixDQUFDO1FBQ0Y7Ozs7Ozs7Ozs7Ozs7O1lBY0k7UUFDSixXQUFXO1FBQ1gsSUFBSSxDQUFDLGFBQWEsQ0FBQywyQkFBMkIsRUFBRSxDQUFDLFNBQVM7Ozs7UUFDdEQsVUFBQSxHQUFHO1lBQ0MsS0FBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7O2dCQUNkLFVBQVUsR0FBRyxHQUFHLENBQUMsTUFBTTs7OztZQUFDLFVBQUMsSUFBUyxJQUFLLE9BQUEsSUFBSSxDQUFDLEtBQUssS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEdBQUcsQ0FBQyxFQUExQyxDQUEwQyxFQUFDO1lBQ3hGLFVBQVUsQ0FBQyxPQUFPOzs7O1lBQUMsVUFBQSxHQUFHO2dCQUNsQixLQUFJLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMxRCxDQUFDLEVBQUMsQ0FBQztRQUNQLENBQUM7Ozs7UUFDRCxVQUFBLEtBQUs7WUFDRCxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyQyxDQUFDLEVBQ0osQ0FBQTtJQUNMLENBQUM7SUFFRDs7O09BR0c7Ozs7OztJQUNILG9DQUFVOzs7OztJQUFWLFVBQVcsV0FBbUI7UUFDMUIsWUFBWTtRQUNaLElBQUksV0FBVyxLQUFLLElBQUksSUFBSSxXQUFXLEtBQUssRUFBRSxFQUFFO1lBQzVDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNuQyxPQUFPO1NBQ1Y7O1lBQ0ssTUFBTSxHQUFHLFdBQVcsQ0FBQyxXQUFXLEVBQUU7UUFDeEMsU0FBUztRQUNULElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNOzs7O1FBQUMsVUFBQSxJQUFJO1lBQ2pDLE9BQUEsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO2dCQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFEeEMsQ0FDd0MsRUFBQyxDQUFDO0lBQ2xELENBQUM7SUFFRDs7O09BR0c7Ozs7OztJQUNILDRDQUFrQjs7Ozs7SUFBbEIsVUFBbUIsR0FBRztRQUNsQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDO1FBQzVCLElBQUksQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsS0FBSyxJQUFJLEdBQUcsS0FBSyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDM0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDbkIsT0FBTztTQUNWOztZQUVLLFVBQVUsR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEVBQUU7UUFDaEMsdUJBQXVCO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNOzs7O1FBQ2pDLFVBQUEsSUFBSSxJQUFJLE9BQUEsVUFBVSxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssVUFBVSxFQUF2QyxDQUF1QyxFQUNsRCxDQUFDO0lBQ04sQ0FBQztJQUdEOztPQUVHOzs7OztJQUNILDJDQUFpQjs7OztJQUFqQjtRQUFBLGlCQUtDOztZQUpTLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU07Ozs7UUFDaEMsVUFBQSxJQUFJLElBQUksT0FBQSxLQUFJLENBQUMsZUFBZSxJQUFJLEtBQUksQ0FBQyxlQUFlLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxLQUFLLElBQUksQ0FBQyxFQUFFLEVBQWxCLENBQWtCLEVBQUMsSUFBSSxDQUFDLEVBQXpGLENBQXlGLEVBQ3BHO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVEOztPQUVHOzs7OztJQUNILGlDQUFPOzs7O0lBQVA7UUFBQSxpQkFRQzs7WUFQUyxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFO1FBQ3ZDLElBQUksSUFBSSxDQUFDLGdCQUFnQixJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN0RCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssS0FBSyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxFQUE3QyxDQUE2QyxFQUFDLENBQUM7U0FDN0c7UUFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM5QyxrQkFBa0I7UUFDbEIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2xCLENBQUM7SUFDRDs7T0FFRzs7Ozs7SUFDSCxnQ0FBTTs7OztJQUFOO1FBQ0ksSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7O0lBRUQsMkNBQWlCOzs7SUFBakI7UUFBQSxpQkFVQztRQVRHLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUMsU0FBUzs7OztRQUNwQyxVQUFBLE1BQU07WUFDRixJQUFJLE1BQU0sRUFBRTtnQkFDUixLQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUM7Z0JBQzlCLEtBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDO2dCQUN6QixLQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7YUFDckM7UUFDTCxDQUFDLEVBQ0osQ0FBQztJQUNOLENBQUM7Ozs7O0lBRU0sNENBQWtCOzs7O0lBQXpCLFVBQTBCLFFBQWdCO1FBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsUUFBUSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLDJCQUEyQixDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQy9ELENBQUM7Ozs7O0lBRU0scURBQTJCOzs7O0lBQWxDLFVBQW1DLE1BQWM7O1lBQ3ZDLFFBQVEsR0FBRyxlQUFlLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUM5RCxPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDOztnQkFqTEosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxhQUFhO29CQUN2Qix1c0dBQXVDOztpQkFFMUM7Ozs7Z0JBZFEsYUFBYTtnQkFFYixtQkFBbUIsdUJBc0RuQixRQUFRO2dCQXBEUixlQUFlOzs7OEJBYW5CLEtBQUs7aUNBRUwsS0FBSzsrQkFLTCxNQUFNOzhCQUtOLE1BQU07b0NBR04sU0FBUyxTQUFDLGdCQUFnQjs7SUE0Si9CLHNCQUFDO0NBQUEsQUFsTEQsSUFrTEM7U0E3S1ksZUFBZTs7O0lBRXhCLHNDQUE2Qjs7SUFFN0IseUNBQ3NDOzs7OztJQUl0Qyx1Q0FDNEM7Ozs7O0lBSTVDLHNDQUNzQzs7SUFFdEMsNENBQ29DOztJQUVwQywrQkFBZTs7SUFDZixvQ0FBZTs7SUFDZixtQ0FBYzs7Ozs7SUFLZCxtQ0FBbUI7Ozs7O0lBSW5CLDBDQUErQjs7SUFDL0IsNkNBQXVDOztJQUN2QywyQ0FBc0I7Ozs7O0lBQ3RCLDBDQUFnQzs7SUFDaEMsZ0NBQWtCOztJQUVsQixxQ0FBcUI7Ozs7O0lBR2pCLHdDQUFvQzs7Ozs7SUFDcEMsc0NBQW9EOzs7OztJQUNwRCxvQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIElucHV0LCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTZWxlY3RhYmxlU2V0dGluZ3MgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1ncmlkJztcclxuaW1wb3J0IHsgUnRmQXBwU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2UvcnRmLWFwcC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUnRmQXBwIH0gZnJvbSAnLi4vZW50aXRpZXMvcnRmLWFwcCc7XHJcbmltcG9ydCB7IEkxOE5yZXNvdXJjZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2kxOE4vaTE4LW5yZXNvdXJjZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgaTE4bkFwcEhlbHBJbmZvIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2kxOG4tbW9kZWwvaTE4bi1tb2RlbCc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5cclxuLyoqXHJcbiAqIOezu+e7n+euoeeQhu+8muWKn+iDveaTjeS9nOW3puagkeacieOAgeWPs+WIl+ihqOWxleekulxyXG4gKi9cclxuLy8gdHNsaW50OmRpc2FibGVcclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2FwcC1ydGYtYXBwJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9ydGYtYXBwLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3J0Zi1hcHAuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSdGZBcHBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIGJpek9iamVjdElkOiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KClcclxuICAgIGdyaWRTZWxlY3RNb2RlOiAnc2luZ2xlJyB8ICdtdWx0aXBsZSc7XHJcbiAgICAvKipcclxuICAgICAqIOehruiupOS6i+S7tlxyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KClcclxuICAgIGFmdGVyQ29uZmlybSA9IG5ldyBFdmVudEVtaXR0ZXI8UnRmQXBwW10+KCk7XHJcbiAgICAvKipcclxuICAgICAqIOWFs+mXreS6i+S7tlxyXG4gICAgICovXHJcbiAgICBAT3V0cHV0KClcclxuICAgIGFmdGVyQ2FuY2xlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvLyDms6jlhaXliLDluK7liqnnmoTnoa7orqTlkozlj5bmtojmjInpkq5cclxuICAgIEBWaWV3Q2hpbGQoJ2J0bk9rQW5kQ2FuY2xlJylcclxuICAgIGJ0bk9rQW5kQ2FuY2xlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAgIGRhdGE6IFJ0ZkFwcFtdO1xyXG4gICAgZGF0YWFycmF5ID0gW107XHJcbiAgICBncmlkRGF0YTogYW55O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bem5L6n5qCR5YiX6KGo5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHRyZWVEYXRhOiBSdGZBcHBbXTtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN6YCJ5Lit5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIGN1clNlbGVjdGVkS2V5czogc3RyaW5nW10gPSBbXTtcclxuICAgIHNlbGVjdGFibGVTZXR0aW5nczogU2VsZWN0YWJsZVNldHRpbmdzO1xyXG4gICAgc2VsZWN0ZWRUcmVlTm9kZTogYW55O1xyXG4gICAgcHJpdmF0ZSBjdXJyZW50TGFuZ0NvZGU6IHN0cmluZztcclxuICAgIHB1YmxpYyB0aXRsZSA9ICcnO1xyXG5cclxuICAgIGkxOG5FbnRpdHk6IGFueSA9IHt9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgcnRmQXBwU2VydmljZTogUnRmQXBwU2VydmljZSxcclxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGkxOG5TZXJ2aWNlOiBJMThOcmVzb3VyY2VTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgZmFycmlzTXNnOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICApIHtcclxuICAgICAgICBpZiAoIWkxOG5TZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blNlcnZpY2UgPSBuZXcgSTE4TnJlc291cmNlU2VydmljZShydGZBcHBTZXJ2aWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5pMThuRW50aXR5SW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0YWJsZVNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICBjaGVja2JveE9ubHk6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIOm7mOiupOWNlemAiVxyXG4gICAgICAgICAgICBtb2RlOiAhdGhpcy5ncmlkU2VsZWN0TW9kZSA/ICdzaW5nbGUnIDogdGhpcy5ncmlkU2VsZWN0TW9kZSxcclxuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLyp0aGlzLnJ0ZkFwcFNlcnZpY2UuZ2V0QXBwTGlzdCgpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIOW3puS+p+agkVxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IHJlcztcclxuICAgICAgICAgICAgICAgIC8vIOiPnOWNleaYjue7huaVsOaNrlxyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHJlcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxheWVyID09PSAnNCcpO1xyXG4gICAgICAgICAgICAgICAgaW5mby5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YWFycmF5ID0gdGhpcy5kYXRhYXJyYXkuY29uY2F0KGVsZW1lbnQuYXBwSW52b2tzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5ncmlkRGF0YSA9IHRoaXMuZGF0YWFycmF5O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6I635Y+W5aSx6LSlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApOyovXHJcbiAgICAgICAgLy8g6I635Y+W5omA5pyJ5bqU55So5pWw5o2uXHJcbiAgICAgICAgdGhpcy5ydGZBcHBTZXJ2aWNlLmdldEFwcExpc3RXaXRoQml6T2JqZWN0RGF0YSgpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZURhdGEgPSByZXM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcHBEZXRhaWxzID0gcmVzLmZpbHRlcigoaXRlbTogYW55KSA9PiBpdGVtLmxheWVyID09PSAnNCcgfHwgKGl0ZW0ubGF5ZXIgPT09ICc1JykpO1xyXG4gICAgICAgICAgICAgICAgYXBwRGV0YWlscy5mb3JFYWNoKGVsZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhYXJyYXkgPSB0aGlzLmRhdGFhcnJheS5jb25jYXQoZWxlLmFwcEludm9rcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mYXJyaXNNc2cuZXJyb3IoXCLojrflj5blupTnlKjmlbDmja7lpLHotKVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmkJzntKJcclxuICAgICAqIEBwYXJhbSBmaWx0ZXJWYWx1ZSDmn6Xor6LmnaHku7ZcclxuICAgICAqL1xyXG4gICAgc2VhcmNoRGF0YShmaWx0ZXJWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgLy8g56m655qE5pCc57Si5piv5YWo6YOo5pWw5o2uXHJcbiAgICAgICAgaWYgKGZpbHRlclZhbHVlID09PSBudWxsIHx8IGZpbHRlclZhbHVlID09PSAnJykge1xyXG4gICAgICAgICAgICB0aGlzLmdyaWREYXRhID0gdGhpcy5kYXRhLmNvbmNhdCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZpbHRlciA9IGZpbHRlclZhbHVlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgLy8g5pCc57Si5Yiw5LiK57qn5pe2XHJcbiAgICAgICAgdGhpcy5ncmlkRGF0YSA9IHRoaXMuZGF0YS5maWx0ZXIoaXRlbSA9PlxyXG4gICAgICAgICAgICBpdGVtLmNvZGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIpIHx8XHJcbiAgICAgICAgICAgIGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlcikpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bem5L6n5qCR5YiH5o2iXHJcbiAgICAgKiBAcGFyYW0gYXJnIOWvueixoeWPguaVsFxyXG4gICAgICovXHJcbiAgICBsZWZ0QXBwVHJlZUNoYW5nZWQoYXJnKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZFRyZWVOb2RlID0gYXJnO1xyXG4gICAgICAgIGlmICghKCc0JyA9PT0gYXJnLmxheWVyIHx8ICc1JyA9PT0gYXJnLmxheWVyKSkge1xyXG4gICAgICAgICAgICB0aGlzLmdyaWREYXRhID0gW107XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSWQgPSBhcmcgJiYgYXJnLmlkO1xyXG4gICAgICAgIC8vIOagueaNrueItuWtkOWFs+ezu+i/h+a7pOW9k+WJjeeVjOmdouaVsOaNru+8jOWMheWQq+S4iuS4i+e6p1xyXG4gICAgICAgIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmRhdGFhcnJheS5maWx0ZXIoXHJcbiAgICAgICAgICAgIGl0ZW0gPT4gc2VsZWN0ZWRJZCAmJiBpdGVtLmFwcElkID09PSBzZWxlY3RlZElkXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bpgInkuK3mlbDmja5cclxuICAgICAqL1xyXG4gICAgZ2V0U2VsZWN0ZWRPYmplY3QoKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5kYXRhYXJyYXkuZmlsdGVyKFxyXG4gICAgICAgICAgICBpdGVtID0+IHRoaXMuY3VyU2VsZWN0ZWRLZXlzICYmIHRoaXMuY3VyU2VsZWN0ZWRLZXlzLmZpbmRJbmRleChzZWxlY3QgPT4gc2VsZWN0ID09PSBpdGVtLmlkKSA+PSAwXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog56Gu6K6kXHJcbiAgICAgKi9cclxuICAgIGNvbmZpcm0oKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5nZXRTZWxlY3RlZE9iamVjdCgpO1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkVHJlZU5vZGUgJiYgcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUcmVlTm9kZS5zZWxlY3RlZEludm9rID0gcmVzdWx0LmZpbHRlcihpbnYgPT4gaW52ICYmIGludi5hcHBJZCA9PT0gdGhpcy5zZWxlY3RlZFRyZWVOb2RlLmlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZnRlckNvbmZpcm0ubmV4dCh0aGlzLnNlbGVjdGVkVHJlZU5vZGUpO1xyXG4gICAgICAgIC8vIOWPlua2iC3nm67nmoTmmK/lnKjov5nph4zorqnmqKHmgIHmoYbmtojlpLFcclxuICAgICAgICB0aGlzLmNhbmNsZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlj5bmtohcclxuICAgICAqL1xyXG4gICAgY2FuY2xlKCkge1xyXG4gICAgICAgIHRoaXMuYWZ0ZXJDYW5jbGUubmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGkxOG5FbnRpdHlJbml0QmFrKCkge1xyXG4gICAgICAgIHRoaXMuaTE4blNlcnZpY2UuZ2V0STE4bkpzb24oKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIGVudGl0eSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IGVudGl0eS5UaXRsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pMThuRW50aXR5ID0gZW50aXR5O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaTE4blNlcnZpY2UuaTE4bk9iaiA9IGVudGl0eTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEN1cnJlbnRMYW5nQ29kZShsYW5nQ29kZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50TGFuZ0NvZGUgPSBsYW5nQ29kZTtcclxuICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5nZXRSZXNPbkN1cnJlbnRMYW5nZUNvbnRleHQoJ1RpdGxlTmFtZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZXNPbkN1cnJlbnRMYW5nZUNvbnRleHQocmVzS2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHJlc1ZhbHVlID0gaTE4bkFwcEhlbHBJbmZvW3RoaXMuY3VycmVudExhbmdDb2RlXVtyZXNLZXldO1xyXG4gICAgICAgIHJldHVybiByZXNWYWx1ZTtcclxuICAgIH1cclxufVxyXG5cclxuIl19
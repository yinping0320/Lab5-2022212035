/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FrameworkVariableService } from '../services/frmVariableService/framework-variable.service';
export class FrmUtil {
    /**
     * @param {?} bizContextId
     * @param {?} options
     * @return {?}
     */
    static setHeader(bizContextId, options) {
        options.headers = {
            'Content-Type': 'application/json',
        };
        if (bizContextId) {
            /** @type {?} */
            const contextKey = 'X-CAF-Runtime-Context';
            options.headers[contextKey] = bizContextId;
        }
        return options;
    }
    /**
     * @return {?}
     */
    static getTabArray() {
        /** @type {?} */
        const iframeTabArr = 'iframeTabarray';
        /** @type {?} */
        const topWin = this.getTopWindow();
        /** @type {?} */
        let frmWin = window;
        while ((!frmWin[iframeTabArr] || frmWin[iframeTabArr].length === 0) && frmWin !== topWin) {
            frmWin = frmWin.parent;
        }
        return (/** @type {?} */ (frmWin[iframeTabArr])) || [];
    }
    /**
     * @return {?}
     */
    static getTopWindow() {
        /** @type {?} */
        let curWin = window.self;
        try {
            while (curWin.location.origin === curWin.parent.location.origin) {
                if (curWin !== curWin.parent) {
                    curWin = curWin.parent;
                }
                else {
                    break;
                }
            }
        }
        catch (e) { }
        return curWin;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    static removeTab(index) {
        /** @type {?} */
        const iframeArr = this.getTabArray();
        iframeArr.splice(index, 1);
    }
}
export class EventUtil {
    /**
     * 获取框架event
     * @return {?}
     */
    static getFrmEvent() {
        /** @type {?} */
        const eventBus = this.frmVariable.getFrmVariableByKey(this.eventBusKey);
        return (/** @type {?} */ (eventBus));
    }
    /**
     * @param {?} feb
     * @return {?}
     */
    static setFrmEvent(feb) {
        this.frmVariable.frameworkVariableReg(this.eventBusKey, feb);
    }
    /**
     * 获取app唯一的观察者标识
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?=} tabId
     * @return {?}
     */
    static appObsToken(appId, appEntrance, tabId) {
        return tabId || `${appId}#${appEntrance}`;
    }
    /**
     * 获取func唯一的观察者标识
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    static funcObsToken(funcId, tabId) {
        return tabId || funcId;
    }
    /**
     * 获取某事件的监听者
     * @param {?} eventToken
     * @return {?}
     */
    static getObserver(eventToken) {
        /** @type {?} */
        const feb = this.getFrmEvent();
        /** @type {?} */
        const eventMap = feb.eventMap.get(eventToken);
        if (!eventMap) {
            return null;
        }
        /** @type {?} */
        let eventPipe;
        for (const eventPipeDetail of eventMap) {
            if (eventPipeDetail.matchEmitterToken(eventToken)) {
                eventPipe = eventPipeDetail;
                break;
            }
        }
        if (!eventPipe) {
            return null;
        }
        /** @type {?} */
        const obs = eventPipe.observers;
        return obs;
    }
    /**
     * 清空监听者
     * @param {?} obKey
     * @return {?}
     */
    static clearObserver(obKey) {
        /** @type {?} */
        const switchObsMap = this.getObserver(this.FUNC_SWITCH);
        /** @type {?} */
        const switchObs = switchObsMap.get(obKey);
        if (switchObs) {
            switchObs.unsubscribe();
            switchObsMap.delete(obKey);
        }
        /** @type {?} */
        const closeObsMap = this.getObserver(this.FUNC_CLOSED);
        /** @type {?} */
        const closeObs = closeObsMap.get(obKey);
        if (closeObs) {
            closeObs.unsubscribe();
            closeObsMap.delete(obKey);
        }
        /** @type {?} */
        const beforeCloseMap = this.getObserver(this.BEFORE_FUNC_CLOSE);
        /** @type {?} */
        const beforeClose = beforeCloseMap.get(obKey);
        if (beforeClose) {
            beforeClose.unsubscribe();
            beforeCloseMap.delete(obKey);
        }
    }
    /**
     * 清空某个管道
     * @param {?} pipeToken
     * @return {?}
     */
    static clearEventPipe(pipeToken) {
        /** @type {?} */
        const feb = this.getFrmEvent();
        /** @type {?} */
        const eventPipes = feb.eventMap.get(pipeToken);
        if (!eventPipes) {
            return;
        }
        /** @type {?} */
        const eventPipe = eventPipes.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.examByTargetToken(pipeToken)));
        if (eventPipe) {
            eventPipe.unSubscribe();
            feb.eventMap.delete(pipeToken);
        }
    }
}
/**
 * eventToken str
 */
EventUtil.FARRIS_APPS = 'all-gsp-farrisapps';
EventUtil.FARRIS_APP_CLICK = 'farrisapp-click';
EventUtil.ALL_GSP_FUNCS = 'all-gsp-functions';
EventUtil.BEFORE_FUNC_CLOSE = 'beforeFuncCloseEvent';
EventUtil.FUNC_CLOSED = 'FuncClosed';
EventUtil.FUNC_SWITCH = 'funcSwitchEvent';
EventUtil.AFTER_FRAME_LOAD = "after-iframe-load-event";
EventUtil.eventBusKey = 'frmEventBus';
EventUtil.frmVariable = new FrameworkVariableService();
if (false) {
    /**
     * eventToken str
     * @type {?}
     */
    EventUtil.FARRIS_APPS;
    /** @type {?} */
    EventUtil.FARRIS_APP_CLICK;
    /** @type {?} */
    EventUtil.ALL_GSP_FUNCS;
    /** @type {?} */
    EventUtil.BEFORE_FUNC_CLOSE;
    /** @type {?} */
    EventUtil.FUNC_CLOSED;
    /** @type {?} */
    EventUtil.FUNC_SWITCH;
    /** @type {?} */
    EventUtil.AFTER_FRAME_LOAD;
    /**
     * @type {?}
     * @private
     */
    EventUtil.eventBusKey;
    /**
     * @type {?}
     * @private
     */
    EventUtil.frmVariable;
}
/** @type {?} */
export const AppType = {
    App: 'app',
    Menu: 'menu',
    Other: 'other'
};
/**
 * @record
 */
export function FuncEventArgs() { }
if (false) {
    /**
     * 当前tab页的唯一标识
     * @type {?}
     */
    FuncEventArgs.prototype.tabId;
    /**
     * 当前tab打开的功能类型 app or menu
     * @type {?}
     */
    FuncEventArgs.prototype.appType;
    /** @type {?|undefined} */
    FuncEventArgs.prototype.funcId;
    /** @type {?|undefined} */
    FuncEventArgs.prototype.appId;
    /** @type {?|undefined} */
    FuncEventArgs.prototype.appEntrance;
    /** @type {?|undefined} */
    FuncEventArgs.prototype.tabName;
    /** @type {?|undefined} */
    FuncEventArgs.prototype.beforeCloseHandle;
}
/**
 * @record
 */
export function FuncStateParam() { }
if (false) {
    /**
     * formToken (简称 cvft)
     * @type {?|undefined}
     */
    FuncStateParam.prototype.token;
    /**
     * 当前tab页的唯一标识
     * @type {?}
     */
    FuncStateParam.prototype.tabId;
    /** @type {?|undefined} */
    FuncStateParam.prototype.funcId;
    /** @type {?|undefined} */
    FuncStateParam.prototype.appId;
    /** @type {?|undefined} */
    FuncStateParam.prototype.appEntrance;
    /**
     * 当页面name自定义时为自定义
     * 否则：func为funcName，app为entryName
     * @type {?}
     */
    FuncStateParam.prototype.menuName;
    /**
     * 动作
     * @type {?}
     */
    FuncStateParam.prototype.action;
}
/**
 * @record
 */
export function AppOptions() { }
if (false) {
    /**
     * 指定当前打开的是菜单（menu）还是应用（app）
     * @type {?}
     */
    AppOptions.prototype.appType;
    /**
     * 如果打开菜单，funcId需要指定，appId、appEntrance可以为空
     * @type {?}
     */
    AppOptions.prototype.funcId;
    /**
     * 如果打开应用，appId及appEntrance需要指定，funcId可以为空
     * @type {?}
     */
    AppOptions.prototype.appId;
    /** @type {?} */
    AppOptions.prototype.appEntrance;
    /**
     * 如果需要重复打开功能，则自行指定唯一tabId
     * @type {?|undefined}
     */
    AppOptions.prototype.tabId;
    /** @type {?|undefined} */
    AppOptions.prototype.tabName;
    /**
     * 表单公共变量token/formToken
     * @type {?|undefined}
     */
    AppOptions.prototype.token;
    /**
     * 表单所属SU
     * @type {?|undefined}
     */
    AppOptions.prototype.su;
    /** @type {?|undefined} */
    AppOptions.prototype.routeUrl;
    /** @type {?|undefined} */
    AppOptions.prototype.entityParams;
    /** @type {?|undefined} */
    AppOptions.prototype.queryStringParams;
    /** @type {?|undefined} */
    AppOptions.prototype.isReload;
    /** @type {?|undefined} */
    AppOptions.prototype.isJquery;
    /**
     * spa模式下重复打开功能
     * true：构造新的页面实例
     * false || null || undefined：复用已打开的页面实例
     * 目前新的tabId就是新的页面实例
     * @type {?|undefined}
     */
    AppOptions.prototype.isNewTab;
    /**
     * 只获取被打开表单的link实体，
     * 不触发框架加载表单实践
     * @type {?|undefined}
     */
    AppOptions.prototype.onlyGetIframeLink;
    /**
     * 关闭前回调处理
     * @type {?|undefined}
     */
    AppOptions.prototype.beforeCloseHandle;
}
/**
 * @record
 */
export function FrmSubjectOptions() { }
if (false) {
    /** @type {?|undefined} */
    FrmSubjectOptions.prototype.customToken;
    /** @type {?|undefined} */
    FrmSubjectOptions.prototype.funcId;
    /** @type {?|undefined} */
    FrmSubjectOptions.prototype.appId;
    /** @type {?|undefined} */
    FrmSubjectOptions.prototype.appEntrance;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJtLXV0aWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9ydGYtY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3NoYXJlZC9mcm0tdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBSUEsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sMkRBQTJELENBQUM7QUFFckcsTUFBTSxPQUFPLE9BQU87Ozs7OztJQUVULE1BQU0sQ0FBQyxTQUFTLENBQUMsWUFBb0IsRUFBRSxPQUFZO1FBQ3RELE9BQU8sQ0FBQyxPQUFPLEdBQUc7WUFDZCxjQUFjLEVBQUUsa0JBQWtCO1NBQ3JDLENBQUM7UUFDRixJQUFJLFlBQVksRUFBRTs7a0JBQ1IsVUFBVSxHQUFHLHVCQUF1QjtZQUMxQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLFlBQVksQ0FBQztTQUM5QztRQUNELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7Ozs7SUFFTSxNQUFNLENBQUMsV0FBVzs7Y0FDZixZQUFZLEdBQUcsZ0JBQWdCOztjQUMvQixNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRTs7WUFDOUIsTUFBTSxHQUFXLE1BQU07UUFDM0IsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLElBQUksTUFBTSxLQUFLLE1BQU0sRUFBRTtZQUN0RixNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUMxQjtRQUNELE9BQU8sbUJBQUEsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFnQixJQUFJLEVBQUUsQ0FBQztJQUN0RCxDQUFDOzs7O0lBRU0sTUFBTSxDQUFDLFlBQVk7O1lBQ2xCLE1BQU0sR0FBVyxNQUFNLENBQUMsSUFBSTtRQUNoQyxJQUFJO1lBQ0EsT0FBTyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsTUFBTSxDQUFDLFFB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QTJGaEUsTUFBTSxPQUFPLE9BQU8sR0FBRztJQUNuQixHQUFHLEVBQUUsS0FBSztJQUNWLElBQUksRUFBRSxNQUFNO0lBQ1osS0FBSyxFQUFFLE9BQU87Q0FDakI7Ozs7QUFFRCxtQ0FVQzs7Ozs7O0lBUkcsOEJBQWM7Ozs7O0lBRWQsZ0NBQWdCOztJQUNoQiwrQkFBZ0I7O0lBQ2hCLDhCQUFlOztJQUNmLG9DQUFxQjs7SUFDckIsZ0NBQWlCOztJQUNqQiwwQ0FBdUM7Ozs7O0FBRzNDLG9DQW1CQzs7Ozs7O0lBZkcsK0JBQWU7Ozs7O0lBRWYsK0JBQWM7O0lBQ2QsZ0NBQWdCOztJQUNoQiwrQkFBZTs7SUFDZixxQ0FBcUI7Ozs7OztJQUtyQixrQ0FBaUI7Ozs7O0lBSWpCLGdDQUFlOzs7OztBQUduQixnQ0FnREM7Ozs7OztJQTVDRyw2QkFBZ0I7Ozs7O0lBR2hCLDRCQUFlOzs7OztJQUdmLDJCQUFjOztJQUNkLGlDQUFvQjs7Ozs7SUFHcEIsMkJBQWU7O0lBQ2YsNkJBQWlCOzs7OztJQUtqQiwyQkFBZTs7Ozs7SUFJZix3QkFBWTs7SUFDWiw4QkFBa0I7O0lBQ2xCLGtDQUFtQjs7SUFDbkIsdUNBQXdDOztJQUN4Qyw4QkFBbUI7O0lBQ25CLDhCQUFtQjs7Ozs7Ozs7SUFPbkIsOEJBQW1COzs7Ozs7SUFNbkIsdUNBQTRCOzs7OztJQUs1Qix1Q0FBdUM7Ozs7O0FBRzNDLHVDQUtDOzs7SUFKRyx3Q0FBcUI7O0lBQ3JCLG1DQUFnQjs7SUFDaEIsa0NBQWU7O0lBQ2Ysd0NBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRnJtRXZlbnRCdXMgfSBmcm9tICcuLi9ldmVudGJ1cy9mcm0tZXZlbmJ1cyc7XHJcbmltcG9ydCB7IElmcmFtZUxpbmsgfSBmcm9tICcuLi9tb2RlbHMvaWZyYW1lLm1vZGVsJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEV2ZW50QnVzUGlwZSB9IGZyb20gJy4uL2V2ZW50YnVzL2ZybS1ldmVudHBpcGUnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtWYXJpYWJsZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9mcm1WYXJpYWJsZVNlcnZpY2UvZnJhbWV3b3JrLXZhcmlhYmxlLnNlcnZpY2UnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZybVV0aWwge1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgc2V0SGVhZGVyKGJpekNvbnRleHRJZDogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcclxuICAgICAgICBvcHRpb25zLmhlYWRlcnMgPSB7XHJcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoYml6Q29udGV4dElkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRleHRLZXkgPSAnWC1DQUYtUnVudGltZS1Db250ZXh0JztcclxuICAgICAgICAgICAgb3B0aW9ucy5oZWFkZXJzW2NvbnRleHRLZXldID0gYml6Q29udGV4dElkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldFRhYkFycmF5KCk6IElmcmFtZUxpbmtbXSB7XHJcbiAgICAgICAgY29uc3QgaWZyYW1lVGFiQXJyID0gJ2lmcmFtZVRhYmFycmF5JztcclxuICAgICAgICBjb25zdCB0b3BXaW4gPSB0aGlzLmdldFRvcFdpbmRvdygpO1xyXG4gICAgICAgIGxldCBmcm1XaW46IFdpbmRvdyA9IHdpbmRvdztcclxuICAgICAgICB3aGlsZSAoKCFmcm1XaW5baWZyYW1lVGFiQXJyXSB8fCBmcm1XaW5baWZyYW1lVGFiQXJyXS5sZW5ndGggPT09IDApICYmIGZybVdpbiAhPT0gdG9wV2luKSB7XHJcbiAgICAgICAgICAgIGZybVdpbiA9IGZybVdpbi5wYXJlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmcm1XaW5baWZyYW1lVGFiQXJyXSBhcyBJZnJhbWVMaW5rW10gfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBnZXRUb3BXaW5kb3coKTogV2luZG93IHtcclxuICAgICAgICBsZXQgY3VyV2luOiBXaW5kb3cgPSB3aW5kb3cuc2VsZjtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB3aGlsZSAoY3VyV2luLmxvY2F0aW9uLm9yaWdpbiA9PT0gY3VyV2luLnBhcmVudC5sb2NhdGlvbi5vcmlnaW4pIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJXaW4gIT09IGN1cldpbi5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJXaW4gPSBjdXJXaW4ucGFyZW50O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgICAgIHJldHVybiBjdXJXaW47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyByZW1vdmVUYWIoaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IGlmcmFtZUFyciA9IHRoaXMuZ2V0VGFiQXJyYXkoKTtcclxuICAgICAgICBpZnJhbWVBcnIuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEV2ZW50VXRpbCB7XHJcblxyXG4gICAgLyoqIGV2ZW50VG9rZW4gc3RyICovXHJcbiAgICBwdWJsaWMgc3RhdGljIEZBUlJJU19BUFBTID0gJ2FsbC1nc3AtZmFycmlzYXBwcyc7XHJcbiAgICBwdWJsaWMgc3RhdGljIEZBUlJJU19BUFBfQ0xJQ0sgPSAnZmFycmlzYXBwLWNsaWNrJztcclxuICAgIHB1YmxpYyBzdGF0aWMgQUxMX0dTUF9GVU5DUyA9ICdhbGwtZ3NwLWZ1bmN0aW9ucyc7XHJcbiAgICBwdWJsaWMgc3RhdGljIEJFRk9SRV9GVU5DX0NMT1NFID0gJ2JlZm9yZUZ1bmNDbG9zZUV2ZW50JztcclxuICAgIHB1YmxpYyBzdGF0aWMgRlVOQ19DTE9TRUQgPSAnRnVuY0Nsb3NlZCc7XHJcbiAgICBwdWJsaWMgc3RhdGljIEZVTkNfU1dJVENIID0gJ2Z1bmNTd2l0Y2hFdmVudCc7XHJcbiAgICBwdWJsaWMgc3RhdGljIEFGVEVSX0ZSQU1FX0xPQUQgPSBcImFmdGVyLWlmcmFtZS1sb2FkLWV2ZW50XCI7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBldmVudEJ1c0tleSA9ICdmcm1FdmVudEJ1cyc7XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZnJtVmFyaWFibGUgPSBuZXcgRnJhbWV3b3JrVmFyaWFibGVTZXJ2aWNlKCk7XHJcblxyXG4gICAgLyoqIOiOt+WPluahhuaetmV2ZW50ICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldEZybUV2ZW50KCk6IEZybUV2ZW50QnVzIHtcclxuICAgICAgICBjb25zdCBldmVudEJ1cyA9IHRoaXMuZnJtVmFyaWFibGUuZ2V0RnJtVmFyaWFibGVCeUtleSh0aGlzLmV2ZW50QnVzS2V5KTtcclxuICAgICAgICByZXR1cm4gZXZlbnRCdXMgYXMgRnJtRXZlbnRCdXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBzZXRGcm1FdmVudChmZWI6IEZybUV2ZW50QnVzKSB7XHJcbiAgICAgICAgdGhpcy5mcm1WYXJpYWJsZS5mcmFtZXdvcmtWYXJpYWJsZVJlZyh0aGlzLmV2ZW50QnVzS2V5LCBmZWIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+WYXBw5ZSv5LiA55qE6KeC5a+f6ICF5qCH6K+GXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXBwT2JzVG9rZW4oYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgdGFiSWQ/OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0YWJJZCB8fCBgJHthcHBJZH0jJHthcHBFbnRyYW5jZX1gO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+WZnVuY+WUr+S4gOeahOinguWvn+iAheagh+ivhlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGZ1bmNPYnNUb2tlbihmdW5jSWQ6IHN0cmluZywgdGFiSWQ/OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0YWJJZCB8fCBmdW5jSWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmn5Dkuovku7bnmoTnm5HlkKzogIVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRPYnNlcnZlcihldmVudFRva2VuOiBzdHJpbmcpOiBNYXA8c3RyaW5nLCBTdWJzY3JpcHRpb24+IHtcclxuICAgICAgICBjb25zdCBmZWIgPSB0aGlzLmdldEZybUV2ZW50KCk7XHJcbiAgICAgICAgY29uc3QgZXZlbnRNYXAgPSBmZWIuZXZlbnRNYXAuZ2V0KGV2ZW50VG9rZW4pO1xyXG4gICAgICAgIGlmICghZXZlbnRNYXApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZXZlbnRQaXBlOiBFdmVudEJ1c1BpcGU7XHJcbiAgICAgICAgZm9yIChjb25zdCBldmVudFBpcGVEZXRhaWwgb2YgZXZlbnRNYXApIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50UGlwZURldGFpbC5tYXRjaEVtaXR0ZXJUb2tlbihldmVudFRva2VuKSkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnRQaXBlID0gZXZlbnRQaXBlRGV0YWlsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFldmVudFBpcGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9icyA9IGV2ZW50UGlwZS5vYnNlcnZlcnM7XHJcbiAgICAgICAgcmV0dXJuIG9icztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa4heepuuebkeWQrOiAhVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGNsZWFyT2JzZXJ2ZXIob2JLZXk6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHN3aXRjaE9ic01hcCA9IHRoaXMuZ2V0T2JzZXJ2ZXIodGhpcy5GVU5DX1NXSVRDSCk7XHJcbiAgICAgICAgY29uc3Qgc3dpdGNoT2JzID0gc3dpdGNoT2JzTWFwLmdldChvYktleSk7XHJcbiAgICAgICAgaWYgKHN3aXRjaE9icykge1xyXG4gICAgICAgICAgICBzd2l0Y2hPYnMudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgc3dpdGNoT2JzTWFwLmRlbGV0ZShvYktleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNsb3NlT2JzTWFwID0gdGhpcy5nZXRPYnNlcnZlcih0aGlzLkZVTkNfQ0xPU0VEKTtcclxuICAgICAgICBjb25zdCBjbG9zZU9icyA9IGNsb3NlT2JzTWFwLmdldChvYktleSk7XHJcbiAgICAgICAgaWYgKGNsb3NlT2JzKSB7XHJcbiAgICAgICAgICAgIGNsb3NlT2JzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIGNsb3NlT2JzTWFwLmRlbGV0ZShvYktleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGJlZm9yZUNsb3NlTWFwID0gdGhpcy5nZXRPYnNlcnZlcih0aGlzLkJFRk9SRV9GVU5DX0NMT1NFKTtcclxuICAgICAgICBjb25zdCBiZWZvcmVDbG9zZSA9IGJlZm9yZUNsb3NlTWFwLmdldChvYktleSk7XHJcbiAgICAgICAgaWYgKGJlZm9yZUNsb3NlKSB7XHJcbiAgICAgICAgICAgIGJlZm9yZUNsb3NlLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIGJlZm9yZUNsb3NlTWFwLmRlbGV0ZShvYktleSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF56m65p+Q5Liq566h6YGTXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgY2xlYXJFdmVudFBpcGUocGlwZVRva2VuOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBmZWIgPSB0aGlzLmdldEZybUV2ZW50KCk7XHJcbiAgICAgICAgY29uc3QgZXZlbnRQaXBlcyA9IGZlYi5ldmVudE1hcC5nZXQocGlwZVRva2VuKTtcclxuICAgICAgICBpZiAoIWV2ZW50UGlwZXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBldmVudFBpcGUgPSBldmVudFBpcGVzLmZpbmQoaXRlbSA9PiBpdGVtLmV4YW1CeVRhcmdldFRva2VuKHBpcGVUb2tlbikpO1xyXG4gICAgICAgIGlmIChldmVudFBpcGUpIHtcclxuICAgICAgICAgICAgZXZlbnRQaXBlLnVuU3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIGZlYi5ldmVudE1hcC5kZWxldGUocGlwZVRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBBcHBUeXBlID0ge1xyXG4gICAgQXBwOiAnYXBwJyxcclxuICAgIE1lbnU6ICdtZW51JyxcclxuICAgIE90aGVyOiAnb3RoZXInXHJcbn07XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEZ1bmNFdmVudEFyZ3Mge1xyXG4gICAgLyoqIOW9k+WJjXRhYumhteeahOWUr+S4gOagh+ivhiAqL1xyXG4gICAgdGFiSWQ6IHN0cmluZztcclxuICAgIC8qKiDlvZPliY10YWLmiZPlvIDnmoTlip/og73nsbvlnosgYXBwIG9yIG1lbnUgKi9cclxuICAgIGFwcFR5cGU6IHN0cmluZztcclxuICAgIGZ1bmNJZD86IHN0cmluZztcclxuICAgIGFwcElkPzogc3RyaW5nO1xyXG4gICAgYXBwRW50cmFuY2U/OiBzdHJpbmc7XHJcbiAgICB0YWJOYW1lPzogc3RyaW5nO1xyXG4gICAgYmVmb3JlQ2xvc2VIYW5kbGU/OiAoYXJnOiBhbnkpID0+IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRnVuY1N0YXRlUGFyYW0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBmb3JtVG9rZW4gKOeugOensCBjdmZ0KVxyXG4gICAgICovXHJcbiAgICB0b2tlbj86IHN0cmluZztcclxuICAgIC8qKiDlvZPliY10YWLpobXnmoTllK/kuIDmoIfor4YgKi9cclxuICAgIHRhYklkOiBzdHJpbmc7XHJcbiAgICBmdW5jSWQ/OiBzdHJpbmc7XHJcbiAgICBhcHBJZD86IHN0cmluZztcclxuICAgIGFwcEVudHJhbmNlPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPpobXpnaJuYW1l6Ieq5a6a5LmJ5pe25Li66Ieq5a6a5LmJXHJcbiAgICAgKiDlkKbliJnvvJpmdW5j5Li6ZnVuY05hbWXvvIxhcHDkuLplbnRyeU5hbWVcclxuICAgICAqL1xyXG4gICAgbWVudU5hbWU6IHN0cmluZztcclxuICAgIC8qKlxyXG4gICAgICog5Yqo5L2cXHJcbiAgICAgKi9cclxuICAgIGFjdGlvbjogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFwcE9wdGlvbnMge1xyXG4gICAgLyoqXHJcbiAgICAgKiDmjIflrprlvZPliY3miZPlvIDnmoTmmK/oj5zljZXvvIhtZW5177yJ6L+Y5piv5bqU55So77yIYXBw77yJXHJcbiAgICAgKi9cclxuICAgIGFwcFR5cGU6IHN0cmluZztcclxuXHJcbiAgICAvKioqIOWmguaenOaJk+W8gOiPnOWNle+8jGZ1bmNJZOmcgOimgeaMh+Wumu+8jGFwcElk44CBYXBwRW50cmFuY2Xlj6/ku6XkuLrnqbogKi9cclxuICAgIGZ1bmNJZDogc3RyaW5nO1xyXG5cclxuICAgIC8qKiog5aaC5p6c5omT5byA5bqU55So77yMYXBwSWTlj4phcHBFbnRyYW5jZemcgOimgeaMh+Wumu+8jGZ1bmNJZOWPr+S7peS4uuepuiAqL1xyXG4gICAgYXBwSWQ6IHN0cmluZztcclxuICAgIGFwcEVudHJhbmNlOiBzdHJpbmc7XHJcblxyXG4gICAgLyoqIOWmguaenOmcgOimgemHjeWkjeaJk+W8gOWKn+iDve+8jOWImeiHquihjOaMh+WumuWUr+S4gHRhYklkICovXHJcbiAgICB0YWJJZD86IHN0cmluZztcclxuICAgIHRhYk5hbWU/OiBzdHJpbmc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDooajljZXlhazlhbHlj5jph490b2tlbi9mb3JtVG9rZW5cclxuICAgICAqL1xyXG4gICAgdG9rZW4/OiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOihqOWNleaJgOWxnlNVXHJcbiAgICAgKi9cclxuICAgIHN1Pzogc3RyaW5nO1xyXG4gICAgcm91dGVVcmw/OiBzdHJpbmc7XHJcbiAgICBlbnRpdHlQYXJhbXM/OiBhbnk7XHJcbiAgICBxdWVyeVN0cmluZ1BhcmFtcz86IE1hcDxzdHJpbmcsIHN0cmluZz47XHJcbiAgICBpc1JlbG9hZD86IGJvb2xlYW47XHJcbiAgICBpc0pxdWVyeT86IGJvb2xlYW47XHJcbiAgICAvKipcclxuICAgICAqIHNwYeaooeW8j+S4i+mHjeWkjeaJk+W8gOWKn+iDvVxyXG4gICAgICogdHJ1Ze+8muaehOmAoOaWsOeahOmhtemdouWunuS+i1xyXG4gICAgICogZmFsc2UgfHwgbnVsbCB8fCB1bmRlZmluZWTvvJrlpI3nlKjlt7LmiZPlvIDnmoTpobXpnaLlrp7kvotcclxuICAgICAqIOebruWJjeaWsOeahHRhYklk5bCx5piv5paw55qE6aG16Z2i5a6e5L6LXHJcbiAgICAgKi9cclxuICAgIGlzTmV3VGFiPzogYm9vbGVhbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWPquiOt+WPluiiq+aJk+W8gOihqOWNleeahGxpbmvlrp7kvZPvvIxcclxuICAgICAqIOS4jeinpuWPkeahhuaetuWKoOi9veihqOWNleWunui3tVxyXG4gICAgICovXHJcbiAgICBvbmx5R2V0SWZyYW1lTGluaz86IGJvb2xlYW47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhbPpl63liY3lm57osIPlpITnkIZcclxuICAgICAqL1xyXG4gICAgYmVmb3JlQ2xvc2VIYW5kbGU/OiAoYXJnOiBhbnkpID0+IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRnJtU3ViamVjdE9wdGlvbnMge1xyXG4gICAgY3VzdG9tVG9rZW4/OiBzdHJpbmc7XHJcbiAgICBmdW5jSWQ/OiBzdHJpbmc7XHJcbiAgICBhcHBJZD86IHN0cmluZztcclxuICAgIGFwcEVudHJhbmNlPzogc3RyaW5nO1xyXG59XHJcblxyXG4iXX0=
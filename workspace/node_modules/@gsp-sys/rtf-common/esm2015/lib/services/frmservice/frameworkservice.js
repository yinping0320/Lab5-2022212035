/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { Router } from '@angular/router';
import { of } from 'rxjs';
import { FrmEventBus } from '../../eventbus/frm-evenbus';
import { LoadingService } from '../loading/loading.service';
import { FuncsService } from '../funcsservice/funcs.service';
import { IframeLink } from '../../models/iframe.model';
import { map, switchMap } from 'rxjs/operators';
import { CacheService, HttpService, LanguageService, SessionService } from '@ecp-caf/caf-common';
import { EventUtil, FrmUtil, AppType } from '../../shared/frm-util';
import { AppService } from '../appservice/app.service';
import { FrmI18nSettingService } from '../i18nService/i18n-setting.service';
import { FrameworkVariableService } from '../frmVariableService/framework-variable.service';
export class FrameworkService {
    /**
     * @param {?} http
     * @param {?} router
     * @param {?} cache
     * @param {?} sessionSvc
     * @param {?} feb
     * @param {?} funcService
     * @param {?} loadService
     * @param {?} appService
     * @param {?} i18nSetting
     */
    constructor(http, router, cache, sessionSvc, feb, funcService, loadService, appService, i18nSetting) {
        this.http = http;
        this.router = router;
        this.cache = cache;
        this.sessionSvc = sessionSvc;
        this.feb = feb;
        this.funcService = funcService;
        this.loadService = loadService;
        this.appService = appService;
        this.i18nSetting = i18nSetting;
        this.FUNCSTATUS_PATH = '/api/runtime/sys/v1.0/function-states';
        this.BeforeFuncClose = EventUtil.BEFORE_FUNC_CLOSE;
        this.FuncClosed = EventUtil.FUNC_CLOSED;
        this.FuncSwitch = EventUtil.FUNC_SWITCH;
        if (!this.i18nSetting) {
            /** @type {?} */
            const variables = new FrameworkVariableService();
            /** @type {?} */
            const language = new LanguageService(null);
            this.i18nSetting = new FrmI18nSettingService(variables, language, http);
        }
        if (!this.appService) {
            this.appService = new AppService(this.http, this.sessionSvc, this.i18nSetting);
        }
    }
    /**
     * 根据funcid打开功能菜单
     * (适用于单页签路由，不支持NG7升级后菜单之间跳转)
     * @param {?} funcid
     * @param {?} routepath
     * @param {?} parentsessionid
     * @param {?=} newsession
     * @param {?=} simpleparam
     * @return {?}
     */
    openFunc(funcid, routepath, parentsessionid, newsession = true, simpleparam = '') {
        /** @type {?} */
        const appOps = {
            appType: AppType.Menu,
            funcId: funcid,
            appId: '',
            appEntrance: ''
        };
        this.internalOpen(appOps);
        return of(true);
        // return this.internalOpen$(appOps);
    }
    /**
     * 直接打开功能
     * @param {?} options
     * @return {?}
     */
    openMenu(options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                if (!options.appId) {
                    window.alert('参数appId不能为空！');
                    return;
                }
                this.appService.openAppByOptions(options);
                break;
            case AppType.Menu:
                this.internalOpen(options);
                break;
            case AppType.Other: break;
        }
    }
    /**
     * 通过流方式打开功能
     * @param {?} options
     * @return {?}
     */
    openMenu$(options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                if (!options.appId) {
                    window.alert('参数appId不能为空！');
                    return;
                }
                return this.appService.openAppByOptions$(options);
            case AppType.Menu:
                if (options.onlyGetIframeLink === true) {
                    return this.internalOpenByIframeLink$(options);
                }
                return this.internalOpen$(options);
            case AppType.Other: break;
        }
    }
    /**
     * 打开联查菜单
     * @param {?} funcId
     * @param {?} options
     * @return {?}
     */
    openConnectedFunc(funcId, options) {
        /** @type {?} */
        const appOps = {
            appType: AppType.Menu,
            funcId,
            appId: '',
            appEntrance: '',
            entityParams: options.EntityParam,
        };
        this.internalOpen(appOps);
    }
    /**
     * 打开联查菜单，并传参
     * @param {?} funcId
     * @param {?} params
     * @param {?=} reload
     * @return {?}
     */
    openFuncWithParam(funcId, params, reload) {
        /** @type {?} */
        const options = {
            appType: AppType.Menu,
            funcId,
            appId: '',
            appEntrance: '',
            entityParams: params,
            queryStringParams: params,
            isReload: reload
        };
        this.internalOpen(options);
    }
    /**
     * 打开功能，不返回流
     * @private
     * @param {?} options
     * @return {?}
     */
    internalOpen(options) {
        this.checkingBeforeOpen$(options)
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            if (!res || !res.func || res.linkobj) {
                return;
            }
            /** @type {?} */
            const func = res.func;
            this.getInvokeAndEnterFunc$(options, func).subscribe((/**
             * @param {?} lobj
             * @return {?}
             */
            (lobj) => this.getFeb().post(EventUtil.FARRIS_APP_CLICK, lobj)), (/**
             * @param {?} err
             * @return {?}
             */
            err => {
                /** @type {?} */
                const info = {
                    isErr: true,
                    errInfo: err
                };
                this.getFeb().post(EventUtil.FARRIS_APP_CLICK, info);
            }));
        }));
    }
    /**
     * 通过串流控制，打开菜单
     * @private
     * @param {?} options
     * @return {?}
     */
    internalOpen$(options) {
        return this.checkingBeforeOpen$(options)
            .pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            if (!res || !res.func || res.linkobj) {
                return of(null);
            }
            /** @type {?} */
            const func = res.func;
            return this.getInvokeAndEnterFunc$(options, func).pipe(map((/**
             * @param {?} lobj
             * @return {?}
             */
            (lobj) => {
                this.getFeb().post(EventUtil.FARRIS_APP_CLICK, lobj);
                return true;
            })));
        })));
    }
    /**
     * 通过串流获取被打开菜单的iframeLink对象信息
     * @private
     * @param {?} options
     * @return {?}
     */
    internalOpenByIframeLink$(options) {
        if (!options.funcId) {
            window.alert('参数funcId不能为空！');
            return of(null);
        }
        return this.getFuncEntity(options.funcId).pipe(switchMap((/**
         * @param {?} func
         * @return {?}
         */
        func => {
            if (!func) {
                window.alert(`请确认您是否具备打开菜单(ID:${options.funcId})的权限`);
                return null;
            }
            return this.getInvokeAndEnterFunc$(options, func);
        })));
    }
    /**
     * @private
     * @param {?} options
     * @param {?} func
     * @return {?}
     */
    getInvokeAndEnterFunc$(options, func) {
        /** @type {?} */
        const newPageId = this.newPageId(options.funcId, options.tabId);
        options.tabId = newPageId;
        /** @type {?} */
        let linkobj;
        return this.getFuncInvok(options.funcId).pipe(switchMap((/**
         * @param {?} funcInvok
         * @return {?}
         */
        funcInvok => {
            /** @type {?} */
            const routurl = funcInvok.invokingConfig.url;
            /** @type {?} */
            const paramInfo = funcInvok.invokingConfig.staticParams;
            /** @type {?} */
            const entityParamInfo = funcInvok.invokingConfig.entityParams;
            /** @type {?} */
            const staticParam = paramInfo ? JSON.parse(paramInfo) : '';
            /** @type {?} */
            const entityParam = entityParamInfo ? JSON.parse(entityParamInfo) : '';
            /** @type {?} */
            const su = this.getSu(routurl);
            return this.enterFunc({
                tabId: newPageId,
                funcId: options.funcId,
                menuName: options.tabName || func.name,
                action: 'enter'
            }, su).pipe(map((/**
             * @param {?} formToken
             * @return {?}
             */
            formToken => {
                linkobj = new IframeLink(func.code, null, this.buildQueryStringByMap(routurl, options.funcId, options.tabId, formToken, options.queryStringParams));
                linkobj.id = newPageId; // 页面唯一标识 允许页面重复打开
                linkobj.appType = AppType.Menu;
                linkobj.funcId = options.funcId;
                linkobj.FuncName = options.tabName || func.name;
                linkobj.url = funcInvok.invokingConfig.url;
                linkobj.reload = options.isReload;
                linkobj.su = su;
                linkobj.isNewTab = options.isNewTab;
                linkobj.formToken = formToken;
                if (staticParam) {
                    // dky特殊场景，打开jquery原生功能
                    staticParam.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => {
                        if (item.name === 'jquery') {
                            linkobj.isjquery = true;
                        }
                        if (item.name === 'mode') {
                            linkobj.mode = item.value;
                            linkobj.src += (item.value ? `&appMode=${item.value}&` : '');
                        }
                    }));
                }
                // 大对象实体传参，针对被打开页面建立唯一管道
                this.getFeb().post(newPageId, options.entityParams);
                // this.getFeb().post(EventUtil.FARRIS_APP_CLICK, linkobj);
                return linkobj;
            })), switchMap((/**
             * @param {?} formLink
             * @return {?}
             */
            formLink => {
                return this.i18nSetting.getSetting$().pipe(map((/**
                 * @return {?}
                 */
                () => formLink)));
            })));
        })));
    }
    /**
     * 流方式检查菜单打开状态
     * @private
     * @param {?} options
     * @return {?}
     */
    checkingBeforeOpen$(options) {
        if (!options.funcId) {
            window.alert('参数funcId不能为空！');
            return of(null);
        }
        return this.getFuncEntity(options.funcId).pipe(map((/**
         * @param {?} func
         * @return {?}
         */
        func => {
            if (!func) {
                window.alert(`请确认您是否具备打开菜单(ID:${options.funcId})的权限`);
                return null;
            }
            /** @type {?} */
            const funcId = options.funcId;
            /** @type {?} */
            const tabId = options.tabId;
            /** @type {?} */
            const pageId = this.getPageId(funcId, tabId);
            /** @type {?} */
            const linkobj = FrmUtil.getTabArray().find((/**
             * @param {?} i
             * @return {?}
             */
            i => i.id === pageId && i.appType === AppType.Menu));
            if (linkobj) {
                linkobj.FuncName = options.tabName || linkobj.FuncName;
                linkobj.src = this.buildQueryStringByMap(linkobj.url, funcId, options.tabId, '', options.queryStringParams);
                linkobj.reload = options.isReload; // 界面刷新不改session
                this.getFeb().post(pageId, options.entityParams);
                this.getFeb().post(EventUtil.FARRIS_APP_CLICK, linkobj);
            }
            return { func, linkobj };
        })));
    }
    /**
     * 关闭前
     * @param {?} options
     * @return {?}
     */
    beforeCloseMenu(options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                this.appService.beforeCloseAppByOptions(options);
                break;
            case AppType.Menu:
                this.beforeCloseFuncByOptions(options);
                break;
            default: break;
        }
    }
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    beforeCloseFuncByOptions(options) {
        /** @type {?} */
        const func = this.funcService.getCachedFunc(options.funcId);
        /** @type {?} */
        const funcObkey = EventUtil.funcObsToken(options.funcId, options.tabId);
        /** @type {?} */
        const pageId = this.getPageId(options.funcId, options.tabId);
        /** @type {?} */
        const obs = EventUtil.getObserver(EventUtil.BEFORE_FUNC_CLOSE).get(funcObkey);
        if (!obs) {
            this.closeFuncByOptions(options);
            return;
        }
        /** @type {?} */
        const eventArgs = {
            tabId: pageId,
            appType: AppType.Menu,
            funcId: options.funcId,
            tabName: func && func.Name,
            beforeCloseHandle: options.beforeCloseHandle
        };
        this.getFeb().post(EventUtil.BEFORE_FUNC_CLOSE, eventArgs);
    }
    /**
     * 菜单关闭前事件触发(无 token)
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    beforeCloseFunc(funcId, tabId) {
        /** @type {?} */
        const func = this.funcService.getCachedFunc(funcId);
        /** @type {?} */
        const funcObkey = EventUtil.funcObsToken(funcId, tabId);
        /** @type {?} */
        const obs = EventUtil.getObserver(EventUtil.BEFORE_FUNC_CLOSE).get(funcObkey);
        if (!obs) {
            this.closeFunc(funcId, tabId);
            return;
        }
        /** @type {?} */
        const eventArgs = {
            tabId: this.getPageId(funcId, tabId),
            appType: AppType.Menu,
            funcId,
            tabName: func && func.Name
        };
        this.getFeb().post(EventUtil.BEFORE_FUNC_CLOSE, eventArgs);
    }
    /**
     * 直接关闭
     *
     * @param {?} options
     * @return {?}
     */
    closeMenu(options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                this.appService.closeAppByOptions(options).subscribe();
                break;
            case AppType.Menu:
                this.closeFuncByOptions(options);
                break;
            default: break;
        }
    }
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    closeFuncByOptions(options) {
        /** @type {?} */
        const pageId = this.getPageId(options.funcId, options.tabId);
        EventUtil.clearObserver(EventUtil.funcObsToken(options.funcId, options.tabId));
        EventUtil.clearEventPipe(pageId); // 当前页面大对象传参会有唯一的管道
        // 当前页面大对象传参会有唯一的管道
        /** @type {?} */
        const func = this.funcService.getCachedFunc(options.funcId);
        /** @type {?} */
        const objIndex = FrmUtil.getTabArray().findIndex((/**
         * @param {?} i
         * @return {?}
         */
        i => i.id === pageId && i.appType === AppType.Menu));
        /** @type {?} */
        const obj = FrmUtil.getTabArray()[objIndex];
        options.token = options.token || obj.formToken;
        /** @type {?} */
        let su = options.su;
        if (obj) {
            su = obj.su;
            FrmUtil.removeTab(objIndex);
            /** @type {?} */
            const eventArgs = {
                tabId: pageId,
                appType: AppType.Menu,
                funcId: options.funcId,
                tabName: func && func.name
            };
            this.getFeb().post(EventUtil.FUNC_CLOSED, eventArgs);
        }
        this.quitFunc(options, su)
            .subscribe((/**
         * @return {?}
         */
        () => { }));
    }
    /**
     * 关闭菜单tab页签，tabId可以指定，默认为funcId
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    closeFunc(funcId, tabId) {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        const pageId = this.getPageId(funcId, tabId);
        EventUtil.clearObserver(EventUtil.funcObsToken(funcId, tabId));
        EventUtil.clearEventPipe(pageId); // 当前页面大对象传参会有唯一的管道
        // 当前页面大对象传参会有唯一的管道
        /** @type {?} */
        const func = this.funcService.getCachedFunc(funcId);
        /** @type {?} */
        const objIndex = FrmUtil.getTabArray().findIndex((/**
         * @param {?} i
         * @return {?}
         */
        i => i.id === pageId && i.appType === AppType.Menu));
        /** @type {?} */
        const obj = FrmUtil.getTabArray()[objIndex];
        /** @type {?} */
        const formToken = obj.formToken;
        if (obj) {
            FrmUtil.removeTab(objIndex);
            /** @type {?} */
            const eventArgs = {
                tabId: pageId,
                appType: AppType.Menu,
                funcId,
                tabName: func && func.name
            };
            self.getFeb().post(EventUtil.FUNC_CLOSED, eventArgs);
        }
        /** @type {?} */
        const options = {
            tabId,
            funcId,
            appId: '',
            appEntrance: '',
            appType: AppType.Menu,
            token: formToken,
        };
        this.quitFunc(options, obj.su)
            .subscribe((/**
         * @return {?}
         */
        () => { }));
        return of(true);
    }
    /**
     * 获取菜单的调用信息
     * @param {?} funcId
     * @return {?}
     */
    getFuncInvok(funcId) {
        /** @type {?} */
        const invoks = this.getInvokCache();
        /** @type {?} */
        const funcInvok = invoks.find((/**
         * @param {?} f
         * @return {?}
         */
        f => f.id === funcId));
        if (!funcInvok) {
            return this.getInvokConfig(funcId).pipe(map((/**
             * @param {?} v
             * @return {?}
             */
            v => {
                if (!v) {
                    return null;
                }
                invoks.push(v);
                this.funcService.cacheAllFuncInvoks(invoks);
                return v;
            })));
        }
        return of(funcInvok);
    }
    /**
     * 获取菜单实体
     * @param {?} funcId
     * @return {?}
     */
    getFuncEntity(funcId) {
        /** @type {?} */
        const func = this.funcService.getCachedFunc(funcId);
        if (!func) {
            /** @type {?} */
            const url = `/api/runtime/sys/v1.0/functions/${funcId}`;
            return this.http.request('Get', url, FrmUtil.setHeader(null, {}))
                .pipe(map((/**
             * @param {?} v
             * @return {?}
             */
            v => {
                if (!v || !v[0]) {
                    return null;
                }
                /** @type {?} */
                const allFuncs = (/** @type {?} */ (this.funcService.getAllCachedFuncs()));
                allFuncs.push(v[0]);
                this.funcService.cacheAllFuncs(allFuncs);
                return v[0];
            })));
        }
        return of(func);
    }
    /**
     * 获取菜单预置参数
     * @param {?} funcId
     * @return {?}
     */
    getPresetParams(funcId) {
        return this.getFuncInvok(funcId).pipe(map((/**
         * @param {?} funcInvok
         * @return {?}
         */
        funcInvok => {
            /** @type {?} */
            const paramInfo = funcInvok.invokingConfig.staticParams;
            /** @type {?} */
            const entityParamInfo = funcInvok.invokingConfig.entityParams;
            /** @type {?} */
            const staticParam = paramInfo ? JSON.parse(paramInfo) : [];
            /** @type {?} */
            const entityParam = entityParamInfo ? JSON.parse(entityParamInfo) : [];
            return this.mergeParams(staticParam, entityParam);
        })));
    }
    /**
     * 获取菜单的静态参数
     * @param {?} funcId
     * @return {?}
     */
    getStaticParam(funcId) {
        return this.getFuncInvok(funcId).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (v.invokingConfig.staticParams) {
                return JSON.parse(v.invokingConfig.staticParams);
            }
        })));
    }
    /**
     * 获取表单的实体参数
     * @param {?} tabId
     * @param {?} handler
     * @param {?=} isSubonce
     * @return {?}
     */
    getEntityParam(tabId, handler, isSubonce = true) {
        if (isSubonce) {
            this.getFeb().once(tabId, handler);
        }
        this.getFeb().on(tabId, handler);
    }
    /**
     * @param {?} funcId
     * @return {?}
     */
    entityParamUnsub(funcId) {
        this.getFeb().unSubscribe(funcId);
    }
    /**
     * 获取某菜单的实体参数结构
     * @param {?} funcId
     * @return {?}
     */
    getEntityParamStructure(funcId) {
        return this.getFuncInvok(funcId).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        v => {
            if (v.invokingConfig.entityParams) {
                return JSON.parse(v.invokingConfig.entityParams);
            }
        })));
    }
    /**
     * @private
     * @param {?} staticParam
     * @param {?} entityParam
     * @return {?}
     */
    mergeParams(staticParam, entityParam) {
        /** @type {?} */
        const paraMap = new Map();
        if (entityParam) {
            entityParam.forEach((/**
             * @param {?} item
             * @return {?}
             */
            (item) => {
                paraMap.set(item.name, item.value);
            }));
        }
        if (staticParam) {
            // func上对app参数复用
            staticParam.forEach((/**
             * @param {?} item
             * @return {?}
             */
            (item) => {
                paraMap.set(item.name, item.value);
            }));
        }
        return paraMap;
    }
    /**
     * @private
     * @param {?} funcId
     * @return {?}
     */
    getInvokConfig(funcId) {
        /** @type {?} */
        const url = `/api/runtime/sys/v1.0/functions/funcInvok/${funcId}`;
        return this.http.request('Get', url, FrmUtil.setHeader(null, {}));
    }
    /**
     * @private
     * @return {?}
     */
    getInvokCache() {
        return this.funcService.getAllCachedFuncInvoks();
    }
    /**
     * 获取框架eventbus
     * @private
     * @return {?}
     */
    getFeb() {
        return EventUtil.getFrmEvent();
    }
    /**
     * 构造功能及session
     * (1912 funcSession移除后，接口不再提供)
     * @param {?} funcId
     * @param {?=} su
     * @return {?}
     */
    buildFuncSession(funcId, su) {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        const userSession = this.sessionSvc.getUserSessionId();
        /** @type {?} */
        const body = {
            token: userSession,
            funcId,
            action: 'enter'
        };
        /** @type {?} */
        const bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : `?su=${su}`);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(userSession, { body })).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        (v) => {
            /** @type {?} */
            const ss = v.sessionId;
            if (ss !== undefined && ss !== null && ss.length > 0) {
                self.sessionSvc.setFuncSessionId(funcId, ss);
            }
            return ss;
        })));
    }
    /**
     * 进入功能，触发服务端逻辑
     * 移除funcSession
     * 返回公共变量token
     * @private
     * @param {?} enterParam
     * @param {?} su
     * @return {?}
     */
    enterFunc(enterParam, su) {
        /** @type {?} */
        const bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : `?su=${su}`);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(null, { body: enterParam }))
            .pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        (v) => {
            return v.token || v.sessionId;
        })));
    }
    /**
     * 退出功能，如果存在bizContext，则移除
     * @private
     * @param {?} options
     * @param {?} su
     * @return {?}
     */
    quitFunc(options, su) {
        /** @type {?} */
        const body = {
            token: options.token,
            tabId: options.tabId,
            funcId: options.funcId,
            action: 'quit'
        };
        /** @type {?} */
        const bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : `?su=${su}`);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(null, { body }));
    }
    /**
     * 获取当前应用所属su
     * @private
     * @param {?} url
     * @return {?}
     */
    getSu(url) {
        /** @type {?} */
        const uriArr = url.split('/');
        return uriArr.length > 3 ? uriArr[3] : '';
    }
    /**
     * iframe url拼接 querystring 参数
     * @private
     * @param {?} routurl
     * @param {?} funcId
     * @param {?} params
     * @return {?}
     */
    buildQueryString(routurl, funcId, params) {
        if (routurl.indexOf('?') < 0) {
            routurl += `?funcId=${funcId}`;
        }
        else {
            routurl += `&funcId=${funcId}`;
        }
        if (params) {
            Object.keys(params).forEach((/**
             * @param {?} propName
             * @param {?} index
             * @return {?}
             */
            (propName, index) => {
                routurl += `${index === 0 ? '' : '&'}${propName}=${params[propName]}`;
            }));
        }
        return routurl;
    }
    /**
     * url 拼接map格式的参数
     * @private
     * @param {?} routurl
     * @param {?} funcId
     * @param {?} tabId
     * @param {?} token
     * @param {?} params
     * @return {?}
     */
    buildQueryStringByMap(routurl, funcId, tabId, token, params) {
        if (routurl.indexOf('?') < 0) {
            routurl += `?funcId=${funcId}`;
        }
        else {
            routurl += `&funcId=${funcId}`;
        }
        routurl += `&appType=${AppType.Menu}`;
        routurl += `&tabId=${this.getPageId(funcId, tabId)}`;
        routurl += !token ? '' : `&cvft=${token}`;
        if (params) {
            params.forEach((/**
             * @param {?} value
             * @param {?} key
             * @return {?}
             */
            (value, key) => {
                routurl += !key ? '' : `&${key}=${value}`;
            }));
        }
        return routurl;
    }
    /**
     * 获取当前菜单页面的唯一标识
     * @private
     * @param {?} funcId
     * @param {?} tabId
     * @return {?}
     */
    getPageId(funcId, tabId) {
        return tabId || funcId;
    }
    /**
     * 页面第一次被打开时，生成唯一标识
     * @private
     * @param {?} funcId
     * @param {?} tabId
     * @return {?}
     */
    newPageId(funcId, tabId) {
        return tabId ? `${funcId}_${tabId}` : funcId;
    }
    /**
     * @param {?} token
     * @param {?} args
     * @return {?}
     */
    eventFire(token, args) {
        /** @type {?} */
        const feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.post !== 'function') {
            return;
        }
        feb.post(token, args);
    }
    /**
     * @param {?} token
     * @param {?} handler
     * @param {?=} options
     * @return {?}
     */
    eventListner(token, handler, options) {
        /** @type {?} */
        const feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.on !== 'function') {
            return;
        }
        // 菜单监听者必须要声明自己的身份，方便框架管理
        if (options && options.appType) {
            switch (options.appType.toLowerCase()) {
                case AppType.App:
                    /** @type {?} */
                    const appObkey = EventUtil.appObsToken(options.appId, options.appEntrance, options.tabId);
                    feb.onWithObkey(token, appObkey, handler);
                    return;
                case AppType.Menu:
                    /** @type {?} */
                    const funcObkey = EventUtil.funcObsToken(options.funcId, options.tabId);
                    feb.onWithObkey(token, funcObkey, handler);
                    return;
                default: break;
            }
        }
        feb.on(token, handler);
    }
    /**
     * 创建监听订阅, 维护一个监听者列表，针对菜单触发事件
     * @param {?} token
     * @param {?} funcId
     * @param {?} handler
     * @return {?}
     */
    eventListner4Func(token, funcId, handler) {
        /** @type {?} */
        const feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.on !== 'function') {
            return;
        }
        feb.onWithObkey(token, funcId, handler);
    }
    /**
     * 创建监听订阅, 维护一个监听者列表，针对应用触发事件
     * @param {?} token
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} handler
     * @return {?}
     */
    eventListner4App(token, appId, appEntrance, handler) {
        /** @type {?} */
        const feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.on !== 'function') {
            return;
        }
        /** @type {?} */
        const appObkey = EventUtil.appObsToken(appId, appEntrance);
        feb.onWithObkey(token, appObkey, handler);
    }
}
FrameworkService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FrameworkService.ctorParameters = () => [
    { type: HttpService },
    { type: Router },
    { type: CacheService },
    { type: SessionService },
    { type: FrmEventBus },
    { type: FuncsService },
    { type: LoadingService },
    { type: AppService, decorators: [{ type: Optional }] },
    { type: FrmI18nSettingService, decorators: [{ type: Optional }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.FUNCSTATUS_PATH;
    /** @type {?} */
    FrameworkService.prototype.BeforeFuncClose;
    /** @type {?} */
    FrameworkService.prototype.FuncClosed;
    /** @type {?} */
    FrameworkService.prototype.FuncSwitch;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.router;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.cache;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.sessionSvc;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.feb;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.funcService;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.loadService;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.appService;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.i18nSetting;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWV3b3Jrc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3J0Zi1jb21tb24vIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZnJtc2VydmljZS9mcmFtZXdvcmtzZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFekMsT0FBTyxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQWMsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakcsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUE2QyxNQUFNLHVCQUF1QixDQUFDO0FBQy9HLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUM1RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUc1RixNQUFNLE9BQU8sZ0JBQWdCOzs7Ozs7Ozs7Ozs7SUFPekIsWUFDWSxJQUFpQixFQUNqQixNQUFjLEVBQ2QsS0FBbUIsRUFDbkIsVUFBMEIsRUFDMUIsR0FBZ0IsRUFDaEIs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QzlGLEdBQUcsR0FBRyxTQUFTLENBQUMsV0FBVyxFQUFFO1FBQ25DLElBQUksQ0FBQyxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsRUFBRSxLQUFLLFVBQVUsRUFBRTtZQUN0QyxPQUFPO1NBQ1Y7O2NBQ0ssUUFBUSxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQztRQUMxRCxHQUFHLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDOUMsQ0FBQzs7O1lBdnRCSixVQUFVOzs7O1lBTlksV0FBVztZQVJ6QixNQUFNO1lBUU4sWUFBWTtZQUFnQyxjQUFjO1lBTDFELFdBQVc7WUFFWCxZQUFZO1lBRFosY0FBYztZQU1kLFVBQVUsdUJBb0JWLFFBQVE7WUFuQlIscUJBQXFCLHVCQW9CckIsUUFBUTs7Ozs7OztJQWRiLDJDQUFrRTs7SUFDbEUsMkNBQXFEOztJQUNyRCxzQ0FBMEM7O0lBQzFDLHNDQUEwQzs7Ozs7SUFHdEMsZ0NBQXlCOzs7OztJQUN6QixrQ0FBc0I7Ozs7O0lBQ3RCLGlDQUEyQjs7Ozs7SUFDM0Isc0NBQWtDOzs7OztJQUNsQywrQkFBd0I7Ozs7O0lBQ3hCLHVDQUFpQzs7Ozs7SUFDakMsdUNBQW1DOzs7OztJQUNuQyxzQ0FBMEM7Ozs7O0lBQzFDLHVDQUFzRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IE9wZW5mdW5jT3B0aW9ucyB9IGZyb20gJy4uLy4uL21vZGVscy9mdW5jdGlvbi5tb2RlbCc7XHJcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEZybUV2ZW50QnVzIH0gZnJvbSAnLi4vLi4vZXZlbnRidXMvZnJtLWV2ZW5idXMnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJy4uL2xvYWRpbmcvbG9hZGluZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRnVuY3NTZXJ2aWNlIH0gZnJvbSAnLi4vZnVuY3NzZXJ2aWNlL2Z1bmNzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJZnJhbWVMaW5rIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2lmcmFtZS5tb2RlbCc7XHJcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwLCBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBDYWNoZVNlcnZpY2UsIEh0dHBTZXJ2aWNlLCBMYW5ndWFnZVNlcnZpY2UsIFNlc3Npb25TZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IEV2ZW50VXRpbCwgRnJtVXRpbCwgQXBwVHlwZSwgRnVuY0V2ZW50QXJncywgQXBwT3B0aW9ucywgRnVuY1N0YXRlUGFyYW0gfSBmcm9tICcuLi8uLi9zaGFyZWQvZnJtLXV0aWwnO1xyXG5pbXBvcnQgeyBBcHBTZXJ2aWNlIH0gZnJvbSAnLi4vYXBwc2VydmljZS9hcHAuc2VydmljZSc7XHJcbmltcG9ydCB7IEZybUkxOG5TZXR0aW5nU2VydmljZSB9IGZyb20gJy4uL2kxOG5TZXJ2aWNlL2kxOG4tc2V0dGluZy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRnJhbWV3b3JrVmFyaWFibGVTZXJ2aWNlIH0gZnJvbSAnLi4vZnJtVmFyaWFibGVTZXJ2aWNlL2ZyYW1ld29yay12YXJpYWJsZS5zZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZyYW1ld29ya1NlcnZpY2Uge1xyXG5cclxuICAgIHByaXZhdGUgRlVOQ1NUQVRVU19QQVRIID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9mdW5jdGlvbi1zdGF0ZXMnO1xyXG4gICAgcHVibGljIEJlZm9yZUZ1bmNDbG9zZSA9IEV2ZW50VXRpbC5CRUZPUkVfRlVOQ19DTE9TRTtcclxuICAgIHB1YmxpYyBGdW5jQ2xvc2VkID0gRXZlbnRVdGlsLkZVTkNfQ0xPU0VEO1xyXG4gICAgcHVibGljIEZ1bmNTd2l0Y2ggPSBFdmVudFV0aWwuRlVOQ19TV0lUQ0g7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxyXG4gICAgICAgIHByaXZhdGUgY2FjaGU6IENhY2hlU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHNlc3Npb25TdmM6IFNlc3Npb25TZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgZmViOiBGcm1FdmVudEJ1cyxcclxuICAgICAgICBwcml2YXRlIGZ1bmNTZXJ2aWNlOiBGdW5jc1NlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBsb2FkU2VydmljZTogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBhcHBTZXJ2aWNlOiBBcHBTZXJ2aWNlLFxyXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgaTE4blNldHRpbmc6IEZybUkxOG5TZXR0aW5nU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmkxOG5TZXR0aW5nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlcyA9IG5ldyBGcmFtZXdvcmtWYXJpYWJsZVNlcnZpY2UoKTtcclxuICAgICAgICAgICAgY29uc3QgbGFuZ3VhZ2UgPSBuZXcgTGFuZ3VhZ2VTZXJ2aWNlKG51bGwpO1xyXG4gICAgICAgICAgICB0aGlzLmkxOG5TZXR0aW5nID0gbmV3IEZybUkxOG5TZXR0aW5nU2VydmljZSh2YXJpYWJsZXMsIGxhbmd1YWdlLCBodHRwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmFwcFNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHBTZXJ2aWNlID0gbmV3IEFwcFNlcnZpY2UodGhpcy5odHRwLCB0aGlzLnNlc3Npb25TdmMsIHRoaXMuaTE4blNldHRpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNrmZ1bmNpZOaJk+W8gOWKn+iDveiPnOWNlVxyXG4gICAgICogKOmAgueUqOS6juWNlemhteetvui3r+eUse+8jOS4jeaUr+aMgU5HN+WNh+e6p+WQjuiPnOWNleS5i+mXtOi3s+i9rClcclxuICAgICAqL1xyXG4gICAgb3BlbkZ1bmMoZnVuY2lkOiBzdHJpbmcsIHJvdXRlcGF0aDogc3RyaW5nLCBwYXJlbnRzZXNzaW9uaWQ6IHN0cmluZywgbmV3c2Vzc2lvbjogYm9vbGVhbiA9IHRydWUsIHNpbXBsZXBhcmFtOiBzdHJpbmcgPSAnJyk6IGFueSB7XHJcblxyXG4gICAgICAgIGNvbnN0IGFwcE9wczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxyXG4gICAgICAgICAgICBmdW5jSWQ6IGZ1bmNpZCxcclxuICAgICAgICAgICAgYXBwSWQ6ICcnLFxyXG4gICAgICAgICAgICBhcHBFbnRyYW5jZTogJydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmludGVybmFsT3BlbihhcHBPcHMpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAvLyByZXR1cm4gdGhpcy5pbnRlcm5hbE9wZW4kKGFwcE9wcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnm7TmjqXmiZPlvIDlip/og71cclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5NZW51KG9wdGlvbnM6IEFwcE9wdGlvbnMpIHtcclxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuYXBwVHlwZSAmJiBvcHRpb25zLmFwcFR5cGUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICBjYXNlIEFwcFR5cGUuQXBwOlxyXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmFwcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCflj4LmlbBhcHBJZOS4jeiDveS4uuepuu+8gScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwU2VydmljZS5vcGVuQXBwQnlPcHRpb25zKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5NZW51OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcm5hbE9wZW4ob3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLk90aGVyOiBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgJrov4fmtYHmlrnlvI/miZPlvIDlip/og71cclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5NZW51JChvcHRpb25zOiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLmFwcFR5cGUgJiYgb3B0aW9ucy5hcHBUeXBlLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLkFwcDpcclxuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5hcHBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgn5Y+C5pWwYXBwSWTkuI3og73kuLrnqbrvvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hcHBTZXJ2aWNlLm9wZW5BcHBCeU9wdGlvbnMkKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBjYXNlIEFwcFR5cGUuTWVudTpcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm9ubHlHZXRJZnJhbWVMaW5rID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxPcGVuQnlJZnJhbWVMaW5rJChvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmludGVybmFsT3BlbiQob3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5PdGhlcjogYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5omT5byA6IGU5p+l6I+c5Y2VXHJcbiAgICAgKi9cclxuICAgIG9wZW5Db25uZWN0ZWRGdW5jKGZ1bmNJZDogc3RyaW5nLCBvcHRpb25zOiBPcGVuZnVuY09wdGlvbnMpIHtcclxuICAgICAgICBjb25zdCBhcHBPcHM6IEFwcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcclxuICAgICAgICAgICAgZnVuY0lkLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgICAgZW50aXR5UGFyYW1zOiBvcHRpb25zLkVudGl0eVBhcmFtLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcGVuKGFwcE9wcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiZPlvIDogZTmn6Xoj5zljZXvvIzlubbkvKDlj4JcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5GdW5jV2l0aFBhcmFtKGZ1bmNJZDogc3RyaW5nLCBwYXJhbXM6IE1hcDxzdHJpbmcsIHN0cmluZz4sIHJlbG9hZD86IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXHJcbiAgICAgICAgICAgIGZ1bmNJZCxcclxuICAgICAgICAgICAgYXBwSWQ6ICcnLFxyXG4gICAgICAgICAgICBhcHBFbnRyYW5jZTogJycsXHJcbiAgICAgICAgICAgIGVudGl0eVBhcmFtczogcGFyYW1zLFxyXG4gICAgICAgICAgICBxdWVyeVN0cmluZ1BhcmFtczogcGFyYW1zLFxyXG4gICAgICAgICAgICBpc1JlbG9hZDogcmVsb2FkXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmludGVybmFsT3BlbihvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJk+W8gOWKn+iDve+8jOS4jei/lOWbnua1gVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGludGVybmFsT3BlbihvcHRpb25zOiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja2luZ0JlZm9yZU9wZW4kKG9wdGlvbnMpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzIHx8ICFyZXMuZnVuYyB8fCByZXMubGlua29iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSByZXMuZnVuYztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEludm9rZUFuZEVudGVyRnVuYyQob3B0aW9ucywgZnVuYykuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAobG9iajogSWZyYW1lTGluaykgPT4gdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GQVJSSVNfQVBQX0NMSUNLLCBsb2JqKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNFcnI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJySW5mbzogZXJyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GQVJSSVNfQVBQX0NMSUNLLCBpbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgJrov4fkuLLmtYHmjqfliLbvvIzmiZPlvIDoj5zljZVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpbnRlcm5hbE9wZW4kKG9wdGlvbnM6IEFwcE9wdGlvbnMpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNraW5nQmVmb3JlT3BlbiQob3B0aW9ucylcclxuICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXMgfHwgIXJlcy5mdW5jIHx8IHJlcy5saW5rb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnVuYyA9IHJlcy5mdW5jO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnZva2VBbmRFbnRlckZ1bmMkKG9wdGlvbnMsIGZ1bmMpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGxvYmo6IElmcmFtZUxpbmspID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GQVJSSVNfQVBQX0NMSUNLLCBsb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmui/h+S4sua1geiOt+WPluiiq+aJk+W8gOiPnOWNleeahGlmcmFtZUxpbmvlr7nosaHkv6Hmga9cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpbnRlcm5hbE9wZW5CeUlmcmFtZUxpbmskKG9wdGlvbnM6IEFwcE9wdGlvbnMpOiBPYnNlcnZhYmxlPElmcmFtZUxpbms+IHtcclxuXHJcbiAgICAgICAgaWYgKCFvcHRpb25zLmZ1bmNJZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ+WPguaVsGZ1bmNJZOS4jeiDveS4uuepuu+8gScpO1xyXG4gICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGdW5jRW50aXR5KG9wdGlvbnMuZnVuY0lkKS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgICAgICBmdW5jID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWZ1bmMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KGDor7fnoa7orqTmgqjmmK/lkKblhbflpIfmiZPlvIDoj5zljZUoSUQ6JHtvcHRpb25zLmZ1bmNJZH0p55qE5p2D6ZmQYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnZva2VBbmRFbnRlckZ1bmMkKG9wdGlvbnMsIGZ1bmMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEludm9rZUFuZEVudGVyRnVuYyQob3B0aW9uczogQXBwT3B0aW9ucywgZnVuYzogYW55KTogT2JzZXJ2YWJsZTxJZnJhbWVMaW5rPiB7XHJcbiAgICAgICAgY29uc3QgbmV3UGFnZUlkID0gdGhpcy5uZXdQYWdlSWQob3B0aW9ucy5mdW5jSWQsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgIG9wdGlvbnMudGFiSWQgPSBuZXdQYWdlSWQ7XHJcbiAgICAgICAgbGV0IGxpbmtvYmo6IElmcmFtZUxpbms7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnVuY0ludm9rKG9wdGlvbnMuZnVuY0lkKS5waXBlKFxyXG4gICAgICAgICAgICBzd2l0Y2hNYXAoXHJcbiAgICAgICAgICAgICAgICBmdW5jSW52b2sgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByb3V0dXJsID0gZnVuY0ludm9rLmludm9raW5nQ29uZmlnLnVybDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbUluZm8gPSBmdW5jSW52b2suaW52b2tpbmdDb25maWcuc3RhdGljUGFyYW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eVBhcmFtSW5mbyA9IGZ1bmNJbnZvay5pbnZva2luZ0NvbmZpZy5lbnRpdHlQYXJhbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdGljUGFyYW0gPSBwYXJhbUluZm8gPyBKU09OLnBhcnNlKHBhcmFtSW5mbykgOiAnJztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHlQYXJhbSA9IGVudGl0eVBhcmFtSW5mbyA/IEpTT04ucGFyc2UoZW50aXR5UGFyYW1JbmZvKSA6ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdSA9IHRoaXMuZ2V0U3Uocm91dHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW50ZXJGdW5jKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFiSWQ6IG5ld1BhZ2VJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY0lkOiBvcHRpb25zLmZ1bmNJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVudU5hbWU6IG9wdGlvbnMudGFiTmFtZSB8fCBmdW5jLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2VudGVyJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIHN1KS5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtVG9rZW4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmogPSBuZXcgSWZyYW1lTGluayhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYy5jb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkUXVlcnlTdHJpbmdCeU1hcChyb3V0dXJsLCBvcHRpb25zLmZ1bmNJZCwgb3B0aW9ucy50YWJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1Ub2tlbiwgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLmlkID0gbmV3UGFnZUlkOyAvLyDpobXpnaLllK/kuIDmoIfor4Yg5YWB6K646aG16Z2i6YeN5aSN5omT5byAXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5hcHBUeXBlID0gQXBwVHlwZS5NZW51O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouZnVuY0lkID0gb3B0aW9ucy5mdW5jSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5GdW5jTmFtZSA9IG9wdGlvbnMudGFiTmFtZSB8fCBmdW5jLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai51cmwgPSBmdW5jSW52b2suaW52b2tpbmdDb25maWcudXJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmoucmVsb2FkID0gb3B0aW9ucy5pc1JlbG9hZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLnN1ID0gc3U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5pc05ld1RhYiA9IG9wdGlvbnMuaXNOZXdUYWI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5mb3JtVG9rZW4gPSBmb3JtVG9rZW47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0aWNQYXJhbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBka3nnibnmrorlnLrmma/vvIzmiZPlvIBqcXVlcnnljp/nlJ/lip/og71cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljUGFyYW0uZm9yRWFjaChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm5hbWUgPT09ICdqcXVlcnknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouaXNqcXVlcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5uYW1lID09PSAnbW9kZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5tb2RlID0gaXRlbS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5zcmMgKz0gKGl0ZW0udmFsdWUgPyBgJmFwcE1vZGU9JHtpdGVtLnZhbHVlfSZgIDogJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5aSn5a+56LGh5a6e5L2T5Lyg5Y+C77yM6ZKI5a+56KKr5omT5byA6aG16Z2i5bu656uL5ZSv5LiA566h6YGTXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KG5ld1BhZ2VJZCwgb3B0aW9ucy5lbnRpdHlQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuRkFSUklTX0FQUF9DTElDSywgbGlua29iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmtvYmo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1MaW5rID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuU2V0dGluZy5nZXRTZXR0aW5nJCgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IGZvcm1MaW5rXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmtYHmlrnlvI/mo4Dmn6Xoj5zljZXmiZPlvIDnirbmgIFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjaGVja2luZ0JlZm9yZU9wZW4kKG9wdGlvbnM6IEFwcE9wdGlvbnMpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGlmICghb3B0aW9ucy5mdW5jSWQpIHtcclxuICAgICAgICAgICAgd2luZG93LmFsZXJ0KCflj4LmlbBmdW5jSWTkuI3og73kuLrnqbrvvIEnKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnVuY0VudGl0eShvcHRpb25zLmZ1bmNJZCkucGlwZShtYXAoXHJcbiAgICAgICAgICAgIGZ1bmMgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFmdW5jKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KGDor7fnoa7orqTmgqjmmK/lkKblhbflpIfmiZPlvIDoj5zljZUoSUQ6JHtvcHRpb25zLmZ1bmNJZH0p55qE5p2D6ZmQYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgZnVuY0lkID0gb3B0aW9ucy5mdW5jSWQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0YWJJZCA9IG9wdGlvbnMudGFiSWQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYWdlSWQgPSB0aGlzLmdldFBhZ2VJZChmdW5jSWQsIHRhYklkKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtvYmogPSBGcm1VdGlsLmdldFRhYkFycmF5KCkuZmluZChpID0+IGkuaWQgPT09IHBhZ2VJZCAmJiBpLmFwcFR5cGUgPT09IEFwcFR5cGUuTWVudSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGxpbmtvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLkZ1bmNOYW1lID0gb3B0aW9ucy50YWJOYW1lIHx8IGxpbmtvYmouRnVuY05hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlua29iai5zcmMgPSB0aGlzLmJ1aWxkUXVlcnlTdHJpbmdCeU1hcChsaW5rb2JqLnVybCwgZnVuY0lkLCBvcHRpb25zLnRhYklkLCAnJywgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlua29iai5yZWxvYWQgPSBvcHRpb25zLmlzUmVsb2FkOyAvLyDnlYzpnaLliLfmlrDkuI3mlLlzZXNzaW9uXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KHBhZ2VJZCwgb3B0aW9ucy5lbnRpdHlQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuRkFSUklTX0FQUF9DTElDSywgbGlua29iaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyBmdW5jLCBsaW5rb2JqIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFs+mXreWJjVxyXG4gICAgICovXHJcbiAgICBiZWZvcmVDbG9zZU1lbnUob3B0aW9uczogQXBwT3B0aW9ucykge1xyXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5hcHBUeXBlICYmIG9wdGlvbnMuYXBwVHlwZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5BcHA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcFNlcnZpY2UuYmVmb3JlQ2xvc2VBcHBCeU9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLk1lbnU6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJlZm9yZUNsb3NlRnVuY0J5T3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiZWZvcmVDbG9zZUZ1bmNCeU9wdGlvbnMob3B0aW9uczogQXBwT3B0aW9ucykge1xyXG4gICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLmZ1bmNTZXJ2aWNlLmdldENhY2hlZEZ1bmMob3B0aW9ucy5mdW5jSWQpO1xyXG4gICAgICAgIGNvbnN0IGZ1bmNPYmtleSA9IEV2ZW50VXRpbC5mdW5jT2JzVG9rZW4ob3B0aW9ucy5mdW5jSWQsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgIGNvbnN0IHBhZ2VJZCA9IHRoaXMuZ2V0UGFnZUlkKG9wdGlvbnMuZnVuY0lkLCBvcHRpb25zLnRhYklkKTtcclxuXHJcbiAgICAgICAgY29uc3Qgb2JzID0gRXZlbnRVdGlsLmdldE9ic2VydmVyKEV2ZW50VXRpbC5CRUZPUkVfRlVOQ19DTE9TRSkuZ2V0KGZ1bmNPYmtleSk7XHJcbiAgICAgICAgaWYgKCFvYnMpIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUZ1bmNCeU9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGV2ZW50QXJnczogRnVuY0V2ZW50QXJncyA9IHtcclxuICAgICAgICAgICAgdGFiSWQ6IHBhZ2VJZCxcclxuICAgICAgICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxyXG4gICAgICAgICAgICBmdW5jSWQ6IG9wdGlvbnMuZnVuY0lkLFxyXG4gICAgICAgICAgICB0YWJOYW1lOiBmdW5jICYmIGZ1bmMuTmFtZSxcclxuICAgICAgICAgICAgYmVmb3JlQ2xvc2VIYW5kbGU6IG9wdGlvbnMuYmVmb3JlQ2xvc2VIYW5kbGVcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuQkVGT1JFX0ZVTkNfQ0xPU0UsIGV2ZW50QXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDoj5zljZXlhbPpl63liY3kuovku7bop6blj5Eo5pegIHRva2VuKVxyXG4gICAgICovXHJcbiAgICBiZWZvcmVDbG9zZUZ1bmMoZnVuY0lkOiBzdHJpbmcsIHRhYklkPzogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuZnVuY1NlcnZpY2UuZ2V0Q2FjaGVkRnVuYyhmdW5jSWQpO1xyXG4gICAgICAgIGNvbnN0IGZ1bmNPYmtleSA9IEV2ZW50VXRpbC5mdW5jT2JzVG9rZW4oZnVuY0lkLCB0YWJJZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9icyA9IEV2ZW50VXRpbC5nZXRPYnNlcnZlcihFdmVudFV0aWwuQkVGT1JFX0ZVTkNfQ0xPU0UpLmdldChmdW5jT2JrZXkpO1xyXG4gICAgICAgIGlmICghb2JzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VGdW5jKGZ1bmNJZCwgdGFiSWQpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBldmVudEFyZ3M6IEZ1bmNFdmVudEFyZ3MgPSB7XHJcbiAgICAgICAgICAgIHRhYklkOiB0aGlzLmdldFBhZ2VJZChmdW5jSWQsIHRhYklkKSxcclxuICAgICAgICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxyXG4gICAgICAgICAgICBmdW5jSWQsXHJcbiAgICAgICAgICAgIHRhYk5hbWU6IGZ1bmMgJiYgZnVuYy5OYW1lXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkJFRk9SRV9GVU5DX0NMT1NFLCBldmVudEFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55u05o6l5YWz6ZetXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBjbG9zZU1lbnUob3B0aW9uczogQXBwT3B0aW9ucykge1xyXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5hcHBUeXBlICYmIG9wdGlvbnMuYXBwVHlwZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5BcHA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcFNlcnZpY2UuY2xvc2VBcHBCeU9wdGlvbnMob3B0aW9ucykuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLk1lbnU6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRnVuY0J5T3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjbG9zZUZ1bmNCeU9wdGlvbnMob3B0aW9uczogQXBwT3B0aW9ucykge1xyXG4gICAgICAgIGNvbnN0IHBhZ2VJZCA9IHRoaXMuZ2V0UGFnZUlkKG9wdGlvbnMuZnVuY0lkLCBvcHRpb25zLnRhYklkKTtcclxuICAgICAgICBFdmVudFV0aWwuY2xlYXJPYnNlcnZlcihFdmVudFV0aWwuZnVuY09ic1Rva2VuKG9wdGlvbnMuZnVuY0lkLCBvcHRpb25zLnRhYklkKSk7XHJcbiAgICAgICAgRXZlbnRVdGlsLmNsZWFyRXZlbnRQaXBlKHBhZ2VJZCk7IC8vIOW9k+WJjemhtemdouWkp+WvueixoeS8oOWPguS8muacieWUr+S4gOeahOeuoemBk1xyXG4gICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLmZ1bmNTZXJ2aWNlLmdldENhY2hlZEZ1bmMob3B0aW9ucy5mdW5jSWQpO1xyXG4gICAgICAgIGNvbnN0IG9iakluZGV4ID0gRnJtVXRpbC5nZXRUYWJBcnJheSgpLmZpbmRJbmRleChpID0+IGkuaWQgPT09IHBhZ2VJZCAmJiBpLmFwcFR5cGUgPT09IEFwcFR5cGUuTWVudSk7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gRnJtVXRpbC5nZXRUYWJBcnJheSgpW29iakluZGV4XTtcclxuICAgICAgICBvcHRpb25zLnRva2VuID0gb3B0aW9ucy50b2tlbiB8fCBvYmouZm9ybVRva2VuO1xyXG4gICAgICAgIGxldCBzdSA9IG9wdGlvbnMuc3U7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICBzdSA9IG9iai5zdTtcclxuICAgICAgICAgICAgRnJtVXRpbC5yZW1vdmVUYWIob2JqSW5kZXgpO1xyXG4gICAgICAgICAgICBjb25zdCBldmVudEFyZ3M6IEZ1bmNFdmVudEFyZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICB0YWJJZDogcGFnZUlkLFxyXG4gICAgICAgICAgICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxyXG4gICAgICAgICAgICAgICAgZnVuY0lkOiBvcHRpb25zLmZ1bmNJZCxcclxuICAgICAgICAgICAgICAgIHRhYk5hbWU6IGZ1bmMgJiYgZnVuYy5uYW1lXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuRlVOQ19DTE9TRUQsIGV2ZW50QXJncyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucXVpdEZ1bmMob3B0aW9ucywgc3UpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4geyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFs+mXreiPnOWNlXRhYumhteetvu+8jHRhYklk5Y+v5Lul5oyH5a6a77yM6buY6K6k5Li6ZnVuY0lkXHJcbiAgICAgKi9cclxuICAgIGNsb3NlRnVuYyhmdW5jSWQ6IHN0cmluZywgdGFiSWQ/OiBzdHJpbmcpOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHBhZ2VJZCA9IHRoaXMuZ2V0UGFnZUlkKGZ1bmNJZCwgdGFiSWQpO1xyXG4gICAgICAgIEV2ZW50VXRpbC5jbGVhck9ic2VydmVyKEV2ZW50VXRpbC5mdW5jT2JzVG9rZW4oZnVuY0lkLCB0YWJJZCkpO1xyXG4gICAgICAgIEV2ZW50VXRpbC5jbGVhckV2ZW50UGlwZShwYWdlSWQpOyAvLyDlvZPliY3pobXpnaLlpKflr7nosaHkvKDlj4LkvJrmnInllK/kuIDnmoTnrqHpgZNcclxuICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5mdW5jU2VydmljZS5nZXRDYWNoZWRGdW5jKGZ1bmNJZCk7XHJcbiAgICAgICAgY29uc3Qgb2JqSW5kZXggPSBGcm1VdGlsLmdldFRhYkFycmF5KCkuZmluZEluZGV4KGkgPT4gaS5pZCA9PT0gcGFnZUlkICYmIGkuYXBwVHlwZSA9PT0gQXBwVHlwZS5NZW51KTtcclxuICAgICAgICBjb25zdCBvYmogPSBGcm1VdGlsLmdldFRhYkFycmF5KClbb2JqSW5kZXhdO1xyXG4gICAgICAgIGNvbnN0IGZvcm1Ub2tlbiA9IG9iai5mb3JtVG9rZW47XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICBGcm1VdGlsLnJlbW92ZVRhYihvYmpJbmRleCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50QXJnczogRnVuY0V2ZW50QXJncyA9IHtcclxuICAgICAgICAgICAgICAgIHRhYklkOiBwYWdlSWQsXHJcbiAgICAgICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXHJcbiAgICAgICAgICAgICAgICBmdW5jSWQsXHJcbiAgICAgICAgICAgICAgICB0YWJOYW1lOiBmdW5jICYmIGZ1bmMubmFtZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBzZWxmLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZVTkNfQ0xPU0VELCBldmVudEFyZ3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgdGFiSWQsXHJcbiAgICAgICAgICAgIGZ1bmNJZCxcclxuICAgICAgICAgICAgYXBwSWQ6ICcnLFxyXG4gICAgICAgICAgICBhcHBFbnRyYW5jZTogJycsXHJcbiAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcclxuICAgICAgICAgICAgdG9rZW46IGZvcm1Ub2tlbixcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMucXVpdEZ1bmMob3B0aW9ucywgb2JqLnN1KVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHsgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5boj5zljZXnmoTosIPnlKjkv6Hmga9cclxuICAgICAqL1xyXG4gICAgZ2V0RnVuY0ludm9rKGZ1bmNJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBpbnZva3MgPSB0aGlzLmdldEludm9rQ2FjaGUoKTtcclxuICAgICAgICBjb25zdCBmdW5jSW52b2sgPSBpbnZva3MuZmluZChmID0+IGYuaWQgPT09IGZ1bmNJZCk7XHJcbiAgICAgICAgaWYgKCFmdW5jSW52b2spIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW52b2tDb25maWcoZnVuY0lkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgbWFwKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaW52b2tzLnB1c2godik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW5jU2VydmljZS5jYWNoZUFsbEZ1bmNJbnZva3MoaW52b2tzKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdjtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZihmdW5jSW52b2spO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6I+c5Y2V5a6e5L2TXHJcbiAgICAgKi9cclxuICAgIGdldEZ1bmNFbnRpdHkoZnVuY0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLmZ1bmNTZXJ2aWNlLmdldENhY2hlZEZ1bmMoZnVuY0lkKTtcclxuICAgICAgICBpZiAoIWZ1bmMpIHtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gYC9hcGkvcnVudGltZS9zeXMvdjEuMC9mdW5jdGlvbnMvJHtmdW5jSWR9YDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdHZXQnLCB1cmwsIEZybVV0aWwuc2V0SGVhZGVyKG51bGwsIHt9KSlcclxuICAgICAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcCh2ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF2IHx8ICF2WzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxGdW5jcyA9IHRoaXMuZnVuY1NlcnZpY2UuZ2V0QWxsQ2FjaGVkRnVuY3MoKSBhcyBhbnlbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsRnVuY3MucHVzaCh2WzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdW5jU2VydmljZS5jYWNoZUFsbEZ1bmNzKGFsbEZ1bmNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZihmdW5jKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluiPnOWNlemihOe9ruWPguaVsFxyXG4gICAgICovXHJcbiAgICBnZXRQcmVzZXRQYXJhbXMoZnVuY0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEZ1bmNJbnZvayhmdW5jSWQpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcChmdW5jSW52b2sgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW1JbmZvID0gZnVuY0ludm9rLmludm9raW5nQ29uZmlnLnN0YXRpY1BhcmFtcztcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eVBhcmFtSW5mbyA9IGZ1bmNJbnZvay5pbnZva2luZ0NvbmZpZy5lbnRpdHlQYXJhbXM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0aWNQYXJhbSA9IHBhcmFtSW5mbyA/IEpTT04ucGFyc2UocGFyYW1JbmZvKSA6IFtdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW50aXR5UGFyYW0gPSBlbnRpdHlQYXJhbUluZm8gPyBKU09OLnBhcnNlKGVudGl0eVBhcmFtSW5mbykgOiBbXTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1lcmdlUGFyYW1zKHN0YXRpY1BhcmFtLCBlbnRpdHlQYXJhbSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluiPnOWNleeahOmdmeaAgeWPguaVsFxyXG4gICAgICovXHJcbiAgICBnZXRTdGF0aWNQYXJhbShmdW5jSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnVuY0ludm9rKGZ1bmNJZCkucGlwZShcclxuICAgICAgICAgICAgbWFwKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHYuaW52b2tpbmdDb25maWcuc3RhdGljUGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uodi5pbnZva2luZ0NvbmZpZy5zdGF0aWNQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5booajljZXnmoTlrp7kvZPlj4LmlbBcclxuICAgICAqL1xyXG4gICAgZ2V0RW50aXR5UGFyYW0odGFiSWQ6IHN0cmluZywgaGFuZGxlcjogKHZhbHVlOiBhbnkpID0+IHZvaWQsIGlzU3Vib25jZTogYm9vbGVhbiA9IHRydWUpOiBhbnkge1xyXG4gICAgICAgIGlmIChpc1N1Ym9uY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5vbmNlKHRhYklkLCBoYW5kbGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRGZWIoKS5vbih0YWJJZCwgaGFuZGxlcik7XHJcbiAgICB9XHJcblxyXG4gICAgZW50aXR5UGFyYW1VbnN1YihmdW5jSWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuZ2V0RmViKCkudW5TdWJzY3JpYmUoZnVuY0lkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluafkOiPnOWNleeahOWunuS9k+WPguaVsOe7k+aehFxyXG4gICAgICovXHJcbiAgICBnZXRFbnRpdHlQYXJhbVN0cnVjdHVyZShmdW5jSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnVuY0ludm9rKGZ1bmNJZCkucGlwZShcclxuICAgICAgICAgICAgbWFwKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHYuaW52b2tpbmdDb25maWcuZW50aXR5UGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uodi5pbnZva2luZ0NvbmZpZy5lbnRpdHlQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtZXJnZVBhcmFtcyhzdGF0aWNQYXJhbTogYW55W10sIGVudGl0eVBhcmFtOiBhbnlbXSk6IE1hcDxhbnksIGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHBhcmFNYXAgPSBuZXcgTWFwPGFueSwgYW55PigpO1xyXG4gICAgICAgIGlmIChlbnRpdHlQYXJhbSkge1xyXG4gICAgICAgICAgICBlbnRpdHlQYXJhbS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHBhcmFNYXAuc2V0KGl0ZW0ubmFtZSwgaXRlbS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc3RhdGljUGFyYW0pIHtcclxuICAgICAgICAgICAgLy8gZnVuY+S4iuWvuWFwcOWPguaVsOWkjeeUqFxyXG4gICAgICAgICAgICBzdGF0aWNQYXJhbS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHBhcmFNYXAuc2V0KGl0ZW0ubmFtZSwgaXRlbS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGFyYU1hcDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBnZXRJbnZva0NvbmZpZyhmdW5jSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHVybCA9IGAvYXBpL3J1bnRpbWUvc3lzL3YxLjAvZnVuY3Rpb25zL2Z1bmNJbnZvay8ke2Z1bmNJZH1gO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnR2V0JywgdXJsLCBGcm1VdGlsLnNldEhlYWRlcihudWxsLCB7fSkpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldEludm9rQ2FjaGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZnVuY1NlcnZpY2UuZ2V0QWxsQ2FjaGVkRnVuY0ludm9rcygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5qGG5p62ZXZlbnRidXNcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRGZWIoKTogRnJtRXZlbnRCdXMge1xyXG4gICAgICAgIHJldHVybiBFdmVudFV0aWwuZ2V0RnJtRXZlbnQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaehOmAoOWKn+iDveWPinNlc3Npb25cclxuICAgICAqICgxOTEyIGZ1bmNTZXNzaW9u56e76Zmk5ZCO77yM5o6l5Y+j5LiN5YaN5o+Q5L6bKVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYnVpbGRGdW5jU2Vzc2lvbihmdW5jSWQ6IHN0cmluZywgc3U/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHVzZXJTZXNzaW9uID0gdGhpcy5zZXNzaW9uU3ZjLmdldFVzZXJTZXNzaW9uSWQoKTtcclxuICAgICAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgICAgICB0b2tlbjogdXNlclNlc3Npb24sXHJcbiAgICAgICAgICAgIGZ1bmNJZCxcclxuICAgICAgICAgICAgYWN0aW9uOiAnZW50ZXInXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgYml6Q29udGV4dFVybCA9IHRoaXMuRlVOQ1NUQVRVU19QQVRIICsgKCFzdSA/ICcnIDogYD9zdT0ke3N1fWApO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnUG9zdCcsIGJpekNvbnRleHRVcmwsIEZybVV0aWwuc2V0SGVhZGVyKHVzZXJTZXNzaW9uLCB7IGJvZHkgfSkpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCgodjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzczogc3RyaW5nID0gdi5zZXNzaW9uSWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3MgIT09IHVuZGVmaW5lZCAmJiBzcyAhPT0gbnVsbCAmJiBzcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXNzaW9uU3ZjLnNldEZ1bmNTZXNzaW9uSWQoZnVuY0lkLCBzcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3M7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/m+WFpeWKn+iDve+8jOinpuWPkeacjeWKoeerr+mAu+i+kVxyXG4gICAgICog56e76ZmkZnVuY1Nlc3Npb25cclxuICAgICAqIOi/lOWbnuWFrOWFseWPmOmHj3Rva2VuXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZW50ZXJGdW5jKGVudGVyUGFyYW06IEZ1bmNTdGF0ZVBhcmFtLCBzdTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBiaXpDb250ZXh0VXJsID0gdGhpcy5GVU5DU1RBVFVTX1BBVEggKyAoIXN1ID8gJycgOiBgP3N1PSR7c3V9YCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdQb3N0JywgYml6Q29udGV4dFVybCwgRnJtVXRpbC5zZXRIZWFkZXIobnVsbCwgeyBib2R5OiBlbnRlclBhcmFtIH0pKVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIG1hcCgodjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHYudG9rZW4gfHwgdi5zZXNzaW9uSWQ7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCA5Ye65Yqf6IO977yM5aaC5p6c5a2Y5ZyoYml6Q29udGV4dO+8jOWImeenu+mZpFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHF1aXRGdW5jKG9wdGlvbnM6IEFwcE9wdGlvbnMsIHN1OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgICAgICAgIHRva2VuOiBvcHRpb25zLnRva2VuLFxyXG4gICAgICAgICAgICB0YWJJZDogb3B0aW9ucy50YWJJZCxcclxuICAgICAgICAgICAgZnVuY0lkOiBvcHRpb25zLmZ1bmNJZCxcclxuICAgICAgICAgICAgYWN0aW9uOiAncXVpdCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGJpekNvbnRleHRVcmwgPSB0aGlzLkZVTkNTVEFUVVNfUEFUSCArICghc3UgPyAnJyA6IGA/c3U9JHtzdX1gKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoJ1Bvc3QnLCBiaXpDb250ZXh0VXJsLCBGcm1VdGlsLnNldEhlYWRlcihudWxsLCB7IGJvZHkgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5b2T5YmN5bqU55So5omA5bGec3VcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRTdSh1cmw6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgdXJpQXJyID0gdXJsLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgcmV0dXJuIHVyaUFyci5sZW5ndGggPiAzID8gdXJpQXJyWzNdIDogJyc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpZnJhbWUgdXJs5ou85o6lIHF1ZXJ5c3RyaW5nIOWPguaVsFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGJ1aWxkUXVlcnlTdHJpbmcocm91dHVybDogc3RyaW5nLCBmdW5jSWQ6IHN0cmluZywgcGFyYW1zKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAocm91dHVybC5pbmRleE9mKCc/JykgPCAwKSB7XHJcbiAgICAgICAgICAgIHJvdXR1cmwgKz0gYD9mdW5jSWQ9JHtmdW5jSWR9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByb3V0dXJsICs9IGAmZnVuY0lkPSR7ZnVuY0lkfWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKChwcm9wTmFtZTogc3RyaW5nLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcm91dHVybCArPSBgJHtpbmRleCA9PT0gMCA/ICcnIDogJyYnfSR7cHJvcE5hbWV9PSR7cGFyYW1zW3Byb3BOYW1lXX1gO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJvdXR1cmw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB1cmwg5ou85o6lbWFw5qC85byP55qE5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYnVpbGRRdWVyeVN0cmluZ0J5TWFwKHJvdXR1cmw6IHN0cmluZywgZnVuY0lkOiBzdHJpbmcsIHRhYklkOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcsIHBhcmFtczogTWFwPHN0cmluZywgc3RyaW5nPik6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKHJvdXR1cmwuaW5kZXhPZignPycpIDwgMCkge1xyXG4gICAgICAgICAgICByb3V0dXJsICs9IGA/ZnVuY0lkPSR7ZnVuY0lkfWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcm91dHVybCArPSBgJmZ1bmNJZD0ke2Z1bmNJZH1gO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcm91dHVybCArPSBgJmFwcFR5cGU9JHtBcHBUeXBlLk1lbnV9YDtcclxuICAgICAgICByb3V0dXJsICs9IGAmdGFiSWQ9JHt0aGlzLmdldFBhZ2VJZChmdW5jSWQsIHRhYklkKX1gO1xyXG4gICAgICAgIHJvdXR1cmwgKz0gIXRva2VuID8gJycgOiBgJmN2ZnQ9JHt0b2tlbn1gO1xyXG4gICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgcGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJvdXR1cmwgKz0gIWtleSA/ICcnIDogYCYke2tleX09JHt2YWx1ZX1gO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJvdXR1cmw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blvZPliY3oj5zljZXpobXpnaLnmoTllK/kuIDmoIfor4ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRQYWdlSWQoZnVuY0lkOiBzdHJpbmcsIHRhYklkOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0YWJJZCB8fCBmdW5jSWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpobXpnaLnrKzkuIDmrKHooqvmiZPlvIDml7bvvIznlJ/miJDllK/kuIDmoIfor4ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBuZXdQYWdlSWQoZnVuY0lkOiBzdHJpbmcsIHRhYklkOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0YWJJZCA/IGAke2Z1bmNJZH1fJHt0YWJJZH1gIDogZnVuY0lkO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBldmVudEZpcmUodG9rZW46IHN0cmluZywgYXJnczogYW55KSB7XHJcbiAgICAgICAgY29uc3QgZmViID0gRXZlbnRVdGlsLmdldEZybUV2ZW50KCk7XHJcbiAgICAgICAgaWYgKCFmZWIgfHwgdHlwZW9mIGZlYi5wb3N0ICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmViLnBvc3QodG9rZW4sIGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBldmVudExpc3RuZXIodG9rZW46IHN0cmluZywgaGFuZGxlcjogKHZhbHVlOiBhbnkpID0+IHZvaWQsIG9wdGlvbnM/OiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgY29uc3QgZmViID0gRXZlbnRVdGlsLmdldEZybUV2ZW50KCk7XHJcbiAgICAgICAgaWYgKCFmZWIgfHwgdHlwZW9mIGZlYi5vbiAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOiPnOWNleebkeWQrOiAheW/hemhu+imgeWjsOaYjuiHquW3seeahOi6q+S7ve+8jOaWueS+v+ahhuaetueuoeeQhlxyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuYXBwVHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuYXBwVHlwZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEFwcFR5cGUuQXBwOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcE9ia2V5ID0gRXZlbnRVdGlsLmFwcE9ic1Rva2VuKG9wdGlvbnMuYXBwSWQsIG9wdGlvbnMuYXBwRW50cmFuY2UsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZlYi5vbldpdGhPYmtleSh0b2tlbiwgYXBwT2JrZXksIGhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5NZW51OlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmNPYmtleSA9IEV2ZW50VXRpbC5mdW5jT2JzVG9rZW4ob3B0aW9ucy5mdW5jSWQsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZlYi5vbldpdGhPYmtleSh0b2tlbiwgZnVuY09ia2V5LCBoYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmZWIub24odG9rZW4sIGhhbmRsZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDliJvlu7rnm5HlkKzorqLpmIUsIOe7tOaKpOS4gOS4quebkeWQrOiAheWIl+ihqO+8jOmSiOWvueiPnOWNleinpuWPkeS6i+S7tiAqL1xyXG4gICAgcHVibGljIGV2ZW50TGlzdG5lcjRGdW5jKHRva2VuOiBzdHJpbmcsIGZ1bmNJZDogc3RyaW5nLCBoYW5kbGVyOiAodmFsdWU6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgICAgIGNvbnN0IGZlYiA9IEV2ZW50VXRpbC5nZXRGcm1FdmVudCgpO1xyXG4gICAgICAgIGlmICghZmViIHx8IHR5cGVvZiBmZWIub24gIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmZWIub25XaXRoT2JrZXkodG9rZW4sIGZ1bmNJZCwgaGFuZGxlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWIm+W7uuebkeWQrOiuoumYhSwg57u05oqk5LiA5Liq55uR5ZCs6ICF5YiX6KGo77yM6ZKI5a+55bqU55So6Kem5Y+R5LqL5Lu2ICovXHJcbiAgICBwdWJsaWMgZXZlbnRMaXN0bmVyNEFwcCh0b2tlbjogc3RyaW5nLCBhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCBoYW5kbGVyOiAodmFsdWU6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgICAgIGNvbnN0IGZlYiA9IEV2ZW50VXRpbC5nZXRGcm1FdmVudCgpO1xyXG4gICAgICAgIGlmICghZmViIHx8IHR5cGVvZiBmZWIub24gIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBhcHBPYmtleSA9IEV2ZW50VXRpbC5hcHBPYnNUb2tlbihhcHBJZCwgYXBwRW50cmFuY2UpO1xyXG4gICAgICAgIGZlYi5vbldpdGhPYmtleSh0b2tlbiwgYXBwT2JrZXksIGhhbmRsZXIpO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
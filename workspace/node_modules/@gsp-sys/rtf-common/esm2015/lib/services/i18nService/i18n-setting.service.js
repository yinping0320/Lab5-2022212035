/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpService, LanguageService } from '@ecp-caf/caf-common';
import { of } from 'rxjs';
import { catchError, map, switchMap } from 'rxjs/operators';
import { FrameworkVariableService } from '../frmVariableService/framework-variable.service';
/**
 * @record
 */
export function I18nSettingEntity() { }
if (false) {
    /** @type {?|undefined} */
    I18nSettingEntity.prototype.i18nSetting;
    /** @type {?|undefined} */
    I18nSettingEntity.prototype.languages;
    /** @type {?|undefined} */
    I18nSettingEntity.prototype.currentLanCode;
}
export class FrmI18nSettingService {
    /**
     * @param {?} frmVariable
     * @param {?} lanService
     * @param {?} http
     */
    constructor(frmVariable, lanService, http) {
        this.frmVariable = frmVariable;
        this.lanService = lanService;
        this.http = http;
        this.variableKey = 'frm-i18nSetting';
    }
    /**
     * @return {?}
     */
    getSetting() {
        /** @type {?} */
        const temp = this.frmVariable.getFrmVariableByKey(this.variableKey);
        return this.deepClone(temp);
    }
    /**
     * @return {?}
     */
    getSetting$() {
        /** @type {?} */
        const temp = this.frmVariable.getFrmVariableByKey(this.variableKey);
        return !temp ? this.loadSetting$() : of(this.deepClone(temp));
    }
    /**
     * @return {?}
     */
    loadSetting$() {
        /** @type {?} */
        const rtfService = ((/** @type {?} */ (window))).gspframeworkService && ((/** @type {?} */ (window))).gspframeworkService.rtf;
        /** @type {?} */
        const entity = {};
        if (!!rtfService && !!rtfService.language) {
            try {
                /** @type {?} */
                const lanService = rtfService.language;
                lanService.i18nSetting((/**
                 * @param {?} res
                 * @return {?}
                 */
                res => {
                    entity.i18nSetting = res;
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                err => {
                    console.log(err);
                }));
                lanService.allLanguages((/**
                 * @param {?} res
                 * @return {?}
                 */
                res => {
                    entity.languages = res;
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                err => {
                    console.log(err);
                }));
                entity.currentLanCode = lanService.getLanguageCode();
                this.frmVariable.frameworkVariableReg(this.variableKey, entity);
                return of(entity);
            }
            catch (e) {
                console.log(e);
                return of(null);
            }
        }
        else {
            /** @type {?} */
            const languagesUrl = '/api/runtime/sys/v1.0/i18n/languageservice/getalllanguages';
            /** @type {?} */
            const settingUrl = '/api/runtime/sys/v1.0/i18n/i18nusersetting/setting';
            entity.currentLanCode = this.lanService.getLanguageCode();
            return this.http.get(languagesUrl).pipe(map((/**
             * @param {?} res
             * @return {?}
             */
            (res) => entity.languages = res)), switchMap((/**
             * @return {?}
             */
            () => this.http.get(settingUrl))), map((/**
             * @param {?} res
             * @return {?}
             */
            (res) => {
                entity.i18nSetting = res;
                this.frmVariable.frameworkVariableReg(this.variableKey, entity);
                return entity;
            })), catchError((/**
             * @param {?} err
             * @return {?}
             */
            (err) => {
                console.log(err);
                return of(null);
            })));
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    deepClone(target) {
        /** @type {?} */
        let result;
        if (typeof target === 'object') {
            if (Array.isArray(target)) {
                result = [];
                for (let i in target) {
                    result.push(this.deepClone(target[i]));
                }
            }
            else if (target === null) {
                result = null;
            }
            else if (target.constructor === RegExp) {
                result = target;
            }
            else {
                result = {};
                for (let i in target) {
                    result[i] = this.deepClone(target[i]);
                }
            }
        }
        else {
            result = target;
        }
        return result;
    }
}
FrmI18nSettingService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FrmI18nSettingService.ctorParameters = () => [
    { type: FrameworkVariableService },
    { type: LanguageService },
    { type: HttpService }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    FrmI18nSettingService.prototype.variableKey;
    /**
     * @type {?}
     * @private
     */
    FrmI18nSettingService.prototype.frmVariable;
    /**
     * @type {?}
     * @private
     */
    FrmI18nSettingService.prototype.lanService;
    /**
     * @type {?}
     * @private
     */
    FrmI18nSettingService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaTE4bi1zZXR0aW5nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9ydGYtY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2kxOG5TZXJ2aWNlL2kxOG4tc2V0dGluZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkUsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQzs7OztBQUU1Rix1Q0FJQzs7O0lBSEcsd0NBQWtCOztJQUNsQixzQ0FBZ0I7O0lBQ2hCLDJDQUF3Qjs7QUFJNUIsTUFBTSxPQUFPLHFCQUFxQjs7Ozs7O0lBRzlCLFlBQ1ksV0FBcUMsRUFDckMsVUFBMkIsRUFDM0IsSUFBaUI7UUFGakIsZ0JBQVcsR0FBWCxXQUFXLENBQTBCO1FBQ3JDLGVBQVUsR0FBVixVQUFVLENBQWlCO1FBQzNCLFNBQUksR0FBSixJQUFJLENBQWE7UUFKckIsZ0JBQVcsR0FBRyxpQkFBaUIsQ0FBQztJQU14QyxDQUFDOzs7O0lBRU0sVUFBVTs7Y0FDUCxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ25FLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDOzs7O0lBRU0sV0FBVzs7Y0FDUixJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ25FLE9BQU8sQ0FB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dkIsTUFBTSxHQUFHLEVBQUUsQ0FBQztnQkFDWixLQUFLLElBQUksQ0FBQyxJQUFJLE1BQU0sRUFBRTtvQkFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7aUJBQ3pDO2FBQ0o7aUJBQU0sSUFBSSxNQUFNLEtBQUssSUFBSSxFQUFFO2dCQUN4QixNQUFNLEdBQUcsSUFBSSxDQUFDO2FBQ2pCO2lCQUFNLElBQUksTUFBTSxDQUFDLFdBQVcsS0FBSyxNQUFNLEVBQUU7Z0JBQ3RDLE1BQU0sR0FBRyxNQUFNLENBQUM7YUFDbkI7aUJBQU07Z0JBQ0gsTUFBTSxHQUFHLEVBQUUsQ0FBQztnQkFDWixLQUFLLElBQUksQ0FBQyxJQUFJLE1BQU0sRUFBRTtvQkFDbEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3pDO2FBQ0o7U0FDSjthQUFNO1lBQ0gsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUNuQjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7OztZQXJHSixVQUFVOzs7O1lBUkYsd0JBQXdCO1lBSFgsZUFBZTtZQUE1QixXQUFXOzs7Ozs7O0lBY2hCLDRDQUF3Qzs7Ozs7SUFFcEMsNENBQTZDOzs7OztJQUM3QywyQ0FBbUM7Ozs7O0lBQ25DLHFDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEh0dHBTZXJ2aWNlLCBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEZyYW1ld29ya1ZhcmlhYmxlU2VydmljZSB9IGZyb20gJy4uL2ZybVZhcmlhYmxlU2VydmljZS9mcmFtZXdvcmstdmFyaWFibGUuc2VydmljZSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEkxOG5TZXR0aW5nRW50aXR5IHtcclxuICAgIGkxOG5TZXR0aW5nPzogYW55O1xyXG4gICAgbGFuZ3VhZ2VzPzogYW55O1xyXG4gICAgY3VycmVudExhbkNvZGU/OiBzdHJpbmc7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZybUkxOG5TZXR0aW5nU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSB2YXJpYWJsZUtleSA9ICdmcm0taTE4blNldHRpbmcnO1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBmcm1WYXJpYWJsZTogRnJhbWV3b3JrVmFyaWFibGVTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgbGFuU2VydmljZTogTGFuZ3VhZ2VTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgaHR0cDogSHR0cFNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRTZXR0aW5nKCk6IGFueSB7XHJcbiAgICAgICAgY29uc3QgdGVtcCA9IHRoaXMuZnJtVmFyaWFibGUuZ2V0RnJtVmFyaWFibGVCeUtleSh0aGlzLnZhcmlhYmxlS2V5KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZWVwQ2xvbmUodGVtcCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFNldHRpbmckKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgdGVtcCA9IHRoaXMuZnJtVmFyaWFibGUuZ2V0RnJtVmFyaWFibGVCeUtleSh0aGlzLnZhcmlhYmxlS2V5KTtcclxuICAgICAgICByZXR1cm4gIXRlbXAgPyB0aGlzLmxvYWRTZXR0aW5nJCgpIDogb2YodGhpcy5kZWVwQ2xvbmUodGVtcCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBsb2FkU2V0dGluZyQoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBydGZTZXJ2aWNlID0gKHdpbmRvdyBhcyBhbnkpLmdzcGZyYW1ld29ya1NlcnZpY2UgJiYgKHdpbmRvdyBhcyBhbnkpLmdzcGZyYW1ld29ya1NlcnZpY2UucnRmO1xyXG4gICAgICAgIGNvbnN0IGVudGl0eTogSTE4blNldHRpbmdFbnRpdHkgPSB7fTtcclxuICAgICAgICBpZiAoISFydGZTZXJ2aWNlICYmICEhcnRmU2VydmljZS5sYW5ndWFnZSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFuU2VydmljZSA9IHJ0ZlNlcnZpY2UubGFuZ3VhZ2U7XHJcbiAgICAgICAgICAgICAgICBsYW5TZXJ2aWNlLmkxOG5TZXR0aW5nKFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5pMThuU2V0dGluZyA9IHJlcztcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGxhblNlcnZpY2UuYWxsTGFuZ3VhZ2VzKFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5sYW5ndWFnZXMgPSByZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHkuY3VycmVudExhbkNvZGUgPSBsYW5TZXJ2aWNlLmdldExhbmd1YWdlQ29kZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mcm1WYXJpYWJsZS5mcmFtZXdvcmtWYXJpYWJsZVJlZyh0aGlzLnZhcmlhYmxlS2V5LCBlbnRpdHkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKGVudGl0eSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgbGFuZ3VhZ2VzVXJsID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9pMThuL2xhbmd1YWdlc2VydmljZS9nZXRhbGxsYW5ndWFnZXMnO1xyXG4gICAgICAgICAgICBjb25zdCBzZXR0aW5nVXJsID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9pMThuL2kxOG51c2Vyc2V0dGluZy9zZXR0aW5nJztcclxuICAgICAgICAgICAgZW50aXR5LmN1cnJlbnRMYW5Db2RlID0gdGhpcy5sYW5TZXJ2aWNlLmdldExhbmd1YWdlQ29kZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChsYW5ndWFnZXNVcmwpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBtYXAoXHJcbiAgICAgICAgICAgICAgICAgICAgKHJlcykgPT4gZW50aXR5Lmxhbmd1YWdlcyA9IHJlc1xyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAoKSA9PiB0aGlzLmh0dHAuZ2V0KHNldHRpbmdVcmwpXHJcbiAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgICAgIChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5LmkxOG5TZXR0aW5nID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZybVZhcmlhYmxlLmZyYW1ld29ya1ZhcmlhYmxlUmVnKHRoaXMudmFyaWFibGVLZXksIGVudGl0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoXHJcbiAgICAgICAgICAgICAgICAgICAgKGVycjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZGVlcENsb25lKHRhcmdldDogYW55KTogYW55IHtcclxuICAgICAgICBsZXQgcmVzdWx0O1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgaW4gdGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5kZWVwQ2xvbmUodGFyZ2V0W2ldKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmNvbnN0cnVjdG9yID09PSBSZWdFeHApIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRhcmdldDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSBpbiB0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHRbaV0gPSB0aGlzLmRlZXBDbG9uZSh0YXJnZXRbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gdGFyZ2V0O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
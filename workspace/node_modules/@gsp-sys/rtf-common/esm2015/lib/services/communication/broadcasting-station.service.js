/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { FrameworkVariableService } from '../frmVariableService/framework-variable.service';
import { EventBusPipe } from '../../eventbus/frm-eventpipe';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
export class BroadcastingStationService {
    constructor() {
        this.frmSubject = 'frmBroadcast-subjects';
        this.frmVariableService = new FrameworkVariableService();
        this.subjectMaps = this.frmVariableService.getFrmVariableByKey(this.frmSubject) || new Map();
    }
    /**
     * 注册主题，并获取当前主题唯一标识token
     * @param {?} subjectCode 主题编码，建议有明确含义，方便确认当前主题的职责
     * code不是唯一标识，即使相同code每次注册都会生成一个新的主题，返回值token是唯一标识
     * @param {?} options 主题注册操作，可以直接对于菜单 或 应用注册主题
     * @param {?=} customSub 自定义主题，如果为null或者不传，默认为Subject
     * @return {?}
     */
    subjectRegister(subjectCode, options, customSub) {
        if (!customSub) {
            customSub = new Subject();
        }
        /** @type {?} */
        let token;
        if (options && options.funcId) {
            token = options.funcId;
        }
        else if (options && options.appId && options.appEntrance) {
            token = `${options.appId}-${options.appEntrance}`;
        }
        else {
            token = this.createToken();
        }
        /** @type {?} */
        const pipe = new EventBusPipe(token, null, customSub);
        pipe.pipeCode = subjectCode;
        this.subjectMaps.set(token, pipe);
        this.frmVariableService.frameworkVariableReg(this.frmSubject, this.subjectMaps);
        return token;
    }
    /**
     * 注册主题，可直接获取主题实体，
     * 框架不托管维护，常用于适配层上事件扩展机制
     * @param {?} options 注册参数
     * @param {?=} customSub 是否自定义主题
     * @return {?}
     */
    customSubjectRegister(options, customSub) {
        /** @type {?} */
        const subMap = new Map();
        if (!customSub) {
            customSub = new Subject();
        }
        /** @type {?} */
        let token;
        if (options && options.customToken) {
            token = options.customToken;
        }
        else if (options && options.funcId) {
            token = options.funcId;
        }
        else if (options && options.appId && options.appEntrance) {
            token = `${options.appId}-${options.appEntrance}`;
        }
        else {
            token = this.createToken();
        }
        /** @type {?} */
        const pipe = new EventBusPipe(token, null, customSub);
        subMap.set(token, pipe);
        return subMap;
    }
    /**
     * 删除主题
     * @param {?} subjectToken 主题唯一标识
     * @return {?}
     */
    subjectRemove(subjectToken) {
        this.subjectMaps.delete(subjectToken);
        this.frmVariableService.frameworkVariableReg(this.frmSubject, this.subjectMaps);
    }
    /**
     * 通过某个主题发送消息
     * @param {?} subjectToken 主题唯一的token标识
     * @param {?} info 要发送的消息
     * @return {?}
     */
    notify(subjectToken, info) {
        /** @type {?} */
        const sub = this.getSubject(subjectToken);
        if (!sub) {
            return;
        }
        sub.post(info);
    }
    /**
     * 为主题添加观察者，并监听主题消息
     * @param {?} subjectToken 主题token
     * @param {?} observerToken 当前监听主题的观察者唯一标识token
     * @param {?} handler 观察者监听到主题消息时要执行的动作
     * @return {?}
     */
    response(subjectToken, observerToken, handler) {
        /** @type {?} */
        const sub = this.getSubject(subjectToken);
        if (!sub) {
            return;
        }
        sub.subscribeWithObkey(observerToken, handler);
    }
    /**
     * 观察者取消对主题的订阅
     * @param {?} subjectToken 主题唯一标识
     * @param {?} observerToken 观察者唯一标识
     * @return {?}
     */
    responseUnSubscribe(subjectToken, observerToken) {
        /** @type {?} */
        const sub = this.getSubject(subjectToken);
        if (!sub) {
            return;
        }
        sub.unSubscribeWithObkey(observerToken);
    }
    /**
     * @private
     * @param {?} subjectToken
     * @return {?}
     */
    getSubject(subjectToken) {
        return this.subjectMaps.get(subjectToken);
    }
    /**
     * 创建唯一token
     * @private
     * @return {?}
     */
    createToken() {
        // tslint:disable-next-line: only-arrow-functions
        /** @type {?} */
        const S4 = (/**
         * @return {?}
         */
        function () {
            // tslint:disable-next-line:no-bitwise
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        });
        return (S4() + S4() + '-' + S4() + '-' + S4() + '-' + S4() + '-' + S4() + S4() + S4());
    }
}
BroadcastingStationService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
BroadcastingStationService.ctorParameters = () => [];
/** @nocollapse */ BroadcastingStationService.ngInjectableDef = i0.defineInjectable({ factory: function BroadcastingStationService_Factory() { return new BroadcastingStationService(); }, token: BroadcastingStationService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    BroadcastingStationService.prototype.subjectMaps;
    /**
     * @type {?}
     * @private
     */
    BroadcastingStationService.prototype.frmVariableService;
    /**
     * @type {?}
     * @private
     */
    BroadcastingStationService.prototype.frmSubject;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJvYWRjYXN0aW5nLXN0YXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3J0Zi1jb21tb24vIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvY29tbXVuaWNhdGlvbi9icm9hZGNhc3Rpbmctc3RhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBQzVGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDOztBQU0vQixNQUFNLE9BQU8sMEJBQTBCO0lBTW5DO1FBRlEsZUFBVSxHQUFHLHVCQUF1QixDQUFDO1FBR3pDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLHdCQUF3QixFQUFFLENBQUM7UUFDekQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLElBQUksR0FBRyxFQUF3QixDQUFDO0lBQ3ZILENBQUM7Ozs7Ozs7OztJQVNNLGVBQWUsQ0FBQyxXQUFtQixFQUFFLE9BQTBCLEVBQUUsU0FBd0I7UUFDNUYsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNaLFNBQVMsR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO1NBQ2xDOztZQUNHLEtBQWE7UUFDakIsSUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtZQUMzQixLQUFLLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztTQUMxQjthQUFNLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFdBQVcsRUFBRTtZQUN4RCxLQUFLLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxJQUFJ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WUFBWSxDQUFDLENBQUM7SUFDOUMsQ0FBQzs7Ozs7O0lBS08sV0FBVzs7O2NBRVQsRUFBRTs7O1FBQUc7WUFDUCxzQ0FBc0M7WUFDdEMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUE7UUFDRCxPQUFPLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEdBQUcsR0FBRyxHQUFHLEVBQUUsRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLEVBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRSxFQUFFLEdBQUcsR0FBRyxHQUFHLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDM0YsQ0FBQzs7O1lBaklKLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsTUFBTTthQUNyQjs7Ozs7Ozs7OztJQUdHLGlEQUErQzs7Ozs7SUFDL0Msd0RBQXFEOzs7OztJQUNyRCxnREFBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZyYW1ld29ya1ZhcmlhYmxlU2VydmljZSB9IGZyb20gJy4uL2ZybVZhcmlhYmxlU2VydmljZS9mcmFtZXdvcmstdmFyaWFibGUuc2VydmljZSc7XHJcbmltcG9ydCB7IEV2ZW50QnVzUGlwZSB9IGZyb20gJy4uLy4uL2V2ZW50YnVzL2ZybS1ldmVudHBpcGUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEZybVN1YmplY3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2hhcmVkL2ZybS11dGlsJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQnJvYWRjYXN0aW5nU3RhdGlvblNlcnZpY2Uge1xyXG5cclxuICAgIHByaXZhdGUgc3ViamVjdE1hcHM6IE1hcDxzdHJpbmcsIEV2ZW50QnVzUGlwZT47XHJcbiAgICBwcml2YXRlIGZybVZhcmlhYmxlU2VydmljZTogRnJhbWV3b3JrVmFyaWFibGVTZXJ2aWNlO1xyXG4gICAgcHJpdmF0ZSBmcm1TdWJqZWN0ID0gJ2ZybUJyb2FkY2FzdC1zdWJqZWN0cyc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5mcm1WYXJpYWJsZVNlcnZpY2UgPSBuZXcgRnJhbWV3b3JrVmFyaWFibGVTZXJ2aWNlKCk7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0TWFwcyA9IHRoaXMuZnJtVmFyaWFibGVTZXJ2aWNlLmdldEZybVZhcmlhYmxlQnlLZXkodGhpcy5mcm1TdWJqZWN0KSB8fCBuZXcgTWFwPHN0cmluZywgRXZlbnRCdXNQaXBlPigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rOo5YaM5Li76aKY77yM5bm26I635Y+W5b2T5YmN5Li76aKY5ZSv5LiA5qCH6K+GdG9rZW5cclxuICAgICAqIEBwYXJhbSBzdWJqZWN0Q29kZSDkuLvpopjnvJbnoIHvvIzlu7rorq7mnInmmI7noa7lkKvkuYnvvIzmlrnkvr/noa7orqTlvZPliY3kuLvpopjnmoTogYzotKNcclxuICAgICAqIGNvZGXkuI3mmK/llK/kuIDmoIfor4bvvIzljbPkvb/nm7jlkIxjb2Rl5q+P5qyh5rOo5YaM6YO95Lya55Sf5oiQ5LiA5Liq5paw55qE5Li76aKY77yM6L+U5Zue5YC8dG9rZW7mmK/llK/kuIDmoIfor4ZcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIOS4u+mimOazqOWGjOaTjeS9nO+8jOWPr+S7peebtOaOpeWvueS6juiPnOWNlSDmiJYg5bqU55So5rOo5YaM5Li76aKYXHJcbiAgICAgKiBAcGFyYW0gY3VzdG9tU3ViIOiHquWumuS5ieS4u+mimO+8jOWmguaenOS4um51bGzmiJbogIXkuI3kvKDvvIzpu5jorqTkuLpTdWJqZWN0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdWJqZWN0UmVnaXN0ZXIoc3ViamVjdENvZGU6IHN0cmluZywgb3B0aW9uczogRnJtU3ViamVjdE9wdGlvbnMsIGN1c3RvbVN1Yj86IFN1YmplY3Q8YW55Pik6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKCFjdXN0b21TdWIpIHtcclxuICAgICAgICAgICAgY3VzdG9tU3ViID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdG9rZW46IHN0cmluZztcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmZ1bmNJZCkge1xyXG4gICAgICAgICAgICB0b2tlbiA9IG9wdGlvbnMuZnVuY0lkO1xyXG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmFwcElkICYmIG9wdGlvbnMuYXBwRW50cmFuY2UpIHtcclxuICAgICAgICAgICAgdG9rZW4gPSBgJHtvcHRpb25zLmFwcElkfS0ke29wdGlvbnMuYXBwRW50cmFuY2V9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0b2tlbiA9IHRoaXMuY3JlYXRlVG9rZW4oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGlwZSA9IG5ldyBFdmVudEJ1c1BpcGUodG9rZW4sIG51bGwsIGN1c3RvbVN1Yik7XHJcbiAgICAgICAgcGlwZS5waXBlQ29kZSA9IHN1YmplY3RDb2RlO1xyXG4gICAgICAgIHRoaXMuc3ViamVjdE1hcHMuc2V0KHRva2VuLCBwaXBlKTtcclxuICAgICAgICB0aGlzLmZybVZhcmlhYmxlU2VydmljZS5mcmFtZXdvcmtWYXJpYWJsZVJlZyh0aGlzLmZybVN1YmplY3QsIHRoaXMuc3ViamVjdE1hcHMpO1xyXG4gICAgICAgIHJldHVybiB0b2tlbjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOazqOWGjOS4u+mimO+8jOWPr+ebtOaOpeiOt+WPluS4u+mimOWunuS9k++8jFxyXG4gICAgICog5qGG5p625LiN5omY566h57u05oqk77yM5bi455So5LqO6YCC6YWN5bGC5LiK5LqL5Lu25omp5bGV5py65Yi2XHJcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyDms6jlhozlj4LmlbBcclxuICAgICAqIEBwYXJhbSBjdXN0b21TdWIg5piv5ZCm6Ieq5a6a5LmJ5Li76aKYXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjdXN0b21TdWJqZWN0UmVnaXN0ZXIob3B0aW9uczogRnJtU3ViamVjdE9wdGlvbnMsIGN1c3RvbVN1Yj86IFN1YmplY3Q8YW55Pik6IE1hcDxzdHJpbmcsIEV2ZW50QnVzUGlwZT4ge1xyXG4gICAgICAgIGNvbnN0IHN1Yk1hcCA9IG5ldyBNYXA8c3RyaW5nLCBFdmVudEJ1c1BpcGU+KCk7XHJcbiAgICAgICAgaWYgKCFjdXN0b21TdWIpIHtcclxuICAgICAgICAgICAgY3VzdG9tU3ViID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdG9rZW46IHN0cmluZztcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmN1c3RvbVRva2VuKSB7XHJcbiAgICAgICAgICAgIHRva2VuID0gb3B0aW9ucy5jdXN0b21Ub2tlbjtcclxuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5mdW5jSWQpIHtcclxuICAgICAgICAgICAgdG9rZW4gPSBvcHRpb25zLmZ1bmNJZDtcclxuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5hcHBJZCAmJiBvcHRpb25zLmFwcEVudHJhbmNlKSB7XHJcbiAgICAgICAgICAgIHRva2VuID0gYCR7b3B0aW9ucy5hcHBJZH0tJHtvcHRpb25zLmFwcEVudHJhbmNlfWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmNyZWF0ZVRva2VuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHBpcGUgPSBuZXcgRXZlbnRCdXNQaXBlKHRva2VuLCBudWxsLCBjdXN0b21TdWIpO1xyXG4gICAgICAgIHN1Yk1hcC5zZXQodG9rZW4sIHBpcGUpO1xyXG4gICAgICAgIHJldHVybiBzdWJNYXA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKDpmaTkuLvpophcclxuICAgICAqIEBwYXJhbSBzdWJqZWN0VG9rZW4g5Li76aKY5ZSv5LiA5qCH6K+GXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdWJqZWN0UmVtb3ZlKHN1YmplY3RUb2tlbjogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0TWFwcy5kZWxldGUoc3ViamVjdFRva2VuKTtcclxuICAgICAgICB0aGlzLmZybVZhcmlhYmxlU2VydmljZS5mcmFtZXdvcmtWYXJpYWJsZVJlZyh0aGlzLmZybVN1YmplY3QsIHRoaXMuc3ViamVjdE1hcHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCa6L+H5p+Q5Liq5Li76aKY5Y+R6YCB5raI5oGvXHJcbiAgICAgKiBAcGFyYW0gc3ViamVjdFRva2VuIOS4u+mimOWUr+S4gOeahHRva2Vu5qCH6K+GXHJcbiAgICAgKiBAcGFyYW0gaW5mbyDopoHlj5HpgIHnmoTmtojmga9cclxuICAgICAqL1xyXG4gICAgcHVibGljIG5vdGlmeShzdWJqZWN0VG9rZW46IHN0cmluZywgaW5mbzogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgc3ViID0gdGhpcy5nZXRTdWJqZWN0KHN1YmplY3RUb2tlbik7XHJcbiAgICAgICAgaWYgKCFzdWIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdWIucG9zdChpbmZvKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4uuS4u+mimOa3u+WKoOinguWvn+iAhe+8jOW5tuebkeWQrOS4u+mimOa2iOaBr1xyXG4gICAgICogQHBhcmFtIHN1YmplY3RUb2tlbiDkuLvpoph0b2tlblxyXG4gICAgICogQHBhcmFtIG9ic2VydmVyVG9rZW4g5b2T5YmN55uR5ZCs5Li76aKY55qE6KeC5a+f6ICF5ZSv5LiA5qCH6K+GdG9rZW5cclxuICAgICAqIEBwYXJhbSBoYW5kbGVyIOinguWvn+iAheebkeWQrOWIsOS4u+mimOa2iOaBr+aXtuimgeaJp+ihjOeahOWKqOS9nFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVzcG9uc2Uoc3ViamVjdFRva2VuOiBzdHJpbmcsIG9ic2VydmVyVG9rZW46IHN0cmluZywgaGFuZGxlcjogKHZhbHVlOiBhbnkpID0+IHZvaWQpIHtcclxuICAgICAgICBjb25zdCBzdWIgPSB0aGlzLmdldFN1YmplY3Qoc3ViamVjdFRva2VuKTtcclxuICAgICAgICBpZiAoIXN1Yikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1Yi5zdWJzY3JpYmVXaXRoT2JrZXkob2JzZXJ2ZXJUb2tlbiwgaGFuZGxlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDop4Llr5/ogIXlj5bmtojlr7nkuLvpopjnmoTorqLpmIVcclxuICAgICAqIEBwYXJhbSBzdWJqZWN0VG9rZW4g5Li76aKY5ZSv5LiA5qCH6K+GXHJcbiAgICAgKiBAcGFyYW0gb2JzZXJ2ZXJUb2tlbiDop4Llr5/ogIXllK/kuIDmoIfor4ZcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlc3BvbnNlVW5TdWJzY3JpYmUoc3ViamVjdFRva2VuOiBzdHJpbmcsIG9ic2VydmVyVG9rZW46IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHN1YiA9IHRoaXMuZ2V0U3ViamVjdChzdWJqZWN0VG9rZW4pO1xyXG4gICAgICAgIGlmICghc3ViKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3ViLnVuU3Vic2NyaWJlV2l0aE9ia2V5KG9ic2VydmVyVG9rZW4pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0U3ViamVjdChzdWJqZWN0VG9rZW46IHN0cmluZyk6IEV2ZW50QnVzUGlwZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdE1hcHMuZ2V0KHN1YmplY3RUb2tlbik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rllK/kuIB0b2tlblxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNyZWF0ZVRva2VuKCkge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogb25seS1hcnJvdy1mdW5jdGlvbnNcclxuICAgICAgICBjb25zdCBTNCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWJpdHdpc2VcclxuICAgICAgICAgICAgcmV0dXJuICgoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApIHwgMCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiAoUzQoKSArIFM0KCkgKyAnLScgKyBTNCgpICsgJy0nICsgUzQoKSArICctJyArIFM0KCkgKyAnLScgKyBTNCgpICsgUzQoKSArIFM0KCkpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
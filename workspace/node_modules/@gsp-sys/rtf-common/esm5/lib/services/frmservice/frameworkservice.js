/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { Router } from '@angular/router';
import { of } from 'rxjs';
import { FrmEventBus } from '../../eventbus/frm-evenbus';
import { LoadingService } from '../loading/loading.service';
import { FuncsService } from '../funcsservice/funcs.service';
import { IframeLink } from '../../models/iframe.model';
import { map, switchMap } from 'rxjs/operators';
import { CacheService, HttpService, LanguageService, SessionService } from '@ecp-caf/caf-common';
import { EventUtil, FrmUtil, AppType } from '../../shared/frm-util';
import { AppService } from '../appservice/app.service';
import { FrmI18nSettingService } from '../i18nService/i18n-setting.service';
import { FrameworkVariableService } from '../frmVariableService/framework-variable.service';
var FrameworkService = /** @class */ (function () {
    function FrameworkService(http, router, cache, sessionSvc, feb, funcService, loadService, appService, i18nSetting) {
        this.http = http;
        this.router = router;
        this.cache = cache;
        this.sessionSvc = sessionSvc;
        this.feb = feb;
        this.funcService = funcService;
        this.loadService = loadService;
        this.appService = appService;
        this.i18nSetting = i18nSetting;
        this.FUNCSTATUS_PATH = '/api/runtime/sys/v1.0/function-states';
        this.BeforeFuncClose = EventUtil.BEFORE_FUNC_CLOSE;
        this.FuncClosed = EventUtil.FUNC_CLOSED;
        this.FuncSwitch = EventUtil.FUNC_SWITCH;
        if (!this.i18nSetting) {
            /** @type {?} */
            var variables = new FrameworkVariableService();
            /** @type {?} */
            var language = new LanguageService(null);
            this.i18nSetting = new FrmI18nSettingService(variables, language, http);
        }
        if (!this.appService) {
            this.appService = new AppService(this.http, this.sessionSvc, this.i18nSetting);
        }
    }
    /**
     * 根据funcid打开功能菜单
     * (适用于单页签路由，不支持NG7升级后菜单之间跳转)
     */
    /**
     * 根据funcid打开功能菜单
     * (适用于单页签路由，不支持NG7升级后菜单之间跳转)
     * @param {?} funcid
     * @param {?} routepath
     * @param {?} parentsessionid
     * @param {?=} newsession
     * @param {?=} simpleparam
     * @return {?}
     */
    FrameworkService.prototype.openFunc = /**
     * 根据funcid打开功能菜单
     * (适用于单页签路由，不支持NG7升级后菜单之间跳转)
     * @param {?} funcid
     * @param {?} routepath
     * @param {?} parentsessionid
     * @param {?=} newsession
     * @param {?=} simpleparam
     * @return {?}
     */
    function (funcid, routepath, parentsessionid, newsession, simpleparam) {
        if (newsession === void 0) { newsession = true; }
        if (simpleparam === void 0) { simpleparam = ''; }
        /** @type {?} */
        var appOps = {
            appType: AppType.Menu,
            funcId: funcid,
            appId: '',
            appEntrance: ''
        };
        this.internalOpen(appOps);
        return of(true);
        // return this.internalOpen$(appOps);
    };
    /**
     * 直接打开功能
     */
    /**
     * 直接打开功能
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.openMenu = /**
     * 直接打开功能
     * @param {?} options
     * @return {?}
     */
    function (options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                if (!options.appId) {
                    window.alert('参数appId不能为空！');
                    return;
                }
                this.appService.openAppByOptions(options);
                break;
            case AppType.Menu:
                this.internalOpen(options);
                break;
            case AppType.Other: break;
        }
    };
    /**
     * 通过流方式打开功能
     */
    /**
     * 通过流方式打开功能
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.openMenu$ = /**
     * 通过流方式打开功能
     * @param {?} options
     * @return {?}
     */
    function (options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                if (!options.appId) {
                    window.alert('参数appId不能为空！');
                    return;
                }
                return this.appService.openAppByOptions$(options);
            case AppType.Menu:
                if (options.onlyGetIframeLink === true) {
                    return this.internalOpenByIframeLink$(options);
                }
                return this.internalOpen$(options);
            case AppType.Other: break;
        }
    };
    /**
     * 打开联查菜单
     */
    /**
     * 打开联查菜单
     * @param {?} funcId
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.openConnectedFunc = /**
     * 打开联查菜单
     * @param {?} funcId
     * @param {?} options
     * @return {?}
     */
    function (funcId, options) {
        /** @type {?} */
        var appOps = {
            appType: AppType.Menu,
            funcId: funcId,
            appId: '',
            appEntrance: '',
            entityParams: options.EntityParam,
        };
        this.internalOpen(appOps);
    };
    /**
     * 打开联查菜单，并传参
     */
    /**
     * 打开联查菜单，并传参
     * @param {?} funcId
     * @param {?} params
     * @param {?=} reload
     * @return {?}
     */
    FrameworkService.prototype.openFuncWithParam = /**
     * 打开联查菜单，并传参
     * @param {?} funcId
     * @param {?} params
     * @param {?=} reload
     * @return {?}
     */
    function (funcId, params, reload) {
        /** @type {?} */
        var options = {
            appType: AppType.Menu,
            funcId: funcId,
            appId: '',
            appEntrance: '',
            entityParams: params,
            queryStringParams: params,
            isReload: reload
        };
        this.internalOpen(options);
    };
    /**
     * 打开功能，不返回流
     */
    /**
     * 打开功能，不返回流
     * @private
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.internalOpen = /**
     * 打开功能，不返回流
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        this.checkingBeforeOpen$(options)
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (!res || !res.func || res.linkobj) {
                return;
            }
            /** @type {?} */
            var func = res.func;
            _this.getInvokeAndEnterFunc$(options, func).subscribe((/**
             * @param {?} lobj
             * @return {?}
             */
            function (lobj) { return _this.getFeb().post(EventUtil.FARRIS_APP_CLICK, lobj); }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                /** @type {?} */
                var info = {
                    isErr: true,
                    errInfo: err
                };
                _this.getFeb().post(EventUtil.FARRIS_APP_CLICK, info);
            }));
        }));
    };
    /**
     * 通过串流控制，打开菜单
     */
    /**
     * 通过串流控制，打开菜单
     * @private
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.internalOpen$ = /**
     * 通过串流控制，打开菜单
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        return this.checkingBeforeOpen$(options)
            .pipe(switchMap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (!res || !res.func || res.linkobj) {
                return of(null);
            }
            /** @type {?} */
            var func = res.func;
            return _this.getInvokeAndEnterFunc$(options, func).pipe(map((/**
             * @param {?} lobj
             * @return {?}
             */
            function (lobj) {
                _this.getFeb().post(EventUtil.FARRIS_APP_CLICK, lobj);
                return true;
            })));
        })));
    };
    /**
     * 通过串流获取被打开菜单的iframeLink对象信息
     */
    /**
     * 通过串流获取被打开菜单的iframeLink对象信息
     * @private
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.internalOpenByIframeLink$ = /**
     * 通过串流获取被打开菜单的iframeLink对象信息
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        if (!options.funcId) {
            window.alert('参数funcId不能为空！');
            return of(null);
        }
        return this.getFuncEntity(options.funcId).pipe(switchMap((/**
         * @param {?} func
         * @return {?}
         */
        function (func) {
            if (!func) {
                window.alert("\u8BF7\u786E\u8BA4\u60A8\u662F\u5426\u5177\u5907\u6253\u5F00\u83DC\u5355(ID:" + options.funcId + ")\u7684\u6743\u9650");
                return null;
            }
            return _this.getInvokeAndEnterFunc$(options, func);
        })));
    };
    /**
     * @private
     * @param {?} options
     * @param {?} func
     * @return {?}
     */
    FrameworkService.prototype.getInvokeAndEnterFunc$ = /**
     * @private
     * @param {?} options
     * @param {?} func
     * @return {?}
     */
    function (options, func) {
        var _this = this;
        /** @type {?} */
        var newPageId = this.newPageId(options.funcId, options.tabId);
        options.tabId = newPageId;
        /** @type {?} */
        var linkobj;
        return this.getFuncInvok(options.funcId).pipe(switchMap((/**
         * @param {?} funcInvok
         * @return {?}
         */
        function (funcInvok) {
            /** @type {?} */
            var routurl = funcInvok.invokingConfig.url;
            /** @type {?} */
            var paramInfo = funcInvok.invokingConfig.staticParams;
            /** @type {?} */
            var entityParamInfo = funcInvok.invokingConfig.entityParams;
            /** @type {?} */
            var staticParam = paramInfo ? JSON.parse(paramInfo) : '';
            /** @type {?} */
            var entityParam = entityParamInfo ? JSON.parse(entityParamInfo) : '';
            /** @type {?} */
            var su = _this.getSu(routurl);
            return _this.enterFunc({
                tabId: newPageId,
                funcId: options.funcId,
                menuName: options.tabName || func.name,
                action: 'enter'
            }, su).pipe(map((/**
             * @param {?} formToken
             * @return {?}
             */
            function (formToken) {
                linkobj = new IframeLink(func.code, null, _this.buildQueryStringByMap(routurl, options.funcId, options.tabId, formToken, options.queryStringParams));
                linkobj.id = newPageId; // 页面唯一标识 允许页面重复打开
                linkobj.appType = AppType.Menu;
                linkobj.funcId = options.funcId;
                linkobj.FuncName = options.tabName || func.name;
                linkobj.url = funcInvok.invokingConfig.url;
                linkobj.reload = options.isReload;
                linkobj.su = su;
                linkobj.isNewTab = options.isNewTab;
                linkobj.formToken = formToken;
                if (staticParam) {
                    // dky特殊场景，打开jquery原生功能
                    staticParam.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        if (item.name === 'jquery') {
                            linkobj.isjquery = true;
                        }
                        if (item.name === 'mode') {
                            linkobj.mode = item.value;
                            linkobj.src += (item.value ? "&appMode=" + item.value + "&" : '');
                        }
                    }));
                }
                // 大对象实体传参，针对被打开页面建立唯一管道
                _this.getFeb().post(newPageId, options.entityParams);
                // this.getFeb().post(EventUtil.FARRIS_APP_CLICK, linkobj);
                return linkobj;
            })), switchMap((/**
             * @param {?} formLink
             * @return {?}
             */
            function (formLink) {
                return _this.i18nSetting.getSetting$().pipe(map((/**
                 * @return {?}
                 */
                function () { return formLink; })));
            })));
        })));
    };
    /**
     * 流方式检查菜单打开状态
     */
    /**
     * 流方式检查菜单打开状态
     * @private
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.checkingBeforeOpen$ = /**
     * 流方式检查菜单打开状态
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        if (!options.funcId) {
            window.alert('参数funcId不能为空！');
            return of(null);
        }
        return this.getFuncEntity(options.funcId).pipe(map((/**
         * @param {?} func
         * @return {?}
         */
        function (func) {
            if (!func) {
                window.alert("\u8BF7\u786E\u8BA4\u60A8\u662F\u5426\u5177\u5907\u6253\u5F00\u83DC\u5355(ID:" + options.funcId + ")\u7684\u6743\u9650");
                return null;
            }
            /** @type {?} */
            var funcId = options.funcId;
            /** @type {?} */
            var tabId = options.tabId;
            /** @type {?} */
            var pageId = _this.getPageId(funcId, tabId);
            /** @type {?} */
            var linkobj = FrmUtil.getTabArray().find((/**
             * @param {?} i
             * @return {?}
             */
            function (i) { return i.id === pageId && i.appType === AppType.Menu; }));
            if (linkobj) {
                linkobj.FuncName = options.tabName || linkobj.FuncName;
                linkobj.src = _this.buildQueryStringByMap(linkobj.url, funcId, options.tabId, '', options.queryStringParams);
                linkobj.reload = options.isReload; // 界面刷新不改session
                _this.getFeb().post(pageId, options.entityParams);
                _this.getFeb().post(EventUtil.FARRIS_APP_CLICK, linkobj);
            }
            return { func: func, linkobj: linkobj };
        })));
    };
    /**
     * 关闭前
     */
    /**
     * 关闭前
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.beforeCloseMenu = /**
     * 关闭前
     * @param {?} options
     * @return {?}
     */
    function (options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                this.appService.beforeCloseAppByOptions(options);
                break;
            case AppType.Menu:
                this.beforeCloseFuncByOptions(options);
                break;
            default: break;
        }
    };
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.beforeCloseFuncByOptions = /**
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var func = this.funcService.getCachedFunc(options.funcId);
        /** @type {?} */
        var funcObkey = EventUtil.funcObsToken(options.funcId, options.tabId);
        /** @type {?} */
        var pageId = this.getPageId(options.funcId, options.tabId);
        /** @type {?} */
        var obs = EventUtil.getObserver(EventUtil.BEFORE_FUNC_CLOSE).get(funcObkey);
        if (!obs) {
            this.closeFuncByOptions(options);
            return;
        }
        /** @type {?} */
        var eventArgs = {
            tabId: pageId,
            appType: AppType.Menu,
            funcId: options.funcId,
            tabName: func && func.Name,
            beforeCloseHandle: options.beforeCloseHandle
        };
        this.getFeb().post(EventUtil.BEFORE_FUNC_CLOSE, eventArgs);
    };
    /**
     * 菜单关闭前事件触发(无 token)
     */
    /**
     * 菜单关闭前事件触发(无 token)
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    FrameworkService.prototype.beforeCloseFunc = /**
     * 菜单关闭前事件触发(无 token)
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    function (funcId, tabId) {
        /** @type {?} */
        var func = this.funcService.getCachedFunc(funcId);
        /** @type {?} */
        var funcObkey = EventUtil.funcObsToken(funcId, tabId);
        /** @type {?} */
        var obs = EventUtil.getObserver(EventUtil.BEFORE_FUNC_CLOSE).get(funcObkey);
        if (!obs) {
            this.closeFunc(funcId, tabId);
            return;
        }
        /** @type {?} */
        var eventArgs = {
            tabId: this.getPageId(funcId, tabId),
            appType: AppType.Menu,
            funcId: funcId,
            tabName: func && func.Name
        };
        this.getFeb().post(EventUtil.BEFORE_FUNC_CLOSE, eventArgs);
    };
    /**
     * 直接关闭
     *
     */
    /**
     * 直接关闭
     *
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.closeMenu = /**
     * 直接关闭
     *
     * @param {?} options
     * @return {?}
     */
    function (options) {
        switch (options.appType && options.appType.toLowerCase()) {
            case AppType.App:
                this.appService.closeAppByOptions(options).subscribe();
                break;
            case AppType.Menu:
                this.closeFuncByOptions(options);
                break;
            default: break;
        }
    };
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    FrameworkService.prototype.closeFuncByOptions = /**
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var pageId = this.getPageId(options.funcId, options.tabId);
        EventUtil.clearObserver(EventUtil.funcObsToken(options.funcId, options.tabId));
        EventUtil.clearEventPipe(pageId); // 当前页面大对象传参会有唯一的管道
        // 当前页面大对象传参会有唯一的管道
        /** @type {?} */
        var func = this.funcService.getCachedFunc(options.funcId);
        /** @type {?} */
        var objIndex = FrmUtil.getTabArray().findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i.id === pageId && i.appType === AppType.Menu; }));
        /** @type {?} */
        var obj = FrmUtil.getTabArray()[objIndex];
        options.token = options.token || obj.formToken;
        /** @type {?} */
        var su = options.su;
        if (obj) {
            su = obj.su;
            FrmUtil.removeTab(objIndex);
            /** @type {?} */
            var eventArgs = {
                tabId: pageId,
                appType: AppType.Menu,
                funcId: options.funcId,
                tabName: func && func.name
            };
            this.getFeb().post(EventUtil.FUNC_CLOSED, eventArgs);
        }
        this.quitFunc(options, su)
            .subscribe((/**
         * @return {?}
         */
        function () { }));
    };
    /**
     * 关闭菜单tab页签，tabId可以指定，默认为funcId
     */
    /**
     * 关闭菜单tab页签，tabId可以指定，默认为funcId
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    FrameworkService.prototype.closeFunc = /**
     * 关闭菜单tab页签，tabId可以指定，默认为funcId
     * @param {?} funcId
     * @param {?=} tabId
     * @return {?}
     */
    function (funcId, tabId) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var pageId = this.getPageId(funcId, tabId);
        EventUtil.clearObserver(EventUtil.funcObsToken(funcId, tabId));
        EventUtil.clearEventPipe(pageId); // 当前页面大对象传参会有唯一的管道
        // 当前页面大对象传参会有唯一的管道
        /** @type {?} */
        var func = this.funcService.getCachedFunc(funcId);
        /** @type {?} */
        var objIndex = FrmUtil.getTabArray().findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i.id === pageId && i.appType === AppType.Menu; }));
        /** @type {?} */
        var obj = FrmUtil.getTabArray()[objIndex];
        /** @type {?} */
        var formToken = obj.formToken;
        if (obj) {
            FrmUtil.removeTab(objIndex);
            /** @type {?} */
            var eventArgs = {
                tabId: pageId,
                appType: AppType.Menu,
                funcId: funcId,
                tabName: func && func.name
            };
            self.getFeb().post(EventUtil.FUNC_CLOSED, eventArgs);
        }
        /** @type {?} */
        var options = {
            tabId: tabId,
            funcId: funcId,
            appId: '',
            appEntrance: '',
            appType: AppType.Menu,
            token: formToken,
        };
        this.quitFunc(options, obj.su)
            .subscribe((/**
         * @return {?}
         */
        function () { }));
        return of(true);
    };
    /**
     * 获取菜单的调用信息
     */
    /**
     * 获取菜单的调用信息
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.getFuncInvok = /**
     * 获取菜单的调用信息
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        var _this = this;
        /** @type {?} */
        var invoks = this.getInvokCache();
        /** @type {?} */
        var funcInvok = invoks.find((/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return f.id === funcId; }));
        if (!funcInvok) {
            return this.getInvokConfig(funcId).pipe(map((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                if (!v) {
                    return null;
                }
                invoks.push(v);
                _this.funcService.cacheAllFuncInvoks(invoks);
                return v;
            })));
        }
        return of(funcInvok);
    };
    /**
     * 获取菜单实体
     */
    /**
     * 获取菜单实体
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.getFuncEntity = /**
     * 获取菜单实体
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        var _this = this;
        /** @type {?} */
        var func = this.funcService.getCachedFunc(funcId);
        if (!func) {
            /** @type {?} */
            var url = "/api/runtime/sys/v1.0/functions/" + funcId;
            return this.http.request('Get', url, FrmUtil.setHeader(null, {}))
                .pipe(map((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                if (!v || !v[0]) {
                    return null;
                }
                /** @type {?} */
                var allFuncs = (/** @type {?} */ (_this.funcService.getAllCachedFuncs()));
                allFuncs.push(v[0]);
                _this.funcService.cacheAllFuncs(allFuncs);
                return v[0];
            })));
        }
        return of(func);
    };
    /**
     * 获取菜单预置参数
     */
    /**
     * 获取菜单预置参数
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.getPresetParams = /**
     * 获取菜单预置参数
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        var _this = this;
        return this.getFuncInvok(funcId).pipe(map((/**
         * @param {?} funcInvok
         * @return {?}
         */
        function (funcInvok) {
            /** @type {?} */
            var paramInfo = funcInvok.invokingConfig.staticParams;
            /** @type {?} */
            var entityParamInfo = funcInvok.invokingConfig.entityParams;
            /** @type {?} */
            var staticParam = paramInfo ? JSON.parse(paramInfo) : [];
            /** @type {?} */
            var entityParam = entityParamInfo ? JSON.parse(entityParamInfo) : [];
            return _this.mergeParams(staticParam, entityParam);
        })));
    };
    /**
     * 获取菜单的静态参数
     */
    /**
     * 获取菜单的静态参数
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.getStaticParam = /**
     * 获取菜单的静态参数
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        return this.getFuncInvok(funcId).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (v.invokingConfig.staticParams) {
                return JSON.parse(v.invokingConfig.staticParams);
            }
        })));
    };
    /**
     * 获取表单的实体参数
     */
    /**
     * 获取表单的实体参数
     * @param {?} tabId
     * @param {?} handler
     * @param {?=} isSubonce
     * @return {?}
     */
    FrameworkService.prototype.getEntityParam = /**
     * 获取表单的实体参数
     * @param {?} tabId
     * @param {?} handler
     * @param {?=} isSubonce
     * @return {?}
     */
    function (tabId, handler, isSubonce) {
        if (isSubonce === void 0) { isSubonce = true; }
        if (isSubonce) {
            this.getFeb().once(tabId, handler);
        }
        this.getFeb().on(tabId, handler);
    };
    /**
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.entityParamUnsub = /**
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        this.getFeb().unSubscribe(funcId);
    };
    /**
     * 获取某菜单的实体参数结构
     */
    /**
     * 获取某菜单的实体参数结构
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.getEntityParamStructure = /**
     * 获取某菜单的实体参数结构
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        return this.getFuncInvok(funcId).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (v.invokingConfig.entityParams) {
                return JSON.parse(v.invokingConfig.entityParams);
            }
        })));
    };
    /**
     * @private
     * @param {?} staticParam
     * @param {?} entityParam
     * @return {?}
     */
    FrameworkService.prototype.mergeParams = /**
     * @private
     * @param {?} staticParam
     * @param {?} entityParam
     * @return {?}
     */
    function (staticParam, entityParam) {
        /** @type {?} */
        var paraMap = new Map();
        if (entityParam) {
            entityParam.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                paraMap.set(item.name, item.value);
            }));
        }
        if (staticParam) {
            // func上对app参数复用
            staticParam.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                paraMap.set(item.name, item.value);
            }));
        }
        return paraMap;
    };
    /**
     * @private
     * @param {?} funcId
     * @return {?}
     */
    FrameworkService.prototype.getInvokConfig = /**
     * @private
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        /** @type {?} */
        var url = "/api/runtime/sys/v1.0/functions/funcInvok/" + funcId;
        return this.http.request('Get', url, FrmUtil.setHeader(null, {}));
    };
    /**
     * @private
     * @return {?}
     */
    FrameworkService.prototype.getInvokCache = /**
     * @private
     * @return {?}
     */
    function () {
        return this.funcService.getAllCachedFuncInvoks();
    };
    /**
     * 获取框架eventbus
     */
    /**
     * 获取框架eventbus
     * @private
     * @return {?}
     */
    FrameworkService.prototype.getFeb = /**
     * 获取框架eventbus
     * @private
     * @return {?}
     */
    function () {
        return EventUtil.getFrmEvent();
    };
    /**
     * 构造功能及session
     * (1912 funcSession移除后，接口不再提供)
     */
    /**
     * 构造功能及session
     * (1912 funcSession移除后，接口不再提供)
     * @param {?} funcId
     * @param {?=} su
     * @return {?}
     */
    FrameworkService.prototype.buildFuncSession = /**
     * 构造功能及session
     * (1912 funcSession移除后，接口不再提供)
     * @param {?} funcId
     * @param {?=} su
     * @return {?}
     */
    function (funcId, su) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var userSession = this.sessionSvc.getUserSessionId();
        /** @type {?} */
        var body = {
            token: userSession,
            funcId: funcId,
            action: 'enter'
        };
        /** @type {?} */
        var bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : "?su=" + su);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(userSession, { body: body })).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            /** @type {?} */
            var ss = v.sessionId;
            if (ss !== undefined && ss !== null && ss.length > 0) {
                self.sessionSvc.setFuncSessionId(funcId, ss);
            }
            return ss;
        })));
    };
    /**
     * 进入功能，触发服务端逻辑
     * 移除funcSession
     * 返回公共变量token
     */
    /**
     * 进入功能，触发服务端逻辑
     * 移除funcSession
     * 返回公共变量token
     * @private
     * @param {?} enterParam
     * @param {?} su
     * @return {?}
     */
    FrameworkService.prototype.enterFunc = /**
     * 进入功能，触发服务端逻辑
     * 移除funcSession
     * 返回公共变量token
     * @private
     * @param {?} enterParam
     * @param {?} su
     * @return {?}
     */
    function (enterParam, su) {
        /** @type {?} */
        var bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : "?su=" + su);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(null, { body: enterParam }))
            .pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            return v.token || v.sessionId;
        })));
    };
    /**
     * 退出功能，如果存在bizContext，则移除
     */
    /**
     * 退出功能，如果存在bizContext，则移除
     * @private
     * @param {?} options
     * @param {?} su
     * @return {?}
     */
    FrameworkService.prototype.quitFunc = /**
     * 退出功能，如果存在bizContext，则移除
     * @private
     * @param {?} options
     * @param {?} su
     * @return {?}
     */
    function (options, su) {
        /** @type {?} */
        var body = {
            token: options.token,
            tabId: options.tabId,
            funcId: options.funcId,
            action: 'quit'
        };
        /** @type {?} */
        var bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : "?su=" + su);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(null, { body: body }));
    };
    /**
     * 获取当前应用所属su
     */
    /**
     * 获取当前应用所属su
     * @private
     * @param {?} url
     * @return {?}
     */
    FrameworkService.prototype.getSu = /**
     * 获取当前应用所属su
     * @private
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var uriArr = url.split('/');
        return uriArr.length > 3 ? uriArr[3] : '';
    };
    /**
     * iframe url拼接 querystring 参数
     */
    /**
     * iframe url拼接 querystring 参数
     * @private
     * @param {?} routurl
     * @param {?} funcId
     * @param {?} params
     * @return {?}
     */
    FrameworkService.prototype.buildQueryString = /**
     * iframe url拼接 querystring 参数
     * @private
     * @param {?} routurl
     * @param {?} funcId
     * @param {?} params
     * @return {?}
     */
    function (routurl, funcId, params) {
        if (routurl.indexOf('?') < 0) {
            routurl += "?funcId=" + funcId;
        }
        else {
            routurl += "&funcId=" + funcId;
        }
        if (params) {
            Object.keys(params).forEach((/**
             * @param {?} propName
             * @param {?} index
             * @return {?}
             */
            function (propName, index) {
                routurl += "" + (index === 0 ? '' : '&') + propName + "=" + params[propName];
            }));
        }
        return routurl;
    };
    /**
     * url 拼接map格式的参数
     */
    /**
     * url 拼接map格式的参数
     * @private
     * @param {?} routurl
     * @param {?} funcId
     * @param {?} tabId
     * @param {?} token
     * @param {?} params
     * @return {?}
     */
    FrameworkService.prototype.buildQueryStringByMap = /**
     * url 拼接map格式的参数
     * @private
     * @param {?} routurl
     * @param {?} funcId
     * @param {?} tabId
     * @param {?} token
     * @param {?} params
     * @return {?}
     */
    function (routurl, funcId, tabId, token, params) {
        if (routurl.indexOf('?') < 0) {
            routurl += "?funcId=" + funcId;
        }
        else {
            routurl += "&funcId=" + funcId;
        }
        routurl += "&appType=" + AppType.Menu;
        routurl += "&tabId=" + this.getPageId(funcId, tabId);
        routurl += !token ? '' : "&cvft=" + token;
        if (params) {
            params.forEach((/**
             * @param {?} value
             * @param {?} key
             * @return {?}
             */
            function (value, key) {
                routurl += !key ? '' : "&" + key + "=" + value;
            }));
        }
        return routurl;
    };
    /**
     * 获取当前菜单页面的唯一标识
     */
    /**
     * 获取当前菜单页面的唯一标识
     * @private
     * @param {?} funcId
     * @param {?} tabId
     * @return {?}
     */
    FrameworkService.prototype.getPageId = /**
     * 获取当前菜单页面的唯一标识
     * @private
     * @param {?} funcId
     * @param {?} tabId
     * @return {?}
     */
    function (funcId, tabId) {
        return tabId || funcId;
    };
    /**
     * 页面第一次被打开时，生成唯一标识
     */
    /**
     * 页面第一次被打开时，生成唯一标识
     * @private
     * @param {?} funcId
     * @param {?} tabId
     * @return {?}
     */
    FrameworkService.prototype.newPageId = /**
     * 页面第一次被打开时，生成唯一标识
     * @private
     * @param {?} funcId
     * @param {?} tabId
     * @return {?}
     */
    function (funcId, tabId) {
        return tabId ? funcId + "_" + tabId : funcId;
    };
    /**
     * @param {?} token
     * @param {?} args
     * @return {?}
     */
    FrameworkService.prototype.eventFire = /**
     * @param {?} token
     * @param {?} args
     * @return {?}
     */
    function (token, args) {
        /** @type {?} */
        var feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.post !== 'function') {
            return;
        }
        feb.post(token, args);
    };
    /**
     * @param {?} token
     * @param {?} handler
     * @param {?=} options
     * @return {?}
     */
    FrameworkService.prototype.eventListner = /**
     * @param {?} token
     * @param {?} handler
     * @param {?=} options
     * @return {?}
     */
    function (token, handler, options) {
        /** @type {?} */
        var feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.on !== 'function') {
            return;
        }
        // 菜单监听者必须要声明自己的身份，方便框架管理
        if (options && options.appType) {
            switch (options.appType.toLowerCase()) {
                case AppType.App:
                    /** @type {?} */
                    var appObkey = EventUtil.appObsToken(options.appId, options.appEntrance, options.tabId);
                    feb.onWithObkey(token, appObkey, handler);
                    return;
                case AppType.Menu:
                    /** @type {?} */
                    var funcObkey = EventUtil.funcObsToken(options.funcId, options.tabId);
                    feb.onWithObkey(token, funcObkey, handler);
                    return;
                default: break;
            }
        }
        feb.on(token, handler);
    };
    /** 创建监听订阅, 维护一个监听者列表，针对菜单触发事件 */
    /**
     * 创建监听订阅, 维护一个监听者列表，针对菜单触发事件
     * @param {?} token
     * @param {?} funcId
     * @param {?} handler
     * @return {?}
     */
    FrameworkService.prototype.eventListner4Func = /**
     * 创建监听订阅, 维护一个监听者列表，针对菜单触发事件
     * @param {?} token
     * @param {?} funcId
     * @param {?} handler
     * @return {?}
     */
    function (token, funcId, handler) {
        /** @type {?} */
        var feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.on !== 'function') {
            return;
        }
        feb.onWithObkey(token, funcId, handler);
    };
    /** 创建监听订阅, 维护一个监听者列表，针对应用触发事件 */
    /**
     * 创建监听订阅, 维护一个监听者列表，针对应用触发事件
     * @param {?} token
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} handler
     * @return {?}
     */
    FrameworkService.prototype.eventListner4App = /**
     * 创建监听订阅, 维护一个监听者列表，针对应用触发事件
     * @param {?} token
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} handler
     * @return {?}
     */
    function (token, appId, appEntrance, handler) {
        /** @type {?} */
        var feb = EventUtil.getFrmEvent();
        if (!feb || typeof feb.on !== 'function') {
            return;
        }
        /** @type {?} */
        var appObkey = EventUtil.appObsToken(appId, appEntrance);
        feb.onWithObkey(token, appObkey, handler);
    };
    FrameworkService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FrameworkService.ctorParameters = function () { return [
        { type: HttpService },
        { type: Router },
        { type: CacheService },
        { type: SessionService },
        { type: FrmEventBus },
        { type: FuncsService },
        { type: LoadingService },
        { type: AppService, decorators: [{ type: Optional }] },
        { type: FrmI18nSettingService, decorators: [{ type: Optional }] }
    ]; };
    return FrameworkService;
}());
export { FrameworkService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.FUNCSTATUS_PATH;
    /** @type {?} */
    FrameworkService.prototype.BeforeFuncClose;
    /** @type {?} */
    FrameworkService.prototype.FuncClosed;
    /** @type {?} */
    FrameworkService.prototype.FuncSwitch;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.router;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.cache;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.sessionSvc;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.feb;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.funcService;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.loadService;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.appService;
    /**
     * @type {?}
     * @private
     */
    FrameworkService.prototype.i18nSetting;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWV3b3Jrc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3J0Zi1jb21tb24vIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZnJtc2VydmljZS9mcmFtZXdvcmtzZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFekMsT0FBTyxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQWMsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakcsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUE2QyxNQUFNLHVCQUF1QixDQUFDO0FBQy9HLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUM1RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUU1RjtJQVFJLDBCQUNZLElBQWlCLEVBQ2pCLE1BQWMsRUFDZCxLQUFtQixFQUNuQixVQUEwQixFQUMxQixHQUFnQixFQUNoQixXQUF5QixFQUN6QixXQUEyQixFQUNmLFVBQXNC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VUFBVSxFQUFFO1lBQ3RDLE9BQU87U0FDVjs7WUFDSyxRQUFRLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsV0FBVyxDQUFDO1FBQzFELEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5QyxDQUFDOztnQkF2dEJKLFVBQVU7Ozs7Z0JBTlksV0FBVztnQkFSekIsTUFBTTtnQkFRTixZQUFZO2dCQUFnQyxjQUFjO2dCQUwxRCxXQUFXO2dCQUVYLFlBQVk7Z0JBRFosY0FBYztnQkFNZCxVQUFVLHVCQW9CVixRQUFRO2dCQW5CUixxQkFBcUIsdUJBb0JyQixRQUFROztJQXdzQmpCLHVCQUFDO0NBQUEsQUF6dEJELElBeXRCQztTQXh0QlksZ0JBQWdCOzs7Ozs7SUFFekIsMkNBQWtFOztJQUNsRSwyQ0FBcUQ7O0lBQ3JELHNDQUEwQzs7SUFDMUMsc0NBQTBDOzs7OztJQUd0QyxnQ0FBeUI7Ozs7O0lBQ3pCLGtDQUFzQjs7Ozs7SUFDdEIsaUNBQTJCOzs7OztJQUMzQixzQ0FBa0M7Ozs7O0lBQ2xDLCtCQUF3Qjs7Ozs7SUFDeEIsdUNBQWlDOzs7OztJQUNqQyx1Q0FBbUM7Ozs7O0lBQ25DLHNDQUEwQzs7Ozs7SUFDMUMsdUNBQXNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgT3BlbmZ1bmNPcHRpb25zIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2Z1bmN0aW9uLm1vZGVsJztcclxuaW1wb3J0IHsgb2YsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRnJtRXZlbnRCdXMgfSBmcm9tICcuLi8uLi9ldmVudGJ1cy9mcm0tZXZlbmJ1cyc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vbG9hZGluZy9sb2FkaW5nLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGdW5jc1NlcnZpY2UgfSBmcm9tICcuLi9mdW5jc3NlcnZpY2UvZnVuY3Muc2VydmljZSc7XHJcbmltcG9ydCB7IElmcmFtZUxpbmsgfSBmcm9tICcuLi8uLi9tb2RlbHMvaWZyYW1lLm1vZGVsJztcclxuaW1wb3J0IHsgbWFwLCBzd2l0Y2hNYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENhY2hlU2VydmljZSwgSHR0cFNlcnZpY2UsIExhbmd1YWdlU2VydmljZSwgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgRXZlbnRVdGlsLCBGcm1VdGlsLCBBcHBUeXBlLCBGdW5jRXZlbnRBcmdzLCBBcHBPcHRpb25zLCBGdW5jU3RhdGVQYXJhbSB9IGZyb20gJy4uLy4uL3NoYXJlZC9mcm0tdXRpbCc7XHJcbmltcG9ydCB7IEFwcFNlcnZpY2UgfSBmcm9tICcuLi9hcHBzZXJ2aWNlL2FwcC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRnJtSTE4blNldHRpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vaTE4blNlcnZpY2UvaTE4bi1zZXR0aW5nLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtWYXJpYWJsZVNlcnZpY2UgfSBmcm9tICcuLi9mcm1WYXJpYWJsZVNlcnZpY2UvZnJhbWV3b3JrLXZhcmlhYmxlLnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRnJhbWV3b3JrU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSBGVU5DU1RBVFVTX1BBVEggPSAnL2FwaS9ydW50aW1lL3N5cy92MS4wL2Z1bmN0aW9uLXN0YXRlcyc7XHJcbiAgICBwdWJsaWMgQmVmb3JlRnVuY0Nsb3NlID0gRXZlbnRVdGlsLkJFRk9SRV9GVU5DX0NMT1NFO1xyXG4gICAgcHVibGljIEZ1bmNDbG9zZWQgPSBFdmVudFV0aWwuRlVOQ19DTE9TRUQ7XHJcbiAgICBwdWJsaWMgRnVuY1N3aXRjaCA9IEV2ZW50VXRpbC5GVU5DX1NXSVRDSDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHBTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBjYWNoZTogQ2FjaGVTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgc2Vzc2lvblN2YzogU2Vzc2lvblNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBmZWI6IEZybUV2ZW50QnVzLFxyXG4gICAgICAgIHByaXZhdGUgZnVuY1NlcnZpY2U6IEZ1bmNzU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGxvYWRTZXJ2aWNlOiBMb2FkaW5nU2VydmljZSxcclxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGFwcFNlcnZpY2U6IEFwcFNlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpMThuU2V0dGluZzogRnJtSTE4blNldHRpbmdTZXJ2aWNlXHJcbiAgICApIHtcclxuICAgICAgICBpZiAoIXRoaXMuaTE4blNldHRpbmcpIHtcclxuICAgICAgICAgICAgY29uc3QgdmFyaWFibGVzID0gbmV3IEZyYW1ld29ya1ZhcmlhYmxlU2VydmljZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBsYW5ndWFnZSA9IG5ldyBMYW5ndWFnZVNlcnZpY2UobnVsbCk7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blNldHRpbmcgPSBuZXcgRnJtSTE4blNldHRpbmdTZXJ2aWNlKHZhcmlhYmxlcywgbGFuZ3VhZ2UsIGh0dHApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuYXBwU2VydmljZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcFNlcnZpY2UgPSBuZXcgQXBwU2VydmljZSh0aGlzLmh0dHAsIHRoaXMuc2Vzc2lvblN2YywgdGhpcy5pMThuU2V0dGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2uZnVuY2lk5omT5byA5Yqf6IO96I+c5Y2VXHJcbiAgICAgKiAo6YCC55So5LqO5Y2V6aG1562+6Lev55Sx77yM5LiN5pSv5oyBTkc35Y2H57qn5ZCO6I+c5Y2V5LmL6Ze06Lez6L2sKVxyXG4gICAgICovXHJcbiAgICBvcGVuRnVuYyhmdW5jaWQ6IHN0cmluZywgcm91dGVwYXRoOiBzdHJpbmcsIHBhcmVudHNlc3Npb25pZDogc3RyaW5nLCBuZXdzZXNzaW9uOiBib29sZWFuID0gdHJ1ZSwgc2ltcGxlcGFyYW06IHN0cmluZyA9ICcnKTogYW55IHtcclxuXHJcbiAgICAgICAgY29uc3QgYXBwT3BzOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXHJcbiAgICAgICAgICAgIGZ1bmNJZDogZnVuY2lkLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcGVuKGFwcE9wcyk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIC8vIHJldHVybiB0aGlzLmludGVybmFsT3BlbiQoYXBwT3BzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOebtOaOpeaJk+W8gOWKn+iDvVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3Blbk1lbnUob3B0aW9uczogQXBwT3B0aW9ucykge1xyXG4gICAgICAgIHN3aXRjaCAob3B0aW9ucy5hcHBUeXBlICYmIG9wdGlvbnMuYXBwVHlwZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5BcHA6XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuYXBwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ+WPguaVsGFwcElk5LiN6IO95Li656m677yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBTZXJ2aWNlLm9wZW5BcHBCeU9wdGlvbnMob3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLk1lbnU6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmludGVybmFsT3BlbihvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEFwcFR5cGUuT3RoZXI6IGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmui/h+a1geaWueW8j+aJk+W8gOWKn+iDvVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3Blbk1lbnUkKG9wdGlvbnM6IEFwcE9wdGlvbnMpIHtcclxuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuYXBwVHlwZSAmJiBvcHRpb25zLmFwcFR5cGUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICBjYXNlIEFwcFR5cGUuQXBwOlxyXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmFwcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCflj4LmlbBhcHBJZOS4jeiDveS4uuepuu+8gScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFwcFNlcnZpY2Uub3BlbkFwcEJ5T3B0aW9ucyQob3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5NZW51OlxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMub25seUdldElmcmFtZUxpbmsgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnRlcm5hbE9wZW5CeUlmcmFtZUxpbmskKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxPcGVuJChvcHRpb25zKTtcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLk90aGVyOiBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiZPlvIDogZTmn6Xoj5zljZVcclxuICAgICAqL1xyXG4gICAgb3BlbkNvbm5lY3RlZEZ1bmMoZnVuY0lkOiBzdHJpbmcsIG9wdGlvbnM6IE9wZW5mdW5jT3B0aW9ucykge1xyXG4gICAgICAgIGNvbnN0IGFwcE9wczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxyXG4gICAgICAgICAgICBmdW5jSWQsXHJcbiAgICAgICAgICAgIGFwcElkOiAnJyxcclxuICAgICAgICAgICAgYXBwRW50cmFuY2U6ICcnLFxyXG4gICAgICAgICAgICBlbnRpdHlQYXJhbXM6IG9wdGlvbnMuRW50aXR5UGFyYW0sXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5pbnRlcm5hbE9wZW4oYXBwT3BzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJk+W8gOiBlOafpeiPnOWNle+8jOW5tuS8oOWPglxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlbkZ1bmNXaXRoUGFyYW0oZnVuY0lkOiBzdHJpbmcsIHBhcmFtczogTWFwPHN0cmluZywgc3RyaW5nPiwgcmVsb2FkPzogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcclxuICAgICAgICAgICAgZnVuY0lkLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgICAgZW50aXR5UGFyYW1zOiBwYXJhbXMsXHJcbiAgICAgICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1zOiBwYXJhbXMsXHJcbiAgICAgICAgICAgIGlzUmVsb2FkOiByZWxvYWRcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxPcGVuKG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5omT5byA5Yqf6IO977yM5LiN6L+U5Zue5rWBXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaW50ZXJuYWxPcGVuKG9wdGlvbnM6IEFwcE9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLmNoZWNraW5nQmVmb3JlT3BlbiQob3B0aW9ucylcclxuICAgICAgICAgICAgLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXMgfHwgIXJlcy5mdW5jIHx8IHJlcy5saW5rb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnVuYyA9IHJlcy5mdW5jO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0SW52b2tlQW5kRW50ZXJGdW5jJChvcHRpb25zLCBmdW5jKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChsb2JqOiBJZnJhbWVMaW5rKSA9PiB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZBUlJJU19BUFBfQ0xJQ0ssIGxvYmopLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0VycjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJJbmZvOiBlcnJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZBUlJJU19BUFBfQ0xJQ0ssIGluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmui/h+S4sua1geaOp+WItu+8jOaJk+W8gOiPnOWNlVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGludGVybmFsT3BlbiQob3B0aW9uczogQXBwT3B0aW9ucyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tpbmdCZWZvcmVPcGVuJChvcHRpb25zKVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcyB8fCAhcmVzLmZ1bmMgfHwgcmVzLmxpbmtvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdW5jID0gcmVzLmZ1bmM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEludm9rZUFuZEVudGVyRnVuYyQob3B0aW9ucywgZnVuYykucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobG9iajogSWZyYW1lTGluaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZBUlJJU19BUFBfQ0xJQ0ssIGxvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCa6L+H5Liy5rWB6I635Y+W6KKr5omT5byA6I+c5Y2V55qEaWZyYW1lTGlua+WvueixoeS/oeaBr1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGludGVybmFsT3BlbkJ5SWZyYW1lTGluayQob3B0aW9uczogQXBwT3B0aW9ucyk6IE9ic2VydmFibGU8SWZyYW1lTGluaz4ge1xyXG5cclxuICAgICAgICBpZiAoIW9wdGlvbnMuZnVuY0lkKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5hbGVydCgn5Y+C5pWwZnVuY0lk5LiN6IO95Li656m677yBJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEZ1bmNFbnRpdHkob3B0aW9ucy5mdW5jSWQpLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgIGZ1bmMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoYOivt+ehruiupOaCqOaYr+WQpuWFt+Wkh+aJk+W8gOiPnOWNlShJRDoke29wdGlvbnMuZnVuY0lkfSnnmoTmnYPpmZBgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEludm9rZUFuZEVudGVyRnVuYyQob3B0aW9ucywgZnVuYyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW52b2tlQW5kRW50ZXJGdW5jJChvcHRpb25zOiBBcHBPcHRpb25zLCBmdW5jOiBhbnkpOiBPYnNlcnZhYmxlPElmcmFtZUxpbms+IHtcclxuICAgICAgICBjb25zdCBuZXdQYWdlSWQgPSB0aGlzLm5ld1BhZ2VJZChvcHRpb25zLmZ1bmNJZCwgb3B0aW9ucy50YWJJZCk7XHJcbiAgICAgICAgb3B0aW9ucy50YWJJZCA9IG5ld1BhZ2VJZDtcclxuICAgICAgICBsZXQgbGlua29iajogSWZyYW1lTGluaztcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGdW5jSW52b2sob3B0aW9ucy5mdW5jSWQpLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgIGZ1bmNJbnZvayA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvdXR1cmwgPSBmdW5jSW52b2suaW52b2tpbmdDb25maWcudXJsO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtSW5mbyA9IGZ1bmNJbnZvay5pbnZva2luZ0NvbmZpZy5zdGF0aWNQYXJhbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50aXR5UGFyYW1JbmZvID0gZnVuY0ludm9rLmludm9raW5nQ29uZmlnLmVudGl0eVBhcmFtcztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0aWNQYXJhbSA9IHBhcmFtSW5mbyA/IEpTT04ucGFyc2UocGFyYW1JbmZvKSA6ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eVBhcmFtID0gZW50aXR5UGFyYW1JbmZvID8gSlNPTi5wYXJzZShlbnRpdHlQYXJhbUluZm8pIDogJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1ID0gdGhpcy5nZXRTdShyb3V0dXJsKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbnRlckZ1bmMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJJZDogbmV3UGFnZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jSWQ6IG9wdGlvbnMuZnVuY0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZW51TmFtZTogb3B0aW9ucy50YWJOYW1lIHx8IGZ1bmMubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZW50ZXInXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgc3UpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1Ub2tlbiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iaiA9IG5ldyBJZnJhbWVMaW5rKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRRdWVyeVN0cmluZ0J5TWFwKHJvdXR1cmwsIG9wdGlvbnMuZnVuY0lkLCBvcHRpb25zLnRhYklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybVRva2VuLCBvcHRpb25zLnF1ZXJ5U3RyaW5nUGFyYW1zKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouaWQgPSBuZXdQYWdlSWQ7IC8vIOmhtemdouWUr+S4gOagh+ivhiDlhYHorrjpobXpnaLph43lpI3miZPlvIBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLmFwcFR5cGUgPSBBcHBUeXBlLk1lbnU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5mdW5jSWQgPSBvcHRpb25zLmZ1bmNJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLkZ1bmNOYW1lID0gb3B0aW9ucy50YWJOYW1lIHx8IGZ1bmMubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLnVybCA9IGZ1bmNJbnZvay5pbnZva2luZ0NvbmZpZy51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5yZWxvYWQgPSBvcHRpb25zLmlzUmVsb2FkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouc3UgPSBzdTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLmlzTmV3VGFiID0gb3B0aW9ucy5pc05ld1RhYjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLmZvcm1Ub2tlbiA9IGZvcm1Ub2tlbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRpY1BhcmFtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRreeeJueauiuWcuuaZr++8jOaJk+W8gGpxdWVyeeWOn+eUn+WKn+iDvVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWNQYXJhbS5mb3JFYWNoKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ubmFtZSA9PT0gJ2pxdWVyeScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5pc2pxdWVyeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm5hbWUgPT09ICdtb2RlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLm1vZGUgPSBpdGVtLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLnNyYyArPSAoaXRlbS52YWx1ZSA/IGAmYXBwTW9kZT0ke2l0ZW0udmFsdWV9JmAgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlpKflr7nosaHlrp7kvZPkvKDlj4LvvIzpkojlr7nooqvmiZPlvIDpobXpnaLlu7rnq4vllK/kuIDnrqHpgZNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QobmV3UGFnZUlkLCBvcHRpb25zLmVudGl0eVBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GQVJSSVNfQVBQX0NMSUNLLCBsaW5rb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlua29iajtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUxpbmsgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmkxOG5TZXR0aW5nLmdldFNldHRpbmckKCkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCkgPT4gZm9ybUxpbmtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa1geaWueW8j+ajgOafpeiPnOWNleaJk+W8gOeKtuaAgVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNoZWNraW5nQmVmb3JlT3BlbiQob3B0aW9uczogQXBwT3B0aW9ucyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgaWYgKCFvcHRpb25zLmZ1bmNJZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ+WPguaVsGZ1bmNJZOS4jeiDveS4uuepuu+8gScpO1xyXG4gICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGdW5jRW50aXR5KG9wdGlvbnMuZnVuY0lkKS5waXBlKG1hcChcclxuICAgICAgICAgICAgZnVuYyA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWZ1bmMpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoYOivt+ehruiupOaCqOaYr+WQpuWFt+Wkh+aJk+W8gOiPnOWNlShJRDoke29wdGlvbnMuZnVuY0lkfSnnmoTmnYPpmZBgKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBmdW5jSWQgPSBvcHRpb25zLmZ1bmNJZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRhYklkID0gb3B0aW9ucy50YWJJZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBhZ2VJZCA9IHRoaXMuZ2V0UGFnZUlkKGZ1bmNJZCwgdGFiSWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGlua29iaiA9IEZybVV0aWwuZ2V0VGFiQXJyYXkoKS5maW5kKGkgPT4gaS5pZCA9PT0gcGFnZUlkICYmIGkuYXBwVHlwZSA9PT0gQXBwVHlwZS5NZW51KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobGlua29iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmtvYmouRnVuY05hbWUgPSBvcHRpb25zLnRhYk5hbWUgfHwgbGlua29iai5GdW5jTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLnNyYyA9IHRoaXMuYnVpbGRRdWVyeVN0cmluZ0J5TWFwKGxpbmtvYmoudXJsLCBmdW5jSWQsIG9wdGlvbnMudGFiSWQsICcnLCBvcHRpb25zLnF1ZXJ5U3RyaW5nUGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLnJlbG9hZCA9IG9wdGlvbnMuaXNSZWxvYWQ7IC8vIOeVjOmdouWIt+aWsOS4jeaUuXNlc3Npb25cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QocGFnZUlkLCBvcHRpb25zLmVudGl0eVBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GQVJSSVNfQVBQX0NMSUNLLCBsaW5rb2JqKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB7IGZ1bmMsIGxpbmtvYmogfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YWz6Zet5YmNXHJcbiAgICAgKi9cclxuICAgIGJlZm9yZUNsb3NlTWVudShvcHRpb25zOiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLmFwcFR5cGUgJiYgb3B0aW9ucy5hcHBUeXBlLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLkFwcDpcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwU2VydmljZS5iZWZvcmVDbG9zZUFwcEJ5T3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEFwcFR5cGUuTWVudTpcclxuICAgICAgICAgICAgICAgIHRoaXMuYmVmb3JlQ2xvc2VGdW5jQnlPcHRpb25zKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJlZm9yZUNsb3NlRnVuY0J5T3B0aW9ucyhvcHRpb25zOiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuZnVuY1NlcnZpY2UuZ2V0Q2FjaGVkRnVuYyhvcHRpb25zLmZ1bmNJZCk7XHJcbiAgICAgICAgY29uc3QgZnVuY09ia2V5ID0gRXZlbnRVdGlsLmZ1bmNPYnNUb2tlbihvcHRpb25zLmZ1bmNJZCwgb3B0aW9ucy50YWJJZCk7XHJcbiAgICAgICAgY29uc3QgcGFnZUlkID0gdGhpcy5nZXRQYWdlSWQob3B0aW9ucy5mdW5jSWQsIG9wdGlvbnMudGFiSWQpO1xyXG5cclxuICAgICAgICBjb25zdCBvYnMgPSBFdmVudFV0aWwuZ2V0T2JzZXJ2ZXIoRXZlbnRVdGlsLkJFRk9SRV9GVU5DX0NMT1NFKS5nZXQoZnVuY09ia2V5KTtcclxuICAgICAgICBpZiAoIW9icykge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlRnVuY0J5T3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZXZlbnRBcmdzOiBGdW5jRXZlbnRBcmdzID0ge1xyXG4gICAgICAgICAgICB0YWJJZDogcGFnZUlkLFxyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXHJcbiAgICAgICAgICAgIGZ1bmNJZDogb3B0aW9ucy5mdW5jSWQsXHJcbiAgICAgICAgICAgIHRhYk5hbWU6IGZ1bmMgJiYgZnVuYy5OYW1lLFxyXG4gICAgICAgICAgICBiZWZvcmVDbG9zZUhhbmRsZTogb3B0aW9ucy5iZWZvcmVDbG9zZUhhbmRsZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5CRUZPUkVfRlVOQ19DTE9TRSwgZXZlbnRBcmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiPnOWNleWFs+mXreWJjeS6i+S7tuinpuWPkSjml6AgdG9rZW4pXHJcbiAgICAgKi9cclxuICAgIGJlZm9yZUNsb3NlRnVuYyhmdW5jSWQ6IHN0cmluZywgdGFiSWQ/OiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5mdW5jU2VydmljZS5nZXRDYWNoZWRGdW5jKGZ1bmNJZCk7XHJcbiAgICAgICAgY29uc3QgZnVuY09ia2V5ID0gRXZlbnRVdGlsLmZ1bmNPYnNUb2tlbihmdW5jSWQsIHRhYklkKTtcclxuXHJcbiAgICAgICAgY29uc3Qgb2JzID0gRXZlbnRVdGlsLmdldE9ic2VydmVyKEV2ZW50VXRpbC5CRUZPUkVfRlVOQ19DTE9TRSkuZ2V0KGZ1bmNPYmtleSk7XHJcbiAgICAgICAgaWYgKCFvYnMpIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUZ1bmMoZnVuY0lkLCB0YWJJZCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGV2ZW50QXJnczogRnVuY0V2ZW50QXJncyA9IHtcclxuICAgICAgICAgICAgdGFiSWQ6IHRoaXMuZ2V0UGFnZUlkKGZ1bmNJZCwgdGFiSWQpLFxyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXHJcbiAgICAgICAgICAgIGZ1bmNJZCxcclxuICAgICAgICAgICAgdGFiTmFtZTogZnVuYyAmJiBmdW5jLk5hbWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuQkVGT1JFX0ZVTkNfQ0xPU0UsIGV2ZW50QXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnm7TmjqXlhbPpl61cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGNsb3NlTWVudShvcHRpb25zOiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgc3dpdGNoIChvcHRpb25zLmFwcFR5cGUgJiYgb3B0aW9ucy5hcHBUeXBlLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgY2FzZSBBcHBUeXBlLkFwcDpcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwU2VydmljZS5jbG9zZUFwcEJ5T3B0aW9ucyhvcHRpb25zKS5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEFwcFR5cGUuTWVudTpcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VGdW5jQnlPcHRpb25zKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNsb3NlRnVuY0J5T3B0aW9ucyhvcHRpb25zOiBBcHBPcHRpb25zKSB7XHJcbiAgICAgICAgY29uc3QgcGFnZUlkID0gdGhpcy5nZXRQYWdlSWQob3B0aW9ucy5mdW5jSWQsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgIEV2ZW50VXRpbC5jbGVhck9ic2VydmVyKEV2ZW50VXRpbC5mdW5jT2JzVG9rZW4ob3B0aW9ucy5mdW5jSWQsIG9wdGlvbnMudGFiSWQpKTtcclxuICAgICAgICBFdmVudFV0aWwuY2xlYXJFdmVudFBpcGUocGFnZUlkKTsgLy8g5b2T5YmN6aG16Z2i5aSn5a+56LGh5Lyg5Y+C5Lya5pyJ5ZSv5LiA55qE566h6YGTXHJcbiAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuZnVuY1NlcnZpY2UuZ2V0Q2FjaGVkRnVuYyhvcHRpb25zLmZ1bmNJZCk7XHJcbiAgICAgICAgY29uc3Qgb2JqSW5kZXggPSBGcm1VdGlsLmdldFRhYkFycmF5KCkuZmluZEluZGV4KGkgPT4gaS5pZCA9PT0gcGFnZUlkICYmIGkuYXBwVHlwZSA9PT0gQXBwVHlwZS5NZW51KTtcclxuICAgICAgICBjb25zdCBvYmogPSBGcm1VdGlsLmdldFRhYkFycmF5KClbb2JqSW5kZXhdO1xyXG4gICAgICAgIG9wdGlvbnMudG9rZW4gPSBvcHRpb25zLnRva2VuIHx8IG9iai5mb3JtVG9rZW47XHJcbiAgICAgICAgbGV0IHN1ID0gb3B0aW9ucy5zdTtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIHN1ID0gb2JqLnN1O1xyXG4gICAgICAgICAgICBGcm1VdGlsLnJlbW92ZVRhYihvYmpJbmRleCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50QXJnczogRnVuY0V2ZW50QXJncyA9IHtcclxuICAgICAgICAgICAgICAgIHRhYklkOiBwYWdlSWQsXHJcbiAgICAgICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLk1lbnUsXHJcbiAgICAgICAgICAgICAgICBmdW5jSWQ6IG9wdGlvbnMuZnVuY0lkLFxyXG4gICAgICAgICAgICAgICAgdGFiTmFtZTogZnVuYyAmJiBmdW5jLm5hbWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GVU5DX0NMT1NFRCwgZXZlbnRBcmdzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5xdWl0RnVuYyhvcHRpb25zLCBzdSlcclxuICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7IH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YWz6Zet6I+c5Y2VdGFi6aG1562+77yMdGFiSWTlj6/ku6XmjIflrprvvIzpu5jorqTkuLpmdW5jSWRcclxuICAgICAqL1xyXG4gICAgY2xvc2VGdW5jKGZ1bmNJZDogc3RyaW5nLCB0YWJJZD86IHN0cmluZyk6IGFueSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgcGFnZUlkID0gdGhpcy5nZXRQYWdlSWQoZnVuY0lkLCB0YWJJZCk7XHJcbiAgICAgICAgRXZlbnRVdGlsLmNsZWFyT2JzZXJ2ZXIoRXZlbnRVdGlsLmZ1bmNPYnNUb2tlbihmdW5jSWQsIHRhYklkKSk7XHJcbiAgICAgICAgRXZlbnRVdGlsLmNsZWFyRXZlbnRQaXBlKHBhZ2VJZCk7IC8vIOW9k+WJjemhtemdouWkp+WvueixoeS8oOWPguS8muacieWUr+S4gOeahOeuoemBk1xyXG4gICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLmZ1bmNTZXJ2aWNlLmdldENhY2hlZEZ1bmMoZnVuY0lkKTtcclxuICAgICAgICBjb25zdCBvYmpJbmRleCA9IEZybVV0aWwuZ2V0VGFiQXJyYXkoKS5maW5kSW5kZXgoaSA9PiBpLmlkID09PSBwYWdlSWQgJiYgaS5hcHBUeXBlID09PSBBcHBUeXBlLk1lbnUpO1xyXG4gICAgICAgIGNvbnN0IG9iaiA9IEZybVV0aWwuZ2V0VGFiQXJyYXkoKVtvYmpJbmRleF07XHJcbiAgICAgICAgY29uc3QgZm9ybVRva2VuID0gb2JqLmZvcm1Ub2tlbjtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIEZybVV0aWwucmVtb3ZlVGFiKG9iakluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgZXZlbnRBcmdzOiBGdW5jRXZlbnRBcmdzID0ge1xyXG4gICAgICAgICAgICAgICAgdGFiSWQ6IHBhZ2VJZCxcclxuICAgICAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuTWVudSxcclxuICAgICAgICAgICAgICAgIGZ1bmNJZCxcclxuICAgICAgICAgICAgICAgIHRhYk5hbWU6IGZ1bmMgJiYgZnVuYy5uYW1lXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHNlbGYuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuRlVOQ19DTE9TRUQsIGV2ZW50QXJncyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICB0YWJJZCxcclxuICAgICAgICAgICAgZnVuY0lkLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgICAgYXBwVHlwZTogQXBwVHlwZS5NZW51LFxyXG4gICAgICAgICAgICB0b2tlbjogZm9ybVRva2VuLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5xdWl0RnVuYyhvcHRpb25zLCBvYmouc3UpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4geyB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluiPnOWNleeahOiwg+eUqOS/oeaBr1xyXG4gICAgICovXHJcbiAgICBnZXRGdW5jSW52b2soZnVuY0lkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGludm9rcyA9IHRoaXMuZ2V0SW52b2tDYWNoZSgpO1xyXG4gICAgICAgIGNvbnN0IGZ1bmNJbnZvayA9IGludm9rcy5maW5kKGYgPT4gZi5pZCA9PT0gZnVuY0lkKTtcclxuICAgICAgICBpZiAoIWZ1bmNJbnZvaykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnZva0NvbmZpZyhmdW5jSWQpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBtYXAodiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpbnZva3MucHVzaCh2KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZ1bmNTZXJ2aWNlLmNhY2hlQWxsRnVuY0ludm9rcyhpbnZva3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2O1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9mKGZ1bmNJbnZvayk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5boj5zljZXlrp7kvZNcclxuICAgICAqL1xyXG4gICAgZ2V0RnVuY0VudGl0eShmdW5jSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuZnVuY1NlcnZpY2UuZ2V0Q2FjaGVkRnVuYyhmdW5jSWQpO1xyXG4gICAgICAgIGlmICghZnVuYykge1xyXG4gICAgICAgICAgICBjb25zdCB1cmwgPSBgL2FwaS9ydW50aW1lL3N5cy92MS4wL2Z1bmN0aW9ucy8ke2Z1bmNJZH1gO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoJ0dldCcsIHVybCwgRnJtVXRpbC5zZXRIZWFkZXIobnVsbCwge30pKVxyXG4gICAgICAgICAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXYgfHwgIXZbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbEZ1bmNzID0gdGhpcy5mdW5jU2VydmljZS5nZXRBbGxDYWNoZWRGdW5jcygpIGFzIGFueVtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxGdW5jcy5wdXNoKHZbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZ1bmNTZXJ2aWNlLmNhY2hlQWxsRnVuY3MoYWxsRnVuY3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdlswXTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9mKGZ1bmMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6I+c5Y2V6aKE572u5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIGdldFByZXNldFBhcmFtcyhmdW5jSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnVuY0ludm9rKGZ1bmNJZCkucGlwZShcclxuICAgICAgICAgICAgbWFwKGZ1bmNJbnZvayA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbUluZm8gPSBmdW5jSW52b2suaW52b2tpbmdDb25maWcuc3RhdGljUGFyYW1zO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW50aXR5UGFyYW1JbmZvID0gZnVuY0ludm9rLmludm9raW5nQ29uZmlnLmVudGl0eVBhcmFtcztcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRpY1BhcmFtID0gcGFyYW1JbmZvID8gSlNPTi5wYXJzZShwYXJhbUluZm8pIDogW107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHlQYXJhbSA9IGVudGl0eVBhcmFtSW5mbyA/IEpTT04ucGFyc2UoZW50aXR5UGFyYW1JbmZvKSA6IFtdO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVyZ2VQYXJhbXMoc3RhdGljUGFyYW0sIGVudGl0eVBhcmFtKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6I+c5Y2V55qE6Z2Z5oCB5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIGdldFN0YXRpY1BhcmFtKGZ1bmNJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGdW5jSW52b2soZnVuY0lkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAodiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi5pbnZva2luZ0NvbmZpZy5zdGF0aWNQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2Lmludm9raW5nQ29uZmlnLnN0YXRpY1BhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluihqOWNleeahOWunuS9k+WPguaVsFxyXG4gICAgICovXHJcbiAgICBnZXRFbnRpdHlQYXJhbSh0YWJJZDogc3RyaW5nLCBoYW5kbGVyOiAodmFsdWU6IGFueSkgPT4gdm9pZCwgaXNTdWJvbmNlOiBib29sZWFuID0gdHJ1ZSk6IGFueSB7XHJcbiAgICAgICAgaWYgKGlzU3Vib25jZSkge1xyXG4gICAgICAgICAgICB0aGlzLmdldEZlYigpLm9uY2UodGFiSWQsIGhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldEZlYigpLm9uKHRhYklkLCBoYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBlbnRpdHlQYXJhbVVuc3ViKGZ1bmNJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5nZXRGZWIoKS51blN1YnNjcmliZShmdW5jSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5p+Q6I+c5Y2V55qE5a6e5L2T5Y+C5pWw57uT5p6EXHJcbiAgICAgKi9cclxuICAgIGdldEVudGl0eVBhcmFtU3RydWN0dXJlKGZ1bmNJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGdW5jSW52b2soZnVuY0lkKS5waXBlKFxyXG4gICAgICAgICAgICBtYXAodiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi5pbnZva2luZ0NvbmZpZy5lbnRpdHlQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2Lmludm9raW5nQ29uZmlnLmVudGl0eVBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1lcmdlUGFyYW1zKHN0YXRpY1BhcmFtOiBhbnlbXSwgZW50aXR5UGFyYW06IGFueVtdKTogTWFwPGFueSwgYW55PiB7XHJcbiAgICAgICAgY29uc3QgcGFyYU1hcCA9IG5ldyBNYXA8YW55LCBhbnk+KCk7XHJcbiAgICAgICAgaWYgKGVudGl0eVBhcmFtKSB7XHJcbiAgICAgICAgICAgIGVudGl0eVBhcmFtLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcGFyYU1hcC5zZXQoaXRlbS5uYW1lLCBpdGVtLnZhbHVlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdGF0aWNQYXJhbSkge1xyXG4gICAgICAgICAgICAvLyBmdW5j5LiK5a+5YXBw5Y+C5pWw5aSN55SoXHJcbiAgICAgICAgICAgIHN0YXRpY1BhcmFtLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcGFyYU1hcC5zZXQoaXRlbS5uYW1lLCBpdGVtLnZhbHVlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXJhTWFwO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwcml2YXRlIGdldEludm9rQ29uZmlnKGZ1bmNJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gYC9hcGkvcnVudGltZS9zeXMvdjEuMC9mdW5jdGlvbnMvZnVuY0ludm9rLyR7ZnVuY0lkfWA7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdHZXQnLCB1cmwsIEZybVV0aWwuc2V0SGVhZGVyKG51bGwsIHt9KSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW52b2tDYWNoZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5mdW5jU2VydmljZS5nZXRBbGxDYWNoZWRGdW5jSW52b2tzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmoYbmnrZldmVudGJ1c1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEZlYigpOiBGcm1FdmVudEJ1cyB7XHJcbiAgICAgICAgcmV0dXJuIEV2ZW50VXRpbC5nZXRGcm1FdmVudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p6E6YCg5Yqf6IO95Y+Kc2Vzc2lvblxyXG4gICAgICogKDE5MTIgZnVuY1Nlc3Npb27np7vpmaTlkI7vvIzmjqXlj6PkuI3lho3mj5DkvpspXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBidWlsZEZ1bmNTZXNzaW9uKGZ1bmNJZDogc3RyaW5nLCBzdT86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgdXNlclNlc3Npb24gPSB0aGlzLnNlc3Npb25TdmMuZ2V0VXNlclNlc3Npb25JZCgpO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgICAgICAgIHRva2VuOiB1c2VyU2Vzc2lvbixcclxuICAgICAgICAgICAgZnVuY0lkLFxyXG4gICAgICAgICAgICBhY3Rpb246ICdlbnRlcidcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBiaXpDb250ZXh0VXJsID0gdGhpcy5GVU5DU1RBVFVTX1BBVEggKyAoIXN1ID8gJycgOiBgP3N1PSR7c3V9YCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdQb3N0JywgYml6Q29udGV4dFVybCwgRnJtVXRpbC5zZXRIZWFkZXIodXNlclNlc3Npb24sIHsgYm9keSB9KSkucGlwZShcclxuICAgICAgICAgICAgbWFwKCh2OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNzOiBzdHJpbmcgPSB2LnNlc3Npb25JZDtcclxuICAgICAgICAgICAgICAgIGlmIChzcyAhPT0gdW5kZWZpbmVkICYmIHNzICE9PSBudWxsICYmIHNzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNlc3Npb25TdmMuc2V0RnVuY1Nlc3Npb25JZChmdW5jSWQsIHNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBzcztcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+b5YWl5Yqf6IO977yM6Kem5Y+R5pyN5Yqh56uv6YC76L6RXHJcbiAgICAgKiDnp7vpmaRmdW5jU2Vzc2lvblxyXG4gICAgICog6L+U5Zue5YWs5YWx5Y+Y6YePdG9rZW5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBlbnRlckZ1bmMoZW50ZXJQYXJhbTogRnVuY1N0YXRlUGFyYW0sIHN1OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGJpekNvbnRleHRVcmwgPSB0aGlzLkZVTkNTVEFUVVNfUEFUSCArICghc3UgPyAnJyA6IGA/c3U9JHtzdX1gKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoJ1Bvc3QnLCBiaXpDb250ZXh0VXJsLCBGcm1VdGlsLnNldEhlYWRlcihudWxsLCB7IGJvZHk6IGVudGVyUGFyYW0gfSkpXHJcbiAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgbWFwKCh2OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdi50b2tlbiB8fCB2LnNlc3Npb25JZDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgIDlh7rlip/og73vvIzlpoLmnpzlrZjlnKhiaXpDb250ZXh077yM5YiZ56e76ZmkXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcXVpdEZ1bmMob3B0aW9uczogQXBwT3B0aW9ucywgc3U6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgICAgICAgdG9rZW46IG9wdGlvbnMudG9rZW4sXHJcbiAgICAgICAgICAgIHRhYklkOiBvcHRpb25zLnRhYklkLFxyXG4gICAgICAgICAgICBmdW5jSWQ6IG9wdGlvbnMuZnVuY0lkLFxyXG4gICAgICAgICAgICBhY3Rpb246ICdxdWl0J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYml6Q29udGV4dFVybCA9IHRoaXMuRlVOQ1NUQVRVU19QQVRIICsgKCFzdSA/ICcnIDogYD9zdT0ke3N1fWApO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnUG9zdCcsIGJpekNvbnRleHRVcmwsIEZybVV0aWwuc2V0SGVhZGVyKG51bGwsIHsgYm9keSB9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blvZPliY3lupTnlKjmiYDlsZ5zdVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFN1KHVybDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCB1cmlBcnIgPSB1cmwuc3BsaXQoJy8nKTtcclxuICAgICAgICByZXR1cm4gdXJpQXJyLmxlbmd0aCA+IDMgPyB1cmlBcnJbM10gOiAnJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGlmcmFtZSB1cmzmi7zmjqUgcXVlcnlzdHJpbmcg5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYnVpbGRRdWVyeVN0cmluZyhyb3V0dXJsOiBzdHJpbmcsIGZ1bmNJZDogc3RyaW5nLCBwYXJhbXMpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChyb3V0dXJsLmluZGV4T2YoJz8nKSA8IDApIHtcclxuICAgICAgICAgICAgcm91dHVybCArPSBgP2Z1bmNJZD0ke2Z1bmNJZH1gO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJvdXR1cmwgKz0gYCZmdW5jSWQ9JHtmdW5jSWR9YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHBhcmFtcykge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhwYXJhbXMpLmZvckVhY2goKHByb3BOYW1lOiBzdHJpbmcsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByb3V0dXJsICs9IGAke2luZGV4ID09PSAwID8gJycgOiAnJid9JHtwcm9wTmFtZX09JHtwYXJhbXNbcHJvcE5hbWVdfWA7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcm91dHVybDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHVybCDmi7zmjqVtYXDmoLzlvI/nmoTlj4LmlbBcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBidWlsZFF1ZXJ5U3RyaW5nQnlNYXAocm91dHVybDogc3RyaW5nLCBmdW5jSWQ6IHN0cmluZywgdGFiSWQ6IHN0cmluZywgdG9rZW46IHN0cmluZywgcGFyYW1zOiBNYXA8c3RyaW5nLCBzdHJpbmc+KTogc3RyaW5nIHtcclxuICAgICAgICBpZiAocm91dHVybC5pbmRleE9mKCc/JykgPCAwKSB7XHJcbiAgICAgICAgICAgIHJvdXR1cmwgKz0gYD9mdW5jSWQ9JHtmdW5jSWR9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByb3V0dXJsICs9IGAmZnVuY0lkPSR7ZnVuY0lkfWA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByb3V0dXJsICs9IGAmYXBwVHlwZT0ke0FwcFR5cGUuTWVudX1gO1xyXG4gICAgICAgIHJvdXR1cmwgKz0gYCZ0YWJJZD0ke3RoaXMuZ2V0UGFnZUlkKGZ1bmNJZCwgdGFiSWQpfWA7XHJcbiAgICAgICAgcm91dHVybCArPSAhdG9rZW4gPyAnJyA6IGAmY3ZmdD0ke3Rva2VufWA7XHJcbiAgICAgICAgaWYgKHBhcmFtcykge1xyXG4gICAgICAgICAgICBwYXJhbXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcm91dHVybCArPSAha2V5ID8gJycgOiBgJiR7a2V5fT0ke3ZhbHVlfWA7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcm91dHVybDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluW9k+WJjeiPnOWNlemhtemdoueahOWUr+S4gOagh+ivhlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFBhZ2VJZChmdW5jSWQ6IHN0cmluZywgdGFiSWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRhYklkIHx8IGZ1bmNJZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmhtemdouesrOS4gOasoeiiq+aJk+W8gOaXtu+8jOeUn+aIkOWUr+S4gOagh+ivhlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG5ld1BhZ2VJZChmdW5jSWQ6IHN0cmluZywgdGFiSWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRhYklkID8gYCR7ZnVuY0lkfV8ke3RhYklkfWAgOiBmdW5jSWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGV2ZW50RmlyZSh0b2tlbjogc3RyaW5nLCBhcmdzOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBmZWIgPSBFdmVudFV0aWwuZ2V0RnJtRXZlbnQoKTtcclxuICAgICAgICBpZiAoIWZlYiB8fCB0eXBlb2YgZmViLnBvc3QgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmZWIucG9zdCh0b2tlbiwgYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGV2ZW50TGlzdG5lcih0b2tlbjogc3RyaW5nLCBoYW5kbGVyOiAodmFsdWU6IGFueSkgPT4gdm9pZCwgb3B0aW9ucz86IEFwcE9wdGlvbnMpIHtcclxuICAgICAgICBjb25zdCBmZWIgPSBFdmVudFV0aWwuZ2V0RnJtRXZlbnQoKTtcclxuICAgICAgICBpZiAoIWZlYiB8fCB0eXBlb2YgZmViLm9uICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6I+c5Y2V55uR5ZCs6ICF5b+F6aG76KaB5aOw5piO6Ieq5bex55qE6Lqr5Lu977yM5pa55L6/5qGG5p62566h55CGXHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5hcHBUeXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5hcHBUeXBlLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgQXBwVHlwZS5BcHA6XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXBwT2JrZXkgPSBFdmVudFV0aWwuYXBwT2JzVG9rZW4ob3B0aW9ucy5hcHBJZCwgb3B0aW9ucy5hcHBFbnRyYW5jZSwgb3B0aW9ucy50YWJJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmViLm9uV2l0aE9ia2V5KHRva2VuLCBhcHBPYmtleSwgaGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBBcHBUeXBlLk1lbnU6XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnVuY09ia2V5ID0gRXZlbnRVdGlsLmZ1bmNPYnNUb2tlbihvcHRpb25zLmZ1bmNJZCwgb3B0aW9ucy50YWJJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmViLm9uV2l0aE9ia2V5KHRva2VuLCBmdW5jT2JrZXksIGhhbmRsZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZlYi5vbih0b2tlbiwgaGFuZGxlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWIm+W7uuebkeWQrOiuoumYhSwg57u05oqk5LiA5Liq55uR5ZCs6ICF5YiX6KGo77yM6ZKI5a+56I+c5Y2V6Kem5Y+R5LqL5Lu2ICovXHJcbiAgICBwdWJsaWMgZXZlbnRMaXN0bmVyNEZ1bmModG9rZW46IHN0cmluZywgZnVuY0lkOiBzdHJpbmcsIGhhbmRsZXI6ICh2YWx1ZTogYW55KSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3QgZmViID0gRXZlbnRVdGlsLmdldEZybUV2ZW50KCk7XHJcbiAgICAgICAgaWYgKCFmZWIgfHwgdHlwZW9mIGZlYi5vbiAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZlYi5vbldpdGhPYmtleSh0b2tlbiwgZnVuY0lkLCBoYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5Yib5bu655uR5ZCs6K6i6ZiFLCDnu7TmiqTkuIDkuKrnm5HlkKzogIXliJfooajvvIzpkojlr7nlupTnlKjop6blj5Hkuovku7YgKi9cclxuICAgIHB1YmxpYyBldmVudExpc3RuZXI0QXBwKHRva2VuOiBzdHJpbmcsIGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlOiBzdHJpbmcsIGhhbmRsZXI6ICh2YWx1ZTogYW55KSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3QgZmViID0gRXZlbnRVdGlsLmdldEZybUV2ZW50KCk7XHJcbiAgICAgICAgaWYgKCFmZWIgfHwgdHlwZW9mIGZlYi5vbiAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGFwcE9ia2V5ID0gRXZlbnRVdGlsLmFwcE9ic1Rva2VuKGFwcElkLCBhcHBFbnRyYW5jZSk7XHJcbiAgICAgICAgZmViLm9uV2l0aE9ia2V5KHRva2VuLCBhcHBPYmtleSwgaGFuZGxlcik7XHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==
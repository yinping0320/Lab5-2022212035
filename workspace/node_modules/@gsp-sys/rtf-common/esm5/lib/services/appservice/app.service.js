/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { of, zip } from 'rxjs';
import { HttpService, LanguageService, SessionService } from '@ecp-caf/caf-common';
import { IframeLink } from '../../models/iframe.model';
import { map, switchMap } from 'rxjs/operators';
import { EventUtil, FrmUtil, AppType } from '../../shared/frm-util';
import { FrameworkVariableService } from '../frmVariableService/framework-variable.service';
import { FrmI18nSettingService } from '../i18nService/i18n-setting.service';
var AppService = /** @class */ (function () {
    function AppService(http, sessionSvc, i18nSetting) {
        this.http = http;
        this.sessionSvc = sessionSvc;
        this.i18nSetting = i18nSetting;
        this.FUNCSTATUS_PATH = '/api/runtime/sys/v1.0/function-states';
        this.APPINVOKE_CAHCE_KEY = 'allappinvoks';
        this.frmVariableService = new FrameworkVariableService();
        if (!this.i18nSetting) {
            /** @type {?} */
            var variables = new FrameworkVariableService();
            /** @type {?} */
            var language = new LanguageService(null);
            this.i18nSetting = new FrmI18nSettingService(variables, language, http);
        }
    }
    /**
     * App跳转打开
     */
    /**
     * App跳转打开
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} params
     * @param {?=} reload
     * @return {?}
     */
    AppService.prototype.openApp = /**
     * App跳转打开
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} params
     * @param {?=} reload
     * @return {?}
     */
    function (appId, appEntrance, params, reload) {
        /** @type {?} */
        var appOpts = {
            funcId: '',
            appId: appId,
            appEntrance: appEntrance,
            appType: AppType.App,
            entityParams: params,
            queryStringParams: params,
            isReload: reload
        };
        this.openAppByOptions(appOpts);
    };
    /**
     * App跳转打开服务
     */
    /**
     * App跳转打开服务
     * @param {?} options
     * @return {?}
     */
    AppService.prototype.openAppByOptions = /**
     * App跳转打开服务
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        /** @type {?} */
        var linkobj = this.checkingRepeatOpen(options);
        if (linkobj) {
            return;
        }
        this.getInvokeAndEnterApp$(options).subscribe((/**
         * @param {?} link
         * @return {?}
         */
        function (link) {
            _this.getFeb().post(EventUtil.FARRIS_APP_CLICK, link);
        }));
    };
    /**
     * 流方式，App跳转打开服务
     */
    /**
     * 流方式，App跳转打开服务
     * @param {?} options
     * @return {?}
     */
    AppService.prototype.openAppByOptions$ = /**
     * 流方式，App跳转打开服务
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        /** @type {?} */
        var linkobj = this.checkingRepeatOpen(options);
        if (linkobj) {
            return of(true);
        }
        return this.getInvokeAndEnterApp$(options).pipe(map((/**
         * @param {?} link
         * @return {?}
         */
        function (link) {
            _this.getFeb().post(EventUtil.FARRIS_APP_CLICK, link);
            return true;
        })));
    };
    /**
     * 获取app调用信息
     */
    /**
     * 获取app调用信息
     * @param {?} appId
     * @return {?}
     */
    AppService.prototype.getAppInvok = /**
     * 获取app调用信息
     * @param {?} appId
     * @return {?}
     */
    function (appId) {
        var _this = this;
        /** @type {?} */
        var invoks = this.getInvokCache();
        /** @type {?} */
        var funcInvok = invoks.find((/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return f.id === appId; }));
        if (!funcInvok) {
            return this.getInvokConfig(appId).pipe(map((/**
             * @param {?} v
             * @return {?}
             */
            function (v) {
                if (!v) {
                    return null;
                }
                _this.refreshInvokCache(invoks, v);
                return v;
            })));
        }
        return of(funcInvok);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    AppService.prototype.beforeCloseAppByOptions = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var appObkey = EventUtil.appObsToken(options.appId, options.appEntrance, options.tabId);
        /** @type {?} */
        var obs = EventUtil.getObserver(EventUtil.BEFORE_FUNC_CLOSE).get(appObkey);
        if (!obs) {
            this.closeAppByOptions(options).subscribe();
            return;
        }
        /** @type {?} */
        var eventArgs = {
            tabId: this.getPageId(options.appId, options.appEntrance, options.tabId),
            appType: AppType.App,
            appId: options.appId,
            appEntrance: options.appEntrance
        };
        this.getFeb().post(EventUtil.BEFORE_FUNC_CLOSE, eventArgs);
    };
    /**
     * App关闭前接口
     */
    /**
     * App关闭前接口
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?=} tabId
     * @return {?}
     */
    AppService.prototype.beforeCloseApp = /**
     * App关闭前接口
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?=} tabId
     * @return {?}
     */
    function (appId, appEntrance, tabId) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var appObkey = EventUtil.appObsToken(appId, appEntrance, tabId);
        /** @type {?} */
        var obs = EventUtil.getObserver(EventUtil.BEFORE_FUNC_CLOSE).get(appObkey);
        if (!obs) {
            this.closeApp(appId, appEntrance, tabId).subscribe();
            return;
        }
        /** @type {?} */
        var eventArgs = {
            tabId: self.getPageId(appId, appEntrance, tabId),
            appType: AppType.App,
            appId: appId,
            appEntrance: appEntrance
        };
        this.getFeb().post(EventUtil.BEFORE_FUNC_CLOSE, eventArgs);
    };
    /**
     * @param {?} options
     * @return {?}
     */
    AppService.prototype.closeAppByOptions = /**
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var appObkey = EventUtil.appObsToken(options.appId, options.appEntrance, options.tabId);
        /** @type {?} */
        var pageToken = this.getPageId(options.appId, options.appEntrance, options.tabId);
        EventUtil.clearObserver(appObkey);
        EventUtil.clearEventPipe(pageToken);
        /** @type {?} */
        var objIndex = FrmUtil.getTabArray().findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i.id === pageToken && i.appType === AppType.App; }));
        /** @type {?} */
        var obj = FrmUtil.getTabArray()[objIndex];
        options.token = options.token || obj.formToken;
        FrmUtil.removeTab(objIndex);
        /** @type {?} */
        var eventArgs = {
            tabId: pageToken,
            appType: AppType.App,
            appId: options.tabId,
            appEntrance: options.appEntrance
        };
        this.getFeb().post(EventUtil.FUNC_CLOSED, eventArgs);
        return this.quitApp(options, obj.su);
    };
    /**
     * 关闭app
     */
    /**
     * 关闭app
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?=} tabId
     * @return {?}
     */
    AppService.prototype.closeApp = /**
     * 关闭app
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?=} tabId
     * @return {?}
     */
    function (appId, appEntrance, tabId) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var appObkey = EventUtil.appObsToken(appId, appEntrance, tabId);
        /** @type {?} */
        var pageId = this.getPageId(appId, appEntrance, tabId);
        EventUtil.clearObserver(appObkey);
        EventUtil.clearEventPipe(pageId);
        /** @type {?} */
        var objIndex = FrmUtil.getTabArray().findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i.id === pageId && i.appType === AppType.App; }));
        /** @type {?} */
        var obj = FrmUtil.getTabArray()[objIndex];
        /** @type {?} */
        var formToken = obj.formToken;
        FrmUtil.removeTab(objIndex);
        /** @type {?} */
        var eventArgs = {
            tabId: pageId,
            appType: AppType.App,
            appId: appId,
            appEntrance: appEntrance,
        };
        self.getFeb().post(EventUtil.FUNC_CLOSED, eventArgs);
        /** @type {?} */
        var options = {
            tabId: tabId,
            funcId: '',
            appId: appId,
            appEntrance: appEntrance,
            appType: AppType.App,
            token: formToken
        };
        return this.quitApp(options, obj.su).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        function (v) { })));
    };
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    AppService.prototype.getInvokeAndEnterApp$ = /**
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        /** @type {?} */
        var newPageId = this.newPageId(options.appId, options.appEntrance, options.tabId);
        options.tabId = newPageId;
        return this.getAppInvok(options.appId).pipe(switchMap((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var invokEntry = value.appInvoks.find((/**
             * @param {?} invok
             * @return {?}
             */
            function (invok) { return invok.appEntrance === options.appEntrance; }));
            if (!options.appEntrance && !invokEntry) {
                invokEntry = value.appInvoks.find((/**
                 * @param {?} invok
                 * @return {?}
                 */
                function (invok) { return !invok.appEntrance; }));
            }
            if (!invokEntry) {
                window.alert("\u8BF7\u68C0\u67E5\u5F53\u524D\u5E94\u7528(ID:" + options.appId + ")\u914D\u7F6E\u7684\u5E94\u7528\u5165\u53E3(appEntrance:" + options.appEntrance + ")\u662F\u5426\u5B58\u5728");
                return;
            }
            /** @type {?} */
            var entityParam;
            try {
                entityParam = invokEntry.entityParams ? JSON.parse(invokEntry.entityParams) : null;
            }
            catch (e) {
                entityParam = null;
                console.log(e);
            }
            /** @type {?} */
            var su = _this.getSu(value.url);
            return _this.enterApp({
                tabId: newPageId,
                appId: options.appId,
                appEntrance: options.appEntrance,
                menuName: options.tabName || invokEntry.name,
                action: 'enterapp'
            }, su).pipe(map((/**
             * @param {?} token
             * @return {?}
             */
            function (token) {
                /** @type {?} */
                var routurl = value.url + (options.appEntrance ? "#/" + options.appEntrance : '');
                /** @type {?} */
                var linkobj = new IframeLink(value.code, null, _this.buildQueryString(routurl, options.appId, options.appEntrance, options.tabId, token, options.queryStringParams));
                // id加入口区分,tabId页签唯一标识
                linkobj.id = newPageId;
                linkobj.appType = AppType.App;
                linkobj.appId = options.appId;
                linkobj.appEntrance = options.appEntrance;
                // 显示app名字及入口名字
                linkobj.FuncName = options.tabName || invokEntry.name;
                linkobj.url = value.url;
                linkobj.reload = options.isReload;
                linkobj.su = su;
                linkobj.formToken = token;
                if (entityParam) {
                    entityParam.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        if (item.name === 'mode') {
                            linkobj.mode = item.value;
                            linkobj.src += (item.value ? "&appMode=" + item.value + "&" : '');
                        }
                    }));
                }
                _this.getFeb().post(newPageId, options.entityParams);
                return linkobj;
            })), switchMap((/**
             * @param {?} formLink
             * @return {?}
             */
            function (formLink) {
                return _this.i18nSetting.getSetting$().pipe(map((/**
                 * @return {?}
                 */
                function () { return formLink; })));
            })));
        })));
    };
    /**
     * @private
     * @param {?} appId
     * @return {?}
     */
    AppService.prototype.getInvokConfig = /**
     * @private
     * @param {?} appId
     * @return {?}
     */
    function (appId) {
        /** @type {?} */
        var url = "/api/runtime/sys/v1.0/gspapp/" + appId;
        return this.http.request('Get', url, FrmUtil.setHeader(null, {}));
    };
    /**
     * 进入应用，触发相关服务
     */
    /**
     * 进入应用，触发相关服务
     * @private
     * @param {?} enterParam
     * @param {?} su
     * @return {?}
     */
    AppService.prototype.enterApp = /**
     * 进入应用，触发相关服务
     * @private
     * @param {?} enterParam
     * @param {?} su
     * @return {?}
     */
    function (enterParam, su) {
        /** @type {?} */
        var bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : "?su=" + su);
        return this.http.request('Post', bizContextUrl, FrmUtil.setHeader(null, { body: enterParam })).pipe(map((/**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            return v.token || v.sessionId;
        })));
    };
    /**
     * 退出应用，触发相关服务
     */
    /**
     * 退出应用，触发相关服务
     * @private
     * @param {?} options
     * @param {?=} su
     * @return {?}
     */
    AppService.prototype.quitApp = /**
     * 退出应用，触发相关服务
     * @private
     * @param {?} options
     * @param {?=} su
     * @return {?}
     */
    function (options, su) {
        /** @type {?} */
        var body = {
            tabId: options.tabId,
            token: options.token,
            appId: options.appId,
            appEntrance: options.appEntrance,
            action: 'quitapp'
        };
        /** @type {?} */
        var invokObs = this.getAppInvok(options.appId);
        /** @type {?} */
        var bizContextUrl = this.FUNCSTATUS_PATH + (!su ? '' : "?su=" + su);
        /** @type {?} */
        var funcState$ = this.http.request('Post', bizContextUrl, FrmUtil.setHeader(null, { body: body }));
        // tslint:disable-next-line: deprecation
        /** @type {?} */
        var $r = zip(invokObs, funcState$, (/**
         * @param {?} res1
         * @param {?} res2
         * @return {?}
         */
        function (res1, res2) { return ({ res1: res1, res2: res2 }); }));
        return $r;
    };
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    AppService.prototype.getSu = /**
     * @private
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var uriArr = url.split('/');
        return uriArr.length > 3 ? uriArr[3] : '';
    };
    /**
     * @private
     * @return {?}
     */
    AppService.prototype.getInvokCache = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var appInvokesCache = this.frmVariableService.getFrmVariableByKey(this.APPINVOKE_CAHCE_KEY);
        return (/** @type {?} */ (appInvokesCache)) || [];
    };
    /**
     * @private
     * @param {?} invoks
     * @param {?} funcInvok
     * @return {?}
     */
    AppService.prototype.refreshInvokCache = /**
     * @private
     * @param {?} invoks
     * @param {?} funcInvok
     * @return {?}
     */
    function (invoks, funcInvok) {
        if (!funcInvok) {
            return;
        }
        invoks.push(funcInvok);
        this.frmVariableService.frameworkVariableReg(this.APPINVOKE_CAHCE_KEY, invoks);
    };
    // tslint:disable-next-line: max-line-length
    // tslint:disable-next-line: max-line-length
    /**
     * @private
     * @param {?} routurl
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} tabId
     * @param {?} token
     * @param {?} params
     * @return {?}
     */
    AppService.prototype.buildQueryString = 
    // tslint:disable-next-line: max-line-length
    /**
     * @private
     * @param {?} routurl
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} tabId
     * @param {?} token
     * @param {?} params
     * @return {?}
     */
    function (routurl, appId, appEntrance, tabId, token, params) {
        if (routurl.indexOf('?') < 0) {
            routurl += "?appId=" + appId + "&appEntrance=" + appEntrance;
        }
        else {
            routurl += "&appId=" + appId + "&appEntrance=" + appEntrance;
        }
        routurl += "&appType=" + AppType.App;
        routurl += "&tabId=" + this.getPageId(appId, appEntrance, tabId);
        routurl += !token ? '' : "&cvft=" + token;
        if (params) {
            params.forEach((/**
             * @param {?} value
             * @param {?} key
             * @return {?}
             */
            function (value, key) {
                routurl += !key ? '' : "&" + key + "=" + value;
            }));
        }
        return routurl;
    };
    /**
     * @private
     * @return {?}
     */
    AppService.prototype.getFeb = /**
     * @private
     * @return {?}
     */
    function () {
        return EventUtil.getFrmEvent();
    };
    /**
     * @private
     * @param {?} appId
     * @param {?} appEntrance
     * @return {?}
     */
    AppService.prototype.mergeAppId = /**
     * @private
     * @param {?} appId
     * @param {?} appEntrance
     * @return {?}
     */
    function (appId, appEntrance) {
        return appId + "_" + appEntrance;
    };
    /**
     * 获取当前菜单页面的唯一标识
     */
    /**
     * 获取当前菜单页面的唯一标识
     * @private
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} tabId
     * @return {?}
     */
    AppService.prototype.getPageId = /**
     * 获取当前菜单页面的唯一标识
     * @private
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} tabId
     * @return {?}
     */
    function (appId, appEntrance, tabId) {
        return tabId || this.mergeAppId(appId, appEntrance);
    };
    /**
     * 生成页面唯一标识
     */
    /**
     * 生成页面唯一标识
     * @private
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} tabId
     * @return {?}
     */
    AppService.prototype.newPageId = /**
     * 生成页面唯一标识
     * @private
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} tabId
     * @return {?}
     */
    function (appId, appEntrance, tabId) {
        return tabId ? this.mergeAppId(appId, appEntrance) + "_" + tabId : this.mergeAppId(appId, appEntrance);
    };
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    AppService.prototype.checkingRepeatOpen = /**
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var appId = options.appId;
        /** @type {?} */
        var appEntrance = options.appEntrance;
        /** @type {?} */
        var tabId = options.tabId;
        /** @type {?} */
        var entityParams = options.entityParams;
        /** @type {?} */
        var linkobj;
        /** @type {?} */
        var pageId = this.getPageId(appId, appEntrance, tabId);
        linkobj = FrmUtil.getTabArray().find((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return i.id === pageId && i.appType === AppType.App; }));
        if (linkobj) {
            linkobj.FuncName = options.tabName || linkobj.FuncName;
            linkobj.src = this.buildQueryString(linkobj.url, appId, appEntrance, options.tabId, linkobj.sessionid, options.queryStringParams);
            linkobj.reload = options.isReload;
            this.getFeb().post(pageId, entityParams);
            this.getFeb().post(EventUtil.FARRIS_APP_CLICK, linkobj);
        }
        return linkobj;
    };
    AppService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AppService.ctorParameters = function () { return [
        { type: HttpService },
        { type: SessionService },
        { type: FrmI18nSettingService, decorators: [{ type: Optional }] }
    ]; };
    return AppService;
}());
export { AppService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AppService.prototype.FUNCSTATUS_PATH;
    /**
     * @type {?}
     * @private
     */
    AppService.prototype.APPINVOKE_CAHCE_KEY;
    /**
     * @type {?}
     * @private
     */
    AppService.prototype.frmVariableService;
    /**
     * @type {?}
     * @private
     */
    AppService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AppService.prototype.sessionSvc;
    /**
     * @type {?}
     * @private
     */
    AppService.prototype.i18nSetting;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9ydGYtY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2FwcHNlcnZpY2UvYXBwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBYyxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25GLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhELE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBNkMsTUFBTSx1QkFBdUIsQ0FBQztBQUMvRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUM1RixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUc1RTtJQU1JLG9CQUNZLElBQWlCLEVBQ2pCLFVBQTBCLEVBQ2QsV0FBa0M7UUFGOUMsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUNqQixlQUFVLEdBQVYsVUFBVSxDQUFnQjtRQUNkLGdCQUFXLEdBQVgsV0FBVyxDQUF1QjtRQVBsRCxvQkFBZSxHQUFHLHVDQUF1QyxDQUFDO1FBQzFELHdCQUFtQixHQUFHLGNBQWMsQ0FBQztRQVF6QyxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSx3QkFBd0IsRUFBRSxDQUFDO1FBQ3pELElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFOztnQkFDYixTQUFTLEdBQUcsSUFBSSx3QkFBd0IsRUFBRTs7Z0JBQzFDLFFBQVEsR0FBRyxJQUFJLGVB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LENBQUMsQ0FBQyxFQUFFLEtBQUssTUFBTSxJQUFJLENBQUMsQ0FBQyxPQUFPLEtBQUssT0FBTyxDQUFDLEdBQUcsRUFBNUMsQ0FBNEMsRUFBQyxDQUFDO1FBQ3hGLElBQUksT0FBTyxFQUFFO1lBQ1QsT0FBTyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUM7WUFDdkQsT0FBTyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQzlFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDbEQsT0FBTyxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQzNEO1FBQ0QsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQzs7Z0JBeFhKLFVBQVU7Ozs7Z0JBVEYsV0FBVztnQkFBbUIsY0FBYztnQkFNNUMscUJBQXFCLHVCQVlyQixRQUFROztJQWlYakIsaUJBQUM7Q0FBQSxBQTFYRCxJQTBYQztTQXpYWSxVQUFVOzs7Ozs7SUFDbkIscUNBQWtFOzs7OztJQUNsRSx5Q0FBNkM7Ozs7O0lBQzdDLHdDQUFxRDs7Ozs7SUFHakQsMEJBQXlCOzs7OztJQUN6QixnQ0FBa0M7Ozs7O0lBQ2xDLGlDQUFzRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCB6aXAgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UsIExhbmd1YWdlU2VydmljZSwgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgSWZyYW1lTGluayB9IGZyb20gJy4uLy4uL21vZGVscy9pZnJhbWUubW9kZWwnO1xyXG5pbXBvcnQgeyBtYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgRnJtRXZlbnRCdXMgfSBmcm9tICcuLi8uLi9ldmVudGJ1cy9mcm0tZXZlbmJ1cyc7XHJcbmltcG9ydCB7IEV2ZW50VXRpbCwgRnJtVXRpbCwgQXBwVHlwZSwgRnVuY0V2ZW50QXJncywgQXBwT3B0aW9ucywgRnVuY1N0YXRlUGFyYW0gfSBmcm9tICcuLi8uLi9zaGFyZWQvZnJtLXV0aWwnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtWYXJpYWJsZVNlcnZpY2UgfSBmcm9tICcuLi9mcm1WYXJpYWJsZVNlcnZpY2UvZnJhbWV3b3JrLXZhcmlhYmxlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGcm1JMThuU2V0dGluZ1NlcnZpY2UgfSBmcm9tICcuLi9pMThuU2VydmljZS9pMThuLXNldHRpbmcuc2VydmljZSc7XHJcblxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQXBwU2VydmljZSB7XHJcbiAgICBwcml2YXRlIEZVTkNTVEFUVVNfUEFUSCA9ICcvYXBpL3J1bnRpbWUvc3lzL3YxLjAvZnVuY3Rpb24tc3RhdGVzJztcclxuICAgIHByaXZhdGUgQVBQSU5WT0tFX0NBSENFX0tFWSA9ICdhbGxhcHBpbnZva3MnO1xyXG4gICAgcHJpdmF0ZSBmcm1WYXJpYWJsZVNlcnZpY2U6IEZyYW1ld29ya1ZhcmlhYmxlU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHBTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgc2Vzc2lvblN2YzogU2Vzc2lvblNlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpMThuU2V0dGluZzogRnJtSTE4blNldHRpbmdTZXJ2aWNlXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmZybVZhcmlhYmxlU2VydmljZSA9IG5ldyBGcmFtZXdvcmtWYXJpYWJsZVNlcnZpY2UoKTtcclxuICAgICAgICBpZiAoIXRoaXMuaTE4blNldHRpbmcpIHtcclxuICAgICAgICAgICAgY29uc3QgdmFyaWFibGVzID0gbmV3IEZyYW1ld29ya1ZhcmlhYmxlU2VydmljZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBsYW5ndWFnZSA9IG5ldyBMYW5ndWFnZVNlcnZpY2UobnVsbCk7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blNldHRpbmcgPSBuZXcgRnJtSTE4blNldHRpbmdTZXJ2aWNlKHZhcmlhYmxlcywgbGFuZ3VhZ2UsIGh0dHApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFwcOi3s+i9rOaJk+W8gFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3BlbkFwcChhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCBwYXJhbXM6IE1hcDxzdHJpbmcsIHN0cmluZz4sIHJlbG9hZD86IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCBhcHBPcHRzOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBmdW5jSWQ6ICcnLFxyXG4gICAgICAgICAgICBhcHBJZCxcclxuICAgICAgICAgICAgYXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuQXBwLFxyXG4gICAgICAgICAgICBlbnRpdHlQYXJhbXM6IHBhcmFtcyxcclxuICAgICAgICAgICAgcXVlcnlTdHJpbmdQYXJhbXM6IHBhcmFtcyxcclxuICAgICAgICAgICAgaXNSZWxvYWQ6IHJlbG9hZFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5vcGVuQXBwQnlPcHRpb25zKGFwcE9wdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQXBw6Lez6L2s5omT5byA5pyN5YqhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuQXBwQnlPcHRpb25zKG9wdGlvbnM6IEFwcE9wdGlvbnMpIHtcclxuXHJcbiAgICAgICAgY29uc3QgbGlua29iaiA9IHRoaXMuY2hlY2tpbmdSZXBlYXRPcGVuKG9wdGlvbnMpO1xyXG4gICAgICAgIGlmIChsaW5rb2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRJbnZva2VBbmRFbnRlckFwcCQob3B0aW9ucykuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBsaW5rID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuRkFSUklTX0FQUF9DTElDSywgbGluayk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rWB5pa55byP77yMQXBw6Lez6L2s5omT5byA5pyN5YqhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuQXBwQnlPcHRpb25zJChvcHRpb25zOiBBcHBPcHRpb25zKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBsaW5rb2JqID0gdGhpcy5jaGVja2luZ1JlcGVhdE9wZW4ob3B0aW9ucyk7XHJcbiAgICAgICAgaWYgKGxpbmtvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRJbnZva2VBbmRFbnRlckFwcCQob3B0aW9ucykucGlwZShcclxuICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgbGluayA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRGZWIoKS5wb3N0KEV2ZW50VXRpbC5GQVJSSVNfQVBQX0NMSUNLLCBsaW5rKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5ZhcHDosIPnlKjkv6Hmga9cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldEFwcEludm9rKGFwcElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGludm9rcyA9IHRoaXMuZ2V0SW52b2tDYWNoZSgpO1xyXG4gICAgICAgIGNvbnN0IGZ1bmNJbnZvayA9IGludm9rcy5maW5kKGYgPT4gZi5pZCA9PT0gYXBwSWQpO1xyXG4gICAgICAgIGlmICghZnVuY0ludm9rKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEludm9rQ29uZmlnKGFwcElkKS5waXBlKFxyXG4gICAgICAgICAgICAgICAgbWFwKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoSW52b2tDYWNoZShpbnZva3MsIHYpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2O1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9mKGZ1bmNJbnZvayk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGJlZm9yZUNsb3NlQXBwQnlPcHRpb25zKG9wdGlvbnM6IEFwcE9wdGlvbnMpIHtcclxuICAgICAgICBjb25zdCBhcHBPYmtleSA9IEV2ZW50VXRpbC5hcHBPYnNUb2tlbihvcHRpb25zLmFwcElkLCBvcHRpb25zLmFwcEVudHJhbmNlLCBvcHRpb25zLnRhYklkKTtcclxuICAgICAgICBjb25zdCBvYnMgPSBFdmVudFV0aWwuZ2V0T2JzZXJ2ZXIoRXZlbnRVdGlsLkJFRk9SRV9GVU5DX0NMT1NFKS5nZXQoYXBwT2JrZXkpO1xyXG4gICAgICAgIGlmICghb2JzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2VBcHBCeU9wdGlvbnMob3B0aW9ucykuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGV2ZW50QXJnczogRnVuY0V2ZW50QXJncyA9IHtcclxuICAgICAgICAgICAgdGFiSWQ6IHRoaXMuZ2V0UGFnZUlkKG9wdGlvbnMuYXBwSWQsIG9wdGlvbnMuYXBwRW50cmFuY2UsIG9wdGlvbnMudGFiSWQpLFxyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLkFwcCxcclxuICAgICAgICAgICAgYXBwSWQ6IG9wdGlvbnMuYXBwSWQsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiBvcHRpb25zLmFwcEVudHJhbmNlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkJFRk9SRV9GVU5DX0NMT1NFLCBldmVudEFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQXBw5YWz6Zet5YmN5o6l5Y+jXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBiZWZvcmVDbG9zZUFwcChhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCB0YWJJZD86IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IGFwcE9ia2V5ID0gRXZlbnRVdGlsLmFwcE9ic1Rva2VuKGFwcElkLCBhcHBFbnRyYW5jZSwgdGFiSWQpO1xyXG4gICAgICAgIGNvbnN0IG9icyA9IEV2ZW50VXRpbC5nZXRPYnNlcnZlcihFdmVudFV0aWwuQkVGT1JFX0ZVTkNfQ0xPU0UpLmdldChhcHBPYmtleSk7XHJcbiAgICAgICAgaWYgKCFvYnMpIHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZUFwcChhcHBJZCwgYXBwRW50cmFuY2UsIHRhYklkKS5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZXZlbnRBcmdzOiBGdW5jRXZlbnRBcmdzID0ge1xyXG4gICAgICAgICAgICB0YWJJZDogc2VsZi5nZXRQYWdlSWQoYXBwSWQsIGFwcEVudHJhbmNlLCB0YWJJZCksXHJcbiAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuQXBwLFxyXG4gICAgICAgICAgICBhcHBJZCxcclxuICAgICAgICAgICAgYXBwRW50cmFuY2VcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0RmViKCkucG9zdChFdmVudFV0aWwuQkVGT1JFX0ZVTkNfQ0xPU0UsIGV2ZW50QXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsb3NlQXBwQnlPcHRpb25zKG9wdGlvbnM6IEFwcE9wdGlvbnMpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGFwcE9ia2V5ID0gRXZlbnRVdGlsLmFwcE9ic1Rva2VuKG9wdGlvbnMuYXBwSWQsIG9wdGlvbnMuYXBwRW50cmFuY2UsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgIGNvbnN0IHBhZ2VUb2tlbiA9IHRoaXMuZ2V0UGFnZUlkKG9wdGlvbnMuYXBwSWQsIG9wdGlvbnMuYXBwRW50cmFuY2UsIG9wdGlvbnMudGFiSWQpO1xyXG4gICAgICAgIEV2ZW50VXRpbC5jbGVhck9ic2VydmVyKGFwcE9ia2V5KTtcclxuICAgICAgICBFdmVudFV0aWwuY2xlYXJFdmVudFBpcGUocGFnZVRva2VuKTtcclxuICAgICAgICBjb25zdCBvYmpJbmRleCA9IEZybVV0aWwuZ2V0VGFiQXJyYXkoKS5maW5kSW5kZXgoaSA9PiBpLmlkID09PSBwYWdlVG9rZW4gJiYgaS5hcHBUeXBlID09PSBBcHBUeXBlLkFwcCk7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gRnJtVXRpbC5nZXRUYWJBcnJheSgpW29iakluZGV4XTtcclxuXHJcbiAgICAgICAgb3B0aW9ucy50b2tlbiA9IG9wdGlvbnMudG9rZW4gfHwgb2JqLmZvcm1Ub2tlbjtcclxuICAgICAgICBGcm1VdGlsLnJlbW92ZVRhYihvYmpJbmRleCk7XHJcbiAgICAgICAgY29uc3QgZXZlbnRBcmdzOiBGdW5jRXZlbnRBcmdzID0ge1xyXG4gICAgICAgICAgICB0YWJJZDogcGFnZVRva2VuLFxyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLkFwcCxcclxuICAgICAgICAgICAgYXBwSWQ6IG9wdGlvbnMudGFiSWQsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiBvcHRpb25zLmFwcEVudHJhbmNlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZVTkNfQ0xPU0VELCBldmVudEFyZ3MpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnF1aXRBcHAob3B0aW9ucywgb2JqLnN1KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFs+mXrWFwcFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY2xvc2VBcHAoYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgdGFiSWQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IGFwcE9ia2V5ID0gRXZlbnRVdGlsLmFwcE9ic1Rva2VuKGFwcElkLCBhcHBFbnRyYW5jZSwgdGFiSWQpO1xyXG4gICAgICAgIGNvbnN0IHBhZ2VJZCA9IHRoaXMuZ2V0UGFnZUlkKGFwcElkLCBhcHBFbnRyYW5jZSwgdGFiSWQpO1xyXG4gICAgICAgIEV2ZW50VXRpbC5jbGVhck9ic2VydmVyKGFwcE9ia2V5KTtcclxuICAgICAgICBFdmVudFV0aWwuY2xlYXJFdmVudFBpcGUocGFnZUlkKTtcclxuICAgICAgICBjb25zdCBvYmpJbmRleCA9IEZybVV0aWwuZ2V0VGFiQXJyYXkoKS5maW5kSW5kZXgoaSA9PiBpLmlkID09PSBwYWdlSWQgJiYgaS5hcHBUeXBlID09PSBBcHBUeXBlLkFwcCk7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gRnJtVXRpbC5nZXRUYWJBcnJheSgpW29iakluZGV4XTtcclxuICAgICAgICBjb25zdCBmb3JtVG9rZW4gPSBvYmouZm9ybVRva2VuO1xyXG4gICAgICAgIEZybVV0aWwucmVtb3ZlVGFiKG9iakluZGV4KTtcclxuICAgICAgICBjb25zdCBldmVudEFyZ3M6IEZ1bmNFdmVudEFyZ3MgPSB7XHJcbiAgICAgICAgICAgIHRhYklkOiBwYWdlSWQsXHJcbiAgICAgICAgICAgIGFwcFR5cGU6IEFwcFR5cGUuQXBwLFxyXG4gICAgICAgICAgICBhcHBJZCxcclxuICAgICAgICAgICAgYXBwRW50cmFuY2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBzZWxmLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZVTkNfQ0xPU0VELCBldmVudEFyZ3MpO1xyXG5cclxuICAgICAgICBjb25zdCBvcHRpb25zOiBBcHBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICB0YWJJZCxcclxuICAgICAgICAgICAgZnVuY0lkOiAnJyxcclxuICAgICAgICAgICAgYXBwSWQsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlLFxyXG4gICAgICAgICAgICBhcHBUeXBlOiBBcHBUeXBlLkFwcCxcclxuICAgICAgICAgICAgdG9rZW46IGZvcm1Ub2tlblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucXVpdEFwcChvcHRpb25zLCBvYmouc3UpLnBpcGUoXHJcbiAgICAgICAgICAgIG1hcCh2ID0+IHsgfSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW52b2tlQW5kRW50ZXJBcHAkKG9wdGlvbnM6IEFwcE9wdGlvbnMpOiBPYnNlcnZhYmxlPElmcmFtZUxpbms+IHtcclxuICAgICAgICBjb25zdCBuZXdQYWdlSWQgPSB0aGlzLm5ld1BhZ2VJZChvcHRpb25zLmFwcElkLCBvcHRpb25zLmFwcEVudHJhbmNlLCBvcHRpb25zLnRhYklkKTtcclxuICAgICAgICBvcHRpb25zLnRhYklkID0gbmV3UGFnZUlkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEFwcEludm9rKG9wdGlvbnMuYXBwSWQpLnBpcGUoXHJcbiAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgIHZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaW52b2tFbnRyeSA9IHZhbHVlLmFwcEludm9rcy5maW5kKGludm9rID0+IGludm9rLmFwcEVudHJhbmNlID09PSBvcHRpb25zLmFwcEVudHJhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMuYXBwRW50cmFuY2UgJiYgIWludm9rRW50cnkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW52b2tFbnRyeSA9IHZhbHVlLmFwcEludm9rcy5maW5kKGludm9rID0+ICFpbnZvay5hcHBFbnRyYW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaW52b2tFbnRyeSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoYOivt+ajgOafpeW9k+WJjeW6lOeUqChJRDoke29wdGlvbnMuYXBwSWR9KemFjee9rueahOW6lOeUqOWFpeWPoyhhcHBFbnRyYW5jZToke29wdGlvbnMuYXBwRW50cmFuY2V9KeaYr+WQpuWtmOWcqGApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBlbnRpdHlQYXJhbTogYW55O1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eVBhcmFtID0gaW52b2tFbnRyeS5lbnRpdHlQYXJhbXMgPyBKU09OLnBhcnNlKGludm9rRW50cnkuZW50aXR5UGFyYW1zKSA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlQYXJhbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdSA9IHRoaXMuZ2V0U3UodmFsdWUudXJsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW50ZXJBcHAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJJZDogbmV3UGFnZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBJZDogb3B0aW9ucy5hcHBJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXBwRW50cmFuY2U6IG9wdGlvbnMuYXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVOYW1lOiBvcHRpb25zLnRhYk5hbWUgfHwgaW52b2tFbnRyeS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdlbnRlcmFwcCdcclxuICAgICAgICAgICAgICAgICAgICB9LCBzdSkucGlwZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvdXR1cmwgPSB2YWx1ZS51cmwgKyAob3B0aW9ucy5hcHBFbnRyYW5jZSA/IGAjLyR7b3B0aW9ucy5hcHBFbnRyYW5jZX1gIDogJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtvYmogPSBuZXcgSWZyYW1lTGluayhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuY29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWlsZFF1ZXJ5U3RyaW5nKHJvdXR1cmwsIG9wdGlvbnMuYXBwSWQsIG9wdGlvbnMuYXBwRW50cmFuY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnRhYklkLCB0b2tlbiwgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZOWKoOWFpeWPo+WMuuWIhix0YWJJZOmhteetvuWUr+S4gOagh+ivhlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouaWQgPSBuZXdQYWdlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5hcHBUeXBlID0gQXBwVHlwZS5BcHA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5hcHBJZCA9IG9wdGlvbnMuYXBwSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5hcHBFbnRyYW5jZSA9IG9wdGlvbnMuYXBwRW50cmFuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5pi+56S6YXBw5ZCN5a2X5Y+K5YWl5Y+j5ZCN5a2XXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5GdW5jTmFtZSA9IG9wdGlvbnMudGFiTmFtZSB8fCBpbnZva0VudHJ5Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai51cmwgPSB2YWx1ZS51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua29iai5yZWxvYWQgPSBvcHRpb25zLmlzUmVsb2FkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouc3UgPSBzdTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rb2JqLmZvcm1Ub2tlbiA9IHRva2VuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHlQYXJhbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlQYXJhbS5mb3JFYWNoKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ubmFtZSA9PT0gJ21vZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmoubW9kZSA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtvYmouc3JjICs9IChpdGVtLnZhbHVlID8gYCZhcHBNb2RlPSR7aXRlbS52YWx1ZX0mYCA6ICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QobmV3UGFnZUlkLCBvcHRpb25zLmVudGl0eVBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmtvYmo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaE1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1MaW5rID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuU2V0dGluZy5nZXRTZXR0aW5nJCgpLnBpcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgpID0+IGZvcm1MaW5rXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEludm9rQ29uZmlnKGFwcElkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBgL2FwaS9ydW50aW1lL3N5cy92MS4wL2dzcGFwcC8ke2FwcElkfWA7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KCdHZXQnLCB1cmwsIEZybVV0aWwuc2V0SGVhZGVyKG51bGwsIHt9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5vlhaXlupTnlKjvvIzop6blj5Hnm7jlhbPmnI3liqFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBlbnRlckFwcChlbnRlclBhcmFtOiBGdW5jU3RhdGVQYXJhbSwgc3U6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgYml6Q29udGV4dFVybCA9IHRoaXMuRlVOQ1NUQVRVU19QQVRIICsgKCFzdSA/ICcnIDogYD9zdT0ke3N1fWApO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnUG9zdCcsIGJpekNvbnRleHRVcmwsIEZybVV0aWwuc2V0SGVhZGVyKG51bGwsIHsgYm9keTogZW50ZXJQYXJhbSB9KSkucGlwZShcclxuICAgICAgICAgICAgbWFwKCh2OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2LnRva2VuIHx8IHYuc2Vzc2lvbklkO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgIDlh7rlupTnlKjvvIzop6blj5Hnm7jlhbPmnI3liqFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBxdWl0QXBwKG9wdGlvbnM6IEFwcE9wdGlvbnMsIHN1Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgICAgICB0YWJJZDogb3B0aW9ucy50YWJJZCxcclxuICAgICAgICAgICAgdG9rZW46IG9wdGlvbnMudG9rZW4sXHJcbiAgICAgICAgICAgIGFwcElkOiBvcHRpb25zLmFwcElkLFxyXG4gICAgICAgICAgICBhcHBFbnRyYW5jZTogb3B0aW9ucy5hcHBFbnRyYW5jZSxcclxuICAgICAgICAgICAgYWN0aW9uOiAncXVpdGFwcCdcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBpbnZva09icyA9IHRoaXMuZ2V0QXBwSW52b2sob3B0aW9ucy5hcHBJZCk7XHJcbiAgICAgICAgY29uc3QgYml6Q29udGV4dFVybCA9IHRoaXMuRlVOQ1NUQVRVU19QQVRIICsgKCFzdSA/ICcnIDogYD9zdT0ke3N1fWApO1xyXG4gICAgICAgIGNvbnN0IGZ1bmNTdGF0ZSQgPSB0aGlzLmh0dHAucmVxdWVzdCgnUG9zdCcsIGJpekNvbnRleHRVcmwsIEZybVV0aWwuc2V0SGVhZGVyKG51bGwsIHsgYm9keSB9KSk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBkZXByZWNhdGlvblxyXG4gICAgICAgIGNvbnN0ICRyID0gemlwKGludm9rT2JzLCBmdW5jU3RhdGUkLCAocmVzMSwgcmVzMikgPT4gKHsgcmVzMSwgcmVzMiB9KSk7XHJcbiAgICAgICAgcmV0dXJuICRyO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0U3UodXJsOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHVyaUFyciA9IHVybC5zcGxpdCgnLycpO1xyXG4gICAgICAgIHJldHVybiB1cmlBcnIubGVuZ3RoID4gMyA/IHVyaUFyclszXSA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW52b2tDYWNoZSgpIHtcclxuICAgICAgICBjb25zdCBhcHBJbnZva2VzQ2FjaGUgPSB0aGlzLmZybVZhcmlhYmxlU2VydmljZS5nZXRGcm1WYXJpYWJsZUJ5S2V5KHRoaXMuQVBQSU5WT0tFX0NBSENFX0tFWSk7XHJcbiAgICAgICAgcmV0dXJuIGFwcEludm9rZXNDYWNoZSBhcyBhbnlbXSB8fCBbXTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZnJlc2hJbnZva0NhY2hlKGludm9rczogYW55W10sIGZ1bmNJbnZvazogYW55KSB7XHJcbiAgICAgICAgaWYgKCFmdW5jSW52b2spIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnZva3MucHVzaChmdW5jSW52b2spO1xyXG4gICAgICAgIHRoaXMuZnJtVmFyaWFibGVTZXJ2aWNlLmZyYW1ld29ya1ZhcmlhYmxlUmVnKHRoaXMuQVBQSU5WT0tFX0NBSENFX0tFWSwgaW52b2tzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG1heC1saW5lLWxlbmd0aFxyXG4gICAgcHJpdmF0ZSBidWlsZFF1ZXJ5U3RyaW5nKHJvdXR1cmw6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgdGFiSWQ6IHN0cmluZywgdG9rZW46IHN0cmluZywgcGFyYW1zOiBNYXA8c3RyaW5nLCBzdHJpbmc+KTogc3RyaW5nIHtcclxuICAgICAgICBpZiAocm91dHVybC5pbmRleE9mKCc/JykgPCAwKSB7XHJcbiAgICAgICAgICAgIHJvdXR1cmwgKz0gYD9hcHBJZD0ke2FwcElkfSZhcHBFbnRyYW5jZT0ke2FwcEVudHJhbmNlfWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcm91dHVybCArPSBgJmFwcElkPSR7YXBwSWR9JmFwcEVudHJhbmNlPSR7YXBwRW50cmFuY2V9YDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJvdXR1cmwgKz0gYCZhcHBUeXBlPSR7QXBwVHlwZS5BcHB9YDtcclxuICAgICAgICByb3V0dXJsICs9IGAmdGFiSWQ9JHt0aGlzLmdldFBhZ2VJZChhcHBJZCwgYXBwRW50cmFuY2UsIHRhYklkKX1gO1xyXG4gICAgICAgIHJvdXR1cmwgKz0gIXRva2VuID8gJycgOiBgJmN2ZnQ9JHt0b2tlbn1gO1xyXG4gICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgcGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJvdXR1cmwgKz0gIWtleSA/ICcnIDogYCYke2tleX09JHt2YWx1ZX1gO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJvdXR1cmw7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0RmViKCk6IEZybUV2ZW50QnVzIHtcclxuICAgICAgICByZXR1cm4gRXZlbnRVdGlsLmdldEZybUV2ZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtZXJnZUFwcElkKGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gYCR7YXBwSWR9XyR7YXBwRW50cmFuY2V9YDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluW9k+WJjeiPnOWNlemhtemdoueahOWUr+S4gOagh+ivhlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldFBhZ2VJZChhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCB0YWJJZDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGFiSWQgfHwgdGhpcy5tZXJnZUFwcElkKGFwcElkLCBhcHBFbnRyYW5jZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnlJ/miJDpobXpnaLllK/kuIDmoIfor4ZcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBuZXdQYWdlSWQoYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZywgdGFiSWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRhYklkID8gYCR7dGhpcy5tZXJnZUFwcElkKGFwcElkLCBhcHBFbnRyYW5jZSl9XyR7dGFiSWR9YCA6IHRoaXMubWVyZ2VBcHBJZChhcHBJZCwgYXBwRW50cmFuY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hlY2tpbmdSZXBlYXRPcGVuKG9wdGlvbnM6IEFwcE9wdGlvbnMpOiBJZnJhbWVMaW5rIHtcclxuICAgICAgICBjb25zdCBhcHBJZCA9IG9wdGlvbnMuYXBwSWQ7XHJcbiAgICAgICAgY29uc3QgYXBwRW50cmFuY2UgPSBvcHRpb25zLmFwcEVudHJhbmNlO1xyXG4gICAgICAgIGNvbnN0IHRhYklkID0gb3B0aW9ucy50YWJJZDtcclxuICAgICAgICBjb25zdCBlbnRpdHlQYXJhbXMgPSBvcHRpb25zLmVudGl0eVBhcmFtcztcclxuXHJcbiAgICAgICAgbGV0IGxpbmtvYmo6IElmcmFtZUxpbms7XHJcbiAgICAgICAgY29uc3QgcGFnZUlkID0gdGhpcy5nZXRQYWdlSWQoYXBwSWQsIGFwcEVudHJhbmNlLCB0YWJJZCk7XHJcbiAgICAgICAgbGlua29iaiA9IEZybVV0aWwuZ2V0VGFiQXJyYXkoKS5maW5kKGkgPT4gaS5pZCA9PT0gcGFnZUlkICYmIGkuYXBwVHlwZSA9PT0gQXBwVHlwZS5BcHApO1xyXG4gICAgICAgIGlmIChsaW5rb2JqKSB7XHJcbiAgICAgICAgICAgIGxpbmtvYmouRnVuY05hbWUgPSBvcHRpb25zLnRhYk5hbWUgfHwgbGlua29iai5GdW5jTmFtZTtcclxuICAgICAgICAgICAgbGlua29iai5zcmMgPSB0aGlzLmJ1aWxkUXVlcnlTdHJpbmcobGlua29iai51cmwsIGFwcElkLCBhcHBFbnRyYW5jZSwgb3B0aW9ucy50YWJJZCxcclxuICAgICAgICAgICAgICAgIGxpbmtvYmouc2Vzc2lvbmlkLCBvcHRpb25zLnF1ZXJ5U3RyaW5nUGFyYW1zKTtcclxuICAgICAgICAgICAgbGlua29iai5yZWxvYWQgPSBvcHRpb25zLmlzUmVsb2FkO1xyXG4gICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QocGFnZUlkLCBlbnRpdHlQYXJhbXMpO1xyXG4gICAgICAgICAgICB0aGlzLmdldEZlYigpLnBvc3QoRXZlbnRVdGlsLkZBUlJJU19BUFBfQ0xJQ0ssIGxpbmtvYmopO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbGlua29iajtcclxuICAgIH1cclxuXHJcbn1cclxuIl19
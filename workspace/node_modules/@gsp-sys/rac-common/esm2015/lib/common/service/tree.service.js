/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { RacCommonUtil } from '../util/rac-util';
/**
 * 取数服务
 */
export class TreeService {
    /**
     * @param {?} util
     */
    constructor(util) {
        this.util = util;
    }
    /**
     * 按照path码构造树
     * @param {?} datas
     * @param {?} pathField
     * @return {?}
     */
    makeTreeByPath(datas, pathField) {
        // 上級爲空，或者沒有上級的
        /** @type {?} */
        const pathLayerOnes = datas.filter((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (this.util.isNullOrEmptyString(x[pathField])) {
                return true;
            }
            /** @type {?} */
            const findObj = datas.find((/**
             * @param {?} parent
             * @return {?}
             */
            parent => parent[pathField] === x[pathField].substring(0, x[pathField].length - 4)));
            if (findObj === undefined || findObj === null) {
                return true;
            }
        }));
        /** @type {?} */
        const treedata = [];
        pathLayerOnes.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            const entity = {};
            entity['data'] = x;
            entity['children'] = [];
            treedata.push(entity);
            // this.root = x['id'];
        }));
        treedata.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this.findChildrenByPath(item, datas, pathField);
        }));
        return treedata;
    }
    /**
     * 找到子节点
     * @param {?} parent
     * @param {?} datas
     * @param {?} pathField
     * @return {?}
     */
    findChildrenByPath(parent, datas, pathField) {
        /** @type {?} */
        const childList = datas.filter((/**
         * @param {?} childitem
         * @return {?}
         */
        childitem => {
            if (childitem[pathField].substring(0, childitem[pathField].length - 4) === parent['data'][pathField]) {
                return true;
            }
        }));
        if (childList && childList.length > 0) {
            childList.forEach((/**
             * @param {?} child
             * @return {?}
             */
            child => {
                /** @type {?} */
                const childEntity = {};
                childEntity['data'] = child;
                // tslint:disable-next-line:no-string-literal
                childEntity['children'] = [];
                // tslint:disable-next-line:no-string-literal
                parent['children'].push(childEntity);
                this.findChildrenByPath(childEntity, datas, pathField);
            }));
        }
    }
    /**
     * 按照parent码构造树
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    makeTreeByParent(datas, parentField, keyField) {
        // 上級爲空，或者沒有上級的
        /** @type {?} */
        const pathLayerOnes = datas.filter((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (this.util.isNullOrEmptyString(x[parentField])) {
                return true;
            }
            // 断层的这种，应该也属于一级
            /** @type {?} */
            const p = datas.find((/**
             * @param {?} parent
             * @return {?}
             */
            parent => parent[keyField] === x[parentField]));
            if (!p) {
                return true;
            }
        }));
        /** @type {?} */
        const treedata = [];
        pathLayerOnes.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            const entity = {};
            entity['data'] = x;
            entity['children'] = [];
            treedata.push(entity);
            // this.root = x['id'];
        }));
        treedata.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this.findChildrenByParent(item, datas, parentField, keyField);
        }));
        return treedata;
    }
    /**
     * 找到子节点
     * @param {?} parent
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    findChildrenByParent(parent, datas, parentField, keyField) {
        /** @type {?} */
        const childList = datas.filter((/**
         * @param {?} childitem
         * @return {?}
         */
        childitem => {
            if (childitem[parentField] === parent['data'][keyField]) {
                return true;
            }
        }));
        if (childList && childList.length > 0) {
            childList.forEach((/**
             * @param {?} child
             * @return {?}
             */
            child => {
                /** @type {?} */
                const childEntity = {};
                childEntity['data'] = child;
                childEntity['children'] = [];
                parent['children'].push(childEntity);
                this.findChildrenByParent(childEntity, datas, parentField, keyField);
            }));
        }
    }
}
TreeService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
TreeService.ctorParameters = () => [
    { type: RacCommonUtil }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    TreeService.prototype.util;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zeXMvcmFjLWNvbW1vbi8iLCJzb3VyY2VzIjpbImxpYi9jb21tb24vc2VydmljZS90cmVlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUdBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7O0FBUWpELE1BQU0sT0FBTyxXQUFXOzs7O0lBQ3BCLFlBRVksSUFBbUI7UUFBbkIsU0FBSSxHQUFKLElBQUksQ0FBZTtJQUcvQixDQUFDOzs7Ozs7O0lBR0QsY0FBYyxDQUFDLEtBQVksRUFBRSxTQUFpQjs7O2NBRXBDLGFBQWEsR0FBRyxLQUFLLENBQUMsTUFBTTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ25DLElBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRztnQkFDaEQsT0FBTyxJQUFJLENBQUM7YUFDZDs7a0JBQ0ssT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJOzs7O1lBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUUsRUFBQztZQUMvRyxJQUFLLE9BQU8sS0FBSyxTQUFTLElBQUksT0FBTyxLQUFLLElBQUksRUFBRztnQkFDOUMsT0FBTyxJQUFJLENBQUM7YUFDZDtRQUVMLENBQUMsRUFBQzs7Y0FDSSxRQUFRLEdBQUcsRUFBRTtRQUNuQixhQUFhLENBQUMsT0FBTzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFOztrQkFDWixNQUFNLEdBQUcsRUFBRTtZQUNqQixNQUFNLENBQUMsTUFBTSxDQUFDLEdB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QVksRUFBRSxXQUFtQixFQUFFLFFBQWdCOztjQUMzRSxTQUFTLEdBQUcsS0FBSyxDQUFDLE1BQU07Ozs7UUFBQyxTQUFTLENBQUMsRUFBRTtZQUN2QyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQ3JELE9BQU8sSUFBSSxDQUFDO2FBQ2Y7UUFDTCxDQUFDLEVBQUM7UUFDRixJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyQyxTQUFTLENBQUMsT0FBTzs7OztZQUFDLEtBQUssQ0FBQyxFQUFFOztzQkFDbEIsV0FBVyxHQUFHLEVBQUU7Z0JBQ3RCLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQzVCLFdBQVcsQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzdCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ3JDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUN2RSxDQUFDLEVBQUMsQ0FBQztTQUNKO0lBQ0wsQ0FBQzs7O1lBckdKLFVBQVU7Ozs7WUFQRixhQUFhOzs7Ozs7O0lBV2QsMkJBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFJlc3RmdWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBSYWNDb21tb25VdGlsIH0gZnJvbSAnLi4vdXRpbC9yYWMtdXRpbCc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL29mJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEhpZXJhcmNoaWNhbFR5cGUgfSBmcm9tICcuLi9lbnRpdHkvaGllcmFyY2hpY2FsLXR5cGUuZW51bSc7XHJcblxyXG5cclxuLyoqIOWPluaVsOacjeWKoSAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBUcmVlU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICAvLyBwcml2YXRlIHJlc3Q6IFJlc3RmdWxTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgdXRpbDogUmFjQ29tbW9uVXRpbCxcclxuICAgICAgICAvLyBwcml2YXRlIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmjInnhadwYXRo56CB5p6E6YCg5qCRICovXHJcbiAgICBtYWtlVHJlZUJ5UGF0aChkYXRhczogYW55W10sIHBhdGhGaWVsZDogc3RyaW5nICk6IGFueSBbXSB7XHJcbiAgICAgICAgLy8g5LiK57Sa54iy56m677yM5oiW6ICF5rKS5pyJ5LiK57Sa55qEXHJcbiAgICAgICAgY29uc3QgcGF0aExheWVyT25lcyA9IGRhdGFzLmZpbHRlcih4ID0+IHtcclxuICAgICAgICAgICAgaWYgKCB0aGlzLnV0aWwuaXNOdWxsT3JFbXB0eVN0cmluZyh4W3BhdGhGaWVsZF0pICkge1xyXG4gICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBmaW5kT2JqID0gZGF0YXMuZmluZChwYXJlbnQgPT4gcGFyZW50W3BhdGhGaWVsZF0gPT09IHhbcGF0aEZpZWxkXS5zdWJzdHJpbmcoMCwgeFtwYXRoRmllbGRdLmxlbmd0aCAtIDQgKSk7XHJcbiAgICAgICAgICAgIGlmICggZmluZE9iaiA9PT0gdW5kZWZpbmVkIHx8IGZpbmRPYmogPT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IHRyZWVkYXRhID0gW107XHJcbiAgICAgICAgcGF0aExheWVyT25lcy5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW50aXR5ID0ge307XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlbJ2RhdGEnXSA9IHg7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlbJ2NoaWxkcmVuJ10gPSBbXTtcclxuICAgICAgICAgICAgICAgIHRyZWVkYXRhLnB1c2goZW50aXR5KTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMucm9vdCA9IHhbJ2lkJ107XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdHJlZWRhdGEuZm9yRWFjaCggaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRDaGlsZHJlbkJ5UGF0aChpdGVtLCBkYXRhcywgcGF0aEZpZWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHRyZWVkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmib7liLDlrZDoioLngrkgKi9cclxuICAgIGZpbmRDaGlsZHJlbkJ5UGF0aChwYXJlbnQ6IGFueSwgZGF0YXM6IGFueVtdLCBwYXRoRmllbGQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgY2hpbGRMaXN0ID0gZGF0YXMuZmlsdGVyKGNoaWxkaXRlbSA9PiB7XHJcbiAgICAgICAgICBpZiAoY2hpbGRpdGVtW3BhdGhGaWVsZF0uc3Vic3RyaW5nKDAsIGNoaWxkaXRlbVtwYXRoRmllbGRdLmxlbmd0aCAtIDQpID09PSBwYXJlbnRbJ2RhdGEnXVtwYXRoRmllbGRdKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBpZiAoY2hpbGRMaXN0ICYmIGNoaWxkTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNoaWxkTGlzdC5mb3JFYWNoKGNoaWxkID0+IHtcclxuICAgICAgICBjb25zdCBjaGlsZEVudGl0eSA9IHt9O1xyXG4gICAgICAgIGNoaWxkRW50aXR5WydkYXRhJ10gPSBjaGlsZDtcclxuICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXN0cmluZy1saXRlcmFsXHJcbiAgICAgICAgY2hpbGRFbnRpdHlbJ2NoaWxkcmVuJ10gPSBbXTtcclxuICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXN0cmluZy1saXRlcmFsXHJcbiAgICAgICAgcGFyZW50WydjaGlsZHJlbiddLnB1c2goY2hpbGRFbnRpdHkpO1xyXG4gICAgICAgIHRoaXMuZmluZENoaWxkcmVuQnlQYXRoKGNoaWxkRW50aXR5LCBkYXRhcywgcGF0aEZpZWxkKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAgLyoqIOaMieeFp3BhcmVudOeggeaehOmAoOagkSAqL1xyXG4gICBtYWtlVHJlZUJ5UGFyZW50KGRhdGFzOiBhbnlbXSwgcGFyZW50RmllbGQ6IHN0cmluZywga2V5RmllbGQ6IHN0cmluZyk6IGFueSBbXSB7XHJcbiAgICAvLyDkuIrntJrniLLnqbrvvIzmiJbogIXmspLmnInkuIrntJrnmoRcclxuICAgIGNvbnN0IHBhdGhMYXllck9uZXMgPSBkYXRhcy5maWx0ZXIoeCA9PiB7XHJcbiAgICAgICBpZiAoIHRoaXMudXRpbC5pc051bGxPckVtcHR5U3RyaW5nKHhbcGFyZW50RmllbGRdKSkge1xyXG4gICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgfVxyXG4gICAgICAgLy8g5pat5bGC55qE6L+Z56eN77yM5bqU6K+l5Lmf5bGe5LqO5LiA57qnXHJcbiAgICAgICBjb25zdCBwID0gZGF0YXMuZmluZChwYXJlbnQgPT4gcGFyZW50W2tleUZpZWxkXSA9PT0geFtwYXJlbnRGaWVsZF0pO1xyXG4gICAgICAgaWYgKCFwKSB7XHJcbiAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCB0cmVlZGF0YSA9IFtdO1xyXG4gICAgcGF0aExheWVyT25lcy5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBlbnRpdHkgPSB7fTtcclxuICAgICAgICAgICAgZW50aXR5WydkYXRhJ10gPSB4O1xyXG4gICAgICAgICAgICBlbnRpdHlbJ2NoaWxkcmVuJ10gPSBbXTtcclxuICAgICAgICAgICAgdHJlZWRhdGEucHVzaChlbnRpdHkpO1xyXG4gICAgICAgICAgICAvLyB0aGlzLnJvb3QgPSB4WydpZCddO1xyXG4gICAgfSk7XHJcbiAgICB0cmVlZGF0YS5mb3JFYWNoKCBpdGVtID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maW5kQ2hpbGRyZW5CeVBhcmVudChpdGVtLCBkYXRhcywgcGFyZW50RmllbGQsIGtleUZpZWxkKTtcclxuICAgICAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHRyZWVkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmib7liLDlrZDoioLngrkgKi9cclxuICAgIGZpbmRDaGlsZHJlbkJ5UGFyZW50KHBhcmVudDogYW55LCBkYXRhczogYW55W10sIHBhcmVudEZpZWxkOiBzdHJpbmcsIGtleUZpZWxkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBjaGlsZExpc3QgPSBkYXRhcy5maWx0ZXIoY2hpbGRpdGVtID0+IHtcclxuICAgICAgICAgICAgaWYgKGNoaWxkaXRlbVtwYXJlbnRGaWVsZF0gPT09IHBhcmVudFsnZGF0YSddW2tleUZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoY2hpbGRMaXN0ICYmIGNoaWxkTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjaGlsZExpc3QuZm9yRWFjaChjaGlsZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkRW50aXR5ID0ge307XHJcbiAgICAgICAgICAgIGNoaWxkRW50aXR5WydkYXRhJ10gPSBjaGlsZDtcclxuICAgICAgICAgICAgY2hpbGRFbnRpdHlbJ2NoaWxkcmVuJ10gPSBbXTtcclxuICAgICAgICAgICAgcGFyZW50WydjaGlsZHJlbiddLnB1c2goY2hpbGRFbnRpdHkpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbmRDaGlsZHJlbkJ5UGFyZW50KGNoaWxkRW50aXR5LCBkYXRhcywgcGFyZW50RmllbGQsIGtleUZpZWxkKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
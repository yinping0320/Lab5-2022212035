/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { TreeTableComponent } from '@farris/ui-treetable';
import { AuthObjService } from '../../../common/service/authobj.service';
import { RacCommonUtil } from '../../../common/util/rac-util';
var AuobjTreeComponent = /** @class */ (function () {
    function AuobjTreeComponent(service, racUtil, translate) {
        this.service = service;
        this.racUtil = racUtil;
        this.translate = translate;
        this.data = [];
        this.selectedKey = '';
        this.selectedKeyOld = '';
        // 树所需参数
        this.cols = [];
        this.selectedchanged = new EventEmitter();
        /**
         * 帮助输出事件
         */
        this.selectedAfterOk = new EventEmitter();
        this.closeModalEmitter = new EventEmitter();
    }
    /**
     * @return {?}
     */
    AuobjTreeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.cols = [
            // { field: 'name', title: this.translate.instant('lblAuthObj') }
            { field: 'name', title: '名称' }
        ];
    };
    /** 根据分配的功能操作初始对应的权限对象 */
    /**
     * 根据分配的功能操作初始对应的权限对象
     * @return {?}
     */
    AuobjTreeComponent.prototype.initData = /**
     * 根据分配的功能操作初始对应的权限对象
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var obs = this.service.getAll();
        if (this.dataMode === 'reassign') {
            obs = this.service.getAllReAssign();
        }
        else {
            obs = this.service.getAll();
        }
        obs.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.data = result;
            if (_this.data) {
                /** @type {?} */
                var initNodeList_1 = [];
                /** @type {?} */
                var layer1 = _this.racUtil.findLayer1ByParentId(_this.data, 'id', 'parentId');
                layer1.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    /** @type {?} */
                    var node = _this.convertToTreeNode(item);
                    initNodeList_1.push(node);
                    _this.initTreeNodeList(node);
                }));
                _this.treeNodeData = initNodeList_1;
                _this.racUtil.setTreeIcon(_this.farrisTt);
            }
        }));
    };
    /**
     * 构造Farris-Tree所需结构
     * @param authfieldList 权限字段列表
     */
    /**
     * 构造Farris-Tree所需结构
     * @private
     * @param {?} parentNode
     * @return {?}
     */
    AuobjTreeComponent.prototype.initTreeNodeList = /**
     * 构造Farris-Tree所需结构
     * @private
     * @param {?} parentNode
     * @return {?}
     */
    function (parentNode) {
        var _this = this;
        // 根据父节点过滤子节点
        /** @type {?} */
        var children = this.data.filter((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return x.parentId === parentNode.data.id; }));
        // 将过滤的数据加到TreeNodes中
        if (children && children.length > 0) {
            children.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                /** @type {?} */
                var child = _this.convertToTreeNode(item);
                parentNode.leaf = false;
                parentNode.children.push(child);
                _this.initTreeNodeList(child);
            }));
        }
    };
    /**
     * 将权限字段实体转换为Farris-TreeNode
     */
    /**
     * 将权限字段实体转换为Farris-TreeNode
     * @private
     * @param {?} obj
     * @return {?}
     */
    AuobjTreeComponent.prototype.convertToTreeNode = /**
     * 将权限字段实体转换为Farris-TreeNode
     * @private
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var node = { data: obj, leaf: true, children: [], icon: this.racUtil.leafIcon };
        // 是否明细节点，type为0 说明是导航
        if (this.racUtil.isNav(obj.type.toString())) {
            // tslint:disable-next-line:no-string-literal
            node['leaf'] = false;
            // tslint:disable-next-line:no-string-literal
            node['children'] = [];
            node['expandedIcon'] = this.racUtil.expandIcon; // 'folder-open';
            node['collapseIcon'] = this.racUtil.collapseIcon; // 'folder';
        }
        return node;
    };
    /**
     * @param {?} newObj
     * @return {?}
     */
    AuobjTreeComponent.prototype.appendNode = /**
     * @param {?} newObj
     * @return {?}
     */
    function (newObj) {
        /** @type {?} */
        var parentRowNode = this.farrisTt.findRowNode(newObj.parentId);
        // const newTreeNode = this.convertToTreeNode(newObj);
        /** @type {?} */
        var selectedRow = this.farrisTt.selectedRow;
        if (this.racUtil.isNav(selectedRow.data.type)) {
            this.farrisTt.append(newObj, this.farrisTt.selectedRow);
        }
        else {
            this.farrisTt.append(newObj, this.farrisTt.selectedRow.parent);
        }
        this.farrisTt.selectNode(newObj.id);
    };
    /**
     * @param {?} newObj
     * @return {?}
     */
    AuobjTreeComponent.prototype.removeNode = /**
     * @param {?} newObj
     * @return {?}
     */
    function (newObj) {
        this.farrisTt.remove(newObj.id);
    };
    /**
     * @param {?} newObj
     * @return {?}
     */
    AuobjTreeComponent.prototype.updateNode = /**
     * @param {?} newObj
     * @return {?}
     */
    function (newObj) {
        // TODO update时data 参数有问题
        // this.farrisTt.update(newObj.id, newObj);
    };
    /**
     * 选中行改变后触发事件
     */
    /**
     * 选中行改变后触发事件
     * @param {?} args
     * @return {?}
     */
    AuobjTreeComponent.prototype.handleSelection = /**
     * 选中行改变后触发事件
     * @param {?} args
     * @return {?}
     */
    function (args) {
        this.selectedKey = args.node.data.id;
        this.selectedModel = args.node.data;
        // 首次触发
        if (this.selectedKeyOld === '') {
            this.selectedKeyOld = this.selectedKey;
            this.selectedchanged.emit(this.selectedModel);
        }
        else {
            // 变化的情况下触发
            if (this.selectedKeyOld !== this.selectedKey) {
                this.selectedKeyOld = this.selectedKey;
                this.selectedchanged.emit(this.selectedModel);
            }
        }
    };
    /**
     * @param {?} __0
     * @return {?}
     */
    AuobjTreeComponent.prototype.iconClass = /**
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var id = _a.id;
        return {
            'k-i-folder': true,
            'k-icon': true
        };
    };
    /** 帮助确定按钮 */
    /**
     * 帮助确定按钮
     * @return {?}
     */
    AuobjTreeComponent.prototype.confirm = /**
     * 帮助确定按钮
     * @return {?}
     */
    function () {
        this.selectedKeyOld = this.selectedKey;
        this.selectedAfterOk.emit(this.selectedModel);
    };
    /**
     * @return {?}
     */
    AuobjTreeComponent.prototype.cancle = /**
     * @return {?}
     */
    function () {
        this.closeModalEmitter.next();
    };
    AuobjTreeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'rac-auobj-tree',
                    template: "<farris-treetable class =\"f-utils-fill-flex-column\"  #farrisTt  \r\n[data]=\"treeNodeData\"\r\n[columns]=\"cols\"\r\n[idField]=\"'id'\" \r\n[fixedHeader]=\"true\"\r\n[fit]=\"true\"\r\n[showIcon]=\"true\"\r\n(nodeSelected)=\"handleSelection($event)\">\r\n</farris-treetable>\r\n\r\n<ng-template #btnOkAndCancle >\r\n    <button class=\"btn btn-sm btn-primary\" (click)=\"confirm()\">\u786E\u8BA4</button>\r\n    <button class=\"btn btn-sm btn-default\" (click)=\"cancle()\">\u53D6\u6D88</button>\r\n  </ng-template>\r\n\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    AuobjTreeComponent.ctorParameters = function () { return [
        { type: AuthObjService },
        { type: RacCommonUtil },
        { type: TranslateService }
    ]; };
    AuobjTreeComponent.propDecorators = {
        dataMode: [{ type: Input }],
        initSelectedKeys: [{ type: Input }],
        farrisTt: [{ type: ViewChild, args: ['farrisTt',] }],
        selectedchanged: [{ type: Output }],
        selectedAfterOk: [{ type: Output }],
        closeModalEmitter: [{ type: Output }],
        btnOkAndCancleRef: [{ type: ViewChild, args: ['btnOkAndCancle',] }]
    };
    return AuobjTreeComponent;
}());
export { AuobjTreeComponent };
if (false) {
    /**
     * 要加载的数据类型
     * all代表全部权限对象
     * reassign代表允许在用户上重新授权的权限对象
     * @type {?}
     */
    AuobjTreeComponent.prototype.dataMode;
    /** @type {?} */
    AuobjTreeComponent.prototype.initSelectedKeys;
    /** @type {?} */
    AuobjTreeComponent.prototype.data;
    /** @type {?} */
    AuobjTreeComponent.prototype.selectedKey;
    /** @type {?} */
    AuobjTreeComponent.prototype.selectedKeyOld;
    /** @type {?} */
    AuobjTreeComponent.prototype.selectedModel;
    /** @type {?} */
    AuobjTreeComponent.prototype.cols;
    /**
     * 树绑定数据源
     * @type {?}
     */
    AuobjTreeComponent.prototype.treeNodeData;
    /** @type {?} */
    AuobjTreeComponent.prototype.farrisTt;
    /** @type {?} */
    AuobjTreeComponent.prototype.selectedchanged;
    /**
     * 帮助输出事件
     * @type {?}
     */
    AuobjTreeComponent.prototype.selectedAfterOk;
    /** @type {?} */
    AuobjTreeComponent.prototype.closeModalEmitter;
    /** @type {?} */
    AuobjTreeComponent.prototype.btnOkAndCancleRef;
    /**
     * @type {?}
     * @private
     */
    AuobjTreeComponent.prototype.service;
    /** @type {?} */
    AuobjTreeComponent.prototype.racUtil;
    /**
     * @type {?}
     * @private
     */
    AuobjTreeComponent.prototype.translate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVvYmotdHJlZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9yYWMtY29tbW9uLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudC9hdW9iai9hdW9iai10cmVlL2F1b2JqLXRyZWUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHdkcsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFZLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFJcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUU5RDtJQW1DRSw0QkFDVSxPQUF1QixFQUN4QixPQUFzQixFQUNyQixTQUEyQjtRQUYzQixZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUN4QixZQUFPLEdBQVAsT0FBTyxDQUFlO1FBQ3JCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBckI5QixTQUFJLEdBQVUsRUFBRSxDQUFDO1FBQ2pCLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3hCLG1CQUFjLEdBQUcsRUFBRSxDQUFDOztRQUdwQixTQUFJLEdBQVUsRUFBRSxDQUFDO1FBSVAsb0JBQWUsR0FBZ0MsSUFBSSxZQUFZLEVBQWlCLENBQUM7Ozs7UUFHakYsb0JBQWUsR0FBZ0MsSUFBSSxZQUFZLEVBQWlCLENBQUM7UUFDakYsc0JBQWlCLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7SUFTekUsQ0FBQzs7OztJQUVELHFDQUFROzs7SUFBUjtRQUNFLElBQUksQ0FBQyxJQUFJLEdBQUc7WUFDVixpRUFBaUU7WUFDakUsRUFBRSxLQUFLLEVBQUUsTUFBTSxF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TUFBTTtrQ0FHTixNQUFNO29DQUNOLE1BQU07b0NBR04sU0FBUyxTQUFDLGdCQUFnQjs7SUFtSTdCLHlCQUFDO0NBQUEsQUFwS0QsSUFvS0M7U0EvSlksa0JBQWtCOzs7Ozs7OztJQU03QixzQ0FDNkI7O0lBRTdCLDhDQUMyQjs7SUFFM0Isa0NBQXdCOztJQUN4Qix5Q0FBd0I7O0lBQ3hCLDRDQUFvQjs7SUFDcEIsMkNBQTZCOztJQUU3QixrQ0FBaUI7Ozs7O0lBRWpCLDBDQUF5Qjs7SUFDekIsc0NBQW9EOztJQUNwRCw2Q0FBMkY7Ozs7O0lBRzNGLDZDQUEyRjs7SUFDM0YsK0NBQXlFOztJQUd6RSwrQ0FBaUU7Ozs7O0lBRy9ELHFDQUErQjs7SUFDL0IscUNBQTZCOzs7OztJQUM3Qix1Q0FBbUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmVlTm9kZSwgVHJlZVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS10cmVldGFibGUnO1xyXG5cclxuXHJcbmltcG9ydCB7IEF1dGhvYmpFbnRpdHkgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vZW50aXR5L2F1dGhvYmouZW50aXR5JztcclxuaW1wb3J0IHsgQXV0aE9ialNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vc2VydmljZS9hdXRob2JqLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSYWNDb21tb25VdGlsIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL3V0aWwvcmFjLXV0aWwnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdyYWMtYXVvYmotdHJlZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2F1b2JqLXRyZWUuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2F1b2JqLXRyZWUuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBdW9ialRyZWVDb21wb25lbnQgIGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgICAvKiog6KaB5Yqg6L2955qE5pWw5o2u57G75Z6LXHJcbiAgICAgKiBhbGzku6Pooajlhajpg6jmnYPpmZDlr7nosaFcclxuICAgICAqIHJlYXNzaWdu5Luj6KGo5YWB6K645Zyo55So5oi35LiK6YeN5paw5o6I5p2D55qE5p2D6ZmQ5a+56LGhXHJcbiAgICAgKi9cclxuICBASW5wdXQoKVxyXG4gIGRhdGFNb2RlOiAnYWxsJyB8ICdyZWFzc2lnbic7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgaW5pdFNlbGVjdGVkS2V5czogc3RyaW5nW107XHJcblxyXG4gIHB1YmxpYyBkYXRhOiBhbnlbXSA9IFtdO1xyXG4gIHB1YmxpYyBzZWxlY3RlZEtleSA9ICcnO1xyXG4gIHNlbGVjdGVkS2V5T2xkID0gJyc7XHJcbiAgc2VsZWN0ZWRNb2RlbDogQXV0aG9iakVudGl0eTtcclxuICAvLyDmoJHmiYDpnIDlj4LmlbBcclxuICBjb2xzOiBhbnlbXSA9IFtdO1xyXG4gIC8qKiDmoJHnu5HlrprmlbDmja7mupAgKi9cclxuICB0cmVlTm9kZURhdGE6IFRyZWVOb2RlW107XHJcbiAgQFZpZXdDaGlsZCgnZmFycmlzVHQnKSBmYXJyaXNUdDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RlZGNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxBdXRob2JqRW50aXR5PiA9IG5ldyBFdmVudEVtaXR0ZXI8QXV0aG9iakVudGl0eT4oKTtcclxuXHJcbiAgLyoqIOW4ruWKqei+k+WHuuS6i+S7tiAqL1xyXG4gIEBPdXRwdXQoKSBzZWxlY3RlZEFmdGVyT2s6IEV2ZW50RW1pdHRlcjxBdXRob2JqRW50aXR5PiA9IG5ldyBFdmVudEVtaXR0ZXI8QXV0aG9iakVudGl0eT4oKTtcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbEVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIC8vIOazqOWFpeWIsOW4ruWKqeeahOehruiupOWSjOWPlua2iOaMiemSrlxyXG4gIEBWaWV3Q2hpbGQoJ2J0bk9rQW5kQ2FuY2xlJykgYnRuT2tBbmRDYW5jbGVSZWY6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBzZXJ2aWNlOiBBdXRoT2JqU2VydmljZSxcclxuICAgIHB1YmxpYyByYWNVdGlsOiBSYWNDb21tb25VdGlsLFxyXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UpIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb2xzID0gW1xyXG4gICAgICAvLyB7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdsYmxBdXRoT2JqJykgfVxyXG4gICAgICB7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiAn5ZCN56ewJyB9XHJcbiAgICBdO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKiDmoLnmja7liIbphY3nmoTlip/og73mk43kvZzliJ3lp4vlr7nlupTnmoTmnYPpmZDlr7nosaEgKi9cclxuICBpbml0RGF0YSgpIHtcclxuICAgIGxldCBvYnMgPSB0aGlzLnNlcnZpY2UuZ2V0QWxsKCk7XHJcbiAgICBpZiAoIHRoaXMuZGF0YU1vZGUgPT09ICdyZWFzc2lnbicgKSB7XHJcbiAgICAgIG9icyA9IHRoaXMuc2VydmljZS5nZXRBbGxSZUFzc2lnbigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgb2JzID0gdGhpcy5zZXJ2aWNlLmdldEFsbCgpO1xyXG4gICAgfVxyXG4gICAgb2JzLnN1YnNjcmliZSgocmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5kYXRhID0gcmVzdWx0O1xyXG4gICAgICBpZiAodGhpcy5kYXRhKSB7XHJcbiAgICAgICAgY29uc3QgaW5pdE5vZGVMaXN0OiBUcmVlTm9kZVtdID0gW107XHJcbiAgICAgICAgY29uc3QgbGF5ZXIxID0gdGhpcy5yYWNVdGlsLmZpbmRMYXllcjFCeVBhcmVudElkKHRoaXMuZGF0YSwgJ2lkJywgJ3BhcmVudElkJyk7XHJcbiAgICAgICAgbGF5ZXIxLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBub2RlID0gdGhpcy5jb252ZXJ0VG9UcmVlTm9kZShpdGVtKTtcclxuICAgICAgICAgIGluaXROb2RlTGlzdC5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgdGhpcy5pbml0VHJlZU5vZGVMaXN0KG5vZGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMudHJlZU5vZGVEYXRhID0gaW5pdE5vZGVMaXN0O1xyXG4gICAgICAgIHRoaXMucmFjVXRpbC5zZXRUcmVlSWNvbih0aGlzLmZhcnJpc1R0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOaehOmAoEZhcnJpcy1UcmVl5omA6ZyA57uT5p6EXHJcbiAgICogQHBhcmFtIGF1dGhmaWVsZExpc3Qg5p2D6ZmQ5a2X5q615YiX6KGoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0VHJlZU5vZGVMaXN0KHBhcmVudE5vZGU6IFRyZWVOb2RlKSB7XHJcbiAgICAvLyDmoLnmja7niLboioLngrnov4fmu6TlrZDoioLngrlcclxuICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5kYXRhLmZpbHRlcih4ID0+IHgucGFyZW50SWQgPT09IHBhcmVudE5vZGUuZGF0YS5pZCk7XHJcblxyXG4gICAgLy8g5bCG6L+H5ruk55qE5pWw5o2u5Yqg5YiwVHJlZU5vZGVz5LitXHJcbiAgICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICBjaGlsZHJlbi5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jb252ZXJ0VG9UcmVlTm9kZShpdGVtKTtcclxuICAgICAgICBwYXJlbnROb2RlLmxlYWYgPSBmYWxzZTtcclxuICAgICAgICBwYXJlbnROb2RlLmNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG4gICAgICAgIHRoaXMuaW5pdFRyZWVOb2RlTGlzdChjaGlsZCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bCG5p2D6ZmQ5a2X5q615a6e5L2T6L2s5o2i5Li6RmFycmlzLVRyZWVOb2RlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb252ZXJ0VG9UcmVlTm9kZShvYmo6IEF1dGhvYmpFbnRpdHkpOiBUcmVlTm9kZSB7XHJcbiAgICBjb25zdCBub2RlID0geyBkYXRhOiBvYmosIGxlYWY6IHRydWUsIGNoaWxkcmVuOiBbXSwgaWNvbjogdGhpcy5yYWNVdGlsLmxlYWZJY29uIH07XHJcbiAgICAvLyDmmK/lkKbmmI7nu4boioLngrnvvIx0eXBl5Li6MCDor7TmmI7mmK/lr7zoiKpcclxuICAgIGlmICh0aGlzLnJhY1V0aWwuaXNOYXYob2JqLnR5cGUudG9TdHJpbmcoKSkpIHtcclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXN0cmluZy1saXRlcmFsXHJcbiAgICAgIG5vZGVbJ2xlYWYnXSA9IGZhbHNlO1xyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tc3RyaW5nLWxpdGVyYWxcclxuICAgICAgbm9kZVsnY2hpbGRyZW4nXSA9IFtdO1xyXG4gICAgICBub2RlWydleHBhbmRlZEljb24nXSA9IHRoaXMucmFjVXRpbC5leHBhbmRJY29uOyAgLy8gJ2ZvbGRlci1vcGVuJztcclxuICAgICAgbm9kZVsnY29sbGFwc2VJY29uJ10gPSB0aGlzLnJhY1V0aWwuY29sbGFwc2VJY29uOyAvLyAnZm9sZGVyJztcclxuICAgIH1cclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgYXBwZW5kTm9kZShuZXdPYmo6IEF1dGhvYmpFbnRpdHkpIHtcclxuICAgIGNvbnN0IHBhcmVudFJvd05vZGUgPSB0aGlzLmZhcnJpc1R0LmZpbmRSb3dOb2RlKG5ld09iai5wYXJlbnRJZCk7XHJcbiAgICAvLyBjb25zdCBuZXdUcmVlTm9kZSA9IHRoaXMuY29udmVydFRvVHJlZU5vZGUobmV3T2JqKTtcclxuICAgIGNvbnN0IHNlbGVjdGVkUm93ID0gdGhpcy5mYXJyaXNUdC5zZWxlY3RlZFJvdztcclxuICAgIGlmICh0aGlzLnJhY1V0aWwuaXNOYXYoIHNlbGVjdGVkUm93LmRhdGEudHlwZSkpIHtcclxuICAgICAgdGhpcy5mYXJyaXNUdC5hcHBlbmQoIG5ld09iaiwgdGhpcy5mYXJyaXNUdC5zZWxlY3RlZFJvdyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmZhcnJpc1R0LmFwcGVuZCggbmV3T2JqICwgdGhpcy5mYXJyaXNUdC5zZWxlY3RlZFJvdy5wYXJlbnQpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mYXJyaXNUdC5zZWxlY3ROb2RlKG5ld09iai5pZCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVOb2RlKG5ld09iajogQXV0aG9iakVudGl0eSkge1xyXG4gICAgdGhpcy5mYXJyaXNUdC5yZW1vdmUobmV3T2JqLmlkKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZU5vZGUobmV3T2JqOiBBdXRob2JqRW50aXR5KSB7XHJcbiAgIC8vIFRPRE8gdXBkYXRl5pe2ZGF0YSDlj4LmlbDmnInpl67pophcclxuICAgLy8gdGhpcy5mYXJyaXNUdC51cGRhdGUobmV3T2JqLmlkLCBuZXdPYmopO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6YCJ5Lit6KGM5pS55Y+Y5ZCO6Kem5Y+R5LqL5Lu2XHJcbiAgICovXHJcbiAgaGFuZGxlU2VsZWN0aW9uKGFyZ3M6IGFueSkge1xyXG4gICAgdGhpcy5zZWxlY3RlZEtleSA9IGFyZ3Mubm9kZS5kYXRhLmlkO1xyXG4gICAgdGhpcy5zZWxlY3RlZE1vZGVsID0gYXJncy5ub2RlLmRhdGE7XHJcbiAgICAvLyDpppbmrKHop6blj5FcclxuICAgIGlmICh0aGlzLnNlbGVjdGVkS2V5T2xkID09PSAnJykge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkS2V5T2xkID0gdGhpcy5zZWxlY3RlZEtleTtcclxuICAgICAgdGhpcy5zZWxlY3RlZGNoYW5nZWQuZW1pdCh0aGlzLnNlbGVjdGVkTW9kZWwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5Y+Y5YyW55qE5oOF5Ya15LiL6Kem5Y+RXHJcbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkS2V5T2xkICE9PSB0aGlzLnNlbGVjdGVkS2V5KSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZEtleU9sZCA9IHRoaXMuc2VsZWN0ZWRLZXk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZGNoYW5nZWQuZW1pdCh0aGlzLnNlbGVjdGVkTW9kZWwpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpY29uQ2xhc3MoeyBpZCB9OiBhbnkpOiBhbnkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgJ2staS1mb2xkZXInOiB0cnVlLFxyXG4gICAgICAnay1pY29uJzogdHJ1ZVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKiDluK7liqnnoa7lrprmjInpkq4gKi9cclxuICBjb25maXJtKCkge1xyXG4gICAgdGhpcy5zZWxlY3RlZEtleU9sZCA9IHRoaXMuc2VsZWN0ZWRLZXk7XHJcbiAgICB0aGlzLnNlbGVjdGVkQWZ0ZXJPay5lbWl0KHRoaXMuc2VsZWN0ZWRNb2RlbCk7XHJcbiAgfVxyXG5cclxuICBjYW5jbGUoKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWxFbWl0dGVyLm5leHQoKTtcclxuICB9XHJcbn1cclxuXHJcbiJdfQ==
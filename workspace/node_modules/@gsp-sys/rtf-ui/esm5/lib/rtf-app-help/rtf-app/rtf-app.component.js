/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, TemplateRef, Input } from '@angular/core';
import { RtfAppService } from '../service/rtf-app.service';
import { i18nFuncHelpInfo } from '../../models/i18n-model/i18n-model';
/**
 * 系统管理：功能操作左树有、右列表展示
 */
var RtfAppComponent = /** @class */ (function () {
    function RtfAppComponent(rtfAppService) {
        this.rtfAppService = rtfAppService;
        /**
         * 是否分层加载左侧树，默认为false
         */
        this.isLayeredLoad = false;
        /**
         * 确认事件
         */
        this.afterConfirm = new EventEmitter();
        /**
         * 关闭事件
         */
        this.afterCancle = new EventEmitter();
        /**
         * 功能操作全量数据
         */
        this.data = [];
        /**
         * 缓存的菜单及结构数据
         */
        this.allAppList = [];
        /**
         * 当前选中数据
         */
        this.curSelectedKeys = [];
        this.title = '功能菜单帮助';
    }
    /**
     * @return {?}
     */
    RtfAppComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.selectableSettings = {
            checkboxOnly: true,
            // 默认单选
            mode: !this.gridSelectMode ? 'single' : this.gridSelectMode,
            enabled: true
        };
        if (this.isLayeredLoad === false) {
            /** @type {?} */
            var allFuncsStream = this.rtfAppService.getAppList();
            this.loadTreeData(allFuncsStream);
        }
        else {
            this.loadTreeDataByGrandParentId('0');
        }
    };
    /**
     * @param {?} arg
     * @return {?}
     */
    RtfAppComponent.prototype.onKeyUp = /**
     * @param {?} arg
     * @return {?}
     */
    function (arg) {
        if (arg && arg.keyCode === 13) {
            this.searchData(this.filter.nativeElement.value);
        }
    };
    /**
     * 搜索
     * @param filterValue 查询条件
     */
    /**
     * 搜索
     * @param {?} filterValue 查询条件
     * @return {?}
     */
    RtfAppComponent.prototype.searchData = /**
     * 搜索
     * @param {?} filterValue 查询条件
     * @return {?}
     */
    function (filterValue) {
        // 空的搜索是全部数据
        if (filterValue === null || filterValue === '') {
            this.gridData = this.data.concat();
            return;
        }
        /** @type {?} */
        var filter = filterValue.toLowerCase();
        // 搜索到上级时
        this.gridData = this.data.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item.Code.toLowerCase().includes(filter) ||
                item.Name.toLowerCase().includes(filter);
        }));
    };
    /**
     * 业务对象变化后
     * @param arg 业务对象参数
     */
    /**
     * 业务对象变化后
     * @param {?} arg 业务对象参数
     * @return {?}
     */
    RtfAppComponent.prototype.leftAppTreeChanged = /**
     * 业务对象变化后
     * @param {?} arg 业务对象参数
     * @return {?}
     */
    function (arg) {
        if (!this.data || this.data.length === 0) {
            return;
        }
        /** @type {?} */
        var selectedId = arg.Id;
        /** @type {?} */
        var selectedPath = arg.Path;
        // 根据父子关系过滤当前界面数据，包含上下级
        this.gridData = this.data.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item.ParentId === selectedId ||
                item.Path.startsWith(selectedPath);
        }));
    };
    /**
     * @param {?} arg
     * @return {?}
     */
    RtfAppComponent.prototype.onAppTreeExpanded = /**
     * @param {?} arg
     * @return {?}
     */
    function (arg) {
        if (this.isLayeredLoad === false) {
            return;
        }
        if (this.isContainGrandChildNode(arg) === false) {
            this.loadTreeDataByGrandParentId(arg.Id);
        }
    };
    /**
     * 获取选中数据
     */
    /**
     * 获取选中数据
     * @return {?}
     */
    RtfAppComponent.prototype.getSelectedObject = /**
     * 获取选中数据
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var result = this.data
            .filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return _this.curSelectedKeys.findIndex((/**
             * @param {?} select
             * @return {?}
             */
            function (select) { return select === item.Id; })) >= 0;
        }));
        return result;
    };
    /**
     * 确认
     */
    /**
     * 确认
     * @return {?}
     */
    RtfAppComponent.prototype.confirm = /**
     * 确认
     * @return {?}
     */
    function () {
        /** @type {?} */
        var result = this.getSelectedObject();
        // this.selectedTreeNode.selectedInvok = result;
        this.afterConfirm.next(result);
        // 取消-目的是在这里让模态框消失
        this.cancle();
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @return {?}
     */
    RtfAppComponent.prototype.cancle = /**
     * 取消
     * @return {?}
     */
    function () {
        this.afterCancle.next();
    };
    /**
     * @param {?} langCode
     * @return {?}
     */
    RtfAppComponent.prototype.setCurrentLangCode = /**
     * @param {?} langCode
     * @return {?}
     */
    function (langCode) {
        this.currentLangCode = langCode;
        this.title = this.getResOnCurrentLangeContext('TitleName');
    };
    /**
     * @param {?} resKey
     * @return {?}
     */
    RtfAppComponent.prototype.getResOnCurrentLangeContext = /**
     * @param {?} resKey
     * @return {?}
     */
    function (resKey) {
        /** @type {?} */
        var resValue = i18nFuncHelpInfo[this.currentLangCode][resKey];
        return resValue;
    };
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    RtfAppComponent.prototype.isContainGrandChildNode = /**
     * @private
     * @param {?} node
     * @return {?}
     */
    function (node) {
        if (!('1' === node.Layer || '2' === node.Layer)) {
            return true;
        }
        /** @type {?} */
        var parentId = node.Id;
        /** @type {?} */
        var sonList = this.allAppList.filter((/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return f.FParentid === parentId; }));
        /** @type {?} */
        var res = false;
        var _loop_1 = function (i) {
            /** @type {?} */
            var grandList = this_1.allAppList.filter((/**
             * @param {?} o
             * @return {?}
             */
            function (o) { return o.FParentid === sonList[i].FID; }));
            if (grandList && grandList.length > 0) {
                res = true;
                return "break";
            }
        };
        var this_1 = this;
        for (var i = 0; i < sonList.length; i++) {
            var state_1 = _loop_1(i);
            if (state_1 === "break")
                break;
        }
        return res;
    };
    /**
     * @private
     * @param {?} grandParentId
     * @return {?}
     */
    RtfAppComponent.prototype.loadTreeDataByGrandParentId = /**
     * @private
     * @param {?} grandParentId
     * @return {?}
     */
    function (grandParentId) {
        // 分层加载
        /** @type {?} */
        var stream = this.rtfAppService.getDataByGrandParentId(grandParentId);
        this.loadTreeData(stream);
    };
    /**
     * @private
     * @param {?} stream
     * @return {?}
     */
    RtfAppComponent.prototype.loadTreeData = /**
     * @private
     * @param {?} stream
     * @return {?}
     */
    function (stream) {
        var _this = this;
        stream.subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (res) {
                res.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                function (element) {
                    /** @type {?} */
                    var temp = {
                        Id: element.id,
                        Code: element.code,
                        Name: element.name,
                        ParentId: element.parentId,
                        Layer: element.layer,
                        Path: element.path,
                        SortOrder: element.sortOrder,
                        Child: element.child,
                        InvokingConfig: element.invokingConfig
                    };
                    _this.allAppList.push(temp);
                }));
            }
            // 左侧树
            _this.treeData = _this.allAppList.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.Layer <= 3; }));
            // 菜单明细数据
            _this.data = _this.allAppList.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.Layer >= 4; }));
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.log('获取菜单数据失败');
        }));
    };
    RtfAppComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-rtf-app',
                    template: "<div class=\"d-flex flex-row\" style=\"width: 800px; border:2px;position:absolute;top:0px;bottom: 0px;\r\nright:0px;left:0px;overflow: hidden;height: 100%;\">\r\n    <div class=\"flex-fill\">\r\n        <kendo-splitter style=\"height:100%\" orientation=\"horizontal\">\r\n            <kendo-splitter-pane size=\"40%\" min=\"20%\" max=\"50%\">\r\n                <div class=\"d-flex flex-column flex-fill\" style=\"height:100%\">\r\n                    <div class=\"p-2\" style=\"height: 35px;\">\r\n                        <h5>{{this.getResOnCurrentLangeContext('TitleName')}}</h5>\r\n                        <hr class=\"m-0 p-0\" />\r\n                    </div>\r\n                    <div class=\"flex-fill\" style=\"overflow: auto;\">\r\n                        <app-module-tree [appTreeData]=\"this.treeData\" [bizObjectId]=\"bizObjectId\"\r\n                            (appTreeChanged)=\"leftAppTreeChanged($event)\" (appTreeExpanded)=\"onAppTreeExpanded($event)\">\r\n                        </app-module-tree>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n            <kendo-splitter-pane>\r\n                <div class=\"d-flex flex-column flex-fill\" style=\"height:100%\">\r\n                    <!-- <div class=\"p-2\" style=\"height: 35px;\">\r\n                        <h5>\u83DC\u5355\u5217\u8868</h5>\r\n                        <hr class=\"m-0 p-0\" />\r\n                    </div> -->\r\n                    <div class=\"clearfix mt-1 mb-1 ml-1\">\r\n                        <div class=\"f-cmp-inputgroup input-group\" style=\"width: 70%;\">\r\n                            <input #filter class=\"form-control\" (keyup)=\"onKeyUp($event)\"\r\n                                placeholder=\"{{this.getResOnCurrentLangeContext('EnterNameOrCode')}}\">\r\n                            <div class=\"input-group-append\"><span class=\"input-group-text\"\r\n                                    (click)=\"searchData(filter.value)\">\r\n                                    <i class=\"k-icon k-i-search\"></i></span></div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"d-flex flex-fill\" style=\"position:relative;\">\r\n                        <kendo-grid [class]=\"'flex-fill'\" [selectable]=\"selectableSettings\"\r\n                            [kendoGridBinding]=\"gridData\" [kendoGridSelectBy]=\"'Id'\" [selectedKeys]=\"curSelectedKeys\">\r\n                            <kendo-grid-checkbox-column width=\"50px\"></kendo-grid-checkbox-column>\r\n                            <kendo-grid-column field=\"Code\" title=\"{{this.getResOnCurrentLangeContext('Code')}}\">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field=\"Name\" title=\"{{this.getResOnCurrentLangeContext('Name')}}\">\r\n                            </kendo-grid-column>\r\n                        </kendo-grid>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n        </kendo-splitter>\r\n    </div>\r\n</div>\r\n<ng-template #btnOkAndCancle>\r\n    <button class=\"btn btn-sm btn-primary\" (click)=\"confirm()\">{{this.getResOnCurrentLangeContext('Confirm')}}</button>\r\n    <button class=\"btn btn-sm btn-default\" (click)=\"cancle()\">{{this.getResOnCurrentLangeContext('Cancel')}}</button>\r\n</ng-template>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    RtfAppComponent.ctorParameters = function () { return [
        { type: RtfAppService }
    ]; };
    RtfAppComponent.propDecorators = {
        bizObjectId: [{ type: Input }],
        gridSelectMode: [{ type: Input }],
        afterConfirm: [{ type: Output }],
        afterCancle: [{ type: Output }],
        btnOkAndCancleRef: [{ type: ViewChild, args: ['btnOkAndCancle',] }],
        filter: [{ type: ViewChild, args: ['filter',] }]
    };
    return RtfAppComponent;
}());
export { RtfAppComponent };
if (false) {
    /**
     * 业务对象,负责传递
     * @type {?}
     */
    RtfAppComponent.prototype.bizObjectId;
    /**
     * 选择模式
     * @type {?}
     */
    RtfAppComponent.prototype.gridSelectMode;
    /**
     * 是否分层加载左侧树，默认为false
     * @type {?}
     */
    RtfAppComponent.prototype.isLayeredLoad;
    /**
     * 确认事件
     * @type {?}
     */
    RtfAppComponent.prototype.afterConfirm;
    /**
     * 关闭事件
     * @type {?}
     */
    RtfAppComponent.prototype.afterCancle;
    /** @type {?} */
    RtfAppComponent.prototype.btnOkAndCancleRef;
    /** @type {?} */
    RtfAppComponent.prototype.filter;
    /**
     * 功能操作全量数据
     * @type {?}
     */
    RtfAppComponent.prototype.data;
    /**
     * 当前UI显示动能操作列表数据
     * @type {?}
     */
    RtfAppComponent.prototype.gridData;
    /**
     * 左侧树列表数据
     * @type {?}
     */
    RtfAppComponent.prototype.treeData;
    /**
     * 缓存的菜单及结构数据
     * @type {?}
     */
    RtfAppComponent.prototype.allAppList;
    /**
     * 当前选中数据
     * @type {?}
     */
    RtfAppComponent.prototype.curSelectedKeys;
    /** @type {?} */
    RtfAppComponent.prototype.selectableSettings;
    /** @type {?} */
    RtfAppComponent.prototype.selectedTreeNode;
    /** @type {?} */
    RtfAppComponent.prototype.title;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.currentLangCode;
    /**
     * @type {?}
     * @private
     */
    RtfAppComponent.prototype.rtfAppService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnRmLWFwcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9ydGYtdWkvIiwic291cmNlcyI6WyJsaWIvcnRmLWFwcC1oZWxwL3J0Zi1hcHAvcnRmLWFwcC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFM0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7QUFLdEU7SUE2REkseUJBQ1ksYUFBNEI7UUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7Ozs7UUEzQ3hDLGtCQUFhLEdBQUcsS0FBSyxDQUFDOzs7O1FBS3RCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQVksQ0FBQzs7OztRQUs1QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7Ozs7UUFVdEMsU0FBSSxHQUFhLEVBQUUsQ0FBQzs7OztRQWFwQixlQUFVLEdBQVUsRUFBRSxDQUFDOzs7O1FBSXZCLG9CQUFlLEdBQWEsRUFBRSxDQUFDO1FBRy9CLFVBQUssR0FBRyxRQUFRLENBQUM7SUFLakIsQ0FBQzs7OztJQUVELGtDQUFROzs7SUFBUjtRQUNJLElBQUksQ0FBQyxrQkFBa0IsR0FBRztZQUN0QixZQUFZLEVBQUUsSUFBSTs7WUFFbEIsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYztZQUMzRCxPQUFPLEVBQUUsSUFBSTtTQUNoQixDQUFDO1FBQ0YsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLEtBQUssRUFBRTs7Z0JBQ3hCLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFD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QUMsVUFBVSxDQUFDLE1BQU07Ozs7WUFBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxFQUFmLENBQWUsRUFBQyxDQUFDO1lBQ2hFLFNBQVM7WUFDVCxLQUFJLENBQUMsSUFBSSxHQUFHLEtBQUksQ0FBQyxVQUFVLENBQUMsTUFBTTs7OztZQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQWYsQ0FBZSxFQUFDLENBQUM7UUFDaEUsQ0FBQzs7OztRQUNELFVBQUMsR0FBc0I7WUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM1QixDQUFDLEVBQ0osQ0FBQztJQUNOLENBQUM7O2dCQXZOSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLGFBQWE7b0JBQ3ZCLGcxR0FBdUM7O2lCQUUxQzs7OztnQkFYUSxhQUFhOzs7OEJBaUJqQixLQUFLO2lDQUlMLEtBQUs7K0JBU0wsTUFBTTs4QkFLTixNQUFNO29DQUdOLFNBQVMsU0FBQyxnQkFBZ0I7eUJBRTFCLFNBQVMsU0FBQyxRQUFROztJQXVMdkIsc0JBQUM7Q0FBQSxBQXhORCxJQXdOQztTQW5OWSxlQUFlOzs7Ozs7SUFLeEIsc0NBQTZCOzs7OztJQUk3Qix5Q0FDc0M7Ozs7O0lBSXRDLHdDQUFzQjs7Ozs7SUFJdEIsdUNBQzRDOzs7OztJQUk1QyxzQ0FDc0M7O0lBRXRDLDRDQUNvQzs7SUFDcEMsaUNBQ1k7Ozs7O0lBS1osK0JBQW9COzs7OztJQUlwQixtQ0FBbUI7Ozs7O0lBS25CLG1DQUFtQjs7Ozs7SUFJbkIscUNBQXVCOzs7OztJQUl2QiwwQ0FBK0I7O0lBQy9CLDZDQUF1Qzs7SUFDdkMsMkNBQXNCOztJQUN0QixnQ0FBaUI7Ozs7O0lBQ2pCLDBDQUFnQzs7Ozs7SUFFNUIsd0NBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU2VsZWN0YWJsZVNldHRpbmdzIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItZ3JpZCc7XHJcbmltcG9ydCB7IFJ0ZkFwcFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL3J0Zi1hcHAuc2VydmljZSc7XHJcbmltcG9ydCB7IFJ0ZkFwcCB9IGZyb20gJy4uL2VudGl0aWVzL3J0Zi1hcHAnO1xyXG5pbXBvcnQgeyBpMThuRnVuY0hlbHBJbmZvIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2kxOG4tbW9kZWwvaTE4bi1tb2RlbCc7XHJcblxyXG4vKipcclxuICog57O757uf566h55CG77ya5Yqf6IO95pON5L2c5bem5qCR5pyJ44CB5Y+z5YiX6KGo5bGV56S6XHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnYXBwLXJ0Zi1hcHAnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3J0Zi1hcHAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vcnRmLWFwcC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFJ0ZkFwcENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDkuJrliqHlr7nosaEs6LSf6LSj5Lyg6YCSXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGJpek9iamVjdElkOiBzdHJpbmc7XHJcbiAgICAvKipcclxuICAgICAqIOmAieaLqeaooeW8j1xyXG4gICAgICovXHJcbiAgICBASW5wdXQoKVxyXG4gICAgZ3JpZFNlbGVjdE1vZGU6ICdzaW5nbGUnIHwgJ211bHRpcGxlJztcclxuICAgIC8qKlxyXG4gICAgICog5piv5ZCm5YiG5bGC5Yqg6L295bem5L6n5qCR77yM6buY6K6k5Li6ZmFsc2VcclxuICAgICAqL1xyXG4gICAgaXNMYXllcmVkTG9hZCA9IGZhbHNlO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnoa7orqTkuovku7ZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpXHJcbiAgICBhZnRlckNvbmZpcm0gPSBuZXcgRXZlbnRFbWl0dGVyPFJ0ZkFwcFtdPigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhbPpl63kuovku7ZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpXHJcbiAgICBhZnRlckNhbmNsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgLy8g5rOo5YWl5Yiw5biu5Yqp55qE56Gu6K6k5ZKM5Y+W5raI5oyJ6ZKuXHJcbiAgICBAVmlld0NoaWxkKCdidG5Pa0FuZENhbmNsZScpXHJcbiAgICBidG5Pa0FuZENhbmNsZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZpbHRlcicpXHJcbiAgICBmaWx0ZXI6IGFueTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWKn+iDveaTjeS9nOWFqOmHj+aVsOaNrlxyXG4gICAgICovXHJcbiAgICBkYXRhOiBSdGZBcHBbXSA9IFtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliY1VSeaYvuekuuWKqOiDveaTjeS9nOWIl+ihqOaVsOaNrlxyXG4gICAgICovXHJcbiAgICBncmlkRGF0YTogUnRmQXBwW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlt6bkvqfmoJHliJfooajmlbDmja5cclxuICAgICAqL1xyXG4gICAgdHJlZURhdGE6IFJ0ZkFwcFtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnvJPlrZjnmoToj5zljZXlj4rnu5PmnoTmlbDmja5cclxuICAgICAqL1xyXG4gICAgYWxsQXBwTGlzdDogYW55W10gPSBbXTtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmN6YCJ5Lit5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIGN1clNlbGVjdGVkS2V5czogc3RyaW5nW10gPSBbXTtcclxuICAgIHNlbGVjdGFibGVTZXR0aW5nczogU2VsZWN0YWJsZVNldHRpbmdzO1xyXG4gICAgc2VsZWN0ZWRUcmVlTm9kZTogYW55O1xyXG4gICAgdGl0bGUgPSAn5Yqf6IO96I+c5Y2V5biu5YqpJztcclxuICAgIHByaXZhdGUgY3VycmVudExhbmdDb2RlOiBzdHJpbmc7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIHJ0ZkFwcFNlcnZpY2U6IFJ0ZkFwcFNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0YWJsZVNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICBjaGVja2JveE9ubHk6IHRydWUsXHJcbiAgICAgICAgICAgIC8vIOm7mOiupOWNlemAiVxyXG4gICAgICAgICAgICBtb2RlOiAhdGhpcy5ncmlkU2VsZWN0TW9kZSA/ICdzaW5nbGUnIDogdGhpcy5ncmlkU2VsZWN0TW9kZSxcclxuICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMuaXNMYXllcmVkTG9hZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY29uc3QgYWxsRnVuY3NTdHJlYW0gPSB0aGlzLnJ0ZkFwcFNlcnZpY2UuZ2V0QXBwTGlzdCgpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRUcmVlRGF0YShhbGxGdW5jc1N0cmVhbSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkVHJlZURhdGFCeUdyYW5kUGFyZW50SWQoJzAnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBvbktleVVwKGFyZzogYW55KSB7XHJcbiAgICAgICAgaWYgKGFyZyAmJiBhcmcua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWFyY2hEYXRhKHRoaXMuZmlsdGVyLm5hdGl2ZUVsZW1lbnQudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5pCc57SiXHJcbiAgICAgKiBAcGFyYW0gZmlsdGVyVmFsdWUg5p+l6K+i5p2h5Lu2XHJcbiAgICAgKi9cclxuICAgIHNlYXJjaERhdGEoZmlsdGVyVmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIC8vIOepuueahOaQnOe0ouaYr+WFqOmDqOaVsOaNrlxyXG4gICAgICAgIGlmIChmaWx0ZXJWYWx1ZSA9PT0gbnVsbCB8fCBmaWx0ZXJWYWx1ZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkRGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaWx0ZXIgPSBmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIOaQnOe0ouWIsOS4iue6p+aXtlxyXG4gICAgICAgIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmRhdGEuZmlsdGVyKGl0ZW0gPT5cclxuICAgICAgICAgICAgaXRlbS5Db2RlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyKSB8fFxyXG4gICAgICAgICAgICBpdGVtLk5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4muWKoeWvueixoeWPmOWMluWQjlxyXG4gICAgICogQHBhcmFtIGFyZyDkuJrliqHlr7nosaHlj4LmlbBcclxuICAgICAqL1xyXG4gICAgbGVmdEFwcFRyZWVDaGFuZ2VkKGFyZzogUnRmQXBwKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEgfHwgdGhpcy5kYXRhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSWQgPSBhcmcuSWQ7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQYXRoID0gYXJnLlBhdGg7XHJcbiAgICAgICAgLy8g5qC55o2u54i25a2Q5YWz57O76L+H5ruk5b2T5YmN55WM6Z2i5pWw5o2u77yM5YyF5ZCr5LiK5LiL57qnXHJcbiAgICAgICAgdGhpcy5ncmlkRGF0YSA9IHRoaXMuZGF0YS5maWx0ZXIoaXRlbSA9PlxyXG4gICAgICAgICAgICBpdGVtLlBhcmVudElkID09PSBzZWxlY3RlZElkIHx8XHJcbiAgICAgICAgICAgIGl0ZW0uUGF0aC5zdGFydHNXaXRoKHNlbGVjdGVkUGF0aClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgb25BcHBUcmVlRXhwYW5kZWQoYXJnOiBhbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0xheWVyZWRMb2FkID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzQ29udGFpbkdyYW5kQ2hpbGROb2RlKGFyZykgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZFRyZWVEYXRhQnlHcmFuZFBhcmVudElkKGFyZy5JZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6YCJ5Lit5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIGdldFNlbGVjdGVkT2JqZWN0KCk6IFJ0ZkFwcFtdIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmRhdGFcclxuICAgICAgICAgICAgLmZpbHRlcihpdGVtID0+XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1clNlbGVjdGVkS2V5cy5maW5kSW5kZXgoc2VsZWN0ID0+IHNlbGVjdCA9PT0gaXRlbS5JZCkgPj0gMFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnoa7orqRcclxuICAgICAqL1xyXG4gICAgY29uZmlybSgpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmdldFNlbGVjdGVkT2JqZWN0KCk7XHJcbiAgICAgICAgLy8gdGhpcy5zZWxlY3RlZFRyZWVOb2RlLnNlbGVjdGVkSW52b2sgPSByZXN1bHQ7XHJcbiAgICAgICAgdGhpcy5hZnRlckNvbmZpcm0ubmV4dChyZXN1bHQpO1xyXG4gICAgICAgIC8vIOWPlua2iC3nm67nmoTmmK/lnKjov5nph4zorqnmqKHmgIHmoYbmtojlpLFcclxuICAgICAgICB0aGlzLmNhbmNsZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDlj5bmtohcclxuICAgICAqL1xyXG4gICAgY2FuY2xlKCkge1xyXG4gICAgICAgIHRoaXMuYWZ0ZXJDYW5jbGUubmV4dCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRDdXJyZW50TGFuZ0NvZGUobGFuZ0NvZGU6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuY3VycmVudExhbmdDb2RlID0gbGFuZ0NvZGU7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMuZ2V0UmVzT25DdXJyZW50TGFuZ2VDb250ZXh0KCdUaXRsZU5hbWUnKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBnZXRSZXNPbkN1cnJlbnRMYW5nZUNvbnRleHQocmVzS2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHJlc1ZhbHVlID0gaTE4bkZ1bmNIZWxwSW5mb1t0aGlzLmN1cnJlbnRMYW5nQ29kZV1bcmVzS2V5XTtcclxuICAgICAgICByZXR1cm4gcmVzVmFsdWU7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGlzQ29udGFpbkdyYW5kQ2hpbGROb2RlKG5vZGU6IGFueSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmICghKCcxJyA9PT0gbm9kZS5MYXllciB8fCAnMicgPT09IG5vZGUuTGF5ZXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXJlbnRJZCA9IG5vZGUuSWQ7XHJcbiAgICAgICAgY29uc3Qgc29uTGlzdCA9IHRoaXMuYWxsQXBwTGlzdC5maWx0ZXIoXHJcbiAgICAgICAgICAgIGYgPT4gZi5GUGFyZW50aWQgPT09IHBhcmVudElkXHJcbiAgICAgICAgKTtcclxuICAgICAgICBsZXQgcmVzID0gZmFsc2U7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb25MaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyYW5kTGlzdCA9IHRoaXMuYWxsQXBwTGlzdC5maWx0ZXIobyA9PiBvLkZQYXJlbnRpZCA9PT0gc29uTGlzdFtpXS5GSUQpO1xyXG4gICAgICAgICAgICBpZiAoZ3JhbmRMaXN0ICYmIGdyYW5kTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgIH1cclxuICAgIHByaXZhdGUgbG9hZFRyZWVEYXRhQnlHcmFuZFBhcmVudElkKGdyYW5kUGFyZW50SWQ6IHN0cmluZykge1xyXG4gICAgICAgIC8vIOWIhuWxguWKoOi9vVxyXG4gICAgICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMucnRmQXBwU2VydmljZS5nZXREYXRhQnlHcmFuZFBhcmVudElkKGdyYW5kUGFyZW50SWQpO1xyXG4gICAgICAgIHRoaXMubG9hZFRyZWVEYXRhKHN0cmVhbSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkVHJlZURhdGEoc3RyZWFtOiBhbnkpIHtcclxuICAgICAgICBzdHJlYW0uc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlbXAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZDogZWxlbWVudC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvZGU6IGVsZW1lbnQuY29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWU6IGVsZW1lbnQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudElkOiBlbGVtZW50LnBhcmVudElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGF5ZXI6IGVsZW1lbnQubGF5ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXRoOiBlbGVtZW50LnBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXI6IGVsZW1lbnQuc29ydE9yZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hpbGQ6IGVsZW1lbnQuY2hpbGQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnZva2luZ0NvbmZpZzogZWxlbWVudC5pbnZva2luZ0NvbmZpZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFsbEFwcExpc3QucHVzaCh0ZW1wKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIOW3puS+p+agkVxyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IHRoaXMuYWxsQXBwTGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLkxheWVyIDw9IDMpO1xyXG4gICAgICAgICAgICAgICAgLy8g6I+c5Y2V5piO57uG5pWw5o2uXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmFsbEFwcExpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5MYXllciA+PSA0KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKGVycjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfojrflj5boj5zljZXmlbDmja7lpLHotKUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==
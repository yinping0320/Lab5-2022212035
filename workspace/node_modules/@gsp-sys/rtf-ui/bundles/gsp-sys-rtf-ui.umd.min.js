!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@progress/kendo-angular-grid"),require("@progress/kendo-angular-layout"),require("@progress/kendo-angular-treeview"),require("rxjs"),require("@angular/core"),require("@angular/common/http"),require("@farris/ui-modal"),require("@farris/ui-messager")):"function"==typeof define&&define.amd?define("@gsp-sys/rtf-ui",["exports","@angular/common","@progress/kendo-angular-grid","@progress/kendo-angular-layout","@progress/kendo-angular-treeview","rxjs","@angular/core","@angular/common/http","@farris/ui-modal","@farris/ui-messager"],t):t((e["gsp-sys"]=e["gsp-sys"]||{},e["gsp-sys"]["rtf-ui"]={}),e.ng.common,e.kendoAngularGrid,e.kendoAngularLayout,e.kendoAngularTreeview,e.rxjs,e.ng.core,e.ng.common.http,e.uiModal,e.uiMessager)}(this,function(e,t,n,r,i,o,a,s,p,l){"use strict";var d=function(){function e(){this.appTreeData=[],this.selectKeys=[],this.appTreeChanged=new a.EventEmitter,this.appTreeExpanded=new a.EventEmitter,this.expandedKeys=[]}return e.prototype.ngOnChanges=function(e){var t=this;e.appTreeData&&e.appTreeData.currentValue&&0!==e.appTreeData.currentValue.length&&o.from(this.appTreeData).subscribe(function(e){e.ParentId&&"0"!==e.ParentId||(e.ParentId=undefined,1===e.Layer&&t.expandedKeys.push(e.Id))})},e.prototype.ngOnInit=function(){},e.prototype.selectChange=function(e){var t=e.dataItem;null==this.selectKeys||0===this.selectKeys.length?this.appTreeChanged.emit(t):this.selectKeys[0]!==t.Id&&this.appTreeChanged.emit(t)},e.prototype.onExpand=function(e){console.log("菜单帮助左侧树展开"),e&&e.dataItem&&this.appTreeExpanded.emit(e.dataItem)},e.decorators=[{type:a.Component,args:[{selector:"app-module-tree",template:'<div class="d-flex flex-column flex-fill pt-2 pb-2" style="height: 100%">\r\n    <kendo-treeview [nodes]="appTreeData" textField="Name" kendoTreeViewExpandable kendoTreeViewFlatDataBinding\r\n        idField="Id" parentIdField="ParentId" kendoTreeViewSelectable [selectBy]="\'Id\'"\r\n        [(selectedKeys)]="this.selectKeys" [(expandedKeys)]="expandedKeys" [expandBy]="\'Id\'"\r\n        (expand)="this.onExpand($event)" (selectionChange)="selectChange($event)">\r\n    </kendo-treeview>\r\n</div>',styles:[""]}]}],e.ctorParameters=function(){return[]},e.propDecorators={appTreeData:[{type:a.Input}],bizObjectId:[{type:a.Input}],appTreeChanged:[{type:a.Output}],appTreeExpanded:[{type:a.Output}]},e}(),c=function(){function e(){}return Object.defineProperty(e.prototype,"functionsApi",{get:function(){return"/api/runtime/sys/v1.0/functions/allfuncs"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bizObjectApi",{get:function(){return"/api/dev/main/v1.0/business-objects"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerFunctionsApi",{get:function(){return"/api/runtime/sys/v1.0/functions/layerFuncs"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpHeader",{get:function(){return{headers:{"Content-Type":"application/json"},responseType:"json"}},enumerable:!0,configurable:!0}),e.decorators=[{type:a.Injectable}],e.ctorParameters=function(){return[]},e}(),u=function(){function e(e,t){this.rtfCommon=e,this.httpClient=t}return e.prototype.getAppList=function(){var e=this.rtfCommon.functionsApi,t=this.rtfCommon.httpHeader;return this.httpClient.get(e,t)},e.prototype.getDataByGrandParentId=function(e){var t=this.rtfCommon.layerFunctionsApi+"/"+e,n=this.rtfCommon.httpHeader;return this.httpClient.get(t,n)},e.decorators=[{type:a.Injectable}],e.ctorParameters=function(){return[{type:c},{type:s.HttpClient}]},e}(),f={"zh-CHS":{TitleName:"功能菜单帮助",EnterNameOrCode:"输入编号或名称查找",Code:"编号",Name:"名称",Confirm:"确认",Cancel:"取消"},"zh-CHT":{TitleName:"功能菜單幫助",EnterNameOrCode:"輸入編號或名稱查找",Code:"編號",Name:" 名稱",Confirm:"確認",Cancel:"取消"},en:{TitleName:"Function Help",EnterNameOrCode:"Please Enter Name Or Code",Code:"Code",Name:"Name",Confirm:"Confirm",Cancel:"Cancel"}},h=function(){function e(e){this.rtfAppService=e,this.isLayeredLoad=!1,this.afterConfirm=new a.EventEmitter,this.afterCancle=new a.EventEmitter,this.data=[],this.allAppList=[],this.curSelectedKeys=[],this.title="功能菜单帮助"}return e.prototype.ngOnInit=function(){if(!(this.selectableSettings={checkboxOnly:!0,mode:this.gridSelectMode?this.gridSelectMode:"single",enabled:!0})===this.isLayeredLoad){var e=this.rtfAppService.getAppList();this.loadTreeData(e)}else this.loadTreeDataByGrandParentId("0")},e.prototype.onKeyUp=function(e){e&&13===e.keyCode&&this.searchData(this.filter.nativeElement.value)},e.prototype.searchData=function(e){if(null!==e&&""!==e){var t=e.toLowerCase();this.gridData=this.data.filter(function(e){return e.Code.toLowerCase().includes(t)||e.Name.toLowerCase().includes(t)})}else this.gridData=this.data.concat()},e.prototype.leftAppTreeChanged=function(e){if(this.data&&0!==this.data.length){var t=e.Id,n=e.Path;this.gridData=this.data.filter(function(e){return e.ParentId===t||e.Path.startsWith(n)})}},e.prototype.onAppTreeExpanded=function(e){!1!==this.isLayeredLoad&&!1===this.isContainGrandChildNode(e)&&this.loadTreeDataByGrandParentId(e.Id)},e.prototype.getSelectedObject=function(){var e=this;return this.data.filter(function(t){return 0<=e.curSelectedKeys.findIndex(function(e){return e===t.Id})})},e.prototype.confirm=function(){var e=this.getSelectedObject();this.afterConfirm.next(e),this.cancle()},e.prototype.cancle=function(){this.afterCancle.next()},e.prototype.setCurrentLangCode=function(e){this.currentLangCode=e,this.title=this.getResOnCurrentLangeContext("TitleName")},e.prototype.getResOnCurrentLangeContext=function(e){return f[this.currentLangCode][e]},e.prototype.isContainGrandChildNode=function(e){if("1"!==e.Layer&&"2"!==e.Layer)return!0;for(var t=e.Id,n=this.allAppList.filter(function(e){return e.FParentid===t}),r=!1,i=function(t){var e=o.allAppList.filter(function(e){return e.FParentid===n[t].FID});if(e&&0<e.length)return r=!0,"break"},o=this,a=0;a<n.length;a++){if("break"===i(a))break}return r},e.prototype.loadTreeDataByGrandParentId=function(e){var t=this.rtfAppService.getDataByGrandParentId(e);this.loadTreeData(t)},e.prototype.loadTreeData=function(e){var n=this;e.subscribe(function(e){e&&e.forEach(function(e){var t={Id:e.id,Code:e.code,Name:e.name,ParentId:e.parentId,Layer:e.layer,Path:e.path,SortOrder:e.sortOrder,Child:e.child,InvokingConfig:e.invokingConfig};n.allAppList.push(t)}),n.treeData=n.allAppList.filter(function(e){return e.Layer<=3}),n.data=n.allAppList.filter(function(e){return 4<=e.Layer})},function(e){console.log("获取菜单数据失败")})},e.decorators=[{type:a.Component,args:[{selector:"app-rtf-app",template:'<div class="d-flex flex-row" style="width: 800px; border:2px;position:absolute;top:0px;bottom: 0px;\r\nright:0px;left:0px;overflow: hidden;height: 100%;">\r\n    <div class="flex-fill">\r\n        <kendo-splitter style="height:100%" orientation="horizontal">\r\n            <kendo-splitter-pane size="40%" min="20%" max="50%">\r\n                <div class="d-flex flex-column flex-fill" style="height:100%">\r\n                    <div class="p-2" style="height: 35px;">\r\n                        <h5>{{this.getResOnCurrentLangeContext(\'TitleName\')}}</h5>\r\n                        <hr class="m-0 p-0" />\r\n                    </div>\r\n                    <div class="flex-fill" style="overflow: auto;">\r\n                        <app-module-tree [appTreeData]="this.treeData" [bizObjectId]="bizObjectId"\r\n                            (appTreeChanged)="leftAppTreeChanged($event)" (appTreeExpanded)="onAppTreeExpanded($event)">\r\n                        </app-module-tree>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n            <kendo-splitter-pane>\r\n                <div class="d-flex flex-column flex-fill" style="height:100%">\r\n                    \x3c!-- <div class="p-2" style="height: 35px;">\r\n                        <h5>菜单列表</h5>\r\n                        <hr class="m-0 p-0" />\r\n                    </div> --\x3e\r\n                    <div class="clearfix mt-1 mb-1 ml-1">\r\n                        <div class="f-cmp-inputgroup input-group" style="width: 70%;">\r\n                            <input #filter class="form-control" (keyup)="onKeyUp($event)"\r\n                                placeholder="{{this.getResOnCurrentLangeContext(\'EnterNameOrCode\')}}">\r\n                            <div class="input-group-append"><span class="input-group-text"\r\n                                    (click)="searchData(filter.value)">\r\n                                    <i class="k-icon k-i-search"></i></span></div>\r\n                        </div>\r\n                    </div>\r\n                    <div class="d-flex flex-fill" style="position:relative;">\r\n                        <kendo-grid [class]="\'flex-fill\'" [selectable]="selectableSettings"\r\n                            [kendoGridBinding]="gridData" [kendoGridSelectBy]="\'Id\'" [selectedKeys]="curSelectedKeys">\r\n                            <kendo-grid-checkbox-column width="50px"></kendo-grid-checkbox-column>\r\n                            <kendo-grid-column field="Code" title="{{this.getResOnCurrentLangeContext(\'Code\')}}">\r\n                            </kendo-grid-column>\r\n                            <kendo-grid-column field="Name" title="{{this.getResOnCurrentLangeContext(\'Name\')}}">\r\n                            </kendo-grid-column>\r\n                        </kendo-grid>\r\n                    </div>\r\n                </div>\r\n            </kendo-splitter-pane>\r\n        </kendo-splitter>\r\n    </div>\r\n</div>\r\n<ng-template #btnOkAndCancle>\r\n    <button class="btn btn-sm btn-primary" (click)="confirm()">{{this.getResOnCurrentLangeContext(\'Confirm\')}}</button>\r\n    <button class="btn btn-sm btn-default" (click)="cancle()">{{this.getResOnCurrentLangeContext(\'Cancel\')}}</button>\r\n</ng-template>',styles:[""]}]}],e.ctorParameters=function(){return[{type:u}]},e.propDecorators={bizObjectId:[{type:a.Input}],gridSelectMode:[{type:a.Input}],afterConfirm:[{type:a.Output}],afterCancle:[{type:a.Output}],btnOkAndCancleRef:[{type:a.ViewChild,args:["btnOkAndCancle"]}],filter:[{type:a.ViewChild,args:["filter"]}]},e}(),g=function(){function e(e,t,n,r,i){this.rtfCommon=e,this.modalService=t,this.farrisMsg=n,this.injector=r,this.cfr=i,this.initSelectKeys=[],this.languageCode="zh-CHS",this.isLayeredLoad=!1,this.afterHelpConfirm=new a.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.showHelp=function(e){var t=this;this.rtfCommon.sessionId=" ";var n=this.cfr.resolveComponentFactory(h);this.funcOpComp=n.create(this.injector),this.funcOpComp.instance.setCurrentLangCode(this.languageCode),this.funcOpComp.instance.isLayeredLoad=this.isLayeredLoad,null!=this.initSelectKeys&&0<this.initSelectKeys.length&&this.initSelectKeys.forEach(function(e){return t.funcOpComp.instance.curSelectedKeys.push(e)}),this.bizObjectId&&""!==this.bizObjectId&&(this.funcOpComp.instance.bizObjectId=this.bizObjectId);var r={title:this.funcOpComp.instance.title,width:800,height:550,buttons:this.funcOpComp.instance.btnOkAndCancleRef,showButtons:!0,showMaxButton:!1,resizable:!1};this.funcOpDialog=this.modalService.show(this.funcOpComp,r),this.funcOpComp.instance.afterCancle.subscribe(function(e){t.funcOpDialog.close()}),this.funcOpComp.instance.afterConfirm.subscribe(function(e){t.afterHelpConfirm.next(e)})},e.decorators=[{type:a.Component,args:[{selector:"app-rtf-app-help",template:"",styles:[""]}]}],e.ctorParameters=function(){return[{type:c},{type:p.BsModalService},{type:l.MessagerService},{type:a.Injector},{type:a.ComponentFactoryResolver}]},e.propDecorators={bizObjectId:[{type:a.Input}],initSelectKeys:[{type:a.Input}],languageCode:[{type:a.Input}],isLayeredLoad:[{type:a.Input}],afterHelpConfirm:[{type:a.Output}]},e}(),m=function(){function e(){}return e.decorators=[{type:a.NgModule,args:[{imports:[t.CommonModule,s.HttpClientModule,n.GridModule,r.LayoutModule,i.TreeViewModule,p.ModalModule.forRoot(),l.MessagerModule.forRoot()],declarations:[d,h,g],entryComponents:[h],providers:[c,u],exports:[h,g]}]}],e}();e.RtfAppHelpModule=m,e.RtfAppHelpComponent=g,e.RtfAppComponent=h,e.ɵc=c,e.ɵa=d,e.ɵb=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-sys-rtf-ui.umd.min.js.map
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { from } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { SysCommonUtilService, SysDataUtil } from '@gsp-sys/sysmgr-common';
import { map } from 'rxjs/operators';
import { userHelp, posHelp, roleHelp, userGroupHelp, posGroupHelp, roleGroupHelp, sysOrgHelp } from '../help-meta/sys-help-meta';
import { SysLocaleService } from '../../locale/sys-locale.service';
/**
 * 帮助服务
 */
var SysFarrisLookupService = /** @class */ (function () {
    function SysFarrisLookupService(http, sysUtil, localService) {
        this.http = http;
        this.sysUtil = sysUtil;
        this.localService = localService;
    }
    /** 初始过滤条件 */
    /**
     * 初始过滤条件
     * @private
     * @param {?} filter
     * @return {?}
     */
    SysFarrisLookupService.prototype.setFilterData = /**
     * 初始过滤条件
     * @private
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        // 有过滤条件
        if (filter) {
            /** @type {?} */
            var str = JSON.stringify(filter);
            if (str !== '{}') {
                // 一定要复制
                this.filterData = JSON.parse(str);
            }
            else {
                this.filterData = null;
            }
        }
        else {
            this.filterData = null;
        }
    };
    /**
     * 添加数据
     */
    /**
     * 添加数据
     * @private
     * @param {?} src
     * @param {?} data
     * @return {?}
     */
    SysFarrisLookupService.prototype.setListData = /**
     * 添加数据
     * @private
     * @param {?} src
     * @param {?} data
     * @return {?}
     */
    function (src, data) {
        if (src) {
            src.push.apply(src, data);
        }
    };
    /** 获取过滤数据 */
    /**
     * 获取过滤数据
     * @private
     * @return {?}
     */
    SysFarrisLookupService.prototype.getFilterData = /**
     * 获取过滤数据
     * @private
     * @return {?}
     */
    function () {
        return this.filterData;
    };
    /**
     * 异步获取版本
     */
    /**
     * 异步获取版本
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    SysFarrisLookupService.prototype.getTreeDataAsync = /**
     * 异步获取版本
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    function (url, params) {
        var _this = this;
        this.i18nRes = this.localService.getComponentOpt('help');
        // 解析查询json对象
        /** @type {?} */
        var treeParam = JSON.parse(params.searchValue);
        /** @type {?} */
        var farrisSelectedData = params['customData'].farrisSelectedData;
        /** @type {?} */
        var filter = {};
        // filter.withPermission = true;
        /** @type {?} */
        var category = treeParam.category;
        // 1.首次加载
        if (category === 'all') {
            filter.layer = 1;
        }
        // 2.异步展开下级
        if (category === 'children') {
            if (treeParam.hasOwnProperty('parentPath')) {
                filter.path = treeParam.parentPath;
            }
            if (treeParam.hasOwnProperty('parentLayer')) {
                // 后端搜索以下级节点为级数的节点
                filter.layer = treeParam.parentLayer + 1;
            }
            if (treeParam.hasOwnProperty('parentId')) {
                filter.parentId = treeParam.parentId;
            }
        }
        // 3.搜索
        if (category === 'search') {
            /** @type {?} */
            var searchField = treeParam.searchField;
            /** @type {?} */
            var searchValue = treeParam.searchValue.trim();
            if (searchValue) {
                filter.isSearchTree = true;
                switch (searchField) {
                    case 'code':
                        filter.code = searchValue;
                        break;
                    case 'name':
                        filter.name = searchValue;
                        break;
                    // 全部列搜索，之前是'*'
                    case '*':
                    default:
                        filter.codeOrName = searchValue;
                        break;
                }
            }
            else {
                // 搜索为空，重新加载，默认从1级开始
                filter.layer = 1;
            }
        }
        //如果是组织，请求选中数据时
        if (url === '/api/runtime/sys/v1.0/sysOrgs' && category === 'fav') {
            /** @type {?} */
            var newUrl = url + '/nullorg';
            /** @type {?} */
            var newOpt = {
                headers: this.sysUtil.getHeader()['headers'],
                params: { useView: 'true' }
            };
            return this.http.get(newUrl, newOpt).pipe(map((/**
             * @param {?} val
             * @return {?}
             */
            function (val) {
                /** @type {?} */
                var gridResult = {};
                return gridResult;
            })));
        }
        // 说明有过滤条件
        if (this.getFilterData()) {
            filter = Object.assign(this.getFilterData(), filter);
            SysDataUtil.deleteEmpty(filter);
        }
        /** @type {?} */
        var paramStr = JSON.stringify(filter);
        /** @type {?} */
        var opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return this.http.get(url, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            /** @type {?} */
            var gridResult = {};
            gridResult.selectedData = farrisSelectedData;
            gridResult.items = [];
            gridResult.treeInfo = {
                loadDataType: 'async',
                layerType: 'parentId',
                dataField: 'treeInfo',
                pathField: 'path',
                layerField: 'layer',
                parentField: 'parentId',
                isDetailField: 'isDetail'
            };
            gridResult.treeInfo['treeDataIsInit'] = true;
            gridResult.columns = [
                { field: 'code', title: _this.i18nRes.codeField },
                { field: 'name', title: _this.i18nRes.nameField }
            ];
            gridResult.searchFields = [
                { label: _this.i18nRes.codeField, value: 'code' },
                { label: _this.i18nRes.nameField, value: 'name' }
            ];
            // 必须要赋值
            from(val).subscribe((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.layer === 1 || !item.parentId) {
                    item.parentId = null;
                }
                item.treeInfo = {
                    parentId: item.parentId,
                    path: item.path,
                    layer: item.layer,
                    isDetail: item.isDetail
                };
            }));
            // 如果是搜索的话，需要自己构造树
            if (filter.isSearchTree) {
                gridResult.items = _this.makeTreeByParent(val, 'parentId', 'id');
                console.log(gridResult.items);
            }
            else {
                // 有结果，普通分层加载
                if (val && val.length > 0) {
                    from(val).subscribe((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        gridResult.items.push(_this.convertToTreeNode(item));
                    }));
                }
            }
            return gridResult;
        })));
    };
    /**
     * 将树节点转换为Farris TreeNode
     */
    /**
     * 将树节点转换为Farris TreeNode
     * @private
     * @param {?} src
     * @return {?}
     */
    SysFarrisLookupService.prototype.convertToTreeNode = /**
     * 将树节点转换为Farris TreeNode
     * @private
     * @param {?} src
     * @return {?}
     */
    function (src) {
        /** @type {?} */
        var node = {};
        node.data = src;
        node.children = [];
        node.selectable = src.farris_selectable;
        node.leaf = src.isDetail;
        node.parent = src.parentId;
        // 这一条必须得加，否则不行
        node.id = node.data.id;
        // 搜索的时候最末级添加了这个属性，不需要展开
        if (src.hasOwnProperty('expanded')) {
            node.expanded = src.expanded;
        }
        return node;
    };
    /** 按照parent码构造树 */
    /**
     * 按照parent码构造树
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    SysFarrisLookupService.prototype.makeTreeByParent = /**
     * 按照parent码构造树
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    function (datas, parentField, keyField) {
        var _this = this;
        // 上級爲空，或者沒有上級的
        /** @type {?} */
        var pathLayerOnes = datas.filter((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            if (!x[parentField]) {
                return true;
            }
            // 断层的这种，应该也属于一级
            /** @type {?} */
            var p = datas.find((/**
             * @param {?} parent
             * @return {?}
             */
            function (parent) { return parent[keyField] === x[parentField]; }));
            if (!p) {
                return true;
            }
        }));
        /** @type {?} */
        var treedata = [];
        pathLayerOnes.forEach((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            /** @type {?} */
            var node = _this.convertToTreeNode(x);
            treedata.push(node);
        }));
        treedata.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            _this.findChildrenByParent(item, datas, parentField, keyField);
        }));
        return treedata;
    };
    /** 找到子节点 */
    /**
     * 找到子节点
     * @param {?} parent
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    SysFarrisLookupService.prototype.findChildrenByParent = /**
     * 找到子节点
     * @param {?} parent
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    function (parent, datas, parentField, keyField) {
        var _this = this;
        /** @type {?} */
        var childList = datas.filter((/**
         * @param {?} childitem
         * @return {?}
         */
        function (childitem) {
            if (childitem[parentField] === parent.data[keyField]) {
                return true;
            }
        }));
        if (childList && childList.length > 0) {
            childList.forEach((/**
             * @param {?} child
             * @return {?}
             */
            function (child) {
                /** @type {?} */
                var node = _this.convertToTreeNode(child);
                parent.children.push(node);
                _this.findChildrenByParent(node, datas, parentField, keyField);
            }));
        }
    };
    /**
     * 全部获取版本版本
     */
    /**
     * 全部获取版本版本
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    SysFarrisLookupService.prototype.getTreeData = /**
     * 全部获取版本版本
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    function (url, params) {
        /** @type {?} */
        var filter = {};
        // 说明有过滤条件
        if (this.getFilterData()) {
            filter = Object.assign(this.getFilterData(), filter);
            SysDataUtil.deleteEmpty(filter);
        }
        /** @type {?} */
        var paramStr = JSON.stringify(filter);
        /** @type {?} */
        var opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return this.http.get(url, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val && val.length > 0) {
                val.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (item.layer == 1 || item.parentId == null) {
                        item.parentId = '';
                    }
                    // 满足前端结构
                    item.treeInfo = {
                        parentId: item.parentId,
                        path: item.path,
                        layer: item.layer,
                        isDetail: item.isDetail
                    };
                    item.selectable = false;
                }));
            }
            else {
                val = [];
            }
            return { items: val };
        })));
    };
    /** 获取列表数据 */
    /**
     * 获取列表数据
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    SysFarrisLookupService.prototype.getGridData = /**
     * 获取列表数据
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    function (url, params) {
        var _this = this;
        /** @type {?} */
        var index = params.pageIndex;
        /** @type {?} */
        var size = params.pageSize;
        /** @type {?} */
        var farrisSelectedData = params['customData'].farrisSelectedData;
        // 目前这个地方有问题，第一次的时候传递不过来
        if (!index) {
            /** @type {?} */
            var customData = params['customData'];
            index = customData.filter.pageIndex;
            size = customData.filter.pageSize;
        }
        /** @type {?} */
        var param = {
            pageIndex: index,
            pageSize: size,
        };
        // 是否有搜索
        /** @type {?} */
        var filterStr = params.searchValue;
        /** @type {?} */
        var filterObj = JSON.parse(filterStr);
        /** @type {?} */
        var searchField = filterObj.searchField;
        /** @type {?} */
        var searchValue = filterObj.searchValue;
        // 有过滤查询,有可能搜索值为空，这时候是不需要搜索的
        if (searchField && searchValue) {
            switch (searchField) {
                case 'code':
                    param.code = searchValue;
                    break;
                case 'name':
                    param.name = searchValue;
                    break;
                // 全部列搜索，之前是'*'
                case '*':
                default:
                    param.codeOrName = searchValue;
                    break;
            }
        }
        // 说明有过滤条件
        if (this.getFilterData()) {
            param = Object.assign(this.getFilterData(), param);
            SysDataUtil.deleteEmpty(param);
        }
        console.log(param);
        /** @type {?} */
        var paramStr = JSON.stringify(param);
        /** @type {?} */
        var opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return this.http.get(url, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            if (val && val.data) {
                // 将本次分页的数据附加到当前帮助的列表中
                _this.setListData(params['customData'].allData, val.data);
            }
            return {
                items: val.data,
                total: val.totalCount,
                pageInfo: {
                    pageIndex: index,
                    pageSize: size,
                    pageList: [20, 40, 60, 80, 100],
                    enablePager: true
                },
                selectedData: farrisSelectedData
            };
        })));
    };
    /** 取数 */
    /**
     * 取数
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    SysFarrisLookupService.prototype.getData = /**
     * 取数
     * @param {?} url
     * @param {?=} params
     * @return {?}
     */
    function (url, params) {
        console.log(params);
        console.log(url);
        /** @type {?} */
        var filter = params['customData'].filter;
        this.setFilterData(filter);
        /** @type {?} */
        var typeIndex = url.indexOf('\/');
        /** @type {?} */
        var httpUrl = url.substring(typeIndex, url.length);
        /** @type {?} */
        var helpType = url.substring(0, typeIndex);
        switch (helpType) {
            case userHelp:
            case posHelp:
            case roleHelp:
                return this.getGridData(httpUrl, params);
            case userGroupHelp:
            case posGroupHelp:
            case roleGroupHelp:
            case sysOrgHelp:
                return this.getTreeDataAsync(httpUrl, params);
            default:
                break;
        }
    };
    SysFarrisLookupService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    SysFarrisLookupService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: SysCommonUtilService },
        { type: SysLocaleService }
    ]; };
    return SysFarrisLookupService;
}());
export { SysFarrisLookupService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SysFarrisLookupService.prototype.filterData;
    /**
     * @type {?}
     * @private
     */
    SysFarrisLookupService.prototype.i18nRes;
    /**
     * @type {?}
     * @private
     */
    SysFarrisLookupService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    SysFarrisLookupService.prototype.sysUtil;
    /**
     * @type {?}
     * @private
     */
    SysFarrisLookupService.prototype.localService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzLWZhcnJpcy1sb29rdXAuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3N5c21nci11aS8iLCJzb3VyY2VzIjpbImxpYi9zeXMtbWFuYWdlci11aS9zZXJ2aWNlL3N5cy1mYXJyaXMtbG9va3VwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBa0IsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMzRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRWpJLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDOzs7O0FBT25FO0lBS0ksZ0NBQ1ksSUFBZ0IsRUFDaEIsT0FBNkIsRUFDN0IsWUFBOEI7UUFGOUIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixZQUFPLEdBQVAsT0FBTyxDQUFzQjtRQUM3QixpQkFBWSxHQUFaLFlBQVksQ0FBa0I7SUFFMUMsQ0FBQztJQUVELGFBQWE7Ozs7Ozs7SUFDTCw4Q0FBYTs7Ozs7O0lBQXJCLFVBQXVCLE1BQVc7UUFDOUIsUUFBUTtRQUNSLElBQUksTUFBTSxFQUFFOztnQkFDRixHQUFHLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7WUFDbEMsSUFBSSxHQUFHLEtBQUssSUFBSSxFQUFFO2dCQUNkLFFBQVE7Z0JBQ1IsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3JDO2lCQUFNO2dCQUNILElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO2FBQzFCO1NBQ0o7YUFBTTtZQUNILElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1NBQzFCO0lBQ0wsQ0FBQztJQUNEOztPQUVHOzs7Ozs7OztJQUNLLDRDQUFXOzs7Ozs7O0lBQW5CLFVBQXFCLEdBQVUsRUFBRSxJQUFXO1FBQ3hDLElBQUksR0FBRyxFQUFFO1lBQ0wsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQzdCO0lBQ0wsQ0FBQztJQUNELGFBQWE7Ozs7OztJQUNMLDhDQUFhOzs7OztJQUFyQjtRQUNJLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUMzQixDQUFDO0lBQ0Q7O09BRUc7Ozs7Ozs7SUFDSCxpREFBZ0I7Ozs7OztJQUFoQixVQUFpQixHQUFXLEVBQUUsTUFBcUI7UUFBbkQsaUJBMkhDO1FBMUhHLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7OztZQUVuRCxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDOztZQUM1QyxrQkFBa0IsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsa0JBQWtCOztZQUU1RCxNQUFNLEdBQWUsRUFBRTs7O1lBRXJCLFFBQVEsR0FBRyxTQUFTLENBQUMsUUFBUTtRQUNuQyxTQUFTO1FBQ1QsSUFBSSxRQUFRLEtBQUssS0FBSyxFQUFFO1lBQ3BCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1NBQ3BCO1FBQ0QsV0FBVztRQUNYLElBQUksUUFBUSxLQUFLLFVBQVUsRUFBRTtZQUN6QixJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0JBQ3hDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLFVBQVUsQ0FBQzthQUN0QztZQUNELElBQUksU0FBUyxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDekMsa0JBQWtCO2dCQUNsQixNQUFNLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO2FBQzVDO1lBQ0QsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUN0QyxNQUFNLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUM7YUFDeEM7U0FDSjtRQUNELE9BQU87UUFDUCxJQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7O2dCQUNqQixXQUFXLEdBQUcsU0FBUyxDQUFDLFdBQVc7O2dCQUNuQyxXQUFXLEdBQVcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7WUFDeEQsSUFBSSxXQUFXLEVBQUU7Z0JBQ2IsTUFBTSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7Z0JBQzNCLFFBQVEsV0FBVyxFQUFFO29CQUNqQixLQUFLLE1BQU07d0JBQ1AsTUFBTSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUM7d0JBQzFCLE1BQU07b0JBQ1YsS0FBSyxNQUFNO3dCQUNQLE1BQU0sQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDO3dCQUMxQixNQUFNO29CQUNWLGVBQWU7b0JBQ2YsS0FBSyxHQUFHLENBQUM7b0JBQ1Q7d0JBQ0ksTUFBTSxDQUFDLFVBQVUsR0FBRyxXQUFXLENBQUM7d0JBQ2hDLE1BQU07aUJBQ2I7YUFDSjtpQkFBTTtnQkFDSCxvQkFBb0I7Z0JBQ3BCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO2FBQ3BCO1NBQ0o7UUFFRCxlQUFlO1FBQ2YsSUFBSSxHQUFHLEtBQUssK0JBQStCLElBQUksUUFBUSxLQUFLLEtBQUssRUFBRTs7Z0JBRTNELE1BQU0sR0FBRyxHQUFHLEdBQUMsVUFBVTs7Z0JBQ3JCLE1BQU0sR0FBRztnQkFDWCxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQzVDLE1BQU0sRUFBRSxFQUFFLE9BQU8sRUFBRyxNQUFNLEVBQUM7YUFDOUI7WUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRzs7OztZQUFDLFVBQUMsR0FBVTs7b0JBQy9DLFVBQVUsR0FBcUIsRUFBRTtnQkFDdkMsT0FBTyxVQUFVLENBQUM7WUFDdEIsQ0FBQyxFQUFDLENBQUMsQ0FBQztTQUNQO1FBRUQsVUFBVTtRQUNWLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ3RCLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNyRCxXQUFXLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ25DOztZQUNLLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQzs7WUFDakMsR0FBRyxHQUFHO1lBQ1IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQzVDLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUU7U0FDOUI7UUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRzs7OztRQUFDLFVBQUMsR0FBVTs7Z0JBQ3pDLFVBQVUsR0FBUSxFQUFFO1lBQzFCLFVBQVUsQ0FBQyxZQUFZLEdBQUcsa0JBQWtCLENBQUM7WUFFN0MsVUFBVSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDdEIsVUFBVSxDQUFDLFFBQVEsR0FBRztnQkFDbEIsWUFBWSxFQUFFLE9BQU87Z0JBQ3JCLFNBQVMsRUFBRSxVQUFVO2dCQUNyQixTQUFTLEVBQUUsVUFBVTtnQkFDckIsU0FBUyxFQUFFLE1BQU07Z0JBQ2pCLFVBQVUsRUFBRSxPQUFPO2dCQUNuQixXQUFXLEVBQUUsVUFBVTtnQkFDdkIsYUFBYSxFQUFFLFVBQVU7YUFDNUIsQ0FBQztZQUNGLFVBQVUsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDN0MsVUFBVSxDQUFDLE9BQU8sR0FBRztnQkFDakIsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRTtnQkFDaEQsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRTthQUFDLENBQUM7WUFDdEQsVUFBVSxDQUFDLFlBQVksR0FBRztnQkFDdEIsRUFBRSxLQUFLLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRTtnQkFDaEQsRUFBRSxLQUFLLEVBQUUsS0FBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRTthQUNuRCxDQUFDO1lBQ0YsUUFBUTtZQUNSLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxJQUFJO2dCQUNwQixJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtvQkFDcEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7aUJBQ3hCO2dCQUNELElBQUksQ0FBQyxRQUFRLEdBQUc7b0JBQ1osUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO29CQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7b0JBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO29CQUNqQixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7aUJBQzFCLENBQUM7WUFDTixDQUFDLEVBQUMsQ0FBQztZQUNILGtCQUFrQjtZQUNsQixJQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUU7Z0JBQ3JCLFVBQVUsQ0FBQyxLQUFLLEdBQUcsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ2hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2pDO2lCQUFNO2dCQUNILGFBQWE7Z0JBQ2IsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTOzs7O29CQUFDLFVBQUEsSUFBSTt3QkFDcEIsVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3hELENBQUMsRUFBQyxDQUFDO2lCQUNOO2FBQ0o7WUFDRCxPQUFPLFVBQVUsQ0FBQztRQUN0QixDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQztJQUVEOztPQUVHOzs7Ozs7O0lBQ0ssa0RBQWlCOzs7Ozs7SUFBekIsVUFBMkIsR0FBUTs7WUFDekIsSUFBSSxHQUFhLEVBQUU7UUFDekIsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7UUFDaEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUM7UUFDeEMsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztRQUMzQixlQUFlO1FBQ2YsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUN2Qix3QkFBd0I7UUFDeEIsSUFBSSxHQUFHLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztTQUNoQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxtQkFBbUI7Ozs7Ozs7O0lBQ25CLGlEQUFnQjs7Ozs7OztJQUFoQixVQUFrQixLQUFZLEVBQUUsV0FBbUIsRUFBRSxRQUFnQjtRQUFyRSxpQkFxQkM7OztZQW5CUyxhQUFhLEdBQUcsS0FBSyxDQUFDLE1BQU07Ozs7UUFBQyxVQUFBLENBQUM7WUFDaEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDakIsT0FBTyxJQUFJLENBQUM7YUFDZjs7O2dCQUVLLENBQUMsR0FBRyxLQUFLLENBQUMsSUFBSTs7OztZQUFDLFVBQUEsTUFBTSxJQUFJLE9BQUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBbkMsQ0FBbUMsRUFBQztZQUNuRSxJQUFJLENBQUMsQ0FBQyxFQUFFO2dCQUNKLE9BQU8sSUFBSSxDQUFDO2FBQ2Y7UUFDTCxDQUFDLEVBQUM7O1lBQ0ksUUFBUSxHQUFlLEVBQUU7UUFDL0IsYUFBYSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFBLENBQUM7O2dCQUNiLElBQUksR0FBRyxLQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsQ0FBQyxFQUFDLENBQUM7UUFDSCxRQUFRLENBQUMsT0FBTzs7OztRQUFDLFVBQUEsSUFBSTtZQUNqQixLQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbEUsQ0FBQyxFQUFDLENBQUM7UUFDSCxPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDO0lBRUQsWUFBWTs7Ozs7Ozs7O0lBQ1oscURBQW9COzs7Ozs7OztJQUFwQixVQUFzQixNQUFnQixFQUFFLEtBQVksRUFBRSxXQUFtQixFQUFFLFFBQWdCO1FBQTNGLGlCQWFDOztZQVpTLFNBQVMsR0FBRyxLQUFLLENBQUMsTUFBTTs7OztRQUFDLFVBQUEsU0FBUztZQUNwQyxJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNsRCxPQUFPLElBQUksQ0FBQzthQUNmO1FBQ0wsQ0FBQyxFQUFDO1FBQ0YsSUFBSSxTQUFTLElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkMsU0FBUyxDQUFDLE9BQU87Ozs7WUFBQyxVQUFBLEtBQUs7O29CQUNiLElBQUksR0FBRyxLQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDO2dCQUMxQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDM0IsS0FBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ2xFLENBQUMsRUFBQyxDQUFDO1NBQ047SUFDTCxDQUFDO0lBRUQ7O09BRUc7Ozs7Ozs7SUFDSCw0Q0FBVzs7Ozs7O0lBQVgsVUFBYSxHQUFXLEVBQUUsTUFBcUI7O1lBQ3ZDLE1BQU0sR0FBUSxFQUFFO1FBQ3BCLFVBQVU7UUFDVixJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRTtZQUN0QixNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDckQsV0FBVyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNuQzs7WUFDSyxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7O1lBQ2pDLEdBQUcsR0FBRztZQUNSLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUM1QyxNQUFNLEVBQUUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFO1NBQzlCO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUc7Ozs7UUFBQyxVQUFDLEdBQVU7WUFDL0MsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ3ZCLEdBQUcsQ0FBQyxPQUFPOzs7O2dCQUFDLFVBQUEsSUFBSTtvQkFDWixJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxFQUFFO3dCQUMxQyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztxQkFDdEI7b0JBQ0QsU0FBUztvQkFDVCxJQUFJLENBQUMsUUFBUSxHQUFHO3dCQUNaLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTt3QkFDdkIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO3dCQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSzt3QkFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO3FCQUMxQixDQUFDO29CQUNGLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO2dCQUM1QixDQUFDLEVBQUMsQ0FBQzthQUNOO2lCQUFNO2dCQUNILEdBQUcsR0FBRyxFQUFFLENBQUM7YUFDWjtZQUNELE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDMUIsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNSLENBQUM7SUFFRCxhQUFhOzs7Ozs7O0lBQ2IsNENBQVc7Ozs7OztJQUFYLFVBQWEsR0FBVyxFQUFFLE1BQXFCO1FBQS9DLGlCQWdFQzs7WUEvRE8sS0FBSyxHQUFHLE1BQU0sQ0FBQyxTQUFTOztZQUN4QixJQUFJLEdBQUcsTUFBTSxDQUFDLFFBQVE7O1lBQ3RCLGtCQUFrQixHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxrQkFBa0I7UUFFaEUsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxLQUFLLEVBQUU7O2dCQUNGLFVBQVUsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDO1lBQ3ZDLEtBQUssR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztZQUNwQyxJQUFJLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7U0FDckM7O1lBQ0csS0FBSyxHQUFRO1lBQ2IsU0FBUyxFQUFFLEtBQUs7WUFDaEIsUUFBUSxFQUFFLElBQUk7U0FDakI7OztZQUVLLFNBQVMsR0FBRyxNQUFNLENBQUMsV0FBVzs7WUFDOUIsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDOztZQUNqQyxXQUFXLEdBQUcsU0FBUyxDQUFDLFdBQVc7O1lBQ25DLFdBQVcsR0FBRyxTQUFTLENBQUMsV0FBVztRQUN6Qyw0QkFBNEI7UUFDNUIsSUFBSSxXQUFXLElBQUksV0FBVyxFQUFFO1lBQzVCLFFBQVEsV0FBVyxFQUFFO2dCQUNqQixLQUFLLE1BQU07b0JBQ1AsS0FBSyxDQUFDLElBQUksR0FBRyxXQUFXLENBQUM7b0JBQ3pCLE1BQU07Z0JBQ1YsS0FBSyxNQUFNO29CQUNQLEtBQUssQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDO29CQUN6QixNQUFNO2dCQUNWLGVBQWU7Z0JBQ2YsS0FBSyxHQUFHLENBQUM7Z0JBQ1Q7b0JBQ0ksS0FBSyxDQUFDLFVBQVUsR0FBRyxXQUFXLENBQUM7b0JBQy9CLE1BQU07YUFDYjtTQUNKO1FBQ0QsVUFBVTtRQUNWLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ3RCLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNuRCxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2xDO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7WUFDYixRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7O1lBQ2hDLEdBQUcsR0FBRztZQUNSLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUM1QyxNQUFNLEVBQUUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFO1NBQzlCO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUc7Ozs7UUFBQyxVQUFDLEdBQVE7WUFDN0MsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRTtnQkFDakIsc0JBQXNCO2dCQUN0QixLQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzVEO1lBQ0QsT0FBTztnQkFDSCxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUk7Z0JBQ2YsS0FBSyxFQUFFLEdBQUcsQ0FBQyxVQUFVO2dCQUNyQixRQUFRLEVBQUU7b0JBQ04sU0FBUyxFQUFFLEtBQUs7b0JBQ2hCLFFBQVEsRUFBRSxJQUFJO29CQUNkLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUM7b0JBQy9CLFdBQVcsRUFBRSxJQUFJO2lCQUNwQjtnQkFDRCxZQUFZLEVBQUMsa0JBQWtCO2FBQ2xDLENBQUM7UUFDTixDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQztJQUNELFNBQVM7Ozs7Ozs7SUFDVCx3Q0FBTzs7Ozs7O0lBQVAsVUFBUyxHQUFXLEVBQUUsTUFBcUI7UUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztZQUNYLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTTtRQUMxQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDOztZQUNyQixTQUFTLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7O1lBQzdCLE9BQU8sR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDOztZQUM5QyxRQUFRLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDO1FBQzVDLFFBQVEsUUFBUSxFQUFFO1lBQ2QsS0FBSyxRQUFRLENBQUM7WUFDZCxLQUFLLE9BQU8sQ0FBQztZQUNiLEtBQUssUUFBUTtnQkFDVCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQzdDLEtBQUssYUFBYSxDQUFDO1lBQ25CLEtBQUssWUFBWSxDQUFDO1lBQ2xCLEtBQUssYUFBYSxDQUFDO1lBQ25CLEtBQUssVUFBVTtnQkFDWCxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDbEQ7Z0JBQ0ksTUFBTTtTQUNiO0lBQ0wsQ0FBQzs7Z0JBL1ZKLFVBQVU7Ozs7Z0JBZEYsVUFBVTtnQkFHVixvQkFBb0I7Z0JBSXBCLGdCQUFnQjs7SUF1V3pCLDZCQUFDO0NBQUEsQUFoV0QsSUFnV0M7U0EvVlksc0JBQXNCOzs7Ozs7SUFFL0IsNENBQXdCOzs7OztJQUN4Qix5Q0FBcUI7Ozs7O0lBRWpCLHNDQUF3Qjs7Ozs7SUFDeEIseUNBQXFDOzs7OztJQUNyQyw4Q0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgZnJvbSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IElMb29rdXBIdHRwU2VydmljZSwgUmVtb3RlUGFyYW1zLCBMb29rdXBHcmlkUmVzdWx0IH0gZnJvbSAnQGZhcnJpcy91aS1sb29rdXAnO1xyXG5pbXBvcnQgeyBTeXNDb21tb25VdGlsU2VydmljZSwgU3lzRGF0YVV0aWwgfSBmcm9tICdAZ3NwLXN5cy9zeXNtZ3ItY29tbW9uJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyB1c2VySGVscCwgcG9zSGVscCwgcm9sZUhlbHAsIHVzZXJHcm91cEhlbHAsIHBvc0dyb3VwSGVscCwgcm9sZUdyb3VwSGVscCwgc3lzT3JnSGVscCB9IGZyb20gJy4uL2hlbHAtbWV0YS9zeXMtaGVscC1tZXRhJztcclxuaW1wb3J0IHsgVHJlZU5vZGUgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IFN5c0xvY2FsZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9sb2NhbGUvc3lzLWxvY2FsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVHJlZUZpbHRlciB9IGZyb20gJy4uL2ZpbHRlci90cmVlLWZpbHRlcic7XHJcblxyXG5cclxuLyoqXHJcbiAqIOW4ruWKqeacjeWKoVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgU3lzRmFycmlzTG9va3VwU2VydmljZSBpbXBsZW1lbnRzIElMb29rdXBIdHRwU2VydmljZSB7XHJcblxyXG4gICAgcHJpdmF0ZSBmaWx0ZXJEYXRhOiBhbnk7XHJcbiAgICBwcml2YXRlIGkxOG5SZXM6IGFueTtcclxuICAgIGNvbnN0cnVjdG9yIChcclxuICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBzeXNVdGlsOiBTeXNDb21tb25VdGlsU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGxvY2FsU2VydmljZTogU3lzTG9jYWxlU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWIneWni+i/h+a7pOadoeS7tiAqL1xyXG4gICAgcHJpdmF0ZSBzZXRGaWx0ZXJEYXRhIChmaWx0ZXI6IGFueSkge1xyXG4gICAgICAgIC8vIOaciei/h+a7pOadoeS7tlxyXG4gICAgICAgIGlmIChmaWx0ZXIpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkoZmlsdGVyKTtcclxuICAgICAgICAgICAgaWYgKHN0ciAhPT0gJ3t9Jykge1xyXG4gICAgICAgICAgICAgICAgLy8g5LiA5a6a6KaB5aSN5Yi2XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckRhdGEgPSBKU09OLnBhcnNlKHN0cik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlckRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXJEYXRhID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOa3u+WKoOaVsOaNrlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNldExpc3REYXRhIChzcmM6IGFueVtdLCBkYXRhOiBhbnlbXSkge1xyXG4gICAgICAgIGlmIChzcmMpIHtcclxuICAgICAgICAgICAgc3JjLnB1c2guYXBwbHkoc3JjLCBkYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiog6I635Y+W6L+H5ruk5pWw5o2uICovXHJcbiAgICBwcml2YXRlIGdldEZpbHRlckRhdGEgKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyRGF0YTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5byC5q2l6I635Y+W54mI5pysXHJcbiAgICAgKi9cclxuICAgIGdldFRyZWVEYXRhQXN5bmModXJsOiBzdHJpbmcsIHBhcmFtcz86IFJlbW90ZVBhcmFtcyk6IE9ic2VydmFibGU8TG9va3VwR3JpZFJlc3VsdD4ge1xyXG4gICAgICAgIHRoaXMuaTE4blJlcyA9IHRoaXMubG9jYWxTZXJ2aWNlLmdldENvbXBvbmVudE9wdCgnaGVscCcpO1xyXG4gICAgICAgIC8vIOino+aekOafpeivompzb27lr7nosaFcclxuICAgICAgICBjb25zdCB0cmVlUGFyYW0gPSBKU09OLnBhcnNlKHBhcmFtcy5zZWFyY2hWYWx1ZSk7XHJcbiAgICAgICAgbGV0IGZhcnJpc1NlbGVjdGVkRGF0YSA9IHBhcmFtc1snY3VzdG9tRGF0YSddLmZhcnJpc1NlbGVjdGVkRGF0YTtcclxuXHJcbiAgICAgICAgbGV0IGZpbHRlcjogVHJlZUZpbHRlciA9IHt9O1xyXG4gICAgICAgIC8vIGZpbHRlci53aXRoUGVybWlzc2lvbiA9IHRydWU7XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSB0cmVlUGFyYW0uY2F0ZWdvcnk7XHJcbiAgICAgICAgLy8gMS7pppbmrKHliqDovb1cclxuICAgICAgICBpZiAoY2F0ZWdvcnkgPT09ICdhbGwnKSB7XHJcbiAgICAgICAgICAgIGZpbHRlci5sYXllciA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIDIu5byC5q2l5bGV5byA5LiL57qnXHJcbiAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnY2hpbGRyZW4nKSB7XHJcbiAgICAgICAgICAgIGlmICh0cmVlUGFyYW0uaGFzT3duUHJvcGVydHkoJ3BhcmVudFBhdGgnKSkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnBhdGggPSB0cmVlUGFyYW0ucGFyZW50UGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHJlZVBhcmFtLmhhc093blByb3BlcnR5KCdwYXJlbnRMYXllcicpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlkI7nq6/mkJzntKLku6XkuIvnuqfoioLngrnkuLrnuqfmlbDnmoToioLngrlcclxuICAgICAgICAgICAgICAgIGZpbHRlci5sYXllciA9IHRyZWVQYXJhbS5wYXJlbnRMYXllciArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRyZWVQYXJhbS5oYXNPd25Qcm9wZXJ0eSgncGFyZW50SWQnKSkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLnBhcmVudElkID0gdHJlZVBhcmFtLnBhcmVudElkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIDMu5pCc57SiXHJcbiAgICAgICAgaWYgKGNhdGVnb3J5ID09PSAnc2VhcmNoJykge1xyXG4gICAgICAgICAgICBjb25zdCBzZWFyY2hGaWVsZCA9IHRyZWVQYXJhbS5zZWFyY2hGaWVsZDtcclxuICAgICAgICAgICAgY29uc3Qgc2VhcmNoVmFsdWU6IHN0cmluZyA9IHRyZWVQYXJhbS5zZWFyY2hWYWx1ZS50cmltKCk7XHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVyLmlzU2VhcmNoVHJlZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHNlYXJjaEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29kZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5jb2RlID0gc2VhcmNoVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hbWUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIubmFtZSA9IHNlYXJjaFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAvLyDlhajpg6jliJfmkJzntKLvvIzkuYvliY3mmK8nKidcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICcqJzpcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuY29kZU9yTmFtZSA9IHNlYXJjaFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIOaQnOe0ouS4uuepuu+8jOmHjeaWsOWKoOi9ve+8jOm7mOiupOS7jjHnuqflvIDlp4tcclxuICAgICAgICAgICAgICAgIGZpbHRlci5sYXllciA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8v5aaC5p6c5piv57uE57uH77yM6K+35rGC6YCJ5Lit5pWw5o2u5pe2XHJcbiAgICAgICAgaWYgKHVybCA9PT0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9zeXNPcmdzJyAmJiBjYXRlZ29yeSA9PT0gJ2ZhdicpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBuZXdVcmwgPSB1cmwrJy9udWxsb3JnJyBcclxuICAgICAgICAgICAgY29uc3QgbmV3T3B0ID0ge1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5zeXNVdGlsLmdldEhlYWRlcigpWydoZWFkZXJzJ10sXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgdXNlVmlldyA6ICd0cnVlJ31cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChuZXdVcmwsIG5ld09wdCkucGlwZShtYXAoKHZhbDogYW55W10pID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyaWRSZXN1bHQ6IExvb2t1cEdyaWRSZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBncmlkUmVzdWx0O1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDor7TmmI7mnInov4fmu6TmnaHku7ZcclxuICAgICAgICBpZiAodGhpcy5nZXRGaWx0ZXJEYXRhKCkpIHtcclxuICAgICAgICAgICAgZmlsdGVyID0gT2JqZWN0LmFzc2lnbih0aGlzLmdldEZpbHRlckRhdGEoKSwgZmlsdGVyKTtcclxuICAgICAgICAgICAgU3lzRGF0YVV0aWwuZGVsZXRlRW1wdHkoZmlsdGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyYW1TdHIgPSBKU09OLnN0cmluZ2lmeShmaWx0ZXIpO1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHtcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5zeXNVdGlsLmdldEhlYWRlcigpWydoZWFkZXJzJ10sXHJcbiAgICAgICAgICAgIHBhcmFtczogeyBwYXJhbTogcGFyYW1TdHIgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsLCBvcHQpLnBpcGUobWFwKCh2YWw6IGFueVtdKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdyaWRSZXN1bHQ6IGFueSA9IHt9O1xyXG4gICAgICAgICAgICBncmlkUmVzdWx0LnNlbGVjdGVkRGF0YSA9IGZhcnJpc1NlbGVjdGVkRGF0YTtcclxuXHJcbiAgICAgICAgICAgIGdyaWRSZXN1bHQuaXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgZ3JpZFJlc3VsdC50cmVlSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgIGxvYWREYXRhVHlwZTogJ2FzeW5jJyxcclxuICAgICAgICAgICAgICAgIGxheWVyVHlwZTogJ3BhcmVudElkJyxcclxuICAgICAgICAgICAgICAgIGRhdGFGaWVsZDogJ3RyZWVJbmZvJyxcclxuICAgICAgICAgICAgICAgIHBhdGhGaWVsZDogJ3BhdGgnLFxyXG4gICAgICAgICAgICAgICAgbGF5ZXJGaWVsZDogJ2xheWVyJyxcclxuICAgICAgICAgICAgICAgIHBhcmVudEZpZWxkOiAncGFyZW50SWQnLFxyXG4gICAgICAgICAgICAgICAgaXNEZXRhaWxGaWVsZDogJ2lzRGV0YWlsJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBncmlkUmVzdWx0LnRyZWVJbmZvWyd0cmVlRGF0YUlzSW5pdCddID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ3JpZFJlc3VsdC5jb2x1bW5zID0gW1xyXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ2NvZGUnLCB0aXRsZTogdGhpcy5pMThuUmVzLmNvZGVGaWVsZCB9LFxyXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ25hbWUnLCB0aXRsZTogdGhpcy5pMThuUmVzLm5hbWVGaWVsZCB9XTtcclxuICAgICAgICAgICAgZ3JpZFJlc3VsdC5zZWFyY2hGaWVsZHMgPSBbXHJcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiB0aGlzLmkxOG5SZXMuY29kZUZpZWxkLCB2YWx1ZTogJ2NvZGUnIH0sXHJcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiB0aGlzLmkxOG5SZXMubmFtZUZpZWxkLCB2YWx1ZTogJ25hbWUnIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgLy8g5b+F6aG76KaB6LWL5YC8XHJcbiAgICAgICAgICAgIGZyb20odmFsKS5zdWJzY3JpYmUoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5sYXllciA9PT0gMSB8fCAhaXRlbS5wYXJlbnRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ucGFyZW50SWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXRlbS50cmVlSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJZDogaXRlbS5wYXJlbnRJZCxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBpdGVtLnBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXI6IGl0ZW0ubGF5ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNEZXRhaWw6IGl0ZW0uaXNEZXRhaWxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzmmK/mkJzntKLnmoTor53vvIzpnIDopoHoh6rlt7HmnoTpgKDmoJFcclxuICAgICAgICAgICAgaWYgKGZpbHRlci5pc1NlYXJjaFRyZWUpIHtcclxuICAgICAgICAgICAgICAgIGdyaWRSZXN1bHQuaXRlbXMgPSB0aGlzLm1ha2VUcmVlQnlQYXJlbnQodmFsLCAncGFyZW50SWQnLCAnaWQnKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGdyaWRSZXN1bHQuaXRlbXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8g5pyJ57uT5p6c77yM5pmu6YCa5YiG5bGC5Yqg6L29XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsICYmIHZhbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJvbSh2YWwpLnN1YnNjcmliZShpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFJlc3VsdC5pdGVtcy5wdXNoKHRoaXMuY29udmVydFRvVHJlZU5vZGUoaXRlbSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBncmlkUmVzdWx0O1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuagkeiKgueCuei9rOaNouS4ukZhcnJpcyBUcmVlTm9kZVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNvbnZlcnRUb1RyZWVOb2RlIChzcmM6IGFueSk6IFRyZWVOb2RlIHtcclxuICAgICAgICBjb25zdCBub2RlOiBUcmVlTm9kZSA9IHt9O1xyXG4gICAgICAgIG5vZGUuZGF0YSA9IHNyYztcclxuICAgICAgICBub2RlLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgbm9kZS5zZWxlY3RhYmxlID0gc3JjLmZhcnJpc19zZWxlY3RhYmxlO1xyXG4gICAgICAgIG5vZGUubGVhZiA9IHNyYy5pc0RldGFpbDtcclxuICAgICAgICBub2RlLnBhcmVudCA9IHNyYy5wYXJlbnRJZDtcclxuICAgICAgICAvLyDov5nkuIDmnaHlv4XpobvlvpfliqDvvIzlkKbliJnkuI3ooYxcclxuICAgICAgICBub2RlLmlkID0gbm9kZS5kYXRhLmlkO1xyXG4gICAgICAgIC8vIOaQnOe0oueahOaXtuWAmeacgOacq+e6p+a3u+WKoOS6hui/meS4quWxnuaAp++8jOS4jemcgOimgeWxleW8gFxyXG4gICAgICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkoJ2V4cGFuZGVkJykpIHtcclxuICAgICAgICAgICAgbm9kZS5leHBhbmRlZCA9IHNyYy5leHBhbmRlZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOaMieeFp3BhcmVudOeggeaehOmAoOagkSAqL1xyXG4gICAgbWFrZVRyZWVCeVBhcmVudCAoZGF0YXM6IGFueVtdLCBwYXJlbnRGaWVsZDogc3RyaW5nLCBrZXlGaWVsZDogc3RyaW5nKTogVHJlZU5vZGVbXSB7XHJcbiAgICAgICAgLy8g5LiK57Sa54iy56m677yM5oiW6ICF5rKS5pyJ5LiK57Sa55qEXHJcbiAgICAgICAgY29uc3QgcGF0aExheWVyT25lcyA9IGRhdGFzLmZpbHRlcih4ID0+IHtcclxuICAgICAgICAgICAgaWYgKCF4W3BhcmVudEZpZWxkXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8g5pat5bGC55qE6L+Z56eN77yM5bqU6K+l5Lmf5bGe5LqO5LiA57qnXHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBkYXRhcy5maW5kKHBhcmVudCA9PiBwYXJlbnRba2V5RmllbGRdID09PSB4W3BhcmVudEZpZWxkXSk7XHJcbiAgICAgICAgICAgIGlmICghcCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCB0cmVlZGF0YTogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgICAgIHBhdGhMYXllck9uZXMuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuY29udmVydFRvVHJlZU5vZGUoeCk7XHJcbiAgICAgICAgICAgIHRyZWVkYXRhLnB1c2gobm9kZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdHJlZWRhdGEuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maW5kQ2hpbGRyZW5CeVBhcmVudChpdGVtLCBkYXRhcywgcGFyZW50RmllbGQsIGtleUZpZWxkKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdHJlZWRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOaJvuWIsOWtkOiKgueCuSAqL1xyXG4gICAgZmluZENoaWxkcmVuQnlQYXJlbnQgKHBhcmVudDogVHJlZU5vZGUsIGRhdGFzOiBhbnlbXSwgcGFyZW50RmllbGQ6IHN0cmluZywga2V5RmllbGQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkTGlzdCA9IGRhdGFzLmZpbHRlcihjaGlsZGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRpdGVtW3BhcmVudEZpZWxkXSA9PT0gcGFyZW50LmRhdGFba2V5RmllbGRdKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChjaGlsZExpc3QgJiYgY2hpbGRMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY2hpbGRMaXN0LmZvckVhY2goY2hpbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuY29udmVydFRvVHJlZU5vZGUoY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50LmNoaWxkcmVuLnB1c2gobm9kZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmRDaGlsZHJlbkJ5UGFyZW50KG5vZGUsIGRhdGFzLCBwYXJlbnRGaWVsZCwga2V5RmllbGQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhajpg6jojrflj5bniYjmnKzniYjmnKxcclxuICAgICAqL1xyXG4gICAgZ2V0VHJlZURhdGEgKHVybDogc3RyaW5nLCBwYXJhbXM/OiBSZW1vdGVQYXJhbXMpOiBPYnNlcnZhYmxlPExvb2t1cEdyaWRSZXN1bHQ+IHtcclxuICAgICAgICBsZXQgZmlsdGVyOiBhbnkgPSB7fTtcclxuICAgICAgICAvLyDor7TmmI7mnInov4fmu6TmnaHku7ZcclxuICAgICAgICBpZiAodGhpcy5nZXRGaWx0ZXJEYXRhKCkpIHtcclxuICAgICAgICAgICAgZmlsdGVyID0gT2JqZWN0LmFzc2lnbih0aGlzLmdldEZpbHRlckRhdGEoKSwgZmlsdGVyKTtcclxuICAgICAgICAgICAgU3lzRGF0YVV0aWwuZGVsZXRlRW1wdHkoZmlsdGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyYW1TdHIgPSBKU09OLnN0cmluZ2lmeShmaWx0ZXIpO1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHtcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5zeXNVdGlsLmdldEhlYWRlcigpWydoZWFkZXJzJ10sXHJcbiAgICAgICAgICAgIHBhcmFtczogeyBwYXJhbTogcGFyYW1TdHIgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsLCBvcHQpLnBpcGUobWFwKCh2YWw6IGFueVtdKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWwgJiYgdmFsLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhbC5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmxheWVyID09IDEgfHwgaXRlbS5wYXJlbnRJZCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGFyZW50SWQgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5ruh6Laz5YmN56uv57uT5p6EXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50cmVlSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQ6IGl0ZW0ucGFyZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGl0ZW0ucGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXI6IGl0ZW0ubGF5ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzRGV0YWlsOiBpdGVtLmlzRGV0YWlsXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnNlbGVjdGFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHsgaXRlbXM6IHZhbCB9O1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6I635Y+W5YiX6KGo5pWw5o2uICovXHJcbiAgICBnZXRHcmlkRGF0YSAodXJsOiBzdHJpbmcsIHBhcmFtcz86IFJlbW90ZVBhcmFtcyk6IE9ic2VydmFibGU8TG9va3VwR3JpZFJlc3VsdD4ge1xyXG4gICAgICAgIGxldCBpbmRleCA9IHBhcmFtcy5wYWdlSW5kZXg7XHJcbiAgICAgICAgbGV0IHNpemUgPSBwYXJhbXMucGFnZVNpemU7XHJcbiAgICAgICAgbGV0IGZhcnJpc1NlbGVjdGVkRGF0YSA9IHBhcmFtc1snY3VzdG9tRGF0YSddLmZhcnJpc1NlbGVjdGVkRGF0YTtcclxuXHJcbiAgICAgICAgLy8g55uu5YmN6L+Z5Liq5Zyw5pa55pyJ6Zeu6aKY77yM56ys5LiA5qyh55qE5pe25YCZ5Lyg6YCS5LiN6L+H5p2lXHJcbiAgICAgICAgaWYgKCFpbmRleCkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21EYXRhID0gcGFyYW1zWydjdXN0b21EYXRhJ107XHJcbiAgICAgICAgICAgIGluZGV4ID0gY3VzdG9tRGF0YS5maWx0ZXIucGFnZUluZGV4O1xyXG4gICAgICAgICAgICBzaXplID0gY3VzdG9tRGF0YS5maWx0ZXIucGFnZVNpemU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBwYXJhbTogYW55ID0ge1xyXG4gICAgICAgICAgICBwYWdlSW5kZXg6IGluZGV4LFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogc2l6ZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIOaYr+WQpuacieaQnOe0olxyXG4gICAgICAgIGNvbnN0IGZpbHRlclN0ciA9IHBhcmFtcy5zZWFyY2hWYWx1ZTtcclxuICAgICAgICBjb25zdCBmaWx0ZXJPYmogPSBKU09OLnBhcnNlKGZpbHRlclN0cik7XHJcbiAgICAgICAgY29uc3Qgc2VhcmNoRmllbGQgPSBmaWx0ZXJPYmouc2VhcmNoRmllbGQ7XHJcbiAgICAgICAgY29uc3Qgc2VhcmNoVmFsdWUgPSBmaWx0ZXJPYmouc2VhcmNoVmFsdWU7XHJcbiAgICAgICAgLy8g5pyJ6L+H5ruk5p+l6K+iLOacieWPr+iDveaQnOe0ouWAvOS4uuepuu+8jOi/meaXtuWAmeaYr+S4jemcgOimgeaQnOe0oueahFxyXG4gICAgICAgIGlmIChzZWFyY2hGaWVsZCAmJiBzZWFyY2hWYWx1ZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHNlYXJjaEZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb2RlJzpcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbS5jb2RlID0gc2VhcmNoVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICduYW1lJzpcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbS5uYW1lID0gc2VhcmNoVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyDlhajpg6jliJfmkJzntKLvvIzkuYvliY3mmK8nKidcclxuICAgICAgICAgICAgICAgIGNhc2UgJyonOlxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbS5jb2RlT3JOYW1lID0gc2VhcmNoVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6K+05piO5pyJ6L+H5ruk5p2h5Lu2XHJcbiAgICAgICAgaWYgKHRoaXMuZ2V0RmlsdGVyRGF0YSgpKSB7XHJcbiAgICAgICAgICAgIHBhcmFtID0gT2JqZWN0LmFzc2lnbih0aGlzLmdldEZpbHRlckRhdGEoKSwgcGFyYW0pO1xyXG4gICAgICAgICAgICBTeXNEYXRhVXRpbC5kZWxldGVFbXB0eShwYXJhbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKHBhcmFtKTtcclxuICAgICAgICBjb25zdCBwYXJhbVN0ciA9IEpTT04uc3RyaW5naWZ5KHBhcmFtKTtcclxuICAgICAgICBjb25zdCBvcHQgPSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuc3lzVXRpbC5nZXRIZWFkZXIoKVsnaGVhZGVycyddLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHsgcGFyYW06IHBhcmFtU3RyIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgb3B0KS5waXBlKG1hcCgodmFsOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbCAmJiB2YWwuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5bCG5pys5qyh5YiG6aG155qE5pWw5o2u6ZmE5Yqg5Yiw5b2T5YmN5biu5Yqp55qE5YiX6KGo5LitXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldExpc3REYXRhKHBhcmFtc1snY3VzdG9tRGF0YSddLmFsbERhdGEsIHZhbC5kYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbXM6IHZhbC5kYXRhLFxyXG4gICAgICAgICAgICAgICAgdG90YWw6IHZhbC50b3RhbENvdW50LFxyXG4gICAgICAgICAgICAgICAgcGFnZUluZm86IHtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IGluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBzaXplLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VMaXN0OiBbMjAsIDQwLCA2MCwgODAsIDEwMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlUGFnZXI6IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZERhdGE6ZmFycmlzU2VsZWN0ZWREYXRhXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG4gICAgLyoqIOWPluaVsCAqL1xyXG4gICAgZ2V0RGF0YSAodXJsOiBzdHJpbmcsIHBhcmFtcz86IFJlbW90ZVBhcmFtcyk6IE9ic2VydmFibGU8TG9va3VwR3JpZFJlc3VsdD4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XHJcbiAgICAgICAgY29uc29sZS5sb2codXJsKTtcclxuICAgICAgICBjb25zdCBmaWx0ZXIgPSBwYXJhbXNbJ2N1c3RvbURhdGEnXS5maWx0ZXI7XHJcbiAgICAgICAgdGhpcy5zZXRGaWx0ZXJEYXRhKGZpbHRlcik7XHJcbiAgICAgICAgY29uc3QgdHlwZUluZGV4ID0gdXJsLmluZGV4T2YoJ1xcLycpO1xyXG4gICAgICAgIGNvbnN0IGh0dHBVcmwgPSB1cmwuc3Vic3RyaW5nKHR5cGVJbmRleCwgdXJsLmxlbmd0aCk7XHJcbiAgICAgICAgY29uc3QgaGVscFR5cGUgPSB1cmwuc3Vic3RyaW5nKDAsIHR5cGVJbmRleCk7XHJcbiAgICAgICAgc3dpdGNoIChoZWxwVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIHVzZXJIZWxwOlxyXG4gICAgICAgICAgICBjYXNlIHBvc0hlbHA6XHJcbiAgICAgICAgICAgIGNhc2Ugcm9sZUhlbHA6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRHcmlkRGF0YShodHRwVXJsLCBwYXJhbXMpO1xyXG4gICAgICAgICAgICBjYXNlIHVzZXJHcm91cEhlbHA6XHJcbiAgICAgICAgICAgIGNhc2UgcG9zR3JvdXBIZWxwOlxyXG4gICAgICAgICAgICBjYXNlIHJvbGVHcm91cEhlbHA6XHJcbiAgICAgICAgICAgIGNhc2Ugc3lzT3JnSGVscDpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRyZWVEYXRhQXN5bmMoaHR0cFVybCwgcGFyYW1zKTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
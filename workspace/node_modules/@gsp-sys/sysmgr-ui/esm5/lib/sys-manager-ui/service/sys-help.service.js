/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { from } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { SysCommonUtilService, SysDataUtil } from '@gsp-sys/sysmgr-common';
import { map } from 'rxjs/operators';
var SysHelpService = /** @class */ (function () {
    function SysHelpService(http, sysUtil) {
        this.http = http;
        this.sysUtil = sysUtil;
    }
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getHttpOption = /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        SysDataUtil.deleteEmpty(filter);
        /** @type {?} */
        var paramStr = JSON.stringify(filter);
        /** @type {?} */
        var opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return opt;
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getUsers = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        // 用户目前的有分页信息
        return this.http.get(this.sysUtil.userWebApi, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            return val.data;
        })));
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getPositions = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        return this.http.get(this.sysUtil.positionWebApi, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            return val.data;
        })));
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getRoles = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        return this.http.get(this.sysUtil.roleWebApi, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            return val.data;
        })));
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getOrgs = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        // 视图
        opt.params.useView = true;
        return this.handerTreeData(this.http.get(this.sysUtil.sysOrgWebApi + '/all', opt));
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getUserGroups = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        return this.handerTreeData(this.http.get(this.sysUtil.userGroupWebApi + '/all', opt));
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getPositionGroups = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        return this.handerTreeData(this.http.get(this.sysUtil.posGroupWebApi + '/all', opt));
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    SysHelpService.prototype.getRoleGroups = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var opt = this.getHttpOption(filter);
        return this.handerTreeData(this.http.get(this.sysUtil.roleGroupWebApi + '/all', opt));
    };
    /**
     * @param {?} item
     * @return {?}
     */
    SysHelpService.prototype.convert2Json = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var result = {
            id: item.id,
            code: item.code,
            name: item.name,
            parentId: item.parentId || '',
            path: item.path,
            layer: item.layer,
            isDetail: item.isDetail,
        };
        if (item.nodeType != null && item.nodeType !== undefined) {
            result.nodeType = item.nodeType;
        }
        return result;
    };
    /**
     * @param {?} org
     * @return {?}
     */
    SysHelpService.prototype.getParentOrg = /**
     * @param {?} org
     * @return {?}
     */
    function (org) {
        /** @type {?} */
        var paramStr = JSON.stringify(this.convert2Json(org));
        /** @type {?} */
        var opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return this.http.get(this.sysUtil.sysOrgWebApi + '/getparentorg/0002', opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            return val;
        })));
    };
    /** 适配Kendo-treeView结构 */
    /**
     * 适配Kendo-treeView结构
     * @private
     * @param {?} src
     * @return {?}
     */
    SysHelpService.prototype.handerTreeData = /**
     * 适配Kendo-treeView结构
     * @private
     * @param {?} src
     * @return {?}
     */
    function (src) {
        return src.pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            from(val).subscribe((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.layer == 1 || item.parentId == null || item.parentId === '') {
                    item.parentId = undefined;
                }
            }));
            return val;
        })));
    };
    SysHelpService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    SysHelpService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: SysCommonUtilService }
    ]; };
    return SysHelpService;
}());
export { SysHelpService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SysHelpService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    SysHelpService.prototype.sysUtil;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzLWhlbHAuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3N5c21nci11aS8iLCJzb3VyY2VzIjpbImxpYi9zeXMtbWFuYWdlci11aS9zZXJ2aWNlL3N5cy1oZWxwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzNFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU1yQztJQUdJLHdCQUNZLElBQWdCLEVBQ2hCLE9BQTZCO1FBRDdCLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsWUFBTyxHQUFQLE9BQU8sQ0FBc0I7SUFFekMsQ0FBQzs7Ozs7O0lBRU8sc0NBQWE7Ozs7O0lBQXJCLFVBQXVCLE1BQVc7UUFDOUIsV0FBVyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQzs7WUFDMUIsUUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDOztZQUNqQyxHQUFHLEdBQUc7WUFDUixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDNUMsTUFBTSxFQUFFLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRTtTQUM5QjtRQUNELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQzs7Ozs7SUFFRCxpQ0FBUTs7OztJQUFSLFVBQVUsTUFBcUI7O1lBQ3JCLEdBQUcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUN0QyxhQUFhO1FBQ2IsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FB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b0JBQ2xFLElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDO2lCQUM3QjtZQUNMLENBQUMsRUFBQyxDQUFDO1lBQ0gsT0FBTyxHQUFHLENBQUM7UUFDZixDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQzs7Z0JBaEdKLFVBQVU7Ozs7Z0JBUkYsVUFBVTtnQkFDVixvQkFBb0I7O0lBd0c3QixxQkFBQztDQUFBLEFBakdELElBaUdDO1NBaEdZLGNBQWM7Ozs7OztJQUduQiw4QkFBd0I7Ozs7O0lBQ3hCLGlDQUFxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBTeXNDb21tb25VdGlsU2VydmljZSwgU3lzRGF0YVV0aWwgfSBmcm9tICdAZ3NwLXN5cy9zeXNtZ3ItY29tbW9uJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBHc3BVc2VyRmlsdGVyIH0gZnJvbSAnLi4vZmlsdGVyL2dzcC11c2VyLWZpbHRlcic7XHJcbmltcG9ydCB7IEdzcFBvc2l0aW9uRmlsdGVyIH0gZnJvbSAnLi4vZmlsdGVyL2dzcC1wb3NpdGlvbi1maWx0ZXInO1xyXG5pbXBvcnQgeyBHc3BSb2xlRmlsdGVyIH0gZnJvbSAnLi4vZmlsdGVyL2dzcC1yb2xlLWZpbHRlcic7XHJcbmltcG9ydCB7IFRyZWVGaWx0ZXIgfSBmcm9tICcuLi9maWx0ZXIvdHJlZS1maWx0ZXInO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgU3lzSGVscFNlcnZpY2Uge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yIChcclxuICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgICAgICAgcHJpdmF0ZSBzeXNVdGlsOiBTeXNDb21tb25VdGlsU2VydmljZVxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRIdHRwT3B0aW9uIChmaWx0ZXI6IGFueSk6IHsgaGVhZGVyczogYW55LCBwYXJhbXM6IGFueSB9IHtcclxuICAgICAgICBTeXNEYXRhVXRpbC5kZWxldGVFbXB0eShmaWx0ZXIpO1xyXG4gICAgICAgIGNvbnN0IHBhcmFtU3RyID0gSlNPTi5zdHJpbmdpZnkoZmlsdGVyKTtcclxuICAgICAgICBjb25zdCBvcHQgPSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuc3lzVXRpbC5nZXRIZWFkZXIoKVsnaGVhZGVycyddLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHsgcGFyYW06IHBhcmFtU3RyIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBvcHQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlcnMgKGZpbHRlcjogR3NwVXNlckZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgLy8g55So5oi355uu5YmN55qE5pyJ5YiG6aG15L+h5oGvXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy5zeXNVdGlsLnVzZXJXZWJBcGksIG9wdCkucGlwZShtYXAoKHZhbDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWwuZGF0YTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UG9zaXRpb25zIChmaWx0ZXI6IEdzcFBvc2l0aW9uRmlsdGVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBvcHQgPSB0aGlzLmdldEh0dHBPcHRpb24oZmlsdGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwucG9zaXRpb25XZWJBcGksIG9wdCkucGlwZShtYXAoKHZhbDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWwuZGF0YTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICBnZXRSb2xlcyAoZmlsdGVyOiBHc3BSb2xlRmlsdGVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBvcHQgPSB0aGlzLmdldEh0dHBPcHRpb24oZmlsdGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwucm9sZVdlYkFwaSwgb3B0KS5waXBlKG1hcCgodmFsOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbC5kYXRhO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxuICAgIGdldE9yZ3MgKGZpbHRlcjogVHJlZUZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgLy8g6KeG5Zu+XHJcbiAgICAgICAgb3B0LnBhcmFtcy51c2VWaWV3ID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kZXJUcmVlRGF0YSh0aGlzLmh0dHAuZ2V0KHRoaXMuc3lzVXRpbC5zeXNPcmdXZWJBcGkgKyAnL2FsbCcsIG9wdCkpO1xyXG4gICAgfVxyXG4gICAgZ2V0VXNlckdyb3VwcyAoZmlsdGVyOiBUcmVlRmlsdGVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBvcHQgPSB0aGlzLmdldEh0dHBPcHRpb24oZmlsdGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kZXJUcmVlRGF0YSh0aGlzLmh0dHAuZ2V0KHRoaXMuc3lzVXRpbC51c2VyR3JvdXBXZWJBcGkgKyAnL2FsbCcsIG9wdCkpO1xyXG4gICAgfVxyXG4gICAgZ2V0UG9zaXRpb25Hcm91cHMgKGZpbHRlcjogVHJlZUZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGVyVHJlZURhdGEodGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwucG9zR3JvdXBXZWJBcGkgKyAnL2FsbCcsIG9wdCkpO1xyXG4gICAgfVxyXG4gICAgZ2V0Um9sZUdyb3VwcyAoZmlsdGVyOiBUcmVlRmlsdGVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBvcHQgPSB0aGlzLmdldEh0dHBPcHRpb24oZmlsdGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kZXJUcmVlRGF0YSh0aGlzLmh0dHAuZ2V0KHRoaXMuc3lzVXRpbC5yb2xlR3JvdXBXZWJBcGkgKyAnL2FsbCcsIG9wdCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnZlcnQySnNvbihpdGVtOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdDogYW55ID0ge1xyXG4gICAgICAgICAgICBpZDogaXRlbS5pZCxcclxuICAgICAgICAgICAgY29kZTogaXRlbS5jb2RlLFxyXG4gICAgICAgICAgICBuYW1lOiBpdGVtLm5hbWUsXHJcbiAgICAgICAgICAgIHBhcmVudElkOiBpdGVtLnBhcmVudElkIHx8ICcnLFxyXG4gICAgICAgICAgICBwYXRoOiBpdGVtLnBhdGgsXHJcbiAgICAgICAgICAgIGxheWVyOiBpdGVtLmxheWVyLFxyXG4gICAgICAgICAgICBpc0RldGFpbDogaXRlbS5pc0RldGFpbCxcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoaXRlbS5ub2RlVHlwZSAhPSBudWxsICYmIGl0ZW0ubm9kZVR5cGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXN1bHQubm9kZVR5cGUgPSBpdGVtLm5vZGVUeXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgZ2V0UGFyZW50T3JnIChvcmc6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3QgcGFyYW1TdHIgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnZlcnQySnNvbihvcmcpKTtcclxuXHJcbiAgICAgICAgY29uc3Qgb3B0ID0ge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLnN5c1V0aWwuZ2V0SGVhZGVyKClbJ2hlYWRlcnMnXSxcclxuICAgICAgICAgICAgcGFyYW1zOiB7IHBhcmFtOiBwYXJhbVN0ciB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwuc3lzT3JnV2ViQXBpKycvZ2V0cGFyZW50b3JnLzAwMDInLCBvcHQpLnBpcGUobWFwKCh2YWw6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog6YCC6YWNS2VuZG8tdHJlZVZpZXfnu5PmnoQgKi9cclxuICAgIHByaXZhdGUgaGFuZGVyVHJlZURhdGEgKHNyYzogT2JzZXJ2YWJsZTxhbnk+KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gc3JjLnBpcGUobWFwKCh2YWw6IGFueVtdKSA9PiB7XHJcbiAgICAgICAgICAgIGZyb20odmFsKS5zdWJzY3JpYmUoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5sYXllciA9PSAxIHx8IGl0ZW0ucGFyZW50SWQgPT0gbnVsbCB8fCBpdGVtLnBhcmVudElkID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ucGFyZW50SWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxufVxyXG4iXX0=
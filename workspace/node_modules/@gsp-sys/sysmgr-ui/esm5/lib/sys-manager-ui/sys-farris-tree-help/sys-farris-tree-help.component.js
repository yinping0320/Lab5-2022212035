/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { SysHelpService } from './../service/sys-help.service';
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { LookupGridComponent, ServerSideToken } from '@farris/ui-lookup';
import { SysCommonUtilService } from '@gsp-sys/sysmgr-common';
import { sysOrgHelp, posGroupHelp, roleGroupHelp, userGroupHelp } from '../help-meta/sys-help-meta';
import { SysFarrisLookupService } from '../service/sys-farris-lookup.service';
import { of } from 'rxjs';
import { SysLocaleService } from '../../locale/sys-locale.service';
import { HELP_LOCALE_ZHCHS } from '../../locale/locales/zh-cn/help';
import { map } from 'rxjs/operators';
var SysFarrisTreeHelpComponent = /** @class */ (function () {
    function SysFarrisTreeHelpComponent(sysUtil, localService, sysHelpService) {
        var _this = this;
        this.sysUtil = sysUtil;
        this.localService = localService;
        this.sysHelpService = sysHelpService;
        /**
         * 是否只读
         */
        this.disabled = false;
        /**
         * 是否分层加载组织
         */
        this.async = false;
        /**
         * 是否单选
         */
        this.singleSelect = true;
        /**
         * 打开帮助后是否有选中数据
         */
        this.enableToSelect = true;
        /**
         * 启用关闭前事件
         */
        this.useBeforeCloseEvent = false;
        /**
         * 是否开始数据权限过滤
         */
        this.withPermission = false;
        /**
         * 帮助选择后事件
         */
        this.afterConfirm = new EventEmitter();
        /**
         * 清空后事件-暂时不用
         */
        this.clear = new EventEmitter();
        this.showAllPathOrg = false;
        this.mapFields = { id: 'id', name: 'name' };
        this.allData = [];
        /**
         * 帮助前事件,强行传递过滤条件
         */
        this.beforeOpen = (/**
         * @param {?} arg
         * @return {?}
         */
        function (arg) {
            //如果有过滤条件，附加到url路径
            /** @type {?} */
            var farrisSelectedData = [];
            /** @type {?} */
            var selectedData = [];
            /** @type {?} */
            var temp = 0;
            if (_this.bindingData != null && _this.bindingData.id != null && _this.bindingData.id != "") {
                selectedData = _this.bindingData.id.split(',');
                /** @type {?} */
                var selectedDataName_1 = _this.bindingData.name.split(',');
                selectedData.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    farrisSelectedData.push({ "id": item, "name": selectedDataName_1[temp] });
                    temp = temp + 1;
                }));
            }
            return of({
                showDialog: true,
                data: {
                    filter: _this.filter,
                    allData: _this.allData,
                    farrisSelectedData: farrisSelectedData
                }
            });
        });
        /**
         * 帮助关闭前事件,目前无论是否都会继续走afterOk映射事件
         */
        this.dictPicked = (/**
         * @param {?} arg
         * @return {?}
         */
        function (arg) {
            if (_this.useBeforeCloseEvent && _this.beforeClose) {
                return _this.beforeClose(arg).pipe(map((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) {
                    // 如果能关闭，调用后事件
                    if (val.closeDialog) {
                        _this.afterConfirm.next(arg);
                    }
                    return val;
                })));
            }
            else {
                return of({ closeDialog: true });
            }
        });
        /**
         * 帮助映射后事件
         */
        this.afterOk = (/**
         * @param {?} helpdata
         * @param {?} mapfields
         * @return {?}
         */
        function (helpdata, mapfields) {
            // 如果启用了关闭前校验事件，不走这里
            if (_this.useBeforeCloseEvent) {
                return;
            }
            if (helpdata) {
                // 多选的话需要处理,帮助已逗号为间隔
                if (!_this.singleSelect) {
                    /** @type {?} */
                    var idList = helpdata.map((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return item.id; }));
                    /** @type {?} */
                    var nameList = helpdata.map((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return item.name; }));
                    _this.bindingData.id = idList.join();
                    _this.bindingData.name = nameList.join();
                    _this.displayTxt = _this.bindingData.name;
                    _this.afterConfirm.next(helpdata);
                }
                else {
                    // 帮助显示
                    _this.displayTxt = helpdata.name;
                    if (_this.showAllPathOrg) {
                        _this.sysHelpService.getParentOrg(helpdata).subscribe((/**
                         * @param {?} items
                         * @return {?}
                         */
                        function (items) {
                            if (items && items.length > 0) {
                                helpdata.allPathOrg = items;
                            }
                            _this.afterConfirm.next(helpdata);
                            console.log(helpdata);
                        }));
                    }
                    else {
                        _this.afterConfirm.next(helpdata);
                    }
                }
            }
            else { // 目前清空会走这里，而且两次
                // 触发事件
                _this.afterConfirm.next(helpdata);
                console.log(helpdata);
            }
        });
    }
    /**
     * @return {?}
     */
    SysFarrisTreeHelpComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.localService) {
            this.i18nRes = this.localService.getComponentOpt('help');
        }
        else {
            this.i18nRes = HELP_LOCALE_ZHCHS;
        }
        // 默认不分层加载
        this.treeInfo = {
            loadDataType: 'all',
            layerType: 'parentId',
            dataField: 'treeInfo',
            pathField: 'path',
            layerField: 'layer',
            parentField: 'parentId',
            isDetailField: 'isDetail',
            treeDataIsInit: false
        };
        this.columns = [
            { title: this.i18nRes.codeField, field: 'code', searchField: 'code' },
            { title: this.i18nRes.nameField, field: 'name', searchField: 'name' },
        ];
        // 异步加载的话需要开启这两个开关
        if (this.async) {
            this.treeInfo.loadDataType = 'async';
            this.treeInfo.treeDataIsInit = true;
        }
        // webapi初始
        switch (this.sourceType) {
            case 'org':
                this.dataUri = sysOrgHelp + this.sysUtil.sysOrgWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.userOrgTitle;
                }
                break;
            case 'usergroup':
                this.dataUri = userGroupHelp + this.sysUtil.userGroupWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.userGroupTitle;
                }
                break;
            case 'positiongroup':
                this.dataUri = posGroupHelp + this.sysUtil.posGroupWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.positionGroupTitle;
                }
                break;
            case 'rolegroup':
            default:
                this.dataUri = roleGroupHelp + this.sysUtil.roleGroupWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.roleGroupTitle;
                }
                break;
        }
        // 必须要有，否则初始选中不起作用
        this.farrisLookUp.mapFields = { id: 'id', name: 'name' };
    };
    /** 清空后 */
    /**
     * 清空后
     * @param {?} arg
     * @return {?}
     */
    SysFarrisTreeHelpComponent.prototype.afterClear = /**
     * 清空后
     * @param {?} arg
     * @return {?}
     */
    function (arg) {
        this.clear.next(arg);
    };
    /** 手动显示帮助 */
    /**
     * 手动显示帮助
     * @return {?}
     */
    SysFarrisTreeHelpComponent.prototype.showHelp = /**
     * 手动显示帮助
     * @return {?}
     */
    function () {
        this.farrisLookUp.showDialog();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    SysFarrisTreeHelpComponent.prototype.search = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        console.log($event);
    };
    SysFarrisTreeHelpComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sys-farris-tree-help',
                    template: "<farris-lookup-grid #farristreelookup\r\n    [(ngModel)]=\"displayTxt\"\r\n    [bindingData]=\"bindingData\"\r\n    [title]=\"title\"\r\n    [remoteSearch]=\"true\"\r\n    [editable]=\"false\"\r\n    [disabled]=\"disabled\"\r\n    [displayType]=\"'TREELIST'\"\r\n    [singleSelect]=\"singleSelect\"\r\n    [enableToSelect]=\"enableToSelect\"\r\n    [uri]=\"dataUri\"\r\n    [columns] = \"columns\"\r\n    [idField]=\"'id'\"\r\n    [treeInfo]=\"treeInfo\"\r\n    [textField]= \"'name'\"\r\n    [valueField]=\"'id'\"\r\n    [mappingFn]= \"afterOk\"\r\n    [mapFields]=\"mapFields\"\r\n    [dictPicking]=\"beforeOpen\"\r\n    [dictPicked]=\"dictPicked\"\r\n    (clear)=\"afterClear($event)\"\r\n    (search)=\"search($event)\"\r\n></farris-lookup-grid>",
                    providers: [
                        { provide: ServerSideToken, useClass: SysFarrisLookupService }
                    ],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SysFarrisTreeHelpComponent.ctorParameters = function () { return [
        { type: SysCommonUtilService },
        { type: SysLocaleService },
        { type: SysHelpService }
    ]; };
    SysFarrisTreeHelpComponent.propDecorators = {
        disabled: [{ type: Input }],
        title: [{ type: Input }],
        async: [{ type: Input }],
        sourceType: [{ type: Input }],
        singleSelect: [{ type: Input }],
        displayTxt: [{ type: Input }],
        bindingData: [{ type: Input }],
        filter: [{ type: Input }],
        enableToSelect: [{ type: Input }],
        useBeforeCloseEvent: [{ type: Input }],
        beforeClose: [{ type: Input }],
        withPermission: [{ type: Input }],
        afterConfirm: [{ type: Output }],
        clear: [{ type: Output }],
        showAllPathOrg: [{ type: Input }],
        farrisLookUp: [{ type: ViewChild, args: ['farristreelookup',] }]
    };
    return SysFarrisTreeHelpComponent;
}());
export { SysFarrisTreeHelpComponent };
if (false) {
    /**
     * 是否只读
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.disabled;
    /**
     * 标题
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.title;
    /**
     * 是否分层加载组织
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.async;
    /**
     * 取数源
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.sourceType;
    /**
     * 是否单选
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.singleSelect;
    /**
     * 绑定到帮助上的数据，初始显示值用
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.displayTxt;
    /**
     * 存储帮助选择的对象
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.bindingData;
    /**
     * 过滤条件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.filter;
    /**
     * 打开帮助后是否有选中数据
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.enableToSelect;
    /**
     * 启用关闭前事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.useBeforeCloseEvent;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.beforeClose;
    /**
     * 是否开始数据权限过滤
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.withPermission;
    /**
     * 帮助选择后事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.afterConfirm;
    /**
     * 清空后事件-暂时不用
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.clear;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.showAllPathOrg;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.farrisLookUp;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.mapFields;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.dataUri;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.columns;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.treeInfo;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.allData;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.i18nRes;
    /**
     * 帮助前事件,强行传递过滤条件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.beforeOpen;
    /**
     * 帮助关闭前事件,目前无论是否都会继续走afterOk映射事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.dictPicked;
    /**
     * 帮助映射后事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.afterOk;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.sysUtil;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.localService;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.sysHelpService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzLWZhcnJpcy10cmVlLWhlbHAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zeXMvc3lzbWdyLXVpLyIsInNvdXJjZXMiOlsibGliL3N5cy1tYW5hZ2VyLXVpL3N5cy1mYXJyaXMtdHJlZS1oZWxwL3N5cy1mYXJyaXMtdHJlZS1oZWxwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxlQUFlLEVBQWdCLE1BQU0sbUJBQW1CLENBQUM7QUFDdkYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3BHLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxFQUFFLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFbkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXJDO0lBK0NJLG9DQUNXLE9BQTZCLEVBQzdCLFlBQThCLEVBQzlCLGNBQThCO1FBSHpDLGlCQUtDO1FBSlUsWUFBTyxHQUFQLE9BQU8sQ0FBc0I7UUFDN0IsaUJBQVksR0FBWixZQUFZLENBQWtCO1FBQzlCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjs7OztRQXhDaEMsYUFBUSxHQUFHLEtBQUssQ0FBQzs7OztRQUlqQixVQUFLLEdBQUcsS0FBSyxDQUFDOzs7O1FBSWQsaUJBQVksR0FBRyxJQUFJLENBQUM7Ozs7UUFVcEIsbUJBQWMsR0FBQyxJQUFJLENBQUM7Ozs7UUFFcEIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDOzs7O1FBRzVCLG1CQUFjLEdBQUcsS0FBSyxDQUFDOzs7O1FBRXRCLGlCQUFZLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7Ozs7UUFFMUQsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3BELG1CQUFjLEdBQVcsS0FBSyxDQUFDO1FBRXhDLGNBQVMsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDO1FBS2hDLFlBQU8sR0FBRyxFQUFFLENBQUM7Ozs7UUFvRXBCLGVBQVU7Ozs7UUFBRyxVQUFDLEdBQUc7OztnQkFFVCxrQkFBa0IsR0FBRyxFQUFFOztnQkFDdkIsWUFBWSxHQUFHLEVBQUU7O2dCQUNqQixJQUFJLEdBQUcsQ0FBQztZQUVaLElBQUcsS0FBSSxDQUFDLFdBQVcsSUFBRSxJQUFJLElBQUUsS0FBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLElBQUUsSUFBSSxJQUFFLEtBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFFLEVBQUUsRUFBQztnQkFDMUUsWUFBWSxHQUFHLEtBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzs7b0JBQzFDLGtCQUFnQixHQUFHLEtBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7Z0JBRXZELFlBQVksQ0FBQyxPQUFPOzs7O2dCQUFDLFVBQUEsSUFBSTtvQkFDckIsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFDLElBQUksRUFBQyxNQUFNLEVBQUMsa0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQyxDQUFDO29CQUNuRSxJQUFJLEdBQUcsSUFBSSxHQUFDLENBQUMsQ0FBQztnQkFFbEIsQ0FBQyxFQUFDLENBQUM7YUFDTjtZQUNELE9BQU8sRUFBRSxDQUFDO2dCQUNOLFVBQVUsRUFBRSxJQUFJO2dCQUNoQixJQUFJLEVBQUU7b0JBQ0YsTUFBTSxFQUFFLEtBQUksQ0FBQyxNQUFNO29CQUNuQixPQUFPLEVBQUUsS0FBSSxDQUFDLE9BQU87b0JBQ3JCLGtCQUFrQixFQUFDLGtCQUFrQjtpQkFDeEM7YUFDSixDQUFDLENBQUM7UUFDUCxDQUFDLEVBQUE7Ozs7UUFHRCxlQUFVOzs7O1FBQUcsVUFBQyxHQUFRO1lBQ2xCLElBQUksS0FBSSxDQUFDLG1CQUFtQixJQUFJLEtBQUksQ0FBQyxXQUFXLEVBQUU7Z0JBQzlDLE9BQU8sS0FBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRzs7OztnQkFBQyxVQUFBLEdBQUc7b0JBQ3JDLGNBQWM7b0JBQ2QsSUFBSSxHQUFHLENBQUMsV0FBVyxFQUFFO3dCQUNqQixLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDL0I7b0JBQ0QsT0FBTyxHQUFHLENBQUM7Z0JBQ2YsQ0FBQyxFQUFDLENBQUMsQ0FBQzthQUNQO2lCQUFNO2dCQUNILE9BQU8sRUFBRSxDQUFDLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7YUFDcEM7UUFDTCxDQUFDLEVBQUE7Ozs7UUFFRCxZQUFPOzs7OztRQUFHLFVBQUMsUUFBUSxFQUFFLFNBQVM7WUFDMUIsb0JBQW9CO1lBQ3BCLElBQUksS0FBSSxDQUFDLG1CQUFtQixFQUFFO2dCQUMxQixPQUFPO2FBQ1Y7WUFDRCxJQUFJLFFBQVEsRUFBRTtnQkFDVixvQkFBb0I7Z0JBQ3BCLElBQUksQ0FBQyxLQUFJLENBQUMsWUFBWSxFQUFFOzt3QkFDZCxNQUFNLEdBQWEsUUFBUSxDQUFDLEdBQUc7Ozs7b0JBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsRUFBRSxFQUFQLENBQU8sRUFBQzs7d0JBQ2hELFFBQVEsR0FBYSxRQUFRLENBQUMsR0FBRzs7OztvQkFBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxJQUFJLEVBQVQsQ0FBUyxFQUFDO29CQUMxRCxLQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQ3BDLEtBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDeEMsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztvQkFDeEMsS0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBRXBDO3FCQUFNO29CQUNILE9BQU87b0JBQ1AsS0FBSSxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO29CQUNoQyxJQUFHLEtBQUksQ0FBQyxjQUFjLEVBQUM7d0JBQ25CLEtBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVM7Ozs7d0JBQUMsVUFBQSxLQUFLOzRCQUN0RCxJQUFHLEtBQUssSUFBRSxLQUFLLENBQUMsTUFBTSxHQUFDLENBQUMsRUFBQztnQ0FDckIsUUFBUSxDQUFDLFVBQVUsR0FBQyxLQUFLLENBQUM7NkJBQzdCOzRCQUNELEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzRCQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUMxQixDQUFDLEVBQUMsQ0FBQztxQkFDTjt5QkFBSTt3QkFDRCxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztxQkFFcEM7aUJBQ0o7YUFDSjtpQkFBTSxFQUFDLGdCQUFnQjtnQkFDcEIsT0FBTztnQkFDUCxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUN6QjtRQUVMLENBQUMsRUFBQTtJQTNJRCxDQUFDOzs7O0lBRUQsNkNBQVE7OztJQUFSO1FBQ0ksSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ25CLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDNUQ7YUFBTTtZQUNILElBQUksQ0FBQyxPQUFPLEdBQUcsaUJBQWlCLENBQUM7U0FDcEM7UUFDRCxVQUFVO1FBQ1YsSUFBSSxDQUFDLFFBQVEsR0FBRztZQUNaLFlBQVksRUFBRSxLQUFLO1lBQ25CLFNBQVMsRUFBRSxVQUFVO1lBQ3JCLFNBQVMsRUFBRSxVQUFVO1lBQ3JCLFNBQVMsRUFBRSxNQUFNO1lBQ2pCLFVBQVUsRUFBRSxPQUFPO1lBQ25CLFdBQVcsRUFBRSxVQUFVO1lBQ3ZCLGFBQWEsRUFBRSxVQUFVO1lBQ3pCLGNBQWMsRUFBRSxLQUFLO1NBQ3hCLENBQUM7UUFDRixJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ1gsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFO1lBQ3JFLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRTtTQUN4RSxDQUFDO1FBQ0Ysa0JBQWtCO1FBQ2xCLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNaLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQztZQUNyQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7U0FDdkM7UUFDRCxXQUFXO1FBQ1gsUUFBUSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3JCLEtBQUssS0FBSztnQkFDTixJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztnQkFDdEQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7b0JBQ2IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztpQkFDMUM7Z0JBQ0QsTUFBTTtZQUNWLEtBQUssV0FBVztnQkFDWixJQUFJLENBQUMsT0FBTyxHQUFHLGFBQWEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQztnQkFDNUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7b0JBQ2IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQztpQkFDNUM7Z0JBQ0QsTUFBTTtZQUNWLEtBQUssZUFBZTtnQkFDaEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFZLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7Z0JBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO29CQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztpQkFDaEQ7Z0JBQ0QsTUFBTTtZQUNWLEtBQUssV0FBVyxDQUFDO1lBQ2pCO2dCQUNJLElBQUksQ0FBQyxPQUFPLEdBQUcsYUFBYSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDO2dCQUM1RCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtvQkFDYixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDO2lCQUM1QztnQkFDRCxNQUFNO1NBQ2I7UUFDRCxrQkFBa0I7UUFDbEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQztJQUM3RCxDQUFDO0lBbUZELFVBQVU7Ozs7OztJQUNWLCtDQUFVOzs7OztJQUFWLFVBQVcsR0FBUTtRQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxhQUFhOzs7OztJQUNOLDZDQUFROzs7O0lBQWY7UUFDSSxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ25DLENBQUM7Ozs7O0lBQ0QsMkNBQU07Ozs7SUFBTixVQUFPLE1BQU07UUFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hCLENBQUM7O2dCQTVNSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLHNCQUFzQjtvQkFDaEMseXZCQUFvRDtvQkFFcEQsU0FBUyxFQUFFO3dCQUNQLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUUsc0JBQXNCLEVBQUU7cUJBQ2pFOztpQkFDSjs7OztnQkFoQlEsb0JBQW9CO2dCQUlwQixnQkFBZ0I7Z0JBUmhCLGNBQWM7OzsyQkF1QmxCLEtBQUs7d0JBRUwsS0FBSzt3QkFFTCxLQUFLOzZCQUVMLEtBQUs7K0JBRUwsS0FBSzs2QkFFTCxLQUFLOzhCQUVMLEtBQUs7eUJBRUwsS0FBSztpQ0FJTCxLQUFLO3NDQUVMLEtBQUs7OEJBQ0wsS0FBSztpQ0FFTCxLQUFLOytCQUVMLE1BQU07d0JBRU4sTUFBTTtpQ0FDTixLQUFLOytCQUNMLFNBQVMsU0FBQyxrQkFBa0I7O0lBc0tqQyxpQ0FBQztDQUFBLEFBN01ELElBNk1DO1NBck1ZLDBCQUEwQjs7Ozs7O0lBRW5DLDhDQUEwQjs7Ozs7SUFFMUIsMkNBQXVCOzs7OztJQUV2QiwyQ0FBdUI7Ozs7O0lBRXZCLGdEQUF5RTs7Ozs7SUFFekUsa0RBQTZCOzs7OztJQUU3QixnREFBNEI7Ozs7O0lBRTVCLGlEQUFtRDs7Ozs7SUFFbkQsNENBQTRCOzs7OztJQUk1QixvREFBNkI7Ozs7O0lBRTdCLHlEQUFxQzs7SUFDckMsaURBQW9FOzs7OztJQUVwRSxvREFBZ0M7Ozs7O0lBRWhDLGtEQUFvRTs7Ozs7SUFFcEUsMkNBQTZEOztJQUM3RCxvREFBd0M7O0lBQ3hDLGtEQUF3RTs7SUFDeEUsK0NBQXVDOztJQUV2Qyw2Q0FBZ0I7O0lBQ2hCLDZDQUFhOztJQUNiLDhDQUFjOztJQUNkLDZDQUFvQjs7SUFDcEIsNkNBQW9COzs7OztJQW1FcEIsZ0RBd0JDOzs7OztJQUdELGdEQVlDOzs7OztJQUVELDZDQXFDQzs7SUEvSUcsNkNBQW9DOztJQUNwQyxrREFBcUM7O0lBQ3JDLG9EQUFxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZvckVhY2ggfSBmcm9tICdAYW5ndWxhci9yb3V0ZXIvc3JjL3V0aWxzL2NvbGxlY3Rpb24nO1xyXG5pbXBvcnQgeyBTeXNIZWxwU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZS9zeXMtaGVscC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyZWVGaWx0ZXIgfSBmcm9tICcuLi9maWx0ZXIvdHJlZS1maWx0ZXInO1xyXG5pbXBvcnQgeyBMb29rdXBHcmlkQ29tcG9uZW50LCBTZXJ2ZXJTaWRlVG9rZW4sIFBpY2tlZFJlc3VsdCB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgU3lzQ29tbW9uVXRpbFNlcnZpY2UgfSBmcm9tICdAZ3NwLXN5cy9zeXNtZ3ItY29tbW9uJztcclxuaW1wb3J0IHsgc3lzT3JnSGVscCwgcG9zR3JvdXBIZWxwLCByb2xlR3JvdXBIZWxwLCB1c2VyR3JvdXBIZWxwIH0gZnJvbSAnLi4vaGVscC1tZXRhL3N5cy1oZWxwLW1ldGEnO1xyXG5pbXBvcnQgeyBTeXNGYXJyaXNMb29rdXBTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9zeXMtZmFycmlzLWxvb2t1cC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgb2YsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU3lzTG9jYWxlU2VydmljZSB9IGZyb20gJy4uLy4uL2xvY2FsZS9zeXMtbG9jYWxlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMYW5ndWFnZVNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgSEVMUF9MT0NBTEVfWkhDSFMgfSBmcm9tICcuLi8uLi9sb2NhbGUvbG9jYWxlcy96aC1jbi9oZWxwJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3N5cy1mYXJyaXMtdHJlZS1oZWxwJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9zeXMtZmFycmlzLXRyZWUtaGVscC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9zeXMtZmFycmlzLXRyZWUtaGVscC5jb21wb25lbnQuY3NzJ10sXHJcbiAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICB7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IFN5c0ZhcnJpc0xvb2t1cFNlcnZpY2UgfVxyXG4gICAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgU3lzRmFycmlzVHJlZUhlbHBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLyoqIOaYr+WQpuWPquivuyAqL1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIC8qKiDmoIfpopggKi9cclxuICAgIEBJbnB1dCgpIHRpdGxlOiBzdHJpbmc7XHJcbiAgICAvKiog5piv5ZCm5YiG5bGC5Yqg6L2957uE57uHICovXHJcbiAgICBASW5wdXQoKSBhc3luYyA9IGZhbHNlO1xyXG4gICAgLyoqIOWPluaVsOa6kCAqL1xyXG4gICAgQElucHV0KCkgc291cmNlVHlwZTogJ29yZycgfCAndXNlcmdyb3VwJyB8ICdwb3NpdGlvbmdyb3VwJyB8ICdyb2xlZ3JvdXAnO1xyXG4gICAgLyoqIOaYr+WQpuWNlemAiSAqL1xyXG4gICAgQElucHV0KCkgc2luZ2xlU2VsZWN0ID0gdHJ1ZTtcclxuICAgIC8qKiDnu5HlrprliLDluK7liqnkuIrnmoTmlbDmja7vvIzliJ3lp4vmmL7npLrlgLznlKggKi9cclxuICAgIEBJbnB1dCgpIGRpc3BsYXlUeHQ6IHN0cmluZztcclxuICAgIC8qKiDlrZjlgqjluK7liqnpgInmi6nnmoTlr7nosaEgKi9cclxuICAgIEBJbnB1dCgpIGJpbmRpbmdEYXRhOiB7IGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZyB9O1xyXG4gICAgLyoqIOi/h+a7pOadoeS7tiAqL1xyXG4gICAgQElucHV0KCkgZmlsdGVyOiBUcmVlRmlsdGVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiDmiZPlvIDluK7liqnlkI7mmK/lkKbmnInpgInkuK3mlbDmja5cclxuICAgICAqL1xyXG4gICAgQElucHV0KCkgZW5hYmxlVG9TZWxlY3Q9dHJ1ZTtcclxuICAgIC8qKiDlkK/nlKjlhbPpl63liY3kuovku7YgKi9cclxuICAgIEBJbnB1dCgpIHVzZUJlZm9yZUNsb3NlRXZlbnQgPSBmYWxzZTtcclxuICAgIEBJbnB1dCgpIGJlZm9yZUNsb3NlOiAoc2VsZWN0RGF0YTogYW55KSA9PiBPYnNlcnZhYmxlPFBpY2tlZFJlc3VsdD47XHJcbiAgICAvKiog5piv5ZCm5byA5aeL5pWw5o2u5p2D6ZmQ6L+H5rukICovXHJcbiAgICBASW5wdXQoKSB3aXRoUGVybWlzc2lvbiA9IGZhbHNlO1xyXG4gICAgLyoqIOW4ruWKqemAieaLqeWQjuS6i+S7tiAqL1xyXG4gICAgQE91dHB1dCgpIGFmdGVyQ29uZmlybTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICAgIC8qKiDmuIXnqbrlkI7kuovku7Yt5pqC5pe25LiN55SoICovXHJcbiAgICBAT3V0cHV0KCkgY2xlYXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICBASW5wdXQoKSBzaG93QWxsUGF0aE9yZzpib29sZWFuID0gZmFsc2U7XHJcbiAgICBAVmlld0NoaWxkKCdmYXJyaXN0cmVlbG9va3VwJykgcHVibGljIGZhcnJpc0xvb2tVcDogTG9va3VwR3JpZENvbXBvbmVudDtcclxuICAgIG1hcEZpZWxkcyA9IHsgaWQ6ICdpZCcsIG5hbWU6ICduYW1lJyB9O1xyXG5cclxuICAgIGRhdGFVcmk6IHN0cmluZztcclxuICAgIGNvbHVtbnM6IGFueTtcclxuICAgIHRyZWVJbmZvOiBhbnk7XHJcbiAgICBwdWJsaWMgYWxsRGF0YSA9IFtdO1xyXG4gICAgcHVibGljIGkxOG5SZXM6IGFueTtcclxuICAgIGNvbnN0cnVjdG9yIChcclxuICAgICAgICBwdWJsaWMgc3lzVXRpbDogU3lzQ29tbW9uVXRpbFNlcnZpY2UsXHJcbiAgICAgICAgcHVibGljIGxvY2FsU2VydmljZTogU3lzTG9jYWxlU2VydmljZSxcclxuICAgICAgICBwdWJsaWMgc3lzSGVscFNlcnZpY2U6IFN5c0hlbHBTZXJ2aWNlLFxyXG4gICAgKSB7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmxvY2FsU2VydmljZSkge1xyXG4gICAgICAgICAgICB0aGlzLmkxOG5SZXMgPSB0aGlzLmxvY2FsU2VydmljZS5nZXRDb21wb25lbnRPcHQoJ2hlbHAnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmkxOG5SZXMgPSBIRUxQX0xPQ0FMRV9aSENIUztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6buY6K6k5LiN5YiG5bGC5Yqg6L29XHJcbiAgICAgICAgdGhpcy50cmVlSW5mbyA9IHtcclxuICAgICAgICAgICAgbG9hZERhdGFUeXBlOiAnYWxsJyxcclxuICAgICAgICAgICAgbGF5ZXJUeXBlOiAncGFyZW50SWQnLFxyXG4gICAgICAgICAgICBkYXRhRmllbGQ6ICd0cmVlSW5mbycsXHJcbiAgICAgICAgICAgIHBhdGhGaWVsZDogJ3BhdGgnLFxyXG4gICAgICAgICAgICBsYXllckZpZWxkOiAnbGF5ZXInLFxyXG4gICAgICAgICAgICBwYXJlbnRGaWVsZDogJ3BhcmVudElkJyxcclxuICAgICAgICAgICAgaXNEZXRhaWxGaWVsZDogJ2lzRGV0YWlsJyxcclxuICAgICAgICAgICAgdHJlZURhdGFJc0luaXQ6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgIHsgdGl0bGU6IHRoaXMuaTE4blJlcy5jb2RlRmllbGQsIGZpZWxkOiAnY29kZScsIHNlYXJjaEZpZWxkOiAnY29kZScgfSxcclxuICAgICAgICAgICAgeyB0aXRsZTogdGhpcy5pMThuUmVzLm5hbWVGaWVsZCwgZmllbGQ6ICduYW1lJywgc2VhcmNoRmllbGQ6ICduYW1lJyB9LFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgLy8g5byC5q2l5Yqg6L2955qE6K+d6ZyA6KaB5byA5ZCv6L+Z5Lik5Liq5byA5YWzXHJcbiAgICAgICAgaWYgKHRoaXMuYXN5bmMpIHtcclxuICAgICAgICAgICAgdGhpcy50cmVlSW5mby5sb2FkRGF0YVR5cGUgPSAnYXN5bmMnO1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVJbmZvLnRyZWVEYXRhSXNJbml0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gd2ViYXBp5Yid5aeLXHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnNvdXJjZVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnb3JnJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YVVyaSA9IHN5c09yZ0hlbHAgKyB0aGlzLnN5c1V0aWwuc3lzT3JnV2ViQXBpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMuaTE4blJlcy51c2VyT3JnVGl0bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndXNlcmdyb3VwJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YVVyaSA9IHVzZXJHcm91cEhlbHAgKyB0aGlzLnN5c1V0aWwudXNlckdyb3VwV2ViQXBpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMuaTE4blJlcy51c2VyR3JvdXBUaXRsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdwb3NpdGlvbmdyb3VwJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YVVyaSA9IHBvc0dyb3VwSGVscCArIHRoaXMuc3lzVXRpbC5wb3NHcm91cFdlYkFwaTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmkxOG5SZXMucG9zaXRpb25Hcm91cFRpdGxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3JvbGVncm91cCc6XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFVcmkgPSByb2xlR3JvdXBIZWxwICsgdGhpcy5zeXNVdGlsLnJvbGVHcm91cFdlYkFwaTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmkxOG5SZXMucm9sZUdyb3VwVGl0bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5b+F6aG76KaB5pyJ77yM5ZCm5YiZ5Yid5aeL6YCJ5Lit5LiN6LW35L2c55SoXHJcbiAgICAgICAgdGhpcy5mYXJyaXNMb29rVXAubWFwRmllbGRzID0geyBpZDogJ2lkJywgbmFtZTogJ25hbWUnIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOW4ruWKqeWJjeS6i+S7tizlvLrooYzkvKDpgJLov4fmu6TmnaHku7YgKi9cclxuICAgIGJlZm9yZU9wZW4gPSAoYXJnKSA9PiB7XHJcbiAgICAgICAgLy/lpoLmnpzmnInov4fmu6TmnaHku7bvvIzpmYTliqDliLB1cmzot6/lvoRcclxuICAgICAgICBsZXQgZmFycmlzU2VsZWN0ZWREYXRhID0gW107XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkRGF0YSA9IFtdO1xyXG4gICAgICAgIGxldCB0ZW1wID0gMDtcclxuXHJcbiAgICAgICAgaWYodGhpcy5iaW5kaW5nRGF0YSE9bnVsbCYmdGhpcy5iaW5kaW5nRGF0YS5pZCE9bnVsbCYmdGhpcy5iaW5kaW5nRGF0YS5pZCE9XCJcIil7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkRGF0YSA9IHRoaXMuYmluZGluZ0RhdGEuaWQuc3BsaXQoJywnKTtcclxuICAgICAgICAgICAgbGV0IHNlbGVjdGVkRGF0YU5hbWUgPSB0aGlzLmJpbmRpbmdEYXRhLm5hbWUuc3BsaXQoJywnKTtcclxuXHJcbiAgICAgICAgICAgIHNlbGVjdGVkRGF0YS5mb3JFYWNoKGl0ZW09PntcclxuICAgICAgICAgICAgICAgIGZhcnJpc1NlbGVjdGVkRGF0YS5wdXNoKHtcImlkXCI6aXRlbSxcIm5hbWVcIjpzZWxlY3RlZERhdGFOYW1lW3RlbXBdfSk7XHJcbiAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcCsxO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvZih7XHJcbiAgICAgICAgICAgIHNob3dEaWFsb2c6IHRydWUsXHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIGZpbHRlcjogdGhpcy5maWx0ZXIsXHJcbiAgICAgICAgICAgICAgICBhbGxEYXRhOiB0aGlzLmFsbERhdGEsXHJcbiAgICAgICAgICAgICAgICBmYXJyaXNTZWxlY3RlZERhdGE6ZmFycmlzU2VsZWN0ZWREYXRhXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5biu5Yqp5YWz6Zet5YmN5LqL5Lu2LOebruWJjeaXoOiuuuaYr+WQpumDveS8mue7p+e7rei1sGFmdGVyT2vmmKDlsITkuovku7YgKi9cclxuICAgIGRpY3RQaWNrZWQgPSAoYXJnOiBhbnkpOiBPYnNlcnZhYmxlPFBpY2tlZFJlc3VsdD4gPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnVzZUJlZm9yZUNsb3NlRXZlbnQgJiYgdGhpcy5iZWZvcmVDbG9zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5iZWZvcmVDbG9zZShhcmcpLnBpcGUobWFwKHZhbCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzog73lhbPpl63vvIzosIPnlKjlkI7kuovku7ZcclxuICAgICAgICAgICAgICAgIGlmICh2YWwuY2xvc2VEaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFmdGVyQ29uZmlybS5uZXh0KGFyZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHsgY2xvc2VEaWFsb2c6IHRydWUgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqIOW4ruWKqeaYoOWwhOWQjuS6i+S7tiAqL1xyXG4gICAgYWZ0ZXJPayA9IChoZWxwZGF0YSwgbWFwZmllbGRzKSA9PiB7XHJcbiAgICAgICAgLy8g5aaC5p6c5ZCv55So5LqG5YWz6Zet5YmN5qCh6aqM5LqL5Lu277yM5LiN6LWw6L+Z6YeMXHJcbiAgICAgICAgaWYgKHRoaXMudXNlQmVmb3JlQ2xvc2VFdmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChoZWxwZGF0YSkge1xyXG4gICAgICAgICAgICAvLyDlpJrpgInnmoTor53pnIDopoHlpITnkIYs5biu5Yqp5bey6YCX5Y+35Li66Ze06ZqUXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5zaW5nbGVTZWxlY3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkTGlzdDogc3RyaW5nW10gPSBoZWxwZGF0YS5tYXAoaXRlbSA9PiBpdGVtLmlkKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVMaXN0OiBzdHJpbmdbXSA9IGhlbHBkYXRhLm1hcChpdGVtID0+IGl0ZW0ubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLmlkID0gaWRMaXN0LmpvaW4oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmluZGluZ0RhdGEubmFtZSA9IG5hbWVMaXN0LmpvaW4oKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVR4dCA9IHRoaXMuYmluZGluZ0RhdGEubmFtZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWZ0ZXJDb25maXJtLm5leHQoaGVscGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIOW4ruWKqeaYvuekulxyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5VHh0ID0gaGVscGRhdGEubmFtZTtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2hvd0FsbFBhdGhPcmcpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3lzSGVscFNlcnZpY2UuZ2V0UGFyZW50T3JnKGhlbHBkYXRhKS5zdWJzY3JpYmUoaXRlbXM9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbXMmJml0ZW1zLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlbHBkYXRhLmFsbFBhdGhPcmc9aXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckNvbmZpcm0ubmV4dChoZWxwZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGhlbHBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWZ0ZXJDb25maXJtLm5leHQoaGVscGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7Ly8g55uu5YmN5riF56m65Lya6LWw6L+Z6YeM77yM6ICM5LiU5Lik5qyhXHJcbiAgICAgICAgICAgIC8vIOinpuWPkeS6i+S7tlxyXG4gICAgICAgICAgICB0aGlzLmFmdGVyQ29uZmlybS5uZXh0KGhlbHBkYXRhKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coaGVscGRhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOa4heepuuWQjiAqL1xyXG4gICAgYWZ0ZXJDbGVhcihhcmc6IGFueSkge1xyXG4gICAgICAgIHRoaXMuY2xlYXIubmV4dChhcmcpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmiYvliqjmmL7npLrluK7liqkgKi9cclxuICAgIHB1YmxpYyBzaG93SGVscCgpIHtcclxuICAgICAgICB0aGlzLmZhcnJpc0xvb2tVcC5zaG93RGlhbG9nKCk7XHJcbiAgICB9XHJcbiAgICBzZWFyY2goJGV2ZW50KXtcclxuICAgICAgICBjb25zb2xlLmxvZygkZXZlbnQpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
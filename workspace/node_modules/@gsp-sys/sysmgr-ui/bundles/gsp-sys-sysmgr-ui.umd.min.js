!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/ui-layout"),require("@progress/kendo-angular-treeview"),require("@progress/kendo-angular-grid"),require("@progress/kendo-angular-layout"),require("@angular/common"),require("@farris/ui-modal"),require("@farris/ui-messager"),require("@farris/ui-notify"),require("@farris/ui-treetable"),require("@angular/common/http"),require("@angular/forms"),require("@angular/core"),require("@farris/ui-lookup"),require("@gsp-sys/sysmgr-common"),require("rxjs"),require("rxjs/operators"),require("@farris/ui-datagrid"),require("@ecp-caf/caf-common"),require("ngx-cookie-service")):"function"==typeof define&&define.amd?define("@gsp-sys/sysmgr-ui",["exports","@farris/ui-layout","@progress/kendo-angular-treeview","@progress/kendo-angular-grid","@progress/kendo-angular-layout","@angular/common","@farris/ui-modal","@farris/ui-messager","@farris/ui-notify","@farris/ui-treetable","@angular/common/http","@angular/forms","@angular/core","@farris/ui-lookup","@gsp-sys/sysmgr-common","rxjs","rxjs/operators","@farris/ui-datagrid","@ecp-caf/caf-common","ngx-cookie-service"],t):t((e["gsp-sys"]=e["gsp-sys"]||{},e["gsp-sys"]["sysmgr-ui"]={}),e.uiLayout,e.kendoAngularTreeview,e.kendoAngularGrid,e.kendoAngularLayout,e.ng.common,e.uiModal,e.uiMessager,e.uiNotify,e.uiTreetable,e.ng.common.http,e.ng.forms,e.ng.core,e.uiLookup,e.i2,e.rxjs,e.rxjs.operators,e.uiDatagrid,e.cafCommon,e.ngxCookieService)}(this,function(e,t,i,r,n,s,a,o,l,c,d,p,u,h,f,y,g,m,b,v){"use strict";var S=function(){function e(){}return Object.defineProperty(e.prototype,"operationApi",{get:function(){return"/api/runtime/sys/v1.0/funcOperations"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bizObjectApi",{get:function(){return"/api/runtime/sys/v1.0/business-objects"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpHeader",{get:function(){return{headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},responseType:"json"}},enumerable:!0,configurable:!0}),e}(),C=function(){function e(e,t){this.sysUtil=e,this.rest=t}return e.prototype.getFuncOperations=function(){var e=this.sysUtil.operationApi+"/all";return this.rest.get(e,this.sysUtil.httpHeader)},e.decorators=[{type:u.Injectable}],e.ctorParameters=function(){return[{type:S},{type:d.HttpClient}]},e}(),D=function(){function e(e){this.funcOpService=e,this.onlyShowGroup=!1,this.afterConfirm=new u.EventEmitter,this.afterCancle=new u.EventEmitter,this.curSelectedKeys=[],this.title="功能操作帮助"}return e.prototype.ngOnInit=function(){},e.prototype.loadData=function(){var i=this;this.selectableSettings={checkboxOnly:!0,mode:this.gridSelectMode?this.gridSelectMode:"single",enabled:!0},this.funcOpService.getFuncOperations().subscribe(function(e){i.data=[];var t=e;i.onlyShowGroup?i.data=t.filter(function(e){return 0==e.type}):i.data=t,i.gridData=[],i.gridData=i.data.concat()},function(e){console.log("获取功能操作对象列表失败")})},e.prototype.searchData=function(e){var t=this;if(null!==e&&""!==e){var i=e.toLowerCase();this.gridData=this.data.filter(function(e){return e.code.toLowerCase().includes(i)||e.name.toLowerCase().includes(i)||t.getFuncGroup(e).toLowerCase().includes(i)})}else this.gridData=this.data.concat()},e.prototype.bizObjectChanged=function(e){if(this.data&&0!==this.data.length){var t=e;this.gridData=this.data.filter(function(e){return e.businessId===t})}},e.prototype.getFuncGroup=function(e){var t=e.parentId;if(null===t||t===undefined||""===t)return"无";var i=this.data.filter(function(e){return e.id===t});return null!==i&&0<i.length?i[0].name:void 0},e.prototype.getSelectedObject=function(){var e=this;return this.data.filter(function(t){return 0<=e.curSelectedKeys.findIndex(function(e){return e===t.id})})},e.prototype.confirm=function(){var e=this.getSelectedObject();this.afterConfirm.next(e),this.cancle()},e.prototype.cancle=function(){this.afterCancle.next()},e.decorators=[{type:u.Component,args:[{selector:"app-sys-func-operation",template:'<div class="d-flex flex-row" style="\r\nwidth: 800px; \r\nborder:2px;\r\nposition:absolute;\r\ntop:0px;\r\nbottom: 0px;\r\nright:0px;\r\nleft:0px;\r\noverflow: hidden;\r\nheight: 100%;">\r\n  <div class="flex-fill">\r\n    <kendo-splitter style="height:100%" orientation="horizontal">\r\n      <kendo-splitter-pane size="40%" min="20%" max="50%">\r\n        <div class="d-flex flex-column flex-fill" style="height:100%">\r\n          <div class="p-2" style="height: 35px;">\r\n            <h5>业务对象</h5>\r\n            <hr class="m-0 p-0" />\r\n          </div>\r\n          <div class="flex-fill" style="overflow: auto;">\r\n            <app-biz-object [bizObjectId]="bizObjectId" (bizObjectChanged)="bizObjectChanged($event)"></app-biz-object>\r\n          </div>\r\n        </div>\r\n      </kendo-splitter-pane>\r\n      <kendo-splitter-pane>\r\n        <div class="d-flex flex-column flex-fill" style="height:100%">\r\n          <div class="p-2" style="height: 35px;">\r\n            <h5>功能操作</h5>\r\n            <hr class="m-0 p-0" />\r\n          </div>\r\n          <div class="clearfix mt-1 mb-1 ml-1">\r\n            <input #filter placeholder="输入编号或名称查找" type="text" />\r\n            <button class="btn btn-sm btn-default" (click)="searchData(filter.value)">查找</button>\r\n          </div>\r\n          <div class="d-flex flex-fill" style="position:relative;">\r\n            <kendo-grid [class]="\'flex-fill\'" [selectable]="selectableSettings" [kendoGridBinding]="gridData"\r\n              [kendoGridSelectBy]="\'id\'" [selectedKeys]="curSelectedKeys">\r\n              <kendo-grid-checkbox-column width="40"></kendo-grid-checkbox-column>\r\n              <kendo-grid-column field="code" title="编号"></kendo-grid-column>\r\n              <kendo-grid-column field="name" title="名称"></kendo-grid-column>\r\n              <kendo-grid-column *ngIf="!onlyShowGroup" title="功能分组">\r\n                <ng-template kendoGridCellTemplate let-dataItem>\r\n                  {{getFuncGroup(dataItem)}}\r\n                </ng-template>\r\n              </kendo-grid-column>\r\n            </kendo-grid>\r\n          </div>\r\n        </div>\r\n      </kendo-splitter-pane>\r\n    </kendo-splitter>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #btnOkAndCancle>\r\n  <button class="btn btn-sm btn-primary" (click)="confirm()">确认</button>\r\n  <button class="btn btn-sm btn-default" (click)="cancle()">取消</button>\r\n</ng-template>\r\n',styles:[""]}]}],e.ctorParameters=function(){return[{type:C}]},e.propDecorators={bizObjectId:[{type:u.Input}],gridSelectMode:[{type:u.Input}],sessionId:[{type:u.Input}],onlyShowGroup:[{type:u.Input}],isGroupCanSelected:[{type:u.Input}],afterConfirm:[{type:u.Output}],afterCancle:[{type:u.Output}],btnOkAndCancleRef:[{type:u.ViewChild,args:["btnOkAndCancle"]}]},e}(),I=function(){function e(e,t){this.rest=e,this.sysUtil=t}return e.prototype.getBizObjects=function(){var e=this.sysUtil.bizObjectApi;return this.rest.get(e,this.sysUtil.httpHeader)},e.decorators=[{type:u.Injectable}],e.ctorParameters=function(){return[{type:d.HttpClient},{type:S}]},e}(),T={rootNodeCode:"ALL",rootNodeTitle:"所有",codeField:"编号",nameField:"名称",allColumnsTitle:"所有列",searchNullData:"没有要查找的数据！"},O={userTitle:"用户",positionTitle:"岗位",roleTitle:"功能组",userOrgTitle:"组织",userGroupTitle:"用户分组",positionGroupTitle:"岗位分组",roleGroupTitle:"功能组分组",codeField:"编号",nameField:"名称",orderField:"排序号",orgName:"隶属组织",orgNamePathField:"隶属单位",operationTitle:"功能操作",busTitle:"业务对象",opGroupField:"功能分组"},w={navi:T,help:O},x={"zh-CHS":w,"zh-cn":w,en:{navi:{rootNodeCode:"ALL",rootNodeTitle:"all data",codeField:"Code",nameField:"Name",allColumnsTitle:"All columns",searchNullData:"No data to find!"},help:{userTitle:"Users",positionTitle:"Positions",roleTitle:"Roles",userOrgTitle:"Organizations",userGroupTitle:"User Groups",positionGroupTitle:"Position Groups",roleGroupTitle:"Role Groups",codeField:"Code",nameField:"Name",orderField:"Order",orgName:"Org Info",orgNamePathField:"Company Info",operationTitle:"Function Operation",busTitle:"Business Object",opGroupField:"Operation Group"}},"zh-CHT":{navi:{rootNodeCode:"ALL",rootNodeTitle:"所有",codeField:"編號",nameField:"名稱",allColumnsTitle:"所有列",searchNullData:"沒有要查找的數據！"},help:{userTitle:"用戶",positionTitle:"崗位",roleTitle:"功能組",userOrgTitle:"組織",userGroupTitle:"用戶分組",positionGroupTitle:"崗位分組",roleGroupTitle:"功能組分組",codeField:"編號",nameField:"名稱",orderField:"排序號",orgName:"隸屬組織",orgNamePathField:"隸屬單位",operationTitle:"功能操作",busTitle:"業務對象",opGroupField:"功能分組"}}},k=function(){function e(e){var t="zh-CHS";(this.lang=e)&&(t=e.getLanguageCode()),this.langData=x[t],this.langData||(this.langData=x["zh-CHS"]),console.log(t),console.log(this.langData)}return e.prototype.getComponentOpt=function(e){return this.langData[e]},e.decorators=[{type:u.Injectable}],e.ctorParameters=function(){return[{type:b.LanguageService}]},e}(),F=function(){function e(e,t,i){var r=this;this.funcOpService=e,this.bizObjectService=t,this.localService=i,this.multiSelect=!1,this.onlyShowGroup=!1,this.afterConfirm=new u.EventEmitter,this.afterCancle=new u.EventEmitter,this.curSelected=[],this.curSelectedKeys=[],this.gridColumns=[],this.opSearchTxt=null,this.funcGroupFormatter=function(e,t){return r.getFuncGroup(t)}}return e.prototype.winResize=function(){this.reSizeTreeTable()},e.prototype.reSizeTreeTable=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),0===e&&(e=this.farrisTreeParent.nativeElement.clientHeight),0===t&&(t=this.farrisTreeParent.nativeElement.clientWidth),this.farrisTt.resize({height:e,width:t})},e.prototype.ngOnInit=function(){this.operationGrid.restService=null,this.operationGrid.virtualized=!0,this.operationGrid.fitColumns=!0,this.operationGrid.fit=!0,this.localService?this.i18nRes=this.localService.getComponentOpt("help"):this.i18nRes=O,this.onlyShowGroup?this.gridColumns=[{field:"code",title:this.i18nRes.codeField,width:120},{field:"name",title:this.i18nRes.nameField,width:150}]:this.gridColumns=[{field:"code",title:this.i18nRes.codeField,width:120},{field:"name",title:this.i18nRes.nameField,width:150},{field:"parentId",title:this.i18nRes.opGroupField,formatter:this.funcGroupFormatter}],this.treeColumns=[{field:"name",title:this.i18nRes.busTitle,width:100}],"multiple"===this.gridSelectMode&&(this.multiSelect=!0),this.loadData()},e.prototype.ngAfterContentInit=function(){this.reSizeTreeTable()},e.prototype.loadData=function(){var t=this;this.bizObjectService.getBizObjects().subscribe(function(e){t.treeDataSrc=e,t.treeData=t.makeTree(e)}),this.funcOpService.getFuncOperations().subscribe(function(e){t.onlyShowGroup?t.gridDataSrc=e.filter(function(e){return 0==e.type}):t.gridDataSrc=e,t.freshGridAndSelect(t.gridDataSrc.concat())},function(e){console.log("获取功能操作对象列表失败")})},e.prototype.freshGridAndSelect=function(e){var t=this;this.operationGrid.clearAll(),this.operationGrid.loadData(e),e.forEach(function(e){-1<t.curSelectedKeys.indexOf(e.id)&&(t.operationGrid.checkRow(e.id,!1),-1===t.curSelected.indexOf(e)&&t.curSelected.push(e))})},e.prototype.makeTree=function(t){var i=this,e=t.filter(function(e){return 1===e.layer}).map(function(e){return{data:e,children:[],expanded:!1,selectable:!0}});return e.forEach(function(e){e.children=i.makeChildrenByParentId(t,e.data.id)}),e[0].expanded=!0,e},e.prototype.makeChildrenByParentId=function(t,i){var r=this;return t.filter(function(e){return e.parentID===i}).map(function(e){return{data:e,children:r.makeChildrenByParentId(t,e.id),expanded:!1,selectable:!0}})},e.prototype.onKeyUp=function(e){e&&13===e.which&&this.searchData()},e.prototype.searchData=function(){var t=this;if(!this.opSearchTxt)return this.gridData=this.gridDataSrc,void this.freshGridAndSelect(this.gridData);var e=this.opSearchTxt.trim();if(!e)return this.gridData=this.gridDataSrc,void this.freshGridAndSelect(this.gridData);var i=e.toLowerCase();this.onlyShowGroup?this.gridData=this.gridDataSrc.filter(function(e){return e.code.toLowerCase().includes(i)||e.name.toLowerCase().includes(i)}):this.gridData=this.gridDataSrc.filter(function(e){return e.code.toLowerCase().includes(i)||e.name.toLowerCase().includes(i)||t.getFuncGroup(e).toLowerCase().includes(i)}),this.freshGridAndSelect(this.gridData)},e.prototype.getFuncGroup=function(e){var t=e.parentId;if(!t)return"";var i=this.gridDataSrc.filter(function(e){return e.id===t});return null!==i&&0<i.length?i[0].name:void 0},e.prototype.bizObjectChanged=function(e){if(this.gridDataSrc&&0!==this.gridDataSrc.length){var t=e.node.data.id,i=this.gridDataSrc.filter(function(e){return e.businessId===t});this.freshGridAndSelect(i)}},e.prototype.getSelectedObject=function(){return this.operationGrid.checkeds.map(function(e){return e.data})},e.prototype.checked=function(e){console.log(e),e&&e.id&&(this.multiSelect?this.curSelectedKeys.indexOf(e.id)<0&&(this.curSelected.push(e.data),this.curSelectedKeys.push(e.id)):(this.curSelected=[e.data],this.curSelectedKeys=[e.id]))},e.prototype.unchecked=function(t){if(console.log(t),t&&t.id)if(this.multiSelect){var e=this.curSelectedKeys.findIndex(function(e){return e===t.id});0<=e&&(this.curSelectedKeys.splice(e,1),this.curSelected.splice(e,1))}else this.curSelectedKeys=[],this.curSelected=[]},e.prototype.confirm=function(){var e=this.curSelected;console.log(e),this.afterConfirm.next(e),this.cancle()},e.prototype.cancle=function(){this.afterCancle.next()},e.decorators=[{type:u.Component,args:[{selector:"app-sys-farris-func-operation",template:'<div class="f-utils-absolute-all farris-split-section m-0">\r\n    <layout [direction]="\'h\'" [fill]="true" [showBorder]="false">\r\n        <layout-panel class="col-5 d-flex flex-column" region="west" [showBorder]="false" [minWidth]="300">\r\n            <div class="f-utils-absolute-all f-utils-flex-column farris-lsection" style="background-color: white">\r\n                <div #farrisTreeParent class="f-utils-fill-flex-column" style="background-color: white">   \r\n                    <farris-treetable #tt [data]="treeData" [virtualized]="true" [fit]="true" [findField]="\'name\'"\r\n                        [enableFindText]="true" [showBorder]="true" [columns]="treeColumns" [idField]="\'id\'"\r\n                        [fixedHeader]="true" [showHeader]="true" [remoteSort]="false"\r\n                        (nodeSelected)="bizObjectChanged($event)">\r\n                    </farris-treetable>\r\n                </div>\r\n            </div>\r\n        </layout-panel>\r\n        <layout-panel class="d-flex flex-column" region="center" [showBorder]="false" [minWidth]="300">\r\n            <div class="f-utils-absolute-all f-utils-flex-column farris-rsection">\r\n                <form class="farris­-form mb-2" style="width:300px;">\r\n                    <div class="f-cmp-inputgroup">\r\n                        <div class="input-group"><input [(ngModel)]="opSearchTxt"\r\n                                [ngModelOptions]="{standalone: true}" class="form-control" (keyup)="onKeyUp($event)"\r\n                                placeholder="\'编号或者名称\'">\r\n                            <div class="input-group-append"><span class="input-group-text"\r\n                                    (click)="searchData()">\r\n                                    <i class="k-icon k-i-search"></i></span></div>\r\n                        </div>\r\n                    </div>\r\n                </form>\r\n                \x3c!--列表信息--\x3e\r\n                <div class="f-utils-fill-flex-column">\r\n                    <farris-datagrid #operationGrid \r\n                    [columns]="gridColumns" \r\n                    [showBorder]="true"\r\n                    [virtualized]="true"\r\n                    [fitColumns]="true"\r\n                    [fit]="true"\r\n                    [striped]="true"\r\n                    [pagination]="false"\r\n                    [showCheckbox]="true"\r\n                    [selectOnCheck]="true"\r\n                    [checkOnSelect]="true"\r\n                    [multiSelect]="multiSelect"\r\n                    (checked)="checked($event)"\r\n                    (unChecked)="unchecked($event)">\r\n                </farris-datagrid>\r\n                </div>\r\n            </div>\r\n        </layout-panel>\r\n    </layout>\r\n</div>\r\n<ng-template #btnOkAndCancle>\r\n    <button class="btn btn-sm btn-primary" (click)="confirm()">确定</button>\r\n    <button class="btn btn-sm btn-secondary" (click)="cancle()">取消</button>\r\n</ng-template>',styles:[""]}]}],e.ctorParameters=function(){return[{type:C},{type:I},{type:k}]},e.propDecorators={bizObjectId:[{type:u.Input}],gridSelectMode:[{type:u.Input}],sessionId:[{type:u.Input}],onlyShowGroup:[{type:u.Input}],isGroupCanSelected:[{type:u.Input}],afterConfirm:[{type:u.Output}],afterCancle:[{type:u.Output}],btnOkAndCancleRef:[{type:u.ViewChild,args:["btnOkAndCancle"]}],operationGrid:[{type:u.ViewChild,args:["operationGrid"]}],farrisTreeParent:[{type:u.ViewChild,args:["farrisTreeParent"]}],farrisTt:[{type:u.ViewChild,args:["tt"]}],winResize:[{type:u.HostListener,args:["window:resize",[]]}]},e}(),U=function(){function e(e,t,i,r,n){this.modalService=e,this.injector=t,this.cfr=i,this.sysUtil=r,this.localService=n,this.useNewUI=!1,this.initSelectKeys=[],this.onlyShowGroup=!1,this.afterHelpConfirm=new u.EventEmitter,this.localService?this.i18nRes=this.localService.getComponentOpt("help"):this.i18nRes=O}return e.prototype.ngOnInit=function(){},e.prototype.showNewHelp=function(e){var t=this;this.sysUtil.sessionId=e;var i=this.cfr.resolveComponentFactory(F).create(this.injector);null!=this.initSelectKeys&&0<this.initSelectKeys.length&&this.initSelectKeys.forEach(function(e){return i.instance.curSelectedKeys.push(e)}),this.bizObjectId&&""!==this.bizObjectId&&(i.instance.bizObjectId=this.bizObjectId),this.gridSelectMode&&(i.instance.gridSelectMode=this.gridSelectMode),i.instance.onlyShowGroup=this.onlyShowGroup,i.instance.isGroupCanSelected=this.isGroupCanSelected;var r={title:this.i18nRes.operationTitle,width:850,height:550,buttons:i.instance.btnOkAndCancleRef,showButtons:!0,showMaxButton:!0,resizable:!0};this.funcOpDialog=this.modalService.show(i,r),i.instance.afterCancle.subscribe(function(e){t.funcOpDialog.close()}),i.instance.afterConfirm.subscribe(function(e){t.afterHelpConfirm.next(e)})},e.prototype.showHelp=function(e){var t=this;if(this.useNewUI)this.showNewHelp(e);else{this.sysUtil.sessionId=e;var i=this.cfr.resolveComponentFactory(D);this.funcOpComp=i.create(this.injector),null!=this.initSelectKeys&&0<this.initSelectKeys.length&&this.initSelectKeys.forEach(function(e){return t.funcOpComp.instance.curSelectedKeys.push(e)}),this.bizObjectId&&""!==this.bizObjectId&&(this.funcOpComp.instance.bizObjectId=this.bizObjectId),this.gridSelectMode&&(this.funcOpComp.instance.gridSelectMode=this.gridSelectMode),this.funcOpComp.instance.onlyShowGroup=this.onlyShowGroup,this.funcOpComp.instance.isGroupCanSelected=this.isGroupCanSelected,this.funcOpComp.instance.loadData();var r={title:"功能操作帮助",width:800,height:550,buttons:this.funcOpComp.instance.btnOkAndCancleRef,showButtons:!0,showMaxButton:!1,resizable:!1};this.funcOpDialog=this.modalService.show(this.funcOpComp,r),this.funcOpComp.instance.afterCancle.subscribe(function(e){t.funcOpDialog.close()}),this.funcOpComp.instance.afterConfirm.subscribe(function(e){t.afterHelpConfirm.next(e)})}},e.decorators=[{type:u.Component,args:[{selector:"app-sys-func-op-help",template:"",styles:[""]}]}],e.ctorParameters=function(){return[{type:a.BsModalService},{type:u.Injector},{type:u.ComponentFactoryResolver},{type:S},{type:k}]},e.propDecorators={bizObjectId:[{type:u.Input}],useNewUI:[{type:u.Input}],initSelectKeys:[{type:u.Input}],onlyShowGroup:[{type:u.Input}],gridSelectMode:[{type:u.Input}],isGroupCanSelected:[{type:u.Input}],afterHelpConfirm:[{type:u.Output}]},e}(),G=function(){function e(e){this.bizObjectService=e,this.selectKeys=[],this.bizObjectChanged=new u.EventEmitter,this.expandedKeys=[]}return e.prototype.ngOnInit=function(){var i=this;this.bizObjectService.getBizObjects().subscribe(function(e){if(e.forEach(function(e){e.parentID||(e.parentID=undefined,1===e.layer&&i.expandedKeys.push(e.id))}),i.data=e,i.bizObjectId&&""!==i.bizObjectId){for(var t=i.bizObjectId;t;)i.expandedKeys.push(t),t=i.data.find(function(e){return e.id===t}).parentID;i.selectKeys=[i.bizObjectId],setTimeout(function(){i.bizObjectChanged.emit(i.bizObjectId)},80)}})},e.prototype.selectChange=function(e){var t=e.dataItem.id;null==this.selectKeys||0===this.selectKeys.length?this.bizObjectChanged.emit(t):this.selectKeys[0]!==t&&this.bizObjectChanged.emit(t)},e.decorators=[{type:u.Component,args:[{selector:"app-biz-object",template:'<div class="d-flex flex-column flex-fill pt-2 pb-2" style="height: 100%">\r\n    <kendo-treeview [nodes]="data" textField="name" kendoTreeViewExpandable kendoTreeViewFlatDataBinding idField="id"\r\n      parentIdField="parentID" kendoTreeViewSelectable [selectBy]="\'id\'" [(selectedKeys)]="this.selectKeys"\r\n      [(expandedKeys)]="expandedKeys"\r\n      [expandBy]="\'id\'"\r\n      (selectionChange)="selectChange($event)">\r\n    </kendo-treeview>\r\n</div>',styles:[""]}]}],e.ctorParameters=function(){return[{type:I}]},e.propDecorators={bizObjectId:[{type:u.Input}],bizObjectChanged:[{type:u.Output}]},e}(),R=function(){function e(){}return e.decorators=[{type:u.NgModule,args:[{imports:[s.CommonModule,d.HttpClientModule,p.FormsModule,p.ReactiveFormsModule,m.DatagridModule,c.TreeTableModule,t.LayoutModule,i.TreeViewModule,n.LayoutModule,t.LayoutModule,r.GridModule,a.ModalModule.forRoot(),o.MessagerModule.forRoot()],declarations:[D,U,G,F],providers:[S,k,C,I],entryComponents:[D,F],exports:[D,U,G,F]}]}],e}(),N=function(){function e(e,t){this.http=e,this.sysUtil=t}return e.prototype.getHttpOption=function(e){f.SysDataUtil.deleteEmpty(e);var t=JSON.stringify(e);return{headers:this.sysUtil.getHeader().headers,params:{param:t}}},e.prototype.getUsers=function(e){var t=this.getHttpOption(e);return this.http.get(this.sysUtil.userWebApi,t).pipe(g.map(function(e){return e.data}))},e.prototype.getPositions=function(e){var t=this.getHttpOption(e);return this.http.get(this.sysUtil.positionWebApi,t).pipe(g.map(function(e){return e.data}))},e.prototype.getRoles=function(e){var t=this.getHttpOption(e);return this.http.get(this.sysUtil.roleWebApi,t).pipe(g.map(function(e){return e.data}))},e.prototype.getOrgs=function(e){var t=this.getHttpOption(e);return t.params.useView=!0,this.handerTreeData(this.http.get(this.sysUtil.sysOrgWebApi+"/all",t))},e.prototype.getUserGroups=function(e){var t=this.getHttpOption(e);return this.handerTreeData(this.http.get(this.sysUtil.userGroupWebApi+"/all",t))},e.prototype.getPositionGroups=function(e){var t=this.getHttpOption(e);return this.handerTreeData(this.http.get(this.sysUtil.posGroupWebApi+"/all",t))},e.prototype.getRoleGroups=function(e){var t=this.getHttpOption(e);return this.handerTreeData(this.http.get(this.sysUtil.roleGroupWebApi+"/all",t))},e.prototype.convert2Json=function(e){var t={id:e.id,code:e.code,name:e.name,parentId:e.parentId||"",path:e.path,layer:e.layer,isDetail:e.isDetail};return null!=e.nodeType&&e.nodeType!==undefined&&(t.nodeType=e.nodeType),t},e.prototype.getParentOrg=function(e){var t=JSON.stringify(this.convert2Json(e)),i={headers:this.sysUtil.getHeader().headers,params:{param:t}};return this.http.get(this.sysUtil.sysOrgWebApi+"/getparentorg/0002",i).pipe(g.map(function(e){return e}))},e.prototype.handerTreeData=function(e){return e.pipe(g.map(function(e){return y.from(e).subscribe(function(e){1!=e.layer&&null!=e.parentId&&""!==e.parentId||(e.parentId=undefined)}),e}))},e.decorators=[{type:u.Injectable}],e.ctorParameters=function(){return[{type:d.HttpClient},{type:f.SysCommonUtilService}]},e}(),P=function(){function e(){}return e.prototype.getErrorInfo=function(e){return e.Message},e.decorators=[{type:u.Injectable}],e}(),z=function(){function e(e,t){this.http=e,this.sysUtil=t}return e.prototype.getUrlByGroupType=function(e){var t="";switch(e){case"user":t=this.sysUtil.userGroupWebApi;break;case"position":t=this.sysUtil.posGroupWebApi;break;case"role":t=this.sysUtil.roleGroupWebApi;break;case"org":t=this.sysUtil.sysOrgWebApi;break;default:t=this.sysUtil.userGroupWebApi}return t},e.prototype.getByLayer=function(e,t,i){var r=this.getUrlByGroupType(t);i||(i={}),i.layer=e,i.parentId=null,f.SysDataUtil.deleteEmpty(i);var n={headers:this.sysUtil.getHeader().headers,params:{param:JSON.stringify(i)}};return this.http.get(r,n)},e.prototype.getByParentId=function(e,t,i){var r=this.getUrlByGroupType(t);i||(i={}),i.layer=null,i.parentId=e,f.SysDataUtil.deleteEmpty(i);var n={headers:this.sysUtil.getHeader().headers,params:{param:JSON.stringify(i)}};return this.http.get(r,n)},e.prototype.searchData=function(e,t){var i=this.getUrlByGroupType(e);t||(t={}),t.layer=null,t.parentId=null,f.SysDataUtil.deleteEmpty(t);var r={headers:this.sysUtil.getHeader().headers,params:{param:JSON.stringify(t)}};return this.http.get(i,r)},e.decorators=[{type:u.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:d.HttpClient},{type:f.SysCommonUtilService}]},e.ngInjectableDef=u.defineInjectable({factory:function(){return new e(u.inject(d.HttpClient),u.inject(f.SysCommonUtilService))},token:e,providedIn:"root"}),e}(),j=function(){function e(e,t,i,r){this.groupService=e,this.localService=t,this.notifyService=i,this.msg=r,this.showHeader=!0,this.fixedHeader=!0,this.withCodeColumn=!0,this.allRoot=!1,this.selectKeys=[],this.needRemote=!0,this.showNodeTypeColumn=!1,this.showFilterBar=!1,this.searchFields=[{label:"编号",value:"code"},{label:"名称",value:"name"}],this.allColumnsTitle="所有列",this.search=new u.EventEmitter,this.selectRowChanged=new u.EventEmitter,this.searchInfo="",this.oldSearchInfo="",this.field="",this.oldField="",this.searchResult=[],this.searchIndex=0,this.temp=!0}return e.prototype.winResize=function(){this.reSizeTreeTable()},e.prototype.reSizeTreeTable=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),0===e&&(e=this.farrisTreeParent.nativeElement.clientHeight),0===t&&(t=this.farrisTreeParent.nativeElement.clientWidth),this.farrisTt.resize({height:e,width:t})},e.prototype.ngOnInit=function(){var r=this;if(this.localService?this.i18nRes=this.localService.getComponentOpt("navi"):this.i18nRes=T,this.searchFields=[{label:this.i18nRes.codeField,value:"code"},{label:this.i18nRes.nameField,value:"name"}],this.allColumnsTitle=this.i18nRes.allColumnsTitle,this.withCodeColumn?(this.fixedHeader=!0,this.showHeader=!0,this.cols=[{field:"code",title:this.i18nRes.codeField,width:100},{field:"name",title:this.i18nRes.nameField,width:100}]):(this.fixedHeader=!1,this.showHeader=!1,this.cols=[{field:"name",title:this.i18nRes.nameField,width:100}]),this.needRemote){if(this.allRoot){this.treeData=[];var e={children:[]};e.data={id:"all",code:this.i18nRes.rootNodeCode,name:this.i18nRes.rootNodeTitle},e.expanded=!0,e.leaf=!1,e.selectable=!0,this.treeData.push(e)}else this.treeData=[];this.groupService.getByLayer(1,this.groupType,this.filter).subscribe(function(e){r.initTreeNodeList(e)})}else this.farrisTt.updateSerializedValue();this.farrisTt.expand.pipe(g.filter(function(e){return 0===e.children.length})).subscribe(function(i){i.showLoading=!0;var e=i.data.id;r.groupService.getByParentId(e,r.groupType,r.filter).subscribe(function(e){i.showLoading=!1;var t=[];y.from(e).subscribe(function(e){t.push(r.convertToTreeNode(e))}),0<t.length?r.farrisTt.appendChildren(t,i):(i.leaf=!0,r.farrisTt.updateSerializedValue())})})},e.prototype.refreshThisNav=function(){var t=this;this.treeData=[];var e={children:[]};e.data={id:"all",code:this.i18nRes.rootNodeCode,name:this.i18nRes.rootNodeTitle},e.expanded=!0,e.leaf=!1,e.selectable=!0,this.treeData.push(e),this.groupService.getByLayer(1,this.groupType,this.filter).subscribe(function(e){t.initTreeNodeList(e)})},e.prototype.ngAfterContentInit=function(){this.reSizeTreeTable()},e.prototype.searchData=function(e){var t=this;this.search.next(e),this.filter||(this.filter={}),e&&(this.searchInfo=e.value,this.field=e.field,!this.searchInfo||this.searchInfo.length<=0?this.clearSearchValue():(this.oldSearchInfo!==this.searchInfo||this.oldField!==this.field?(this.filter.isSearchTree=!0,"*"===this.field?(this.filter.codeOrName=this.searchInfo,this.filter.code="",this.filter.name=""):"code"===this.field?(this.filter.code=this.searchInfo,this.filter.name="",this.filter.codeOrName=""):"name"===this.field&&(this.filter.name=this.searchInfo,this.filter.code="",this.filter.codeOrName=""),this.groupService.searchData(this.groupType,this.filter).subscribe(function(e){t.treeData=[],t.searchResult=[],t.searchIndex=0,e&&0<e.length?(t.treeData=t.makeTree(e),e.forEach(function(e){e.search_data&&t.searchResult.push(e.id)}),t.farrisTt.updateSerializedValue(),setTimeout(function(){t.farrisTt.selectNode(t.searchResult[0]),t.farrisTt.collapseAll(),t.expandParent(t.searchResult[0]),t.farrisTt.scrollToCurrentNode()})):(t.farrisTt.updateSerializedValue(),t.notifyService.info(t.i18nRes.searchNullData))})):this.searchResult&&0<this.searchResult.length?(this.searchIndex=this.searchIndex+1,this.searchIndex===this.searchResult.length&&(this.searchIndex=0),setTimeout(function(){t.farrisTt.selectNode(t.searchResult[t.searchIndex]),t.farrisTt.collapseAll(),t.expandParent(t.searchResult[t.searchIndex]),t.farrisTt.scrollToCurrentNode()})):this.notifyService.info(this.i18nRes.searchNullData),this.oldSearchInfo=this.searchInfo,this.oldField=this.field))},e.prototype.clearSearchValue=function(){var t=this;if(this.temp){if(this.temp=!1,this.allRoot){this.treeData=[];var e={children:[]};e.data={id:"all",code:this.i18nRes.rootNodeCode,name:this.i18nRes.rootNodeTitle},e.expanded=!0,e.leaf=!1,e.selectable=!0,this.treeData.push(e)}else this.treeData=[];this.filter.isSearchTree=!1,this.filter.codeOrName=null,this.filter.code=null,this.filter.name=null,this.groupService.getByLayer(1,this.groupType,this.filter).subscribe(function(e){t.initTreeNodeList(e),0<t.treeData.length&&t.farrisTt.selectNode(t.treeData[0].data.id),t.temp=!0}),this.oldSearchInfo="",this.oldField=""}},e.prototype.makeTree=function(t){var i=this,e=t.filter(function(e){return 1===e.layer}).map(function(e){var t={data:e,children:[],expanded:!1,selectable:e.farris_selectable};return e.isDetail||(t.leaf=!1,t.children=[]),t});return e.forEach(function(e){e.children=i.makeChildrenByParentId(t,e.data.id)}),e},e.prototype.makeChildrenByParentId=function(t,i){var r=this;return t.filter(function(e){return e.parentId===i}).map(function(e){return{data:e,children:r.makeChildrenByParentId(t,e.id),expanded:!1,selectable:e.farris_selectable}})},e.prototype.convertToTreeNode=function(e){var t={data:e};return e.isDetail||(t.leaf=!1,t.children=[]),t.selectable=e.farris_selectable,t},e.prototype.initTreeNodeList=function(n){var s=this;n&&0!==n.length&&(y.from(n).subscribe(function(e){var t=s.convertToTreeNode(e);if(t.leaf){var i=e.id,r=n.filter(function(e){return e.parentId===i});y.from(r).subscribe(function(e){t.children.push(s.convertToTreeNode(e))})}s.allRoot?s.treeData[0].children.push(t):s.treeData.push(t)}),this.farrisTt.updateSerializedValue())},e.prototype.onNodeSelect=function(e){console.log(e.node.data),this.selectRowChanged.next(e.node.data)},e.prototype.getTreeData=function(){return this.treeData},e.prototype.getTreeTableComp=function(){return this.farrisTt},e.prototype.selectNode=function(e,t){this.farrisTt.selectNode(e,t)},e.prototype.unCheckAllNodes=function(){this.farrisTt.unCheckAllNodes()},e.prototype.scrollToCurrentNode=function(e){e&&(this.farrisTt.selectNode(e),this.expandParent(e),this.farrisTt.scrollToCurrentNode())},e.prototype.expandParent=function(e){var t=this.farrisTt.findRowNode(e).parent;if(t)for(;t;)this.farrisTt.expandNode(t.id),t=t.parent},e.decorators=[{type:u.Component,args:[{selector:"lib-group-nav",template:'<div #farrisTreeParent class="f-utils-fill-flex-column" style="background-color: white">\r\n    <farris-treetable #farrisTt \r\n    [data]="this.treeData" \r\n    [columns]="cols" \r\n    [idField]="\'id\'" \r\n    [fixedHeader]="fixedHeader" \r\n    [showHeader]="showHeader" \r\n    [fit]="true" \r\n    [resizableColumns]="true"\r\n    [fitColumns]="true"\r\n    [(showFilterBar)]="showFilterBar"\r\n    (search)="searchData($event)"\r\n    [searchFields]="searchFields"\r\n    [allColumnsTitle]="allColumnsTitle"\r\n    (clearSearchValue)="clearSearchValue()"\r\n    (nodeSelected)="onNodeSelect($event)">\r\n    </farris-treetable>\r\n</div>\r\n',styles:[""]}]}],e.ctorParameters=function(){return[{type:z},{type:k},{type:l.NotifyService},{type:o.MessagerService}]},e.propDecorators={farrisTreeParent:[{type:u.ViewChild,args:["farrisTreeParent"]}],farrisTt:[{type:u.ViewChild,args:["farrisTt"]}],title:[{type:u.Input}],showHeader:[{type:u.Input}],fixedHeader:[{type:u.Input}],withCodeColumn:[{type:u.Input}],allRoot:[{type:u.Input}],groupType:[{type:u.Input}],filter:[{type:u.Input}],selectKeys:[{type:u.Input}],needRemote:[{type:u.Input}],showNodeTypeColumn:[{type:u.Input}],treeData:[{type:u.Input}],showFilterBar:[{type:u.Input}],search:[{type:u.Output}],selectRowChanged:[{type:u.Output}],winResize:[{type:u.HostListener,args:["window:resize",[]]}]},e}(),E="user",H="position",M="role",A="userGroup",L="posGroup",B="roleGroupHelp",K="sysOrg",V=function(){function e(e,t,i){this.http=e,this.sysUtil=t,this.localService=i}return e.prototype.setFilterData=function(e){if(e){var t=JSON.stringify(e);this.filterData="{}"!==t?JSON.parse(t):null}else this.filterData=null},e.prototype.setListData=function(e,t){e&&e.push.apply(e,t)},e.prototype.getFilterData=function(){return this.filterData},e.prototype.getTreeDataAsync=function(e,t){var i=this;this.i18nRes=this.localService.getComponentOpt("help");var r=JSON.parse(t.searchValue),n=t.customData.farrisSelectedData,s={},a=r.category;if("all"===a&&(s.layer=1),"children"===a&&(r.hasOwnProperty("parentPath")&&(s.path=r.parentPath),r.hasOwnProperty("parentLayer")&&(s.layer=r.parentLayer+1),r.hasOwnProperty("parentId")&&(s.parentId=r.parentId)),"search"===a){var o=r.searchField,l=r.searchValue.trim();if(l)switch(s.isSearchTree=!0,o){case"code":s.code=l;break;case"name":s.name=l;break;case"*":default:s.codeOrName=l}else s.layer=1}if("/api/runtime/sys/v1.0/sysOrgs"===e&&"fav"===a){var c=e+"/nullorg",d={headers:this.sysUtil.getHeader().headers,params:{useView:"true"}};return this.http.get(c,d).pipe(g.map(function(e){return{}}))}this.getFilterData()&&(s=Object.assign(this.getFilterData(),s),f.SysDataUtil.deleteEmpty(s));var p=JSON.stringify(s),u={headers:this.sysUtil.getHeader().headers,params:{param:p}};return this.http.get(e,u).pipe(g.map(function(e){var t={};return t.selectedData=n,t.items=[],t.treeInfo={loadDataType:"async",layerType:"parentId",dataField:"treeInfo",pathField:"path",layerField:"layer",parentField:"parentId",isDetailField:"isDetail"},t.treeInfo.treeDataIsInit=!0,t.columns=[{field:"code",title:i.i18nRes.codeField},{field:"name",title:i.i18nRes.nameField}],t.searchFields=[{label:i.i18nRes.codeField,value:"code"},{label:i.i18nRes.nameField,value:"name"}],y.from(e).subscribe(function(e){1!==e.layer&&e.parentId||(e.parentId=null),e.treeInfo={parentId:e.parentId,path:e.path,layer:e.layer,isDetail:e.isDetail}}),s.isSearchTree?(t.items=i.makeTreeByParent(e,"parentId","id"),console.log(t.items)):e&&0<e.length&&y.from(e).subscribe(function(e){t.items.push(i.convertToTreeNode(e))}),t}))},e.prototype.convertToTreeNode=function(e){var t={};return t.data=e,t.children=[],t.selectable=e.farris_selectable,t.leaf=e.isDetail,t.parent=e.parentId,t.id=t.data.id,e.hasOwnProperty("expanded")&&(t.expanded=e.expanded),t},e.prototype.makeTreeByParent=function(i,r,n){var s=this,e=i.filter(function(t){return!t[r]||(!i.find(function(e){return e[n]===t[r]})||void 0)}),a=[];return e.forEach(function(e){var t=s.convertToTreeNode(e);a.push(t)}),a.forEach(function(e){s.findChildrenByParent(e,i,r,n)}),a},e.prototype.findChildrenByParent=function(i,r,n,s){var a=this,e=r.filter(function(e){if(e[n]===i.data[s])return!0});e&&0<e.length&&e.forEach(function(e){var t=a.convertToTreeNode(e);i.children.push(t),a.findChildrenByParent(t,r,n,s)})},e.prototype.getTreeData=function(e,t){var i={};this.getFilterData()&&(i=Object.assign(this.getFilterData(),i),f.SysDataUtil.deleteEmpty(i));var r=JSON.stringify(i),n={headers:this.sysUtil.getHeader().headers,params:{param:r}};return this.http.get(e,n).pipe(g.map(function(e){return e&&0<e.length?e.forEach(function(e){1!=e.layer&&null!=e.parentId||(e.parentId=""),e.treeInfo={parentId:e.parentId,path:e.path,layer:e.layer,isDetail:e.isDetail},e.selectable=!1}):e=[],{items:e}}))},e.prototype.getGridData=function(e,t){var i=this,r=t.pageIndex,n=t.pageSize,s=t.customData.farrisSelectedData;if(!r){var a=t.customData;r=a.filter.pageIndex,n=a.filter.pageSize}var o={pageIndex:r,pageSize:n},l=t.searchValue,c=JSON.parse(l),d=c.searchField,p=c.searchValue;if(d&&p)switch(d){case"code":o.code=p;break;case"name":o.name=p;break;case"*":default:o.codeOrName=p}this.getFilterData()&&(o=Object.assign(this.getFilterData(),o),f.SysDataUtil.deleteEmpty(o)),console.log(o);var u=JSON.stringify(o),h={headers:this.sysUtil.getHeader().headers,params:{param:u}};return this.http.get(e,h).pipe(g.map(function(e){return e&&e.data&&i.setListData(t.customData.allData,e.data),{items:e.data,total:e.totalCount,pageInfo:{pageIndex:r,pageSize:n,pageList:[20,40,60,80,100],enablePager:!0},selectedData:s}}))},e.prototype.getData=function(e,t){console.log(t),console.log(e);var i=t.customData.filter;this.setFilterData(i);var r=e.indexOf("/"),n=e.substring(r,e.length);switch(e.substring(0,r)){case E:case H:case M:return this.getGridData(n,t);case A:case L:case B:case K:return this.getTreeDataAsync(n,t)}},e.decorators=[{type:u.Injectable}],e.ctorParameters=function(){return[{type:d.HttpClient},{type:f.SysCommonUtilService},{type:k}]},e}(),W=function(){function e(e,t){var s=this;this.sysUtil=e,this.localService=t,this.width=550,this.showUserOrderField=!1,this.showUserUnitInfo=!1,this.disabled=!1,this.required=!0,this.enableToSelect=!0,this.pagination=!0,this.pageIndex=1,this.pageSize=20,this.withPermission=!1,this.useBeforeCloseEvent=!1,this.typeMode=0,this.afterConfirm=new u.EventEmitter,this.afterConfirmData=new u.EventEmitter,this.clear=new u.EventEmitter,this.loadSuccessEvent=new u.EventEmitter,this.valueChangedEvent=new u.EventEmitter,this.selectDataEvent=new u.EventEmitter,this.dialogClosed=new u.EventEmitter,this.selectedData=[],this.farrisSelectedData=[],this.mapFields={id:"id",name:"name"},this.beforeOpen=function(e){return s.filter||(s.filter={}),s.showUserUnitInfo&&(s.filter.queryMode="0002"),s.filter.pageIndex=s.pageIndex,s.filter.pageSize=s.pageSize,s.allData.length=0,s.farrisSelectedData=[],s.selectedData=[],null!=s.bindingData&&null!=s.bindingData.id&&""!=s.bindingData.id&&(s.selectedData=s.bindingData.id.split(","),s.selectedData.forEach(function(e){s.farrisSelectedData.push({id:e})})),y.of({showDialog:!0,data:{filter:s.filter,allData:s.allData,farrisSelectedData:s.farrisSelectedData}})},this.dictPicked=function(t){return s.useBeforeCloseEvent&&s.beforeClose?s.beforeClose(t).pipe(g.map(function(e){return e.closeDialog&&s.afterConfirm.next(t),e})):y.of({closeDialog:!0})},this.afterOk=function(e,t){if(!s.useBeforeCloseEvent){if(s.typeMode&&1===s.typeMode&&(s.singleSelect||(s.selectedData=s.selectedData.filter(function(t){return-1<s.allData.findIndex(function(e){return t.hasOwnProperty("id")?e.id===t.id:e.id===t})}),s.selectedData.forEach(function(t,i){t.hasOwnProperty("id")||s.allData.forEach(function(e){e.id===t&&(s.selectedData[i]=e)})}),e=s.selectedData)),e)if(s.singleSelect)s.displayTxt=e.name;else{var i=e.map(function(e){return e.id}),r=e.map(function(e){return e.name}).join(),n=i.join();s.displayTxt=r,s.bindingData.id=n,s.bindingData.name=r}s.afterConfirm.next(e)}},this.onOkClick=function(){if(!s.useBeforeCloseEvent){var e;if(!s.selectedData||0===s.selectedData.length)return s.singleSelect?s.afterConfirm.next(e):s.afterConfirm.next([]),void s.farrisLookUp.closeDialog();if(s.selectedData=s.selectedData.filter(function(t){return-1<s.allData.findIndex(function(e){return t.hasOwnProperty("id")?e.id===t.id:e.id===t})}),s.selectedData.forEach(function(t,i){t.hasOwnProperty("id")||s.allData.forEach(function(e){e.id===t&&(s.selectedData[i]=e)})}),(e=s.selectedData)&&0<e.length)if(s.singleSelect){i=e[0].name;s.displayTxt=i,s.afterConfirm.next(e[0])}else{var t=e.map(function(e){return e.id}),i=e.map(function(e){return e.name}).join(),r=t.join();s.displayTxt=i,s.bindingData.id=r,s.bindingData.name=i,s.afterConfirm.next(e)}else s.afterConfirm.next(e);s.farrisLookUp.closeDialog()}},this.selectedData=[]}return e.prototype.ngOnInit=function(){var t=this;switch(this.localService?this.i18nRes=this.localService.getComponentOpt("help"):this.i18nRes=O,this.columns=[{title:this.i18nRes.codeField,field:"code",searchField:"code",width:"160"},{title:this.i18nRes.nameField,field:"name",searchField:"name",width:"200"}],this.showUserUnitInfo&&(this.width=850,this.columns.push({title:this.i18nRes.orgNamePathField,field:"orgNamePath"}),this.width=850,this.columns.push({title:this.i18nRes.orgName,field:"sysOrgName"})),this.showUserOrderField&&this.columns.push({title:this.i18nRes.orderField,field:"orderNum"}),this.allData=[],this.sourceType){case"position":this.dataUri=H+this.sysUtil.positionWebApi,this.title||(this.title=this.i18nRes.positionTitle);break;case"role":this.dataUri=M+this.sysUtil.roleWebApi,this.title||(this.title=this.i18nRes.roleTitle);break;case"user":default:this.dataUri=E+this.sysUtil.userWebApi,this.title||(this.title=this.i18nRes.userTitle)}this.farrisLookUp.mapFields={id:"id",name:"name"},this.farrisLookUp.dialogClosed.subscribe(function(e){console.log(e),t.dialogClosed.next(e)})},e.prototype.afterClear=function(e){this.clear.next(e)},e.prototype.showHelp=function(){this.farrisLookUp.showDialog()},e.prototype.oncheckedChange=function(e){var t=this;this.singleSelect&&(this.selectedData=[]),e.isCheck?e.data.forEach(function(e){-1===t.selectedData.indexOf(e.id)&&t.selectedData.push(e)}):this.selectedData=this.selectedData.filter(function(t){return!(-1<e.data.findIndex(function(e){return t.hasOwnProperty("id")?t.id===e.id:t===e.id}))})},e.decorators=[{type:u.Component,args:[{selector:"sys-farris-grid-lookup",template:'<farris-lookup-grid #farrislookup\r\n    [disabled]="disabled"\r\n    [editable]="false"\r\n    [bindingData]="bindingData"\r\n    [(ngModel)]="displayTxt"\r\n    [columns]="columns"\r\n    [singleSelect]="singleSelect"\r\n    [title]="title"\r\n    [displayType]="\'List\'"\r\n    [uri]="dataUri"\r\n    [idField]="\'id\'"\r\n    [pageIndex]="pageIndex"\r\n    [pageSize]="pageSize"\r\n    [enableToSelect]="enableToSelect"\r\n    [pagination]="pagination"\r\n    [valueField]="\'id\'" \r\n    [textField]="\'name\'"\r\n    (clear)="afterClear($event)"\r\n    [mapFields]="mapFields"\r\n    [dictPicking]="beforeOpen"\r\n    [dictPicked]="beforeClose"\r\n    [mappingFn]= "afterOk"\r\n    [dialogWidth]="width"\r\n    (checkedChange)="oncheckedChange($event)"\r\n\r\n    [required]="required"></farris-lookup-grid>\r\n\r\n    \x3c!--\r\n        确定的自定义事件，需要删除\r\n        [okHandler]="onOkClick" --\x3e\r\n\r\n',providers:[{provide:h.ServerSideToken,useClass:V}],styles:[""]}]}],e.ctorParameters=function(){return[{type:f.SysCommonUtilService},{type:k}]},e.propDecorators={title:[{type:u.Input}],width:[{type:u.Input}],showUserOrderField:[{type:u.Input}],showUserUnitInfo:[{type:u.Input}],sourceType:[{type:u.Input}],disabled:[{type:u.Input}],required:[{type:u.Input}],enableToSelect:[{type:u.Input}],singleSelect:[{type:u.Input}],pagination:[{type:u.Input}],pageIndex:[{type:u.Input}],pageSize:[{type:u.Input}],displayTxt:[{type:u.Input}],bindingData:[{type:u.Input}],filter:[{type:u.Input}],withPermission:[{type:u.Input}],useBeforeCloseEvent:[{type:u.Input}],beforeClose:[{type:u.Input}],typeMode:[{type:u.Input}],afterConfirm:[{type:u.Output}],afterConfirmData:[{type:u.Output}],clear:[{type:u.Output}],loadSuccessEvent:[{type:u.Output}],valueChangedEvent:[{type:u.Output}],selectDataEvent:[{type:u.Output}],dialogClosed:[{type:u.Output}],farrisLookUp:[{type:u.ViewChild,args:["farrislookup"]}]},e}(),q=function Q(){this.helpMeta=new Map},J=function(){function e(e,t,i){var s=this;this.sysUtil=e,this.localService=t,this.sysHelpService=i,this.disabled=!1,this.async=!1,this.singleSelect=!0,this.enableToSelect=!0,this.useBeforeCloseEvent=!1,this.withPermission=!1,this.afterConfirm=new u.EventEmitter,this.clear=new u.EventEmitter,this.showAllPathOrg=!1,this.mapFields={id:"id",name:"name"},this.allData=[],this.beforeOpen=function(e){var t=[],i=[],r=0;if(null!=s.bindingData&&null!=s.bindingData.id&&""!=s.bindingData.id){i=s.bindingData.id.split(",");var n=s.bindingData.name.split(",");i.forEach(function(e){t.push({id:e,name:n[r]}),r+=1})}return y.of({showDialog:!0,data:{filter:s.filter,allData:s.allData,farrisSelectedData:t}})},this.dictPicked=function(t){return s.useBeforeCloseEvent&&s.beforeClose?s.beforeClose(t).pipe(g.map(function(e){return e.closeDialog&&s.afterConfirm.next(t),e})):y.of({closeDialog:!0})},this.afterOk=function(t,e){if(!s.useBeforeCloseEvent)if(t)if(s.singleSelect)s.displayTxt=t.name,s.showAllPathOrg?s.sysHelpService.getParentOrg(t).subscribe(function(e){e&&0<e.length&&(t.allPathOrg=e),s.afterConfirm.next(t),console.log(t)}):s.afterConfirm.next(t);else{var i=t.map(function(e){return e.id}),r=t.map(function(e){return e.name});s.bindingData.id=i.join(),s.bindingData.name=r.join(),s.displayTxt=s.bindingData.name,s.afterConfirm.next(t)}else s.afterConfirm.next(t),console.log(t)}}return e.prototype.ngOnInit=function(){switch(this.localService?this.i18nRes=this.localService.getComponentOpt("help"):this.i18nRes=O,this.treeInfo={loadDataType:"all",layerType:"parentId",dataField:"treeInfo",pathField:"path",layerField:"layer",parentField:"parentId",isDetailField:"isDetail",treeDataIsInit:!1},this.columns=[{title:this.i18nRes.codeField,field:"code",searchField:"code"},{title:this.i18nRes.nameField,field:"name",searchField:"name"}],this.async&&(this.treeInfo.loadDataType="async",this.treeInfo.treeDataIsInit=!0),this.sourceType){case"org":this.dataUri=K+this.sysUtil.sysOrgWebApi,this.title||(this.title=this.i18nRes.userOrgTitle);break;case"usergroup":this.dataUri=A+this.sysUtil.userGroupWebApi,this.title||(this.title=this.i18nRes.userGroupTitle);break;case"positiongroup":this.dataUri=L+this.sysUtil.posGroupWebApi,this.title||(this.title=this.i18nRes.positionGroupTitle);break;case"rolegroup":default:this.dataUri=B+this.sysUtil.roleGroupWebApi,this.title||(this.title=this.i18nRes.roleGroupTitle)}this.farrisLookUp.mapFields={id:"id",name:"name"}},e.prototype.afterClear=function(e){this.clear.next(e)},e.prototype.showHelp=function(){this.farrisLookUp.showDialog()},e.prototype.search=function(e){console.log(e)},e.decorators=[{type:u.Component,args:[{selector:"sys-farris-tree-help",template:'<farris-lookup-grid #farristreelookup\r\n    [(ngModel)]="displayTxt"\r\n    [bindingData]="bindingData"\r\n    [title]="title"\r\n    [remoteSearch]="true"\r\n    [editable]="false"\r\n    [disabled]="disabled"\r\n    [displayType]="\'TREELIST\'"\r\n    [singleSelect]="singleSelect"\r\n    [enableToSelect]="enableToSelect"\r\n    [uri]="dataUri"\r\n    [columns] = "columns"\r\n    [idField]="\'id\'"\r\n    [treeInfo]="treeInfo"\r\n    [textField]= "\'name\'"\r\n    [valueField]="\'id\'"\r\n    [mappingFn]= "afterOk"\r\n    [mapFields]="mapFields"\r\n    [dictPicking]="beforeOpen"\r\n    [dictPicked]="dictPicked"\r\n    (clear)="afterClear($event)"\r\n    (search)="search($event)"\r\n></farris-lookup-grid>',providers:[{provide:h.ServerSideToken,useClass:V}],styles:[""]}]}],e.ctorParameters=function(){return[{type:f.SysCommonUtilService},{type:k},{type:N}]},e.propDecorators={disabled:[{type:u.Input}],title:[{type:u.Input}],async:[{type:u.Input}],sourceType:[{type:u.Input}],singleSelect:[{type:u.Input}],displayTxt:[{type:u.Input}],bindingData:[{type:u.Input}],filter:[{type:u.Input}],enableToSelect:[{type:u.Input}],useBeforeCloseEvent:[{type:u.Input}],beforeClose:[{type:u.Input}],withPermission:[{type:u.Input}],afterConfirm:[{type:u.Output}],clear:[{type:u.Output}],showAllPathOrg:[{type:u.Input}],farrisLookUp:[{type:u.ViewChild,args:["farristreelookup"]}]},e}(),$=function(){function e(){}return e.decorators=[{type:u.NgModule,args:[{imports:[s.CommonModule,p.FormsModule,d.HttpClientModule,h.LookupModule,a.ModalModule.forRoot(),o.MessagerModule.forRoot(),m.DatagridModule,c.TreeTableModule,f.SysCommonModule],declarations:[j,W,J],exports:[j,W,J],providers:[q,N,P,f.SysCommonUtilService,z,b.LanguageService,v.CookieService,k]}]}],e}(),_=function(){function e(){}return e.userManage="UserManage",e.userView="UserView",e.userAssPosition="UserAssPosition",e.positionManage="PositionManage",e.positionView="PositionView",e.positionAssRole="PositionAssRole",e.positionAssUser="PositionAssUser",e.roleManage="RoleManage",e.roleAssPosition="RoleAssPosition",e}();e.SysFuncOpHelpModule=R,e.SysFuncOpHelpComponent=U,e.SysFuncOperationComponent=D,e.SysManagerUIModule=$,e.AuthOp=_,e.SysFarrisLookupService=V,e.SysHelpService=N,e.userHelp=E,e.posHelp=H,e.roleHelp=M,e.userGroupHelp=A,e.posGroupHelp=L,e.roleGroupHelp=B,e.sysOrgHelp=K,e.SysExceptionService=P,e.GroupNavComponent=j,e.SysFarrisLookupComponent=W,e.SysFarrisTreeHelpComponent=J,e.SysLocaleService=k,e.HelpFilterMap=q,e.ɵc=G,e.ɵd=I,e.ɵa=C,e.ɵe=F,e.ɵb=S,e.ɵf=z,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-sys-sysmgr-ui.umd.min.js.map
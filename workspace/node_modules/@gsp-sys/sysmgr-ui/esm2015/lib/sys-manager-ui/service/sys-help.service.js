/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { from } from 'rxjs';
import { HttpClient } from '@angular/common/http';
import { SysCommonUtilService, SysDataUtil } from '@gsp-sys/sysmgr-common';
import { map } from 'rxjs/operators';
export class SysHelpService {
    /**
     * @param {?} http
     * @param {?} sysUtil
     */
    constructor(http, sysUtil) {
        this.http = http;
        this.sysUtil = sysUtil;
    }
    /**
     * @private
     * @param {?} filter
     * @return {?}
     */
    getHttpOption(filter) {
        SysDataUtil.deleteEmpty(filter);
        /** @type {?} */
        const paramStr = JSON.stringify(filter);
        /** @type {?} */
        const opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return opt;
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getUsers(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        // 用户目前的有分页信息
        return this.http.get(this.sysUtil.userWebApi, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            return val.data;
        })));
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getPositions(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        return this.http.get(this.sysUtil.positionWebApi, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            return val.data;
        })));
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getRoles(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        return this.http.get(this.sysUtil.roleWebApi, opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            return val.data;
        })));
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getOrgs(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        // 视图
        opt.params.useView = true;
        return this.handerTreeData(this.http.get(this.sysUtil.sysOrgWebApi + '/all', opt));
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getUserGroups(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        return this.handerTreeData(this.http.get(this.sysUtil.userGroupWebApi + '/all', opt));
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getPositionGroups(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        return this.handerTreeData(this.http.get(this.sysUtil.posGroupWebApi + '/all', opt));
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    getRoleGroups(filter) {
        /** @type {?} */
        const opt = this.getHttpOption(filter);
        return this.handerTreeData(this.http.get(this.sysUtil.roleGroupWebApi + '/all', opt));
    }
    /**
     * @param {?} item
     * @return {?}
     */
    convert2Json(item) {
        /** @type {?} */
        const result = {
            id: item.id,
            code: item.code,
            name: item.name,
            parentId: item.parentId || '',
            path: item.path,
            layer: item.layer,
            isDetail: item.isDetail,
        };
        if (item.nodeType != null && item.nodeType !== undefined) {
            result.nodeType = item.nodeType;
        }
        return result;
    }
    /**
     * @param {?} org
     * @return {?}
     */
    getParentOrg(org) {
        /** @type {?} */
        const paramStr = JSON.stringify(this.convert2Json(org));
        /** @type {?} */
        const opt = {
            headers: this.sysUtil.getHeader()['headers'],
            params: { param: paramStr }
        };
        return this.http.get(this.sysUtil.sysOrgWebApi + '/getparentorg/0002', opt).pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            return val;
        })));
    }
    /**
     * 适配Kendo-treeView结构
     * @private
     * @param {?} src
     * @return {?}
     */
    handerTreeData(src) {
        return src.pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            from(val).subscribe((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                if (item.layer == 1 || item.parentId == null || item.parentId === '') {
                    item.parentId = undefined;
                }
            }));
            return val;
        })));
    }
}
SysHelpService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
SysHelpService.ctorParameters = () => [
    { type: HttpClient },
    { type: SysCommonUtilService }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    SysHelpService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    SysHelpService.prototype.sysUtil;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzLWhlbHAuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3N5c21nci11aS8iLCJzb3VyY2VzIjpbImxpYi9zeXMtbWFuYWdlci11aS9zZXJ2aWNlL3N5cy1oZWxwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzNFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU9yQyxNQUFNLE9BQU8sY0FBYzs7Ozs7SUFFdkIsWUFDWSxJQUFnQixFQUNoQixPQUE2QjtRQUQ3QixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLFlBQU8sR0FBUCxPQUFPLENBQXNCO0lBRXpDLENBQUM7Ozs7OztJQUVPLGFBQWEsQ0FBRSxNQUFXO1FBQzlCLFdBQVcsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7O2NBQzFCLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQzs7Y0FDakMsR0FBRyxHQUFHO1lBQ1IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQzVDLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUU7U0FDOUI7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUM7Ozs7O0lBRUQsUUFBUSxDQUFFLE1BQXFCOztjQUNyQixHQUFHLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUM7UUFDdEMsYUFBYTtRQUNiLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMs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Q0wsQ0FBQyxFQUFDLENBQUM7WUFDSCxPQUFPLEdBQUcsQ0FBQztRQUNmLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDUixDQUFDOzs7WUFoR0osVUFBVTs7OztZQVJGLFVBQVU7WUFDVixvQkFBb0I7Ozs7Ozs7SUFXckIsOEJBQXdCOzs7OztJQUN4QixpQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgU3lzQ29tbW9uVXRpbFNlcnZpY2UsIFN5c0RhdGFVdGlsIH0gZnJvbSAnQGdzcC1zeXMvc3lzbWdyLWNvbW1vbic7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgR3NwVXNlckZpbHRlciB9IGZyb20gJy4uL2ZpbHRlci9nc3AtdXNlci1maWx0ZXInO1xyXG5pbXBvcnQgeyBHc3BQb3NpdGlvbkZpbHRlciB9IGZyb20gJy4uL2ZpbHRlci9nc3AtcG9zaXRpb24tZmlsdGVyJztcclxuaW1wb3J0IHsgR3NwUm9sZUZpbHRlciB9IGZyb20gJy4uL2ZpbHRlci9nc3Atcm9sZS1maWx0ZXInO1xyXG5pbXBvcnQgeyBUcmVlRmlsdGVyIH0gZnJvbSAnLi4vZmlsdGVyL3RyZWUtZmlsdGVyJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFN5c0hlbHBTZXJ2aWNlIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvciAoXHJcbiAgICAgICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICAgICAgIHByaXZhdGUgc3lzVXRpbDogU3lzQ29tbW9uVXRpbFNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SHR0cE9wdGlvbiAoZmlsdGVyOiBhbnkpOiB7IGhlYWRlcnM6IGFueSwgcGFyYW1zOiBhbnkgfSB7XHJcbiAgICAgICAgU3lzRGF0YVV0aWwuZGVsZXRlRW1wdHkoZmlsdGVyKTtcclxuICAgICAgICBjb25zdCBwYXJhbVN0ciA9IEpTT04uc3RyaW5naWZ5KGZpbHRlcik7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0ge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLnN5c1V0aWwuZ2V0SGVhZGVyKClbJ2hlYWRlcnMnXSxcclxuICAgICAgICAgICAgcGFyYW1zOiB7IHBhcmFtOiBwYXJhbVN0ciB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gb3B0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJzIChmaWx0ZXI6IEdzcFVzZXJGaWx0ZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHRoaXMuZ2V0SHR0cE9wdGlvbihmaWx0ZXIpO1xyXG4gICAgICAgIC8vIOeUqOaIt+ebruWJjeeahOacieWIhumhteS/oeaBr1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHRoaXMuc3lzVXRpbC51c2VyV2ViQXBpLCBvcHQpLnBpcGUobWFwKCh2YWw6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsLmRhdGE7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFBvc2l0aW9ucyAoZmlsdGVyOiBHc3BQb3NpdGlvbkZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy5zeXNVdGlsLnBvc2l0aW9uV2ViQXBpLCBvcHQpLnBpcGUobWFwKCh2YWw6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsLmRhdGE7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG4gICAgZ2V0Um9sZXMgKGZpbHRlcjogR3NwUm9sZUZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy5zeXNVdGlsLnJvbGVXZWJBcGksIG9wdCkucGlwZShtYXAoKHZhbDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWwuZGF0YTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbiAgICBnZXRPcmdzIChmaWx0ZXI6IFRyZWVGaWx0ZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHRoaXMuZ2V0SHR0cE9wdGlvbihmaWx0ZXIpO1xyXG4gICAgICAgIC8vIOinhuWbvlxyXG4gICAgICAgIG9wdC5wYXJhbXMudXNlVmlldyA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGVyVHJlZURhdGEodGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwuc3lzT3JnV2ViQXBpICsgJy9hbGwnLCBvcHQpKTtcclxuICAgIH1cclxuICAgIGdldFVzZXJHcm91cHMgKGZpbHRlcjogVHJlZUZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGVyVHJlZURhdGEodGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwudXNlckdyb3VwV2ViQXBpICsgJy9hbGwnLCBvcHQpKTtcclxuICAgIH1cclxuICAgIGdldFBvc2l0aW9uR3JvdXBzIChmaWx0ZXI6IFRyZWVGaWx0ZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IG9wdCA9IHRoaXMuZ2V0SHR0cE9wdGlvbihmaWx0ZXIpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRlclRyZWVEYXRhKHRoaXMuaHR0cC5nZXQodGhpcy5zeXNVdGlsLnBvc0dyb3VwV2ViQXBpICsgJy9hbGwnLCBvcHQpKTtcclxuICAgIH1cclxuICAgIGdldFJvbGVHcm91cHMgKGZpbHRlcjogVHJlZUZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5nZXRIdHRwT3B0aW9uKGZpbHRlcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGVyVHJlZURhdGEodGhpcy5odHRwLmdldCh0aGlzLnN5c1V0aWwucm9sZUdyb3VwV2ViQXBpICsgJy9hbGwnLCBvcHQpKTtcclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0Mkpzb24oaXRlbTogYW55KTogYW55IHtcclxuICAgICAgICBjb25zdCByZXN1bHQ6IGFueSA9IHtcclxuICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsXHJcbiAgICAgICAgICAgIGNvZGU6IGl0ZW0uY29kZSxcclxuICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLFxyXG4gICAgICAgICAgICBwYXJlbnRJZDogaXRlbS5wYXJlbnRJZCB8fCAnJyxcclxuICAgICAgICAgICAgcGF0aDogaXRlbS5wYXRoLFxyXG4gICAgICAgICAgICBsYXllcjogaXRlbS5sYXllcixcclxuICAgICAgICAgICAgaXNEZXRhaWw6IGl0ZW0uaXNEZXRhaWwsXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGl0ZW0ubm9kZVR5cGUgIT0gbnVsbCAmJiBpdGVtLm5vZGVUeXBlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmVzdWx0Lm5vZGVUeXBlID0gaXRlbS5ub2RlVHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIGdldFBhcmVudE9yZyAob3JnOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHBhcmFtU3RyID0gSlNPTi5zdHJpbmdpZnkodGhpcy5jb252ZXJ0Mkpzb24ob3JnKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG9wdCA9IHtcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5zeXNVdGlsLmdldEhlYWRlcigpWydoZWFkZXJzJ10sXHJcbiAgICAgICAgICAgIHBhcmFtczogeyBwYXJhbTogcGFyYW1TdHIgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy5zeXNVdGlsLnN5c09yZ1dlYkFwaSsnL2dldHBhcmVudG9yZy8wMDAyJywgb3B0KS5waXBlKG1hcCgodmFsOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOmAgumFjUtlbmRvLXRyZWVWaWV357uT5p6EICovXHJcbiAgICBwcml2YXRlIGhhbmRlclRyZWVEYXRhIChzcmM6IE9ic2VydmFibGU8YW55Pik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHNyYy5waXBlKG1hcCgodmFsOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICBmcm9tKHZhbCkuc3Vic2NyaWJlKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ubGF5ZXIgPT0gMSB8fCBpdGVtLnBhcmVudElkID09IG51bGwgfHwgaXRlbS5wYXJlbnRJZCA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnBhcmVudElkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbn1cclxuIl19
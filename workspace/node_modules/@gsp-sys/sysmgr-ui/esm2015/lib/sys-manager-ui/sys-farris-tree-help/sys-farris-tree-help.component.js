/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { SysHelpService } from './../service/sys-help.service';
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { LookupGridComponent, ServerSideToken } from '@farris/ui-lookup';
import { SysCommonUtilService } from '@gsp-sys/sysmgr-common';
import { sysOrgHelp, posGroupHelp, roleGroupHelp, userGroupHelp } from '../help-meta/sys-help-meta';
import { SysFarrisLookupService } from '../service/sys-farris-lookup.service';
import { of } from 'rxjs';
import { SysLocaleService } from '../../locale/sys-locale.service';
import { HELP_LOCALE_ZHCHS } from '../../locale/locales/zh-cn/help';
import { map } from 'rxjs/operators';
export class SysFarrisTreeHelpComponent {
    /**
     * @param {?} sysUtil
     * @param {?} localService
     * @param {?} sysHelpService
     */
    constructor(sysUtil, localService, sysHelpService) {
        this.sysUtil = sysUtil;
        this.localService = localService;
        this.sysHelpService = sysHelpService;
        /**
         * 是否只读
         */
        this.disabled = false;
        /**
         * 是否分层加载组织
         */
        this.async = false;
        /**
         * 是否单选
         */
        this.singleSelect = true;
        /**
         * 打开帮助后是否有选中数据
         */
        this.enableToSelect = true;
        /**
         * 启用关闭前事件
         */
        this.useBeforeCloseEvent = false;
        /**
         * 是否开始数据权限过滤
         */
        this.withPermission = false;
        /**
         * 帮助选择后事件
         */
        this.afterConfirm = new EventEmitter();
        /**
         * 清空后事件-暂时不用
         */
        this.clear = new EventEmitter();
        this.showAllPathOrg = false;
        this.mapFields = { id: 'id', name: 'name' };
        this.allData = [];
        /**
         * 帮助前事件,强行传递过滤条件
         */
        this.beforeOpen = (/**
         * @param {?} arg
         * @return {?}
         */
        (arg) => {
            //如果有过滤条件，附加到url路径
            /** @type {?} */
            let farrisSelectedData = [];
            /** @type {?} */
            let selectedData = [];
            /** @type {?} */
            let temp = 0;
            if (this.bindingData != null && this.bindingData.id != null && this.bindingData.id != "") {
                selectedData = this.bindingData.id.split(',');
                /** @type {?} */
                let selectedDataName = this.bindingData.name.split(',');
                selectedData.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => {
                    farrisSelectedData.push({ "id": item, "name": selectedDataName[temp] });
                    temp = temp + 1;
                }));
            }
            return of({
                showDialog: true,
                data: {
                    filter: this.filter,
                    allData: this.allData,
                    farrisSelectedData: farrisSelectedData
                }
            });
        });
        /**
         * 帮助关闭前事件,目前无论是否都会继续走afterOk映射事件
         */
        this.dictPicked = (/**
         * @param {?} arg
         * @return {?}
         */
        (arg) => {
            if (this.useBeforeCloseEvent && this.beforeClose) {
                return this.beforeClose(arg).pipe(map((/**
                 * @param {?} val
                 * @return {?}
                 */
                val => {
                    // 如果能关闭，调用后事件
                    if (val.closeDialog) {
                        this.afterConfirm.next(arg);
                    }
                    return val;
                })));
            }
            else {
                return of({ closeDialog: true });
            }
        });
        /**
         * 帮助映射后事件
         */
        this.afterOk = (/**
         * @param {?} helpdata
         * @param {?} mapfields
         * @return {?}
         */
        (helpdata, mapfields) => {
            // 如果启用了关闭前校验事件，不走这里
            if (this.useBeforeCloseEvent) {
                return;
            }
            if (helpdata) {
                // 多选的话需要处理,帮助已逗号为间隔
                if (!this.singleSelect) {
                    /** @type {?} */
                    const idList = helpdata.map((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => item.id));
                    /** @type {?} */
                    const nameList = helpdata.map((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => item.name));
                    this.bindingData.id = idList.join();
                    this.bindingData.name = nameList.join();
                    this.displayTxt = this.bindingData.name;
                    this.afterConfirm.next(helpdata);
                }
                else {
                    // 帮助显示
                    this.displayTxt = helpdata.name;
                    if (this.showAllPathOrg) {
                        this.sysHelpService.getParentOrg(helpdata).subscribe((/**
                         * @param {?} items
                         * @return {?}
                         */
                        items => {
                            if (items && items.length > 0) {
                                helpdata.allPathOrg = items;
                            }
                            this.afterConfirm.next(helpdata);
                            console.log(helpdata);
                        }));
                    }
                    else {
                        this.afterConfirm.next(helpdata);
                    }
                }
            }
            else { // 目前清空会走这里，而且两次
                // 触发事件
                this.afterConfirm.next(helpdata);
                console.log(helpdata);
            }
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.localService) {
            this.i18nRes = this.localService.getComponentOpt('help');
        }
        else {
            this.i18nRes = HELP_LOCALE_ZHCHS;
        }
        // 默认不分层加载
        this.treeInfo = {
            loadDataType: 'all',
            layerType: 'parentId',
            dataField: 'treeInfo',
            pathField: 'path',
            layerField: 'layer',
            parentField: 'parentId',
            isDetailField: 'isDetail',
            treeDataIsInit: false
        };
        this.columns = [
            { title: this.i18nRes.codeField, field: 'code', searchField: 'code' },
            { title: this.i18nRes.nameField, field: 'name', searchField: 'name' },
        ];
        // 异步加载的话需要开启这两个开关
        if (this.async) {
            this.treeInfo.loadDataType = 'async';
            this.treeInfo.treeDataIsInit = true;
        }
        // webapi初始
        switch (this.sourceType) {
            case 'org':
                this.dataUri = sysOrgHelp + this.sysUtil.sysOrgWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.userOrgTitle;
                }
                break;
            case 'usergroup':
                this.dataUri = userGroupHelp + this.sysUtil.userGroupWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.userGroupTitle;
                }
                break;
            case 'positiongroup':
                this.dataUri = posGroupHelp + this.sysUtil.posGroupWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.positionGroupTitle;
                }
                break;
            case 'rolegroup':
            default:
                this.dataUri = roleGroupHelp + this.sysUtil.roleGroupWebApi;
                if (!this.title) {
                    this.title = this.i18nRes.roleGroupTitle;
                }
                break;
        }
        // 必须要有，否则初始选中不起作用
        this.farrisLookUp.mapFields = { id: 'id', name: 'name' };
    }
    /**
     * 清空后
     * @param {?} arg
     * @return {?}
     */
    afterClear(arg) {
        this.clear.next(arg);
    }
    /**
     * 手动显示帮助
     * @return {?}
     */
    showHelp() {
        this.farrisLookUp.showDialog();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    search($event) {
        console.log($event);
    }
}
SysFarrisTreeHelpComponent.decorators = [
    { type: Component, args: [{
                selector: 'sys-farris-tree-help',
                template: "<farris-lookup-grid #farristreelookup\r\n    [(ngModel)]=\"displayTxt\"\r\n    [bindingData]=\"bindingData\"\r\n    [title]=\"title\"\r\n    [remoteSearch]=\"true\"\r\n    [editable]=\"false\"\r\n    [disabled]=\"disabled\"\r\n    [displayType]=\"'TREELIST'\"\r\n    [singleSelect]=\"singleSelect\"\r\n    [enableToSelect]=\"enableToSelect\"\r\n    [uri]=\"dataUri\"\r\n    [columns] = \"columns\"\r\n    [idField]=\"'id'\"\r\n    [treeInfo]=\"treeInfo\"\r\n    [textField]= \"'name'\"\r\n    [valueField]=\"'id'\"\r\n    [mappingFn]= \"afterOk\"\r\n    [mapFields]=\"mapFields\"\r\n    [dictPicking]=\"beforeOpen\"\r\n    [dictPicked]=\"dictPicked\"\r\n    (clear)=\"afterClear($event)\"\r\n    (search)=\"search($event)\"\r\n></farris-lookup-grid>",
                providers: [
                    { provide: ServerSideToken, useClass: SysFarrisLookupService }
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
SysFarrisTreeHelpComponent.ctorParameters = () => [
    { type: SysCommonUtilService },
    { type: SysLocaleService },
    { type: SysHelpService }
];
SysFarrisTreeHelpComponent.propDecorators = {
    disabled: [{ type: Input }],
    title: [{ type: Input }],
    async: [{ type: Input }],
    sourceType: [{ type: Input }],
    singleSelect: [{ type: Input }],
    displayTxt: [{ type: Input }],
    bindingData: [{ type: Input }],
    filter: [{ type: Input }],
    enableToSelect: [{ type: Input }],
    useBeforeCloseEvent: [{ type: Input }],
    beforeClose: [{ type: Input }],
    withPermission: [{ type: Input }],
    afterConfirm: [{ type: Output }],
    clear: [{ type: Output }],
    showAllPathOrg: [{ type: Input }],
    farrisLookUp: [{ type: ViewChild, args: ['farristreelookup',] }]
};
if (false) {
    /**
     * 是否只读
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.disabled;
    /**
     * 标题
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.title;
    /**
     * 是否分层加载组织
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.async;
    /**
     * 取数源
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.sourceType;
    /**
     * 是否单选
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.singleSelect;
    /**
     * 绑定到帮助上的数据，初始显示值用
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.displayTxt;
    /**
     * 存储帮助选择的对象
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.bindingData;
    /**
     * 过滤条件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.filter;
    /**
     * 打开帮助后是否有选中数据
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.enableToSelect;
    /**
     * 启用关闭前事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.useBeforeCloseEvent;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.beforeClose;
    /**
     * 是否开始数据权限过滤
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.withPermission;
    /**
     * 帮助选择后事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.afterConfirm;
    /**
     * 清空后事件-暂时不用
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.clear;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.showAllPathOrg;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.farrisLookUp;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.mapFields;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.dataUri;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.columns;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.treeInfo;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.allData;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.i18nRes;
    /**
     * 帮助前事件,强行传递过滤条件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.beforeOpen;
    /**
     * 帮助关闭前事件,目前无论是否都会继续走afterOk映射事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.dictPicked;
    /**
     * 帮助映射后事件
     * @type {?}
     */
    SysFarrisTreeHelpComponent.prototype.afterOk;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.sysUtil;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.localService;
    /** @type {?} */
    SysFarrisTreeHelpComponent.prototype.sysHelpService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzLWZhcnJpcy10cmVlLWhlbHAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1zeXMvc3lzbWdyLXVpLyIsInNvdXJjZXMiOlsibGliL3N5cy1tYW5hZ2VyLXVpL3N5cy1mYXJyaXMtdHJlZS1oZWxwL3N5cy1mYXJyaXMtdHJlZS1oZWxwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxlQUFlLEVBQWdCLE1BQU0sbUJBQW1CLENBQUM7QUFDdkYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3BHLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxFQUFFLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFbkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBVXJDLE1BQU0sT0FBTywwQkFBMEI7Ozs7OztJQXVDbkMsWUFDVyxPQUE2QixFQUM3QixZQUE4QixFQUM5QixjQUE4QjtRQUY5QixZQUFPLEdBQVAsT0FBTyxDQUFzQjtRQUM3QixpQkFBWSxHQUFaLFlBQVksQ0FBa0I7UUFDOUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCOzs7O1FBeENoQyxhQUFRLEdBQUcs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SUFHRCxnREFZQzs7Ozs7SUFFRCw2Q0FxQ0M7O0lBL0lHLDZDQUFvQzs7SUFDcEMsa0RBQXFDOztJQUNyQyxvREFBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmb3JFYWNoIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyL3NyYy91dGlscy9jb2xsZWN0aW9uJztcclxuaW1wb3J0IHsgU3lzSGVscFNlcnZpY2UgfSBmcm9tICcuLy4uL3NlcnZpY2Uvc3lzLWhlbHAuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmVlRmlsdGVyIH0gZnJvbSAnLi4vZmlsdGVyL3RyZWUtZmlsdGVyJztcclxuaW1wb3J0IHsgTG9va3VwR3JpZENvbXBvbmVudCwgU2VydmVyU2lkZVRva2VuLCBQaWNrZWRSZXN1bHQgfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XHJcbmltcG9ydCB7IFN5c0NvbW1vblV0aWxTZXJ2aWNlIH0gZnJvbSAnQGdzcC1zeXMvc3lzbWdyLWNvbW1vbic7XHJcbmltcG9ydCB7IHN5c09yZ0hlbHAsIHBvc0dyb3VwSGVscCwgcm9sZUdyb3VwSGVscCwgdXNlckdyb3VwSGVscCB9IGZyb20gJy4uL2hlbHAtbWV0YS9zeXMtaGVscC1tZXRhJztcclxuaW1wb3J0IHsgU3lzRmFycmlzTG9va3VwU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2Uvc3lzLWZhcnJpcy1sb29rdXAuc2VydmljZSc7XHJcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFN5c0xvY2FsZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9sb2NhbGUvc3lzLWxvY2FsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IEhFTFBfTE9DQUxFX1pIQ0hTIH0gZnJvbSAnLi4vLi4vbG9jYWxlL2xvY2FsZXMvemgtY24vaGVscCc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzeXMtZmFycmlzLXRyZWUtaGVscCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vc3lzLWZhcnJpcy10cmVlLWhlbHAuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vc3lzLWZhcnJpcy10cmVlLWhlbHAuY29tcG9uZW50LmNzcyddLFxyXG4gICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgeyBwcm92aWRlOiBTZXJ2ZXJTaWRlVG9rZW4sIHVzZUNsYXNzOiBTeXNGYXJyaXNMb29rdXBTZXJ2aWNlIH1cclxuICAgIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFN5c0ZhcnJpc1RyZWVIZWxwQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIC8qKiDmmK/lkKblj6ror7sgKi9cclxuICAgIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAvKiog5qCH6aKYICovXHJcbiAgICBASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xyXG4gICAgLyoqIOaYr+WQpuWIhuWxguWKoOi9vee7hOe7hyAqL1xyXG4gICAgQElucHV0KCkgYXN5bmMgPSBmYWxzZTtcclxuICAgIC8qKiDlj5bmlbDmupAgKi9cclxuICAgIEBJbnB1dCgpIHNvdXJjZVR5cGU6ICdvcmcnIHwgJ3VzZXJncm91cCcgfCAncG9zaXRpb25ncm91cCcgfCAncm9sZWdyb3VwJztcclxuICAgIC8qKiDmmK/lkKbljZXpgIkgKi9cclxuICAgIEBJbnB1dCgpIHNpbmdsZVNlbGVjdCA9IHRydWU7XHJcbiAgICAvKiog57uR5a6a5Yiw5biu5Yqp5LiK55qE5pWw5o2u77yM5Yid5aeL5pi+56S65YC855SoICovXHJcbiAgICBASW5wdXQoKSBkaXNwbGF5VHh0OiBzdHJpbmc7XHJcbiAgICAvKiog5a2Y5YKo5biu5Yqp6YCJ5oup55qE5a+56LGhICovXHJcbiAgICBASW5wdXQoKSBiaW5kaW5nRGF0YTogeyBpZDogc3RyaW5nLCBuYW1lOiBzdHJpbmcgfTtcclxuICAgIC8qKiDov4fmu6TmnaHku7YgKi9cclxuICAgIEBJbnB1dCgpIGZpbHRlcjogVHJlZUZpbHRlcjtcclxuICAgIC8qKlxyXG4gICAgICog5omT5byA5biu5Yqp5ZCO5piv5ZCm5pyJ6YCJ5Lit5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIEBJbnB1dCgpIGVuYWJsZVRvU2VsZWN0PXRydWU7XHJcbiAgICAvKiog5ZCv55So5YWz6Zet5YmN5LqL5Lu2ICovXHJcbiAgICBASW5wdXQoKSB1c2VCZWZvcmVDbG9zZUV2ZW50ID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBiZWZvcmVDbG9zZTogKHNlbGVjdERhdGE6IGFueSkgPT4gT2JzZXJ2YWJsZTxQaWNrZWRSZXN1bHQ+O1xyXG4gICAgLyoqIOaYr+WQpuW8gOWni+aVsOaNruadg+mZkOi/h+a7pCAqL1xyXG4gICAgQElucHV0KCkgd2l0aFBlcm1pc3Npb24gPSBmYWxzZTtcclxuICAgIC8qKiDluK7liqnpgInmi6nlkI7kuovku7YgKi9cclxuICAgIEBPdXRwdXQoKSBhZnRlckNvbmZpcm06IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvKiog5riF56m65ZCO5LqL5Lu2LeaaguaXtuS4jeeUqCAqL1xyXG4gICAgQE91dHB1dCgpIGNsZWFyOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgQElucHV0KCkgc2hvd0FsbFBhdGhPcmc6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgQFZpZXdDaGlsZCgnZmFycmlzdHJlZWxvb2t1cCcpIHB1YmxpYyBmYXJyaXNMb29rVXA6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcbiAgICBtYXBGaWVsZHMgPSB7IGlkOiAnaWQnLCBuYW1lOiAnbmFtZScgfTtcclxuXHJcbiAgICBkYXRhVXJpOiBzdHJpbmc7XHJcbiAgICBjb2x1bW5zOiBhbnk7XHJcbiAgICB0cmVlSW5mbzogYW55O1xyXG4gICAgcHVibGljIGFsbERhdGEgPSBbXTtcclxuICAgIHB1YmxpYyBpMThuUmVzOiBhbnk7XHJcbiAgICBjb25zdHJ1Y3RvciAoXHJcbiAgICAgICAgcHVibGljIHN5c1V0aWw6IFN5c0NvbW1vblV0aWxTZXJ2aWNlLFxyXG4gICAgICAgIHB1YmxpYyBsb2NhbFNlcnZpY2U6IFN5c0xvY2FsZVNlcnZpY2UsXHJcbiAgICAgICAgcHVibGljIHN5c0hlbHBTZXJ2aWNlOiBTeXNIZWxwU2VydmljZSxcclxuICAgICkge1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25Jbml0ICgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2NhbFNlcnZpY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5pMThuUmVzID0gdGhpcy5sb2NhbFNlcnZpY2UuZ2V0Q29tcG9uZW50T3B0KCdoZWxwJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pMThuUmVzID0gSEVMUF9MT0NBTEVfWkhDSFM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOm7mOiupOS4jeWIhuWxguWKoOi9vVxyXG4gICAgICAgIHRoaXMudHJlZUluZm8gPSB7XHJcbiAgICAgICAgICAgIGxvYWREYXRhVHlwZTogJ2FsbCcsXHJcbiAgICAgICAgICAgIGxheWVyVHlwZTogJ3BhcmVudElkJyxcclxuICAgICAgICAgICAgZGF0YUZpZWxkOiAndHJlZUluZm8nLFxyXG4gICAgICAgICAgICBwYXRoRmllbGQ6ICdwYXRoJyxcclxuICAgICAgICAgICAgbGF5ZXJGaWVsZDogJ2xheWVyJyxcclxuICAgICAgICAgICAgcGFyZW50RmllbGQ6ICdwYXJlbnRJZCcsXHJcbiAgICAgICAgICAgIGlzRGV0YWlsRmllbGQ6ICdpc0RldGFpbCcsXHJcbiAgICAgICAgICAgIHRyZWVEYXRhSXNJbml0OiBmYWxzZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gW1xyXG4gICAgICAgICAgICB7IHRpdGxlOiB0aGlzLmkxOG5SZXMuY29kZUZpZWxkLCBmaWVsZDogJ2NvZGUnLCBzZWFyY2hGaWVsZDogJ2NvZGUnIH0sXHJcbiAgICAgICAgICAgIHsgdGl0bGU6IHRoaXMuaTE4blJlcy5uYW1lRmllbGQsIGZpZWxkOiAnbmFtZScsIHNlYXJjaEZpZWxkOiAnbmFtZScgfSxcclxuICAgICAgICBdO1xyXG4gICAgICAgIC8vIOW8guatpeWKoOi9veeahOivnemcgOimgeW8gOWQr+i/meS4pOS4quW8gOWFs1xyXG4gICAgICAgIGlmICh0aGlzLmFzeW5jKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJlZUluZm8ubG9hZERhdGFUeXBlID0gJ2FzeW5jJztcclxuICAgICAgICAgICAgdGhpcy50cmVlSW5mby50cmVlRGF0YUlzSW5pdCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHdlYmFwaeWIneWni1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zb3VyY2VUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ29yZyc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFVcmkgPSBzeXNPcmdIZWxwICsgdGhpcy5zeXNVdGlsLnN5c09yZ1dlYkFwaTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmkxOG5SZXMudXNlck9yZ1RpdGxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3VzZXJncm91cCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFVcmkgPSB1c2VyR3JvdXBIZWxwICsgdGhpcy5zeXNVdGlsLnVzZXJHcm91cFdlYkFwaTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmkxOG5SZXMudXNlckdyb3VwVGl0bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAncG9zaXRpb25ncm91cCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFVcmkgPSBwb3NHcm91cEhlbHAgKyB0aGlzLnN5c1V0aWwucG9zR3JvdXBXZWJBcGk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5pMThuUmVzLnBvc2l0aW9uR3JvdXBUaXRsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdyb2xlZ3JvdXAnOlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhVXJpID0gcm9sZUdyb3VwSGVscCArIHRoaXMuc3lzVXRpbC5yb2xlR3JvdXBXZWJBcGk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5pMThuUmVzLnJvbGVHcm91cFRpdGxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOW/hemhu+imgeacie+8jOWQpuWImeWIneWni+mAieS4reS4jei1t+S9nOeUqFxyXG4gICAgICAgIHRoaXMuZmFycmlzTG9va1VwLm1hcEZpZWxkcyA9IHsgaWQ6ICdpZCcsIG5hbWU6ICduYW1lJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDluK7liqnliY3kuovku7Ys5by66KGM5Lyg6YCS6L+H5ruk5p2h5Lu2ICovXHJcbiAgICBiZWZvcmVPcGVuID0gKGFyZykgPT4ge1xyXG4gICAgICAgIC8v5aaC5p6c5pyJ6L+H5ruk5p2h5Lu277yM6ZmE5Yqg5YiwdXJs6Lev5b6EXHJcbiAgICAgICAgbGV0IGZhcnJpc1NlbGVjdGVkRGF0YSA9IFtdO1xyXG4gICAgICAgIGxldCBzZWxlY3RlZERhdGEgPSBbXTtcclxuICAgICAgICBsZXQgdGVtcCA9IDA7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuYmluZGluZ0RhdGEhPW51bGwmJnRoaXMuYmluZGluZ0RhdGEuaWQhPW51bGwmJnRoaXMuYmluZGluZ0RhdGEuaWQhPVwiXCIpe1xyXG4gICAgICAgICAgICBzZWxlY3RlZERhdGEgPSB0aGlzLmJpbmRpbmdEYXRhLmlkLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZERhdGFOYW1lID0gdGhpcy5iaW5kaW5nRGF0YS5uYW1lLnNwbGl0KCcsJyk7XHJcblxyXG4gICAgICAgICAgICBzZWxlY3RlZERhdGEuZm9yRWFjaChpdGVtPT57XHJcbiAgICAgICAgICAgICAgICBmYXJyaXNTZWxlY3RlZERhdGEucHVzaCh7XCJpZFwiOml0ZW0sXCJuYW1lXCI6c2VsZWN0ZWREYXRhTmFtZVt0ZW1wXX0pO1xyXG4gICAgICAgICAgICAgICAgdGVtcCA9IHRlbXArMTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gb2Yoe1xyXG4gICAgICAgICAgICBzaG93RGlhbG9nOiB0cnVlLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBmaWx0ZXI6IHRoaXMuZmlsdGVyLFxyXG4gICAgICAgICAgICAgICAgYWxsRGF0YTogdGhpcy5hbGxEYXRhLFxyXG4gICAgICAgICAgICAgICAgZmFycmlzU2VsZWN0ZWREYXRhOmZhcnJpc1NlbGVjdGVkRGF0YVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOW4ruWKqeWFs+mXreWJjeS6i+S7tiznm67liY3ml6DorrrmmK/lkKbpg73kvJrnu6fnu63otbBhZnRlck9r5pig5bCE5LqL5Lu2ICovXHJcbiAgICBkaWN0UGlja2VkID0gKGFyZzogYW55KTogT2JzZXJ2YWJsZTxQaWNrZWRSZXN1bHQ+ID0+IHtcclxuICAgICAgICBpZiAodGhpcy51c2VCZWZvcmVDbG9zZUV2ZW50ICYmIHRoaXMuYmVmb3JlQ2xvc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlQ2xvc2UoYXJnKS5waXBlKG1hcCh2YWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c6IO95YWz6Zet77yM6LCD55So5ZCO5LqL5Lu2XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsLmNsb3NlRGlhbG9nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckNvbmZpcm0ubmV4dChhcmcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih7IGNsb3NlRGlhbG9nOiB0cnVlIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKiDluK7liqnmmKDlsITlkI7kuovku7YgKi9cclxuICAgIGFmdGVyT2sgPSAoaGVscGRhdGEsIG1hcGZpZWxkcykgPT4ge1xyXG4gICAgICAgIC8vIOWmguaenOWQr+eUqOS6huWFs+mXreWJjeagoemqjOS6i+S7tu+8jOS4jei1sOi/memHjFxyXG4gICAgICAgIGlmICh0aGlzLnVzZUJlZm9yZUNsb3NlRXZlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaGVscGRhdGEpIHtcclxuICAgICAgICAgICAgLy8g5aSa6YCJ55qE6K+d6ZyA6KaB5aSE55CGLOW4ruWKqeW3sumAl+WPt+S4uumXtOmalFxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc2luZ2xlU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpZExpc3Q6IHN0cmluZ1tdID0gaGVscGRhdGEubWFwKGl0ZW0gPT4gaXRlbS5pZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lTGlzdDogc3RyaW5nW10gPSBoZWxwZGF0YS5tYXAoaXRlbSA9PiBpdGVtLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kaW5nRGF0YS5pZCA9IGlkTGlzdC5qb2luKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJpbmRpbmdEYXRhLm5hbWUgPSBuYW1lTGlzdC5qb2luKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlUeHQgPSB0aGlzLmJpbmRpbmdEYXRhLm5hbWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFmdGVyQ29uZmlybS5uZXh0KGhlbHBkYXRhKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDluK7liqnmmL7npLpcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheVR4dCA9IGhlbHBkYXRhLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNob3dBbGxQYXRoT3JnKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5c0hlbHBTZXJ2aWNlLmdldFBhcmVudE9yZyhoZWxwZGF0YSkuc3Vic2NyaWJlKGl0ZW1zPT57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW1zJiZpdGVtcy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWxwZGF0YS5hbGxQYXRoT3JnPWl0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWZ0ZXJDb25maXJtLm5leHQoaGVscGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhoZWxwZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFmdGVyQ29uZmlybS5uZXh0KGhlbHBkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Ugey8vIOebruWJjea4heepuuS8mui1sOi/memHjO+8jOiAjOS4lOS4pOasoVxyXG4gICAgICAgICAgICAvLyDop6blj5Hkuovku7ZcclxuICAgICAgICAgICAgdGhpcy5hZnRlckNvbmZpcm0ubmV4dChoZWxwZGF0YSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGhlbHBkYXRhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmuIXnqbrlkI4gKi9cclxuICAgIGFmdGVyQ2xlYXIoYXJnOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNsZWFyLm5leHQoYXJnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5omL5Yqo5pi+56S65biu5YqpICovXHJcbiAgICBwdWJsaWMgc2hvd0hlbHAoKSB7XHJcbiAgICAgICAgdGhpcy5mYXJyaXNMb29rVXAuc2hvd0RpYWxvZygpO1xyXG4gICAgfVxyXG4gICAgc2VhcmNoKCRldmVudCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coJGV2ZW50KTtcclxuICAgIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Input, EventEmitter, Output, HostListener, ElementRef } from '@angular/core';
import { TreeTableComponent } from '@farris/ui-treetable';
import { from } from 'rxjs';
import { GroupService } from './group.service';
import { filter } from 'rxjs/operators';
import { SysLocaleService } from '../../locale/sys-locale.service';
import { NAVI_LOCALE_ZHCHS } from '../../locale/locales/zh-cn/navigiation';
import { MessagerService } from '@farris/ui-messager';
import { NotifyService } from '@farris/ui-notify';
export class GroupNavComponent {
    /**
     * @param {?} groupService
     * @param {?} localService
     * @param {?} notifyService
     * @param {?} msg
     */
    constructor(groupService, localService, notifyService, msg) {
        this.groupService = groupService;
        this.localService = localService;
        this.notifyService = notifyService;
        this.msg = msg;
        this.showHeader = true;
        this.fixedHeader = true;
        this.withCodeColumn = true;
        // 是否添加所有根节点
        this.allRoot = false;
        this.selectKeys = [];
        this.needRemote = true;
        /**
         * 显示组织类型列
         */
        this.showNodeTypeColumn = false;
        this.showFilterBar = false;
        this.searchFields = [{ label: "编号", value: "code" }, { label: "名称", value: "name" }];
        this.allColumnsTitle = '所有列';
        this.search = new EventEmitter();
        this.selectRowChanged = new EventEmitter();
        /**
         * 查询内容
         */
        this.searchInfo = '';
        /**
         * 上次查询内容
         */
        this.oldSearchInfo = '';
        this.field = '';
        /**
         * 上次查询内容
         */
        this.oldField = '';
        //上次搜索结果
        this.searchResult = [];
        //上次搜索的位置
        this.searchIndex = 0;
        /**
         * 监控拖拽事件，重绘组织TreeTable
         * @param event 事件参数
         */
        this.temp = true;
    }
    /**
     * @return {?}
     */
    winResize() {
        this.reSizeTreeTable();
    }
    /**
     * 重绘Farris-TreeTable的大小
     * @param {?=} height
     * @param {?=} width
     * @return {?}
     */
    reSizeTreeTable(height = 0, width = 0) {
        if (height === 0) {
            height = this.farrisTreeParent.nativeElement.clientHeight;
        }
        if (width === 0) {
            width = this.farrisTreeParent.nativeElement.clientWidth;
        }
        this.farrisTt.resize({ height, width });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.localService) {
            this.i18nRes = this.localService.getComponentOpt('navi');
        }
        else {
            this.i18nRes = NAVI_LOCALE_ZHCHS;
        }
        this.searchFields = [{ label: this.i18nRes.codeField, value: "code" }, { label: this.i18nRes.nameField, value: "name" }];
        this.allColumnsTitle = this.i18nRes.allColumnsTitle;
        // 启用编号列
        if (this.withCodeColumn) {
            this.fixedHeader = true;
            this.showHeader = true;
            this.cols = [
                { field: 'code', title: this.i18nRes.codeField, width: 100 },
                { field: 'name', title: this.i18nRes.nameField, width: 100 }
            ];
        }
        else {
            this.fixedHeader = false;
            this.showHeader = false;
            this.cols = [
                { field: 'name', title: this.i18nRes.nameField, width: 100 }
            ];
        }
        // 需要获取数据，否则直接根据treeData初始数据
        if (this.needRemote) {
            // 所有标识
            if (this.allRoot) {
                this.treeData = [];
                /** @type {?} */
                const rootNode = {};
                rootNode.children = [];
                rootNode.data = {
                    id: 'all',
                    code: this.i18nRes.rootNodeCode,
                    name: this.i18nRes.rootNodeTitle
                };
                rootNode.expanded = true;
                rootNode.leaf = false;
                rootNode.selectable = true;
                this.treeData.push(rootNode);
            }
            else {
                this.treeData = [];
            }
            this.groupService.getByLayer(1, this.groupType, this.filter).subscribe((/**
             * @param {?} val
             * @return {?}
             */
            val => {
                this.initTreeNodeList(val);
            }));
        }
        else { // 不需要从服务器端获取
            this.farrisTt.updateSerializedValue();
        }
        // 异步加载，通过children为0来判断从未展开过节点
        this.farrisTt.expand.pipe(filter((/**
         * @param {?} node
         * @return {?}
         */
        (node) => node.children.length === 0))).subscribe((/**
         * @param {?} node
         * @return {?}
         */
        (node) => {
            node['showLoading'] = true;
            /** @type {?} */
            const id = node.data.id;
            // 获取系统组织
            this.groupService.getByParentId(id, this.groupType, this.filter).subscribe((/**
             * @param {?} list
             * @return {?}
             */
            (list) => {
                node['showLoading'] = false;
                /** @type {?} */
                const childNode = [];
                // 转换下级组织
                from(list).subscribe((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => {
                    childNode.push(this.convertToTreeNode(item));
                }));
                // 防止出现下级节点没有数据
                if (childNode.length > 0) {
                    this.farrisTt.appendChildren(childNode, node);
                }
                else { // 应该是无下级权限才走这里
                    node.leaf = true;
                    this.farrisTt.updateSerializedValue();
                }
            }));
        }));
    }
    /**
     * 刷新当前页面信息
     * @return {?}
     */
    refreshThisNav() {
        this.treeData = [];
        /** @type {?} */
        const rootNode = {};
        rootNode.children = [];
        rootNode.data = {
            id: 'all',
            code: this.i18nRes.rootNodeCode,
            name: this.i18nRes.rootNodeTitle
        };
        rootNode.expanded = true;
        rootNode.leaf = false;
        rootNode.selectable = true;
        this.treeData.push(rootNode);
        this.groupService.getByLayer(1, this.groupType, this.filter).subscribe((/**
         * @param {?} val
         * @return {?}
         */
        val => {
            this.initTreeNodeList(val);
        }));
    }
    /**
     * 页面渲染完成后
     * @return {?}
     */
    ngAfterContentInit() {
        this.reSizeTreeTable();
    }
    /**
     * 搜索， 此处是分层加载，搜索时需要根据原数据进行搜索，搜索后，需要将对应父节点展示
     * @param {?} args  格式 searchData = { field: '*', value: '' };
     * @return {?}
     */
    searchData(args) {
        this.search.next(args);
        if (!this.filter) {
            this.filter = {};
        }
        if (!args) {
            return;
        }
        this.searchInfo = args.value;
        this.field = args.field;
        // 搜索内容为空
        if (!this.searchInfo || this.searchInfo.length <= 0) {
            this.clearSearchValue();
            return;
        }
        // 搜索内容与上次不同，重新搜索
        if (this.oldSearchInfo !== this.searchInfo || this.oldField !== this.field) {
            this.filter.isSearchTree = true;
            if (this.field === '*') {
                this.filter.codeOrName = this.searchInfo;
                this.filter.code = '';
                this.filter.name = '';
            }
            else if (this.field === 'code') {
                this.filter.code = this.searchInfo;
                this.filter.name = '';
                this.filter.codeOrName = '';
            }
            else if (this.field === 'name') {
                this.filter.name = this.searchInfo;
                this.filter.code = '';
                this.filter.codeOrName = '';
            }
            this.groupService.searchData(this.groupType, this.filter).subscribe((/**
             * @param {?} list
             * @return {?}
             */
            list => {
                this.treeData = [];
                this.searchResult = [];
                this.searchIndex = 0;
                if (list && list.length > 0) {
                    this.treeData = this.makeTree(list);
                    list.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => {
                        if (item.search_data) {
                            this.searchResult.push(item.id);
                        }
                    }));
                    // 手动更新TreeTable的值
                    this.farrisTt.updateSerializedValue();
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.farrisTt.selectNode(this.searchResult[0]);
                        this.farrisTt.collapseAll();
                        this.expandParent(this.searchResult[0]);
                        this.farrisTt.scrollToCurrentNode();
                    }));
                }
                else {
                    // 手动更新TreeTable的值
                    this.farrisTt.updateSerializedValue();
                    this.notifyService.info(this.i18nRes.searchNullData);
                }
            }));
        }
        else {
            if (this.searchResult && this.searchResult.length > 0) {
                this.searchIndex = this.searchIndex + 1;
                // 已经搜索到最后，需要重头搜索
                if (this.searchIndex === this.searchResult.length) {
                    this.searchIndex = 0;
                }
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.farrisTt.selectNode(this.searchResult[this.searchIndex]);
                    this.farrisTt.collapseAll();
                    this.expandParent(this.searchResult[this.searchIndex]);
                    this.farrisTt.scrollToCurrentNode();
                }));
            }
            else {
                this.notifyService.info(this.i18nRes.searchNullData);
            }
        }
        this.oldSearchInfo = this.searchInfo;
        this.oldField = this.field;
    }
    /**
     * @return {?}
     */
    clearSearchValue() {
        //点击清除时，防止事件执行两次
        if (!this.temp) {
            return;
        }
        this.temp = false;
        // 所有标识
        if (this.allRoot) {
            this.treeData = [];
            /** @type {?} */
            const rootNode = {};
            rootNode.children = [];
            rootNode.data = {
                id: 'all',
                code: this.i18nRes.rootNodeCode,
                name: this.i18nRes.rootNodeTitle
            };
            rootNode.expanded = true;
            rootNode.leaf = false;
            rootNode.selectable = true;
            this.treeData.push(rootNode);
        }
        else {
            this.treeData = [];
        }
        this.filter.isSearchTree = false;
        this.filter.codeOrName = null;
        this.filter.code = null;
        this.filter.name = null;
        this.groupService.getByLayer(1, this.groupType, this.filter).subscribe((/**
         * @param {?} val
         * @return {?}
         */
        val => {
            this.initTreeNodeList(val);
            if (this.treeData.length > 0) {
                this.farrisTt.selectNode(this.treeData[0].data.id);
            }
            this.temp = true;
        }));
        this.oldSearchInfo = '';
        this.oldField = '';
    }
    /**
     * 构造树
     * @private
     * @param {?} data
     * @return {?}
     */
    makeTree(data) {
        /** @type {?} */
        const root = data.filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.layer === 1)).map((/**
         * @param {?} t
         * @return {?}
         */
        t => {
            /** @type {?} */
            const node = {
                data: t,
                children: [],
                expanded: false,
                selectable: t.farris_selectable
            };
            if (!t.isDetail) {
                node.leaf = false;
                node.children = [];
            }
            return node;
        }));
        root.forEach((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            // 构造下级：children，父级的id信息
            e.children = this.makeChildrenByParentId(data, e.data.id);
        }));
        return root;
    }
    /**
     * 父节点构造树
     * @private
     * @param {?} datas
     * @param {?} parentId
     * @return {?}
     */
    makeChildrenByParentId(datas, parentId) {
        /** @type {?} */
        const x = datas.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c.parentId === parentId)).map((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            return {
                data: d,
                children: this.makeChildrenByParentId(datas, d.id),
                expanded: false,
                selectable: d.farris_selectable
            };
        }));
        return x;
    }
    /**
     * 将组织实体转换为Farris-TreeNode
     * @private
     * @param {?} src
     * @return {?}
     */
    convertToTreeNode(src) {
        /** @type {?} */
        const node = { data: src };
        // 非明细节点
        if (!src.isDetail) {
            node.leaf = false;
            node.children = [];
        }
        // TODO: 只有有权限的组织才能被选中,还是这里不做处理，发送事件时去处理
        node.selectable = src.farris_selectable;
        return node;
    }
    /**
     * 初始顶级分组，默认layer=1的情况
     * @private
     * @param {?} list
     * @return {?}
     */
    initTreeNodeList(list) {
        if (!list || list.length === 0) {
            return;
        }
        from(list).subscribe((/**
         * @param {?} firstLayer
         * @return {?}
         */
        firstLayer => {
            /** @type {?} */
            const node = this.convertToTreeNode(firstLayer);
            // 非明细，带往下多构造一级，假设有数据
            if (node.leaf) {
                /** @type {?} */
                const curId = firstLayer.id;
                /** @type {?} */
                const childern = list.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item.parentId === curId));
                from(childern).subscribe((/**
                 * @param {?} secondLayer
                 * @return {?}
                 */
                secondLayer => {
                    node.children.push(this.convertToTreeNode(secondLayer));
                }));
            }
            // 如果添加所有根节点
            if (this.allRoot) {
                this.treeData[0].children.push(node);
            }
            else {
                this.treeData.push(node);
            }
        }));
        // 手动更新TreeTable的值
        this.farrisTt.updateSerializedValue();
    }
    /**
     * 选择的组织行
     * @param {?} event
     * @return {?}
     */
    onNodeSelect(event) {
        console.log(event.node.data);
        this.selectRowChanged.next(event.node.data);
    }
    /**
     * 获取当前TreeTable的绑定数据
     * @return {?}
     */
    getTreeData() {
        return this.treeData;
    }
    /**
     * 获取当前TreeTable的组件实例
     * @return {?}
     */
    getTreeTableComp() {
        return this.farrisTt;
    }
    /**
     * 选中某个节点
     * @param {?} id
     * @param {?=} isCheck
     * @return {?}
     */
    selectNode(id, isCheck) {
        this.farrisTt.selectNode(id, isCheck);
    }
    /**
     * 清除所有选中值
     * @return {?}
     */
    unCheckAllNodes() {
        this.farrisTt.unCheckAllNodes();
    }
    /**
     * 清除所有选中值
     * @param {?} key
     * @return {?}
     */
    scrollToCurrentNode(key) {
        if (key) {
            this.farrisTt.selectNode(key);
            this.expandParent(key);
            this.farrisTt.scrollToCurrentNode();
        }
    }
    /**
     * 逐一找到需要展开的父节点，全部展开
     * @param {?} key
     * @return {?}
     */
    expandParent(key) {
        /** @type {?} */
        const parent = this.farrisTt.findRowNode(key);
        /** @type {?} */
        let parentNode = parent.parent;
        if (parentNode) {
            while (parentNode) {
                this.farrisTt.expandNode(parentNode.id);
                parentNode = parentNode.parent;
            }
        }
        else {
            // this.farrisTt.expandNode(key);
        }
    }
}
GroupNavComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-group-nav',
                template: "<div #farrisTreeParent class=\"f-utils-fill-flex-column\" style=\"background-color: white\">\r\n    <farris-treetable #farrisTt \r\n    [data]=\"this.treeData\" \r\n    [columns]=\"cols\" \r\n    [idField]=\"'id'\" \r\n    [fixedHeader]=\"fixedHeader\" \r\n    [showHeader]=\"showHeader\" \r\n    [fit]=\"true\" \r\n    [resizableColumns]=\"true\"\r\n    [fitColumns]=\"true\"\r\n    [(showFilterBar)]=\"showFilterBar\"\r\n    (search)=\"searchData($event)\"\r\n    [searchFields]=\"searchFields\"\r\n    [allColumnsTitle]=\"allColumnsTitle\"\r\n    (clearSearchValue)=\"clearSearchValue()\"\r\n    (nodeSelected)=\"onNodeSelect($event)\">\r\n    </farris-treetable>\r\n</div>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
GroupNavComponent.ctorParameters = () => [
    { type: GroupService },
    { type: SysLocaleService },
    { type: NotifyService },
    { type: MessagerService }
];
GroupNavComponent.propDecorators = {
    farrisTreeParent: [{ type: ViewChild, args: ['farrisTreeParent',] }],
    farrisTt: [{ type: ViewChild, args: ['farrisTt',] }],
    title: [{ type: Input }],
    showHeader: [{ type: Input }],
    fixedHeader: [{ type: Input }],
    withCodeColumn: [{ type: Input }],
    allRoot: [{ type: Input }],
    groupType: [{ type: Input }],
    filter: [{ type: Input }],
    selectKeys: [{ type: Input }],
    needRemote: [{ type: Input }],
    showNodeTypeColumn: [{ type: Input }],
    treeData: [{ type: Input }],
    showFilterBar: [{ type: Input }],
    search: [{ type: Output }],
    selectRowChanged: [{ type: Output }],
    winResize: [{ type: HostListener, args: ['window:resize', [],] }]
};
if (false) {
    /** @type {?} */
    GroupNavComponent.prototype.farrisTreeParent;
    /** @type {?} */
    GroupNavComponent.prototype.farrisTt;
    /** @type {?} */
    GroupNavComponent.prototype.title;
    /** @type {?} */
    GroupNavComponent.prototype.showHeader;
    /** @type {?} */
    GroupNavComponent.prototype.fixedHeader;
    /** @type {?} */
    GroupNavComponent.prototype.withCodeColumn;
    /** @type {?} */
    GroupNavComponent.prototype.allRoot;
    /** @type {?} */
    GroupNavComponent.prototype.groupType;
    /** @type {?} */
    GroupNavComponent.prototype.filter;
    /** @type {?} */
    GroupNavComponent.prototype.selectKeys;
    /** @type {?} */
    GroupNavComponent.prototype.needRemote;
    /**
     * 显示组织类型列
     * @type {?}
     */
    GroupNavComponent.prototype.showNodeTypeColumn;
    /** @type {?} */
    GroupNavComponent.prototype.treeData;
    /** @type {?} */
    GroupNavComponent.prototype.showFilterBar;
    /** @type {?} */
    GroupNavComponent.prototype.searchFields;
    /** @type {?} */
    GroupNavComponent.prototype.allColumnsTitle;
    /** @type {?} */
    GroupNavComponent.prototype.search;
    /** @type {?} */
    GroupNavComponent.prototype.selectRowChanged;
    /** @type {?} */
    GroupNavComponent.prototype.cols;
    /** @type {?} */
    GroupNavComponent.prototype.i18nRes;
    /**
     * 查询内容
     * @type {?}
     */
    GroupNavComponent.prototype.searchInfo;
    /**
     * 上次查询内容
     * @type {?}
     */
    GroupNavComponent.prototype.oldSearchInfo;
    /** @type {?} */
    GroupNavComponent.prototype.field;
    /**
     * 上次查询内容
     * @type {?}
     */
    GroupNavComponent.prototype.oldField;
    /** @type {?} */
    GroupNavComponent.prototype.searchResult;
    /** @type {?} */
    GroupNavComponent.prototype.searchIndex;
    /**
     * 监控拖拽事件，重绘组织TreeTable
     * \@param event 事件参数
     * @type {?}
     */
    GroupNavComponent.prototype.temp;
    /** @type {?} */
    GroupNavComponent.prototype.groupService;
    /** @type {?} */
    GroupNavComponent.prototype.localService;
    /**
     * @type {?}
     * @private
     */
    GroupNavComponent.prototype.notifyService;
    /** @type {?} */
    GroupNavComponent.prototype.msg;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXAtbmF2LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atc3lzL3N5c21nci11aS8iLCJzb3VyY2VzIjpbImxpYi9zeXMtbWFuYWdlci11aS9ncm91cC1uYXYvZ3JvdXAtbmF2LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBb0IsTUFBTSxlQUFlLENBQUM7QUFDdEksT0FBTyxFQUFFLGtCQUFrQixFQUFZLE1BQU0sc0JBQXNCLENBQUM7QUFDcEUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXhDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFPbEQsTUFBTSxPQUFPLGlCQUFpQjs7Ozs7OztJQW9EMUIsWUFDVyxZQUEwQixFQUMxQixZQUE4QixFQUM3QixhQUE0QixFQUM3QixHQUFvQjtRQUhwQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixpQkFBWSxHQUFaLFlBQVksQ0FBa0I7UUFDN0Isa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDN0IsUUFBRyxHQUFILEdBQUcsQ0FBaUI7UUFuRHRCLGVBQVUsR0FBRyxJQUFJLENBQUM7UUFDbEIsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbkIsbUJBQWMsR0FBRyxJQUFJLENBQUM7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QUNMLEtBQUs7NEJBQ0wsS0FBSztxQkFHTCxNQUFNOytCQUVOLE1BQU07d0JBeUJOLFlBQVksU0FBQyxlQUFlLEVBQUUsRUFBRTs7OztJQTlDakMsNkNBQTREOztJQUM1RCxxQ0FBb0Q7O0lBQ3BELGtDQUF1Qjs7SUFDdkIsdUNBQTJCOztJQUMzQix3Q0FBNEI7O0lBQzVCLDJDQUErQjs7SUFFL0Isb0NBQXlCOztJQUN6QixzQ0FBeUQ7O0lBRXpELG1DQUE0Qjs7SUFDNUIsdUNBQW1DOztJQUNuQyx1Q0FBMkI7Ozs7O0lBRTNCLCtDQUFvQzs7SUFDcEMscUNBQThCOztJQUM5QiwwQ0FBdUM7O0lBQ3ZDLHlDQUE2RTs7SUFDN0UsNENBQXFCOztJQUNyQixtQ0FBOEQ7O0lBRTlELDZDQUF3RTs7SUFFeEUsaUNBQVk7O0lBQ1osb0NBQWE7Ozs7O0lBR2IsdUNBQWdCOzs7OztJQUVoQiwwQ0FBbUI7O0lBRW5CLGtDQUFXOzs7OztJQUVYLHFDQUFjOztJQUdkLHlDQUFrQjs7SUFFbEIsd0NBQWdCOzs7Ozs7SUFNaEIsaUNBQVk7O0lBT1IseUNBQWlDOztJQUNqQyx5Q0FBcUM7Ozs7O0lBQ3JDLDBDQUFvQzs7SUFDcEMsZ0NBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBIb3N0TGlzdGVuZXIsIEVsZW1lbnRSZWYsIEFmdGVyQ29udGVudEluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHJlZVRhYmxlQ29tcG9uZW50LCBUcmVlTm9kZSB9IGZyb20gJ0BmYXJyaXMvdWktdHJlZXRhYmxlJztcclxuaW1wb3J0IHsgZnJvbSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBHcm91cFNlcnZpY2UgfSBmcm9tICcuL2dyb3VwLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IFRyZWVGaWx0ZXIgfSBmcm9tICcuLi9maWx0ZXIvdHJlZS1maWx0ZXInO1xyXG5pbXBvcnQgeyBTeXNMb2NhbGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbG9jYWxlL3N5cy1sb2NhbGUuc2VydmljZSc7XHJcbmltcG9ydCB7IE5BVklfTE9DQUxFX1pIQ0hTIH0gZnJvbSAnLi4vLi4vbG9jYWxlL2xvY2FsZXMvemgtY24vbmF2aWdpYXRpb24nO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsaWItZ3JvdXAtbmF2JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9ncm91cC1uYXYuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vZ3JvdXAtbmF2LmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgR3JvdXBOYXZDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQge1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ2ZhcnJpc1RyZWVQYXJlbnQnKSBmYXJyaXNUcmVlUGFyZW50OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgnZmFycmlzVHQnKSBmYXJyaXNUdDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgQElucHV0KCkgdGl0bGU6IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHNob3dIZWFkZXIgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgZml4ZWRIZWFkZXIgPSB0cnVlO1xyXG4gICAgQElucHV0KCkgd2l0aENvZGVDb2x1bW4gPSB0cnVlO1xyXG4gICAgLy8g5piv5ZCm5re75Yqg5omA5pyJ5qC56IqC54K5XHJcbiAgICBASW5wdXQoKSBhbGxSb290ID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSBncm91cFR5cGU6ICd1c2VyJyB8ICdwb3NpdGlvbicgfCAncm9sZScgfCAnb3JnJztcclxuICAgIC8vIOm7mOiupOS4jeW8gOWQr+aVsOaNruadg+mZkOi/h+a7pFxyXG4gICAgQElucHV0KCkgZmlsdGVyOiBUcmVlRmlsdGVyO1xyXG4gICAgQElucHV0KCkgc2VsZWN0S2V5czogc3RyaW5nW10gPSBbXTtcclxuICAgIEBJbnB1dCgpIG5lZWRSZW1vdGUgPSB0cnVlO1xyXG4gICAgLyoqIOaYvuekuue7hOe7h+exu+Wei+WIlyAqL1xyXG4gICAgQElucHV0KCkgc2hvd05vZGVUeXBlQ29sdW1uID0gZmFsc2U7XHJcbiAgICBASW5wdXQoKSB0cmVlRGF0YTogVHJlZU5vZGVbXTtcclxuICAgIEBJbnB1dCgpIHNob3dGaWx0ZXJCYXI6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgc2VhcmNoRmllbGRzOmFueSA9IFt7bGFiZWw6IFwi57yW5Y+3XCIsdmFsdWU6IFwiY29kZVwifSx7bGFiZWw6IFwi5ZCN56ewXCIsdmFsdWU6IFwibmFtZVwifV07XHJcbiAgICBhbGxDb2x1bW5zVGl0bGU9J+aJgOacieWIlydcclxuICAgIEBPdXRwdXQoKSBzZWFyY2g6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gICAgQE91dHB1dCgpIHNlbGVjdFJvd0NoYW5nZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgICAvLyDmmL7npLrliJdcclxuICAgIGNvbHM6IGFueVtdO1xyXG4gICAgaTE4blJlczogYW55O1xyXG5cclxuICAgIC8qKiDmn6Xor6LlhoXlrrkgKi9cclxuICAgIHNlYXJjaEluZm8gPSAnJztcclxuICAgIC8qKiDkuIrmrKHmn6Xor6LlhoXlrrkgKi9cclxuICAgIG9sZFNlYXJjaEluZm8gPSAnJztcclxuXHJcbiAgICBmaWVsZCA9ICcnO1xyXG4gICAgLyoqIOS4iuasoeafpeivouWGheWuuSAqL1xyXG4gICAgb2xkRmllbGQgPSAnJztcclxuXHJcbiAgICAvL+S4iuasoeaQnOe0oue7k+aenFxyXG4gICAgc2VhcmNoUmVzdWx0ID0gW107XHJcbiAgICAvL+S4iuasoeaQnOe0oueahOS9jee9rlxyXG4gICAgc2VhcmNoSW5kZXggPSAwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog55uR5o6n5ouW5ou95LqL5Lu277yM6YeN57uY57uE57uHVHJlZVRhYmxlXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg5LqL5Lu25Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHRlbXAgPSB0cnVlO1xyXG5cclxuICAgIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbXSlcclxuICAgIHdpblJlc2l6ZSgpIHtcclxuICAgICAgICB0aGlzLnJlU2l6ZVRyZWVUYWJsZSgpO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIGdyb3VwU2VydmljZTogR3JvdXBTZXJ2aWNlLFxyXG4gICAgICAgIHB1YmxpYyBsb2NhbFNlcnZpY2U6IFN5c0xvY2FsZVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgICAgIHB1YmxpYyBtc2c6IE1lc3NhZ2VyU2VydmljZSxcclxuXHJcbiAgICApIHtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqIOmHjee7mEZhcnJpcy1UcmVlVGFibGXnmoTlpKflsI8gKi9cclxuICAgIHB1YmxpYyByZVNpemVUcmVlVGFibGUgKGhlaWdodDogbnVtYmVyID0gMCwgd2lkdGg6IG51bWJlciA9IDApIHtcclxuICAgICAgICBpZiAoaGVpZ2h0ID09PSAwKSB7XHJcbiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMuZmFycmlzVHJlZVBhcmVudC5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy5mYXJyaXNUcmVlUGFyZW50Lm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZmFycmlzVHQucmVzaXplKHsgaGVpZ2h0LCB3aWR0aCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9jYWxTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blJlcyA9IHRoaXMubG9jYWxTZXJ2aWNlLmdldENvbXBvbmVudE9wdCgnbmF2aScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blJlcyA9IE5BVklfTE9DQUxFX1pIQ0hTO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNlYXJjaEZpZWxkcyA9IFt7bGFiZWw6IHRoaXMuaTE4blJlcy5jb2RlRmllbGQsdmFsdWU6IFwiY29kZVwifSx7bGFiZWw6IHRoaXMuaTE4blJlcy5uYW1lRmllbGQsdmFsdWU6IFwibmFtZVwifV07XHJcbiAgICAgICAgdGhpcy5hbGxDb2x1bW5zVGl0bGU9dGhpcy5pMThuUmVzLmFsbENvbHVtbnNUaXRsZTtcclxuXHJcbiAgICAgICAgLy8g5ZCv55So57yW5Y+35YiXXHJcbiAgICAgICAgaWYgKHRoaXMud2l0aENvZGVDb2x1bW4pIHtcclxuICAgICAgICAgICAgdGhpcy5maXhlZEhlYWRlciA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvd0hlYWRlciA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY29scyA9IFtcclxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdjb2RlJywgdGl0bGU6IHRoaXMuaTE4blJlcy5jb2RlRmllbGQsIHdpZHRoOiAxMDAgfSxcclxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6IHRoaXMuaTE4blJlcy5uYW1lRmllbGQsIHdpZHRoOiAxMDAgfVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZml4ZWRIZWFkZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5zaG93SGVhZGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuY29scyA9IFtcclxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6IHRoaXMuaTE4blJlcy5uYW1lRmllbGQsIHdpZHRoOiAxMDAgfVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g6ZyA6KaB6I635Y+W5pWw5o2u77yM5ZCm5YiZ55u05o6l5qC55o2udHJlZURhdGHliJ3lp4vmlbDmja5cclxuICAgICAgICBpZiAodGhpcy5uZWVkUmVtb3RlKSB7XHJcbiAgICAgICAgICAgIC8vIOaJgOacieagh+ivhlxyXG4gICAgICAgICAgICBpZiAodGhpcy5hbGxSb290KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb290Tm9kZTogVHJlZU5vZGUgPSB7fTtcclxuICAgICAgICAgICAgICAgIHJvb3ROb2RlLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgICAgICByb290Tm9kZS5kYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAnYWxsJyxcclxuICAgICAgICAgICAgICAgICAgICBjb2RlOiB0aGlzLmkxOG5SZXMucm9vdE5vZGVDb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuaTE4blJlcy5yb290Tm9kZVRpdGxlXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcm9vdE5vZGUuZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcm9vdE5vZGUubGVhZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcm9vdE5vZGUuc2VsZWN0YWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhLnB1c2gocm9vdE5vZGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmdyb3VwU2VydmljZS5nZXRCeUxheWVyKDEsIHRoaXMuZ3JvdXBUeXBlLCB0aGlzLmZpbHRlcikuc3Vic2NyaWJlKHZhbCA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUcmVlTm9kZUxpc3QodmFsKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8g5LiN6ZyA6KaB5LuO5pyN5Yqh5Zmo56uv6I635Y+WXHJcbiAgICAgICAgICAgIHRoaXMuZmFycmlzVHQudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDlvILmraXliqDovb3vvIzpgJrov4djaGlsZHJlbuS4ujDmnaXliKTmlq3ku47mnKrlsZXlvIDov4foioLngrlcclxuICAgICAgICB0aGlzLmZhcnJpc1R0LmV4cGFuZC5waXBlKGZpbHRlcigobm9kZTogVHJlZU5vZGUpID0+IG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSkuc3Vic2NyaWJlKChub2RlOiBUcmVlTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICBub2RlWydzaG93TG9hZGluZyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBub2RlLmRhdGEuaWQ7XHJcbiAgICAgICAgICAgIC8vIOiOt+WPluezu+e7n+e7hOe7h1xyXG4gICAgICAgICAgICB0aGlzLmdyb3VwU2VydmljZS5nZXRCeVBhcmVudElkKGlkLCB0aGlzLmdyb3VwVHlwZSwgdGhpcy5maWx0ZXIpLnN1YnNjcmliZSgobGlzdDogYW55W10pID0+IHtcclxuICAgICAgICAgICAgICAgIG5vZGVbJ3Nob3dMb2FkaW5nJ10gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkTm9kZTogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy8g6L2s5o2i5LiL57qn57uE57uHXHJcbiAgICAgICAgICAgICAgICBmcm9tKGxpc3QpLnN1YnNjcmliZShpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZE5vZGUucHVzaCh0aGlzLmNvbnZlcnRUb1RyZWVOb2RlKGl0ZW0pKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8g6Ziy5q2i5Ye6546w5LiL57qn6IqC54K55rKh5pyJ5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhcnJpc1R0LmFwcGVuZENoaWxkcmVuKGNoaWxkTm9kZSwgbm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Ugey8vIOW6lOivpeaYr+aXoOS4i+e6p+adg+mZkOaJjei1sOi/memHjFxyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUubGVhZiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYXJyaXNUdC51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliLfmlrDlvZPliY3pobXpnaLkv6Hmga9cclxuICAgICAqL1xyXG4gICAgcmVmcmVzaFRoaXNOYXYoKXtcclxuICAgICAgICB0aGlzLnRyZWVEYXRhPVtdO1xyXG4gICAgICAgIGNvbnN0IHJvb3ROb2RlOiBUcmVlTm9kZSA9IHt9O1xyXG4gICAgICAgIHJvb3ROb2RlLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgcm9vdE5vZGUuZGF0YSA9IHtcclxuICAgICAgICAgICAgaWQ6ICdhbGwnLFxyXG4gICAgICAgICAgICBjb2RlOiB0aGlzLmkxOG5SZXMucm9vdE5vZGVDb2RlLFxyXG4gICAgICAgICAgICBuYW1lOiB0aGlzLmkxOG5SZXMucm9vdE5vZGVUaXRsZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcm9vdE5vZGUuZXhwYW5kZWQgPSB0cnVlO1xyXG4gICAgICAgIHJvb3ROb2RlLmxlYWYgPSBmYWxzZTtcclxuICAgICAgICByb290Tm9kZS5zZWxlY3RhYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnRyZWVEYXRhLnB1c2gocm9vdE5vZGUpO1xyXG4gICAgICAgIHRoaXMuZ3JvdXBTZXJ2aWNlLmdldEJ5TGF5ZXIoMSwgdGhpcy5ncm91cFR5cGUsIHRoaXMuZmlsdGVyKS5zdWJzY3JpYmUodmFsID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pbml0VHJlZU5vZGVMaXN0KHZhbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOmhtemdoua4suafk+WujOaIkOWQjiAqL1xyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0ICgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJlU2l6ZVRyZWVUYWJsZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDmkJzntKLvvIwg5q2k5aSE5piv5YiG5bGC5Yqg6L2977yM5pCc57Si5pe26ZyA6KaB5qC55o2u5Y6f5pWw5o2u6L+b6KGM5pCc57Si77yM5pCc57Si5ZCO77yM6ZyA6KaB5bCG5a+55bqU54i26IqC54K55bGV56S6IFxyXG4gICAgICogICBAcGFyYW0gYXJncyAg5qC85byPIHNlYXJjaERhdGEgPSB7IGZpZWxkOiAnKicsIHZhbHVlOiAnJyB9O1xyXG4gICAgICovXHJcbiAgICAgc2VhcmNoRGF0YShhcmdzOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnNlYXJjaC5uZXh0KGFyZ3MpO1xyXG4gICAgICAgIGlmICghdGhpcy5maWx0ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIWFyZ3Mpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VhcmNoSW5mbyA9IGFyZ3MudmFsdWU7XHJcbiAgICAgICAgdGhpcy5maWVsZCA9IGFyZ3MuZmllbGQ7XHJcblxyXG4gICAgICAgIC8vIOaQnOe0ouWGheWuueS4uuepulxyXG4gICAgICAgIGlmICghdGhpcy5zZWFyY2hJbmZvIHx8IHRoaXMuc2VhcmNoSW5mby5sZW5ndGggPD0gMCApIHtcclxuICAgICAgICAgICAgdGhpcy5jbGVhclNlYXJjaFZhbHVlKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g5pCc57Si5YaF5a655LiO5LiK5qyh5LiN5ZCM77yM6YeN5paw5pCc57SiXHJcbiAgICAgICAgaWYgKHRoaXMub2xkU2VhcmNoSW5mbyAhPT0gdGhpcy5zZWFyY2hJbmZvIHx8IHRoaXMub2xkRmllbGQgIT09IHRoaXMuZmllbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5maWx0ZXIuaXNTZWFyY2hUcmVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYodGhpcy5maWVsZCA9PT0gJyonKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyLmNvZGVPck5hbWUgPSB0aGlzLnNlYXJjaEluZm87XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlci5jb2RlID0gJyc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlci5uYW1lID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMuZmllbGQgPT09ICdjb2RlJyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlci5jb2RlID0gdGhpcy5zZWFyY2hJbmZvO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIubmFtZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIuY29kZU9yTmFtZSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgfWVsc2UgaWYodGhpcy5maWVsZCA9PT0gJ25hbWUnKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyLm5hbWUgPSB0aGlzLnNlYXJjaEluZm87XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlci5jb2RlID0gJyc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlci5jb2RlT3JOYW1lID0gJyc7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmdyb3VwU2VydmljZS5zZWFyY2hEYXRhKCB0aGlzLmdyb3VwVHlwZSwgdGhpcy5maWx0ZXIpLnN1YnNjcmliZShsaXN0ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZURhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoUmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gdGhpcy5tYWtlVHJlZShsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0LmZvckVhY2goaXRlbT0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtLnNlYXJjaF9kYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoUmVzdWx0LnB1c2goaXRlbS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOaJi+WKqOabtOaWsFRyZWVUYWJsZeeahOWAvFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFycmlzVHQudXBkYXRlU2VyaWFsaXplZFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhcnJpc1R0LnNlbGVjdE5vZGUodGhpcy5zZWFyY2hSZXN1bHRbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZhcnJpc1R0LmNvbGxhcHNlQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kUGFyZW50KHRoaXMuc2VhcmNoUmVzdWx0WzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mYXJyaXNUdC5zY3JvbGxUb0N1cnJlbnROb2RlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAvLyDmiYvliqjmm7TmlrBUcmVlVGFibGXnmoTlgLxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhcnJpc1R0LnVwZGF0ZVNlcmlhbGl6ZWRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5pbmZvKHRoaXMuaTE4blJlcy5zZWFyY2hOdWxsRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuc2VhcmNoUmVzdWx0ICYmIHRoaXMuc2VhcmNoUmVzdWx0Lmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hJbmRleCA9IHRoaXMuc2VhcmNoSW5kZXggKyAxO1xyXG4gICAgICAgICAgICAgICAgLy8g5bey57uP5pCc57Si5Yiw5pyA5ZCO77yM6ZyA6KaB6YeN5aS05pCc57SiXHJcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMuc2VhcmNoSW5kZXggPT09IHRoaXMuc2VhcmNoUmVzdWx0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mYXJyaXNUdC5zZWxlY3ROb2RlKHRoaXMuc2VhcmNoUmVzdWx0W3RoaXMuc2VhcmNoSW5kZXhdKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZhcnJpc1R0LmNvbGxhcHNlQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBhbmRQYXJlbnQodGhpcy5zZWFyY2hSZXN1bHRbdGhpcy5zZWFyY2hJbmRleF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmFycmlzVHQuc2Nyb2xsVG9DdXJyZW50Tm9kZSgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2UuaW5mbyh0aGlzLmkxOG5SZXMuc2VhcmNoTnVsbERhdGEpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vbGRTZWFyY2hJbmZvID0gdGhpcy5zZWFyY2hJbmZvO1xyXG4gICAgICAgIHRoaXMub2xkRmllbGQgPSB0aGlzLmZpZWxkO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNlYXJjaFZhbHVlKCl7XHJcbiAgICAgICAgLy/ngrnlh7vmuIXpmaTml7bvvIzpmLLmraLkuovku7bmiafooYzkuKTmrKFcclxuICAgICAgICBpZighdGhpcy50ZW1wKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRlbXAgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8g5omA5pyJ5qCH6K+GXHJcbiAgICAgICAgaWYgKHRoaXMuYWxsUm9vdCkge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IHJvb3ROb2RlOiBUcmVlTm9kZSA9IHt9O1xyXG4gICAgICAgICAgICByb290Tm9kZS5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgICAgICByb290Tm9kZS5kYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICdhbGwnLFxyXG4gICAgICAgICAgICAgICAgY29kZTogdGhpcy5pMThuUmVzLnJvb3ROb2RlQ29kZSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuaTE4blJlcy5yb290Tm9kZVRpdGxlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJvb3ROb2RlLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcm9vdE5vZGUubGVhZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICByb290Tm9kZS5zZWxlY3RhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy50cmVlRGF0YS5wdXNoKHJvb3ROb2RlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZmlsdGVyLmlzU2VhcmNoVHJlZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyLmNvZGVPck5hbWUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyLmNvZGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyLm5hbWUgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLmdyb3VwU2VydmljZS5nZXRCeUxheWVyKDEsIHRoaXMuZ3JvdXBUeXBlLCB0aGlzLmZpbHRlcikuc3Vic2NyaWJlKHZhbCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFRyZWVOb2RlTGlzdCh2YWwpO1xyXG4gICAgICAgICAgICBpZih0aGlzLnRyZWVEYXRhLmxlbmd0aD4wKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmFycmlzVHQuc2VsZWN0Tm9kZSh0aGlzLnRyZWVEYXRhWzBdLmRhdGEuaWQpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnRlbXAgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMub2xkU2VhcmNoSW5mbyA9ICcnO1xyXG4gICAgICAgIHRoaXMub2xkRmllbGQgPSAnJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaehOmAoOagkVxyXG4gICAgKi9cclxuICAgIHByaXZhdGUgbWFrZVRyZWUoZGF0YTogYW55W10pOiBUcmVlTm9kZVtdIHtcclxuICAgICAgICBjb25zdCByb290ID0gZGF0YS5maWx0ZXIodCA9PiB0LmxheWVyID09PSAxKS5tYXAodCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vZGU6IFRyZWVOb2RlID0geyBcclxuICAgICAgICAgICAgICAgIGRhdGE6IHQgLFxyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICAgICAgZXhwYW5kZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZTogdC5mYXJyaXNfc2VsZWN0YWJsZX07XHJcblxyXG4gICAgICAgICAgICBpZiAoIXQuaXNEZXRhaWwpIHtcclxuICAgICAgICAgICAgICAgIG5vZGUubGVhZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJvb3QuZm9yRWFjaChlID0+IHtcclxuICAgICAgICAgICAgLy8g5p6E6YCg5LiL57qn77yaY2hpbGRyZW7vvIzniLbnuqfnmoRpZOS/oeaBr1xyXG4gICAgICAgICAgICBlLmNoaWxkcmVuID0gdGhpcy5tYWtlQ2hpbGRyZW5CeVBhcmVudElkKGRhdGEsIGUuZGF0YS5pZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJvb3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDniLboioLngrnmnoTpgKDmoJFcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBtYWtlQ2hpbGRyZW5CeVBhcmVudElkKGRhdGFzOiBhbnlbXSwgcGFyZW50SWQ6IHN0cmluZyk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCB4ID0gZGF0YXMuZmlsdGVyKGMgPT4gYy5wYXJlbnRJZCA9PT0gcGFyZW50SWQpLm1hcChkID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IGQsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5tYWtlQ2hpbGRyZW5CeVBhcmVudElkKGRhdGFzLCBkLmlkKSxcclxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IGQuZmFycmlzX3NlbGVjdGFibGVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4geDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlsIbnu4Tnu4flrp7kvZPovazmjaLkuLpGYXJyaXMtVHJlZU5vZGVcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjb252ZXJ0VG9UcmVlTm9kZSAoc3JjOiBhbnkpOiBUcmVlTm9kZSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZTogVHJlZU5vZGUgPSB7IGRhdGE6IHNyYyB9O1xyXG4gICAgICAgIC8vIOmdnuaYjue7huiKgueCuVxyXG4gICAgICAgIGlmICghc3JjLmlzRGV0YWlsKSB7XHJcbiAgICAgICAgICAgIG5vZGUubGVhZiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBub2RlLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRPRE86IOWPquacieacieadg+mZkOeahOe7hOe7h+aJjeiDveiiq+mAieS4rSzov5jmmK/ov5nph4zkuI3lgZrlpITnkIbvvIzlj5HpgIHkuovku7bml7bljrvlpITnkIZcclxuICAgICAgICBub2RlLnNlbGVjdGFibGUgPSBzcmMuZmFycmlzX3NlbGVjdGFibGU7XHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vpobbnuqfliIbnu4TvvIzpu5jorqRsYXllcj0x55qE5oOF5Ya1XHJcbiAgICAgKiBAcGFyYW0gc3lzT3JnTGlzdCDns7vnu5/nu4Tnu4fliJfooahcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpbml0VHJlZU5vZGVMaXN0IChsaXN0OiBhbnlbXSkge1xyXG4gICAgICAgIGlmICghbGlzdCB8fCBsaXN0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZyb20obGlzdCkuc3Vic2NyaWJlKGZpcnN0TGF5ZXIgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBub2RlID0gdGhpcy5jb252ZXJ0VG9UcmVlTm9kZShmaXJzdExheWVyKTtcclxuICAgICAgICAgICAgLy8g6Z2e5piO57uG77yM5bim5b6A5LiL5aSa5p6E6YCg5LiA57qn77yM5YGH6K6+5pyJ5pWw5o2uXHJcbiAgICAgICAgICAgIGlmIChub2RlLmxlYWYpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cklkID0gZmlyc3RMYXllci5pZDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkZXJuID0gbGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLnBhcmVudElkID09PSBjdXJJZCk7XHJcbiAgICAgICAgICAgICAgICBmcm9tKGNoaWxkZXJuKS5zdWJzY3JpYmUoc2Vjb25kTGF5ZXIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4ucHVzaCh0aGlzLmNvbnZlcnRUb1RyZWVOb2RlKHNlY29uZExheWVyKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDlpoLmnpzmt7vliqDmiYDmnInmoLnoioLngrlcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWxsUm9vdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YVswXS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlRGF0YS5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8g5omL5Yqo5pu05pawVHJlZVRhYmxl55qE5YC8XHJcbiAgICAgICAgdGhpcy5mYXJyaXNUdC51cGRhdGVTZXJpYWxpemVkVmFsdWUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAieaLqeeahOe7hOe7h+ihjFxyXG4gICAgICogQHBhcmFtIGFyZyDlj4LmlbBcclxuICAgICAqL1xyXG4gICAgb25Ob2RlU2VsZWN0IChldmVudDogYW55KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXZlbnQubm9kZS5kYXRhKTtcclxuICAgICAgICB0aGlzLnNlbGVjdFJvd0NoYW5nZWQubmV4dChldmVudC5ub2RlLmRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5b2T5YmNVHJlZVRhYmxl55qE57uR5a6a5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRUcmVlRGF0YSAoKTogVHJlZU5vZGVbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZURhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blvZPliY1UcmVlVGFibGXnmoTnu4Tku7blrp7kvotcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFRyZWVUYWJsZUNvbXAgKCk6IFRyZWVUYWJsZUNvbXBvbmVudCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmFycmlzVHQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmAieS4reafkOS4quiKgueCuVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2VsZWN0Tm9kZSAoaWQ6IHN0cmluZywgaXNDaGVjaz86IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLmZhcnJpc1R0LnNlbGVjdE5vZGUoaWQsIGlzQ2hlY2spO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF6Zmk5omA5pyJ6YCJ5Lit5YC8XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyB1bkNoZWNrQWxsTm9kZXMgKCkge1xyXG4gICAgICAgIHRoaXMuZmFycmlzVHQudW5DaGVja0FsbE5vZGVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuIXpmaTmiYDmnInpgInkuK3lgLxcclxuICAgICAqL1xyXG4gICAgc2Nyb2xsVG9DdXJyZW50Tm9kZShrZXk6YW55KXtcclxuICAgICAgICBpZihrZXkpe1xyXG4gICAgICAgICAgICB0aGlzLmZhcnJpc1R0LnNlbGVjdE5vZGUoa2V5KTtcclxuICAgICAgICAgICAgdGhpcy5leHBhbmRQYXJlbnQoa2V5KTtcclxuICAgICAgICAgICAgdGhpcy5mYXJyaXNUdC5zY3JvbGxUb0N1cnJlbnROb2RlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0gXHJcbiAgICBcclxuICAgIC8qKiDpgJDkuIDmib7liLDpnIDopoHlsZXlvIDnmoTniLboioLngrnvvIzlhajpg6jlsZXlvIAgKi9cclxuICAgIGV4cGFuZFBhcmVudChrZXk6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuZmFycmlzVHQuZmluZFJvd05vZGUoa2V5KTtcclxuICAgICAgICBsZXQgcGFyZW50Tm9kZSA9IHBhcmVudC5wYXJlbnQ7XHJcbiAgICAgICAgaWYgKHBhcmVudE5vZGUpIHtcclxuICAgICAgICAgICAgd2hpbGUgKHBhcmVudE5vZGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmFycmlzVHQuZXhwYW5kTm9kZShwYXJlbnROb2RlLmlkKTtcclxuICAgICAgICAgICAgICAgIHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLnBhcmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZmFycmlzVHQuZXhwYW5kTm9kZShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuIl19
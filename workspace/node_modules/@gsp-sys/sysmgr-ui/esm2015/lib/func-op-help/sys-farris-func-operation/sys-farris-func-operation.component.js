/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, TemplateRef, Input, ElementRef, HostListener } from '@angular/core';
import { SysFuncOperationService } from '../service/sys-func-operation.service';
import { DatagridComponent } from '@farris/ui-datagrid';
import { TreeTableComponent } from '@farris/ui-treetable';
import { BizObjectService } from '../service/biz-object.service';
import { SysLocaleService } from '../../locale/sys-locale.service';
import { HELP_LOCALE_ZHCHS } from '../../locale/locales/zh-cn/help';
/**
 * 系统管理：功能操作左树有、右列表展示
 */
export class SysFarrisFuncOperationComponent {
    /**
     * @param {?} funcOpService
     * @param {?} bizObjectService
     * @param {?} localService
     */
    constructor(funcOpService, bizObjectService, localService) {
        this.funcOpService = funcOpService;
        this.bizObjectService = bizObjectService;
        this.localService = localService;
        this.multiSelect = false;
        /**
         * 是否只显示分组
         */
        this.onlyShowGroup = false;
        /**
         * 确认事件
         */
        this.afterConfirm = new EventEmitter();
        /**
         * 关闭事件
         */
        this.afterCancle = new EventEmitter();
        /**
         * 当前选中数据
         */
        this.curSelected = [];
        this.curSelectedKeys = [];
        this.gridColumns = [];
        this.opSearchTxt = null;
        /**
         * 格式化
         */
        this.funcGroupFormatter = (/**
         * @param {?} val
         * @param {?} data
         * @return {?}
         */
        (val, data) => {
            return this.getFuncGroup(data);
        });
    }
    /**
     * 监控拖拽事件，重绘组织TreeTable
     * @return {?}
     */
    winResize() {
        this.reSizeTreeTable();
    }
    /**
     * 重绘Farris-TreeTable的大小
     * @param {?=} height
     * @param {?=} width
     * @return {?}
     */
    reSizeTreeTable(height = 0, width = 0) {
        if (height === 0) {
            height = this.farrisTreeParent.nativeElement.clientHeight;
        }
        if (width === 0) {
            width = this.farrisTreeParent.nativeElement.clientWidth;
        }
        this.farrisTt.resize({ height, width });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.operationGrid.restService = null;
        this.operationGrid.virtualized = true;
        this.operationGrid.fitColumns = true;
        this.operationGrid.fit = true;
        if (this.localService) {
            this.i18nRes = this.localService.getComponentOpt('help');
        }
        else {
            this.i18nRes = HELP_LOCALE_ZHCHS;
        }
        // 只显示分组，功能菜单使用
        if (this.onlyShowGroup) {
            this.gridColumns = [
                { field: 'code', title: this.i18nRes.codeField, width: 120 },
                { field: 'name', title: this.i18nRes.nameField, width: 150 }
            ];
            // 私有方法，更新列
            // this.operationGrid['columnsChanged']();
        }
        else {
            this.gridColumns = [
                { field: 'code', title: this.i18nRes.codeField, width: 120 },
                { field: 'name', title: this.i18nRes.nameField, width: 150 },
                { field: 'parentId', title: this.i18nRes.opGroupField, formatter: this.funcGroupFormatter }
            ];
        }
        this.treeColumns = [
            { field: 'name', title: this.i18nRes.busTitle, width: 100 }
        ];
        // 多选
        if (this.gridSelectMode === 'multiple') {
            this.multiSelect = true;
        }
        this.loadData();
    }
    /**
     * 页面渲染完成后
     * @return {?}
     */
    ngAfterContentInit() {
        this.reSizeTreeTable();
    }
    /**
     * 加载数据,TODO 加载数据
     * @return {?}
     */
    loadData() {
        // 加载业务对象数据
        this.bizObjectService.getBizObjects().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            this.treeDataSrc = result;
            this.treeData = this.makeTree(result);
        }));
        // 加载功能操作数据
        this.funcOpService.getFuncOperations().subscribe((/**
         * @param {?} lists
         * @return {?}
         */
        lists => {
            // 只显示分组
            if (this.onlyShowGroup) {
                this.gridDataSrc = lists.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item.type == 0));
            }
            else {
                this.gridDataSrc = lists;
            }
            // 一定要延迟一段时间
            this.freshGridAndSelect(this.gridDataSrc.concat());
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            console.log('获取功能操作对象列表失败');
        }));
    }
    /**
     * 刷新列表显示
     * @private
     * @param {?} list
     * @return {?}
     */
    freshGridAndSelect(list) {
        this.operationGrid.clearAll();
        this.operationGrid.loadData(list);
        list.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            if (this.curSelectedKeys.indexOf(item.id) > -1) {
                this.operationGrid.checkRow(item.id, false);
                if (this.curSelected.indexOf(item) === -1) {
                    this.curSelected.push(item);
                }
            }
        }));
    }
    /**
     * 构造树
     * @private
     * @param {?} data
     * @return {?}
     */
    makeTree(data) {
        /** @type {?} */
        const root = data.filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.layer === 1)).map((/**
         * @param {?} t
         * @return {?}
         */
        t => {
            return {
                data: t,
                children: [],
                expanded: false,
                selectable: true
            };
        }));
        root.forEach((/**
         * @param {?} e
         * @return {?}
         */
        e => {
            // 构造下级：children，父级的id信息
            e.children = this.makeChildrenByParentId(data, e.data.id);
        }));
        // 默认展开第一个节点
        root[0].expanded = true;
        return root;
    }
    /**
     * 父节点构造树
     * @private
     * @param {?} datas
     * @param {?} parentId
     * @return {?}
     */
    makeChildrenByParentId(datas, parentId) {
        /** @type {?} */
        const x = datas.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c.parentID === parentId)).map((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            return {
                data: d,
                children: this.makeChildrenByParentId(datas, d.id),
                expanded: false,
                selectable: true
            };
        }));
        return x;
    }
    /**
     * 搜索时监测回车
     * @param {?} arg
     * @return {?}
     */
    onKeyUp(arg) {
        if (arg && arg.which === 13) {
            this.searchData();
        }
    }
    /**
     * 搜索
     * @return {?}
     */
    searchData() {
        // 测试
        if (!this.opSearchTxt) {
            // 全量的数据
            this.gridData = this.gridDataSrc;
            this.freshGridAndSelect(this.gridData);
            return;
        }
        /** @type {?} */
        const content = this.opSearchTxt.trim();
        if (!content) {
            // 全量的数据
            this.gridData = this.gridDataSrc;
            this.freshGridAndSelect(this.gridData);
            return;
        }
        /** @type {?} */
        const filter = content.toLowerCase();
        // 如果只显示分组
        if (this.onlyShowGroup) {
            this.gridData = this.gridDataSrc.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.code.toLowerCase().includes(filter) ||
                item.name.toLowerCase().includes(filter)));
        }
        else {
            // 需要显示操作的时候，搜索到上级时
            this.gridData = this.gridDataSrc.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.code.toLowerCase().includes(filter) ||
                item.name.toLowerCase().includes(filter) ||
                this.getFuncGroup(item).toLowerCase().includes(filter)));
        }
        this.freshGridAndSelect(this.gridData);
    }
    /**
     * 获取功能分组
     * @param {?} funcOpObj
     * @return {?}
     */
    getFuncGroup(funcOpObj) {
        // 获取父节点
        /** @type {?} */
        const parentId = funcOpObj.parentId;
        if (parentId) {
            /** @type {?} */
            const parentObj = this.gridDataSrc.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.id === parentId));
            if (parentObj !== null && parentObj.length > 0) {
                return parentObj[0].name;
            }
        }
        else {
            return '';
        }
    }
    /**
     * 业务对象变化后
     * @param {?} arg 业务对象参数
     * @return {?}
     */
    bizObjectChanged(arg) {
        if (!this.gridDataSrc || this.gridDataSrc.length === 0) {
            return;
        }
        /** @type {?} */
        const busId = arg.node.data.id;
        // 根据业务对象过滤
        /** @type {?} */
        const lists = this.gridDataSrc.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.businessId === busId));
        this.freshGridAndSelect(lists);
    }
    /**
     * 获取选中数据
     * @return {?}
     */
    getSelectedObject() {
        /** @type {?} */
        const rows = this.operationGrid.checkeds.map((/**
         * @param {?} item
         * @return {?}
         */
        item => item.data));
        return rows;
    }
    /**
     * 选中后
     * @param {?} row
     * @return {?}
     */
    checked(row) {
        console.log(row);
        if (row && row.id) {
            // 是否多选
            if (this.multiSelect) {
                if (this.curSelectedKeys.indexOf(row.id) < 0) {
                    this.curSelected.push(row.data);
                    this.curSelectedKeys.push(row.id);
                }
            }
            else {
                this.curSelected = [row.data];
                this.curSelectedKeys = [row.id];
            }
        }
    }
    /**
     * 取消选中列表
     * @param {?} row
     * @return {?}
     */
    unchecked(row) {
        console.log(row);
        if (row && row.id) {
            if (this.multiSelect) {
                /** @type {?} */
                const x = this.curSelectedKeys.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item === row.id));
                if (x >= 0) {
                    this.curSelectedKeys.splice(x, 1);
                    this.curSelected.splice(x, 1);
                }
            }
            else {
                this.curSelectedKeys = [];
                this.curSelected = [];
            }
        }
    }
    /**
     * 确认
     * @return {?}
     */
    confirm() {
        // const result = this.getSelectedObject();
        /** @type {?} */
        const result = this.curSelected;
        console.log(result);
        this.afterConfirm.next(result);
        // 取消-目的是在这里让模态框消失
        this.cancle();
    }
    /**
     * 取消
     * @return {?}
     */
    cancle() {
        this.afterCancle.next();
    }
}
SysFarrisFuncOperationComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-sys-farris-func-operation',
                template: "<div class=\"f-utils-absolute-all farris-split-section m-0\">\r\n    <layout [direction]=\"'h'\" [fill]=\"true\" [showBorder]=\"false\">\r\n        <layout-panel class=\"col-5 d-flex flex-column\" region=\"west\" [showBorder]=\"false\" [minWidth]=\"300\">\r\n            <div class=\"f-utils-absolute-all f-utils-flex-column farris-lsection\" style=\"background-color: white\">\r\n                <div #farrisTreeParent class=\"f-utils-fill-flex-column\" style=\"background-color: white\">   \r\n                    <farris-treetable #tt [data]=\"treeData\" [virtualized]=\"true\" [fit]=\"true\" [findField]=\"'name'\"\r\n                        [enableFindText]=\"true\" [showBorder]=\"true\" [columns]=\"treeColumns\" [idField]=\"'id'\"\r\n                        [fixedHeader]=\"true\" [showHeader]=\"true\" [remoteSort]=\"false\"\r\n                        (nodeSelected)=\"bizObjectChanged($event)\">\r\n                    </farris-treetable>\r\n                </div>\r\n            </div>\r\n        </layout-panel>\r\n        <layout-panel class=\"d-flex flex-column\" region=\"center\" [showBorder]=\"false\" [minWidth]=\"300\">\r\n            <div class=\"f-utils-absolute-all f-utils-flex-column farris-rsection\">\r\n                <form class=\"farris\u00AD-form mb-2\" style=\"width:300px;\">\r\n                    <div class=\"f-cmp-inputgroup\">\r\n                        <div class=\"input-group\"><input [(ngModel)]=\"opSearchTxt\"\r\n                                [ngModelOptions]=\"{standalone: true}\" class=\"form-control\" (keyup)=\"onKeyUp($event)\"\r\n                                placeholder=\"'\u7F16\u53F7\u6216\u8005\u540D\u79F0'\">\r\n                            <div class=\"input-group-append\"><span class=\"input-group-text\"\r\n                                    (click)=\"searchData()\">\r\n                                    <i class=\"k-icon k-i-search\"></i></span></div>\r\n                        </div>\r\n                    </div>\r\n                </form>\r\n                <!--\u5217\u8868\u4FE1\u606F-->\r\n                <div class=\"f-utils-fill-flex-column\">\r\n                    <farris-datagrid #operationGrid \r\n                    [columns]=\"gridColumns\" \r\n                    [showBorder]=\"true\"\r\n                    [virtualized]=\"true\"\r\n                    [fitColumns]=\"true\"\r\n                    [fit]=\"true\"\r\n                    [striped]=\"true\"\r\n                    [pagination]=\"false\"\r\n                    [showCheckbox]=\"true\"\r\n                    [selectOnCheck]=\"true\"\r\n                    [checkOnSelect]=\"true\"\r\n                    [multiSelect]=\"multiSelect\"\r\n                    (checked)=\"checked($event)\"\r\n                    (unChecked)=\"unchecked($event)\">\r\n                </farris-datagrid>\r\n                </div>\r\n            </div>\r\n        </layout-panel>\r\n    </layout>\r\n</div>\r\n<ng-template #btnOkAndCancle>\r\n    <button class=\"btn btn-sm btn-primary\" (click)=\"confirm()\">\u786E\u5B9A</button>\r\n    <button class=\"btn btn-sm btn-secondary\" (click)=\"cancle()\">\u53D6\u6D88</button>\r\n</ng-template>",
                styles: [""]
            }] }
];
/** @nocollapse */
SysFarrisFuncOperationComponent.ctorParameters = () => [
    { type: SysFuncOperationService },
    { type: BizObjectService },
    { type: SysLocaleService }
];
SysFarrisFuncOperationComponent.propDecorators = {
    bizObjectId: [{ type: Input }],
    gridSelectMode: [{ type: Input }],
    sessionId: [{ type: Input }],
    onlyShowGroup: [{ type: Input }],
    isGroupCanSelected: [{ type: Input }],
    afterConfirm: [{ type: Output }],
    afterCancle: [{ type: Output }],
    btnOkAndCancleRef: [{ type: ViewChild, args: ['btnOkAndCancle',] }],
    operationGrid: [{ type: ViewChild, args: ['operationGrid',] }],
    farrisTreeParent: [{ type: ViewChild, args: ['farrisTreeParent',] }],
    farrisTt: [{ type: ViewChild, args: ['tt',] }],
    winResize: [{ type: HostListener, args: ['window:resize', [],] }]
};
if (false) {
    /**
     * 业务对象,负责传递
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.bizObjectId;
    /**
     * 选择模式
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.gridSelectMode;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.multiSelect;
    /**
     * 已经废弃
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.sessionId;
    /**
     * 是否只显示分组
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.onlyShowGroup;
    /**
     * 分组能否被选择
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.isGroupCanSelected;
    /**
     * 确认事件
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.afterConfirm;
    /**
     * 关闭事件
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.afterCancle;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.btnOkAndCancleRef;
    /**
     * 功能操作全量数据
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.gridDataSrc;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.treeDataSrc;
    /**
     * 当前UI显示动能操作列表数据
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.gridData;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.treeData;
    /**
     * 当前选中数据
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.curSelected;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.curSelectedKeys;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.gridColumns;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.treeColumns;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.opSearchTxt;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.i18nRes;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.operationGrid;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.farrisTreeParent;
    /** @type {?} */
    SysFarrisFuncOperationComponent.prototype.farrisTt;
    /**
     * 格式化
     * @type {?}
     */
    SysFarrisFuncOperationComponent.prototype.funcGroupFormatter;
    /**
     * @type {?}
     * @private
     */
    SysFarrisFuncOperationComponent.prototype.funcOpService;
    /**
     * @type {?}
     * @private
     */
    SysFarrisFuncOperationComponent.prototype.bizObjectService;
    /**
     * @type {?}
     * @private
     */
    SysFarrisFuncOperationComponent.prototype.localService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzLWZhcnJpcy1mdW5jLW9wZXJhdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXN5cy9zeXNtZ3ItdWkvIiwic291cmNlcyI6WyJsaWIvZnVuYy1vcC1oZWxwL3N5cy1mYXJyaXMtZnVuYy1vcGVyYXRpb24vc3lzLWZhcnJpcy1mdW5jLW9wZXJhdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBb0IsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuSixPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUNoRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQVksa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNuRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7OztBQVVwRSxNQUFNLE9BQU8sK0JBQStCOzs7Ozs7SUE0RHhDLFlBQ1ksYUFBc0MsRUFDdEMsZ0JBQWtDLEVBQ2xDLFlBQThCO1FBRjlCLGtCQUFhLEdBQWIsYUFBYSxDQUF5QjtRQUN0QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLGlCQUFZLEdBQVosWUFBWSxDQUFrQjtRQXhEMUMsZ0JBQVcsR0FBRyxLQUFLLENBQUM7Ozs7UUFNcEIsa0JBQWEsR0FBRyxLQUFLLENBQUM7Ozs7UUFRdEIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBUyxDQUFDOzs7O1FBS3pDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8s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blZKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsK0JBQStCO2dCQUN6QyxrbkdBQXlEOzthQUU1RDs7OztZQWRRLHVCQUF1QjtZQUd2QixnQkFBZ0I7WUFDaEIsZ0JBQWdCOzs7MEJBY3BCLEtBQUs7NkJBRUwsS0FBSzt3QkFJTCxLQUFLOzRCQUdMLEtBQUs7aUNBR0wsS0FBSzsyQkFLTCxNQUFNOzBCQUtOLE1BQU07Z0NBR04sU0FBUyxTQUFDLGdCQUFnQjs0QkFxQjFCLFNBQVMsU0FBQyxlQUFlOytCQUN6QixTQUFTLFNBQUMsa0JBQWtCO3VCQUM1QixTQUFTLFNBQUMsSUFBSTt3QkFLYixZQUFZLFNBQUMsZUFBZSxFQUFFLEVBQUU7Ozs7Ozs7SUFyRGxDLHNEQUE2Qjs7Ozs7SUFFN0IseURBQ3NDOztJQUN0QyxzREFBb0I7Ozs7O0lBRXBCLG9EQUNrQjs7Ozs7SUFFbEIsd0RBQ3NCOzs7OztJQUV0Qiw2REFDNEI7Ozs7O0lBSTVCLHVEQUN5Qzs7Ozs7SUFJekMsc0RBQ3NDOztJQUV0Qyw0REFDb0M7Ozs7O0lBSXBDLHNEQUFtQjs7SUFDbkIsc0RBQW1COzs7OztJQUluQixtREFBZ0I7O0lBQ2hCLG1EQUFnQjs7Ozs7SUFJaEIsc0RBQXFCOztJQUNyQiwwREFBK0I7O0lBQy9CLHNEQUF3Qjs7SUFDeEIsc0RBQW1COztJQUNuQixzREFBbUI7O0lBQ25CLGtEQUFhOztJQUNiLHdEQUE2RDs7SUFDN0QsMkRBQTREOztJQUM1RCxtREFBOEM7Ozs7O0lBNEw5Qyw2REFFQzs7Ozs7SUFwTEcsd0RBQThDOzs7OztJQUM5QywyREFBMEM7Ozs7O0lBQzFDLHVEQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVsZW1lbnQgfSBmcm9tICdwcm90cmFjdG9yJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBJbnB1dCwgQWZ0ZXJDb250ZW50SW5pdCwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN5c0Z1bmNPcGVyYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9zeXMtZnVuYy1vcGVyYXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IEJpek9iamVjdFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2Jpei1vYmplY3Quc2VydmljZSc7XHJcbmltcG9ydCB7IFN5c0xvY2FsZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9sb2NhbGUvc3lzLWxvY2FsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSEVMUF9MT0NBTEVfWkhDSFMgfSBmcm9tICcuLi8uLi9sb2NhbGUvbG9jYWxlcy96aC1jbi9oZWxwJztcclxuXHJcbi8qKlxyXG4gKiDns7vnu5/nrqHnkIbvvJrlip/og73mk43kvZzlt6bmoJHmnInjgIHlj7PliJfooajlsZXnpLpcclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdhcHAtc3lzLWZhcnJpcy1mdW5jLW9wZXJhdGlvbicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vc3lzLWZhcnJpcy1mdW5jLW9wZXJhdGlvbi5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9zeXMtZmFycmlzLWZ1bmMtb3BlcmF0aW9uLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgU3lzRmFycmlzRnVuY09wZXJhdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCxBZnRlckNvbnRlbnRJbml0IHtcclxuXHJcbiAgICAvKiog5Lia5Yqh5a+56LGhLOi0n+i0o+S8oOmAkiAqL1xyXG4gICAgQElucHV0KCkgYml6T2JqZWN0SWQ6IHN0cmluZztcclxuICAgIC8qKiDpgInmi6nmqKHlvI8gKi9cclxuICAgIEBJbnB1dCgpXHJcbiAgICBncmlkU2VsZWN0TW9kZTogJ3NpbmdsZScgfCAnbXVsdGlwbGUnO1xyXG4gICAgbXVsdGlTZWxlY3QgPSBmYWxzZTtcclxuICAgIC8qKiDlt7Lnu4/lup/lvIMgKi9cclxuICAgIEBJbnB1dCgpXHJcbiAgICBzZXNzaW9uSWQ6IHN0cmluZztcclxuICAgIC8qKiDmmK/lkKblj6rmmL7npLrliIbnu4QgKi9cclxuICAgIEBJbnB1dCgpXHJcbiAgICBvbmx5U2hvd0dyb3VwID0gZmFsc2U7XHJcbiAgICAvKiog5YiG57uE6IO95ZCm6KKr6YCJ5oupICovXHJcbiAgICBASW5wdXQoKVxyXG4gICAgaXNHcm91cENhblNlbGVjdGVkOiBib29sZWFuO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnoa7orqTkuovku7ZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpXHJcbiAgICBhZnRlckNvbmZpcm0gPSBuZXcgRXZlbnRFbWl0dGVyPGFueVtdPigpO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlhbPpl63kuovku7ZcclxuICAgICAqL1xyXG4gICAgQE91dHB1dCgpXHJcbiAgICBhZnRlckNhbmNsZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gICAgLy8g5rOo5YWl5Yiw5biu5Yqp55qE56Gu6K6k5ZKM5Y+W5raI5oyJ6ZKuXHJcbiAgICBAVmlld0NoaWxkKCdidG5Pa0FuZENhbmNsZScpXHJcbiAgICBidG5Pa0FuZENhbmNsZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIC8qKlxyXG4gICAgICog5Yqf6IO95pON5L2c5YWo6YeP5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIGdyaWREYXRhU3JjOiBhbnlbXTtcclxuICAgIHRyZWVEYXRhU3JjOiBhbnlbXTtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5YmNVUnmmL7npLrliqjog73mk43kvZzliJfooajmlbDmja5cclxuICAgICAqL1xyXG4gICAgZ3JpZERhdGE6IGFueVtdO1xyXG4gICAgdHJlZURhdGE6IGFueVtdO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliY3pgInkuK3mlbDmja5cclxuICAgICAqL1xyXG4gICAgY3VyU2VsZWN0ZWQ6YW55W109W107XHJcbiAgICBjdXJTZWxlY3RlZEtleXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBncmlkQ29sdW1uczogYW55W10gPSBbXTtcclxuICAgIHRyZWVDb2x1bW5zOiBhbnlbXTtcclxuICAgIG9wU2VhcmNoVHh0ID0gbnVsbDtcclxuICAgIGkxOG5SZXM6IGFueTtcclxuICAgIEBWaWV3Q2hpbGQoJ29wZXJhdGlvbkdyaWQnKSBvcGVyYXRpb25HcmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIEBWaWV3Q2hpbGQoJ2ZhcnJpc1RyZWVQYXJlbnQnKSBmYXJyaXNUcmVlUGFyZW50OiBFbGVtZW50UmVmO1xyXG4gICAgQFZpZXdDaGlsZCgndHQnKSBmYXJyaXNUdDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gICAgLyoqXHJcbiAgICAgKiDnm5Hmjqfmi5bmi73kuovku7bvvIzph43nu5jnu4Tnu4dUcmVlVGFibGVcclxuICAgICAqIEBwYXJhbSBldmVudCDkuovku7blj4LmlbBcclxuICAgICAqL1xyXG4gICAgIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbXSlcclxuICAgICB3aW5SZXNpemUoKSB7XHJcbiAgICAgICAgIHRoaXMucmVTaXplVHJlZVRhYmxlKCk7XHJcbiAgICAgfVxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBmdW5jT3BTZXJ2aWNlOiBTeXNGdW5jT3BlcmF0aW9uU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGJpek9iamVjdFNlcnZpY2U6IEJpek9iamVjdFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBsb2NhbFNlcnZpY2U6IFN5c0xvY2FsZVNlcnZpY2VcclxuICAgICkge1xyXG4gICAgfVxyXG4gICAgLyoqIOmHjee7mEZhcnJpcy1UcmVlVGFibGXnmoTlpKflsI8gKi9cclxuICAgIHB1YmxpYyByZVNpemVUcmVlVGFibGUgKGhlaWdodDogbnVtYmVyID0gMCwgd2lkdGg6IG51bWJlciA9IDApIHtcclxuICAgICAgICBpZiAoaGVpZ2h0ID09PSAwKSB7XHJcbiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMuZmFycmlzVHJlZVBhcmVudC5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy5mYXJyaXNUcmVlUGFyZW50Lm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZmFycmlzVHQucmVzaXplKHsgaGVpZ2h0LCB3aWR0aCB9KTtcclxuICAgIH1cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9uR3JpZC5yZXN0U2VydmljZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25HcmlkLnZpcnR1YWxpemVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm9wZXJhdGlvbkdyaWQuZml0Q29sdW1ucyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25HcmlkLmZpdCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMubG9jYWxTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blJlcyA9IHRoaXMubG9jYWxTZXJ2aWNlLmdldENvbXBvbmVudE9wdCgnaGVscCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaTE4blJlcyA9IEhFTFBfTE9DQUxFX1pIQ0hTO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlj6rmmL7npLrliIbnu4TvvIzlip/og73oj5zljZXkvb/nlKhcclxuICAgICAgICBpZiAodGhpcy5vbmx5U2hvd0dyb3VwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZENvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnY29kZScsIHRpdGxlOiB0aGlzLmkxOG5SZXMuY29kZUZpZWxkLCB3aWR0aDogMTIwIH0sXHJcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiB0aGlzLmkxOG5SZXMubmFtZUZpZWxkLCB3aWR0aDogMTUwIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgLy8g56eB5pyJ5pa55rOV77yM5pu05paw5YiXXHJcbiAgICAgICAgICAgIC8vIHRoaXMub3BlcmF0aW9uR3JpZFsnY29sdW1uc0NoYW5nZWQnXSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZENvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnY29kZScsIHRpdGxlOiB0aGlzLmkxOG5SZXMuY29kZUZpZWxkLCB3aWR0aDogMTIwIH0sXHJcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiB0aGlzLmkxOG5SZXMubmFtZUZpZWxkLCB3aWR0aDogMTUwIH0sXHJcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAncGFyZW50SWQnLCB0aXRsZTogdGhpcy5pMThuUmVzLm9wR3JvdXBGaWVsZCwgZm9ybWF0dGVyOiB0aGlzLmZ1bmNHcm91cEZvcm1hdHRlciB9XHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudHJlZUNvbHVtbnMgPSBbXHJcbiAgICAgICAgICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6IHRoaXMuaTE4blJlcy5idXNUaXRsZSwgd2lkdGg6IDEwMCB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICAvLyDlpJrpgIlcclxuICAgICAgICBpZiAodGhpcy5ncmlkU2VsZWN0TW9kZSA9PT0gJ211bHRpcGxlJykge1xyXG4gICAgICAgICAgICB0aGlzLm11bHRpU2VsZWN0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDpobXpnaLmuLLmn5PlrozmiJDlkI4gKi9cclxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCAoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZVNpemVUcmVlVGFibGUoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiDliqDovb3mlbDmja4sVE9ETyDliqDovb3mlbDmja5cclxuICAgICAqL1xyXG4gICAgbG9hZERhdGEgKCkge1xyXG4gICAgICAgIC8vIOWKoOi9veS4muWKoeWvueixoeaVsOaNrlxyXG4gICAgICAgIHRoaXMuYml6T2JqZWN0U2VydmljZS5nZXRCaXpPYmplY3RzKCkuc3Vic2NyaWJlKChyZXN1bHQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhU3JjID0gcmVzdWx0O1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEYXRhID0gdGhpcy5tYWtlVHJlZShyZXN1bHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIOWKoOi9veWKn+iDveaTjeS9nOaVsOaNrlxyXG4gICAgICAgIHRoaXMuZnVuY09wU2VydmljZS5nZXRGdW5jT3BlcmF0aW9ucygpLnN1YnNjcmliZShsaXN0cyA9PiB7XHJcbiAgICAgICAgICAgIC8vIOWPquaYvuekuuWIhue7hFxyXG4gICAgICAgICAgICBpZiAodGhpcy5vbmx5U2hvd0dyb3VwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWREYXRhU3JjID0gbGlzdHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS50eXBlID09IDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkRGF0YVNyYyA9IGxpc3RzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOS4gOWumuimgeW7tui/n+S4gOauteaXtumXtFxyXG4gICAgICAgICAgICB0aGlzLmZyZXNoR3JpZEFuZFNlbGVjdCh0aGlzLmdyaWREYXRhU3JjLmNvbmNhdCgpKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6I635Y+W5Yqf6IO95pON5L2c5a+56LGh5YiX6KGo5aSx6LSlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yi35paw5YiX6KGo5pi+56S6XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZnJlc2hHcmlkQW5kU2VsZWN0IChsaXN0OiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9uR3JpZC5jbGVhckFsbCgpO1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9uR3JpZC5sb2FkRGF0YShsaXN0KTtcclxuICAgICAgICBsaXN0LmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuY3VyU2VsZWN0ZWRLZXlzLmluZGV4T2YoaXRlbS5pZCk+LTEpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcGVyYXRpb25HcmlkLmNoZWNrUm93KGl0ZW0uaWQsZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5jdXJTZWxlY3RlZC5pbmRleE9mKGl0ZW0pPT09LTEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VyU2VsZWN0ZWQucHVzaChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaehOmAoOagkVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG1ha2VUcmVlIChkYXRhOiBhbnlbXSk6IFRyZWVOb2RlW10ge1xyXG4gICAgICAgIGNvbnN0IHJvb3QgPSBkYXRhLmZpbHRlcih0ID0+IHQubGF5ZXIgPT09IDEpLm1hcCh0ID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IHQsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgICAgICBleHBhbmRlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RhYmxlOiB0cnVlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcm9vdC5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICAvLyDmnoTpgKDkuIvnuqfvvJpjaGlsZHJlbu+8jOeItue6p+eahGlk5L+h5oGvXHJcbiAgICAgICAgICAgIGUuY2hpbGRyZW4gPSB0aGlzLm1ha2VDaGlsZHJlbkJ5UGFyZW50SWQoZGF0YSwgZS5kYXRhLmlkKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyDpu5jorqTlsZXlvIDnrKzkuIDkuKroioLngrlcclxuICAgICAgICByb290WzBdLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gcm9vdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeItuiKgueCueaehOmAoOagkVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIG1ha2VDaGlsZHJlbkJ5UGFyZW50SWQgKGRhdGFzOiBhbnlbXSwgcGFyZW50SWQ6IHN0cmluZyk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCB4ID0gZGF0YXMuZmlsdGVyKGMgPT4gYy5wYXJlbnRJRCA9PT0gcGFyZW50SWQpLm1hcChkID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IGQsXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5tYWtlQ2hpbGRyZW5CeVBhcmVudElkKGRhdGFzLCBkLmlkKSxcclxuICAgICAgICAgICAgICAgIGV4cGFuZGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4geDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5pCc57Si5pe255uR5rWL5Zue6L2mXHJcbiAgICAgKi9cclxuICAgIG9uS2V5VXAgKGFyZzogYW55KSB7XHJcbiAgICAgICAgaWYgKGFyZyAmJiBhcmcud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoRGF0YSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5pCc57SiXHJcbiAgICAgKi9cclxuICAgIHNlYXJjaERhdGEgKCkge1xyXG4gICAgICAgIC8vIOa1i+ivlVxyXG4gICAgICAgIGlmICghdGhpcy5vcFNlYXJjaFR4dCkge1xyXG4gICAgICAgICAgICAvLyDlhajph4/nmoTmlbDmja5cclxuICAgICAgICAgICAgdGhpcy5ncmlkRGF0YSA9IHRoaXMuZ3JpZERhdGFTcmM7XHJcbiAgICAgICAgICAgIHRoaXMuZnJlc2hHcmlkQW5kU2VsZWN0KHRoaXMuZ3JpZERhdGEpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLm9wU2VhcmNoVHh0LnRyaW0oKTtcclxuICAgICAgICBpZiAoIWNvbnRlbnQpIHtcclxuICAgICAgICAgICAgLy8g5YWo6YeP55qE5pWw5o2uXHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmdyaWREYXRhU3JjO1xyXG4gICAgICAgICAgICB0aGlzLmZyZXNoR3JpZEFuZFNlbGVjdCh0aGlzLmdyaWREYXRhKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaWx0ZXIgPSBjb250ZW50LnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgLy8g5aaC5p6c5Y+q5pi+56S65YiG57uEXHJcbiAgICAgICAgaWYgKHRoaXMub25seVNob3dHcm91cCkge1xyXG4gICAgICAgICAgICB0aGlzLmdyaWREYXRhID0gdGhpcy5ncmlkRGF0YVNyYy5maWx0ZXIoaXRlbSA9PlxyXG4gICAgICAgICAgICAgICAgaXRlbS5jb2RlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyKSB8fFxyXG4gICAgICAgICAgICAgICAgaXRlbS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g6ZyA6KaB5pi+56S65pON5L2c55qE5pe25YCZ77yM5pCc57Si5Yiw5LiK57qn5pe2XHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZERhdGEgPSB0aGlzLmdyaWREYXRhU3JjLmZpbHRlcihpdGVtID0+XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNvZGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIpIHx8XHJcbiAgICAgICAgICAgICAgICBpdGVtLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIpIHx8XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEZ1bmNHcm91cChpdGVtKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlcikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZyZXNoR3JpZEFuZFNlbGVjdCh0aGlzLmdyaWREYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagvOW8j+WMllxyXG4gICAgICovXHJcbiAgICBmdW5jR3JvdXBGb3JtYXR0ZXIgPSAodmFsLCBkYXRhKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RnVuY0dyb3VwKGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5Yqf6IO95YiG57uEXHJcbiAgICAgKi9cclxuICAgIGdldEZ1bmNHcm91cCAoZnVuY09wT2JqOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgICAgIC8vIOiOt+WPlueItuiKgueCuVxyXG4gICAgICAgIGNvbnN0IHBhcmVudElkID0gZnVuY09wT2JqLnBhcmVudElkO1xyXG4gICAgICAgIGlmIChwYXJlbnRJZCkge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnRPYmogPSB0aGlzLmdyaWREYXRhU3JjLmZpbHRlcihpdGVtID0+IGl0ZW0uaWQgPT09IHBhcmVudElkKTtcclxuICAgICAgICAgICAgaWYgKHBhcmVudE9iaiAhPT0gbnVsbCAmJiBwYXJlbnRPYmoubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudE9ialswXS5uYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4muWKoeWvueixoeWPmOWMluWQjlxyXG4gICAgICogQHBhcmFtIGFyZyDkuJrliqHlr7nosaHlj4LmlbBcclxuICAgICAqL1xyXG4gICAgYml6T2JqZWN0Q2hhbmdlZCAoYXJnOiBhbnkpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZERhdGFTcmMgfHwgdGhpcy5ncmlkRGF0YVNyYy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBidXNJZCA9IGFyZy5ub2RlLmRhdGEuaWQ7XHJcbiAgICAgICAgLy8g5qC55o2u5Lia5Yqh5a+56LGh6L+H5rukXHJcbiAgICAgICAgY29uc3QgbGlzdHMgPSB0aGlzLmdyaWREYXRhU3JjLmZpbHRlcihpdGVtID0+XHJcbiAgICAgICAgICAgIGl0ZW0uYnVzaW5lc3NJZCA9PT0gYnVzSWQpO1xyXG4gICAgICAgIHRoaXMuZnJlc2hHcmlkQW5kU2VsZWN0KGxpc3RzKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6YCJ5Lit5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIGdldFNlbGVjdGVkT2JqZWN0KCk6IGFueVtdIHtcclxuICAgICAgICBjb25zdCByb3dzID0gdGhpcy5vcGVyYXRpb25HcmlkLmNoZWNrZWRzLm1hcChpdGVtID0+IGl0ZW0uZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIHJvd3M7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOmAieS4reWQjlxyXG4gICAgICovXHJcbiAgICBjaGVja2VkKHJvdykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJvdyk7XHJcbiAgICAgICAgaWYgKHJvdyAmJiByb3cuaWQpIHtcclxuICAgICAgICAgICAgLy8g5piv5ZCm5aSa6YCJXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmN1clNlbGVjdGVkS2V5cy5pbmRleE9mKHJvdy5pZCk8MCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJTZWxlY3RlZC5wdXNoKHJvdy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1clNlbGVjdGVkS2V5cy5wdXNoKHJvdy5pZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJTZWxlY3RlZD1bcm93LmRhdGFdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJTZWxlY3RlZEtleXMgPSBbcm93LmlkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5Y+W5raI6YCJ5Lit5YiX6KGoXHJcbiAgICAgKi9cclxuICAgIHVuY2hlY2tlZChyb3cpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhyb3cpO1xyXG4gICAgICAgIGlmIChyb3cgJiYgcm93LmlkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5jdXJTZWxlY3RlZEtleXMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbSA9PT0gcm93LmlkKTtcclxuICAgICAgICAgICAgICAgIGlmICh4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1clNlbGVjdGVkS2V5cy5zcGxpY2UoeCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJTZWxlY3RlZC5zcGxpY2UoeCwgMSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VyU2VsZWN0ZWRLZXlzID0gW107XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1clNlbGVjdGVkID0gW107XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDnoa7orqRcclxuICAgICAqL1xyXG4gICAgY29uZmlybSAoKSB7XHJcbiAgICAgICAgLy8gY29uc3QgcmVzdWx0ID0gdGhpcy5nZXRTZWxlY3RlZE9iamVjdCgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuY3VyU2VsZWN0ZWQ7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICB0aGlzLmFmdGVyQ29uZmlybS5uZXh0KHJlc3VsdCk7XHJcbiAgICAgICAgLy8g5Y+W5raILeebrueahOaYr+WcqOi/memHjOiuqeaooeaAgeahhua2iOWksVxyXG4gICAgICAgIHRoaXMuY2FuY2xlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWPlua2iFxyXG4gICAgICovXHJcbiAgICBjYW5jbGUgKCkge1xyXG4gICAgICAgIHRoaXMuYWZ0ZXJDYW5jbGUubmV4dCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG4iXX0=
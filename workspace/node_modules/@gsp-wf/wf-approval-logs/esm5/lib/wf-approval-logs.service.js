/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { of } from 'rxjs';
import { translate } from './service/i18n/index';
import { WfApprovalLogsComponent } from './wf-approval-logs.component';
var WfApprovalLogsService = /** @class */ (function () {
    function WfApprovalLogsService(msgService, injector, resolver, modalService) {
        this.msgService = msgService;
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
    }
    /**
     * 根据流程实例id打开审批记录弹框
     * @param procInstId 流程实例id
     */
    /**
     * 根据流程实例id打开审批记录弹框
     * @param {?} procInstId 流程实例id
     * @return {?}
     */
    WfApprovalLogsService.prototype.showByProcInstId = /**
     * 根据流程实例id打开审批记录弹框
     * @param {?} procInstId 流程实例id
     * @return {?}
     */
    function (procInstId) {
        if (!procInstId) {
            console.error("查看审批记录，procInstId参数为空");
            return;
        }
        /** @type {?} */
        var parameters = {
            procInstId: procInstId
        };
        this.showApprovalLog(parameters);
    };
    /**
     * 根据表单数据id打开审批记录弹框
     * @param dataId 表单数据id
     * @param params 其他参数 params.style 为datagrid时，弹框使用大的（520,760,960）
     */
    /**
     * 根据表单数据id打开审批记录弹框
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    WfApprovalLogsService.prototype.showByDataId = /**
     * 根据表单数据id打开审批记录弹框
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    function (dataId) {
        if (!dataId) {
            console.error("查看审批记录，dataId参数为空");
            return;
        }
        /** @type {?} */
        var parameters = {
            dataId: dataId
        };
        this.showApprovalLog(parameters);
    };
    /**
     * 查看审批记录
     * @param parameters
     */
    /**
     * 查看审批记录
     * @param {?} parameters
     * @return {?}
     */
    WfApprovalLogsService.prototype.showApprovalLog = /**
     * 查看审批记录
     * @param {?} parameters
     * @return {?}
     */
    function (parameters) {
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(WfApprovalLogsComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.DataId = parameters.dataId;
        compRef.instance.Style = parameters.style;
        compRef.instance.ProcInstId = parameters.procInstId;
        compRef.instance.IncludeAdminOperate = parameters.includeAdminOperate;
        compRef.instance.IncludeHistory = parameters.includeHistory;
        compRef.instance.fill();
        /** @type {?} */
        var modalConfig = {
            title: this.getI18nValue('static.approvalLogs.title'),
            width: parameters.style == 'datagrid' ? 960 : 520,
            height: parameters.style == 'datagrid' ? 500 : 520,
            showButtons: parameters.style == 'datagrid' ? true : false,
            buttons: compRef.instance.taskDialogFooter,
            beforeClose: this.beforeClose,
        };
        this.dialog = this.modalService.show(compRef, modalConfig);
        this.addEventListener();
    };
    /**
     * 获取多语
     * @param name
     * @returns
     */
    /**
     * 获取多语
     * @private
     * @param {?} name
     * @return {?}
     */
    WfApprovalLogsService.prototype.getI18nValue = /**
     * 获取多语
     * @private
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!name) {
            return '';
        }
        /** @type {?} */
        var defaultLang = localStorage.getItem('languageCode');
        /** @type {?} */
        var langData = defaultLang ? translate[defaultLang] : translate['zh-CHS'];
        /** @type {?} */
        var resultVal = '';
        if (name.indexOf('.') === -1) {
            resultVal = langData[name];
        }
        else {
            resultVal = name.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            function (obj, key) {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }), langData);
        }
        return resultVal;
    };
    //SPA模式下，点击附件，窗口关闭
    //SPA模式下，点击附件，窗口关闭
    /**
     * @private
     * @return {?}
     */
    WfApprovalLogsService.prototype.addEventListener = 
    //SPA模式下，点击附件，窗口关闭
    /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        window.addEventListener("message", (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (window.document.location.origin.search(event.origin) > -1) {
                if (event.data == 'TaskCloseLogDialog' && _this.dialog) {
                    _this.dialog.close();
                }
            }
        }), false);
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    WfApprovalLogsService.prototype.beforeClose = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        window.removeEventListener("message", (/**
         * @return {?}
         */
        function () { }));
        return of(true);
    };
    WfApprovalLogsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    WfApprovalLogsService.ctorParameters = function () { return [
        { type: MessagerService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService }
    ]; };
    return WfApprovalLogsService;
}());
export { WfApprovalLogsService };
if (false) {
    /** @type {?} */
    WfApprovalLogsService.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.modalService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtYXBwcm92YWwtbG9ncy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1hcHByb3ZhbC1sb2dzLyIsInNvdXJjZXMiOlsibGliL3dmLWFwcHJvdmFsLWxvZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQWdCLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFMUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2pELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRXZFO0lBS0ksK0JBQ1ksVUFBMkIsRUFDM0IsUUFBa0IsRUFDbEIsUUFBa0MsRUFDbEMsWUFBNEI7UUFINUIsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDM0IsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUNsQyxpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7SUFHeEMsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7O0lBQ0gsZ0RBQWdCOzs7OztJQUFoQixVQUFpQixVQUFrQjtRQUMvQixJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBQ3ZDLE9BQU87U0FDVjs7WUFDSyxVQUFVLEdBQUc7WUFDZixVQUFVLEVBQUUsVUFBVTtTQUN6QjtRQUNELElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVEOzs7O09BSUc7Ozs7OztJQUNILDRDQUFZOzs7OztJQUFaLFVBQWEsTUFB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QUNyQixDQUFDO0lBRUQsa0JBQWtCOzs7Ozs7SUFDVixnREFBZ0I7Ozs7OztJQUF4QjtRQUFBLGlCQVNDO1FBUkcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVM7Ozs7UUFBRSxVQUFDLEtBQUs7WUFDckMsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDM0QsSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLG9CQUFvQixJQUFJLEtBQUksQ0FBQyxNQUFNLEVBQUU7b0JBQ25ELEtBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7aUJBQ3ZCO2FBQ0o7UUFDTCxDQUFDLEdBQUUsS0FBSyxDQUFDLENBQUE7SUFFYixDQUFDOzs7Ozs7SUFFTywyQ0FBVzs7Ozs7SUFBbkIsVUFBb0IsS0FBSztRQUNyQixNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUzs7O1FBQUUsY0FBUSxDQUFDLEVBQUMsQ0FBQTtRQUNoRCxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVwQixDQUFDOztnQkE5R0osVUFBVTs7OztnQkFQRixlQUFlO2dCQURILFFBQVE7Z0JBQUUsd0JBQXdCO2dCQUVoQyxjQUFjOztJQXFIckMsNEJBQUM7Q0FBQSxBQS9HRCxJQStHQztTQTlHWSxxQkFBcUI7OztJQUU5Qix1Q0FBWTs7Ozs7SUFHUiwyQ0FBbUM7Ozs7O0lBQ25DLHlDQUEwQjs7Ozs7SUFDMUIseUNBQTBDOzs7OztJQUMxQyw2Q0FBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTW9kYWxPcHRpb25zLCBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBMb2dGaWx0ZXIgfSBmcm9tICcuL2VudGl0eS9Mb2dQYXJhbXMnO1xyXG5pbXBvcnQgeyB0cmFuc2xhdGUgfSBmcm9tICcuL3NlcnZpY2UvaTE4bi9pbmRleCc7XHJcbmltcG9ydCB7IFdmQXBwcm92YWxMb2dzQ29tcG9uZW50IH0gZnJvbSAnLi93Zi1hcHByb3ZhbC1sb2dzLmNvbXBvbmVudCc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBXZkFwcHJvdmFsTG9nc1NlcnZpY2Uge1xyXG5cclxuICAgIGRpYWxvZzogYW55Oy8v5by55qGGXHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBtc2dTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNrua1geeoi+WunuS+i2lk5omT5byA5a6h5om56K6w5b2V5by55qGGXHJcbiAgICAgKiBAcGFyYW0gcHJvY0luc3RJZCDmtYHnqIvlrp7kvotpZFxyXG4gICAgICovXHJcbiAgICBzaG93QnlQcm9jSW5zdElkKHByb2NJbnN0SWQ6IHN0cmluZykge1xyXG4gICAgICAgIGlmICghcHJvY0luc3RJZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5p+l55yL5a6h5om56K6w5b2V77yMcHJvY0luc3RJZOWPguaVsOS4uuepulwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0ge1xyXG4gICAgICAgICAgICBwcm9jSW5zdElkOiBwcm9jSW5zdElkXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2hvd0FwcHJvdmFsTG9nKHBhcmFtZXRlcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u6KGo5Y2V5pWw5o2uaWTmiZPlvIDlrqHmibnorrDlvZXlvLnmoYZcclxuICAgICAqIEBwYXJhbSBkYXRhSWQg6KGo5Y2V5pWw5o2uaWRcclxuICAgICAqIEBwYXJhbSBwYXJhbXMg5YW25LuW5Y+C5pWwIHBhcmFtcy5zdHlsZSDkuLpkYXRhZ3JpZOaXtu+8jOW8ueahhuS9v+eUqOWkp+eahO+8iDUyMCw3NjAsOTYw77yJXHJcbiAgICAgKi9cclxuICAgIHNob3dCeURhdGFJZChkYXRhSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGlmICghZGF0YUlkKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLmn6XnnIvlrqHmibnorrDlvZXvvIxkYXRhSWTlj4LmlbDkuLrnqbpcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHtcclxuICAgICAgICAgICAgZGF0YUlkOiBkYXRhSWRcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaG93QXBwcm92YWxMb2cocGFyYW1ldGVycyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmn6XnnIvlrqHmibnorrDlvZVcclxuICAgICAqIEBwYXJhbSBwYXJhbWV0ZXJzIFxyXG4gICAgICovXHJcbiAgICBzaG93QXBwcm92YWxMb2cocGFyYW1ldGVyczogTG9nRmlsdGVyKSB7XHJcbiAgICAgICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFdmQXBwcm92YWxMb2dzQ29tcG9uZW50KTtcclxuICAgICAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuRGF0YUlkID0gcGFyYW1ldGVycy5kYXRhSWQ7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5TdHlsZSA9IHBhcmFtZXRlcnMuc3R5bGU7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5Qcm9jSW5zdElkID0gcGFyYW1ldGVycy5wcm9jSW5zdElkO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuSW5jbHVkZUFkbWluT3BlcmF0ZSA9IHBhcmFtZXRlcnMuaW5jbHVkZUFkbWluT3BlcmF0ZTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLkluY2x1ZGVIaXN0b3J5ID0gcGFyYW1ldGVycy5pbmNsdWRlSGlzdG9yeTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmZpbGwoKTtcclxuICAgICAgICBjb25zdCBtb2RhbENvbmZpZzogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICB0aXRsZTogdGhpcy5nZXRJMThuVmFsdWUoJ3N0YXRpYy5hcHByb3ZhbExvZ3MudGl0bGUnKSxcclxuICAgICAgICAgICAgd2lkdGg6IHBhcmFtZXRlcnMuc3R5bGUgPT0gJ2RhdGFncmlkJyA/IDk2MCA6IDUyMCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBwYXJhbWV0ZXJzLnN0eWxlID09ICdkYXRhZ3JpZCcgPyA1MDAgOiA1MjAsXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBwYXJhbWV0ZXJzLnN0eWxlID09ICdkYXRhZ3JpZCcgPyB0cnVlIDogZmFsc2UsXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IGNvbXBSZWYuaW5zdGFuY2UudGFza0RpYWxvZ0Zvb3RlcixcclxuICAgICAgICAgICAgYmVmb3JlQ2xvc2U6IHRoaXMuYmVmb3JlQ2xvc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5aSa6K+tXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEkxOG5WYWx1ZShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIW5hbWUpIHsgcmV0dXJuICcnOyB9XHJcbiAgICAgICAgdmFyIGRlZmF1bHRMYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpO1xyXG4gICAgICAgIHZhciBsYW5nRGF0YSA9IGRlZmF1bHRMYW5nID8gdHJhbnNsYXRlW2RlZmF1bHRMYW5nXSA6IHRyYW5zbGF0ZVsnemgtQ0hTJ107XHJcbiAgICAgICAgbGV0IHJlc3VsdFZhbCA9ICcnO1xyXG4gICAgICAgIGlmIChuYW1lLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gbGFuZ0RhdGFbbmFtZV07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gbmFtZS5zcGxpdCgnLicpLnJlZHVjZSgob2JqLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqW2tleV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBsYW5nRGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRWYWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy9TUEHmqKHlvI/kuIvvvIzngrnlh7vpmYTku7bvvIznqpflj6PlhbPpl61cclxuICAgIHByaXZhdGUgYWRkRXZlbnRMaXN0ZW5lcigpIHtcclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh3aW5kb3cuZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luLnNlYXJjaChldmVudC5vcmlnaW4pID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhID09ICdUYXNrQ2xvc2VMb2dEaWFsb2cnICYmIHRoaXMuZGlhbG9nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGZhbHNlKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJlZm9yZUNsb3NlKGV2ZW50KSB7XHJcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsICgpID0+IHsgfSlcclxuICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcblxyXG4gICAgfVxyXG59XHJcbiJdfQ==
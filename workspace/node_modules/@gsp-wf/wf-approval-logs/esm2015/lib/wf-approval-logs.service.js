/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { of } from 'rxjs';
import { translate } from './service/i18n/index';
import { WfApprovalLogsComponent } from './wf-approval-logs.component';
export class WfApprovalLogsService {
    //弹框
    /**
     * @param {?} msgService
     * @param {?} injector
     * @param {?} resolver
     * @param {?} modalService
     */
    constructor(msgService, injector, resolver, modalService) {
        this.msgService = msgService;
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
    }
    /**
     * 根据流程实例id打开审批记录弹框
     * @param {?} procInstId 流程实例id
     * @return {?}
     */
    showByProcInstId(procInstId) {
        if (!procInstId) {
            console.error("查看审批记录，procInstId参数为空");
            return;
        }
        /** @type {?} */
        const parameters = {
            procInstId: procInstId
        };
        this.showApprovalLog(parameters);
    }
    /**
     * 根据表单数据id打开审批记录弹框
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    showByDataId(dataId) {
        if (!dataId) {
            console.error("查看审批记录，dataId参数为空");
            return;
        }
        /** @type {?} */
        const parameters = {
            dataId: dataId
        };
        this.showApprovalLog(parameters);
    }
    /**
     * 查看审批记录
     * @param {?} parameters
     * @return {?}
     */
    showApprovalLog(parameters) {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(WfApprovalLogsComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.DataId = parameters.dataId;
        compRef.instance.Style = parameters.style;
        compRef.instance.ProcInstId = parameters.procInstId;
        compRef.instance.IncludeAdminOperate = parameters.includeAdminOperate;
        compRef.instance.IncludeHistory = parameters.includeHistory;
        compRef.instance.fill();
        /** @type {?} */
        const modalConfig = {
            title: this.getI18nValue('static.approvalLogs.title'),
            width: parameters.style == 'datagrid' ? 960 : 520,
            height: parameters.style == 'datagrid' ? 500 : 520,
            showButtons: parameters.style == 'datagrid' ? true : false,
            buttons: compRef.instance.taskDialogFooter,
            beforeClose: this.beforeClose,
        };
        this.dialog = this.modalService.show(compRef, modalConfig);
        this.addEventListener();
    }
    /**
     * 获取多语
     * @private
     * @param {?} name
     * @return {?}
     */
    getI18nValue(name) {
        if (!name) {
            return '';
        }
        /** @type {?} */
        var defaultLang = localStorage.getItem('languageCode');
        /** @type {?} */
        var langData = defaultLang ? translate[defaultLang] : translate['zh-CHS'];
        /** @type {?} */
        let resultVal = '';
        if (name.indexOf('.') === -1) {
            resultVal = langData[name];
        }
        else {
            resultVal = name.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            (obj, key) => {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }), langData);
        }
        return resultVal;
    }
    //SPA模式下，点击附件，窗口关闭
    /**
     * @private
     * @return {?}
     */
    addEventListener() {
        window.addEventListener("message", (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            if (window.document.location.origin.search(event.origin) > -1) {
                if (event.data == 'TaskCloseLogDialog' && this.dialog) {
                    this.dialog.close();
                }
            }
        }), false);
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    beforeClose(event) {
        window.removeEventListener("message", (/**
         * @return {?}
         */
        () => { }));
        return of(true);
    }
}
WfApprovalLogsService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
WfApprovalLogsService.ctorParameters = () => [
    { type: MessagerService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: BsModalService }
];
if (false) {
    /** @type {?} */
    WfApprovalLogsService.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WfApprovalLogsService.prototype.modalService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtYXBwcm92YWwtbG9ncy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1hcHByb3ZhbC1sb2dzLyIsInNvdXJjZXMiOlsibGliL3dmLWFwcHJvdmFsLWxvZ3Muc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQWdCLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFMUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2pELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBR3ZFLE1BQU0sT0FBTyxxQkFBcUI7Ozs7Ozs7O0lBSTlCLFlBQ1ksVUFBMkIsRUFDM0IsUUFBa0IsRUFDbEIsUUFBa0MsRUFDbEMsWUFBNEI7UUFINUIsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDM0IsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUNsQyxpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7SUFHeEMsQ0FBQzs7Ozs7O0lBTUQsZ0JBQWdCLENBQUMsVUFBa0I7UUFDL0IsSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNiLE9BQU8sQ0FBQyxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUN2QyxPQUFPO1NBQ1Y7O2NBQ0ssVUFBVSxHQUFHO1lBQ2YsVUFBVSxFQUFFLFVBQVU7U0FDekI7UUFDRCxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7Ozs7OztJQU9ELFlBQVksQ0FBQyxNQUFjO1FBQ3ZCLElBQUksQ0FBQyxNQUFN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OztRQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDekMsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDM0QsSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLG9CQUFvQixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7b0JBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7aUJBQ3ZCO2FBQ0o7UUFDTCxDQUFDLEdBQUUsS0FBSyxDQUFDLENBQUE7SUFFYixDQUFDOzs7Ozs7SUFFTyxXQUFXLENBQUMsS0FBSztRQUNyQixNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUzs7O1FBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFDLENBQUE7UUFDaEQsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFcEIsQ0FBQzs7O1lBOUdKLFVBQVU7Ozs7WUFQRixlQUFlO1lBREgsUUFBUTtZQUFFLHdCQUF3QjtZQUVoQyxjQUFjOzs7O0lBU2pDLHVDQUFZOzs7OztJQUdSLDJDQUFtQzs7Ozs7SUFDbkMseUNBQTBCOzs7OztJQUMxQix5Q0FBMEM7Ozs7O0lBQzFDLDZDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE9uRGVzdHJveSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBNb2RhbE9wdGlvbnMsIEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IExvZ0ZpbHRlciB9IGZyb20gJy4vZW50aXR5L0xvZ1BhcmFtcyc7XHJcbmltcG9ydCB7IHRyYW5zbGF0ZSB9IGZyb20gJy4vc2VydmljZS9pMThuL2luZGV4JztcclxuaW1wb3J0IHsgV2ZBcHByb3ZhbExvZ3NDb21wb25lbnQgfSBmcm9tICcuL3dmLWFwcHJvdmFsLWxvZ3MuY29tcG9uZW50JztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFdmQXBwcm92YWxMb2dzU2VydmljZSB7XHJcblxyXG4gICAgZGlhbG9nOiBhbnk7Ly/lvLnmoYZcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u5rWB56iL5a6e5L6LaWTmiZPlvIDlrqHmibnorrDlvZXlvLnmoYZcclxuICAgICAqIEBwYXJhbSBwcm9jSW5zdElkIOa1geeoi+WunuS+i2lkXHJcbiAgICAgKi9cclxuICAgIHNob3dCeVByb2NJbnN0SWQocHJvY0luc3RJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKCFwcm9jSW5zdElkKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLmn6XnnIvlrqHmibnorrDlvZXvvIxwcm9jSW5zdElk5Y+C5pWw5Li656m6XCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB7XHJcbiAgICAgICAgICAgIHByb2NJbnN0SWQ6IHByb2NJbnN0SWRcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaG93QXBwcm92YWxMb2cocGFyYW1ldGVycyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7ooajljZXmlbDmja5pZOaJk+W8gOWuoeaJueiusOW9leW8ueahhlxyXG4gICAgICogQHBhcmFtIGRhdGFJZCDooajljZXmlbDmja5pZFxyXG4gICAgICogQHBhcmFtIHBhcmFtcyDlhbbku5blj4LmlbAgcGFyYW1zLnN0eWxlIOS4umRhdGFncmlk5pe277yM5by55qGG5L2/55So5aSn55qE77yINTIwLDc2MCw5NjDvvIlcclxuICAgICAqL1xyXG4gICAgc2hvd0J5RGF0YUlkKGRhdGFJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKCFkYXRhSWQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIuafpeeci+WuoeaJueiusOW9le+8jGRhdGFJZOWPguaVsOS4uuepulwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0ge1xyXG4gICAgICAgICAgICBkYXRhSWQ6IGRhdGFJZFxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNob3dBcHByb3ZhbExvZyhwYXJhbWV0ZXJzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOafpeeci+WuoeaJueiusOW9lVxyXG4gICAgICogQHBhcmFtIHBhcmFtZXRlcnMgXHJcbiAgICAgKi9cclxuICAgIHNob3dBcHByb3ZhbExvZyhwYXJhbWV0ZXJzOiBMb2dGaWx0ZXIpIHtcclxuICAgICAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoV2ZBcHByb3ZhbExvZ3NDb21wb25lbnQpO1xyXG4gICAgICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5EYXRhSWQgPSBwYXJhbWV0ZXJzLmRhdGFJZDtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLlN0eWxlID0gcGFyYW1ldGVycy5zdHlsZTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLlByb2NJbnN0SWQgPSBwYXJhbWV0ZXJzLnByb2NJbnN0SWQ7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5JbmNsdWRlQWRtaW5PcGVyYXRlID0gcGFyYW1ldGVycy5pbmNsdWRlQWRtaW5PcGVyYXRlO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuSW5jbHVkZUhpc3RvcnkgPSBwYXJhbWV0ZXJzLmluY2x1ZGVIaXN0b3J5O1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZmlsbCgpO1xyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmdldEkxOG5WYWx1ZSgnc3RhdGljLmFwcHJvdmFsTG9ncy50aXRsZScpLFxyXG4gICAgICAgICAgICB3aWR0aDogcGFyYW1ldGVycy5zdHlsZSA9PSAnZGF0YWdyaWQnID8gOTYwIDogNTIwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHBhcmFtZXRlcnMuc3R5bGUgPT0gJ2RhdGFncmlkJyA/IDUwMCA6IDUyMCxcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IHBhcmFtZXRlcnMuc3R5bGUgPT0gJ2RhdGFncmlkJyA/IHRydWUgOiBmYWxzZSxcclxuICAgICAgICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS50YXNrRGlhbG9nRm9vdGVyLFxyXG4gICAgICAgICAgICBiZWZvcmVDbG9zZTogdGhpcy5iZWZvcmVDbG9zZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blpJror61cclxuICAgICAqIEBwYXJhbSBuYW1lIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0STE4blZhbHVlKG5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICghbmFtZSkgeyByZXR1cm4gJyc7IH1cclxuICAgICAgICB2YXIgZGVmYXVsdExhbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJyk7XHJcbiAgICAgICAgdmFyIGxhbmdEYXRhID0gZGVmYXVsdExhbmcgPyB0cmFuc2xhdGVbZGVmYXVsdExhbmddIDogdHJhbnNsYXRlWyd6aC1DSFMnXTtcclxuICAgICAgICBsZXQgcmVzdWx0VmFsID0gJyc7XHJcbiAgICAgICAgaWYgKG5hbWUuaW5kZXhPZignLicpID09PSAtMSkge1xyXG4gICAgICAgICAgICByZXN1bHRWYWwgPSBsYW5nRGF0YVtuYW1lXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHRWYWwgPSBuYW1lLnNwbGl0KCcuJykucmVkdWNlKChvYmosIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGxhbmdEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdFZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvL1NQQeaooeW8j+S4i++8jOeCueWHu+mZhOS7tu+8jOeql+WPo+WFs+mXrVxyXG4gICAgcHJpdmF0ZSBhZGRFdmVudExpc3RlbmVyKCkge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKHdpbmRvdy5kb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4uc2VhcmNoKGV2ZW50Lm9yaWdpbikgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEgPT0gJ1Rhc2tDbG9zZUxvZ0RpYWxvZycgJiYgdGhpcy5kaWFsb2cpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZmFsc2UpXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmVmb3JlQ2xvc2UoZXZlbnQpIHtcclxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKCkgPT4geyB9KVxyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuXHJcbiAgICB9XHJcbn1cclxuIl19
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('rxjs/operators'), require('@angular/platform-browser'), require('@edp-pmf/bpmn-model'), require('@gsp-wf/wf-process-model'), require('@edp-pmf/mxgraph-ts'), require('@farris/ui-modal'), require('@gsp-sys/rtf-common'), require('rxjs'), require('@angular/common'), require('@ecp-caf/caf-common'), require('@farris/ui-messager'), require('@farris/ui-dialog'), require('@angular/core'), require('@farris/ui-layout'), require('@farris/ui-section'), require('@gsp-wf/wf-approval-logs'), require('@farris/ui-combo-list'), require('@angular/forms'), require('@farris/ui-dropdown'), require('@farris/ui-datagrid'), require('@farris/ui-notify'), require('@farris/ui-loading'), require('@farris/ui-tabs'), require('@farris/ui-splitter')) :
    typeof define === 'function' && define.amd ? define('@gsp-wf/ui-flowchart', ['exports', 'rxjs/operators', '@angular/platform-browser', '@edp-pmf/bpmn-model', '@gsp-wf/wf-process-model', '@edp-pmf/mxgraph-ts', '@farris/ui-modal', '@gsp-sys/rtf-common', 'rxjs', '@angular/common', '@ecp-caf/caf-common', '@farris/ui-messager', '@farris/ui-dialog', '@angular/core', '@farris/ui-layout', '@farris/ui-section', '@gsp-wf/wf-approval-logs', '@farris/ui-combo-list', '@angular/forms', '@farris/ui-dropdown', '@farris/ui-datagrid', '@farris/ui-notify', '@farris/ui-loading', '@farris/ui-tabs', '@farris/ui-splitter'], factory) :
    (factory((global['gsp-wf'] = global['gsp-wf'] || {}, global['gsp-wf']['ui-flowchart'] = {}),global.rxjs.operators,global.ng.platformBrowser,global.bpmnModel,global.wfProcessModel,global.mxgraphTs,global.uiModal,global.rtfCommon,global.rxjs,global.ng.common,global.cafCommon,global.uiMessager,global.uiDialog,global.ng.core,global.uiLayout,global.uiSection,global.wfApprovalLogs,global.uiComboList,global.ng.forms,global.uiDropdown,global.uiDatagrid,global.uiNotify,global.uiLoading,global.uiTabs,global.uiSplitter));
}(this, (function (exports,operators,platformBrowser,bpmnModel,wfProcessModel,mxgraphTs,uiModal,rtfCommon,rxjs,common,cafCommon,uiMessager,uiDialog,core,uiLayout,uiSection,wfApprovalLogs,uiComboList,forms,uiDropdown,uiDatagrid,uiNotify,uiLoading,uiTabs,uiSplitter) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    /** @type {?} */
    var en = {
        static: {
            approvalLogs: {
                title: 'Approval Logs',
                approvalOpinion: 'Approval opinion',
                startTime: 'StartTime',
                endTime: 'EndTime',
                todo: 'Todo',
                done: 'Done',
                toAssign: 'To Assign'
            },
            flowchart: {
                title: 'Flow Chart',
                processNotFound: 'process instance id is null',
                flowChart: 'Flow Chart',
                complete: 'Hide Calculated Route',
                simulation: 'Show Calculated Route',
                sequenceColor: 'Description Of Sequence Color',
                completed: 'Completed',
                calculate: 'Calculate Route',
                default: 'Default',
                suspend: 'Calculate Suspend',
                noProcess: 'Process definition not found!',
                list: 'Process List',
                noDataId: 'form id is null',
                noBizDefKey: 'process category id is null'
            }
        }
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    /** @type {?} */
    var zh_CHT = {
        static: {
            approvalLogs: {
                title: '審批記錄',
                approvalOpinion: '審批意見',
                startTime: '接收時間',
                endTime: '處理時間',
                todo: '待辦理',
                done: '已辦理',
                toAssign: '未指派'
            },
            flowchart: {
                title: '查看流程',
                processNotFound: '流程實例ID為空',
                dataIdIsNull: '單據內碼為空',
                flowChart: '流程圖',
                complete: '隱藏計算路線',
                simulation: '顯示計算路線',
                sequenceColor: '分支線顏色說明',
                completed: '已運行',
                calculate: '計算路線',
                default: '默認',
                suspend: '計算中斷',
                noProcess: '未找到符合條件的流程定義！',
                list: '流程列表',
                noDataId: '單據內碼為空',
                noBizDefKey: '流程分類ID為空'
            }
        }
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    /** @type {?} */
    var zh_CHS = {
        static: {
            approvalLogs: {
                title: '审批记录',
                approvalOpinion: '审批意见',
                startTime: '接收时间',
                endTime: '处理时间',
                todo: '待办理',
                done: '已办理',
                toAssign: '未指派'
            },
            flowchart: {
                title: '查看流程',
                processNotFound: '流程实例ID为空',
                dataIdIsNull: '单据内码为空',
                flowChart: '流程图',
                complete: '显示设计路线',
                simulation: '显示预测路线',
                sequenceColor: '分支线颜色说明',
                completed: '已运行',
                calculate: '计算路线',
                default: '默认',
                suspend: '计算中断',
                noProcess: '未找到符合条件的流程定义！',
                list: '流程列表',
                noDataId: '单据内码为空',
                noBizDefKey: '流程分类ID为空'
            }
        }
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    /** @type {?} */
    var translate = {
        'zh-CHS': zh_CHS,
        'en': en,
        'zh-CHT': zh_CHT
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var UiFlowchartService = /** @class */ (function () {
        function UiFlowchartService(httpSvc) {
            this.httpSvc = httpSvc;
        }
        /**
         * @param {?} payload
         * @return {?}
         */
        UiFlowchartService.prototype.getForecastProcessListByPayload = /**
         * @param {?} payload
         * @return {?}
         */
            function (payload) {
                /** @type {?} */
                var url = '/api/runtime/wf/v1.0/processInstances/startProcess-simulation';
                return this.httpSvc.post(url, payload).pipe(operators.map(( /**
                 * @param {?} re
                 * @return {?}
                 */function (re) { return re.procDefs; })));
            };
        /**
         * @param {?} dataId
         * @return {?}
         */
        UiFlowchartService.prototype.getRuntimeProcInstsByDataId = /**
         * @param {?} dataId
         * @return {?}
         */
            function (dataId) {
                if (dataId) {
                    /** @type {?} */
                    var url = "/api/runtime/wf/v1.0/processInstances/runtimeProcInstList?dataId=" + dataId;
                    return this.httpSvc.get(url);
                }
                else {
                    return rxjs.from(new Array());
                }
            };
        /**
         * @param {?} dataId
         * @return {?}
         */
        UiFlowchartService.prototype.getHistoricProcInstsByDataId = /**
         * @param {?} dataId
         * @return {?}
         */
            function (dataId) {
                if (dataId) {
                    /** @type {?} */
                    var url = "/api/runtime/wf/v1.0/processInstances/historicProcInstList?dataId=" + dataId;
                    return this.httpSvc.get(url);
                }
                else {
                    return rxjs.from(new Array());
                }
            };
        /**
         * 基于流程实例ID获取流程实例
         * @param procInstId 流程实例id
         */
        /**
         * 基于流程实例ID获取流程实例
         * @param {?} procInstId 流程实例id
         * @return {?}
         */
        UiFlowchartService.prototype.getProcInstanceById = /**
         * 基于流程实例ID获取流程实例
         * @param {?} procInstId 流程实例id
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId;
                return this.httpSvc.get(url);
            };
        /**
         * 基于流程实例ID获取bpmnModel
         */
        /**
         * 基于流程实例ID获取bpmnModel
         * @param {?} procInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getBpmnModelbyProcInstId = /**
         * 基于流程实例ID获取bpmnModel
         * @param {?} procInstId
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/bpmnModel";
                return this.httpSvc.get(url);
            };
        /**
         * 基于流程定义ID获取bpmnModel
         */
        /**
         * 基于流程定义ID获取bpmnModel
         * @param {?} procDefId
         * @return {?}
         */
        UiFlowchartService.prototype.getBpmnModelbyProcDefId = /**
         * 基于流程定义ID获取bpmnModel
         * @param {?} procDefId
         * @return {?}
         */
            function (procDefId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/procDefs/" + procDefId + "/bpmnModel";
                return this.httpSvc.get(url);
            };
        /**
         * @param {?} superActInstId
         * @param {?} superProcInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getSubProcessInstance = /**
         * @param {?} superActInstId
         * @param {?} superProcInstId
         * @return {?}
         */
            function (superActInstId, superProcInstId) {
                if (superActInstId) {
                    /** @type {?} */
                    var url = "/api/runtime/wf/v1.0/processInstances/subProcInst?superActInstId=" + superActInstId + "&superProcInstId=" + superProcInstId;
                    return this.httpSvc.get(url);
                }
            };
        /**
         * 获取所有包含预解析的流程实例信息
         */
        /**
         * 获取所有包含预解析的流程实例信息
         * @param {?} procInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getForecastProcessByProcInstId = /**
         * 获取所有包含预解析的流程实例信息
         * @param {?} procInstId
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/forecastProcess";
                return this.httpSvc.get(url);
            };
        /**
         * 获取流程预测数据
         */
        /**
         * 获取流程预测数据
         * @param {?} payload
         * @return {?}
         */
        UiFlowchartService.prototype.getForecastProcessByPayload = /**
         * 获取流程预测数据
         * @param {?} payload
         * @return {?}
         */
            function (payload) {
                /** @type {?} */
                var url = '/api/runtime/wf/v1.0/processInstances/forecastProcess';
                return this.httpSvc.post(url, payload);
            };
        /**
         * @param {?} procInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getCompleteProcessInfoByProcInstId = /**
         * @param {?} procInstId
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/flowChartInfo";
                return this.httpSvc.get(url);
            };
        /**
         * 基于流程实例Id获取所有活动实例
         * @param procInstId procInstId
         */
        /**
         * 基于流程实例Id获取所有活动实例
         * @param {?} procInstId procInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getAllActiInstsbyProcInstId = /**
         * 基于流程实例Id获取所有活动实例
         * @param {?} procInstId procInstId
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/activityInstanceSlims";
                return this.httpSvc.get(url);
            };
        /**
         * 基于流程实例ID获取所有的流转实例
         * @param procInstId procInstId
         */
        /**
         * 基于流程实例ID获取所有的流转实例
         * @param {?} procInstId procInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getTransitionInstanceSlimsByProcInstId = /**
         * 基于流程实例ID获取所有的流转实例
         * @param {?} procInstId procInstId
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/transitionInstanceSlims";
                return this.httpSvc.get(url);
            };
        /**
         * @param {?} procInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getFormInfoByProcInstId = /**
         * @param {?} procInstId
         * @return {?}
         */
            function (procInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/formInfo";
                return this.httpSvc.get(url);
            };
        /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @return {?}
         */
        UiFlowchartService.prototype.getFormInfoByActInstId = /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @return {?}
         */
            function (procInstId, actInstId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/formInfo";
                if (actInstId) {
                    url += "?actInstId=" + actInstId;
                }
                return this.httpSvc.get(url);
            };
        /**
         * 获取审批日志信息
         * @param ProcInstId ProcInstId
         * 新改造的接口
         */
        /**
         * 获取审批日志信息
         * @param {?} procInstId
         * @param {?=} activityDefinitionId
         * @return {?}
         */
        UiFlowchartService.prototype.getWorkItemLogs = /**
         * 获取审批日志信息
         * @param {?} procInstId
         * @param {?=} activityDefinitionId
         * @return {?}
         */
            function (procInstId, activityDefinitionId) {
                /** @type {?} */
                var logUrl = activityDefinitionId ?
                    "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/logs?activityDefinitionId=" + activityDefinitionId :
                    "/api/runtime/wf/v1.0/processInstances/" + procInstId + "/logs";
                return this.httpSvc.get(logUrl);
            };
        /**
         * @param {?} name
         * @return {?}
         */
        UiFlowchartService.prototype.getI18nValue = /**
         * @param {?} name
         * @return {?}
         */
            function (name) {
                if (!name) {
                    return '';
                }
                /** @type {?} */
                var defaultLang = localStorage.getItem('languageCode');
                /** @type {?} */
                var langData = defaultLang ? translate[defaultLang] : translate['zh-CHS'];
                /** @type {?} */
                var resultVal = '';
                if (name.indexOf('.') === -1) {
                    resultVal = langData[name];
                }
                else {
                    resultVal = name.split('.').reduce(( /**
                     * @param {?} obj
                     * @param {?} key
                     * @return {?}
                     */function (obj, key) {
                        if (obj) {
                            return obj[key];
                        }
                        else {
                            return null;
                        }
                    }), langData);
                }
                return resultVal;
            };
        /**
         * @param {?} processId
         * @return {?}
         */
        UiFlowchartService.prototype.getProcessInstanceById = /**
         * @param {?} processId
         * @return {?}
         */
            function (processId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/" + processId;
                return this.httpSvc.get(url);
            };
        /**
         * @param {?} dataId
         * @return {?}
         */
        UiFlowchartService.prototype.getProcInstIdByDataId = /**
         * @param {?} dataId
         * @return {?}
         */
            function (dataId) {
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/procInstId?bizInstId=" + dataId;
                return this.httpSvc.get(url);
            };
        /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
        UiFlowchartService.prototype.retryAifCreation = /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
            function (procInstId, actInstId, bizInstId) {
                return this.httpSvc.post("/api/runtime/wf/v1.0/aifactivityinstance/retry", actInstId);
            };
        /**
         * 是否是外部流程第三方的任务
         * @param processInstanceId 流程实例ID
         */
        /**
         * 是否是外部流程第三方的任务
         * @param {?} processInstanceId 流程实例ID
         * @return {?}
         */
        UiFlowchartService.prototype.ifThirdTask = /**
         * 是否是外部流程第三方的任务
         * @param {?} processInstanceId 流程实例ID
         * @return {?}
         */
            function (processInstanceId) {
                /** @type {?} */
                var url = "/api/runtime/task/v1.0/instances/wfExternalProcess?processInstanceId=" + processInstanceId;
                return this.httpSvc.get(url);
            };
        /**
         * 获取查看共享流程图的相关参数
         * @param bizId 单据内码
         */
        /**
         * 获取查看共享流程图的相关参数
         * @param {?} bizId 单据内码
         * @return {?}
         */
        UiFlowchartService.prototype.getFsParamsByBizId = /**
         * 获取查看共享流程图的相关参数
         * @param {?} bizId 单据内码
         * @return {?}
         */
            function (bizId) {
                /** @type {?} */
                var url = "/api/runtime/task/v1.0/tasks/third/bizId?bizId=" + bizId;
                return this.httpSvc.get(url);
            };
        /**
         * 获取共享查看流程图的URL
         * @param params 参数
         */
        /**
         * 获取共享查看流程图的URL
         * @param {?} params 参数
         * @return {?}
         */
        UiFlowchartService.prototype.viewFsProcessNew = /**
         * 获取共享查看流程图的URL
         * @param {?} params 参数
         * @return {?}
         */
            function (params) {
                /** @type {?} */
                var url = "/api/fssp/ssp/v1.0/mybill/fswybz/viewprocess";
                return this.httpSvc.post(url, params);
            };
        /**
         * @return {?}
         */
        UiFlowchartService.prototype.getFlowChartStyleConfig = /**
         * @return {?}
         */
            function () {
                /** @type {?} */
                var url = "/platform/runtime/common/web/@gsp-wf/wf-process-editor/config/cell-style-config.json";
                return this.httpSvc.get(url);
            };
        /**
         * 获取多实例子流程
         * @param actInst 活动实例
         * @param superProcInstId 父流程实例id
         * @returns
         */
        /**
         * 获取多实例子流程
         * @param {?} actInst 活动实例
         * @param {?} superProcInstId 父流程实例id
         * @return {?}
         */
        UiFlowchartService.prototype.getMutiChildInstance = /**
         * 获取多实例子流程
         * @param {?} actInst 活动实例
         * @param {?} superProcInstId 父流程实例id
         * @return {?}
         */
            function (actInst, superProcInstId) {
                /** @type {?} */
                var actInstId = actInst.activityInstanceId;
                /** @type {?} */
                var isMultiInstanceRoot = actInst.multiInstanceRoot || false;
                /** @type {?} */
                var url = "/api/runtime/wf/v1.0/processInstances/subProcInstList?actInstId=" + actInstId + "&isMultiInstanceRoot=" + isMultiInstanceRoot + "&superProcInstId=" + superProcInstId;
                return this.httpSvc.get(url);
            };
        UiFlowchartService.decorators = [
            { type: core.Injectable }
        ];
        /** @nocollapse */
        UiFlowchartService.ctorParameters = function () {
            return [
                { type: cafCommon.HttpService }
            ];
        };
        return UiFlowchartService;
    }());

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
    /* global Reflect, Promise */
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b)
                if (Object.prototype.hasOwnProperty.call(b, p))
                    d[p] = b[p]; };
        return extendStatics(d, b);
    };
    function __extends(d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    }
    function __values(o) {
        var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
        if (m)
            return m.call(o);
        if (o && typeof o.length === "number")
            return {
                next: function () {
                    if (o && i >= o.length)
                        o = void 0;
                    return { value: o && o[i++], done: !o };
                }
            };
        throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
    }

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var Cell = /** @class */ (function (_super) {
        __extends(Cell, _super);
        function Cell(value, geometry, style) {
            return _super.call(this, value, geometry, style) || this;
        }
        return Cell;
    }(mxgraphTs.mxCell));

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var FlowGraph = /** @class */ (function (_super) {
        __extends(FlowGraph, _super);
        function FlowGraph(container, cellStyleConfig) {
            var _this = _super.call(this, container) || this;
            _this.scrollTileSize = new mxgraphTs.mxRectangle(0, 0, 400, 600);
            _this.cellStyleConfig = {
                edgeStyleDic: {},
                shapeStyleDic: {},
            };
            _this.actList = [];
            _this.transInsList = [];
            _this.rootPath = ''; //基路径
            //基路径
            /**
             * 当前语言
             */
            _this.langCode = (( /** @type {?} */(window))).gspframeworkService && (( /** @type {?} */(window))).gspframeworkService.rtf.language.getLanguageCode() || localStorage.getItem('languageCode') || 'zh-CHS';
            //获取基路径
            try {
                _this.rootPath = (( /** @type {?} */(window))).gspframeworkService.common.getBasePath.get();
            }
            catch (error) {
            }
            _this.cellStyleConfig = cellStyleConfig ? cellStyleConfig : _this.cellStyleConfig;
            _this.autoScroll = false;
            _this.autoExtend = true;
            _this.pageVisible = false;
            //this.panningHandler.ignoreCell = true;
            //this.setPanning(true);
            _this.setCellsSelectable(true);
            _this.setDisconnectOnMove(false);
            //节点不可改变大小
            _this.setCellsResizable(false);
            //cell是否可以连线
            _this.setConnectable(false);
            //禁止操作
            _this.setEnabled(true);
            //设置cell文本是否可移动
            _this.setVertexLabelsMovable(false);
            _this.setCellsLocked(true);
            //不允许图上存在没有连接活动节点的线（防止拖动线连接点导致失去连接）,还没有找到不允许拖动连接控制点的属性
            _this.setAllowDanglingEdges(false);
            mxgraphTs.mxEvent.disableContextMenu(container);
            // 设置默认样式
            _this.setDefaultStyles();
            return _this;
        }
        /**
         * 重写创建节点对象方法
         * @param parent
         * @param id
         * @param value
         * @param x
         * @param y
         * @param width
         * @param height
         * @param style
         * @param relative
         * @returns
         */
        /**
         * 重写创建节点对象方法
         * @param {?} parent
         * @param {?} id
         * @param {?} value
         * @param {?} x
         * @param {?} y
         * @param {?} width
         * @param {?} height
         * @param {?} style
         * @param {?} relative
         * @return {?}
         */
        FlowGraph.prototype.createVertex = /**
         * 重写创建节点对象方法
         * @param {?} parent
         * @param {?} id
         * @param {?} value
         * @param {?} x
         * @param {?} y
         * @param {?} width
         * @param {?} height
         * @param {?} style
         * @param {?} relative
         * @return {?}
         */
            function (parent, id, value, x, y, width, height, style, relative) {
                // Creates the geometry for the vertex
                /** @type {?} */
                var geometry = new mxgraphTs.mxGeometry(x, y, width, height);
                geometry.relative = (relative != null) ? relative : false;
                // Creates the vertex
                /** @type {?} */
                var vertex = new Cell(value, geometry, style);
                vertex.setId(id);
                vertex.setVertex(true);
                vertex.setConnectable(true);
                return vertex;
            };
        /**
         * 重写创建边对象方法
         * @param parent
         * @param id
         * @param value
         * @param source
         * @param target
         * @param style
         * @returns
         */
        /**
         * 重写创建边对象方法
         * @param {?} parent
         * @param {?} id
         * @param {?} value
         * @param {?} source
         * @param {?} target
         * @param {?} style
         * @return {?}
         */
        FlowGraph.prototype.createEdge = /**
         * 重写创建边对象方法
         * @param {?} parent
         * @param {?} id
         * @param {?} value
         * @param {?} source
         * @param {?} target
         * @param {?} style
         * @return {?}
         */
            function (parent, id, value, source, target, style) {
                // Creates the edge
                /** @type {?} */
                var edge = new Cell(value, new mxgraphTs.mxGeometry(), style);
                edge.setId(id);
                edge.setEdge(true);
                edge.geometry.relative = true;
                return edge;
            };
        /**
         * 设置默认样式
         */
        /**
         * 设置默认样式
         * @return {?}
         */
        FlowGraph.prototype.setDefaultStyles = /**
         * 设置默认样式
         * @return {?}
         */
            function () {
                /** @type {?} */
                var styleSheet = this.getStylesheet();
                // 节点默认样式
                /** @type {?} */
                var vertexStyle = styleSheet.getDefaultVertexStyle();
                vertexStyle[mxgraphTs.mxConstants.STYLE_SHAPE] = mxgraphTs.mxConstants.SHAPE_IMAGE;
                vertexStyle[mxgraphTs.mxConstants.STYLE_VERTICAL_LABEL_POSITION] = mxgraphTs.mxConstants.ALIGN_BOTTOM;
                vertexStyle[mxgraphTs.mxConstants.STYLE_FONTSIZE] = 12;
                vertexStyle[mxgraphTs.mxConstants.STYLE_FONTFAMILY] = 'Helvetica';
                vertexStyle[mxgraphTs.mxConstants.STYLE_FONTCOLOR] = "#333";
                // 连线样式默认为正交
                /** @type {?} */
                var edgeStyle = styleSheet.getDefaultEdgeStyle();
                edgeStyle[mxgraphTs.mxConstants.STYLE_SOURCE_PORT] = 'e';
                edgeStyle[mxgraphTs.mxConstants.STYLE_TARGET_PORT] = 'w';
                edgeStyle[mxgraphTs.mxConstants.STYLE_EDGE] = mxgraphTs.mxConstants.EDGESTYLE_ORTHOGONAL;
                edgeStyle[mxgraphTs.mxConstants.STYLE_ROUNDED] = 1;
                edgeStyle[mxgraphTs.mxConstants.STYLE_STROKECOLOR] = '#6482B9';
                edgeStyle[mxgraphTs.mxConstants.STYLE_FONTSIZE] = 12;
                edgeStyle[mxgraphTs.mxConstants.STYLE_FONTFAMILY] = 'Helvetica';
            };
        /**
         * 创建无限大画布
         */
        /**
         * 创建无限大画布
         * @return {?}
         */
        FlowGraph.prototype.createInfiniteCanvas = /**
         * 创建无限大画布
         * @return {?}
         */
            function () {
                var _this = this;
                this.getPagePadding = ( /**
                 * @return {?}
                 */function () {
                    return new mxgraphTs.mxPoint(Math.max(0, Math.round(_this.container.offsetWidth - 34)), Math.max(0, Math.round(_this.container.offsetHeight - 34)));
                });
                this.getScrollTileSize = ( /**
                 * @return {?}
                 */function () {
                    if (_this.scrollTileSize == null) {
                        _this.scrollTileSize = new mxgraphTs.mxRectangle(0, 0, 400, 600);
                    }
                    return _this.scrollTileSize;
                });
                this.getPageSize = ( /**
                 * @return {?}
                 */function () {
                    return (_this.pageVisible) ? new mxgraphTs.mxRectangle(0, 0, _this.pageFormat.width * _this.pageScale, _this.pageFormat.height * _this.pageScale) : _this.getScrollTileSize();
                });
                this.getPageLayout = ( /**
                 * @return {?}
                 */function () {
                    /** @type {?} */
                    var size = (_this.pageVisible) ? _this.getPageSize() : _this.getScrollTileSize();
                    /** @type {?} */
                    var bounds = _this.getGraphBounds();
                    if (bounds.width == 0 || bounds.height == 0) {
                        return new mxgraphTs.mxRectangle(0, 0, 1, 1);
                    }
                    else {
                        // Computes untransformed graph bounds
                        /** @type {?} */
                        var x = Math.ceil(bounds.x / _this.view.scale - _this.view.translate.x);
                        /** @type {?} */
                        var y = Math.ceil(bounds.y / _this.view.scale - _this.view.translate.y);
                        /** @type {?} */
                        var w = Math.floor(bounds.width / _this.view.scale);
                        /** @type {?} */
                        var h = Math.floor(bounds.height / _this.view.scale);
                        /** @type {?} */
                        var x0 = Math.floor(x / size.width);
                        /** @type {?} */
                        var y0 = Math.floor(y / size.height);
                        /** @type {?} */
                        var w0 = Math.ceil((x + w) / size.width) - x0;
                        /** @type {?} */
                        var h0 = Math.ceil((y + h) / size.height) - y0;
                        return new mxgraphTs.mxRectangle(x0, y0, w0, h0);
                    }
                });
                this.getPreferredPageSize = ( /**
                 * @param {?} bounds
                 * @param {?} width
                 * @param {?} height
                 * @return {?}
                 */function (bounds, width, height) {
                    /** @type {?} */
                    var pages = _this.getPageLayout();
                    /** @type {?} */
                    var size = _this.getPageSize();
                    return new mxgraphTs.mxRectangle(0, 0, pages.width * size.width, pages.height * size.height);
                });
                // 重写画布大小变化后方法
                /** @type {?} */
                var graphSizeDidChange = this.sizeDidChange;
                this.sizeDidChange = ( /**
                 * @return {?}
                 */function () {
                    if (_this.container != null && mxgraphTs.mxUtils.hasScrollbars(_this.container)) {
                        /** @type {?} */
                        var pages = _this.getPageLayout();
                        /** @type {?} */
                        var pad = _this.getPagePadding();
                        /** @type {?} */
                        var size = _this.getPageSize();
                        // Updates the minimum graph size
                        /** @type {?} */
                        var minw = Math.ceil(2 * pad.x / _this.view.scale + pages.width * size.width);
                        /** @type {?} */
                        var minh = Math.ceil(2 * pad.y / _this.view.scale + pages.height * size.height);
                        /** @type {?} */
                        var min = _this.minimumGraphSize;
                        // LATER: Fix flicker of scrollbar size in IE quirks mode
                        // after delayed call in window.resize event handler
                        if (min == null || min.width != minw || min.height != minh) {
                            _this.minimumGraphSize = new mxgraphTs.mxRectangle(0, 0, minw, minh);
                        }
                        // Updates auto-translate to include padding and graph size
                        /** @type {?} */
                        var dx = pad.x / _this.view.scale - pages.x * size.width;
                        /** @type {?} */
                        var dy = pad.y / _this.view.scale - pages.y * size.height;
                        if (!_this.autoTranslate && (_this.view.translate.x != dx || _this.view.translate.y != dy)) {
                            _this.autoTranslate = true;
                            (( /** @type {?} */(_this.view))).x0 = pages.x;
                            (( /** @type {?} */(_this.view))).y0 = pages.y;
                            /** @type {?} */
                            var tx = _this.view.translate.x;
                            /** @type {?} */
                            var ty = _this.view.translate.y;
                            _this.view.setTranslate(dx, dy);
                            _this.container.scrollLeft += (dx - tx) * _this.view.scale;
                            _this.container.scrollTop += (dy - ty) * _this.view.scale;
                            _this.autoTranslate = false;
                            return;
                        }
                        graphSizeDidChange.apply(_this, []);
                    }
                });
                // 重写view获取背景页大小
                this.view.getBackgroundPageBounds = ( /**
                 * @return {?}
                 */function () {
                    /** @type {?} */
                    var layout = _this.getPageLayout();
                    /** @type {?} */
                    var page = _this.getPageSize();
                    return new mxgraphTs.mxRectangle(_this.view.scale * (_this.view.translate.x + layout.x * page.width), _this.view.scale * (_this.view.translate.y + layout.y * page.height), _this.view.scale * layout.width * page.width, _this.view.scale * layout.height * page.height);
                });
                // 重写view validate方法
                /** @type {?} */
                var graphViewValidate = this.view.validate;
                this.view.validate = ( /**
                 * @param {?=} cell
                 * @return {?}
                 */function (cell) {
                    if (_this.container != null && mxgraphTs.mxUtils.hasScrollbars(_this.container)) {
                        /** @type {?} */
                        var pad = _this.getPagePadding();
                        /** @type {?} */
                        var size = _this.getPageSize();
                        /** @type {?} */
                        var tx = _this.view.translate.x;
                        /** @type {?} */
                        var ty = _this.view.translate.y;
                        _this.view.translate.x = pad.x / _this.view.scale - ((( /** @type {?} */(_this.view))).x0 || 0) * size.width;
                        _this.view.translate.y = pad.y / _this.view.scale - ((( /** @type {?} */(_this.view))).y0 || 0) * size.height;
                    }
                    graphViewValidate.apply(_this.view, [cell]);
                });
            };
        /**
         * 创建BpmnModel
         */
        /**
         * 创建BpmnModel
         * @return {?}
         */
        FlowGraph.prototype.createBpmnModel = /**
         * 创建BpmnModel
         * @return {?}
         */
            function () {
                /** @type {?} */
                var bpmnModel$$1 = new bpmnModel.BpmnModel();
                bpmnModel$$1.TargetNamespace = "Default_Namespace";
                bpmnModel$$1.DefaultProcess = new bpmnModel.Process(bpmnModel$$1);
                bpmnModel$$1.DefaultDiagram = new bpmnModel.BPMNDiagram(bpmnModel$$1);
                bpmnModel$$1.DefaultDiagram.BpmnPlane.BpmnElementId = bpmnModel$$1.DefaultProcess.Id;
                return bpmnModel$$1;
            };
        /**
         * 加载BpmnModel并画图
         */
        /**
         * 加载BpmnModel并画图
         * @param {?} json
         * @return {?}
         */
        FlowGraph.prototype.loadBpmnModel = /**
         * 加载BpmnModel并画图
         * @param {?} json
         * @return {?}
         */
            function (json) {
                this.removeCells(this.getChildCells(this.getDefaultParent()));
                this.bpmnModel = this.createBpmnModel();
                this.bpmnModel.LoadFromJson(json);
                this.drawBpmnGraph(this.bpmnModel);
            };
        /**
         * 重新加载BpmnModel并画图
         * @param json
         */
        /**
         * 重新加载BpmnModel并画图
         * @param {?=} json
         * @return {?}
         */
        FlowGraph.prototype.reloadBpmnModel = /**
         * 重新加载BpmnModel并画图
         * @param {?=} json
         * @return {?}
         */
            function (json) {
                this.removeCells(this.getChildCells(this.getDefaultParent()));
                if (json) {
                    this.loadBpmnModel(json);
                }
                else {
                    this.drawBpmnGraph(this.bpmnModel);
                }
            };
        /**
         * 根据BpmnModel画图
         */
        /**
         * 根据BpmnModel画图
         * @param {?} bpmnModel
         * @return {?}
         */
        FlowGraph.prototype.drawBpmnGraph = /**
         * 根据BpmnModel画图
         * @param {?} bpmnModel
         * @return {?}
         */
            function (bpmnModel$$1) {
                var _a = this.buildFlowDiagDict(bpmnModel$$1), nodeDict = _a.nodeDict, edgeDict = _a.edgeDict;
                /** @type {?} */
                var flowDict = this.buildFlowDict(bpmnModel$$1);
                this.drawNodeCells(flowDict, nodeDict);
                this.drawEdgeCells(flowDict, edgeDict);
                this.getModel().beginUpdate();
                if (this.mode === 'simulation') {
                    this.drawInterceptGraph(flowDict, nodeDict, edgeDict);
                    this.addJumpEdges(flowDict);
                }
                this.getModel().endUpdate();
            };
        /**
         * @private
         * @param {?} flowDict
         * @param {?} nodeDict
         * @param {?} edgeDict
         * @return {?}
         */
        FlowGraph.prototype.drawInterceptGraph = /**
         * @private
         * @param {?} flowDict
         * @param {?} nodeDict
         * @param {?} edgeDict
         * @return {?}
         */
            function (flowDict, nodeDict, edgeDict) {
                var _this = this;
                /** @type {?} */
                var firstAct = this.findFirstStartActivityInstance(this.actList);
                // todo：此处待修复
                /** @type {?} */
                var endActDef;
                for (var key in flowDict) {
                    if (flowDict[key] instanceof bpmnModel.EndEvent) {
                        endActDef = ( /** @type {?} */(flowDict[key]));
                    }
                }
                if (firstAct) {
                    /** @type {?} */
                    var endActiInstList = this.findEndActiInstList(firstAct, this.actList, this.transInsList);
                    endActiInstList.forEach((( /**
                     * @param {?} endActiInst
                     * @return {?}
                     */function (endActiInst) {
                        if (endActiInst.activityDefinitionId !== endActDef.Id) {
                            _this.drawNextFlowChart(endActiInst.activityDefinitionId, nodeDict, edgeDict);
                        }
                    })));
                }
            };
        /**
         * @param {?} flowDict
         * @return {?}
         */
        FlowGraph.prototype.addJumpEdges = /**
         * @param {?} flowDict
         * @return {?}
         */
            function (flowDict) {
                var e_1, _a;
                /** @type {?} */
                var nodeCells = ( /** @type {?} */((this.getChildCells(this.getDefaultParent(), true) || [])));
                /** @type {?} */
                var noIncomingNodes = this.findNoIncomingNodes(nodeCells);
                var _loop_1 = function (node) {
                    /** @type {?} */
                    var actInst = this_1.actList.filter(( /**
                     * @param {?} a
                     * @return {?}
                     */function (a) { return a.activityDefinitionId === node.flowElement.Id; }))[0];
                    /** @type {?} */
                    var cellId = actInst.precursorActivityDefinitionId + '_' + actInst.activityDefinitionId;
                    /** @type {?} */
                    var source = nodeCells.find(( /**
                     * @param {?} it
                     * @return {?}
                     */function (it) {
                        return it.flowElement && it.flowElement.Id === actInst.precursorActivityDefinitionId;
                    }));
                    /** @type {?} */
                    var target = nodeCells.find(( /**
                     * @param {?} it
                     * @return {?}
                     */function (it) {
                        return it.flowElement && it.flowElement.Id === actInst.activityDefinitionId;
                    }));
                    /** @type {?} */
                    var map = new Map();
                    map.set('jump', true);
                    /** @type {?} */
                    var style = this_1.getEdgeStyle(null, null, map);
                    /** @type {?} */
                    var cell = ( /** @type {?} */(this_1.insertEdge(this_1.getDefaultParent(), cellId, '', source, target, style)));
                    if (cell !== null) {
                        cell.source = source;
                        cell.target = target;
                        cell.geometry.points = [
                        // new mxPoint(source.geometry.x+ source.geometry.width/2, target.geometry.y+target.geometry.height/2)
                        ];
                        console.log(cell);
                        this_1.moveCells([cell], undefined, undefined, undefined, this_1.getDefaultParent());
                    }
                };
                var this_1 = this;
                try {
                    for (var noIncomingNodes_1 = __values(noIncomingNodes), noIncomingNodes_1_1 = noIncomingNodes_1.next(); !noIncomingNodes_1_1.done; noIncomingNodes_1_1 = noIncomingNodes_1.next()) {
                        var node = noIncomingNodes_1_1.value;
                        _loop_1(node);
                    }
                }
                catch (e_1_1) {
                    e_1 = { error: e_1_1 };
                }
                finally {
                    try {
                        if (noIncomingNodes_1_1 && !noIncomingNodes_1_1.done && (_a = noIncomingNodes_1.return))
                            _a.call(noIncomingNodes_1);
                    }
                    finally {
                        if (e_1)
                            throw e_1.error;
                    }
                }
            };
        /**
         * 画节点
         */
        /**
         * 画节点
         * @param {?} flowDict
         * @param {?} nodeDict
         * @param {?=} additional
         * @return {?}
         */
        FlowGraph.prototype.drawNodeCells = /**
         * 画节点
         * @param {?} flowDict
         * @param {?} nodeDict
         * @param {?=} additional
         * @return {?}
         */
            function (flowDict, nodeDict, additional) {
                var _this = this;
                if (additional === void 0) {
                    additional = false;
                }
                Object.keys(nodeDict).forEach(( /**
                 * @param {?} bpmnModelElementId
                 * @return {?}
                 */function (bpmnModelElementId) {
                    /** @type {?} */
                    var flowElt = flowDict[bpmnModelElementId];
                    /** @type {?} */
                    var diagElt = ( /** @type {?} */(nodeDict[bpmnModelElementId]));
                    if (flowElt == null) {
                        return;
                    }
                    _this.drawNodeCell(flowElt, diagElt, additional);
                }));
            };
        /**
         * 画单个节点
         * @param flowElt
         * @param diagElt
         * @param additional
         */
        /**
         * 画单个节点
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @return {?}
         */
        FlowGraph.prototype.drawNodeCell = /**
         * 画单个节点
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @return {?}
         */
            function (flowElt, diagElt, additional) {
                /** @type {?} */
                var style = this.getVertexStyle(flowElt, diagElt, additional);
                /** @type {?} */
                var cell = null;
                /** @type {?} */
                var label = "";
                if (flowElt != null) {
                    label = flowElt.Name;
                    if (flowElt.NameLanguage && flowElt.NameLanguage[this.langCode] != null) {
                        label = flowElt.NameLanguage[this.langCode];
                    }
                }
                if (this.mode === 'simulation') {
                    if (this.actList.findIndex(( /**
                     * @param {?} a
                     * @return {?}
                     */function (a) { return a.activityDefinitionId === flowElt.Id; })) > -1) {
                        cell = ( /** @type {?} */(this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
                    }
                    else if (additional) {
                        cell = ( /** @type {?} */(this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
                    }
                }
                else {
                    cell = ( /** @type {?} */(this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
                }
                if (cell == null) {
                    return;
                }
                // const cell = this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style) as Cell;
                cell.flowElement = flowElt;
                cell.diagramElement = diagElt;
                this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
            };
        /**
         * 画连线
         */
        /**
         * 画连线
         * @param {?} flowDict
         * @param {?} edgeDict
         * @param {?=} additional
         * @param {?=} cut
         * @return {?}
         */
        FlowGraph.prototype.drawEdgeCells = /**
         * 画连线
         * @param {?} flowDict
         * @param {?} edgeDict
         * @param {?=} additional
         * @param {?=} cut
         * @return {?}
         */
            function (flowDict, edgeDict, additional, cut) {
                var _this = this;
                if (additional === void 0) {
                    additional = false;
                }
                if (cut === void 0) {
                    cut = false;
                }
                Object.keys(edgeDict).forEach(( /**
                 * @param {?} bpmnModelElementId
                 * @return {?}
                 */function (bpmnModelElementId) {
                    /** @type {?} */
                    var flowElt = ( /** @type {?} */(flowDict[bpmnModelElementId]));
                    /** @type {?} */
                    var diagElt = ( /** @type {?} */(edgeDict[bpmnModelElementId]));
                    if (flowElt == null) {
                        return;
                    }
                    _this.drawEdgeCell(flowElt, diagElt, additional, cut);
                }));
            };
        /**
         * @private
         * @param {?} flowDict
         * @param {?} sourceId
         * @param {?} targetId
         * @return {?}
         */
        FlowGraph.prototype.judgeConnectBetweenTwoNodes = /**
         * @private
         * @param {?} flowDict
         * @param {?} sourceId
         * @param {?} targetId
         * @return {?}
         */
            function (flowDict, sourceId, targetId) {
                var e_2, _a;
                /** @type {?} */
                var source = ( /** @type {?} */(flowDict[sourceId]));
                /** @type {?} */
                var outGoings = source.Outgoings;
                if (!outGoings || outGoings.length === 0) {
                    return false;
                }
                try {
                    for (var outGoings_1 = __values(outGoings), outGoings_1_1 = outGoings_1.next(); !outGoings_1_1.done; outGoings_1_1 = outGoings_1.next()) {
                        var outGoing = outGoings_1_1.value;
                        /** @type {?} */
                        var sequenceFlow = ( /** @type {?} */(flowDict[outGoing]));
                        if (sequenceFlow.TargetRef === targetId) {
                            return true;
                        }
                    }
                }
                catch (e_2_1) {
                    e_2 = { error: e_2_1 };
                }
                finally {
                    try {
                        if (outGoings_1_1 && !outGoings_1_1.done && (_a = outGoings_1.return))
                            _a.call(outGoings_1);
                    }
                    finally {
                        if (e_2)
                            throw e_2.error;
                    }
                }
                return false;
            };
        /**
         * 画单条连线
         * @param flowElt
         * @param diagElt
         * @param additional
         * @param cut
         * @returns
         */
        /**
         * 画单条连线
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @param {?} cut
         * @return {?}
         */
        FlowGraph.prototype.drawEdgeCell = /**
         * 画单条连线
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @param {?} cut
         * @return {?}
         */
            function (flowElt, diagElt, additional, cut) {
                // 获取已插入的节点元素
                /** @type {?} */
                var nodeCells = ( /** @type {?} */((this.getChildCells(this.getDefaultParent(), true) || [])));
                /** @type {?} */
                var source = nodeCells.find(( /**
                 * @param {?} it
                 * @return {?}
                 */function (it) {
                    return it.flowElement && it.flowElement.Id === flowElt.SourceRef;
                }));
                /** @type {?} */
                var target = nodeCells.find(( /**
                 * @param {?} it
                 * @return {?}
                 */function (it) {
                    return it.flowElement && it.flowElement.Id === flowElt.TargetRef;
                }));
                /** @type {?} */
                var map = new Map();
                map.set('additional', additional);
                map.set('cut', cut);
                /** @type {?} */
                var style = this.getEdgeStyle(flowElt, diagElt, map);
                /** @type {?} */
                var cell = null;
                /** @type {?} */
                var label = "";
                if (flowElt != null) {
                    label = flowElt.Name;
                    if (flowElt.NameLanguage && flowElt.NameLanguage[this.langCode] != null) {
                        label = flowElt.NameLanguage[this.langCode];
                    }
                }
                if (this.mode === 'simulation') {
                    if (this.transInsList.findIndex(( /**
                     * @param {?} a
                     * @return {?}
                     */function (a) {
                        return a.sourceActivityDefinitionId === flowElt.SourceRef
                            && a.destinationActivityDefinitionId === flowElt.TargetRef;
                    })) > -1) {
                        cell = ( /** @type {?} */(this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
                    }
                    else if (additional || cut) {
                        cell = ( /** @type {?} */(this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
                    }
                }
                else {
                    cell = ( /** @type {?} */(this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
                }
                if (cell == null) {
                    return;
                }
                // const cell = this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style) as Cell;
                // cell.geometry.relative = true;
                cell.flowElement = flowElt;
                cell.diagramElement = diagElt;
                cell.source = source;
                cell.target = target;
                cell.geometry.points = cell.geometry.points || [];
                // 判断是否为旧版本连线
                if (this.isOldBpmnEdge(diagElt)) {
                    for (var i = 2; i < diagElt.Points.length; i++) {
                        /** @type {?} */
                        var pt = diagElt.Points[i];
                        cell.geometry.points.push(new mxgraphTs.mxPoint(pt.X, pt.Y));
                    }
                    // 此行代码执行后可获取mxCellState
                    this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
                    //按坐标插入label
                    /** @type {?} */
                    var state = this.view.getState(cell);
                    if (diagElt.BpmnLabel && state) {
                        if (diagElt.BpmnLabel.Bounds.X === 0 && diagElt.BpmnLabel.Bounds.Y === 0) {
                            return;
                        }
                        /** @type {?} */
                        var x = diagElt.BpmnLabel.Bounds.X + (state.x - state.paintBounds.x);
                        /** @type {?} */
                        var y = diagElt.BpmnLabel.Bounds.Y + (state.y - state.paintBounds.y);
                        /** @type {?} */
                        var edgeHandler = this.createEdgeHandler(state, undefined);
                        edgeHandler.moveLabel(state, x, y);
                        edgeHandler.destroy();
                    }
                }
                else {
                    for (var i = 1; i < diagElt.Points.length - 1; i++) {
                        /** @type {?} */
                        var pt = diagElt.Points[i];
                        cell.geometry.points.push(new mxgraphTs.mxPoint(pt.X, pt.Y));
                    }
                    // 此行代码执行后可获取mxCellState
                    this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
                    //按坐标插入label
                    /** @type {?} */
                    var state = this.view.getState(cell);
                    /** @type {?} */
                    var scale = this.view.getScale();
                    /** @type {?} */
                    var translate = this.view.getTranslate();
                    if (diagElt.BpmnLabel && state) {
                        if (diagElt.BpmnLabel.Bounds.X === 0 && diagElt.BpmnLabel.Bounds.Y === 0) {
                            return;
                        }
                        /** @type {?} */
                        var x = diagElt.BpmnLabel.Bounds.X * scale + translate.x;
                        /** @type {?} */
                        var y = diagElt.BpmnLabel.Bounds.Y * scale + translate.y;
                        /** @type {?} */
                        var edgeHandler = this.createEdgeHandler(state, undefined);
                        edgeHandler.moveLabel(state, x, y);
                        edgeHandler.destroy();
                    }
                }
            };
        /**
         * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
         */
        /**
         * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
         * @param {?} bpmnModel
         * @return {?}
         */
        FlowGraph.prototype.buildFlowDict = /**
         * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
         * @param {?} bpmnModel
         * @return {?}
         */
            function (bpmnModel$$1) {
                /** @type {?} */
                var flowDict = bpmnModel$$1.DefaultProcess.GetFlowElements();
                return flowDict;
            };
        /**
         * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
         */
        /**
         * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
         * @param {?} bpmnModel
         * @return {?}
         */
        FlowGraph.prototype.buildFlowDiagDict = /**
         * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
         * @param {?} bpmnModel
         * @return {?}
         */
            function (bpmnModel$$1) {
                /** @type {?} */
                var nodeDict = {};
                /** @type {?} */
                var edgeDict = {};
                /** @type {?} */
                var diagramElts = ( /** @type {?} */(bpmnModel$$1.DefaultDiagram.BpmnPlane.GetDiagramElements()));
                diagramElts && diagramElts.forEach(( /**
                 * @param {?} elt
                 * @return {?}
                 */function (elt) {
                    if (elt instanceof bpmnModel.Node) {
                        nodeDict[elt.BpmnElementId] = elt;
                    }
                    else if (elt instanceof bpmnModel.Edge) {
                        edgeDict[elt.BpmnElementId] = elt;
                    }
                }));
                return {
                    nodeDict: nodeDict,
                    edgeDict: edgeDict,
                };
            };
        /**
         * 判断是否为旧版本BPMNEdge
         *
         * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
         * 新版本从起点到终点按顺序记录每一个点坐标
         * @param bpmnEdge
         * @returns
         */
        /**
         * 判断是否为旧版本BPMNEdge
         *
         * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
         * 新版本从起点到终点按顺序记录每一个点坐标
         * @param {?} bpmnEdge
         * @return {?}
         */
        FlowGraph.prototype.isOldBpmnEdge = /**
         * 判断是否为旧版本BPMNEdge
         *
         * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
         * 新版本从起点到终点按顺序记录每一个点坐标
         * @param {?} bpmnEdge
         * @return {?}
         */
            function (bpmnEdge) {
                if (bpmnEdge.Points.length >= 2) {
                    /** @type {?} */
                    var pt1 = bpmnEdge.Points[0];
                    /** @type {?} */
                    var pt2 = bpmnEdge.Points[1];
                    if (pt1.X == 0 && pt1.Y == 0 && pt2.X == 0 && pt2.Y == 0) {
                        return true;
                    }
                }
                return false;
            };
        /**
         * 获取节点样式
         * @param flowElt
         * @param diagElt
         * @param additional
         * @returns
         */
        /**
         * 获取节点样式
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @return {?}
         */
        FlowGraph.prototype.getVertexStyle = /**
         * 获取节点样式
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @return {?}
         */
            function (flowElt, diagElt, additional) {
                /** @type {?} */
                var activityInstanceSlims = this.actList;
                /** @type {?} */
                var stateShapeStyle = null;
                // 特殊处理,业务活动要单独赋成人工操作类型的样式
                // if (flowElt.ClrTypeID === UserActivity.Clr_Type_ID) {
                //   stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[flowElt.ClrTypeID];
                // } else if (flowElt.ClrTypeID === OperationActivity.Clr_Type_ID) {
                //   stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[OperationActivity.Clr_Type_ID];
                // }
                if (flowElt instanceof wfProcessModel.UserActivity && flowElt.BizActivityID !== '') {
                    stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[wfProcessModel.OperationActivity.Clr_Type_ID];
                }
                else {
                    stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[flowElt.ClrTypeID];
                }
                if (stateShapeStyle == null) {
                    return this.getVertexStyleOld(flowElt, additional);
                }
                /** @type {?} */
                var img = stateShapeStyle[bpmnModel.FlowNodeState.Default] && stateShapeStyle[bpmnModel.FlowNodeState.Default].image;
                if (!additional) {
                    /** @type {?} */
                    var acts = activityInstanceSlims.filter(( /**
                     * @param {?} item
                     * @return {?}
                     */function (item) { return item.activityDefinitionId === flowElt.Id; }));
                    if (acts && acts.length > 0) {
                        if (acts.filter(( /**
                         * @param {?} act
                         * @return {?}
                         */function (act) { return act.state === 'RUNNING'; })).length > 0) {
                            if (stateShapeStyle[bpmnModel.FlowNodeState.Running]) {
                                img = stateShapeStyle[bpmnModel.FlowNodeState.Running].image;
                            }
                        }
                        else if (acts.filter(( /**
                         * @param {?} act
                         * @return {?}
                         */function (act) { return act.state === 'COMPLETED'; })).length > 0) {
                            if (stateShapeStyle[bpmnModel.FlowNodeState.Completed]) {
                                img = stateShapeStyle[bpmnModel.FlowNodeState.Completed].image;
                            }
                        }
                        else if (acts.filter(( /**
                         * @param {?} act
                         * @return {?}
                         */function (act) { return act.state === 'TERMINATED'; })).length > 0) {
                            if (stateShapeStyle[bpmnModel.FlowNodeState.Terminated]) {
                                img = stateShapeStyle[bpmnModel.FlowNodeState.Terminated].image;
                            }
                        }
                    }
                }
                return img == null ? null : 'image=' + this.rootPath + img;
            };
        /**
         * 旧版diagramElement未存储样式信息
         * @param flowElt
         * @param additional
         * @returns
         */
        /**
         * 旧版diagramElement未存储样式信息
         * @param {?} flowElt
         * @param {?} additional
         * @return {?}
         */
        FlowGraph.prototype.getVertexStyleOld = /**
         * 旧版diagramElement未存储样式信息
         * @param {?} flowElt
         * @param {?} additional
         * @return {?}
         */
            function (flowElt, additional) {
                /** @type {?} */
                var style;
                switch (flowElt.ClrTypeID) {
                    //结束事件
                    case "bpmn.EndEvent":
                        style = 'end';
                        break;
                    //流程开始活动节点
                    case wfProcessModel.StartActivity.Clr_Type_ID:
                        style = 'start';
                        break;
                    // 业务活动节点
                    case wfProcessModel.UserActivity.Clr_Type_ID:
                        if ((( /** @type {?} */(flowElt))).BizActivityID) {
                            style = 'bizActivity';
                        }
                        else {
                            style = 'approval';
                        }
                        break;
                    // 排他网关
                    case 'bpmn.ExclusiveGateway':
                        style = 'ExclusiveGateway';
                        break;
                    //并行网关
                    case 'bpmn.ParallelGateway':
                        style = 'ParallelGateway';
                        break;
                    case wfProcessModel.CallActivitySubProcess.Clr_Type_ID:
                        style = 'sub';
                        break;
                    case wfProcessModel.AutoActivity.Clr_Type_ID:
                        style = 'auto';
                        break;
                    case wfProcessModel.IntermediateCatchEventImpl.Clr_Type_ID:
                        style = 'catchEvent';
                        break;
                    case wfProcessModel.OperationActivity.Clr_Type_ID:
                        style = 'bizActivity';
                        break;
                    case wfProcessModel.MessageActivity.Clr_Type_ID:
                        style = 'message';
                        break;
                    case wfProcessModel.NotifyActivity.Clr_Type_ID:
                        style = 'notify';
                        break;
                    case wfProcessModel.AifCreationBillActivity.Clr_Type_ID:
                        style = 'aifCreationActivity';
                        break;
                    default:
                        break;
                }
                return 'image=' + this.rootPath + '/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/' + style + this.getChartState(flowElt, additional) + ';';
            };
        /**
         * @param {?} flowElt
         * @param {?} additional
         * @return {?}
         */
        FlowGraph.prototype.getChartState = /**
         * @param {?} flowElt
         * @param {?} additional
         * @return {?}
         */
            function (flowElt, additional) {
                if (!additional) {
                    /** @type {?} */
                    var acts = this.actList.filter(( /**
                     * @param {?} item
                     * @return {?}
                     */function (item) { return item.activityDefinitionId === flowElt.Id; }));
                    if (acts && acts.length > 0) {
                        if (acts.filter(( /**
                         * @param {?} act
                         * @return {?}
                         */function (act) { return act.state === 'RUNNING'; })).length > 0) {
                            return '_light.gif';
                        }
                        else if (acts.filter(( /**
                         * @param {?} act
                         * @return {?}
                         */function (act) { return act.state === 'COMPLETED'; })).length > 0
                            || acts.filter(( /**
                             * @param {?} act
                             * @return {?}
                             */function (act) { return act.state === 'TERMINATED'; })).length > 0) {
                            return '_gray.png';
                        }
                        else {
                            return '.png';
                        }
                    }
                }
                return '.png';
            };
        /**
         * 获取连线样式
         * @param flowElt
         * @param additional
         * @param cut
         * @returns
         */
        /**
         * 获取连线样式
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} parameters
         * @return {?}
         */
        FlowGraph.prototype.getEdgeStyle = /**
         * 获取连线样式
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} parameters
         * @return {?}
         */
            function (flowElt, diagElt, parameters) {
                if (parameters.get('jump')) {
                    /** @type {?} */
                    var style_1 = '';
                    /** @type {?} */
                    var stateEdgeStyle_1 = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic['bpmn.SequenceFlow'];
                    if (stateEdgeStyle_1['jump']) {
                        Object.keys(stateEdgeStyle_1['jump']).forEach(( /**
                         * @param {?} key
                         * @return {?}
                         */function (key) {
                            style_1 += (key + "=" + stateEdgeStyle_1['jump'][key] + ";");
                        }));
                        return style_1;
                    }
                    return null;
                }
                else {
                    /** @type {?} */
                    var stateEdgeStyle_2 = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic[flowElt.ClrTypeID];
                    if (stateEdgeStyle_2 == null) {
                        return this.getEdgeStyleOld(flowElt, parameters.get('additional'), parameters.get('cut'));
                    }
                    /** @type {?} */
                    var transitionInstanceSlims = this.transInsList;
                    /** @type {?} */
                    var style_2 = '';
                    if (parameters.get('cut')) {
                        if (stateEdgeStyle_2[bpmnModel.SequenceFlowState.Cut]) {
                            Object.keys(stateEdgeStyle_2[bpmnModel.SequenceFlowState.Cut]).forEach(( /**
                             * @param {?} key
                             * @return {?}
                             */function (key) {
                                style_2 += (key + "=" + stateEdgeStyle_2[bpmnModel.SequenceFlowState.Cut][key] + ";");
                            }));
                            return style_2;
                        }
                    }
                    if (parameters.get('additional')) {
                        if (stateEdgeStyle_2[bpmnModel.SequenceFlowState.Add]) {
                            Object.keys(stateEdgeStyle_2[bpmnModel.SequenceFlowState.Add]).forEach(( /**
                             * @param {?} key
                             * @return {?}
                             */function (key) {
                                style_2 += (key + "=" + stateEdgeStyle_2[bpmnModel.SequenceFlowState.Add][key] + ";");
                            }));
                            return style_2;
                        }
                    }
                    /** @type {?} */
                    var transIns = transitionInstanceSlims.filter(( /**
                     * @param {?} item
                     * @return {?}
                     */function (item) { return item.sourceActivityDefinitionId === flowElt.SourceRef && item.destinationActivityDefinitionId === flowElt.TargetRef; }));
                    if (transIns && transIns.filter(( /**
                     * @param {?} t
                     * @return {?}
                     */function (t) { return t.state === 'COMPLETED'; })).length > 0) {
                        if (stateEdgeStyle_2[bpmnModel.SequenceFlowState.Completed]) {
                            Object.keys(stateEdgeStyle_2[bpmnModel.SequenceFlowState.Completed]).forEach(( /**
                             * @param {?} key
                             * @return {?}
                             */function (key) {
                                style_2 += (key + "=" + stateEdgeStyle_2[bpmnModel.SequenceFlowState.Completed][key] + ";");
                            }));
                            return style_2;
                        }
                    }
                    if (this.mode === 'simulation') {
                        if (stateEdgeStyle_2[bpmnModel.SequenceFlowState.Simulation]) {
                            Object.keys(stateEdgeStyle_2[bpmnModel.SequenceFlowState.Simulation]).forEach(( /**
                             * @param {?} key
                             * @return {?}
                             */function (key) {
                                style_2 += (key + "=" + stateEdgeStyle_2[bpmnModel.SequenceFlowState.Simulation][key] + ";");
                            }));
                            return style_2;
                        }
                    }
                    if (stateEdgeStyle_2[bpmnModel.SequenceFlowState.Default]) {
                        Object.keys(stateEdgeStyle_2[bpmnModel.SequenceFlowState.Default]).forEach(( /**
                         * @param {?} key
                         * @return {?}
                         */function (key) {
                            style_2 += (key + "=" + stateEdgeStyle_2[bpmnModel.SequenceFlowState.Default][key] + ";");
                        }));
                    }
                    return style_2;
                }
            };
        /**
         * 获取连线颜色
         * @param flowElt
         * @param diagElt
         * @param additional
         * @param cut
         * @returns
         */
        /**
         * 获取连线颜色
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @param {?} cut
         * @return {?}
         */
        FlowGraph.prototype.getStrokeColor = /**
         * 获取连线颜色
         * @param {?} flowElt
         * @param {?} diagElt
         * @param {?} additional
         * @param {?} cut
         * @return {?}
         */
            function (flowElt, diagElt, additional, cut) {
                /** @type {?} */
                var transitionInstanceSlims = this.transInsList;
                /** @type {?} */
                var stateEdgeStyle = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic[flowElt.ClrTypeID];
                if (cut) {
                    if (stateEdgeStyle[bpmnModel.SequenceFlowState.Cut]) {
                        return stateEdgeStyle[bpmnModel.SequenceFlowState.Cut].strokeColor;
                    }
                }
                if (additional) {
                    if (stateEdgeStyle[bpmnModel.SequenceFlowState.Add]) {
                        return stateEdgeStyle[bpmnModel.SequenceFlowState.Add].strokeColor;
                    }
                }
                /** @type {?} */
                var transIns = transitionInstanceSlims.filter(( /**
                 * @param {?} item
                 * @return {?}
                 */function (item) { return item.sourceActivityDefinitionId === flowElt.SourceRef && item.destinationActivityDefinitionId === flowElt.TargetRef; }));
                if (transIns && transIns.filter(( /**
                 * @param {?} t
                 * @return {?}
                 */function (t) { return t.state === 'COMPLETED'; })).length > 0) {
                    if (stateEdgeStyle[bpmnModel.SequenceFlowState.Completed]) {
                        return stateEdgeStyle[bpmnModel.SequenceFlowState.Completed].strokeColor;
                    }
                }
                if (this.mode === 'simulation') {
                    if (stateEdgeStyle[bpmnModel.SequenceFlowState.Simulation]) {
                        return stateEdgeStyle[bpmnModel.SequenceFlowState.Simulation].strokeColor;
                    }
                }
                return stateEdgeStyle[bpmnModel.SequenceFlowState.Default].strokeColor;
            };
        /**
         * 旧版diagramElement未存储样式信息
         * @param flowElt
         * @param additional
         * @returns
         */
        /**
         * 旧版diagramElement未存储样式信息
         * @param {?} seq
         * @param {?} additional
         * @param {?} cut
         * @return {?}
         */
        FlowGraph.prototype.getEdgeStyleOld = /**
         * 旧版diagramElement未存储样式信息
         * @param {?} seq
         * @param {?} additional
         * @param {?} cut
         * @return {?}
         */
            function (seq, additional, cut) {
                if (cut) {
                    return 'strokeColor=#FF4040';
                }
                if (additional) {
                    return 'strokeColor=#59A1FF';
                }
                /** @type {?} */
                var transIns = this.transInsList.filter(( /**
                 * @param {?} item
                 * @return {?}
                 */function (item) { return item.sourceActivityDefinitionId === seq.SourceRef && item.destinationActivityDefinitionId === seq.TargetRef; }));
                if (transIns && transIns.filter(( /**
                 * @param {?} t
                 * @return {?}
                 */function (t) { return t.state === 'COMPLETED'; })).length > 0) {
                    return 'strokeColor=#595959;strokeWidth=2;';
                }
                if (this.mode === 'simulation') {
                    return 'strokeColor=#f59c24;dashed=1;';
                }
                else {
                    return 'strokeColor=#59A1FF;';
                }
            };
        /**
         * @param {?} actiDefId
         * @param {?} nodeDict
         * @param {?} edgeDict
         * @return {?}
         */
        FlowGraph.prototype.drawNextFlowChart = /**
         * @param {?} actiDefId
         * @param {?} nodeDict
         * @param {?} edgeDict
         * @return {?}
         */
            function (actiDefId, nodeDict, edgeDict) {
                var _this = this;
                var _a = this.findDrawFlowElementsByActDefId(actiDefId, this.bpmnModel), nextFlowNodeDict = _a.nextFlowNodeDict, nextSeqFlowDict = _a.nextSeqFlowDict;
                /** @type {?} */
                var actDef = ( /** @type {?} */(this.bpmnModel.DefaultProcess.GetFlowElement(actiDefId)));
                /** @type {?} */
                var outgoings = actDef.Outgoings;
                // 先插入节点
                Object.keys(nextFlowNodeDict).forEach(( /**
                 * @param {?} id
                 * @return {?}
                 */function (id) {
                    /** @type {?} */
                    var flowElt = nextFlowNodeDict[id];
                    /** @type {?} */
                    var diagElt = ( /** @type {?} */(nodeDict[flowElt.Id]));
                    /** @type {?} */
                    var cell = _this.getCellByFlowElementId(flowElt.Id);
                    if (!cell) {
                        _this.drawNodeCell(flowElt, diagElt, true);
                    }
                }));
                // 再插入边
                Object.keys(nextSeqFlowDict).forEach(( /**
                 * @param {?} id
                 * @return {?}
                 */function (id) {
                    /** @type {?} */
                    var flowElt = nextSeqFlowDict[id];
                    /** @type {?} */
                    var diagElt = ( /** @type {?} */(edgeDict[flowElt.Id]));
                    /** @type {?} */
                    var cell = _this.getCellByFlowElementId(flowElt.Id);
                    if (!cell) {
                        if (outgoings.some(( /**
                         * @param {?} o
                         * @return {?}
                         */function (o) { return o === flowElt.Id; }))) {
                            _this.drawEdgeCell(flowElt, diagElt, true, true);
                        }
                        else {
                            _this.drawEdgeCell(flowElt, diagElt, true, false);
                        }
                    }
                }));
            };
        /**
         * 根据flowElementId获取cell
         */
        /**
         * 根据flowElementId获取cell
         * @param {?} flowEltId
         * @param {?=} parent
         * @return {?}
         */
        FlowGraph.prototype.getCellByFlowElementId = /**
         * 根据flowElementId获取cell
         * @param {?} flowEltId
         * @param {?=} parent
         * @return {?}
         */
            function (flowEltId, parent) {
                parent = parent ? parent : this.getDefaultParent();
                /** @type {?} */
                var cells = this.getChildCells(parent);
                /** @type {?} */
                var cell = ( /** @type {?} */(cells.find(( /**
                 * @param {?} it
                 * @return {?}
                 */function (it) {
                    if (it instanceof Cell) {
                        return it.flowElement && it.flowElement.Id == flowEltId;
                    }
                    else {
                        return false;
                    }
                }))));
                return cell;
            };
        /**
         * @param {?} activities
         * @return {?}
         */
        FlowGraph.prototype.findFirstStartActivityInstance = /**
         * @param {?} activities
         * @return {?}
         */
            function (activities) {
                var e_3, _a;
                try {
                    for (var activities_1 = __values(activities), activities_1_1 = activities_1.next(); !activities_1_1.done; activities_1_1 = activities_1.next()) {
                        var act = activities_1_1.value;
                        if (!act.precursorActivityDefinitionId) {
                            return act;
                        }
                    }
                }
                catch (e_3_1) {
                    e_3 = { error: e_3_1 };
                }
                finally {
                    try {
                        if (activities_1_1 && !activities_1_1.done && (_a = activities_1.return))
                            _a.call(activities_1);
                    }
                    finally {
                        if (e_3)
                            throw e_3.error;
                    }
                }
                return null;
            };
        /**
         * @param {?} nodeCells
         * @return {?}
         */
        FlowGraph.prototype.findNoIncomingNodes = /**
         * @param {?} nodeCells
         * @return {?}
         */
            function (nodeCells) {
                var e_4, _a;
                /** @type {?} */
                var noIncomingNodes = new Array();
                var _loop_2 = function (node) {
                    if (node.flowElement.ClrTypeID === 'wf.StartActivity') {
                        return "continue";
                    }
                    if (!node.edges || node.edges.length === 0) {
                        noIncomingNodes.push(node);
                        return "continue";
                    }
                    if (!node.edges.some(( /**
                     * @param {?} edge
                     * @return {?}
                     */function (edge) { return (( /** @type {?} */(edge.target))).flowElement.Id === node.flowElement.Id; }))) {
                        noIncomingNodes.push(node);
                    }
                };
                try {
                    for (var nodeCells_1 = __values(nodeCells), nodeCells_1_1 = nodeCells_1.next(); !nodeCells_1_1.done; nodeCells_1_1 = nodeCells_1.next()) {
                        var node = nodeCells_1_1.value;
                        _loop_2(node);
                    }
                }
                catch (e_4_1) {
                    e_4 = { error: e_4_1 };
                }
                finally {
                    try {
                        if (nodeCells_1_1 && !nodeCells_1_1.done && (_a = nodeCells_1.return))
                            _a.call(nodeCells_1);
                    }
                    finally {
                        if (e_4)
                            throw e_4.error;
                    }
                }
                return noIncomingNodes;
            };
        /**
         * @param {?} firstAct
         * @param {?} activities
         * @param {?} transInsList
         * @return {?}
         */
        FlowGraph.prototype.findEndActiInstList = /**
         * @param {?} firstAct
         * @param {?} activities
         * @param {?} transInsList
         * @return {?}
         */
            function (firstAct, activities, transInsList) {
                /** @type {?} */
                var endActiInstList = [];
                this.getNextTransitions(endActiInstList, firstAct.activityInstanceId, activities, transInsList);
                return endActiInstList;
            };
        /**
         * @param {?} endActiInstList
         * @param {?} sourceActInstId
         * @param {?} activities
         * @param {?} transInsList
         * @return {?}
         */
        FlowGraph.prototype.getNextTransitions = /**
         * @param {?} endActiInstList
         * @param {?} sourceActInstId
         * @param {?} activities
         * @param {?} transInsList
         * @return {?}
         */
            function (endActiInstList, sourceActInstId, activities, transInsList) {
                var e_5, _a;
                /** @type {?} */
                var nextTransitions = this.findTranInstsBySourceActInstId(sourceActInstId, transInsList);
                if (nextTransitions && nextTransitions.length > 0) {
                    try {
                        for (var nextTransitions_1 = __values(nextTransitions), nextTransitions_1_1 = nextTransitions_1.next(); !nextTransitions_1_1.done; nextTransitions_1_1 = nextTransitions_1.next()) {
                            var t = nextTransitions_1_1.value;
                            if (t.destinationActivityDefinitionId) {
                                this.getNextTransitions(endActiInstList, t.destinationActivityInstanceId, activities, transInsList);
                            }
                        }
                    }
                    catch (e_5_1) {
                        e_5 = { error: e_5_1 };
                    }
                    finally {
                        try {
                            if (nextTransitions_1_1 && !nextTransitions_1_1.done && (_a = nextTransitions_1.return))
                                _a.call(nextTransitions_1);
                        }
                        finally {
                            if (e_5)
                                throw e_5.error;
                        }
                    }
                }
                else {
                    /** @type {?} */
                    var actInst_1 = this.findActInstByActInstId(sourceActInstId, activities);
                    if (actInst_1) {
                        if (!endActiInstList.some(( /**
                         * @param {?} a
                         * @return {?}
                         */function (a) { return a.activityInstanceId === actInst_1.activityInstanceId; }))) {
                            endActiInstList.push(actInst_1);
                        }
                    }
                }
            };
        /**
         * @param {?} sourceActInstId
         * @param {?} transInsList
         * @return {?}
         */
        FlowGraph.prototype.findTranInstsBySourceActInstId = /**
         * @param {?} sourceActInstId
         * @param {?} transInsList
         * @return {?}
         */
            function (sourceActInstId, transInsList) {
                return transInsList.filter(( /**
                 * @param {?} t
                 * @return {?}
                 */function (t) { return t.sourceActivityInstanceId === sourceActInstId; }));
            };
        /**
         * @param {?} actInstId
         * @param {?} activities
         * @return {?}
         */
        FlowGraph.prototype.findActInstByActInstId = /**
         * @param {?} actInstId
         * @param {?} activities
         * @return {?}
         */
            function (actInstId, activities) {
                return activities.find(( /**
                 * @param {?} a
                 * @return {?}
                 */function (a) { return a.activityInstanceId === actInstId; }));
            };
        /**
         * @param {?} actiDefId
         * @param {?} bpmnModel
         * @return {?}
         */
        FlowGraph.prototype.findDrawFlowElementsByActDefId = /**
         * @param {?} actiDefId
         * @param {?} bpmnModel
         * @return {?}
         */
            function (actiDefId, bpmnModel$$1) {
                /** @type {?} */
                var nextFlowNodeDict = {};
                /** @type {?} */
                var nextSeqFlowDict = {};
                this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, actiDefId, bpmnModel$$1);
                return {
                    nextFlowNodeDict: nextFlowNodeDict,
                    nextSeqFlowDict: nextSeqFlowDict,
                };
            };
        /**
         * @param {?} nextFlowNodeDict
         * @param {?} nextSeqFlowDict
         * @param {?} flowElementId
         * @param {?} bpmnModel
         * @return {?}
         */
        FlowGraph.prototype.findNextFlowElementsByFlowElementId = /**
         * @param {?} nextFlowNodeDict
         * @param {?} nextSeqFlowDict
         * @param {?} flowElementId
         * @param {?} bpmnModel
         * @return {?}
         */
            function (nextFlowNodeDict, nextSeqFlowDict, flowElementId, bpmnModel$$1) {
                var _this = this;
                /** @type {?} */
                var flowElt = bpmnModel$$1.DefaultProcess.GetFlowElement(flowElementId);
                if (flowElt && nextFlowNodeDict[flowElementId] == null) {
                    if (flowElt instanceof bpmnModel.SequenceFlow) {
                        nextSeqFlowDict[flowElt.Id] = flowElt;
                        this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, flowElt.TargetRef, bpmnModel$$1);
                    }
                    else if (flowElt instanceof bpmnModel.FlowNode) {
                        nextFlowNodeDict[flowElt.Id] = flowElt;
                        if ((flowElt instanceof bpmnModel.EndEvent) == false) {
                            flowElt.Outgoings && flowElt.Outgoings.forEach(( /**
                             * @param {?} outgoing
                             * @return {?}
                             */function (outgoing) {
                                _this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, outgoing, bpmnModel$$1);
                            }));
                        }
                    }
                }
            };
        return FlowGraph;
    }(mxgraphTs.mxGraph));

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var FlowChart = /** @class */ (function (_super) {
        __extends(FlowChart, _super);
        function FlowChart(container, config) {
            var _this = _super.call(this) || this;
            _this.mode = 'complete';
            _this.actList = [];
            _this.transInsList = [];
            _this.rootPath = ''; //基路径
            //基路径
            /**
             * 当前语言
             */
            _this.langCode = (( /** @type {?} */(window))).gspframeworkService && (( /** @type {?} */(window))).gspframeworkService.rtf.language.getLanguageCode() || localStorage.getItem('languageCode') || 'zh-CHS';
            try {
                _this.rootPath = (( /** @type {?} */(window))).gspframeworkService.common.getBasePath.get();
            }
            catch (error) {
            }
            _this.container = container;
            _this.createDiv();
            _this.graph = _this.createGraph(config);
            window.setTimeout(( /**
             * @return {?}
             */function () {
                _this.resetScrollbars();
            }), 0);
            _this.refresh();
            _this.resizeHandler = ( /**
             * @return {?}
             */function () {
                window.setTimeout(( /**
                 * @return {?}
                 */function () {
                    if (_this.graph != null) {
                        _this.refresh();
                    }
                }), 0);
            });
            mxgraphTs.mxEvent.addListener(window, 'resize', _this.resizeHandler);
            _this.graph.getSelectionModel().addListener(mxgraphTs.mxEvent.CHANGE, ( /**
             * @param {?} sender
             * @param {?} evt
             * @return {?}
             */function (sender, evt) {
                _this.cellSelect(sender, evt);
            }));
            return _this;
        }
        /**
         * 设置当前语言
         * @param lang
         */
        /**
         * 设置当前语言
         * @param {?} lang
         * @return {?}
         */
        FlowChart.prototype.setLanguage = /**
         * 设置当前语言
         * @param {?} lang
         * @return {?}
         */
            function (lang) {
                this.langCode = lang;
                if (this.graph) {
                    this.graph.langCode = lang;
                }
            };
        /**
         * @param {?} __0
         * @return {?}
         */
        FlowChart.prototype.switchMode = /**
         * @param {?} __0
         * @return {?}
         */
            function (_a) {
                var mode = _a.mode, actiInstList = _a.actiInstList, transInsList = _a.transInsList;
                this.mode = mode;
                this.actList = actiInstList;
                this.transInsList = transInsList;
                this.graph.actList = this.actList;
                this.graph.transInsList = this.transInsList;
                this.graph.mode = this.mode;
                this.graph.reloadBpmnModel();
            };
        /**
         * @param {?} data
         * @return {?}
         */
        FlowChart.prototype.load = /**
         * @param {?} data
         * @return {?}
         */
            function (data) {
                if (data) {
                    this.processInstance = data.processInstance;
                    this.actList = data.actiInstList;
                    this.transInsList = data.transInsList;
                    this.mode = data.mode;
                    this.graph.actList = this.actList;
                    this.graph.transInsList = this.transInsList;
                    this.graph.mode = this.mode;
                    this.graph.loadBpmnModel(data.content);
                    this.resetScrollbars();
                }
            };
        /**
         * @return {?}
         */
        FlowChart.prototype.createDiv = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.diagramContainer = document.createElement('div');
                this.diagramContainer.className = 'flowChartContainer';
                this.container.appendChild(this.diagramContainer);
                setTimeout(( /**
                 * @return {?}
                 */function () {
                    // this.diagramContainer.style.overflow = 'hidden';
                    mxgraphTs.mxEvent.addListener(_this.diagramContainer, 'mouseover', ( /**
                     * @return {?}
                     */function () {
                        // this.diagramContainer.style.overflow = 'auto';
                        _this.diagramContainer.classList.add('active');
                    }));
                    mxgraphTs.mxEvent.addListener(_this.diagramContainer, 'mouseleave', ( /**
                     * @return {?}
                     */function () {
                        // this.diagramContainer.style.overflow = 'hidden';
                        _this.diagramContainer.classList.remove('active');
                    }));
                }), 0);
                /** @type {?} */
                var buttonIn = document.createElement('a');
                buttonIn.setAttribute('href', 'javascript:void(0);');
                /** @type {?} */
                var buttonInImg = document.createElement('img');
                buttonIn.style.marginRight = '10px';
                buttonInImg.src = this.rootPath + '/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/zoomIn.svg';
                buttonInImg.style.display = "inline-block";
                buttonInImg.style.verticalAlign = "middle";
                buttonIn.appendChild(buttonInImg);
                mxgraphTs.mxEvent.addListener(buttonIn, 'click', ( /**
                 * @param {?} evt
                 * @return {?}
                 */function (evt) {
                    _this.graph.zoomIn();
                }));
                /** @type {?} */
                var buttonOut = document.createElement('a');
                buttonOut.setAttribute('href', 'javascript:void(0);');
                /** @type {?} */
                var buttonOutImg = document.createElement('img');
                buttonOutImg.src = this.rootPath + '/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/zoomOut.svg';
                buttonOutImg.style.display = "inline-block";
                buttonOutImg.style.verticalAlign = "middle";
                buttonOut.appendChild(buttonOutImg);
                mxgraphTs.mxEvent.addListener(buttonOut, 'click', ( /**
                 * @param {?} evt
                 * @return {?}
                 */function (evt) {
                    _this.graph.zoomOut();
                }));
                /** @type {?} */
                var zoomBar = document.createElement('div');
                zoomBar.className = 'zoomBar';
                zoomBar.style.position = 'absolute';
                zoomBar.style.top = '10px';
                zoomBar.style.right = '20px';
                zoomBar.appendChild(buttonIn);
                zoomBar.appendChild(buttonOut);
                // zoomBar.appendChild(zoom);
                this.container.appendChild(zoomBar);
            };
        /**
         * @param {?} config
         * @return {?}
         */
        FlowChart.prototype.createGraph = /**
         * @param {?} config
         * @return {?}
         */
            function (config) {
                var _this = this;
                mxgraphTs.mxConstants.VERTEX_SELECTION_STROKEWIDTH = 1;
                mxgraphTs.mxConstants.VERTEX_SELECTION_COLOR = '#0000CD';
                mxgraphTs.mxConstants.VERTEX_SELECTION_DASHED = true;
                /** @type {?} */
                var graph = new FlowGraph(this.diagramContainer, config);
                // 创建无限大画布
                graph.createInfiniteCanvas();
                // 创建后需要调用一次才生效
                graph.sizeDidChange();
                graph.popupMenuHandler.autoExpand = true;
                graph.popupMenuHandler.factoryMethod = ( /**
                 * @param {?} menu
                 * @param {?} cell
                 * @param {?} evt
                 * @return {?}
                 */function (menu, cell, evt) {
                    if (cell != null
                        && cell.getId().indexOf('UserActivity') > -1
                        && _this.actList.findIndex(( /**
                         * @param {?} a
                         * @return {?}
                         */function (a) { return a.activityDefinitionId === cell.getId(); })) > -1
                        && _this.processInstance) {
                        /** @type {?} */
                        var actInstId_1 = _this.actList.find(( /**
                         * @param {?} a
                         * @return {?}
                         */function (a) { return a.activityDefinitionId === cell.getId(); })).activityInstanceId;
                        menu.addItem('查看单据', null, ( /**
                         * @return {?}
                         */function () {
                            _this.viewForm(_this.processInstance.id, actInstId_1, _this.processInstance.bizInstId);
                        }));
                    }
                    if (cell != null
                        && cell.getId().indexOf('AifCreationBillActivity') > -1
                        && _this.actList.findIndex(( /**
                         * @param {?} a
                         * @return {?}
                         */function (a) { return a.activityDefinitionId === cell.getId(); })) > -1
                        && _this.processInstance) {
                        // 筛选状态是Running的自动生单活动实例
                        /** @type {?} */
                        var actInsts = _this.actList.filter(( /**
                         * @param {?} a
                         * @return {?}
                         */function (a) { return a.activityDefinitionId === cell.getId() && a.state == "RUNNING"; }));
                        if (actInsts.length == 1) {
                            /** @type {?} */
                            var actInst_1 = actInsts[0];
                            menu.addItem('重试', null, ( /**
                             * @return {?}
                             */function () {
                                _this.retryAifCreation(_this.processInstance.id, actInst_1.activityInstanceId, _this.processInstance.bizInstId);
                            }));
                        }
                    }
                });
                return graph;
            };
        /**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
        FlowChart.prototype.cellSelect = /**
         * @param {?} sender
         * @param {?} evt
         * @return {?}
         */
            function (sender, evt) {
                if (!(sender instanceof mxgraphTs.mxGraphSelectionModel)) {
                    return;
                }
                /** @type {?} */
                var selectedCell = sender.cells[0];
                if (selectedCell) {
                    if (selectedCell.vertex) {
                        /** @type {?} */
                        var selectId_1 = selectedCell.getId();
                        // 选中子流程节点时，弹出子流程图
                        if (selectId_1 && selectId_1.indexOf('CallActivitySubProcess') > -1
                            && this.actList.findIndex(( /**
                             * @param {?} a
                             * @return {?}
                             */function (a) {
                                return a.state !== 'FORECAST'
                                    && a.activityDefinitionId === selectId_1;
                            })) > -1) {
                            /** @type {?} */
                            var actInsts = this.actList.filter(( /**
                             * @param {?} a
                             * @return {?}
                             */function (a) { return a.state !== 'FORECAST' && a.activityDefinitionId === selectId_1; }));
                            /** @type {?} */
                            var activeInst = actInsts.find(( /**
                             * @param {?} a
                             * @return {?}
                             */function (a) { return a.state === 'RUNNING'; }));
                            if (activeInst) {
                                this.viewChildProcessChart(activeInst);
                            }
                            else {
                                this.viewChildProcessChart(actInsts[0]);
                            }
                        }
                        else {
                            this.ngComp.viewLogs({ type: 'activity', actiDefId: selectedCell.id });
                        }
                    }
                    else {
                        this.ngComp.viewLogs({ type: 'sequence' });
                    }
                }
                else {
                    this.ngComp.viewLogs({ type: 'process' });
                }
            };
        /**
         * @param {?} actInst
         * @return {?}
         */
        FlowChart.prototype.viewChildProcessChart = /**
         * @param {?} actInst
         * @return {?}
         */
            function (actInst) {
                this.ngComp.viewChild(actInst, this.processInstance);
            };
        /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
        FlowChart.prototype.viewForm = /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
            function (procInstId, actInstId, bizInstId) {
                this.ngComp.viewForm(procInstId, actInstId, bizInstId);
            };
        /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
        FlowChart.prototype.retryAifCreation = /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
            function (procInstId, actInstId, bizInstId) {
                this.ngComp.retryAifCreation(procInstId, actInstId, bizInstId);
            };
        /**
         * @return {?}
         */
        FlowChart.prototype.resetScrollbars = /**
         * @return {?}
         */
            function () {
                /** @type {?} */
                var bounds = this.graph.getGraphBounds();
                /** @type {?} */
                var width = Math.max(bounds.width * this.graph.view.scale, 0);
                // this.getScrollTileSize().width * this.graph.view.scale);
                /** @type {?} */
                var height = Math.max(bounds.height * this.graph.view.scale, 0);
                this.graph.container.scrollTop = Math.floor(Math.max(0, bounds.y - Math.max(20, (this.graph.container.clientHeight - height) / 2)));
                this.graph.container.scrollLeft = Math.floor(Math.max(0, bounds.x - Math.max(0, (this.graph.container.clientWidth - width) / 2)));
            };
        /**
         * @return {?}
         */
        FlowChart.prototype.refresh = /**
         * @return {?}
         */
            function () {
                this.resetScrollbars();
            };
        /**
         * @return {?}
         */
        FlowChart.prototype.reloadBpmnModel = /**
         * @return {?}
         */
            function () {
                this.graph.removeCells(this.graph.getChildCells(this.graph.getDefaultParent()));
            };
        return FlowChart;
    }(mxgraphTs.mxEventSource));

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var WFFlowchartService = /** @class */ (function () {
        function WFFlowchartService(msgService, injector, resolver, modalService) {
            this.msgService = msgService;
            this.injector = injector;
            this.resolver = resolver;
            this.modalService = modalService;
            this.flowchartService = this.injector.get(UiFlowchartService);
            this.frameworkService = this.injector.get(rtfCommon.FrameworkService);
        }
        /**
         * 查看流程图，支持预览
         * @param payload
         * @returns
         */
        /**
         * 查看流程图，支持预览
         * @param {?} payload
         * @return {?}
         */
        WFFlowchartService.prototype.viewProcess = /**
         * 查看流程图，支持预览
         * @param {?} payload
         * @return {?}
         */
            function (payload) {
                if (!payload || !payload.dataId) {
                    this.msgService.warning(this.getI18nValue('static.flowchart.noDataId'));
                    return;
                }
                if (!payload || !payload.bizDefKey) {
                    this.msgService.warning(this.getI18nValue('static.flowchart.noBizDefKey'));
                    return;
                }
                /** @type {?} */
                var parameters = new Map();
                parameters.set('dataId', payload.dataId);
                parameters.set('bizDefKey', payload.bizDefKey);
                if (payload.startMode) {
                    parameters.set('startMode', payload.startMode);
                }
                if (payload.startUserId) {
                    parameters.set('startUserId', payload.startUserId);
                }
                parameters.set('withTitle', true);
                /** @type {?} */
                var options = {
                    appType: 'menu',
                    funcId: 'WFViewFlowChart',
                    appId: '',
                    appEntrance: '',
                    tabId: payload.dataId,
                    isNewTab: true,
                    queryStringParams: parameters
                };
                this.openMenu(options);
            };
        /**
         * 根据流程实例id查看流程（tab页中打开）
         * @param procInstId 流程实例ID
         */
        /**
         * 根据流程实例id查看流程（tab页中打开）
         * @param {?} procInstId 流程实例ID
         * @return {?}
         */
        WFFlowchartService.prototype.viewFlowChart = /**
         * 根据流程实例id查看流程（tab页中打开）
         * @param {?} procInstId 流程实例ID
         * @return {?}
         */
            function (procInstId) {
                if (!procInstId) {
                    this.msgService.warning(this.getI18nValue('static.flowchart.processNotFound'));
                    return;
                }
                /** @type {?} */
                var parameters = new Map();
                parameters.set('processId', procInstId);
                parameters.set('withTitle', true);
                /** @type {?} */
                var options = {
                    appType: 'menu',
                    funcId: 'WFViewFlowChart',
                    appId: '',
                    appEntrance: '',
                    tabId: new Date().getTime().toString(),
                    isNewTab: true,
                    queryStringParams: parameters
                };
                this.openMenu(options);
            };
        /**
         * 根据单据内码查看流程
         * @param dataId 单据内码
         * @returns
         */
        /**
         * 根据单据内码查看流程
         * @param {?} dataId 单据内码
         * @return {?}
         */
        WFFlowchartService.prototype.viewFlowChartByDataId = /**
         * 根据单据内码查看流程
         * @param {?} dataId 单据内码
         * @return {?}
         */
            function (dataId) {
                if (!dataId) {
                    this.msgService.warning(this.getI18nValue('static.flowchart.dataIdIsNull'));
                    return;
                }
                /** @type {?} */
                var parameters = new Map();
                parameters.set('dataId', dataId);
                parameters.set('withTitle', true);
                /** @type {?} */
                var options = {
                    appType: 'menu',
                    funcId: 'WFViewFlowChart',
                    appId: '',
                    appEntrance: '',
                    tabId: new Date().getTime().toString(),
                    isNewTab: true,
                    queryStringParams: parameters
                };
                this.openMenu(options);
            };
        /**
         * 查看流程（弹框中打开）
         * @param procInstId 流程实例ID
         */
        /**
         * 查看流程（弹框中打开）
         * @param {?} procInstId 流程实例ID
         * @param {?=} mode
         * @return {?}
         */
        WFFlowchartService.prototype.viewFlowChartByDialog = /**
         * 查看流程（弹框中打开）
         * @param {?} procInstId 流程实例ID
         * @param {?=} mode
         * @return {?}
         */
            function (procInstId, mode) {
                var _this = this;
                if (!procInstId) {
                    this.msgService.warning(this.getI18nValue('static.flowchart.processNotFound'));
                    return;
                }
                this.flowchartService.getProcessInstanceById(procInstId).subscribe(( /**
                 * @param {?} re
                 * @return {?}
                 */function (re) {
                    if (re) {
                        _this.viewMutiInstanceFlowChartByDialog([re]);
                    }
                }));
            };
        /**
         * 查看流程（弹框中打开，兼容多实例子流程）
         * @param procInstId 流程实例ID
         */
        /**
         * 查看流程（弹框中打开，兼容多实例子流程）
         * @param {?} procInstList
         * @param {?=} mode
         * @return {?}
         */
        WFFlowchartService.prototype.viewMutiInstanceFlowChartByDialog = /**
         * 查看流程（弹框中打开，兼容多实例子流程）
         * @param {?} procInstList
         * @param {?=} mode
         * @return {?}
         */
            function (procInstList, mode) {
                /** @type {?} */
                var func;
                if (UIFlowchartComponent.func) {
                    func = UIFlowchartComponent.func;
                }
                /** @type {?} */
                var options = {
                    title: this.getI18nValue('static.flowchart.title'),
                    width: 1200,
                    height: 530,
                    showButtons: false,
                    beforeClose: ( /**
                     * @param {?} modalRef
                     * @return {?}
                     */function (modalRef) {
                        if (UIFlowchartComponent.func) {
                            window.removeEventListener('message', UIFlowchartComponent.func, false);
                        }
                        if (func) {
                            window.addEventListener('message', func, false);
                            UIFlowchartComponent.func = func;
                        }
                        return rxjs.of(true);
                    })
                };
                /** @type {?} */
                var compFactory = this.resolver.resolveComponentFactory(UIFlowchartComponent);
                /** @type {?} */
                var inj = core.Injector.create({
                    providers: [{
                            provide: UiFlowchartService, useFactory: ( /**
                             * @param {?} httpSvc
                             * @return {?}
                             */function (httpSvc) {
                                return new UiFlowchartService(httpSvc);
                            }),
                            deps: [
                                cafCommon.HttpService
                            ]
                        }], parent: this.injector
                });
                /** @type {?} */
                var compRef = compFactory.create(inj);
                if (procInstList && procInstList.length) {
                    if (procInstList.length == 1) {
                        options.showHeader = true;
                        options.title = procInstList[0].name + '-v' + procInstList[0].version + '.0';
                        compRef.instance.ProcInstId = procInstList[0].id;
                    }
                    else {
                        options.showHeader = false;
                        compRef.instance.ProcInstList = procInstList;
                    }
                }
                if (mode) {
                    compRef.instance.mode = mode;
                }
                compRef.instance.fill();
                /** @type {?} */
                var dialog = this.modalService.show(compRef, options);
                compRef.instance.dialog = dialog;
            };
        /**
         * 查看流程图。（如果作为共享的外部流程，则打开共享的查看流程）
         * @param procInstId 流程实例id
         * @param dataId 单据内码
         */
        /**
         * 查看流程图。（如果作为共享的外部流程，则打开共享的查看流程）
         * @param {?} procInstId 流程实例id
         * @param {?} dataId 单据内码
         * @return {?}
         */
        WFFlowchartService.prototype.viewFlowchartByProcInstIdAndDataId = /**
         * 查看流程图。（如果作为共享的外部流程，则打开共享的查看流程）
         * @param {?} procInstId 流程实例id
         * @param {?} dataId 单据内码
         * @return {?}
         */
            function (procInstId, dataId) {
                var _this = this;
                this.flowchartService.ifThirdTask(procInstId).subscribe(( /**
                 * @param {?} ifThirdTask
                 * @return {?}
                 */function (ifThirdTask) {
                    if (ifThirdTask === true) { //是第三方的任务
                        _this.flowchartService.getFsParamsByBizId(dataId).subscribe(( /**
                         * @param {?} params
                         * @return {?}
                         */function (params) {
                            if (params) { //有不往共享单据表推数据的情况，此时返回为空
                                //有不往共享单据表推数据的情况，此时返回为空
                                /** @type {?} */
                                var param = {
                                    "lcsl": params[0],
                                    "djnm": params[1],
                                    "djlx": params[2],
                                    "djbh": params[3]
                                };
                                _this.flowchartService.viewFsProcessNew(param).subscribe(( /**
                                 * @param {?} re
                                 * @return {?}
                                 */function (re) {
                                    if (re && re.value) {
                                        _this.openViewProcessMenu(re.value);
                                    }
                                }), ( /**
                                 * @param {?} error
                                 * @return {?}
                                 */function (error) {
                                    _this.viewFlowChart(procInstId);
                                }));
                            }
                            else {
                                _this.viewFlowChart(procInstId);
                            }
                        }), ( /**
                         * @param {?} error
                         * @return {?}
                         */function (error) {
                            _this.viewFlowChart(procInstId);
                        }));
                    }
                    else { //WF的任务
                        _this.viewFlowChart(procInstId);
                    }
                }), ( /**
                 * @param {?} error
                 * @return {?}
                 */function (error) {
                    _this.viewFlowChart(procInstId);
                }));
            };
        /**
         * 共享的任务，借用自己的查看流程菜单，iframe嵌入共享的查看流程URL
         * @param entity 任务实体，区分tab页
         * @param url 共享查看流程的URL
         */
        /**
         * 共享的任务，借用自己的查看流程菜单，iframe嵌入共享的查看流程URL
         * @private
         * @param {?} url 共享查看流程的URL
         * @return {?}
         */
        WFFlowchartService.prototype.openViewProcessMenu = /**
         * 共享的任务，借用自己的查看流程菜单，iframe嵌入共享的查看流程URL
         * @private
         * @param {?} url 共享查看流程的URL
         * @return {?}
         */
            function (url) {
                /** @type {?} */
                var queryParams = new Map();
                queryParams.set("thirdTask", true);
                /** @type {?} */
                var entityParams = new Map();
                entityParams.set("thirdProcessUrl", url);
                /** @type {?} */
                var options = {
                    appType: 'menu',
                    funcId: 'WFViewFlowChart',
                    appId: '',
                    appEntrance: '',
                    tabId: new Date().getTime().toString(),
                    isNewTab: true,
                    entityParams: entityParams,
                    queryStringParams: queryParams
                };
                this.openMenu(options);
            };
        /**
         * 获取i18n
         */
        /**
         * 获取i18n
         * @private
         * @param {?} name
         * @return {?}
         */
        WFFlowchartService.prototype.getI18nValue = /**
         * 获取i18n
         * @private
         * @param {?} name
         * @return {?}
         */
            function (name) {
                if (!name) {
                    return '';
                }
                /** @type {?} */
                var defaultLang = localStorage.getItem('languageCode');
                /** @type {?} */
                var langData = defaultLang ? translate[defaultLang] : translate['zh-CHS'];
                /** @type {?} */
                var resultVal = '';
                if (name.indexOf('.') === -1) {
                    resultVal = langData[name];
                }
                else {
                    resultVal = name.split('.').reduce(( /**
                     * @param {?} obj
                     * @param {?} key
                     * @return {?}
                     */function (obj, key) {
                        if (obj) {
                            return obj[key];
                        }
                        else {
                            return null;
                        }
                    }), langData);
                }
                return resultVal;
            };
        /**
         * 判断是否inSuite环境
         */
        /**
         * 判断是否inSuite环境
         * @private
         * @return {?}
         */
        WFFlowchartService.prototype.isInSuite = /**
         * 判断是否inSuite环境
         * @private
         * @return {?}
         */
            function () {
                /** @type {?} */
                var frameWorkService = (( /** @type {?} */(window))).gspframeworkService;
                if (frameWorkService && frameWorkService.rtf) {
                    /** @type {?} */
                    var extendMethod = frameWorkService.rtf.extendMethod;
                    if (extendMethod && extendMethod.getExtObj()) {
                        /** @type {?} */
                        var extObj = extendMethod.getExtObj();
                        /** @type {?} */
                        var mode = extObj.iGIX4inSuiteMode();
                        if (mode) {
                            return true;
                        }
                    }
                }
                return false;
            };
        /**
         * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
         * @param options 打开参数
         * @param menuTitle 菜单名称
         */
        /**
         * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
         * @private
         * @param {?} options 打开参数
         * @return {?}
         */
        WFFlowchartService.prototype.openMenu = /**
         * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
         * @private
         * @param {?} options 打开参数
         * @return {?}
         */
            function (options) {
                /** @type {?} */
                var menuTitle = this.getI18nValue('static.flowchart.title');
                if (this.isInSuite()) {
                    options.menuTitle = menuTitle;
                    /** @type {?} */
                    var extObj = (( /** @type {?} */(window))).gspframeworkService.rtf.extendMethod.getExtObj();
                    extObj.iGIXMenuOpen(options);
                }
                else {
                    this.frameworkService.openMenu$(options).subscribe(( /**
                     * @param {?} re
                     * @return {?}
                     */function (re) {
                    }), ( /**
                     * @param {?} error
                     * @return {?}
                     */function (error) {
                        console.error(error);
                    }));
                }
            };
        WFFlowchartService.decorators = [
            { type: core.Injectable }
        ];
        /** @nocollapse */
        WFFlowchartService.ctorParameters = function () {
            return [
                { type: uiMessager.MessagerService },
                { type: core.Injector },
                { type: core.ComponentFactoryResolver },
                { type: uiModal.BsModalService }
            ];
        };
        return WFFlowchartService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var UIFlowchartComponent = /** @class */ (function () {
        function UIFlowchartComponent(sanitizer, service, changeDetector, injector, chartService) {
            this.sanitizer = sanitizer;
            this.service = service;
            this.changeDetector = changeDetector;
            this.injector = injector;
            this.chartService = chartService;
            // 消息监听处理方法
            this.cls = 'd-flex flex-fill h-100';
            this.modalHide = new core.EventEmitter();
            this.fcHtml = window.document.location.origin + '/platform/runtime/wf/web/designer/flowchart.html?v=20221111';
            this.theme = 'viewFlowChart';
            this._mode = 'complete';
            this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
            this.typeList = [
                {
                    value: 'complete', text: this.service.getI18nValue('static.flowchart.complete')
                },
                {
                    value: 'simulation', text: this.service.getI18nValue('static.flowchart.simulation')
                }
            ];
            this.localeId = "zh-CHS";
            this.procInstList = []; //流程实例list，多实例子流程使用
            //当前选中的流程
            this.flowChartContainerClientSize = {};
            this.sequenceColorList = [
                {
                    colorClass: 'color-gey',
                    label: 'completed'
                }, {
                    colorClass: 'color-yellow',
                    label: 'calculate'
                }, {
                    colorClass: 'color-blue',
                    label: 'default'
                }, {
                    colorClass: 'color-red',
                    label: 'suspend'
                }
            ];
            this.message = this.injector.get(uiMessager.MessagerService);
            this.frameworkSvc = this.injector.get(rtfCommon.FrameworkService);
            this.localeId = this.injector.get(core.LOCALE_ID, null) || this.localeId;
            this.loading = this.injector.get(uiLoading.LoadingService, null);
            if (this.loading == null) {
                /** @type {?} */
                var inject = core.ReflectiveInjector.resolveAndCreate([
                    uiLoading.LoadingService
                ], this.injector);
                this.loading = inject.get(uiLoading.LoadingService, null);
            }
            this.notify = this.injector.get(uiNotify.NotifyService, null);
            if (this.notify == null) {
                /** @type {?} */
                var inject = core.ReflectiveInjector.resolveAndCreate([
                    uiNotify.NotifyService
                ], this.injector);
                this.notify = inject.get(uiNotify.NotifyService, null);
            }
        }
        Object.defineProperty(UIFlowchartComponent.prototype, "mode", {
            get: /**
             * @return {?}
             */ function () {
                return this._mode;
            },
            set: /**
             * @param {?} v
             * @return {?}
             */ function (v) {
                this._mode = v;
                if (this._mode === 'simulation') {
                    this.ifForecast = 'true';
                    this.modeButton = this.service.getI18nValue('static.flowchart.complete');
                }
                else if (this._mode === 'complete') {
                    this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(UIFlowchartComponent.prototype, "ProcInstId", {
            set: /**
             * @param {?} procInstId
             * @return {?}
             */ function (procInstId) {
                if (procInstId) {
                    this.procInstId = procInstId;
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(UIFlowchartComponent.prototype, "DataId", {
            set: /**
             * @param {?} dataId
             * @return {?}
             */ function (dataId) {
                if (dataId) {
                    this.dataId = dataId;
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(UIFlowchartComponent.prototype, "ProcInstList", {
            set: /**
             * @param {?} procInstList
             * @return {?}
             */ function (procInstList) {
                if (procInstList && procInstList.length) {
                    this.procInstId = procInstList[0].id;
                    this.procInstList = procInstList;
                }
            },
            enumerable: true,
            configurable: true
        });
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.ngOnInit = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.service.getFlowChartStyleConfig().subscribe(( /**
                 * @param {?} config
                 * @return {?}
                 */function (config) {
                    setTimeout(( /**
                     * @return {?}
                     */function () {
                        _this.createFlowChart(config);
                        _this.viewFlowChart();
                    }), 300);
                }));
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.ngAfterViewChecked = /**
         * @return {?}
         */
            function () {
                // 监听画布容器高度和宽度属性变化，发生变化时刷新画布
                if (this.flowChartContainerER == null || this.flowChartContainerER.nativeElement == null || this.flowChart == null) {
                    return;
                }
                if (this.flowChartContainerClientSize.clientHeight != this.flowChartContainerER.nativeElement.clientHeight
                    || this.flowChartContainerClientSize.clientWidth != this.flowChartContainerER.nativeElement.clientWidth) {
                    this.flowChartContainerClientSize = {
                        clientHeight: this.flowChartContainerER.nativeElement.clientHeight,
                        clientWidth: this.flowChartContainerER.nativeElement.clientWidth,
                    };
                    this.flowChart.refresh();
                    this.flowChart.graph.sizeDidChange();
                }
            };
        /**
         * @param {?} config
         * @return {?}
         */
        UIFlowchartComponent.prototype.createFlowChart = /**
         * @param {?} config
         * @return {?}
         */
            function (config) {
                this.flowChart = new FlowChart(this.flowChartContainerER.nativeElement, config);
                this.flowChart.ngComp = this;
                this.flowChart.setLanguage(this.localeId);
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.viewFlowChart = /**
         * @return {?}
         */
            function () {
                if (this.theme === 'viewFlowChart') {
                    this.viewFlowChartByProcInstId();
                }
                else {
                    this.processForecast();
                }
            };
        /**
         * @param {?} event
         * @return {?}
         */
        UIFlowchartComponent.prototype.tabChange = /**
         * @param {?} event
         * @return {?}
         */
            function (event) {
                this.procInstId = event.nextId;
                this.viewFlowChart();
                this.flowChart.reloadBpmnModel();
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.closeDialog = /**
         * @return {?}
         */
            function () {
                this.dialog.close();
            };
        /**
         * 查看子流程图
         * @param actInst 活动实例
         * @param superProcess 父流程
         */
        /**
         * 查看子流程图
         * @param {?} actInst 活动实例
         * @param {?} superProcess 父流程
         * @return {?}
         */
        UIFlowchartComponent.prototype.viewChild = /**
         * 查看子流程图
         * @param {?} actInst 活动实例
         * @param {?} superProcess 父流程
         * @return {?}
         */
            function (actInst, superProcess) {
                var _this = this;
                this.service.getMutiChildInstance(actInst, superProcess.id).subscribe(( /**
                 * @param {?} re
                 * @return {?}
                 */function (re) {
                    if (_this.chartService && re && re.length) {
                        if (re.length == 1) { //单个子流程
                            _this.chartService.viewFlowChartByDialog(re[0].id, _this.mode);
                        }
                        else { //多实例子流程
                            _this.chartService.viewMutiInstanceFlowChartByDialog(re, _this.mode);
                        }
                    }
                    else {
                        throw Error('请升级查看流程公共包实现联查子流程图功能');
                    }
                }));
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.modeSwitch = /**
         * @return {?}
         */
            function () {
                var _this = this;
                if (this.mode === 'complete') {
                    this.mode = 'simulation';
                    this.ifForecast = 'true';
                    this.modeButton = this.service.getI18nValue('static.flowchart.complete');
                    this.service.getForecastProcessByProcInstId(this.procInstId).subscribe(( /**
                     * @param {?} r
                     * @return {?}
                     */function (r) {
                        _this.actInstList = r.activityInstanceSlims;
                        _this.transInsList = r.transitionInstanceSlims;
                        _this.flowChart.switchMode({
                            mode: 'simulation',
                            actiInstList: r.activityInstanceSlims,
                            transInsList: r.transitionInstanceSlims
                        });
                    }));
                }
                else {
                    this.mode = 'complete';
                    this.ifForecast = 'false';
                    this.modeButton = this.service.getI18nValue('static.flowchart.simulation');
                    this.service.getCompleteProcessInfoByProcInstId(this.procInstId).subscribe(( /**
                     * @param {?} r
                     * @return {?}
                     */function (r) {
                        _this.actInstList = r.activityInstanceSlims;
                        _this.transInsList = r.transitionInstanceSlims;
                        _this.flowChart.switchMode({
                            mode: 'complete',
                            actiInstList: r.activityInstanceSlims,
                            transInsList: r.transitionInstanceSlims
                        });
                    }));
                }
            };
        /**
         * @param {?} data
         * @return {?}
         */
        UIFlowchartComponent.prototype.viewLogs = /**
         * @param {?} data
         * @return {?}
         */
            function (data) {
                this.type = data.type;
                this.actDefId = data.actiDefId;
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.viewFlowChartByProcInstId = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.content = '';
                if (this.procInstId) {
                    if (this.mode === 'complete') {
                        rxjs.forkJoin(this.service.getProcInstanceById(this.procInstId), this.service.getBpmnModelbyProcInstId(this.procInstId), this.service.getCompleteProcessInfoByProcInstId(this.procInstId))
                            .subscribe(( /**
                     * @param {?} data
                     * @return {?}
                     */function (data) {
                            _this.processInstance = data[0];
                            _this.content = JSON.stringify(data[1]);
                            _this.actInstList = data[2].activityInstanceSlims;
                            _this.transInsList = data[2].transitionInstanceSlims;
                            _this.loadFlowChart();
                        }));
                    }
                    else {
                        rxjs.forkJoin(this.service.getProcInstanceById(this.procInstId), this.service.getBpmnModelbyProcInstId(this.procInstId), this.service.getForecastProcessByProcInstId(this.procInstId))
                            .subscribe(( /**
                     * @param {?} data
                     * @return {?}
                     */function (data) {
                            _this.processInstance = data[0];
                            _this.content = JSON.stringify(data[1]);
                            _this.actInstList = data[2].activityInstanceSlims;
                            _this.transInsList = data[2].transitionInstanceSlims;
                            _this.loadFlowChart();
                        }));
                    }
                }
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.processForecast = /**
         * @return {?}
         */
            function () {
                var _this = this;
                this.content = '';
                this.mode = 'simulation';
                if (this.processForecastPayload.processDefinitionId && this.processForecastPayload.dataId) {
                    rxjs.forkJoin(this.service.getBpmnModelbyProcDefId(this.processForecastPayload.processDefinitionId), this.service.getForecastProcessByPayload(this.processForecastPayload))
                        .subscribe(( /**
                 * @param {?} data
                 * @return {?}
                 */function (data) {
                        _this.content = JSON.stringify(data[0]);
                        _this.actInstList = data[1].activityInstanceSlims;
                        _this.transInsList = data[1].transitionInstanceSlims;
                        _this.loadFlowChart();
                    }));
                }
            };
        /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
        UIFlowchartComponent.prototype.viewForm = /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
            function (procInstId, actInstId, bizInstId) {
                var _this = this;
                if (procInstId) {
                    this.service.getFormInfoByActInstId(procInstId, actInstId).subscribe(( /**
                     * @param {?} re
                     * @return {?}
                     */function (re) {
                        /** @type {?} */
                        var formInfo = re;
                        if (!formInfo || !formInfo.appId) {
                            if (_this.message) {
                                _this.message.info('找不到单据，请联系管理员查看原因！');
                            }
                            return;
                        }
                        /** @type {?} */
                        var options = {
                            appType: 'menu',
                            funcId: formInfo.appId,
                            appId: '',
                            appEntrance: '',
                            tabId: bizInstId,
                            isNewTab: true
                        };
                        // 传工作流上下文参数
                        /** @type {?} */
                        var parameters = new Map();
                        parameters.set('procInstId', procInstId);
                        parameters.set('actInstId', actInstId);
                        formInfo.parameters.forEach(( /**
                         * @param {?} item
                         * @return {?}
                         */function (item) {
                            return parameters.set(item.code, item.value);
                        }));
                        options.queryStringParams = parameters;
                        if (_this.frameworkSvc) {
                            _this.frameworkSvc.openMenu(options);
                        }
                        else {
                            throw Error('框架服务不存在！无法联查！');
                        }
                    }));
                }
            };
        /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
        UIFlowchartComponent.prototype.retryAifCreation = /**
         * @param {?} procInstId
         * @param {?} actInstId
         * @param {?} bizInstId
         * @return {?}
         */
            function (procInstId, actInstId, bizInstId) {
                var _this = this;
                if (procInstId) {
                    /** @type {?} */
                    var l_1 = this.loading.show();
                    this.service.retryAifCreation(procInstId, actInstId, bizInstId).subscribe(( /**
                     * @param {?} re
                     * @return {?}
                     */function (re) {
                        l_1.close();
                        _this.notify.success("重试成功");
                        _this.viewFlowChart();
                    }), ( /**
                     * @param {?} err
                     * @return {?}
                     */function (err) {
                        l_1.close();
                        setTimeout(( /**
                         * @return {?}
                         */function () {
                            //todo 确定异常结构, 目前采用兼容取值方式
                            _this.message.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
                        }), 300);
                        throw err;
                    }));
                }
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.loadFlowChart = /**
         * @return {?}
         */
            function () {
                if (this.content) {
                    this.flowChart.load({
                        processInstance: this.processInstance,
                        content: this.content,
                        actiInstList: this.actInstList,
                        transInsList: this.transInsList,
                        mode: this.mode
                    });
                }
            };
        /**
         * @return {?}
         */
        UIFlowchartComponent.prototype.fill = /**
         * @return {?}
         */
            function () {
                this.cls = 'd-flex flex-fill h-100 f-utils-absolute-all';
            };
        UIFlowchartComponent.func = null; // 消息监听处理方法
        UIFlowchartComponent.decorators = [
            { type: core.Component, args: [{
                        selector: 'wf-flowchart',
                        template: "<div class=\"f-page f-page-navigate f-page-is-listnav\">\r\n    <!-- \u591A\u5B9E\u4F8B\u5B50\u6D41\u7A0B\u5934 -->\r\n    <div *ngIf=\"procInstList?.length\" class=\"flowChart-muti-header\">\r\n        <farris-tabs [value]=\"curChildProcInst?.id\" [contentFill]=\"true\" [autoTitleWidth]=\"true\" [titleWidth]=\"90\"\r\n            (tabChange)=\"tabChange($event)\" class=\"w-100\">\r\n            <farris-tab *ngFor=\"let process of procInstList\" [id]=\"process.id\"\r\n                [title]=\"process.name + '-v' + process.version + '.0'\" style=\"overflow: hidden\">\r\n                <ng-template farrisTabsExtend>\r\n                    <li class=\"f-btn-icon f-bare\" (click)=\"closeDialog()\"><span\r\n                            class=\"f-icon modal_close flowchart-header-button\"></span></li>\r\n                </ng-template>\r\n            </farris-tab>\r\n        </farris-tabs>\r\n    </div>\r\n    <!-- \u6B63\u5E38\u60C5\u51B5\u67E5\u770B\u6D41\u7A0B -->\r\n    <div class=\"f-page-main\" style=\"margin: 0;\">\r\n        <farris-splitter class=\"f-page-content f-component-splitter\">\r\n            <!-- \u5DE6\u4FA7\u6D41\u7A0B\u56FE -->\r\n            <farris-splitter-pane class=\"f-page-content-main f-component-splitter-pane\">\r\n                <div class=\"f-utils-flex-column h-100\">\r\n                    <div *ngIf=\"dataId || procInstId || processForecastPayload\" class=\"f-utils-fill\">\r\n                        <div style=\"position: relative; height: 100%; width: 100%;\">\r\n                            <div id=\"flowChartContainer\" class=\"geEditor flowchart-container\" #flowChartContainer></div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"flowchart-buttons-padding \">\r\n                        <!-- \u663E\u793A\u9884\u6D4B\u8DEF\u7EBF -->\r\n                        <button *ngIf=\"theme==='viewFlowChart'\" class=\"btn btn-secondary mr-2\"\r\n                            (click)=\"modeSwitch()\">{{modeButton}}\r\n                        </button>\r\n                        <!-- \u5206\u652F\u7EBF\u989C\u8272\u8BF4\u660E -->\r\n                        <div class=\"btn-group\" fDropdown [placement]=\"'top'\">\r\n                            <button class=\"btn btn-secondary dropdown-toggle\" fDropdownToggle type=\"button\">\r\n                                {{'static.flowchart.sequenceColor' | translate}}\r\n                            </button>\r\n                            <div class=\"dropdown-menu\" fDropdownMenu>\r\n                                <div *ngFor=\"let s of sequenceColorList\" class=\"flowchart-sequence-color\">\r\n                                    <span class=\"flowchart-color-div\" [ngClass]=\"s.colorClass\"></span>\r\n                                    {{'static.flowchart.' + s.label | translate}}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </farris-splitter-pane>\r\n            <!-- \u53F3\u4FA7\u5BA1\u6279\u65E5\u5FD7 -->\r\n            <farris-splitter-pane class=\"f-page-content-nav f-component-splitter-pane flowchart-right-pane\" ngResizable\r\n                [rzHandles]=\"'w'\" [collapsePosition]=\"'left'\" [enableCollapse]=\"true\" [rzMinWidth]=\"200\"\r\n                [rzMaxWidth]=\"600\">\r\n                <farris-section [enableMaximize]=\"false\" [enableAccordion]=\"false\" [showHeader]=\"false\"\r\n                    class=\"f-overflow-y-auto px-0\">\r\n                    <wf-approval-logs [ProcInstId]=\"procInstId\" [DataId]=\"dataId\" [IfForecast]=\"ifForecast\"\r\n                        [ActivityDefinitionId]=\"actDefId\" [Type]=\"type\"\r\n                        [processForecastPayload]=\"processForecastPayload\" [ShowHeader]=\"true\" [ShowViewProcess]=\"false\"\r\n                        [OnlyIncludeCurrentProcInst]=\"true\">\r\n                    </wf-approval-logs>\r\n                </farris-section>\r\n            </farris-splitter-pane>\r\n        </farris-splitter>\r\n    </div>\r\n</div>",
                        encapsulation: core.ViewEncapsulation.None,
                        styles: ["@charset \"UTF-8\";::ng-deep .chartModal .ant-modal{height:100%}::ng-deep .chartModal .ant-modal-content{height:100%}::ng-deep .chartModal .ant-modal-body{height:90%}.flowChart{height:100%;min-height:300px;width:100%}.flowChartContainer{overflow:auto;position:absolute;top:0;left:0;width:100%;height:100%;cursor:default;outline:0;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAwIDEwIEwgNDAgMTAgTSAxMCAwIEwgMTAgNDAgTSAwIDIwIEwgNDAgMjAgTSAyMCAwIEwgMjAgNDAgTSAwIDMwIEwgNDAgMzAgTSAzMCAwIEwgMzAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2UwZTBlMCIgb3BhY2l0eT0iMC4yIiBzdHJva2Utd2lkdGg9IjEiLz48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=)}.flowChartContainer.active::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.2)}.flowChartContainer::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,0)}.geEditor{font-family:Microsoft YaHei,Source Han Sans,sans-serif;font-size:10pt;border:none;margin:0}.geEditor input[type=text]::-ms-clear{display:none}body div.mxPopupMenu{box-shadow:3px 3px 6px silver;background:#fff;position:absolute;border:3px solid #e7e7e7;padding:3px}body table.mxPopupMenu{border-collapse:collapse;margin:0}body tr.mxPopupMenuItem{color:#000;cursor:default}body td.mxPopupMenuItem{padding:6px 0 6px 30px;font-family:Arial;font-size:10pt}body td.mxPopupMenuIcon{background-color:#fff;padding:0}body tr.mxPopupMenuItemHover{background-color:#eee;color:#000}table.mxPopupMenu hr{border-top:1px solid #ccc}table.mxPopupMenu tr{font-size:4pt}.flowchart-container{position:relative;width:100%;height:100%;overflow:auto}.flowChart-muti-header{display:flex;align-items:center;padding:0 16px}.flowchart-header-button{cursor:pointer;color:#848c9a}.flowchart-header-button:hover{color:#529dff}.flowchart-right-pane{margin:0 10px;width:30%}.flowchart-buttons-padding{padding:0 0 10px 10px}.flowchart-sequence-color{display:flex;align-items:center;padding-left:8px}.flowchart-color-div{color:#fff;border-radius:0;display:block;width:15px;height:15px;margin-right:8px}.color-gey{background:#595959}.color-yellow{background:#f59c24}.color-blue{background:#59a1ff}.color-red{background:#ff4040}"]
                    }] }
        ];
        /** @nocollapse */
        UIFlowchartComponent.ctorParameters = function () {
            return [
                { type: platformBrowser.DomSanitizer },
                { type: UiFlowchartService },
                { type: core.ChangeDetectorRef },
                { type: core.Injector },
                { type: WFFlowchartService, decorators: [{ type: core.Optional }] }
            ];
        };
        UIFlowchartComponent.propDecorators = {
            cls: [{ type: core.HostBinding, args: ['class',] }],
            iframe: [{ type: core.ViewChild, args: ['iframe',] }],
            modalHide: [{ type: core.Output }],
            theme: [{ type: core.Input }],
            processForecastPayload: [{ type: core.Input }],
            mode: [{ type: core.Input }],
            ProcInstId: [{ type: core.Input }],
            DataId: [{ type: core.Input }],
            ProcInstList: [{ type: core.Input }],
            flowChartContainerER: [{ type: core.ViewChild, args: ["flowChartContainer",] }],
            flowChartContainerVCR: [{ type: core.ViewChild, args: ["flowChartContainer", { read: core.ViewContainerRef },] }]
        };
        return UIFlowchartComponent;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var TranslatePipe = /** @class */ (function () {
        function TranslatePipe(service) {
            this.service = service;
        }
        /**
         * @param {?} name
         * @param {?=} defaultVal
         * @return {?}
         */
        TranslatePipe.prototype.transform = /**
         * @param {?} name
         * @param {?=} defaultVal
         * @return {?}
         */
            function (name, defaultVal) {
                if (defaultVal === void 0) {
                    defaultVal = '';
                }
                /** @type {?} */
                var r = this.service.getI18nValue(name);
                return r ? r : defaultVal;
            };
        TranslatePipe.decorators = [
            { type: core.Pipe, args: [{ name: 'translate' },] }
        ];
        /** @nocollapse */
        TranslatePipe.ctorParameters = function () {
            return [
                { type: UiFlowchartService }
            ];
        };
        return TranslatePipe;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var UiFlowchartModule = /** @class */ (function () {
        function UiFlowchartModule() {
        }
        UiFlowchartModule.decorators = [
            { type: core.NgModule, args: [{
                        declarations: [
                            UIFlowchartComponent,
                            TranslatePipe
                        ],
                        imports: [
                            uiLayout.LayoutModule,
                            common.CommonModule,
                            uiDialog.FarrisDialogModule,
                            uiMessager.MessagerModule.forRoot({
                                width: 500
                            }),
                            uiSection.FarrisSectionModule,
                            wfApprovalLogs.WfApprovalLogsModule,
                            uiComboList.ComboListModule,
                            forms.ReactiveFormsModule,
                            forms.FormsModule,
                            uiDropdown.FDropdownDirectiveTypeModule,
                            uiDatagrid.DatagridModule,
                            uiNotify.NotifyModule,
                            uiLoading.LoadingModule,
                            uiTabs.FarrisTabsModule.forRoot(),
                            uiSplitter.SplitterModule
                        ],
                        exports: [UIFlowchartComponent],
                        providers: [
                            cafCommon.HttpService,
                            UiFlowchartService,
                            WFFlowchartService,
                        ],
                        entryComponents: [
                            UIFlowchartComponent
                        ]
                    },] }
        ];
        return UiFlowchartModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */
    var ForecastProcessPayload = /** @class */ (function () {
        function ForecastProcessPayload() {
        }
        return ForecastProcessPayload;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
     */

    exports.UiFlowchartService = UiFlowchartService;
    exports.UIFlowchartComponent = UIFlowchartComponent;
    exports.UiFlowchartModule = UiFlowchartModule;
    exports.WFFlowchartService = WFFlowchartService;
    exports.TranslatePipe = TranslatePipe;
    exports.ForecastProcessPayload = ForecastProcessPayload;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=gsp-wf-ui-flowchart.umd.js.map
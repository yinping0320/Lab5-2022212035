!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/operators"),require("@angular/platform-browser"),require("@edp-pmf/bpmn-model"),require("@gsp-wf/wf-process-model"),require("@edp-pmf/mxgraph-ts"),require("@farris/ui-modal"),require("@gsp-sys/rtf-common"),require("rxjs"),require("@angular/common"),require("@ecp-caf/caf-common"),require("@farris/ui-messager"),require("@farris/ui-dialog"),require("@angular/core"),require("@farris/ui-layout"),require("@farris/ui-section"),require("@gsp-wf/wf-approval-logs"),require("@farris/ui-combo-list"),require("@angular/forms"),require("@farris/ui-dropdown"),require("@farris/ui-datagrid"),require("@farris/ui-notify"),require("@farris/ui-loading"),require("@farris/ui-tabs"),require("@farris/ui-splitter")):"function"==typeof define&&define.amd?define("@gsp-wf/ui-flowchart",["exports","rxjs/operators","@angular/platform-browser","@edp-pmf/bpmn-model","@gsp-wf/wf-process-model","@edp-pmf/mxgraph-ts","@farris/ui-modal","@gsp-sys/rtf-common","rxjs","@angular/common","@ecp-caf/caf-common","@farris/ui-messager","@farris/ui-dialog","@angular/core","@farris/ui-layout","@farris/ui-section","@gsp-wf/wf-approval-logs","@farris/ui-combo-list","@angular/forms","@farris/ui-dropdown","@farris/ui-datagrid","@farris/ui-notify","@farris/ui-loading","@farris/ui-tabs","@farris/ui-splitter"],e):e((t["gsp-wf"]=t["gsp-wf"]||{},t["gsp-wf"]["ui-flowchart"]={}),t.rxjs.operators,t.ng.platformBrowser,t.bpmnModel,t.wfProcessModel,t.mxgraphTs,t.uiModal,t.rtfCommon,t.rxjs,t.ng.common,t.cafCommon,t.uiMessager,t.uiDialog,t.ng.core,t.uiLayout,t.uiSection,t.wfApprovalLogs,t.uiComboList,t.ng.forms,t.uiDropdown,t.uiDatagrid,t.uiNotify,t.uiLoading,t.uiTabs,t.uiSplitter)}(this,function(t,e,n,l,a,g,z,s,c,i,d,u,k,p,o,R,j,q,r,_,H,f,h,V,G){"use strict";var m={"zh-CHS":{"static":{approvalLogs:{title:"审批记录",approvalOpinion:"审批意见",startTime:"接收时间",endTime:"处理时间",todo:"待办理",done:"已办理",toAssign:"未指派"},flowchart:{title:"查看流程",processNotFound:"流程实例ID为空",dataIdIsNull:"单据内码为空",flowChart:"流程图",complete:"显示设计路线",simulation:"显示预测路线",sequenceColor:"分支线颜色说明",completed:"已运行",calculate:"计算路线","default":"默认",suspend:"计算中断",noProcess:"未找到符合条件的流程定义！",list:"流程列表",noDataId:"单据内码为空",noBizDefKey:"流程分类ID为空"}}},en:{"static":{approvalLogs:{title:"Approval Logs",approvalOpinion:"Approval opinion",startTime:"StartTime",endTime:"EndTime",todo:"Todo",done:"Done",toAssign:"To Assign"},flowchart:{title:"Flow Chart",processNotFound:"process instance id is null",flowChart:"Flow Chart",complete:"Hide Calculated Route",simulation:"Show Calculated Route",sequenceColor:"Description Of Sequence Color",completed:"Completed",calculate:"Calculate Route","default":"Default",suspend:"Calculate Suspend",noProcess:"Process definition not found!",list:"Process List",noDataId:"form id is null",noBizDefKey:"process category id is null"}}},"zh-CHT":{"static":{approvalLogs:{title:"審批記錄",approvalOpinion:"審批意見",startTime:"接收時間",endTime:"處理時間",todo:"待辦理",done:"已辦理",toAssign:"未指派"},flowchart:{title:"查看流程",processNotFound:"流程實例ID為空",dataIdIsNull:"單據內碼為空",flowChart:"流程圖",complete:"隱藏計算路線",simulation:"顯示計算路線",sequenceColor:"分支線顏色說明",completed:"已運行",calculate:"計算路線","default":"默認",suspend:"計算中斷",noProcess:"未找到符合條件的流程定義！",list:"流程列表",noDataId:"單據內碼為空",noBizDefKey:"流程分類ID為空"}}}},w=(I.prototype.getForecastProcessListByPayload=function(t){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/startProcess-simulation",t).pipe(e.map(function(t){return t.procDefs}))},I.prototype.getRuntimeProcInstsByDataId=function(t){return t?this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/runtimeProcInstList?dataId="+t):c.from(new Array)},I.prototype.getHistoricProcInstsByDataId=function(t){return t?this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/historicProcInstList?dataId="+t):c.from(new Array)},I.prototype.getProcInstanceById=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t)},I.prototype.getBpmnModelbyProcInstId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t+"/bpmnModel")},I.prototype.getBpmnModelbyProcDefId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/procDefs/"+t+"/bpmnModel")},I.prototype.getSubProcessInstance=function(t,e){if(t)return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/subProcInst?superActInstId="+t+"&superProcInstId="+e)},I.prototype.getForecastProcessByProcInstId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t+"/forecastProcess")},I.prototype.getForecastProcessByPayload=function(t){return this.httpSvc.post("/api/runtime/wf/v1.0/processInstances/forecastProcess",t)},I.prototype.getCompleteProcessInfoByProcInstId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t+"/flowChartInfo")},I.prototype.getAllActiInstsbyProcInstId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t+"/activityInstanceSlims")},I.prototype.getTransitionInstanceSlimsByProcInstId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t+"/transitionInstanceSlims")},I.prototype.getFormInfoByProcInstId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t+"/formInfo")},I.prototype.getFormInfoByActInstId=function(t,e){t="/api/runtime/wf/v1.0/processInstances/"+t+"/formInfo";return e&&(t+="?actInstId="+e),this.httpSvc.get(t)},I.prototype.getWorkItemLogs=function(t,e){return this.httpSvc.get(e?"/api/runtime/wf/v1.0/processInstances/"+t+"/logs?activityDefinitionId="+e:"/api/runtime/wf/v1.0/processInstances/"+t+"/logs")},I.prototype.getI18nValue=function(t){var e;return t?(e=(e=localStorage.getItem("languageCode"))?m[e]:m["zh-CHS"],-1===t.indexOf(".")?e[t]:t.split(".").reduce(function(t,e){return t?t[e]:null},e)):""},I.prototype.getProcessInstanceById=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/"+t)},I.prototype.getProcInstIdByDataId=function(t){return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/procInstId?bizInstId="+t)},I.prototype.retryAifCreation=function(t,e,n){return this.httpSvc.post("/api/runtime/wf/v1.0/aifactivityinstance/retry",e)},I.prototype.ifThirdTask=function(t){return this.httpSvc.get("/api/runtime/task/v1.0/instances/wfExternalProcess?processInstanceId="+t)},I.prototype.getFsParamsByBizId=function(t){return this.httpSvc.get("/api/runtime/task/v1.0/tasks/third/bizId?bizId="+t)},I.prototype.viewFsProcessNew=function(t){return this.httpSvc.post("/api/fssp/ssp/v1.0/mybill/fswybz/viewprocess",t)},I.prototype.getFlowChartStyleConfig=function(){return this.httpSvc.get("/platform/runtime/common/web/@gsp-wf/wf-process-editor/config/cell-style-config.json")},I.prototype.getMutiChildInstance=function(t,e){var n=t.activityInstanceId,t=t.multiInstanceRoot||!1;return this.httpSvc.get("/api/runtime/wf/v1.0/processInstances/subProcInstList?actInstId="+n+"&isMultiInstanceRoot="+t+"&superProcInstId="+e)},I.decorators=[{type:p.Injectable}],I.ctorParameters=function(){return[{type:d.HttpService}]},I);function I(t){this.httpSvc=t}var y=function(t,e){return(y=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)};function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function C(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&i>=t.length?void 0:t)&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}v(D,S=g.mxCell);var S,b=D;function D(t,e,n){return S.call(this,t,e,n)||this}v(P,E=g.mxGraph),P.prototype.createVertex=function(t,e,n,i,o,r,a,s,l){i=new g.mxGeometry(i,o,r,a),i.relative=null!=l&&l,o=new b(n,i,s);return o.setId(e),o.setVertex(!0),o.setConnectable(!0),o},P.prototype.createEdge=function(t,e,n,i,o,r){n=new b(n,new g.mxGeometry,r);return n.setId(e),n.setEdge(!0),n.geometry.relative=!0,n},P.prototype.setDefaultStyles=function(){var t=this.getStylesheet(),e=t.getDefaultVertexStyle(),e=(e[g.mxConstants.STYLE_SHAPE]=g.mxConstants.SHAPE_IMAGE,e[g.mxConstants.STYLE_VERTICAL_LABEL_POSITION]=g.mxConstants.ALIGN_BOTTOM,e[g.mxConstants.STYLE_FONTSIZE]=12,e[g.mxConstants.STYLE_FONTFAMILY]="Helvetica",e[g.mxConstants.STYLE_FONTCOLOR]="#333",t.getDefaultEdgeStyle());e[g.mxConstants.STYLE_SOURCE_PORT]="e",e[g.mxConstants.STYLE_TARGET_PORT]="w",e[g.mxConstants.STYLE_EDGE]=g.mxConstants.EDGESTYLE_ORTHOGONAL,e[g.mxConstants.STYLE_ROUNDED]=1,e[g.mxConstants.STYLE_STROKECOLOR]="#6482B9",e[g.mxConstants.STYLE_FONTSIZE]=12,e[g.mxConstants.STYLE_FONTFAMILY]="Helvetica"},P.prototype.createInfiniteCanvas=function(){var s=this,a=(this.getPagePadding=function(){return new g.mxPoint(Math.max(0,Math.round(s.container.offsetWidth-34)),Math.max(0,Math.round(s.container.offsetHeight-34)))},this.getScrollTileSize=function(){return null==s.scrollTileSize&&(s.scrollTileSize=new g.mxRectangle(0,0,400,600)),s.scrollTileSize},this.getPageSize=function(){return s.pageVisible?new g.mxRectangle(0,0,s.pageFormat.width*s.pageScale,s.pageFormat.height*s.pageScale):s.getScrollTileSize()},this.getPageLayout=function(){var t,e,n,i,o,r=s.pageVisible?s.getPageSize():s.getScrollTileSize(),a=s.getGraphBounds();return 0==a.width||0==a.height?new g.mxRectangle(0,0,1,1):(i=Math.ceil(a.x/s.view.scale-s.view.translate.x),t=Math.ceil(a.y/s.view.scale-s.view.translate.y),o=Math.floor(a.width/s.view.scale),a=Math.floor(a.height/s.view.scale),e=Math.floor(i/r.width),n=Math.floor(t/r.height),i=Math.ceil((i+o)/r.width)-e,o=Math.ceil((t+a)/r.height)-n,new g.mxRectangle(e,n,i,o))},this.getPreferredPageSize=function(t,e,n){var i=s.getPageLayout(),o=s.getPageSize();return new g.mxRectangle(0,0,i.width*o.width,i.height*o.height)},this.sizeDidChange),i=(this.sizeDidChange=function(){var t,e,n,i,o,r;null!=s.container&&g.mxUtils.hasScrollbars(s.container)&&(t=s.getPageLayout(),r=s.getPagePadding(),e=s.getPageSize(),i=Math.ceil(2*r.x/s.view.scale+t.width*e.width),o=Math.ceil(2*r.y/s.view.scale+t.height*e.height),null!=(n=s.minimumGraphSize)&&n.width==i&&n.height==o||(s.minimumGraphSize=new g.mxRectangle(0,0,i,o)),n=r.x/s.view.scale-t.x*e.width,i=r.y/s.view.scale-t.y*e.height,s.autoTranslate||s.view.translate.x==n&&s.view.translate.y==i?a.apply(s,[]):(s.autoTranslate=!0,s.view.x0=t.x,s.view.y0=t.y,o=s.view.translate.x,r=s.view.translate.y,s.view.setTranslate(n,i),s.container.scrollLeft+=(n-o)*s.view.scale,s.container.scrollTop+=(i-r)*s.view.scale,s.autoTranslate=!1))},this.view.getBackgroundPageBounds=function(){var t=s.getPageLayout(),e=s.getPageSize();return new g.mxRectangle(s.view.scale*(s.view.translate.x+t.x*e.width),s.view.scale*(s.view.translate.y+t.y*e.height),s.view.scale*t.width*e.width,s.view.scale*t.height*e.height)},this.view.validate);this.view.validate=function(t){var e,n;null!=s.container&&g.mxUtils.hasScrollbars(s.container)&&(e=s.getPagePadding(),n=s.getPageSize(),s.view.translate.x,s.view.translate.y,s.view.translate.x=e.x/s.view.scale-(s.view.x0||0)*n.width,s.view.translate.y=e.y/s.view.scale-(s.view.y0||0)*n.height),i.apply(s.view,[t])}},P.prototype.createBpmnModel=function(){var t=new l.BpmnModel;return t.TargetNamespace="Default_Namespace",t.DefaultProcess=new l.Process(t),t.DefaultDiagram=new l.BPMNDiagram(t),t.DefaultDiagram.BpmnPlane.BpmnElementId=t.DefaultProcess.Id,t},P.prototype.loadBpmnModel=function(t){this.removeCells(this.getChildCells(this.getDefaultParent())),this.bpmnModel=this.createBpmnModel(),this.bpmnModel.LoadFromJson(t),this.drawBpmnGraph(this.bpmnModel)},P.prototype.reloadBpmnModel=function(t){this.removeCells(this.getChildCells(this.getDefaultParent())),t?this.loadBpmnModel(t):this.drawBpmnGraph(this.bpmnModel)},P.prototype.drawBpmnGraph=function(t){var e=this.buildFlowDiagDict(t),n=e.nodeDict,e=e.edgeDict,t=this.buildFlowDict(t);this.drawNodeCells(t,n),this.drawEdgeCells(t,e),this.getModel().beginUpdate(),"simulation"===this.mode&&(this.drawInterceptGraph(t,n,e),this.addJumpEdges(t)),this.getModel().endUpdate()},P.prototype.drawInterceptGraph=function(t,e,n){var i,o,r=this,a=this.findFirstStartActivityInstance(this.actList);for(o in t)t[o]instanceof l.EndEvent&&(i=t[o]);a&&this.findEndActiInstList(a,this.actList,this.transInsList).forEach(function(t){t.activityDefinitionId!==i.Id&&r.drawNextFlowChart(t.activityDefinitionId,e,n)})},P.prototype.addJumpEdges=function(t){var e,n,a=this.getChildCells(this.getDefaultParent(),!0)||[],i=this.findNoIncomingNodes(a),s=this;try{for(var o=C(i),r=o.next();!r.done;r=o.next())!function(e){var n=s.actList.filter(function(t){return t.activityDefinitionId===e.flowElement.Id})[0],t=n.precursorActivityDefinitionId+"_"+n.activityDefinitionId,i=a.find(function(t){return t.flowElement&&t.flowElement.Id===n.precursorActivityDefinitionId}),o=a.find(function(t){return t.flowElement&&t.flowElement.Id===n.activityDefinitionId}),r=new Map,r=(r.set("jump",!0),s.getEdgeStyle(null,null,r)),t=s.insertEdge(s.getDefaultParent(),t,"",i,o,r);null!==t&&(t.source=i,t.target=o,t.geometry.points=[],console.log(t),s.moveCells([t],undefined,undefined,undefined,s.getDefaultParent()))}(r.value)}catch(l){e={error:l}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(e)throw e.error}}},P.prototype.drawNodeCells=function(n,i,o){var r=this;void 0===o&&(o=!1),Object.keys(i).forEach(function(t){var e=n[t],t=i[t];null!=e&&r.drawNodeCell(e,t,o)})},P.prototype.drawNodeCell=function(e,t,n){var i=this.getVertexStyle(e,t,n),o=null,r="";null!=e&&(r=e.Name,e.NameLanguage)&&null!=e.NameLanguage[this.langCode]&&(r=e.NameLanguage[this.langCode]),null!=(o="simulation"!==this.mode||-1<this.actList.findIndex(function(t){return t.activityDefinitionId===e.Id})||n?this.insertVertex(this.getDefaultParent(),e.Id,r,t.Bounds.X,t.Bounds.Y,t.Bounds.Width,t.Bounds.Height,i):o)&&(o.flowElement=e,o.diagramElement=t,this.moveCells([o],undefined,undefined,undefined,this.getDefaultParent()))},P.prototype.drawEdgeCells=function(n,i,o,r){var a=this;void 0===o&&(o=!1),void 0===r&&(r=!1),Object.keys(i).forEach(function(t){var e=n[t],t=i[t];null!=e&&a.drawEdgeCell(e,t,o,r)})},P.prototype.judgeConnectBetweenTwoNodes=function(t,e,n){var i,o,e=t[e].Outgoings;if(e&&0!==e.length)try{for(var r=C(e),a=r.next();!a.done;a=r.next())if(t[a.value].TargetRef===n)return!0}catch(s){i={error:s}}finally{try{a&&!a.done&&(o=r["return"])&&o.call(r)}finally{if(i)throw i.error}}return!1},P.prototype.drawEdgeCell=function(e,t,n,i){var o=this.getChildCells(this.getDefaultParent(),!0)||[],r=o.find(function(t){return t.flowElement&&t.flowElement.Id===e.SourceRef}),o=o.find(function(t){return t.flowElement&&t.flowElement.Id===e.TargetRef}),a=new Map,a=(a.set("additional",n),a.set("cut",i),this.getEdgeStyle(e,t,a)),s=null,l="";if(null!=e&&(l=e.Name,e.NameLanguage)&&null!=e.NameLanguage[this.langCode]&&(l=e.NameLanguage[this.langCode]),null!=(s="simulation"!==this.mode||-1<this.transInsList.findIndex(function(t){return t.sourceActivityDefinitionId===e.SourceRef&&t.destinationActivityDefinitionId===e.TargetRef})||n||i?this.insertEdge(this.getDefaultParent(),e.Id,l,r,o,a):s))if(s.flowElement=e,s.diagramElement=t,s.source=r,s.target=o,s.geometry.points=s.geometry.points||[],this.isOldBpmnEdge(t)){for(var c=2;c<t.Points.length;c++){var d=t.Points[c];s.geometry.points.push(new g.mxPoint(d.X,d.Y))}this.moveCells([s],undefined,undefined,undefined,this.getDefaultParent());var u=this.view.getState(s);t.BpmnLabel&&u&&(0===t.BpmnLabel.Bounds.X&&0===t.BpmnLabel.Bounds.Y||(p=t.BpmnLabel.Bounds.X+(u.x-u.paintBounds.x),f=t.BpmnLabel.Bounds.Y+(u.y-u.paintBounds.y),(h=this.createEdgeHandler(u,undefined)).moveLabel(u,p,f),h.destroy()))}else{for(c=1;c<t.Points.length-1;c++){d=t.Points[c];s.geometry.points.push(new g.mxPoint(d.X,d.Y))}this.moveCells([s],undefined,undefined,undefined,this.getDefaultParent());var p,f,h,u=this.view.getState(s),n=this.view.getScale(),i=this.view.getTranslate();t.BpmnLabel&&u&&(0===t.BpmnLabel.Bounds.X&&0===t.BpmnLabel.Bounds.Y||(p=t.BpmnLabel.Bounds.X*n+i.x,f=t.BpmnLabel.Bounds.Y*n+i.y,(h=this.createEdgeHandler(u,undefined)).moveLabel(u,p,f),h.destroy()))}},P.prototype.buildFlowDict=function(t){return t.DefaultProcess.GetFlowElements()},P.prototype.buildFlowDiagDict=function(t){var e={},n={},t=t.DefaultDiagram.BpmnPlane.GetDiagramElements();return t&&t.forEach(function(t){t instanceof l.Node?e[t.BpmnElementId]=t:t instanceof l.Edge&&(n[t.BpmnElementId]=t)}),{nodeDict:e,edgeDict:n}},P.prototype.isOldBpmnEdge=function(t){if(2<=t.Points.length){var e=t.Points[0],t=t.Points[1];if(0==e.X&&0==e.Y&&0==t.X&&0==t.Y)return!0}return!1},P.prototype.getVertexStyle=function(e,t,n){var i,o=this.actList,r=null;return null==(r=e instanceof a.UserActivity&&""!==e.BizActivityID?this.cellStyleConfig.shapeStyleDic&&this.cellStyleConfig.shapeStyleDic[a.OperationActivity.Clr_Type_ID]:this.cellStyleConfig.shapeStyleDic&&this.cellStyleConfig.shapeStyleDic[e.ClrTypeID])?this.getVertexStyleOld(e,n):(i=r[l.FlowNodeState.Default]&&r[l.FlowNodeState.Default].image,n||(n=o.filter(function(t){return t.activityDefinitionId===e.Id}))&&0<n.length&&(0<n.filter(function(t){return"RUNNING"===t.state}).length?r[l.FlowNodeState.Running]&&(i=r[l.FlowNodeState.Running].image):0<n.filter(function(t){return"COMPLETED"===t.state}).length?r[l.FlowNodeState.Completed]&&(i=r[l.FlowNodeState.Completed].image):0<n.filter(function(t){return"TERMINATED"===t.state}).length&&r[l.FlowNodeState.Terminated]&&(i=r[l.FlowNodeState.Terminated].image)),null==i?null:"image="+this.rootPath+i)},P.prototype.getVertexStyleOld=function(t,e){var n;switch(t.ClrTypeID){case"bpmn.EndEvent":n="end";break;case a.StartActivity.Clr_Type_ID:n="start";break;case a.UserActivity.Clr_Type_ID:n=t.BizActivityID?"bizActivity":"approval";break;case"bpmn.ExclusiveGateway":n="ExclusiveGateway";break;case"bpmn.ParallelGateway":n="ParallelGateway";break;case a.CallActivitySubProcess.Clr_Type_ID:n="sub";break;case a.AutoActivity.Clr_Type_ID:n="auto";break;case a.IntermediateCatchEventImpl.Clr_Type_ID:n="catchEvent";break;case a.OperationActivity.Clr_Type_ID:n="bizActivity";break;case a.MessageActivity.Clr_Type_ID:n="message";break;case a.NotifyActivity.Clr_Type_ID:n="notify";break;case a.AifCreationBillActivity.Clr_Type_ID:n="aifCreationActivity"}return"image="+this.rootPath+"/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/"+n+this.getChartState(t,e)+";"},P.prototype.getChartState=function(e,t){if(!t){t=this.actList.filter(function(t){return t.activityDefinitionId===e.Id});if(t&&0<t.length)return 0<t.filter(function(t){return"RUNNING"===t.state}).length?"_light.gif":0<t.filter(function(t){return"COMPLETED"===t.state}).length||0<t.filter(function(t){return"TERMINATED"===t.state}).length?"_gray.png":".png"}return".png"},P.prototype.getEdgeStyle=function(e,t,n){var i,o,r,a,s;return n.get("jump")?(i="",(o=this.cellStyleConfig.edgeStyleDic&&this.cellStyleConfig.edgeStyleDic["bpmn.SequenceFlow"]).jump?(Object.keys(o.jump).forEach(function(t){i+=t+"="+o.jump[t]+";"}),i):null):null==(r=this.cellStyleConfig.edgeStyleDic&&this.cellStyleConfig.edgeStyleDic[e.ClrTypeID])?this.getEdgeStyleOld(e,n.get("additional"),n.get("cut")):(a=this.transInsList,s="",n.get("cut")&&r[l.SequenceFlowState.Cut]?Object.keys(r[l.SequenceFlowState.Cut]).forEach(function(t){s+=t+"="+r[l.SequenceFlowState.Cut][t]+";"}):n.get("additional")&&r[l.SequenceFlowState.Add]?Object.keys(r[l.SequenceFlowState.Add]).forEach(function(t){s+=t+"="+r[l.SequenceFlowState.Add][t]+";"}):(n=a.filter(function(t){return t.sourceActivityDefinitionId===e.SourceRef&&t.destinationActivityDefinitionId===e.TargetRef}))&&0<n.filter(function(t){return"COMPLETED"===t.state}).length&&r[l.SequenceFlowState.Completed]?Object.keys(r[l.SequenceFlowState.Completed]).forEach(function(t){s+=t+"="+r[l.SequenceFlowState.Completed][t]+";"}):"simulation"===this.mode&&r[l.SequenceFlowState.Simulation]?Object.keys(r[l.SequenceFlowState.Simulation]).forEach(function(t){s+=t+"="+r[l.SequenceFlowState.Simulation][t]+";"}):r[l.SequenceFlowState.Default]&&Object.keys(r[l.SequenceFlowState.Default]).forEach(function(t){s+=t+"="+r[l.SequenceFlowState.Default][t]+";"}),s)},P.prototype.getStrokeColor=function(e,t,n,i){var o=this.transInsList,r=this.cellStyleConfig.edgeStyleDic&&this.cellStyleConfig.edgeStyleDic[e.ClrTypeID];return(i&&r[l.SequenceFlowState.Cut]?r[l.SequenceFlowState.Cut]:n&&r[l.SequenceFlowState.Add]?r[l.SequenceFlowState.Add]:(i=o.filter(function(t){return t.sourceActivityDefinitionId===e.SourceRef&&t.destinationActivityDefinitionId===e.TargetRef}))&&0<i.filter(function(t){return"COMPLETED"===t.state}).length&&r[l.SequenceFlowState.Completed]?r[l.SequenceFlowState.Completed]:"simulation"===this.mode&&r[l.SequenceFlowState.Simulation]?r[l.SequenceFlowState.Simulation]:r[l.SequenceFlowState.Default]).strokeColor},P.prototype.getEdgeStyleOld=function(e,t,n){return n?"strokeColor=#FF4040":t?"strokeColor=#59A1FF":(n=this.transInsList.filter(function(t){return t.sourceActivityDefinitionId===e.SourceRef&&t.destinationActivityDefinitionId===e.TargetRef}))&&0<n.filter(function(t){return"COMPLETED"===t.state}).length?"strokeColor=#595959;strokeWidth=2;":"simulation"===this.mode?"strokeColor=#f59c24;dashed=1;":"strokeColor=#59A1FF;"},P.prototype.drawNextFlowChart=function(t,n,i){var o=this,e=this.findDrawFlowElementsByActDefId(t,this.bpmnModel),r=e.nextFlowNodeDict,a=e.nextSeqFlowDict,s=this.bpmnModel.DefaultProcess.GetFlowElement(t).Outgoings;Object.keys(r).forEach(function(t){var t=r[t],e=n[t.Id];o.getCellByFlowElementId(t.Id)||o.drawNodeCell(t,e,!0)}),Object.keys(a).forEach(function(t){var e=a[t],t=i[e.Id];o.getCellByFlowElementId(e.Id)||(s.some(function(t){return t===e.Id})?o.drawEdgeCell(e,t,!0,!0):o.drawEdgeCell(e,t,!0,!1))})},P.prototype.getCellByFlowElementId=function(e,t){return t=t||this.getDefaultParent(),this.getChildCells(t).find(function(t){return t instanceof b&&t.flowElement&&t.flowElement.Id==e})},P.prototype.findFirstStartActivityInstance=function(t){var e,n;try{for(var i=C(t),o=i.next();!o.done;o=i.next()){var r=o.value;if(!r.precursorActivityDefinitionId)return r}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i["return"])&&n.call(i)}finally{if(e)throw e.error}}return null},P.prototype.findNoIncomingNodes=function(t){var e,n,i=new Array;try{for(var o=C(t),r=o.next();!r.done;r=o.next())!function(e){"wf.StartActivity"===e.flowElement.ClrTypeID||(e.edges&&0!==e.edges.length?e.edges.some(function(t){return t.target.flowElement.Id===e.flowElement.Id})||i.push(e):i.push(e))}(r.value)}catch(a){e={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(e)throw e.error}}return i},P.prototype.findEndActiInstList=function(t,e,n){var i=[];return this.getNextTransitions(i,t.activityInstanceId,e,n),i},P.prototype.getNextTransitions=function(t,e,n,i){var o,r,a=this.findTranInstsBySourceActInstId(e,i);if(a&&0<a.length)try{for(var s=C(a),l=s.next();!l.done;l=s.next()){var c=l.value;c.destinationActivityDefinitionId&&this.getNextTransitions(t,c.destinationActivityInstanceId,n,i)}}catch(u){o={error:u}}finally{try{l&&!l.done&&(r=s["return"])&&r.call(s)}finally{if(o)throw o.error}}else{var d=this.findActInstByActInstId(e,n);!d||t.some(function(t){return t.activityInstanceId===d.activityInstanceId})||t.push(d)}},P.prototype.findTranInstsBySourceActInstId=function(e,t){return t.filter(function(t){return t.sourceActivityInstanceId===e})},P.prototype.findActInstByActInstId=function(e,t){return t.find(function(t){return t.activityInstanceId===e})},P.prototype.findDrawFlowElementsByActDefId=function(t,e){var n={},i={};return this.findNextFlowElementsByFlowElementId(n,i,t,e),{nextFlowNodeDict:n,nextSeqFlowDict:i}},P.prototype.findNextFlowElementsByFlowElementId=function(e,n,t,i){var o=this,r=i.DefaultProcess.GetFlowElement(t);r&&null==e[t]&&(r instanceof l.SequenceFlow?(n[r.Id]=r,this.findNextFlowElementsByFlowElementId(e,n,r.TargetRef,i)):r instanceof l.FlowNode&&(e[r.Id]=r)instanceof l.EndEvent==0&&r.Outgoings&&r.Outgoings.forEach(function(t){o.findNextFlowElementsByFlowElementId(e,n,t,i)}))};var E,U=P;function P(t,e){var n=E.call(this,t)||this;n.scrollTileSize=new g.mxRectangle(0,0,400,600),n.cellStyleConfig={edgeStyleDic:{},shapeStyleDic:{}},n.actList=[],n.transInsList=[],n.rootPath="",n.langCode=window.gspframeworkService&&window.gspframeworkService.rtf.language.getLanguageCode()||localStorage.getItem("languageCode")||"zh-CHS";try{n.rootPath=window.gspframeworkService.common.getBasePath.get()}catch(i){}return n.cellStyleConfig=e||n.cellStyleConfig,n.autoScroll=!1,n.autoExtend=!0,n.pageVisible=!1,n.setCellsSelectable(!0),n.setDisconnectOnMove(!1),n.setCellsResizable(!1),n.setConnectable(!1),n.setEnabled(!0),n.setVertexLabelsMovable(!1),n.setCellsLocked(!0),n.setAllowDanglingEdges(!1),g.mxEvent.disableContextMenu(t),n.setDefaultStyles(),n}v(F,x=g.mxEventSource),F.prototype.setLanguage=function(t){this.langCode=t,this.graph&&(this.graph.langCode=t)},F.prototype.switchMode=function(t){var e=t.mode,n=t.actiInstList,t=t.transInsList;this.mode=e,this.actList=n,this.transInsList=t,this.graph.actList=this.actList,this.graph.transInsList=this.transInsList,this.graph.mode=this.mode,this.graph.reloadBpmnModel()},F.prototype.load=function(t){t&&(this.processInstance=t.processInstance,this.actList=t.actiInstList,this.transInsList=t.transInsList,this.mode=t.mode,this.graph.actList=this.actList,this.graph.transInsList=this.transInsList,this.graph.mode=this.mode,this.graph.loadBpmnModel(t.content),this.resetScrollbars())},F.prototype.createDiv=function(){var e=this,t=(this.diagramContainer=document.createElement("div"),this.diagramContainer.className="flowChartContainer",this.container.appendChild(this.diagramContainer),setTimeout(function(){g.mxEvent.addListener(e.diagramContainer,"mouseover",function(){e.diagramContainer.classList.add("active")}),g.mxEvent.addListener(e.diagramContainer,"mouseleave",function(){e.diagramContainer.classList.remove("active")})},0),document.createElement("a")),n=(t.setAttribute("href","javascript:void(0);"),document.createElement("img")),n=(t.style.marginRight="10px",n.src=this.rootPath+"/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/zoomIn.svg",n.style.display="inline-block",n.style.verticalAlign="middle",t.appendChild(n),g.mxEvent.addListener(t,"click",function(t){e.graph.zoomIn()}),document.createElement("a")),i=(n.setAttribute("href","javascript:void(0);"),document.createElement("img")),i=(i.src=this.rootPath+"/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/zoomOut.svg",i.style.display="inline-block",i.style.verticalAlign="middle",n.appendChild(i),g.mxEvent.addListener(n,"click",function(t){e.graph.zoomOut()}),document.createElement("div"));i.className="zoomBar",i.style.position="absolute",i.style.top="10px",i.style.right="20px",i.appendChild(t),i.appendChild(n),this.container.appendChild(i)},F.prototype.createGraph=function(t){var a=this,t=(g.mxConstants.VERTEX_SELECTION_STROKEWIDTH=1,g.mxConstants.VERTEX_SELECTION_COLOR="#0000CD",g.mxConstants.VERTEX_SELECTION_DASHED=!0,new U(this.diagramContainer,t));return t.createInfiniteCanvas(),t.sizeDidChange(),t.popupMenuHandler.autoExpand=!0,t.popupMenuHandler.factoryMethod=function(t,e,n){var i,o,r;null!=e&&-1<e.getId().indexOf("UserActivity")&&-1<a.actList.findIndex(function(t){return t.activityDefinitionId===e.getId()})&&a.processInstance&&(i=a.actList.find(function(t){return t.activityDefinitionId===e.getId()}).activityInstanceId,t.addItem("查看单据",null,function(){a.viewForm(a.processInstance.id,i,a.processInstance.bizInstId)})),null!=e&&-1<e.getId().indexOf("AifCreationBillActivity")&&-1<a.actList.findIndex(function(t){return t.activityDefinitionId===e.getId()})&&a.processInstance&&1==(o=a.actList.filter(function(t){return t.activityDefinitionId===e.getId()&&"RUNNING"==t.state})).length&&(r=o[0],t.addItem("重试",null,function(){a.retryAifCreation(a.processInstance.id,r.activityInstanceId,a.processInstance.bizInstId)}))},t},F.prototype.cellSelect=function(t,e){var n,i,o;t instanceof g.mxGraphSelectionModel&&((t=t.cells[0])?t.vertex?(n=t.getId())&&-1<n.indexOf("CallActivitySubProcess")&&-1<this.actList.findIndex(function(t){return"FORECAST"!==t.state&&t.activityDefinitionId===n})?(o=(i=this.actList.filter(function(t){return"FORECAST"!==t.state&&t.activityDefinitionId===n})).find(function(t){return"RUNNING"===t.state}))?this.viewChildProcessChart(o):this.viewChildProcessChart(i[0]):this.ngComp.viewLogs({type:"activity",actiDefId:t.id}):this.ngComp.viewLogs({type:"sequence"}):this.ngComp.viewLogs({type:"process"}))},F.prototype.viewChildProcessChart=function(t){this.ngComp.viewChild(t,this.processInstance)},F.prototype.viewForm=function(t,e,n){this.ngComp.viewForm(t,e,n)},F.prototype.retryAifCreation=function(t,e,n){this.ngComp.retryAifCreation(t,e,n)},F.prototype.resetScrollbars=function(){var t=this.graph.getGraphBounds(),e=Math.max(t.width*this.graph.view.scale,0),n=Math.max(t.height*this.graph.view.scale,0);this.graph.container.scrollTop=Math.floor(Math.max(0,t.y-Math.max(20,(this.graph.container.clientHeight-n)/2))),this.graph.container.scrollLeft=Math.floor(Math.max(0,t.x-Math.max(0,(this.graph.container.clientWidth-e)/2)))},F.prototype.refresh=function(){this.resetScrollbars()},F.prototype.reloadBpmnModel=function(){this.graph.removeCells(this.graph.getChildCells(this.graph.getDefaultParent()))};var x,W=F;function F(t,e){var n=x.call(this)||this;n.mode="complete",n.actList=[],n.transInsList=[],n.rootPath="",n.langCode=window.gspframeworkService&&window.gspframeworkService.rtf.language.getLanguageCode()||localStorage.getItem("languageCode")||"zh-CHS";try{n.rootPath=window.gspframeworkService.common.getBasePath.get()}catch(i){}return n.container=t,n.createDiv(),n.graph=n.createGraph(e),window.setTimeout(function(){n.resetScrollbars()},0),n.refresh(),n.resizeHandler=function(){window.setTimeout(function(){null!=n.graph&&n.refresh()},0)},g.mxEvent.addListener(window,"resize",n.resizeHandler),n.graph.getSelectionModel().addListener(g.mxEvent.CHANGE,function(t,e){n.cellSelect(t,e)}),n}M.prototype.viewProcess=function(t){var e;t&&t.dataId?t&&t.bizDefKey?((e=new Map).set("dataId",t.dataId),e.set("bizDefKey",t.bizDefKey),t.startMode&&e.set("startMode",t.startMode),t.startUserId&&e.set("startUserId",t.startUserId),e.set("withTitle",!0),t={appType:"menu",funcId:"WFViewFlowChart",appId:"",appEntrance:"",tabId:t.dataId,isNewTab:!0,queryStringParams:e},this.openMenu(t)):this.msgService.warning(this.getI18nValue("static.flowchart.noBizDefKey")):this.msgService.warning(this.getI18nValue("static.flowchart.noDataId"))},M.prototype.viewFlowChart=function(t){var e;t?((e=new Map).set("processId",t),e.set("withTitle",!0),t={appType:"menu",funcId:"WFViewFlowChart",appId:"",appEntrance:"",tabId:(new Date).getTime().toString(),isNewTab:!0,queryStringParams:e},this.openMenu(t)):this.msgService.warning(this.getI18nValue("static.flowchart.processNotFound"))},M.prototype.viewFlowChartByDataId=function(t){var e;t?((e=new Map).set("dataId",t),e.set("withTitle",!0),t={appType:"menu",funcId:"WFViewFlowChart",appId:"",appEntrance:"",tabId:(new Date).getTime().toString(),isNewTab:!0,queryStringParams:e},this.openMenu(t)):this.msgService.warning(this.getI18nValue("static.flowchart.dataIdIsNull"))},M.prototype.viewFlowChartByDialog=function(t,e){var n=this;t?this.flowchartService.getProcessInstanceById(t).subscribe(function(t){t&&n.viewMutiInstanceFlowChartByDialog([t])}):this.msgService.warning(this.getI18nValue("static.flowchart.processNotFound"))},M.prototype.viewMutiInstanceFlowChartByDialog=function(t,e){T.func&&(n=T.func);var n,i={title:this.getI18nValue("static.flowchart.title"),width:1200,height:530,showButtons:!1,beforeClose:function(t){return T.func&&window.removeEventListener("message",T.func,!1),n&&(window.addEventListener("message",n,!1),T.func=n),c.of(!0)}},o=this.resolver.resolveComponentFactory(T),r=p.Injector.create({providers:[{provide:w,useFactory:function(t){return new w(t)},deps:[d.HttpService]}],parent:this.injector}),r=o.create(r),o=(t&&t.length&&(1==t.length?(i.showHeader=!0,i.title=t[0].name+"-v"+t[0].version+".0",r.instance.ProcInstId=t[0].id):(i.showHeader=!1,r.instance.ProcInstList=t)),e&&(r.instance.mode=e),r.instance.fill(),this.modalService.show(r,i));r.instance.dialog=o},M.prototype.viewFlowchartByProcInstIdAndDataId=function(e,n){var i=this;this.flowchartService.ifThirdTask(e).subscribe(function(t){!0===t?i.flowchartService.getFsParamsByBizId(n).subscribe(function(t){t?(t={lcsl:t[0],djnm:t[1],djlx:t[2],djbh:t[3]},i.flowchartService.viewFsProcessNew(t).subscribe(function(t){t&&t.value&&i.openViewProcessMenu(t.value)},function(t){i.viewFlowChart(e)})):i.viewFlowChart(e)},function(t){i.viewFlowChart(e)}):i.viewFlowChart(e)},function(t){i.viewFlowChart(e)})},M.prototype.openViewProcessMenu=function(t){var e=new Map,n=(e.set("thirdTask",!0),new Map),t=(n.set("thirdProcessUrl",t),{appType:"menu",funcId:"WFViewFlowChart",appId:"",appEntrance:"",tabId:(new Date).getTime().toString(),isNewTab:!0,entityParams:n,queryStringParams:e});this.openMenu(t)},M.prototype.getI18nValue=function(t){var e;return t?(e=(e=localStorage.getItem("languageCode"))?m[e]:m["zh-CHS"],-1===t.indexOf(".")?e[t]:t.split(".").reduce(function(t,e){return t?t[e]:null},e)):""},M.prototype.isInSuite=function(){var t=window.gspframeworkService;if(t&&t.rtf){t=t.rtf.extendMethod;if(t&&t.getExtObj())if(t.getExtObj().iGIX4inSuiteMode())return!0}return!1},M.prototype.openMenu=function(t){var e=this.getI18nValue("static.flowchart.title");this.isInSuite()?(t.menuTitle=e,window.gspframeworkService.rtf.extendMethod.getExtObj().iGIXMenuOpen(t)):this.frameworkService.openMenu$(t).subscribe(function(t){},function(t){console.error(t)})},M.decorators=[{type:p.Injectable}],M.ctorParameters=function(){return[{type:u.MessagerService},{type:p.Injector},{type:p.ComponentFactoryResolver},{type:z.BsModalService}]};var L=M;function M(t,e,n,i){this.msgService=t,this.injector=e,this.resolver=n,this.modalService=i,this.flowchartService=this.injector.get(w),this.frameworkService=this.injector.get(s.FrameworkService)}Object.defineProperty(B.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t,"simulation"===this._mode?(this.ifForecast="true",this.modeButton=this.service.getI18nValue("static.flowchart.complete")):"complete"===this._mode&&(this.modeButton=this.service.getI18nValue("static.flowchart.simulation"))},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"ProcInstId",{set:function(t){t&&(this.procInstId=t)},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"DataId",{set:function(t){t&&(this.dataId=t)},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"ProcInstList",{set:function(t){t&&t.length&&(this.procInstId=t[0].id,this.procInstList=t)},enumerable:!0,configurable:!0}),B.prototype.ngOnInit=function(){var e=this;this.service.getFlowChartStyleConfig().subscribe(function(t){setTimeout(function(){e.createFlowChart(t),e.viewFlowChart()},300)})},B.prototype.ngAfterViewChecked=function(){null==this.flowChartContainerER||null==this.flowChartContainerER.nativeElement||null==this.flowChart||this.flowChartContainerClientSize.clientHeight==this.flowChartContainerER.nativeElement.clientHeight&&this.flowChartContainerClientSize.clientWidth==this.flowChartContainerER.nativeElement.clientWidth||(this.flowChartContainerClientSize={clientHeight:this.flowChartContainerER.nativeElement.clientHeight,clientWidth:this.flowChartContainerER.nativeElement.clientWidth},this.flowChart.refresh(),this.flowChart.graph.sizeDidChange())},B.prototype.createFlowChart=function(t){this.flowChart=new W(this.flowChartContainerER.nativeElement,t),(this.flowChart.ngComp=this).flowChart.setLanguage(this.localeId)},B.prototype.viewFlowChart=function(){"viewFlowChart"===this.theme?this.viewFlowChartByProcInstId():this.processForecast()},B.prototype.tabChange=function(t){this.procInstId=t.nextId,this.viewFlowChart(),this.flowChart.reloadBpmnModel()},B.prototype.closeDialog=function(){this.dialog.close()},B.prototype.viewChild=function(t,e){var n=this;this.service.getMutiChildInstance(t,e.id).subscribe(function(t){if(!(n.chartService&&t&&t.length))throw Error("请升级查看流程公共包实现联查子流程图功能");1==t.length?n.chartService.viewFlowChartByDialog(t[0].id,n.mode):n.chartService.viewMutiInstanceFlowChartByDialog(t,n.mode)})},B.prototype.modeSwitch=function(){var e=this;"complete"===this.mode?(this.mode="simulation",this.ifForecast="true",this.modeButton=this.service.getI18nValue("static.flowchart.complete"),this.service.getForecastProcessByProcInstId(this.procInstId).subscribe(function(t){e.actInstList=t.activityInstanceSlims,e.transInsList=t.transitionInstanceSlims,e.flowChart.switchMode({mode:"simulation",actiInstList:t.activityInstanceSlims,transInsList:t.transitionInstanceSlims})})):(this.mode="complete",this.ifForecast="false",this.modeButton=this.service.getI18nValue("static.flowchart.simulation"),this.service.getCompleteProcessInfoByProcInstId(this.procInstId).subscribe(function(t){e.actInstList=t.activityInstanceSlims,e.transInsList=t.transitionInstanceSlims,e.flowChart.switchMode({mode:"complete",actiInstList:t.activityInstanceSlims,transInsList:t.transitionInstanceSlims})}))},B.prototype.viewLogs=function(t){this.type=t.type,this.actDefId=t.actiDefId},B.prototype.viewFlowChartByProcInstId=function(){var e=this;this.content="",this.procInstId&&("complete"===this.mode?c.forkJoin(this.service.getProcInstanceById(this.procInstId),this.service.getBpmnModelbyProcInstId(this.procInstId),this.service.getCompleteProcessInfoByProcInstId(this.procInstId)).subscribe(function(t){e.processInstance=t[0],e.content=JSON.stringify(t[1]),e.actInstList=t[2].activityInstanceSlims,e.transInsList=t[2].transitionInstanceSlims,e.loadFlowChart()}):c.forkJoin(this.service.getProcInstanceById(this.procInstId),this.service.getBpmnModelbyProcInstId(this.procInstId),this.service.getForecastProcessByProcInstId(this.procInstId)).subscribe(function(t){e.processInstance=t[0],e.content=JSON.stringify(t[1]),e.actInstList=t[2].activityInstanceSlims,e.transInsList=t[2].transitionInstanceSlims,e.loadFlowChart()}))},B.prototype.processForecast=function(){var e=this;this.content="",this.mode="simulation",this.processForecastPayload.processDefinitionId&&this.processForecastPayload.dataId&&c.forkJoin(this.service.getBpmnModelbyProcDefId(this.processForecastPayload.processDefinitionId),this.service.getForecastProcessByPayload(this.processForecastPayload)).subscribe(function(t){e.content=JSON.stringify(t[0]),e.actInstList=t[1].activityInstanceSlims,e.transInsList=t[1].transitionInstanceSlims,e.loadFlowChart()})},B.prototype.viewForm=function(i,o,r){var a=this;i&&this.service.getFormInfoByActInstId(i,o).subscribe(function(t){if(t&&t.appId){var e={appType:"menu",funcId:t.appId,appId:"",appEntrance:"",tabId:r,isNewTab:!0},n=new Map;if(n.set("procInstId",i),n.set("actInstId",o),t.parameters.forEach(function(t){return n.set(t.code,t.value)}),e.queryStringParams=n,!a.frameworkSvc)throw Error("框架服务不存在！无法联查！");a.frameworkSvc.openMenu(e)}else a.message&&a.message.info("找不到单据，请联系管理员查看原因！")})},B.prototype.retryAifCreation=function(t,e,n){var i,o=this;t&&(i=this.loading.show(),this.service.retryAifCreation(t,e,n).subscribe(function(t){i.close(),o.notify.success("重试成功"),o.viewFlowChart()},function(t){throw i.close(),setTimeout(function(){o.message.error(null!=t.error&&(t.error.Message||t.error.message)||t.message)},300),t}))},B.prototype.loadFlowChart=function(){this.content&&this.flowChart.load({processInstance:this.processInstance,content:this.content,actiInstList:this.actInstList,transInsList:this.transInsList,mode:this.mode})},B.prototype.fill=function(){this.cls="d-flex flex-fill h-100 f-utils-absolute-all"},B.func=null,B.decorators=[{type:p.Component,args:[{selector:"wf-flowchart",template:'<div class="f-page f-page-navigate f-page-is-listnav">\r\n    \x3c!-- 多实例子流程头 --\x3e\r\n    <div *ngIf="procInstList?.length" class="flowChart-muti-header">\r\n        <farris-tabs [value]="curChildProcInst?.id" [contentFill]="true" [autoTitleWidth]="true" [titleWidth]="90"\r\n            (tabChange)="tabChange($event)" class="w-100">\r\n            <farris-tab *ngFor="let process of procInstList" [id]="process.id"\r\n                [title]="process.name + \'-v\' + process.version + \'.0\'" style="overflow: hidden">\r\n                <ng-template farrisTabsExtend>\r\n                    <li class="f-btn-icon f-bare" (click)="closeDialog()"><span\r\n                            class="f-icon modal_close flowchart-header-button"></span></li>\r\n                </ng-template>\r\n            </farris-tab>\r\n        </farris-tabs>\r\n    </div>\r\n    \x3c!-- 正常情况查看流程 --\x3e\r\n    <div class="f-page-main" style="margin: 0;">\r\n        <farris-splitter class="f-page-content f-component-splitter">\r\n            \x3c!-- 左侧流程图 --\x3e\r\n            <farris-splitter-pane class="f-page-content-main f-component-splitter-pane">\r\n                <div class="f-utils-flex-column h-100">\r\n                    <div *ngIf="dataId || procInstId || processForecastPayload" class="f-utils-fill">\r\n                        <div style="position: relative; height: 100%; width: 100%;">\r\n                            <div id="flowChartContainer" class="geEditor flowchart-container" #flowChartContainer></div>\r\n                        </div>\r\n                    </div>\r\n                    <div class="flowchart-buttons-padding ">\r\n                        \x3c!-- 显示预测路线 --\x3e\r\n                        <button *ngIf="theme===\'viewFlowChart\'" class="btn btn-secondary mr-2"\r\n                            (click)="modeSwitch()">{{modeButton}}\r\n                        </button>\r\n                        \x3c!-- 分支线颜色说明 --\x3e\r\n                        <div class="btn-group" fDropdown [placement]="\'top\'">\r\n                            <button class="btn btn-secondary dropdown-toggle" fDropdownToggle type="button">\r\n                                {{\'static.flowchart.sequenceColor\' | translate}}\r\n                            </button>\r\n                            <div class="dropdown-menu" fDropdownMenu>\r\n                                <div *ngFor="let s of sequenceColorList" class="flowchart-sequence-color">\r\n                                    <span class="flowchart-color-div" [ngClass]="s.colorClass"></span>\r\n                                    {{\'static.flowchart.\' + s.label | translate}}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </farris-splitter-pane>\r\n            \x3c!-- 右侧审批日志 --\x3e\r\n            <farris-splitter-pane class="f-page-content-nav f-component-splitter-pane flowchart-right-pane" ngResizable\r\n                [rzHandles]="\'w\'" [collapsePosition]="\'left\'" [enableCollapse]="true" [rzMinWidth]="200"\r\n                [rzMaxWidth]="600">\r\n                <farris-section [enableMaximize]="false" [enableAccordion]="false" [showHeader]="false"\r\n                    class="f-overflow-y-auto px-0">\r\n                    <wf-approval-logs [ProcInstId]="procInstId" [DataId]="dataId" [IfForecast]="ifForecast"\r\n                        [ActivityDefinitionId]="actDefId" [Type]="type"\r\n                        [processForecastPayload]="processForecastPayload" [ShowHeader]="true" [ShowViewProcess]="false"\r\n                        [OnlyIncludeCurrentProcInst]="true">\r\n                    </wf-approval-logs>\r\n                </farris-section>\r\n            </farris-splitter-pane>\r\n        </farris-splitter>\r\n    </div>\r\n</div>',encapsulation:p.ViewEncapsulation.None,styles:['@charset "UTF-8";::ng-deep .chartModal .ant-modal{height:100%}::ng-deep .chartModal .ant-modal-content{height:100%}::ng-deep .chartModal .ant-modal-body{height:90%}.flowChart{height:100%;min-height:300px;width:100%}.flowChartContainer{overflow:auto;position:absolute;top:0;left:0;width:100%;height:100%;cursor:default;outline:0;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAwIDEwIEwgNDAgMTAgTSAxMCAwIEwgMTAgNDAgTSAwIDIwIEwgNDAgMjAgTSAyMCAwIEwgMjAgNDAgTSAwIDMwIEwgNDAgMzAgTSAzMCAwIEwgMzAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2UwZTBlMCIgb3BhY2l0eT0iMC4yIiBzdHJva2Utd2lkdGg9IjEiLz48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=)}.flowChartContainer.active::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.2)}.flowChartContainer::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,0)}.geEditor{font-family:Microsoft YaHei,Source Han Sans,sans-serif;font-size:10pt;border:none;margin:0}.geEditor input[type=text]::-ms-clear{display:none}body div.mxPopupMenu{box-shadow:3px 3px 6px silver;background:#fff;position:absolute;border:3px solid #e7e7e7;padding:3px}body table.mxPopupMenu{border-collapse:collapse;margin:0}body tr.mxPopupMenuItem{color:#000;cursor:default}body td.mxPopupMenuItem{padding:6px 0 6px 30px;font-family:Arial;font-size:10pt}body td.mxPopupMenuIcon{background-color:#fff;padding:0}body tr.mxPopupMenuItemHover{background-color:#eee;color:#000}table.mxPopupMenu hr{border-top:1px solid #ccc}table.mxPopupMenu tr{font-size:4pt}.flowchart-container{position:relative;width:100%;height:100%;overflow:auto}.flowChart-muti-header{display:flex;align-items:center;padding:0 16px}.flowchart-header-button{cursor:pointer;color:#848c9a}.flowchart-header-button:hover{color:#529dff}.flowchart-right-pane{margin:0 10px;width:30%}.flowchart-buttons-padding{padding:0 0 10px 10px}.flowchart-sequence-color{display:flex;align-items:center;padding-left:8px}.flowchart-color-div{color:#fff;border-radius:0;display:block;width:15px;height:15px;margin-right:8px}.color-gey{background:#595959}.color-yellow{background:#f59c24}.color-blue{background:#59a1ff}.color-red{background:#ff4040}']}]}],B.ctorParameters=function(){return[{type:n.DomSanitizer},{type:w},{type:p.ChangeDetectorRef},{type:p.Injector},{type:L,decorators:[{type:p.Optional}]}]},B.propDecorators={cls:[{type:p.HostBinding,args:["class"]}],iframe:[{type:p.ViewChild,args:["iframe"]}],modalHide:[{type:p.Output}],theme:[{type:p.Input}],processForecastPayload:[{type:p.Input}],mode:[{type:p.Input}],ProcInstId:[{type:p.Input}],DataId:[{type:p.Input}],ProcInstList:[{type:p.Input}],flowChartContainerER:[{type:p.ViewChild,args:["flowChartContainer"]}],flowChartContainerVCR:[{type:p.ViewChild,args:["flowChartContainer",{read:p.ViewContainerRef}]}]};var T=B;function B(t,e,n,i,o){var r;this.sanitizer=t,this.service=e,this.changeDetector=n,this.injector=i,this.chartService=o,this.cls="d-flex flex-fill h-100",this.modalHide=new p.EventEmitter,this.fcHtml=window.document.location.origin+"/platform/runtime/wf/web/designer/flowchart.html?v=20221111",this.theme="viewFlowChart",this._mode="complete",this.modeButton=this.service.getI18nValue("static.flowchart.simulation"),this.typeList=[{value:"complete",text:this.service.getI18nValue("static.flowchart.complete")},{value:"simulation",text:this.service.getI18nValue("static.flowchart.simulation")}],this.localeId="zh-CHS",this.procInstList=[],this.flowChartContainerClientSize={},this.sequenceColorList=[{colorClass:"color-gey",label:"completed"},{colorClass:"color-yellow",label:"calculate"},{colorClass:"color-blue",label:"default"},{colorClass:"color-red",label:"suspend"}],this.message=this.injector.get(u.MessagerService),this.frameworkSvc=this.injector.get(s.FrameworkService),this.localeId=this.injector.get(p.LOCALE_ID,null)||this.localeId,this.loading=this.injector.get(h.LoadingService,null),null==this.loading&&(r=p.ReflectiveInjector.resolveAndCreate([h.LoadingService],this.injector),this.loading=r.get(h.LoadingService,null)),this.notify=this.injector.get(f.NotifyService,null),null==this.notify&&(r=p.ReflectiveInjector.resolveAndCreate([f.NotifyService],this.injector),this.notify=r.get(f.NotifyService,null))}N.prototype.transform=function(t,e){void 0===e&&(e="");t=this.service.getI18nValue(t);return t||e},N.decorators=[{type:p.Pipe,args:[{name:"translate"}]}],N.ctorParameters=function(){return[{type:w}]};var A=N;function N(t){this.service=t}O.decorators=[{type:p.NgModule,args:[{declarations:[T,A],imports:[o.LayoutModule,i.CommonModule,k.FarrisDialogModule,u.MessagerModule.forRoot({width:500}),R.FarrisSectionModule,j.WfApprovalLogsModule,q.ComboListModule,r.ReactiveFormsModule,r.FormsModule,_.FDropdownDirectiveTypeModule,H.DatagridModule,f.NotifyModule,h.LoadingModule,V.FarrisTabsModule.forRoot(),G.SplitterModule],exports:[T],providers:[d.HttpService,w,L],entryComponents:[T]}]}];o=O;function O(){}i=function(){};t.UiFlowchartService=w,t.UIFlowchartComponent=T,t.UiFlowchartModule=o,t.WFFlowchartService=L,t.TranslatePipe=A,t.ForecastProcessPayload=i,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-wf-ui-flowchart.umd.min.js.map
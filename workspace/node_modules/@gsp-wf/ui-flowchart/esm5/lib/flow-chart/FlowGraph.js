/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { mxGraph, mxEvent, mxConstants, mxPoint, mxRectangle, mxUtils, mxGeometry } from "@edp-pmf/mxgraph-ts";
import { EndEvent, BpmnModel, Process, BPMNDiagram, SequenceFlow, FlowNode, Node, Edge, FlowNodeState, SequenceFlowState } from "@edp-pmf/bpmn-model";
import { StartActivity, UserActivity, CallActivitySubProcess, AutoActivity, IntermediateCatchEventImpl, OperationActivity, MessageActivity, NotifyActivity, AifCreationBillActivity } from "@gsp-wf/wf-process-model";
import { Cell } from "./entity/Cell";
var FlowGraph = /** @class */ (function (_super) {
    tslib_1.__extends(FlowGraph, _super);
    function FlowGraph(container, cellStyleConfig) {
        var _this = _super.call(this, container) || this;
        _this.scrollTileSize = new mxRectangle(0, 0, 400, 600);
        _this.cellStyleConfig = {
            edgeStyleDic: {},
            shapeStyleDic: {},
        };
        _this.actList = [];
        _this.transInsList = [];
        _this.rootPath = ''; //基路径
        //基路径
        /**
         * 当前语言
         */
        _this.langCode = ((/** @type {?} */ (window))).gspframeworkService && ((/** @type {?} */ (window))).gspframeworkService.rtf.language.getLanguageCode() || localStorage.getItem('languageCode') || 'zh-CHS';
        //获取基路径
        try {
            _this.rootPath = ((/** @type {?} */ (window))).gspframeworkService.common.getBasePath.get();
        }
        catch (error) {
        }
        _this.cellStyleConfig = cellStyleConfig ? cellStyleConfig : _this.cellStyleConfig;
        _this.autoScroll = false;
        _this.autoExtend = true;
        _this.pageVisible = false;
        //this.panningHandler.ignoreCell = true;
        //this.setPanning(true);
        _this.setCellsSelectable(true);
        _this.setDisconnectOnMove(false);
        //节点不可改变大小
        _this.setCellsResizable(false);
        //cell是否可以连线
        _this.setConnectable(false);
        //禁止操作
        _this.setEnabled(true);
        //设置cell文本是否可移动
        _this.setVertexLabelsMovable(false);
        _this.setCellsLocked(true);
        //不允许图上存在没有连接活动节点的线（防止拖动线连接点导致失去连接）,还没有找到不允许拖动连接控制点的属性
        _this.setAllowDanglingEdges(false);
        mxEvent.disableContextMenu(container);
        // 设置默认样式
        _this.setDefaultStyles();
        return _this;
    }
    /**
     * 重写创建节点对象方法
     * @param parent
     * @param id
     * @param value
     * @param x
     * @param y
     * @param width
     * @param height
     * @param style
     * @param relative
     * @returns
     */
    /**
     * 重写创建节点对象方法
     * @param {?} parent
     * @param {?} id
     * @param {?} value
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?} style
     * @param {?} relative
     * @return {?}
     */
    FlowGraph.prototype.createVertex = /**
     * 重写创建节点对象方法
     * @param {?} parent
     * @param {?} id
     * @param {?} value
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?} style
     * @param {?} relative
     * @return {?}
     */
    function (parent, id, value, x, y, width, height, style, relative) {
        // Creates the geometry for the vertex
        /** @type {?} */
        var geometry = new mxGeometry(x, y, width, height);
        geometry.relative = (relative != null) ? relative : false;
        // Creates the vertex
        /** @type {?} */
        var vertex = new Cell(value, geometry, style);
        vertex.setId(id);
        vertex.setVertex(true);
        vertex.setConnectable(true);
        return vertex;
    };
    /**
     * 重写创建边对象方法
     * @param parent
     * @param id
     * @param value
     * @param source
     * @param target
     * @param style
     * @returns
     */
    /**
     * 重写创建边对象方法
     * @param {?} parent
     * @param {?} id
     * @param {?} value
     * @param {?} source
     * @param {?} target
     * @param {?} style
     * @return {?}
     */
    FlowGraph.prototype.createEdge = /**
     * 重写创建边对象方法
     * @param {?} parent
     * @param {?} id
     * @param {?} value
     * @param {?} source
     * @param {?} target
     * @param {?} style
     * @return {?}
     */
    function (parent, id, value, source, target, style) {
        // Creates the edge
        /** @type {?} */
        var edge = new Cell(value, new mxGeometry(), style);
        edge.setId(id);
        edge.setEdge(true);
        edge.geometry.relative = true;
        return edge;
    };
    /**
     * 设置默认样式
     */
    /**
     * 设置默认样式
     * @return {?}
     */
    FlowGraph.prototype.setDefaultStyles = /**
     * 设置默认样式
     * @return {?}
     */
    function () {
        /** @type {?} */
        var styleSheet = this.getStylesheet();
        // 节点默认样式
        /** @type {?} */
        var vertexStyle = styleSheet.getDefaultVertexStyle();
        vertexStyle[mxConstants.STYLE_SHAPE] = mxConstants.SHAPE_IMAGE;
        vertexStyle[mxConstants.STYLE_VERTICAL_LABEL_POSITION] = mxConstants.ALIGN_BOTTOM;
        vertexStyle[mxConstants.STYLE_FONTSIZE] = 12;
        vertexStyle[mxConstants.STYLE_FONTFAMILY] = 'Helvetica';
        vertexStyle[mxConstants.STYLE_FONTCOLOR] = "#333";
        // 连线样式默认为正交
        /** @type {?} */
        var edgeStyle = styleSheet.getDefaultEdgeStyle();
        edgeStyle[mxConstants.STYLE_SOURCE_PORT] = 'e';
        edgeStyle[mxConstants.STYLE_TARGET_PORT] = 'w';
        edgeStyle[mxConstants.STYLE_EDGE] = mxConstants.EDGESTYLE_ORTHOGONAL;
        edgeStyle[mxConstants.STYLE_ROUNDED] = 1;
        edgeStyle[mxConstants.STYLE_STROKECOLOR] = '#6482B9';
        edgeStyle[mxConstants.STYLE_FONTSIZE] = 12;
        edgeStyle[mxConstants.STYLE_FONTFAMILY] = 'Helvetica';
    };
    /**
     * 创建无限大画布
     */
    /**
     * 创建无限大画布
     * @return {?}
     */
    FlowGraph.prototype.createInfiniteCanvas = /**
     * 创建无限大画布
     * @return {?}
     */
    function () {
        var _this = this;
        this.getPagePadding = (/**
         * @return {?}
         */
        function () {
            return new mxPoint(Math.max(0, Math.round(_this.container.offsetWidth - 34)), Math.max(0, Math.round(_this.container.offsetHeight - 34)));
        });
        this.getScrollTileSize = (/**
         * @return {?}
         */
        function () {
            if (_this.scrollTileSize == null) {
                _this.scrollTileSize = new mxRectangle(0, 0, 400, 600);
            }
            return _this.scrollTileSize;
        });
        this.getPageSize = (/**
         * @return {?}
         */
        function () {
            return (_this.pageVisible) ? new mxRectangle(0, 0, _this.pageFormat.width * _this.pageScale, _this.pageFormat.height * _this.pageScale) : _this.getScrollTileSize();
        });
        this.getPageLayout = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var size = (_this.pageVisible) ? _this.getPageSize() : _this.getScrollTileSize();
            /** @type {?} */
            var bounds = _this.getGraphBounds();
            if (bounds.width == 0 || bounds.height == 0) {
                return new mxRectangle(0, 0, 1, 1);
            }
            else {
                // Computes untransformed graph bounds
                /** @type {?} */
                var x = Math.ceil(bounds.x / _this.view.scale - _this.view.translate.x);
                /** @type {?} */
                var y = Math.ceil(bounds.y / _this.view.scale - _this.view.translate.y);
                /** @type {?} */
                var w = Math.floor(bounds.width / _this.view.scale);
                /** @type {?} */
                var h = Math.floor(bounds.height / _this.view.scale);
                /** @type {?} */
                var x0 = Math.floor(x / size.width);
                /** @type {?} */
                var y0 = Math.floor(y / size.height);
                /** @type {?} */
                var w0 = Math.ceil((x + w) / size.width) - x0;
                /** @type {?} */
                var h0 = Math.ceil((y + h) / size.height) - y0;
                return new mxRectangle(x0, y0, w0, h0);
            }
        });
        this.getPreferredPageSize = (/**
         * @param {?} bounds
         * @param {?} width
         * @param {?} height
         * @return {?}
         */
        function (bounds, width, height) {
            /** @type {?} */
            var pages = _this.getPageLayout();
            /** @type {?} */
            var size = _this.getPageSize();
            return new mxRectangle(0, 0, pages.width * size.width, pages.height * size.height);
        });
        // 重写画布大小变化后方法
        /** @type {?} */
        var graphSizeDidChange = this.sizeDidChange;
        this.sizeDidChange = (/**
         * @return {?}
         */
        function () {
            if (_this.container != null && mxUtils.hasScrollbars(_this.container)) {
                /** @type {?} */
                var pages = _this.getPageLayout();
                /** @type {?} */
                var pad = _this.getPagePadding();
                /** @type {?} */
                var size = _this.getPageSize();
                // Updates the minimum graph size
                /** @type {?} */
                var minw = Math.ceil(2 * pad.x / _this.view.scale + pages.width * size.width);
                /** @type {?} */
                var minh = Math.ceil(2 * pad.y / _this.view.scale + pages.height * size.height);
                /** @type {?} */
                var min = _this.minimumGraphSize;
                // LATER: Fix flicker of scrollbar size in IE quirks mode
                // after delayed call in window.resize event handler
                if (min == null || min.width != minw || min.height != minh) {
                    _this.minimumGraphSize = new mxRectangle(0, 0, minw, minh);
                }
                // Updates auto-translate to include padding and graph size
                /** @type {?} */
                var dx = pad.x / _this.view.scale - pages.x * size.width;
                /** @type {?} */
                var dy = pad.y / _this.view.scale - pages.y * size.height;
                if (!_this.autoTranslate && (_this.view.translate.x != dx || _this.view.translate.y != dy)) {
                    _this.autoTranslate = true;
                    ((/** @type {?} */ (_this.view))).x0 = pages.x;
                    ((/** @type {?} */ (_this.view))).y0 = pages.y;
                    /** @type {?} */
                    var tx = _this.view.translate.x;
                    /** @type {?} */
                    var ty = _this.view.translate.y;
                    _this.view.setTranslate(dx, dy);
                    _this.container.scrollLeft += (dx - tx) * _this.view.scale;
                    _this.container.scrollTop += (dy - ty) * _this.view.scale;
                    _this.autoTranslate = false;
                    return;
                }
                graphSizeDidChange.apply(_this, []);
            }
        });
        // 重写view获取背景页大小
        this.view.getBackgroundPageBounds = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var layout = _this.getPageLayout();
            /** @type {?} */
            var page = _this.getPageSize();
            return new mxRectangle(_this.view.scale * (_this.view.translate.x + layout.x * page.width), _this.view.scale * (_this.view.translate.y + layout.y * page.height), _this.view.scale * layout.width * page.width, _this.view.scale * layout.height * page.height);
        });
        // 重写view validate方法
        /** @type {?} */
        var graphViewValidate = this.view.validate;
        this.view.validate = (/**
         * @param {?=} cell
         * @return {?}
         */
        function (cell) {
            if (_this.container != null && mxUtils.hasScrollbars(_this.container)) {
                /** @type {?} */
                var pad = _this.getPagePadding();
                /** @type {?} */
                var size = _this.getPageSize();
                /** @type {?} */
                var tx = _this.view.translate.x;
                /** @type {?} */
                var ty = _this.view.translate.y;
                _this.view.translate.x = pad.x / _this.view.scale - (((/** @type {?} */ (_this.view))).x0 || 0) * size.width;
                _this.view.translate.y = pad.y / _this.view.scale - (((/** @type {?} */ (_this.view))).y0 || 0) * size.height;
            }
            graphViewValidate.apply(_this.view, [cell]);
        });
    };
    /**
     * 创建BpmnModel
     */
    /**
     * 创建BpmnModel
     * @return {?}
     */
    FlowGraph.prototype.createBpmnModel = /**
     * 创建BpmnModel
     * @return {?}
     */
    function () {
        /** @type {?} */
        var bpmnModel = new BpmnModel();
        bpmnModel.TargetNamespace = "Default_Namespace";
        bpmnModel.DefaultProcess = new Process(bpmnModel);
        bpmnModel.DefaultDiagram = new BPMNDiagram(bpmnModel);
        bpmnModel.DefaultDiagram.BpmnPlane.BpmnElementId = bpmnModel.DefaultProcess.Id;
        return bpmnModel;
    };
    /**
     * 加载BpmnModel并画图
     */
    /**
     * 加载BpmnModel并画图
     * @param {?} json
     * @return {?}
     */
    FlowGraph.prototype.loadBpmnModel = /**
     * 加载BpmnModel并画图
     * @param {?} json
     * @return {?}
     */
    function (json) {
        this.removeCells(this.getChildCells(this.getDefaultParent()));
        this.bpmnModel = this.createBpmnModel();
        this.bpmnModel.LoadFromJson(json);
        this.drawBpmnGraph(this.bpmnModel);
    };
    /**
     * 重新加载BpmnModel并画图
     * @param json
     */
    /**
     * 重新加载BpmnModel并画图
     * @param {?=} json
     * @return {?}
     */
    FlowGraph.prototype.reloadBpmnModel = /**
     * 重新加载BpmnModel并画图
     * @param {?=} json
     * @return {?}
     */
    function (json) {
        this.removeCells(this.getChildCells(this.getDefaultParent()));
        if (json) {
            this.loadBpmnModel(json);
        }
        else {
            this.drawBpmnGraph(this.bpmnModel);
        }
    };
    /**
     * 根据BpmnModel画图
     */
    /**
     * 根据BpmnModel画图
     * @param {?} bpmnModel
     * @return {?}
     */
    FlowGraph.prototype.drawBpmnGraph = /**
     * 根据BpmnModel画图
     * @param {?} bpmnModel
     * @return {?}
     */
    function (bpmnModel) {
        var _a = this.buildFlowDiagDict(bpmnModel), nodeDict = _a.nodeDict, edgeDict = _a.edgeDict;
        /** @type {?} */
        var flowDict = this.buildFlowDict(bpmnModel);
        this.drawNodeCells(flowDict, nodeDict);
        this.drawEdgeCells(flowDict, edgeDict);
        this.getModel().beginUpdate();
        if (this.mode === 'simulation') {
            this.drawInterceptGraph(flowDict, nodeDict, edgeDict);
            this.addJumpEdges(flowDict);
        }
        this.getModel().endUpdate();
    };
    /**
     * @private
     * @param {?} flowDict
     * @param {?} nodeDict
     * @param {?} edgeDict
     * @return {?}
     */
    FlowGraph.prototype.drawInterceptGraph = /**
     * @private
     * @param {?} flowDict
     * @param {?} nodeDict
     * @param {?} edgeDict
     * @return {?}
     */
    function (flowDict, nodeDict, edgeDict) {
        var _this = this;
        /** @type {?} */
        var firstAct = this.findFirstStartActivityInstance(this.actList);
        // todo：此处待修复
        /** @type {?} */
        var endActDef;
        for (var key in flowDict) {
            if (flowDict[key] instanceof EndEvent) {
                endActDef = (/** @type {?} */ (flowDict[key]));
            }
        }
        if (firstAct) {
            /** @type {?} */
            var endActiInstList = this.findEndActiInstList(firstAct, this.actList, this.transInsList);
            endActiInstList.forEach(((/**
             * @param {?} endActiInst
             * @return {?}
             */
            function (endActiInst) {
                if (endActiInst.activityDefinitionId !== endActDef.Id) {
                    _this.drawNextFlowChart(endActiInst.activityDefinitionId, nodeDict, edgeDict);
                }
            })));
        }
    };
    /**
     * @param {?} flowDict
     * @return {?}
     */
    FlowGraph.prototype.addJumpEdges = /**
     * @param {?} flowDict
     * @return {?}
     */
    function (flowDict) {
        var e_1, _a;
        /** @type {?} */
        var nodeCells = (/** @type {?} */ ((this.getChildCells(this.getDefaultParent(), true) || [])));
        /** @type {?} */
        var noIncomingNodes = this.findNoIncomingNodes(nodeCells);
        var _loop_1 = function (node) {
            /** @type {?} */
            var actInst = this_1.actList.filter((/**
             * @param {?} a
             * @return {?}
             */
            function (a) { return a.activityDefinitionId === node.flowElement.Id; }))[0];
            /** @type {?} */
            var cellId = actInst.precursorActivityDefinitionId + '_' + actInst.activityDefinitionId;
            /** @type {?} */
            var source = nodeCells.find((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                return it.flowElement && it.flowElement.Id === actInst.precursorActivityDefinitionId;
            }));
            /** @type {?} */
            var target = nodeCells.find((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                return it.flowElement && it.flowElement.Id === actInst.activityDefinitionId;
            }));
            /** @type {?} */
            var map = new Map();
            map.set('jump', true);
            /** @type {?} */
            var style = this_1.getEdgeStyle(null, null, map);
            /** @type {?} */
            var cell = (/** @type {?} */ (this_1.insertEdge(this_1.getDefaultParent(), cellId, '', source, target, style)));
            if (cell !== null) {
                cell.source = source;
                cell.target = target;
                cell.geometry.points = [
                // new mxPoint(source.geometry.x+ source.geometry.width/2, target.geometry.y+target.geometry.height/2)
                ];
                console.log(cell);
                this_1.moveCells([cell], undefined, undefined, undefined, this_1.getDefaultParent());
            }
        };
        var this_1 = this;
        try {
            for (var noIncomingNodes_1 = tslib_1.__values(noIncomingNodes), noIncomingNodes_1_1 = noIncomingNodes_1.next(); !noIncomingNodes_1_1.done; noIncomingNodes_1_1 = noIncomingNodes_1.next()) {
                var node = noIncomingNodes_1_1.value;
                _loop_1(node);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (noIncomingNodes_1_1 && !noIncomingNodes_1_1.done && (_a = noIncomingNodes_1.return)) _a.call(noIncomingNodes_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /**
     * 画节点
     */
    /**
     * 画节点
     * @param {?} flowDict
     * @param {?} nodeDict
     * @param {?=} additional
     * @return {?}
     */
    FlowGraph.prototype.drawNodeCells = /**
     * 画节点
     * @param {?} flowDict
     * @param {?} nodeDict
     * @param {?=} additional
     * @return {?}
     */
    function (flowDict, nodeDict, additional) {
        var _this = this;
        if (additional === void 0) { additional = false; }
        Object.keys(nodeDict).forEach((/**
         * @param {?} bpmnModelElementId
         * @return {?}
         */
        function (bpmnModelElementId) {
            /** @type {?} */
            var flowElt = flowDict[bpmnModelElementId];
            /** @type {?} */
            var diagElt = (/** @type {?} */ (nodeDict[bpmnModelElementId]));
            if (flowElt == null) {
                return;
            }
            _this.drawNodeCell(flowElt, diagElt, additional);
        }));
    };
    /**
     * 画单个节点
     * @param flowElt
     * @param diagElt
     * @param additional
     */
    /**
     * 画单个节点
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @return {?}
     */
    FlowGraph.prototype.drawNodeCell = /**
     * 画单个节点
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @return {?}
     */
    function (flowElt, diagElt, additional) {
        /** @type {?} */
        var style = this.getVertexStyle(flowElt, diagElt, additional);
        /** @type {?} */
        var cell = null;
        /** @type {?} */
        var label = "";
        if (flowElt != null) {
            label = flowElt.Name;
            if (flowElt.NameLanguage && flowElt.NameLanguage[this.langCode] != null) {
                label = flowElt.NameLanguage[this.langCode];
            }
        }
        if (this.mode === 'simulation') {
            if (this.actList.findIndex((/**
             * @param {?} a
             * @return {?}
             */
            function (a) { return a.activityDefinitionId === flowElt.Id; })) > -1) {
                cell = (/** @type {?} */ (this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
            }
            else if (additional) {
                cell = (/** @type {?} */ (this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
            }
        }
        else {
            cell = (/** @type {?} */ (this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
        }
        if (cell == null) {
            return;
        }
        // const cell = this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style) as Cell;
        cell.flowElement = flowElt;
        cell.diagramElement = diagElt;
        this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
    };
    /**
     * 画连线
     */
    /**
     * 画连线
     * @param {?} flowDict
     * @param {?} edgeDict
     * @param {?=} additional
     * @param {?=} cut
     * @return {?}
     */
    FlowGraph.prototype.drawEdgeCells = /**
     * 画连线
     * @param {?} flowDict
     * @param {?} edgeDict
     * @param {?=} additional
     * @param {?=} cut
     * @return {?}
     */
    function (flowDict, edgeDict, additional, cut) {
        var _this = this;
        if (additional === void 0) { additional = false; }
        if (cut === void 0) { cut = false; }
        Object.keys(edgeDict).forEach((/**
         * @param {?} bpmnModelElementId
         * @return {?}
         */
        function (bpmnModelElementId) {
            /** @type {?} */
            var flowElt = (/** @type {?} */ (flowDict[bpmnModelElementId]));
            /** @type {?} */
            var diagElt = (/** @type {?} */ (edgeDict[bpmnModelElementId]));
            if (flowElt == null) {
                return;
            }
            _this.drawEdgeCell(flowElt, diagElt, additional, cut);
        }));
    };
    /**
     * @private
     * @param {?} flowDict
     * @param {?} sourceId
     * @param {?} targetId
     * @return {?}
     */
    FlowGraph.prototype.judgeConnectBetweenTwoNodes = /**
     * @private
     * @param {?} flowDict
     * @param {?} sourceId
     * @param {?} targetId
     * @return {?}
     */
    function (flowDict, sourceId, targetId) {
        var e_2, _a;
        /** @type {?} */
        var source = (/** @type {?} */ (flowDict[sourceId]));
        /** @type {?} */
        var outGoings = source.Outgoings;
        if (!outGoings || outGoings.length === 0) {
            return false;
        }
        try {
            for (var outGoings_1 = tslib_1.__values(outGoings), outGoings_1_1 = outGoings_1.next(); !outGoings_1_1.done; outGoings_1_1 = outGoings_1.next()) {
                var outGoing = outGoings_1_1.value;
                /** @type {?} */
                var sequenceFlow = (/** @type {?} */ (flowDict[outGoing]));
                if (sequenceFlow.TargetRef === targetId) {
                    return true;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (outGoings_1_1 && !outGoings_1_1.done && (_a = outGoings_1.return)) _a.call(outGoings_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return false;
    };
    /**
     * 画单条连线
     * @param flowElt
     * @param diagElt
     * @param additional
     * @param cut
     * @returns
     */
    /**
     * 画单条连线
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    FlowGraph.prototype.drawEdgeCell = /**
     * 画单条连线
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    function (flowElt, diagElt, additional, cut) {
        // 获取已插入的节点元素
        /** @type {?} */
        var nodeCells = (/** @type {?} */ ((this.getChildCells(this.getDefaultParent(), true) || [])));
        /** @type {?} */
        var source = nodeCells.find((/**
         * @param {?} it
         * @return {?}
         */
        function (it) {
            return it.flowElement && it.flowElement.Id === flowElt.SourceRef;
        }));
        /** @type {?} */
        var target = nodeCells.find((/**
         * @param {?} it
         * @return {?}
         */
        function (it) {
            return it.flowElement && it.flowElement.Id === flowElt.TargetRef;
        }));
        /** @type {?} */
        var map = new Map();
        map.set('additional', additional);
        map.set('cut', cut);
        /** @type {?} */
        var style = this.getEdgeStyle(flowElt, diagElt, map);
        /** @type {?} */
        var cell = null;
        /** @type {?} */
        var label = "";
        if (flowElt != null) {
            label = flowElt.Name;
            if (flowElt.NameLanguage && flowElt.NameLanguage[this.langCode] != null) {
                label = flowElt.NameLanguage[this.langCode];
            }
        }
        if (this.mode === 'simulation') {
            if (this.transInsList.findIndex((/**
             * @param {?} a
             * @return {?}
             */
            function (a) { return a.sourceActivityDefinitionId === flowElt.SourceRef
                && a.destinationActivityDefinitionId === flowElt.TargetRef; })) > -1) {
                cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
            }
            else if (additional || cut) {
                cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
            }
        }
        else {
            cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
        }
        if (cell == null) {
            return;
        }
        // const cell = this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style) as Cell;
        // cell.geometry.relative = true;
        cell.flowElement = flowElt;
        cell.diagramElement = diagElt;
        cell.source = source;
        cell.target = target;
        cell.geometry.points = cell.geometry.points || [];
        // 判断是否为旧版本连线
        if (this.isOldBpmnEdge(diagElt)) {
            for (var i = 2; i < diagElt.Points.length; i++) {
                /** @type {?} */
                var pt = diagElt.Points[i];
                cell.geometry.points.push(new mxPoint(pt.X, pt.Y));
            }
            // 此行代码执行后可获取mxCellState
            this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
            //按坐标插入label
            /** @type {?} */
            var state = this.view.getState(cell);
            if (diagElt.BpmnLabel && state) {
                if (diagElt.BpmnLabel.Bounds.X === 0 && diagElt.BpmnLabel.Bounds.Y === 0) {
                    return;
                }
                /** @type {?} */
                var x = diagElt.BpmnLabel.Bounds.X + (state.x - state.paintBounds.x);
                /** @type {?} */
                var y = diagElt.BpmnLabel.Bounds.Y + (state.y - state.paintBounds.y);
                /** @type {?} */
                var edgeHandler = this.createEdgeHandler(state, undefined);
                edgeHandler.moveLabel(state, x, y);
                edgeHandler.destroy();
            }
        }
        else {
            for (var i = 1; i < diagElt.Points.length - 1; i++) {
                /** @type {?} */
                var pt = diagElt.Points[i];
                cell.geometry.points.push(new mxPoint(pt.X, pt.Y));
            }
            // 此行代码执行后可获取mxCellState
            this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
            //按坐标插入label
            /** @type {?} */
            var state = this.view.getState(cell);
            /** @type {?} */
            var scale = this.view.getScale();
            /** @type {?} */
            var translate = this.view.getTranslate();
            if (diagElt.BpmnLabel && state) {
                if (diagElt.BpmnLabel.Bounds.X === 0 && diagElt.BpmnLabel.Bounds.Y === 0) {
                    return;
                }
                /** @type {?} */
                var x = diagElt.BpmnLabel.Bounds.X * scale + translate.x;
                /** @type {?} */
                var y = diagElt.BpmnLabel.Bounds.Y * scale + translate.y;
                /** @type {?} */
                var edgeHandler = this.createEdgeHandler(state, undefined);
                edgeHandler.moveLabel(state, x, y);
                edgeHandler.destroy();
            }
        }
    };
    /**
     * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
     */
    /**
     * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
     * @param {?} bpmnModel
     * @return {?}
     */
    FlowGraph.prototype.buildFlowDict = /**
     * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
     * @param {?} bpmnModel
     * @return {?}
     */
    function (bpmnModel) {
        /** @type {?} */
        var flowDict = bpmnModel.DefaultProcess.GetFlowElements();
        return flowDict;
    };
    /**
     * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
     */
    /**
     * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
     * @param {?} bpmnModel
     * @return {?}
     */
    FlowGraph.prototype.buildFlowDiagDict = /**
     * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
     * @param {?} bpmnModel
     * @return {?}
     */
    function (bpmnModel) {
        /** @type {?} */
        var nodeDict = {};
        /** @type {?} */
        var edgeDict = {};
        /** @type {?} */
        var diagramElts = (/** @type {?} */ (bpmnModel.DefaultDiagram.BpmnPlane.GetDiagramElements()));
        diagramElts && diagramElts.forEach((/**
         * @param {?} elt
         * @return {?}
         */
        function (elt) {
            if (elt instanceof Node) {
                nodeDict[elt.BpmnElementId] = elt;
            }
            else if (elt instanceof Edge) {
                edgeDict[elt.BpmnElementId] = elt;
            }
        }));
        return {
            nodeDict: nodeDict,
            edgeDict: edgeDict,
        };
    };
    /**
     * 判断是否为旧版本BPMNEdge
     *
     * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
     * 新版本从起点到终点按顺序记录每一个点坐标
     * @param bpmnEdge
     * @returns
     */
    /**
     * 判断是否为旧版本BPMNEdge
     *
     * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
     * 新版本从起点到终点按顺序记录每一个点坐标
     * @param {?} bpmnEdge
     * @return {?}
     */
    FlowGraph.prototype.isOldBpmnEdge = /**
     * 判断是否为旧版本BPMNEdge
     *
     * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
     * 新版本从起点到终点按顺序记录每一个点坐标
     * @param {?} bpmnEdge
     * @return {?}
     */
    function (bpmnEdge) {
        if (bpmnEdge.Points.length >= 2) {
            /** @type {?} */
            var pt1 = bpmnEdge.Points[0];
            /** @type {?} */
            var pt2 = bpmnEdge.Points[1];
            if (pt1.X == 0 && pt1.Y == 0 && pt2.X == 0 && pt2.Y == 0) {
                return true;
            }
        }
        return false;
    };
    /**
     * 获取节点样式
     * @param flowElt
     * @param diagElt
     * @param additional
     * @returns
     */
    /**
     * 获取节点样式
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @return {?}
     */
    FlowGraph.prototype.getVertexStyle = /**
     * 获取节点样式
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @return {?}
     */
    function (flowElt, diagElt, additional) {
        /** @type {?} */
        var activityInstanceSlims = this.actList;
        /** @type {?} */
        var stateShapeStyle = null;
        // 特殊处理,业务活动要单独赋成人工操作类型的样式
        // if (flowElt.ClrTypeID === UserActivity.Clr_Type_ID) {
        //   stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[flowElt.ClrTypeID];
        // } else if (flowElt.ClrTypeID === OperationActivity.Clr_Type_ID) {
        //   stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[OperationActivity.Clr_Type_ID];
        // }
        if (flowElt instanceof UserActivity && flowElt.BizActivityID !== '') {
            stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[OperationActivity.Clr_Type_ID];
        }
        else {
            stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[flowElt.ClrTypeID];
        }
        if (stateShapeStyle == null) {
            return this.getVertexStyleOld(flowElt, additional);
        }
        /** @type {?} */
        var img = stateShapeStyle[FlowNodeState.Default] && stateShapeStyle[FlowNodeState.Default].image;
        if (!additional) {
            /** @type {?} */
            var acts = activityInstanceSlims.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.activityDefinitionId === flowElt.Id; }));
            if (acts && acts.length > 0) {
                if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                function (act) { return act.state === 'RUNNING'; })).length > 0) {
                    if (stateShapeStyle[FlowNodeState.Running]) {
                        img = stateShapeStyle[FlowNodeState.Running].image;
                    }
                }
                else if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                function (act) { return act.state === 'COMPLETED'; })).length > 0) {
                    if (stateShapeStyle[FlowNodeState.Completed]) {
                        img = stateShapeStyle[FlowNodeState.Completed].image;
                    }
                }
                else if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                function (act) { return act.state === 'TERMINATED'; })).length > 0) {
                    if (stateShapeStyle[FlowNodeState.Terminated]) {
                        img = stateShapeStyle[FlowNodeState.Terminated].image;
                    }
                }
            }
        }
        return img == null ? null : 'image=' + this.rootPath + img;
    };
    /**
     * 旧版diagramElement未存储样式信息
     * @param flowElt
     * @param additional
     * @returns
     */
    /**
     * 旧版diagramElement未存储样式信息
     * @param {?} flowElt
     * @param {?} additional
     * @return {?}
     */
    FlowGraph.prototype.getVertexStyleOld = /**
     * 旧版diagramElement未存储样式信息
     * @param {?} flowElt
     * @param {?} additional
     * @return {?}
     */
    function (flowElt, additional) {
        /** @type {?} */
        var style;
        switch (flowElt.ClrTypeID) {
            //结束事件
            case "bpmn.EndEvent":
                style = 'end';
                break;
            //流程开始活动节点
            case StartActivity.Clr_Type_ID:
                style = 'start';
                break;
            // 业务活动节点
            case UserActivity.Clr_Type_ID:
                if (((/** @type {?} */ (flowElt))).BizActivityID) {
                    style = 'bizActivity';
                }
                else {
                    style = 'approval';
                }
                break;
            // 排他网关
            case 'bpmn.ExclusiveGateway':
                style = 'ExclusiveGateway';
                break;
            //并行网关
            case 'bpmn.ParallelGateway':
                style = 'ParallelGateway';
                break;
            case CallActivitySubProcess.Clr_Type_ID:
                style = 'sub';
                break;
            case AutoActivity.Clr_Type_ID:
                style = 'auto';
                break;
            case IntermediateCatchEventImpl.Clr_Type_ID:
                style = 'catchEvent';
                break;
            case OperationActivity.Clr_Type_ID:
                style = 'bizActivity';
                break;
            case MessageActivity.Clr_Type_ID:
                style = 'message';
                break;
            case NotifyActivity.Clr_Type_ID:
                style = 'notify';
                break;
            case AifCreationBillActivity.Clr_Type_ID:
                style = 'aifCreationActivity';
                break;
            default:
                break;
        }
        return 'image=' + this.rootPath + '/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/' + style + this.getChartState(flowElt, additional) + ';';
    };
    /**
     * @param {?} flowElt
     * @param {?} additional
     * @return {?}
     */
    FlowGraph.prototype.getChartState = /**
     * @param {?} flowElt
     * @param {?} additional
     * @return {?}
     */
    function (flowElt, additional) {
        if (!additional) {
            /** @type {?} */
            var acts = this.actList.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.activityDefinitionId === flowElt.Id; }));
            if (acts && acts.length > 0) {
                if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                function (act) { return act.state === 'RUNNING'; })).length > 0) {
                    return '_light.gif';
                }
                else if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                function (act) { return act.state === 'COMPLETED'; })).length > 0
                    || acts.filter((/**
                     * @param {?} act
                     * @return {?}
                     */
                    function (act) { return act.state === 'TERMINATED'; })).length > 0) {
                    return '_gray.png';
                }
                else {
                    return '.png';
                }
            }
        }
        return '.png';
    };
    /**
     * 获取连线样式
     * @param flowElt
     * @param additional
     * @param cut
     * @returns
     */
    /**
     * 获取连线样式
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} parameters
     * @return {?}
     */
    FlowGraph.prototype.getEdgeStyle = /**
     * 获取连线样式
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} parameters
     * @return {?}
     */
    function (flowElt, diagElt, parameters) {
        if (parameters.get('jump')) {
            /** @type {?} */
            var style_1 = '';
            /** @type {?} */
            var stateEdgeStyle_1 = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic['bpmn.SequenceFlow'];
            if (stateEdgeStyle_1['jump']) {
                Object.keys(stateEdgeStyle_1['jump']).forEach((/**
                 * @param {?} key
                 * @return {?}
                 */
                function (key) {
                    style_1 += (key + "=" + stateEdgeStyle_1['jump'][key] + ";");
                }));
                return style_1;
            }
            return null;
        }
        else {
            /** @type {?} */
            var stateEdgeStyle_2 = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic[flowElt.ClrTypeID];
            if (stateEdgeStyle_2 == null) {
                return this.getEdgeStyleOld(flowElt, parameters.get('additional'), parameters.get('cut'));
            }
            /** @type {?} */
            var transitionInstanceSlims = this.transInsList;
            /** @type {?} */
            var style_2 = '';
            if (parameters.get('cut')) {
                if (stateEdgeStyle_2[SequenceFlowState.Cut]) {
                    Object.keys(stateEdgeStyle_2[SequenceFlowState.Cut]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    function (key) {
                        style_2 += (key + "=" + stateEdgeStyle_2[SequenceFlowState.Cut][key] + ";");
                    }));
                    return style_2;
                }
            }
            if (parameters.get('additional')) {
                if (stateEdgeStyle_2[SequenceFlowState.Add]) {
                    Object.keys(stateEdgeStyle_2[SequenceFlowState.Add]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    function (key) {
                        style_2 += (key + "=" + stateEdgeStyle_2[SequenceFlowState.Add][key] + ";");
                    }));
                    return style_2;
                }
            }
            /** @type {?} */
            var transIns = transitionInstanceSlims.filter((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.sourceActivityDefinitionId === flowElt.SourceRef && item.destinationActivityDefinitionId === flowElt.TargetRef; }));
            if (transIns && transIns.filter((/**
             * @param {?} t
             * @return {?}
             */
            function (t) { return t.state === 'COMPLETED'; })).length > 0) {
                if (stateEdgeStyle_2[SequenceFlowState.Completed]) {
                    Object.keys(stateEdgeStyle_2[SequenceFlowState.Completed]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    function (key) {
                        style_2 += (key + "=" + stateEdgeStyle_2[SequenceFlowState.Completed][key] + ";");
                    }));
                    return style_2;
                }
            }
            if (this.mode === 'simulation') {
                if (stateEdgeStyle_2[SequenceFlowState.Simulation]) {
                    Object.keys(stateEdgeStyle_2[SequenceFlowState.Simulation]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    function (key) {
                        style_2 += (key + "=" + stateEdgeStyle_2[SequenceFlowState.Simulation][key] + ";");
                    }));
                    return style_2;
                }
            }
            if (stateEdgeStyle_2[SequenceFlowState.Default]) {
                Object.keys(stateEdgeStyle_2[SequenceFlowState.Default]).forEach((/**
                 * @param {?} key
                 * @return {?}
                 */
                function (key) {
                    style_2 += (key + "=" + stateEdgeStyle_2[SequenceFlowState.Default][key] + ";");
                }));
            }
            return style_2;
        }
    };
    /**
     * 获取连线颜色
     * @param flowElt
     * @param diagElt
     * @param additional
     * @param cut
     * @returns
     */
    /**
     * 获取连线颜色
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    FlowGraph.prototype.getStrokeColor = /**
     * 获取连线颜色
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    function (flowElt, diagElt, additional, cut) {
        /** @type {?} */
        var transitionInstanceSlims = this.transInsList;
        /** @type {?} */
        var stateEdgeStyle = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic[flowElt.ClrTypeID];
        if (cut) {
            if (stateEdgeStyle[SequenceFlowState.Cut]) {
                return stateEdgeStyle[SequenceFlowState.Cut].strokeColor;
            }
        }
        if (additional) {
            if (stateEdgeStyle[SequenceFlowState.Add]) {
                return stateEdgeStyle[SequenceFlowState.Add].strokeColor;
            }
        }
        /** @type {?} */
        var transIns = transitionInstanceSlims.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.sourceActivityDefinitionId === flowElt.SourceRef && item.destinationActivityDefinitionId === flowElt.TargetRef; }));
        if (transIns && transIns.filter((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.state === 'COMPLETED'; })).length > 0) {
            if (stateEdgeStyle[SequenceFlowState.Completed]) {
                return stateEdgeStyle[SequenceFlowState.Completed].strokeColor;
            }
        }
        if (this.mode === 'simulation') {
            if (stateEdgeStyle[SequenceFlowState.Simulation]) {
                return stateEdgeStyle[SequenceFlowState.Simulation].strokeColor;
            }
        }
        return stateEdgeStyle[SequenceFlowState.Default].strokeColor;
    };
    /**
     * 旧版diagramElement未存储样式信息
     * @param flowElt
     * @param additional
     * @returns
     */
    /**
     * 旧版diagramElement未存储样式信息
     * @param {?} seq
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    FlowGraph.prototype.getEdgeStyleOld = /**
     * 旧版diagramElement未存储样式信息
     * @param {?} seq
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    function (seq, additional, cut) {
        if (cut) {
            return 'strokeColor=#FF4040';
        }
        if (additional) {
            return 'strokeColor=#59A1FF';
        }
        /** @type {?} */
        var transIns = this.transInsList.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.sourceActivityDefinitionId === seq.SourceRef && item.destinationActivityDefinitionId === seq.TargetRef; }));
        if (transIns && transIns.filter((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.state === 'COMPLETED'; })).length > 0) {
            return 'strokeColor=#595959;strokeWidth=2;';
        }
        if (this.mode === 'simulation') {
            return 'strokeColor=#f59c24;dashed=1;';
        }
        else {
            return 'strokeColor=#59A1FF;';
        }
    };
    /**
     * @param {?} actiDefId
     * @param {?} nodeDict
     * @param {?} edgeDict
     * @return {?}
     */
    FlowGraph.prototype.drawNextFlowChart = /**
     * @param {?} actiDefId
     * @param {?} nodeDict
     * @param {?} edgeDict
     * @return {?}
     */
    function (actiDefId, nodeDict, edgeDict) {
        var _this = this;
        var _a = this.findDrawFlowElementsByActDefId(actiDefId, this.bpmnModel), nextFlowNodeDict = _a.nextFlowNodeDict, nextSeqFlowDict = _a.nextSeqFlowDict;
        /** @type {?} */
        var actDef = (/** @type {?} */ (this.bpmnModel.DefaultProcess.GetFlowElement(actiDefId)));
        /** @type {?} */
        var outgoings = actDef.Outgoings;
        // 先插入节点
        Object.keys(nextFlowNodeDict).forEach((/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            /** @type {?} */
            var flowElt = nextFlowNodeDict[id];
            /** @type {?} */
            var diagElt = (/** @type {?} */ (nodeDict[flowElt.Id]));
            /** @type {?} */
            var cell = _this.getCellByFlowElementId(flowElt.Id);
            if (!cell) {
                _this.drawNodeCell(flowElt, diagElt, true);
            }
        }));
        // 再插入边
        Object.keys(nextSeqFlowDict).forEach((/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            /** @type {?} */
            var flowElt = nextSeqFlowDict[id];
            /** @type {?} */
            var diagElt = (/** @type {?} */ (edgeDict[flowElt.Id]));
            /** @type {?} */
            var cell = _this.getCellByFlowElementId(flowElt.Id);
            if (!cell) {
                if (outgoings.some((/**
                 * @param {?} o
                 * @return {?}
                 */
                function (o) { return o === flowElt.Id; }))) {
                    _this.drawEdgeCell(flowElt, diagElt, true, true);
                }
                else {
                    _this.drawEdgeCell(flowElt, diagElt, true, false);
                }
            }
        }));
    };
    /**
     * 根据flowElementId获取cell
     */
    /**
     * 根据flowElementId获取cell
     * @param {?} flowEltId
     * @param {?=} parent
     * @return {?}
     */
    FlowGraph.prototype.getCellByFlowElementId = /**
     * 根据flowElementId获取cell
     * @param {?} flowEltId
     * @param {?=} parent
     * @return {?}
     */
    function (flowEltId, parent) {
        parent = parent ? parent : this.getDefaultParent();
        /** @type {?} */
        var cells = this.getChildCells(parent);
        /** @type {?} */
        var cell = (/** @type {?} */ (cells.find((/**
         * @param {?} it
         * @return {?}
         */
        function (it) {
            if (it instanceof Cell) {
                return it.flowElement && it.flowElement.Id == flowEltId;
            }
            else {
                return false;
            }
        }))));
        return cell;
    };
    /**
     * @param {?} activities
     * @return {?}
     */
    FlowGraph.prototype.findFirstStartActivityInstance = /**
     * @param {?} activities
     * @return {?}
     */
    function (activities) {
        var e_3, _a;
        try {
            for (var activities_1 = tslib_1.__values(activities), activities_1_1 = activities_1.next(); !activities_1_1.done; activities_1_1 = activities_1.next()) {
                var act = activities_1_1.value;
                if (!act.precursorActivityDefinitionId) {
                    return act;
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (activities_1_1 && !activities_1_1.done && (_a = activities_1.return)) _a.call(activities_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return null;
    };
    /**
     * @param {?} nodeCells
     * @return {?}
     */
    FlowGraph.prototype.findNoIncomingNodes = /**
     * @param {?} nodeCells
     * @return {?}
     */
    function (nodeCells) {
        var e_4, _a;
        /** @type {?} */
        var noIncomingNodes = new Array();
        var _loop_2 = function (node) {
            if (node.flowElement.ClrTypeID === 'wf.StartActivity') {
                return "continue";
            }
            if (!node.edges || node.edges.length === 0) {
                noIncomingNodes.push(node);
                return "continue";
            }
            if (!node.edges.some((/**
             * @param {?} edge
             * @return {?}
             */
            function (edge) { return ((/** @type {?} */ (edge.target))).flowElement.Id === node.flowElement.Id; }))) {
                noIncomingNodes.push(node);
            }
        };
        try {
            for (var nodeCells_1 = tslib_1.__values(nodeCells), nodeCells_1_1 = nodeCells_1.next(); !nodeCells_1_1.done; nodeCells_1_1 = nodeCells_1.next()) {
                var node = nodeCells_1_1.value;
                _loop_2(node);
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (nodeCells_1_1 && !nodeCells_1_1.done && (_a = nodeCells_1.return)) _a.call(nodeCells_1);
            }
            finally { if (e_4) throw e_4.error; }
        }
        return noIncomingNodes;
    };
    /**
     * @param {?} firstAct
     * @param {?} activities
     * @param {?} transInsList
     * @return {?}
     */
    FlowGraph.prototype.findEndActiInstList = /**
     * @param {?} firstAct
     * @param {?} activities
     * @param {?} transInsList
     * @return {?}
     */
    function (firstAct, activities, transInsList) {
        /** @type {?} */
        var endActiInstList = [];
        this.getNextTransitions(endActiInstList, firstAct.activityInstanceId, activities, transInsList);
        return endActiInstList;
    };
    /**
     * @param {?} endActiInstList
     * @param {?} sourceActInstId
     * @param {?} activities
     * @param {?} transInsList
     * @return {?}
     */
    FlowGraph.prototype.getNextTransitions = /**
     * @param {?} endActiInstList
     * @param {?} sourceActInstId
     * @param {?} activities
     * @param {?} transInsList
     * @return {?}
     */
    function (endActiInstList, sourceActInstId, activities, transInsList) {
        var e_5, _a;
        /** @type {?} */
        var nextTransitions = this.findTranInstsBySourceActInstId(sourceActInstId, transInsList);
        if (nextTransitions && nextTransitions.length > 0) {
            try {
                for (var nextTransitions_1 = tslib_1.__values(nextTransitions), nextTransitions_1_1 = nextTransitions_1.next(); !nextTransitions_1_1.done; nextTransitions_1_1 = nextTransitions_1.next()) {
                    var t = nextTransitions_1_1.value;
                    if (t.destinationActivityDefinitionId) {
                        this.getNextTransitions(endActiInstList, t.destinationActivityInstanceId, activities, transInsList);
                    }
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (nextTransitions_1_1 && !nextTransitions_1_1.done && (_a = nextTransitions_1.return)) _a.call(nextTransitions_1);
                }
                finally { if (e_5) throw e_5.error; }
            }
        }
        else {
            /** @type {?} */
            var actInst_1 = this.findActInstByActInstId(sourceActInstId, activities);
            if (actInst_1) {
                if (!endActiInstList.some((/**
                 * @param {?} a
                 * @return {?}
                 */
                function (a) { return a.activityInstanceId === actInst_1.activityInstanceId; }))) {
                    endActiInstList.push(actInst_1);
                }
            }
        }
    };
    /**
     * @param {?} sourceActInstId
     * @param {?} transInsList
     * @return {?}
     */
    FlowGraph.prototype.findTranInstsBySourceActInstId = /**
     * @param {?} sourceActInstId
     * @param {?} transInsList
     * @return {?}
     */
    function (sourceActInstId, transInsList) {
        return transInsList.filter((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.sourceActivityInstanceId === sourceActInstId; }));
    };
    /**
     * @param {?} actInstId
     * @param {?} activities
     * @return {?}
     */
    FlowGraph.prototype.findActInstByActInstId = /**
     * @param {?} actInstId
     * @param {?} activities
     * @return {?}
     */
    function (actInstId, activities) {
        return activities.find((/**
         * @param {?} a
         * @return {?}
         */
        function (a) { return a.activityInstanceId === actInstId; }));
    };
    /**
     * @param {?} actiDefId
     * @param {?} bpmnModel
     * @return {?}
     */
    FlowGraph.prototype.findDrawFlowElementsByActDefId = /**
     * @param {?} actiDefId
     * @param {?} bpmnModel
     * @return {?}
     */
    function (actiDefId, bpmnModel) {
        /** @type {?} */
        var nextFlowNodeDict = {};
        /** @type {?} */
        var nextSeqFlowDict = {};
        this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, actiDefId, bpmnModel);
        return {
            nextFlowNodeDict: nextFlowNodeDict,
            nextSeqFlowDict: nextSeqFlowDict,
        };
    };
    /**
     * @param {?} nextFlowNodeDict
     * @param {?} nextSeqFlowDict
     * @param {?} flowElementId
     * @param {?} bpmnModel
     * @return {?}
     */
    FlowGraph.prototype.findNextFlowElementsByFlowElementId = /**
     * @param {?} nextFlowNodeDict
     * @param {?} nextSeqFlowDict
     * @param {?} flowElementId
     * @param {?} bpmnModel
     * @return {?}
     */
    function (nextFlowNodeDict, nextSeqFlowDict, flowElementId, bpmnModel) {
        var _this = this;
        /** @type {?} */
        var flowElt = bpmnModel.DefaultProcess.GetFlowElement(flowElementId);
        if (flowElt && nextFlowNodeDict[flowElementId] == null) {
            if (flowElt instanceof SequenceFlow) {
                nextSeqFlowDict[flowElt.Id] = flowElt;
                this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, flowElt.TargetRef, bpmnModel);
            }
            else if (flowElt instanceof FlowNode) {
                nextFlowNodeDict[flowElt.Id] = flowElt;
                if ((flowElt instanceof EndEvent) == false) {
                    flowElt.Outgoings && flowElt.Outgoings.forEach((/**
                     * @param {?} outgoing
                     * @return {?}
                     */
                    function (outgoing) {
                        _this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, outgoing, bpmnModel);
                    }));
                }
            }
        }
    };
    return FlowGraph;
}(mxGraph));
export { FlowGraph };
if (false) {
    /** @type {?} */
    FlowGraph.prototype.bpmnModel;
    /** @type {?} */
    FlowGraph.prototype.autoTranslate;
    /** @type {?} */
    FlowGraph.prototype.scrollTileSize;
    /** @type {?} */
    FlowGraph.prototype.getPagePadding;
    /** @type {?} */
    FlowGraph.prototype.getPageSize;
    /** @type {?} */
    FlowGraph.prototype.getScrollTileSize;
    /** @type {?} */
    FlowGraph.prototype.getPageLayout;
    /** @type {?} */
    FlowGraph.prototype.cellStyleConfig;
    /** @type {?} */
    FlowGraph.prototype.actList;
    /** @type {?} */
    FlowGraph.prototype.transInsList;
    /** @type {?} */
    FlowGraph.prototype.mode;
    /** @type {?} */
    FlowGraph.prototype.rootPath;
    /**
     * 当前语言
     * @type {?}
     */
    FlowGraph.prototype.langCode;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmxvd0dyYXBoLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi91aS1mbG93Y2hhcnQvIiwic291cmNlcyI6WyJsaWIvZmxvdy1jaGFydC9GbG93R3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQWEsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUgsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBb0QsWUFBWSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hNLE9BQU8sRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLHNCQUFzQixFQUFFLFlBQVksRUFBRSwwQkFBMEIsRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDdE4sT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU1yQztJQUErQixxQ0FBTztJQXVCbEMsbUJBQVksU0FBeUIsRUFBRSxlQUFpQztRQUF4RSxZQUNJLGtCQUFNLFNBQVMsQ0FBQyxTQThCbkI7UUFuREQsb0JBQWMsR0FBMEIsSUFBSSxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFNeEUscUJBQWUsR0FBb0I7WUFDL0IsWUFBWSxFQUFFLEVBQUU7WUFDaEIsYUFBYSxFQUFFLEVBQUU7U0FDcEIsQ0FBQztRQUVGLGFBQU8sR0FBMkIsRUFBRSxDQUFDO1FBQ3JDLGtCQUFZLEdBQTZCLEVBQUUsQ0FBQztRQUU1QyxjQUFRLEdBQVcsRUFBRSxDQUFDLENBQUEsS0FBSzs7Ozs7UUFJM0IsY0FBUSxHQUFHLENB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ckIsa0NBQXVCOztJQUN2QixtQ0FBd0U7O0lBQ3hFLG1DQUF3Qzs7SUFDeEMsZ0NBQXlDOztJQUN6QyxzQ0FBK0M7O0lBQy9DLGtDQUEyQzs7SUFFM0Msb0NBR0U7O0lBRUYsNEJBQXFDOztJQUNyQyxpQ0FBNEM7O0lBQzVDLHlCQUFhOztJQUNiLDZCQUFzQjs7Ozs7SUFJdEIsNkJBQXlLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbXhHcmFwaCwgbXhFdmVudCwgbXhDb25zdGFudHMsIG14UG9pbnQsIG14UmVjdGFuZ2xlLCBteFV0aWxzLCBNeEdyYXBoTlMsIG14R2VvbWV0cnkgfSBmcm9tIFwiQGVkcC1wbWYvbXhncmFwaC10c1wiO1xyXG5pbXBvcnQgeyBFbmRFdmVudCwgQnBtbk1vZGVsLCBQcm9jZXNzLCBCUE1ORGlhZ3JhbSwgRmxvd0VsZW1lbnQsIERpYWdyYW1FbGVtZW50LCBCUE1OU2hhcGUsIEJQTU5FZGdlLCBTZXF1ZW5jZUZsb3csIEZsb3dOb2RlLCBOb2RlLCBFZGdlLCBGbG93Tm9kZVN0YXRlLCBTZXF1ZW5jZUZsb3dTdGF0ZSB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IFN0YXJ0QWN0aXZpdHksIFVzZXJBY3Rpdml0eSwgQ2FsbEFjdGl2aXR5U3ViUHJvY2VzcywgQXV0b0FjdGl2aXR5LCBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCwgT3BlcmF0aW9uQWN0aXZpdHksIE1lc3NhZ2VBY3Rpdml0eSwgTm90aWZ5QWN0aXZpdHksIEFpZkNyZWF0aW9uQmlsbEFjdGl2aXR5IH0gZnJvbSBcIkBnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbFwiO1xyXG5pbXBvcnQgeyBDZWxsIH0gZnJvbSBcIi4vZW50aXR5L0NlbGxcIjtcclxuaW1wb3J0IHsgQWN0aXZpdHlJbnN0YW5jZVNsaW0gfSBmcm9tIFwiLi9lbnRpdHkvQWN0aXZpdHlJbnN0YW5jZVNsaW1cIjtcclxuaW1wb3J0IHsgVHJhbnNpdGlvbkluc3RhbmNlU2xpbSB9IGZyb20gXCIuL2VudGl0eS9UcmFuc2l0aW9uSW5zdGFuY2VTbGltXCI7XHJcbmltcG9ydCB7IENlbGxTdHlsZUNvbmZpZyB9IGZyb20gXCIuLi9lbnRpdHkvY2VsbC1zdHlsZS9DZWxsU3R5bGVDb25maWdcIjtcclxuaW1wb3J0IHsgU3RhdGVTaGFwZVN0eWxlIH0gZnJvbSBcIi4uL2VudGl0eS9jZWxsLXN0eWxlL1N0YXRlU2hhcGVTdHlsZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEZsb3dHcmFwaCBleHRlbmRzIG14R3JhcGgge1xyXG4gICAgYnBtbk1vZGVsOiBCcG1uTW9kZWw7XHJcbiAgICBhdXRvVHJhbnNsYXRlOiBib29sZWFuO1xyXG4gICAgc2Nyb2xsVGlsZVNpemU6IE14R3JhcGhOUy5teFJlY3RhbmdsZSA9IG5ldyBteFJlY3RhbmdsZSgwLCAwLCA0MDAsIDYwMCk7XHJcbiAgICBnZXRQYWdlUGFkZGluZzogKCkgPT4gTXhHcmFwaE5TLm14UG9pbnQ7XHJcbiAgICBnZXRQYWdlU2l6ZTogKCkgPT4gTXhHcmFwaE5TLm14UmVjdGFuZ2xlO1xyXG4gICAgZ2V0U2Nyb2xsVGlsZVNpemU6ICgpID0+IE14R3JhcGhOUy5teFJlY3RhbmdsZTtcclxuICAgIGdldFBhZ2VMYXlvdXQ6ICgpID0+IE14R3JhcGhOUy5teFJlY3RhbmdsZTtcclxuXHJcbiAgICBjZWxsU3R5bGVDb25maWc6IENlbGxTdHlsZUNvbmZpZyA9IHtcclxuICAgICAgICBlZGdlU3R5bGVEaWM6IHt9LFxyXG4gICAgICAgIHNoYXBlU3R5bGVEaWM6IHt9LFxyXG4gICAgfTtcclxuXHJcbiAgICBhY3RMaXN0OiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdID0gW107XHJcbiAgICB0cmFuc0luc0xpc3Q6IFRyYW5zaXRpb25JbnN0YW5jZVNsaW1bXSA9IFtdO1xyXG4gICAgbW9kZTogc3RyaW5nO1xyXG4gICAgcm9vdFBhdGg6IHN0cmluZyA9ICcnOy8v5Z+66Lev5b6EXHJcbiAgICAvKipcclxuICAgICAqIOW9k+WJjeivreiogFxyXG4gICAgICovXHJcbiAgICBsYW5nQ29kZSA9ICh3aW5kb3cgYXMgYW55KS5nc3BmcmFtZXdvcmtTZXJ2aWNlICYmICh3aW5kb3cgYXMgYW55KS5nc3BmcmFtZXdvcmtTZXJ2aWNlLnJ0Zi5sYW5ndWFnZS5nZXRMYW5ndWFnZUNvZGUoKSB8fCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2VDb2RlJykgfHwgJ3poLUNIUyc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCwgY2VsbFN0eWxlQ29uZmlnPzogQ2VsbFN0eWxlQ29uZmlnKSB7XHJcbiAgICAgICAgc3VwZXIoY29udGFpbmVyKTtcclxuICAgICAgICAvL+iOt+WPluWfuui3r+W+hFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHRoaXMucm9vdFBhdGggPSAod2luZG93IGFzIGFueSkuZ3NwZnJhbWV3b3JrU2VydmljZS5jb21tb24uZ2V0QmFzZVBhdGguZ2V0KCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jZWxsU3R5bGVDb25maWcgPSBjZWxsU3R5bGVDb25maWcgPyBjZWxsU3R5bGVDb25maWcgOiB0aGlzLmNlbGxTdHlsZUNvbmZpZztcclxuICAgICAgICB0aGlzLmF1dG9TY3JvbGwgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmF1dG9FeHRlbmQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAvL3RoaXMucGFubmluZ0hhbmRsZXIuaWdub3JlQ2VsbCA9IHRydWU7XHJcbiAgICAgICAgLy90aGlzLnNldFBhbm5pbmcodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5zZXRDZWxsc1NlbGVjdGFibGUodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5zZXREaXNjb25uZWN0T25Nb3ZlKGZhbHNlKTtcclxuICAgICAgICAvL+iKgueCueS4jeWPr+aUueWPmOWkp+Wwj1xyXG4gICAgICAgIHRoaXMuc2V0Q2VsbHNSZXNpemFibGUoZmFsc2UpO1xyXG4gICAgICAgIC8vY2VsbOaYr+WQpuWPr+S7pei/nue6v1xyXG4gICAgICAgIHRoaXMuc2V0Q29ubmVjdGFibGUoZmFsc2UpO1xyXG4gICAgICAgIC8v56aB5q2i5pON5L2cXHJcbiAgICAgICAgdGhpcy5zZXRFbmFibGVkKHRydWUpO1xyXG4gICAgICAgIC8v6K6+572uY2VsbOaWh+acrOaYr+WQpuWPr+enu+WKqFxyXG4gICAgICAgIHRoaXMuc2V0VmVydGV4TGFiZWxzTW92YWJsZShmYWxzZSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0Q2VsbHNMb2NrZWQodHJ1ZSk7XHJcbiAgICAgICAgLy/kuI3lhYHorrjlm77kuIrlrZjlnKjmsqHmnInov57mjqXmtLvliqjoioLngrnnmoTnur/vvIjpmLLmraLmi5bliqjnur/ov57mjqXngrnlr7zoh7TlpLHljrvov57mjqXvvIks6L+Y5rKh5pyJ5om+5Yiw5LiN5YWB6K645ouW5Yqo6L+e5o6l5o6n5Yi254K555qE5bGe5oCnXHJcbiAgICAgICAgdGhpcy5zZXRBbGxvd0RhbmdsaW5nRWRnZXMoZmFsc2UpO1xyXG4gICAgICAgIG14RXZlbnQuZGlzYWJsZUNvbnRleHRNZW51KGNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIC8vIOiuvue9rum7mOiupOagt+W8j1xyXG4gICAgICAgIHRoaXMuc2V0RGVmYXVsdFN0eWxlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YeN5YaZ5Yib5bu66IqC54K55a+56LGh5pa55rOVXHJcbiAgICAgKiBAcGFyYW0gcGFyZW50XHJcbiAgICAgKiBAcGFyYW0gaWRcclxuICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIHhcclxuICAgICAqIEBwYXJhbSB5XHJcbiAgICAgKiBAcGFyYW0gd2lkdGhcclxuICAgICAqIEBwYXJhbSBoZWlnaHRcclxuICAgICAqIEBwYXJhbSBzdHlsZVxyXG4gICAgICogQHBhcmFtIHJlbGF0aXZlXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBjcmVhdGVWZXJ0ZXgocGFyZW50LCBpZCwgdmFsdWUsIHgsIHksIHdpZHRoLCBoZWlnaHQsIHN0eWxlLCByZWxhdGl2ZSkge1xyXG4gICAgICAgIC8vIENyZWF0ZXMgdGhlIGdlb21ldHJ5IGZvciB0aGUgdmVydGV4XHJcbiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgbXhHZW9tZXRyeSh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICBnZW9tZXRyeS5yZWxhdGl2ZSA9IChyZWxhdGl2ZSAhPSBudWxsKSA/IHJlbGF0aXZlIDogZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZXMgdGhlIHZlcnRleFxyXG4gICAgICAgIGNvbnN0IHZlcnRleCA9IG5ldyBDZWxsKHZhbHVlLCBnZW9tZXRyeSwgc3R5bGUpO1xyXG4gICAgICAgIHZlcnRleC5zZXRJZChpZCk7XHJcbiAgICAgICAgdmVydGV4LnNldFZlcnRleCh0cnVlKTtcclxuICAgICAgICB2ZXJ0ZXguc2V0Q29ubmVjdGFibGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIHJldHVybiB2ZXJ0ZXg7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDph43lhpnliJvlu7rovrnlr7nosaHmlrnms5VcclxuICAgICAqIEBwYXJhbSBwYXJlbnRcclxuICAgICAqIEBwYXJhbSBpZFxyXG4gICAgICogQHBhcmFtIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0gc291cmNlXHJcbiAgICAgKiBAcGFyYW0gdGFyZ2V0XHJcbiAgICAgKiBAcGFyYW0gc3R5bGVcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZUVkZ2UocGFyZW50LCBpZCwgdmFsdWUsIHNvdXJjZSwgdGFyZ2V0LCBzdHlsZSkge1xyXG4gICAgICAgIC8vIENyZWF0ZXMgdGhlIGVkZ2VcclxuICAgICAgICB2YXIgZWRnZSA9IG5ldyBDZWxsKHZhbHVlLCBuZXcgbXhHZW9tZXRyeSgpLCBzdHlsZSk7XHJcbiAgICAgICAgZWRnZS5zZXRJZChpZCk7XHJcbiAgICAgICAgZWRnZS5zZXRFZGdlKHRydWUpO1xyXG4gICAgICAgIGVkZ2UuZ2VvbWV0cnkucmVsYXRpdmUgPSB0cnVlO1xyXG5cclxuICAgICAgICByZXR1cm4gZWRnZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rum7mOiupOagt+W8j1xyXG4gICAgICovXHJcbiAgICBzZXREZWZhdWx0U3R5bGVzKCkge1xyXG4gICAgICAgIGNvbnN0IHN0eWxlU2hlZXQgPSB0aGlzLmdldFN0eWxlc2hlZXQoKTtcclxuICAgICAgICAvLyDoioLngrnpu5jorqTmoLflvI9cclxuICAgICAgICBjb25zdCB2ZXJ0ZXhTdHlsZSA9IHN0eWxlU2hlZXQuZ2V0RGVmYXVsdFZlcnRleFN0eWxlKCk7XHJcbiAgICAgICAgdmVydGV4U3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU0hBUEVdID0gbXhDb25zdGFudHMuU0hBUEVfSU1BR0U7XHJcbiAgICAgICAgdmVydGV4U3R5bGVbbXhDb25zdGFudHMuU1RZTEVfVkVSVElDQUxfTEFCRUxfUE9TSVRJT05dID0gbXhDb25zdGFudHMuQUxJR05fQk9UVE9NO1xyXG4gICAgICAgIHZlcnRleFN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0ZPTlRTSVpFXSA9IDEyO1xyXG4gICAgICAgIHZlcnRleFN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0ZPTlRGQU1JTFldID0gJ0hlbHZldGljYSc7XHJcbiAgICAgICAgdmVydGV4U3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRk9OVENPTE9SXSA9IFwiIzMzM1wiO1xyXG5cclxuICAgICAgICAvLyDov57nur/moLflvI/pu5jorqTkuLrmraPkuqRcclxuICAgICAgICBjb25zdCBlZGdlU3R5bGUgPSBzdHlsZVNoZWV0LmdldERlZmF1bHRFZGdlU3R5bGUoKTtcclxuICAgICAgICBlZGdlU3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU09VUkNFX1BPUlRdID0gJ2UnO1xyXG4gICAgICAgIGVkZ2VTdHlsZVtteENvbnN0YW50cy5TVFlMRV9UQVJHRVRfUE9SVF0gPSAndyc7XHJcbiAgICAgICAgZWRnZVN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0VER0VdID0gbXhDb25zdGFudHMuRURHRVNUWUxFX09SVEhPR09OQUw7XHJcbiAgICAgICAgZWRnZVN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1JPVU5ERURdID0gMTtcclxuICAgICAgICBlZGdlU3R5bGVbbXhDb25zdGFudHMuU1RZTEVfU1RST0tFQ09MT1JdID0gJyM2NDgyQjknO1xyXG4gICAgICAgIGVkZ2VTdHlsZVtteENvbnN0YW50cy5TVFlMRV9GT05UU0laRV0gPSAxMjtcclxuICAgICAgICBlZGdlU3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRk9OVEZBTUlMWV0gPSAnSGVsdmV0aWNhJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuaXoOmZkOWkp+eUu+W4g1xyXG4gICAgICovXHJcbiAgICBjcmVhdGVJbmZpbml0ZUNhbnZhcygpIHtcclxuICAgICAgICB0aGlzLmdldFBhZ2VQYWRkaW5nID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IG14UG9pbnQoXHJcbiAgICAgICAgICAgICAgICBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKHRoaXMuY29udGFpbmVyLm9mZnNldFdpZHRoIC0gMzQpKSxcclxuICAgICAgICAgICAgICAgIE1hdGgubWF4KDAsIE1hdGgucm91bmQodGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0IC0gMzQpKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdldFNjcm9sbFRpbGVTaXplID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxUaWxlU2l6ZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFRpbGVTaXplID0gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIDQwMCwgNjAwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2Nyb2xsVGlsZVNpemU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdldFBhZ2VTaXplID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gKHRoaXMucGFnZVZpc2libGUpID8gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIHRoaXMucGFnZUZvcm1hdC53aWR0aCAqIHRoaXMucGFnZVNjYWxlLCB0aGlzLnBhZ2VGb3JtYXQuaGVpZ2h0ICogdGhpcy5wYWdlU2NhbGUpIDogdGhpcy5nZXRTY3JvbGxUaWxlU2l6ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRQYWdlTGF5b3V0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgc2l6ZSA9ICh0aGlzLnBhZ2VWaXNpYmxlKSA/IHRoaXMuZ2V0UGFnZVNpemUoKSA6IHRoaXMuZ2V0U2Nyb2xsVGlsZVNpemUoKTtcclxuICAgICAgICAgICAgbGV0IGJvdW5kcyA9IHRoaXMuZ2V0R3JhcGhCb3VuZHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChib3VuZHMud2lkdGggPT0gMCB8fCBib3VuZHMuaGVpZ2h0ID09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgbXhSZWN0YW5nbGUoMCwgMCwgMSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDb21wdXRlcyB1bnRyYW5zZm9ybWVkIGdyYXBoIGJvdW5kc1xyXG4gICAgICAgICAgICAgICAgbGV0IHggPSBNYXRoLmNlaWwoYm91bmRzLnggLyB0aGlzLnZpZXcuc2NhbGUgLSB0aGlzLnZpZXcudHJhbnNsYXRlLngpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHkgPSBNYXRoLmNlaWwoYm91bmRzLnkgLyB0aGlzLnZpZXcuc2NhbGUgLSB0aGlzLnZpZXcudHJhbnNsYXRlLnkpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHcgPSBNYXRoLmZsb29yKGJvdW5kcy53aWR0aCAvIHRoaXMudmlldy5zY2FsZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgaCA9IE1hdGguZmxvb3IoYm91bmRzLmhlaWdodCAvIHRoaXMudmlldy5zY2FsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHgwID0gTWF0aC5mbG9vcih4IC8gc2l6ZS53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgeTAgPSBNYXRoLmZsb29yKHkgLyBzaXplLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdzAgPSBNYXRoLmNlaWwoKHggKyB3KSAvIHNpemUud2lkdGgpIC0geDA7XHJcbiAgICAgICAgICAgICAgICBsZXQgaDAgPSBNYXRoLmNlaWwoKHkgKyBoKSAvIHNpemUuaGVpZ2h0KSAtIHkwO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgbXhSZWN0YW5nbGUoeDAsIHkwLCB3MCwgaDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdldFByZWZlcnJlZFBhZ2VTaXplID0gKGJvdW5kcywgd2lkdGgsIGhlaWdodCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcGFnZXMgPSB0aGlzLmdldFBhZ2VMYXlvdXQoKTtcclxuICAgICAgICAgICAgbGV0IHNpemUgPSB0aGlzLmdldFBhZ2VTaXplKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIHBhZ2VzLndpZHRoICogc2l6ZS53aWR0aCwgcGFnZXMuaGVpZ2h0ICogc2l6ZS5oZWlnaHQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIOmHjeWGmeeUu+W4g+Wkp+Wwj+WPmOWMluWQjuaWueazlVxyXG4gICAgICAgIGNvbnN0IGdyYXBoU2l6ZURpZENoYW5nZSA9IHRoaXMuc2l6ZURpZENoYW5nZTtcclxuICAgICAgICB0aGlzLnNpemVEaWRDaGFuZ2UgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5lciAhPSBudWxsICYmIG14VXRpbHMuaGFzU2Nyb2xsYmFycyh0aGlzLmNvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwYWdlcyA9IHRoaXMuZ2V0UGFnZUxheW91dCgpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhZCA9IHRoaXMuZ2V0UGFnZVBhZGRpbmcoKTtcclxuICAgICAgICAgICAgICAgIGxldCBzaXplID0gdGhpcy5nZXRQYWdlU2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZXMgdGhlIG1pbmltdW0gZ3JhcGggc2l6ZVxyXG4gICAgICAgICAgICAgICAgbGV0IG1pbncgPSBNYXRoLmNlaWwoMiAqIHBhZC54IC8gdGhpcy52aWV3LnNjYWxlICsgcGFnZXMud2lkdGggKiBzaXplLndpZHRoKTtcclxuICAgICAgICAgICAgICAgIGxldCBtaW5oID0gTWF0aC5jZWlsKDIgKiBwYWQueSAvIHRoaXMudmlldy5zY2FsZSArIHBhZ2VzLmhlaWdodCAqIHNpemUuaGVpZ2h0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbWluID0gdGhpcy5taW5pbXVtR3JhcGhTaXplO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIExBVEVSOiBGaXggZmxpY2tlciBvZiBzY3JvbGxiYXIgc2l6ZSBpbiBJRSBxdWlya3MgbW9kZVxyXG4gICAgICAgICAgICAgICAgLy8gYWZ0ZXIgZGVsYXllZCBjYWxsIGluIHdpbmRvdy5yZXNpemUgZXZlbnQgaGFuZGxlclxyXG4gICAgICAgICAgICAgICAgaWYgKG1pbiA9PSBudWxsIHx8IG1pbi53aWR0aCAhPSBtaW53IHx8IG1pbi5oZWlnaHQgIT0gbWluaCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWluaW11bUdyYXBoU2l6ZSA9IG5ldyBteFJlY3RhbmdsZSgwLCAwLCBtaW53LCBtaW5oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIGF1dG8tdHJhbnNsYXRlIHRvIGluY2x1ZGUgcGFkZGluZyBhbmQgZ3JhcGggc2l6ZVxyXG4gICAgICAgICAgICAgICAgbGV0IGR4ID0gcGFkLnggLyB0aGlzLnZpZXcuc2NhbGUgLSBwYWdlcy54ICogc2l6ZS53aWR0aDtcclxuICAgICAgICAgICAgICAgIGxldCBkeSA9IHBhZC55IC8gdGhpcy52aWV3LnNjYWxlIC0gcGFnZXMueSAqIHNpemUuaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5hdXRvVHJhbnNsYXRlICYmICh0aGlzLnZpZXcudHJhbnNsYXRlLnggIT0gZHggfHwgdGhpcy52aWV3LnRyYW5zbGF0ZS55ICE9IGR5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b1RyYW5zbGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMudmlldyBhcyBhbnkpLngwID0gcGFnZXMueDtcclxuICAgICAgICAgICAgICAgICAgICAodGhpcy52aWV3IGFzIGFueSkueTAgPSBwYWdlcy55O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgdHggPSB0aGlzLnZpZXcudHJhbnNsYXRlLng7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5ID0gdGhpcy52aWV3LnRyYW5zbGF0ZS55O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXcuc2V0VHJhbnNsYXRlKGR4LCBkeSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc2Nyb2xsTGVmdCArPSAoZHggLSB0eCkgKiB0aGlzLnZpZXcuc2NhbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wICs9IChkeSAtIHR5KSAqIHRoaXMudmlldy5zY2FsZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRvVHJhbnNsYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGdyYXBoU2l6ZURpZENoYW5nZS5hcHBseSh0aGlzLCBbXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDph43lhpl2aWV36I635Y+W6IOM5pmv6aG15aSn5bCPXHJcbiAgICAgICAgdGhpcy52aWV3LmdldEJhY2tncm91bmRQYWdlQm91bmRzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbGF5b3V0ID0gdGhpcy5nZXRQYWdlTGF5b3V0KCk7XHJcbiAgICAgICAgICAgIGxldCBwYWdlID0gdGhpcy5nZXRQYWdlU2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBteFJlY3RhbmdsZShcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5zY2FsZSAqICh0aGlzLnZpZXcudHJhbnNsYXRlLnggKyBsYXlvdXQueCAqIHBhZ2Uud2lkdGgpLFxyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnNjYWxlICogKHRoaXMudmlldy50cmFuc2xhdGUueSArIGxheW91dC55ICogcGFnZS5oZWlnaHQpLFxyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnNjYWxlICogbGF5b3V0LndpZHRoICogcGFnZS53aWR0aCxcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5zY2FsZSAqIGxheW91dC5oZWlnaHQgKiBwYWdlLmhlaWdodFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDph43lhpl2aWV3IHZhbGlkYXRl5pa55rOVXHJcbiAgICAgICAgY29uc3QgZ3JhcGhWaWV3VmFsaWRhdGUgPSB0aGlzLnZpZXcudmFsaWRhdGU7XHJcbiAgICAgICAgdGhpcy52aWV3LnZhbGlkYXRlID0gKGNlbGw/OiBNeEdyYXBoTlMubXhDZWxsKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5lciAhPSBudWxsICYmIG14VXRpbHMuaGFzU2Nyb2xsYmFycyh0aGlzLmNvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgICAgIGxldCBwYWQgPSB0aGlzLmdldFBhZ2VQYWRkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2l6ZSA9IHRoaXMuZ2V0UGFnZVNpemUoKTtcclxuICAgICAgICAgICAgICAgIGxldCB0eCA9IHRoaXMudmlldy50cmFuc2xhdGUueDtcclxuICAgICAgICAgICAgICAgIGxldCB0eSA9IHRoaXMudmlldy50cmFuc2xhdGUueTtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy50cmFuc2xhdGUueCA9IHBhZC54IC8gdGhpcy52aWV3LnNjYWxlIC0gKCh0aGlzLnZpZXcgYXMgYW55KS54MCB8fCAwKSAqIHNpemUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcudHJhbnNsYXRlLnkgPSBwYWQueSAvIHRoaXMudmlldy5zY2FsZSAtICgodGhpcy52aWV3IGFzIGFueSkueTAgfHwgMCkgKiBzaXplLmhlaWdodDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ3JhcGhWaWV3VmFsaWRhdGUuYXBwbHkodGhpcy52aWV3LCBbY2VsbF0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu6QnBtbk1vZGVsXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZUJwbW5Nb2RlbCgpIHtcclxuICAgICAgICBjb25zdCBicG1uTW9kZWwgPSBuZXcgQnBtbk1vZGVsKCk7XHJcbiAgICAgICAgYnBtbk1vZGVsLlRhcmdldE5hbWVzcGFjZSA9IFwiRGVmYXVsdF9OYW1lc3BhY2VcIjtcclxuICAgICAgICBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MgPSBuZXcgUHJvY2VzcyhicG1uTW9kZWwpO1xyXG4gICAgICAgIGJwbW5Nb2RlbC5EZWZhdWx0RGlhZ3JhbSA9IG5ldyBCUE1ORGlhZ3JhbShicG1uTW9kZWwpO1xyXG4gICAgICAgIGJwbW5Nb2RlbC5EZWZhdWx0RGlhZ3JhbS5CcG1uUGxhbmUuQnBtbkVsZW1lbnRJZCA9IGJwbW5Nb2RlbC5EZWZhdWx0UHJvY2Vzcy5JZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGJwbW5Nb2RlbDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWKoOi9vUJwbW5Nb2RlbOW5tueUu+WbvlxyXG4gICAgICovXHJcbiAgICBsb2FkQnBtbk1vZGVsKGpzb246IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQ2VsbHModGhpcy5nZXRDaGlsZENlbGxzKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpKSk7XHJcbiAgICAgICAgdGhpcy5icG1uTW9kZWwgPSB0aGlzLmNyZWF0ZUJwbW5Nb2RlbCgpO1xyXG4gICAgICAgIHRoaXMuYnBtbk1vZGVsLkxvYWRGcm9tSnNvbihqc29uKTtcclxuICAgICAgICB0aGlzLmRyYXdCcG1uR3JhcGgodGhpcy5icG1uTW9kZWwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YeN5paw5Yqg6L29QnBtbk1vZGVs5bm255S75Zu+XHJcbiAgICAgKiBAcGFyYW0ganNvblxyXG4gICAgICovXHJcbiAgICByZWxvYWRCcG1uTW9kZWwoanNvbj86IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQ2VsbHModGhpcy5nZXRDaGlsZENlbGxzKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpKSk7XHJcbiAgICAgICAgaWYgKGpzb24pIHtcclxuICAgICAgICAgICAgdGhpcy5sb2FkQnBtbk1vZGVsKGpzb24pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd0JwbW5HcmFwaCh0aGlzLmJwbW5Nb2RlbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2uQnBtbk1vZGVs55S75Zu+XHJcbiAgICAgKi9cclxuICAgIGRyYXdCcG1uR3JhcGgoYnBtbk1vZGVsOiBCcG1uTW9kZWwpIHtcclxuICAgICAgICBjb25zdCB7IG5vZGVEaWN0LCBlZGdlRGljdCB9ID0gdGhpcy5idWlsZEZsb3dEaWFnRGljdChicG1uTW9kZWwpO1xyXG4gICAgICAgIGNvbnN0IGZsb3dEaWN0ID0gdGhpcy5idWlsZEZsb3dEaWN0KGJwbW5Nb2RlbCk7XHJcbiAgICAgICAgdGhpcy5kcmF3Tm9kZUNlbGxzKGZsb3dEaWN0LCBub2RlRGljdCk7XHJcbiAgICAgICAgdGhpcy5kcmF3RWRnZUNlbGxzKGZsb3dEaWN0LCBlZGdlRGljdCk7XHJcbiAgICAgICAgdGhpcy5nZXRNb2RlbCgpLmJlZ2luVXBkYXRlKCk7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3NpbXVsYXRpb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd0ludGVyY2VwdEdyYXBoKGZsb3dEaWN0LCBub2RlRGljdCwgZWRnZURpY3QpO1xyXG4gICAgICAgICAgICB0aGlzLmFkZEp1bXBFZGdlcyhmbG93RGljdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ2V0TW9kZWwoKS5lbmRVcGRhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXdJbnRlcmNlcHRHcmFwaChmbG93RGljdDogeyBba2V5OiBzdHJpbmddOiBGbG93RWxlbWVudDsgfSxcclxuICAgICAgICBub2RlRGljdDogeyBbQnBtbkVsZW1lbnRJZDogc3RyaW5nXTogRGlhZ3JhbUVsZW1lbnQ7IH0sXHJcbiAgICAgICAgZWRnZURpY3Q6IHsgW0JwbW5FbGVtZW50SWQ6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9KSB7XHJcbiAgICAgICAgY29uc3QgZmlyc3RBY3QgPSB0aGlzLmZpbmRGaXJzdFN0YXJ0QWN0aXZpdHlJbnN0YW5jZSh0aGlzLmFjdExpc3QpO1xyXG4gICAgICAgIC8vIHRvZG/vvJrmraTlpITlvoXkv67lpI1cclxuICAgICAgICBsZXQgZW5kQWN0RGVmOiBFbmRFdmVudDtcclxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBmbG93RGljdCkge1xyXG4gICAgICAgICAgICBpZiAoZmxvd0RpY3Rba2V5XSBpbnN0YW5jZW9mIEVuZEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBlbmRBY3REZWYgPSBmbG93RGljdFtrZXldIGFzIEVuZEV2ZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmaXJzdEFjdCkge1xyXG4gICAgICAgICAgICBjb25zdCBlbmRBY3RpSW5zdExpc3QgPSB0aGlzLmZpbmRFbmRBY3RpSW5zdExpc3QoZmlyc3RBY3QsIHRoaXMuYWN0TGlzdCwgdGhpcy50cmFuc0luc0xpc3QpO1xyXG4gICAgICAgICAgICBlbmRBY3RpSW5zdExpc3QuZm9yRWFjaCgoZW5kQWN0aUluc3QgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVuZEFjdGlJbnN0LmFjdGl2aXR5RGVmaW5pdGlvbklkICE9PSBlbmRBY3REZWYuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdOZXh0Rmxvd0NoYXJ0KGVuZEFjdGlJbnN0LmFjdGl2aXR5RGVmaW5pdGlvbklkLCBub2RlRGljdCwgZWRnZURpY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZEp1bXBFZGdlcyhmbG93RGljdDogeyBba2V5OiBzdHJpbmddOiBGbG93RWxlbWVudDsgfSkge1xyXG4gICAgICAgIGNvbnN0IG5vZGVDZWxscyA9ICh0aGlzLmdldENoaWxkQ2VsbHModGhpcy5nZXREZWZhdWx0UGFyZW50KCksIHRydWUpIHx8IFtdKSBhcyBDZWxsW107XHJcbiAgICAgICAgY29uc3Qgbm9JbmNvbWluZ05vZGVzOiBDZWxsW10gPSB0aGlzLmZpbmROb0luY29taW5nTm9kZXMobm9kZUNlbGxzKTtcclxuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9JbmNvbWluZ05vZGVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdEluc3QgPSB0aGlzLmFjdExpc3QuZmlsdGVyKGEgPT4gYS5hY3Rpdml0eURlZmluaXRpb25JZCA9PT0gbm9kZS5mbG93RWxlbWVudC5JZClbMF07XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGxJZCA9IGFjdEluc3QucHJlY3Vyc29yQWN0aXZpdHlEZWZpbml0aW9uSWQgKyAnXycgKyBhY3RJbnN0LmFjdGl2aXR5RGVmaW5pdGlvbklkO1xyXG4gICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBub2RlQ2VsbHMuZmluZCgoaXQpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdC5mbG93RWxlbWVudCAmJiBpdC5mbG93RWxlbWVudC5JZCA9PT0gYWN0SW5zdC5wcmVjdXJzb3JBY3Rpdml0eURlZmluaXRpb25JZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IG5vZGVDZWxscy5maW5kKChpdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0LmZsb3dFbGVtZW50ICYmIGl0LmZsb3dFbGVtZW50LklkID09PSBhY3RJbnN0LmFjdGl2aXR5RGVmaW5pdGlvbklkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgICAgICBtYXAuc2V0KCdqdW1wJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0eWxlID0gdGhpcy5nZXRFZGdlU3R5bGUobnVsbCwgbnVsbCwgbWFwKTtcclxuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuaW5zZXJ0RWRnZSh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSwgY2VsbElkLCAnJywgc291cmNlLCB0YXJnZXQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgICAgICBpZiAoY2VsbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY2VsbC5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgICAgICAgICBjZWxsLnRhcmdldCA9IHRhcmdldDtcclxuICAgICAgICAgICAgICAgIGNlbGwuZ2VvbWV0cnkucG9pbnRzID0gW1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG5ldyBteFBvaW50KHNvdXJjZS5nZW9tZXRyeS54KyBzb3VyY2UuZ2VvbWV0cnkud2lkdGgvMiwgdGFyZ2V0Lmdlb21ldHJ5LnkrdGFyZ2V0Lmdlb21ldHJ5LmhlaWdodC8yKVxyXG4gICAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNlbGwpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlQ2VsbHMoW2NlbGxdLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0aGlzLmdldERlZmF1bHRQYXJlbnQoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnlLvoioLngrlcclxuICAgICAqL1xyXG4gICAgZHJhd05vZGVDZWxscyhcclxuICAgICAgICBmbG93RGljdDogeyBba2V5OiBzdHJpbmddOiBGbG93RWxlbWVudDsgfSxcclxuICAgICAgICBub2RlRGljdDogeyBbQnBtbkVsZW1lbnRJZDogc3RyaW5nXTogRGlhZ3JhbUVsZW1lbnQ7IH0sXHJcbiAgICAgICAgYWRkaXRpb25hbDogYm9vbGVhbiA9IGZhbHNlLFxyXG4gICAgKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMobm9kZURpY3QpLmZvckVhY2goKGJwbW5Nb2RlbEVsZW1lbnRJZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZsb3dFbHQgPSBmbG93RGljdFticG1uTW9kZWxFbGVtZW50SWRdO1xyXG4gICAgICAgICAgICBjb25zdCBkaWFnRWx0ID0gbm9kZURpY3RbYnBtbk1vZGVsRWxlbWVudElkXSBhcyBCUE1OU2hhcGU7XHJcbiAgICAgICAgICAgIGlmIChmbG93RWx0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5kcmF3Tm9kZUNlbGwoZmxvd0VsdCwgZGlhZ0VsdCwgYWRkaXRpb25hbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnlLvljZXkuKroioLngrlcclxuICAgICAqIEBwYXJhbSBmbG93RWx0XHJcbiAgICAgKiBAcGFyYW0gZGlhZ0VsdFxyXG4gICAgICogQHBhcmFtIGFkZGl0aW9uYWxcclxuICAgICAqL1xyXG4gICAgZHJhd05vZGVDZWxsKGZsb3dFbHQ6IEZsb3dFbGVtZW50LCBkaWFnRWx0OiBCUE1OU2hhcGUsIGFkZGl0aW9uYWw6IGJvb2xlYW4pIHtcclxuICAgICAgICBjb25zdCBzdHlsZSA9IHRoaXMuZ2V0VmVydGV4U3R5bGUoZmxvd0VsdCwgZGlhZ0VsdCwgYWRkaXRpb25hbCk7XHJcbiAgICAgICAgbGV0IGNlbGw6IENlbGwgPSBudWxsO1xyXG4gICAgICAgIGxldCBsYWJlbCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKGZsb3dFbHQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBsYWJlbCA9IGZsb3dFbHQuTmFtZTtcclxuICAgICAgICAgICAgaWYgKGZsb3dFbHQuTmFtZUxhbmd1YWdlICYmIGZsb3dFbHQuTmFtZUxhbmd1YWdlW3RoaXMubGFuZ0NvZGVdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGxhYmVsID0gZmxvd0VsdC5OYW1lTGFuZ3VhZ2VbdGhpcy5sYW5nQ29kZV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3NpbXVsYXRpb24nKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFjdExpc3QuZmluZEluZGV4KGEgPT4gYS5hY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5JZCkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgY2VsbCA9IHRoaXMuaW5zZXJ0VmVydGV4KHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgZGlhZ0VsdC5Cb3VuZHMuWCwgZGlhZ0VsdC5Cb3VuZHMuWSwgZGlhZ0VsdC5Cb3VuZHMuV2lkdGgsIGRpYWdFbHQuQm91bmRzLkhlaWdodCwgc3R5bGUpIGFzIENlbGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWRkaXRpb25hbCkge1xyXG4gICAgICAgICAgICAgICAgY2VsbCA9IHRoaXMuaW5zZXJ0VmVydGV4KHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgZGlhZ0VsdC5Cb3VuZHMuWCwgZGlhZ0VsdC5Cb3VuZHMuWSwgZGlhZ0VsdC5Cb3VuZHMuV2lkdGgsIGRpYWdFbHQuQm91bmRzLkhlaWdodCwgc3R5bGUpIGFzIENlbGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjZWxsID0gdGhpcy5pbnNlcnRWZXJ0ZXgodGhpcy5nZXREZWZhdWx0UGFyZW50KCksIGZsb3dFbHQuSWQsIGxhYmVsLCBkaWFnRWx0LkJvdW5kcy5YLCBkaWFnRWx0LkJvdW5kcy5ZLCBkaWFnRWx0LkJvdW5kcy5XaWR0aCwgZGlhZ0VsdC5Cb3VuZHMuSGVpZ2h0LCBzdHlsZSkgYXMgQ2VsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNlbGwgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnN0IGNlbGwgPSB0aGlzLmluc2VydFZlcnRleCh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSwgZmxvd0VsdC5JZCwgbGFiZWwsIGRpYWdFbHQuQm91bmRzLlgsIGRpYWdFbHQuQm91bmRzLlksIGRpYWdFbHQuQm91bmRzLldpZHRoLCBkaWFnRWx0LkJvdW5kcy5IZWlnaHQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgIGNlbGwuZmxvd0VsZW1lbnQgPSBmbG93RWx0O1xyXG4gICAgICAgIGNlbGwuZGlhZ3JhbUVsZW1lbnQgPSBkaWFnRWx0O1xyXG4gICAgICAgIHRoaXMubW92ZUNlbGxzKFtjZWxsXSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdGhpcy5nZXREZWZhdWx0UGFyZW50KCkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55S76L+e57q/XHJcbiAgICAgKi9cclxuICAgIGRyYXdFZGdlQ2VsbHMoXHJcbiAgICAgICAgZmxvd0RpY3Q6IHsgW2tleTogc3RyaW5nXTogRmxvd0VsZW1lbnQ7IH0sXHJcbiAgICAgICAgZWRnZURpY3Q6IHsgW0JwbW5FbGVtZW50SWQ6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9LFxyXG4gICAgICAgIGFkZGl0aW9uYWw6IGJvb2xlYW4gPSBmYWxzZSxcclxuICAgICAgICBjdXQ6IGJvb2xlYW4gPSBmYWxzZSxcclxuICAgICkge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKGVkZ2VEaWN0KS5mb3JFYWNoKChicG1uTW9kZWxFbGVtZW50SWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmbG93RWx0ID0gZmxvd0RpY3RbYnBtbk1vZGVsRWxlbWVudElkXSBhcyBTZXF1ZW5jZUZsb3c7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpYWdFbHQgPSBlZGdlRGljdFticG1uTW9kZWxFbGVtZW50SWRdIGFzIEJQTU5FZGdlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZsb3dFbHQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRyYXdFZGdlQ2VsbChmbG93RWx0LCBkaWFnRWx0LCBhZGRpdGlvbmFsLCBjdXQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUganVkZ2VDb25uZWN0QmV0d2VlblR3b05vZGVzKGZsb3dEaWN0OiB7IFtrZXk6IHN0cmluZ106IEZsb3dFbGVtZW50OyB9LCBzb3VyY2VJZDogc3RyaW5nLCB0YXJnZXRJZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3Qgc291cmNlID0gZmxvd0RpY3Rbc291cmNlSWRdIGFzIEZsb3dOb2RlO1xyXG4gICAgICAgIGNvbnN0IG91dEdvaW5ncyA9IHNvdXJjZS5PdXRnb2luZ3M7XHJcbiAgICAgICAgaWYgKCFvdXRHb2luZ3MgfHwgb3V0R29pbmdzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3Qgb3V0R29pbmcgb2Ygb3V0R29pbmdzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlcXVlbmNlRmxvdyA9IGZsb3dEaWN0W291dEdvaW5nXSBhcyBTZXF1ZW5jZUZsb3c7XHJcbiAgICAgICAgICAgIGlmIChzZXF1ZW5jZUZsb3cuVGFyZ2V0UmVmID09PSB0YXJnZXRJZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55S75Y2V5p2h6L+e57q/XHJcbiAgICAgKiBAcGFyYW0gZmxvd0VsdFxyXG4gICAgICogQHBhcmFtIGRpYWdFbHRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsXHJcbiAgICAgKiBAcGFyYW0gY3V0XHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBkcmF3RWRnZUNlbGwoZmxvd0VsdDogU2VxdWVuY2VGbG93LCBkaWFnRWx0OiBCUE1ORWRnZSwgYWRkaXRpb25hbDogYm9vbGVhbiwgY3V0OiBib29sZWFuKSB7XHJcbiAgICAgICAgLy8g6I635Y+W5bey5o+S5YWl55qE6IqC54K55YWD57SgXHJcbiAgICAgICAgY29uc3Qgbm9kZUNlbGxzID0gKHRoaXMuZ2V0Q2hpbGRDZWxscyh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSwgdHJ1ZSkgfHwgW10pIGFzIENlbGxbXTtcclxuICAgICAgICBjb25zdCBzb3VyY2UgPSBub2RlQ2VsbHMuZmluZCgoaXQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0LmZsb3dFbGVtZW50ICYmIGl0LmZsb3dFbGVtZW50LklkID09PSBmbG93RWx0LlNvdXJjZVJlZjtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCB0YXJnZXQgPSBub2RlQ2VsbHMuZmluZCgoaXQpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0LmZsb3dFbGVtZW50ICYmIGl0LmZsb3dFbGVtZW50LklkID09PSBmbG93RWx0LlRhcmdldFJlZjtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgbWFwLnNldCgnYWRkaXRpb25hbCcsIGFkZGl0aW9uYWwpO1xyXG4gICAgICAgIG1hcC5zZXQoJ2N1dCcsIGN1dCk7XHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSB0aGlzLmdldEVkZ2VTdHlsZShmbG93RWx0LCBkaWFnRWx0LCBtYXApO1xyXG4gICAgICAgIGxldCBjZWxsOiBDZWxsID0gbnVsbDtcclxuICAgICAgICBsZXQgbGFiZWwgPSBcIlwiO1xyXG4gICAgICAgIGlmIChmbG93RWx0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgbGFiZWwgPSBmbG93RWx0Lk5hbWU7XHJcbiAgICAgICAgICAgIGlmIChmbG93RWx0Lk5hbWVMYW5ndWFnZSAmJiBmbG93RWx0Lk5hbWVMYW5ndWFnZVt0aGlzLmxhbmdDb2RlXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCA9IGZsb3dFbHQuTmFtZUxhbmd1YWdlW3RoaXMubGFuZ0NvZGVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzaW11bGF0aW9uJykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50cmFuc0luc0xpc3QuZmluZEluZGV4KGEgPT4gYS5zb3VyY2VBY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5Tb3VyY2VSZWZcclxuICAgICAgICAgICAgICAgICYmIGEuZGVzdGluYXRpb25BY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5UYXJnZXRSZWYpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIGNlbGwgPSB0aGlzLmluc2VydEVkZ2UodGhpcy5nZXREZWZhdWx0UGFyZW50KCksIGZsb3dFbHQuSWQsIGxhYmVsLCBzb3VyY2UsIHRhcmdldCwgc3R5bGUpIGFzIENlbGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWRkaXRpb25hbCB8fCBjdXQpIHtcclxuICAgICAgICAgICAgICAgIGNlbGwgPSB0aGlzLmluc2VydEVkZ2UodGhpcy5nZXREZWZhdWx0UGFyZW50KCksIGZsb3dFbHQuSWQsIGxhYmVsLCBzb3VyY2UsIHRhcmdldCwgc3R5bGUpIGFzIENlbGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjZWxsID0gdGhpcy5pbnNlcnRFZGdlKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgc291cmNlLCB0YXJnZXQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNlbGwgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnN0IGNlbGwgPSB0aGlzLmluc2VydEVkZ2UodGhpcy5nZXREZWZhdWx0UGFyZW50KCksIGZsb3dFbHQuSWQsIGxhYmVsLCBzb3VyY2UsIHRhcmdldCwgc3R5bGUpIGFzIENlbGw7XHJcbiAgICAgICAgLy8gY2VsbC5nZW9tZXRyeS5yZWxhdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgY2VsbC5mbG93RWxlbWVudCA9IGZsb3dFbHQ7XHJcbiAgICAgICAgY2VsbC5kaWFncmFtRWxlbWVudCA9IGRpYWdFbHQ7XHJcbiAgICAgICAgY2VsbC5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgY2VsbC50YXJnZXQgPSB0YXJnZXQ7XHJcblxyXG4gICAgICAgIGNlbGwuZ2VvbWV0cnkucG9pbnRzID0gY2VsbC5nZW9tZXRyeS5wb2ludHMgfHwgW107XHJcblxyXG4gICAgICAgIC8vIOWIpOaWreaYr+WQpuS4uuaXp+eJiOacrOi/nue6v1xyXG4gICAgICAgIGlmICh0aGlzLmlzT2xkQnBtbkVkZ2UoZGlhZ0VsdCkpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDI7IGkgPCBkaWFnRWx0LlBvaW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHQgPSBkaWFnRWx0LlBvaW50c1tpXTtcclxuICAgICAgICAgICAgICAgIGNlbGwuZ2VvbWV0cnkucG9pbnRzLnB1c2gobmV3IG14UG9pbnQocHQuWCwgcHQuWSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmraTooYzku6PnoIHmiafooYzlkI7lj6/ojrflj5ZteENlbGxTdGF0ZVxyXG4gICAgICAgICAgICB0aGlzLm1vdmVDZWxscyhbY2VsbF0sIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpKTtcclxuXHJcbiAgICAgICAgICAgIC8v5oyJ5Z2Q5qCH5o+S5YWlbGFiZWxcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnZpZXcuZ2V0U3RhdGUoY2VsbCk7XHJcbiAgICAgICAgICAgIGlmIChkaWFnRWx0LkJwbW5MYWJlbCAmJiBzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5YID09PSAwICYmIGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5ZID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5YICsgKHN0YXRlLnggLSBzdGF0ZS5wYWludEJvdW5kcy54KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBkaWFnRWx0LkJwbW5MYWJlbC5Cb3VuZHMuWSArIChzdGF0ZS55IC0gc3RhdGUucGFpbnRCb3VuZHMueSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgZWRnZUhhbmRsZXI6IE14R3JhcGhOUy5teEVkZ2VIYW5kbGVyID0gdGhpcy5jcmVhdGVFZGdlSGFuZGxlcihzdGF0ZSwgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgICAgIGVkZ2VIYW5kbGVyLm1vdmVMYWJlbChzdGF0ZSwgeCwgeSk7XHJcbiAgICAgICAgICAgICAgICBlZGdlSGFuZGxlci5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGRpYWdFbHQuUG9pbnRzLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHQgPSBkaWFnRWx0LlBvaW50c1tpXTtcclxuICAgICAgICAgICAgICAgIGNlbGwuZ2VvbWV0cnkucG9pbnRzLnB1c2gobmV3IG14UG9pbnQocHQuWCwgcHQuWSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyDmraTooYzku6PnoIHmiafooYzlkI7lj6/ojrflj5ZteENlbGxTdGF0ZVxyXG4gICAgICAgICAgICB0aGlzLm1vdmVDZWxscyhbY2VsbF0sIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpKTtcclxuXHJcbiAgICAgICAgICAgIC8v5oyJ5Z2Q5qCH5o+S5YWlbGFiZWxcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnZpZXcuZ2V0U3RhdGUoY2VsbCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy52aWV3LmdldFNjYWxlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZSA9IHRoaXMudmlldy5nZXRUcmFuc2xhdGUoKTtcclxuICAgICAgICAgICAgaWYgKGRpYWdFbHQuQnBtbkxhYmVsICYmIHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlhZ0VsdC5CcG1uTGFiZWwuQm91bmRzLlggPT09IDAgJiYgZGlhZ0VsdC5CcG1uTGFiZWwuQm91bmRzLlkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCB4ID0gZGlhZ0VsdC5CcG1uTGFiZWwuQm91bmRzLlggKiBzY2FsZSArIHRyYW5zbGF0ZS54O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5ZICogc2NhbGUgKyB0cmFuc2xhdGUueTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBlZGdlSGFuZGxlcjogTXhHcmFwaE5TLm14RWRnZUhhbmRsZXIgPSB0aGlzLmNyZWF0ZUVkZ2VIYW5kbGVyKHN0YXRlLCB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICAgICAgZWRnZUhhbmRsZXIubW92ZUxhYmVsKHN0YXRlLCB4LCB5KTtcclxuICAgICAgICAgICAgICAgIGVkZ2VIYW5kbGVyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaehOW7ukZsb3dFbGVtZW505a2X5YW477yMeyBbZmxvd0VsdElkOiBzdHJpbmddOiBGbG93RWxlbWVudCB9XHJcbiAgICAgKi9cclxuICAgIGJ1aWxkRmxvd0RpY3QoYnBtbk1vZGVsOiBCcG1uTW9kZWwpIHtcclxuICAgICAgICBsZXQgZmxvd0RpY3QgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0Rmxvd0VsZW1lbnRzKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBmbG93RGljdDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaehOW7ukRpYWdyYW1FbGVtZW505a2X5YW477yMeyBbZmxvd0VsdElkOiBzdHJpbmddOiBEaWFncmFtRWxlbWVudCB9XHJcbiAgICAgKi9cclxuICAgIGJ1aWxkRmxvd0RpYWdEaWN0KGJwbW5Nb2RlbDogQnBtbk1vZGVsKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZURpY3Q6IHsgW0JwbW5FbGVtZW50SWQ6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9ID0ge307XHJcbiAgICAgICAgY29uc3QgZWRnZURpY3Q6IHsgW0JwbW5FbGVtZW50SWQ6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9ID0ge307XHJcblxyXG4gICAgICAgIGNvbnN0IGRpYWdyYW1FbHRzOiAoRGlhZ3JhbUVsZW1lbnQgJiB7IEJwbW5FbGVtZW50SWQ6IHN0cmluZzsgfSlbXSA9IGJwbW5Nb2RlbC5EZWZhdWx0RGlhZ3JhbS5CcG1uUGxhbmUuR2V0RGlhZ3JhbUVsZW1lbnRzKCkgYXMgYW55O1xyXG5cclxuICAgICAgICBkaWFncmFtRWx0cyAmJiBkaWFncmFtRWx0cy5mb3JFYWNoKGVsdCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlbHQgaW5zdGFuY2VvZiBOb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlRGljdFtlbHQuQnBtbkVsZW1lbnRJZF0gPSBlbHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWx0IGluc3RhbmNlb2YgRWRnZSkge1xyXG4gICAgICAgICAgICAgICAgZWRnZURpY3RbZWx0LkJwbW5FbGVtZW50SWRdID0gZWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG5vZGVEaWN0LFxyXG4gICAgICAgICAgICBlZGdlRGljdCxcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKTmlq3mmK/lkKbkuLrml6fniYjmnKxCUE1ORWRnZVxyXG4gICAgICpcclxuICAgICAqIOaXp+eJiOacrOi/nue6v1BvaW50c+aVsOe7hOS4rVswXeWSjFsxXeWIhuWIq+ihqOekuui1t+eCueWSjOe7iOeCue+8jOWboOWPluWAvOmUmeivr++8jFswXeWSjFsxXeWdkOagh+Wdh+S4uigwLDAp77yM5Lul5q2k5Li65L6d5o2u5Yik5pat5piv5ZCm5Li65pen54mI5pys55qE6L+e57q/XHJcbiAgICAgKiDmlrDniYjmnKzku47otbfngrnliLDnu4jngrnmjInpobrluo/orrDlvZXmr4/kuIDkuKrngrnlnZDmoIdcclxuICAgICAqIEBwYXJhbSBicG1uRWRnZVxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgaXNPbGRCcG1uRWRnZShicG1uRWRnZTogQlBNTkVkZ2UpIHtcclxuICAgICAgICBpZiAoYnBtbkVkZ2UuUG9pbnRzLmxlbmd0aCA+PSAyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHB0MSA9IGJwbW5FZGdlLlBvaW50c1swXTtcclxuICAgICAgICAgICAgY29uc3QgcHQyID0gYnBtbkVkZ2UuUG9pbnRzWzFdO1xyXG4gICAgICAgICAgICBpZiAocHQxLlggPT0gMCAmJiBwdDEuWSA9PSAwICYmIHB0Mi5YID09IDAgJiYgcHQyLlkgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6IqC54K55qC35byPXHJcbiAgICAgKiBAcGFyYW0gZmxvd0VsdFxyXG4gICAgICogQHBhcmFtIGRpYWdFbHRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBnZXRWZXJ0ZXhTdHlsZShmbG93RWx0OiBGbG93RWxlbWVudCwgZGlhZ0VsdDogQlBNTlNoYXBlLCBhZGRpdGlvbmFsOiBib29sZWFuKSB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJbnN0YW5jZVNsaW1zID0gdGhpcy5hY3RMaXN0O1xyXG5cclxuICAgICAgICBsZXQgc3RhdGVTaGFwZVN0eWxlOiBTdGF0ZVNoYXBlU3R5bGUgPSBudWxsO1xyXG4gICAgICAgIC8vIOeJueauiuWkhOeQhizkuJrliqHmtLvliqjopoHljZXni6zotYvmiJDkurrlt6Xmk43kvZznsbvlnovnmoTmoLflvI9cclxuICAgICAgICAvLyBpZiAoZmxvd0VsdC5DbHJUeXBlSUQgPT09IFVzZXJBY3Rpdml0eS5DbHJfVHlwZV9JRCkge1xyXG4gICAgICAgIC8vICAgc3RhdGVTaGFwZVN0eWxlID0gdGhpcy5jZWxsU3R5bGVDb25maWcuc2hhcGVTdHlsZURpYyAmJiB0aGlzLmNlbGxTdHlsZUNvbmZpZy5zaGFwZVN0eWxlRGljW2Zsb3dFbHQuQ2xyVHlwZUlEXTtcclxuICAgICAgICAvLyB9IGVsc2UgaWYgKGZsb3dFbHQuQ2xyVHlwZUlEID09PSBPcGVyYXRpb25BY3Rpdml0eS5DbHJfVHlwZV9JRCkge1xyXG4gICAgICAgIC8vICAgc3RhdGVTaGFwZVN0eWxlID0gdGhpcy5jZWxsU3R5bGVDb25maWcuc2hhcGVTdHlsZURpYyAmJiB0aGlzLmNlbGxTdHlsZUNvbmZpZy5zaGFwZVN0eWxlRGljW09wZXJhdGlvbkFjdGl2aXR5LkNscl9UeXBlX0lEXTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgaWYgKGZsb3dFbHQgaW5zdGFuY2VvZiBVc2VyQWN0aXZpdHkgJiYgZmxvd0VsdC5CaXpBY3Rpdml0eUlEICE9PSAnJykge1xyXG4gICAgICAgICAgICBzdGF0ZVNoYXBlU3R5bGUgPSB0aGlzLmNlbGxTdHlsZUNvbmZpZy5zaGFwZVN0eWxlRGljICYmIHRoaXMuY2VsbFN0eWxlQ29uZmlnLnNoYXBlU3R5bGVEaWNbT3BlcmF0aW9uQWN0aXZpdHkuQ2xyX1R5cGVfSURdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN0YXRlU2hhcGVTdHlsZSA9IHRoaXMuY2VsbFN0eWxlQ29uZmlnLnNoYXBlU3R5bGVEaWMgJiYgdGhpcy5jZWxsU3R5bGVDb25maWcuc2hhcGVTdHlsZURpY1tmbG93RWx0LkNsclR5cGVJRF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdGF0ZVNoYXBlU3R5bGUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWZXJ0ZXhTdHlsZU9sZChmbG93RWx0LCBhZGRpdGlvbmFsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGltZzogc3RyaW5nID0gc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuRGVmYXVsdF0gJiYgc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuRGVmYXVsdF0uaW1hZ2U7XHJcbiAgICAgICAgaWYgKCFhZGRpdGlvbmFsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdHMgPSBhY3Rpdml0eUluc3RhbmNlU2xpbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5hY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5JZCk7XHJcbiAgICAgICAgICAgIGlmIChhY3RzICYmIGFjdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjdHMuZmlsdGVyKGFjdCA9PiBhY3Quc3RhdGUgPT09ICdSVU5OSU5HJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVNoYXBlU3R5bGVbRmxvd05vZGVTdGF0ZS5SdW5uaW5nXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSBzdGF0ZVNoYXBlU3R5bGVbRmxvd05vZGVTdGF0ZS5SdW5uaW5nXS5pbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdHMuZmlsdGVyKGFjdCA9PiBhY3Quc3RhdGUgPT09ICdDT01QTEVURUQnKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlU2hhcGVTdHlsZVtGbG93Tm9kZVN0YXRlLkNvbXBsZXRlZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuQ29tcGxldGVkXS5pbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdHMuZmlsdGVyKGFjdCA9PiBhY3Quc3RhdGUgPT09ICdURVJNSU5BVEVEJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVNoYXBlU3R5bGVbRmxvd05vZGVTdGF0ZS5UZXJtaW5hdGVkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSBzdGF0ZVNoYXBlU3R5bGVbRmxvd05vZGVTdGF0ZS5UZXJtaW5hdGVkXS5pbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGltZyA9PSBudWxsID8gbnVsbCA6ICdpbWFnZT0nICsgdGhpcy5yb290UGF0aCArIGltZztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaXp+eJiGRpYWdyYW1FbGVtZW505pyq5a2Y5YKo5qC35byP5L+h5oGvXHJcbiAgICAgKiBAcGFyYW0gZmxvd0VsdFxyXG4gICAgICogQHBhcmFtIGFkZGl0aW9uYWxcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGdldFZlcnRleFN0eWxlT2xkKGZsb3dFbHQ6IEZsb3dFbGVtZW50LCBhZGRpdGlvbmFsOiBib29sZWFuKSB7XHJcbiAgICAgICAgbGV0IHN0eWxlOiBzdHJpbmc7XHJcbiAgICAgICAgc3dpdGNoIChmbG93RWx0LkNsclR5cGVJRCkge1xyXG4gICAgICAgICAgICAvL+e7k+adn+S6i+S7tlxyXG4gICAgICAgICAgICBjYXNlIFwiYnBtbi5FbmRFdmVudFwiOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnZW5kJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAvL+a1geeoi+W8gOWni+a0u+WKqOiKgueCuVxyXG4gICAgICAgICAgICBjYXNlIFN0YXJ0QWN0aXZpdHkuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9ICdzdGFydCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgLy8g5Lia5Yqh5rS75Yqo6IqC54K5XHJcbiAgICAgICAgICAgIGNhc2UgVXNlckFjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgaWYgKChmbG93RWx0IGFzIFVzZXJBY3Rpdml0eSkuQml6QWN0aXZpdHlJRCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlID0gJ2JpekFjdGl2aXR5JztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGUgPSAnYXBwcm92YWwnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8vIOaOkuS7lue9keWFs1xyXG4gICAgICAgICAgICBjYXNlICdicG1uLkV4Y2x1c2l2ZUdhdGV3YXknOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnRXhjbHVzaXZlR2F0ZXdheSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgLy/lubbooYznvZHlhbNcclxuICAgICAgICAgICAgY2FzZSAnYnBtbi5QYXJhbGxlbEdhdGV3YXknOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnUGFyYWxsZWxHYXRld2F5JztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENhbGxBY3Rpdml0eVN1YlByb2Nlc3MuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9ICdzdWInO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQXV0b0FjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnYXV0byc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbC5DbHJfVHlwZV9JRDpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ2NhdGNoRXZlbnQnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgT3BlcmF0aW9uQWN0aXZpdHkuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9ICdiaXpBY3Rpdml0eSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBNZXNzYWdlQWN0aXZpdHkuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9ICdtZXNzYWdlJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIE5vdGlmeUFjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnbm90aWZ5JztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEFpZkNyZWF0aW9uQmlsbEFjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnYWlmQ3JlYXRpb25BY3Rpdml0eSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJ2ltYWdlPScgKyB0aGlzLnJvb3RQYXRoICsgJy9wbGF0Zm9ybS9ydW50aW1lL2NvbW1vbi93ZWIvQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci9pbWFnZXMvJyArIHN0eWxlICsgdGhpcy5nZXRDaGFydFN0YXRlKGZsb3dFbHQsIGFkZGl0aW9uYWwpICsgJzsnO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENoYXJ0U3RhdGUoZmxvd0VsdDogRmxvd0VsZW1lbnQsIGFkZGl0aW9uYWw6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAoIWFkZGl0aW9uYWwpIHtcclxuICAgICAgICAgICAgY29uc3QgYWN0cyA9IHRoaXMuYWN0TGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLmFjdGl2aXR5RGVmaW5pdGlvbklkID09PSBmbG93RWx0LklkKTtcclxuICAgICAgICAgICAgaWYgKGFjdHMgJiYgYWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0cy5maWx0ZXIoYWN0ID0+IGFjdC5zdGF0ZSA9PT0gJ1JVTk5JTkcnKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdfbGlnaHQuZ2lmJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0cy5maWx0ZXIoYWN0ID0+IGFjdC5zdGF0ZSA9PT0gJ0NPTVBMRVRFRCcpLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICAgICAgICB8fCBhY3RzLmZpbHRlcihhY3QgPT4gYWN0LnN0YXRlID09PSAnVEVSTUlOQVRFRCcpLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnX2dyYXkucG5nJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcucG5nJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJy5wbmcnO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W6L+e57q/5qC35byPXHJcbiAgICAgKiBAcGFyYW0gZmxvd0VsdFxyXG4gICAgICogQHBhcmFtIGFkZGl0aW9uYWxcclxuICAgICAqIEBwYXJhbSBjdXRcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGdldEVkZ2VTdHlsZShmbG93RWx0OiBTZXF1ZW5jZUZsb3csIGRpYWdFbHQ6IEJQTU5FZGdlLCBwYXJhbWV0ZXJzOiBNYXA8c3RyaW5nLCBib29sZWFuPikge1xyXG4gICAgICAgIGlmIChwYXJhbWV0ZXJzLmdldCgnanVtcCcpKSB7XHJcbiAgICAgICAgICAgIGxldCBzdHlsZSA9ICcnO1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ZUVkZ2VTdHlsZSA9IHRoaXMuY2VsbFN0eWxlQ29uZmlnLmVkZ2VTdHlsZURpYyAmJiB0aGlzLmNlbGxTdHlsZUNvbmZpZy5lZGdlU3R5bGVEaWNbJ2JwbW4uU2VxdWVuY2VGbG93J107XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVsnanVtcCddKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhzdGF0ZUVkZ2VTdHlsZVsnanVtcCddKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZSArPSAoYCR7a2V5fT0ke3N0YXRlRWRnZVN0eWxlWydqdW1wJ11ba2V5XX07YCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ZUVkZ2VTdHlsZSA9IHRoaXMuY2VsbFN0eWxlQ29uZmlnLmVkZ2VTdHlsZURpYyAmJiB0aGlzLmNlbGxTdHlsZUNvbmZpZy5lZGdlU3R5bGVEaWNbZmxvd0VsdC5DbHJUeXBlSURdO1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RWRnZVN0eWxlT2xkKGZsb3dFbHQsIHBhcmFtZXRlcnMuZ2V0KCdhZGRpdGlvbmFsJyksIHBhcmFtZXRlcnMuZ2V0KCdjdXQnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdHJhbnNpdGlvbkluc3RhbmNlU2xpbXMgPSB0aGlzLnRyYW5zSW5zTGlzdDtcclxuICAgICAgICAgICAgbGV0IHN0eWxlID0gJyc7XHJcbiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJzLmdldCgnY3V0JykpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5DdXRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQ3V0XSkuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlICs9IChgJHtrZXl9PSR7c3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQ3V0XVtrZXldfTtgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHBhcmFtZXRlcnMuZ2V0KCdhZGRpdGlvbmFsJykpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5BZGRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQWRkXSkuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlICs9IChgJHtrZXl9PSR7c3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQWRkXVtrZXldfTtgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdHJhbnNJbnMgPSB0cmFuc2l0aW9uSW5zdGFuY2VTbGltcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnNvdXJjZUFjdGl2aXR5RGVmaW5pdGlvbklkID09PSBmbG93RWx0LlNvdXJjZVJlZiAmJiBpdGVtLmRlc3RpbmF0aW9uQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuVGFyZ2V0UmVmKTtcclxuICAgICAgICAgICAgaWYgKHRyYW5zSW5zICYmIHRyYW5zSW5zLmZpbHRlcih0ID0+IHQuc3RhdGUgPT09ICdDT01QTEVURUQnKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQ29tcGxldGVkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkNvbXBsZXRlZF0pLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSArPSAoYCR7a2V5fT0ke3N0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkNvbXBsZXRlZF1ba2V5XX07YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzaW11bGF0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLlNpbXVsYXRpb25dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuU2ltdWxhdGlvbl0pLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSArPSAoYCR7a2V5fT0ke3N0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLlNpbXVsYXRpb25dW2tleV19O2ApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuRGVmYXVsdF0pIHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkRlZmF1bHRdKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZSArPSAoYCR7a2V5fT0ke3N0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkRlZmF1bHRdW2tleV19O2ApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlui/nue6v+minOiJslxyXG4gICAgICogQHBhcmFtIGZsb3dFbHRcclxuICAgICAqIEBwYXJhbSBkaWFnRWx0XHJcbiAgICAgKiBAcGFyYW0gYWRkaXRpb25hbFxyXG4gICAgICogQHBhcmFtIGN1dFxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgZ2V0U3Ryb2tlQ29sb3IoZmxvd0VsdDogU2VxdWVuY2VGbG93LCBkaWFnRWx0OiBCUE1ORWRnZSwgYWRkaXRpb25hbDogYm9vbGVhbiwgY3V0OiBib29sZWFuKSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNpdGlvbkluc3RhbmNlU2xpbXMgPSB0aGlzLnRyYW5zSW5zTGlzdDtcclxuXHJcbiAgICAgICAgY29uc3Qgc3RhdGVFZGdlU3R5bGUgPSB0aGlzLmNlbGxTdHlsZUNvbmZpZy5lZGdlU3R5bGVEaWMgJiYgdGhpcy5jZWxsU3R5bGVDb25maWcuZWRnZVN0eWxlRGljW2Zsb3dFbHQuQ2xyVHlwZUlEXTtcclxuXHJcblxyXG4gICAgICAgIGlmIChjdXQpIHtcclxuICAgICAgICAgICAgaWYgKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkN1dF0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5DdXRdLnN0cm9rZUNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhZGRpdGlvbmFsKSB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5BZGRdKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQWRkXS5zdHJva2VDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0cmFuc0lucyA9IHRyYW5zaXRpb25JbnN0YW5jZVNsaW1zLmZpbHRlcihpdGVtID0+IGl0ZW0uc291cmNlQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuU291cmNlUmVmICYmIGl0ZW0uZGVzdGluYXRpb25BY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5UYXJnZXRSZWYpO1xyXG4gICAgICAgIGlmICh0cmFuc0lucyAmJiB0cmFuc0lucy5maWx0ZXIodCA9PiB0LnN0YXRlID09PSAnQ09NUExFVEVEJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQ29tcGxldGVkXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkNvbXBsZXRlZF0uc3Ryb2tlQ29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3NpbXVsYXRpb24nKSB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5TaW11bGF0aW9uXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLlNpbXVsYXRpb25dLnN0cm9rZUNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5EZWZhdWx0XS5zdHJva2VDb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaXp+eJiGRpYWdyYW1FbGVtZW505pyq5a2Y5YKo5qC35byP5L+h5oGvXHJcbiAgICAgKiBAcGFyYW0gZmxvd0VsdFxyXG4gICAgICogQHBhcmFtIGFkZGl0aW9uYWxcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGdldEVkZ2VTdHlsZU9sZChzZXE6IFNlcXVlbmNlRmxvdywgYWRkaXRpb25hbDogYm9vbGVhbiwgY3V0OiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKGN1dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ3N0cm9rZUNvbG9yPSNGRjQwNDAnXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhZGRpdGlvbmFsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnc3Ryb2tlQ29sb3I9IzU5QTFGRic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRyYW5zSW5zID0gdGhpcy50cmFuc0luc0xpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zb3VyY2VBY3Rpdml0eURlZmluaXRpb25JZCA9PT0gc2VxLlNvdXJjZVJlZiAmJiBpdGVtLmRlc3RpbmF0aW9uQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IHNlcS5UYXJnZXRSZWYpO1xyXG4gICAgICAgIGlmICh0cmFuc0lucyAmJiB0cmFuc0lucy5maWx0ZXIodCA9PiB0LnN0YXRlID09PSAnQ09NUExFVEVEJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ3N0cm9rZUNvbG9yPSM1OTU5NTk7c3Ryb2tlV2lkdGg9MjsnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5tb2RlID09PSAnc2ltdWxhdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdzdHJva2VDb2xvcj0jZjU5YzI0O2Rhc2hlZD0xOyc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICdzdHJva2VDb2xvcj0jNTlBMUZGOyc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRyYXdOZXh0Rmxvd0NoYXJ0KFxyXG4gICAgICAgIGFjdGlEZWZJZDogc3RyaW5nLFxyXG4gICAgICAgIG5vZGVEaWN0OiB7IFtrZXk6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9LFxyXG4gICAgICAgIGVkZ2VEaWN0OiB7IFtCcG1uRWxlbWVudElkOiBzdHJpbmddOiBEaWFncmFtRWxlbWVudDsgfSxcclxuICAgICkge1xyXG4gICAgICAgIGNvbnN0IHsgbmV4dEZsb3dOb2RlRGljdCwgbmV4dFNlcUZsb3dEaWN0IH0gPSB0aGlzLmZpbmREcmF3Rmxvd0VsZW1lbnRzQnlBY3REZWZJZChhY3RpRGVmSWQsIHRoaXMuYnBtbk1vZGVsKTtcclxuICAgICAgICBjb25zdCBhY3REZWYgPSB0aGlzLmJwbW5Nb2RlbC5EZWZhdWx0UHJvY2Vzcy5HZXRGbG93RWxlbWVudChhY3RpRGVmSWQpIGFzIEZsb3dOb2RlO1xyXG4gICAgICAgIGNvbnN0IG91dGdvaW5ncyA9IGFjdERlZi5PdXRnb2luZ3M7XHJcblxyXG4gICAgICAgIC8vIOWFiOaPkuWFpeiKgueCuVxyXG4gICAgICAgIE9iamVjdC5rZXlzKG5leHRGbG93Tm9kZURpY3QpLmZvckVhY2goaWQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmbG93RWx0ID0gbmV4dEZsb3dOb2RlRGljdFtpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGRpYWdFbHQgPSBub2RlRGljdFtmbG93RWx0LklkXSBhcyBCUE1OU2hhcGU7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmdldENlbGxCeUZsb3dFbGVtZW50SWQoZmxvd0VsdC5JZCk7XHJcbiAgICAgICAgICAgIGlmICghY2VsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3Tm9kZUNlbGwoZmxvd0VsdCwgZGlhZ0VsdCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g5YaN5o+S5YWl6L65XHJcbiAgICAgICAgT2JqZWN0LmtleXMobmV4dFNlcUZsb3dEaWN0KS5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmxvd0VsdCA9IG5leHRTZXFGbG93RGljdFtpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IGRpYWdFbHQgPSBlZGdlRGljdFtmbG93RWx0LklkXSBhcyBCUE1ORWRnZTtcclxuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuZ2V0Q2VsbEJ5Rmxvd0VsZW1lbnRJZChmbG93RWx0LklkKTtcclxuICAgICAgICAgICAgaWYgKCFjZWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3V0Z29pbmdzLnNvbWUobyA9PiBvID09PSBmbG93RWx0LklkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0VkZ2VDZWxsKGZsb3dFbHQsIGRpYWdFbHQsIHRydWUsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdFZGdlQ2VsbChmbG93RWx0LCBkaWFnRWx0LCB0cnVlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNrmZsb3dFbGVtZW50SWTojrflj5ZjZWxsXHJcbiAgICAgKi9cclxuICAgIGdldENlbGxCeUZsb3dFbGVtZW50SWQoZmxvd0VsdElkOiBzdHJpbmcsIHBhcmVudD86IE14R3JhcGhOUy5teENlbGwpOiBDZWxsIHtcclxuICAgICAgICBwYXJlbnQgPSBwYXJlbnQgPyBwYXJlbnQgOiB0aGlzLmdldERlZmF1bHRQYXJlbnQoKTtcclxuICAgICAgICBjb25zdCBjZWxscyA9IHRoaXMuZ2V0Q2hpbGRDZWxscyhwYXJlbnQpO1xyXG4gICAgICAgIGNvbnN0IGNlbGwgPSBjZWxscy5maW5kKGl0ID0+IHtcclxuICAgICAgICAgICAgaWYgKGl0IGluc3RhbmNlb2YgQ2VsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0LmZsb3dFbGVtZW50ICYmIGl0LmZsb3dFbGVtZW50LklkID09IGZsb3dFbHRJZDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pIGFzIENlbGw7XHJcbiAgICAgICAgcmV0dXJuIGNlbGw7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZEZpcnN0U3RhcnRBY3Rpdml0eUluc3RhbmNlKGFjdGl2aXRpZXM6IEFjdGl2aXR5SW5zdGFuY2VTbGltW10pOiBBY3Rpdml0eUluc3RhbmNlU2xpbSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBhY3Qgb2YgYWN0aXZpdGllcykge1xyXG4gICAgICAgICAgICBpZiAoIWFjdC5wcmVjdXJzb3JBY3Rpdml0eURlZmluaXRpb25JZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kTm9JbmNvbWluZ05vZGVzKG5vZGVDZWxsczogQ2VsbFtdKSB7XHJcbiAgICAgICAgY29uc3Qgbm9JbmNvbWluZ05vZGVzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVDZWxscykge1xyXG4gICAgICAgICAgICBpZiAobm9kZS5mbG93RWxlbWVudC5DbHJUeXBlSUQgPT09ICd3Zi5TdGFydEFjdGl2aXR5Jykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFub2RlLmVkZ2VzIHx8IG5vZGUuZWRnZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBub0luY29taW5nTm9kZXMucHVzaChub2RlKTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghbm9kZS5lZGdlcy5zb21lKGVkZ2UgPT4gKGVkZ2UudGFyZ2V0IGFzIENlbGwpLmZsb3dFbGVtZW50LklkID09PSBub2RlLmZsb3dFbGVtZW50LklkKSkge1xyXG4gICAgICAgICAgICAgICAgbm9JbmNvbWluZ05vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vSW5jb21pbmdOb2RlcztcclxuICAgIH1cclxuXHJcbiAgICBmaW5kRW5kQWN0aUluc3RMaXN0KGZpcnN0QWN0OiBBY3Rpdml0eUluc3RhbmNlU2xpbSwgYWN0aXZpdGllczogQWN0aXZpdHlJbnN0YW5jZVNsaW1bXSwgdHJhbnNJbnNMaXN0OiBUcmFuc2l0aW9uSW5zdGFuY2VTbGltW10pOiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdIHtcclxuICAgICAgICBjb25zdCBlbmRBY3RpSW5zdExpc3Q6IEFjdGl2aXR5SW5zdGFuY2VTbGltW10gPSBbXTtcclxuICAgICAgICB0aGlzLmdldE5leHRUcmFuc2l0aW9ucyhlbmRBY3RpSW5zdExpc3QsIGZpcnN0QWN0LmFjdGl2aXR5SW5zdGFuY2VJZCwgYWN0aXZpdGllcywgdHJhbnNJbnNMaXN0KTtcclxuICAgICAgICByZXR1cm4gZW5kQWN0aUluc3RMaXN0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldE5leHRUcmFuc2l0aW9ucyhlbmRBY3RpSW5zdExpc3Q6IEFjdGl2aXR5SW5zdGFuY2VTbGltW10sIHNvdXJjZUFjdEluc3RJZDogc3RyaW5nLCBhY3Rpdml0aWVzOiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdLCB0cmFuc0luc0xpc3Q6IFRyYW5zaXRpb25JbnN0YW5jZVNsaW1bXSkge1xyXG4gICAgICAgIGNvbnN0IG5leHRUcmFuc2l0aW9ucyA9IHRoaXMuZmluZFRyYW5JbnN0c0J5U291cmNlQWN0SW5zdElkKHNvdXJjZUFjdEluc3RJZCwgdHJhbnNJbnNMaXN0KTtcclxuICAgICAgICBpZiAobmV4dFRyYW5zaXRpb25zICYmIG5leHRUcmFuc2l0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBuZXh0VHJhbnNpdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0LmRlc3RpbmF0aW9uQWN0aXZpdHlEZWZpbml0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldE5leHRUcmFuc2l0aW9ucyhlbmRBY3RpSW5zdExpc3QsIHQuZGVzdGluYXRpb25BY3Rpdml0eUluc3RhbmNlSWQsIGFjdGl2aXRpZXMsIHRyYW5zSW5zTGlzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBhY3RJbnN0OiBBY3Rpdml0eUluc3RhbmNlU2xpbSA9IHRoaXMuZmluZEFjdEluc3RCeUFjdEluc3RJZChzb3VyY2VBY3RJbnN0SWQsIGFjdGl2aXRpZXMpO1xyXG4gICAgICAgICAgICBpZiAoYWN0SW5zdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlbmRBY3RpSW5zdExpc3Quc29tZShhID0+IGEuYWN0aXZpdHlJbnN0YW5jZUlkID09PSBhY3RJbnN0LmFjdGl2aXR5SW5zdGFuY2VJZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmRBY3RpSW5zdExpc3QucHVzaChhY3RJbnN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmaW5kVHJhbkluc3RzQnlTb3VyY2VBY3RJbnN0SWQoc291cmNlQWN0SW5zdElkOiBzdHJpbmcsIHRyYW5zSW5zTGlzdDogVHJhbnNpdGlvbkluc3RhbmNlU2xpbVtdKTogVHJhbnNpdGlvbkluc3RhbmNlU2xpbVtdIHtcclxuICAgICAgICByZXR1cm4gdHJhbnNJbnNMaXN0LmZpbHRlcih0ID0+IHQuc291cmNlQWN0aXZpdHlJbnN0YW5jZUlkID09PSBzb3VyY2VBY3RJbnN0SWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRBY3RJbnN0QnlBY3RJbnN0SWQoYWN0SW5zdElkOiBzdHJpbmcsIGFjdGl2aXRpZXM6IEFjdGl2aXR5SW5zdGFuY2VTbGltW10pIHtcclxuICAgICAgICByZXR1cm4gYWN0aXZpdGllcy5maW5kKGEgPT4gYS5hY3Rpdml0eUluc3RhbmNlSWQgPT09IGFjdEluc3RJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZERyYXdGbG93RWxlbWVudHNCeUFjdERlZklkKGFjdGlEZWZJZDogc3RyaW5nLCBicG1uTW9kZWw6IEJwbW5Nb2RlbCkge1xyXG4gICAgICAgIGNvbnN0IG5leHRGbG93Tm9kZURpY3Q6IHsgW2lkOiBzdHJpbmddOiBGbG93Tm9kZSB9ID0ge307XHJcbiAgICAgICAgY29uc3QgbmV4dFNlcUZsb3dEaWN0OiB7IFtpZDogc3RyaW5nXTogU2VxdWVuY2VGbG93IH0gPSB7fTtcclxuICAgICAgICB0aGlzLmZpbmROZXh0Rmxvd0VsZW1lbnRzQnlGbG93RWxlbWVudElkKG5leHRGbG93Tm9kZURpY3QsIG5leHRTZXFGbG93RGljdCwgYWN0aURlZklkLCBicG1uTW9kZWwpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG5leHRGbG93Tm9kZURpY3QsXHJcbiAgICAgICAgICAgIG5leHRTZXFGbG93RGljdCxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmROZXh0Rmxvd0VsZW1lbnRzQnlGbG93RWxlbWVudElkKG5leHRGbG93Tm9kZURpY3Q6IHsgW2lkOiBzdHJpbmddOiBGbG93Tm9kZSB9LCBuZXh0U2VxRmxvd0RpY3Q6IHsgW2lkOiBzdHJpbmddOiBTZXF1ZW5jZUZsb3cgfSwgZmxvd0VsZW1lbnRJZDogc3RyaW5nLCBicG1uTW9kZWw6IEJwbW5Nb2RlbCkge1xyXG4gICAgICAgIGNvbnN0IGZsb3dFbHQgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0Rmxvd0VsZW1lbnQoZmxvd0VsZW1lbnRJZCk7XHJcbiAgICAgICAgaWYgKGZsb3dFbHQgJiYgbmV4dEZsb3dOb2RlRGljdFtmbG93RWxlbWVudElkXSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChmbG93RWx0IGluc3RhbmNlb2YgU2VxdWVuY2VGbG93KSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0U2VxRmxvd0RpY3RbZmxvd0VsdC5JZF0gPSBmbG93RWx0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maW5kTmV4dEZsb3dFbGVtZW50c0J5Rmxvd0VsZW1lbnRJZChuZXh0Rmxvd05vZGVEaWN0LCBuZXh0U2VxRmxvd0RpY3QsIGZsb3dFbHQuVGFyZ2V0UmVmLCBicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZsb3dFbHQgaW5zdGFuY2VvZiBGbG93Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgbmV4dEZsb3dOb2RlRGljdFtmbG93RWx0LklkXSA9IGZsb3dFbHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGZsb3dFbHQgaW5zdGFuY2VvZiBFbmRFdmVudCkgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBmbG93RWx0Lk91dGdvaW5ncyAmJiBmbG93RWx0Lk91dGdvaW5ncy5mb3JFYWNoKG91dGdvaW5nID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kTmV4dEZsb3dFbGVtZW50c0J5Rmxvd0VsZW1lbnRJZChuZXh0Rmxvd05vZGVEaWN0LCBuZXh0U2VxRmxvd0RpY3QsIG91dGdvaW5nLCBicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
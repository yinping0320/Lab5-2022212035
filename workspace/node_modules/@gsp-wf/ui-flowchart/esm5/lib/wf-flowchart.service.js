/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { UIFlowchartComponent } from './task-flowchart/task-flowchart.component';
import { translate } from './services/i18n/index';
import { UiFlowchartService } from './services/ui-flowchart.service';
import { FrameworkService } from '@gsp-sys/rtf-common';
import { of } from 'rxjs';
import { HttpService } from '@ecp-caf/caf-common';
var WFFlowchartService = /** @class */ (function () {
    function WFFlowchartService(msgService, injector, resolver, modalService) {
        this.msgService = msgService;
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
        this.flowchartService = this.injector.get(UiFlowchartService);
        this.frameworkService = this.injector.get(FrameworkService);
    }
    /**
     * 查看流程图，支持预览
     * @param payload
     * @returns
     */
    /**
     * 查看流程图，支持预览
     * @param {?} payload
     * @return {?}
     */
    WFFlowchartService.prototype.viewProcess = /**
     * 查看流程图，支持预览
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        if (!payload || !payload.dataId) {
            this.msgService.warning(this.getI18nValue('static.flowchart.noDataId'));
            return;
        }
        if (!payload || !payload.bizDefKey) {
            this.msgService.warning(this.getI18nValue('static.flowchart.noBizDefKey'));
            return;
        }
        /** @type {?} */
        var parameters = new Map();
        parameters.set('dataId', payload.dataId);
        parameters.set('bizDefKey', payload.bizDefKey);
        if (payload.startMode) {
            parameters.set('startMode', payload.startMode);
        }
        if (payload.startUserId) {
            parameters.set('startUserId', payload.startUserId);
        }
        parameters.set('withTitle', true);
        /** @type {?} */
        var options = {
            appType: 'menu',
            funcId: 'WFViewFlowChart',
            appId: '',
            appEntrance: '',
            tabId: payload.dataId,
            isNewTab: true,
            queryStringParams: parameters
        };
        this.openMenu(options);
    };
    /**
     * 根据流程实例id查看流程（tab页中打开）
     * @param procInstId 流程实例ID
     */
    /**
     * 根据流程实例id查看流程（tab页中打开）
     * @param {?} procInstId 流程实例ID
     * @return {?}
     */
    WFFlowchartService.prototype.viewFlowChart = /**
     * 根据流程实例id查看流程（tab页中打开）
     * @param {?} procInstId 流程实例ID
     * @return {?}
     */
    function (procInstId) {
        if (!procInstId) {
            this.msgService.warning(this.getI18nValue('static.flowchart.processNotFound'));
            return;
        }
        /** @type {?} */
        var parameters = new Map();
        parameters.set('processId', procInstId);
        parameters.set('withTitle', true);
        /** @type {?} */
        var options = {
            appType: 'menu',
            funcId: 'WFViewFlowChart',
            appId: '',
            appEntrance: '',
            tabId: new Date().getTime().toString(),
            isNewTab: true,
            queryStringParams: parameters
        };
        this.openMenu(options);
    };
    /**
     * 根据单据内码查看流程
     * @param dataId 单据内码
     * @returns
     */
    /**
     * 根据单据内码查看流程
     * @param {?} dataId 单据内码
     * @return {?}
     */
    WFFlowchartService.prototype.viewFlowChartByDataId = /**
     * 根据单据内码查看流程
     * @param {?} dataId 单据内码
     * @return {?}
     */
    function (dataId) {
        if (!dataId) {
            this.msgService.warning(this.getI18nValue('static.flowchart.dataIdIsNull'));
            return;
        }
        /** @type {?} */
        var parameters = new Map();
        parameters.set('dataId', dataId);
        parameters.set('withTitle', true);
        /** @type {?} */
        var options = {
            appType: 'menu',
            funcId: 'WFViewFlowChart',
            appId: '',
            appEntrance: '',
            tabId: new Date().getTime().toString(),
            isNewTab: true,
            queryStringParams: parameters
        };
        this.openMenu(options);
    };
    /**
     * 查看流程（弹框中打开）
     * @param procInstId 流程实例ID
     */
    /**
     * 查看流程（弹框中打开）
     * @param {?} procInstId 流程实例ID
     * @param {?=} mode
     * @return {?}
     */
    WFFlowchartService.prototype.viewFlowChartByDialog = /**
     * 查看流程（弹框中打开）
     * @param {?} procInstId 流程实例ID
     * @param {?=} mode
     * @return {?}
     */
    function (procInstId, mode) {
        var _this = this;
        if (!procInstId) {
            this.msgService.warning(this.getI18nValue('static.flowchart.processNotFound'));
            return;
        }
        this.flowchartService.getProcessInstanceById(procInstId).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            if (re) {
                _this.viewMutiInstanceFlowChartByDialog([re]);
            }
        }));
    };
    /**
     * 查看流程（弹框中打开，兼容多实例子流程）
     * @param procInstId 流程实例ID
     */
    /**
     * 查看流程（弹框中打开，兼容多实例子流程）
     * @param {?} procInstList
     * @param {?=} mode
     * @return {?}
     */
    WFFlowchartService.prototype.viewMutiInstanceFlowChartByDialog = /**
     * 查看流程（弹框中打开，兼容多实例子流程）
     * @param {?} procInstList
     * @param {?=} mode
     * @return {?}
     */
    function (procInstList, mode) {
        /** @type {?} */
        var func;
        if (UIFlowchartComponent.func) {
            func = UIFlowchartComponent.func;
        }
        /** @type {?} */
        var options = {
            title: this.getI18nValue('static.flowchart.title'),
            width: 1200,
            height: 530,
            showButtons: false,
            beforeClose: (/**
             * @param {?} modalRef
             * @return {?}
             */
            function (modalRef) {
                if (UIFlowchartComponent.func) {
                    window.removeEventListener('message', UIFlowchartComponent.func, false);
                }
                if (func) {
                    window.addEventListener('message', func, false);
                    UIFlowchartComponent.func = func;
                }
                return of(true);
            })
        };
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(UIFlowchartComponent);
        /** @type {?} */
        var inj = Injector.create({
            providers: [{
                    provide: UiFlowchartService, useFactory: (/**
                     * @param {?} httpSvc
                     * @return {?}
                     */
                    function (httpSvc) {
                        return new UiFlowchartService(httpSvc);
                    }),
                    deps: [
                        HttpService
                    ]
                }], parent: this.injector
        });
        /** @type {?} */
        var compRef = compFactory.create(inj);
        if (procInstList && procInstList.length) {
            if (procInstList.length == 1) {
                options.showHeader = true;
                options.title = procInstList[0].name + '-v' + procInstList[0].version + '.0';
                compRef.instance.ProcInstId = procInstList[0].id;
            }
            else {
                options.showHeader = false;
                compRef.instance.ProcInstList = procInstList;
            }
        }
        if (mode) {
            compRef.instance.mode = mode;
        }
        compRef.instance.fill();
        /** @type {?} */
        var dialog = this.modalService.show(compRef, options);
        compRef.instance.dialog = dialog;
    };
    /**
     * 查看流程图。（如果作为共享的外部流程，则打开共享的查看流程）
     * @param procInstId 流程实例id
     * @param dataId 单据内码
     */
    /**
     * 查看流程图。（如果作为共享的外部流程，则打开共享的查看流程）
     * @param {?} procInstId 流程实例id
     * @param {?} dataId 单据内码
     * @return {?}
     */
    WFFlowchartService.prototype.viewFlowchartByProcInstIdAndDataId = /**
     * 查看流程图。（如果作为共享的外部流程，则打开共享的查看流程）
     * @param {?} procInstId 流程实例id
     * @param {?} dataId 单据内码
     * @return {?}
     */
    function (procInstId, dataId) {
        var _this = this;
        this.flowchartService.ifThirdTask(procInstId).subscribe((/**
         * @param {?} ifThirdTask
         * @return {?}
         */
        function (ifThirdTask) {
            if (ifThirdTask === true) { //是第三方的任务
                _this.flowchartService.getFsParamsByBizId(dataId).subscribe((/**
                 * @param {?} params
                 * @return {?}
                 */
                function (params) {
                    if (params) { //有不往共享单据表推数据的情况，此时返回为空
                        //有不往共享单据表推数据的情况，此时返回为空
                        /** @type {?} */
                        var param = {
                            "lcsl": params[0],
                            "djnm": params[1],
                            "djlx": params[2],
                            "djbh": params[3]
                        };
                        _this.flowchartService.viewFsProcessNew(param).subscribe((/**
                         * @param {?} re
                         * @return {?}
                         */
                        function (re) {
                            if (re && re.value) {
                                _this.openViewProcessMenu(re.value);
                            }
                        }), (/**
                         * @param {?} error
                         * @return {?}
                         */
                        function (error) {
                            _this.viewFlowChart(procInstId);
                        }));
                    }
                    else {
                        _this.viewFlowChart(procInstId);
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.viewFlowChart(procInstId);
                }));
            }
            else { //WF的任务
                _this.viewFlowChart(procInstId);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.viewFlowChart(procInstId);
        }));
    };
    /**
     * 共享的任务，借用自己的查看流程菜单，iframe嵌入共享的查看流程URL
     * @param entity 任务实体，区分tab页
     * @param url 共享查看流程的URL
     */
    /**
     * 共享的任务，借用自己的查看流程菜单，iframe嵌入共享的查看流程URL
     * @private
     * @param {?} url 共享查看流程的URL
     * @return {?}
     */
    WFFlowchartService.prototype.openViewProcessMenu = /**
     * 共享的任务，借用自己的查看流程菜单，iframe嵌入共享的查看流程URL
     * @private
     * @param {?} url 共享查看流程的URL
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var queryParams = new Map();
        queryParams.set("thirdTask", true);
        /** @type {?} */
        var entityParams = new Map();
        entityParams.set("thirdProcessUrl", url);
        /** @type {?} */
        var options = {
            appType: 'menu',
            funcId: 'WFViewFlowChart',
            appId: '',
            appEntrance: '',
            tabId: new Date().getTime().toString(),
            isNewTab: true,
            entityParams: entityParams,
            queryStringParams: queryParams
        };
        this.openMenu(options);
    };
    /**
     * 获取i18n
     */
    /**
     * 获取i18n
     * @private
     * @param {?} name
     * @return {?}
     */
    WFFlowchartService.prototype.getI18nValue = /**
     * 获取i18n
     * @private
     * @param {?} name
     * @return {?}
     */
    function (name) {
        if (!name) {
            return '';
        }
        /** @type {?} */
        var defaultLang = localStorage.getItem('languageCode');
        /** @type {?} */
        var langData = defaultLang ? translate[defaultLang] : translate['zh-CHS'];
        /** @type {?} */
        var resultVal = '';
        if (name.indexOf('.') === -1) {
            resultVal = langData[name];
        }
        else {
            resultVal = name.split('.').reduce((/**
             * @param {?} obj
             * @param {?} key
             * @return {?}
             */
            function (obj, key) {
                if (obj) {
                    return obj[key];
                }
                else {
                    return null;
                }
            }), langData);
        }
        return resultVal;
    };
    /**
     * 判断是否inSuite环境
     */
    /**
     * 判断是否inSuite环境
     * @private
     * @return {?}
     */
    WFFlowchartService.prototype.isInSuite = /**
     * 判断是否inSuite环境
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var frameWorkService = ((/** @type {?} */ (window))).gspframeworkService;
        if (frameWorkService && frameWorkService.rtf) {
            /** @type {?} */
            var extendMethod = frameWorkService.rtf.extendMethod;
            if (extendMethod && extendMethod.getExtObj()) {
                /** @type {?} */
                var extObj = extendMethod.getExtObj();
                /** @type {?} */
                var mode = extObj.iGIX4inSuiteMode();
                if (mode) {
                    return true;
                }
            }
        }
        return false;
    };
    /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @param options 打开参数
     * @param menuTitle 菜单名称
     */
    /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @private
     * @param {?} options 打开参数
     * @return {?}
     */
    WFFlowchartService.prototype.openMenu = /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @private
     * @param {?} options 打开参数
     * @return {?}
     */
    function (options) {
        /** @type {?} */
        var menuTitle = this.getI18nValue('static.flowchart.title');
        if (this.isInSuite()) {
            options.menuTitle = menuTitle;
            /** @type {?} */
            var extObj = ((/** @type {?} */ (window))).gspframeworkService.rtf.extendMethod.getExtObj();
            extObj.iGIXMenuOpen(options);
        }
        else {
            this.frameworkService.openMenu$(options).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                console.error(error);
            }));
        }
    };
    WFFlowchartService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    WFFlowchartService.ctorParameters = function () { return [
        { type: MessagerService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService }
    ]; };
    return WFFlowchartService;
}());
export { WFFlowchartService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WFFlowchartService.prototype.flowchartService;
    /**
     * @type {?}
     * @private
     */
    WFFlowchartService.prototype.frameworkService;
    /**
     * @type {?}
     * @private
     */
    WFFlowchartService.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    WFFlowchartService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WFFlowchartService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WFFlowchartService.prototype.modalService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtZmxvd2NoYXJ0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3VpLWZsb3djaGFydC8iLCJzb3VyY2VzIjpbImxpYi93Zi1mbG93Y2hhcnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBZ0IsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDaEUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDakYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ3JFLE9BQU8sRUFBYyxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBS2xEO0lBTUksNEJBQ1ksVUFBMkIsRUFDM0IsUUFBa0IsRUFDbEIsUUFBa0MsRUFDbEMsWUFBNEI7UUFINUIsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDM0IsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUNsQyxpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFFcEMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVE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OztnQkFaRixlQUFlO2dCQURILFFBQVE7Z0JBQUUsd0JBQXdCO2dCQUVoQyxjQUFjOztJQThTckMseUJBQUM7Q0FBQSxBQW5TRCxJQW1TQztTQWxTWSxrQkFBa0I7Ozs7OztJQUUzQiw4Q0FBNkM7Ozs7O0lBQzdDLDhDQUEyQzs7Ozs7SUFHdkMsd0NBQW1DOzs7OztJQUNuQyxzQ0FBMEI7Ozs7O0lBQzFCLHNDQUEwQzs7Ozs7SUFDMUMsMENBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTW9kYWxPcHRpb25zLCBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBVSUZsb3djaGFydENvbXBvbmVudCB9IGZyb20gJy4vdGFzay1mbG93Y2hhcnQvdGFzay1mbG93Y2hhcnQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgdHJhbnNsYXRlIH0gZnJvbSAnLi9zZXJ2aWNlcy9pMThuL2luZGV4JztcclxuaW1wb3J0IHsgVWlGbG93Y2hhcnRTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy91aS1mbG93Y2hhcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IEFwcE9wdGlvbnMsIEZyYW1ld29ya1NlcnZpY2UgfSBmcm9tICdAZ3NwLXN5cy9ydGYtY29tbW9uJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgRm9yZWNhc3RQcm9jZXNzUGF5bG9hZCB9IGZyb20gJy4vZW50aXR5L2ZvcmVjYXN0LXByb2Nlc3MtcGF5bG9hZCc7XHJcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZSB9IGZyb20gJy4vZmxvdy1jaGFydCc7XHJcblxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgV0ZGbG93Y2hhcnRTZXJ2aWNlIHtcclxuXHJcbiAgICBwcml2YXRlIGZsb3djaGFydFNlcnZpY2U6IFVpRmxvd2NoYXJ0U2VydmljZTtcclxuICAgIHByaXZhdGUgZnJhbWV3b3JrU2VydmljZTogRnJhbWV3b3JrU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoVWlGbG93Y2hhcnRTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmZyYW1ld29ya1NlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChGcmFtZXdvcmtTZXJ2aWNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOafpeeci+a1geeoi+Wbvu+8jOaUr+aMgemihOiniFxyXG4gICAgICogQHBhcmFtIHBheWxvYWQgXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgdmlld1Byb2Nlc3MocGF5bG9hZDogRm9yZWNhc3RQcm9jZXNzUGF5bG9hZCkge1xyXG4gICAgICAgIGlmICghcGF5bG9hZCB8fCAhcGF5bG9hZC5kYXRhSWQpIHtcclxuICAgICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLndhcm5pbmcodGhpcy5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQubm9EYXRhSWQnKSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFwYXlsb2FkIHx8ICFwYXlsb2FkLmJpekRlZktleSkge1xyXG4gICAgICAgICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZyh0aGlzLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC5ub0JpekRlZktleScpKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnNldCgnZGF0YUlkJywgcGF5bG9hZC5kYXRhSWQpO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCdiaXpEZWZLZXknLCBwYXlsb2FkLmJpekRlZktleSk7XHJcbiAgICAgICAgaWYgKHBheWxvYWQuc3RhcnRNb2RlKSB7XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KCdzdGFydE1vZGUnLCBwYXlsb2FkLnN0YXJ0TW9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXlsb2FkLnN0YXJ0VXNlcklkKSB7XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KCdzdGFydFVzZXJJZCcsIHBheWxvYWQuc3RhcnRVc2VySWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYXJhbWV0ZXJzLnNldCgnd2l0aFRpdGxlJywgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYXBwVHlwZTogJ21lbnUnLFxyXG4gICAgICAgICAgICBmdW5jSWQ6ICdXRlZpZXdGbG93Q2hhcnQnLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgICAgdGFiSWQ6IHBheWxvYWQuZGF0YUlkLFxyXG4gICAgICAgICAgICBpc05ld1RhYjogdHJ1ZSxcclxuICAgICAgICAgICAgcXVlcnlTdHJpbmdQYXJhbXM6IHBhcmFtZXRlcnNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMub3Blbk1lbnUob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7mtYHnqIvlrp7kvotpZOafpeeci+a1geeoi++8iHRhYumhteS4reaJk+W8gO+8iVxyXG4gICAgICogQHBhcmFtIHByb2NJbnN0SWQg5rWB56iL5a6e5L6LSURcclxuICAgICAqL1xyXG4gICAgdmlld0Zsb3dDaGFydChwcm9jSW5zdElkOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIXByb2NJbnN0SWQpIHtcclxuICAgICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLndhcm5pbmcodGhpcy5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQucHJvY2Vzc05vdEZvdW5kJykpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCdwcm9jZXNzSWQnLCBwcm9jSW5zdElkKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnNldCgnd2l0aFRpdGxlJywgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYXBwVHlwZTogJ21lbnUnLFxyXG4gICAgICAgICAgICBmdW5jSWQ6ICdXRlZpZXdGbG93Q2hhcnQnLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgICAgdGFiSWQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgIGlzTmV3VGFiOiB0cnVlLFxyXG4gICAgICAgICAgICBxdWVyeVN0cmluZ1BhcmFtczogcGFyYW1ldGVyc1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5vcGVuTWVudShvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNruWNleaNruWGheeggeafpeeci+a1geeoi1xyXG4gICAgICogQHBhcmFtIGRhdGFJZCDljZXmja7lhoXnoIFcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICB2aWV3Rmxvd0NoYXJ0QnlEYXRhSWQoZGF0YUlkOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIWRhdGFJZCkge1xyXG4gICAgICAgICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZyh0aGlzLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICAgICAgcGFyYW1ldGVycy5zZXQoJ2RhdGFJZCcsIGRhdGFJZCk7XHJcbiAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3dpdGhUaXRsZScsIHRydWUpO1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnM6IEFwcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGFwcFR5cGU6ICdtZW51JyxcclxuICAgICAgICAgICAgZnVuY0lkOiAnV0ZWaWV3Rmxvd0NoYXJ0JyxcclxuICAgICAgICAgICAgYXBwSWQ6ICcnLFxyXG4gICAgICAgICAgICBhcHBFbnRyYW5jZTogJycsXHJcbiAgICAgICAgICAgIHRhYklkOiBuZXcgRGF0ZSgpLmdldFRpbWUoKS50b1N0cmluZygpLFxyXG4gICAgICAgICAgICBpc05ld1RhYjogdHJ1ZSxcclxuICAgICAgICAgICAgcXVlcnlTdHJpbmdQYXJhbXM6IHBhcmFtZXRlcnNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMub3Blbk1lbnUob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmn6XnnIvmtYHnqIvvvIjlvLnmoYbkuK3miZPlvIDvvIlcclxuICAgICAqIEBwYXJhbSBwcm9jSW5zdElkIOa1geeoi+WunuS+i0lEXHJcbiAgICAgKi9cclxuICAgIHZpZXdGbG93Q2hhcnRCeURpYWxvZyhwcm9jSW5zdElkOiBzdHJpbmcsIG1vZGU/OiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIXByb2NJbnN0SWQpIHtcclxuICAgICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLndhcm5pbmcodGhpcy5nZXRJMThuVmFsdWUoJ3N0YXRpYy5mbG93Y2hhcnQucHJvY2Vzc05vdEZvdW5kJykpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZmxvd2NoYXJ0U2VydmljZS5nZXRQcm9jZXNzSW5zdGFuY2VCeUlkKHByb2NJbnN0SWQpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3TXV0aUluc3RhbmNlRmxvd0NoYXJ0QnlEaWFsb2coW3JlXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p+l55yL5rWB56iL77yI5by55qGG5Lit5omT5byA77yM5YW85a655aSa5a6e5L6L5a2Q5rWB56iL77yJXHJcbiAgICAgKiBAcGFyYW0gcHJvY0luc3RJZCDmtYHnqIvlrp7kvotJRFxyXG4gICAgICovXHJcbiAgICB2aWV3TXV0aUluc3RhbmNlRmxvd0NoYXJ0QnlEaWFsb2cocHJvY0luc3RMaXN0OiBQcm9jZXNzSW5zdGFuY2VbXSwgbW9kZT86IHN0cmluZykge1xyXG4gICAgICAgIGxldCBmdW5jO1xyXG4gICAgICAgIGlmIChVSUZsb3djaGFydENvbXBvbmVudC5mdW5jKSB7XHJcbiAgICAgICAgICAgIGZ1bmMgPSBVSUZsb3djaGFydENvbXBvbmVudC5mdW5jO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvcHRpb25zOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC50aXRsZScpLFxyXG4gICAgICAgICAgICB3aWR0aDogMTIwMCxcclxuICAgICAgICAgICAgaGVpZ2h0OiA1MzAsXHJcbiAgICAgICAgICAgIHNob3dCdXR0b25zOiBmYWxzZSxcclxuICAgICAgICAgICAgYmVmb3JlQ2xvc2U6IChtb2RhbFJlZjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoVUlGbG93Y2hhcnRDb21wb25lbnQuZnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgVUlGbG93Y2hhcnRDb21wb25lbnQuZnVuYywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGZ1bmMpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmMsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBVSUZsb3djaGFydENvbXBvbmVudC5mdW5jID0gZnVuYztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFVJRmxvd2NoYXJ0Q29tcG9uZW50KTtcclxuICAgICAgICBjb25zdCBpbmogPSBJbmplY3Rvci5jcmVhdGUoe1xyXG4gICAgICAgICAgICBwcm92aWRlcnM6IFt7XHJcbiAgICAgICAgICAgICAgICBwcm92aWRlOiBVaUZsb3djaGFydFNlcnZpY2UsIHVzZUZhY3Rvcnk6IChodHRwU3ZjKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaUZsb3djaGFydFNlcnZpY2UoaHR0cFN2Yyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZGVwczogW1xyXG4gICAgICAgICAgICAgICAgICAgIEh0dHBTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1dLCBwYXJlbnQ6IHRoaXMuaW5qZWN0b3JcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKGluaik7XHJcbiAgICAgICAgaWYgKHByb2NJbnN0TGlzdCAmJiBwcm9jSW5zdExpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmIChwcm9jSW5zdExpc3QubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2hvd0hlYWRlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRpdGxlID0gcHJvY0luc3RMaXN0WzBdLm5hbWUgKyAnLXYnICsgcHJvY0luc3RMaXN0WzBdLnZlcnNpb24gKyAnLjAnO1xyXG4gICAgICAgICAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5Qcm9jSW5zdElkID0gcHJvY0luc3RMaXN0WzBdLmlkO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5zaG93SGVhZGVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLlByb2NJbnN0TGlzdCA9IHByb2NJbnN0TGlzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW9kZSkge1xyXG4gICAgICAgICAgICBjb21wUmVmLmluc3RhbmNlLm1vZGUgPSBtb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmZpbGwoKTtcclxuICAgICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG9wdGlvbnMpO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZGlhbG9nID0gZGlhbG9nO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5p+l55yL5rWB56iL5Zu+44CC77yI5aaC5p6c5L2c5Li65YWx5Lqr55qE5aSW6YOo5rWB56iL77yM5YiZ5omT5byA5YWx5Lqr55qE5p+l55yL5rWB56iL77yJXHJcbiAgICAgKiBAcGFyYW0gcHJvY0luc3RJZCDmtYHnqIvlrp7kvotpZFxyXG4gICAgICogQHBhcmFtIGRhdGFJZCDljZXmja7lhoXnoIFcclxuICAgICAqL1xyXG4gICAgdmlld0Zsb3djaGFydEJ5UHJvY0luc3RJZEFuZERhdGFJZChwcm9jSW5zdElkOiBzdHJpbmcsIGRhdGFJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlLmlmVGhpcmRUYXNrKHByb2NJbnN0SWQpLnN1YnNjcmliZShpZlRoaXJkVGFzayA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpZlRoaXJkVGFzayA9PT0gdHJ1ZSkgey8v5piv56ys5LiJ5pa555qE5Lu75YqhXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3djaGFydFNlcnZpY2UuZ2V0RnNQYXJhbXNCeUJpeklkKGRhdGFJZCkuc3Vic2NyaWJlKHBhcmFtcyA9PiB7Ly/ojrflj5bmn6XnnIvmtYHnqIvlm77miYDpnIDlj4LmlbBcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zKSB7Ly/mnInkuI3lvoDlhbHkuqvljZXmja7ooajmjqjmlbDmja7nmoTmg4XlhrXvvIzmraTml7bov5Tlm57kuLrnqbpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxjc2xcIjogcGFyYW1zWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkam5tXCI6IHBhcmFtc1sxXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGpseFwiOiBwYXJhbXNbMl0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRqYmhcIjogcGFyYW1zWzNdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlLnZpZXdGc1Byb2Nlc3NOZXcocGFyYW0pLnN1YnNjcmliZShyZSA9PiB7Ly/ml6fmjqXlj6PmiqXplJnvvIzmlLnosIPmlrDmjqXlj6NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZSAmJiByZS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3BlblZpZXdQcm9jZXNzTWVudShyZS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld0Zsb3dDaGFydChwcm9jSW5zdElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdGbG93Q2hhcnQocHJvY0luc3RJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld0Zsb3dDaGFydChwcm9jSW5zdElkKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7Ly9XRueahOS7u+WKoVxyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3Rmxvd0NoYXJ0KHByb2NJbnN0SWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdGbG93Q2hhcnQocHJvY0luc3RJZCk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFseS6q+eahOS7u+WKoe+8jOWAn+eUqOiHquW3seeahOafpeeci+a1geeoi+iPnOWNle+8jGlmcmFtZeW1jOWFpeWFseS6q+eahOafpeeci+a1geeoi1VSTFxyXG4gICAgICogQHBhcmFtIGVudGl0eSDku7vliqHlrp7kvZPvvIzljLrliIZ0YWLpobVcclxuICAgICAqIEBwYXJhbSB1cmwg5YWx5Lqr5p+l55yL5rWB56iL55qEVVJMXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgb3BlblZpZXdQcm9jZXNzTWVudSh1cmw6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgICAgICBxdWVyeVBhcmFtcy5zZXQoXCJ0aGlyZFRhc2tcIiwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3QgZW50aXR5UGFyYW1zID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgICAgICBlbnRpdHlQYXJhbXMuc2V0KFwidGhpcmRQcm9jZXNzVXJsXCIsIHVybCk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYXBwVHlwZTogJ21lbnUnLFxyXG4gICAgICAgICAgICBmdW5jSWQ6ICdXRlZpZXdGbG93Q2hhcnQnLFxyXG4gICAgICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgICAgIGFwcEVudHJhbmNlOiAnJyxcclxuICAgICAgICAgICAgdGFiSWQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgIGlzTmV3VGFiOiB0cnVlLFxyXG4gICAgICAgICAgICBlbnRpdHlQYXJhbXM6IGVudGl0eVBhcmFtcyxcclxuICAgICAgICAgICAgcXVlcnlTdHJpbmdQYXJhbXM6IHF1ZXJ5UGFyYW1zXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLm9wZW5NZW51KG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+WaTE4blxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGdldEkxOG5WYWx1ZShuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIW5hbWUpIHsgcmV0dXJuICcnOyB9XHJcbiAgICAgICAgdmFyIGRlZmF1bHRMYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpO1xyXG4gICAgICAgIHZhciBsYW5nRGF0YSA9IGRlZmF1bHRMYW5nID8gdHJhbnNsYXRlW2RlZmF1bHRMYW5nXSA6IHRyYW5zbGF0ZVsnemgtQ0hTJ107XHJcbiAgICAgICAgbGV0IHJlc3VsdFZhbCA9ICcnO1xyXG4gICAgICAgIGlmIChuYW1lLmluZGV4T2YoJy4nKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gbGFuZ0RhdGFbbmFtZV07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0VmFsID0gbmFtZS5zcGxpdCgnLicpLnJlZHVjZSgob2JqLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqW2tleV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBsYW5nRGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRWYWw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKTmlq3mmK/lkKZpblN1aXRl546v5aKDXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaXNJblN1aXRlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IGZyYW1lV29ya1NlcnZpY2UgPSAod2luZG93IGFzIGFueSkuZ3NwZnJhbWV3b3JrU2VydmljZTtcclxuICAgICAgICBpZiAoZnJhbWVXb3JrU2VydmljZSAmJiBmcmFtZVdvcmtTZXJ2aWNlLnJ0Zikge1xyXG4gICAgICAgICAgICBjb25zdCBleHRlbmRNZXRob2QgPSBmcmFtZVdvcmtTZXJ2aWNlLnJ0Zi5leHRlbmRNZXRob2Q7XHJcbiAgICAgICAgICAgIGlmIChleHRlbmRNZXRob2QgJiYgZXh0ZW5kTWV0aG9kLmdldEV4dE9iaigpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0T2JqID0gZXh0ZW5kTWV0aG9kLmdldEV4dE9iaigpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbW9kZSA9IGV4dE9iai5pR0lYNGluU3VpdGVNb2RlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaJk+W8gOiPnOWNle+8jOWMuuWIhuaYr+WQpmluU3VpdGXnjq/looPvvIznlKjkuI3lkIzmlrnlvI/miZPlvIDoj5zljZVcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIOaJk+W8gOWPguaVsFxyXG4gICAgICogQHBhcmFtIG1lbnVUaXRsZSDoj5zljZXlkI3np7BcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBvcGVuTWVudShvcHRpb25zOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBtZW51VGl0bGUgPSB0aGlzLmdldEkxOG5WYWx1ZSgnc3RhdGljLmZsb3djaGFydC50aXRsZScpXHJcbiAgICAgICAgaWYgKHRoaXMuaXNJblN1aXRlKCkpIHtcclxuICAgICAgICAgICAgb3B0aW9ucy5tZW51VGl0bGUgPSBtZW51VGl0bGU7XHJcbiAgICAgICAgICAgIHZhciBleHRPYmogPSAod2luZG93IGFzIGFueSkuZ3NwZnJhbWV3b3JrU2VydmljZS5ydGYuZXh0ZW5kTWV0aG9kLmdldEV4dE9iaigpO1xyXG4gICAgICAgICAgICBleHRPYmouaUdJWE1lbnVPcGVuKG9wdGlvbnMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZnJhbWV3b3JrU2VydmljZS5vcGVuTWVudSQob3B0aW9ucykuc3Vic2NyaWJlKHJlID0+IHtcclxuXHJcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
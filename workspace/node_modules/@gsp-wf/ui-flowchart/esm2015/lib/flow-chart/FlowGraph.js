/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { mxGraph, mxEvent, mxConstants, mxPoint, mxRectangle, mxUtils, mxGeometry } from "@edp-pmf/mxgraph-ts";
import { EndEvent, BpmnModel, Process, BPMNDiagram, SequenceFlow, FlowNode, Node, Edge, FlowNodeState, SequenceFlowState } from "@edp-pmf/bpmn-model";
import { StartActivity, UserActivity, CallActivitySubProcess, AutoActivity, IntermediateCatchEventImpl, OperationActivity, MessageActivity, NotifyActivity, AifCreationBillActivity } from "@gsp-wf/wf-process-model";
import { Cell } from "./entity/Cell";
export class FlowGraph extends mxGraph {
    /**
     * @param {?} container
     * @param {?=} cellStyleConfig
     */
    constructor(container, cellStyleConfig) {
        super(container);
        this.scrollTileSize = new mxRectangle(0, 0, 400, 600);
        this.cellStyleConfig = {
            edgeStyleDic: {},
            shapeStyleDic: {},
        };
        this.actList = [];
        this.transInsList = [];
        this.rootPath = ''; //基路径
        //基路径
        /**
         * 当前语言
         */
        this.langCode = ((/** @type {?} */ (window))).gspframeworkService && ((/** @type {?} */ (window))).gspframeworkService.rtf.language.getLanguageCode() || localStorage.getItem('languageCode') || 'zh-CHS';
        //获取基路径
        try {
            this.rootPath = ((/** @type {?} */ (window))).gspframeworkService.common.getBasePath.get();
        }
        catch (error) {
        }
        this.cellStyleConfig = cellStyleConfig ? cellStyleConfig : this.cellStyleConfig;
        this.autoScroll = false;
        this.autoExtend = true;
        this.pageVisible = false;
        //this.panningHandler.ignoreCell = true;
        //this.setPanning(true);
        this.setCellsSelectable(true);
        this.setDisconnectOnMove(false);
        //节点不可改变大小
        this.setCellsResizable(false);
        //cell是否可以连线
        this.setConnectable(false);
        //禁止操作
        this.setEnabled(true);
        //设置cell文本是否可移动
        this.setVertexLabelsMovable(false);
        this.setCellsLocked(true);
        //不允许图上存在没有连接活动节点的线（防止拖动线连接点导致失去连接）,还没有找到不允许拖动连接控制点的属性
        this.setAllowDanglingEdges(false);
        mxEvent.disableContextMenu(container);
        // 设置默认样式
        this.setDefaultStyles();
    }
    /**
     * 重写创建节点对象方法
     * @param {?} parent
     * @param {?} id
     * @param {?} value
     * @param {?} x
     * @param {?} y
     * @param {?} width
     * @param {?} height
     * @param {?} style
     * @param {?} relative
     * @return {?}
     */
    createVertex(parent, id, value, x, y, width, height, style, relative) {
        // Creates the geometry for the vertex
        /** @type {?} */
        const geometry = new mxGeometry(x, y, width, height);
        geometry.relative = (relative != null) ? relative : false;
        // Creates the vertex
        /** @type {?} */
        const vertex = new Cell(value, geometry, style);
        vertex.setId(id);
        vertex.setVertex(true);
        vertex.setConnectable(true);
        return vertex;
    }
    /**
     * 重写创建边对象方法
     * @param {?} parent
     * @param {?} id
     * @param {?} value
     * @param {?} source
     * @param {?} target
     * @param {?} style
     * @return {?}
     */
    createEdge(parent, id, value, source, target, style) {
        // Creates the edge
        /** @type {?} */
        var edge = new Cell(value, new mxGeometry(), style);
        edge.setId(id);
        edge.setEdge(true);
        edge.geometry.relative = true;
        return edge;
    }
    /**
     * 设置默认样式
     * @return {?}
     */
    setDefaultStyles() {
        /** @type {?} */
        const styleSheet = this.getStylesheet();
        // 节点默认样式
        /** @type {?} */
        const vertexStyle = styleSheet.getDefaultVertexStyle();
        vertexStyle[mxConstants.STYLE_SHAPE] = mxConstants.SHAPE_IMAGE;
        vertexStyle[mxConstants.STYLE_VERTICAL_LABEL_POSITION] = mxConstants.ALIGN_BOTTOM;
        vertexStyle[mxConstants.STYLE_FONTSIZE] = 12;
        vertexStyle[mxConstants.STYLE_FONTFAMILY] = 'Helvetica';
        vertexStyle[mxConstants.STYLE_FONTCOLOR] = "#333";
        // 连线样式默认为正交
        /** @type {?} */
        const edgeStyle = styleSheet.getDefaultEdgeStyle();
        edgeStyle[mxConstants.STYLE_SOURCE_PORT] = 'e';
        edgeStyle[mxConstants.STYLE_TARGET_PORT] = 'w';
        edgeStyle[mxConstants.STYLE_EDGE] = mxConstants.EDGESTYLE_ORTHOGONAL;
        edgeStyle[mxConstants.STYLE_ROUNDED] = 1;
        edgeStyle[mxConstants.STYLE_STROKECOLOR] = '#6482B9';
        edgeStyle[mxConstants.STYLE_FONTSIZE] = 12;
        edgeStyle[mxConstants.STYLE_FONTFAMILY] = 'Helvetica';
    }
    /**
     * 创建无限大画布
     * @return {?}
     */
    createInfiniteCanvas() {
        this.getPagePadding = (/**
         * @return {?}
         */
        () => {
            return new mxPoint(Math.max(0, Math.round(this.container.offsetWidth - 34)), Math.max(0, Math.round(this.container.offsetHeight - 34)));
        });
        this.getScrollTileSize = (/**
         * @return {?}
         */
        () => {
            if (this.scrollTileSize == null) {
                this.scrollTileSize = new mxRectangle(0, 0, 400, 600);
            }
            return this.scrollTileSize;
        });
        this.getPageSize = (/**
         * @return {?}
         */
        () => {
            return (this.pageVisible) ? new mxRectangle(0, 0, this.pageFormat.width * this.pageScale, this.pageFormat.height * this.pageScale) : this.getScrollTileSize();
        });
        this.getPageLayout = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            let size = (this.pageVisible) ? this.getPageSize() : this.getScrollTileSize();
            /** @type {?} */
            let bounds = this.getGraphBounds();
            if (bounds.width == 0 || bounds.height == 0) {
                return new mxRectangle(0, 0, 1, 1);
            }
            else {
                // Computes untransformed graph bounds
                /** @type {?} */
                let x = Math.ceil(bounds.x / this.view.scale - this.view.translate.x);
                /** @type {?} */
                let y = Math.ceil(bounds.y / this.view.scale - this.view.translate.y);
                /** @type {?} */
                let w = Math.floor(bounds.width / this.view.scale);
                /** @type {?} */
                let h = Math.floor(bounds.height / this.view.scale);
                /** @type {?} */
                let x0 = Math.floor(x / size.width);
                /** @type {?} */
                let y0 = Math.floor(y / size.height);
                /** @type {?} */
                let w0 = Math.ceil((x + w) / size.width) - x0;
                /** @type {?} */
                let h0 = Math.ceil((y + h) / size.height) - y0;
                return new mxRectangle(x0, y0, w0, h0);
            }
        });
        this.getPreferredPageSize = (/**
         * @param {?} bounds
         * @param {?} width
         * @param {?} height
         * @return {?}
         */
        (bounds, width, height) => {
            /** @type {?} */
            let pages = this.getPageLayout();
            /** @type {?} */
            let size = this.getPageSize();
            return new mxRectangle(0, 0, pages.width * size.width, pages.height * size.height);
        });
        // 重写画布大小变化后方法
        /** @type {?} */
        const graphSizeDidChange = this.sizeDidChange;
        this.sizeDidChange = (/**
         * @return {?}
         */
        () => {
            if (this.container != null && mxUtils.hasScrollbars(this.container)) {
                /** @type {?} */
                let pages = this.getPageLayout();
                /** @type {?} */
                let pad = this.getPagePadding();
                /** @type {?} */
                let size = this.getPageSize();
                // Updates the minimum graph size
                /** @type {?} */
                let minw = Math.ceil(2 * pad.x / this.view.scale + pages.width * size.width);
                /** @type {?} */
                let minh = Math.ceil(2 * pad.y / this.view.scale + pages.height * size.height);
                /** @type {?} */
                let min = this.minimumGraphSize;
                // LATER: Fix flicker of scrollbar size in IE quirks mode
                // after delayed call in window.resize event handler
                if (min == null || min.width != minw || min.height != minh) {
                    this.minimumGraphSize = new mxRectangle(0, 0, minw, minh);
                }
                // Updates auto-translate to include padding and graph size
                /** @type {?} */
                let dx = pad.x / this.view.scale - pages.x * size.width;
                /** @type {?} */
                let dy = pad.y / this.view.scale - pages.y * size.height;
                if (!this.autoTranslate && (this.view.translate.x != dx || this.view.translate.y != dy)) {
                    this.autoTranslate = true;
                    ((/** @type {?} */ (this.view))).x0 = pages.x;
                    ((/** @type {?} */ (this.view))).y0 = pages.y;
                    /** @type {?} */
                    let tx = this.view.translate.x;
                    /** @type {?} */
                    let ty = this.view.translate.y;
                    this.view.setTranslate(dx, dy);
                    this.container.scrollLeft += (dx - tx) * this.view.scale;
                    this.container.scrollTop += (dy - ty) * this.view.scale;
                    this.autoTranslate = false;
                    return;
                }
                graphSizeDidChange.apply(this, []);
            }
        });
        // 重写view获取背景页大小
        this.view.getBackgroundPageBounds = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            let layout = this.getPageLayout();
            /** @type {?} */
            let page = this.getPageSize();
            return new mxRectangle(this.view.scale * (this.view.translate.x + layout.x * page.width), this.view.scale * (this.view.translate.y + layout.y * page.height), this.view.scale * layout.width * page.width, this.view.scale * layout.height * page.height);
        });
        // 重写view validate方法
        /** @type {?} */
        const graphViewValidate = this.view.validate;
        this.view.validate = (/**
         * @param {?=} cell
         * @return {?}
         */
        (cell) => {
            if (this.container != null && mxUtils.hasScrollbars(this.container)) {
                /** @type {?} */
                let pad = this.getPagePadding();
                /** @type {?} */
                let size = this.getPageSize();
                /** @type {?} */
                let tx = this.view.translate.x;
                /** @type {?} */
                let ty = this.view.translate.y;
                this.view.translate.x = pad.x / this.view.scale - (((/** @type {?} */ (this.view))).x0 || 0) * size.width;
                this.view.translate.y = pad.y / this.view.scale - (((/** @type {?} */ (this.view))).y0 || 0) * size.height;
            }
            graphViewValidate.apply(this.view, [cell]);
        });
    }
    /**
     * 创建BpmnModel
     * @return {?}
     */
    createBpmnModel() {
        /** @type {?} */
        const bpmnModel = new BpmnModel();
        bpmnModel.TargetNamespace = "Default_Namespace";
        bpmnModel.DefaultProcess = new Process(bpmnModel);
        bpmnModel.DefaultDiagram = new BPMNDiagram(bpmnModel);
        bpmnModel.DefaultDiagram.BpmnPlane.BpmnElementId = bpmnModel.DefaultProcess.Id;
        return bpmnModel;
    }
    /**
     * 加载BpmnModel并画图
     * @param {?} json
     * @return {?}
     */
    loadBpmnModel(json) {
        this.removeCells(this.getChildCells(this.getDefaultParent()));
        this.bpmnModel = this.createBpmnModel();
        this.bpmnModel.LoadFromJson(json);
        this.drawBpmnGraph(this.bpmnModel);
    }
    /**
     * 重新加载BpmnModel并画图
     * @param {?=} json
     * @return {?}
     */
    reloadBpmnModel(json) {
        this.removeCells(this.getChildCells(this.getDefaultParent()));
        if (json) {
            this.loadBpmnModel(json);
        }
        else {
            this.drawBpmnGraph(this.bpmnModel);
        }
    }
    /**
     * 根据BpmnModel画图
     * @param {?} bpmnModel
     * @return {?}
     */
    drawBpmnGraph(bpmnModel) {
        const { nodeDict, edgeDict } = this.buildFlowDiagDict(bpmnModel);
        /** @type {?} */
        const flowDict = this.buildFlowDict(bpmnModel);
        this.drawNodeCells(flowDict, nodeDict);
        this.drawEdgeCells(flowDict, edgeDict);
        this.getModel().beginUpdate();
        if (this.mode === 'simulation') {
            this.drawInterceptGraph(flowDict, nodeDict, edgeDict);
            this.addJumpEdges(flowDict);
        }
        this.getModel().endUpdate();
    }
    /**
     * @private
     * @param {?} flowDict
     * @param {?} nodeDict
     * @param {?} edgeDict
     * @return {?}
     */
    drawInterceptGraph(flowDict, nodeDict, edgeDict) {
        /** @type {?} */
        const firstAct = this.findFirstStartActivityInstance(this.actList);
        // todo：此处待修复
        /** @type {?} */
        let endActDef;
        for (const key in flowDict) {
            if (flowDict[key] instanceof EndEvent) {
                endActDef = (/** @type {?} */ (flowDict[key]));
            }
        }
        if (firstAct) {
            /** @type {?} */
            const endActiInstList = this.findEndActiInstList(firstAct, this.actList, this.transInsList);
            endActiInstList.forEach(((/**
             * @param {?} endActiInst
             * @return {?}
             */
            endActiInst => {
                if (endActiInst.activityDefinitionId !== endActDef.Id) {
                    this.drawNextFlowChart(endActiInst.activityDefinitionId, nodeDict, edgeDict);
                }
            })));
        }
    }
    /**
     * @param {?} flowDict
     * @return {?}
     */
    addJumpEdges(flowDict) {
        /** @type {?} */
        const nodeCells = (/** @type {?} */ ((this.getChildCells(this.getDefaultParent(), true) || [])));
        /** @type {?} */
        const noIncomingNodes = this.findNoIncomingNodes(nodeCells);
        for (const node of noIncomingNodes) {
            /** @type {?} */
            const actInst = this.actList.filter((/**
             * @param {?} a
             * @return {?}
             */
            a => a.activityDefinitionId === node.flowElement.Id))[0];
            /** @type {?} */
            const cellId = actInst.precursorActivityDefinitionId + '_' + actInst.activityDefinitionId;
            /** @type {?} */
            const source = nodeCells.find((/**
             * @param {?} it
             * @return {?}
             */
            (it) => {
                return it.flowElement && it.flowElement.Id === actInst.precursorActivityDefinitionId;
            }));
            /** @type {?} */
            const target = nodeCells.find((/**
             * @param {?} it
             * @return {?}
             */
            (it) => {
                return it.flowElement && it.flowElement.Id === actInst.activityDefinitionId;
            }));
            /** @type {?} */
            const map = new Map();
            map.set('jump', true);
            /** @type {?} */
            const style = this.getEdgeStyle(null, null, map);
            /** @type {?} */
            const cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), cellId, '', source, target, style)));
            if (cell !== null) {
                cell.source = source;
                cell.target = target;
                cell.geometry.points = [
                // new mxPoint(source.geometry.x+ source.geometry.width/2, target.geometry.y+target.geometry.height/2)
                ];
                console.log(cell);
                this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
            }
        }
    }
    /**
     * 画节点
     * @param {?} flowDict
     * @param {?} nodeDict
     * @param {?=} additional
     * @return {?}
     */
    drawNodeCells(flowDict, nodeDict, additional = false) {
        Object.keys(nodeDict).forEach((/**
         * @param {?} bpmnModelElementId
         * @return {?}
         */
        (bpmnModelElementId) => {
            /** @type {?} */
            const flowElt = flowDict[bpmnModelElementId];
            /** @type {?} */
            const diagElt = (/** @type {?} */ (nodeDict[bpmnModelElementId]));
            if (flowElt == null) {
                return;
            }
            this.drawNodeCell(flowElt, diagElt, additional);
        }));
    }
    /**
     * 画单个节点
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @return {?}
     */
    drawNodeCell(flowElt, diagElt, additional) {
        /** @type {?} */
        const style = this.getVertexStyle(flowElt, diagElt, additional);
        /** @type {?} */
        let cell = null;
        /** @type {?} */
        let label = "";
        if (flowElt != null) {
            label = flowElt.Name;
            if (flowElt.NameLanguage && flowElt.NameLanguage[this.langCode] != null) {
                label = flowElt.NameLanguage[this.langCode];
            }
        }
        if (this.mode === 'simulation') {
            if (this.actList.findIndex((/**
             * @param {?} a
             * @return {?}
             */
            a => a.activityDefinitionId === flowElt.Id)) > -1) {
                cell = (/** @type {?} */ (this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
            }
            else if (additional) {
                cell = (/** @type {?} */ (this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
            }
        }
        else {
            cell = (/** @type {?} */ (this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style)));
        }
        if (cell == null) {
            return;
        }
        // const cell = this.insertVertex(this.getDefaultParent(), flowElt.Id, label, diagElt.Bounds.X, diagElt.Bounds.Y, diagElt.Bounds.Width, diagElt.Bounds.Height, style) as Cell;
        cell.flowElement = flowElt;
        cell.diagramElement = diagElt;
        this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
    }
    /**
     * 画连线
     * @param {?} flowDict
     * @param {?} edgeDict
     * @param {?=} additional
     * @param {?=} cut
     * @return {?}
     */
    drawEdgeCells(flowDict, edgeDict, additional = false, cut = false) {
        Object.keys(edgeDict).forEach((/**
         * @param {?} bpmnModelElementId
         * @return {?}
         */
        (bpmnModelElementId) => {
            /** @type {?} */
            const flowElt = (/** @type {?} */ (flowDict[bpmnModelElementId]));
            /** @type {?} */
            const diagElt = (/** @type {?} */ (edgeDict[bpmnModelElementId]));
            if (flowElt == null) {
                return;
            }
            this.drawEdgeCell(flowElt, diagElt, additional, cut);
        }));
    }
    /**
     * @private
     * @param {?} flowDict
     * @param {?} sourceId
     * @param {?} targetId
     * @return {?}
     */
    judgeConnectBetweenTwoNodes(flowDict, sourceId, targetId) {
        /** @type {?} */
        const source = (/** @type {?} */ (flowDict[sourceId]));
        /** @type {?} */
        const outGoings = source.Outgoings;
        if (!outGoings || outGoings.length === 0) {
            return false;
        }
        for (const outGoing of outGoings) {
            /** @type {?} */
            const sequenceFlow = (/** @type {?} */ (flowDict[outGoing]));
            if (sequenceFlow.TargetRef === targetId) {
                return true;
            }
        }
        return false;
    }
    /**
     * 画单条连线
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    drawEdgeCell(flowElt, diagElt, additional, cut) {
        // 获取已插入的节点元素
        /** @type {?} */
        const nodeCells = (/** @type {?} */ ((this.getChildCells(this.getDefaultParent(), true) || [])));
        /** @type {?} */
        const source = nodeCells.find((/**
         * @param {?} it
         * @return {?}
         */
        (it) => {
            return it.flowElement && it.flowElement.Id === flowElt.SourceRef;
        }));
        /** @type {?} */
        const target = nodeCells.find((/**
         * @param {?} it
         * @return {?}
         */
        (it) => {
            return it.flowElement && it.flowElement.Id === flowElt.TargetRef;
        }));
        /** @type {?} */
        const map = new Map();
        map.set('additional', additional);
        map.set('cut', cut);
        /** @type {?} */
        const style = this.getEdgeStyle(flowElt, diagElt, map);
        /** @type {?} */
        let cell = null;
        /** @type {?} */
        let label = "";
        if (flowElt != null) {
            label = flowElt.Name;
            if (flowElt.NameLanguage && flowElt.NameLanguage[this.langCode] != null) {
                label = flowElt.NameLanguage[this.langCode];
            }
        }
        if (this.mode === 'simulation') {
            if (this.transInsList.findIndex((/**
             * @param {?} a
             * @return {?}
             */
            a => a.sourceActivityDefinitionId === flowElt.SourceRef
                && a.destinationActivityDefinitionId === flowElt.TargetRef)) > -1) {
                cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
            }
            else if (additional || cut) {
                cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
            }
        }
        else {
            cell = (/** @type {?} */ (this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style)));
        }
        if (cell == null) {
            return;
        }
        // const cell = this.insertEdge(this.getDefaultParent(), flowElt.Id, label, source, target, style) as Cell;
        // cell.geometry.relative = true;
        cell.flowElement = flowElt;
        cell.diagramElement = diagElt;
        cell.source = source;
        cell.target = target;
        cell.geometry.points = cell.geometry.points || [];
        // 判断是否为旧版本连线
        if (this.isOldBpmnEdge(diagElt)) {
            for (let i = 2; i < diagElt.Points.length; i++) {
                /** @type {?} */
                const pt = diagElt.Points[i];
                cell.geometry.points.push(new mxPoint(pt.X, pt.Y));
            }
            // 此行代码执行后可获取mxCellState
            this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
            //按坐标插入label
            /** @type {?} */
            const state = this.view.getState(cell);
            if (diagElt.BpmnLabel && state) {
                if (diagElt.BpmnLabel.Bounds.X === 0 && diagElt.BpmnLabel.Bounds.Y === 0) {
                    return;
                }
                /** @type {?} */
                const x = diagElt.BpmnLabel.Bounds.X + (state.x - state.paintBounds.x);
                /** @type {?} */
                const y = diagElt.BpmnLabel.Bounds.Y + (state.y - state.paintBounds.y);
                /** @type {?} */
                const edgeHandler = this.createEdgeHandler(state, undefined);
                edgeHandler.moveLabel(state, x, y);
                edgeHandler.destroy();
            }
        }
        else {
            for (let i = 1; i < diagElt.Points.length - 1; i++) {
                /** @type {?} */
                const pt = diagElt.Points[i];
                cell.geometry.points.push(new mxPoint(pt.X, pt.Y));
            }
            // 此行代码执行后可获取mxCellState
            this.moveCells([cell], undefined, undefined, undefined, this.getDefaultParent());
            //按坐标插入label
            /** @type {?} */
            const state = this.view.getState(cell);
            /** @type {?} */
            const scale = this.view.getScale();
            /** @type {?} */
            const translate = this.view.getTranslate();
            if (diagElt.BpmnLabel && state) {
                if (diagElt.BpmnLabel.Bounds.X === 0 && diagElt.BpmnLabel.Bounds.Y === 0) {
                    return;
                }
                /** @type {?} */
                const x = diagElt.BpmnLabel.Bounds.X * scale + translate.x;
                /** @type {?} */
                const y = diagElt.BpmnLabel.Bounds.Y * scale + translate.y;
                /** @type {?} */
                const edgeHandler = this.createEdgeHandler(state, undefined);
                edgeHandler.moveLabel(state, x, y);
                edgeHandler.destroy();
            }
        }
    }
    /**
     * 构建FlowElement字典，{ [flowEltId: string]: FlowElement }
     * @param {?} bpmnModel
     * @return {?}
     */
    buildFlowDict(bpmnModel) {
        /** @type {?} */
        let flowDict = bpmnModel.DefaultProcess.GetFlowElements();
        return flowDict;
    }
    /**
     * 构建DiagramElement字典，{ [flowEltId: string]: DiagramElement }
     * @param {?} bpmnModel
     * @return {?}
     */
    buildFlowDiagDict(bpmnModel) {
        /** @type {?} */
        const nodeDict = {};
        /** @type {?} */
        const edgeDict = {};
        /** @type {?} */
        const diagramElts = (/** @type {?} */ (bpmnModel.DefaultDiagram.BpmnPlane.GetDiagramElements()));
        diagramElts && diagramElts.forEach((/**
         * @param {?} elt
         * @return {?}
         */
        elt => {
            if (elt instanceof Node) {
                nodeDict[elt.BpmnElementId] = elt;
            }
            else if (elt instanceof Edge) {
                edgeDict[elt.BpmnElementId] = elt;
            }
        }));
        return {
            nodeDict,
            edgeDict,
        };
    }
    /**
     * 判断是否为旧版本BPMNEdge
     *
     * 旧版本连线Points数组中[0]和[1]分别表示起点和终点，因取值错误，[0]和[1]坐标均为(0,0)，以此为依据判断是否为旧版本的连线
     * 新版本从起点到终点按顺序记录每一个点坐标
     * @param {?} bpmnEdge
     * @return {?}
     */
    isOldBpmnEdge(bpmnEdge) {
        if (bpmnEdge.Points.length >= 2) {
            /** @type {?} */
            const pt1 = bpmnEdge.Points[0];
            /** @type {?} */
            const pt2 = bpmnEdge.Points[1];
            if (pt1.X == 0 && pt1.Y == 0 && pt2.X == 0 && pt2.Y == 0) {
                return true;
            }
        }
        return false;
    }
    /**
     * 获取节点样式
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @return {?}
     */
    getVertexStyle(flowElt, diagElt, additional) {
        /** @type {?} */
        const activityInstanceSlims = this.actList;
        /** @type {?} */
        let stateShapeStyle = null;
        // 特殊处理,业务活动要单独赋成人工操作类型的样式
        // if (flowElt.ClrTypeID === UserActivity.Clr_Type_ID) {
        //   stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[flowElt.ClrTypeID];
        // } else if (flowElt.ClrTypeID === OperationActivity.Clr_Type_ID) {
        //   stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[OperationActivity.Clr_Type_ID];
        // }
        if (flowElt instanceof UserActivity && flowElt.BizActivityID !== '') {
            stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[OperationActivity.Clr_Type_ID];
        }
        else {
            stateShapeStyle = this.cellStyleConfig.shapeStyleDic && this.cellStyleConfig.shapeStyleDic[flowElt.ClrTypeID];
        }
        if (stateShapeStyle == null) {
            return this.getVertexStyleOld(flowElt, additional);
        }
        /** @type {?} */
        let img = stateShapeStyle[FlowNodeState.Default] && stateShapeStyle[FlowNodeState.Default].image;
        if (!additional) {
            /** @type {?} */
            const acts = activityInstanceSlims.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.activityDefinitionId === flowElt.Id));
            if (acts && acts.length > 0) {
                if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                act => act.state === 'RUNNING')).length > 0) {
                    if (stateShapeStyle[FlowNodeState.Running]) {
                        img = stateShapeStyle[FlowNodeState.Running].image;
                    }
                }
                else if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                act => act.state === 'COMPLETED')).length > 0) {
                    if (stateShapeStyle[FlowNodeState.Completed]) {
                        img = stateShapeStyle[FlowNodeState.Completed].image;
                    }
                }
                else if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                act => act.state === 'TERMINATED')).length > 0) {
                    if (stateShapeStyle[FlowNodeState.Terminated]) {
                        img = stateShapeStyle[FlowNodeState.Terminated].image;
                    }
                }
            }
        }
        return img == null ? null : 'image=' + this.rootPath + img;
    }
    /**
     * 旧版diagramElement未存储样式信息
     * @param {?} flowElt
     * @param {?} additional
     * @return {?}
     */
    getVertexStyleOld(flowElt, additional) {
        /** @type {?} */
        let style;
        switch (flowElt.ClrTypeID) {
            //结束事件
            case "bpmn.EndEvent":
                style = 'end';
                break;
            //流程开始活动节点
            case StartActivity.Clr_Type_ID:
                style = 'start';
                break;
            // 业务活动节点
            case UserActivity.Clr_Type_ID:
                if (((/** @type {?} */ (flowElt))).BizActivityID) {
                    style = 'bizActivity';
                }
                else {
                    style = 'approval';
                }
                break;
            // 排他网关
            case 'bpmn.ExclusiveGateway':
                style = 'ExclusiveGateway';
                break;
            //并行网关
            case 'bpmn.ParallelGateway':
                style = 'ParallelGateway';
                break;
            case CallActivitySubProcess.Clr_Type_ID:
                style = 'sub';
                break;
            case AutoActivity.Clr_Type_ID:
                style = 'auto';
                break;
            case IntermediateCatchEventImpl.Clr_Type_ID:
                style = 'catchEvent';
                break;
            case OperationActivity.Clr_Type_ID:
                style = 'bizActivity';
                break;
            case MessageActivity.Clr_Type_ID:
                style = 'message';
                break;
            case NotifyActivity.Clr_Type_ID:
                style = 'notify';
                break;
            case AifCreationBillActivity.Clr_Type_ID:
                style = 'aifCreationActivity';
                break;
            default:
                break;
        }
        return 'image=' + this.rootPath + '/platform/runtime/common/web/@gsp-wf/wf-process-editor/images/' + style + this.getChartState(flowElt, additional) + ';';
    }
    /**
     * @param {?} flowElt
     * @param {?} additional
     * @return {?}
     */
    getChartState(flowElt, additional) {
        if (!additional) {
            /** @type {?} */
            const acts = this.actList.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.activityDefinitionId === flowElt.Id));
            if (acts && acts.length > 0) {
                if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                act => act.state === 'RUNNING')).length > 0) {
                    return '_light.gif';
                }
                else if (acts.filter((/**
                 * @param {?} act
                 * @return {?}
                 */
                act => act.state === 'COMPLETED')).length > 0
                    || acts.filter((/**
                     * @param {?} act
                     * @return {?}
                     */
                    act => act.state === 'TERMINATED')).length > 0) {
                    return '_gray.png';
                }
                else {
                    return '.png';
                }
            }
        }
        return '.png';
    }
    /**
     * 获取连线样式
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} parameters
     * @return {?}
     */
    getEdgeStyle(flowElt, diagElt, parameters) {
        if (parameters.get('jump')) {
            /** @type {?} */
            let style = '';
            /** @type {?} */
            const stateEdgeStyle = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic['bpmn.SequenceFlow'];
            if (stateEdgeStyle['jump']) {
                Object.keys(stateEdgeStyle['jump']).forEach((/**
                 * @param {?} key
                 * @return {?}
                 */
                (key) => {
                    style += (`${key}=${stateEdgeStyle['jump'][key]};`);
                }));
                return style;
            }
            return null;
        }
        else {
            /** @type {?} */
            const stateEdgeStyle = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic[flowElt.ClrTypeID];
            if (stateEdgeStyle == null) {
                return this.getEdgeStyleOld(flowElt, parameters.get('additional'), parameters.get('cut'));
            }
            /** @type {?} */
            const transitionInstanceSlims = this.transInsList;
            /** @type {?} */
            let style = '';
            if (parameters.get('cut')) {
                if (stateEdgeStyle[SequenceFlowState.Cut]) {
                    Object.keys(stateEdgeStyle[SequenceFlowState.Cut]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    (key) => {
                        style += (`${key}=${stateEdgeStyle[SequenceFlowState.Cut][key]};`);
                    }));
                    return style;
                }
            }
            if (parameters.get('additional')) {
                if (stateEdgeStyle[SequenceFlowState.Add]) {
                    Object.keys(stateEdgeStyle[SequenceFlowState.Add]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    (key) => {
                        style += (`${key}=${stateEdgeStyle[SequenceFlowState.Add][key]};`);
                    }));
                    return style;
                }
            }
            /** @type {?} */
            const transIns = transitionInstanceSlims.filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.sourceActivityDefinitionId === flowElt.SourceRef && item.destinationActivityDefinitionId === flowElt.TargetRef));
            if (transIns && transIns.filter((/**
             * @param {?} t
             * @return {?}
             */
            t => t.state === 'COMPLETED')).length > 0) {
                if (stateEdgeStyle[SequenceFlowState.Completed]) {
                    Object.keys(stateEdgeStyle[SequenceFlowState.Completed]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    (key) => {
                        style += (`${key}=${stateEdgeStyle[SequenceFlowState.Completed][key]};`);
                    }));
                    return style;
                }
            }
            if (this.mode === 'simulation') {
                if (stateEdgeStyle[SequenceFlowState.Simulation]) {
                    Object.keys(stateEdgeStyle[SequenceFlowState.Simulation]).forEach((/**
                     * @param {?} key
                     * @return {?}
                     */
                    (key) => {
                        style += (`${key}=${stateEdgeStyle[SequenceFlowState.Simulation][key]};`);
                    }));
                    return style;
                }
            }
            if (stateEdgeStyle[SequenceFlowState.Default]) {
                Object.keys(stateEdgeStyle[SequenceFlowState.Default]).forEach((/**
                 * @param {?} key
                 * @return {?}
                 */
                (key) => {
                    style += (`${key}=${stateEdgeStyle[SequenceFlowState.Default][key]};`);
                }));
            }
            return style;
        }
    }
    /**
     * 获取连线颜色
     * @param {?} flowElt
     * @param {?} diagElt
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    getStrokeColor(flowElt, diagElt, additional, cut) {
        /** @type {?} */
        const transitionInstanceSlims = this.transInsList;
        /** @type {?} */
        const stateEdgeStyle = this.cellStyleConfig.edgeStyleDic && this.cellStyleConfig.edgeStyleDic[flowElt.ClrTypeID];
        if (cut) {
            if (stateEdgeStyle[SequenceFlowState.Cut]) {
                return stateEdgeStyle[SequenceFlowState.Cut].strokeColor;
            }
        }
        if (additional) {
            if (stateEdgeStyle[SequenceFlowState.Add]) {
                return stateEdgeStyle[SequenceFlowState.Add].strokeColor;
            }
        }
        /** @type {?} */
        const transIns = transitionInstanceSlims.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.sourceActivityDefinitionId === flowElt.SourceRef && item.destinationActivityDefinitionId === flowElt.TargetRef));
        if (transIns && transIns.filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.state === 'COMPLETED')).length > 0) {
            if (stateEdgeStyle[SequenceFlowState.Completed]) {
                return stateEdgeStyle[SequenceFlowState.Completed].strokeColor;
            }
        }
        if (this.mode === 'simulation') {
            if (stateEdgeStyle[SequenceFlowState.Simulation]) {
                return stateEdgeStyle[SequenceFlowState.Simulation].strokeColor;
            }
        }
        return stateEdgeStyle[SequenceFlowState.Default].strokeColor;
    }
    /**
     * 旧版diagramElement未存储样式信息
     * @param {?} seq
     * @param {?} additional
     * @param {?} cut
     * @return {?}
     */
    getEdgeStyleOld(seq, additional, cut) {
        if (cut) {
            return 'strokeColor=#FF4040';
        }
        if (additional) {
            return 'strokeColor=#59A1FF';
        }
        /** @type {?} */
        const transIns = this.transInsList.filter((/**
         * @param {?} item
         * @return {?}
         */
        item => item.sourceActivityDefinitionId === seq.SourceRef && item.destinationActivityDefinitionId === seq.TargetRef));
        if (transIns && transIns.filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.state === 'COMPLETED')).length > 0) {
            return 'strokeColor=#595959;strokeWidth=2;';
        }
        if (this.mode === 'simulation') {
            return 'strokeColor=#f59c24;dashed=1;';
        }
        else {
            return 'strokeColor=#59A1FF;';
        }
    }
    /**
     * @param {?} actiDefId
     * @param {?} nodeDict
     * @param {?} edgeDict
     * @return {?}
     */
    drawNextFlowChart(actiDefId, nodeDict, edgeDict) {
        const { nextFlowNodeDict, nextSeqFlowDict } = this.findDrawFlowElementsByActDefId(actiDefId, this.bpmnModel);
        /** @type {?} */
        const actDef = (/** @type {?} */ (this.bpmnModel.DefaultProcess.GetFlowElement(actiDefId)));
        /** @type {?} */
        const outgoings = actDef.Outgoings;
        // 先插入节点
        Object.keys(nextFlowNodeDict).forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            /** @type {?} */
            const flowElt = nextFlowNodeDict[id];
            /** @type {?} */
            const diagElt = (/** @type {?} */ (nodeDict[flowElt.Id]));
            /** @type {?} */
            const cell = this.getCellByFlowElementId(flowElt.Id);
            if (!cell) {
                this.drawNodeCell(flowElt, diagElt, true);
            }
        }));
        // 再插入边
        Object.keys(nextSeqFlowDict).forEach((/**
         * @param {?} id
         * @return {?}
         */
        id => {
            /** @type {?} */
            const flowElt = nextSeqFlowDict[id];
            /** @type {?} */
            const diagElt = (/** @type {?} */ (edgeDict[flowElt.Id]));
            /** @type {?} */
            const cell = this.getCellByFlowElementId(flowElt.Id);
            if (!cell) {
                if (outgoings.some((/**
                 * @param {?} o
                 * @return {?}
                 */
                o => o === flowElt.Id))) {
                    this.drawEdgeCell(flowElt, diagElt, true, true);
                }
                else {
                    this.drawEdgeCell(flowElt, diagElt, true, false);
                }
            }
        }));
    }
    /**
     * 根据flowElementId获取cell
     * @param {?} flowEltId
     * @param {?=} parent
     * @return {?}
     */
    getCellByFlowElementId(flowEltId, parent) {
        parent = parent ? parent : this.getDefaultParent();
        /** @type {?} */
        const cells = this.getChildCells(parent);
        /** @type {?} */
        const cell = (/** @type {?} */ (cells.find((/**
         * @param {?} it
         * @return {?}
         */
        it => {
            if (it instanceof Cell) {
                return it.flowElement && it.flowElement.Id == flowEltId;
            }
            else {
                return false;
            }
        }))));
        return cell;
    }
    /**
     * @param {?} activities
     * @return {?}
     */
    findFirstStartActivityInstance(activities) {
        for (const act of activities) {
            if (!act.precursorActivityDefinitionId) {
                return act;
            }
        }
        return null;
    }
    /**
     * @param {?} nodeCells
     * @return {?}
     */
    findNoIncomingNodes(nodeCells) {
        /** @type {?} */
        const noIncomingNodes = new Array();
        for (const node of nodeCells) {
            if (node.flowElement.ClrTypeID === 'wf.StartActivity') {
                continue;
            }
            if (!node.edges || node.edges.length === 0) {
                noIncomingNodes.push(node);
                continue;
            }
            if (!node.edges.some((/**
             * @param {?} edge
             * @return {?}
             */
            edge => ((/** @type {?} */ (edge.target))).flowElement.Id === node.flowElement.Id))) {
                noIncomingNodes.push(node);
            }
        }
        return noIncomingNodes;
    }
    /**
     * @param {?} firstAct
     * @param {?} activities
     * @param {?} transInsList
     * @return {?}
     */
    findEndActiInstList(firstAct, activities, transInsList) {
        /** @type {?} */
        const endActiInstList = [];
        this.getNextTransitions(endActiInstList, firstAct.activityInstanceId, activities, transInsList);
        return endActiInstList;
    }
    /**
     * @param {?} endActiInstList
     * @param {?} sourceActInstId
     * @param {?} activities
     * @param {?} transInsList
     * @return {?}
     */
    getNextTransitions(endActiInstList, sourceActInstId, activities, transInsList) {
        /** @type {?} */
        const nextTransitions = this.findTranInstsBySourceActInstId(sourceActInstId, transInsList);
        if (nextTransitions && nextTransitions.length > 0) {
            for (const t of nextTransitions) {
                if (t.destinationActivityDefinitionId) {
                    this.getNextTransitions(endActiInstList, t.destinationActivityInstanceId, activities, transInsList);
                }
            }
        }
        else {
            /** @type {?} */
            const actInst = this.findActInstByActInstId(sourceActInstId, activities);
            if (actInst) {
                if (!endActiInstList.some((/**
                 * @param {?} a
                 * @return {?}
                 */
                a => a.activityInstanceId === actInst.activityInstanceId))) {
                    endActiInstList.push(actInst);
                }
            }
        }
    }
    /**
     * @param {?} sourceActInstId
     * @param {?} transInsList
     * @return {?}
     */
    findTranInstsBySourceActInstId(sourceActInstId, transInsList) {
        return transInsList.filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.sourceActivityInstanceId === sourceActInstId));
    }
    /**
     * @param {?} actInstId
     * @param {?} activities
     * @return {?}
     */
    findActInstByActInstId(actInstId, activities) {
        return activities.find((/**
         * @param {?} a
         * @return {?}
         */
        a => a.activityInstanceId === actInstId));
    }
    /**
     * @param {?} actiDefId
     * @param {?} bpmnModel
     * @return {?}
     */
    findDrawFlowElementsByActDefId(actiDefId, bpmnModel) {
        /** @type {?} */
        const nextFlowNodeDict = {};
        /** @type {?} */
        const nextSeqFlowDict = {};
        this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, actiDefId, bpmnModel);
        return {
            nextFlowNodeDict,
            nextSeqFlowDict,
        };
    }
    /**
     * @param {?} nextFlowNodeDict
     * @param {?} nextSeqFlowDict
     * @param {?} flowElementId
     * @param {?} bpmnModel
     * @return {?}
     */
    findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, flowElementId, bpmnModel) {
        /** @type {?} */
        const flowElt = bpmnModel.DefaultProcess.GetFlowElement(flowElementId);
        if (flowElt && nextFlowNodeDict[flowElementId] == null) {
            if (flowElt instanceof SequenceFlow) {
                nextSeqFlowDict[flowElt.Id] = flowElt;
                this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, flowElt.TargetRef, bpmnModel);
            }
            else if (flowElt instanceof FlowNode) {
                nextFlowNodeDict[flowElt.Id] = flowElt;
                if ((flowElt instanceof EndEvent) == false) {
                    flowElt.Outgoings && flowElt.Outgoings.forEach((/**
                     * @param {?} outgoing
                     * @return {?}
                     */
                    outgoing => {
                        this.findNextFlowElementsByFlowElementId(nextFlowNodeDict, nextSeqFlowDict, outgoing, bpmnModel);
                    }));
                }
            }
        }
    }
}
if (false) {
    /** @type {?} */
    FlowGraph.prototype.bpmnModel;
    /** @type {?} */
    FlowGraph.prototype.autoTranslate;
    /** @type {?} */
    FlowGraph.prototype.scrollTileSize;
    /** @type {?} */
    FlowGraph.prototype.getPagePadding;
    /** @type {?} */
    FlowGraph.prototype.getPageSize;
    /** @type {?} */
    FlowGraph.prototype.getScrollTileSize;
    /** @type {?} */
    FlowGraph.prototype.getPageLayout;
    /** @type {?} */
    FlowGraph.prototype.cellStyleConfig;
    /** @type {?} */
    FlowGraph.prototype.actList;
    /** @type {?} */
    FlowGraph.prototype.transInsList;
    /** @type {?} */
    FlowGraph.prototype.mode;
    /** @type {?} */
    FlowGraph.prototype.rootPath;
    /**
     * 当前语言
     * @type {?}
     */
    FlowGraph.prototype.langCode;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmxvd0dyYXBoLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi91aS1mbG93Y2hhcnQvIiwic291cmNlcyI6WyJsaWIvZmxvdy1jaGFydC9GbG93R3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBYSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMxSCxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFvRCxZQUFZLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeE0sT0FBTyxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsc0JBQXNCLEVBQUUsWUFBWSxFQUFFLDBCQUEwQixFQUFFLGlCQUFpQixFQUFFLGVBQWUsRUFBRSxjQUFjLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0TixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBTXJDLE1BQU0sT0FBTyxTQUFVLFNBQVEsT0FBTzs7Ozs7SUF1QmxDLFlBQVksU0FBeUIsRUFBRSxlQUFpQztRQUNwRSxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFyQnJCLG1CQUFjLEdBQTBCLElBQUksV0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBTXhFLG9CQUFlLEdBQW9CO1lBQy9CLFlBQVksRUFBRSxFQUFFO1lBQ2hCLGFBQWEsRUFBRSxFQUFFO1NBQ3BCLENBQUM7UUFFRixZQUFPLEdBQTJCLEVBQUUsQ0FBQztRQUNyQyxpQkFBWSxHQUE2QixFQUFFLENBQUM7UUFFNUMsYUFBUSxHQUFXLEVBQUUsQ0FBQyxDQUFBLEtBQUs7Ozs7O1FBSTNC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SUFDYiw2QkFBc0I7Ozs7O0lBSXRCLDZCQUF5SyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG14R3JhcGgsIG14RXZlbnQsIG14Q29uc3RhbnRzLCBteFBvaW50LCBteFJlY3RhbmdsZSwgbXhVdGlscywgTXhHcmFwaE5TLCBteEdlb21ldHJ5IH0gZnJvbSBcIkBlZHAtcG1mL214Z3JhcGgtdHNcIjtcclxuaW1wb3J0IHsgRW5kRXZlbnQsIEJwbW5Nb2RlbCwgUHJvY2VzcywgQlBNTkRpYWdyYW0sIEZsb3dFbGVtZW50LCBEaWFncmFtRWxlbWVudCwgQlBNTlNoYXBlLCBCUE1ORWRnZSwgU2VxdWVuY2VGbG93LCBGbG93Tm9kZSwgTm9kZSwgRWRnZSwgRmxvd05vZGVTdGF0ZSwgU2VxdWVuY2VGbG93U3RhdGUgfSBmcm9tIFwiQGVkcC1wbWYvYnBtbi1tb2RlbFwiO1xyXG5pbXBvcnQgeyBTdGFydEFjdGl2aXR5LCBVc2VyQWN0aXZpdHksIENhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIEF1dG9BY3Rpdml0eSwgSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwsIE9wZXJhdGlvbkFjdGl2aXR5LCBNZXNzYWdlQWN0aXZpdHksIE5vdGlmeUFjdGl2aXR5LCBBaWZDcmVhdGlvbkJpbGxBY3Rpdml0eSB9IGZyb20gXCJAZ3NwLXdmL3dmLXByb2Nlc3MtbW9kZWxcIjtcclxuaW1wb3J0IHsgQ2VsbCB9IGZyb20gXCIuL2VudGl0eS9DZWxsXCI7XHJcbmltcG9ydCB7IEFjdGl2aXR5SW5zdGFuY2VTbGltIH0gZnJvbSBcIi4vZW50aXR5L0FjdGl2aXR5SW5zdGFuY2VTbGltXCI7XHJcbmltcG9ydCB7IFRyYW5zaXRpb25JbnN0YW5jZVNsaW0gfSBmcm9tIFwiLi9lbnRpdHkvVHJhbnNpdGlvbkluc3RhbmNlU2xpbVwiO1xyXG5pbXBvcnQgeyBDZWxsU3R5bGVDb25maWcgfSBmcm9tIFwiLi4vZW50aXR5L2NlbGwtc3R5bGUvQ2VsbFN0eWxlQ29uZmlnXCI7XHJcbmltcG9ydCB7IFN0YXRlU2hhcGVTdHlsZSB9IGZyb20gXCIuLi9lbnRpdHkvY2VsbC1zdHlsZS9TdGF0ZVNoYXBlU3R5bGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBGbG93R3JhcGggZXh0ZW5kcyBteEdyYXBoIHtcclxuICAgIGJwbW5Nb2RlbDogQnBtbk1vZGVsO1xyXG4gICAgYXV0b1RyYW5zbGF0ZTogYm9vbGVhbjtcclxuICAgIHNjcm9sbFRpbGVTaXplOiBNeEdyYXBoTlMubXhSZWN0YW5nbGUgPSBuZXcgbXhSZWN0YW5nbGUoMCwgMCwgNDAwLCA2MDApO1xyXG4gICAgZ2V0UGFnZVBhZGRpbmc6ICgpID0+IE14R3JhcGhOUy5teFBvaW50O1xyXG4gICAgZ2V0UGFnZVNpemU6ICgpID0+IE14R3JhcGhOUy5teFJlY3RhbmdsZTtcclxuICAgIGdldFNjcm9sbFRpbGVTaXplOiAoKSA9PiBNeEdyYXBoTlMubXhSZWN0YW5nbGU7XHJcbiAgICBnZXRQYWdlTGF5b3V0OiAoKSA9PiBNeEdyYXBoTlMubXhSZWN0YW5nbGU7XHJcblxyXG4gICAgY2VsbFN0eWxlQ29uZmlnOiBDZWxsU3R5bGVDb25maWcgPSB7XHJcbiAgICAgICAgZWRnZVN0eWxlRGljOiB7fSxcclxuICAgICAgICBzaGFwZVN0eWxlRGljOiB7fSxcclxuICAgIH07XHJcblxyXG4gICAgYWN0TGlzdDogQWN0aXZpdHlJbnN0YW5jZVNsaW1bXSA9IFtdO1xyXG4gICAgdHJhbnNJbnNMaXN0OiBUcmFuc2l0aW9uSW5zdGFuY2VTbGltW10gPSBbXTtcclxuICAgIG1vZGU6IHN0cmluZztcclxuICAgIHJvb3RQYXRoOiBzdHJpbmcgPSAnJzsvL+Wfuui3r+W+hFxyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliY3or63oqIBcclxuICAgICAqL1xyXG4gICAgbGFuZ0NvZGUgPSAod2luZG93IGFzIGFueSkuZ3NwZnJhbWV3b3JrU2VydmljZSAmJiAod2luZG93IGFzIGFueSkuZ3NwZnJhbWV3b3JrU2VydmljZS5ydGYubGFuZ3VhZ2UuZ2V0TGFuZ3VhZ2VDb2RlKCkgfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIHx8ICd6aC1DSFMnO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQsIGNlbGxTdHlsZUNvbmZpZz86IENlbGxTdHlsZUNvbmZpZykge1xyXG4gICAgICAgIHN1cGVyKGNvbnRhaW5lcik7XHJcbiAgICAgICAgLy/ojrflj5bln7rot6/lvoRcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLnJvb3RQYXRoID0gKHdpbmRvdyBhcyBhbnkpLmdzcGZyYW1ld29ya1NlcnZpY2UuY29tbW9uLmdldEJhc2VQYXRoLmdldCgpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2VsbFN0eWxlQ29uZmlnID0gY2VsbFN0eWxlQ29uZmlnID8gY2VsbFN0eWxlQ29uZmlnIDogdGhpcy5jZWxsU3R5bGVDb25maWc7XHJcbiAgICAgICAgdGhpcy5hdXRvU2Nyb2xsID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hdXRvRXh0ZW5kID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnBhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgLy90aGlzLnBhbm5pbmdIYW5kbGVyLmlnbm9yZUNlbGwgPSB0cnVlO1xyXG4gICAgICAgIC8vdGhpcy5zZXRQYW5uaW5nKHRydWUpO1xyXG4gICAgICAgIHRoaXMuc2V0Q2VsbHNTZWxlY3RhYmxlKHRydWUpO1xyXG4gICAgICAgIHRoaXMuc2V0RGlzY29ubmVjdE9uTW92ZShmYWxzZSk7XHJcbiAgICAgICAgLy/oioLngrnkuI3lj6/mlLnlj5jlpKflsI9cclxuICAgICAgICB0aGlzLnNldENlbGxzUmVzaXphYmxlKGZhbHNlKTtcclxuICAgICAgICAvL2NlbGzmmK/lkKblj6/ku6Xov57nur9cclxuICAgICAgICB0aGlzLnNldENvbm5lY3RhYmxlKGZhbHNlKTtcclxuICAgICAgICAvL+emgeatouaTjeS9nFxyXG4gICAgICAgIHRoaXMuc2V0RW5hYmxlZCh0cnVlKTtcclxuICAgICAgICAvL+iuvue9rmNlbGzmlofmnKzmmK/lkKblj6/np7vliqhcclxuICAgICAgICB0aGlzLnNldFZlcnRleExhYmVsc01vdmFibGUoZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLnNldENlbGxzTG9ja2VkKHRydWUpO1xyXG4gICAgICAgIC8v5LiN5YWB6K645Zu+5LiK5a2Y5Zyo5rKh5pyJ6L+e5o6l5rS75Yqo6IqC54K555qE57q/77yI6Ziy5q2i5ouW5Yqo57q/6L+e5o6l54K55a+86Ie05aSx5Y676L+e5o6l77yJLOi/mOayoeacieaJvuWIsOS4jeWFgeiuuOaLluWKqOi/nuaOpeaOp+WItueCueeahOWxnuaAp1xyXG4gICAgICAgIHRoaXMuc2V0QWxsb3dEYW5nbGluZ0VkZ2VzKGZhbHNlKTtcclxuICAgICAgICBteEV2ZW50LmRpc2FibGVDb250ZXh0TWVudShjb250YWluZXIpO1xyXG5cclxuICAgICAgICAvLyDorr7nva7pu5jorqTmoLflvI9cclxuICAgICAgICB0aGlzLnNldERlZmF1bHRTdHlsZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmHjeWGmeWIm+W7uuiKgueCueWvueixoeaWueazlVxyXG4gICAgICogQHBhcmFtIHBhcmVudFxyXG4gICAgICogQHBhcmFtIGlkXHJcbiAgICAgKiBAcGFyYW0gdmFsdWVcclxuICAgICAqIEBwYXJhbSB4XHJcbiAgICAgKiBAcGFyYW0geVxyXG4gICAgICogQHBhcmFtIHdpZHRoXHJcbiAgICAgKiBAcGFyYW0gaGVpZ2h0XHJcbiAgICAgKiBAcGFyYW0gc3R5bGVcclxuICAgICAqIEBwYXJhbSByZWxhdGl2ZVxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgY3JlYXRlVmVydGV4KHBhcmVudCwgaWQsIHZhbHVlLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBzdHlsZSwgcmVsYXRpdmUpIHtcclxuICAgICAgICAvLyBDcmVhdGVzIHRoZSBnZW9tZXRyeSBmb3IgdGhlIHZlcnRleFxyXG4gICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IG14R2VvbWV0cnkoeCwgeSwgd2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgZ2VvbWV0cnkucmVsYXRpdmUgPSAocmVsYXRpdmUgIT0gbnVsbCkgPyByZWxhdGl2ZSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAvLyBDcmVhdGVzIHRoZSB2ZXJ0ZXhcclxuICAgICAgICBjb25zdCB2ZXJ0ZXggPSBuZXcgQ2VsbCh2YWx1ZSwgZ2VvbWV0cnksIHN0eWxlKTtcclxuICAgICAgICB2ZXJ0ZXguc2V0SWQoaWQpO1xyXG4gICAgICAgIHZlcnRleC5zZXRWZXJ0ZXgodHJ1ZSk7XHJcbiAgICAgICAgdmVydGV4LnNldENvbm5lY3RhYmxlKHRydWUpO1xyXG5cclxuICAgICAgICByZXR1cm4gdmVydGV4O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YeN5YaZ5Yib5bu66L655a+56LGh5pa55rOVXHJcbiAgICAgKiBAcGFyYW0gcGFyZW50XHJcbiAgICAgKiBAcGFyYW0gaWRcclxuICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIHNvdXJjZVxyXG4gICAgICogQHBhcmFtIHRhcmdldFxyXG4gICAgICogQHBhcmFtIHN0eWxlXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBjcmVhdGVFZGdlKHBhcmVudCwgaWQsIHZhbHVlLCBzb3VyY2UsIHRhcmdldCwgc3R5bGUpIHtcclxuICAgICAgICAvLyBDcmVhdGVzIHRoZSBlZGdlXHJcbiAgICAgICAgdmFyIGVkZ2UgPSBuZXcgQ2VsbCh2YWx1ZSwgbmV3IG14R2VvbWV0cnkoKSwgc3R5bGUpO1xyXG4gICAgICAgIGVkZ2Uuc2V0SWQoaWQpO1xyXG4gICAgICAgIGVkZ2Uuc2V0RWRnZSh0cnVlKTtcclxuICAgICAgICBlZGdlLmdlb21ldHJ5LnJlbGF0aXZlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGVkZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDorr7nva7pu5jorqTmoLflvI9cclxuICAgICAqL1xyXG4gICAgc2V0RGVmYXVsdFN0eWxlcygpIHtcclxuICAgICAgICBjb25zdCBzdHlsZVNoZWV0ID0gdGhpcy5nZXRTdHlsZXNoZWV0KCk7XHJcbiAgICAgICAgLy8g6IqC54K56buY6K6k5qC35byPXHJcbiAgICAgICAgY29uc3QgdmVydGV4U3R5bGUgPSBzdHlsZVNoZWV0LmdldERlZmF1bHRWZXJ0ZXhTdHlsZSgpO1xyXG4gICAgICAgIHZlcnRleFN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NIQVBFXSA9IG14Q29uc3RhbnRzLlNIQVBFX0lNQUdFO1xyXG4gICAgICAgIHZlcnRleFN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1ZFUlRJQ0FMX0xBQkVMX1BPU0lUSU9OXSA9IG14Q29uc3RhbnRzLkFMSUdOX0JPVFRPTTtcclxuICAgICAgICB2ZXJ0ZXhTdHlsZVtteENvbnN0YW50cy5TVFlMRV9GT05UU0laRV0gPSAxMjtcclxuICAgICAgICB2ZXJ0ZXhTdHlsZVtteENvbnN0YW50cy5TVFlMRV9GT05URkFNSUxZXSA9ICdIZWx2ZXRpY2EnO1xyXG4gICAgICAgIHZlcnRleFN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0ZPTlRDT0xPUl0gPSBcIiMzMzNcIjtcclxuXHJcbiAgICAgICAgLy8g6L+e57q/5qC35byP6buY6K6k5Li65q2j5LqkXHJcbiAgICAgICAgY29uc3QgZWRnZVN0eWxlID0gc3R5bGVTaGVldC5nZXREZWZhdWx0RWRnZVN0eWxlKCk7XHJcbiAgICAgICAgZWRnZVN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NPVVJDRV9QT1JUXSA9ICdlJztcclxuICAgICAgICBlZGdlU3R5bGVbbXhDb25zdGFudHMuU1RZTEVfVEFSR0VUX1BPUlRdID0gJ3cnO1xyXG4gICAgICAgIGVkZ2VTdHlsZVtteENvbnN0YW50cy5TVFlMRV9FREdFXSA9IG14Q29uc3RhbnRzLkVER0VTVFlMRV9PUlRIT0dPTkFMO1xyXG4gICAgICAgIGVkZ2VTdHlsZVtteENvbnN0YW50cy5TVFlMRV9ST1VOREVEXSA9IDE7XHJcbiAgICAgICAgZWRnZVN0eWxlW214Q29uc3RhbnRzLlNUWUxFX1NUUk9LRUNPTE9SXSA9ICcjNjQ4MkI5JztcclxuICAgICAgICBlZGdlU3R5bGVbbXhDb25zdGFudHMuU1RZTEVfRk9OVFNJWkVdID0gMTI7XHJcbiAgICAgICAgZWRnZVN0eWxlW214Q29uc3RhbnRzLlNUWUxFX0ZPTlRGQU1JTFldID0gJ0hlbHZldGljYSc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rml6DpmZDlpKfnlLvluINcclxuICAgICAqL1xyXG4gICAgY3JlYXRlSW5maW5pdGVDYW52YXMoKSB7XHJcbiAgICAgICAgdGhpcy5nZXRQYWdlUGFkZGluZyA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBteFBvaW50KFxyXG4gICAgICAgICAgICAgICAgTWF0aC5tYXgoMCwgTWF0aC5yb3VuZCh0aGlzLmNvbnRhaW5lci5vZmZzZXRXaWR0aCAtIDM0KSksXHJcbiAgICAgICAgICAgICAgICBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKHRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodCAtIDM0KSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRTY3JvbGxUaWxlU2l6ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVGlsZVNpemUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUaWxlU2l6ZSA9IG5ldyBteFJlY3RhbmdsZSgwLCAwLCA0MDAsIDYwMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNjcm9sbFRpbGVTaXplO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRQYWdlU2l6ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLnBhZ2VWaXNpYmxlKSA/IG5ldyBteFJlY3RhbmdsZSgwLCAwLCB0aGlzLnBhZ2VGb3JtYXQud2lkdGggKiB0aGlzLnBhZ2VTY2FsZSwgdGhpcy5wYWdlRm9ybWF0LmhlaWdodCAqIHRoaXMucGFnZVNjYWxlKSA6IHRoaXMuZ2V0U2Nyb2xsVGlsZVNpemUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0UGFnZUxheW91dCA9ICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IHNpemUgPSAodGhpcy5wYWdlVmlzaWJsZSkgPyB0aGlzLmdldFBhZ2VTaXplKCkgOiB0aGlzLmdldFNjcm9sbFRpbGVTaXplKCk7XHJcbiAgICAgICAgICAgIGxldCBib3VuZHMgPSB0aGlzLmdldEdyYXBoQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYm91bmRzLndpZHRoID09IDAgfHwgYm91bmRzLmhlaWdodCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG14UmVjdGFuZ2xlKDAsIDAsIDEsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gQ29tcHV0ZXMgdW50cmFuc2Zvcm1lZCBncmFwaCBib3VuZHNcclxuICAgICAgICAgICAgICAgIGxldCB4ID0gTWF0aC5jZWlsKGJvdW5kcy54IC8gdGhpcy52aWV3LnNjYWxlIC0gdGhpcy52aWV3LnRyYW5zbGF0ZS54KTtcclxuICAgICAgICAgICAgICAgIGxldCB5ID0gTWF0aC5jZWlsKGJvdW5kcy55IC8gdGhpcy52aWV3LnNjYWxlIC0gdGhpcy52aWV3LnRyYW5zbGF0ZS55KTtcclxuICAgICAgICAgICAgICAgIGxldCB3ID0gTWF0aC5mbG9vcihib3VuZHMud2lkdGggLyB0aGlzLnZpZXcuc2NhbGUpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGggPSBNYXRoLmZsb29yKGJvdW5kcy5oZWlnaHQgLyB0aGlzLnZpZXcuc2NhbGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB4MCA9IE1hdGguZmxvb3IoeCAvIHNpemUud2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHkwID0gTWF0aC5mbG9vcih5IC8gc2l6ZS5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHcwID0gTWF0aC5jZWlsKCh4ICsgdykgLyBzaXplLndpZHRoKSAtIHgwO1xyXG4gICAgICAgICAgICAgICAgbGV0IGgwID0gTWF0aC5jZWlsKCh5ICsgaCkgLyBzaXplLmhlaWdodCkgLSB5MDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG14UmVjdGFuZ2xlKHgwLCB5MCwgdzAsIGgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5nZXRQcmVmZXJyZWRQYWdlU2l6ZSA9IChib3VuZHMsIHdpZHRoLCBoZWlnaHQpID0+IHtcclxuICAgICAgICAgICAgbGV0IHBhZ2VzID0gdGhpcy5nZXRQYWdlTGF5b3V0KCk7XHJcbiAgICAgICAgICAgIGxldCBzaXplID0gdGhpcy5nZXRQYWdlU2l6ZSgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBteFJlY3RhbmdsZSgwLCAwLCBwYWdlcy53aWR0aCAqIHNpemUud2lkdGgsIHBhZ2VzLmhlaWdodCAqIHNpemUuaGVpZ2h0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyDph43lhpnnlLvluIPlpKflsI/lj5jljJblkI7mlrnms5VcclxuICAgICAgICBjb25zdCBncmFwaFNpemVEaWRDaGFuZ2UgPSB0aGlzLnNpemVEaWRDaGFuZ2U7XHJcbiAgICAgICAgdGhpcy5zaXplRGlkQ2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIgIT0gbnVsbCAmJiBteFV0aWxzLmhhc1Njcm9sbGJhcnModGhpcy5jb250YWluZXIpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFnZXMgPSB0aGlzLmdldFBhZ2VMYXlvdXQoKTtcclxuICAgICAgICAgICAgICAgIGxldCBwYWQgPSB0aGlzLmdldFBhZ2VQYWRkaW5nKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2l6ZSA9IHRoaXMuZ2V0UGFnZVNpemUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIHRoZSBtaW5pbXVtIGdyYXBoIHNpemVcclxuICAgICAgICAgICAgICAgIGxldCBtaW53ID0gTWF0aC5jZWlsKDIgKiBwYWQueCAvIHRoaXMudmlldy5zY2FsZSArIHBhZ2VzLndpZHRoICogc2l6ZS53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWluaCA9IE1hdGguY2VpbCgyICogcGFkLnkgLyB0aGlzLnZpZXcuc2NhbGUgKyBwYWdlcy5oZWlnaHQgKiBzaXplLmhlaWdodCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG1pbiA9IHRoaXMubWluaW11bUdyYXBoU2l6ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBMQVRFUjogRml4IGZsaWNrZXIgb2Ygc2Nyb2xsYmFyIHNpemUgaW4gSUUgcXVpcmtzIG1vZGVcclxuICAgICAgICAgICAgICAgIC8vIGFmdGVyIGRlbGF5ZWQgY2FsbCBpbiB3aW5kb3cucmVzaXplIGV2ZW50IGhhbmRsZXJcclxuICAgICAgICAgICAgICAgIGlmIChtaW4gPT0gbnVsbCB8fCBtaW4ud2lkdGggIT0gbWludyB8fCBtaW4uaGVpZ2h0ICE9IG1pbmgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1pbmltdW1HcmFwaFNpemUgPSBuZXcgbXhSZWN0YW5nbGUoMCwgMCwgbWludywgbWluaCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlcyBhdXRvLXRyYW5zbGF0ZSB0byBpbmNsdWRlIHBhZGRpbmcgYW5kIGdyYXBoIHNpemVcclxuICAgICAgICAgICAgICAgIGxldCBkeCA9IHBhZC54IC8gdGhpcy52aWV3LnNjYWxlIC0gcGFnZXMueCAqIHNpemUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBsZXQgZHkgPSBwYWQueSAvIHRoaXMudmlldy5zY2FsZSAtIHBhZ2VzLnkgKiBzaXplLmhlaWdodDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYXV0b1RyYW5zbGF0ZSAmJiAodGhpcy52aWV3LnRyYW5zbGF0ZS54ICE9IGR4IHx8IHRoaXMudmlldy50cmFuc2xhdGUueSAhPSBkeSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dG9UcmFuc2xhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICh0aGlzLnZpZXcgYXMgYW55KS54MCA9IHBhZ2VzLng7XHJcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMudmlldyBhcyBhbnkpLnkwID0gcGFnZXMueTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR4ID0gdGhpcy52aWV3LnRyYW5zbGF0ZS54O1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0eSA9IHRoaXMudmlldy50cmFuc2xhdGUueTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3LnNldFRyYW5zbGF0ZShkeCwgZHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbExlZnQgKz0gKGR4IC0gdHgpICogdGhpcy52aWV3LnNjYWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCArPSAoZHkgLSB0eSkgKiB0aGlzLnZpZXcuc2NhbGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b1RyYW5zbGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBncmFwaFNpemVEaWRDaGFuZ2UuYXBwbHkodGhpcywgW10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8g6YeN5YaZdmlld+iOt+WPluiDjOaZr+mhteWkp+Wwj1xyXG4gICAgICAgIHRoaXMudmlldy5nZXRCYWNrZ3JvdW5kUGFnZUJvdW5kcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IGxheW91dCA9IHRoaXMuZ2V0UGFnZUxheW91dCgpO1xyXG4gICAgICAgICAgICBsZXQgcGFnZSA9IHRoaXMuZ2V0UGFnZVNpemUoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgbXhSZWN0YW5nbGUoXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcuc2NhbGUgKiAodGhpcy52aWV3LnRyYW5zbGF0ZS54ICsgbGF5b3V0LnggKiBwYWdlLndpZHRoKSxcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5zY2FsZSAqICh0aGlzLnZpZXcudHJhbnNsYXRlLnkgKyBsYXlvdXQueSAqIHBhZ2UuaGVpZ2h0KSxcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5zY2FsZSAqIGxheW91dC53aWR0aCAqIHBhZ2Uud2lkdGgsXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcuc2NhbGUgKiBsYXlvdXQuaGVpZ2h0ICogcGFnZS5oZWlnaHRcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8g6YeN5YaZdmlldyB2YWxpZGF0ZeaWueazlVxyXG4gICAgICAgIGNvbnN0IGdyYXBoVmlld1ZhbGlkYXRlID0gdGhpcy52aWV3LnZhbGlkYXRlO1xyXG4gICAgICAgIHRoaXMudmlldy52YWxpZGF0ZSA9IChjZWxsPzogTXhHcmFwaE5TLm14Q2VsbCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250YWluZXIgIT0gbnVsbCAmJiBteFV0aWxzLmhhc1Njcm9sbGJhcnModGhpcy5jb250YWluZXIpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcGFkID0gdGhpcy5nZXRQYWdlUGFkZGluZygpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNpemUgPSB0aGlzLmdldFBhZ2VTaXplKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdHggPSB0aGlzLnZpZXcudHJhbnNsYXRlLng7XHJcbiAgICAgICAgICAgICAgICBsZXQgdHkgPSB0aGlzLnZpZXcudHJhbnNsYXRlLnk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcudHJhbnNsYXRlLnggPSBwYWQueCAvIHRoaXMudmlldy5zY2FsZSAtICgodGhpcy52aWV3IGFzIGFueSkueDAgfHwgMCkgKiBzaXplLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnRyYW5zbGF0ZS55ID0gcGFkLnkgLyB0aGlzLnZpZXcuc2NhbGUgLSAoKHRoaXMudmlldyBhcyBhbnkpLnkwIHx8IDApICogc2l6ZS5oZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdyYXBoVmlld1ZhbGlkYXRlLmFwcGx5KHRoaXMudmlldywgW2NlbGxdKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7ukJwbW5Nb2RlbFxyXG4gICAgICovXHJcbiAgICBjcmVhdGVCcG1uTW9kZWwoKSB7XHJcbiAgICAgICAgY29uc3QgYnBtbk1vZGVsID0gbmV3IEJwbW5Nb2RlbCgpO1xyXG4gICAgICAgIGJwbW5Nb2RlbC5UYXJnZXROYW1lc3BhY2UgPSBcIkRlZmF1bHRfTmFtZXNwYWNlXCI7XHJcbiAgICAgICAgYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzID0gbmV3IFByb2Nlc3MoYnBtbk1vZGVsKTtcclxuICAgICAgICBicG1uTW9kZWwuRGVmYXVsdERpYWdyYW0gPSBuZXcgQlBNTkRpYWdyYW0oYnBtbk1vZGVsKTtcclxuICAgICAgICBicG1uTW9kZWwuRGVmYXVsdERpYWdyYW0uQnBtblBsYW5lLkJwbW5FbGVtZW50SWQgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuSWQ7XHJcblxyXG4gICAgICAgIHJldHVybiBicG1uTW9kZWw7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliqDovb1CcG1uTW9kZWzlubbnlLvlm75cclxuICAgICAqL1xyXG4gICAgbG9hZEJwbW5Nb2RlbChqc29uOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUNlbGxzKHRoaXMuZ2V0Q2hpbGRDZWxscyh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSkpO1xyXG4gICAgICAgIHRoaXMuYnBtbk1vZGVsID0gdGhpcy5jcmVhdGVCcG1uTW9kZWwoKTtcclxuICAgICAgICB0aGlzLmJwbW5Nb2RlbC5Mb2FkRnJvbUpzb24oanNvbik7XHJcbiAgICAgICAgdGhpcy5kcmF3QnBtbkdyYXBoKHRoaXMuYnBtbk1vZGVsKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmHjeaWsOWKoOi9vUJwbW5Nb2RlbOW5tueUu+WbvlxyXG4gICAgICogQHBhcmFtIGpzb25cclxuICAgICAqL1xyXG4gICAgcmVsb2FkQnBtbk1vZGVsKGpzb24/OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUNlbGxzKHRoaXMuZ2V0Q2hpbGRDZWxscyh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSkpO1xyXG4gICAgICAgIGlmIChqc29uKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZEJwbW5Nb2RlbChqc29uKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdCcG1uR3JhcGgodGhpcy5icG1uTW9kZWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOagueaNrkJwbW5Nb2RlbOeUu+WbvlxyXG4gICAgICovXHJcbiAgICBkcmF3QnBtbkdyYXBoKGJwbW5Nb2RlbDogQnBtbk1vZGVsKSB7XHJcbiAgICAgICAgY29uc3QgeyBub2RlRGljdCwgZWRnZURpY3QgfSA9IHRoaXMuYnVpbGRGbG93RGlhZ0RpY3QoYnBtbk1vZGVsKTtcclxuICAgICAgICBjb25zdCBmbG93RGljdCA9IHRoaXMuYnVpbGRGbG93RGljdChicG1uTW9kZWwpO1xyXG4gICAgICAgIHRoaXMuZHJhd05vZGVDZWxscyhmbG93RGljdCwgbm9kZURpY3QpO1xyXG4gICAgICAgIHRoaXMuZHJhd0VkZ2VDZWxscyhmbG93RGljdCwgZWRnZURpY3QpO1xyXG4gICAgICAgIHRoaXMuZ2V0TW9kZWwoKS5iZWdpblVwZGF0ZSgpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzaW11bGF0aW9uJykge1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdJbnRlcmNlcHRHcmFwaChmbG93RGljdCwgbm9kZURpY3QsIGVkZ2VEaWN0KTtcclxuICAgICAgICAgICAgdGhpcy5hZGRKdW1wRWRnZXMoZmxvd0RpY3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldE1vZGVsKCkuZW5kVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3SW50ZXJjZXB0R3JhcGgoZmxvd0RpY3Q6IHsgW2tleTogc3RyaW5nXTogRmxvd0VsZW1lbnQ7IH0sXHJcbiAgICAgICAgbm9kZURpY3Q6IHsgW0JwbW5FbGVtZW50SWQ6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9LFxyXG4gICAgICAgIGVkZ2VEaWN0OiB7IFtCcG1uRWxlbWVudElkOiBzdHJpbmddOiBEaWFncmFtRWxlbWVudDsgfSkge1xyXG4gICAgICAgIGNvbnN0IGZpcnN0QWN0ID0gdGhpcy5maW5kRmlyc3RTdGFydEFjdGl2aXR5SW5zdGFuY2UodGhpcy5hY3RMaXN0KTtcclxuICAgICAgICAvLyB0b2Rv77ya5q2k5aSE5b6F5L+u5aSNXHJcbiAgICAgICAgbGV0IGVuZEFjdERlZjogRW5kRXZlbnQ7XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZmxvd0RpY3QpIHtcclxuICAgICAgICAgICAgaWYgKGZsb3dEaWN0W2tleV0gaW5zdGFuY2VvZiBFbmRFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgZW5kQWN0RGVmID0gZmxvd0RpY3Rba2V5XSBhcyBFbmRFdmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmlyc3RBY3QpIHtcclxuICAgICAgICAgICAgY29uc3QgZW5kQWN0aUluc3RMaXN0ID0gdGhpcy5maW5kRW5kQWN0aUluc3RMaXN0KGZpcnN0QWN0LCB0aGlzLmFjdExpc3QsIHRoaXMudHJhbnNJbnNMaXN0KTtcclxuICAgICAgICAgICAgZW5kQWN0aUluc3RMaXN0LmZvckVhY2goKGVuZEFjdGlJbnN0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlbmRBY3RpSW5zdC5hY3Rpdml0eURlZmluaXRpb25JZCAhPT0gZW5kQWN0RGVmLklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3TmV4dEZsb3dDaGFydChlbmRBY3RpSW5zdC5hY3Rpdml0eURlZmluaXRpb25JZCwgbm9kZURpY3QsIGVkZ2VEaWN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZGRKdW1wRWRnZXMoZmxvd0RpY3Q6IHsgW2tleTogc3RyaW5nXTogRmxvd0VsZW1lbnQ7IH0pIHtcclxuICAgICAgICBjb25zdCBub2RlQ2VsbHMgPSAodGhpcy5nZXRDaGlsZENlbGxzKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCB0cnVlKSB8fCBbXSkgYXMgQ2VsbFtdO1xyXG4gICAgICAgIGNvbnN0IG5vSW5jb21pbmdOb2RlczogQ2VsbFtdID0gdGhpcy5maW5kTm9JbmNvbWluZ05vZGVzKG5vZGVDZWxscyk7XHJcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vSW5jb21pbmdOb2Rlcykge1xyXG4gICAgICAgICAgICBjb25zdCBhY3RJbnN0ID0gdGhpcy5hY3RMaXN0LmZpbHRlcihhID0+IGEuYWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IG5vZGUuZmxvd0VsZW1lbnQuSWQpWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBjZWxsSWQgPSBhY3RJbnN0LnByZWN1cnNvckFjdGl2aXR5RGVmaW5pdGlvbklkICsgJ18nICsgYWN0SW5zdC5hY3Rpdml0eURlZmluaXRpb25JZDtcclxuICAgICAgICAgICAgY29uc3Qgc291cmNlID0gbm9kZUNlbGxzLmZpbmQoKGl0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXQuZmxvd0VsZW1lbnQgJiYgaXQuZmxvd0VsZW1lbnQuSWQgPT09IGFjdEluc3QucHJlY3Vyc29yQWN0aXZpdHlEZWZpbml0aW9uSWQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBub2RlQ2VsbHMuZmluZCgoaXQpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdC5mbG93RWxlbWVudCAmJiBpdC5mbG93RWxlbWVudC5JZCA9PT0gYWN0SW5zdC5hY3Rpdml0eURlZmluaXRpb25JZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICAgICAgbWFwLnNldCgnanVtcCcsIHRydWUpO1xyXG4gICAgICAgICAgICBjb25zdCBzdHlsZSA9IHRoaXMuZ2V0RWRnZVN0eWxlKG51bGwsIG51bGwsIG1hcCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmluc2VydEVkZ2UodGhpcy5nZXREZWZhdWx0UGFyZW50KCksIGNlbGxJZCwgJycsIHNvdXJjZSwgdGFyZ2V0LCBzdHlsZSkgYXMgQ2VsbDtcclxuICAgICAgICAgICAgaWYgKGNlbGwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNlbGwuc291cmNlID0gc291cmNlO1xyXG4gICAgICAgICAgICAgICAgY2VsbC50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICBjZWxsLmdlb21ldHJ5LnBvaW50cyA9IFtcclxuICAgICAgICAgICAgICAgICAgICAvLyBuZXcgbXhQb2ludChzb3VyY2UuZ2VvbWV0cnkueCsgc291cmNlLmdlb21ldHJ5LndpZHRoLzIsIHRhcmdldC5nZW9tZXRyeS55K3RhcmdldC5nZW9tZXRyeS5oZWlnaHQvMilcclxuICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjZWxsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW92ZUNlbGxzKFtjZWxsXSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdGhpcy5nZXREZWZhdWx0UGFyZW50KCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55S76IqC54K5XHJcbiAgICAgKi9cclxuICAgIGRyYXdOb2RlQ2VsbHMoXHJcbiAgICAgICAgZmxvd0RpY3Q6IHsgW2tleTogc3RyaW5nXTogRmxvd0VsZW1lbnQ7IH0sXHJcbiAgICAgICAgbm9kZURpY3Q6IHsgW0JwbW5FbGVtZW50SWQ6IHN0cmluZ106IERpYWdyYW1FbGVtZW50OyB9LFxyXG4gICAgICAgIGFkZGl0aW9uYWw6IGJvb2xlYW4gPSBmYWxzZSxcclxuICAgICkge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKG5vZGVEaWN0KS5mb3JFYWNoKChicG1uTW9kZWxFbGVtZW50SWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmbG93RWx0ID0gZmxvd0RpY3RbYnBtbk1vZGVsRWxlbWVudElkXTtcclxuICAgICAgICAgICAgY29uc3QgZGlhZ0VsdCA9IG5vZGVEaWN0W2JwbW5Nb2RlbEVsZW1lbnRJZF0gYXMgQlBNTlNoYXBlO1xyXG4gICAgICAgICAgICBpZiAoZmxvd0VsdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZHJhd05vZGVDZWxsKGZsb3dFbHQsIGRpYWdFbHQsIGFkZGl0aW9uYWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55S75Y2V5Liq6IqC54K5XHJcbiAgICAgKiBAcGFyYW0gZmxvd0VsdFxyXG4gICAgICogQHBhcmFtIGRpYWdFbHRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsXHJcbiAgICAgKi9cclxuICAgIGRyYXdOb2RlQ2VsbChmbG93RWx0OiBGbG93RWxlbWVudCwgZGlhZ0VsdDogQlBNTlNoYXBlLCBhZGRpdGlvbmFsOiBib29sZWFuKSB7XHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSB0aGlzLmdldFZlcnRleFN0eWxlKGZsb3dFbHQsIGRpYWdFbHQsIGFkZGl0aW9uYWwpO1xyXG4gICAgICAgIGxldCBjZWxsOiBDZWxsID0gbnVsbDtcclxuICAgICAgICBsZXQgbGFiZWwgPSBcIlwiO1xyXG4gICAgICAgIGlmIChmbG93RWx0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgbGFiZWwgPSBmbG93RWx0Lk5hbWU7XHJcbiAgICAgICAgICAgIGlmIChmbG93RWx0Lk5hbWVMYW5ndWFnZSAmJiBmbG93RWx0Lk5hbWVMYW5ndWFnZVt0aGlzLmxhbmdDb2RlXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCA9IGZsb3dFbHQuTmFtZUxhbmd1YWdlW3RoaXMubGFuZ0NvZGVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzaW11bGF0aW9uJykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RMaXN0LmZpbmRJbmRleChhID0+IGEuYWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuSWQpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIGNlbGwgPSB0aGlzLmluc2VydFZlcnRleCh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSwgZmxvd0VsdC5JZCwgbGFiZWwsIGRpYWdFbHQuQm91bmRzLlgsIGRpYWdFbHQuQm91bmRzLlksIGRpYWdFbHQuQm91bmRzLldpZHRoLCBkaWFnRWx0LkJvdW5kcy5IZWlnaHQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFkZGl0aW9uYWwpIHtcclxuICAgICAgICAgICAgICAgIGNlbGwgPSB0aGlzLmluc2VydFZlcnRleCh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSwgZmxvd0VsdC5JZCwgbGFiZWwsIGRpYWdFbHQuQm91bmRzLlgsIGRpYWdFbHQuQm91bmRzLlksIGRpYWdFbHQuQm91bmRzLldpZHRoLCBkaWFnRWx0LkJvdW5kcy5IZWlnaHQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY2VsbCA9IHRoaXMuaW5zZXJ0VmVydGV4KHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgZGlhZ0VsdC5Cb3VuZHMuWCwgZGlhZ0VsdC5Cb3VuZHMuWSwgZGlhZ0VsdC5Cb3VuZHMuV2lkdGgsIGRpYWdFbHQuQm91bmRzLkhlaWdodCwgc3R5bGUpIGFzIENlbGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjZWxsID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjb25zdCBjZWxsID0gdGhpcy5pbnNlcnRWZXJ0ZXgodGhpcy5nZXREZWZhdWx0UGFyZW50KCksIGZsb3dFbHQuSWQsIGxhYmVsLCBkaWFnRWx0LkJvdW5kcy5YLCBkaWFnRWx0LkJvdW5kcy5ZLCBkaWFnRWx0LkJvdW5kcy5XaWR0aCwgZGlhZ0VsdC5Cb3VuZHMuSGVpZ2h0LCBzdHlsZSkgYXMgQ2VsbDtcclxuICAgICAgICBjZWxsLmZsb3dFbGVtZW50ID0gZmxvd0VsdDtcclxuICAgICAgICBjZWxsLmRpYWdyYW1FbGVtZW50ID0gZGlhZ0VsdDtcclxuICAgICAgICB0aGlzLm1vdmVDZWxscyhbY2VsbF0sIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUu+i/nue6v1xyXG4gICAgICovXHJcbiAgICBkcmF3RWRnZUNlbGxzKFxyXG4gICAgICAgIGZsb3dEaWN0OiB7IFtrZXk6IHN0cmluZ106IEZsb3dFbGVtZW50OyB9LFxyXG4gICAgICAgIGVkZ2VEaWN0OiB7IFtCcG1uRWxlbWVudElkOiBzdHJpbmddOiBEaWFncmFtRWxlbWVudDsgfSxcclxuICAgICAgICBhZGRpdGlvbmFsOiBib29sZWFuID0gZmFsc2UsXHJcbiAgICAgICAgY3V0OiBib29sZWFuID0gZmFsc2UsXHJcbiAgICApIHtcclxuICAgICAgICBPYmplY3Qua2V5cyhlZGdlRGljdCkuZm9yRWFjaCgoYnBtbk1vZGVsRWxlbWVudElkOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmxvd0VsdCA9IGZsb3dEaWN0W2JwbW5Nb2RlbEVsZW1lbnRJZF0gYXMgU2VxdWVuY2VGbG93O1xyXG4gICAgICAgICAgICBjb25zdCBkaWFnRWx0ID0gZWRnZURpY3RbYnBtbk1vZGVsRWxlbWVudElkXSBhcyBCUE1ORWRnZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChmbG93RWx0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5kcmF3RWRnZUNlbGwoZmxvd0VsdCwgZGlhZ0VsdCwgYWRkaXRpb25hbCwgY3V0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIGp1ZGdlQ29ubmVjdEJldHdlZW5Ud29Ob2RlcyhmbG93RGljdDogeyBba2V5OiBzdHJpbmddOiBGbG93RWxlbWVudDsgfSwgc291cmNlSWQ6IHN0cmluZywgdGFyZ2V0SWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IGZsb3dEaWN0W3NvdXJjZUlkXSBhcyBGbG93Tm9kZTtcclxuICAgICAgICBjb25zdCBvdXRHb2luZ3MgPSBzb3VyY2UuT3V0Z29pbmdzO1xyXG4gICAgICAgIGlmICghb3V0R29pbmdzIHx8IG91dEdvaW5ncy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IG91dEdvaW5nIG9mIG91dEdvaW5ncykge1xyXG4gICAgICAgICAgICBjb25zdCBzZXF1ZW5jZUZsb3cgPSBmbG93RGljdFtvdXRHb2luZ10gYXMgU2VxdWVuY2VGbG93O1xyXG4gICAgICAgICAgICBpZiAoc2VxdWVuY2VGbG93LlRhcmdldFJlZiA9PT0gdGFyZ2V0SWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUu+WNleadoei/nue6v1xyXG4gICAgICogQHBhcmFtIGZsb3dFbHRcclxuICAgICAqIEBwYXJhbSBkaWFnRWx0XHJcbiAgICAgKiBAcGFyYW0gYWRkaXRpb25hbFxyXG4gICAgICogQHBhcmFtIGN1dFxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgZHJhd0VkZ2VDZWxsKGZsb3dFbHQ6IFNlcXVlbmNlRmxvdywgZGlhZ0VsdDogQlBNTkVkZ2UsIGFkZGl0aW9uYWw6IGJvb2xlYW4sIGN1dDogYm9vbGVhbikge1xyXG4gICAgICAgIC8vIOiOt+WPluW3suaPkuWFpeeahOiKgueCueWFg+e0oFxyXG4gICAgICAgIGNvbnN0IG5vZGVDZWxscyA9ICh0aGlzLmdldENoaWxkQ2VsbHModGhpcy5nZXREZWZhdWx0UGFyZW50KCksIHRydWUpIHx8IFtdKSBhcyBDZWxsW107XHJcbiAgICAgICAgY29uc3Qgc291cmNlID0gbm9kZUNlbGxzLmZpbmQoKGl0KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdC5mbG93RWxlbWVudCAmJiBpdC5mbG93RWxlbWVudC5JZCA9PT0gZmxvd0VsdC5Tb3VyY2VSZWY7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gbm9kZUNlbGxzLmZpbmQoKGl0KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdC5mbG93RWxlbWVudCAmJiBpdC5mbG93RWxlbWVudC5JZCA9PT0gZmxvd0VsdC5UYXJnZXRSZWY7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgbWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIG1hcC5zZXQoJ2FkZGl0aW9uYWwnLCBhZGRpdGlvbmFsKTtcclxuICAgICAgICBtYXAuc2V0KCdjdXQnLCBjdXQpO1xyXG4gICAgICAgIGNvbnN0IHN0eWxlID0gdGhpcy5nZXRFZGdlU3R5bGUoZmxvd0VsdCwgZGlhZ0VsdCwgbWFwKTtcclxuICAgICAgICBsZXQgY2VsbDogQ2VsbCA9IG51bGw7XHJcbiAgICAgICAgbGV0IGxhYmVsID0gXCJcIjtcclxuICAgICAgICBpZiAoZmxvd0VsdCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGxhYmVsID0gZmxvd0VsdC5OYW1lO1xyXG4gICAgICAgICAgICBpZiAoZmxvd0VsdC5OYW1lTGFuZ3VhZ2UgJiYgZmxvd0VsdC5OYW1lTGFuZ3VhZ2VbdGhpcy5sYW5nQ29kZV0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgbGFiZWwgPSBmbG93RWx0Lk5hbWVMYW5ndWFnZVt0aGlzLmxhbmdDb2RlXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5tb2RlID09PSAnc2ltdWxhdGlvbicpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNJbnNMaXN0LmZpbmRJbmRleChhID0+IGEuc291cmNlQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuU291cmNlUmVmXHJcbiAgICAgICAgICAgICAgICAmJiBhLmRlc3RpbmF0aW9uQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuVGFyZ2V0UmVmKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBjZWxsID0gdGhpcy5pbnNlcnRFZGdlKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgc291cmNlLCB0YXJnZXQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFkZGl0aW9uYWwgfHwgY3V0KSB7XHJcbiAgICAgICAgICAgICAgICBjZWxsID0gdGhpcy5pbnNlcnRFZGdlKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgc291cmNlLCB0YXJnZXQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY2VsbCA9IHRoaXMuaW5zZXJ0RWRnZSh0aGlzLmdldERlZmF1bHRQYXJlbnQoKSwgZmxvd0VsdC5JZCwgbGFiZWwsIHNvdXJjZSwgdGFyZ2V0LCBzdHlsZSkgYXMgQ2VsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjZWxsID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjb25zdCBjZWxsID0gdGhpcy5pbnNlcnRFZGdlKHRoaXMuZ2V0RGVmYXVsdFBhcmVudCgpLCBmbG93RWx0LklkLCBsYWJlbCwgc291cmNlLCB0YXJnZXQsIHN0eWxlKSBhcyBDZWxsO1xyXG4gICAgICAgIC8vIGNlbGwuZ2VvbWV0cnkucmVsYXRpdmUgPSB0cnVlO1xyXG4gICAgICAgIGNlbGwuZmxvd0VsZW1lbnQgPSBmbG93RWx0O1xyXG4gICAgICAgIGNlbGwuZGlhZ3JhbUVsZW1lbnQgPSBkaWFnRWx0O1xyXG4gICAgICAgIGNlbGwuc291cmNlID0gc291cmNlO1xyXG4gICAgICAgIGNlbGwudGFyZ2V0ID0gdGFyZ2V0O1xyXG5cclxuICAgICAgICBjZWxsLmdlb21ldHJ5LnBvaW50cyA9IGNlbGwuZ2VvbWV0cnkucG9pbnRzIHx8IFtdO1xyXG5cclxuICAgICAgICAvLyDliKTmlq3mmK/lkKbkuLrml6fniYjmnKzov57nur9cclxuICAgICAgICBpZiAodGhpcy5pc09sZEJwbW5FZGdlKGRpYWdFbHQpKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAyOyBpIDwgZGlhZ0VsdC5Qb2ludHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHB0ID0gZGlhZ0VsdC5Qb2ludHNbaV07XHJcbiAgICAgICAgICAgICAgICBjZWxsLmdlb21ldHJ5LnBvaW50cy5wdXNoKG5ldyBteFBvaW50KHB0LlgsIHB0LlkpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g5q2k6KGM5Luj56CB5omn6KGM5ZCO5Y+v6I635Y+WbXhDZWxsU3RhdGVcclxuICAgICAgICAgICAgdGhpcy5tb3ZlQ2VsbHMoW2NlbGxdLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0aGlzLmdldERlZmF1bHRQYXJlbnQoKSk7XHJcblxyXG4gICAgICAgICAgICAvL+aMieWdkOagh+aPkuWFpWxhYmVsXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy52aWV3LmdldFN0YXRlKGNlbGwpO1xyXG4gICAgICAgICAgICBpZiAoZGlhZ0VsdC5CcG1uTGFiZWwgJiYgc3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkaWFnRWx0LkJwbW5MYWJlbC5Cb3VuZHMuWCA9PT0gMCAmJiBkaWFnRWx0LkJwbW5MYWJlbC5Cb3VuZHMuWSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBkaWFnRWx0LkJwbW5MYWJlbC5Cb3VuZHMuWCArIChzdGF0ZS54IC0gc3RhdGUucGFpbnRCb3VuZHMueCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB5ID0gZGlhZ0VsdC5CcG1uTGFiZWwuQm91bmRzLlkgKyAoc3RhdGUueSAtIHN0YXRlLnBhaW50Qm91bmRzLnkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGVkZ2VIYW5kbGVyOiBNeEdyYXBoTlMubXhFZGdlSGFuZGxlciA9IHRoaXMuY3JlYXRlRWRnZUhhbmRsZXIoc3RhdGUsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICBlZGdlSGFuZGxlci5tb3ZlTGFiZWwoc3RhdGUsIHgsIHkpO1xyXG4gICAgICAgICAgICAgICAgZWRnZUhhbmRsZXIuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBkaWFnRWx0LlBvaW50cy5sZW5ndGggLSAxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHB0ID0gZGlhZ0VsdC5Qb2ludHNbaV07XHJcbiAgICAgICAgICAgICAgICBjZWxsLmdlb21ldHJ5LnBvaW50cy5wdXNoKG5ldyBteFBvaW50KHB0LlgsIHB0LlkpKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g5q2k6KGM5Luj56CB5omn6KGM5ZCO5Y+v6I635Y+WbXhDZWxsU3RhdGVcclxuICAgICAgICAgICAgdGhpcy5tb3ZlQ2VsbHMoW2NlbGxdLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0aGlzLmdldERlZmF1bHRQYXJlbnQoKSk7XHJcblxyXG4gICAgICAgICAgICAvL+aMieWdkOagh+aPkuWFpWxhYmVsXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy52aWV3LmdldFN0YXRlKGNlbGwpO1xyXG4gICAgICAgICAgICBjb25zdCBzY2FsZSA9IHRoaXMudmlldy5nZXRTY2FsZSgpO1xyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGUgPSB0aGlzLnZpZXcuZ2V0VHJhbnNsYXRlKCk7XHJcbiAgICAgICAgICAgIGlmIChkaWFnRWx0LkJwbW5MYWJlbCAmJiBzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5YID09PSAwICYmIGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5ZID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgeCA9IGRpYWdFbHQuQnBtbkxhYmVsLkJvdW5kcy5YICogc2NhbGUgKyB0cmFuc2xhdGUueDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBkaWFnRWx0LkJwbW5MYWJlbC5Cb3VuZHMuWSAqIHNjYWxlICsgdHJhbnNsYXRlLnk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgZWRnZUhhbmRsZXI6IE14R3JhcGhOUy5teEVkZ2VIYW5kbGVyID0gdGhpcy5jcmVhdGVFZGdlSGFuZGxlcihzdGF0ZSwgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgICAgIGVkZ2VIYW5kbGVyLm1vdmVMYWJlbChzdGF0ZSwgeCwgeSk7XHJcbiAgICAgICAgICAgICAgICBlZGdlSGFuZGxlci5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmnoTlu7pGbG93RWxlbWVudOWtl+WFuO+8jHsgW2Zsb3dFbHRJZDogc3RyaW5nXTogRmxvd0VsZW1lbnQgfVxyXG4gICAgICovXHJcbiAgICBidWlsZEZsb3dEaWN0KGJwbW5Nb2RlbDogQnBtbk1vZGVsKSB7XHJcbiAgICAgICAgbGV0IGZsb3dEaWN0ID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEZsb3dFbGVtZW50cygpO1xyXG5cclxuICAgICAgICByZXR1cm4gZmxvd0RpY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmnoTlu7pEaWFncmFtRWxlbWVudOWtl+WFuO+8jHsgW2Zsb3dFbHRJZDogc3RyaW5nXTogRGlhZ3JhbUVsZW1lbnQgfVxyXG4gICAgICovXHJcbiAgICBidWlsZEZsb3dEaWFnRGljdChicG1uTW9kZWw6IEJwbW5Nb2RlbCkge1xyXG4gICAgICAgIGNvbnN0IG5vZGVEaWN0OiB7IFtCcG1uRWxlbWVudElkOiBzdHJpbmddOiBEaWFncmFtRWxlbWVudDsgfSA9IHt9O1xyXG4gICAgICAgIGNvbnN0IGVkZ2VEaWN0OiB7IFtCcG1uRWxlbWVudElkOiBzdHJpbmddOiBEaWFncmFtRWxlbWVudDsgfSA9IHt9O1xyXG5cclxuICAgICAgICBjb25zdCBkaWFncmFtRWx0czogKERpYWdyYW1FbGVtZW50ICYgeyBCcG1uRWxlbWVudElkOiBzdHJpbmc7IH0pW10gPSBicG1uTW9kZWwuRGVmYXVsdERpYWdyYW0uQnBtblBsYW5lLkdldERpYWdyYW1FbGVtZW50cygpIGFzIGFueTtcclxuXHJcbiAgICAgICAgZGlhZ3JhbUVsdHMgJiYgZGlhZ3JhbUVsdHMuZm9yRWFjaChlbHQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZWx0IGluc3RhbmNlb2YgTm9kZSkge1xyXG4gICAgICAgICAgICAgICAgbm9kZURpY3RbZWx0LkJwbW5FbGVtZW50SWRdID0gZWx0O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsdCBpbnN0YW5jZW9mIEVkZ2UpIHtcclxuICAgICAgICAgICAgICAgIGVkZ2VEaWN0W2VsdC5CcG1uRWxlbWVudElkXSA9IGVsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBub2RlRGljdCxcclxuICAgICAgICAgICAgZWRnZURpY3QsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yik5pat5piv5ZCm5Li65pen54mI5pysQlBNTkVkZ2VcclxuICAgICAqXHJcbiAgICAgKiDml6fniYjmnKzov57nur9Qb2ludHPmlbDnu4TkuK1bMF3lkoxbMV3liIbliKvooajnpLrotbfngrnlkoznu4jngrnvvIzlm6Dlj5blgLzplJnor6/vvIxbMF3lkoxbMV3lnZDmoIflnYfkuLooMCwwKe+8jOS7peatpOS4uuS+neaNruWIpOaWreaYr+WQpuS4uuaXp+eJiOacrOeahOi/nue6v1xyXG4gICAgICog5paw54mI5pys5LuO6LW354K55Yiw57uI54K55oyJ6aG65bqP6K6w5b2V5q+P5LiA5Liq54K55Z2Q5qCHXHJcbiAgICAgKiBAcGFyYW0gYnBtbkVkZ2VcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGlzT2xkQnBtbkVkZ2UoYnBtbkVkZ2U6IEJQTU5FZGdlKSB7XHJcbiAgICAgICAgaWYgKGJwbW5FZGdlLlBvaW50cy5sZW5ndGggPj0gMikge1xyXG4gICAgICAgICAgICBjb25zdCBwdDEgPSBicG1uRWRnZS5Qb2ludHNbMF07XHJcbiAgICAgICAgICAgIGNvbnN0IHB0MiA9IGJwbW5FZGdlLlBvaW50c1sxXTtcclxuICAgICAgICAgICAgaWYgKHB0MS5YID09IDAgJiYgcHQxLlkgPT0gMCAmJiBwdDIuWCA9PSAwICYmIHB0Mi5ZID09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluiKgueCueagt+W8j1xyXG4gICAgICogQHBhcmFtIGZsb3dFbHRcclxuICAgICAqIEBwYXJhbSBkaWFnRWx0XHJcbiAgICAgKiBAcGFyYW0gYWRkaXRpb25hbFxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgZ2V0VmVydGV4U3R5bGUoZmxvd0VsdDogRmxvd0VsZW1lbnQsIGRpYWdFbHQ6IEJQTU5TaGFwZSwgYWRkaXRpb25hbDogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IGFjdGl2aXR5SW5zdGFuY2VTbGltcyA9IHRoaXMuYWN0TGlzdDtcclxuXHJcbiAgICAgICAgbGV0IHN0YXRlU2hhcGVTdHlsZTogU3RhdGVTaGFwZVN0eWxlID0gbnVsbDtcclxuICAgICAgICAvLyDnibnmrorlpITnkIYs5Lia5Yqh5rS75Yqo6KaB5Y2V54us6LWL5oiQ5Lq65bel5pON5L2c57G75Z6L55qE5qC35byPXHJcbiAgICAgICAgLy8gaWYgKGZsb3dFbHQuQ2xyVHlwZUlEID09PSBVc2VyQWN0aXZpdHkuQ2xyX1R5cGVfSUQpIHtcclxuICAgICAgICAvLyAgIHN0YXRlU2hhcGVTdHlsZSA9IHRoaXMuY2VsbFN0eWxlQ29uZmlnLnNoYXBlU3R5bGVEaWMgJiYgdGhpcy5jZWxsU3R5bGVDb25maWcuc2hhcGVTdHlsZURpY1tmbG93RWx0LkNsclR5cGVJRF07XHJcbiAgICAgICAgLy8gfSBlbHNlIGlmIChmbG93RWx0LkNsclR5cGVJRCA9PT0gT3BlcmF0aW9uQWN0aXZpdHkuQ2xyX1R5cGVfSUQpIHtcclxuICAgICAgICAvLyAgIHN0YXRlU2hhcGVTdHlsZSA9IHRoaXMuY2VsbFN0eWxlQ29uZmlnLnNoYXBlU3R5bGVEaWMgJiYgdGhpcy5jZWxsU3R5bGVDb25maWcuc2hhcGVTdHlsZURpY1tPcGVyYXRpb25BY3Rpdml0eS5DbHJfVHlwZV9JRF07XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIGlmIChmbG93RWx0IGluc3RhbmNlb2YgVXNlckFjdGl2aXR5ICYmIGZsb3dFbHQuQml6QWN0aXZpdHlJRCAhPT0gJycpIHtcclxuICAgICAgICAgICAgc3RhdGVTaGFwZVN0eWxlID0gdGhpcy5jZWxsU3R5bGVDb25maWcuc2hhcGVTdHlsZURpYyAmJiB0aGlzLmNlbGxTdHlsZUNvbmZpZy5zaGFwZVN0eWxlRGljW09wZXJhdGlvbkFjdGl2aXR5LkNscl9UeXBlX0lEXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdGF0ZVNoYXBlU3R5bGUgPSB0aGlzLmNlbGxTdHlsZUNvbmZpZy5zaGFwZVN0eWxlRGljICYmIHRoaXMuY2VsbFN0eWxlQ29uZmlnLnNoYXBlU3R5bGVEaWNbZmxvd0VsdC5DbHJUeXBlSURdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc3RhdGVTaGFwZVN0eWxlID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVydGV4U3R5bGVPbGQoZmxvd0VsdCwgYWRkaXRpb25hbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpbWc6IHN0cmluZyA9IHN0YXRlU2hhcGVTdHlsZVtGbG93Tm9kZVN0YXRlLkRlZmF1bHRdICYmIHN0YXRlU2hhcGVTdHlsZVtGbG93Tm9kZVN0YXRlLkRlZmF1bHRdLmltYWdlO1xyXG4gICAgICAgIGlmICghYWRkaXRpb25hbCkge1xyXG4gICAgICAgICAgICBjb25zdCBhY3RzID0gYWN0aXZpdHlJbnN0YW5jZVNsaW1zLmZpbHRlcihpdGVtID0+IGl0ZW0uYWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuSWQpO1xyXG4gICAgICAgICAgICBpZiAoYWN0cyAmJiBhY3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGlmIChhY3RzLmZpbHRlcihhY3QgPT4gYWN0LnN0YXRlID09PSAnUlVOTklORycpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuUnVubmluZ10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuUnVubmluZ10uaW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3RzLmZpbHRlcihhY3QgPT4gYWN0LnN0YXRlID09PSAnQ09NUExFVEVEJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVNoYXBlU3R5bGVbRmxvd05vZGVTdGF0ZS5Db21wbGV0ZWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IHN0YXRlU2hhcGVTdHlsZVtGbG93Tm9kZVN0YXRlLkNvbXBsZXRlZF0uaW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3RzLmZpbHRlcihhY3QgPT4gYWN0LnN0YXRlID09PSAnVEVSTUlOQVRFRCcpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuVGVybWluYXRlZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gc3RhdGVTaGFwZVN0eWxlW0Zsb3dOb2RlU3RhdGUuVGVybWluYXRlZF0uaW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbWcgPT0gbnVsbCA/IG51bGwgOiAnaW1hZ2U9JyArIHRoaXMucm9vdFBhdGggKyBpbWc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDml6fniYhkaWFncmFtRWxlbWVudOacquWtmOWCqOagt+W8j+S/oeaBr1xyXG4gICAgICogQHBhcmFtIGZsb3dFbHRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBnZXRWZXJ0ZXhTdHlsZU9sZChmbG93RWx0OiBGbG93RWxlbWVudCwgYWRkaXRpb25hbDogYm9vbGVhbikge1xyXG4gICAgICAgIGxldCBzdHlsZTogc3RyaW5nO1xyXG4gICAgICAgIHN3aXRjaCAoZmxvd0VsdC5DbHJUeXBlSUQpIHtcclxuICAgICAgICAgICAgLy/nu5PmnZ/kuovku7ZcclxuICAgICAgICAgICAgY2FzZSBcImJwbW4uRW5kRXZlbnRcIjpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ2VuZCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgLy/mtYHnqIvlvIDlp4vmtLvliqjoioLngrlcclxuICAgICAgICAgICAgY2FzZSBTdGFydEFjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnc3RhcnQnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8vIOS4muWKoea0u+WKqOiKgueCuVxyXG4gICAgICAgICAgICBjYXNlIFVzZXJBY3Rpdml0eS5DbHJfVHlwZV9JRDpcclxuICAgICAgICAgICAgICAgIGlmICgoZmxvd0VsdCBhcyBVc2VyQWN0aXZpdHkpLkJpekFjdGl2aXR5SUQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZSA9ICdiaXpBY3Rpdml0eSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlID0gJ2FwcHJvdmFsJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAvLyDmjpLku5bnvZHlhbNcclxuICAgICAgICAgICAgY2FzZSAnYnBtbi5FeGNsdXNpdmVHYXRld2F5JzpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ0V4Y2x1c2l2ZUdhdGV3YXknO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8v5bm26KGM572R5YWzXHJcbiAgICAgICAgICAgIGNhc2UgJ2JwbW4uUGFyYWxsZWxHYXRld2F5JzpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ1BhcmFsbGVsR2F0ZXdheSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzLkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnc3ViJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEF1dG9BY3Rpdml0eS5DbHJfVHlwZV9JRDpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ2F1dG8nO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICBzdHlsZSA9ICdjYXRjaEV2ZW50JztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIE9wZXJhdGlvbkFjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnYml6QWN0aXZpdHknO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTWVzc2FnZUFjdGl2aXR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSAnbWVzc2FnZSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBOb3RpZnlBY3Rpdml0eS5DbHJfVHlwZV9JRDpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ25vdGlmeSc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBBaWZDcmVhdGlvbkJpbGxBY3Rpdml0eS5DbHJfVHlwZV9JRDpcclxuICAgICAgICAgICAgICAgIHN0eWxlID0gJ2FpZkNyZWF0aW9uQWN0aXZpdHknO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICdpbWFnZT0nICsgdGhpcy5yb290UGF0aCArICcvcGxhdGZvcm0vcnVudGltZS9jb21tb24vd2ViL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvaW1hZ2VzLycgKyBzdHlsZSArIHRoaXMuZ2V0Q2hhcnRTdGF0ZShmbG93RWx0LCBhZGRpdGlvbmFsKSArICc7JztcclxuICAgIH1cclxuXHJcbiAgICBnZXRDaGFydFN0YXRlKGZsb3dFbHQ6IEZsb3dFbGVtZW50LCBhZGRpdGlvbmFsOiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKCFhZGRpdGlvbmFsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdHMgPSB0aGlzLmFjdExpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5hY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5JZCk7XHJcbiAgICAgICAgICAgIGlmIChhY3RzICYmIGFjdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjdHMuZmlsdGVyKGFjdCA9PiBhY3Quc3RhdGUgPT09ICdSVU5OSU5HJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnX2xpZ2h0LmdpZic7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdHMuZmlsdGVyKGFjdCA9PiBhY3Quc3RhdGUgPT09ICdDT01QTEVURUQnKS5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgICAgICAgICAgfHwgYWN0cy5maWx0ZXIoYWN0ID0+IGFjdC5zdGF0ZSA9PT0gJ1RFUk1JTkFURUQnKS5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ19ncmF5LnBuZyc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnLnBuZyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcucG5nJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlui/nue6v+agt+W8j1xyXG4gICAgICogQHBhcmFtIGZsb3dFbHRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsXHJcbiAgICAgKiBAcGFyYW0gY3V0XHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBnZXRFZGdlU3R5bGUoZmxvd0VsdDogU2VxdWVuY2VGbG93LCBkaWFnRWx0OiBCUE1ORWRnZSwgcGFyYW1ldGVyczogTWFwPHN0cmluZywgYm9vbGVhbj4pIHtcclxuICAgICAgICBpZiAocGFyYW1ldGVycy5nZXQoJ2p1bXAnKSkge1xyXG4gICAgICAgICAgICBsZXQgc3R5bGUgPSAnJztcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGVFZGdlU3R5bGUgPSB0aGlzLmNlbGxTdHlsZUNvbmZpZy5lZGdlU3R5bGVEaWMgJiYgdGhpcy5jZWxsU3R5bGVDb25maWcuZWRnZVN0eWxlRGljWydicG1uLlNlcXVlbmNlRmxvdyddO1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbJ2p1bXAnXSkge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoc3RhdGVFZGdlU3R5bGVbJ2p1bXAnXSkuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGUgKz0gKGAke2tleX09JHtzdGF0ZUVkZ2VTdHlsZVsnanVtcCddW2tleV19O2ApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGVFZGdlU3R5bGUgPSB0aGlzLmNlbGxTdHlsZUNvbmZpZy5lZGdlU3R5bGVEaWMgJiYgdGhpcy5jZWxsU3R5bGVDb25maWcuZWRnZVN0eWxlRGljW2Zsb3dFbHQuQ2xyVHlwZUlEXTtcclxuICAgICAgICAgICAgaWYgKHN0YXRlRWRnZVN0eWxlID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEVkZ2VTdHlsZU9sZChmbG93RWx0LCBwYXJhbWV0ZXJzLmdldCgnYWRkaXRpb25hbCcpLCBwYXJhbWV0ZXJzLmdldCgnY3V0JykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zaXRpb25JbnN0YW5jZVNsaW1zID0gdGhpcy50cmFuc0luc0xpc3Q7XHJcbiAgICAgICAgICAgIGxldCBzdHlsZSA9ICcnO1xyXG4gICAgICAgICAgICBpZiAocGFyYW1ldGVycy5nZXQoJ2N1dCcpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQ3V0XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkN1dF0pLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSArPSAoYCR7a2V5fT0ke3N0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkN1dF1ba2V5XX07YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJzLmdldCgnYWRkaXRpb25hbCcpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQWRkXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkFkZF0pLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSArPSAoYCR7a2V5fT0ke3N0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkFkZF1ba2V5XX07YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zSW5zID0gdHJhbnNpdGlvbkluc3RhbmNlU2xpbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zb3VyY2VBY3Rpdml0eURlZmluaXRpb25JZCA9PT0gZmxvd0VsdC5Tb3VyY2VSZWYgJiYgaXRlbS5kZXN0aW5hdGlvbkFjdGl2aXR5RGVmaW5pdGlvbklkID09PSBmbG93RWx0LlRhcmdldFJlZik7XHJcbiAgICAgICAgICAgIGlmICh0cmFuc0lucyAmJiB0cmFuc0lucy5maWx0ZXIodCA9PiB0LnN0YXRlID09PSAnQ09NUExFVEVEJykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkNvbXBsZXRlZF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5Db21wbGV0ZWRdKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUgKz0gKGAke2tleX09JHtzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5Db21wbGV0ZWRdW2tleV19O2ApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5tb2RlID09PSAnc2ltdWxhdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5TaW11bGF0aW9uXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLlNpbXVsYXRpb25dKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGUgKz0gKGAke2tleX09JHtzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5TaW11bGF0aW9uXVtrZXldfTtgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkRlZmF1bHRdKSB7XHJcbiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5EZWZhdWx0XSkuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGUgKz0gKGAke2tleX09JHtzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5EZWZhdWx0XVtrZXldfTtgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzdHlsZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bov57nur/popzoibJcclxuICAgICAqIEBwYXJhbSBmbG93RWx0XHJcbiAgICAgKiBAcGFyYW0gZGlhZ0VsdFxyXG4gICAgICogQHBhcmFtIGFkZGl0aW9uYWxcclxuICAgICAqIEBwYXJhbSBjdXRcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGdldFN0cm9rZUNvbG9yKGZsb3dFbHQ6IFNlcXVlbmNlRmxvdywgZGlhZ0VsdDogQlBNTkVkZ2UsIGFkZGl0aW9uYWw6IGJvb2xlYW4sIGN1dDogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zaXRpb25JbnN0YW5jZVNsaW1zID0gdGhpcy50cmFuc0luc0xpc3Q7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0YXRlRWRnZVN0eWxlID0gdGhpcy5jZWxsU3R5bGVDb25maWcuZWRnZVN0eWxlRGljICYmIHRoaXMuY2VsbFN0eWxlQ29uZmlnLmVkZ2VTdHlsZURpY1tmbG93RWx0LkNsclR5cGVJRF07XHJcblxyXG5cclxuICAgICAgICBpZiAoY3V0KSB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5DdXRdKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQ3V0XS5zdHJva2VDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYWRkaXRpb25hbCkge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuQWRkXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkFkZF0uc3Ryb2tlQ29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdHJhbnNJbnMgPSB0cmFuc2l0aW9uSW5zdGFuY2VTbGltcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnNvdXJjZUFjdGl2aXR5RGVmaW5pdGlvbklkID09PSBmbG93RWx0LlNvdXJjZVJlZiAmJiBpdGVtLmRlc3RpbmF0aW9uQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGZsb3dFbHQuVGFyZ2V0UmVmKTtcclxuICAgICAgICBpZiAodHJhbnNJbnMgJiYgdHJhbnNJbnMuZmlsdGVyKHQgPT4gdC5zdGF0ZSA9PT0gJ0NPTVBMRVRFRCcpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgaWYgKHN0YXRlRWRnZVN0eWxlW1NlcXVlbmNlRmxvd1N0YXRlLkNvbXBsZXRlZF0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5Db21wbGV0ZWRdLnN0cm9rZUNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdzaW11bGF0aW9uJykge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuU2ltdWxhdGlvbl0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUVkZ2VTdHlsZVtTZXF1ZW5jZUZsb3dTdGF0ZS5TaW11bGF0aW9uXS5zdHJva2VDb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RhdGVFZGdlU3R5bGVbU2VxdWVuY2VGbG93U3RhdGUuRGVmYXVsdF0uc3Ryb2tlQ29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDml6fniYhkaWFncmFtRWxlbWVudOacquWtmOWCqOagt+W8j+S/oeaBr1xyXG4gICAgICogQHBhcmFtIGZsb3dFbHRcclxuICAgICAqIEBwYXJhbSBhZGRpdGlvbmFsXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBnZXRFZGdlU3R5bGVPbGQoc2VxOiBTZXF1ZW5jZUZsb3csIGFkZGl0aW9uYWw6IGJvb2xlYW4sIGN1dDogYm9vbGVhbikge1xyXG4gICAgICAgIGlmIChjdXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdzdHJva2VDb2xvcj0jRkY0MDQwJ1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYWRkaXRpb25hbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ3N0cm9rZUNvbG9yPSM1OUExRkYnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0cmFuc0lucyA9IHRoaXMudHJhbnNJbnNMaXN0LmZpbHRlcihpdGVtID0+IGl0ZW0uc291cmNlQWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IHNlcS5Tb3VyY2VSZWYgJiYgaXRlbS5kZXN0aW5hdGlvbkFjdGl2aXR5RGVmaW5pdGlvbklkID09PSBzZXEuVGFyZ2V0UmVmKTtcclxuICAgICAgICBpZiAodHJhbnNJbnMgJiYgdHJhbnNJbnMuZmlsdGVyKHQgPT4gdC5zdGF0ZSA9PT0gJ0NPTVBMRVRFRCcpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuICdzdHJva2VDb2xvcj0jNTk1OTU5O3N0cm9rZVdpZHRoPTI7JztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3NpbXVsYXRpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnc3Ryb2tlQ29sb3I9I2Y1OWMyNDtkYXNoZWQ9MTsnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnc3Ryb2tlQ29sb3I9IzU5QTFGRjsnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkcmF3TmV4dEZsb3dDaGFydChcclxuICAgICAgICBhY3RpRGVmSWQ6IHN0cmluZyxcclxuICAgICAgICBub2RlRGljdDogeyBba2V5OiBzdHJpbmddOiBEaWFncmFtRWxlbWVudDsgfSxcclxuICAgICAgICBlZGdlRGljdDogeyBbQnBtbkVsZW1lbnRJZDogc3RyaW5nXTogRGlhZ3JhbUVsZW1lbnQ7IH0sXHJcbiAgICApIHtcclxuICAgICAgICBjb25zdCB7IG5leHRGbG93Tm9kZURpY3QsIG5leHRTZXFGbG93RGljdCB9ID0gdGhpcy5maW5kRHJhd0Zsb3dFbGVtZW50c0J5QWN0RGVmSWQoYWN0aURlZklkLCB0aGlzLmJwbW5Nb2RlbCk7XHJcbiAgICAgICAgY29uc3QgYWN0RGVmID0gdGhpcy5icG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0Rmxvd0VsZW1lbnQoYWN0aURlZklkKSBhcyBGbG93Tm9kZTtcclxuICAgICAgICBjb25zdCBvdXRnb2luZ3MgPSBhY3REZWYuT3V0Z29pbmdzO1xyXG5cclxuICAgICAgICAvLyDlhYjmj5LlhaXoioLngrlcclxuICAgICAgICBPYmplY3Qua2V5cyhuZXh0Rmxvd05vZGVEaWN0KS5mb3JFYWNoKGlkID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmxvd0VsdCA9IG5leHRGbG93Tm9kZURpY3RbaWRdO1xyXG4gICAgICAgICAgICBjb25zdCBkaWFnRWx0ID0gbm9kZURpY3RbZmxvd0VsdC5JZF0gYXMgQlBNTlNoYXBlO1xyXG4gICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5nZXRDZWxsQnlGbG93RWxlbWVudElkKGZsb3dFbHQuSWQpO1xyXG4gICAgICAgICAgICBpZiAoIWNlbGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd05vZGVDZWxsKGZsb3dFbHQsIGRpYWdFbHQsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOWGjeaPkuWFpei+uVxyXG4gICAgICAgIE9iamVjdC5rZXlzKG5leHRTZXFGbG93RGljdCkuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZsb3dFbHQgPSBuZXh0U2VxRmxvd0RpY3RbaWRdO1xyXG4gICAgICAgICAgICBjb25zdCBkaWFnRWx0ID0gZWRnZURpY3RbZmxvd0VsdC5JZF0gYXMgQlBNTkVkZ2U7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmdldENlbGxCeUZsb3dFbGVtZW50SWQoZmxvd0VsdC5JZCk7XHJcbiAgICAgICAgICAgIGlmICghY2VsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG91dGdvaW5ncy5zb21lKG8gPT4gbyA9PT0gZmxvd0VsdC5JZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdFZGdlQ2VsbChmbG93RWx0LCBkaWFnRWx0LCB0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3RWRnZUNlbGwoZmxvd0VsdCwgZGlhZ0VsdCwgdHJ1ZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja5mbG93RWxlbWVudElk6I635Y+WY2VsbFxyXG4gICAgICovXHJcbiAgICBnZXRDZWxsQnlGbG93RWxlbWVudElkKGZsb3dFbHRJZDogc3RyaW5nLCBwYXJlbnQ/OiBNeEdyYXBoTlMubXhDZWxsKTogQ2VsbCB7XHJcbiAgICAgICAgcGFyZW50ID0gcGFyZW50ID8gcGFyZW50IDogdGhpcy5nZXREZWZhdWx0UGFyZW50KCk7XHJcbiAgICAgICAgY29uc3QgY2VsbHMgPSB0aGlzLmdldENoaWxkQ2VsbHMocGFyZW50KTtcclxuICAgICAgICBjb25zdCBjZWxsID0gY2VsbHMuZmluZChpdCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpdCBpbnN0YW5jZW9mIENlbGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdC5mbG93RWxlbWVudCAmJiBpdC5mbG93RWxlbWVudC5JZCA9PSBmbG93RWx0SWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSBhcyBDZWxsO1xyXG4gICAgICAgIHJldHVybiBjZWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRGaXJzdFN0YXJ0QWN0aXZpdHlJbnN0YW5jZShhY3Rpdml0aWVzOiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdKTogQWN0aXZpdHlJbnN0YW5jZVNsaW0ge1xyXG4gICAgICAgIGZvciAoY29uc3QgYWN0IG9mIGFjdGl2aXRpZXMpIHtcclxuICAgICAgICAgICAgaWYgKCFhY3QucHJlY3Vyc29yQWN0aXZpdHlEZWZpbml0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhY3Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZE5vSW5jb21pbmdOb2Rlcyhub2RlQ2VsbHM6IENlbGxbXSkge1xyXG4gICAgICAgIGNvbnN0IG5vSW5jb21pbmdOb2RlcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2RlQ2VsbHMpIHtcclxuICAgICAgICAgICAgaWYgKG5vZGUuZmxvd0VsZW1lbnQuQ2xyVHlwZUlEID09PSAnd2YuU3RhcnRBY3Rpdml0eScpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghbm9kZS5lZGdlcyB8fCBub2RlLmVkZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgbm9JbmNvbWluZ05vZGVzLnB1c2gobm9kZSk7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIW5vZGUuZWRnZXMuc29tZShlZGdlID0+IChlZGdlLnRhcmdldCBhcyBDZWxsKS5mbG93RWxlbWVudC5JZCA9PT0gbm9kZS5mbG93RWxlbWVudC5JZCkpIHtcclxuICAgICAgICAgICAgICAgIG5vSW5jb21pbmdOb2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub0luY29taW5nTm9kZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZEVuZEFjdGlJbnN0TGlzdChmaXJzdEFjdDogQWN0aXZpdHlJbnN0YW5jZVNsaW0sIGFjdGl2aXRpZXM6IEFjdGl2aXR5SW5zdGFuY2VTbGltW10sIHRyYW5zSW5zTGlzdDogVHJhbnNpdGlvbkluc3RhbmNlU2xpbVtdKTogQWN0aXZpdHlJbnN0YW5jZVNsaW1bXSB7XHJcbiAgICAgICAgY29uc3QgZW5kQWN0aUluc3RMaXN0OiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdID0gW107XHJcbiAgICAgICAgdGhpcy5nZXROZXh0VHJhbnNpdGlvbnMoZW5kQWN0aUluc3RMaXN0LCBmaXJzdEFjdC5hY3Rpdml0eUluc3RhbmNlSWQsIGFjdGl2aXRpZXMsIHRyYW5zSW5zTGlzdCk7XHJcbiAgICAgICAgcmV0dXJuIGVuZEFjdGlJbnN0TGlzdDtcclxuICAgIH1cclxuXHJcbiAgICBnZXROZXh0VHJhbnNpdGlvbnMoZW5kQWN0aUluc3RMaXN0OiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdLCBzb3VyY2VBY3RJbnN0SWQ6IHN0cmluZywgYWN0aXZpdGllczogQWN0aXZpdHlJbnN0YW5jZVNsaW1bXSwgdHJhbnNJbnNMaXN0OiBUcmFuc2l0aW9uSW5zdGFuY2VTbGltW10pIHtcclxuICAgICAgICBjb25zdCBuZXh0VHJhbnNpdGlvbnMgPSB0aGlzLmZpbmRUcmFuSW5zdHNCeVNvdXJjZUFjdEluc3RJZChzb3VyY2VBY3RJbnN0SWQsIHRyYW5zSW5zTGlzdCk7XHJcbiAgICAgICAgaWYgKG5leHRUcmFuc2l0aW9ucyAmJiBuZXh0VHJhbnNpdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgbmV4dFRyYW5zaXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodC5kZXN0aW5hdGlvbkFjdGl2aXR5RGVmaW5pdGlvbklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXROZXh0VHJhbnNpdGlvbnMoZW5kQWN0aUluc3RMaXN0LCB0LmRlc3RpbmF0aW9uQWN0aXZpdHlJbnN0YW5jZUlkLCBhY3Rpdml0aWVzLCB0cmFuc0luc0xpc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgYWN0SW5zdDogQWN0aXZpdHlJbnN0YW5jZVNsaW0gPSB0aGlzLmZpbmRBY3RJbnN0QnlBY3RJbnN0SWQoc291cmNlQWN0SW5zdElkLCBhY3Rpdml0aWVzKTtcclxuICAgICAgICAgICAgaWYgKGFjdEluc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghZW5kQWN0aUluc3RMaXN0LnNvbWUoYSA9PiBhLmFjdGl2aXR5SW5zdGFuY2VJZCA9PT0gYWN0SW5zdC5hY3Rpdml0eUluc3RhbmNlSWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5kQWN0aUluc3RMaXN0LnB1c2goYWN0SW5zdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZmluZFRyYW5JbnN0c0J5U291cmNlQWN0SW5zdElkKHNvdXJjZUFjdEluc3RJZDogc3RyaW5nLCB0cmFuc0luc0xpc3Q6IFRyYW5zaXRpb25JbnN0YW5jZVNsaW1bXSk6IFRyYW5zaXRpb25JbnN0YW5jZVNsaW1bXSB7XHJcbiAgICAgICAgcmV0dXJuIHRyYW5zSW5zTGlzdC5maWx0ZXIodCA9PiB0LnNvdXJjZUFjdGl2aXR5SW5zdGFuY2VJZCA9PT0gc291cmNlQWN0SW5zdElkKTtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kQWN0SW5zdEJ5QWN0SW5zdElkKGFjdEluc3RJZDogc3RyaW5nLCBhY3Rpdml0aWVzOiBBY3Rpdml0eUluc3RhbmNlU2xpbVtdKSB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2aXRpZXMuZmluZChhID0+IGEuYWN0aXZpdHlJbnN0YW5jZUlkID09PSBhY3RJbnN0SWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmREcmF3Rmxvd0VsZW1lbnRzQnlBY3REZWZJZChhY3RpRGVmSWQ6IHN0cmluZywgYnBtbk1vZGVsOiBCcG1uTW9kZWwpIHtcclxuICAgICAgICBjb25zdCBuZXh0Rmxvd05vZGVEaWN0OiB7IFtpZDogc3RyaW5nXTogRmxvd05vZGUgfSA9IHt9O1xyXG4gICAgICAgIGNvbnN0IG5leHRTZXFGbG93RGljdDogeyBbaWQ6IHN0cmluZ106IFNlcXVlbmNlRmxvdyB9ID0ge307XHJcbiAgICAgICAgdGhpcy5maW5kTmV4dEZsb3dFbGVtZW50c0J5Rmxvd0VsZW1lbnRJZChuZXh0Rmxvd05vZGVEaWN0LCBuZXh0U2VxRmxvd0RpY3QsIGFjdGlEZWZJZCwgYnBtbk1vZGVsKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuZXh0Rmxvd05vZGVEaWN0LFxyXG4gICAgICAgICAgICBuZXh0U2VxRmxvd0RpY3QsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kTmV4dEZsb3dFbGVtZW50c0J5Rmxvd0VsZW1lbnRJZChuZXh0Rmxvd05vZGVEaWN0OiB7IFtpZDogc3RyaW5nXTogRmxvd05vZGUgfSwgbmV4dFNlcUZsb3dEaWN0OiB7IFtpZDogc3RyaW5nXTogU2VxdWVuY2VGbG93IH0sIGZsb3dFbGVtZW50SWQ6IHN0cmluZywgYnBtbk1vZGVsOiBCcG1uTW9kZWwpIHtcclxuICAgICAgICBjb25zdCBmbG93RWx0ID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEZsb3dFbGVtZW50KGZsb3dFbGVtZW50SWQpO1xyXG4gICAgICAgIGlmIChmbG93RWx0ICYmIG5leHRGbG93Tm9kZURpY3RbZmxvd0VsZW1lbnRJZF0gPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZiAoZmxvd0VsdCBpbnN0YW5jZW9mIFNlcXVlbmNlRmxvdykge1xyXG4gICAgICAgICAgICAgICAgbmV4dFNlcUZsb3dEaWN0W2Zsb3dFbHQuSWRdID0gZmxvd0VsdDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmluZE5leHRGbG93RWxlbWVudHNCeUZsb3dFbGVtZW50SWQobmV4dEZsb3dOb2RlRGljdCwgbmV4dFNlcUZsb3dEaWN0LCBmbG93RWx0LlRhcmdldFJlZiwgYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChmbG93RWx0IGluc3RhbmNlb2YgRmxvd05vZGUpIHtcclxuICAgICAgICAgICAgICAgIG5leHRGbG93Tm9kZURpY3RbZmxvd0VsdC5JZF0gPSBmbG93RWx0O1xyXG4gICAgICAgICAgICAgICAgaWYgKChmbG93RWx0IGluc3RhbmNlb2YgRW5kRXZlbnQpID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxvd0VsdC5PdXRnb2luZ3MgJiYgZmxvd0VsdC5PdXRnb2luZ3MuZm9yRWFjaChvdXRnb2luZyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZE5leHRGbG93RWxlbWVudHNCeUZsb3dFbGVtZW50SWQobmV4dEZsb3dOb2RlRGljdCwgbmV4dFNlcUZsb3dEaWN0LCBvdXRnb2luZywgYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
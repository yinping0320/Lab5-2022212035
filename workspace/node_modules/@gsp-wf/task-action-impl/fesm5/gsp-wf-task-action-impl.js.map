{"version":3,"file":"gsp-wf-task-action-impl.js.map","sources":["ng://@gsp-wf/task-action-impl/lib/task-action-impl.service.ts","ng://@gsp-wf/task-action-impl/lib/task-action-impl/task-action-impl.component.ts","ng://@gsp-wf/task-action-impl/lib/throttleTime/throttleClickDirective.ts","ng://@gsp-wf/task-action-impl/lib/task-action-impl.module.ts"],"sourcesContent":["import { Injectable, Injector } from '@angular/core';\r\nimport { HttpService } from '@ecp-caf/caf-common';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class TaskActionImplService {\r\n\r\n  constructor(\r\n    private injector: Injector,\r\n    private http: HttpService\r\n  ) { }\r\n\r\n  /**\r\n   * è·åä»»å¡ä¸­å¿éç½®é¡¹\r\n   * @param code éç½®é¡¹çCode\r\n   */\r\n  getTaskCenterConfigByCode(code: string, ownerType?: string, ownerId?: string): Observable<any> {\r\n    let url = `/api/runtime/task/v1.0/task-center-setting/code?code=${code}`;\r\n    ownerType && (url += `&ownerType=${ownerType}`);\r\n    ownerId && (url += `&ownerId=${ownerId}`);\r\n    return this.http.get(url);\r\n  }\r\n\r\n  /**\r\n    * æ·»å å³æ³¨\r\n    * @param sourceId sourceId\r\n    */\r\n  addFocus(sourceId: string): Observable<any> {\r\n    const url = `/api/runtime/task/v1.0/focus?sourceId=${sourceId}`;\r\n    return this.http.post(url, '');\r\n  }\r\n\r\n  /**\r\n   * ç§»é¤å³æ³¨\r\n   * @param processInstanceId æµç¨å®ä¾id\r\n   */\r\n  removeFocus(processInstanceId: string): Observable<any> {\r\n    const url = `/api/runtime/task/v1.0/focus?processInstanceId=${processInstanceId}`;\r\n    return this.http.delete(url, '');\r\n  }\r\n\r\n  /**\r\n   * æ¯å¦å³æ³¨äºè¯¥ä»»å¡\r\n   * @param processInstanceId æµç¨å®ä¾id\r\n   */\r\n  ifFocused(processInstanceId: string): Observable<any> {\r\n    const url = `/api/runtime/task/v1.0/focus/?processInstanceId=${processInstanceId}`;\r\n    return this.http.get(url);\r\n  }\r\n}\r\n","import { Component, OnInit, ViewChild, ViewContainerRef, Injector, ComponentFactoryResolver, ComponentRef, ComponentFactory, Input, Output, EventEmitter, ElementRef, NgZone } from '@angular/core';\r\nimport { TaskExecuteComponent } from '@gsp-wf/wf-task-handler';\r\nimport { TaskAction, TaskEntity, ActionBaseImplComponent, SubmitResult, ActionEvent } from '@gsp-wf/task-impl-api';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { LoadingService } from '@farris/ui-loading';\r\nimport { MessagerService } from '@farris/ui-messager';\r\nimport { ActionOrigin } from '@gsp-wf/task-impl-api';\r\nimport { TaskActionImplService } from '../task-action-impl.service';\r\n\r\ndeclare var System: any;\r\n\r\n@Component({\r\n  selector: 'task-action-impl',\r\n  templateUrl: './task-action-impl.component.html',\r\n  styleUrls: ['./task-action-impl.component.scss'],\r\n})\r\nexport class TaskActionImplComponent implements OnInit {\r\n\r\n  @ViewChild('container', { read: ViewContainerRef }) container: ViewContainerRef;\r\n  @Input() actions: TaskAction[];\r\n  @Input() submitName: string;\r\n  @Input() showButtons = true; //æ¯å¦å±ç¤ºæäº¤æé®ãä»»å¡åççé¢å±ç¤ºï¼ä»»å¡åè¡¨ä¸å±ç¤º\r\n  @Input() batch = false;\r\n  @Input() task: TaskEntity;\r\n\r\n  _iframe: ElementRef<HTMLIFrameElement>;\r\n  @Input()\r\n  set iframe(iframe: ElementRef<HTMLIFrameElement>) {\r\n    this._iframe = iframe;\r\n    if (this.iframe && this.componentRef) {\r\n      this.componentRef.instance.iframe = this.iframe;\r\n    }\r\n  }\r\n\r\n  get iframe() {\r\n    return this._iframe;\r\n  }\r\n  @Input() origin: string; // æ¥æºï¼ä»åªæå¼ç\r\n\r\n  @Output() submited = new EventEmitter<SubmitResult>();\r\n  @Output() actionCode = new EventEmitter<any>();\r\n\r\n  selectAction: TaskAction;\r\n  actionCodeMap = new Map();\r\n  componentRef: ComponentRef<ActionBaseImplComponent>;\r\n\r\n  index = 0;\r\n  submitDisable: boolean = false; // æäº¤æé®æ¯å¦ç¦ç¨\r\n  ifFocused: boolean = false; // æ¯å¦å³æ³¨äºæ­¤ä»»å¡\r\n  focus: string = this.i18nService(\"focus\");//å³æ³¨æ­¤æµç¨\r\n  ifShowFocus: boolean = true; // æ¯å¦å¯ç¨æçå³æ³¨åè½\r\n  dialogHeight: number; // ä»»å¡åè¡¨ä¸å¼¹æ¡çé«åº¦\r\n  dialogWidth: number; // ä»»å¡åè¡¨ä¸å¼¹æ¡çå®½åº¦\r\n\r\n  ngZone: NgZone;\r\n\r\n  // æ³¨æï¼ä¿®æ¹æé æ¹æ³éè¦éæ°æåtask-mainåtask form\r\n  constructor(\r\n    private injector: Injector,\r\n    private cfr: ComponentFactoryResolver,\r\n    private loadingService: LoadingService,\r\n    private msgService: MessagerService,\r\n    private taskService: TaskActionImplService\r\n  ) {\r\n    this.ngZone = this.injector.get(NgZone);\r\n  }\r\n\r\n  ngOnInit() {\r\n    //è¡¨åè§¦åé¢è§£æï¼éæ°å è½½ç»ä»¶\r\n    (window as any).gspWfEventService = (window as any).gspWfEventService || {};\r\n    (window as any).gspWfEventService.simulate = (func: Function) => {\r\n      this.ngZone.run(() => {\r\n        this.actionSelect(this.actions[0], 0).subscribe(() => func && typeof func === 'function' && func());\r\n      })\r\n    };\r\n    // æ¯å¦å¯ç¨æçå³æ³¨åè½\r\n    const load = this.loadingService.show();\r\n    this.taskService.getTaskCenterConfigByCode(\"If_Show_My_Focus\", 'all', '*').subscribe(re => {\r\n      load.close();\r\n      re && re.currentValue === 'false' && (this.ifShowFocus = false);\r\n      // æ¯å¦å³æ³¨äºè¯¥ä»»å¡(ä»è¯¦ææå¼)\r\n      if (this.ifShowFocus && this.task && this.showButtons) {\r\n        const load = this.loadingService.show();\r\n        this.taskService.ifFocused(this.task.processInstanceId).subscribe(re => {\r\n          load.close();\r\n          this.ifFocused = re && re.length ? true : false;\r\n        }, () => {\r\n          load.close();\r\n        });\r\n      }\r\n    }, () => {\r\n      load.close();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * éä¸­å¨ä½æé®\r\n   * @param action \r\n   * @param index \r\n   * @returns \r\n   */\r\n  actionSelect(action: TaskAction, index?: number): Observable<any> {\r\n    let subject = new Subject();\r\n    this.selectAction = action;\r\n    if (index) {\r\n      this.index = index;\r\n    }\r\n    let cmpFactory: ComponentFactory<ActionBaseImplComponent>;\r\n    if (action.typeId === 'wf') {\r\n      cmpFactory = this.cfr.resolveComponentFactory(TaskExecuteComponent);\r\n      this.loadComponentFactory(cmpFactory);\r\n      setTimeout(() => {\r\n        subject.next({ result: true });\r\n      }, 100);\r\n    } else {\r\n      System.import(action.impl + '?v=' + new Date().getTime().toString()).then((moduleFactories: any) => {\r\n        const moduleFactory: any = Object.values(moduleFactories)[0];\r\n        const moduleRef = moduleFactory.create(this.injector);\r\n        cmpFactory = moduleRef.instance.getActionComponentFactory(action);\r\n        this.loadComponentFactory(cmpFactory);\r\n        subject.next({ result: true });\r\n      });\r\n    }\r\n    return subject.asObservable();\r\n  }\r\n\r\n  /**\r\n   * å¨æå è½½å®¡æ¹ç»ä»¶\r\n   * @param cmpFactory \r\n   */\r\n  private loadComponentFactory(cmpFactory: ComponentFactory<ActionBaseImplComponent>) {\r\n    let comment;\r\n    if (this.componentRef && this.componentRef.instance) {\r\n      comment = (this.componentRef.instance as any).comment;\r\n    }\r\n    this.container.clear();\r\n    this.componentRef = this.container.createComponent(cmpFactory, 0, this.injector);\r\n    this.componentRef.instance.origin = this.showButtons ? ActionOrigin.TaskForm : ActionOrigin.TaskCenter;\r\n    if (this.task && this.componentRef.instance.setTask) {\r\n      this.componentRef.instance.setTask(this.task);\r\n    }\r\n    if (this.componentRef.instance.setAction) {\r\n      this.componentRef.instance.setAction(this.selectAction);\r\n    }\r\n    if (this.componentRef.instance.dialogHeight) {\r\n      this.dialogHeight = this.componentRef.instance.dialogHeight;\r\n    }\r\n    if (this.componentRef.instance.dialogWidth) {\r\n      this.dialogWidth = this.componentRef.instance.dialogWidth;\r\n    }\r\n    // æå­wfçå®¡æ¹æè§\r\n    (this.componentRef.instance as any).wfCacheComment = comment;\r\n    this.container.insert(this.componentRef.hostView);\r\n  }\r\n\r\n  /**\r\n   * ç¹å»æäº¤\r\n   */\r\n  submit() {\r\n    //è¡¨ååäºä»¶\r\n    if (this.showButtons && window['taskCenterBeforeLoad']) {\r\n      this.submitDisable = true;\r\n      const context = {\r\n        task: this.task,\r\n        action: this.selectAction\r\n      }\r\n      window['taskCenterBeforeLoad'](context).then(re => {\r\n        this.submitDisable = false;\r\n        if (re && re.result == true) {\r\n          this.showConfirmDialog();\r\n        }\r\n      }, error => {\r\n        this.submitDisable = false;\r\n        console.error(error);\r\n      })\r\n    } else {\r\n      this.showConfirmDialog();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ¯å¦æäº¤åç¡®è®¤\r\n   */\r\n  private showConfirmDialog() {\r\n    this.taskService.getTaskCenterConfigByCode('Is_Confirm_Commit').subscribe((config: any) => {\r\n      if (config.currentValue === 'true') {\r\n        this.msgService.question(this.i18nService(\"confirm\") + this.selectAction.name + 'ï¼', () => {\r\n          this.executeSubmit();\r\n        });\r\n      } else {\r\n        this.executeSubmit();\r\n      }\r\n    });\r\n  }\r\n\r\n  private executeSubmit() {\r\n    this.submitDisable = true;\r\n    if (this.selectAction.preEvents && this.selectAction.preEvents.length > 0\r\n      && this.selectAction.preEvents.filter(e => !e.batch).length > 0) {\r\n      let taskComment: string;\r\n      const action = this.selectAction as TaskAction;\r\n      if (action.typeId === 'wf') {\r\n        // åæè§æ¡éçæè§å­æ¾å¨taskCommenté\r\n        taskComment = (this.componentRef.instance as any).comment;\r\n      } else {\r\n      }\r\n      this.executeEvents([...this.selectAction.preEvents.filter(e => !e.batch)], () => {\r\n        this.confirmSubmit(taskComment);\r\n      }, taskComment);\r\n    } else {\r\n      this.confirmSubmit();\r\n    }\r\n  }\r\n\r\n  private confirmSubmit(taskComment?: string) {\r\n    const load = this.loadingService.show();\r\n    this.handleSubmit().subscribe((re: any) => {\r\n      if (re) {\r\n        load.close();\r\n        if (re.result) {\r\n          if (this.selectAction && this.selectAction.postEvents.length > 0\r\n            && this.selectAction.postEvents.filter(e => !e.batch).length > 0) {\r\n            this.executeEvents([...this.selectAction.postEvents.filter(e => !e.batch)], () => {\r\n              this.submited.emit(re);\r\n              setTimeout(() => {\r\n                this.submitDisable = false;\r\n              }, 2000);\r\n            }, taskComment);\r\n          } else {\r\n            this.submited.emit(re);\r\n            setTimeout(() => {\r\n              this.submitDisable = false;\r\n            }, 2000);\r\n          }\r\n        } else {\r\n          this.submitDisable = false;\r\n        }\r\n      }\r\n      this.actionCodeMap.set('isTransfer', this.selectAction.code === 'Transfer');\r\n      this.actionCodeMap.set('isAddSignFront', this.selectAction.code === 'AddSignFront');\r\n      this.actionCodeMap.set('isUnClaim', this.selectAction.code === 'Unclaim');\r\n      this.actionCodeMap.set('isComment', this.selectAction.code === 'Comment');\r\n      this.actionCodeMap.set('isClaim', this.selectAction.code === 'Claim');\r\n      this.actionCode.emit(this.actionCodeMap);\r\n    });\r\n  }\r\n\r\n\r\n  handleSubmit(): Observable<SubmitResult> {\r\n    return this.componentRef.instance.submit();\r\n  }\r\n\r\n  batchHandleSubmit(tasks: TaskEntity[]) {\r\n    return this.componentRef.instance.batchSubmit(tasks);\r\n  }\r\n\r\n  private executeEvents(events: ActionEvent[], handler: any, taskComment?: string) {\r\n    if (events && events.length > 0) {\r\n      const event = events.shift();\r\n      const url = event.eventImpl.split('#')[0];\r\n      const func = event.eventImpl.split('#')[1];\r\n      System.import(url + '?v=' + new Date().getTime().toString())\r\n        .then((moduleFactories: any) => {\r\n          const moduleFactory: any = Object.values(moduleFactories)[0];\r\n          const moduleRef = moduleFactory.create(this.injector);\r\n          const context: any = {\r\n            task: this.task,\r\n            action: this.selectAction,\r\n            origin: 'TaskForm',\r\n            formIframe: this.iframe,\r\n            comment: taskComment,\r\n          };\r\n          moduleRef.instance[func].apply(moduleRef.instance, [context]).subscribe((re: any) => {\r\n            // å¼å®¹æ§çå¸å°ç±»ååæ°\r\n            if (typeof re === 'boolean') {\r\n              if (re) {\r\n                this.executeEvents(events, handler, taskComment);\r\n              } else {\r\n                this.submitDisable = false;\r\n              }\r\n            } else {\r\n              if (re.result) {\r\n                if (re.comment) {\r\n                  taskComment = re.comment;\r\n                  // åå°çåäºä»¶æè§åå«å¨taskCommenté\r\n                }\r\n                this.executeEvents(events, handler, taskComment);\r\n              } else {\r\n                this.submitDisable = false;\r\n              }\r\n            }\r\n          });\r\n        });\r\n    } else {\r\n      (this.componentRef.instance as any).comment = taskComment;\r\n      handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç¹å»æ·»å /åæ¶å³æ³¨\r\n   */\r\n  focusTask() {\r\n    const load = this.loadingService.show();\r\n    if (this.ifFocused) {\r\n      this.taskService.addFocus(this.task.sourceId).subscribe(() => {\r\n        load.close();\r\n      }, () => {\r\n        load.close();\r\n      });\r\n    } else {\r\n      this.taskService.removeFocus(this.task.processInstanceId).subscribe(() => {\r\n        load.close();\r\n      }, () => {\r\n        load.close();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å½éå\r\n   * @param code \r\n   * @returns \r\n   */\r\n  i18nService(code: string) {\r\n    var result;\r\n    const supportLanguage = [\"zh-CHS\", \"zh-CHT\", \"en\"];\r\n    const curLanguage = localStorage.getItem(\"languageCode\");\r\n    const translate = {\r\n      \"zh-CHS\": {\r\n        focus: \"å³æ³¨æ­¤æµç¨\",\r\n        focused: \"å·²å³æ³¨æ­¤æµç¨\",\r\n        confirm: \"ç¡®è®¤\"\r\n      },\r\n      \"zh-CHT\": {\r\n        focus: \"éè¨»æ­¤æµç¨\",\r\n        focused: \"å·²éè¨»æ­¤æµç¨\",\r\n        confirm: \"ç¢ºèª\"\r\n      },\r\n      en: {\r\n        focus: \"Focus this process\",\r\n        focused: \"Focused this process\",\r\n        confirm: \"Confirm\"\r\n      },\r\n    };\r\n    if (curLanguage && supportLanguage.includes(curLanguage)) {\r\n      result = translate[curLanguage][code];\r\n    } else {\r\n      result = translate[\"zh-CHS\"][code];\r\n    }\r\n    return result;\r\n  }\r\n\r\n\r\n\r\n}\r\n","import { Directive, EventEmitter, HostListener, OnInit, Output, OnDestroy } from '@angular/core';\r\nimport { Subject, Subscription } from 'rxjs';\r\nimport { throttleTime } from 'rxjs/operators';\r\n/**\r\n * ç¹å»èæµå¨ï¼é¿åè¿ç»­ç¹å»\r\n */\r\n@Directive({\r\n  selector: '[directive-throttle]'\r\n})\r\nexport class ThrottleClickDirective implements OnInit, OnDestroy {\r\n  // ä¸å®çæ¶é´ååªæ§è¡ç¬¬ä¸ä¸ªäºä»¶\r\n  private THROTTLE_TIME: number = 2000;\r\n  private subject = new Subject<MouseEvent>();\r\n  private click: Subscription;\r\n  // äºä»¶æ¹æ³\r\n  @Output() throttleClick = new EventEmitter();\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n    const result = this.subject.pipe(\r\n      throttleTime(this.THROTTLE_TIME)\r\n    );\r\n    this.click = result.subscribe(e => {\r\n      this.throttleClick.emit(e)\r\n    })\r\n\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.click.unsubscribe();\r\n  }\r\n\r\n  @HostListener('click', ['$event'])\r\n  onClick(evt: MouseEvent) {\r\n    this.subject.next(evt);\r\n  }\r\n}","import { NgModule } from '@angular/core';\r\nimport { TaskActionImplComponent } from './task-action-impl/task-action-impl.component';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { WfTaskHandlerModule } from '@gsp-wf/wf-task-handler';\r\nimport { LoadingModule } from '@farris/ui-loading'\r\nimport { ThrottleClickDirective } from './throttleTime/throttleClickDirective';\r\nimport { MessagerModule } from '@farris/ui-messager'\r\nimport { TaskActionImplService } from './task-action-impl.service';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    TaskActionImplComponent,\r\n    ThrottleClickDirective\r\n  ],\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    WfTaskHandlerModule,\r\n    LoadingModule,\r\n    MessagerModule.forRoot()\r\n  ],\r\n  exports: [TaskActionImplComponent],\r\n  providers: [\r\n    TaskActionImplService,\r\n  ]\r\n})\r\nexport class TaskActionImplModule { }\r\n"],"names":[],"mappings":"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"}

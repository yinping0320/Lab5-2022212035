/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BpmnModel, BpmnModelHelper, ExtensionMethod, UserTask } from "@edp-pmf/bpmn-model";
import { ExtendProperty } from "./ExtendProperty";
import { ExecuteForm } from "./extension/ExecuteForm";
import { HumanPerformerImpl } from "./HumanPerformerImpl";
import { MessageNotice } from "./MessageNotice";
import { OrganizationPotentialOwner } from "./OrganizationPotentialOwner";
import { ActivityExecutorParticipant } from "./participants/old/ActivityExecutorParticipant";
import { ComponentParticipant } from "./participants/old/ComponentParticipant";
import { MatrixParticipant } from "./participants/old/MatrixParticipant";
import { Participant } from "./participants/old/Participant";
import { PositionParticipant } from "./participants/old/PositionParticipant";
import { ReportingLineParticipant } from "./participants/old/ReportingLineParticipant";
import { UserParticipant } from "./participants/old/UserParticipant";
import { OrganizationParticipantExpression } from "./participants/OrganizationParticipantExpression";
import { ParticipantExpression } from "./participants/ParticipantExpression";
import { PotentialOwnerImpl } from "./PotentialOwnerImpl";
export class NotifyActivity extends UserTask {
    /**
     * @param {?} model
     */
    constructor(model) {
        super(model);
        this.ClrTypeID = NotifyActivity.Clr_Type_ID;
        this.dynamicParticipants = new Array();
    }
    /**
     * 模型校验
     * @param {?} errors 模型校验错误信息
     * @return {?}
     */
    Validate(errors) {
        // TODO: 需要添加自定义校验信息
        super.Validate(errors);
    }
    /**
     * @return {?}
     */
    clone() {
        /** @type {?} */
        let notifyActivity = new NotifyActivity(this.Model);
        notifyActivity.Name = this.Name;
        /** @type {?} */
        const resourceRoles = this.GetResourceRoles();
        if (resourceRoles && resourceRoles.length > 0) {
            for (const role of resourceRoles) {
                if (role instanceof UserParticipant) {
                    /** @type {?} */
                    const user = (/** @type {?} */ (role));
                    /** @type {?} */
                    const userParticipant = user.clone();
                    notifyActivity.AddResourceRole(userParticipant);
                }
                else if (role instanceof PositionParticipant) {
                    /** @type {?} */
                    const position = (/** @type {?} */ (role));
                    /** @type {?} */
                    const positionParticipant = position.clone();
                    notifyActivity.AddResourceRole(positionParticipant);
                }
                else if (role instanceof ReportingLineParticipant) {
                    /** @type {?} */
                    const reportingLine = (/** @type {?} */ (role));
                    /** @type {?} */
                    const reportingLineParticipant = reportingLine.clone();
                    notifyActivity.AddResourceRole(reportingLineParticipant);
                }
                else if (role instanceof ActivityExecutorParticipant) {
                    /** @type {?} */
                    const activityExecutor = (/** @type {?} */ (role));
                    /** @type {?} */
                    const activityExecutorParticipant = activityExecutor.clone();
                    notifyActivity.AddResourceRole(activityExecutorParticipant);
                }
                else if (role instanceof ComponentParticipant) {
                    /** @type {?} */
                    const component = (/** @type {?} */ (role));
                    /** @type {?} */
                    const componentParticipant = component.clone();
                    notifyActivity.AddResourceRole(componentParticipant);
                }
                else if (role instanceof MatrixParticipant) {
                    /** @type {?} */
                    const matrix = (/** @type {?} */ (role));
                    /** @type {?} */
                    const matrixParticipant = matrix.clone();
                    notifyActivity.AddResourceRole(matrixParticipant);
                }
                else if (role instanceof OrganizationPotentialOwner) {
                    /** @type {?} */
                    const org = (/** @type {?} */ (role));
                    /** @type {?} */
                    const organizationPotentialOwner = org.clone();
                    notifyActivity.AddResourceRole(organizationPotentialOwner);
                }
                else if (role instanceof HumanPerformerImpl) {
                    /** @type {?} */
                    const performer = (/** @type {?} */ (role));
                    /** @type {?} */
                    const humanPerformerImpl = performer.clone();
                    notifyActivity.AddResourceRole(humanPerformerImpl);
                }
                else if (role instanceof PotentialOwnerImpl) {
                    /** @type {?} */
                    const owner = (/** @type {?} */ (role));
                    /** @type {?} */
                    const potentialOwnerImpl = owner.clone();
                    notifyActivity.AddResourceRole(potentialOwnerImpl);
                }
            }
        }
        notifyActivity.executeForms = new Array();
        if (this.executeForms && this.executeForms.length > 0) {
            for (const f of this.executeForms) {
                /** @type {?} */
                const executeForm = f.clone();
                notifyActivity.executeForms.push(executeForm);
            }
        }
        notifyActivity.extendProperties = new Array();
        if (this.extendProperties && this.extendProperties.length > 0) {
            for (const e of this.extendProperties) {
                /** @type {?} */
                const extendProperty = e.clone();
                notifyActivity.extendProperties.push(extendProperty);
            }
        }
        notifyActivity.messageNotices = new Array();
        if (this.messageNotices && this.messageNotices.length > 0) {
            for (const m of this.messageNotices) {
                /** @type {?} */
                const messageNotice = m.clone();
                notifyActivity.messageNotices.push(messageNotice);
            }
        }
        notifyActivity.notifyAble = this.notifyAble;
        notifyActivity.dynamicParticipants = new Array();
        if (this.dynamicParticipants && this.dynamicParticipants.length > 0) {
            for (const p of this.dynamicParticipants) {
                if (p instanceof OrganizationParticipantExpression) {
                    /** @type {?} */
                    const o = (/** @type {?} */ (p));
                    /** @type {?} */
                    const organizationParticipantExpression = o.clone();
                    notifyActivity.dynamicParticipants.push(organizationParticipantExpression);
                }
            }
        }
        return notifyActivity;
    }
    /**
     * @return {?}
     */
    NewInstance() {
        return new NotifyActivity(this.Model);
    }
    /**
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.participants = new Array();
        this.messageNotices = new Array();
        this.executeForms = new Array();
        this.extendProperties = new Array();
        this.notifyAble = false;
        this.dynamicParticipants = new Array();
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        // this.beforeSerialize();
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelHelper.SetAttributeValue(obj, "NotifyAble", this.notifyAble);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.notifyAble = ExtensionMethod.GetAttributeValue4Boolean(obj, "NotifyAble");
        ;
        // this.afterDeserialize();
    }
    /**
     * @protected
     * @return {?}
     */
    GetExtensionElements4ConvertTo() {
        /** @type {?} */
        let list = super.GetExtensionElements4ConvertTo();
        if (this.messageNotices != null) {
            for (let item of this.messageNotices) {
                item.MexTag = NotifyActivity.MEXTAG;
                list.push(item);
            }
        }
        if (this.executeForms != null) {
            for (let form of this.executeForms) {
                form.MexTag = NotifyActivity.MEXTAG;
                list.push(form);
            }
        }
        if (this.extendProperties != null) {
            for (let extendProperty of this.extendProperties) {
                extendProperty.MexTag = NotifyActivity.MEXTAG;
                list.push(extendProperty);
            }
        }
        if (this.dynamicParticipants != null) {
            for (let participant of this.dynamicParticipants) {
                participant.MexTag = NotifyActivity.MEXTAG;
                list.push(participant);
            }
        }
        return list;
    }
    /**
     * @protected
     * @param {?} extensionElements
     * @return {?}
     */
    SetExtensionElements4LoadFrom(extensionElements) {
        super.SetExtensionElements4LoadFrom(extensionElements);
        for (let extensionElement of extensionElements) {
            if (NotifyActivity.MEXTAG != extensionElement.MexTag) {
                continue;
            }
            switch (extensionElement.ClrTypeID) {
                case MessageNotice.Clr_Type_ID:
                    this.messageNotices.push((/** @type {?} */ (extensionElement)));
                    break;
                case ExecuteForm.Clr_Type_ID:
                    this.executeForms.push((/** @type {?} */ (extensionElement)));
                    break;
                case ExtendProperty.Clr_Type_ID:
                    this.extendProperties.push((/** @type {?} */ (extensionElement)));
                    break;
                default:
                    if (extensionElement instanceof ParticipantExpression) {
                        this.dynamicParticipants.push((/** @type {?} */ (extensionElement)));
                    }
                    break;
            }
        }
    }
    /**
     * @protected
     * @return {?}
     */
    beforeSerialize() {
        /** @type {?} */
        let roles = this.GetResourceRoles();
        if (roles != null && roles.length != 0) {
            for (let role of roles) {
                super.RemoveResourceRole(role.Id);
            }
        }
        if (this.participants != null && this.participants.length != 0) {
            for (let participant of this.participants) {
                this.AddResourceRole(participant);
            }
        }
    }
    /**
     * @protected
     * @return {?}
     */
    afterDeserialize() {
        /** @type {?} */
        let roles = this.GetResourceRoles();
        if (roles == null || roles.length == 0) {
            return;
        }
        for (let role of roles) {
            if (role instanceof Participant) {
                this.participants.push(role);
            }
        }
    }
}
NotifyActivity.Clr_Type_ID = "wf.NotifyActivity";
NotifyActivity.MEXTAG = "wf.NotifyActivity";
if (false) {
    /** @type {?} */
    NotifyActivity.Clr_Type_ID;
    /**
     * @type {?}
     * @protected
     */
    NotifyActivity.MEXTAG;
    /** @type {?} */
    NotifyActivity.prototype.ClrTypeID;
    /** @type {?} */
    NotifyActivity.prototype.participants;
    /** @type {?} */
    NotifyActivity.prototype.messageNotices;
    /** @type {?} */
    NotifyActivity.prototype.executeForms;
    /** @type {?} */
    NotifyActivity.prototype.extendProperties;
    /** @type {?} */
    NotifyActivity.prototype.dynamicParticipants;
    /** @type {?} */
    NotifyActivity.prototype.notifyAble;
}
BpmnModelHelper.RegisterElementType(new NotifyActivity(new BpmnModel()));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm90aWZ5QWN0aXZpdHkuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtbW9kZWwvIiwic291cmNlcyI6WyJsaWIvbW9kZWwvTm90aWZ5QWN0aXZpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFvQixlQUFlLEVBQW1CLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQy9ILE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzFFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQzdGLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM3RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUM3RSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQUN2RixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDckUsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDckcsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDN0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFMUQs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QixDQUFDLElBQUksY0FBYyxDQUFDLElBQUksU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnBtbk1vZGVsLCBCcG1uTW9kZWxIZWxwZXIsIEV4dGVuc2lvbkVsZW1lbnQsIEV4dGVuc2lvbk1ldGhvZCwgVmFsaWRhdGlvbkVycm9yLCBVc2VyVGFzayB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IEV4dGVuZFByb3BlcnR5IH0gZnJvbSBcIi4vRXh0ZW5kUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgRXhlY3V0ZUZvcm0gfSBmcm9tIFwiLi9leHRlbnNpb24vRXhlY3V0ZUZvcm1cIjtcclxuaW1wb3J0IHsgSHVtYW5QZXJmb3JtZXJJbXBsIH0gZnJvbSBcIi4vSHVtYW5QZXJmb3JtZXJJbXBsXCI7XHJcbmltcG9ydCB7IE1lc3NhZ2VOb3RpY2UgfSBmcm9tIFwiLi9NZXNzYWdlTm90aWNlXCI7XHJcbmltcG9ydCB7IE9yZ2FuaXphdGlvblBvdGVudGlhbE93bmVyIH0gZnJvbSBcIi4vT3JnYW5pemF0aW9uUG90ZW50aWFsT3duZXJcIjtcclxuaW1wb3J0IHsgQWN0aXZpdHlFeGVjdXRvclBhcnRpY2lwYW50IH0gZnJvbSBcIi4vcGFydGljaXBhbnRzL29sZC9BY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnRcIjtcclxuaW1wb3J0IHsgQ29tcG9uZW50UGFydGljaXBhbnQgfSBmcm9tIFwiLi9wYXJ0aWNpcGFudHMvb2xkL0NvbXBvbmVudFBhcnRpY2lwYW50XCI7XHJcbmltcG9ydCB7IE1hdHJpeFBhcnRpY2lwYW50IH0gZnJvbSBcIi4vcGFydGljaXBhbnRzL29sZC9NYXRyaXhQYXJ0aWNpcGFudFwiO1xyXG5pbXBvcnQgeyBQYXJ0aWNpcGFudCB9IGZyb20gXCIuL3BhcnRpY2lwYW50cy9vbGQvUGFydGljaXBhbnRcIjtcclxuaW1wb3J0IHsgUG9zaXRpb25QYXJ0aWNpcGFudCB9IGZyb20gXCIuL3BhcnRpY2lwYW50cy9vbGQvUG9zaXRpb25QYXJ0aWNpcGFudFwiO1xyXG5pbXBvcnQgeyBSZXBvcnRpbmdMaW5lUGFydGljaXBhbnQgfSBmcm9tIFwiLi9wYXJ0aWNpcGFudHMvb2xkL1JlcG9ydGluZ0xpbmVQYXJ0aWNpcGFudFwiO1xyXG5pbXBvcnQgeyBVc2VyUGFydGljaXBhbnQgfSBmcm9tIFwiLi9wYXJ0aWNpcGFudHMvb2xkL1VzZXJQYXJ0aWNpcGFudFwiO1xyXG5pbXBvcnQgeyBPcmdhbml6YXRpb25QYXJ0aWNpcGFudEV4cHJlc3Npb24gfSBmcm9tIFwiLi9wYXJ0aWNpcGFudHMvT3JnYW5pemF0aW9uUGFydGljaXBhbnRFeHByZXNzaW9uXCI7XHJcbmltcG9ydCB7IFBhcnRpY2lwYW50RXhwcmVzc2lvbiB9IGZyb20gXCIuL3BhcnRpY2lwYW50cy9QYXJ0aWNpcGFudEV4cHJlc3Npb25cIjtcclxuaW1wb3J0IHsgUG90ZW50aWFsT3duZXJJbXBsIH0gZnJvbSBcIi4vUG90ZW50aWFsT3duZXJJbXBsXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTm90aWZ5QWN0aXZpdHkgZXh0ZW5kcyBVc2VyVGFzayB7XHJcbiAgICBzdGF0aWMgQ2xyX1R5cGVfSUQ6IHN0cmluZyA9IFwid2YuTm90aWZ5QWN0aXZpdHlcIjtcclxuICAgIENsclR5cGVJRDogc3RyaW5nID0gTm90aWZ5QWN0aXZpdHkuQ2xyX1R5cGVfSUQ7XHJcbiAgICBwcm90ZWN0ZWQgc3RhdGljIE1FWFRBRzogc3RyaW5nID0gXCJ3Zi5Ob3RpZnlBY3Rpdml0eVwiO1xyXG5cclxuICAgIHBhcnRpY2lwYW50czogQXJyYXk8UGFydGljaXBhbnQ+O1xyXG4gICAgbWVzc2FnZU5vdGljZXM6IEFycmF5PE1lc3NhZ2VOb3RpY2U+O1xyXG4gICAgZXhlY3V0ZUZvcm1zOiBBcnJheTxFeGVjdXRlRm9ybT47XHJcbiAgICBleHRlbmRQcm9wZXJ0aWVzOiBBcnJheTxFeHRlbmRQcm9wZXJ0eT47XHJcbiAgICBkeW5hbWljUGFydGljaXBhbnRzOiBBcnJheTxQYXJ0aWNpcGFudEV4cHJlc3Npb24+ID0gbmV3IEFycmF5KCk7XHJcbiAgICBub3RpZnlBYmxlOiBib29sZWFuO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZGVsOiBCcG1uTW9kZWwpIHtcclxuICAgICAgICBzdXBlcihtb2RlbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnovmoKHpqoxcclxuICAgICAqIEBwYXJhbSBlcnJvcnMg5qih5Z6L5qCh6aqM6ZSZ6K+v5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIFZhbGlkYXRlKGVycm9yczogVmFsaWRhdGlvbkVycm9yW10pOiB2b2lkIHtcclxuICAgICAgICAvLyBUT0RPOiDpnIDopoHmt7vliqDoh6rlrprkuYnmoKHpqozkv6Hmga9cclxuICAgICAgICBzdXBlci5WYWxpZGF0ZShlcnJvcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb25lKCk6IE5vdGlmeUFjdGl2aXR5IHtcclxuICAgICAgICBsZXQgbm90aWZ5QWN0aXZpdHkgPSBuZXcgTm90aWZ5QWN0aXZpdHkodGhpcy5Nb2RlbCk7XHJcbiAgICAgICAgbm90aWZ5QWN0aXZpdHkuTmFtZSA9IHRoaXMuTmFtZTtcclxuICAgICAgICBjb25zdCByZXNvdXJjZVJvbGVzID0gdGhpcy5HZXRSZXNvdXJjZVJvbGVzKCk7XHJcbiAgICAgICAgaWYgKHJlc291cmNlUm9sZXMgJiYgcmVzb3VyY2VSb2xlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiByZXNvdXJjZVJvbGVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocm9sZSBpbnN0YW5jZW9mIFVzZXJQYXJ0aWNpcGFudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSByb2xlIGFzIFVzZXJQYXJ0aWNpcGFudDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyUGFydGljaXBhbnQgPSB1c2VyLmNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZ5QWN0aXZpdHkuQWRkUmVzb3VyY2VSb2xlKHVzZXJQYXJ0aWNpcGFudCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGUgaW5zdGFuY2VvZiBQb3NpdGlvblBhcnRpY2lwYW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSByb2xlIGFzIFBvc2l0aW9uUGFydGljaXBhbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb25QYXJ0aWNpcGFudCA9IHBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZ5QWN0aXZpdHkuQWRkUmVzb3VyY2VSb2xlKHBvc2l0aW9uUGFydGljaXBhbnQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlIGluc3RhbmNlb2YgUmVwb3J0aW5nTGluZVBhcnRpY2lwYW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVwb3J0aW5nTGluZSA9IHJvbGUgYXMgUmVwb3J0aW5nTGluZVBhcnRpY2lwYW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcG9ydGluZ0xpbmVQYXJ0aWNpcGFudCA9IHJlcG9ydGluZ0xpbmUuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZnlBY3Rpdml0eS5BZGRSZXNvdXJjZVJvbGUocmVwb3J0aW5nTGluZVBhcnRpY2lwYW50KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm9sZSBpbnN0YW5jZW9mIEFjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5RXhlY3V0b3IgPSByb2xlIGFzIEFjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnQgPSBhY3Rpdml0eUV4ZWN1dG9yLmNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZ5QWN0aXZpdHkuQWRkUmVzb3VyY2VSb2xlKGFjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGUgaW5zdGFuY2VvZiBDb21wb25lbnRQYXJ0aWNpcGFudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHJvbGUgYXMgQ29tcG9uZW50UGFydGljaXBhbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcG9uZW50UGFydGljaXBhbnQgPSBjb21wb25lbnQuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZnlBY3Rpdml0eS5BZGRSZXNvdXJjZVJvbGUoY29tcG9uZW50UGFydGljaXBhbnQpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb2xlIGluc3RhbmNlb2YgTWF0cml4UGFydGljaXBhbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRyaXggPSByb2xlIGFzIE1hdHJpeFBhcnRpY2lwYW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdHJpeFBhcnRpY2lwYW50ID0gbWF0cml4LmNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZ5QWN0aXZpdHkuQWRkUmVzb3VyY2VSb2xlKG1hdHJpeFBhcnRpY2lwYW50KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm9sZSBpbnN0YW5jZW9mIE9yZ2FuaXphdGlvblBvdGVudGlhbE93bmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JnID0gcm9sZSBhcyBPcmdhbml6YXRpb25Qb3RlbnRpYWxPd25lcjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25Qb3RlbnRpYWxPd25lciA9IG9yZy5jbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmeUFjdGl2aXR5LkFkZFJlc291cmNlUm9sZShvcmdhbml6YXRpb25Qb3RlbnRpYWxPd25lcik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJvbGUgaW5zdGFuY2VvZiBIdW1hblBlcmZvcm1lckltcGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJmb3JtZXIgPSByb2xlIGFzIEh1bWFuUGVyZm9ybWVySW1wbDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBodW1hblBlcmZvcm1lckltcGwgPSBwZXJmb3JtZXIuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZnlBY3Rpdml0eS5BZGRSZXNvdXJjZVJvbGUoaHVtYW5QZXJmb3JtZXJJbXBsKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm9sZSBpbnN0YW5jZW9mIFBvdGVudGlhbE93bmVySW1wbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG93bmVyID0gcm9sZSBhcyBQb3RlbnRpYWxPd25lckltcGw7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG90ZW50aWFsT3duZXJJbXBsID0gb3duZXIuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZnlBY3Rpdml0eS5BZGRSZXNvdXJjZVJvbGUocG90ZW50aWFsT3duZXJJbXBsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBub3RpZnlBY3Rpdml0eS5leGVjdXRlRm9ybXMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICBpZiAodGhpcy5leGVjdXRlRm9ybXMgJiYgdGhpcy5leGVjdXRlRm9ybXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGYgb2YgdGhpcy5leGVjdXRlRm9ybXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGVGb3JtID0gZi5jbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgbm90aWZ5QWN0aXZpdHkuZXhlY3V0ZUZvcm1zLnB1c2goZXhlY3V0ZUZvcm0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5vdGlmeUFjdGl2aXR5LmV4dGVuZFByb3BlcnRpZXMgPSBuZXcgQXJyYXk8RXh0ZW5kUHJvcGVydHk+KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZXh0ZW5kUHJvcGVydGllcyAmJiB0aGlzLmV4dGVuZFByb3BlcnRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5leHRlbmRQcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleHRlbmRQcm9wZXJ0eSA9IGUuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIG5vdGlmeUFjdGl2aXR5LmV4dGVuZFByb3BlcnRpZXMucHVzaChleHRlbmRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbm90aWZ5QWN0aXZpdHkubWVzc2FnZU5vdGljZXMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICBpZiAodGhpcy5tZXNzYWdlTm90aWNlcyAmJiB0aGlzLm1lc3NhZ2VOb3RpY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBtIG9mIHRoaXMubWVzc2FnZU5vdGljZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VOb3RpY2UgPSBtLmNsb25lKCk7XHJcbiAgICAgICAgICAgICAgICBub3RpZnlBY3Rpdml0eS5tZXNzYWdlTm90aWNlcy5wdXNoKG1lc3NhZ2VOb3RpY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5vdGlmeUFjdGl2aXR5Lm5vdGlmeUFibGUgPSB0aGlzLm5vdGlmeUFibGU7XHJcbiAgICAgICAgbm90aWZ5QWN0aXZpdHkuZHluYW1pY1BhcnRpY2lwYW50cyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIGlmICh0aGlzLmR5bmFtaWNQYXJ0aWNpcGFudHMgJiYgdGhpcy5keW5hbWljUGFydGljaXBhbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMuZHluYW1pY1BhcnRpY2lwYW50cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHAgaW5zdGFuY2VvZiBPcmdhbml6YXRpb25QYXJ0aWNpcGFudEV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvID0gcCBhcyBPcmdhbml6YXRpb25QYXJ0aWNpcGFudEV4cHJlc3Npb247XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uUGFydGljaXBhbnRFeHByZXNzaW9uID0gby5jbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmeUFjdGl2aXR5LmR5bmFtaWNQYXJ0aWNpcGFudHMucHVzaChvcmdhbml6YXRpb25QYXJ0aWNpcGFudEV4cHJlc3Npb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbm90aWZ5QWN0aXZpdHk7XHJcbiAgICB9XHJcblxyXG4gICAgTmV3SW5zdGFuY2UoKTogTm90aWZ5QWN0aXZpdHkge1xyXG4gICAgICAgIHJldHVybiBuZXcgTm90aWZ5QWN0aXZpdHkodGhpcy5Nb2RlbCk7XHJcbiAgICB9XHJcblxyXG4gICAgUmVzZXRCZWZvcmVMb2FkRnJvbSgpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5SZXNldEJlZm9yZUxvYWRGcm9tKCk7XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNpcGFudHMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VOb3RpY2VzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgdGhpcy5leGVjdXRlRm9ybXMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICB0aGlzLmV4dGVuZFByb3BlcnRpZXMgPSBuZXcgQXJyYXk8RXh0ZW5kUHJvcGVydHk+KCk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlBYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5keW5hbWljUGFydGljaXBhbnRzID0gbmV3IEFycmF5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIENvbnZlcnRUb0pzb25PYmplY3QoKToge30ge1xyXG4gICAgICAgIC8vIHRoaXMuYmVmb3JlU2VyaWFsaXplKCk7XHJcbiAgICAgICAgbGV0IG9iaiA9IHN1cGVyLkNvbnZlcnRUb0pzb25PYmplY3QoKTtcclxuICAgICAgICBCcG1uTW9kZWxIZWxwZXIuU2V0QXR0cmlidXRlVmFsdWUob2JqLCBcIk5vdGlmeUFibGVcIiwgdGhpcy5ub3RpZnlBYmxlKTtcclxuICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBMb2FkRnJvbUpzb25PYmplY3Qob2JqOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5Mb2FkRnJvbUpzb25PYmplY3Qob2JqKTtcclxuXHJcbiAgICAgICAgdGhpcy5ub3RpZnlBYmxlID0gRXh0ZW5zaW9uTWV0aG9kLkdldEF0dHJpYnV0ZVZhbHVlNEJvb2xlYW4ob2JqLCBcIk5vdGlmeUFibGVcIik7O1xyXG4gICAgICAgIC8vIHRoaXMuYWZ0ZXJEZXNlcmlhbGl6ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBHZXRFeHRlbnNpb25FbGVtZW50czRDb252ZXJ0VG8oKTogRXh0ZW5zaW9uRWxlbWVudFtdIHtcclxuICAgICAgICBsZXQgbGlzdDogRXh0ZW5zaW9uRWxlbWVudFtdID0gc3VwZXIuR2V0RXh0ZW5zaW9uRWxlbWVudHM0Q29udmVydFRvKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VOb3RpY2VzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaXRlbSBvZiB0aGlzLm1lc3NhZ2VOb3RpY2VzKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLk1leFRhZyA9IE5vdGlmeUFjdGl2aXR5Lk1FWFRBRztcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5leGVjdXRlRm9ybXMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBmb3JtIG9mIHRoaXMuZXhlY3V0ZUZvcm1zKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLk1leFRhZyA9IE5vdGlmeUFjdGl2aXR5Lk1FWFRBRztcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaChmb3JtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5leHRlbmRQcm9wZXJ0aWVzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgZXh0ZW5kUHJvcGVydHkgb2YgdGhpcy5leHRlbmRQcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICBleHRlbmRQcm9wZXJ0eS5NZXhUYWcgPSBOb3RpZnlBY3Rpdml0eS5NRVhUQUc7XHJcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2goZXh0ZW5kUHJvcGVydHkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmR5bmFtaWNQYXJ0aWNpcGFudHMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBwYXJ0aWNpcGFudCBvZiB0aGlzLmR5bmFtaWNQYXJ0aWNpcGFudHMpIHtcclxuICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50Lk1leFRhZyA9IE5vdGlmeUFjdGl2aXR5Lk1FWFRBRztcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaChwYXJ0aWNpcGFudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIFNldEV4dGVuc2lvbkVsZW1lbnRzNExvYWRGcm9tKGV4dGVuc2lvbkVsZW1lbnRzOiBFeHRlbnNpb25FbGVtZW50W10pOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5TZXRFeHRlbnNpb25FbGVtZW50czRMb2FkRnJvbShleHRlbnNpb25FbGVtZW50cyk7XHJcbiAgICAgICAgZm9yIChsZXQgZXh0ZW5zaW9uRWxlbWVudCBvZiBleHRlbnNpb25FbGVtZW50cykge1xyXG4gICAgICAgICAgICBpZiAoTm90aWZ5QWN0aXZpdHkuTUVYVEFHICE9IGV4dGVuc2lvbkVsZW1lbnQuTWV4VGFnKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzd2l0Y2ggKGV4dGVuc2lvbkVsZW1lbnQuQ2xyVHlwZUlEKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIE1lc3NhZ2VOb3RpY2UuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlTm90aWNlcy5wdXNoKGV4dGVuc2lvbkVsZW1lbnQgYXMgTWVzc2FnZU5vdGljZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEV4ZWN1dGVGb3JtLkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXhlY3V0ZUZvcm1zLnB1c2goZXh0ZW5zaW9uRWxlbWVudCBhcyBFeGVjdXRlRm9ybSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEV4dGVuZFByb3BlcnR5LkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXh0ZW5kUHJvcGVydGllcy5wdXNoKGV4dGVuc2lvbkVsZW1lbnQgYXMgRXh0ZW5kUHJvcGVydHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXh0ZW5zaW9uRWxlbWVudCBpbnN0YW5jZW9mIFBhcnRpY2lwYW50RXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmR5bmFtaWNQYXJ0aWNpcGFudHMucHVzaChleHRlbnNpb25FbGVtZW50IGFzIFBhcnRpY2lwYW50RXhwcmVzc2lvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBiZWZvcmVTZXJpYWxpemUoKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IHJvbGVzID0gdGhpcy5HZXRSZXNvdXJjZVJvbGVzKCk7XHJcbiAgICAgICAgaWYgKHJvbGVzICE9IG51bGwgJiYgcm9sZXMubGVuZ3RoICE9IDApIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgcm9sZSBvZiByb2xlcykge1xyXG4gICAgICAgICAgICAgICAgc3VwZXIuUmVtb3ZlUmVzb3VyY2VSb2xlKHJvbGUuSWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBhcnRpY2lwYW50cyAhPSBudWxsICYmIHRoaXMucGFydGljaXBhbnRzLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHBhcnRpY2lwYW50IG9mIHRoaXMucGFydGljaXBhbnRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLkFkZFJlc291cmNlUm9sZShwYXJ0aWNpcGFudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGFmdGVyRGVzZXJpYWxpemUoKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IHJvbGVzID0gdGhpcy5HZXRSZXNvdXJjZVJvbGVzKCk7XHJcbiAgICAgICAgaWYgKHJvbGVzID09IG51bGwgfHwgcm9sZXMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCByb2xlIG9mIHJvbGVzKSB7XHJcbiAgICAgICAgICAgIGlmIChyb2xlIGluc3RhbmNlb2YgUGFydGljaXBhbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFydGljaXBhbnRzLnB1c2gocm9sZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbkJwbW5Nb2RlbEhlbHBlci5SZWdpc3RlckVsZW1lbnRUeXBlKG5ldyBOb3RpZnlBY3Rpdml0eShuZXcgQnBtbk1vZGVsKCkpKTtcclxuIl19
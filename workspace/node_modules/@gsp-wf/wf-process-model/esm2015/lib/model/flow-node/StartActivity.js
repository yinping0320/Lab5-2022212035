/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { BpmnModel, BpmnModelHelper, StartEvent, ExtensionMethod } from "@edp-pmf/bpmn-model";
import { ExtendProperty } from "../ExtendProperty";
import { ExecuteForm, TerminalType } from "../extension/ExecuteForm";
import { JumpScope } from "../extension/JumpScope";
import { OtherAssignNodes } from "../extension/OtherAssignNodes";
import { ActualParameter } from "../parameter/WFActualParameter";
export class StartActivity extends StartEvent {
    /**
     * @param {?} model
     */
    constructor(model) {
        super(model);
        this.ClrTypeID = StartActivity.Clr_Type_ID;
        this.sendBackedTask = true;
        this.selectTargetAble = false;
    }
    /**
     * @return {?}
     */
    ResetBeforeLoadFrom() {
        super.ResetBeforeLoadFrom();
        this.ExecuteForms = new Array();
        this.extendProperties = new Array();
        this.sendBackedTask = true;
        this.selectTargetAble = false;
        this.jumpScope = null;
        this.otherAssignNodes = null;
    }
    /**
     * @return {?}
     */
    ConvertToJsonObject() {
        /** @type {?} */
        let obj = super.ConvertToJsonObject();
        BpmnModelHelper.SetAttributeValue(obj, 'SendBackedTask', this.sendBackedTask);
        BpmnModelHelper.SetAttributeValue(obj, 'SelectTargetAble', this.selectTargetAble);
        return obj;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    LoadFromJsonObject(obj) {
        super.LoadFromJsonObject(obj);
        this.sendBackedTask = ExtensionMethod.GetAttributeValue4Boolean(obj, "SendBackedTask");
        this.selectTargetAble = ExtensionMethod.GetAttributeValue4Boolean(obj, "SelectTargetAble");
    }
    /**
     * @protected
     * @return {?}
     */
    GetExtensionElements4ConvertTo() {
        /** @type {?} */
        let list = super.GetExtensionElements4ConvertTo();
        if (this.ExecuteForms != null) {
            for (let form of this.ExecuteForms) {
                form.MexTag = StartActivity.MEXTAG;
                list.push(form);
            }
        }
        if (this.extendProperties != null) {
            for (let e of this.extendProperties) {
                e.MexTag = StartActivity.MEXTAG;
                list.push(e);
            }
        }
        if (this.jumpScope != null) {
            this.jumpScope.MexTag = StartActivity.MEXTAG;
            list.push(this.jumpScope);
        }
        if (this.otherAssignNodes != null) {
            this.otherAssignNodes.MexTag = StartActivity.MEXTAG;
            list.push(this.otherAssignNodes);
        }
        return list;
    }
    /**
     * @protected
     * @param {?} extensionElements
     * @return {?}
     */
    SetExtensionElements4LoadFrom(extensionElements) {
        super.SetExtensionElements4LoadFrom(extensionElements);
        for (let extensionElement of extensionElements) {
            if (extensionElement.MexTag !== StartActivity.MEXTAG)
                continue;
            switch (extensionElement.ClrTypeID) {
                case ExecuteForm.Clr_Type_ID:
                    this.ExecuteForms.push((/** @type {?} */ (extensionElement)));
                    break;
                case ExtendProperty.Clr_Type_ID:
                    this.extendProperties.push((/** @type {?} */ (extensionElement)));
                    break;
                case JumpScope.Clr_Type_ID:
                    this.jumpScope = ((/** @type {?} */ (extensionElement)));
                    break;
                case OtherAssignNodes.Clr_Type_ID:
                    this.otherAssignNodes = ((/** @type {?} */ (extensionElement)));
                    break;
                default:
                    break;
            }
        }
    }
    /**
     * @return {?}
     */
    NewInstance() {
        return new StartActivity(this.Model);
    }
    /**
     * 模型校验
     * @param {?} errors 模型校验错误信息
     * @return {?}
     */
    Validate(errors) {
        // TODO: 需要添加自定义校验信息
        super.Validate(errors);
    }
    /**
     * @return {?}
     */
    clone() {
        /** @type {?} */
        const startActivity = new StartActivity(this.Model);
        startActivity.Name = this.Name;
        startActivity.sendBackedTask = this.sendBackedTask;
        startActivity.selectTargetAble = this.selectTargetAble;
        startActivity.jumpScope = null;
        if (this.jumpScope) {
            startActivity.jumpScope = this.jumpScope.clone();
        }
        startActivity.ExecuteForms = new Array();
        if (this.ExecuteForms && this.ExecuteForms.length > 0) {
            for (const f of this.ExecuteForms) {
                /** @type {?} */
                const executeForm = f.clone();
                startActivity.ExecuteForms.push(executeForm);
            }
        }
        if (this.extendProperties && this.extendProperties.length > 0) {
            for (const e of this.extendProperties) {
                /** @type {?} */
                const extendProperty = e.clone();
                startActivity.extendProperties.push(extendProperty);
            }
        }
        if (this.otherAssignNodes) {
            startActivity.otherAssignNodes = this.otherAssignNodes.clone();
        }
        return startActivity;
    }
    /**
     * @param {?} forms
     * @return {?}
     */
    setDefaultForms(forms) {
        if (!this.ExecuteForms) {
            this.ExecuteForms = new Array();
        }
        for (const form of forms) {
            /** @type {?} */
            let params = (/** @type {?} */ (form.urlParameters));
            /** @type {?} */
            let actParas = new Array();
            if (params && params.length > 0) {
                for (let para of params) {
                    /** @type {?} */
                    let actPara = new ActualParameter(this.Model, para.code, para.value);
                    if (para.Value && para.Value.length >= 8 && para.Value.slice(0, 8) === `{"expr":`) {
                        actPara.Tag = 'expression';
                    }
                    else {
                        actPara.Tag = 'constant';
                    }
                    actParas.push(actPara);
                }
            }
            /** @type {?} */
            const id = BpmnModelHelper.GenerateElementId();
            /** @type {?} */
            let item = new ExecuteForm(this.Model, id, form.name, actParas);
            item.ComponentId = null;
            item.FormType = '0';
            item.formFormatId = form.id;
            if (form.terminal === 'PC') {
                item.TerminalType = TerminalType.PC;
            }
            else if (form.terminal === 'Mobile') {
                item.TerminalType = TerminalType.MOBILE;
            }
            this.ExecuteForms.push(item);
        }
    }
}
StartActivity.Clr_Type_ID = "wf.StartActivity";
StartActivity.MEXTAG = "wf.StartActivity";
if (false) {
    /** @type {?} */
    StartActivity.Clr_Type_ID;
    /**
     * @type {?}
     * @private
     */
    StartActivity.MEXTAG;
    /** @type {?} */
    StartActivity.prototype.ClrTypeID;
    /** @type {?} */
    StartActivity.prototype.ExecuteForms;
    /** @type {?} */
    StartActivity.prototype.extendProperties;
    /** @type {?} */
    StartActivity.prototype.sendBackedTask;
    /** @type {?} */
    StartActivity.prototype.selectTargetAble;
    /** @type {?} */
    StartActivity.prototype.jumpScope;
    /** @type {?} */
    StartActivity.prototype.otherAssignNodes;
}
BpmnModelHelper.RegisterElementType(new StartActivity(new BpmnModel()));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhcnRBY3Rpdml0eS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbC8iLCJzb3VyY2VzIjpbImxpYi9tb2RlbC9mbG93LW5vZGUvU3RhcnRBY3Rpdml0eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQW9CLFVBQVUsRUFBRSxlQUFlLEVBQW1CLE1BQU0scUJBQXFCLENBQUM7QUFDakksT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVqRSxNQUFNLE9BQU8sYUFBYyxTQUFRLFVBQVU7Ozs7SUFDekMsWUFBWSxLQUFnQjtRQUN4QixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFJakIsY0FBUyxHQUFXLGFBQWEsQ0FBQyxXQUFXLENBQUM7UUFNOUMsbUJBQWMsR0FBWSxJQUFJLENBQUM7UUFUM0IsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztJQUNsQyxDQUFDOzs7O0lBZUQsbUJBQW1CO1FBQ2YsS0FBSyxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLEtBQUssRUFBZSxDQUFDO1FBQzdDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLEtBQUssRUFBa0IsQ0FBQztRQUNwRCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcs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LGFBQWEsQ0FBQyxJQUFJLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJwbW5Nb2RlbCwgQnBtbk1vZGVsSGVscGVyLCBFeHRlbnNpb25FbGVtZW50LCBTdGFydEV2ZW50LCBFeHRlbnNpb25NZXRob2QsIFZhbGlkYXRpb25FcnJvciB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IEV4dGVuZFByb3BlcnR5IH0gZnJvbSBcIi4uL0V4dGVuZFByb3BlcnR5XCI7XHJcbmltcG9ydCB7IEV4ZWN1dGVGb3JtLCBUZXJtaW5hbFR5cGUgfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL0V4ZWN1dGVGb3JtXCI7XHJcbmltcG9ydCB7IEp1bXBTY29wZSB9IGZyb20gXCIuLi9leHRlbnNpb24vSnVtcFNjb3BlXCI7XHJcbmltcG9ydCB7IE90aGVyQXNzaWduTm9kZXMgfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL090aGVyQXNzaWduTm9kZXNcIjtcclxuaW1wb3J0IHsgQWN0dWFsUGFyYW1ldGVyIH0gZnJvbSBcIi4uL3BhcmFtZXRlci9XRkFjdHVhbFBhcmFtZXRlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN0YXJ0QWN0aXZpdHkgZXh0ZW5kcyBTdGFydEV2ZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKG1vZGVsOiBCcG1uTW9kZWwpIHtcclxuICAgICAgICBzdXBlcihtb2RlbCk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RUYXJnZXRBYmxlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgQ2xyX1R5cGVfSUQ6IHN0cmluZyA9IFwid2YuU3RhcnRBY3Rpdml0eVwiO1xyXG4gICAgQ2xyVHlwZUlEOiBzdHJpbmcgPSBTdGFydEFjdGl2aXR5LkNscl9UeXBlX0lEO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgTUVYVEFHOiBzdHJpbmcgPSBcIndmLlN0YXJ0QWN0aXZpdHlcIjtcclxuXHJcbiAgICBFeGVjdXRlRm9ybXM6IEFycmF5PEV4ZWN1dGVGb3JtPjtcclxuICAgIGV4dGVuZFByb3BlcnRpZXM6IEFycmF5PEV4dGVuZFByb3BlcnR5PjtcclxuXHJcbiAgICBzZW5kQmFja2VkVGFzazogYm9vbGVhbiA9IHRydWU7XHJcblxyXG4gICAgc2VsZWN0VGFyZ2V0QWJsZTogYm9vbGVhbjtcclxuICAgIGp1bXBTY29wZTogSnVtcFNjb3BlO1xyXG5cclxuICAgIG90aGVyQXNzaWduTm9kZXM6IE90aGVyQXNzaWduTm9kZXM7XHJcblxyXG4gICAgUmVzZXRCZWZvcmVMb2FkRnJvbSgpIHtcclxuICAgICAgICBzdXBlci5SZXNldEJlZm9yZUxvYWRGcm9tKCk7XHJcbiAgICAgICAgdGhpcy5FeGVjdXRlRm9ybXMgPSBuZXcgQXJyYXk8RXhlY3V0ZUZvcm0+KCk7XHJcbiAgICAgICAgdGhpcy5leHRlbmRQcm9wZXJ0aWVzID0gbmV3IEFycmF5PEV4dGVuZFByb3BlcnR5PigpO1xyXG4gICAgICAgIHRoaXMuc2VuZEJhY2tlZFRhc2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0VGFyZ2V0QWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuanVtcFNjb3BlID0gbnVsbDtcclxuICAgICAgICB0aGlzLm90aGVyQXNzaWduTm9kZXMgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIENvbnZlcnRUb0pzb25PYmplY3QoKTogYW55IHtcclxuICAgICAgICBsZXQgb2JqID0gc3VwZXIuQ29udmVydFRvSnNvbk9iamVjdCgpO1xyXG4gICAgICAgIEJwbW5Nb2RlbEhlbHBlci5TZXRBdHRyaWJ1dGVWYWx1ZShvYmosICdTZW5kQmFja2VkVGFzaycsIHRoaXMuc2VuZEJhY2tlZFRhc2spO1xyXG4gICAgICAgIEJwbW5Nb2RlbEhlbHBlci5TZXRBdHRyaWJ1dGVWYWx1ZShvYmosICdTZWxlY3RUYXJnZXRBYmxlJywgdGhpcy5zZWxlY3RUYXJnZXRBYmxlKTtcclxuICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG4gICAgTG9hZEZyb21Kc29uT2JqZWN0KG9iajogYW55KSB7XHJcbiAgICAgICAgc3VwZXIuTG9hZEZyb21Kc29uT2JqZWN0KG9iaik7XHJcbiAgICAgICAgdGhpcy5zZW5kQmFja2VkVGFzayA9IEV4dGVuc2lvbk1ldGhvZC5HZXRBdHRyaWJ1dGVWYWx1ZTRCb29sZWFuKG9iaiwgXCJTZW5kQmFja2VkVGFza1wiKTtcclxuICAgICAgICB0aGlzLnNlbGVjdFRhcmdldEFibGUgPSBFeHRlbnNpb25NZXRob2QuR2V0QXR0cmlidXRlVmFsdWU0Qm9vbGVhbihvYmosIFwiU2VsZWN0VGFyZ2V0QWJsZVwiKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgR2V0RXh0ZW5zaW9uRWxlbWVudHM0Q29udmVydFRvKCk6IEV4dGVuc2lvbkVsZW1lbnRbXSB7XHJcbiAgICAgICAgbGV0IGxpc3QgPSBzdXBlci5HZXRFeHRlbnNpb25FbGVtZW50czRDb252ZXJ0VG8oKTtcclxuICAgICAgICBpZiAodGhpcy5FeGVjdXRlRm9ybXMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBmb3JtIG9mIHRoaXMuRXhlY3V0ZUZvcm1zKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLk1leFRhZyA9IFN0YXJ0QWN0aXZpdHkuTUVYVEFHO1xyXG4gICAgICAgICAgICAgICAgbGlzdC5wdXNoKGZvcm0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmV4dGVuZFByb3BlcnRpZXMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBlIG9mIHRoaXMuZXh0ZW5kUHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgZS5NZXhUYWcgPSBTdGFydEFjdGl2aXR5Lk1FWFRBRztcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5qdW1wU2NvcGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmp1bXBTY29wZS5NZXhUYWcgPSBTdGFydEFjdGl2aXR5Lk1FWFRBRztcclxuICAgICAgICAgICAgbGlzdC5wdXNoKHRoaXMuanVtcFNjb3BlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMub3RoZXJBc3NpZ25Ob2RlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3RoZXJBc3NpZ25Ob2Rlcy5NZXhUYWcgPSBTdGFydEFjdGl2aXR5Lk1FWFRBRztcclxuICAgICAgICAgICAgbGlzdC5wdXNoKHRoaXMub3RoZXJBc3NpZ25Ob2Rlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgfVxyXG4gICAgcHJvdGVjdGVkIFNldEV4dGVuc2lvbkVsZW1lbnRzNExvYWRGcm9tKGV4dGVuc2lvbkVsZW1lbnRzOiBFeHRlbnNpb25FbGVtZW50W10pIHtcclxuICAgICAgICBzdXBlci5TZXRFeHRlbnNpb25FbGVtZW50czRMb2FkRnJvbShleHRlbnNpb25FbGVtZW50cyk7XHJcbiAgICAgICAgZm9yIChsZXQgZXh0ZW5zaW9uRWxlbWVudCBvZiBleHRlbnNpb25FbGVtZW50cykge1xyXG4gICAgICAgICAgICBpZiAoZXh0ZW5zaW9uRWxlbWVudC5NZXhUYWcgIT09IFN0YXJ0QWN0aXZpdHkuTUVYVEFHKVxyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZXh0ZW5zaW9uRWxlbWVudC5DbHJUeXBlSUQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRXhlY3V0ZUZvcm0uQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5FeGVjdXRlRm9ybXMucHVzaChleHRlbnNpb25FbGVtZW50IGFzIEV4ZWN1dGVGb3JtKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRXh0ZW5kUHJvcGVydHkuQ2xyX1R5cGVfSUQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHRlbmRQcm9wZXJ0aWVzLnB1c2goZXh0ZW5zaW9uRWxlbWVudCBhcyBFeHRlbmRQcm9wZXJ0eSlcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgSnVtcFNjb3BlLkNscl9UeXBlX0lEOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuanVtcFNjb3BlID0gKGV4dGVuc2lvbkVsZW1lbnQgYXMgSnVtcFNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgT3RoZXJBc3NpZ25Ob2Rlcy5DbHJfVHlwZV9JRDpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm90aGVyQXNzaWduTm9kZXMgPSAoZXh0ZW5zaW9uRWxlbWVudCBhcyBPdGhlckFzc2lnbk5vZGVzKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBOZXdJbnN0YW5jZSgpOiBTdGFydEFjdGl2aXR5IHtcclxuICAgICAgICByZXR1cm4gbmV3IFN0YXJ0QWN0aXZpdHkodGhpcy5Nb2RlbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICog5qih5Z6L5qCh6aqMXHJcbiAgICAqIEBwYXJhbSBlcnJvcnMg5qih5Z6L5qCh6aqM6ZSZ6K+v5L+h5oGvXHJcbiAgICAqL1xyXG4gICAgVmFsaWRhdGUoZXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JbXSk6IHZvaWQge1xyXG4gICAgICAgIC8vIFRPRE86IOmcgOimgea3u+WKoOiHquWumuS5ieagoemqjOS/oeaBr1xyXG4gICAgICAgIHN1cGVyLlZhbGlkYXRlKGVycm9ycyk7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvbmUoKTogU3RhcnRBY3Rpdml0eSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRBY3Rpdml0eSA9IG5ldyBTdGFydEFjdGl2aXR5KHRoaXMuTW9kZWwpO1xyXG4gICAgICAgIHN0YXJ0QWN0aXZpdHkuTmFtZSA9IHRoaXMuTmFtZTtcclxuICAgICAgICBzdGFydEFjdGl2aXR5LnNlbmRCYWNrZWRUYXNrID0gdGhpcy5zZW5kQmFja2VkVGFzaztcclxuICAgICAgICBzdGFydEFjdGl2aXR5LnNlbGVjdFRhcmdldEFibGUgPSB0aGlzLnNlbGVjdFRhcmdldEFibGU7XHJcbiAgICAgICAgc3RhcnRBY3Rpdml0eS5qdW1wU2NvcGUgPSBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmp1bXBTY29wZSkge1xyXG4gICAgICAgICAgICBzdGFydEFjdGl2aXR5Lmp1bXBTY29wZSA9IHRoaXMuanVtcFNjb3BlLmNsb25lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXJ0QWN0aXZpdHkuRXhlY3V0ZUZvcm1zID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuRXhlY3V0ZUZvcm1zICYmIHRoaXMuRXhlY3V0ZUZvcm1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBmIG9mIHRoaXMuRXhlY3V0ZUZvcm1zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleGVjdXRlRm9ybSA9IGYuY2xvbmUoKVxyXG4gICAgICAgICAgICAgICAgc3RhcnRBY3Rpdml0eS5FeGVjdXRlRm9ybXMucHVzaChleGVjdXRlRm9ybSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZXh0ZW5kUHJvcGVydGllcyAmJiB0aGlzLmV4dGVuZFByb3BlcnRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5leHRlbmRQcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleHRlbmRQcm9wZXJ0eSA9IGUuY2xvbmUoKTtcclxuICAgICAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHkuZXh0ZW5kUHJvcGVydGllcy5wdXNoKGV4dGVuZFByb3BlcnR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5vdGhlckFzc2lnbk5vZGVzKSB7XHJcbiAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHkub3RoZXJBc3NpZ25Ob2RlcyA9IHRoaXMub3RoZXJBc3NpZ25Ob2Rlcy5jbG9uZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RhcnRBY3Rpdml0eTtcclxuICAgIH1cclxuXHJcbiAgICBzZXREZWZhdWx0Rm9ybXMoZm9ybXM6IEFycmF5PGFueT4pIHtcclxuICAgICAgICBpZiAoIXRoaXMuRXhlY3V0ZUZvcm1zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuRXhlY3V0ZUZvcm1zID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoY29uc3QgZm9ybSBvZiBmb3Jtcykge1xyXG4gICAgICAgICAgICBsZXQgcGFyYW1zID0gZm9ybS51cmxQYXJhbWV0ZXJzIGFzIGFueVtdO1xyXG4gICAgICAgICAgICBsZXQgYWN0UGFyYXMgPSBuZXcgQXJyYXk8QWN0dWFsUGFyYW1ldGVyPigpO1xyXG4gICAgICAgICAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBwYXJhIG9mIHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhY3RQYXJhID0gbmV3IEFjdHVhbFBhcmFtZXRlcih0aGlzLk1vZGVsLCBwYXJhLmNvZGUsIHBhcmEudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhLlZhbHVlICYmIHBhcmEuVmFsdWUubGVuZ3RoID49IDggJiYgcGFyYS5WYWx1ZS5zbGljZSgwLCA4KSA9PT0gYHtcImV4cHJcIjpgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdFBhcmEuVGFnID0gJ2V4cHJlc3Npb24nO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdFBhcmEuVGFnID0gJ2NvbnN0YW50JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0UGFyYXMucHVzaChhY3RQYXJhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBpZCA9IEJwbW5Nb2RlbEhlbHBlci5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IG5ldyBFeGVjdXRlRm9ybSh0aGlzLk1vZGVsLCBpZCwgZm9ybS5uYW1lLCBhY3RQYXJhcyk7XHJcbiAgICAgICAgICAgIGl0ZW0uQ29tcG9uZW50SWQgPSBudWxsO1xyXG4gICAgICAgICAgICBpdGVtLkZvcm1UeXBlID0gJzAnO1xyXG4gICAgICAgICAgICBpdGVtLmZvcm1Gb3JtYXRJZCA9IGZvcm0uaWQ7XHJcbiAgICAgICAgICAgIGlmIChmb3JtLnRlcm1pbmFsID09PSAnUEMnKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLlRlcm1pbmFsVHlwZSA9IFRlcm1pbmFsVHlwZS5QQztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtLnRlcm1pbmFsID09PSAnTW9iaWxlJykge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5UZXJtaW5hbFR5cGUgPSBUZXJtaW5hbFR5cGUuTU9CSUxFO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuRXhlY3V0ZUZvcm1zLnB1c2goaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuQnBtbk1vZGVsSGVscGVyLlJlZ2lzdGVyRWxlbWVudFR5cGUobmV3IFN0YXJ0QWN0aXZpdHkobmV3IEJwbW5Nb2RlbCgpKSk7XHJcbiJdfQ==
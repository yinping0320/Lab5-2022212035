/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { BpmnModel, BpmnModelHelper, ExtensionMethod, ExtensionElement } from "@edp-pmf/bpmn-model";
import { AutoHandleExpireOperation } from "./AutoHandleExpireOperation";
import { SendMessageExpireOperation } from "./SendMessageExpireOperation";
var TimeLimitControl = /** @class */ (function (_super) {
    tslib_1.__extends(TimeLimitControl, _super);
    function TimeLimitControl(model) {
        var _this = _super.call(this, model) || this;
        _this.ClrTypeID = TimeLimitControl.Clr_Type_ID;
        _this.expireOperations = new Array();
        return _this;
    }
    /**
     * @protected
     * @return {?}
     */
    TimeLimitControl.prototype.ResetBeforeLoadFrom = /**
     * @protected
     * @return {?}
     */
    function () {
        _super.prototype.ResetBeforeLoadFrom.call(this);
    };
    /**
     * @return {?}
     */
    TimeLimitControl.prototype.ConvertToJsonObject = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var obj = _super.prototype.ConvertToJsonObject.call(this);
        ExtensionMethod.SetAttributeValue(obj, "Tag", this.tag);
        ExtensionMethod.SetAttributeValue(obj, "DueTime", this.dueTime);
        ExtensionMethod.SetAttributeValue(obj, "TimeUnit", this.timeUnit);
        ExtensionMethod.SetAttributeValue(obj, "Enable", this.enable);
        /** @type {?} */
        var expireOperationElements = new Array();
        if (this.expireOperations !== null && this.expireOperations.length > 0) {
            this.expireOperations.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                expireOperationElements.push(item.ConvertToJsonObject());
            }));
        }
        ExtensionMethod.SetAttributeValue(obj, "ExpireOperations", expireOperationElements);
        return obj;
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    TimeLimitControl.prototype.LoadFromJsonObject = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        var _this = this;
        _super.prototype.LoadFromJsonObject.call(this, obj);
        this.tag = ExtensionMethod.GetAttributeValue4String(obj, "Tag");
        this.dueTime = ExtensionMethod.GetAttributeValue4String(obj, "DueTime");
        this.timeUnit = ExtensionMethod.GetAttributeValue4String(obj, "TimeUnit");
        this.enable = ExtensionMethod.GetAttributeValue4Boolean(obj, "Enable");
        /** @type {?} */
        var expireOperationElements = (/** @type {?} */ (ExtensionMethod.GetAttributeValue(obj, "ExpireOperations")));
        if (expireOperationElements !== null && expireOperationElements.length > 0) {
            expireOperationElements.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.OperationTypeName === 'SendMessageExpireOperation') {
                    /** @type {?} */
                    var expireOperation = new SendMessageExpireOperation(_this.Model);
                    expireOperation.LoadFromJsonObject(item);
                    _this.expireOperations.push(expireOperation);
                }
                else if (item.OperationTypeName === 'AutoHandleExpireOperation') {
                    /** @type {?} */
                    var expireOperation = new AutoHandleExpireOperation(_this.Model);
                    expireOperation.LoadFromJsonObject(item);
                    _this.expireOperations.push(expireOperation);
                }
            }));
        }
    };
    /**
     * @return {?}
     */
    TimeLimitControl.prototype.NewInstance = /**
     * @return {?}
     */
    function () {
        return new TimeLimitControl(this.Model);
    };
    /**
     * @return {?}
     */
    TimeLimitControl.prototype.clone = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        /** @type {?} */
        var timeLimitControl = new TimeLimitControl(this.Model);
        timeLimitControl.tag = this.tag;
        timeLimitControl.enable = this.enable;
        timeLimitControl.dueTime = this.dueTime;
        timeLimitControl.timeUnit = this.timeUnit;
        timeLimitControl.expireOperations = new Array();
        if (this.expireOperations && this.expireOperations.length > 0) {
            try {
                for (var _b = tslib_1.__values(this.expireOperations), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var e = _c.value;
                    if (e instanceof SendMessageExpireOperation) {
                        /** @type {?} */
                        var sendMessage = (/** @type {?} */ (e));
                        /** @type {?} */
                        var expireOperation = sendMessage.clone();
                        timeLimitControl.expireOperations.push(expireOperation);
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return timeLimitControl;
    };
    TimeLimitControl.Clr_Type_ID = "wf.TimeLimitControl";
    return TimeLimitControl;
}(ExtensionElement));
export { TimeLimitControl };
if (false) {
    /** @type {?} */
    TimeLimitControl.Clr_Type_ID;
    /** @type {?} */
    TimeLimitControl.prototype.ClrTypeID;
    /**
     * 自定义标签，用于区分期限控制方式
     * expression 表达式
     * constant 固定值
     * scope 时间范围
     * @type {?}
     */
    TimeLimitControl.prototype.tag;
    /**
     * 是否启用
     * @type {?}
     */
    TimeLimitControl.prototype.enable;
    /**
     * 限定时长
     * @type {?}
     */
    TimeLimitControl.prototype.dueTime;
    /**
     * 时间单位 day,hour,minute
     * @type {?}
     */
    TimeLimitControl.prototype.timeUnit;
    /** @type {?} */
    TimeLimitControl.prototype.expireOperations;
}
BpmnModelHelper.RegisterElementType(new TimeLimitControl(new BpmnModel()));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGltZUxpbWl0Q29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbC8iLCJzb3VyY2VzIjpbImxpYi9tb2RlbC9UaW1lTGltaXRDb250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDcEcsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFeEUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFMUU7SUFBc0MsNENBQWdCO0lBNkJsRCwwQkFBWSxLQUFnQjtRQUE1QixZQUNJLGtCQUFNLEtBQUssQ0FBQyxTQUNmO1FBN0JRLGVBQVMsR0FBVyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7UUF5QjFELHNCQUFnQixHQUEyQixJQUFJLEtBQUssRUFBRSxDQUFDOztJQUl2RCxDQUFDOzs7OztJQUVTLDhDQUFtQjs7OztJQUE3QjtRQUNJLGlCQUFNLG1CQUFtQixXQUFFLENBQUM7SUFDaEMsQ0FBQzs7OztJQUVELDhDQUFtQjs7O0lBQW5COztZQUNRLEdBQUcsR0FBRyxpQkFBTSxtQkFBbUIsV0FBRTtRQUNyQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEQsZUFBZSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2hFLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRSxlQUFlLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7O1lB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QUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTs7Z0JBQzNELEtBQWdCLElBQUEsS0FBQSxpQkFBQSxJQUFJLENBQUMsZ0JBQWdCLENBQUEsZ0JBQUEsNEJBQUU7b0JBQWxDLElBQU0sQ0FBQyxXQUFBO29CQUNSLElBQUksQ0FBQyxZQUFZLDBCQUEwQixFQUFFOzs0QkFDbkMsV0FBVyxHQUFHLG1CQUFBLENBQUMsRUFBOEI7OzRCQUM3QyxlQUFlLEdBQUcsV0FBVyxDQUFDLEtBQUssRUFBRTt3QkFDM0MsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO3FCQUMzRDtpQkFDSjs7Ozs7Ozs7O1NBQ0o7UUFFRCxPQUFPLGdCQUFnQixDQUFDO0lBQzVCLENBQUM7SUF0R00sNEJBQVcsR0FBVyxxQkFBcUIsQ0FBQztJQXVHdkQsdUJBQUM7Q0FBQSxBQXhHRCxDQUFzQyxnQkFBZ0IsR0F3R3JEO1NBeEdZLGdCQUFnQjs7O0lBQ3pCLDZCQUFtRDs7SUFDbkQscUNBQTBEOzs7Ozs7OztJQVExRCwrQkFBWTs7Ozs7SUFLWixrQ0FBZ0I7Ozs7O0lBS2hCLG1DQUFnQjs7Ozs7SUFLaEIsb0NBQWlCOztJQUVqQiw0Q0FBdUQ7O0FBOEUzRCxlQUFlLENBQUMsbUJBQW1CLENBQUMsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJwbW5Nb2RlbCwgQnBtbk1vZGVsSGVscGVyLCBFeHRlbnNpb25NZXRob2QsIEV4dGVuc2lvbkVsZW1lbnQgfSBmcm9tIFwiQGVkcC1wbWYvYnBtbi1tb2RlbFwiO1xyXG5pbXBvcnQgeyBBdXRvSGFuZGxlRXhwaXJlT3BlcmF0aW9uIH0gZnJvbSBcIi4vQXV0b0hhbmRsZUV4cGlyZU9wZXJhdGlvblwiO1xyXG5pbXBvcnQgeyBFeHBpcmVPcGVyYXRpb24gfSBmcm9tIFwiLi9FeHBpcmVPcGVyYXRpb25cIjtcclxuaW1wb3J0IHsgU2VuZE1lc3NhZ2VFeHBpcmVPcGVyYXRpb24gfSBmcm9tIFwiLi9TZW5kTWVzc2FnZUV4cGlyZU9wZXJhdGlvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFRpbWVMaW1pdENvbnRyb2wgZXh0ZW5kcyBFeHRlbnNpb25FbGVtZW50IHtcclxuICAgIHN0YXRpYyBDbHJfVHlwZV9JRDogc3RyaW5nID0gXCJ3Zi5UaW1lTGltaXRDb250cm9sXCI7XHJcbiAgICByZWFkb25seSBDbHJUeXBlSUQ6IHN0cmluZyA9IFRpbWVMaW1pdENvbnRyb2wuQ2xyX1R5cGVfSUQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDoh6rlrprkuYnmoIfnrb7vvIznlKjkuo7ljLrliIbmnJ/pmZDmjqfliLbmlrnlvI9cclxuICAgICAqIGV4cHJlc3Npb24g6KGo6L6+5byPXHJcbiAgICAgKiBjb25zdGFudCDlm7rlrprlgLxcclxuICAgICAqIHNjb3BlIOaXtumXtOiMg+WbtFxyXG4gICAgICovXHJcbiAgICB0YWc6IHN0cmluZztcclxuXHJcbiAgICAvKipcclxuICAgICAqIOaYr+WQpuWQr+eUqFxyXG4gICAgICovXHJcbiAgICBlbmFibGU6IGJvb2xlYW47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpmZDlrprml7bplb9cclxuICAgICAqL1xyXG4gICAgZHVlVGltZTogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pe26Ze05Y2V5L2NIGRheSxob3VyLG1pbnV0ZVxyXG4gICAgICovXHJcbiAgICB0aW1lVW5pdDogc3RyaW5nO1xyXG5cclxuICAgIGV4cGlyZU9wZXJhdGlvbnM6IEFycmF5PEV4cGlyZU9wZXJhdGlvbj4gPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbDogQnBtbk1vZGVsKSB7XHJcbiAgICAgICAgc3VwZXIobW9kZWwpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBSZXNldEJlZm9yZUxvYWRGcm9tKCkge1xyXG4gICAgICAgIHN1cGVyLlJlc2V0QmVmb3JlTG9hZEZyb20oKTtcclxuICAgIH1cclxuXHJcbiAgICBDb252ZXJ0VG9Kc29uT2JqZWN0KCk6IGFueSB7XHJcbiAgICAgICAgbGV0IG9iaiA9IHN1cGVyLkNvbnZlcnRUb0pzb25PYmplY3QoKTtcclxuICAgICAgICBFeHRlbnNpb25NZXRob2QuU2V0QXR0cmlidXRlVmFsdWUob2JqLCBcIlRhZ1wiLCB0aGlzLnRhZyk7XHJcbiAgICAgICAgRXh0ZW5zaW9uTWV0aG9kLlNldEF0dHJpYnV0ZVZhbHVlKG9iaiwgXCJEdWVUaW1lXCIsIHRoaXMuZHVlVGltZSk7XHJcbiAgICAgICAgRXh0ZW5zaW9uTWV0aG9kLlNldEF0dHJpYnV0ZVZhbHVlKG9iaiwgXCJUaW1lVW5pdFwiLCB0aGlzLnRpbWVVbml0KTtcclxuICAgICAgICBFeHRlbnNpb25NZXRob2QuU2V0QXR0cmlidXRlVmFsdWUob2JqLCBcIkVuYWJsZVwiLCB0aGlzLmVuYWJsZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGV4cGlyZU9wZXJhdGlvbkVsZW1lbnRzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZXhwaXJlT3BlcmF0aW9ucyAhPT0gbnVsbCAmJiB0aGlzLmV4cGlyZU9wZXJhdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmV4cGlyZU9wZXJhdGlvbnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZXhwaXJlT3BlcmF0aW9uRWxlbWVudHMucHVzaChpdGVtLkNvbnZlcnRUb0pzb25PYmplY3QoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBFeHRlbnNpb25NZXRob2QuU2V0QXR0cmlidXRlVmFsdWUob2JqLCBcIkV4cGlyZU9wZXJhdGlvbnNcIiwgZXhwaXJlT3BlcmF0aW9uRWxlbWVudHMpO1xyXG5cclxuICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG5cclxuICAgIExvYWRGcm9tSnNvbk9iamVjdChvYmo6IGFueSkge1xyXG4gICAgICAgIHN1cGVyLkxvYWRGcm9tSnNvbk9iamVjdChvYmopO1xyXG5cclxuICAgICAgICB0aGlzLnRhZyA9IEV4dGVuc2lvbk1ldGhvZC5HZXRBdHRyaWJ1dGVWYWx1ZTRTdHJpbmcob2JqLCBcIlRhZ1wiKTtcclxuICAgICAgICB0aGlzLmR1ZVRpbWUgPSBFeHRlbnNpb25NZXRob2QuR2V0QXR0cmlidXRlVmFsdWU0U3RyaW5nKG9iaiwgXCJEdWVUaW1lXCIpO1xyXG4gICAgICAgIHRoaXMudGltZVVuaXQgPSBFeHRlbnNpb25NZXRob2QuR2V0QXR0cmlidXRlVmFsdWU0U3RyaW5nKG9iaiwgXCJUaW1lVW5pdFwiKTtcclxuICAgICAgICB0aGlzLmVuYWJsZSA9IEV4dGVuc2lvbk1ldGhvZC5HZXRBdHRyaWJ1dGVWYWx1ZTRCb29sZWFuKG9iaiwgXCJFbmFibGVcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IGV4cGlyZU9wZXJhdGlvbkVsZW1lbnRzID0gRXh0ZW5zaW9uTWV0aG9kLkdldEF0dHJpYnV0ZVZhbHVlKG9iaiwgXCJFeHBpcmVPcGVyYXRpb25zXCIpIGFzIEFycmF5PGFueT47XHJcblxyXG4gICAgICAgIGlmIChleHBpcmVPcGVyYXRpb25FbGVtZW50cyAhPT0gbnVsbCAmJiBleHBpcmVPcGVyYXRpb25FbGVtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGV4cGlyZU9wZXJhdGlvbkVsZW1lbnRzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLk9wZXJhdGlvblR5cGVOYW1lID09PSAnU2VuZE1lc3NhZ2VFeHBpcmVPcGVyYXRpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwaXJlT3BlcmF0aW9uID0gbmV3IFNlbmRNZXNzYWdlRXhwaXJlT3BlcmF0aW9uKHRoaXMuTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cGlyZU9wZXJhdGlvbi5Mb2FkRnJvbUpzb25PYmplY3QoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leHBpcmVPcGVyYXRpb25zLnB1c2goZXhwaXJlT3BlcmF0aW9uKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5PcGVyYXRpb25UeXBlTmFtZSA9PT0gJ0F1dG9IYW5kbGVFeHBpcmVPcGVyYXRpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwaXJlT3BlcmF0aW9uID0gbmV3IEF1dG9IYW5kbGVFeHBpcmVPcGVyYXRpb24odGhpcy5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwaXJlT3BlcmF0aW9uLkxvYWRGcm9tSnNvbk9iamVjdChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGlyZU9wZXJhdGlvbnMucHVzaChleHBpcmVPcGVyYXRpb24pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgTmV3SW5zdGFuY2UoKTogVGltZUxpbWl0Q29udHJvbCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBUaW1lTGltaXRDb250cm9sKHRoaXMuTW9kZWwpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb25lKCk6IFRpbWVMaW1pdENvbnRyb2wge1xyXG4gICAgICAgIGNvbnN0IHRpbWVMaW1pdENvbnRyb2wgPSBuZXcgVGltZUxpbWl0Q29udHJvbCh0aGlzLk1vZGVsKTtcclxuICAgICAgICB0aW1lTGltaXRDb250cm9sLnRhZyA9IHRoaXMudGFnO1xyXG4gICAgICAgIHRpbWVMaW1pdENvbnRyb2wuZW5hYmxlID0gdGhpcy5lbmFibGU7XHJcbiAgICAgICAgdGltZUxpbWl0Q29udHJvbC5kdWVUaW1lID0gdGhpcy5kdWVUaW1lO1xyXG4gICAgICAgIHRpbWVMaW1pdENvbnRyb2wudGltZVVuaXQgPSB0aGlzLnRpbWVVbml0O1xyXG4gICAgICAgIHRpbWVMaW1pdENvbnRyb2wuZXhwaXJlT3BlcmF0aW9ucyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIGlmICh0aGlzLmV4cGlyZU9wZXJhdGlvbnMgJiYgdGhpcy5leHBpcmVPcGVyYXRpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuZXhwaXJlT3BlcmF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTZW5kTWVzc2FnZUV4cGlyZU9wZXJhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRNZXNzYWdlID0gZSBhcyBTZW5kTWVzc2FnZUV4cGlyZU9wZXJhdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBpcmVPcGVyYXRpb24gPSBzZW5kTWVzc2FnZS5jbG9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRpbWVMaW1pdENvbnRyb2wuZXhwaXJlT3BlcmF0aW9ucy5wdXNoKGV4cGlyZU9wZXJhdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aW1lTGltaXRDb250cm9sO1xyXG4gICAgfVxyXG59XHJcbkJwbW5Nb2RlbEhlbHBlci5SZWdpc3RlckVsZW1lbnRUeXBlKG5ldyBUaW1lTGltaXRDb250cm9sKG5ldyBCcG1uTW9kZWwoKSkpO1xyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, TemplateRef, HostBinding, ComponentFactoryResolver, Injector } from '@angular/core';
import { Subject } from 'rxjs';
import { MessagerService } from '@farris/ui-messager';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { DatagridComponent } from '@farris/ui-datagrid';
import { EnumItem } from '../entity/dimensiondef.entity';
import { WFDimensionDefUIState } from '../service/wf-dimension-def.uistate';
import { GSPElementObjectType } from '@gsp-bef/gsp-cm-metadata';
import { SelectElementComponent } from '../refModule/select-element/select-element.component';
import { BsModalService } from '@farris/ui-modal';
var EnumEditComponent = /** @class */ (function () {
    function EnumEditComponent(messageService, uistate, modalService, resolver, injector) {
        this.messageService = messageService;
        this.uistate = uistate;
        this.modalService = modalService;
        this.resolver = resolver;
        this.injector = injector;
        this.cls = 'farris-main-area flex-column';
        this.columns = [
            { field: 'key', width: 100, title: '键', editor: { type: EditorTypes.TEXTBOX, options: {} } },
            { field: 'value', width: 100, title: '值', editor: { type: EditorTypes.TEXTBOX, options: {} } }
        ];
        this.confirm = new Subject();
        this.closeModalEmitter = new Subject();
        /**
         * 显示值
         */
        this.editData = new Array();
        this.maxNum = 0;
    }
    Object.defineProperty(EnumEditComponent.prototype, "enumValues", {
        /**
         * 实际值
         */
        get: /**
         * 实际值
         * @return {?}
         */
        function () {
            /** @type {?} */
            var arr = [];
            if (this.editData && this.editData.length >= 0) {
                this.editData.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    /** @type {?} */
                    var enumItem = new EnumItem();
                    enumItem.key = item.key;
                    enumItem.value = item.value;
                    arr.push(enumItem);
                }));
            }
            return arr;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    EnumEditComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * 加载显示数据
     */
    /**
     * 加载显示数据
     * @param {?} enumValues
     * @return {?}
     */
    EnumEditComponent.prototype.load = /**
     * 加载显示数据
     * @param {?} enumValues
     * @return {?}
     */
    function (enumValues) {
        this.editData = tslib_1.__spread(this.createData(enumValues));
    };
    /**
     * 确认
     */
    /**
     * 确认
     * @return {?}
     */
    EnumEditComponent.prototype.onConfirm = /**
     * 确认
     * @return {?}
     */
    function () {
        this.closeCell();
        if (this.checkBeforeSave()) {
            this.confirm.next(this.enumValues);
            this.closeModalEmitter.next();
        }
    };
    /**
     * 取消
     */
    /**
     * 取消
     * @return {?}
     */
    EnumEditComponent.prototype.cancel = /**
     * 取消
     * @return {?}
     */
    function () {
        this.closeModalEmitter.next();
    };
    /**
     * 保存前检查
     */
    /**
     * 保存前检查
     * @return {?}
     */
    EnumEditComponent.prototype.checkBeforeSave = /**
     * 保存前检查
     * @return {?}
     */
    function () {
        var e_1, _a;
        // ① 空，则通过；
        if (!(this.enumValues) || this.enumValues.length === 0) {
            this.messageService.warning('请添加枚举值。');
            return false;
        }
        try {
            // ② 非空，则校验每个的键值是否为空；
            for (var _b = tslib_1.__values(this.enumValues), _c = _b.next(); !_c.done; _c = _b.next()) {
                var item = _c.value;
                if (!item.key || !item.value) {
                    this.messageService.warning('枚举的[键][值]均不允许为空。');
                    return false;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // ③ 多于一个，索引不允许重复；
        if (this.enumValues.length > 1) {
            for (var i = 0; i < this.enumValues.length; i++) {
                /** @type {?} */
                var code1 = this.enumValues[i].value;
                /** @type {?} */
                var name1 = this.enumValues[i].key;
                for (var j = i + 1; j < this.enumValues.length; j++) {
                    /** @type {?} */
                    var code2 = this.enumValues[j].value;
                    /** @type {?} */
                    var name2 = this.enumValues[j].key;
                    if (code1 === code2) {
                        this.messageService.warning("\u679A\u4E3E\u7684[\u7F16\u53F7]\u4E0D\u5141\u8BB8\u91CD\u590D\uFF0C\u91CD\u590D\u7F16\u53F7\u4E3A[" + code1 + "]\u3002");
                        return false;
                    }
                    if (name1 === name2) {
                        this.messageService.warning("\u679A\u4E3E\u7684[\u540D\u79F0]\u4E0D\u5141\u8BB8\u91CD\u590D\uFF0C\u91CD\u590D\u540D\u79F0\u4E3A[" + name1 + "]\u3002");
                        return false;
                    }
                }
            }
        }
        return true;
    };
    /**
     * 取消编辑
     */
    /**
     * 取消编辑
     * @return {?}
     */
    EnumEditComponent.prototype.closeCell = /**
     * 取消编辑
     * @return {?}
     */
    function () {
        this.dg.endCellEdit();
    };
    /**
     * 引入
     */
    /**
     * 引入
     * @return {?}
     */
    EnumEditComponent.prototype.import = /**
     * 引入
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.uistate.beMetaData) {
            this.messageService.error('未获取到BE元数据，请联系管理员查看原因！');
            return;
        }
        /** @type {?} */
        var model = this.uistate.beMetaData.content;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(SelectElementComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.selectEleInfo.be = model;
        compRef.instance.selectEleInfo.singleElement = true;
        compRef.instance.selectEleInfo.assoRefElement = false;
        compRef.instance.confirm.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            var e_2, _a;
            /** @type {?} */
            var selectedElement = (/** @type {?} */ (data.selectedBeFields[0]));
            if (selectedElement.ObjectType === GSPElementObjectType.Enum) {
                _this.editData = new Array();
                /** @type {?} */
                var k = 0;
                try {
                    for (var _b = tslib_1.__values(selectedElement.ContainEnumValues), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var enumValue = _c.value;
                        _this.editData.push({
                            id: k,
                            key: enumValue.Value,
                            value: enumValue.Name,
                        });
                        k++;
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
                _this.maxNum = k;
            }
            else {
                _this.messageService.info('选中字段并非枚举字段，请了解！');
            }
        }));
        /** @type {?} */
        var modalConfig = {
            title: '枚举字段选择',
            width: 1000,
            height: 550,
            showButtons: false
        };
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.closeModal.subscribe((/**
         * @return {?}
         */
        function () {
            dialog.close();
        }));
    };
    /**
     * 新增
     */
    /**
     * 新增
     * @return {?}
     */
    EnumEditComponent.prototype.add = /**
     * 新增
     * @return {?}
     */
    function () {
        this.closeCell();
        /** @type {?} */
        var newId = this.maxNum;
        this.editData = this.editData.concat([{
                id: newId
            }]);
        this.maxNum++;
    };
    /**
     * 删除
     */
    /**
     * 删除
     * @return {?}
     */
    EnumEditComponent.prototype.remove = /**
     * 删除
     * @return {?}
     */
    function () {
        this.closeCell();
        if (this.dg.selectedRow) {
            /** @type {?} */
            var id_1 = this.dg.selectedRow.id;
            this.dg.selectPrevRow();
            this.editData = this.editData.filter((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.id !== id_1; }));
        }
    };
    /**
     * @param {?} enumValues
     * @return {?}
     */
    EnumEditComponent.prototype.createData = /**
     * @param {?} enumValues
     * @return {?}
     */
    function (enumValues) {
        var e_3, _a;
        /** @type {?} */
        var arr = [];
        /** @type {?} */
        var k = 0;
        try {
            for (var enumValues_1 = tslib_1.__values(enumValues), enumValues_1_1 = enumValues_1.next(); !enumValues_1_1.done; enumValues_1_1 = enumValues_1.next()) {
                var enumValue = enumValues_1_1.value;
                arr.push({
                    id: k,
                    key: enumValue.key,
                    value: enumValue.value,
                });
                k++;
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (enumValues_1_1 && !enumValues_1_1.done && (_a = enumValues_1.return)) _a.call(enumValues_1);
            }
            finally { if (e_3) throw e_3.error; }
        }
        this.maxNum = k;
        return arr;
    };
    EnumEditComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-enum-edit',
                    template: "<ng-template #buttons>\r\n    <button class=\"btn btn-primary\" (click)=\"onConfirm()\">\u786E\u5B9A</button>\r\n    <button class=\"btn btn-secondary\" (click)=\"cancel()\">\u53D6\u6D88</button>\r\n</ng-template>\r\n\r\n<div class=\"f-page\">\r\n    <div class=\"f-page-header\">\r\n        <nav class=\"f-page-header-base\">\r\n            <div class=\"f-title\">\r\n                <span class=\"f-title-icon f-text-orna-bill\">\r\n                    <i class=\"f-icon f-icon-page-title-administer\"></i>\r\n                </span>\r\n                <h4 class=\"f-title-text\">\u5217\u8868</h4>\r\n            </div>\r\n            <div class=\"btn-toolbar btn-group-lg\">\r\n                <button class=\"btn btn-primary mr-2\" (click)=\"import()\">\u5F15\u5165</button>\r\n                <button class=\"btn btn-secondary mr-2\" (click)=\"add()\">\u65B0\u589E</button>\r\n                <button class=\"btn btn-secondary\" (click)=\"remove()\">\u5220\u9664</button>\r\n            </div>\r\n        </nav>\r\n    </div>\r\n    <div class=\"f-page-main f-utils-fill-flex-column h-100\">\r\n        <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\">\r\n            <farris-datagrid [data]=\"editData\" [columns]=\"columns\" #dg=\"datagrid\" [fit]=\"true\" \r\n                [editable]=\"true\" [editMode]=\"'cell'\" [idField]=\"'id'\"\r\n                [showCheckbox]=\"false\" [fitColumns]=\"true\" [showLineNumber]=\"true\" [lineNumberTitle]=\"'\u5E8F\u53F7'\" [lineNumberWidth]=\"50\" \r\n                [striped]=\"true\" [virtualized]=\"true\" [pagination]=\"false\">\r\n            </farris-datagrid>\r\n        </div>\r\n    </div>\r\n</div>",
                    styles: [":host{position:absolute;top:0;bottom:0;right:0;left:0}"]
                }] }
    ];
    /** @nocollapse */
    EnumEditComponent.ctorParameters = function () { return [
        { type: MessagerService },
        { type: WFDimensionDefUIState },
        { type: BsModalService },
        { type: ComponentFactoryResolver },
        { type: Injector }
    ]; };
    EnumEditComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        dg: [{ type: ViewChild, args: ['dg',] }],
        btnRef: [{ type: ViewChild, args: ['buttons',] }]
    };
    return EnumEditComponent;
}());
export { EnumEditComponent };
if (false) {
    /** @type {?} */
    EnumEditComponent.prototype.cls;
    /** @type {?} */
    EnumEditComponent.prototype.columns;
    /** @type {?} */
    EnumEditComponent.prototype.dg;
    /** @type {?} */
    EnumEditComponent.prototype.btnRef;
    /** @type {?} */
    EnumEditComponent.prototype.confirm;
    /** @type {?} */
    EnumEditComponent.prototype.closeModalEmitter;
    /**
     * 显示值
     * @type {?}
     */
    EnumEditComponent.prototype.editData;
    /** @type {?} */
    EnumEditComponent.prototype.maxNum;
    /**
     * @type {?}
     * @private
     */
    EnumEditComponent.prototype.messageService;
    /**
     * @type {?}
     * @private
     */
    EnumEditComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    EnumEditComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    EnumEditComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    EnumEditComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW51bS1lZGl0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtZGltZW5zaW9uLWRlZi8iLCJzb3VyY2VzIjpbImxpYi9lbnVtLWVkaXQvZW51bS1lZGl0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNILE9BQU8sRUFBRSxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFFbkMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDekQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDNUUsT0FBTyxFQUFvQyxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2xHLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBQzlGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVsRDtJQXlDRSwyQkFDVSxjQUErQixFQUMvQixPQUE4QixFQUM5QixZQUE0QixFQUM1QixRQUFrQyxFQUNsQyxRQUFrQjtRQUpsQixtQkFBYyxHQUFkLGNBQWMsQ0FBaUI7UUFDL0IsWUFBTyxHQUFQLE9BQU8sQ0FBdUI7UUFDOUIsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVU7UUF2QzVCLFFBQUcsR0FBRyw4QkFBOEIsQ0FBQztRQUVyQyxZ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Qzs7Ozs7SUFDdEMseUNBQW9DOzs7OztJQUNwQyxxQ0FBMEM7Ozs7O0lBQzFDLHFDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBIb3N0QmluZGluZywgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBWYWxpZGF0b3JzLCBGb3JtQnVpbGRlciwgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgRWRpdG9yVHlwZXMgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkLWVkaXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBFbnVtSXRlbSB9IGZyb20gJy4uL2VudGl0eS9kaW1lbnNpb25kZWYuZW50aXR5JztcclxuaW1wb3J0IHsgV0ZEaW1lbnNpb25EZWZVSVN0YXRlIH0gZnJvbSAnLi4vc2VydmljZS93Zi1kaW1lbnNpb24tZGVmLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBHU1BDb21tb25Nb2RlbCwgR1NQQ29tbW9uRWxlbWVudCwgR1NQRWxlbWVudE9iamVjdFR5cGUgfSBmcm9tICdAZ3NwLWJlZi9nc3AtY20tbWV0YWRhdGEnO1xyXG5pbXBvcnQgeyBTZWxlY3RFbGVtZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vcmVmTW9kdWxlL3NlbGVjdC1lbGVtZW50L3NlbGVjdC1lbGVtZW50LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1lbnVtLWVkaXQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9lbnVtLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2VudW0tZWRpdC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEVudW1FZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZmFycmlzLW1haW4tYXJlYSBmbGV4LWNvbHVtbic7XHJcblxyXG4gIGNvbHVtbnMgPSBbXHJcbiAgICB7IGZpZWxkOiAna2V5Jywgd2lkdGg6IDEwMCwgdGl0bGU6ICfplK4nLCBlZGl0b3I6IHsgdHlwZTogRWRpdG9yVHlwZXMuVEVYVEJPWCwgb3B0aW9uczoge30gfSB9LFxyXG4gICAgeyBmaWVsZDogJ3ZhbHVlJywgd2lkdGg6IDEwMCwgdGl0bGU6ICflgLwnLCBlZGl0b3I6IHsgdHlwZTogRWRpdG9yVHlwZXMuVEVYVEJPWCwgb3B0aW9uczoge30gfSB9XTtcclxuICBAVmlld0NoaWxkKCdkZycpIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdidXR0b25zJykgYnRuUmVmOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICBjb25maXJtID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIGNsb3NlTW9kYWxFbWl0dGVyID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAvKipcclxuICAgKiDmmL7npLrlgLxcclxuICAgKi9cclxuICBlZGl0RGF0YSA9IG5ldyBBcnJheSgpO1xyXG5cclxuICBtYXhOdW0gPSAwO1xyXG5cclxuICAvKipcclxuICAgKiDlrp7pmYXlgLxcclxuICAgKi9cclxuICBnZXQgZW51bVZhbHVlcygpOiBFbnVtSXRlbVtdIHtcclxuICAgIGNvbnN0IGFyciA9IFtdO1xyXG4gICAgaWYgKHRoaXMuZWRpdERhdGEgJiYgdGhpcy5lZGl0RGF0YS5sZW5ndGggPj0gMCkge1xyXG4gICAgICB0aGlzLmVkaXREYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgY29uc3QgZW51bUl0ZW0gPSBuZXcgRW51bUl0ZW0oKTtcclxuICAgICAgICBlbnVtSXRlbS5rZXkgPSBpdGVtLmtleTtcclxuICAgICAgICBlbnVtSXRlbS52YWx1ZSA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgYXJyLnB1c2goZW51bUl0ZW0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBhcnI7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbWVzc2FnZVNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgdWlzdGF0ZTogV0ZEaW1lbnNpb25EZWZVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IEJzTW9kYWxTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yqg6L295pi+56S65pWw5o2uXHJcbiAgICovXHJcbiAgbG9hZChlbnVtVmFsdWVzKSB7XHJcbiAgICB0aGlzLmVkaXREYXRhID0gWy4uLnRoaXMuY3JlYXRlRGF0YShlbnVtVmFsdWVzKV07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDnoa7orqRcclxuICAgKi9cclxuICBvbkNvbmZpcm0oKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsb3NlQ2VsbCgpO1xyXG4gICAgaWYgKHRoaXMuY2hlY2tCZWZvcmVTYXZlKCkpIHtcclxuICAgICAgdGhpcy5jb25maXJtLm5leHQodGhpcy5lbnVtVmFsdWVzKTtcclxuICAgICAgdGhpcy5jbG9zZU1vZGFsRW1pdHRlci5uZXh0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtohcclxuICAgKi9cclxuICBjYW5jZWwoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWxFbWl0dGVyLm5leHQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOS/neWtmOWJjeajgOafpVxyXG4gICAqL1xyXG4gIGNoZWNrQmVmb3JlU2F2ZSgpOiBib29sZWFuIHtcclxuICAgIC8vIOKRoCDnqbrvvIzliJnpgJrov4fvvJtcclxuICAgIGlmICghKHRoaXMuZW51bVZhbHVlcykgfHwgdGhpcy5lbnVtVmFsdWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLndhcm5pbmcoJ+ivt+a3u+WKoOaemuS4vuWAvOOAgicpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvLyDikaEg6Z2e56m677yM5YiZ5qCh6aqM5q+P5Liq55qE6ZSu5YC85piv5ZCm5Li656m677ybXHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5lbnVtVmFsdWVzKSB7XHJcbiAgICAgIGlmICghaXRlbS5rZXkgfHwgIWl0ZW0udmFsdWUpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLndhcm5pbmcoJ+aemuS4vueahFvplK5dW+WAvF3lnYfkuI3lhYHorrjkuLrnqbrjgIInKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOKRoiDlpJrkuo7kuIDkuKrvvIzntKLlvJXkuI3lhYHorrjph43lpI3vvJtcclxuICAgIGlmICh0aGlzLmVudW1WYWx1ZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZW51bVZhbHVlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IGNvZGUxID0gdGhpcy5lbnVtVmFsdWVzW2ldLnZhbHVlO1xyXG4gICAgICAgIGNvbnN0IG5hbWUxID0gdGhpcy5lbnVtVmFsdWVzW2ldLmtleTtcclxuICAgICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCB0aGlzLmVudW1WYWx1ZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgIGNvbnN0IGNvZGUyID0gdGhpcy5lbnVtVmFsdWVzW2pdLnZhbHVlO1xyXG4gICAgICAgICAgY29uc3QgbmFtZTIgPSB0aGlzLmVudW1WYWx1ZXNbal0ua2V5O1xyXG5cclxuICAgICAgICAgIGlmIChjb2RlMSA9PT0gY29kZTIpIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS53YXJuaW5nKGDmnprkuL7nmoRb57yW5Y+3XeS4jeWFgeiuuOmHjeWkje+8jOmHjeWkjee8luWPt+S4ulske2NvZGUxfV3jgIJgKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKG5hbWUxID09PSBuYW1lMikge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLndhcm5pbmcoYOaemuS4vueahFvlkI3np7Bd5LiN5YWB6K646YeN5aSN77yM6YeN5aSN5ZCN56ew5Li6WyR7bmFtZTF9XeOAgmApO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWPlua2iOe8lui+kVxyXG4gICAqL1xyXG4gIGNsb3NlQ2VsbCgpIHtcclxuICAgIHRoaXMuZGcuZW5kQ2VsbEVkaXQoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5byV5YWlXHJcbiAgICovXHJcbiAgaW1wb3J0KCkge1xyXG4gICAgaWYgKCF0aGlzLnVpc3RhdGUuYmVNZXRhRGF0YSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLmVycm9yKCfmnKrojrflj5bliLBCReWFg+aVsOaNru+8jOivt+iBlOezu+euoeeQhuWRmOafpeeci+WOn+WboO+8gScpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBtb2RlbDogR1NQQ29tbW9uTW9kZWwgPSB0aGlzLnVpc3RhdGUuYmVNZXRhRGF0YS5jb250ZW50O1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNlbGVjdEVsZW1lbnRDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2VsZWN0RWxlSW5mby5iZSA9IG1vZGVsO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZWxlY3RFbGVJbmZvLnNpbmdsZUVsZW1lbnQgPSB0cnVlO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZWxlY3RFbGVJbmZvLmFzc29SZWZFbGVtZW50ID0gZmFsc2U7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNvbmZpcm0uc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnQgPSBkYXRhLnNlbGVjdGVkQmVGaWVsZHNbMF0gYXMgR1NQQ29tbW9uRWxlbWVudDtcclxuICAgICAgaWYgKHNlbGVjdGVkRWxlbWVudC5PYmplY3RUeXBlID09PSBHU1BFbGVtZW50T2JqZWN0VHlwZS5FbnVtKSB7XHJcbiAgICAgICAgdGhpcy5lZGl0RGF0YSA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIGxldCBrID0gMDtcclxuICAgICAgICBmb3IgKGNvbnN0IGVudW1WYWx1ZSBvZiBzZWxlY3RlZEVsZW1lbnQuQ29udGFpbkVudW1WYWx1ZXMpIHtcclxuICAgICAgICAgIHRoaXMuZWRpdERhdGEucHVzaCh7XHJcbiAgICAgICAgICAgIGlkOiBrLFxyXG4gICAgICAgICAgICBrZXk6IGVudW1WYWx1ZS5WYWx1ZSxcclxuICAgICAgICAgICAgdmFsdWU6IGVudW1WYWx1ZS5OYW1lLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBrKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubWF4TnVtID0gaztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLmluZm8oJ+mAieS4reWtl+auteW5tumdnuaemuS4vuWtl+aute+8jOivt+S6huino++8gScpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IG1vZGFsQ29uZmlnID0ge1xyXG4gICAgICB0aXRsZTogJ+aemuS4vuWtl+autemAieaLqScsXHJcbiAgICAgIHdpZHRoOiAxMDAwLFxyXG4gICAgICBoZWlnaHQ6IDU1MCxcclxuICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlXHJcbiAgICB9O1xyXG4gICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNsb3NlTW9kYWwuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOWinlxyXG4gICAqL1xyXG4gIGFkZCgpIHtcclxuICAgIHRoaXMuY2xvc2VDZWxsKCk7XHJcbiAgICBjb25zdCBuZXdJZCA9IHRoaXMubWF4TnVtO1xyXG4gICAgdGhpcy5lZGl0RGF0YSA9IHRoaXMuZWRpdERhdGEuY29uY2F0KFt7XHJcbiAgICAgIGlkOiBuZXdJZFxyXG4gICAgfV0pO1xyXG4gICAgdGhpcy5tYXhOdW0rKztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpFxyXG4gICAqL1xyXG4gIHJlbW92ZSgpIHtcclxuICAgIHRoaXMuY2xvc2VDZWxsKCk7XHJcbiAgICBpZiAodGhpcy5kZy5zZWxlY3RlZFJvdykge1xyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZGcuc2VsZWN0ZWRSb3cuaWQ7XHJcbiAgICAgIHRoaXMuZGcuc2VsZWN0UHJldlJvdygpO1xyXG4gICAgICB0aGlzLmVkaXREYXRhID0gdGhpcy5lZGl0RGF0YS5maWx0ZXIobiA9PiBuLmlkICE9PSBpZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjcmVhdGVEYXRhKGVudW1WYWx1ZXM6IEVudW1JdGVtW10pIHtcclxuICAgIGNvbnN0IGFyciA9IFtdO1xyXG4gICAgbGV0IGsgPSAwO1xyXG4gICAgZm9yIChjb25zdCBlbnVtVmFsdWUgb2YgZW51bVZhbHVlcykge1xyXG4gICAgICBhcnIucHVzaCh7XHJcbiAgICAgICAgaWQ6IGssXHJcbiAgICAgICAga2V5OiBlbnVtVmFsdWUua2V5LFxyXG4gICAgICAgIHZhbHVlOiBlbnVtVmFsdWUudmFsdWUsXHJcbiAgICAgIH0pO1xyXG4gICAgICBrKys7XHJcbiAgICB9XHJcbiAgICB0aGlzLm1heE51bSA9IGs7XHJcbiAgICByZXR1cm4gYXJyO1xyXG4gIH1cclxufVxyXG4iXX0=
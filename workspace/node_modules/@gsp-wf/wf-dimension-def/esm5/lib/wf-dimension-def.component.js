/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { DimenDefEntityUtil } from './entity/dimendef-entity.util';
import { ItemEditState, DimensionInputType } from './entity/dimensiondef.entity';
import { WFDimensionDefViewmodel } from './service/wf-dimension-def.viewModel';
import { NotifyService } from '@farris/ui-notify';
import { WFDimensionDefUIState } from './service/wf-dimension-def.uistate';
import { forkJoin } from 'rxjs/observable/forkJoin';
import { switchMap, catchError } from 'rxjs/operators';
import { of } from 'rxjs';
var WfDimensionDefComponent = /** @class */ (function () {
    function WfDimensionDefComponent(messageService, viewmodel, notifyService, uistate) {
        this.messageService = messageService;
        this.viewmodel = viewmodel;
        this.notifyService = notifyService;
        this.uistate = uistate;
        this.entry = 'flowForm';
        // tslint:disable-next-line: variable-name
        this._editable = false;
        this.data = new Array();
        this.editData = new Array();
    }
    Object.defineProperty(WfDimensionDefComponent.prototype, "flowFormId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._flowFormId;
        },
        set: /**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            this._flowFormId = id;
            this.load();
            this.getDimensionDefSet(this._flowFormId);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WfDimensionDefComponent.prototype, "schema", {
        get: /**
         * @return {?}
         */
        function () {
            return this.uistate.schema;
        },
        set: /**
         * @param {?} s
         * @return {?}
         */
        function (s) {
            this.uistate.schema = s;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WfDimensionDefComponent.prototype, "beMetaData", {
        get: /**
         * @return {?}
         */
        function () {
            return this.uistate.beMetaData;
        },
        set: /**
         * @param {?} m
         * @return {?}
         */
        function (m) {
            this.uistate.beMetaData = m;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WfDimensionDefComponent.prototype, "editable", {
        get: /**
         * @return {?}
         */
        function () {
            return this._editable;
        },
        set: /**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            var e_1, _a;
            this._editable = e;
            try {
                for (var _b = tslib_1.__values(this.editData), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var d = _c.value;
                    d.canEdit = this._editable;
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    WfDimensionDefComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    WfDimensionDefComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    WfDimensionDefComponent.prototype.load = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.flowFormId) {
            this.viewmodel.loadDimensionDefs(this.flowFormId).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                _this.data = re;
                _this.editData = [];
                if (_this.data && _this.data.length > 0) {
                    _this.data.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        _this.addItem(item, _this.editable);
                    }));
                }
            }));
        }
    };
    /**
     * @param {?} flowFormId
     * @return {?}
     */
    WfDimensionDefComponent.prototype.getDimensionDefSet = /**
     * @param {?} flowFormId
     * @return {?}
     */
    function (flowFormId) {
        var _this = this;
        if (flowFormId) {
            this.viewmodel.getDimensionDefSet(flowFormId).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                _this.dimensionDefSet = re;
            }));
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WfDimensionDefComponent.prototype.hasItem = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.index === index; }));
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WfDimensionDefComponent.prototype.getItem = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.hasItem(index) ? this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.index === index; })).itemData : null;
    };
    /**
     * @param {?} index
     * @param {?} itemData
     * @return {?}
     */
    WfDimensionDefComponent.prototype.setItem = /**
     * @param {?} index
     * @param {?} itemData
     * @return {?}
     */
    function (index, itemData) {
        this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.index === index; })).itemData = itemData;
    };
    /**
     * @param {?} itemData
     * @param {?} canEdit
     * @return {?}
     */
    WfDimensionDefComponent.prototype.addItem = /**
     * @param {?} itemData
     * @param {?} canEdit
     * @return {?}
     */
    function (itemData, canEdit) {
        /** @type {?} */
        var editDataItem = new ItemEditState();
        editDataItem.canEdit = canEdit;
        editDataItem.index = this.editData.length;
        editDataItem.itemData = Object.assign({}, itemData);
        editDataItem.id = itemData.id;
        this.editData.push(editDataItem);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WfDimensionDefComponent.prototype.getTitle = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var suffix = '';
        switch (index) {
            case 0:
                suffix = '一';
                break;
            case 1:
                suffix = '二';
                break;
        }
        return "\u7EF4\u5EA6" + suffix;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WfDimensionDefComponent.prototype.getState = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (!this.hasItem(index)) {
            return false;
        }
        /** @type {?} */
        var sysInit = this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.index === index; })).itemData.sysInit;
        return sysInit === 1 ? true : false;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WfDimensionDefComponent.prototype.isEditState = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (!this.hasItem(index)) {
            return false;
        }
        return this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.index === index; })).canEdit;
    };
    /**
     * @param {?} item
     * @return {?}
     */
    WfDimensionDefComponent.prototype.edit = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.editData.find((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.id === item.id; })).canEdit = true;
    };
    /**
     * @param {?} item
     * @return {?}
     */
    WfDimensionDefComponent.prototype.remove = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var _this = this;
        if (this.dimensionDefSet && (item.id === this.dimensionDefSet.dimension1 || item.id === this.dimensionDefSet.dimension2)) {
            this.messageService.info('当前维度定义已在流程分配维度配置中启用');
            return;
        }
        if (this.entry === 'flowForm') {
            this.removeDimensionDef(item);
            // const i = this.data.findIndex(d => d.id === item.id);
            // if (i > -1) {
            //   this.data.splice(i, 1);
            // }
        }
        else {
            this.messageService.question("\u786E\u8BA4\u5220\u9664'" + this.getTitle(item.index) + "'\u5417\uFF1F", (/**
             * @return {?}
             */
            function () {
                if (_this.data.findIndex((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) { return d.id === item.id; })) === -1) {
                    _this.removeDimensionDef(item);
                    _this.notifyService.success('删除成功');
                    return;
                }
                _this.viewmodel.removeDimensionDef(item.id).subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                function (re) {
                    _this.removeDimensionDef(item);
                    /** @type {?} */
                    var i = _this.data.findIndex((/**
                     * @param {?} d
                     * @return {?}
                     */
                    function (d) { return d.id === item.id; }));
                    if (i > -1) {
                        _this.data.splice(i, 1);
                    }
                    _this.notifyService.success('删除成功');
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                function (err) {
                    _this.notifyService.error('删除失败，请联系管理员查看原因！');
                }));
            }));
        }
    };
    /**
     * @return {?}
     */
    WfDimensionDefComponent.prototype.getDimensionDefs = /**
     * @return {?}
     */
    function () {
        return this.editData.map((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.itemData; }));
    };
    /**
     * @private
     * @param {?} item
     * @return {?}
     */
    WfDimensionDefComponent.prototype.removeDimensionDef = /**
     * @private
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var index = this.editData.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.id === item.id; }));
        if (index > -1) {
            this.editData.splice(index, 1);
        }
        if (index < this.editData.length) {
            for (var i = 0; i < this.editData.length; i++) {
                this.editData[i].index = i;
            }
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    WfDimensionDefComponent.prototype.save = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var _this = this;
        /** @type {?} */
        var v = this.validate(item.itemData);
        if (!v.result) {
            this.messageService.info(v.message);
            return;
        }
        if (this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.id === item.id; })) === -1) {
            this.viewmodel.addDimensionDef(item.itemData).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                _this.endEdit(item);
                _this.data.push(Object.assign({}, item.itemData));
                _this.notifyService.success('保存成功');
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.notifyService.error('保存失败，请联系管理员查看原因！');
            }));
        }
        else {
            this.viewmodel.updateDimensionDef(item.itemData).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                _this.endEdit(item);
                /** @type {?} */
                var data = _this.data.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                function (d) { return d.id === item.id; }));
                Object.assign(data, item.itemData);
                _this.notifyService.success('保存成功');
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.notifyService.error('保存失败，请联系管理员查看原因！');
            }));
        }
    };
    /**
     * @return {?}
     */
    WfDimensionDefComponent.prototype.saveAll = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var deleteDefs = this.data.filter((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return _this.editData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.id === d.id; })) === -1; }));
        /** @type {?} */
        var addDefs = this.editData.filter((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return _this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.id === e.id; })) === -1; })).map((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.itemData; }));
        /** @type {?} */
        var updateDefs = this.editData.filter((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return _this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.id === e.id; })) > -1; }))
            .map((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e.itemData; }))
            .filter((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.sysInit === 0; }));
        return forkJoin(deleteDefs.map((/**
         * @param {?} d
         * @return {?}
         */
        function (d) {
            return _this.viewmodel.removeDimensionDef(d.id);
        })).concat(updateDefs.map((/**
         * @param {?} u
         * @return {?}
         */
        function (u) {
            return _this.viewmodel.updateDimensionDef(u);
        })).concat(addDefs.map((/**
         * @param {?} a
         * @return {?}
         */
        function (a) {
            return _this.viewmodel.addDimensionDef(a);
        }))))).pipe(switchMap((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            _this.data = _this.editData.map((/**
             * @param {?} e
             * @return {?}
             */
            function (e) { return e.itemData; }));
            // this.editData.map(e => e.canEdit = false);
            return of(true);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.error(err);
            return of(false);
        })));
        //   .subscribe(re => {
        //   this.data = this.editData.map(e => e.itemData);
        //   this.editData.map(e => e.canEdit = false);
        // },
        // err => {
        //   this.notifyService.error('保存维度定义失败，请联系系统管理员查看原因！');
        // });
    };
    /**
     * @param {?} item
     * @return {?}
     */
    WfDimensionDefComponent.prototype.cancel = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.endEdit(item);
        if (this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d.id === item.id; })) === -1) {
            this.removeDimensionDef(item);
            return;
        }
        else {
            Object.assign(this.editData.find((/**
             * @param {?} d
             * @return {?}
             */
            function (d) {
                return d.id === item.id;
            })).itemData, this.data.find((/**
             * @param {?} d
             * @return {?}
             */
            function (d) { return d.id === item.id; })));
        }
    };
    /**
     * @return {?}
     */
    WfDimensionDefComponent.prototype.addHandler = /**
     * @return {?}
     */
    function () {
        if (this.entry === 'flowForm' && !this.editable) {
            return;
        }
        /** @type {?} */
        var info = DimenDefEntityUtil.newDimendefEntity(this.flowFormId);
        this.addItem(info, true);
    };
    /**
     * @param {?} index
     * @return {?}
     */
    WfDimensionDefComponent.prototype.isOtherItemEditting = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        var _this = this;
        /** @type {?} */
        var isOtherItemEditting = false;
        this.editData.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (item.canEdit === true && item.index !== index) {
                isOtherItemEditting = true;
                _this.messageService.info("\u8BF7\u5148\u4FDD\u5B58\u5BF9\u4E8E'" + _this.getTitle(item.index) + "'\u7684\u4FEE\u6539\u3002");
            }
        }));
        return isOtherItemEditting;
    };
    /**
     * @param {?} item
     * @return {?}
     */
    WfDimensionDefComponent.prototype.endEdit = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var e_2, _a;
        try {
            for (var _b = tslib_1.__values(this.editData), _c = _b.next(); !_c.done; _c = _b.next()) {
                var d = _c.value;
                if (d.id === item.id) {
                    d.canEdit = false;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    /**
     * @private
     * @param {?} d
     * @return {?}
     */
    WfDimensionDefComponent.prototype.validate = /**
     * @private
     * @param {?} d
     * @return {?}
     */
    function (d) {
        if (!d.code) {
            return { result: false, message: '维度定义不允许编号为空，请修改！' };
        }
        else if (!d.dimensionName) {
            return { result: false, message: '维度定义不允许维度名称为空，请修改！' };
        }
        else if (!d.dimensionCode) {
            return { result: false, message: '维度定义不允许分配维度为空，请修改！' };
        }
        else if (d.inputType === DimensionInputType.Help && !d.smartHelp) {
            return { result: false, message: '维度定义数据类型为帮助，但帮助值为空，请修改！' };
        }
        else if (d.inputType === DimensionInputType.Enum && !d.enumList) {
            return { result: false, message: '维度定义数据类型为枚举，但枚举值为空，请修改！' };
        }
        return { result: true, message: '' };
    };
    WfDimensionDefComponent.decorators = [
        { type: Component, args: [{
                    selector: 'wf-dimension-def',
                    template: "<wf-dimension-panel [model]=\"['b']\" [width]=\"'700px'\" [defaultExpand]=\"true\">\r\n    <div *ngFor=\"let item of editData; index as index;\"\r\n        style=\"width: 100%;border: 1px solid rgba(0, 0, 0, .125);margin-bottom: 25px;\">\r\n        <wf-dimension-panel-item [title]=\"getTitle(index)\" [sysInit]=\"getState(index)\" [value]=\"index\" [editState]=\"entry==='billCategory'?isEditState(index):false\">\r\n            <ng-template #contentTempl>\r\n                <wf-dimension-item-card [data]=\"getItem(index)\" [canCardEdit]=\"isEditState(index)\" [sysInit]=\"getState(index)\">\r\n                </wf-dimension-item-card>\r\n            </ng-template>\r\n            <ng-template #toolTempl>\r\n                <farris-button *ngIf=\"entry==='billCategory'\" [type]=\"'link'\" (click)=\"edit(item)\"><span class=\"f-icon text-info k-i-edit\"></span>\u4FEE\u6539\r\n                </farris-button>\r\n                <farris-button *ngIf=\"editable && !getState(index)\" [type]=\"'link'\" (click)=\"remove(item)\"><span\r\n                        class=\"f-icon text-info k-i-delete\"></span> \u5220\u9664\r\n                </farris-button>\r\n            </ng-template>\r\n            <ng-template #bottomRef>\r\n                <farris-button (click)=\"save(item)\">\u4FDD\u5B58</farris-button>\r\n                <farris-button style=\"margin-left:10px\" [type]=\"'secondary'\" (click)=\"cancel(item)\">\u53D6\u6D88</farris-button>\r\n            </ng-template>\r\n        </wf-dimension-panel-item>\r\n    </div>\r\n</wf-dimension-panel>\r\n<div *ngIf=\"hasItem(1)\" class=\"panel-ony-two\">\r\n    <div style=\"width: 250px;margin:0 auto\">\r\n        <p style=\"color:rgba(217,217,217)\">Tips:\u76EE\u524D\u4EC5\u652F\u6301\u6DFB\u52A0\u4E24\u4E2A\u7EF4\u5EA6</p>\r\n    </div>\r\n</div>\r\n<div *ngIf=\"!hasItem(1)\" class=\"panel-add\">\r\n    <div style=\"width: 100px;margin:0 auto\">\r\n        <farris-button style=\"margin:25px\" [type]=\"'link'\" [disabled]=\"entry==='flowForm'&&!editable\" (click)=\"addHandler()\">\r\n            <span *ngIf=\"!(entry==='flowForm'&&!editable)\" class=\"f-icon text-info k-i-plus\"></span>\u6DFB\u52A0\u7EF4\u5EA6</farris-button>\r\n    </div>\r\n</div>",
                    styles: [".panel-add{margin:25px;padding:10px;border:1px dashed rgba(0,0,0,.125)}.panel-ony-two{margin:20px}"]
                }] }
    ];
    /** @nocollapse */
    WfDimensionDefComponent.ctorParameters = function () { return [
        { type: MessagerService },
        { type: WFDimensionDefViewmodel },
        { type: NotifyService },
        { type: WFDimensionDefUIState }
    ]; };
    WfDimensionDefComponent.propDecorators = {
        flowFormId: [{ type: Input }],
        schema: [{ type: Input }],
        beMetaData: [{ type: Input }],
        entry: [{ type: Input }],
        editable: [{ type: Input }]
    };
    return WfDimensionDefComponent;
}());
export { WfDimensionDefComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype._flowFormId;
    /** @type {?} */
    WfDimensionDefComponent.prototype.entry;
    /** @type {?} */
    WfDimensionDefComponent.prototype._editable;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.data;
    /** @type {?} */
    WfDimensionDefComponent.prototype.editData;
    /** @type {?} */
    WfDimensionDefComponent.prototype.dimensionDefSet;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.messageService;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.viewmodel;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.uistate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtZGltZW5zaW9uLWRlZi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLWRpbWVuc2lvbi1kZWYvIiwic291cmNlcyI6WyJsaWIvd2YtZGltZW5zaW9uLWRlZi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFvQyxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ25FLE9BQU8sRUFBc0IsYUFBYSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDckcsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxFQUFFLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFFdEM7SUF3REUsaUNBQ1UsY0FBK0IsRUFDL0IsU0FBa0MsRUFDbEMsYUFBNEIsRUFDNUIsT0FBOEI7UUFIOUIsbUJBQWMsR0FBZCxjQUFjLENBQWlCO1FBQy9CLGNBQVMsR0FBVCxTQUFTLENBQXlCO1FBQ2xDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLFlBQU8sR0FBUCxPQUFPLENBQXVCO1FBeEJ4QyxVQUFLLEdBQWdDLFVBQVUsQ0FBQzs7UUFHaEQsY0FBUyxHQUFHLEtBQUssQ0FBQztRQVlWLFNBQUksR0FBRyxJQUFJLEtBQUssRUFBc0IsQ0FBQztR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Ozs7O0lBQzFDLGdEQUFvQzs7Ozs7SUFDcEMsMENBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IERpbWVuRGVmRW50aXR5VXRpbCB9IGZyb20gJy4vZW50aXR5L2RpbWVuZGVmLWVudGl0eS51dGlsJztcclxuaW1wb3J0IHsgRGltZW5zaW9uRGVmRW50aXR5LCBJdGVtRWRpdFN0YXRlLCBEaW1lbnNpb25JbnB1dFR5cGUgfSBmcm9tICcuL2VudGl0eS9kaW1lbnNpb25kZWYuZW50aXR5JztcclxuaW1wb3J0IHsgV0ZEaW1lbnNpb25EZWZWaWV3bW9kZWwgfSBmcm9tICcuL3NlcnZpY2Uvd2YtZGltZW5zaW9uLWRlZi52aWV3TW9kZWwnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBXRkRpbWVuc2lvbkRlZlVJU3RhdGUgfSBmcm9tICcuL3NlcnZpY2Uvd2YtZGltZW5zaW9uLWRlZi51aXN0YXRlJztcclxuaW1wb3J0IHsgZm9ya0pvaW4gfSBmcm9tICdyeGpzL29ic2VydmFibGUvZm9ya0pvaW4nO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dmLWRpbWVuc2lvbi1kZWYnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi93Zi1kaW1lbnNpb24tZGVmLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi93Zi1kaW1lbnNpb24tZGVmLmNvbXBvbmVudC5jc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIFdmRGltZW5zaW9uRGVmQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICBwcml2YXRlIF9mbG93Rm9ybUlkOiBzdHJpbmc7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IGZsb3dGb3JtSWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZmxvd0Zvcm1JZDtcclxuICB9XHJcbiAgc2V0IGZsb3dGb3JtSWQoaWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5fZmxvd0Zvcm1JZCA9IGlkO1xyXG4gICAgdGhpcy5sb2FkKCk7XHJcbiAgICB0aGlzLmdldERpbWVuc2lvbkRlZlNldCh0aGlzLl9mbG93Rm9ybUlkKTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHNjaGVtYShzOiBhbnkpIHtcclxuICAgIHRoaXMudWlzdGF0ZS5zY2hlbWEgPSBzO1xyXG4gIH1cclxuICBnZXQgc2NoZW1hKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudWlzdGF0ZS5zY2hlbWE7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCBiZU1ldGFEYXRhKG06IGFueSkge1xyXG4gICAgdGhpcy51aXN0YXRlLmJlTWV0YURhdGEgPSBtO1xyXG4gIH1cclxuICBnZXQgYmVNZXRhRGF0YSgpIHtcclxuICAgIHJldHVybiB0aGlzLnVpc3RhdGUuYmVNZXRhRGF0YTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZW50cnk6ICdmbG93Rm9ybScgfCAnYmlsbENhdGVnb3J5JyA9ICdmbG93Rm9ybSc7XHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdmFyaWFibGUtbmFtZVxyXG4gIF9lZGl0YWJsZSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IGVkaXRhYmxlKGU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX2VkaXRhYmxlID0gZTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLmVkaXREYXRhKSB7XHJcbiAgICAgIGQuY2FuRWRpdCA9IHRoaXMuX2VkaXRhYmxlO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgZWRpdGFibGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZWRpdGFibGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRhdGEgPSBuZXcgQXJyYXk8RGltZW5zaW9uRGVmRW50aXR5PigpO1xyXG4gIGVkaXREYXRhID0gbmV3IEFycmF5PEl0ZW1FZGl0U3RhdGU+KCk7XHJcblxyXG4gIGRpbWVuc2lvbkRlZlNldDogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbWVzc2FnZVNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgdmlld21vZGVsOiBXRkRpbWVuc2lvbkRlZlZpZXdtb2RlbCxcclxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgdWlzdGF0ZTogV0ZEaW1lbnNpb25EZWZVSVN0YXRlXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuXHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgaWYgKHRoaXMuZmxvd0Zvcm1JZCkge1xyXG4gICAgICB0aGlzLnZpZXdtb2RlbC5sb2FkRGltZW5zaW9uRGVmcyh0aGlzLmZsb3dGb3JtSWQpLnN1YnNjcmliZSgocmU6IEFycmF5PERpbWVuc2lvbkRlZkVudGl0eT4pID0+IHtcclxuICAgICAgICB0aGlzLmRhdGEgPSByZTtcclxuICAgICAgICB0aGlzLmVkaXREYXRhID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5kYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkSXRlbShpdGVtLCB0aGlzLmVkaXRhYmxlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXREaW1lbnNpb25EZWZTZXQoZmxvd0Zvcm1JZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoZmxvd0Zvcm1JZCkge1xyXG4gICAgICB0aGlzLnZpZXdtb2RlbC5nZXREaW1lbnNpb25EZWZTZXQoZmxvd0Zvcm1JZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHRoaXMuZGltZW5zaW9uRGVmU2V0ID0gcmU7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFzSXRlbShpbmRleDogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lZGl0RGF0YS5maW5kKGl0ZW0gPT4gaXRlbS5pbmRleCA9PT0gaW5kZXgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SXRlbShpbmRleDogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5oYXNJdGVtKGluZGV4KSA/IHRoaXMuZWRpdERhdGEuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KS5pdGVtRGF0YSA6IG51bGw7XHJcbiAgfVxyXG5cclxuXHJcbiAgc2V0SXRlbShpbmRleDogbnVtYmVyLCBpdGVtRGF0YTogYW55KSB7XHJcbiAgICB0aGlzLmVkaXREYXRhLmZpbmQoaXRlbSA9PiBpdGVtLmluZGV4ID09PSBpbmRleCkuaXRlbURhdGEgPSBpdGVtRGF0YTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oaXRlbURhdGE6IERpbWVuc2lvbkRlZkVudGl0eSwgY2FuRWRpdDogYm9vbGVhbikge1xyXG4gICAgY29uc3QgZWRpdERhdGFJdGVtID0gbmV3IEl0ZW1FZGl0U3RhdGUoKTtcclxuICAgIGVkaXREYXRhSXRlbS5jYW5FZGl0ID0gY2FuRWRpdDtcclxuICAgIGVkaXREYXRhSXRlbS5pbmRleCA9IHRoaXMuZWRpdERhdGEubGVuZ3RoO1xyXG4gICAgZWRpdERhdGFJdGVtLml0ZW1EYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbURhdGEpO1xyXG4gICAgZWRpdERhdGFJdGVtLmlkID0gaXRlbURhdGEuaWQ7XHJcbiAgICB0aGlzLmVkaXREYXRhLnB1c2goZWRpdERhdGFJdGVtKTtcclxuICB9XHJcblxyXG4gIGdldFRpdGxlKGluZGV4OiBudW1iZXIpIHtcclxuICAgIGxldCBzdWZmaXggPSAnJztcclxuICAgIHN3aXRjaCAoaW5kZXgpIHtcclxuICAgICAgY2FzZSAwOlxyXG4gICAgICAgIHN1ZmZpeCA9ICfkuIAnO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIDE6XHJcbiAgICAgICAgc3VmZml4ID0gJ+S6jCc7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYOe7tOW6piR7c3VmZml4fWA7XHJcbiAgfVxyXG5cclxuICBnZXRTdGF0ZShpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuaGFzSXRlbShpbmRleCkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc3lzSW5pdCA9IHRoaXMuZWRpdERhdGEuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KS5pdGVtRGF0YS5zeXNJbml0O1xyXG4gICAgcmV0dXJuIHN5c0luaXQgPT09IDEgPyB0cnVlIDogZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpc0VkaXRTdGF0ZShpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuaGFzSXRlbShpbmRleCkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZWRpdERhdGEuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KS5jYW5FZGl0O1xyXG4gIH1cclxuXHJcbiAgZWRpdChpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICB0aGlzLmVkaXREYXRhLmZpbmQoZCA9PiBkLmlkID09PSBpdGVtLmlkKS5jYW5FZGl0ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHJlbW92ZShpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICBpZiAodGhpcy5kaW1lbnNpb25EZWZTZXQgJiYgKGl0ZW0uaWQgPT09IHRoaXMuZGltZW5zaW9uRGVmU2V0LmRpbWVuc2lvbjEgfHwgaXRlbS5pZCA9PT0gdGhpcy5kaW1lbnNpb25EZWZTZXQuZGltZW5zaW9uMikpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5pbmZvKCflvZPliY3nu7TluqblrprkuYnlt7LlnKjmtYHnqIvliIbphY3nu7TluqbphY3nva7kuK3lkK/nlKgnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZW50cnkgPT09ICdmbG93Rm9ybScpIHtcclxuICAgICAgdGhpcy5yZW1vdmVEaW1lbnNpb25EZWYoaXRlbSk7XHJcbiAgICAgIC8vIGNvbnN0IGkgPSB0aGlzLmRhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gaXRlbS5pZCk7XHJcbiAgICAgIC8vIGlmIChpID4gLTEpIHtcclxuICAgICAgLy8gICB0aGlzLmRhdGEuc3BsaWNlKGksIDEpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLnF1ZXN0aW9uKGDnoa7orqTliKDpmaQnJHt0aGlzLmdldFRpdGxlKGl0ZW0uaW5kZXgpfSflkJfvvJ9gLCAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5maW5kSW5kZXgoZCA9PiBkLmlkID09PSBpdGVtLmlkKSA9PT0gLTEpIHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRGltZW5zaW9uRGVmKGl0ZW0pO1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ+WIoOmZpOaIkOWKnycpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZpZXdtb2RlbC5yZW1vdmVEaW1lbnNpb25EZWYoaXRlbS5pZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRGltZW5zaW9uRGVmKGl0ZW0pO1xyXG4gICAgICAgICAgY29uc3QgaSA9IHRoaXMuZGF0YS5maW5kSW5kZXgoZCA9PiBkLmlkID09PSBpdGVtLmlkKTtcclxuICAgICAgICAgIGlmIChpID4gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5zdWNjZXNzKCfliKDpmaTmiJDlip8nKTtcclxuICAgICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKCfliKDpmaTlpLHotKXvvIzor7fogZTns7vnrqHnkIblkZjmn6XnnIvljp/lm6DvvIEnKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXREaW1lbnNpb25EZWZzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZWRpdERhdGEubWFwKGQgPT4gZC5pdGVtRGF0YSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbW92ZURpbWVuc2lvbkRlZihpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZWRpdERhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gaXRlbS5pZCk7XHJcbiAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICB0aGlzLmVkaXREYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbiAgICBpZiAoaW5kZXggPCB0aGlzLmVkaXREYXRhLmxlbmd0aCkge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZWRpdERhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB0aGlzLmVkaXREYXRhW2ldLmluZGV4ID0gaTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2F2ZShpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICBjb25zdCB2ID0gdGhpcy52YWxpZGF0ZShpdGVtLml0ZW1EYXRhKTtcclxuICAgIGlmICghdi5yZXN1bHQpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5pbmZvKHYubWVzc2FnZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gaXRlbS5pZCkgPT09IC0xKSB7XHJcbiAgICAgIHRoaXMudmlld21vZGVsLmFkZERpbWVuc2lvbkRlZihpdGVtLml0ZW1EYXRhKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgIHRoaXMuZW5kRWRpdChpdGVtKTtcclxuICAgICAgICB0aGlzLmRhdGEucHVzaChPYmplY3QuYXNzaWduKHt9LCBpdGVtLml0ZW1EYXRhKSk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcign5L+d5a2Y5aSx6LSl77yM6K+36IGU57O7566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy52aWV3bW9kZWwudXBkYXRlRGltZW5zaW9uRGVmKGl0ZW0uaXRlbURhdGEpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgdGhpcy5lbmRFZGl0KGl0ZW0pO1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGEuZmluZChkID0+IGQuaWQgPT09IGl0ZW0uaWQpO1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgaXRlbS5pdGVtRGF0YSk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcign5L+d5a2Y5aSx6LSl77yM6K+36IGU57O7566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2F2ZUFsbCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IGRlbGV0ZURlZnMgPSB0aGlzLmRhdGEuZmlsdGVyKGQgPT4gdGhpcy5lZGl0RGF0YS5maW5kSW5kZXgoZSA9PiBlLmlkID09PSBkLmlkKSA9PT0gLTEpO1xyXG4gICAgY29uc3QgYWRkRGVmcyA9IHRoaXMuZWRpdERhdGEuZmlsdGVyKGUgPT4gdGhpcy5kYXRhLmZpbmRJbmRleChkID0+IGQuaWQgPT09IGUuaWQpID09PSAtMSkubWFwKGUgPT4gZS5pdGVtRGF0YSk7XHJcbiAgICBjb25zdCB1cGRhdGVEZWZzID0gdGhpcy5lZGl0RGF0YS5maWx0ZXIoZSA9PiB0aGlzLmRhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gZS5pZCkgPiAtMSlcclxuICAgICAgLm1hcChlID0+IGUuaXRlbURhdGEpXHJcbiAgICAgIC5maWx0ZXIoZCA9PiBkLnN5c0luaXQgPT09IDApO1xyXG4gICAgcmV0dXJuIGZvcmtKb2luKGRlbGV0ZURlZnMubWFwKGQgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy52aWV3bW9kZWwucmVtb3ZlRGltZW5zaW9uRGVmKGQuaWQpO1xyXG4gICAgfSkuY29uY2F0KHVwZGF0ZURlZnMubWFwKHUgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy52aWV3bW9kZWwudXBkYXRlRGltZW5zaW9uRGVmKHUpO1xyXG4gICAgfSkuY29uY2F0KGFkZERlZnMubWFwKGEgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy52aWV3bW9kZWwuYWRkRGltZW5zaW9uRGVmKGEpO1xyXG4gICAgfSkpKSkucGlwZShcclxuICAgICAgc3dpdGNoTWFwKHJlID0+IHtcclxuICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmVkaXREYXRhLm1hcChlID0+IGUuaXRlbURhdGEpO1xyXG4gICAgICAgIC8vIHRoaXMuZWRpdERhdGEubWFwKGUgPT4gZS5jYW5FZGl0ID0gZmFsc2UpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICAvLyAgIC5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgLy8gICB0aGlzLmRhdGEgPSB0aGlzLmVkaXREYXRhLm1hcChlID0+IGUuaXRlbURhdGEpO1xyXG4gICAgLy8gICB0aGlzLmVkaXREYXRhLm1hcChlID0+IGUuY2FuRWRpdCA9IGZhbHNlKTtcclxuICAgIC8vIH0sXHJcbiAgICAvLyBlcnIgPT4ge1xyXG4gICAgLy8gICB0aGlzLm5vdGlmeVNlcnZpY2UuZXJyb3IoJ+S/neWtmOe7tOW6puWumuS5ieWksei0pe+8jOivt+iBlOezu+ezu+e7n+euoeeQhuWRmOafpeeci+WOn+WboO+8gScpO1xyXG4gICAgLy8gfSk7XHJcbiAgfVxyXG5cclxuICBjYW5jZWwoaXRlbTogSXRlbUVkaXRTdGF0ZSkge1xyXG4gICAgdGhpcy5lbmRFZGl0KGl0ZW0pO1xyXG4gICAgaWYgKHRoaXMuZGF0YS5maW5kSW5kZXgoZCA9PiBkLmlkID09PSBpdGVtLmlkKSA9PT0gLTEpIHtcclxuICAgICAgdGhpcy5yZW1vdmVEaW1lbnNpb25EZWYoaXRlbSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5lZGl0RGF0YS5maW5kKGQgPT5cclxuICAgICAgICBkLmlkID09PSBpdGVtLmlkKS5pdGVtRGF0YSwgdGhpcy5kYXRhLmZpbmQoZCA9PiBkLmlkID09PSBpdGVtLmlkKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhZGRIYW5kbGVyKCkge1xyXG4gICAgaWYgKHRoaXMuZW50cnkgPT09ICdmbG93Rm9ybScgJiYgIXRoaXMuZWRpdGFibGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaW5mbyA9IERpbWVuRGVmRW50aXR5VXRpbC5uZXdEaW1lbmRlZkVudGl0eSh0aGlzLmZsb3dGb3JtSWQpO1xyXG4gICAgdGhpcy5hZGRJdGVtKGluZm8sIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgaXNPdGhlckl0ZW1FZGl0dGluZyhpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNPdGhlckl0ZW1FZGl0dGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5lZGl0RGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpZiAoaXRlbS5jYW5FZGl0ID09PSB0cnVlICYmIGl0ZW0uaW5kZXggIT09IGluZGV4KSB7XHJcbiAgICAgICAgaXNPdGhlckl0ZW1FZGl0dGluZyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5pbmZvKGDor7flhYjkv53lrZjlr7nkuo4nJHt0aGlzLmdldFRpdGxlKGl0ZW0uaW5kZXgpfSfnmoTkv67mlLnjgIJgKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaXNPdGhlckl0ZW1FZGl0dGluZztcclxuICB9XHJcblxyXG4gIGVuZEVkaXQoaXRlbTogSXRlbUVkaXRTdGF0ZSkge1xyXG4gICAgZm9yIChjb25zdCBkIG9mIHRoaXMuZWRpdERhdGEpIHtcclxuICAgICAgaWYgKGQuaWQgPT09IGl0ZW0uaWQpIHtcclxuICAgICAgICBkLmNhbkVkaXQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHZhbGlkYXRlKGQ6IERpbWVuc2lvbkRlZkVudGl0eSkge1xyXG4gICAgaWYgKCFkLmNvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgcmVzdWx0OiBmYWxzZSwgbWVzc2FnZTogJ+e7tOW6puWumuS5ieS4jeWFgeiuuOe8luWPt+S4uuepuu+8jOivt+S/ruaUue+8gScgfTtcclxuICAgIH0gZWxzZSBpZiAoIWQuZGltZW5zaW9uTmFtZSkge1xyXG4gICAgICByZXR1cm4geyByZXN1bHQ6IGZhbHNlLCBtZXNzYWdlOiAn57u05bqm5a6a5LmJ5LiN5YWB6K6457u05bqm5ZCN56ew5Li656m677yM6K+35L+u5pS577yBJyB9O1xyXG4gICAgfSBlbHNlIGlmICghZC5kaW1lbnNpb25Db2RlKSB7XHJcbiAgICAgIHJldHVybiB7IHJlc3VsdDogZmFsc2UsIG1lc3NhZ2U6ICfnu7TluqblrprkuYnkuI3lhYHorrjliIbphY3nu7TluqbkuLrnqbrvvIzor7fkv67mlLnvvIEnIH07XHJcbiAgICB9IGVsc2UgaWYgKGQuaW5wdXRUeXBlID09PSBEaW1lbnNpb25JbnB1dFR5cGUuSGVscCAmJiAhZC5zbWFydEhlbHApIHtcclxuICAgICAgcmV0dXJuIHsgcmVzdWx0OiBmYWxzZSwgbWVzc2FnZTogJ+e7tOW6puWumuS5ieaVsOaNruexu+Wei+S4uuW4ruWKqe+8jOS9huW4ruWKqeWAvOS4uuepuu+8jOivt+S/ruaUue+8gScgfTtcclxuICAgIH0gZWxzZSBpZiAoZC5pbnB1dFR5cGUgPT09IERpbWVuc2lvbklucHV0VHlwZS5FbnVtICYmICFkLmVudW1MaXN0KSB7XHJcbiAgICAgIHJldHVybiB7IHJlc3VsdDogZmFsc2UsIG1lc3NhZ2U6ICfnu7TluqblrprkuYnmlbDmja7nsbvlnovkuLrmnprkuL7vvIzkvYbmnprkuL7lgLzkuLrnqbrvvIzor7fkv67mlLnvvIEnIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyByZXN1bHQ6IHRydWUsIG1lc3NhZ2U6ICcnIH07XHJcbiAgfVxyXG59XHJcbiJdfQ==
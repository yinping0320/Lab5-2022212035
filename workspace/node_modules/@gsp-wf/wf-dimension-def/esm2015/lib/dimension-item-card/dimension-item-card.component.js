/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, Injector, EventEmitter, Input } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { DimensionDefEntity, WFDimensionTypes, WFDimensionInputTypes, DimensionInputType } from '../entity/dimensiondef.entity';
import { WFDimensionDefUIState } from '../service/wf-dimension-def.uistate';
import { ExpressionService, InjectedType } from '@gsp-svc/expression';
import { EnumEditComponent } from '../enum-edit/enum-edit.component';
import { LookupConfigService } from '@farris/lookup-config';
export class DimensionItemCardComponent {
    /**
     * @param {?} modalService
     * @param {?} resolver
     * @param {?} injector
     * @param {?} messageService
     * @param {?} uistate
     * @param {?} exprService
     * @param {?} configService
     */
    constructor(modalService, resolver, injector, messageService, uistate, exprService, configService) {
        this.modalService = modalService;
        this.resolver = resolver;
        this.injector = injector;
        this.messageService = messageService;
        this.uistate = uistate;
        this.exprService = exprService;
        this.configService = configService;
        this.sysInit = false;
        this.canEdit = false;
        /**
         * 维度种类
         */
        this.dimensionTypes = WFDimensionTypes;
        this.inputTypes = WFDimensionInputTypes;
        this.selectedBEMetadata = new EventEmitter();
        this.selectedHelpMetadata = new EventEmitter();
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.enumListText = (/**
         * @return {?}
         */
        () => {
            if (!this.getIsEnumInput()) {
                return '';
            }
            /** @type {?} */
            let display = '';
            if (this.data.enumList) {
                /** @type {?} */
                const enumList = JSON.parse(this.data.enumList);
                if (enumList.length > 0) {
                    enumList.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => {
                        display = display.concat(`${item.key}:${item.value}; `);
                    }));
                }
            }
            return display;
        });
        this.configService.getLookupData().subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            console.log(data);
            this.data.smartHelp = data;
        }));
    }
    /**
     * @return {?}
     */
    get dimensionItemCode() {
        return this.data ? this.data.code : '';
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set dimensionItemCode(value) {
        this.data.code = value;
    }
    /**
     * @return {?}
     */
    get dimensionItemName() {
        return this.data ? this.data.dimensionName : '';
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set dimensionItemName(value) {
        this.data.dimensionName = value;
    }
    /**
     * @return {?}
     */
    get dimensionCode() {
        return this.data ? this.data.dimensionCode : '';
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set dimensionCode(v) {
        this.data.dimensionCode = v;
    }
    /**
     * @return {?}
     */
    get inputType() {
        return this.data ? this.data.inputType : null;
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set inputType(v) {
        this.data.inputType = v;
    }
    /**
     * @return {?}
     */
    get dimensionType() {
        return this.data ? this.data.dimensionType : null;
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set dimensionType(v) {
        this.data.dimensionType = v;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.canEdit = this.canCardEdit;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.canCardEdit) {
            this.canEdit = this.canCardEdit;
        }
    }
    /**
     * 维度类型
     * @param {?} data
     * @return {?}
     */
    selectDimensionType(data) {
    }
    /**
     * 维度选择1-be字段
     * @return {?}
     */
    selectBEMeta() {
        if (this.uistate.schema) {
            this.exprService.clearInjectedEntity();
            this.exprService.addSchema('Schema', this.uistate.schema);
            if (this.uistate.schema.entityTypes && this.uistate.schema.entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.uistate.schema.entityTypes[0];
                this.exprService.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        // if (this.dimensionCode) {                                 // 编辑器加载初始值
        //   try {
        this.exprService.addExpressionText(this.dimensionCode);
        // } catch (error) {
        //   console.log('parse expression error:' + this.dimensionCode);
        // }
        // }
        this.exprService.buildExpression().then((/**
         * @param {?} d
         * @return {?}
         */
        (d) => {
            if (d) {
                this.dimensionCode = d;
            }
        }));
    }
    /**
     * 输入类型
     * @param {?} data
     * @return {?}
     */
    selectInputType(data) {
        this.data.inputType = data.data.value;
    }
    /**
     * 是否枚举输入
     * @return {?}
     */
    getIsEnumInput() {
        return this.data && this.data.inputType === DimensionInputType.Enum;
    }
    /**
     * 是否帮助输入
     * @return {?}
     */
    getIsSmartHelpInput() {
        return this.data && this.data.inputType === DimensionInputType.Help;
    }
    /**
     * 枚举显示值
     * @return {?}
     */
    getEnumInputDisplay() {
        // if (!this.getIsEnumInput()) {
        //   return '';
        // }
        // const enumInputInfo = this.data.inputInfo as EnumInputInfo;
        // let display = '';
        // if (!enumInputInfo || !enumInputInfo.enumItems) {
        //   return display;
        // }
        // enumInputInfo.enumItems.forEach(item => {
        //   display = display.concat(`${item.key}:${item.value}; `);
        // });
        // return display;
    }
    /**
     * 帮助名称
     * @return {?}
     */
    get helperName() {
        if (!this.getIsSmartHelpInput()) {
            return '';
        }
        return this.data.smartHelp;
    }
    /**
     * 帮助选择
     * @return {?}
     */
    selectHelpMeta() {
        this.lookupConfig = this.configService.showConfig({
            configId: this.data.smartHelp
        });
        // const compFactory =
        //   this.resolver.resolveComponentFactory(SelectMetadataRTComponent);
        // const compRef = compFactory.create(this.injector);
        // compRef.instance.typeList = 'HelpMetadata';
        // compRef.instance.selectedMetadata
        //   .subscribe(($event: Metadata4RefDto) => {
        //     const meta: MetadataDto = $event.metadata;
        //     const help = JSON.parse(meta.content);
        //     this.data.smartHelp = help.id;
        //   });
        // const modalConfig = {
        //   title: '帮助选择',
        //   width: 930,
        //   height: 573,
        //   showButtons: false
        // };
        // const dialog = this.modalService.show(compRef, modalConfig);
        // compRef.instance.closeModalEmitter.subscribe($event => dialog.close());
    }
    /**
     * @return {?}
     */
    editEnumValues() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(EnumEditComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        /** @type {?} */
        const modalConfig = {
            title: '枚举设置',
            width: 650,
            height: 450,
            showButtons: true,
            buttons: compRef.instance.btnRef,
        };
        if (this.data.enumList) {
            compRef.instance.load(JSON.parse(this.data.enumList));
        }
        compRef.instance.confirm.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            this.data.enumList = JSON.stringify(re) ? JSON.stringify(re) : null;
        }));
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.closeModalEmitter.subscribe((/**
         * @return {?}
         */
        () => {
            dialog.close();
        }));
    }
}
DimensionItemCardComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf-dimension-item-card',
                template: "<div class=\"farris-form farris-form-controls-inline mt-3\">\r\n    <form class=\"f-section-formgroup\">\r\n        <div class=\"f-section-formgroup-inputs\">\r\n            <div class=\"col-12 row\">\r\n                <div class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u7EF4\u5EA6\u7F16\u53F7</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <input-group [(ngModel)]=\"dimensionItemCode\" name=\"code\" \r\n                            [disabled]=\"!canEdit\" [readonly]=\"sysInit\" [enableClear]=\"false\"></input-group>\r\n                            <!-- <input type=\"text\" class=\"form-control\" [(ngModel)]=\"dimensionItemCode\" name=\"code\"\r\n                                [disabled]=\"!canEdit\" [readOnly]=\"canEdit && sysInit\"> -->\r\n                            <div class=\"farris-feedback valid-feedback\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u7EF4\u5EA6\u7C7B\u578B</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <farris-combo-list [ngModel]=\"dimensionType\" [idField]=\"'value'\" [textField]=\"'text'\" \r\n                                [disabled]=\"!canEdit\" [enableClear]=\"false\" [readonly]=\"sysInit\"\r\n                                [data]=\"dimensionTypes\" name=\"dimensionType\" (selectChange)=\"selectDimensionType($event)\"></farris-combo-list>\r\n                            <div class=\"farris-feedback valid-feedback\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u5206\u914D\u7EF4\u5EA6</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <input-group class=\"form-control\" style=\"width: 100%;padding:0;border:0;\" [enableClear]=\"false\" \r\n                                [showButtonWhenDisabled]=\"false\" [disabled]=\"!canEdit\" [readonly]=\"sysInit\"\r\n                                [ngModel]=\"dimensionCode\" name=\"dimensionCode\"\r\n                                [editable]=\"false\" (clickHandle)=\"selectBEMeta()\" [groupText]=\"groupIcon\"></input-group>\r\n                            <div class=\"farris-feedback valid-feedback\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u7EF4\u5EA6\u540D\u79F0</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <input-group [(ngModel)]=\"dimensionItemName\" name=\"name\" \r\n                            [disabled]=\"!canEdit\" [readonly]=\"sysInit\" [enableClear]=\"false\"></input-group>\r\n                            <!-- <input type=\"text\" class=\"form-control\" [(ngModel)]=\"dimensionItemName\" name=\"name\" \r\n                            [disabled]=\"!canEdit\" [readOnly]=\"canEdit && sysInit\"> -->\r\n                            <div class=\"farris-feedback valid-feedback\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u6570\u636E\u7C7B\u578B</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <farris-combo-list [ngModel]=\"inputType\" [idField]=\"'value'\" [textField]=\"'text'\" [disabled]=\"!canEdit\" \r\n                                [data]=\"inputTypes\" [enableClear]=\"false\" [readonly]=\"sysInit\"\r\n                                (selectChange)=\"selectInputType($event)\" name=\"inputType\"></farris-combo-list>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div *ngIf=\"getIsEnumInput()\" class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u679A\u4E3E\u5217\u8868</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <input-group class=\"form-control\" style=\"width: 100%;padding:0;border:0;\" [enableClear]=\"false\"\r\n                                [showButtonWhenDisabled]=\"false\" [disabled]=\"!canEdit\" [value]=\"enumListText()\" [editable]=\"false\"\r\n                                (clickHandle)=\"editEnumValues()\" [groupText]=\"groupIcon\" [readonly]=\"sysInit\"></input-group>\r\n                            <div class=\"farris-feedback valid-feedback\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div *ngIf=\"getIsSmartHelpInput()\" class=\"farris-group-wrap col-4\">\r\n                    <div class=\"form-group farris-form-group\">\r\n                        <label class=\"col-form-label\">\r\n                            <span class=\"farris-label-info text-danger\">*</span>\r\n                            <span class=\"farris-label-text\">\u5E2E\u52A9\u9009\u62E9</span>\r\n                        </label>\r\n                        <div class=\"farris-input-wrap\">\r\n                            <input-group class=\"form-control\" style=\"width: 100%;padding:0;border:0;\" [enableClear]=\"false\" \r\n                                [showButtonWhenDisabled]=\"false\" [disabled]=\"!canEdit\"\r\n                                [value]=\"helperName\" [editable]=\"false\" (clickHandle)=\"selectHelpMeta()\"\r\n                                [groupText]=\"groupIcon\"></input-group>\r\n                            <div class=\"farris-feedback valid-feedback\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </form>\r\n</div>",
                providers: [LookupConfigService],
                styles: [""]
            }] }
];
/** @nocollapse */
DimensionItemCardComponent.ctorParameters = () => [
    { type: BsModalService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: MessagerService },
    { type: WFDimensionDefUIState },
    { type: ExpressionService },
    { type: LookupConfigService }
];
DimensionItemCardComponent.propDecorators = {
    data: [{ type: Input }],
    canCardEdit: [{ type: Input }],
    sysInit: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DimensionItemCardComponent.prototype.data;
    /** @type {?} */
    DimensionItemCardComponent.prototype.canCardEdit;
    /** @type {?} */
    DimensionItemCardComponent.prototype.sysInit;
    /** @type {?} */
    DimensionItemCardComponent.prototype.canEdit;
    /**
     * 维度种类
     * @type {?}
     */
    DimensionItemCardComponent.prototype.dimensionTypes;
    /** @type {?} */
    DimensionItemCardComponent.prototype.inputTypes;
    /** @type {?} */
    DimensionItemCardComponent.prototype.selectedBEMetadata;
    /** @type {?} */
    DimensionItemCardComponent.prototype.selectedHelpMetadata;
    /** @type {?} */
    DimensionItemCardComponent.prototype.groupIcon;
    /** @type {?} */
    DimensionItemCardComponent.prototype.lookupConfig;
    /** @type {?} */
    DimensionItemCardComponent.prototype.enumListText;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.messageService;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.exprService;
    /**
     * @type {?}
     * @private
     */
    DimensionItemCardComponent.prototype.configService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGltZW5zaW9uLWl0ZW0tY2FyZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLWRpbWVuc2lvbi1kZWYvIiwic291cmNlcyI6WyJsaWIvZGltZW5zaW9uLWl0ZW0tY2FyZC9kaW1lbnNpb24taXRlbS1jYXJkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSx3QkFBd0IsRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFDckksT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWxELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQWlCLHFCQUFxQixFQUFFLGtCQUFrQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0ksT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDNUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBUzVELE1BQU0sT0FBTywwQkFBMEI7Ozs7Ozs7Ozs7SUF5RHJDLFlBQ1UsWUFBNEIsRUFDNUIsUUFBa0MsRUFDbEMsUUFBa0IsRUFDbEIsY0FBK0IsRUFDL0IsT0FBOEIsRUFDOUIsV0FBOEIsRUFDOUIsYUFBa0M7UUFObEMsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsbUJBQWMsR0FBZCxjQUFjLENBQWlCO1FBQy9CLFlBQU8sR0FBUCxPQUFPLENBQXVCO1FB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QyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUN0RSxDQUFDLEVBQUMsQ0FBQzs7Y0FDRyxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQztRQUMzRCxPQUFPLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFNBQVM7OztRQUFDLEdBQUcsRUFBRTtZQUNoRCxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDakIsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7WUE5T0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSx3QkFBd0I7Z0JBQ2xDLGsrT0FBbUQ7Z0JBRW5ELFNBQVMsRUFBRSxDQUFDLG1CQUFtQixDQUFDOzthQUNqQzs7OztZQWhCUSxjQUFjO1lBREssd0JBQXdCO1lBQUUsUUFBUTtZQUdyRCxlQUFlO1lBR2YscUJBQXFCO1lBQ3JCLGlCQUFpQjtZQUVqQixtQkFBbUI7OzttQkFVekIsS0FBSzswQkFDTCxLQUFLO3NCQUNMLEtBQUs7Ozs7SUFGTiwwQ0FBa0M7O0lBQ2xDLGlEQUE4Qjs7SUFDOUIsNkNBQXlCOztJQUN6Qiw2Q0FBZ0I7Ozs7O0lBS2hCLG9EQUFrQzs7SUFDbEMsZ0RBQW1DOztJQUVuQyx3REFBMkQ7O0lBQzNELDBEQUE2RDs7SUFDN0QsK0NBQW1EOztJQUVuRCxrREFBa0I7O0lBdUpsQixrREFjQzs7Ozs7SUEzSEMsa0RBQW9DOzs7OztJQUNwQyw4Q0FBMEM7Ozs7O0lBQzFDLDhDQUEwQjs7Ozs7SUFDMUIsb0RBQXVDOzs7OztJQUN2Qyw2Q0FBc0M7Ozs7O0lBQ3RDLGlEQUFzQzs7Ozs7SUFDdEMsbURBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBTZWxlY3RNZXRhZGF0YVJUQ29tcG9uZW50LCBNZXRhZGF0YTRSZWZEdG8sIE1ldGFkYXRhRHRvIH0gZnJvbSAnQGdzcC1sY20vbWV0YWRhdGFydC1zZWxlY3Rvcic7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBHU1BDb21tb25Nb2RlbCwgR1NQQ29tbW9uT2JqZWN0LCBHU1BDb21tb25FbGVtZW50LCBHU1BFbGVtZW50T2JqZWN0VHlwZSB9IGZyb20gJ0Bnc3AtYmVmL2dzcC1jbS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IERpbWVuc2lvbkRlZkVudGl0eSwgV0ZEaW1lbnNpb25UeXBlcywgRGltZW5zaW9uVHlwZSwgV0ZEaW1lbnNpb25JbnB1dFR5cGVzLCBEaW1lbnNpb25JbnB1dFR5cGUgfSBmcm9tICcuLi9lbnRpdHkvZGltZW5zaW9uZGVmLmVudGl0eSc7XHJcbmltcG9ydCB7IFdGRGltZW5zaW9uRGVmVUlTdGF0ZSB9IGZyb20gJy4uL3NlcnZpY2Uvd2YtZGltZW5zaW9uLWRlZi51aXN0YXRlJztcclxuaW1wb3J0IHsgRXhwcmVzc2lvblNlcnZpY2UsIEluamVjdGVkVHlwZSB9IGZyb20gJ0Bnc3Atc3ZjL2V4cHJlc3Npb24nO1xyXG5pbXBvcnQgeyBFbnVtRWRpdENvbXBvbmVudCB9IGZyb20gJy4uL2VudW0tZWRpdC9lbnVtLWVkaXQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTG9va3VwQ29uZmlnU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvbG9va3VwLWNvbmZpZyc7XHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd3Zi1kaW1lbnNpb24taXRlbS1jYXJkJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZGltZW5zaW9uLWl0ZW0tY2FyZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vZGltZW5zaW9uLWl0ZW0tY2FyZC5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbTG9va3VwQ29uZmlnU2VydmljZV1cclxufSlcclxuZXhwb3J0IGNsYXNzIERpbWVuc2lvbkl0ZW1DYXJkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgpIGRhdGE6IERpbWVuc2lvbkRlZkVudGl0eTtcclxuICBASW5wdXQoKSBjYW5DYXJkRWRpdDogYm9vbGVhbjtcclxuICBASW5wdXQoKSBzeXNJbml0ID0gZmFsc2U7XHJcbiAgY2FuRWRpdCA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiDnu7Tluqbnp43nsbtcclxuICAgKi9cclxuICBkaW1lbnNpb25UeXBlcyA9IFdGRGltZW5zaW9uVHlwZXM7XHJcbiAgaW5wdXRUeXBlcyA9IFdGRGltZW5zaW9uSW5wdXRUeXBlcztcclxuXHJcbiAgc2VsZWN0ZWRCRU1ldGFkYXRhOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBzZWxlY3RlZEhlbHBNZXRhZGF0YTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgZ3JvdXBJY29uID0gJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JztcclxuXHJcbiAgbG9va3VwQ29uZmlnOiBhbnk7XHJcblxyXG5cclxuICBnZXQgZGltZW5zaW9uSXRlbUNvZGUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGEgPyB0aGlzLmRhdGEuY29kZSA6ICcnO1xyXG4gIH1cclxuXHJcbiAgc2V0IGRpbWVuc2lvbkl0ZW1Db2RlKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuZGF0YS5jb2RlID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBnZXQgZGltZW5zaW9uSXRlbU5hbWUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGEgPyB0aGlzLmRhdGEuZGltZW5zaW9uTmFtZSA6ICcnO1xyXG4gIH1cclxuXHJcbiAgc2V0IGRpbWVuc2lvbkl0ZW1OYW1lKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuZGF0YS5kaW1lbnNpb25OYW1lID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBnZXQgZGltZW5zaW9uQ29kZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YSA/IHRoaXMuZGF0YS5kaW1lbnNpb25Db2RlIDogJyc7XHJcbiAgfVxyXG5cclxuICBzZXQgZGltZW5zaW9uQ29kZSh2OiBzdHJpbmcpIHtcclxuICAgIHRoaXMuZGF0YS5kaW1lbnNpb25Db2RlID0gdjtcclxuICB9XHJcblxyXG4gIGdldCBpbnB1dFR5cGUoKTogRGltZW5zaW9uSW5wdXRUeXBlIHtcclxuICAgIHJldHVybiB0aGlzLmRhdGEgPyB0aGlzLmRhdGEuaW5wdXRUeXBlIDogbnVsbDtcclxuICB9XHJcbiAgc2V0IGlucHV0VHlwZSh2OiBEaW1lbnNpb25JbnB1dFR5cGUpIHtcclxuICAgIHRoaXMuZGF0YS5pbnB1dFR5cGUgPSB2O1xyXG4gIH1cclxuXHJcblxyXG4gIGdldCBkaW1lbnNpb25UeXBlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YSA/IHRoaXMuZGF0YS5kaW1lbnNpb25UeXBlIDogbnVsbDtcclxuICB9XHJcbiAgc2V0IGRpbWVuc2lvblR5cGUodjogRGltZW5zaW9uVHlwZSkge1xyXG4gICAgdGhpcy5kYXRhLmRpbWVuc2lvblR5cGUgPSB2O1xyXG4gIH1cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB1aXN0YXRlOiBXRkRpbWVuc2lvbkRlZlVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGV4cHJTZXJ2aWNlOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgY29uZmlnU2VydmljZTogTG9va3VwQ29uZmlnU2VydmljZVxyXG4gICkge1xyXG4gICAgdGhpcy5jb25maWdTZXJ2aWNlLmdldExvb2t1cERhdGEoKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICB0aGlzLmRhdGEuc21hcnRIZWxwID0gZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNhbkVkaXQgPSB0aGlzLmNhbkNhcmRFZGl0O1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgaWYgKGNoYW5nZXMuY2FuQ2FyZEVkaXQpIHtcclxuICAgICAgdGhpcy5jYW5FZGl0ID0gdGhpcy5jYW5DYXJkRWRpdDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOe7tOW6puexu+Wei1xyXG4gICAqL1xyXG4gIHNlbGVjdERpbWVuc2lvblR5cGUoZGF0YSkge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog57u05bqm6YCJ5oupMS1iZeWtl+autVxyXG4gICAqL1xyXG4gIHNlbGVjdEJFTWV0YSgpIHtcclxuICAgIGlmICh0aGlzLnVpc3RhdGUuc2NoZW1hKSB7XHJcbiAgICAgIHRoaXMuZXhwclNlcnZpY2UuY2xlYXJJbmplY3RlZEVudGl0eSgpO1xyXG4gICAgICB0aGlzLmV4cHJTZXJ2aWNlLmFkZFNjaGVtYSgnU2NoZW1hJywgdGhpcy51aXN0YXRlLnNjaGVtYSk7XHJcbiAgICAgIGlmICh0aGlzLnVpc3RhdGUuc2NoZW1hLmVudGl0eVR5cGVzICYmIHRoaXMudWlzdGF0ZS5zY2hlbWEuZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLnVpc3RhdGUuc2NoZW1hLmVudGl0eVR5cGVzWzBdO1xyXG4gICAgICAgIHRoaXMuZXhwclNlcnZpY2UuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBpZiAodGhpcy5kaW1lbnNpb25Db2RlKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g57yW6L6R5Zmo5Yqg6L295Yid5aeL5YC8XHJcbiAgICAvLyAgIHRyeSB7XHJcbiAgICB0aGlzLmV4cHJTZXJ2aWNlLmFkZEV4cHJlc3Npb25UZXh0KHRoaXMuZGltZW5zaW9uQ29kZSk7XHJcbiAgICAgIC8vIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIC8vICAgY29uc29sZS5sb2coJ3BhcnNlIGV4cHJlc3Npb24gZXJyb3I6JyArIHRoaXMuZGltZW5zaW9uQ29kZSk7XHJcbiAgICAgIC8vIH1cclxuICAgIC8vIH1cclxuICAgIHRoaXMuZXhwclNlcnZpY2UuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoZDogc3RyaW5nKSA9PiB7IC8vIOe8lui+keWZqOi/lOWbnuWAvFxyXG4gICAgICBpZiAoZCkge1xyXG4gICAgICAgIHRoaXMuZGltZW5zaW9uQ29kZSA9IGQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOi+k+WFpeexu+Wei1xyXG4gICAqIEBwYXJhbSB2YWx1ZSBcclxuICAgKi9cclxuICBzZWxlY3RJbnB1dFR5cGUoZGF0YSkge1xyXG4gICAgdGhpcy5kYXRhLmlucHV0VHlwZSA9IGRhdGEuZGF0YS52YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuaemuS4vui+k+WFpVxyXG4gICAqL1xyXG4gIGdldElzRW51bUlucHV0KCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEuaW5wdXRUeXBlID09PSBEaW1lbnNpb25JbnB1dFR5cGUuRW51bTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaYr+WQpuW4ruWKqei+k+WFpVxyXG4gICAqL1xyXG4gIGdldElzU21hcnRIZWxwSW5wdXQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhICYmIHRoaXMuZGF0YS5pbnB1dFR5cGUgPT09IERpbWVuc2lvbklucHV0VHlwZS5IZWxwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5p6a5Li+5pi+56S65YC8XHJcbiAgICovXHJcbiAgZ2V0RW51bUlucHV0RGlzcGxheSgpIHtcclxuICAgIC8vIGlmICghdGhpcy5nZXRJc0VudW1JbnB1dCgpKSB7XHJcbiAgICAvLyAgIHJldHVybiAnJztcclxuICAgIC8vIH1cclxuICAgIC8vIGNvbnN0IGVudW1JbnB1dEluZm8gPSB0aGlzLmRhdGEuaW5wdXRJbmZvIGFzIEVudW1JbnB1dEluZm87XHJcbiAgICAvLyBsZXQgZGlzcGxheSA9ICcnO1xyXG4gICAgLy8gaWYgKCFlbnVtSW5wdXRJbmZvIHx8ICFlbnVtSW5wdXRJbmZvLmVudW1JdGVtcykge1xyXG4gICAgLy8gICByZXR1cm4gZGlzcGxheTtcclxuICAgIC8vIH1cclxuICAgIC8vIGVudW1JbnB1dEluZm8uZW51bUl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAvLyAgIGRpc3BsYXkgPSBkaXNwbGF5LmNvbmNhdChgJHtpdGVtLmtleX06JHtpdGVtLnZhbHVlfTsgYCk7XHJcbiAgICAvLyB9KTtcclxuICAgIC8vIHJldHVybiBkaXNwbGF5O1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIOW4ruWKqeWQjeensFxyXG4gICAqL1xyXG4gIGdldCBoZWxwZXJOYW1lKCk6IHN0cmluZyB7XHJcbiAgICBpZiAoIXRoaXMuZ2V0SXNTbWFydEhlbHBJbnB1dCgpKSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmRhdGEuc21hcnRIZWxwO1xyXG4gIH1cclxuXHJcbiAgZW51bUxpc3RUZXh0ID0gKCkgPT4ge1xyXG4gICAgaWYgKCF0aGlzLmdldElzRW51bUlucHV0KCkpIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gICAgbGV0IGRpc3BsYXkgPSAnJztcclxuICAgIGlmICh0aGlzLmRhdGEuZW51bUxpc3QpIHtcclxuICAgICAgY29uc3QgZW51bUxpc3QgPSBKU09OLnBhcnNlKHRoaXMuZGF0YS5lbnVtTGlzdCk7XHJcbiAgICAgIGlmIChlbnVtTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZW51bUxpc3QuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIGRpc3BsYXkgPSBkaXNwbGF5LmNvbmNhdChgJHtpdGVtLmtleX06JHtpdGVtLnZhbHVlfTsgYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBkaXNwbGF5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5biu5Yqp6YCJ5oupXHJcbiAgICovXHJcbiAgc2VsZWN0SGVscE1ldGEoKSB7XHJcbiAgICB0aGlzLmxvb2t1cENvbmZpZyA9IHRoaXMuY29uZmlnU2VydmljZS5zaG93Q29uZmlnKHtcclxuICAgICAgY29uZmlnSWQ6IHRoaXMuZGF0YS5zbWFydEhlbHBcclxuICAgIH0pO1xyXG4gICAgLy8gY29uc3QgY29tcEZhY3RvcnkgPVxyXG4gICAgLy8gICB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFNlbGVjdE1ldGFkYXRhUlRDb21wb25lbnQpO1xyXG4gICAgLy8gY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIC8vIGNvbXBSZWYuaW5zdGFuY2UudHlwZUxpc3QgPSAnSGVscE1ldGFkYXRhJztcclxuICAgIC8vIGNvbXBSZWYuaW5zdGFuY2Uuc2VsZWN0ZWRNZXRhZGF0YVxyXG4gICAgLy8gICAuc3Vic2NyaWJlKCgkZXZlbnQ6IE1ldGFkYXRhNFJlZkR0bykgPT4ge1xyXG4gICAgLy8gICAgIGNvbnN0IG1ldGE6IE1ldGFkYXRhRHRvID0gJGV2ZW50Lm1ldGFkYXRhO1xyXG4gICAgLy8gICAgIGNvbnN0IGhlbHAgPSBKU09OLnBhcnNlKG1ldGEuY29udGVudCk7XHJcblxyXG4gICAgLy8gICAgIHRoaXMuZGF0YS5zbWFydEhlbHAgPSBoZWxwLmlkO1xyXG4gICAgLy8gICB9KTtcclxuXHJcbiAgICAvLyBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgIC8vICAgdGl0bGU6ICfluK7liqnpgInmi6knLFxyXG4gICAgLy8gICB3aWR0aDogOTMwLFxyXG4gICAgLy8gICBoZWlnaHQ6IDU3MyxcclxuICAgIC8vICAgc2hvd0J1dHRvbnM6IGZhbHNlXHJcbiAgICAvLyB9O1xyXG4gICAgLy8gY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAvLyBjb21wUmVmLmluc3RhbmNlLmNsb3NlTW9kYWxFbWl0dGVyLnN1YnNjcmliZSgkZXZlbnQgPT4gZGlhbG9nLmNsb3NlKCkpO1xyXG4gIH1cclxuXHJcbiAgZWRpdEVudW1WYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRW51bUVkaXRDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbnN0IG1vZGFsQ29uZmlnID0ge1xyXG4gICAgICB0aXRsZTogJ+aemuS4vuiuvue9ricsXHJcbiAgICAgIHdpZHRoOiA2NTAsXHJcbiAgICAgIGhlaWdodDogNDUwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5idG5SZWYsXHJcbiAgICB9O1xyXG4gICAgaWYgKHRoaXMuZGF0YS5lbnVtTGlzdCkge1xyXG4gICAgICBjb21wUmVmLmluc3RhbmNlLmxvYWQoSlNPTi5wYXJzZSh0aGlzLmRhdGEuZW51bUxpc3QpKTtcclxuICAgIH1cclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY29uZmlybS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICB0aGlzLmRhdGEuZW51bUxpc3QgPSBKU09OLnN0cmluZ2lmeShyZSkgPyBKU09OLnN0cmluZ2lmeShyZSkgOiBudWxsO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VNb2RhbEVtaXR0ZXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, Input } from '@angular/core';
import { FarrisPageDetailComponent } from '@farris/ui-wizard';
export class SelectObjectComponent {
    constructor() {
        this.enableNextStep = true;
        this.detailPage = null;
        // 记录当前BE所有表的code
        this.treeTables = [];
        this.grid_selected = {};
        this.readonlyFields = []; // 不可取消勾选的字段
        // 不可取消勾选的字段
        /**
         * 左侧树信息
         */
        this.treeData = [];
        this.farrisTreeData = [];
        this.treeConfig = {
            idField: 'ID',
            columns: [
                { field: 'Name', title: 'Name', width: 200 }
            ],
            /**
             * 叶子节点图标
             */
            leafIcon: 'f-icon f-icon-folder text-info',
            /**
             * 节点展开图标
             */
            expandIcon: 'f-icon f-icon-folder-open text-info',
            /**
             * 节点折叠图标
             */
            collapseIcon: 'f-icon f-icon-folder text-info',
            /**
             * 树列表默认展开层级。 -1： 不展开； 0： 全部展开； >0:  展开到指定级数；
             */
            expandLevel: 2,
        };
    }
    /**
     * @param {?} cmp
     * @return {?}
     */
    set cmpPageDetail(cmp) {
        this.detailPage = cmp;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.load();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.load();
    }
    /**
     * @return {?}
     */
    load() {
        if (this.data && this.data.be) {
            /** @type {?} */
            const mainObject = this.data.be.MainObject;
            this.treeData = this.getTablesTree(mainObject);
            this.farrisTreeData = this.getFarrisTreeData(this.treeData);
        }
    }
    /**
     * 组装farris-tree左侧树
     * @param {?} data
     * @return {?}
     */
    getFarrisTreeData(data) {
        /** @type {?} */
        const newArr = [];
        if (data && data.length) {
            data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            item => {
                /** @type {?} */
                let childrenArr = [];
                if (item && item.Children && item.Children.length) {
                    childrenArr = this.getFarrisTreeData(item.Children);
                }
                newArr.push({ data: item, children: childrenArr, expanded: true });
            }));
        }
        return newArr;
    }
    /**
     * 组装左侧树
     * @param {?} mainObject
     * @return {?}
     */
    getTablesTree(mainObject) {
        const { ContainChildObjects, ColumnGenerateID, Keys } = mainObject, parentTable = tslib_1.__rest(mainObject, ["ContainChildObjects", "ColumnGenerateID", "Keys"]);
        this.treeTables.push(parentTable.Code);
        // const selectedAll = this.grid_selected[parentTable.Code] ? false : true;
        // this.gridData[parentTable.Code] = this.getGridFields(parentTable.ContainElements, parentTable.Code, selectedAll);
        if (ContainChildObjects && ContainChildObjects.length > 0) {
            parentTable['Children'] = [];
            ContainChildObjects.forEach((/**
             * @param {?} child
             * @return {?}
             */
            child => {
                /** @type {?} */
                const childTree = this.getTablesTree((/** @type {?} */ (child)));
                parentTable['Children'] = parentTable['Children'].concat(childTree);
            }));
        }
        // 判断主键
        if (ColumnGenerateID) {
            this.readonlyFields.push(ColumnGenerateID.ElementID);
        }
        // 判断主从表的关联字段
        if (Keys && Keys.length > 0) {
            Keys.forEach((/**
             * @param {?} key
             * @return {?}
             */
            key => {
                this.readonlyFields.push(key.SourceElement);
            }));
        }
        return [parentTable];
    }
    /**
     * 选中节点事件
     * @param {?} event 被选中节点
     * @return {?}
     */
    handleTreeSelection(event) {
        this.data.selectedObj = event.node.data;
    }
    /**
     * @return {?}
     */
    nextStep() {
        // 设置当前页传递出去数据
        this.data.BeFields = this.data.selectedObj.ContainElements;
        this.detailPage.setPageData(this.data.selectedObj);
        // 下一步
        this.detailPage.nextStep();
    }
    /**
     * @return {?}
     */
    cancel() {
        this.detailPage.cancelWizard();
    }
    /**
     * @param {?} args
     * @return {?}
     */
    pagedetailSelected(args) {
    }
}
SelectObjectComponent.decorators = [
    { type: Component, args: [{
                selector: 'select-object',
                template: "<wizard-page-detail #detailpage1 (pagedetailSelected)=\"pagedetailSelected($event)\">\r\n    <ng-template wizardPageContent>\r\n        <div class=\"f-template-wizard-page-content\" style=\"margin-left:2px\">\r\n            <farris-treetable #treetable [columns]=\"treeConfig.columns\" [showBorder]=\"false\" [showHeader]=\"false\" [data]=\"farrisTreeData\" [fit]=\"true\" [idField]=\"treeConfig.idField\" [singleSelect]=\"true\" [showCheckbox]=\"false\" [showIcon]=\"true\" [disabled]=\"false\"\r\n                [checkOnSelect]=\"true\" (nodeSelected)=\"handleTreeSelection($event)\" [leafIcon]=\"treeConfig.leafIcon\" [expandIcon]=\"treeConfig.expandIcon\" [collapseIcon]=\"treeConfig.collapseIcon\">\r\n            </farris-treetable>\r\n        </div>\r\n    </ng-template>\r\n    <ng-template wizardPageFooter>\r\n        <div class=\"f-template-wizard-page-footer\">\r\n            <button class=\"btn btn-secondary\" (click)=\"cancel()\">\r\n              \u53D6\u6D88\r\n          </button>\r\n            <button class=\"btn btn-primary\" [disabled]=\"!enableNextStep\" (click)=\"nextStep()\">\r\n              \u4E0B\u4E00\u6B65\r\n          </button>\r\n        </div>\r\n    </ng-template>\r\n</wizard-page-detail>",
                styles: [":host{display:flex;flex:1}button{margin:10px}"]
            }] }
];
/** @nocollapse */
SelectObjectComponent.ctorParameters = () => [];
SelectObjectComponent.propDecorators = {
    data: [{ type: Input }],
    cmpPageDetail: [{ type: ViewChild, args: [FarrisPageDetailComponent,] }]
};
if (false) {
    /** @type {?} */
    SelectObjectComponent.prototype.data;
    /** @type {?} */
    SelectObjectComponent.prototype.enableNextStep;
    /**
     * @type {?}
     * @private
     */
    SelectObjectComponent.prototype.detailPage;
    /** @type {?} */
    SelectObjectComponent.prototype.treeTables;
    /** @type {?} */
    SelectObjectComponent.prototype.grid_selected;
    /** @type {?} */
    SelectObjectComponent.prototype.readonlyFields;
    /**
     * 左侧树信息
     * @type {?}
     */
    SelectObjectComponent.prototype.treeData;
    /** @type {?} */
    SelectObjectComponent.prototype.farrisTreeData;
    /** @type {?} */
    SelectObjectComponent.prototype.treeConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LW9iamVjdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLWRpbWVuc2lvbi1kZWYvIiwic291cmNlcyI6WyJsaWIvcmVmTW9kdWxlL3NlbGVjdC1lbGVtZW50L3N0ZXBzL3NlbGVjdC1vYmplY3Qvc2VsZWN0LW9iamVjdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxLQUFLLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBQzlGLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBUTlELE1BQU0sT0FBTyxxQkFBcUI7SUE2Q2hDO1FBaENBLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBQ2QsZUFBVSxHQUE4QixJQUFJLENBQUM7O1FBUXJELGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDaEIsa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFDbkIsbUJBQWMsR0FBRyxFQUFFLENBQUMsQ0FBQyxZQUFZOzs7OztRQUdqQyxhQUFRLEdBQVUsRUFBRSxDQUFDO1FBQ3JCLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBRXBCLGVBQVUsR0FBRztZQUNYLE9BQU8sRUFBRSxJQUFJO1lBQ2IsT0FBTyxFQUFFO2dCQUNQLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUU7YUFDN0M7Ozs7WUFFRCxRQUFRLEVBQUUsZ0NBQWdDOzs7O1lBRTFDLFVBQVUsRUFBRSxxQ0FBcUM7Ozs7WUFFakQsWUFBWSxFQUFFLGdDQUFnQzs7OztZQUU5QyxXQUFXLEVBQUUsQ0FBQztTQUNmLENBQUM7SUFFYyxDQUFDOzs7OztJQTlCakIsSUFBMEMsYUFBYSxDQUNyRCxHQUE4QjtRQUU5QixJQUFJLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQztJQUN4QixDQUFDOzs7O0lBNEJELFFBQVE7UUFDTixJ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Q0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDO1FBQzNELElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbkQsTUFBTTtRQUNOLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDN0IsQ0FBQzs7OztJQUNELE1BQU07UUFDSixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ2pDLENBQUM7Ozs7O0lBQ0Qsa0JBQWtCLENBQUMsSUFBSTtJQUV2QixDQUFDOzs7WUFySUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxlQUFlO2dCQUN6Qix3dENBQTZDOzthQUU5Qzs7Ozs7bUJBWUUsS0FBSzs0QkFJTCxTQUFTLFNBQUMseUJBQXlCOzs7O0lBSnBDLHFDQUFjOztJQUVkLCtDQUFzQjs7Ozs7SUFDdEIsMkNBQXFEOztJQVFyRCwyQ0FBZ0I7O0lBQ2hCLDhDQUFtQjs7SUFDbkIsK0NBQW9COzs7OztJQUdwQix5Q0FBcUI7O0lBQ3JCLCtDQUFvQjs7SUFFcEIsMkNBYUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBJbnB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZhcnJpc1BhZ2VEZXRhaWxDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXdpemFyZCc7XHJcbmltcG9ydCB7IEdTUENvbW1vbk9iamVjdCB9IGZyb20gJ0Bnc3AtYmVmL2dzcC1jbS1tZXRhZGF0YSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3NlbGVjdC1vYmplY3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zZWxlY3Qtb2JqZWN0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9zZWxlY3Qtb2JqZWN0LmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2VsZWN0T2JqZWN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIC8vIC8qKlxyXG4gIC8vICAgKiDovpPlhaXlj4LmlbDmoLzlvI9cclxuICAvLyAgICovXHJcbiAgLy8gZGF0YSA9IHtcclxuICAvLyAgIGJlOiBudWxsLCAgICAgICAgICAgICAgLy8gYmXlrp7kvZNcclxuICAvLyAgIHNlbGVjdGVkT2JqOiBudWxsLCAgICAgLy8gYmXoioLngrlcclxuICAvLyAgIEJlRmllbGRzOiBbXSwgICAgICAgICAgLy8gQmXlrZfmrrXliJfooahcclxuICAvLyAgIHNlbGVjdGVkQmVGaWVsZHM6IFtdLCAgLy8gQmXlrZfmrrVJROWIl+ihqFxyXG4gIC8vIH07XHJcblxyXG4gIEBJbnB1dCgpIGRhdGE7XHJcblxyXG4gIGVuYWJsZU5leHRTdGVwID0gdHJ1ZTtcclxuICBwcml2YXRlIGRldGFpbFBhZ2U6IEZhcnJpc1BhZ2VEZXRhaWxDb21wb25lbnQgPSBudWxsO1xyXG4gIEBWaWV3Q2hpbGQoRmFycmlzUGFnZURldGFpbENvbXBvbmVudCkgc2V0IGNtcFBhZ2VEZXRhaWwoXHJcbiAgICBjbXA6IEZhcnJpc1BhZ2VEZXRhaWxDb21wb25lbnRcclxuICApIHtcclxuICAgIHRoaXMuZGV0YWlsUGFnZSA9IGNtcDtcclxuICB9XHJcblxyXG4gIC8vIOiusOW9leW9k+WJjUJF5omA5pyJ6KGo55qEY29kZVxyXG4gIHRyZWVUYWJsZXMgPSBbXTtcclxuICBncmlkX3NlbGVjdGVkID0ge307XHJcbiAgcmVhZG9ubHlGaWVsZHMgPSBbXTsgLy8g5LiN5Y+v5Y+W5raI5Yu+6YCJ55qE5a2X5q61XHJcblxyXG4gIC8qKiDlt6bkvqfmoJHkv6Hmga8gKi9cclxuICB0cmVlRGF0YTogYW55W10gPSBbXTtcclxuICBmYXJyaXNUcmVlRGF0YSA9IFtdO1xyXG5cclxuICB0cmVlQ29uZmlnID0ge1xyXG4gICAgaWRGaWVsZDogJ0lEJyxcclxuICAgIGNvbHVtbnM6IFtcclxuICAgICAgeyBmaWVsZDogJ05hbWUnLCB0aXRsZTogJ05hbWUnLCB3aWR0aDogMjAwIH1cclxuICAgIF0sXHJcbiAgICAvKiog5Y+25a2Q6IqC54K55Zu+5qCHICovXHJcbiAgICBsZWFmSWNvbjogJ2YtaWNvbiBmLWljb24tZm9sZGVyIHRleHQtaW5mbycsXHJcbiAgICAvKiog6IqC54K55bGV5byA5Zu+5qCHICovXHJcbiAgICBleHBhbmRJY29uOiAnZi1pY29uIGYtaWNvbi1mb2xkZXItb3BlbiB0ZXh0LWluZm8nLFxyXG4gICAgLyoqIOiKgueCueaKmOWPoOWbvuaghyAqL1xyXG4gICAgY29sbGFwc2VJY29uOiAnZi1pY29uIGYtaWNvbi1mb2xkZXIgdGV4dC1pbmZvJyxcclxuICAgIC8qKiAg5qCR5YiX6KGo6buY6K6k5bGV5byA5bGC57qn44CCIC0x77yaIOS4jeWxleW8gO+8myAw77yaIOWFqOmDqOWxleW8gO+8myA+MDogIOWxleW8gOWIsOaMh+Wumue6p+aVsO+8myAqL1xyXG4gICAgZXhwYW5kTGV2ZWw6IDIsXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmxvYWQoKTtcclxuICB9XHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2FkKCk7XHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEuYmUpIHtcclxuICAgICAgY29uc3QgbWFpbk9iamVjdCA9IHRoaXMuZGF0YS5iZS5NYWluT2JqZWN0O1xyXG4gICAgICB0aGlzLnRyZWVEYXRhID0gdGhpcy5nZXRUYWJsZXNUcmVlKG1haW5PYmplY3QpO1xyXG4gICAgICB0aGlzLmZhcnJpc1RyZWVEYXRhID0gdGhpcy5nZXRGYXJyaXNUcmVlRGF0YSh0aGlzLnRyZWVEYXRhKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog57uE6KOFZmFycmlzLXRyZWXlt6bkvqfmoJFcclxuICAgKi9cclxuICBnZXRGYXJyaXNUcmVlRGF0YShkYXRhOiBhbnlbXSkge1xyXG4gICAgY29uc3QgbmV3QXJyID0gW107XHJcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICBkYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgbGV0IGNoaWxkcmVuQXJyID0gW107XHJcbiAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbS5DaGlsZHJlbiAmJiBpdGVtLkNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgY2hpbGRyZW5BcnIgPSB0aGlzLmdldEZhcnJpc1RyZWVEYXRhKGl0ZW0uQ2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBuZXdBcnIucHVzaCh7IGRhdGE6IGl0ZW0sIGNoaWxkcmVuOiBjaGlsZHJlbkFyciwgZXhwYW5kZWQ6IHRydWUgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ld0FycjtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog57uE6KOF5bem5L6n5qCRXHJcbiAgICovXHJcbiAgZ2V0VGFibGVzVHJlZShtYWluT2JqZWN0OiBHU1BDb21tb25PYmplY3QpIHtcclxuICAgIGNvbnN0IHsgQ29udGFpbkNoaWxkT2JqZWN0cywgQ29sdW1uR2VuZXJhdGVJRCwgS2V5cywgLi4ucGFyZW50VGFibGUgfSA9IG1haW5PYmplY3Q7XHJcbiAgICB0aGlzLnRyZWVUYWJsZXMucHVzaChwYXJlbnRUYWJsZS5Db2RlKTtcclxuXHJcbiAgICAvLyBjb25zdCBzZWxlY3RlZEFsbCA9IHRoaXMuZ3JpZF9zZWxlY3RlZFtwYXJlbnRUYWJsZS5Db2RlXSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgIC8vIHRoaXMuZ3JpZERhdGFbcGFyZW50VGFibGUuQ29kZV0gPSB0aGlzLmdldEdyaWRGaWVsZHMocGFyZW50VGFibGUuQ29udGFpbkVsZW1lbnRzLCBwYXJlbnRUYWJsZS5Db2RlLCBzZWxlY3RlZEFsbCk7XHJcblxyXG4gICAgaWYgKENvbnRhaW5DaGlsZE9iamVjdHMgJiYgQ29udGFpbkNoaWxkT2JqZWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHBhcmVudFRhYmxlWydDaGlsZHJlbiddID0gW107XHJcbiAgICAgIENvbnRhaW5DaGlsZE9iamVjdHMuZm9yRWFjaChjaGlsZCA9PiB7XHJcbiAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gdGhpcy5nZXRUYWJsZXNUcmVlKGNoaWxkIGFzIEdTUENvbW1vbk9iamVjdCk7XHJcbiAgICAgICAgcGFyZW50VGFibGVbJ0NoaWxkcmVuJ10gPSBwYXJlbnRUYWJsZVsnQ2hpbGRyZW4nXS5jb25jYXQoY2hpbGRUcmVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyDliKTmlq3kuLvplK5cclxuICAgIGlmIChDb2x1bW5HZW5lcmF0ZUlEKSB7XHJcbiAgICAgIHRoaXMucmVhZG9ubHlGaWVsZHMucHVzaChDb2x1bW5HZW5lcmF0ZUlELkVsZW1lbnRJRCk7XHJcbiAgICB9XHJcbiAgICAvLyDliKTmlq3kuLvku47ooajnmoTlhbPogZTlrZfmrrVcclxuICAgIGlmIChLZXlzICYmIEtleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBLZXlzLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICB0aGlzLnJlYWRvbmx5RmllbGRzLnB1c2goa2V5LlNvdXJjZUVsZW1lbnQpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9XHJcbiAgICByZXR1cm4gW3BhcmVudFRhYmxlXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOmAieS4reiKgueCueS6i+S7tlxyXG4gICAqIEBwYXJhbSBldmVudCDooqvpgInkuK3oioLngrlcclxuICAgKi9cclxuICBoYW5kbGVUcmVlU2VsZWN0aW9uKGV2ZW50KTogdm9pZCB7XHJcbiAgICB0aGlzLmRhdGEuc2VsZWN0ZWRPYmogPSBldmVudC5ub2RlLmRhdGE7XHJcbiAgfVxyXG5cclxuICBuZXh0U3RlcCgpIHtcclxuICAgIC8vIOiuvue9ruW9k+WJjemhteS8oOmAkuWHuuWOu+aVsOaNrlxyXG4gICAgdGhpcy5kYXRhLkJlRmllbGRzID0gdGhpcy5kYXRhLnNlbGVjdGVkT2JqLkNvbnRhaW5FbGVtZW50cztcclxuICAgIHRoaXMuZGV0YWlsUGFnZS5zZXRQYWdlRGF0YSh0aGlzLmRhdGEuc2VsZWN0ZWRPYmopO1xyXG4gICAgLy8g5LiL5LiA5q2lXHJcbiAgICB0aGlzLmRldGFpbFBhZ2UubmV4dFN0ZXAoKTtcclxuICB9XHJcbiAgY2FuY2VsKCkge1xyXG4gICAgdGhpcy5kZXRhaWxQYWdlLmNhbmNlbFdpemFyZCgpO1xyXG4gIH1cclxuICBwYWdlZGV0YWlsU2VsZWN0ZWQoYXJncykge1xyXG5cclxuICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { DimenDefEntityUtil } from './entity/dimendef-entity.util';
import { ItemEditState, DimensionInputType } from './entity/dimensiondef.entity';
import { WFDimensionDefViewmodel } from './service/wf-dimension-def.viewModel';
import { NotifyService } from '@farris/ui-notify';
import { WFDimensionDefUIState } from './service/wf-dimension-def.uistate';
import { forkJoin } from 'rxjs/observable/forkJoin';
import { switchMap, catchError } from 'rxjs/operators';
import { of } from 'rxjs';
export class WfDimensionDefComponent {
    /**
     * @param {?} messageService
     * @param {?} viewmodel
     * @param {?} notifyService
     * @param {?} uistate
     */
    constructor(messageService, viewmodel, notifyService, uistate) {
        this.messageService = messageService;
        this.viewmodel = viewmodel;
        this.notifyService = notifyService;
        this.uistate = uistate;
        this.entry = 'flowForm';
        // tslint:disable-next-line: variable-name
        this._editable = false;
        this.data = new Array();
        this.editData = new Array();
    }
    /**
     * @return {?}
     */
    get flowFormId() {
        return this._flowFormId;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    set flowFormId(id) {
        this._flowFormId = id;
        this.load();
        this.getDimensionDefSet(this._flowFormId);
    }
    /**
     * @param {?} s
     * @return {?}
     */
    set schema(s) {
        this.uistate.schema = s;
    }
    /**
     * @return {?}
     */
    get schema() {
        return this.uistate.schema;
    }
    /**
     * @param {?} m
     * @return {?}
     */
    set beMetaData(m) {
        this.uistate.beMetaData = m;
    }
    /**
     * @return {?}
     */
    get beMetaData() {
        return this.uistate.beMetaData;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    set editable(e) {
        this._editable = e;
        for (const d of this.editData) {
            d.canEdit = this._editable;
        }
    }
    /**
     * @return {?}
     */
    get editable() {
        return this._editable;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    load() {
        if (this.flowFormId) {
            this.viewmodel.loadDimensionDefs(this.flowFormId).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            (re) => {
                this.data = re;
                this.editData = [];
                if (this.data && this.data.length > 0) {
                    this.data.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => {
                        this.addItem(item, this.editable);
                    }));
                }
            }));
        }
    }
    /**
     * @param {?} flowFormId
     * @return {?}
     */
    getDimensionDefSet(flowFormId) {
        if (flowFormId) {
            this.viewmodel.getDimensionDefSet(flowFormId).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            re => {
                this.dimensionDefSet = re;
            }));
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    hasItem(index) {
        return this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.index === index));
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getItem(index) {
        return this.hasItem(index) ? this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.index === index)).itemData : null;
    }
    /**
     * @param {?} index
     * @param {?} itemData
     * @return {?}
     */
    setItem(index, itemData) {
        this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.index === index)).itemData = itemData;
    }
    /**
     * @param {?} itemData
     * @param {?} canEdit
     * @return {?}
     */
    addItem(itemData, canEdit) {
        /** @type {?} */
        const editDataItem = new ItemEditState();
        editDataItem.canEdit = canEdit;
        editDataItem.index = this.editData.length;
        editDataItem.itemData = Object.assign({}, itemData);
        editDataItem.id = itemData.id;
        this.editData.push(editDataItem);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getTitle(index) {
        /** @type {?} */
        let suffix = '';
        switch (index) {
            case 0:
                suffix = '一';
                break;
            case 1:
                suffix = '二';
                break;
        }
        return `维度${suffix}`;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    getState(index) {
        if (!this.hasItem(index)) {
            return false;
        }
        /** @type {?} */
        const sysInit = this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.index === index)).itemData.sysInit;
        return sysInit === 1 ? true : false;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    isEditState(index) {
        if (!this.hasItem(index)) {
            return false;
        }
        return this.editData.find((/**
         * @param {?} item
         * @return {?}
         */
        item => item.index === index)).canEdit;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    edit(item) {
        this.editData.find((/**
         * @param {?} d
         * @return {?}
         */
        d => d.id === item.id)).canEdit = true;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    remove(item) {
        if (this.dimensionDefSet && (item.id === this.dimensionDefSet.dimension1 || item.id === this.dimensionDefSet.dimension2)) {
            this.messageService.info('当前维度定义已在流程分配维度配置中启用');
            return;
        }
        if (this.entry === 'flowForm') {
            this.removeDimensionDef(item);
            // const i = this.data.findIndex(d => d.id === item.id);
            // if (i > -1) {
            //   this.data.splice(i, 1);
            // }
        }
        else {
            this.messageService.question(`确认删除'${this.getTitle(item.index)}'吗？`, (/**
             * @return {?}
             */
            () => {
                if (this.data.findIndex((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => d.id === item.id)) === -1) {
                    this.removeDimensionDef(item);
                    this.notifyService.success('删除成功');
                    return;
                }
                this.viewmodel.removeDimensionDef(item.id).subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                re => {
                    this.removeDimensionDef(item);
                    /** @type {?} */
                    const i = this.data.findIndex((/**
                     * @param {?} d
                     * @return {?}
                     */
                    d => d.id === item.id));
                    if (i > -1) {
                        this.data.splice(i, 1);
                    }
                    this.notifyService.success('删除成功');
                }), (/**
                 * @param {?} err
                 * @return {?}
                 */
                err => {
                    this.notifyService.error('删除失败，请联系管理员查看原因！');
                }));
            }));
        }
    }
    /**
     * @return {?}
     */
    getDimensionDefs() {
        return this.editData.map((/**
         * @param {?} d
         * @return {?}
         */
        d => d.itemData));
    }
    /**
     * @private
     * @param {?} item
     * @return {?}
     */
    removeDimensionDef(item) {
        /** @type {?} */
        const index = this.editData.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        d => d.id === item.id));
        if (index > -1) {
            this.editData.splice(index, 1);
        }
        if (index < this.editData.length) {
            for (let i = 0; i < this.editData.length; i++) {
                this.editData[i].index = i;
            }
        }
    }
    /**
     * @param {?} item
     * @return {?}
     */
    save(item) {
        /** @type {?} */
        const v = this.validate(item.itemData);
        if (!v.result) {
            this.messageService.info(v.message);
            return;
        }
        if (this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        d => d.id === item.id)) === -1) {
            this.viewmodel.addDimensionDef(item.itemData).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            re => {
                this.endEdit(item);
                this.data.push(Object.assign({}, item.itemData));
                this.notifyService.success('保存成功');
            }), (/**
             * @param {?} err
             * @return {?}
             */
            err => {
                this.notifyService.error('保存失败，请联系管理员查看原因！');
            }));
        }
        else {
            this.viewmodel.updateDimensionDef(item.itemData).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            re => {
                this.endEdit(item);
                /** @type {?} */
                const data = this.data.find((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => d.id === item.id));
                Object.assign(data, item.itemData);
                this.notifyService.success('保存成功');
            }), (/**
             * @param {?} err
             * @return {?}
             */
            err => {
                this.notifyService.error('保存失败，请联系管理员查看原因！');
            }));
        }
    }
    /**
     * @return {?}
     */
    saveAll() {
        /** @type {?} */
        const deleteDefs = this.data.filter((/**
         * @param {?} d
         * @return {?}
         */
        d => this.editData.findIndex((/**
         * @param {?} e
         * @return {?}
         */
        e => e.id === d.id)) === -1));
        /** @type {?} */
        const addDefs = this.editData.filter((/**
         * @param {?} e
         * @return {?}
         */
        e => this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        d => d.id === e.id)) === -1)).map((/**
         * @param {?} e
         * @return {?}
         */
        e => e.itemData));
        /** @type {?} */
        const updateDefs = this.editData.filter((/**
         * @param {?} e
         * @return {?}
         */
        e => this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        d => d.id === e.id)) > -1))
            .map((/**
         * @param {?} e
         * @return {?}
         */
        e => e.itemData))
            .filter((/**
         * @param {?} d
         * @return {?}
         */
        d => d.sysInit === 0));
        return forkJoin(deleteDefs.map((/**
         * @param {?} d
         * @return {?}
         */
        d => {
            return this.viewmodel.removeDimensionDef(d.id);
        })).concat(updateDefs.map((/**
         * @param {?} u
         * @return {?}
         */
        u => {
            return this.viewmodel.updateDimensionDef(u);
        })).concat(addDefs.map((/**
         * @param {?} a
         * @return {?}
         */
        a => {
            return this.viewmodel.addDimensionDef(a);
        }))))).pipe(switchMap((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            this.data = this.editData.map((/**
             * @param {?} e
             * @return {?}
             */
            e => e.itemData));
            // this.editData.map(e => e.canEdit = false);
            return of(true);
        })), catchError((/**
         * @param {?} err
         * @return {?}
         */
        err => {
            console.error(err);
            return of(false);
        })));
        //   .subscribe(re => {
        //   this.data = this.editData.map(e => e.itemData);
        //   this.editData.map(e => e.canEdit = false);
        // },
        // err => {
        //   this.notifyService.error('保存维度定义失败，请联系系统管理员查看原因！');
        // });
    }
    /**
     * @param {?} item
     * @return {?}
     */
    cancel(item) {
        this.endEdit(item);
        if (this.data.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        d => d.id === item.id)) === -1) {
            this.removeDimensionDef(item);
            return;
        }
        else {
            Object.assign(this.editData.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d.id === item.id)).itemData, this.data.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d.id === item.id)));
        }
    }
    /**
     * @return {?}
     */
    addHandler() {
        if (this.entry === 'flowForm' && !this.editable) {
            return;
        }
        /** @type {?} */
        const info = DimenDefEntityUtil.newDimendefEntity(this.flowFormId);
        this.addItem(info, true);
    }
    /**
     * @param {?} index
     * @return {?}
     */
    isOtherItemEditting(index) {
        /** @type {?} */
        let isOtherItemEditting = false;
        this.editData.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            if (item.canEdit === true && item.index !== index) {
                isOtherItemEditting = true;
                this.messageService.info(`请先保存对于'${this.getTitle(item.index)}'的修改。`);
            }
        }));
        return isOtherItemEditting;
    }
    /**
     * @param {?} item
     * @return {?}
     */
    endEdit(item) {
        for (const d of this.editData) {
            if (d.id === item.id) {
                d.canEdit = false;
            }
        }
    }
    /**
     * @private
     * @param {?} d
     * @return {?}
     */
    validate(d) {
        if (!d.code) {
            return { result: false, message: '维度定义不允许编号为空，请修改！' };
        }
        else if (!d.dimensionName) {
            return { result: false, message: '维度定义不允许维度名称为空，请修改！' };
        }
        else if (!d.dimensionCode) {
            return { result: false, message: '维度定义不允许分配维度为空，请修改！' };
        }
        else if (d.inputType === DimensionInputType.Help && !d.smartHelp) {
            return { result: false, message: '维度定义数据类型为帮助，但帮助值为空，请修改！' };
        }
        else if (d.inputType === DimensionInputType.Enum && !d.enumList) {
            return { result: false, message: '维度定义数据类型为枚举，但枚举值为空，请修改！' };
        }
        return { result: true, message: '' };
    }
}
WfDimensionDefComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf-dimension-def',
                template: "<wf-dimension-panel [model]=\"['b']\" [width]=\"'700px'\" [defaultExpand]=\"true\">\r\n    <div *ngFor=\"let item of editData; index as index;\"\r\n        style=\"width: 100%;border: 1px solid rgba(0, 0, 0, .125);margin-bottom: 25px;\">\r\n        <wf-dimension-panel-item [title]=\"getTitle(index)\" [sysInit]=\"getState(index)\" [value]=\"index\" [editState]=\"entry==='billCategory'?isEditState(index):false\">\r\n            <ng-template #contentTempl>\r\n                <wf-dimension-item-card [data]=\"getItem(index)\" [canCardEdit]=\"isEditState(index)\" [sysInit]=\"getState(index)\">\r\n                </wf-dimension-item-card>\r\n            </ng-template>\r\n            <ng-template #toolTempl>\r\n                <farris-button *ngIf=\"entry==='billCategory'\" [type]=\"'link'\" (click)=\"edit(item)\"><span class=\"f-icon text-info k-i-edit\"></span>\u4FEE\u6539\r\n                </farris-button>\r\n                <farris-button *ngIf=\"editable && !getState(index)\" [type]=\"'link'\" (click)=\"remove(item)\"><span\r\n                        class=\"f-icon text-info k-i-delete\"></span> \u5220\u9664\r\n                </farris-button>\r\n            </ng-template>\r\n            <ng-template #bottomRef>\r\n                <farris-button (click)=\"save(item)\">\u4FDD\u5B58</farris-button>\r\n                <farris-button style=\"margin-left:10px\" [type]=\"'secondary'\" (click)=\"cancel(item)\">\u53D6\u6D88</farris-button>\r\n            </ng-template>\r\n        </wf-dimension-panel-item>\r\n    </div>\r\n</wf-dimension-panel>\r\n<div *ngIf=\"hasItem(1)\" class=\"panel-ony-two\">\r\n    <div style=\"width: 250px;margin:0 auto\">\r\n        <p style=\"color:rgba(217,217,217)\">Tips:\u76EE\u524D\u4EC5\u652F\u6301\u6DFB\u52A0\u4E24\u4E2A\u7EF4\u5EA6</p>\r\n    </div>\r\n</div>\r\n<div *ngIf=\"!hasItem(1)\" class=\"panel-add\">\r\n    <div style=\"width: 100px;margin:0 auto\">\r\n        <farris-button style=\"margin:25px\" [type]=\"'link'\" [disabled]=\"entry==='flowForm'&&!editable\" (click)=\"addHandler()\">\r\n            <span *ngIf=\"!(entry==='flowForm'&&!editable)\" class=\"f-icon text-info k-i-plus\"></span>\u6DFB\u52A0\u7EF4\u5EA6</farris-button>\r\n    </div>\r\n</div>",
                styles: [".panel-add{margin:25px;padding:10px;border:1px dashed rgba(0,0,0,.125)}.panel-ony-two{margin:20px}"]
            }] }
];
/** @nocollapse */
WfDimensionDefComponent.ctorParameters = () => [
    { type: MessagerService },
    { type: WFDimensionDefViewmodel },
    { type: NotifyService },
    { type: WFDimensionDefUIState }
];
WfDimensionDefComponent.propDecorators = {
    flowFormId: [{ type: Input }],
    schema: [{ type: Input }],
    beMetaData: [{ type: Input }],
    entry: [{ type: Input }],
    editable: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype._flowFormId;
    /** @type {?} */
    WfDimensionDefComponent.prototype.entry;
    /** @type {?} */
    WfDimensionDefComponent.prototype._editable;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.data;
    /** @type {?} */
    WfDimensionDefComponent.prototype.editData;
    /** @type {?} */
    WfDimensionDefComponent.prototype.dimensionDefSet;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.messageService;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.viewmodel;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    WfDimensionDefComponent.prototype.uistate;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtZGltZW5zaW9uLWRlZi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLWRpbWVuc2lvbi1kZWYvIiwic291cmNlcyI6WyJsaWIvd2YtZGltZW5zaW9uLWRlZi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQW9DLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbkUsT0FBTyxFQUFzQixhQUFhLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNyRyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMvRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDM0UsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkQsT0FBTyxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQU90QyxNQUFNLE9BQU8sdUJBQXVCOzs7Ozs7O0lBbURsQyxZQUNVLGNBQStCLEVBQy9CLFNBQWtDLEVBQ2xDLGFBQTRCLEVBQzVCLE9BQThCO1FBSDlCLG1CQUFjLEdBQWQsY0FBYyxDQUFpQjtRQUMvQixjQUFTLEdBQVQsU0FBUyxDQUF5QjtRQUNsQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixZQUFPLEdBQVAsT0FBTyxDQUF1QjtRQXhCeEMsVUFBSyxHQUFnQyxVQUFVLENBQUM7O1FBR2hELGNBQVMsR0FBRyxLQUFLLENBQUM7UUFZVixTQUFJLEdBQUcsSUFBSSxLQUFLLEVBQXNCLENBQUM7UUFDL0MsYUFBUSxHQUFHLElBQUksS0FBSyxFQUFpQixDQUFDO0lBU2xDLENBQUM7Ozs7SUFwREwsSUFDSSxVQUFVO1FBQ1osT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7Ozs7O0lBQ0QsSUFBSSxVQUFVLENBQUMsRUFBVTtRQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDWixJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzVDLENBQUM7Ozs7O0lBRUQsSUFDSSxNQUFNLENBQUMsQ0FBTTtRQUNmLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUMxQixDQUFDOzs7O0lBQ0QsSUFBSSxNQUFNO1FBQ1IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUM3QixDQUFDOzs7OztJQUVELElBQ0ksVUFBVSxDQUFDLENBQU07UUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLENBQUM7Ozs7SUFDRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO0lBQ2pDLENBQUM7Ozs7O0lBT0QsSUFDSSxRQUFRLENBQUMsQ0FBVTtRQUNyQixJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUNuQixLQUFLLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDN0IsQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQzVCO0lBQ0gsQ0FBQzs7OztJQUNELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUN4QixDQUFDOzs7O0lBY0QsUUFBUTtJQUNSLENBQUM7Ozs7O0lBQ0QsV0FBVyxDQUFDLE9BQXNCO0lBRWxDLENBQUM7Ozs7SUFFRCxJQUFJO1FBQ0YsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ25CLElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVM7Ozs7WUFBQyxDQUFDLEVBQTZCLEVBQUUsRUFBRTtnQkFDNUYsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7Z0JBQ25CLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTzs7OztvQkFBQyxJQUFJLENBQUMsRUFBRTt3QkFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUNwQyxDQUFDLEVBQUMsQ0FBQztpQkFDSjtZQUNILENBQUMsRUFBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOzs7OztJQUVELGtCQUFrQixDQUFDLFVBQWtCO1FBQ25DLElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTOzs7O1lBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ3pELElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1lBQzlCLENBQUMsRUFBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOzs7OztJQUVELE9BQU8sQ0FBQyxLQUFhO1FBQ25CLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBQyxDQUFDO0lBQzFELENBQUM7Ozs7O0lBRUQsT0FBTyxDQUFDLEtBQWE7UUFDbkIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUk7Ozs7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxFQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDaEcsQ0FBQzs7Ozs7O0lBR0QsT0FBTyxDQUFDLEtBQWEsRUFBRSxRQUFhO1FBQ2xDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSTs7OztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQUMsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQ3ZFLENBQUM7Ozs7OztJQUVELE9BQU8sQ0FBQyxRQUE0QixFQUFFLE9BQWdCOztjQUM5QyxZQUFZLEdBQUcsSUFBSSxhQUFhLEVBQUU7UUFDeEMsWUFBWSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDL0IsWUFBWSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUMxQyxZQUFZLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3BELFlBQVksQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNuQyxDQUFDOzs7OztJQUVELFFBQVEsQ0FBQyxLQUFhOztZQUNoQixNQUFNLEdBQUcsRUFBRTtRQUNmLFFBQVEsS0FBSyxFQUFFO1lBQ2IsS0FBSyxDQUFDO2dCQUNKLE1BQU0sR0FBRyxHQUFHLENBQUM7Z0JBQ2IsTUFBTTtZQUNSLEtBQUssQ0FBQztnQkFDSixNQUFNLEdBQUcsR0FBRyxDQUFDO2dCQUNiLE1BQU07U0FDVDtRQUNELE9BQU8sS0FBSyxNQUFNLEVBQUUsQ0FBQztJQUN2QixDQUFDOzs7OztJQUVELFFBQVEsQ0FBQyxLQUFhO1FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3hCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7O2NBQ0ssT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSTs7OztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTztRQUNqRixPQUFPLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQ3RDLENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFDLEtBQWE7UUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDeEIsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBQyxDQUFDLE9BQU8sQ0FBQztJQUNsRSxDQUFDOzs7OztJQUVELElBQUksQ0FBQyxJQUFtQjtRQUN0QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUk7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsRUFBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDM0QsQ0FBQzs7Ozs7SUFFRCxNQUFNLENBQUMsSUFBbUI7UUFDeEIsSUFBSSxJQUFJLENBQUMsZUFBZSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDeEgsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUNoRCxPQUFPO1NBQ1I7UUFDRCxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssVUFBVSxFQUFFO1lBQzdCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5Qix3REFBd0Q7WUFDeEQsZ0JBQWdCO1lBQ2hCLDRCQUE0QjtZQUM1QixJQUFJO1NBQ0w7YUFBTTtZQUNMLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUs7OztZQUFFLEdBQUcsRUFBRTtnQkFDeEUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7Ozs7Z0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLEVBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtvQkFDckQsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO29CQUM5QixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDbkMsT0FBTztpQkFDUjtnQkFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTOzs7O2dCQUFDLEVBQUUsQ0FBQyxFQUFFO29CQUN4RCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7OzBCQUN4QixDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTOzs7O29CQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxFQUFDO29CQUNwRCxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTt3QkFDVixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7cUJBQ3hCO29CQUNELElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNyQyxDQUFDOzs7O2dCQUFFLEdBQUcsQ0FBQyxFQUFFO29CQUNQLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQy9DLENBQUMsRUFBQyxDQUFDO1lBQ0wsQ0FBQyxFQUFDLENBQUM7U0FDSjtJQUNILENBQUM7Ozs7SUFFRCxnQkFBZ0I7UUFDZCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBQyxDQUFDO0lBQzVDLENBQUM7Ozs7OztJQUVPLGtCQUFrQixDQUFDLElBQW1COztjQUN0QyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLEVBQUM7UUFDNUQsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDZCxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDaEM7UUFDRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRTtZQUNoQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQzdDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQzthQUM1QjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxJQUFJLENBQUMsSUFBbUI7O2NBQ2hCLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUU7WUFDYixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsT0FBTztTQUNSO1FBQ0QsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsRUFBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ3JELElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTOzs7O1lBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQzNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNqRCxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNyQyxDQUFDOzs7O1lBQUUsR0FBRyxDQUFDLEVBQUU7Z0JBQ1AsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUMvQyxDQUFDLEVBQUMsQ0FBQztTQUNKO2FBQU07WUFDTCxJQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTOzs7O1lBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQzlELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7O3NCQUNiLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUk7Ozs7Z0JBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLEVBQUM7Z0JBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDbkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDckMsQ0FBQzs7OztZQUFFLEdBQUcsQ0FBQyxFQUFFO2dCQUNQLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDL0MsQ0FBQyxFQUFDLENBQUM7U0FDSjtJQUNILENBQUM7Ozs7SUFFRCxPQUFPOztjQUNDLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUM7O2NBQ3RGLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFHOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFDOztjQUN4RyxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBQyxHQUFHLENBQUMsQ0FBQyxFQUFDO2FBQ3ZGLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUM7YUFDcEIsTUFBTTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLEVBQUM7UUFDL0IsT0FBTyxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUNqQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELENBQUMsRUFBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzNCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QyxDQUFDLEVBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRTtZQUN4QixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDUixTQUFTOzs7O1FBQUMsRUFBRSxDQUFDLEVBQUU7WUFDYixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRzs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBQyxDQUFDO1lBQy9DLDZDQUE2QztZQUM3QyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQixDQUFDLEVBQUMsRUFDRixVQUFVOzs7O1FBQUMsR0FBRyxDQUFDLEVBQUU7WUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25CLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25CLENBQUMsRUFBQyxDQUNILENBQUM7UUFDRix1QkFBdUI7UUFDdkIsb0RBQW9EO1FBQ3BELCtDQUErQztRQUMvQyxLQUFLO1FBQ0wsV0FBVztRQUNYLHdEQUF3RDtRQUN4RCxNQUFNO0lBQ1IsQ0FBQzs7Ozs7SUFFRCxNQUFNLENBQUMsSUFBbUI7UUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQixJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxFQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDckQsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzlCLE9BQU87U0FDUjthQUFNO1lBQ0wsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUk7Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUNuQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLEVBQUMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJOzs7O1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLEVBQUMsQ0FBQyxDQUFDO1NBQ3RFO0lBQ0gsQ0FBQzs7OztJQUVELFVBQVU7UUFDUixJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssVUFBVSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUMvQyxPQUFPO1NBQ1I7O2NBQ0ssSUFBSSxHQUFHLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDbEUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQzs7Ozs7SUFFRCxtQkFBbUIsQ0FBQyxLQUFhOztZQUMzQixtQkFBbUIsR0FBRyxLQUFLO1FBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTzs7OztRQUFDLElBQUksQ0FBQyxFQUFFO1lBQzNCLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxLQUFLLEVBQUU7Z0JBQ2pELG1CQUFtQixHQUFHLElBQUksQ0FBQztnQkFDM0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDdEU7UUFDSCxDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sbUJBQW1CLENBQUM7SUFDN0IsQ0FBQzs7Ozs7SUFFRCxPQUFPLENBQUMsSUFBbUI7UUFDekIsS0FBSyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQzdCLElBQUksQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNwQixDQUFDLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQzthQUNuQjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7O0lBQ08sUUFBUSxDQUFDLENBQXFCO1FBQ3BDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO1lBQ1gsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLENBQUM7U0FDdkQ7YUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLGFBQWEsRUFBRTtZQUMzQixPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQztTQUN6RDthQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsYUFBYSxFQUFFO1lBQzNCLE9BQU8sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxDQUFDO1NBQ3pEO2FBQU0sSUFBSSxDQUFDLENBQUMsU0FBUyxLQUFLLGtCQUFrQixDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUU7WUFDbEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLENBQUM7U0FDOUQ7YUFBTSxJQUFJLENBQUMsQ0FBQyxTQUFTLEtBQUssa0JBQWtCLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRTtZQUNqRSxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsQ0FBQztTQUM5RDtRQUNELE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUN2QyxDQUFDOzs7WUE3U0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxrQkFBa0I7Z0JBQzVCLDByRUFBZ0Q7O2FBRWpEOzs7O1lBZFEsZUFBZTtZQUdmLHVCQUF1QjtZQUN2QixhQUFhO1lBQ2IscUJBQXFCOzs7eUJBYzNCLEtBQUs7cUJBVUwsS0FBSzt5QkFRTCxLQUFLO29CQVFMLEtBQUs7dUJBS0wsS0FBSzs7Ozs7OztJQWpDTiw4Q0FBNEI7O0lBNEI1Qix3Q0FDZ0Q7O0lBR2hELDRDQUFrQjs7Ozs7SUFZbEIsdUNBQStDOztJQUMvQywyQ0FBc0M7O0lBRXRDLGtEQUFxQjs7Ozs7SUFHbkIsaURBQXVDOzs7OztJQUN2Qyw0Q0FBMEM7Ozs7O0lBQzFDLGdEQUFvQzs7Ozs7SUFDcEMsMENBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IERpbWVuRGVmRW50aXR5VXRpbCB9IGZyb20gJy4vZW50aXR5L2RpbWVuZGVmLWVudGl0eS51dGlsJztcclxuaW1wb3J0IHsgRGltZW5zaW9uRGVmRW50aXR5LCBJdGVtRWRpdFN0YXRlLCBEaW1lbnNpb25JbnB1dFR5cGUgfSBmcm9tICcuL2VudGl0eS9kaW1lbnNpb25kZWYuZW50aXR5JztcclxuaW1wb3J0IHsgV0ZEaW1lbnNpb25EZWZWaWV3bW9kZWwgfSBmcm9tICcuL3NlcnZpY2Uvd2YtZGltZW5zaW9uLWRlZi52aWV3TW9kZWwnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBXRkRpbWVuc2lvbkRlZlVJU3RhdGUgfSBmcm9tICcuL3NlcnZpY2Uvd2YtZGltZW5zaW9uLWRlZi51aXN0YXRlJztcclxuaW1wb3J0IHsgZm9ya0pvaW4gfSBmcm9tICdyeGpzL29ic2VydmFibGUvZm9ya0pvaW4nO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dmLWRpbWVuc2lvbi1kZWYnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi93Zi1kaW1lbnNpb24tZGVmLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi93Zi1kaW1lbnNpb24tZGVmLmNvbXBvbmVudC5jc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIFdmRGltZW5zaW9uRGVmQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICBwcml2YXRlIF9mbG93Rm9ybUlkOiBzdHJpbmc7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IGZsb3dGb3JtSWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZmxvd0Zvcm1JZDtcclxuICB9XHJcbiAgc2V0IGZsb3dGb3JtSWQoaWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5fZmxvd0Zvcm1JZCA9IGlkO1xyXG4gICAgdGhpcy5sb2FkKCk7XHJcbiAgICB0aGlzLmdldERpbWVuc2lvbkRlZlNldCh0aGlzLl9mbG93Rm9ybUlkKTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHNjaGVtYShzOiBhbnkpIHtcclxuICAgIHRoaXMudWlzdGF0ZS5zY2hlbWEgPSBzO1xyXG4gIH1cclxuICBnZXQgc2NoZW1hKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudWlzdGF0ZS5zY2hlbWE7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCBiZU1ldGFEYXRhKG06IGFueSkge1xyXG4gICAgdGhpcy51aXN0YXRlLmJlTWV0YURhdGEgPSBtO1xyXG4gIH1cclxuICBnZXQgYmVNZXRhRGF0YSgpIHtcclxuICAgIHJldHVybiB0aGlzLnVpc3RhdGUuYmVNZXRhRGF0YTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZW50cnk6ICdmbG93Rm9ybScgfCAnYmlsbENhdGVnb3J5JyA9ICdmbG93Rm9ybSc7XHJcblxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogdmFyaWFibGUtbmFtZVxyXG4gIF9lZGl0YWJsZSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IGVkaXRhYmxlKGU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX2VkaXRhYmxlID0gZTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLmVkaXREYXRhKSB7XHJcbiAgICAgIGQuY2FuRWRpdCA9IHRoaXMuX2VkaXRhYmxlO1xyXG4gICAgfVxyXG4gIH1cclxuICBnZXQgZWRpdGFibGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZWRpdGFibGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRhdGEgPSBuZXcgQXJyYXk8RGltZW5zaW9uRGVmRW50aXR5PigpO1xyXG4gIGVkaXREYXRhID0gbmV3IEFycmF5PEl0ZW1FZGl0U3RhdGU+KCk7XHJcblxyXG4gIGRpbWVuc2lvbkRlZlNldDogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbWVzc2FnZVNlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgdmlld21vZGVsOiBXRkRpbWVuc2lvbkRlZlZpZXdtb2RlbCxcclxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgdWlzdGF0ZTogV0ZEaW1lbnNpb25EZWZVSVN0YXRlXHJcbiAgKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuXHJcbiAgfVxyXG5cclxuICBsb2FkKCkge1xyXG4gICAgaWYgKHRoaXMuZmxvd0Zvcm1JZCkge1xyXG4gICAgICB0aGlzLnZpZXdtb2RlbC5sb2FkRGltZW5zaW9uRGVmcyh0aGlzLmZsb3dGb3JtSWQpLnN1YnNjcmliZSgocmU6IEFycmF5PERpbWVuc2lvbkRlZkVudGl0eT4pID0+IHtcclxuICAgICAgICB0aGlzLmRhdGEgPSByZTtcclxuICAgICAgICB0aGlzLmVkaXREYXRhID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgdGhpcy5kYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkSXRlbShpdGVtLCB0aGlzLmVkaXRhYmxlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXREaW1lbnNpb25EZWZTZXQoZmxvd0Zvcm1JZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoZmxvd0Zvcm1JZCkge1xyXG4gICAgICB0aGlzLnZpZXdtb2RlbC5nZXREaW1lbnNpb25EZWZTZXQoZmxvd0Zvcm1JZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHRoaXMuZGltZW5zaW9uRGVmU2V0ID0gcmU7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFzSXRlbShpbmRleDogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lZGl0RGF0YS5maW5kKGl0ZW0gPT4gaXRlbS5pbmRleCA9PT0gaW5kZXgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SXRlbShpbmRleDogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gdGhpcy5oYXNJdGVtKGluZGV4KSA/IHRoaXMuZWRpdERhdGEuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KS5pdGVtRGF0YSA6IG51bGw7XHJcbiAgfVxyXG5cclxuXHJcbiAgc2V0SXRlbShpbmRleDogbnVtYmVyLCBpdGVtRGF0YTogYW55KSB7XHJcbiAgICB0aGlzLmVkaXREYXRhLmZpbmQoaXRlbSA9PiBpdGVtLmluZGV4ID09PSBpbmRleCkuaXRlbURhdGEgPSBpdGVtRGF0YTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oaXRlbURhdGE6IERpbWVuc2lvbkRlZkVudGl0eSwgY2FuRWRpdDogYm9vbGVhbikge1xyXG4gICAgY29uc3QgZWRpdERhdGFJdGVtID0gbmV3IEl0ZW1FZGl0U3RhdGUoKTtcclxuICAgIGVkaXREYXRhSXRlbS5jYW5FZGl0ID0gY2FuRWRpdDtcclxuICAgIGVkaXREYXRhSXRlbS5pbmRleCA9IHRoaXMuZWRpdERhdGEubGVuZ3RoO1xyXG4gICAgZWRpdERhdGFJdGVtLml0ZW1EYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbURhdGEpO1xyXG4gICAgZWRpdERhdGFJdGVtLmlkID0gaXRlbURhdGEuaWQ7XHJcbiAgICB0aGlzLmVkaXREYXRhLnB1c2goZWRpdERhdGFJdGVtKTtcclxuICB9XHJcblxyXG4gIGdldFRpdGxlKGluZGV4OiBudW1iZXIpIHtcclxuICAgIGxldCBzdWZmaXggPSAnJztcclxuICAgIHN3aXRjaCAoaW5kZXgpIHtcclxuICAgICAgY2FzZSAwOlxyXG4gICAgICAgIHN1ZmZpeCA9ICfkuIAnO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIDE6XHJcbiAgICAgICAgc3VmZml4ID0gJ+S6jCc7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYOe7tOW6piR7c3VmZml4fWA7XHJcbiAgfVxyXG5cclxuICBnZXRTdGF0ZShpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuaGFzSXRlbShpbmRleCkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc3lzSW5pdCA9IHRoaXMuZWRpdERhdGEuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KS5pdGVtRGF0YS5zeXNJbml0O1xyXG4gICAgcmV0dXJuIHN5c0luaXQgPT09IDEgPyB0cnVlIDogZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpc0VkaXRTdGF0ZShpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuaGFzSXRlbShpbmRleCkpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZWRpdERhdGEuZmluZChpdGVtID0+IGl0ZW0uaW5kZXggPT09IGluZGV4KS5jYW5FZGl0O1xyXG4gIH1cclxuXHJcbiAgZWRpdChpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICB0aGlzLmVkaXREYXRhLmZpbmQoZCA9PiBkLmlkID09PSBpdGVtLmlkKS5jYW5FZGl0ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHJlbW92ZShpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICBpZiAodGhpcy5kaW1lbnNpb25EZWZTZXQgJiYgKGl0ZW0uaWQgPT09IHRoaXMuZGltZW5zaW9uRGVmU2V0LmRpbWVuc2lvbjEgfHwgaXRlbS5pZCA9PT0gdGhpcy5kaW1lbnNpb25EZWZTZXQuZGltZW5zaW9uMikpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5pbmZvKCflvZPliY3nu7TluqblrprkuYnlt7LlnKjmtYHnqIvliIbphY3nu7TluqbphY3nva7kuK3lkK/nlKgnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZW50cnkgPT09ICdmbG93Rm9ybScpIHtcclxuICAgICAgdGhpcy5yZW1vdmVEaW1lbnNpb25EZWYoaXRlbSk7XHJcbiAgICAgIC8vIGNvbnN0IGkgPSB0aGlzLmRhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gaXRlbS5pZCk7XHJcbiAgICAgIC8vIGlmIChpID4gLTEpIHtcclxuICAgICAgLy8gICB0aGlzLmRhdGEuc3BsaWNlKGksIDEpO1xyXG4gICAgICAvLyB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLnF1ZXN0aW9uKGDnoa7orqTliKDpmaQnJHt0aGlzLmdldFRpdGxlKGl0ZW0uaW5kZXgpfSflkJfvvJ9gLCAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5maW5kSW5kZXgoZCA9PiBkLmlkID09PSBpdGVtLmlkKSA9PT0gLTEpIHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRGltZW5zaW9uRGVmKGl0ZW0pO1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ+WIoOmZpOaIkOWKnycpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnZpZXdtb2RlbC5yZW1vdmVEaW1lbnNpb25EZWYoaXRlbS5pZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlRGltZW5zaW9uRGVmKGl0ZW0pO1xyXG4gICAgICAgICAgY29uc3QgaSA9IHRoaXMuZGF0YS5maW5kSW5kZXgoZCA9PiBkLmlkID09PSBpdGVtLmlkKTtcclxuICAgICAgICAgIGlmIChpID4gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5zdWNjZXNzKCfliKDpmaTmiJDlip8nKTtcclxuICAgICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKCfliKDpmaTlpLHotKXvvIzor7fogZTns7vnrqHnkIblkZjmn6XnnIvljp/lm6DvvIEnKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXREaW1lbnNpb25EZWZzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZWRpdERhdGEubWFwKGQgPT4gZC5pdGVtRGF0YSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbW92ZURpbWVuc2lvbkRlZihpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZWRpdERhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gaXRlbS5pZCk7XHJcbiAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICB0aGlzLmVkaXREYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbiAgICBpZiAoaW5kZXggPCB0aGlzLmVkaXREYXRhLmxlbmd0aCkge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZWRpdERhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB0aGlzLmVkaXREYXRhW2ldLmluZGV4ID0gaTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2F2ZShpdGVtOiBJdGVtRWRpdFN0YXRlKSB7XHJcbiAgICBjb25zdCB2ID0gdGhpcy52YWxpZGF0ZShpdGVtLml0ZW1EYXRhKTtcclxuICAgIGlmICghdi5yZXN1bHQpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5pbmZvKHYubWVzc2FnZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gaXRlbS5pZCkgPT09IC0xKSB7XHJcbiAgICAgIHRoaXMudmlld21vZGVsLmFkZERpbWVuc2lvbkRlZihpdGVtLml0ZW1EYXRhKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgIHRoaXMuZW5kRWRpdChpdGVtKTtcclxuICAgICAgICB0aGlzLmRhdGEucHVzaChPYmplY3QuYXNzaWduKHt9LCBpdGVtLml0ZW1EYXRhKSk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcign5L+d5a2Y5aSx6LSl77yM6K+36IGU57O7566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy52aWV3bW9kZWwudXBkYXRlRGltZW5zaW9uRGVmKGl0ZW0uaXRlbURhdGEpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgdGhpcy5lbmRFZGl0KGl0ZW0pO1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGEuZmluZChkID0+IGQuaWQgPT09IGl0ZW0uaWQpO1xyXG4gICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgaXRlbS5pdGVtRGF0YSk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3MoJ+S/neWtmOaIkOWKnycpO1xyXG4gICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcign5L+d5a2Y5aSx6LSl77yM6K+36IGU57O7566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2F2ZUFsbCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IGRlbGV0ZURlZnMgPSB0aGlzLmRhdGEuZmlsdGVyKGQgPT4gdGhpcy5lZGl0RGF0YS5maW5kSW5kZXgoZSA9PiBlLmlkID09PSBkLmlkKSA9PT0gLTEpO1xyXG4gICAgY29uc3QgYWRkRGVmcyA9IHRoaXMuZWRpdERhdGEuZmlsdGVyKGUgPT4gdGhpcy5kYXRhLmZpbmRJbmRleChkID0+IGQuaWQgPT09IGUuaWQpID09PSAtMSkubWFwKGUgPT4gZS5pdGVtRGF0YSk7XHJcbiAgICBjb25zdCB1cGRhdGVEZWZzID0gdGhpcy5lZGl0RGF0YS5maWx0ZXIoZSA9PiB0aGlzLmRhdGEuZmluZEluZGV4KGQgPT4gZC5pZCA9PT0gZS5pZCkgPiAtMSlcclxuICAgICAgLm1hcChlID0+IGUuaXRlbURhdGEpXHJcbiAgICAgIC5maWx0ZXIoZCA9PiBkLnN5c0luaXQgPT09IDApO1xyXG4gICAgcmV0dXJuIGZvcmtKb2luKGRlbGV0ZURlZnMubWFwKGQgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy52aWV3bW9kZWwucmVtb3ZlRGltZW5zaW9uRGVmKGQuaWQpO1xyXG4gICAgfSkuY29uY2F0KHVwZGF0ZURlZnMubWFwKHUgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy52aWV3bW9kZWwudXBkYXRlRGltZW5zaW9uRGVmKHUpO1xyXG4gICAgfSkuY29uY2F0KGFkZERlZnMubWFwKGEgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy52aWV3bW9kZWwuYWRkRGltZW5zaW9uRGVmKGEpO1xyXG4gICAgfSkpKSkucGlwZShcclxuICAgICAgc3dpdGNoTWFwKHJlID0+IHtcclxuICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmVkaXREYXRhLm1hcChlID0+IGUuaXRlbURhdGEpO1xyXG4gICAgICAgIC8vIHRoaXMuZWRpdERhdGEubWFwKGUgPT4gZS5jYW5FZGl0ID0gZmFsc2UpO1xyXG4gICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgfSksXHJcbiAgICAgIGNhdGNoRXJyb3IoZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgICAvLyAgIC5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgLy8gICB0aGlzLmRhdGEgPSB0aGlzLmVkaXREYXRhLm1hcChlID0+IGUuaXRlbURhdGEpO1xyXG4gICAgLy8gICB0aGlzLmVkaXREYXRhLm1hcChlID0+IGUuY2FuRWRpdCA9IGZhbHNlKTtcclxuICAgIC8vIH0sXHJcbiAgICAvLyBlcnIgPT4ge1xyXG4gICAgLy8gICB0aGlzLm5vdGlmeVNlcnZpY2UuZXJyb3IoJ+S/neWtmOe7tOW6puWumuS5ieWksei0pe+8jOivt+iBlOezu+ezu+e7n+euoeeQhuWRmOafpeeci+WOn+WboO+8gScpO1xyXG4gICAgLy8gfSk7XHJcbiAgfVxyXG5cclxuICBjYW5jZWwoaXRlbTogSXRlbUVkaXRTdGF0ZSkge1xyXG4gICAgdGhpcy5lbmRFZGl0KGl0ZW0pO1xyXG4gICAgaWYgKHRoaXMuZGF0YS5maW5kSW5kZXgoZCA9PiBkLmlkID09PSBpdGVtLmlkKSA9PT0gLTEpIHtcclxuICAgICAgdGhpcy5yZW1vdmVEaW1lbnNpb25EZWYoaXRlbSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5lZGl0RGF0YS5maW5kKGQgPT5cclxuICAgICAgICBkLmlkID09PSBpdGVtLmlkKS5pdGVtRGF0YSwgdGhpcy5kYXRhLmZpbmQoZCA9PiBkLmlkID09PSBpdGVtLmlkKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhZGRIYW5kbGVyKCkge1xyXG4gICAgaWYgKHRoaXMuZW50cnkgPT09ICdmbG93Rm9ybScgJiYgIXRoaXMuZWRpdGFibGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaW5mbyA9IERpbWVuRGVmRW50aXR5VXRpbC5uZXdEaW1lbmRlZkVudGl0eSh0aGlzLmZsb3dGb3JtSWQpO1xyXG4gICAgdGhpcy5hZGRJdGVtKGluZm8sIHRydWUpO1xyXG4gIH1cclxuXHJcbiAgaXNPdGhlckl0ZW1FZGl0dGluZyhpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaXNPdGhlckl0ZW1FZGl0dGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5lZGl0RGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpZiAoaXRlbS5jYW5FZGl0ID09PSB0cnVlICYmIGl0ZW0uaW5kZXggIT09IGluZGV4KSB7XHJcbiAgICAgICAgaXNPdGhlckl0ZW1FZGl0dGluZyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlU2VydmljZS5pbmZvKGDor7flhYjkv53lrZjlr7nkuo4nJHt0aGlzLmdldFRpdGxlKGl0ZW0uaW5kZXgpfSfnmoTkv67mlLnjgIJgKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaXNPdGhlckl0ZW1FZGl0dGluZztcclxuICB9XHJcblxyXG4gIGVuZEVkaXQoaXRlbTogSXRlbUVkaXRTdGF0ZSkge1xyXG4gICAgZm9yIChjb25zdCBkIG9mIHRoaXMuZWRpdERhdGEpIHtcclxuICAgICAgaWYgKGQuaWQgPT09IGl0ZW0uaWQpIHtcclxuICAgICAgICBkLmNhbkVkaXQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHZhbGlkYXRlKGQ6IERpbWVuc2lvbkRlZkVudGl0eSkge1xyXG4gICAgaWYgKCFkLmNvZGUpIHtcclxuICAgICAgcmV0dXJuIHsgcmVzdWx0OiBmYWxzZSwgbWVzc2FnZTogJ+e7tOW6puWumuS5ieS4jeWFgeiuuOe8luWPt+S4uuepuu+8jOivt+S/ruaUue+8gScgfTtcclxuICAgIH0gZWxzZSBpZiAoIWQuZGltZW5zaW9uTmFtZSkge1xyXG4gICAgICByZXR1cm4geyByZXN1bHQ6IGZhbHNlLCBtZXNzYWdlOiAn57u05bqm5a6a5LmJ5LiN5YWB6K6457u05bqm5ZCN56ew5Li656m677yM6K+35L+u5pS577yBJyB9O1xyXG4gICAgfSBlbHNlIGlmICghZC5kaW1lbnNpb25Db2RlKSB7XHJcbiAgICAgIHJldHVybiB7IHJlc3VsdDogZmFsc2UsIG1lc3NhZ2U6ICfnu7TluqblrprkuYnkuI3lhYHorrjliIbphY3nu7TluqbkuLrnqbrvvIzor7fkv67mlLnvvIEnIH07XHJcbiAgICB9IGVsc2UgaWYgKGQuaW5wdXRUeXBlID09PSBEaW1lbnNpb25JbnB1dFR5cGUuSGVscCAmJiAhZC5zbWFydEhlbHApIHtcclxuICAgICAgcmV0dXJuIHsgcmVzdWx0OiBmYWxzZSwgbWVzc2FnZTogJ+e7tOW6puWumuS5ieaVsOaNruexu+Wei+S4uuW4ruWKqe+8jOS9huW4ruWKqeWAvOS4uuepuu+8jOivt+S/ruaUue+8gScgfTtcclxuICAgIH0gZWxzZSBpZiAoZC5pbnB1dFR5cGUgPT09IERpbWVuc2lvbklucHV0VHlwZS5FbnVtICYmICFkLmVudW1MaXN0KSB7XHJcbiAgICAgIHJldHVybiB7IHJlc3VsdDogZmFsc2UsIG1lc3NhZ2U6ICfnu7TluqblrprkuYnmlbDmja7nsbvlnovkuLrmnprkuL7vvIzkvYbmnprkuL7lgLzkuLrnqbrvvIzor7fkv67mlLnvvIEnIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyByZXN1bHQ6IHRydWUsIG1lc3NhZ2U6ICcnIH07XHJcbiAgfVxyXG59XHJcbiJdfQ==
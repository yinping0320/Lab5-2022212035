/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, ComponentFactoryResolver, Injector, Optional } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { ProcessSelectorComponent } from '../process-selector/process-selector.component';
import { InteractionResponse } from '../../entity/interaction-response';
import { AssignParticipantComponent } from '../assign-participant/assign-participant.component';
import { of } from 'rxjs';
import { I18nService } from '../../runtime/services/i18n.service';
/**
 * 提交审批客户端交互服务
 */
export class WFSubmiteService {
    /**
     * @param {?} injector
     * @param {?} resolver
     * @param {?} modalService
     * @param {?} i18nService
     */
    constructor(injector, resolver, modalService, i18nService) {
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
        this.i18nService = i18nService;
    }
    /**
     * 客户端交互处理服务端返回结果
     * @param {?} excutionRe 提交审批服务器端返回结果
     * @param {?} handler 处理结果回调页面
     * @return {?}
     */
    excute(excutionRe, handler) {
        /** @type {?} */
        const response = new InteractionResponse();
        // 无需交互
        if (excutionRe.needInteraction === false) {
            response.message = '无需交互';
            handler(response);
            return;
        }
        // 选择要提交的流程
        if (excutionRe.procDefs && excutionRe.procDefs.length > 1) {
            this.selectProcess(excutionRe.procDefs, handler);
            return;
        }
        // 指定下一步参与者
        if (excutionRe.nextFlowNodes[0].assigneeInfo) {
            this.assignee([excutionRe.nextFlowNodes[0].assigneeInfo], handler);
            return;
        }
    }
    /**
     * 处理选择流程结果
     * @private
     * @param {?} prcesses
     * @param {?} handler
     * @return {?}
     */
    selectProcess(prcesses, handler) {
        /** @type {?} */
        const response = new InteractionResponse();
        /** @type {?} */
        const modalConfig = {
            title: this.i18nService ? this.i18nService.getValue('static.submit.selectProcess') : '流程选择',
            width: 520,
            height: 290,
            showButtons: false,
            showMaxButton: false,
            beforeClose: (/**
             * @param {?} modelRef
             * @return {?}
             */
            (modelRef) => {
                handler(response);
                return of(true);
            })
        };
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ProcessSelectorComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.gridData = prcesses;
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.subscribe().subscribe((/**
         * @param {?} val
         * @return {?}
         */
        val => {
            response.processDefinitionId = val;
            dialog.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            response.message = err;
            dialog.close();
        }));
    }
    /**
     * 处理指定下一步人员结果
     * @private
     * @param {?} assigneeInfos
     * @param {?=} handler
     * @return {?}
     */
    assignee(assigneeInfos, handler) {
        /** @type {?} */
        const response = new InteractionResponse();
        /** @type {?} */
        const modalConfig = {
            title: this.i18nService ? this.i18nService.getValue('static.assignee.title') : '请选择操作用户',
            width: 850,
            height: 520,
            showMaxButton: false,
            showButtons: false,
            beforeClose: (/**
             * @param {?} modelRef
             * @return {?}
             */
            (modelRef) => {
                handler(response);
                return of(true);
            })
        };
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(AssignParticipantComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.assigneeInfo = assigneeInfos;
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.subscribe().subscribe((/**
         * @param {?} val
         * @return {?}
         */
        val => {
            dialog.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            dialog.close();
        }));
    }
}
WFSubmiteService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
WFSubmiteService.ctorParameters = () => [
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: BsModalService },
    { type: I18nService, decorators: [{ type: Optional }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.i18nService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Ytc3VibWl0ZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi9ydGRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9zdWJtaXQvc2VydmljZS93Zi1zdWJtaXRlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsd0JBQXdCLEVBQWdCLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkcsT0FBTyxFQUFFLGNBQWMsRUFBZ0IsTUFBTSxrQkFBa0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUUxRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUd4RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUNoRyxPQUFPLEVBQXVCLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7QUFNbEUsTUFBTSxPQUFPLGdCQUFnQjs7Ozs7OztJQUV6QixZQUNZLFFBQWtCLEVBQ2xCLFFBQWtDLEVBQ2xDLFlBQTRCLEVBQ2hCLFdBQXdCO1FBSHBDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFDbEMsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQ2hCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO0lBQzVDLENBQUM7Ozs7Ozs7SUFPTCxNQUFNLENBQUMsVUFBNEIsRUFBRSxPQUE4Qzs7Y0FDekUsUUFBUSxHQUFHLElBQUksbUJBQW1CLEVBQUU7UUFDMUMsT0FBTztRQUNQLElBQUksVUFBVSxDQUFDLGVBQWUsS0FBSyxLQUFLLEVBQUU7WUFDdEMsUUFBUSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7WUFDMUIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2xC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TyxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsYUFBYSxDQUFDOztjQUN4QyxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQztRQUMzRCxPQUFPLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVM7Ozs7UUFBQyxHQUFHLENBQUMsRUFBRTtZQUN6QyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbkIsQ0FBQzs7OztRQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ0wsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ25CLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7O1lBeEZKLFVBQVU7Ozs7WUFka0QsUUFBUTtZQUFoRCx3QkFBd0I7WUFDcEMsY0FBYztZQVFkLFdBQVcsdUJBWVgsUUFBUTs7Ozs7OztJQUhULG9DQUEwQjs7Ozs7SUFDMUIsb0NBQTBDOzs7OztJQUMxQyx3Q0FBb0M7Ozs7O0lBQ3BDLHVDQUE0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgRXZlbnRFbWl0dGVyLCBJbmplY3RvciwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UsIE1vZGFsT3B0aW9ucyB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBQcm9jZXNzU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuLi9wcm9jZXNzLXNlbGVjdG9yL3Byb2Nlc3Mtc2VsZWN0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRXhjdXRpb25SZXNwb25zZSB9IGZyb20gJy4uLy4uL2VudGl0eS9leGN1dGlvbi1yZXNwb25zZSc7XHJcbmltcG9ydCB7IEludGVyYWN0aW9uUmVzcG9uc2UgfSBmcm9tICcuLi8uLi9lbnRpdHkvaW50ZXJhY3Rpb24tcmVzcG9uc2UnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVmaW5pdGlvbiB9IGZyb20gJy4uLy4uL2VudGl0eS9wcm9jZXNzZGVmaW5pdGlvbic7XHJcbmltcG9ydCB7IEFzc2lnbmVlSW5mbyB9IGZyb20gJy4uLy4uL2VudGl0eS9jb21wbGV0ZS1yZXNwb25zZSc7XHJcbmltcG9ydCB7IEFzc2lnblBhcnRpY2lwYW50Q29tcG9uZW50IH0gZnJvbSAnLi4vYXNzaWduLXBhcnRpY2lwYW50L2Fzc2lnbi1wYXJ0aWNpcGFudC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBJMThuU2VydmljZSB9IGZyb20gJy4uLy4uL3J1bnRpbWUvc2VydmljZXMvaTE4bi5zZXJ2aWNlJztcclxuXHJcbi8qKlxyXG4gKiDmj5DkuqTlrqHmibnlrqLmiLfnq6/kuqTkupLmnI3liqFcclxuICovXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFdGU3VibWl0ZVNlcnZpY2Uge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpMThuU2VydmljZTogSTE4blNlcnZpY2VcclxuICAgICkgeyB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlrqLmiLfnq6/kuqTkupLlpITnkIbmnI3liqHnq6/ov5Tlm57nu5PmnpxcclxuICAgICAqIEBwYXJhbSBleGN1dGlvblJlIOaPkOS6pOWuoeaJueacjeWKoeWZqOerr+i/lOWbnue7k+aenFxyXG4gICAgICogQHBhcmFtIGhhbmRsZXIg5aSE55CG57uT5p6c5Zue6LCD6aG16Z2iXHJcbiAgICAgKi9cclxuICAgIGV4Y3V0ZShleGN1dGlvblJlOiBFeGN1dGlvblJlc3BvbnNlLCBoYW5kbGVyOiAocmVzdWx0OiBJbnRlcmFjdGlvblJlc3BvbnNlKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgSW50ZXJhY3Rpb25SZXNwb25zZSgpO1xyXG4gICAgICAgIC8vIOaXoOmcgOS6pOS6klxyXG4gICAgICAgIGlmIChleGN1dGlvblJlLm5lZWRJbnRlcmFjdGlvbiA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9ICfml6DpnIDkuqTkupInO1xyXG4gICAgICAgICAgICBoYW5kbGVyKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDpgInmi6nopoHmj5DkuqTnmoTmtYHnqItcclxuICAgICAgICBpZiAoZXhjdXRpb25SZS5wcm9jRGVmcyAmJiBleGN1dGlvblJlLnByb2NEZWZzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RQcm9jZXNzKGV4Y3V0aW9uUmUucHJvY0RlZnMsIGhhbmRsZXIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOaMh+WumuS4i+S4gOatpeWPguS4juiAhVxyXG4gICAgICAgIGlmIChleGN1dGlvblJlLm5leHRGbG93Tm9kZXNbMF0uYXNzaWduZWVJbmZvKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXNzaWduZWUoW2V4Y3V0aW9uUmUubmV4dEZsb3dOb2Rlc1swXS5hc3NpZ25lZUluZm9dLCBoYW5kbGVyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWkhOeQhumAieaLqea1geeoi+e7k+aenFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHNlbGVjdFByb2Nlc3MocHJjZXNzZXM6IFByb2Nlc3NEZWZpbml0aW9uW10sIGhhbmRsZXI6IChyZXN1bHQ6IEludGVyYWN0aW9uUmVzcG9uc2UpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IG5ldyBJbnRlcmFjdGlvblJlc3BvbnNlKCk7XHJcbiAgICAgICAgY29uc3QgbW9kYWxDb25maWc6IE1vZGFsT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgdGl0bGU6IHRoaXMuaTE4blNlcnZpY2UgPyB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMuc3VibWl0LnNlbGVjdFByb2Nlc3MnKSA6ICfmtYHnqIvpgInmi6knLFxyXG4gICAgICAgICAgICB3aWR0aDogNTIwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDI5MCxcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgYmVmb3JlQ2xvc2U6IChtb2RlbFJlZjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVyKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZih0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCk7XHJcbiAgICAgICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdyaWREYXRhID0gcHJjZXNzZXM7XHJcbiAgICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5zdWJzY3JpYmUoKS5zdWJzY3JpYmUodmFsID0+IHtcclxuICAgICAgICAgICAgcmVzcG9uc2UucHJvY2Vzc0RlZmluaXRpb25JZCA9IHZhbDtcclxuICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgZXJyID0+IHtcclxuICAgICAgICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IGVycjtcclxuICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWkhOeQhuaMh+WumuS4i+S4gOatpeS6uuWRmOe7k+aenFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGFzc2lnbmVlKGFzc2lnbmVlSW5mb3M6IEFzc2lnbmVlSW5mb1tdLCBoYW5kbGVyPzogKHJlc3VsdDogSW50ZXJhY3Rpb25SZXNwb25zZSkgPT4gdm9pZCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbmV3IEludGVyYWN0aW9uUmVzcG9uc2UoKTtcclxuICAgICAgICBjb25zdCBtb2RhbENvbmZpZzogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZSA/IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5hc3NpZ25lZS50aXRsZScpIDogJ+ivt+mAieaLqeaTjeS9nOeUqOaItycsXHJcbiAgICAgICAgICAgIHdpZHRoOiA4NTAsXHJcbiAgICAgICAgICAgIGhlaWdodDogNTIwLFxyXG4gICAgICAgICAgICBzaG93TWF4QnV0dG9uOiBmYWxzZSxcclxuICAgICAgICAgICAgc2hvd0J1dHRvbnM6IGZhbHNlLFxyXG4gICAgICAgICAgICBiZWZvcmVDbG9zZTogKG1vZGVsUmVmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZXIocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoQXNzaWduUGFydGljaXBhbnRDb21wb25lbnQpO1xyXG4gICAgICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5hc3NpZ25lZUluZm8gPSBhc3NpZ25lZUluZm9zO1xyXG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2Uuc3Vic2NyaWJlKCkuc3Vic2NyaWJlKHZhbCA9PiB7XHJcbiAgICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0sIGVyciA9PiB7XHJcbiAgICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
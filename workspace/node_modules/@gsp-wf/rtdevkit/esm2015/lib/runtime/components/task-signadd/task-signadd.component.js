/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { UserHelperComponent } from '../user-helper/user-helper.component';
import { TaskService } from '../../services/task.service';
import { UserService } from '../../services/user.service';
import { NotifyService } from '@farris/ui-notify';
import { I18nService } from '../../services/i18n.service';
export class TaskSignaddComponent extends UserHelperComponent {
    /**
     * @param {?} taskSvc
     * @param {?} userSvc
     * @param {?} notify
     * @param {?} i18nService
     */
    constructor(taskSvc, userSvc, notify, i18nService) {
        super(i18nService, userSvc);
        this.taskSvc = taskSvc;
        this.userSvc = userSvc;
        this.notify = notify;
        this.i18nService = i18nService;
        this.completed = new EventEmitter();
        this.paginationOptions.id = 'WF-SignAdd-DataTable-Pagination';
    }
    /**
     * @param {?} context
     * @return {?}
     */
    set addsign_context(context) {
        this.selectedUsers = [];
        this.addSignContext = Object.assign({}, context, { assignees: [] });
        this.showModal(!!this.addSignContext.workItemId);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    handleOk() {
        this.selectedUsers = this.userTable.selections;
        // 征询
        if (this.addSignContext.action === 'AddSignFront') {
            // 需要校验选中用户
            if (!this.selectedUsers || this.selectedUsers.length < 1) {
                this.notify.info(this.i18nService.getValue('static.addsign.selectConsultant'));
                return;
            }
            this.addSignContext.assignees = this.selectedUsers.map((/**
             * @param {?} user
             * @return {?}
             */
            user => user.ID));
            this.taskSvc.addSign(this.addSignContext).subscribe((/**
             * @return {?}
             */
            () => {
                this.notify.success(this.i18nService.getValue('static.addsign.successConsult'));
                this.completed.emit(true);
                this.showModal(false);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                if (error && error.error && error.error.Message) {
                    this.notify.error(error.error.Message);
                }
            }));
        }
        else {
            // 加签
            this.completed.emit(true);
            this.showModal(false);
        }
    }
}
TaskSignaddComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf-task-signadd',
                template: "<farris-dialog #allUserDialog [buttons]=\"buttonRef\" [width]=\"850\" [height]=\"520\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\">\r\n  <div class=\"d-flex flex-column my-data-grid h-100\" style=\"padding: 0 14px;\">\r\n    <div class=\"flex-auto\" style=\"position:relative;\">\r\n      <farris-datatable #allUserTable [columns]=\"columns\" [data]=\"userListData | paginate: paginationOptions\"\r\n        [showFilterBar]='true' [singleSelect]=\"singleSelect\" [idField]=\"'ID'\" [remote]=\"'server'\" (search)=\"search($event)\"\r\n        [pagination]='false'></farris-datatable>\r\n    </div>\r\n    <div style=\"position:relative;\">\r\n      <pagination-controls [id]=\"paginationOptions.id\" [previousLabel]=\"' '\" [nextLabel]=\"' '\"\r\n        (pageChange)=\"onPageChange($event)\" (pageSizeChange)=\"onPageSizeChange($event)\">\r\n      </pagination-controls>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"handleOk()\">\u786E\u5B9A</button>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"handleCancel()\">\u53D6\u6D88</button>\r\n</ng-template>",
                styles: [".my-data-grid .filter-row .search-fields{padding-left:0!important}.my-data-grid .filter-row .search-text{padding-right:0!important}"]
            }] }
];
/** @nocollapse */
TaskSignaddComponent.ctorParameters = () => [
    { type: TaskService },
    { type: UserService },
    { type: NotifyService },
    { type: I18nService }
];
TaskSignaddComponent.propDecorators = {
    addsign_context: [{ type: Input }],
    completed: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    TaskSignaddComponent.prototype.completed;
    /** @type {?} */
    TaskSignaddComponent.prototype.addSignContext;
    /**
     * @type {?}
     * @private
     */
    TaskSignaddComponent.prototype.taskSvc;
    /**
     * @type {?}
     * @protected
     */
    TaskSignaddComponent.prototype.userSvc;
    /**
     * @type {?}
     * @protected
     */
    TaskSignaddComponent.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    TaskSignaddComponent.prototype.i18nService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1zaWduYWRkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2YvcnRkZXZraXQvIiwic291cmNlcyI6WyJsaWIvcnVudGltZS9jb21wb25lbnRzL3Rhc2stc2lnbmFkZC90YXNrLXNpZ25hZGQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9FLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQU8xRCxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsbUJBQW1COzs7Ozs7O0lBa0IzRCxZQUNVLE9BQW9CLEVBQ2xCLE9BQW9CLEVBQ3BCLE1BQXFCLEVBQ3JCLFdBQXdCO1FBRWxDLEtBQUssQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFMcEIsWUFBTyxHQUFQLE9BQU8sQ0FBYTtRQUNsQixZQUFPLEdBQVAsT0FBTyxDQUFhO1FBQ3BCLFdBQU0sR0FBTixNQUFNLENBQWU7UUFDckIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFicEMsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFnQmxDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEdBQUcsaUNBQWlDLENBQUM7SUFDaEUsQ0FBQzs7Ozs7SUF4QkQsSUFDVyxlQUFlLENBQUMsT0FBWTtRQUNyQyxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsY0FBYyxxQkFBUSxPQUFPLElBQUUsU0FBUyxFQUFFLEVBQUUsR0FBRSxDQUFDO1FBQ3BELElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkQsQ0FBQzs7OztJQXFCRCxRQUFRO0lBQ1IsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO1FBQy9DLEtBQUs7UUFDTCxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxLQUFLLGNBQWMsRUFBRTtZQUNqRCxXQUFXO1lBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUN4RCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLENBQUM7Z0JBQy9FLE9BQU87YUFDUjtZQUNELElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRzs7OztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBQyxDQUFDO1lBQ3hFLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxTQUFTOzs7WUFBQyxHQUFHLEVBQUU7Z0JBQ3ZELElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLCtCQUErQixDQUFDLENBQUMsQ0FBQztnQkFDaEYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDeEIsQ0FBQzs7OztZQUFFLEtBQUssQ0FBQyxFQUFFO2dCQUNULElBQUcsS0FBSyxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUU7b0JBQzlDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQ3hDO1lBQ0gsQ0FBQyxFQUFDLENBQUM7U0FDSjthQUFNO1lBQ0wsS0FBSztZQUNMLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDdkI7SUFDSCxDQUFDOzs7WUE1REYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLDhvQ0FBd0Q7O2FBRXpEOzs7O1lBVFEsV0FBVztZQUNYLFdBQVc7WUFDWCxhQUFhO1lBQ2IsV0FBVzs7OzhCQVNqQixLQUFLO3dCQU1MLE1BQU07Ozs7SUFBUCx5Q0FDb0M7O0lBR3BDLDhDQUtFOzs7OztJQUVBLHVDQUE0Qjs7Ozs7SUFDNUIsdUNBQThCOzs7OztJQUM5QixzQ0FBK0I7Ozs7O0lBQy9CLDJDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVXNlckhlbHBlckNvbXBvbmVudCB9IGZyb20gJy4uL3VzZXItaGVscGVyL3VzZXItaGVscGVyLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRhc2tTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGFzay5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVXNlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy91c2VyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBJMThuU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2kxOG4uc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dmLXRhc2stc2lnbmFkZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuLi91c2VyLWhlbHBlci91c2VyLWhlbHBlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdGFzay1zaWduYWRkLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGFza1NpZ25hZGRDb21wb25lbnQgZXh0ZW5kcyBVc2VySGVscGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IGFkZHNpZ25fY29udGV4dChjb250ZXh0OiBhbnkpIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRVc2VycyA9IFtdO1xyXG4gICAgdGhpcy5hZGRTaWduQ29udGV4dCA9IHsgLi4uY29udGV4dCwgYXNzaWduZWVzOiBbXSB9O1xyXG4gICAgdGhpcy5zaG93TW9kYWwoISF0aGlzLmFkZFNpZ25Db250ZXh0LndvcmtJdGVtSWQpO1xyXG4gIH1cclxuICBAT3V0cHV0KClcclxuICBjb21wbGV0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLy8g5omn6KGM5Yqg562+5LiK5LiL5paH5Y+C5pWwXHJcbiAgYWRkU2lnbkNvbnRleHQ6IHtcclxuICAgIHdvcmtJdGVtSWQ6IHN0cmluZyxcclxuICAgIGFjdGlvbjogJ0FkZFNpZ25Gcm9udCcgfCAnQWRkU2lnbkJlaGluZCcsXHJcbiAgICBhc3NpZ25lZXM6IHN0cmluZ1tdLFxyXG4gICAgY29tbWVudDogJycvLyBUT0RPOiDliqDnrb7ml6Xlv5dcclxuICB9O1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSB0YXNrU3ZjOiBUYXNrU2VydmljZSxcclxuICAgIHByb3RlY3RlZCB1c2VyU3ZjOiBVc2VyU2VydmljZSxcclxuICAgIHByb3RlY3RlZCBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgaTE4blNlcnZpY2U6IEkxOG5TZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICBzdXBlcihpMThuU2VydmljZSwgdXNlclN2Yyk7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLmlkID0gJ1dGLVNpZ25BZGQtRGF0YVRhYmxlLVBhZ2luYXRpb24nO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVPaygpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRVc2VycyA9IHRoaXMudXNlclRhYmxlLnNlbGVjdGlvbnM7XHJcbiAgICAvLyDlvoHor6JcclxuICAgIGlmICh0aGlzLmFkZFNpZ25Db250ZXh0LmFjdGlvbiA9PT0gJ0FkZFNpZ25Gcm9udCcpIHtcclxuICAgICAgLy8g6ZyA6KaB5qCh6aqM6YCJ5Lit55So5oi3XHJcbiAgICAgIGlmICghdGhpcy5zZWxlY3RlZFVzZXJzIHx8IHRoaXMuc2VsZWN0ZWRVc2Vycy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMuYWRkc2lnbi5zZWxlY3RDb25zdWx0YW50JykpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmFkZFNpZ25Db250ZXh0LmFzc2lnbmVlcyA9IHRoaXMuc2VsZWN0ZWRVc2Vycy5tYXAodXNlciA9PiB1c2VyLklEKTtcclxuICAgICAgdGhpcy50YXNrU3ZjLmFkZFNpZ24odGhpcy5hZGRTaWduQ29udGV4dCkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5hZGRzaWduLnN1Y2Nlc3NDb25zdWx0JykpO1xyXG4gICAgICAgIHRoaXMuY29tcGxldGVkLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5zaG93TW9kYWwoZmFsc2UpO1xyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgaWYoZXJyb3IgJiYgZXJyb3IuZXJyb3IgJiYgZXJyb3IuZXJyb3IuTWVzc2FnZSkge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuZXJyb3IoZXJyb3IuZXJyb3IuTWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOWKoOetvlxyXG4gICAgICB0aGlzLmNvbXBsZXRlZC5lbWl0KHRydWUpO1xyXG4gICAgICB0aGlzLnNob3dNb2RhbChmYWxzZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { TaskService } from '../services/task.service';
import { CompleteContext } from '../../entity';
import { NotifyService } from '@farris/ui-notify';
import { TaskSignaddComponent } from '../components/task-signadd/task-signadd.component';
import { DialogComponent } from '@farris/ui-dialog';
import { from } from 'rxjs';
import { I18nService } from '../services/i18n.service';
export class WfWorkitemHandleComponent {
    /**
     * @param {?} taskSvc
     * @param {?} notify
     * @param {?} i18nService
     */
    constructor(taskSvc, notify, i18nService) {
        this.taskSvc = taskSvc;
        this.notify = notify;
        this.i18nService = i18nService;
        this.completeContext = new CompleteContext();
        // 加签选中人
        this.displayPlaceholder = "请选择"; //跳转的默认显示节点
        //跳转的默认显示节点
        this.hasDefaultBranch = true;
        /**
         * 任务办理动作列表
         */
        this.actions = new EventEmitter();
        /**
         * 任务办理完成事件
         */
        this.completed = new EventEmitter();
        // 当前选中动作和动作实现
        this.preFuncList = [];
        this.postFuncList = [];
        // 弹框高度设置
        this.height = 420;
        this.actionsTitle = {
            pass: '',
            back: '',
            refuse: '',
            more: '',
            viewLog: '',
            viewFlowChart: '',
            viewBizlog: ''
        };
        /** @type {?} */
        const titles = this.i18nService.getValue('static.taskActions');
        Object.keys(this.actionsTitle).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            this.actionsTitle[key] = titles[key];
        }));
    }
    /**
     * 任务Id
     * @param {?} workitemId
     * @return {?}
     */
    set workitemId(workitemId) {
        this.inWorkitemId = (workitemId && workitemId.trim());
        if (this.inWorkitemId) {
            this.refreshActions();
        }
    }
    /**
     * @return {?}
     */
    get workitemId() {
        return this.inWorkitemId;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * 刷新动作列表
     * @private
     * @return {?}
     */
    refreshActions() {
        this.taskSvc.getWorkItemActions(this.inWorkitemId).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            // 临时方案：oData不支持自定义function $expand展开，临时序列化处理
            this.taskActions = re.map((/**
             * @param {?} action
             * @return {?}
             */
            action => {
                action.parameters = JSON.parse(action.parameters);
                return action;
            }));
            this.taskActions = this.taskActions.filter((/**
             * @param {?} a
             * @return {?}
             */
            a => a.code !== 'ViewBizLog'
                && a.code !== 'ViewFlowChart'
                && a.code !== 'ViewExecuteForm'));
            this.actions.emit(this.taskActions);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.showError(error);
        }));
    }
    /**
     * 动作完成后事件
     * @private
     * @param {?=} result 事件结果
     * @return {?}
     */
    completedEvt(result = true) {
        if (result) {
            this.refreshActions();
        }
        this.completed.emit(result);
    }
    /**
     * 完成审批任务
     * @param {?} actionCode 任务办理动作编号
     * @param {?=} comment
     * @return {?}
     */
    complete(actionCode, comment) {
        switch (actionCode) {
            case 'AssignUser': { // 指派
                this.assignee(this.inWorkitemId);
                break;
            }
            case 'Claim': // 领用
                this.taskSvc.claim(this.inWorkitemId).subscribe((/**
                 * @param {?} r
                 * @return {?}
                 */
                r => {
                    this.notify.success(this.i18nService.getValue('cueWords.successClaim'));
                    this.refreshActions();
                    this.completed.emit(false);
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.showError(error);
                }));
                break;
            case 'Unclaim': // 取消领用
                this.taskSvc.unClaim(this.inWorkitemId).subscribe((/**
                 * @param {?} r
                 * @return {?}
                 */
                r => {
                    this.notify.success(this.i18nService.getValue('cueWords.successUnClaim'));
                    this.refreshActions();
                    this.completed.emit(false);
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.showError(error);
                }));
                break;
            case 'Retrieve': // 取回
                this.taskSvc.retrieve({ workItemId: this.inWorkitemId, comment }).subscribe((/**
                 * @param {?} r
                 * @return {?}
                 */
                r => {
                    this.notify.success(this.i18nService.getValue('cueWords.successRetrieve'));
                    this.completedEvt();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    this.showError(error);
                }));
                break;
            case 'Transfer': { // 移交
                this.transferContext = {
                    workItemId: this.inWorkitemId,
                    comment
                };
                break;
            }
            case 'AddSignFront': // 征询
                this.addSignContext = {
                    workItemId: this.inWorkitemId,
                    action: 'AddSignFront'
                };
                break;
            default:
                this.executeTask(actionCode, comment);
        }
    }
    /**
     * @param {?} sucess
     * @return {?}
     */
    refreshList(sucess) {
        this.completedEvt(sucess);
    }
    // 弹出加签帮助
    /**
     * @return {?}
     */
    runAddSign() {
        this.addSignContext = {
            workItemId: this.inWorkitemId,
            action: 'AddSignBehind'
        };
    }
    // 加签完成
    /**
     * @param {?} sucess
     * @return {?}
     */
    addSignComplete(sucess) {
        if (this.addSignContext.action === 'AddSignFront') {
            this.refreshList(sucess);
        }
        else {
            this.completeContext.signAssignees = this.addSignCmp.selectedUsers.map((/**
             * @param {?} user
             * @return {?}
             */
            user => user.ID));
            this.selectAddSignees = this.addSignCmp.selectedUsers.map((/**
             * @param {?} user
             * @return {?}
             */
            user => user.Name)).join(',');
        }
    }
    // 审批确认
    /**
     * @return {?}
     */
    handleOk() {
        if (!this.completeContext.comment) {
            this.notify.info("请输入审批意见");
            return;
        }
        if (!this.hasDefaultBranch && this.completeContext.destinationActivityId.length <= 0) { //没有默认分支并且用户没选择跳转节点，不允许提交
            this.notify.info("请选择目标节点");
            return;
        }
        this.taskSvc.excuteTask(this.inWorkitemId, this.completeContext).subscribe((/**
         * @param {?} cr
         * @return {?}
         */
        (cr) => {
            this.commentModal.close();
            // 完成工作项后，检查是否需要执行后事件
            this.excutePostEvent();
            if (this.completeContext.conclusionValue === 'Pass') {
                this.notify.success(this.i18nService.getValue('cueWords.successPass'));
            }
            else if (this.completeContext.conclusionValue === 'Back') {
                this.notify.success(this.i18nService.getValue('cueWords.successBack'));
            }
            else if (this.completeContext.conclusionValue === 'Refuse') {
                this.notify.success(this.i18nService.getValue('cueWords.successRefuse'));
            }
            else {
                this.notify.success(this.i18nService.getValue('cueWords.success'));
            }
            if (cr.needInteraction) {
                this.refreshActions(); //通过后弹出指派 add by fpf
                this.assigneeInfos = [cr.nextFlowNodes[0].assigneeInfo];
            }
            else {
                this.completedEvt();
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.showError(error);
        }));
    }
    // 取消操作
    /**
     * @return {?}
     */
    handleCancel() {
        this.completeContext = new CompleteContext();
        this.commentModal.close();
    }
    // 指派操作
    /**
     * @private
     * @param {?} workItemId
     * @return {?}
     */
    assignee(workItemId) {
        this.taskSvc.getAssigneeInfo(workItemId).subscribe((/**
         * @param {?} info
         * @return {?}
         */
        (info) => {
            info.assigneeInfo.workItemId = workItemId; //兼容处理，此处返回的workitemid为null
            this.assigneeInfos = [info.assigneeInfo];
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.showError(error);
        }));
    }
    // 重新初始化当前参数
    /**
     * @private
     * @return {?}
     */
    initState() {
        this.selectAddSignees = '';
        this.destActivities = null;
        this.needAddSign = false;
    }
    /**
     * @private
     * @param {?} actionCode
     * @param {?=} opinion
     * @return {?}
     */
    executeTask(actionCode, opinion) {
        this.initState();
        this.completeContext = {
            workItemId: this.inWorkitemId,
            conclusionValue: actionCode,
            comment: '',
            signAssignees: [],
            // 加签人员
            destinationActivityId: '' // 目标节点
        };
        this.completeContext.comment = actionCode === 'Pass' ? this.actionsTitle.pass : '';
        if (opinion) {
            this.completeContext.comment = opinion;
        }
        /** @type {?} */
        const action = this.taskActions.find((/**
         * @param {?} a
         * @return {?}
         */
        a => a.code === actionCode));
        this.taskSvc.getActionEntity(this.workitemId, actionCode).subscribe((/**
         * @param {?} act
         * @return {?}
         */
        (act) => {
            if (!act) { // 审批动作已删除，走完成工作项  TODO: 非完成工作项动作如何处理？
                this.showExcuteModal(action);
            }
            else {
                from(this.excuteAction(act)).subscribe((/**
                 * @return {?}
                 */
                () => {
                    if (!act.webComponent) {
                        this.showExcuteModal(action);
                    }
                }));
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.showError(error);
        }));
    }
    /**
     * 加签，跳转情况
     * @private
     * @param {?} action 动作
     * @return {?}
     */
    showExcuteModal(action) {
        // 动作参数按照
        if (action && action.parameters) {
            // 跳转、驳回场景
            if (action.parameters.SelectTargetAble === 'True' || action.parameters.SelectTargetAble === 'true') {
                // this.taskSvc.getDestinationScope(this.inWorkitemId, action.code).subscribe((re: { id: string, name: string }[]) => {
                //   this.destActivities = re;
                // });
                this.getDestinationNodes(this.inWorkitemId, action.code);
            }
            // 需要加签
            if (action.parameters.AddSignBehindAble === 'True' || action.parameters.AddSignBehindAble === 'true') {
                this.needAddSign = true;
            }
        }
        this.commentModal.show();
    }
    /**
     * @private
     * @param {?} workItemId
     * @param {?} actionCode
     * @return {?}
     */
    getDestinationNodes(workItemId, actionCode) {
        /** @type {?} */
        var nextNodes = [];
        this.taskSvc.getDestinationScope(workItemId, actionCode).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            nextNodes = re;
            /** @type {?} */
            const des = re.map((/**
             * @param {?} a
             * @return {?}
             */
            a => a.nodeInfoList));
            /** @type {?} */
            let list = [];
            des.forEach((/**
             * @param {?} i
             * @return {?}
             */
            i => {
                list = list.concat(i);
            }));
            this.destActivities = list.map((/**
             * @param {?} i
             * @return {?}
             */
            i => ({ id: i.activityDefinitionId, name: i.activityDefinitionName })));
            this.hasDefaultBranch = this.hasDefaultBranchFunc(nextNodes);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.showError(error);
        }));
    }
    /**
     * 跳转，返回的数据是否有默认分支
     * 如果返回的没有默认节点，跳转节点又没选的话，不允许提交
     * @private
     * @param {?} nextNodes
     * @return {?}
     */
    hasDefaultBranchFunc(nextNodes) {
        for (let i = 0; i < nextNodes.length; i++) {
            if (nextNodes[i].defaultBranch) {
                this.displayPlaceholder = nextNodes[i].nodeInfoList[0].activityDefinitionName;
                return true;
            }
        }
        return false;
    }
    /**
     * @private
     * @param {?} act
     * @return {?}
     */
    excuteAction(act) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.getActionWebEventsFunc(act);
            if (this.preFuncList && this.preFuncList.length > 0) {
                for (let i = 0; i < this.preFuncList.length; i++) {
                    this.preFuncList.filter((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => item.index === i))[0].func();
                }
            }
            if (this.webCptFunc) {
                this.webCptFunc();
            }
        });
    }
    /**
     * @private
     * @return {?}
     */
    excutePostEvent() {
        if (this.postFuncList && this.postFuncList.length > 0) {
            for (let i = 0; i < this.postFuncList.length; i++) {
                this.postFuncList.filter((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item.index === i))[0].func();
            }
        }
    }
    /**
     * 获取动作的前后事件和实现方法
     * @private
     * @param {?} act 动作
     * @return {?}
     */
    getActionWebEventsFunc(act) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            this.preFuncList = [];
            this.webCptFunc = null;
            this.postFuncList = [];
            /** @type {?} */
            const reqMap = [];
            /** @type {?} */
            let preIndex = 0;
            /** @type {?} */
            let postIndex = 0;
            if (act.preEvent && act.preEvent.length > 0) {
                for (const e of act.preEvent) {
                    /** @type {?} */
                    const pre = {
                        event: 'pre',
                        index: preIndex++,
                        funcName: e.component.split('#')[1],
                        req: System.import(e.component.split('#')[0])
                    };
                    reqMap.push(pre);
                }
            }
            if (act.webComponent) {
                /** @type {?} */
                const cpt = {
                    event: 'cpt',
                    index: 0,
                    funcName: act.webComponent.split('#')[1],
                    req: System.import(act.webComponent.split('#')[0])
                };
                reqMap.push(cpt);
            }
            if (act.postEvent && act.postEvent.length > 0) {
                for (const a of act.postEvent) {
                    /** @type {?} */
                    const post = {
                        event: 'post',
                        index: postIndex++,
                        funcName: a.component.split('#')[1],
                        req: System.import(a.component.split('#')[0])
                    };
                    reqMap.push(post);
                }
            }
            for (const r of reqMap) {
                /** @type {?} */
                const m = yield r.req;
                if (r.event === 'pre') {
                    this.preFuncList.push({
                        index: r.index,
                        func: m.default[r.funcName]
                    });
                }
                else if (r.event === 'post') {
                    this.postFuncList.push({
                        index: r.index,
                        func: m.default[r.funcName]
                    });
                }
                else {
                    this.webCptFunc = m.default[r.funcName];
                }
            }
        });
    }
    /**
     * 显示报错信息
     * @private
     * @param {?} error
     * @return {?}
     */
    showError(error) {
        if (error && error.error && error.error.Message) {
            this.notify.error(error.error.Message);
        }
        else {
            this.notify.error(error);
        }
    }
}
WfWorkitemHandleComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf-workitem-handle',
                template: "<farris-dialog #commentModal [enableScroll]= \"false\" [buttons]=\"buttonRef\" [width]=\"550\" [height]=\"360\" [title]=\"'static.title' | translate\">\r\n    <div style=\"padding: 20px;\">\r\n        <div>\r\n            <wf-comment class=\"w-100\" [(ngModel)]=\"completeContext.comment\" name=\"comment\"\r\n                [placeholder]=\"'static.inputHolder' | translate\"></wf-comment>\r\n        </div>\r\n        <div class=\"d-flex\" style=\"height:28px;overflow: hidden;\">\r\n            <div *ngIf=\"needAddSign\" style=\"flex:1;display: flex;height:28px;overflow: hidden;\" [ngStyle]=\"{'padding-right': destActivities ? '20px' : '0px'}\">\r\n                <label style=\"padding-right: 10px;line-height: 24px;\">{{ 'static.addSignee' | translate }}</label>\r\n                <div class=\"d-flex\" style=\"flex: 1\">\r\n                    <div class=\"input-group\">\r\n                        <input type=\"text\" class=\"form-control\" [(ngModel)]=\"selectAddSignees\" [readOnly]=\"true\" placeholder=\"\u8BF7\u9009\u62E9\"/>\r\n                        <button class=\"k-button k-bare\" type=\"button\" (click)=\"runAddSign()\">\r\n                            <i class=\"f-icon f-icon-lookup\" style=\"color: #bfbfbf; margin: 0 -8px 0 0;\"></i>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div *ngIf=\"destActivities\" style=\"flex:1;display: flex;height:28px;overflow: hidden;\">\r\n                <label style=\"padding-right: 10px;line-height: 24px;\">{{ 'static.selectActivity' | translate }}</label>\r\n                <div class=\"d-flex\" style=\"flex:1\">\r\n                    <farris-combo-list  [data]=\"destActivities\" [textField]=\"'name'\" [valueField]=\"'id'\" [idField]=\"'id'\"\r\n                        [(ngModel)]=\"completeContext.destinationActivityId\" style=\"flex: 1;\" [placeholder] = \"displayPlaceholder\">\r\n                    </farris-combo-list >\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n    <button class=\"btn btn-sm btn-primary px-3\" (click)=\"handleOk()\">{{\r\n            'static.footOk' | translate }}</button>\r\n    <button class=\"btn btn-sm btn-default px-3\" (click)=\"handleCancel()\">{{\r\n            'static.footCancel' | translate }}</button>\r\n</ng-template>\r\n\r\n<!-- \u6307\u6D3E -->\r\n<wf-task-assign [assigneeInfo]=\"assigneeInfos\" (completed)=\"refreshList($event)\"></wf-task-assign>\r\n<!-- \u79FB\u4EA4 -->\r\n<wf-task-transfer [transfer_context]=\"transferContext\" (completed)=\"refreshList($event)\"></wf-task-transfer>\r\n<!-- \u52A0\u7B7E\u3001\u5F81\u8BE2 -->\r\n<wf-task-signadd [addsign_context]=\"addSignContext\" (completed)=\"addSignComplete($event)\"></wf-task-signadd>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
WfWorkitemHandleComponent.ctorParameters = () => [
    { type: TaskService },
    { type: NotifyService },
    { type: I18nService }
];
WfWorkitemHandleComponent.propDecorators = {
    addSignCmp: [{ type: ViewChild, args: [TaskSignaddComponent,] }],
    commentModal: [{ type: ViewChild, args: ['commentModal',] }],
    workitemId: [{ type: Input }],
    actions: [{ type: Output }],
    completed: [{ type: Output }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    WfWorkitemHandleComponent.prototype.inWorkitemId;
    /**
     * @type {?}
     * @private
     */
    WfWorkitemHandleComponent.prototype.taskActions;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.completeContext;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.assigneeInfos;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.transferContext;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.destActivities;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.addSignContext;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.needAddSign;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.selectAddSignees;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.displayPlaceholder;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.hasDefaultBranch;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.addSignCmp;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.commentModal;
    /**
     * 任务办理动作列表
     * @type {?}
     */
    WfWorkitemHandleComponent.prototype.actions;
    /**
     * 任务办理完成事件
     * @type {?}
     */
    WfWorkitemHandleComponent.prototype.completed;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.preFuncList;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.webCptFunc;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.postFuncList;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.height;
    /** @type {?} */
    WfWorkitemHandleComponent.prototype.actionsTitle;
    /**
     * @type {?}
     * @private
     */
    WfWorkitemHandleComponent.prototype.taskSvc;
    /**
     * @type {?}
     * @private
     */
    WfWorkitemHandleComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    WfWorkitemHandleComponent.prototype.i18nService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Ytd29ya2l0ZW0taGFuZGxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2YvcnRkZXZraXQvIiwic291cmNlcyI6WyJsaWIvcnVudGltZS93Zi13b3JraXRlbS1oYW5kbGUvd2Ytd29ya2l0ZW0taGFuZGxlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUV2RCxPQUFPLEVBQUUsZUFBZSxFQUFrQyxNQUFNLGNBQWMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFDekYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBELE9BQU8sRUFBRSxJQUFJLEVBQWtCLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQVV2RCxNQUFNLE9BQU8seUJBQXlCOzs7Ozs7SUFtRXBDLFlBQ1UsT0FBb0IsRUFDcEIsTUFBcUIsRUFDckIsV0FBd0I7UUFGeEIsWUFBTyxHQUFQLE9BQU8sQ0FBYTtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3JCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBbkVsQyxvQkFBZSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUM7O1FBY3hDLHVCQUFrQixHQUFXLEtBQUssQ0FBQyxDQUFBLFdBQVc7O1FBQzlDLHFCQUFnQixHQUFHLElBQUksQ0FBQzs7OztRQXVCeEIsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFvQixDQUFDOzs7O1FBTS9DLGNBQVMsR0FBRyxJQUFJLFlB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NENBQTRCOzs7OztJQUM1QiwyQ0FBNkI7Ozs7O0lBQzdCLGdEQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUYXNrU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3Rhc2suc2VydmljZSc7XHJcbmltcG9ydCB7IFdvcmtpdGVtQWN0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L3dvcmtpdGVtLWFjdGlvbic7XHJcbmltcG9ydCB7IENvbXBsZXRlQ29udGV4dCwgQXNzaWduZWVJbmZvLCBDb21wbGV0ZVJlc3BvbnNlIH0gZnJvbSAnLi4vLi4vZW50aXR5JztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgVGFza1NpZ25hZGRDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL3Rhc2stc2lnbmFkZC90YXNrLXNpZ25hZGQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBBY3Rpb25FbnRpdHkgfSBmcm9tICcuLi8uLi9lbnRpdHkvYWN0aW9uLWVudGl0eSc7XHJcbmltcG9ydCB7IGZyb20sIG9mLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEkxOG5TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaTE4bi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTmV4dE5vZGUgfSBmcm9tICcuLi8uLi9lbnRpdHkvZGVzdGluYXRpb24tbm9kZXMnO1xyXG5pbXBvcnQgeyBGbG93Tm9kZUluZm8gfSBmcm9tICcuLi8uLi9lbnRpdHkvZXhjdXRpb24tcmVzcG9uc2UnO1xyXG5cclxuZGVjbGFyZSBjb25zdCBTeXN0ZW06IGFueTtcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd3Zi13b3JraXRlbS1oYW5kbGUnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi93Zi13b3JraXRlbS1oYW5kbGUuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3dmLXdvcmtpdGVtLWhhbmRsZS5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFdmV29ya2l0ZW1IYW5kbGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIHByaXZhdGUgaW5Xb3JraXRlbUlkOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSB0YXNrQWN0aW9uczogV29ya2l0ZW1BY3Rpb25bXTtcclxuICBjb21wbGV0ZUNvbnRleHQgPSBuZXcgQ29tcGxldGVDb250ZXh0KCk7XHJcbiAgYXNzaWduZWVJbmZvczogQXNzaWduZWVJbmZvW107XHJcbiAgdHJhbnNmZXJDb250ZXh0OiB7XHJcbiAgICB3b3JrSXRlbUlkOiBzdHJpbmcsXHJcbiAgICBjb21tZW50OiBzdHJpbmdcclxuICB9O1xyXG4gIGRlc3RBY3Rpdml0aWVzOiB7IGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZyB9W107XHJcbiAgLy8g5Yqg562+5b6B6K+i5LiK5LiL5paH5Y+C5pWwXHJcbiAgYWRkU2lnbkNvbnRleHQ6IHtcclxuICAgIHdvcmtJdGVtSWQ6IHN0cmluZyxcclxuICAgIGFjdGlvbjogJ0FkZFNpZ25Gcm9udCcgfCAnQWRkU2lnbkJlaGluZCdcclxuICB9O1xyXG4gIG5lZWRBZGRTaWduOiBib29sZWFuOyAvLyDmmK/lkKbpnIDopoHliqDnrb5cclxuICBzZWxlY3RBZGRTaWduZWVzOiBzdHJpbmc7IC8vIOWKoOetvumAieS4reS6ulxyXG4gIGRpc3BsYXlQbGFjZWhvbGRlcjogc3RyaW5nID0gXCLor7fpgInmi6lcIjsvL+i3s+i9rOeahOm7mOiupOaYvuekuuiKgueCuVxyXG4gIGhhc0RlZmF1bHRCcmFuY2ggPSB0cnVlO1xyXG4gIEBWaWV3Q2hpbGQoVGFza1NpZ25hZGRDb21wb25lbnQpXHJcbiAgYWRkU2lnbkNtcDogVGFza1NpZ25hZGRDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnY29tbWVudE1vZGFsJylcclxuICBjb21tZW50TW9kYWw6IERpYWxvZ0NvbXBvbmVudDtcclxuICAvKipcclxuICAgKiDku7vliqFJZFxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHdvcmtpdGVtSWQod29ya2l0ZW1JZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmluV29ya2l0ZW1JZCA9ICh3b3JraXRlbUlkICYmIHdvcmtpdGVtSWQudHJpbSgpKTtcclxuICAgIGlmICh0aGlzLmluV29ya2l0ZW1JZCkge1xyXG4gICAgICB0aGlzLnJlZnJlc2hBY3Rpb25zKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGdldCB3b3JraXRlbUlkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5Xb3JraXRlbUlkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Lu75Yqh5Yqe55CG5Yqo5L2c5YiX6KGoXHJcbiAgICovXHJcbiAgQE91dHB1dCgpXHJcbiAgYWN0aW9ucyA9IG5ldyBFdmVudEVtaXR0ZXI8V29ya2l0ZW1BY3Rpb25bXT4oKTtcclxuXHJcbiAgLyoqXHJcbiAgICog5Lu75Yqh5Yqe55CG5a6M5oiQ5LqL5Lu2XHJcbiAgICovXHJcbiAgQE91dHB1dCgpXHJcbiAgY29tcGxldGVkID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG5cclxuICAvLyDlvZPliY3pgInkuK3liqjkvZzlkozliqjkvZzlrp7njrBcclxuICBwcmVGdW5jTGlzdDogYW55W10gPSBbXTtcclxuICB3ZWJDcHRGdW5jOiBhbnk7XHJcbiAgcG9zdEZ1bmNMaXN0OiBhbnlbXSA9IFtdO1xyXG5cclxuICAvLyDlvLnmoYbpq5jluqborr7nva5cclxuICBoZWlnaHQgPSA0MjA7XHJcblxyXG4gIGFjdGlvbnNUaXRsZSA9IHtcclxuICAgIHBhc3M6ICcnLFxyXG4gICAgYmFjazogJycsXHJcbiAgICByZWZ1c2U6ICcnLFxyXG4gICAgbW9yZTogJycsXHJcbiAgICB2aWV3TG9nOiAnJyxcclxuICAgIHZpZXdGbG93Q2hhcnQ6ICcnLFxyXG4gICAgdmlld0JpemxvZzogJydcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgdGFza1N2YzogVGFza1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgaTE4blNlcnZpY2U6IEkxOG5TZXJ2aWNlLFxyXG4gICkge1xyXG4gICAgY29uc3QgdGl0bGVzID0gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLnRhc2tBY3Rpb25zJyk7XHJcbiAgICBPYmplY3Qua2V5cyh0aGlzLmFjdGlvbnNUaXRsZSkuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICB0aGlzLmFjdGlvbnNUaXRsZVtrZXldID0gdGl0bGVzW2tleV07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yi35paw5Yqo5L2c5YiX6KGoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWZyZXNoQWN0aW9ucygpIHtcclxuICAgIHRoaXMudGFza1N2Yy5nZXRXb3JrSXRlbUFjdGlvbnModGhpcy5pbldvcmtpdGVtSWQpLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICAvLyDkuLTml7bmlrnmoYjvvJpvRGF0YeS4jeaUr+aMgeiHquWumuS5iWZ1bmN0aW9uICRleHBhbmTlsZXlvIDvvIzkuLTml7bluo/liJfljJblpITnkIZcclxuICAgICAgdGhpcy50YXNrQWN0aW9ucyA9IHJlLm1hcChhY3Rpb24gPT4ge1xyXG4gICAgICAgIGFjdGlvbi5wYXJhbWV0ZXJzID0gSlNPTi5wYXJzZShhY3Rpb24ucGFyYW1ldGVycyk7XHJcbiAgICAgICAgcmV0dXJuIGFjdGlvbjtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMudGFza0FjdGlvbnMgPSB0aGlzLnRhc2tBY3Rpb25zLmZpbHRlcihhID0+XHJcbiAgICAgICAgYS5jb2RlICE9PSAnVmlld0JpekxvZydcclxuICAgICAgICAmJiBhLmNvZGUgIT09ICdWaWV3Rmxvd0NoYXJ0J1xyXG4gICAgICAgICYmIGEuY29kZSAhPT0gJ1ZpZXdFeGVjdXRlRm9ybScpO1xyXG5cclxuICAgICAgdGhpcy5hY3Rpb25zLmVtaXQodGhpcy50YXNrQWN0aW9ucyk7XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIHRoaXMuc2hvd0Vycm9yKGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yqo5L2c5a6M5oiQ5ZCO5LqL5Lu2XHJcbiAgICogQHBhcmFtIHJlc3VsdCDkuovku7bnu5PmnpxcclxuICAgKi9cclxuICBwcml2YXRlIGNvbXBsZXRlZEV2dChyZXN1bHQ6IGJvb2xlYW4gPSB0cnVlKSB7XHJcbiAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgIHRoaXMucmVmcmVzaEFjdGlvbnMoKTtcclxuICAgIH1cclxuICAgIHRoaXMuY29tcGxldGVkLmVtaXQocmVzdWx0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWujOaIkOWuoeaJueS7u+WKoVxyXG4gICAqIEBwYXJhbSBhY3Rpb25Db2RlIOS7u+WKoeWKnueQhuWKqOS9nOe8luWPt1xyXG4gICAqIEBwYXJhbSBjb21tZW50PyDlip7nkIbmhI/op4FcclxuICAgKi9cclxuICBjb21wbGV0ZShhY3Rpb25Db2RlOiBzdHJpbmcsIGNvbW1lbnQ/OiBzdHJpbmcpIHtcclxuICAgIHN3aXRjaCAoYWN0aW9uQ29kZSkge1xyXG4gICAgICBjYXNlICdBc3NpZ25Vc2VyJzogeyAvLyDmjIfmtL5cclxuICAgICAgICB0aGlzLmFzc2lnbmVlKHRoaXMuaW5Xb3JraXRlbUlkKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBjYXNlICdDbGFpbSc6IC8vIOmihueUqFxyXG4gICAgICAgIHRoaXMudGFza1N2Yy5jbGFpbSh0aGlzLmluV29ya2l0ZW1JZCkuc3Vic2NyaWJlKHIgPT4ge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdjdWVXb3Jkcy5zdWNjZXNzQ2xhaW0nKSk7XHJcbiAgICAgICAgICB0aGlzLnJlZnJlc2hBY3Rpb25zKCk7XHJcbiAgICAgICAgICB0aGlzLmNvbXBsZXRlZC5lbWl0KGZhbHNlKTtcclxuICAgICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLnNob3dFcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1VuY2xhaW0nOiAvLyDlj5bmtojpoobnlKhcclxuICAgICAgICB0aGlzLnRhc2tTdmMudW5DbGFpbSh0aGlzLmluV29ya2l0ZW1JZCkuc3Vic2NyaWJlKHIgPT4ge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdjdWVXb3Jkcy5zdWNjZXNzVW5DbGFpbScpKTtcclxuICAgICAgICAgIHRoaXMucmVmcmVzaEFjdGlvbnMoKTtcclxuICAgICAgICAgIHRoaXMuY29tcGxldGVkLmVtaXQoZmFsc2UpO1xyXG4gICAgICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgICAgIHRoaXMuc2hvd0Vycm9yKGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnUmV0cmlldmUnOiAvLyDlj5blm55cclxuICAgICAgICB0aGlzLnRhc2tTdmMucmV0cmlldmUoeyB3b3JrSXRlbUlkOiB0aGlzLmluV29ya2l0ZW1JZCwgY29tbWVudCB9KS5zdWJzY3JpYmUociA9PiB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2N1ZVdvcmRzLnN1Y2Nlc3NSZXRyaWV2ZScpKTtcclxuICAgICAgICAgIHRoaXMuY29tcGxldGVkRXZ0KCk7XHJcbiAgICAgICAgfSxlcnJvciA9PiB7XHJcbiAgICAgICAgICB0aGlzLnNob3dFcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1RyYW5zZmVyJzogeyAvLyDnp7vkuqRcclxuICAgICAgICB0aGlzLnRyYW5zZmVyQ29udGV4dCA9IHtcclxuICAgICAgICAgIHdvcmtJdGVtSWQ6IHRoaXMuaW5Xb3JraXRlbUlkLFxyXG4gICAgICAgICAgY29tbWVudFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgY2FzZSAnQWRkU2lnbkZyb250JzogLy8g5b6B6K+iXHJcbiAgICAgICAgdGhpcy5hZGRTaWduQ29udGV4dCA9IHtcclxuICAgICAgICAgIHdvcmtJdGVtSWQ6IHRoaXMuaW5Xb3JraXRlbUlkLFxyXG4gICAgICAgICAgYWN0aW9uOiAnQWRkU2lnbkZyb250J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhpcy5leGVjdXRlVGFzayhhY3Rpb25Db2RlLCBjb21tZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlZnJlc2hMaXN0KHN1Y2VzczogYm9vbGVhbikge1xyXG4gICAgdGhpcy5jb21wbGV0ZWRFdnQoc3VjZXNzKTtcclxuICB9XHJcbiAgLy8g5by55Ye65Yqg562+5biu5YqpXHJcbiAgcnVuQWRkU2lnbigpIHtcclxuICAgIHRoaXMuYWRkU2lnbkNvbnRleHQgPSB7XHJcbiAgICAgIHdvcmtJdGVtSWQ6IHRoaXMuaW5Xb3JraXRlbUlkLFxyXG4gICAgICBhY3Rpb246ICdBZGRTaWduQmVoaW5kJ1xyXG4gICAgfTtcclxuICB9XHJcbiAgLy8g5Yqg562+5a6M5oiQXHJcbiAgYWRkU2lnbkNvbXBsZXRlKHN1Y2VzczogYm9vbGVhbikge1xyXG5cclxuICAgIGlmICh0aGlzLmFkZFNpZ25Db250ZXh0LmFjdGlvbiA9PT0gJ0FkZFNpZ25Gcm9udCcpIHtcclxuICAgICAgdGhpcy5yZWZyZXNoTGlzdChzdWNlc3MpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jb21wbGV0ZUNvbnRleHQuc2lnbkFzc2lnbmVlcyA9IHRoaXMuYWRkU2lnbkNtcC5zZWxlY3RlZFVzZXJzLm1hcCh1c2VyID0+IHVzZXIuSUQpO1xyXG4gICAgICB0aGlzLnNlbGVjdEFkZFNpZ25lZXMgPSB0aGlzLmFkZFNpZ25DbXAuc2VsZWN0ZWRVc2Vycy5tYXAodXNlciA9PiB1c2VyLk5hbWUpLmpvaW4oJywnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIOWuoeaJueehruiupFxyXG4gIGhhbmRsZU9rKCkge1xyXG4gICAgaWYoIXRoaXMuY29tcGxldGVDb250ZXh0LmNvbW1lbnQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkuaW5mbyhcIuivt+i+k+WFpeWuoeaJueaEj+ingVwiKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYoIXRoaXMuaGFzRGVmYXVsdEJyYW5jaCAmJiB0aGlzLmNvbXBsZXRlQ29udGV4dC5kZXN0aW5hdGlvbkFjdGl2aXR5SWQubGVuZ3RoIDw9IDApIHsvL+ayoeaciem7mOiupOWIhuaUr+W5tuS4lOeUqOaIt+ayoemAieaLqei3s+i9rOiKgueCue+8jOS4jeWFgeiuuOaPkOS6pFxyXG4gICAgICB0aGlzLm5vdGlmeS5pbmZvKFwi6K+36YCJ5oup55uu5qCH6IqC54K5XCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnRhc2tTdmMuZXhjdXRlVGFzayh0aGlzLmluV29ya2l0ZW1JZCwgdGhpcy5jb21wbGV0ZUNvbnRleHQpLnN1YnNjcmliZShcclxuICAgICAgKGNyOiBDb21wbGV0ZVJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jb21tZW50TW9kYWwuY2xvc2UoKTtcclxuICAgICAgICAvLyDlrozmiJDlt6XkvZzpobnlkI7vvIzmo4Dmn6XmmK/lkKbpnIDopoHmiafooYzlkI7kuovku7ZcclxuICAgICAgICB0aGlzLmV4Y3V0ZVBvc3RFdmVudCgpO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbXBsZXRlQ29udGV4dC5jb25jbHVzaW9uVmFsdWUgPT09ICdQYXNzJykge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdjdWVXb3Jkcy5zdWNjZXNzUGFzcycpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29tcGxldGVDb250ZXh0LmNvbmNsdXNpb25WYWx1ZSA9PT0gJ0JhY2snKSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2N1ZVdvcmRzLnN1Y2Nlc3NCYWNrJykpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb21wbGV0ZUNvbnRleHQuY29uY2x1c2lvblZhbHVlID09PSAnUmVmdXNlJykge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdjdWVXb3Jkcy5zdWNjZXNzUmVmdXNlJykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2N1ZVdvcmRzLnN1Y2Nlc3MnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjci5uZWVkSW50ZXJhY3Rpb24pIHtcclxuICAgICAgICAgIHRoaXMucmVmcmVzaEFjdGlvbnMoKTsvL+mAmui/h+WQjuW8ueWHuuaMh+a0viBhZGQgYnkgZnBmXHJcbiAgICAgICAgICB0aGlzLmFzc2lnbmVlSW5mb3MgPSBbY3IubmV4dEZsb3dOb2Rlc1swXS5hc3NpZ25lZUluZm9dO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNvbXBsZXRlZEV2dCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgIHRoaXMuc2hvd0Vycm9yKGVycm9yKTtcclxuICAgICAgfSk7IFxyXG4gIH1cclxuICAvLyDlj5bmtojmk43kvZxcclxuICBoYW5kbGVDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNvbXBsZXRlQ29udGV4dCA9IG5ldyBDb21wbGV0ZUNvbnRleHQoKTtcclxuICAgIHRoaXMuY29tbWVudE1vZGFsLmNsb3NlKCk7XHJcbiAgfVxyXG4gIC8vIOaMh+a0vuaTjeS9nFxyXG4gIHByaXZhdGUgYXNzaWduZWUod29ya0l0ZW1JZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnRhc2tTdmMuZ2V0QXNzaWduZWVJbmZvKHdvcmtJdGVtSWQpLnN1YnNjcmliZSgoaW5mbzogRmxvd05vZGVJbmZvKSA9PiB7XHJcbiAgICAgIGluZm8uYXNzaWduZWVJbmZvLndvcmtJdGVtSWQgPSB3b3JrSXRlbUlkOy8v5YW85a655aSE55CG77yM5q2k5aSE6L+U5Zue55qEd29ya2l0ZW1pZOS4um51bGxcclxuICAgICAgdGhpcy5hc3NpZ25lZUluZm9zID0gW2luZm8uYXNzaWduZWVJbmZvXTtcclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgdGhpcy5zaG93RXJyb3IoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8vIOmHjeaWsOWIneWni+WMluW9k+WJjeWPguaVsFxyXG4gIHByaXZhdGUgaW5pdFN0YXRlKCkge1xyXG4gICAgdGhpcy5zZWxlY3RBZGRTaWduZWVzID0gJyc7XHJcbiAgICB0aGlzLmRlc3RBY3Rpdml0aWVzID0gbnVsbDtcclxuICAgIHRoaXMubmVlZEFkZFNpZ24gPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXhlY3V0ZVRhc2soYWN0aW9uQ29kZTogc3RyaW5nLCBvcGluaW9uPzogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmluaXRTdGF0ZSgpO1xyXG4gICAgdGhpcy5jb21wbGV0ZUNvbnRleHQgPSB7XHJcbiAgICAgIHdvcmtJdGVtSWQ6IHRoaXMuaW5Xb3JraXRlbUlkLFxyXG4gICAgICBjb25jbHVzaW9uVmFsdWU6IGFjdGlvbkNvZGUsXHJcbiAgICAgIGNvbW1lbnQ6ICcnLFxyXG4gICAgICBzaWduQXNzaWduZWVzOiBbXSwgLy8g5Yqg562+5Lq65ZGYXHJcbiAgICAgIGRlc3RpbmF0aW9uQWN0aXZpdHlJZDogJycvLyDnm67moIfoioLngrlcclxuICAgIH07XHJcbiAgICB0aGlzLmNvbXBsZXRlQ29udGV4dC5jb21tZW50ID0gYWN0aW9uQ29kZSA9PT0gJ1Bhc3MnID8gdGhpcy5hY3Rpb25zVGl0bGUucGFzcyA6ICcnO1xyXG4gICAgaWYgKG9waW5pb24pIHtcclxuICAgICAgdGhpcy5jb21wbGV0ZUNvbnRleHQuY29tbWVudCA9IG9waW5pb247XHJcbiAgICB9XHJcbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLnRhc2tBY3Rpb25zLmZpbmQoYSA9PiBhLmNvZGUgPT09IGFjdGlvbkNvZGUpO1xyXG4gICAgdGhpcy50YXNrU3ZjLmdldEFjdGlvbkVudGl0eSh0aGlzLndvcmtpdGVtSWQsIGFjdGlvbkNvZGUpLnN1YnNjcmliZSgoYWN0OiBBY3Rpb25FbnRpdHkpID0+IHtcclxuXHJcbiAgICAgIGlmICghYWN0KSB7Ly8g5a6h5om55Yqo5L2c5bey5Yig6Zmk77yM6LWw5a6M5oiQ5bel5L2c6aG5ICBUT0RPOiDpnZ7lrozmiJDlt6XkvZzpobnliqjkvZzlpoLkvZXlpITnkIbvvJ9cclxuICAgICAgICB0aGlzLnNob3dFeGN1dGVNb2RhbChhY3Rpb24pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGZyb20odGhpcy5leGN1dGVBY3Rpb24oYWN0KSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgIGlmICghYWN0LndlYkNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLnNob3dFeGN1dGVNb2RhbChhY3Rpb24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIHRoaXMuc2hvd0Vycm9yKGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiDliqDnrb7vvIzot7Povazmg4XlhrVcclxuICAgKiBAcGFyYW0gYWN0aW9uIOWKqOS9nFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0V4Y3V0ZU1vZGFsKGFjdGlvbjogV29ya2l0ZW1BY3Rpb24pIHtcclxuICAgIC8vIOWKqOS9nOWPguaVsOaMieeFp1xyXG4gICAgaWYgKGFjdGlvbiAmJiBhY3Rpb24ucGFyYW1ldGVycykge1xyXG4gICAgICAvLyDot7PovazjgIHpqbPlm57lnLrmma9cclxuICAgICAgaWYgKGFjdGlvbi5wYXJhbWV0ZXJzLlNlbGVjdFRhcmdldEFibGUgPT09ICdUcnVlJyB8fCBhY3Rpb24ucGFyYW1ldGVycy5TZWxlY3RUYXJnZXRBYmxlID09PSAndHJ1ZScpIHtcclxuICAgICAgICAvLyB0aGlzLnRhc2tTdmMuZ2V0RGVzdGluYXRpb25TY29wZSh0aGlzLmluV29ya2l0ZW1JZCwgYWN0aW9uLmNvZGUpLnN1YnNjcmliZSgocmU6IHsgaWQ6IHN0cmluZywgbmFtZTogc3RyaW5nIH1bXSkgPT4ge1xyXG4gICAgICAgIC8vICAgdGhpcy5kZXN0QWN0aXZpdGllcyA9IHJlO1xyXG4gICAgICAgIC8vIH0pO1xyXG4gICAgICAgIHRoaXMuZ2V0RGVzdGluYXRpb25Ob2Rlcyh0aGlzLmluV29ya2l0ZW1JZCwgYWN0aW9uLmNvZGUpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOmcgOimgeWKoOetvlxyXG4gICAgICBpZiAoYWN0aW9uLnBhcmFtZXRlcnMuQWRkU2lnbkJlaGluZEFibGUgPT09ICdUcnVlJyB8fCBhY3Rpb24ucGFyYW1ldGVycy5BZGRTaWduQmVoaW5kQWJsZSA9PT0gJ3RydWUnKSB7XHJcbiAgICAgICAgdGhpcy5uZWVkQWRkU2lnbiA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuY29tbWVudE1vZGFsLnNob3coKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RGVzdGluYXRpb25Ob2Rlcyh3b3JrSXRlbUlkOiBzdHJpbmcsIGFjdGlvbkNvZGU6IHN0cmluZykge1xyXG4gICAgdmFyIG5leHROb2RlczogTmV4dE5vZGVbXSA9IFtdO1xyXG4gICAgdGhpcy50YXNrU3ZjLmdldERlc3RpbmF0aW9uU2NvcGUod29ya0l0ZW1JZCwgYWN0aW9uQ29kZSkuc3Vic2NyaWJlKChyZTogTmV4dE5vZGVbXSkgPT4ge1xyXG4gICAgICBuZXh0Tm9kZXMgPSByZTtcclxuICAgICAgY29uc3QgZGVzID0gcmUubWFwKGEgPT4gYS5ub2RlSW5mb0xpc3QpO1xyXG4gICAgICBsZXQgbGlzdCA9W107XHJcbiAgICAgIGRlcy5mb3JFYWNoKGkgPT4ge1xyXG4gICAgICAgIGxpc3QgPSBsaXN0LmNvbmNhdChpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuZGVzdEFjdGl2aXRpZXMgPSBsaXN0Lm1hcChpID0+ICh7aWQ6aS5hY3Rpdml0eURlZmluaXRpb25JZCwgbmFtZTppLmFjdGl2aXR5RGVmaW5pdGlvbk5hbWV9KSk7XHJcbiAgICAgIHRoaXMuaGFzRGVmYXVsdEJyYW5jaCA9IHRoaXMuaGFzRGVmYXVsdEJyYW5jaEZ1bmMobmV4dE5vZGVzKTtcclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgdGhpcy5zaG93RXJyb3IoZXJyb3IpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDot7PovazvvIzov5Tlm57nmoTmlbDmja7mmK/lkKbmnInpu5jorqTliIbmlK9cclxuICAgKiDlpoLmnpzov5Tlm57nmoTmsqHmnInpu5jorqToioLngrnvvIzot7PovazoioLngrnlj4jmsqHpgInnmoTor53vvIzkuI3lhYHorrjmj5DkuqRcclxuICAgKiBAcGFyYW0gbmV4dE5vZGVzIFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaGFzRGVmYXVsdEJyYW5jaEZ1bmMobmV4dE5vZGVzOiBOZXh0Tm9kZVtdKSB7XHJcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgbmV4dE5vZGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGlmKG5leHROb2Rlc1tpXS5kZWZhdWx0QnJhbmNoKSB7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5UGxhY2Vob2xkZXIgPSBuZXh0Tm9kZXNbaV0ubm9kZUluZm9MaXN0WzBdLmFjdGl2aXR5RGVmaW5pdGlvbk5hbWU7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgcHJpdmF0ZSBhc3luYyBleGN1dGVBY3Rpb24oYWN0OiBBY3Rpb25FbnRpdHkpIHtcclxuICAgIGF3YWl0IHRoaXMuZ2V0QWN0aW9uV2ViRXZlbnRzRnVuYyhhY3QpO1xyXG4gICAgaWYgKHRoaXMucHJlRnVuY0xpc3QgJiYgdGhpcy5wcmVGdW5jTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wcmVGdW5jTGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHRoaXMucHJlRnVuY0xpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5pbmRleCA9PT0gaSlbMF0uZnVuYygpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy53ZWJDcHRGdW5jKSB7XHJcbiAgICAgIHRoaXMud2ViQ3B0RnVuYygpO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGV4Y3V0ZVBvc3RFdmVudCgpIHtcclxuICAgIGlmICh0aGlzLnBvc3RGdW5jTGlzdCAmJiB0aGlzLnBvc3RGdW5jTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wb3N0RnVuY0xpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB0aGlzLnBvc3RGdW5jTGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLmluZGV4ID09PSBpKVswXS5mdW5jKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Yqo5L2c55qE5YmN5ZCO5LqL5Lu25ZKM5a6e546w5pa55rOVXHJcbiAgICogQHBhcmFtIGFjdCDliqjkvZxcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldEFjdGlvbldlYkV2ZW50c0Z1bmMoYWN0OiBBY3Rpb25FbnRpdHkpIHtcclxuICAgIHRoaXMucHJlRnVuY0xpc3QgPSBbXTtcclxuICAgIHRoaXMud2ViQ3B0RnVuYyA9IG51bGw7XHJcbiAgICB0aGlzLnBvc3RGdW5jTGlzdCA9IFtdO1xyXG4gICAgY29uc3QgcmVxTWFwID0gW107XHJcbiAgICBsZXQgcHJlSW5kZXggPSAwO1xyXG4gICAgbGV0IHBvc3RJbmRleCA9IDA7XHJcbiAgICBpZiAoYWN0LnByZUV2ZW50ICYmIGFjdC5wcmVFdmVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgZSBvZiBhY3QucHJlRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBwcmUgPSB7XHJcbiAgICAgICAgICBldmVudDogJ3ByZScsXHJcbiAgICAgICAgICBpbmRleDogcHJlSW5kZXgrKyxcclxuICAgICAgICAgIGZ1bmNOYW1lOiBlLmNvbXBvbmVudC5zcGxpdCgnIycpWzFdLFxyXG4gICAgICAgICAgcmVxOiBTeXN0ZW0uaW1wb3J0KGUuY29tcG9uZW50LnNwbGl0KCcjJylbMF0pXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXFNYXAucHVzaChwcmUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoYWN0LndlYkNvbXBvbmVudCkge1xyXG4gICAgICBjb25zdCBjcHQgPSB7XHJcbiAgICAgICAgZXZlbnQ6ICdjcHQnLFxyXG4gICAgICAgIGluZGV4OiAwLFxyXG4gICAgICAgIGZ1bmNOYW1lOiBhY3Qud2ViQ29tcG9uZW50LnNwbGl0KCcjJylbMV0sXHJcbiAgICAgICAgcmVxOiBTeXN0ZW0uaW1wb3J0KGFjdC53ZWJDb21wb25lbnQuc3BsaXQoJyMnKVswXSlcclxuICAgICAgfTtcclxuICAgICAgcmVxTWFwLnB1c2goY3B0KTtcclxuICAgIH1cclxuICAgIGlmIChhY3QucG9zdEV2ZW50ICYmIGFjdC5wb3N0RXZlbnQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IGEgb2YgYWN0LnBvc3RFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IHBvc3QgPSB7XHJcbiAgICAgICAgICBldmVudDogJ3Bvc3QnLFxyXG4gICAgICAgICAgaW5kZXg6IHBvc3RJbmRleCsrLFxyXG4gICAgICAgICAgZnVuY05hbWU6IGEuY29tcG9uZW50LnNwbGl0KCcjJylbMV0sXHJcbiAgICAgICAgICByZXE6IFN5c3RlbS5pbXBvcnQoYS5jb21wb25lbnQuc3BsaXQoJyMnKVswXSlcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJlcU1hcC5wdXNoKHBvc3QpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGNvbnN0IHIgb2YgcmVxTWFwKSB7XHJcbiAgICAgIGNvbnN0IG0gPSBhd2FpdCByLnJlcTtcclxuICAgICAgaWYgKHIuZXZlbnQgPT09ICdwcmUnKSB7XHJcbiAgICAgICAgdGhpcy5wcmVGdW5jTGlzdC5wdXNoKHtcclxuICAgICAgICAgIGluZGV4OiByLmluZGV4LFxyXG4gICAgICAgICAgZnVuYzogbS5kZWZhdWx0W3IuZnVuY05hbWVdXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoci5ldmVudCA9PT0gJ3Bvc3QnKSB7XHJcbiAgICAgICAgdGhpcy5wb3N0RnVuY0xpc3QucHVzaCh7XHJcbiAgICAgICAgICBpbmRleDogci5pbmRleCxcclxuICAgICAgICAgIGZ1bmM6IG0uZGVmYXVsdFtyLmZ1bmNOYW1lXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMud2ViQ3B0RnVuYyA9IG0uZGVmYXVsdFtyLmZ1bmNOYW1lXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5pi+56S65oql6ZSZ5L+h5oGvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG93RXJyb3IoZXJyb3I6IGFueSkge1xyXG4gICAgaWYoZXJyb3IgJiYgZXJyb3IuZXJyb3IgJiYgZXJyb3IuZXJyb3IuTWVzc2FnZSkge1xyXG4gICAgICB0aGlzLm5vdGlmeS5lcnJvcihlcnJvci5lcnJvci5NZXNzYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubm90aWZ5LmVycm9yKGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
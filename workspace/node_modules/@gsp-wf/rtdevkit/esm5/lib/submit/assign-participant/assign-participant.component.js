/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, Optional, ViewChild } from '@angular/core';
import { UserService } from '../../runtime/services/user.service';
import { Subject } from 'rxjs';
import { NotifyService } from '@farris/ui-notify';
import { TaskService } from '../../runtime/services/task.service';
import { I18nService } from '../../runtime/services/i18n.service';
import { DataTableComponent } from '@farris/ui-datatable';
import { LoadingService } from '@farris/ui-loading';
var AssignParticipantComponent = /** @class */ (function () {
    function AssignParticipantComponent(userSvc, notify, taskSvc, loadingService, i18nService) {
        this.userSvc = userSvc;
        this.notify = notify;
        this.taskSvc = taskSvc;
        this.loadingService = loadingService;
        this.i18nService = i18nService;
        this.cls = 'farris-main-area flex-column';
        this.pageList = [10, 20, 30, 50, 100];
        this.paginationOptions = {
            id: 'WF-Users-DataTable-Pagination',
            currentPage: 1,
            itemsPerPage: 10,
            pageList: this.pageList,
            totalItems: 0
        };
        this.subject = new Subject();
        this.withAllOrg = true;
        this.orgId = '';
        this.userListData = [];
        // 是否允许多选,默认多选
        this.singleSelect = false;
        this.searchValue = null;
        this.selectedUsers = [];
        this.columns = [
            { title: this.i18nService ? this.i18nService.getValue('static.columnName.code') : '编号', field: 'Code', width: 80 },
            { title: this.i18nService ? this.i18nService.getValue('static.columnName.name') : '姓名', field: 'Name', width: 90 },
            { title: this.i18nService ? this.i18nService.getValue('static.columnName.department') : '组织信息', field: 'OrgName', width: 180 }
        ];
    }
    Object.defineProperty(AssignParticipantComponent.prototype, "assigneeInfo", {
        set: /**
         * @param {?} assigneeInfos
         * @return {?}
         */
        function (assigneeInfos) {
            this.assignees = assigneeInfos;
            this.assigneesPa = {
                procInstId: '',
                //后端用不到 先为空
                assigneeInfos: []
            };
            this.getUserList();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    AssignParticipantComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    AssignParticipantComponent.prototype.getUserList = /**
     * @return {?}
     */
    function () {
        this.singleSelect = !this.assignees[0].multiSelect;
        if (this.assignees[0].assigneeUsers && this.assignees[0].assigneeUsers.length) {
            this.getAssignedUsers();
        }
        else {
            if (this.assignees[0].allowGlobalAssign) {
                if (this.assignees[0].organizationScope && this.assignees[0].organizationScope.length) {
                    this.withAllOrg = this.assignees[0].organizationScope[0].includeChildren;
                    this.orgId = this.assignees[0].organizationScope[0].id;
                }
                this.getAllUserList();
            }
            else {
                this.getAssignedUsers();
            }
        }
    };
    /**
     * @return {?}
     */
    AssignParticipantComponent.prototype.getAssignedUsers = /**
     * @return {?}
     */
    function () {
        if (this.assignees.length > 0) {
            this.selectedUsers = this.assignees[0].assigneeUsers.map((/**
             * @param {?} user
             * @return {?}
             */
            function (user) {
                return {
                    ID: user.id,
                    Name: user.name,
                    Code: user.code,
                    OrgId: user.orgId,
                    OrgName: user.orgNamePath
                };
            })),
                this.userListData = this.selectedUsers;
        }
    };
    /**
     * @protected
     * @return {?}
     */
    AssignParticipantComponent.prototype.getAllUserList = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var load = this.loadingService.show();
        this.userSvc.getUserList_Assign(this.searchValue, this.paginationOptions.currentPage, this.paginationOptions.itemsPerPage, this.withAllOrg, this.orgId)
            .subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            load.close();
            _this.paginationOptions.totalItems = re.totalCount;
            _this.userListData = re.data.map((/**
             * @param {?} u
             * @return {?}
             */
            function (u) { return ({
                ID: u.id,
                Code: u.code,
                Name: u.name,
                OrgId: u.sysOrgId,
                OrgName: u.orgNamePath,
                Checked: false
            }); }));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            load.close();
        }));
    };
    /**
     * @param {?} event
     * @return {?}
     */
    AssignParticipantComponent.prototype.search = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        this.searchValue = event.value;
        if (this.assignees[0].assigneeUsers && this.assignees[0].assigneeUsers.length) { //有候选人，在候选人中筛选
            if (this.searchValue) {
                this.userListData = this.selectedUsers.filter((/**
                 * @param {?} user
                 * @return {?}
                 */
                function (user) {
                    return (user.Name) && user.Name.includes(_this.searchValue) ||
                        (user.Code) && user.Code.includes(_this.searchValue);
                }));
            }
            else {
                this.getAssignedUsers();
            }
        }
        else { //无候选人，在全员中选择
            this.paginationOptions.currentPage = 1;
            this.getUserList();
        }
    };
    /**
     * @return {?}
     */
    AssignParticipantComponent.prototype.btnCancelClick = /**
     * @return {?}
     */
    function () {
        this.notify.info(this.i18nService ? this.i18nService.getValue('static.assignee.cancelAssign') : '已取消操作。');
        this.subject.next(null);
    };
    /**
     * @return {?}
     */
    AssignParticipantComponent.prototype.btnOKClick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.selectedUsers = this.singleSelect ? [this.userTable.selections] : this.userTable.selections;
        if (!this.selectedUsers || this.selectedUsers.length < 1) {
            this.notify.warning(this.i18nService ? this.i18nService.getValue('static.assignee.noAssignee') : '请至少选择一个审批人。');
            return;
        }
        // 添加已选人员
        /** @type {?} */
        var assigneeInfo = this.assignees.shift();
        assigneeInfo.assigneeIds = this.selectedUsers.map((/**
         * @param {?} user
         * @return {?}
         */
        function (user) { return user.ID; }));
        this.assigneesPa.assigneeInfos.push(assigneeInfo);
        // 检查指定是否完成，如果完成提交，否则继续指派任务
        if (this.assignees.length > 0) {
            this.userListData = []; // clear source
            this.getUserList();
        }
        else {
            /** @type {?} */
            var load_1 = this.loadingService.show();
            this.taskSvc.assignNextUsersByProcInstId(this.assigneesPa).subscribe((/**
             * @return {?}
             */
            function () {
                load_1.close();
                _this.notify.success(_this.i18nService ? _this.i18nService.getValue('static.assignee.successAssign') : '操作成功。');
                _this.subject.next(_this.assigneesPa);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                _this.notify.error(_this.i18nService ? _this.i18nService.getValue('static.assignee.errorAssign') : '操作失败，请联系管理员查看原因！');
                _this.subject.error(_this.i18nService ? _this.i18nService.getValue('static.assignee.errorAssign') : '操作失败，请联系管理员查看原因！');
            }));
        }
    };
    /**
     * @return {?}
     */
    AssignParticipantComponent.prototype.subscribe = /**
     * @return {?}
     */
    function () {
        return this.subject.asObservable();
    };
    /**
     * @param {?} pageSize
     * @return {?}
     */
    AssignParticipantComponent.prototype.onPageSizeChange = /**
     * @param {?} pageSize
     * @return {?}
     */
    function (pageSize) {
        this.paginationOptions.itemsPerPage = pageSize;
        this.getUserList();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    AssignParticipantComponent.prototype.onPageChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.paginationOptions.currentPage = event.pageIndex;
        this.getUserList();
    };
    AssignParticipantComponent.decorators = [
        { type: Component, args: [{
                    selector: 'wf-assign-participant',
                    template: "<div class=\"modal-body farris-overflow-hidden f-utils-flex-column\" style=\"background-color: white;\">\r\n  <div class=\"d-flex flex-column my-data-grid h-100\" style=\"padding: 0 14px;\">\r\n    <div class=\"flex-auto h-100\" style=\"position:relative; overflow: auto;\">\r\n      <farris-datatable #allUserTable [columns]=\"columns\" [data]=\"userListData | paginate: paginationOptions\"\r\n        [showFilterBar]='true' [singleSelect]=\"singleSelect\" [idField]=\"'ID'\" [remote]=\"'server'\"\r\n        (search)=\"search($event)\" [pagination]='false'></farris-datatable>\r\n    </div>\r\n    <div style=\"position:relative;\">\r\n      <pagination-controls [id]=\"paginationOptions.id\" [previousLabel]=\"' '\" [nextLabel]=\"' '\" [showPageList]=\"false\"\r\n        (pageChange)=\"onPageChange($event)\" (pageSizeChange)=\"onPageSizeChange($event)\">\r\n      </pagination-controls>\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"modal-footer flex-shrink-0\">\r\n  <button type=\"button\" class=\"btn btn-primary\" (click)=\"btnOKClick()\">{{('static.footOk' | translate)?('static.footOk' | translate):'\u786E\u5B9A' }}</button>\r\n  <button type=\"button\" class=\"btn btn-default\" (click)=\"btnCancelClick()\">{{('static.footCancel' | translate)?('static.footCancel' | translate):'\u53D6\u6D88' }}</button>\r\n</div>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    AssignParticipantComponent.ctorParameters = function () { return [
        { type: UserService },
        { type: NotifyService },
        { type: TaskService },
        { type: LoadingService },
        { type: I18nService, decorators: [{ type: Optional }] }
    ]; };
    AssignParticipantComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        assigneeInfo: [{ type: Input }],
        userTable: [{ type: ViewChild, args: ['allUserTable',] }]
    };
    return AssignParticipantComponent;
}());
export { AssignParticipantComponent };
if (false) {
    /** @type {?} */
    AssignParticipantComponent.prototype.cls;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.pageList;
    /** @type {?} */
    AssignParticipantComponent.prototype.paginationOptions;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.assignees;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.assigneesPa;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.allowGlobalAssign;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.withAllOrg;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.orgId;
    /** @type {?} */
    AssignParticipantComponent.prototype.userListData;
    /** @type {?} */
    AssignParticipantComponent.prototype.singleSelect;
    /** @type {?} */
    AssignParticipantComponent.prototype.searchValue;
    /** @type {?} */
    AssignParticipantComponent.prototype.selectedUsers;
    /** @type {?} */
    AssignParticipantComponent.prototype.userTable;
    /** @type {?} */
    AssignParticipantComponent.prototype.columns;
    /**
     * @type {?}
     * @protected
     */
    AssignParticipantComponent.prototype.userSvc;
    /**
     * @type {?}
     * @protected
     */
    AssignParticipantComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.taskSvc;
    /**
     * @type {?}
     * @private
     */
    AssignParticipantComponent.prototype.loadingService;
    /**
     * @type {?}
     * @protected
     */
    AssignParticipantComponent.prototype.i18nService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzaWduLXBhcnRpY2lwYW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2YvcnRkZXZraXQvIiwic291cmNlcyI6WyJsaWIvc3VibWl0L2Fzc2lnbi1wYXJ0aWNpcGFudC9hc3NpZ24tcGFydGljaXBhbnQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDbEUsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNsRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUUxRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFFbkQ7SUFrREUsb0NBQ1ksT0FBb0IsRUFDcEIsTUFBcUIsRUFDdkIsT0FBb0IsRUFDcEIsY0FBOEIsRUFDaEIsV0FBd0I7UUFKcEMsWUFBTyxHQUFQLE9BQU8sQ0FBYTtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3ZCLFlBQU8sR0FBUCxPQUFPLENBQWE7UUFDcEIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQ2hCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBaERoRCxRQUFHLEdBQUcsOEJBQThCLENBQUM7UUFFN0IsYUFBUSxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pDLHNCQUFpQixH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QUFFLENBQUM7SUFDckMsQ0FBQzs7Ozs7SUFFRCxxREFBZ0I7Ozs7SUFBaEIsVUFBaUIsUUFBUTtRQUN2QixJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQztRQUMvQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQzs7Ozs7SUFFRCxpREFBWTs7OztJQUFaLFVBQWEsS0FBSztRQUNoQixJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDckQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7O2dCQS9LRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLHVCQUF1QjtvQkFDakMscTBDQUFrRDs7aUJBRW5EOzs7O2dCQWJRLFdBQVc7Z0JBRVgsYUFBYTtnQkFDYixXQUFXO2dCQUlYLGNBQWM7Z0JBSGQsV0FBVyx1QkE0RGYsUUFBUTs7O3NCQWpEVixXQUFXLFNBQUMsT0FBTzsrQkFZbkIsS0FBSzs0QkEyQkwsU0FBUyxTQUFDLGNBQWM7O0lBb0kzQixpQ0FBQztDQUFBLEFBakxELElBaUxDO1NBNUtZLDBCQUEwQjs7O0lBQ3JDLHlDQUNxQzs7Ozs7SUFFckMsOENBQXlDOztJQUN6Qyx1REFNRTs7Ozs7SUFZRiwrQ0FBa0M7Ozs7O0lBQ2xDLGlEQUF1RDs7Ozs7SUFDdkQsdURBQW1DOzs7OztJQUNuQyw2Q0FBbUU7Ozs7O0lBQ25FLGdEQUFtQzs7Ozs7SUFDbkMsMkNBQTJCOztJQUMzQixrREFBa0I7O0lBRWxCLGtEQUFxQjs7SUFDckIsaURBQW1COztJQUNuQixtREFNUzs7SUFDVCwrQ0FBeUQ7O0lBQ3pELDZDQUdrSTs7Ozs7SUFFaEksNkNBQThCOzs7OztJQUM5Qiw0Q0FBK0I7Ozs7O0lBQy9CLDZDQUE0Qjs7Ozs7SUFDNUIsb0RBQXNDOzs7OztJQUN0QyxpREFBOEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEhvc3RCaW5kaW5nLCBPcHRpb25hbCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFzc2lnbmVlSW5mbywgQXNzaWduZWVJbmZvQnlQcm9jSW5zdElkUGFyYW1ldGVyIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbXBsZXRlLXJlc3BvbnNlJztcclxuaW1wb3J0IHsgVXNlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9ydW50aW1lL3NlcnZpY2VzL3VzZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgVGFza1NlcnZpY2UgfSBmcm9tICcuLi8uLi9ydW50aW1lL3NlcnZpY2VzL3Rhc2suc2VydmljZSc7XHJcbmltcG9ydCB7IEkxOG5TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vcnVudGltZS9zZXJ2aWNlcy9pMThuLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBEYXRhVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGF0YWJsZSc7XHJcbmltcG9ydCB7IFBhZ2luYXRpb25JbnN0YW5jZSB9IGZyb20gJ0BmYXJyaXMvdWktcGFnaW5hdGlvbic7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJ1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd3Zi1hc3NpZ24tcGFydGljaXBhbnQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hc3NpZ24tcGFydGljaXBhbnQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2Fzc2lnbi1wYXJ0aWNpcGFudC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEFzc2lnblBhcnRpY2lwYW50Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZmFycmlzLW1haW4tYXJlYSBmbGV4LWNvbHVtbic7XHJcblxyXG4gIHByaXZhdGUgcGFnZUxpc3QgPSBbMTAsIDIwLCAzMCwgNTAsIDEwMF07XHJcbiAgcGFnaW5hdGlvbk9wdGlvbnM6IFBhZ2luYXRpb25JbnN0YW5jZSA9IHtcclxuICAgIGlkOiAnV0YtVXNlcnMtRGF0YVRhYmxlLVBhZ2luYXRpb24nLFxyXG4gICAgY3VycmVudFBhZ2U6IDEsXHJcbiAgICBpdGVtc1BlclBhZ2U6IDEwLFxyXG4gICAgcGFnZUxpc3Q6IHRoaXMucGFnZUxpc3QsXHJcbiAgICB0b3RhbEl0ZW1zOiAwXHJcbiAgfTtcclxuXHJcbiAgQElucHV0KClcclxuICBzZXQgYXNzaWduZWVJbmZvKGFzc2lnbmVlSW5mb3M6IEFzc2lnbmVlSW5mb1tdKSB7XHJcbiAgICB0aGlzLmFzc2lnbmVlcyA9IGFzc2lnbmVlSW5mb3M7XHJcbiAgICB0aGlzLmFzc2lnbmVlc1BhID0ge1xyXG4gICAgICBwcm9jSW5zdElkOiAnJywvL+WQjuerr+eUqOS4jeWIsCDlhYjkuLrnqbpcclxuICAgICAgYXNzaWduZWVJbmZvczogW11cclxuICAgIH07XHJcbiAgICB0aGlzLmdldFVzZXJMaXN0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzc2lnbmVlczogQXNzaWduZWVJbmZvW107XHJcbiAgcHJpdmF0ZSBhc3NpZ25lZXNQYTogQXNzaWduZWVJbmZvQnlQcm9jSW5zdElkUGFyYW1ldGVyO1xyXG4gIHByaXZhdGUgYWxsb3dHbG9iYWxBc3NpZ246IGJvb2xlYW47XHJcbiAgcHJpdmF0ZSBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8QXNzaWduZWVJbmZvQnlQcm9jSW5zdElkUGFyYW1ldGVyPigpO1xyXG4gIHByaXZhdGUgd2l0aEFsbE9yZzogYm9vbGVhbiA9IHRydWU7XHJcbiAgcHJpdmF0ZSBvcmdJZDogc3RyaW5nID0gJyc7XHJcbiAgdXNlckxpc3REYXRhID0gW107XHJcbiAgLy8g5piv5ZCm5YWB6K645aSa6YCJLOm7mOiupOWkmumAiVxyXG4gIHNpbmdsZVNlbGVjdCA9IGZhbHNlO1xyXG4gIHNlYXJjaFZhbHVlID0gbnVsbDtcclxuICBzZWxlY3RlZFVzZXJzOiB7XHJcbiAgICBJRDogc3RyaW5nLFxyXG4gICAgQ29kZTogc3RyaW5nLFxyXG4gICAgTmFtZTogc3RyaW5nLFxyXG4gICAgT3JnSWQ6IHN0cmluZyxcclxuICAgIE9yZ05hbWU6IHN0cmluZ1xyXG4gIH1bXSA9IFtdO1xyXG4gIEBWaWV3Q2hpbGQoJ2FsbFVzZXJUYWJsZScpIHVzZXJUYWJsZTogRGF0YVRhYmxlQ29tcG9uZW50O1xyXG4gIGNvbHVtbnMgPSBbXHJcbiAgICB7IHRpdGxlOiB0aGlzLmkxOG5TZXJ2aWNlID8gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLmNvbHVtbk5hbWUuY29kZScpIDogJ+e8luWPtycsIGZpZWxkOiAnQ29kZScsIHdpZHRoOiA4MCB9LFxyXG4gICAgeyB0aXRsZTogdGhpcy5pMThuU2VydmljZSA/IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5jb2x1bW5OYW1lLm5hbWUnKSA6ICflp5PlkI0nLCBmaWVsZDogJ05hbWUnLCB3aWR0aDogOTAgfSxcclxuICAgIHsgdGl0bGU6IHRoaXMuaTE4blNlcnZpY2UgPyB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMuY29sdW1uTmFtZS5kZXBhcnRtZW50JykgOiAn57uE57uH5L+h5oGvJywgZmllbGQ6ICdPcmdOYW1lJywgd2lkdGg6IDE4MCB9XTtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByb3RlY3RlZCB1c2VyU3ZjOiBVc2VyU2VydmljZSxcclxuICAgIHByb3RlY3RlZCBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHRhc2tTdmM6IFRhc2tTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsb2FkaW5nU2VydmljZTogTG9hZGluZ1NlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcm90ZWN0ZWQgaTE4blNlcnZpY2U6IEkxOG5TZXJ2aWNlXHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIGdldFVzZXJMaXN0KCkge1xyXG4gICAgdGhpcy5zaW5nbGVTZWxlY3QgPSAhdGhpcy5hc3NpZ25lZXNbMF0ubXVsdGlTZWxlY3Q7XHJcbiAgICBpZiAodGhpcy5hc3NpZ25lZXNbMF0uYXNzaWduZWVVc2VycyAmJiB0aGlzLmFzc2lnbmVlc1swXS5hc3NpZ25lZVVzZXJzLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLmdldEFzc2lnbmVkVXNlcnMoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICh0aGlzLmFzc2lnbmVlc1swXS5hbGxvd0dsb2JhbEFzc2lnbikge1xyXG4gICAgICAgIGlmICh0aGlzLmFzc2lnbmVlc1swXS5vcmdhbml6YXRpb25TY29wZSAmJiB0aGlzLmFzc2lnbmVlc1swXS5vcmdhbml6YXRpb25TY29wZS5sZW5ndGgpIHtcclxuICAgICAgICAgIHRoaXMud2l0aEFsbE9yZyA9IHRoaXMuYXNzaWduZWVzWzBdLm9yZ2FuaXphdGlvblNjb3BlWzBdLmluY2x1ZGVDaGlsZHJlbjtcclxuICAgICAgICAgIHRoaXMub3JnSWQgPSB0aGlzLmFzc2lnbmVlc1swXS5vcmdhbml6YXRpb25TY29wZVswXS5pZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5nZXRBbGxVc2VyTGlzdCgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZ2V0QXNzaWduZWRVc2VycygpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXRBc3NpZ25lZFVzZXJzKCkge1xyXG4gICAgaWYgKHRoaXMuYXNzaWduZWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZFVzZXJzID0gdGhpcy5hc3NpZ25lZXNbMF0uYXNzaWduZWVVc2Vycy5tYXAodXNlciA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIElEOiB1c2VyLmlkLFxyXG4gICAgICAgICAgTmFtZTogdXNlci5uYW1lLFxyXG4gICAgICAgICAgQ29kZTogdXNlci5jb2RlLFxyXG4gICAgICAgICAgT3JnSWQ6IHVzZXIub3JnSWQsXHJcbiAgICAgICAgICBPcmdOYW1lOiB1c2VyLm9yZ05hbWVQYXRoXHJcbiAgICAgICAgfTtcclxuICAgICAgfSksXHJcbiAgICAgICAgdGhpcy51c2VyTGlzdERhdGEgPSB0aGlzLnNlbGVjdGVkVXNlcnM7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0QWxsVXNlckxpc3QoKSB7XHJcbiAgICBjb25zdCBsb2FkID0gdGhpcy5sb2FkaW5nU2VydmljZS5zaG93KCk7XHJcbiAgICB0aGlzLnVzZXJTdmMuZ2V0VXNlckxpc3RfQXNzaWduKHRoaXMuc2VhcmNoVmFsdWUsIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuY3VycmVudFBhZ2UsIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuaXRlbXNQZXJQYWdlLCB0aGlzLndpdGhBbGxPcmcsIHRoaXMub3JnSWQpXHJcbiAgICAgIC5zdWJzY3JpYmUoKHJlOiB7IHRvdGFsQ291bnQ6IG51bWJlciwgZGF0YTogYW55W10gfSkgPT4ge1xyXG4gICAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLnRvdGFsSXRlbXMgPSByZS50b3RhbENvdW50O1xyXG4gICAgICAgIHRoaXMudXNlckxpc3REYXRhID0gcmUuZGF0YS5tYXAodSA9PiAoe1xyXG4gICAgICAgICAgSUQ6IHUuaWQsXHJcbiAgICAgICAgICBDb2RlOiB1LmNvZGUsXHJcbiAgICAgICAgICBOYW1lOiB1Lm5hbWUsXHJcbiAgICAgICAgICBPcmdJZDogdS5zeXNPcmdJZCxcclxuICAgICAgICAgIE9yZ05hbWU6IHUub3JnTmFtZVBhdGgsXHJcbiAgICAgICAgICBDaGVja2VkOiBmYWxzZVxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZWFyY2goZXZlbnQpIHtcclxuICAgIHRoaXMuc2VhcmNoVmFsdWUgPSBldmVudC52YWx1ZTtcclxuICAgIGlmICh0aGlzLmFzc2lnbmVlc1swXS5hc3NpZ25lZVVzZXJzICYmIHRoaXMuYXNzaWduZWVzWzBdLmFzc2lnbmVlVXNlcnMubGVuZ3RoKSB7Ly/mnInlgJnpgInkurrvvIzlnKjlgJnpgInkurrkuK3nrZvpgIlcclxuICAgICAgaWYodGhpcy5zZWFyY2hWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMudXNlckxpc3REYXRhID0gdGhpcy5zZWxlY3RlZFVzZXJzLmZpbHRlcih1c2VyID0+XHJcbiAgICAgICAgICAodXNlci5OYW1lKSAmJiB1c2VyLk5hbWUuaW5jbHVkZXModGhpcy5zZWFyY2hWYWx1ZSkgfHxcclxuICAgICAgICAgICh1c2VyLkNvZGUpICYmIHVzZXIuQ29kZS5pbmNsdWRlcyh0aGlzLnNlYXJjaFZhbHVlKVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5nZXRBc3NpZ25lZFVzZXJzKCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7Ly/ml6DlgJnpgInkurrvvIzlnKjlhajlkZjkuK3pgInmi6lcclxuICAgICAgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5jdXJyZW50UGFnZSA9IDE7XHJcbiAgICAgIHRoaXMuZ2V0VXNlckxpc3QoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGJ0bkNhbmNlbENsaWNrKCkge1xyXG4gICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlID8gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLmFzc2lnbmVlLmNhbmNlbEFzc2lnbicpIDogJ+W3suWPlua2iOaTjeS9nOOAgicpO1xyXG4gICAgdGhpcy5zdWJqZWN0Lm5leHQobnVsbCk7XHJcbiAgfVxyXG4gIGJ0bk9LQ2xpY2soKSB7XHJcbiAgICB0aGlzLnNlbGVjdGVkVXNlcnMgPSB0aGlzLnNpbmdsZVNlbGVjdCA/IFt0aGlzLnVzZXJUYWJsZS5zZWxlY3Rpb25zXSA6IHRoaXMudXNlclRhYmxlLnNlbGVjdGlvbnM7XHJcblxyXG4gICAgaWYgKCF0aGlzLnNlbGVjdGVkVXNlcnMgfHwgdGhpcy5zZWxlY3RlZFVzZXJzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlID8gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLmFzc2lnbmVlLm5vQXNzaWduZWUnKSA6ICfor7foh7PlsJHpgInmi6nkuIDkuKrlrqHmibnkurrjgIInKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOa3u+WKoOW3sumAieS6uuWRmFxyXG4gICAgY29uc3QgYXNzaWduZWVJbmZvID0gdGhpcy5hc3NpZ25lZXMuc2hpZnQoKTtcclxuICAgIGFzc2lnbmVlSW5mby5hc3NpZ25lZUlkcyA9IHRoaXMuc2VsZWN0ZWRVc2Vycy5tYXAodXNlciA9PiB1c2VyLklEKTtcclxuICAgIHRoaXMuYXNzaWduZWVzUGEuYXNzaWduZWVJbmZvcy5wdXNoKGFzc2lnbmVlSW5mbyk7XHJcblxyXG4gICAgLy8g5qOA5p+l5oyH5a6a5piv5ZCm5a6M5oiQ77yM5aaC5p6c5a6M5oiQ5o+Q5Lqk77yM5ZCm5YiZ57un57ut5oyH5rS+5Lu75YqhXHJcbiAgICBpZiAodGhpcy5hc3NpZ25lZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLnVzZXJMaXN0RGF0YSA9IFtdOyAvLyBjbGVhciBzb3VyY2VcclxuICAgICAgdGhpcy5nZXRVc2VyTGlzdCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZ1NlcnZpY2Uuc2hvdygpO1xyXG4gICAgICB0aGlzLnRhc2tTdmMuYXNzaWduTmV4dFVzZXJzQnlQcm9jSW5zdElkKHRoaXMuYXNzaWduZWVzUGEpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgbG9hZC5jbG9zZSgpO1xyXG4gICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3ModGhpcy5pMThuU2VydmljZSA/IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5hc3NpZ25lZS5zdWNjZXNzQXNzaWduJykgOiAn5pON5L2c5oiQ5Yqf44CCJyk7XHJcbiAgICAgICAgdGhpcy5zdWJqZWN0Lm5leHQodGhpcy5hc3NpZ25lZXNQYSk7XHJcbiAgICAgIH0sIGVyciA9PiB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuZXJyb3IodGhpcy5pMThuU2VydmljZSA/IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5hc3NpZ25lZS5lcnJvckFzc2lnbicpIDogJ+aTjeS9nOWksei0pe+8jOivt+iBlOezu+euoeeQhuWRmOafpeeci+WOn+WboO+8gScpO1xyXG4gICAgICAgIHRoaXMuc3ViamVjdC5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlID8gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLmFzc2lnbmVlLmVycm9yQXNzaWduJykgOiAn5pON5L2c5aSx6LSl77yM6K+36IGU57O7566h55CG5ZGY5p+l55yL5Y6f5Zug77yBJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBzdWJzY3JpYmUoKTogT2JzZXJ2YWJsZTxBc3NpZ25lZUluZm9CeVByb2NJbnN0SWRQYXJhbWV0ZXI+IHtcclxuICAgIHJldHVybiB0aGlzLnN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICBvblBhZ2VTaXplQ2hhbmdlKHBhZ2VTaXplKSB7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLml0ZW1zUGVyUGFnZSA9IHBhZ2VTaXplO1xyXG4gICAgdGhpcy5nZXRVc2VyTGlzdCgpO1xyXG4gIH1cclxuXHJcbiAgb25QYWdlQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLmN1cnJlbnRQYWdlID0gZXZlbnQucGFnZUluZGV4O1xyXG4gICAgdGhpcy5nZXRVc2VyTGlzdCgpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, ComponentFactoryResolver, Injector, Optional } from '@angular/core';
import { BsModalService } from '@farris/ui-modal';
import { ProcessSelectorComponent } from '../process-selector/process-selector.component';
import { InteractionResponse } from '../../entity/interaction-response';
import { AssignParticipantComponent } from '../assign-participant/assign-participant.component';
import { of } from 'rxjs';
import { I18nService } from '../../runtime/services/i18n.service';
/**
 * 提交审批客户端交互服务
 */
var WFSubmiteService = /** @class */ (function () {
    function WFSubmiteService(injector, resolver, modalService, i18nService) {
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
        this.i18nService = i18nService;
    }
    /**
     * 客户端交互处理服务端返回结果
     * @param excutionRe 提交审批服务器端返回结果
     * @param handler 处理结果回调页面
     */
    /**
     * 客户端交互处理服务端返回结果
     * @param {?} excutionRe 提交审批服务器端返回结果
     * @param {?} handler 处理结果回调页面
     * @return {?}
     */
    WFSubmiteService.prototype.excute = /**
     * 客户端交互处理服务端返回结果
     * @param {?} excutionRe 提交审批服务器端返回结果
     * @param {?} handler 处理结果回调页面
     * @return {?}
     */
    function (excutionRe, handler) {
        /** @type {?} */
        var response = new InteractionResponse();
        // 无需交互
        if (excutionRe.needInteraction === false) {
            response.message = '无需交互';
            handler(response);
            return;
        }
        // 选择要提交的流程
        if (excutionRe.procDefs && excutionRe.procDefs.length > 1) {
            this.selectProcess(excutionRe.procDefs, handler);
            return;
        }
        // 指定下一步参与者
        if (excutionRe.nextFlowNodes[0].assigneeInfo) {
            this.assignee([excutionRe.nextFlowNodes[0].assigneeInfo], handler);
            return;
        }
    };
    /**
     * 处理选择流程结果
     */
    /**
     * 处理选择流程结果
     * @private
     * @param {?} prcesses
     * @param {?} handler
     * @return {?}
     */
    WFSubmiteService.prototype.selectProcess = /**
     * 处理选择流程结果
     * @private
     * @param {?} prcesses
     * @param {?} handler
     * @return {?}
     */
    function (prcesses, handler) {
        /** @type {?} */
        var response = new InteractionResponse();
        /** @type {?} */
        var modalConfig = {
            title: this.i18nService ? this.i18nService.getValue('static.submit.selectProcess') : '流程选择',
            width: 520,
            height: 290,
            showButtons: false,
            showMaxButton: false,
            beforeClose: (/**
             * @param {?} modelRef
             * @return {?}
             */
            function (modelRef) {
                handler(response);
                return of(true);
            })
        };
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(ProcessSelectorComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.gridData = prcesses;
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.subscribe().subscribe((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            response.processDefinitionId = val;
            dialog.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            response.message = err;
            dialog.close();
        }));
    };
    /**
     * 处理指定下一步人员结果
     */
    /**
     * 处理指定下一步人员结果
     * @private
     * @param {?} assigneeInfos
     * @param {?=} handler
     * @return {?}
     */
    WFSubmiteService.prototype.assignee = /**
     * 处理指定下一步人员结果
     * @private
     * @param {?} assigneeInfos
     * @param {?=} handler
     * @return {?}
     */
    function (assigneeInfos, handler) {
        /** @type {?} */
        var response = new InteractionResponse();
        /** @type {?} */
        var modalConfig = {
            title: this.i18nService ? this.i18nService.getValue('static.assignee.title') : '请选择操作用户',
            width: 850,
            height: 520,
            showMaxButton: false,
            showButtons: false,
            beforeClose: (/**
             * @param {?} modelRef
             * @return {?}
             */
            function (modelRef) {
                handler(response);
                return of(true);
            })
        };
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(AssignParticipantComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.assigneeInfo = assigneeInfos;
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.subscribe().subscribe((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            dialog.close();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            dialog.close();
        }));
    };
    WFSubmiteService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    WFSubmiteService.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: I18nService, decorators: [{ type: Optional }] }
    ]; };
    return WFSubmiteService;
}());
export { WFSubmiteService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WFSubmiteService.prototype.i18nService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Ytc3VibWl0ZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi9ydGRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9zdWJtaXQvc2VydmljZS93Zi1zdWJtaXRlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsd0JBQXdCLEVBQWdCLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkcsT0FBTyxFQUFFLGNBQWMsRUFBZ0IsTUFBTSxrQkFBa0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUUxRixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUd4RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUNoRyxPQUFPLEVBQXVCLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7QUFLbEU7SUFHSSwwQkFDWSxRQUFrQixFQUNsQixRQUFrQyxFQUNsQyxZQUE0QixFQUNoQixXQUF3QjtRQUhwQyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLGlCQUFZLEdBQVosWUFBWSxDQUFnQjtRQUNoQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtJQUM1QyxDQUFDO0lBRUw7Ozs7T0FJRzs7Ozs7OztJQUNILGlDQUFNOzs7Ozs7SUFBTixVQUFPLFVBQTRCLEVBQUUsT0FBOEM7O1lBQ3pFLFFBQVEsR0FBRyxJQUFJLG1CQUFtQixFQUFFO1FBQzFDLE9BQU87UUFDUCxJQUFJLFVBQVUsQ0FBQyxlQUFlLEtBQUssS0FBSyxFQUFFO1lBQ3RDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1lBQzFCLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNs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QyxRQUFRLENBQUM7UUFDakQsT0FBTyxDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsYUFBYSxDQUFDOztZQUN4QyxNQUFNLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQztRQUMzRCxPQUFPLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLEdBQUc7WUFDdEMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ25CLENBQUM7Ozs7UUFBRSxVQUFBLEdBQUc7WUFDRixNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbkIsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOztnQkF4RkosVUFBVTs7OztnQkFka0QsUUFBUTtnQkFBaEQsd0JBQXdCO2dCQUNwQyxjQUFjO2dCQVFkLFdBQVcsdUJBWVgsUUFBUTs7SUFrRmpCLHVCQUFDO0NBQUEsQUF6RkQsSUF5RkM7U0F4RlksZ0JBQWdCOzs7Ozs7SUFHckIsb0NBQTBCOzs7OztJQUMxQixvQ0FBMEM7Ozs7O0lBQzFDLHdDQUFvQzs7Ozs7SUFDcEMsdUNBQTRDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBFdmVudEVtaXR0ZXIsIEluamVjdG9yLCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCB9IGZyb20gJy4uL3Byb2Nlc3Mtc2VsZWN0b3IvcHJvY2Vzcy1zZWxlY3Rvci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBFeGN1dGlvblJlc3BvbnNlIH0gZnJvbSAnLi4vLi4vZW50aXR5L2V4Y3V0aW9uLXJlc3BvbnNlJztcclxuaW1wb3J0IHsgSW50ZXJhY3Rpb25SZXNwb25zZSB9IGZyb20gJy4uLy4uL2VudGl0eS9pbnRlcmFjdGlvbi1yZXNwb25zZSc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZWZpbml0aW9uIH0gZnJvbSAnLi4vLi4vZW50aXR5L3Byb2Nlc3NkZWZpbml0aW9uJztcclxuaW1wb3J0IHsgQXNzaWduZWVJbmZvIH0gZnJvbSAnLi4vLi4vZW50aXR5L2NvbXBsZXRlLXJlc3BvbnNlJztcclxuaW1wb3J0IHsgQXNzaWduUGFydGljaXBhbnRDb21wb25lbnQgfSBmcm9tICcuLi9hc3NpZ24tcGFydGljaXBhbnQvYXNzaWduLXBhcnRpY2lwYW50LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEkxOG5TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vcnVudGltZS9zZXJ2aWNlcy9pMThuLnNlcnZpY2UnO1xyXG5cclxuLyoqXHJcbiAqIOaPkOS6pOWuoeaJueWuouaIt+err+S6pOS6kuacjeWKoVxyXG4gKi9cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgV0ZTdWJtaXRlU2VydmljZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICAgICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGkxOG5TZXJ2aWNlOiBJMThuU2VydmljZVxyXG4gICAgKSB7IH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWuouaIt+err+S6pOS6kuWkhOeQhuacjeWKoeerr+i/lOWbnue7k+aenFxyXG4gICAgICogQHBhcmFtIGV4Y3V0aW9uUmUg5o+Q5Lqk5a6h5om55pyN5Yqh5Zmo56uv6L+U5Zue57uT5p6cXHJcbiAgICAgKiBAcGFyYW0gaGFuZGxlciDlpITnkIbnu5Pmnpzlm57osIPpobXpnaJcclxuICAgICAqL1xyXG4gICAgZXhjdXRlKGV4Y3V0aW9uUmU6IEV4Y3V0aW9uUmVzcG9uc2UsIGhhbmRsZXI6IChyZXN1bHQ6IEludGVyYWN0aW9uUmVzcG9uc2UpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IG5ldyBJbnRlcmFjdGlvblJlc3BvbnNlKCk7XHJcbiAgICAgICAgLy8g5peg6ZyA5Lqk5LqSXHJcbiAgICAgICAgaWYgKGV4Y3V0aW9uUmUubmVlZEludGVyYWN0aW9uID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gJ+aXoOmcgOS6pOS6kic7XHJcbiAgICAgICAgICAgIGhhbmRsZXIocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOmAieaLqeimgeaPkOS6pOeahOa1geeoi1xyXG4gICAgICAgIGlmIChleGN1dGlvblJlLnByb2NEZWZzICYmIGV4Y3V0aW9uUmUucHJvY0RlZnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdFByb2Nlc3MoZXhjdXRpb25SZS5wcm9jRGVmcywgaGFuZGxlcik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5oyH5a6a5LiL5LiA5q2l5Y+C5LiO6ICFXHJcbiAgICAgICAgaWYgKGV4Y3V0aW9uUmUubmV4dEZsb3dOb2Rlc1swXS5hc3NpZ25lZUluZm8pIHtcclxuICAgICAgICAgICAgdGhpcy5hc3NpZ25lZShbZXhjdXRpb25SZS5uZXh0Rmxvd05vZGVzWzBdLmFzc2lnbmVlSW5mb10sIGhhbmRsZXIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5aSE55CG6YCJ5oup5rWB56iL57uT5p6cXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc2VsZWN0UHJvY2VzcyhwcmNlc3NlczogUHJvY2Vzc0RlZmluaXRpb25bXSwgaGFuZGxlcjogKHJlc3VsdDogSW50ZXJhY3Rpb25SZXNwb25zZSkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbmV3IEludGVyYWN0aW9uUmVzcG9uc2UoKTtcclxuICAgICAgICBjb25zdCBtb2RhbENvbmZpZzogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZSA/IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5zdWJtaXQuc2VsZWN0UHJvY2VzcycpIDogJ+a1geeoi+mAieaLqScsXHJcbiAgICAgICAgICAgIHdpZHRoOiA1MjAsXHJcbiAgICAgICAgICAgIGhlaWdodDogMjkwLFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICBiZWZvcmVDbG9zZTogKG1vZGVsUmVmOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZXIocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoUHJvY2Vzc1NlbGVjdG9yQ29tcG9uZW50KTtcclxuICAgICAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZ3JpZERhdGEgPSBwcmNlc3NlcztcclxuICAgICAgICBjb25zdCBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLnN1YnNjcmliZSgpLnN1YnNjcmliZSh2YWwgPT4ge1xyXG4gICAgICAgICAgICByZXNwb25zZS5wcm9jZXNzRGVmaW5pdGlvbklkID0gdmFsO1xyXG4gICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9LCBlcnIgPT4ge1xyXG4gICAgICAgICAgICByZXNwb25zZS5tZXNzYWdlID0gZXJyO1xyXG4gICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5aSE55CG5oyH5a6a5LiL5LiA5q2l5Lq65ZGY57uT5p6cXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgYXNzaWduZWUoYXNzaWduZWVJbmZvczogQXNzaWduZWVJbmZvW10sIGhhbmRsZXI/OiAocmVzdWx0OiBJbnRlcmFjdGlvblJlc3BvbnNlKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgSW50ZXJhY3Rpb25SZXNwb25zZSgpO1xyXG4gICAgICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmkxOG5TZXJ2aWNlID8gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLmFzc2lnbmVlLnRpdGxlJykgOiAn6K+36YCJ5oup5pON5L2c55So5oi3JyxcclxuICAgICAgICAgICAgd2lkdGg6IDg1MCxcclxuICAgICAgICAgICAgaGVpZ2h0OiA1MjAsXHJcbiAgICAgICAgICAgIHNob3dNYXhCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICBzaG93QnV0dG9uczogZmFsc2UsXHJcbiAgICAgICAgICAgIGJlZm9yZUNsb3NlOiAobW9kZWxSZWY6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlcihyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShBc3NpZ25QYXJ0aWNpcGFudENvbXBvbmVudCk7XHJcbiAgICAgICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmFzc2lnbmVlSW5mbyA9IGFzc2lnbmVlSW5mb3M7XHJcbiAgICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5zdWJzY3JpYmUoKS5zdWJzY3JpYmUodmFsID0+IHtcclxuICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgZXJyID0+IHtcclxuICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19
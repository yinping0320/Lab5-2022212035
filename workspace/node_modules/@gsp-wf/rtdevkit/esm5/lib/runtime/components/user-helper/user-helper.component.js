/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Optional, Output, EventEmitter } from '@angular/core';
import { UserService } from '../../services/user.service';
import { DataTableComponent } from '@farris/ui-datatable';
import { NotifyService } from '@farris/ui-notify';
import { DialogComponent } from '@farris/ui-dialog';
import { I18nService } from '../../services/i18n.service';
var UserHelperComponent = /** @class */ (function () {
    function UserHelperComponent(i18nService, userSvc, notify) {
        this.i18nService = i18nService;
        this.userSvc = userSvc;
        this.notify = notify;
        this.pageList = [10, 20, 30, 50, 100];
        this.paginationOptions = {
            id: 'WF-Users-DataTable-Pagination',
            currentPage: 1,
            itemsPerPage: 10,
            pageList: this.pageList,
            totalItems: 0
        };
        this.columns = [
            { title: this.i18nService ? this.i18nService.getValue('static.columnName.code') : '编号', field: 'Code', width: 80 },
            { title: this.i18nService ? this.i18nService.getValue('static.columnName.name') : '姓名', field: 'Name', width: 90 },
            { title: this.i18nService ? this.i18nService.getValue('static.columnName.department') : '部门', field: 'OrgName', width: 200 }
        ];
        this.searchValue = null;
        this.userListData = [];
        // 是否允许多选,默认多选
        this.singleSelect = false;
        this.selectedUsers = [];
        this.completed = new EventEmitter();
    }
    /**
     * @return {?}
     */
    UserHelperComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    UserHelperComponent.prototype.handleOk = /**
     * @return {?}
     */
    function () {
        throw new Error('没有实现，需要子组件实现');
    };
    /**
     * @return {?}
     */
    UserHelperComponent.prototype.handleCancel = /**
     * @return {?}
     */
    function () {
        this.completed.emit(false);
        this.showModal(false);
    };
    /**
     * @param {?} pageSize
     * @return {?}
     */
    UserHelperComponent.prototype.onPageSizeChange = /**
     * @param {?} pageSize
     * @return {?}
     */
    function (pageSize) {
        this.paginationOptions.itemsPerPage = pageSize;
        this.getUserList();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    UserHelperComponent.prototype.onPageChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.paginationOptions.currentPage = event.pageIndex;
        this.getUserList();
    };
    /**
     * @protected
     * @return {?}
     */
    UserHelperComponent.prototype.getUserList = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        this.userSvc.getUserList(this.searchValue, this.paginationOptions.currentPage, this.paginationOptions.itemsPerPage)
            .subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            _this.paginationOptions.totalItems = re.totalCount;
            _this.userListData = re.data.map((/**
             * @param {?} u
             * @return {?}
             */
            function (u) { return ({
                ID: u.id,
                Code: u.code,
                Name: u.name,
                OrgId: u.sysOrgId,
                OrgName: u.sysOrgName,
                Checked: false
            }); }));
        }));
    };
    /**
     * @param {?} event
     * @return {?}
     */
    UserHelperComponent.prototype.search = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.paginationOptions.currentPage = 1;
        this.searchValue = encodeURIComponent(event.value);
        if (event.field === '*') {
            this.getUserList();
        }
        else if (event.field === 'Name') {
            this.getUserList();
        }
        else {
            this.notify.warning('只支持用户名称过滤！');
        }
    };
    /**
     * @protected
     * @param {?} show
     * @return {?}
     */
    UserHelperComponent.prototype.showModal = /**
     * @protected
     * @param {?} show
     * @return {?}
     */
    function (show) {
        if (show) {
            this.userDialog.show();
            this.getUserList();
        }
        else {
            // 临时处理方案
            if (this.userDialog.beforeClose) {
                this.userDialog.close();
            }
        }
    };
    UserHelperComponent.decorators = [
        { type: Component, args: [{
                    selector: 'wf-user-helper',
                    template: "<farris-dialog #allUserDialog [buttons]=\"buttonRef\" [width]=\"850\" [height]=\"520\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\">\r\n  <div class=\"d-flex flex-column my-data-grid h-100\" style=\"padding: 0 14px;\">\r\n    <div class=\"flex-auto\" style=\"position:relative;\">\r\n      <farris-datatable #allUserTable [columns]=\"columns\" [data]=\"userListData | paginate: paginationOptions\"\r\n        [showFilterBar]='true' [singleSelect]=\"singleSelect\" [idField]=\"'ID'\" [remote]=\"'server'\" (search)=\"search($event)\"\r\n        [pagination]='false'></farris-datatable>\r\n    </div>\r\n    <div style=\"position:relative;\">\r\n      <pagination-controls [id]=\"paginationOptions.id\" [previousLabel]=\"' '\" [nextLabel]=\"' '\"\r\n        (pageChange)=\"onPageChange($event)\" (pageSizeChange)=\"onPageSizeChange($event)\">\r\n      </pagination-controls>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"handleOk()\">\u786E\u5B9A</button>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"handleCancel()\">\u53D6\u6D88</button>\r\n</ng-template>",
                    styles: [".my-data-grid .filter-row .search-fields{padding-left:0!important}.my-data-grid .filter-row .search-text{padding-right:0!important}"]
                }] }
    ];
    /** @nocollapse */
    UserHelperComponent.ctorParameters = function () { return [
        { type: I18nService, decorators: [{ type: Optional }] },
        { type: UserService },
        { type: NotifyService }
    ]; };
    UserHelperComponent.propDecorators = {
        userTable: [{ type: ViewChild, args: ['allUserTable',] }],
        userDialog: [{ type: ViewChild, args: ['allUserDialog',] }],
        completed: [{ type: Output }]
    };
    return UserHelperComponent;
}());
export { UserHelperComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    UserHelperComponent.prototype.pageList;
    /** @type {?} */
    UserHelperComponent.prototype.paginationOptions;
    /** @type {?} */
    UserHelperComponent.prototype.columns;
    /** @type {?} */
    UserHelperComponent.prototype.searchValue;
    /** @type {?} */
    UserHelperComponent.prototype.userListData;
    /** @type {?} */
    UserHelperComponent.prototype.singleSelect;
    /** @type {?} */
    UserHelperComponent.prototype.selectedUsers;
    /** @type {?} */
    UserHelperComponent.prototype.userTable;
    /** @type {?} */
    UserHelperComponent.prototype.userDialog;
    /** @type {?} */
    UserHelperComponent.prototype.completed;
    /**
     * @type {?}
     * @protected
     */
    UserHelperComponent.prototype.i18nService;
    /**
     * @type {?}
     * @protected
     */
    UserHelperComponent.prototype.userSvc;
    /**
     * @type {?}
     * @protected
     */
    UserHelperComponent.prototype.notify;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1oZWxwZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi9ydGRldmtpdC8iLCJzb3VyY2VzIjpbImxpYi9ydW50aW1lL2NvbXBvbmVudHMvdXNlci1oZWxwZXIvdXNlci1oZWxwZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFMUQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFMUQ7SUFpQ0UsNkJBQ3dCLFdBQXdCLEVBQ3BDLE9BQW9CLEVBQ3BCLE1BQXNCO1FBRlYsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDcEMsWUFBTyxHQUFQLE9BQU8sQ0FBYTtRQUNwQixXQUFNLEdBQU4sTUFBTSxDQUFnQjtRQTdCMUIsYUFBUSxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pDLHNCQUFpQixHQUF1QjtZQUN0QyxFQUFFLEVBQUUsK0JBQStCO1lBQ25DLFdBQVcsRUFBRSxDQUFDO1lBQ2QsWUFBWSxFQUFFLEVBQUU7WUFDaEIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ3ZCLFVBQVUsRUFBRSxDQUFDO1NBQ2QsQ0FBQztRQUNGLFlBQU8sR0FBRztZQUNSLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElB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bmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIE9wdGlvbmFsLCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBVc2VyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3VzZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IFBhZ2luYXRpb25JbnN0YW5jZSB9IGZyb20gJ0BmYXJyaXMvdWktcGFnaW5hdGlvbic7XHJcbmltcG9ydCB7IERhdGFUYWJsZUNvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YXRhYmxlJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBJMThuU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2kxOG4uc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dmLXVzZXItaGVscGVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdXNlci1oZWxwZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3VzZXItaGVscGVyLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVXNlckhlbHBlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIHByaXZhdGUgcGFnZUxpc3QgPSBbMTAsIDIwLCAzMCwgNTAsIDEwMF07XHJcbiAgcGFnaW5hdGlvbk9wdGlvbnM6IFBhZ2luYXRpb25JbnN0YW5jZSA9IHtcclxuICAgIGlkOiAnV0YtVXNlcnMtRGF0YVRhYmxlLVBhZ2luYXRpb24nLFxyXG4gICAgY3VycmVudFBhZ2U6IDEsXHJcbiAgICBpdGVtc1BlclBhZ2U6IDEwLFxyXG4gICAgcGFnZUxpc3Q6IHRoaXMucGFnZUxpc3QsXHJcbiAgICB0b3RhbEl0ZW1zOiAwXHJcbiAgfTtcclxuICBjb2x1bW5zID0gW1xyXG4gICAgeyB0aXRsZTogdGhpcy5pMThuU2VydmljZSA/IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5jb2x1bW5OYW1lLmNvZGUnKSA6ICfnvJblj7cnLCBmaWVsZDogJ0NvZGUnLCB3aWR0aDogODAgfSxcclxuICAgIHsgdGl0bGU6IHRoaXMuaTE4blNlcnZpY2UgPyB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMuY29sdW1uTmFtZS5uYW1lJykgOiAn5aeT5ZCNJywgZmllbGQ6ICdOYW1lJywgd2lkdGg6IDkwIH0sXHJcbiAgICB7IHRpdGxlOiB0aGlzLmkxOG5TZXJ2aWNlID8gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhdGljLmNvbHVtbk5hbWUuZGVwYXJ0bWVudCcpIDogJ+mDqOmXqCcsIGZpZWxkOiAnT3JnTmFtZScsIHdpZHRoOiAyMDAgfV07XHJcblxyXG4gIHNlYXJjaFZhbHVlID0gbnVsbDtcclxuICB1c2VyTGlzdERhdGEgPSBbXTtcclxuICAvLyDmmK/lkKblhYHorrjlpJrpgIks6buY6K6k5aSa6YCJXHJcbiAgc2luZ2xlU2VsZWN0ID0gZmFsc2U7XHJcbiAgc2VsZWN0ZWRVc2Vyczoge1xyXG4gICAgSUQ6IHN0cmluZyxcclxuICAgIENvZGU6IHN0cmluZyxcclxuICAgIE5hbWU6IHN0cmluZyxcclxuICAgIE9yZ0lkOiBzdHJpbmcsXHJcbiAgICBPcmdOYW1lOiBzdHJpbmdcclxuICB9W10gPSBbXTtcclxuICBAVmlld0NoaWxkKCdhbGxVc2VyVGFibGUnKSB1c2VyVGFibGU6IERhdGFUYWJsZUNvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdhbGxVc2VyRGlhbG9nJykgdXNlckRpYWxvZz86IERpYWxvZ0NvbXBvbmVudDtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBPcHRpb25hbCgpIHByb3RlY3RlZCBpMThuU2VydmljZTogSTE4blNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgdXNlclN2YzogVXNlclNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgbm90aWZ5PzogTm90aWZ5U2VydmljZSxcclxuICApIHsgfVxyXG5cclxuICBAT3V0cHV0KClcclxuICBjb21wbGV0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVPaygpOiB2b2lkIHtcclxuICAgIHRocm93IG5ldyBFcnJvcign5rKh5pyJ5a6e546w77yM6ZyA6KaB5a2Q57uE5Lu25a6e546wJyk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDYW5jZWwoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbXBsZXRlZC5lbWl0KGZhbHNlKTtcclxuICAgIHRoaXMuc2hvd01vZGFsKGZhbHNlKTtcclxuICB9XHJcblxyXG4gIG9uUGFnZVNpemVDaGFuZ2UocGFnZVNpemUpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuaXRlbXNQZXJQYWdlID0gcGFnZVNpemU7XHJcbiAgICB0aGlzLmdldFVzZXJMaXN0KCk7XHJcbiAgfVxyXG5cclxuICBvblBhZ2VDaGFuZ2UoZXZlbnQpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMuY3VycmVudFBhZ2UgPSBldmVudC5wYWdlSW5kZXg7XHJcbiAgICB0aGlzLmdldFVzZXJMaXN0KCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0VXNlckxpc3QoKSB7XHJcbiAgICB0aGlzLnVzZXJTdmMuZ2V0VXNlckxpc3QodGhpcy5zZWFyY2hWYWx1ZSwgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5jdXJyZW50UGFnZSwgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5pdGVtc1BlclBhZ2UpXHJcbiAgICAgIC5zdWJzY3JpYmUoKHJlOiB7IHRvdGFsQ291bnQ6IG51bWJlciwgZGF0YTogYW55W10gfSkgPT4ge1xyXG4gICAgICAgIHRoaXMucGFnaW5hdGlvbk9wdGlvbnMudG90YWxJdGVtcyA9IHJlLnRvdGFsQ291bnQ7XHJcbiAgICAgICAgdGhpcy51c2VyTGlzdERhdGEgPSByZS5kYXRhLm1hcCh1ID0+ICh7XHJcbiAgICAgICAgICBJRDogdS5pZCxcclxuICAgICAgICAgIENvZGU6IHUuY29kZSxcclxuICAgICAgICAgIE5hbWU6IHUubmFtZSxcclxuICAgICAgICAgIE9yZ0lkOiB1LnN5c09yZ0lkLFxyXG4gICAgICAgICAgT3JnTmFtZTogdS5zeXNPcmdOYW1lLFxyXG4gICAgICAgICAgQ2hlY2tlZDogZmFsc2VcclxuICAgICAgICB9KSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlYXJjaChldmVudCkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5jdXJyZW50UGFnZSA9IDE7XHJcbiAgICB0aGlzLnNlYXJjaFZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KGV2ZW50LnZhbHVlKTtcclxuXHJcbiAgICBpZiAoZXZlbnQuZmllbGQgPT09ICcqJykge1xyXG4gICAgICB0aGlzLmdldFVzZXJMaXN0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGV2ZW50LmZpZWxkID09PSAnTmFtZScpIHtcclxuICAgICAgdGhpcy5nZXRVc2VyTGlzdCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZygn5Y+q5pSv5oyB55So5oi35ZCN56ew6L+H5ruk77yBJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgc2hvd01vZGFsKHNob3c6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgIHRoaXMudXNlckRpYWxvZy5zaG93KCk7XHJcbiAgICAgIHRoaXMuZ2V0VXNlckxpc3QoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOS4tOaXtuWkhOeQhuaWueahiFxyXG4gICAgICBpZiAodGhpcy51c2VyRGlhbG9nLmJlZm9yZUNsb3NlKSB7XHJcbiAgICAgICAgdGhpcy51c2VyRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
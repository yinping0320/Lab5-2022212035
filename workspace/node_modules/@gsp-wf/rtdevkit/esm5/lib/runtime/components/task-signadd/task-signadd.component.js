/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { UserHelperComponent } from '../user-helper/user-helper.component';
import { TaskService } from '../../services/task.service';
import { UserService } from '../../services/user.service';
import { NotifyService } from '@farris/ui-notify';
import { I18nService } from '../../services/i18n.service';
var TaskSignaddComponent = /** @class */ (function (_super) {
    tslib_1.__extends(TaskSignaddComponent, _super);
    function TaskSignaddComponent(taskSvc, userSvc, notify, i18nService) {
        var _this = _super.call(this, i18nService, userSvc) || this;
        _this.taskSvc = taskSvc;
        _this.userSvc = userSvc;
        _this.notify = notify;
        _this.i18nService = i18nService;
        _this.completed = new EventEmitter();
        _this.paginationOptions.id = 'WF-SignAdd-DataTable-Pagination';
        return _this;
    }
    Object.defineProperty(TaskSignaddComponent.prototype, "addsign_context", {
        set: /**
         * @param {?} context
         * @return {?}
         */
        function (context) {
            this.selectedUsers = [];
            this.addSignContext = tslib_1.__assign({}, context, { assignees: [] });
            this.showModal(!!this.addSignContext.workItemId);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TaskSignaddComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    TaskSignaddComponent.prototype.handleOk = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.selectedUsers = this.userTable.selections;
        // 征询
        if (this.addSignContext.action === 'AddSignFront') {
            // 需要校验选中用户
            if (!this.selectedUsers || this.selectedUsers.length < 1) {
                this.notify.info(this.i18nService.getValue('static.addsign.selectConsultant'));
                return;
            }
            this.addSignContext.assignees = this.selectedUsers.map((/**
             * @param {?} user
             * @return {?}
             */
            function (user) { return user.ID; }));
            this.taskSvc.addSign(this.addSignContext).subscribe((/**
             * @return {?}
             */
            function () {
                _this.notify.success(_this.i18nService.getValue('static.addsign.successConsult'));
                _this.completed.emit(true);
                _this.showModal(false);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                if (error && error.error && error.error.Message) {
                    _this.notify.error(error.error.Message);
                }
            }));
        }
        else {
            // 加签
            this.completed.emit(true);
            this.showModal(false);
        }
    };
    TaskSignaddComponent.decorators = [
        { type: Component, args: [{
                    selector: 'wf-task-signadd',
                    template: "<farris-dialog #allUserDialog [buttons]=\"buttonRef\" [width]=\"850\" [height]=\"520\" [title]=\"'\u7CFB\u7EDF\u7528\u6237'\">\r\n  <div class=\"d-flex flex-column my-data-grid h-100\" style=\"padding: 0 14px;\">\r\n    <div class=\"flex-auto\" style=\"position:relative;\">\r\n      <farris-datatable #allUserTable [columns]=\"columns\" [data]=\"userListData | paginate: paginationOptions\"\r\n        [showFilterBar]='true' [singleSelect]=\"singleSelect\" [idField]=\"'ID'\" [remote]=\"'server'\" (search)=\"search($event)\"\r\n        [pagination]='false'></farris-datatable>\r\n    </div>\r\n    <div style=\"position:relative;\">\r\n      <pagination-controls [id]=\"paginationOptions.id\" [previousLabel]=\"' '\" [nextLabel]=\"' '\"\r\n        (pageChange)=\"onPageChange($event)\" (pageSizeChange)=\"onPageSizeChange($event)\">\r\n      </pagination-controls>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"handleOk()\">\u786E\u5B9A</button>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"handleCancel()\">\u53D6\u6D88</button>\r\n</ng-template>",
                    styles: [".my-data-grid .filter-row .search-fields{padding-left:0!important}.my-data-grid .filter-row .search-text{padding-right:0!important}"]
                }] }
    ];
    /** @nocollapse */
    TaskSignaddComponent.ctorParameters = function () { return [
        { type: TaskService },
        { type: UserService },
        { type: NotifyService },
        { type: I18nService }
    ]; };
    TaskSignaddComponent.propDecorators = {
        addsign_context: [{ type: Input }],
        completed: [{ type: Output }]
    };
    return TaskSignaddComponent;
}(UserHelperComponent));
export { TaskSignaddComponent };
if (false) {
    /** @type {?} */
    TaskSignaddComponent.prototype.completed;
    /** @type {?} */
    TaskSignaddComponent.prototype.addSignContext;
    /**
     * @type {?}
     * @private
     */
    TaskSignaddComponent.prototype.taskSvc;
    /**
     * @type {?}
     * @protected
     */
    TaskSignaddComponent.prototype.userSvc;
    /**
     * @type {?}
     * @protected
     */
    TaskSignaddComponent.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    TaskSignaddComponent.prototype.i18nService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1zaWduYWRkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2YvcnRkZXZraXQvIiwic291cmNlcyI6WyJsaWIvcnVudGltZS9jb21wb25lbnRzL3Rhc2stc2lnbmFkZC90YXNrLXNpZ25hZGQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFMUQ7SUFLMEMsZ0RBQW1CO0lBa0IzRCw4QkFDVSxPQUFvQixFQUNsQixPQUFvQixFQUNwQixNQUFxQixFQUNyQixXQUF3QjtRQUpwQyxZQU1FLGtCQUFNLFdBQVcsRUFBRSxPQUFPLENBQUMsU0FFNUI7UUFQUyxhQUFPLEdBQVAsT0FBTyxDQUFhO1FBQ2xCLGFBQU8sR0FBUCxPQUFPLENBQWE7UUFDcEIsWUFBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixpQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQWJwQyxlQUFTLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQWdCbEMsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsR0FBRyxpQ0FBaUMsQ0FBQzs7SUFDaEUsQ0FBQztJQXhCRCxzQkFDVyxpREFBZTs7Ozs7UUFEMUIsVUFDMkIsT0FBWTtZQUNyQyxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsY0FBYyx3QkFBUSxPQUFPLElBQUUsU0FBUyxFQUFFLEVBQUUsR0FBRSxDQUFDO1lBQ3BELElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDbkQsQ0FBQzs7O09BQUE7Ozs7SUFxQkQsdUNBQVE7OztJQUFSO0lBQ0EsQ0FBQzs7OztJQUVELHVDQUFROzs7SUFBUjtRQUFBLGlCQXdCQztRQXZCQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO1FBQy9DLEtBQUs7UUFDTCxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxLQUFLLGNBQWMsRUFBRTtZQUNqRCxXQUFXO1lBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUN4RCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLENBQUM7Z0JBQy9FLE9BQU87YUFDUjtZQUNELElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRzs7OztZQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEVBQUUsRUFBUCxDQUFPLEVBQUMsQ0FBQztZQUN4RSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsU0FBUzs7O1lBQUM7Z0JBQ2xELEtBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLCtCQUErQixDQUFDLENBQUMsQ0FBQztnQkFDaEYsS0FBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzFCLEtBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDeEIsQ0FBQzs7OztZQUFFLFVBQUEsS0FBSztnQkFDTixJQUFHLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFO29CQUM5QyxLQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUN4QztZQUNILENBQUMsRUFBQyxDQUFDO1NBQ0o7YUFBTTtZQUNMLEtBQUs7WUFDTCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQzs7Z0JBNURGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsaUJBQWlCO29CQUMzQiw4b0NBQXdEOztpQkFFekQ7Ozs7Z0JBVFEsV0FBVztnQkFDWCxXQUFXO2dCQUNYLGFBQWE7Z0JBQ2IsV0FBVzs7O2tDQVNqQixLQUFLOzRCQU1MLE1BQU07O0lBaURULDJCQUFDO0NBQUEsQUE5REQsQ0FLMEMsbUJBQW1CLEdBeUQ1RDtTQXpEWSxvQkFBb0I7OztJQVEvQix5Q0FDb0M7O0lBR3BDLDhDQUtFOzs7OztJQUVBLHVDQUE0Qjs7Ozs7SUFDNUIsdUNBQThCOzs7OztJQUM5QixzQ0FBK0I7Ozs7O0lBQy9CLDJDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVXNlckhlbHBlckNvbXBvbmVudCB9IGZyb20gJy4uL3VzZXItaGVscGVyL3VzZXItaGVscGVyLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFRhc2tTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGFzay5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVXNlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy91c2VyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBJMThuU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2kxOG4uc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3dmLXRhc2stc2lnbmFkZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuLi91c2VyLWhlbHBlci91c2VyLWhlbHBlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdGFzay1zaWduYWRkLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGFza1NpZ25hZGRDb21wb25lbnQgZXh0ZW5kcyBVc2VySGVscGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IGFkZHNpZ25fY29udGV4dChjb250ZXh0OiBhbnkpIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRVc2VycyA9IFtdO1xyXG4gICAgdGhpcy5hZGRTaWduQ29udGV4dCA9IHsgLi4uY29udGV4dCwgYXNzaWduZWVzOiBbXSB9O1xyXG4gICAgdGhpcy5zaG93TW9kYWwoISF0aGlzLmFkZFNpZ25Db250ZXh0LndvcmtJdGVtSWQpO1xyXG4gIH1cclxuICBAT3V0cHV0KClcclxuICBjb21wbGV0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgLy8g5omn6KGM5Yqg562+5LiK5LiL5paH5Y+C5pWwXHJcbiAgYWRkU2lnbkNvbnRleHQ6IHtcclxuICAgIHdvcmtJdGVtSWQ6IHN0cmluZyxcclxuICAgIGFjdGlvbjogJ0FkZFNpZ25Gcm9udCcgfCAnQWRkU2lnbkJlaGluZCcsXHJcbiAgICBhc3NpZ25lZXM6IHN0cmluZ1tdLFxyXG4gICAgY29tbWVudDogJycvLyBUT0RPOiDliqDnrb7ml6Xlv5dcclxuICB9O1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSB0YXNrU3ZjOiBUYXNrU2VydmljZSxcclxuICAgIHByb3RlY3RlZCB1c2VyU3ZjOiBVc2VyU2VydmljZSxcclxuICAgIHByb3RlY3RlZCBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgaTE4blNlcnZpY2U6IEkxOG5TZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICBzdXBlcihpMThuU2VydmljZSwgdXNlclN2Yyk7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLmlkID0gJ1dGLVNpZ25BZGQtRGF0YVRhYmxlLVBhZ2luYXRpb24nO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVPaygpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRVc2VycyA9IHRoaXMudXNlclRhYmxlLnNlbGVjdGlvbnM7XHJcbiAgICAvLyDlvoHor6JcclxuICAgIGlmICh0aGlzLmFkZFNpZ25Db250ZXh0LmFjdGlvbiA9PT0gJ0FkZFNpZ25Gcm9udCcpIHtcclxuICAgICAgLy8g6ZyA6KaB5qCh6aqM6YCJ5Lit55So5oi3XHJcbiAgICAgIGlmICghdGhpcy5zZWxlY3RlZFVzZXJzIHx8IHRoaXMuc2VsZWN0ZWRVc2Vycy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMuYWRkc2lnbi5zZWxlY3RDb25zdWx0YW50JykpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmFkZFNpZ25Db250ZXh0LmFzc2lnbmVlcyA9IHRoaXMuc2VsZWN0ZWRVc2Vycy5tYXAodXNlciA9PiB1c2VyLklEKTtcclxuICAgICAgdGhpcy50YXNrU3ZjLmFkZFNpZ24odGhpcy5hZGRTaWduQ29udGV4dCkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXRpYy5hZGRzaWduLnN1Y2Nlc3NDb25zdWx0JykpO1xyXG4gICAgICAgIHRoaXMuY29tcGxldGVkLmVtaXQodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5zaG93TW9kYWwoZmFsc2UpO1xyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgaWYoZXJyb3IgJiYgZXJyb3IuZXJyb3IgJiYgZXJyb3IuZXJyb3IuTWVzc2FnZSkge1xyXG4gICAgICAgICAgdGhpcy5ub3RpZnkuZXJyb3IoZXJyb3IuZXJyb3IuTWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOWKoOetvlxyXG4gICAgICB0aGlzLmNvbXBsZXRlZC5lbWl0KHRydWUpO1xyXG4gICAgICB0aGlzLnNob3dNb2RhbChmYWxzZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
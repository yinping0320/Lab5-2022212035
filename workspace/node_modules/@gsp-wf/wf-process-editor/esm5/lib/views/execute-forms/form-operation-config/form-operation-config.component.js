/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, TemplateRef, ComponentFactoryResolver, Injector, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { workFlowActions, executionTime, FormMethodConfig } from '../entities/form-method-config';
import { HttpService } from '@ecp-caf/caf-common';
import { DialogComponent } from '@farris/ui-dialog';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { ParameterSettingComponent } from '../parameter-setting/parameter-setting.component';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../../i18n/pipe/wf-process-editor-locale.pipe';
var FormOperationConfigComponent = /** @class */ (function () {
    function FormOperationConfigComponent(http, message, resolver, injector, modalService, cdr, localeId, resources, localePipe) {
        this.http = http;
        this.message = message;
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.operations = new Array();
        this.cols = new Array();
        this.methodCols = [
            { field: 'method', width: 100, title: this.localePipe.transform("component.executeForms.method"), showTips: true },
            { field: 'methodName', width: 80, title: this.localePipe.transform("component.executeForms.methodName"), showTips: true },
            { field: 'description', width: 120, title: this.localePipe.transform("component.executeForms.description"), showTips: true }
        ];
        this.formMethods = new Array();
        this.state = 'add';
    }
    Object.defineProperty(FormOperationConfigComponent.prototype, "formFormatId", {
        get: /**
         * @return {?}
         */
        function () {
            return this._fromFormatId;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this._fromFormatId = v;
            if (this._fromFormatId) {
                this.getFormMethods();
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.cols = [
            {
                field: 'workFlowAction', width: 80, title: this.localePipe.transform("component.executeForms.workFlowAction"),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: workFlowActions }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: workFlowActions, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'method', width: 100, title: this.localePipe.transform("component.executeForms.formOperations"),
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            _this.e = e;
                            _this.methodsDialog.show();
                            _this.state = 'edit';
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            console.log('clear', e);
                        })
                    }
                },
                formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                function (v, d, i) {
                    if (v) {
                        /** @type {?} */
                        var m = _this.formMethods.find((/**
                         * @param {?} item
                         * @return {?}
                         */
                        function (item) { return item.method === v; }));
                        if (m) {
                            return m.methodName;
                        }
                        else {
                            return '';
                        }
                    }
                    else {
                        return '';
                    }
                }),
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'executionTime', width: 80, title: this.localePipe.transform("component.executeForms.executionTime"),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: executionTime }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: executionTime, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'sortOrder', width: 60, title: this.localePipe.transform("component.executeForms.sortOrder"),
                editor: {
                    type: EditorTypes.NUMBERBOX, options: {}
                },
                formatter: { type: 'number', options: { precision: 0 } },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'methodParameters', width: 80, title: this.localePipe.transform("component.executeForms.methodParameters"),
                template: this.cell,
                halign: 'center', align: 'center'
            }
        ];
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.add = /**
     * @return {?}
     */
    function () {
        this.methodsDialog.show();
        this.state = 'add';
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.delete = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.grid.selectedRow) {
            this.operations = this.operations.filter((/**
             * @param {?} o
             * @return {?}
             */
            function (o) { return o.id !== _this.grid.selectedRow.id; }));
        }
        else {
            this.message.info(this.localePipe.transform("component.executeForms.selectFormActionConfig"));
        }
    };
    /**
     * @param {?} ctx
     * @return {?}
     */
    FormOperationConfigComponent.prototype.editParam = /**
     * @param {?} ctx
     * @return {?}
     */
    function (ctx) {
        var _this = this;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(ParameterSettingComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.mode = 'usual';
        compRef.instance.showFormType = false;
        if (ctx.rowData.methodParameters) {
            compRef.instance.parameters = tslib_1.__spread(ctx.rowData.methodParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            function (p) { return Object.assign({}, p); })));
        }
        else {
            compRef.instance.parameters = new Array();
        }
        /** @type {?} */
        var modalConfig = {
            title: this.localePipe.transform("component.executeForms.parameterSettings"),
            width: 620,
            height: 400,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.submit.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            var e_1, _a;
            try {
                for (var _b = tslib_1.__values(_this.operations), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var o = _c.value;
                    if (o.id === ctx.rowData.id) {
                        o.methodParameters = re.parameters;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
            dialog.close();
        }));
        compRef.instance.cancel.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            dialog.close();
        }));
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.methodSelected = /**
     * @return {?}
     */
    function () {
        var e_2, _a;
        if (this.methodGrid.selectedRow) {
            /** @type {?} */
            var data = this.methodGrid.selectedRow.data;
            if (this.state === 'edit') {
                if (this.e) {
                    this.e.formControl.setValue(data.method);
                    this.e.instance.cd.detectChanges();
                    try {
                        for (var _b = tslib_1.__values(this.operations), _c = _b.next(); !_c.done; _c = _b.next()) {
                            var o = _c.value;
                            if (o.id === data.id) {
                                o.method = data.method;
                                o.sortOrder = data.sortOrder;
                                o.methodParameters = data.methodParameters;
                            }
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                }
            }
            else {
                /** @type {?} */
                var operation = new FormMethodConfig();
                operation.formFormatConfigId = this.formFormatConfigId;
                operation.method = data.method;
                operation.sortOrder = data.sortOrder;
                operation.methodParameters = data.methodParameters;
                this.operations = this.operations.concat([operation]);
            }
            this.methodsDialog.close();
        }
        else {
            this.message.info(this.localePipe.transform("component.executeForms.selectFormAction"));
        }
    };
    /**
     * @return {?}
     */
    FormOperationConfigComponent.prototype.validator = /**
     * @return {?}
     */
    function () {
        var e_3, _a;
        this.grid.endCellEdit();
        try {
            for (var _b = tslib_1.__values(this.operations), _c = _b.next(); !_c.done; _c = _b.next()) {
                var o = _c.value;
                if (!o.method) {
                    this.message.info(this.localePipe.transform("component.executeForms.selectFormAction"));
                    return false;
                }
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return true;
    };
    /**
     * @private
     * @return {?}
     */
    FormOperationConfigComponent.prototype.getFormMethods = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.formFormatId) {
            /** @type {?} */
            var url = "/api/runtime/wf/v1.0/formOperation?formFormatId=" + this.formFormatId;
            this.http.get(url).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                if (re) {
                    _this.formMethods = re;
                }
            }));
        }
    };
    FormOperationConfigComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-form-operation-config',
                    template: "<div class=\"f-utils-fill-flex-column h-100\" style=\"background: #FFF;\">\r\n  <farris-datagrid class=\"f-component-grid f-utils-fill\" [columns]=\"cols\" [data]=\"operations\" #grid\r\n    [idField]=\"'id'\" [showLineNumber]=\"true\" [fitColumns]=\"true\" [striped]=\"true\" [showCheckbox]=\"false\"\r\n    [virtualized]=\"true\" [pagination]=\"false\" [useThemes]=\"false\" [fit]=\"true\"\r\n    [editable]=\"true\" [editMode]=\"'cell'\" >\r\n  </farris-datagrid>\r\n  <ng-template #cell let-ctx>\r\n    <a href=\"javascript: void(0);\" title=\"{{'component.executeForms.parameterSettings'|wfLocale}}\" (click)=\"editParam(ctx)\">{{'component.executeForms.editParam'|wfLocale}}</a>\r\n  </ng-template>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"methodsDialog.close()\">{{'component.executeForms.clickCancel'|wfLocale}}</button>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"methodSelected()\">{{'component.executeForms.clickOK'|wfLocale}}</button>\r\n</ng-template>\r\n<farris-dialog #methodsDialog [buttons]=\"buttonRef\" [width]=\"700\" [height]=\"500\" title=\"{{'component.executeForms.formEvents'|wfLocale}}\">\r\n  <div class=\"f-page f-page-is-managelist\">\r\n    <div class=\"f-page-main\">\r\n      <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n        <farris-section class=\"f-section-grid f-section-in-managelist p-0\" [showHeader]=\"false\">\r\n          <farris-datagrid class=\"f-component-grid\" [columns]=\"methodCols\" [data]=\"formMethods\" #methodGrid [idField]=\"'id'\"\r\n            [showLineNumber]=\"true\" [striped]=\"true\" [showCheckbox]=\"false\" [virtualized]=\"true\" [pagination]=\"false\"\r\n            [fit]=\"true\" [fitColumns]=\"true\">\r\n          </farris-datagrid>\r\n        </farris-section>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n",
                    providers: [
                        WfLocalePipe,
                    ],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    FormOperationConfigComponent.ctorParameters = function () { return [
        { type: HttpService },
        { type: MessagerService },
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: BsModalService },
        { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
        { type: WfLocalePipe, decorators: [{ type: Optional }] }
    ]; };
    FormOperationConfigComponent.propDecorators = {
        formFormatId: [{ type: Input }],
        formFormatConfigId: [{ type: Input }],
        operations: [{ type: Input }],
        methodsDialog: [{ type: ViewChild, args: ['methodsDialog',] }],
        grid: [{ type: ViewChild, args: ['grid',] }],
        methodGrid: [{ type: ViewChild, args: ['methodGrid',] }],
        cell: [{ type: ViewChild, args: ['cell',] }]
    };
    return FormOperationConfigComponent;
}());
export { FormOperationConfigComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype._fromFormatId;
    /** @type {?} */
    FormOperationConfigComponent.prototype.formFormatConfigId;
    /** @type {?} */
    FormOperationConfigComponent.prototype.operations;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodsDialog;
    /** @type {?} */
    FormOperationConfigComponent.prototype.grid;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodGrid;
    /** @type {?} */
    FormOperationConfigComponent.prototype.cell;
    /** @type {?} */
    FormOperationConfigComponent.prototype.cols;
    /** @type {?} */
    FormOperationConfigComponent.prototype.methodCols;
    /** @type {?} */
    FormOperationConfigComponent.prototype.e;
    /** @type {?} */
    FormOperationConfigComponent.prototype.formMethods;
    /** @type {?} */
    FormOperationConfigComponent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    FormOperationConfigComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvZXhlY3V0ZS1mb3Jtcy9mb3JtLW9wZXJhdGlvbi1jb25maWcvZm9ybS1vcGVyYXRpb24tY29uZmlnLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JLLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUM3RixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFHbkc7SUF5Q0Usc0NBQ1UsSUFBaUIsRUFDakIsT0FBd0IsRUFDeEIsUUFBa0MsRUFDbEMsUUFBa0IsRUFDbEIsWUFBNEIsRUFDaEIsR0FBc0IsRUFDZixRQUFnQixFQUNSLFNBQWMsRUFDN0IsVUFB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QVE7Z0JBUXBGLGNBQWM7Z0JBUndFLGlCQUFpQix1QkE0RDNHLFFBQVE7NkNBQ1IsTUFBTSxTQUFDLFNBQVM7Z0RBQ2hCLE1BQU0sU0FBQyxpQkFBaUI7Z0JBcERELFlBQVksdUJBcURuQyxRQUFROzs7K0JBeENWLEtBQUs7cUNBV0wsS0FBSzs2QkFDTCxLQUFLO2dDQUVMLFNBQVMsU0FBQyxlQUFlO3VCQUN6QixTQUFTLFNBQUMsTUFBTTs2QkFDaEIsU0FBUyxTQUFDLFlBQVk7dUJBQ3RCLFNBQVMsU0FBQyxNQUFNOztJQTZNbkIsbUNBQUM7Q0FBQSxBQXhPRCxJQXdPQztTQWhPWSw0QkFBNEI7Ozs7OztJQUN2QyxxREFBOEI7O0lBWTlCLDBEQUFvQzs7SUFDcEMsa0RBQW9EOztJQUVwRCxxREFBMkQ7O0lBQzNELDRDQUEyQzs7SUFDM0Msa0RBQXVEOztJQUN2RCw0Q0FBMEM7O0lBRTFDLDRDQUFtQjs7SUFFbkIsa0RBSUU7O0lBQ0YseUNBQU87O0lBRVAsbURBQXNDOztJQUN0Qyw2Q0FBOEI7Ozs7O0lBRzVCLDRDQUF5Qjs7Ozs7SUFDekIsK0NBQWdDOzs7OztJQUNoQyxnREFBMEM7Ozs7O0lBQzFDLGdEQUEwQjs7Ozs7SUFDMUIsb0RBQW9DOzs7OztJQUNwQywyQ0FBMEM7Ozs7O0lBQzFDLGdEQUEyQzs7Ozs7SUFDM0MsaURBQWlEOzs7OztJQUNqRCxrREFBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0b3IsIENoYW5nZURldGVjdG9yUmVmLCBPcHRpb25hbCwgSW5qZWN0LCBMT0NBTEVfSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRWRpdG9yVHlwZXMgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkLWVkaXRvcnMnO1xyXG5pbXBvcnQgeyB3b3JrRmxvd0FjdGlvbnMsIGV4ZWN1dGlvblRpbWUsIEZvcm1NZXRob2RDb25maWcgfSBmcm9tICcuLi9lbnRpdGllcy9mb3JtLW1ldGhvZC1jb25maWcnO1xyXG5pbXBvcnQgeyBIdHRwU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBGb3JtTWV0aG9kIH0gZnJvbSAnLi4vZW50aXRpZXMvZm9ybS1tZXRob2QnO1xyXG5pbXBvcnQgeyBEaWFsb2dDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBQYXJhbWV0ZXJTZXR0aW5nQ29tcG9uZW50IH0gZnJvbSAnLi4vcGFyYW1ldGVyLXNldHRpbmcvcGFyYW1ldGVyLXNldHRpbmcuY29tcG9uZW50JztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1mb3JtLW9wZXJhdGlvbi1jb25maWcnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9mb3JtLW9wZXJhdGlvbi1jb25maWcuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2Zvcm0tb3BlcmF0aW9uLWNvbmZpZy5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGb3JtT3BlcmF0aW9uQ29uZmlnQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBwcml2YXRlIF9mcm9tRm9ybWF0SWQ6IHN0cmluZztcclxuICBASW5wdXQoKVxyXG4gIHNldCBmb3JtRm9ybWF0SWQodjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLl9mcm9tRm9ybWF0SWQgPSB2O1xyXG4gICAgaWYgKHRoaXMuX2Zyb21Gb3JtYXRJZCkge1xyXG4gICAgICB0aGlzLmdldEZvcm1NZXRob2RzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGdldCBmb3JtRm9ybWF0SWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZnJvbUZvcm1hdElkO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KCkgZm9ybUZvcm1hdENvbmZpZ0lkOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgb3BlcmF0aW9ucyA9IG5ldyBBcnJheTxGb3JtTWV0aG9kQ29uZmlnPigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdtZXRob2RzRGlhbG9nJykgbWV0aG9kc0RpYWxvZzogRGlhbG9nQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2dyaWQnKSBncmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdtZXRob2RHcmlkJykgbWV0aG9kR3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnY2VsbCcpIGNlbGw6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gIGNvbHMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgbWV0aG9kQ29scyA9IFtcclxuICAgIHsgZmllbGQ6ICdtZXRob2QnLCB3aWR0aDogMTAwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5leGVjdXRlRm9ybXMubWV0aG9kXCIpLCBzaG93VGlwczogdHJ1ZSB9LFxyXG4gICAgeyBmaWVsZDogJ21ldGhvZE5hbWUnLCB3aWR0aDogODAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5tZXRob2ROYW1lXCIpLCBzaG93VGlwczogdHJ1ZSB9LFxyXG4gICAgeyBmaWVsZDogJ2Rlc2NyaXB0aW9uJywgd2lkdGg6IDEyMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQuZXhlY3V0ZUZvcm1zLmRlc2NyaXB0aW9uXCIpLCBzaG93VGlwczogdHJ1ZSB9XHJcbiAgXTtcclxuICBlOiBhbnk7XHJcblxyXG4gIGZvcm1NZXRob2RzID0gbmV3IEFycmF5PEZvcm1NZXRob2Q+KCk7XHJcbiAgc3RhdGU6ICdhZGQnIHwgJ2VkaXQnID0gJ2FkZCc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQEluamVjdChXRl9MQU5HX1JFU09VUkNFUykgcHJpdmF0ZSByZXNvdXJjZXM6IGFueSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbG9jYWxlUGlwZTogV2ZMb2NhbGVQaXBlLFxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb2xzID0gW1xyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ3dvcmtGbG93QWN0aW9uJywgd2lkdGg6IDgwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5leGVjdXRlRm9ybXMud29ya0Zsb3dBY3Rpb25cIiksXHJcbiAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgIHR5cGU6ICdlbnVtJyxcclxuICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB3b3JrRmxvd0FjdGlvbnMgfVxyXG4gICAgICB9LFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5DT01CT0xJU1QsXHJcbiAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogd29ya0Zsb3dBY3Rpb25zLCBpZEZpZWxkOiAndmFsdWUnLCBwYW5lbEhlaWdodDogJ2F1dG8nLCBlbmFibGVDbGVhcjogZmFsc2UgfVxyXG4gICAgICB9LFxyXG4gICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICBdXHJcbiAgICB9LCB7XHJcbiAgICAgIGZpZWxkOiAnbWV0aG9kJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQuZXhlY3V0ZUZvcm1zLmZvcm1PcGVyYXRpb25zXCIpLFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiAnaW5wdXQtZ3JvdXAnLFxyXG4gICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgIGNsaWNrSGFuZGxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICB0aGlzLmUgPSBlO1xyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZHNEaWFsb2cuc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gJ2VkaXQnO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNsZWFyOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXInLCBlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZvcm1hdHRlcjogKHYsIGQsIGkpID0+IHtcclxuICAgICAgICBpZiAodikge1xyXG4gICAgICAgICAgY29uc3QgbSA9IHRoaXMuZm9ybU1ldGhvZHMuZmluZChpdGVtID0+IGl0ZW0ubWV0aG9kID09PSB2KTtcclxuICAgICAgICAgIGlmIChtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtLm1ldGhvZE5hbWU7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnZXhlY3V0aW9uVGltZScsIHdpZHRoOiA4MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQuZXhlY3V0ZUZvcm1zLmV4ZWN1dGlvblRpbWVcIiksXHJcbiAgICAgIGZvcm1hdHRlcjoge1xyXG4gICAgICAgIHR5cGU6ICdlbnVtJyxcclxuICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiBleGVjdXRpb25UaW1lIH1cclxuICAgICAgfSxcclxuICAgICAgZWRpdG9yOiB7XHJcbiAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IGV4ZWN1dGlvblRpbWUsIGlkRmllbGQ6ICd2YWx1ZScsIHBhbmVsSGVpZ2h0OiAnYXV0bycsIGVuYWJsZUNsZWFyOiBmYWxzZSB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnc29ydE9yZGVyJywgd2lkdGg6IDYwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5leGVjdXRlRm9ybXMuc29ydE9yZGVyXCIpLFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5OVU1CRVJCT1gsIG9wdGlvbnM6IHtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZvcm1hdHRlcjogeyB0eXBlOiAnbnVtYmVyJywgb3B0aW9uczogeyBwcmVjaXNpb246IDAgfSB9LFxyXG4gICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgeyB0eXBlOiAncmVxdWlyZWQnLCBtZXNzYWdlcjogJ+W/heWhqycgfVxyXG4gICAgICBdXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ21ldGhvZFBhcmFtZXRlcnMnLCB3aWR0aDogODAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5tZXRob2RQYXJhbWV0ZXJzXCIpLFxyXG4gICAgICB0ZW1wbGF0ZTogdGhpcy5jZWxsLFxyXG4gICAgICBoYWxpZ246ICdjZW50ZXInLCBhbGlnbjogJ2NlbnRlcidcclxuICAgIH1cclxuICBdO1xyXG4gIH1cclxuXHJcbiAgYWRkKCkge1xyXG4gICAgdGhpcy5tZXRob2RzRGlhbG9nLnNob3coKTtcclxuICAgIHRoaXMuc3RhdGUgPSAnYWRkJztcclxuICB9XHJcblxyXG4gIGRlbGV0ZSgpIHtcclxuICAgIGlmICh0aGlzLmdyaWQuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgdGhpcy5vcGVyYXRpb25zID0gdGhpcy5vcGVyYXRpb25zLmZpbHRlcihvID0+IG8uaWQgIT09IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdy5pZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5zZWxlY3RGb3JtQWN0aW9uQ29uZmlnXCIpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGVkaXRQYXJhbShjdHg6IGFueSkge1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFBhcmFtZXRlclNldHRpbmdDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UubW9kZSA9ICd1c3VhbCc7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnNob3dGb3JtVHlwZSA9IGZhbHNlO1xyXG4gICAgaWYgKGN0eC5yb3dEYXRhLm1ldGhvZFBhcmFtZXRlcnMpIHtcclxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5wYXJhbWV0ZXJzID0gWy4uLmN0eC5yb3dEYXRhLm1ldGhvZFBhcmFtZXRlcnMubWFwKHAgPT4gT2JqZWN0LmFzc2lnbih7fSwgcCkpXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UucGFyYW1ldGVycyA9IG5ldyBBcnJheSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1vZGFsQ29uZmlnID0ge1xyXG4gICAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5leGVjdXRlRm9ybXMucGFyYW1ldGVyU2V0dGluZ3NcIiksXHJcbiAgICAgIHdpZHRoOiA2MjAsXHJcbiAgICAgIGhlaWdodDogNDAwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlclxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG5cclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc3VibWl0LnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGZvciAoY29uc3QgbyBvZiB0aGlzLm9wZXJhdGlvbnMpIHtcclxuICAgICAgICBpZiAoby5pZCA9PT0gY3R4LnJvd0RhdGEuaWQpIHtcclxuICAgICAgICAgIG8ubWV0aG9kUGFyYW1ldGVycyA9IHJlLnBhcmFtZXRlcnM7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNhbmNlbC5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbWV0aG9kU2VsZWN0ZWQoKSB7XHJcbiAgICBpZiAodGhpcy5tZXRob2RHcmlkLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1ldGhvZEdyaWQuc2VsZWN0ZWRSb3cuZGF0YTtcclxuICAgICAgaWYgKHRoaXMuc3RhdGUgPT09ICdlZGl0Jykge1xyXG4gICAgICAgIGlmICh0aGlzLmUpIHtcclxuICAgICAgICAgIHRoaXMuZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShkYXRhLm1ldGhvZCk7XHJcbiAgICAgICAgICB0aGlzLmUuaW5zdGFuY2UuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgICAgZm9yIChjb25zdCBvIG9mIHRoaXMub3BlcmF0aW9ucykge1xyXG4gICAgICAgICAgICBpZiAoby5pZCA9PT0gZGF0YS5pZCkge1xyXG4gICAgICAgICAgICAgIG8ubWV0aG9kID0gZGF0YS5tZXRob2Q7XHJcbiAgICAgICAgICAgICAgby5zb3J0T3JkZXIgPSBkYXRhLnNvcnRPcmRlcjtcclxuICAgICAgICAgICAgICBvLm1ldGhvZFBhcmFtZXRlcnMgPSBkYXRhLm1ldGhvZFBhcmFtZXRlcnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gbmV3IEZvcm1NZXRob2RDb25maWcoKTtcclxuICAgICAgICBvcGVyYXRpb24uZm9ybUZvcm1hdENvbmZpZ0lkID0gdGhpcy5mb3JtRm9ybWF0Q29uZmlnSWQ7XHJcbiAgICAgICAgb3BlcmF0aW9uLm1ldGhvZCA9IGRhdGEubWV0aG9kO1xyXG4gICAgICAgIG9wZXJhdGlvbi5zb3J0T3JkZXIgPSBkYXRhLnNvcnRPcmRlcjtcclxuICAgICAgICBvcGVyYXRpb24ubWV0aG9kUGFyYW1ldGVycyA9IGRhdGEubWV0aG9kUGFyYW1ldGVycztcclxuICAgICAgICB0aGlzLm9wZXJhdGlvbnMgPSB0aGlzLm9wZXJhdGlvbnMuY29uY2F0KFtvcGVyYXRpb25dKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLm1ldGhvZHNEaWFsb2cuY2xvc2UoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQuZXhlY3V0ZUZvcm1zLnNlbGVjdEZvcm1BY3Rpb25cIikpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdmFsaWRhdG9yKCk6IGJvb2xlYW4ge1xyXG4gICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICBmb3IgKGNvbnN0IG8gb2YgdGhpcy5vcGVyYXRpb25zKSB7XHJcbiAgICAgIGlmICghby5tZXRob2QpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5zZWxlY3RGb3JtQWN0aW9uXCIpKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRGb3JtTWV0aG9kcygpIHtcclxuICAgIGlmICh0aGlzLmZvcm1Gb3JtYXRJZCkge1xyXG4gICAgICBjb25zdCB1cmwgPSBgL2FwaS9ydW50aW1lL3dmL3YxLjAvZm9ybU9wZXJhdGlvbj9mb3JtRm9ybWF0SWQ9JHt0aGlzLmZvcm1Gb3JtYXRJZH1gO1xyXG4gICAgICB0aGlzLmh0dHAuZ2V0KHVybCkuc3Vic2NyaWJlKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHJlKSB7XHJcbiAgICAgICAgICB0aGlzLmZvcm1NZXRob2RzID0gcmU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==
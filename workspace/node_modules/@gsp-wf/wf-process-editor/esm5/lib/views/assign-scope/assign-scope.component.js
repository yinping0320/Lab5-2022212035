/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, EventEmitter, Inject, Input, LOCALE_ID, Optional, Output, TemplateRef, ViewChild } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
import { DisplayInfor, OtherAssignActivityNodeInfo } from './other-assign-activity-node-info';
import { DialogComponent } from '@farris/ui-dialog';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
var AssignScopeComponent = /** @class */ (function () {
    function AssignScopeComponent(uistate, message, exprService, cdr, localeId, resources, localePipe) {
        var _this = this;
        this.uistate = uistate;
        this.message = message;
        this.exprService = exprService;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.items = new Array();
        this.listItems = new Array();
        this.modalConfig = {
            title: this.localePipe.transform('component.assignScope.assignScopeList'),
            width: 600,
            height: 520,
            showButtons: true
        };
        this.cols = [
            { title: this.localePipe.transform('component.assignScope.name'), field: 'name', width: 80 },
            { title: 'ID', field: 'activityDefinitionId', width: 100 },
            { title: this.localePipe.transform('component.assignScope.required'), field: 'required', width: 50,
                editor: {
                    type: EditorTypes.SWITCH,
                    options: {}
                },
                formatter: { type: 'boolean', options: { trueText: this.localePipe.transform('component.assignScope.yes'), falseText: this.localePipe.transform('component.assignScope.no') } },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            { title: this.localePipe.transform('component.assignScope.condition'), field: 'condition', width: 70,
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            _this.editConditon(e);
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        function (e) {
                            console.log('clear', e);
                        })
                    }
                }
            }
        ];
        this.nodeCols = [
            { title: this.localePipe.transform('component.assignScope.name'), field: 'Name', width: 100, filter: true },
            { title: 'ID', field: 'Id', width: 100, filter: true },
        ];
        // otherAssignActivities = new Array();
        this.otherAssignActivityNodeInfos = new Array();
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    Object.defineProperty(AssignScopeComponent.prototype, "value", {
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            var _this = this;
            if (data && data.length > 0) {
                // this.otherAssignActivities = [...data];
                data.forEach((/**
                 * @param {?} data1
                 * @return {?}
                 */
                function (data1) {
                    /** @type {?} */
                    var otherAssignActivityNodeInfo = new OtherAssignActivityNodeInfo(data1.activityDefinitionId, data1.condition ? data1.condition.Value : data1.condition, data1.required);
                    _this.otherAssignActivityNodeInfos.push(otherAssignActivityNodeInfo);
                }));
                this.otherAssignActivityNodeInfos.forEach((/**
                 * @param {?} other
                 * @return {?}
                 */
                function (other) {
                    /** @type {?} */
                    var displayInfo = new DisplayInfor(null, other.activityDefinitionId);
                    displayInfo.required = other.required;
                    if (other.condition) {
                        displayInfo.condition = other.condition.Value;
                    }
                    // displayInfo.name = this.items.find(item => item.Id === displayInfo.activityDefinitionId).Name;
                    _this.listItems.push(displayInfo);
                }));
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var e_1, _a, e_2, _b;
        if (!this.location) {
            this.location = this.editorParams.location;
        }
        /** @type {?} */
        var activities = new Array();
        if (this.location === 'startActivity') {
            activities = tslib_1.__spread(this.uistate.userActList.filter((/**
             * @param {?} a
             * @return {?}
             */
            function (a) { return a.Id !== _this.uistate.propertyData.Id
                && a.AssignmentStrategy === 'ASSIGN'
                && a.AssignPerformerConfig
                && a.AssignPerformerConfig.Operator === 'procInstCreator'; })));
        }
        else {
            activities = tslib_1.__spread(this.uistate.userActList.filter((/**
             * @param {?} a
             * @return {?}
             */
            function (a) { return a.Id !== _this.uistate.propertyData.Id && a.AssignmentStrategy === 'ASSIGN'; })));
        }
        if (this.otherAssignActivityNodeInfos && this.otherAssignActivityNodeInfos.length > 0) {
            var _loop_1 = function (other) {
                /** @type {?} */
                var activity = activities.find((/**
                 * @param {?} a
                 * @return {?}
                 */
                function (a) { return a.Id === other.activityDefinitionId; }));
                if (activity) {
                    this_1.items = this_1.items.concat([activity]);
                }
            };
            var this_1 = this;
            try {
                for (var _c = tslib_1.__values(this.otherAssignActivityNodeInfos), _d = _c.next(); !_d.done; _d = _c.next()) {
                    var other = _d.value;
                    _loop_1(other);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                }
                finally { if (e_1) throw e_1.error; }
            }
            var _loop_2 = function (activity) {
                if (this_2.items.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.Id === activity.Id; })) === -1) {
                    this_2.items = this_2.items.concat([activity]);
                }
            };
            var this_2 = this;
            try {
                for (var activities_1 = tslib_1.__values(activities), activities_1_1 = activities_1.next(); !activities_1_1.done; activities_1_1 = activities_1.next()) {
                    var activity = activities_1_1.value;
                    _loop_2(activity);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (activities_1_1 && !activities_1_1.done && (_b = activities_1.return)) _b.call(activities_1);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
        else {
            this.items = activities;
        }
        this.listItems.forEach((/**
         * @param {?} listItem
         * @return {?}
         */
        function (listItem) {
            listItem.name = _this.items.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.Id === listItem.activityDefinitionId; })).Name;
        }));
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var e_3, _a;
        if (this.otherAssignActivityNodeInfos && this.otherAssignActivityNodeInfos.length > 0) {
            try {
                for (var _b = tslib_1.__values(this.otherAssignActivityNodeInfos), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var other = _c.value;
                    this.grid.checkRow(other.activityDefinitionId);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.delete = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.grid.endCellEdit();
        if (this.grid.selectedRow && this.grid.selectedRow.data) {
            /** @type {?} */
            var i = this.listItems.findIndex((/**
             * @param {?} d
             * @return {?}
             */
            function (d) { return d.activityDefinitionId === _this.grid.selectedRow.data.activityDefinitionId; }));
            this.listItems.splice(i, 1);
            this.grid.loadData(this.listItems);
        }
        else {
            this.message.info(this.localePipe.transform('component.assignScope.deleteRow'));
        }
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.moveUp = /**
     * @return {?}
     */
    function () {
        if (!this.curActivity) {
            this.message.info(this.localePipe.transform('component.assignScope.curActivity'));
            return;
        }
        /** @type {?} */
        var curCmpId = this.curActivity.activityDefinitionId;
        /** @type {?} */
        var i = this.listItems.findIndex((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c.activityDefinitionId === curCmpId; }));
        if (i === 0) {
            return;
        }
        this.swapArray(this.listItems, i, i - 1);
        this.grid.loadData(this.listItems);
        this.grid.selectRow(curCmpId, true);
        // const selectedRow = this.grid.selectedRow;
        // debugger;
        // if (!selectedRow) {
        //   this.message.info('尚未选中行');
        //   return;
        // }
        // if (selectedRow.index === 0) {
        //   return;
        // }
        // this.swapArray(this.items, selectedRow.index, selectedRow.index - 1);
        // this.grid.loadData(this.items);
        // this.grid.selectRow(selectedRow.id, true);
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.moveDown = /**
     * @return {?}
     */
    function () {
        if (!this.curActivity) {
            this.message.info(this.localePipe.transform('component.assignScope.curActivity'));
            return;
        }
        /** @type {?} */
        var curCmpId = this.curActivity.activityDefinitionId;
        /** @type {?} */
        var i = this.listItems.findIndex((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c.activityDefinitionId === curCmpId; }));
        if (i === this.listItems.length - 1) {
            return;
        }
        this.swapArray(this.listItems, i, i + 1);
        this.grid.loadData(this.listItems);
        this.grid.selectRow(curCmpId, true);
        // const selectedRow = this.grid.selectedRow;
        // if (!selectedRow) {
        //   this.message.info('尚未选中行');
        //   return;
        // }
        // if (selectedRow.index === this.items.length - 1) {
        //   return;
        // }
        // this.swapArray(this.items, selectedRow.index, selectedRow.index + 1);
        // this.grid.loadData(this.items);
        // this.grid.selectRow(selectedRow.id, true);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AssignScopeComponent.prototype.selectionChange = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.curActivity = data.data;
    };
    /**
     * @private
     * @param {?} arr
     * @param {?} i1
     * @param {?} i2
     * @return {?}
     */
    AssignScopeComponent.prototype.swapArray = /**
     * @private
     * @param {?} arr
     * @param {?} i1
     * @param {?} i2
     * @return {?}
     */
    function (arr, i1, i2) {
        arr[i1] = arr.splice(i2, 1, arr[i1])[0];
        return arr;
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        var e_4, _a;
        this.otherAssignActivityNodeInfos = new Array();
        try {
            for (var _b = tslib_1.__values(this.listItems), _c = _b.next(); !_c.done; _c = _b.next()) {
                var item = _c.value;
                this.otherAssignActivityNodeInfos.push(new OtherAssignActivityNodeInfo(item.activityDefinitionId, item.condition, item.required));
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_4) throw e_4.error; }
        }
        /** @type {?} */
        var object = { value: this.otherAssignActivityNodeInfos, parameters: null };
        this.submitModal.emit(object);
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.closeModal.emit();
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.actionsSelect = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var selections = this.actionsTable1.checkeds;
        if (selections && selections.length > 0) {
            selections.forEach((/**
             * @param {?} action
             * @return {?}
             */
            function (action) {
                /** @type {?} */
                var item = new DisplayInfor(action.data.Name, action.data.Id);
                /** @type {?} */
                var index = _this.listItems.findIndex((/**
                 * @param {?} act
                 * @return {?}
                 */
                function (act) { return act.activityDefinitionId === action.data.Id; }));
                if (index > -1) {
                    _this.listItems.splice(index, 1);
                }
                _this.listItems.push(item);
            }));
            this.grid.loadData(this.listItems);
        }
        // 2023-6-13 关闭前清空已选数据
        this.actionsTable1.clearCheckeds(true);
        this.actionsDialog1.close();
    };
    /**
     * @return {?}
     */
    AssignScopeComponent.prototype.SelectCancel = /**
     * @return {?}
     */
    function () {
        // 2023-6-13 关闭前清空已选数据
        this.actionsTable1.clearCheckeds(true);
        this.actionsDialog1.close();
    };
    /**
     * @param {?} e
     * @return {?}
     */
    AssignScopeComponent.prototype.editConditon = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        var _this = this;
        var e_5, _a, e_6, _b, e_7, _c, e_8, _d;
        /** @type {?} */
        var context = new Array();
        // if(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage')) {
        //   context.push(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage'));
        // }
        // this.expr.clearContext();
        if (this.uistate.schemas.length > 0) {
            try {
                for (var _e = tslib_1.__values(this.uistate.schemas), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var schema = _f.value;
                    this.exprService.addSchema('Schema', schema);
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (_f && !_f.done && (_a = _e.return)) _a.call(_e);
                }
                finally { if (e_5) throw e_5.error; }
            }
            if (this.uistate.schemas[0].entityTypes && this.uistate.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                var entityType = this.uistate.schemas[0].entityTypes[0];
                this.exprService.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        context = this.uistate.addContext(context);
        if (this.uistate.subActivityContext.length > 0) {
            var _loop_3 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _g = tslib_1.__values(this.uistate.subActivityContext), _h = _g.next(); !_h.done; _h = _g.next()) {
                    var variable = _h.value;
                    _loop_3(variable);
                }
            }
            catch (e_6_1) { e_6 = { error: e_6_1 }; }
            finally {
                try {
                    if (_h && !_h.done && (_b = _g.return)) _b.call(_g);
                }
                finally { if (e_6) throw e_6.error; }
            }
        }
        if (this.uistate.activityComponentContext.length > 0) {
            var _loop_4 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _j = tslib_1.__values(this.uistate.activityComponentContext), _k = _j.next(); !_k.done; _k = _j.next()) {
                    var variable = _k.value;
                    _loop_4(variable);
                }
            }
            catch (e_7_1) { e_7 = { error: e_7_1 }; }
            finally {
                try {
                    if (_k && !_k.done && (_c = _j.return)) _c.call(_j);
                }
                finally { if (e_7) throw e_7.error; }
            }
        }
        if (context.length > 0) {
            try {
                for (var context_1 = tslib_1.__values(context), context_1_1 = context_1.next(); !context_1_1.done; context_1_1 = context_1.next()) {
                    var v = context_1_1.value;
                    this.exprService.addContext(v);
                }
            }
            catch (e_8_1) { e_8 = { error: e_8_1 }; }
            finally {
                try {
                    if (context_1_1 && !context_1_1.done && (_d = context_1.return)) _d.call(context_1);
                }
                finally { if (e_8) throw e_8.error; }
            }
        }
        this.exprService.setEditPattern(ExprEditMode.Conditional);
        this.exprService.addExpressionText(e.instance.value);
        this.exprService.buildExpression().then((/**
         * @param {?} cond
         * @return {?}
         */
        function (cond) {
            e.formControl.setValue(cond);
            e.instance.cd.detectChanges();
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                _this.exprService.exprEntity.contextEntities = _this.exprService.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                function (y) { return y.key === x.key; })); }));
            }
        }));
    };
    AssignScopeComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-assign-scope',
                    template: "<div class=\"f-page\">\r\n  <section class=\"f-page-main d-flex flex-column\">\r\n    <farris-section class=\"pt-0 f-section-grid f-section-in-managelist\" mainTitle=\"{{'component.assignScope.set'|wfLocale}}\" [enableAccordion]=\"''\"\r\n      [enableMaximize]=\"false\" [fill]=\"true\">\r\n      <ng-template farrisSectionToolbar>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"actionsDialog1.show()\">{{'component.assignScope.add'|wfLocale}}</button>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"delete()\">{{'component.assignScope.delete'|wfLocale}}</button>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"moveUp()\">{{'component.assignScope.moveUp'|wfLocale}}</button>\r\n        <button class=\"btn btn-secondary\" (click)=\"moveDown()\">{{'component.assignScope.moveDown'|wfLocale}}</button>\r\n      </ng-template>\r\n      <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\" style=\"border-radius:16px;border: 1.5px solid #F1F3F7;\">\r\n        <farris-datagrid class=\"f-component-grid\" [columns]=\"cols\" [data]=\"listItems\" #grid [idField]=\"'activityDefinitionId'\" [showLineNumber]=\"true\"\r\n          [striped]=\"true\" [multiSelect]=\"true\" [editMode]=\"'cell'\"\r\n          [checkOnSelect]=\"true\" [selectOnCheck]=\"true\"  [pagination]=\"false\" [fit]=\"true\" [fitColumns]=\"true\" [editable]=\"true\"\r\n          (selectChanged)=\"selectionChange($event)\">\r\n        </farris-datagrid>\r\n      </div>\r\n    </farris-section>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3\" (click)=\"clickCancel()\">{{'component.assignScope.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.assignScope.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-default px-3\" (click)=\"SelectCancel()\">{{'component.approvelItems.clickCancel' | wfLocale}}</button>\r\n  <button class=\"btn btn-sm btn-primary px-3\" (click)=\"actionsSelect()\">{{'component.approvelItems.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n<farris-dialog #actionsDialog1 [buttons]=\"buttonRef\" [width]=\"700\" [height]=\"520\" title='\u8282\u70B9\u5217\u8868'>\r\n  <!-- 2023-6-1 \u89E3\u51B3\u5BA1\u6279\u52A8\u4F5C\u5F39\u7A97\u53CC\u6EDA\u52A8\u6761\u7684\u95EE\u9898 -->\r\n  <div class=\"f-utils-fill-flex-column farris-overflow-y-hidden h-100\" style=\"margin-left: 8px;margin-right: 8px;\">\r\n    <farris-datagrid #actionsTable1 [columns]=\"nodeCols\" [data]=\"items\"\r\n      [idField]=\"'Id'\" [fit]=\"true\" [fitColumns]=\"true\" [pagination]='false' \r\n      [showCheckbox]=\"true\" [multiSelect]=\"true\" [checkOnSelect]=\"true\" [selectOnCheck]=\"true\" [showAllCheckbox]=\"true\" [striped]=\"true\">\r\n    </farris-datagrid>\r\n  </div>\r\n</farris-dialog>\r\n",
                    providers: [
                        WfLocalePipe,
                    ],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    AssignScopeComponent.ctorParameters = function () { return [
        { type: ProcessDesignerUIState },
        { type: MessagerService },
        { type: ExpressionService },
        { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
        { type: WfLocalePipe, decorators: [{ type: Optional }] }
    ]; };
    AssignScopeComponent.propDecorators = {
        closeModal: [{ type: Output }],
        submitModal: [{ type: Output }],
        modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
        grid: [{ type: ViewChild, args: ['grid',] }],
        actionsTable1: [{ type: ViewChild, args: ['actionsTable1',] }],
        actionsDialog1: [{ type: ViewChild, args: ['actionsDialog1',] }],
        editorParams: [{ type: Input }],
        value: [{ type: Input }]
    };
    return AssignScopeComponent;
}());
export { AssignScopeComponent };
if (false) {
    /** @type {?} */
    AssignScopeComponent.prototype.closeModal;
    /** @type {?} */
    AssignScopeComponent.prototype.submitModal;
    /** @type {?} */
    AssignScopeComponent.prototype.modalFooter;
    /** @type {?} */
    AssignScopeComponent.prototype.grid;
    /** @type {?} */
    AssignScopeComponent.prototype.actionsTable1;
    /** @type {?} */
    AssignScopeComponent.prototype.actionsDialog1;
    /** @type {?} */
    AssignScopeComponent.prototype.editorParams;
    /** @type {?} */
    AssignScopeComponent.prototype.location;
    /** @type {?} */
    AssignScopeComponent.prototype.items;
    /** @type {?} */
    AssignScopeComponent.prototype.listItems;
    /** @type {?} */
    AssignScopeComponent.prototype.modalConfig;
    /** @type {?} */
    AssignScopeComponent.prototype.cols;
    /** @type {?} */
    AssignScopeComponent.prototype.nodeCols;
    /** @type {?} */
    AssignScopeComponent.prototype.otherAssignActivityNodeInfos;
    /** @type {?} */
    AssignScopeComponent.prototype.curActivity;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.exprService;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    AssignScopeComponent.prototype.localePipe;
}
var AssignScopeConverter = /** @class */ (function () {
    function AssignScopeConverter(uistate, localePipe) {
        this.uistate = uistate;
        this.localePipe = localePipe;
        this.actList = new Array();
        this.actList = tslib_1.__spread(this.uistate.userActList.filter((/**
         * @param {?} a
         * @return {?}
         */
        function (a) { return a.AssignmentStrategy === 'ASSIGN'; })));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    AssignScopeConverter.prototype.convertTo = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (data && data.length > 0) {
            return this.localePipe.transform("component.assignScope.set");
        }
        else {
            return this.localePipe.transform("component.assignScope.notSet");
        }
    };
    return AssignScopeConverter;
}());
export { AssignScopeConverter };
if (false) {
    /** @type {?} */
    AssignScopeConverter.prototype.actList;
    /**
     * @type {?}
     * @private
     */
    AssignScopeConverter.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    AssignScopeConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzaWduLXNjb3BlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvYXNzaWduLXNjb3BlL2Fzc2lnbi1zY29wZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWlCLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQVUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXRLLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXhELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFFaEcsT0FBTyxFQUFFLFlBQVksRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQzlGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQWEsTUFBTSxxQkFBcUIsQ0FBQztBQUUvRjtJQTRGRSw4QkFDVSxPQUErQixFQUMvQixPQUF3QixFQUN4QixXQUE4QixFQUNsQixHQUFzQixFQUNmLFFBQWdCLEVBQ1IsU0FBYyxFQUM3QixVQUF3QjtRQVA5QyxpQkFVRTtRQVRRLFlBQU8sR0FBUCxPQUFPLENBQXdCO1FBQy9CLFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQ3hCLGdCQUFXLEdBQVgsV0FBVyxDQUFtQjtRQUNsQixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUNmLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDUixjQUFTLEdBQVQsU0FBUyxDQUFLO1FBQzdCLGVBQVUsR0FBVixVQUFVLENBQWM7UUF6RnBDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3JDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQU12QyxpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQXNCaEMsVUFBSyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7UUFFcEIsY0FBUyxHQUFHLElBQUksS0FBSyxFQUFnQixDQUFDO1FBRXRDLGdCQUFXLEdBQUc7WUFDWixLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsdUNBQXVDLENBQUM7WUFDekUsS0FBSyxFQUFFLEdBQUc7WUFDVixNQUFNLEVBQUUsR0FBRztZQUNYLFdBQVcsRUFBRSxJQUFJO1NBQ2xCLENBQUM7UUFFRixTQUFJLEdBQUc7WUFDTCxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyw0QkFBNEIsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQztZQUMzRixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUM7WUFDekQsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsZ0NBQWdDLENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUNoRyxNQUFNLEVBQUU7b0JBQ04sSUFBSSxFQUFFLFdBQVcsQ0FBQyxNQUFNO29CQUN4QixPQUFPLEVBQUUsRUFBRTtpQkFDWjtnQkFDRCxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQywyQkFBMkIsQ0FBQyxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQywwQkFBMEIsQ0FBQyxFQUFFLEVBQUU7Z0JBQy9LLFVBQVUsRUFBRTtvQkFDVixFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRTtpQkFDckM7YUFDRjtZQUNELEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLGlDQUFpQyxDQUFDLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDbEcsTUFBTSxFQUFFO29CQUNOLElBQUksRUFBRSxhQUFhO29CQUNuQixPQUFPLEVBQUU7d0JBQ1AsU0FBUyxFQUFFLHNDQUFzQzt3QkFDakQsUUFBUSxFQUFFLEtBQUs7d0JBQ2YsV0FBVzs7Ozt3QkFBRSxVQUFDLENBQUM7NEJBQ2IsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQzs0QkFDakUsS0FBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDdkIsQ0FBQyxDQUFBO3dCQUNELEtBQUs7Ozs7d0JBQUUsVUFBQyxDQUFDOzRCQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUMxQixDQUFDLENBQUE7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUM7UUFFRixhQUFRLEdBQUc7WUFDVCxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyw0QkFBNEIsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBQzNHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtTQUN2RCxDQUFBOztRQUlELGlDQUE0QixHQUFHLElBQUksS0FBSyxFQUErQixDQUFDO1FBYXRFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLFlBQVksQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQXBGRixzQkFBYSx1Q0FBSzs7Ozs7UUFBbEIsVUFBbUIsSUFBSTtZQUF2QixpQkFpQkM7WUFoQkMsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzNCLDBDQUEwQztnQkFDMUMsSUFBSSxDQUFDLE9BQU87Ozs7Z0JBQUMsVUFBQSxLQUFLOzt3QkFDWiwyQkFBMkIsR0FBRyxJQUFJLDJCQUEyQixDQUFDLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDO29CQUN4SyxLQUFJLENBQUMsNEJBQTRCLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUM7Z0JBQ3RFLENBQUMsRUFBRSxDQUFDO2dCQUNKLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPOzs7O2dCQUFDLFVBQUEsS0FBSzs7d0JBQ3pDLFdBQVcsR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLEVBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDO29CQUNuRSxXQUFXLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7b0JBQ3RDLElBQUcsS0FBSyxDQUFDLFNBQVMsRUFBQzt3QkFDakIsV0FBVyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztxQkFDL0M7b0JBQ0QsaUdBQWlHO29CQUNqRyxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDbkMsQ0FBQyxFQUFFLENBQUM7YUFDTDtRQUNILENBQUM7OztPQUFBOzs7O0lBcUVELHVDQUFROzs7SUFBUjtRQUFBLGlCQWdDQzs7UUEvQkMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztTQUM1Qzs7WUFDRyxVQUFVLEdBQUcsSUFBSSxLQUFLLEVBQUU7UUFDNUIsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLGVBQWUsRUFBRTtZQUNyQyxVQUFVLG9CQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU07Ozs7WUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxFQUFFLEtBQUssS0FBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBRTttQkFDdEYsQ0FBQyxDQUFDLGtCQUFrQixLQUFLLFFBQVE7bUJBQ2pDLENBQUMsQ0FBQyxxQkFBcUI7bUJBQ3ZCLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEtBQUssaUJBQWlCLEVBSEwsQ0FHSyxFQUFDLENBQUMsQ0FBQztTQUMvRDthQUFNO1lBQ0wsVUFBVSxvQkFBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsa0JBQWtCLEtBQUssUUFBUSxFQUExRSxDQUEwRSxFQUFDLENBQUMsQ0FBQztTQUNwSTtRQUNELElBQUksSUFBSSxDQUFDLDRCQUE0QixJQUFJLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29DQUMxRSxLQUFLOztvQkFDUixRQUFRLEdBQUcsVUFBVSxDQUFDLElBQUk7Ozs7Z0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FBQyxvQkFBb0IsRUFBbkMsQ0FBbUMsRUFBQztnQkFDMUUsSUFBSSxRQUFRLEVBQUU7b0JBQ1osT0FBSyxLQUFLLEdBQUcsT0FBSyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDNUM7Ozs7Z0JBSkgsS0FBb0IsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyw0QkFBNEIsQ0FBQSxnQkFBQTtvQkFBaEQsSUFBTSxLQUFLLFdBQUE7NEJBQUwsS0FBSztpQkFLZjs7Ozs7Ozs7O29DQUNVLFFBQVE7Z0JBQ2pCLElBQUksT0FBSyxLQUFLLENBQUMsU0FBUzs7OztnQkFBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxFQUFFLEtBQUssUUFBUSxDQUFDLEVBQUUsRUFBdkIsQ0FBdUIsRUFBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO29CQUNoRSxPQUFLLEtBQUssR0FBRyxPQUFLLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUM1Qzs7OztnQkFISCxLQUF1QixJQUFBLGVBQUEsaUJBQUEsVUFBVSxDQUFBLHNDQUFBO29CQUE1QixJQUFNLFFBQVEsdUJBQUE7NEJBQVIsUUFBUTtpQkFJbEI7Ozs7Ozs7OztTQUNGO2FBQU07WUFDTCxJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztTQUN6QjtRQUVELElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTzs7OztRQUFDLFVBQUEsUUFBUTtZQUM3QixRQUFRLENBQUMsSUFBSSxHQUFHLEtBQUksQ0FBQyxLQUFLLENBQUMsSUFBSTs7OztZQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEVBQUUsS0FBSyxRQUFRLENBQUMsb0JBQW9CLEVBQXpDLENBQXlDLEVBQUMsQ0FBQyxJQUFJLENBQUM7UUFDMUYsQ0FBQyxFQUFDLENBQUE7SUFDSixDQUFDOzs7O0lBR0QsOENBQWU7OztJQUFmOztRQUNFLElBQUksSUFBSSxDQUFDLDRCQUE0QixJQUFJLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztnQkFDckYsS0FBb0IsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyw0QkFBNEIsQ0FBQSxnQkFBQSw0QkFBRTtvQkFBbEQsSUFBTSxLQUFLLFdBQUE7b0JBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7aUJBQ2hEOzs7Ozs7Ozs7U0FDRjtJQUNILENBQUM7Ozs7SUFFRCxxQ0FBTTs7O0lBQU47UUFBQSxpQkFTQztRQVJDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDeEIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUU7O2dCQUNqRCxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsb0JBQW9CLEtBQUssS0FBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUExRSxDQUEwRSxFQUFDO1lBQ25ILElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDcEM7YUFBTTtZQUNMLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLGlDQUFpQyxDQUFDLENBQUMsQ0FBQztTQUNqRjtJQUNILENBQUM7Ozs7SUFFRCxxQ0FBTTs7O0lBQU47UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDLENBQUM7WUFDbEYsT0FBTztTQUNSOztZQUNLLFFBQVEsR0FBVyxJQUFJLENBQUMsV0FBVyxDQUFDLG9CQUFvQjs7WUFDeEQsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLG9CQUFvQixLQUFLLFFBQVEsRUFBbkMsQ0FBbUMsRUFBQztRQUM1RSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDWCxPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUV6QyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRXBDLDZDQUE2QztRQUM3QyxZQUFZO1FBQ1osc0JBQXNCO1FBQ3RCLGdDQUFnQztRQUNoQyxZQUFZO1FBQ1osSUFBSTtRQUNKLGlDQUFpQztRQUNqQyxZQUFZO1FBQ1osSUFBSTtRQUNKLHdFQUF3RTtRQUV4RSxrQ0FBa0M7UUFDbEMsNkNBQTZDO0lBQy9DLENBQUM7Ozs7SUFFRCx1Q0FBUTs7O0lBQVI7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDLENBQUM7WUFDbEYsT0FBTztTQUNSOztZQUNLLFFBQVEsR0FBVyxJQUFJLENBQUMsV0FBVyxDQUFDLG9CQUFvQjs7WUFDeEQsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUzs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLG9CQUFvQixLQUFLLFFBQVEsRUFBbkMsQ0FBbUMsRUFBQztRQUM1RSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkMsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFekMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUdwQyw2Q0FBNkM7UUFDN0Msc0JBQXNCO1FBQ3RCLGdDQUFnQztRQUNoQyxZQUFZO1FBQ1osSUFBSTtRQUNKLHFEQUFxRDtRQUNyRCxZQUFZO1FBQ1osSUFBSTtRQUNKLHdFQUF3RTtRQUV4RSxrQ0FBa0M7UUFDbEMsNkNBQTZDO0lBQy9DLENBQUM7Ozs7O0lBRUQsOENBQWU7Ozs7SUFBZixVQUFnQixJQUFTO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUMvQixDQUFDOzs7Ozs7OztJQUVPLHdDQUFTOzs7Ozs7O0lBQWpCLFVBQWtCLEdBQWUsRUFBRSxFQUFVLEVBQUUsRUFBVTtRQUN2RCxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQzs7OztJQUVELHNDQUFPOzs7SUFBUDs7UUFDRSxJQUFJLENBQUMsNEJBQTRCLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQzs7WUFDaEQsS0FBbUIsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxTQUFTLENBQUEsZ0JBQUEsNEJBQUU7Z0JBQTlCLElBQU0sSUFBSSxXQUFBO2dCQUNiLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxJQUFJLENBQUMsSUFBSSwyQkFBMkIsQ0FDcEUsSUFBSSxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDOUQ7Ozs7Ozs7Ozs7WUFDSyxNQUFNLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLDRCQUE0QixFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUU7UUFDN0UsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEMsQ0FBQzs7OztJQUVELDBDQUFXOzs7SUFBWDtRQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQzs7OztJQUVELDRDQUFhOzs7SUFBYjtRQUFBLGlCQWdCQzs7WUFmTyxVQUFVLEdBQVUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRO1FBQ3JELElBQUksVUFBVSxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3ZDLFVBQVUsQ0FBQyxPQUFPOzs7O1lBQUMsVUFBQSxNQUFNOztvQkFDbkIsSUFBSSxHQUFHLElBQUksWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDOztvQkFDdkQsS0FBSyxHQUFHLEtBQUksQ0FBQyxTQUFTLENBQUMsU0FBUzs7OztnQkFBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxvQkFBb0IsS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBM0MsQ0FBMkMsRUFBQztnQkFDMUYsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUU7b0JBQ2QsS0FBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUNqQztnQkFDRCxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1QixDQUFDLEVBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNwQztRQUNELHNCQUFzQjtRQUN0QixJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzlCLENBQUM7Ozs7SUFFRCwyQ0FBWTs7O0lBQVo7UUFDRSxzQkFBc0I7UUFDdEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUM5QixDQUFDOzs7OztJQUVELDJDQUFZOzs7O0lBQVosVUFBYSxDQUFNO1FBQW5CLGlCQThDQzs7O1lBN0NLLE9BQU8sR0FBRyxJQUFJLEtBQUssRUFBYTtRQUNwQyxvRkFBb0Y7UUFDcEYsK0ZBQStGO1FBQy9GLElBQUk7UUFDSiw0QkFBNEI7UUFDNUIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztnQkFDbkMsS0FBcUIsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFBLGdCQUFBLDRCQUFFO29CQUF0QyxJQUFNLE1BQU0sV0FBQTtvQkFDZixJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7aUJBQzlDOzs7Ozs7Ozs7WUFDRCxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTs7b0JBQ25GLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUN6RCxJQUFJLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUMxRCxVQUFVLENBQUMsSUFBSSxFQUFFLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUM3QztTQUNGO1FBQ0QsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29DQUNuQyxRQUFRO2dCQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUk7Ozs7Z0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsR0FBRyxLQUFLLFFBQVEsQ0FBQyxHQUFHLEVBQXRCLENBQXNCLEVBQUMsRUFBRTtvQkFDOUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztpQkFDeEI7OztnQkFISCxLQUF1QixJQUFBLEtBQUEsaUJBQUEsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQSxnQkFBQTtvQkFBakQsSUFBTSxRQUFRLFdBQUE7NEJBQVIsUUFBUTtpQkFJbEI7Ozs7Ozs7OztTQUNGO1FBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLHdCQUF3QixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0NBQ3pDLFFBQVE7Z0JBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSTs7OztnQkFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxHQUFHLEtBQUssUUFBUSxDQUFDLEdBQUcsRUFBdEIsQ0FBc0IsRUFBQyxFQUFFO29CQUM5QyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUN4Qjs7O2dCQUhILEtBQXVCLElBQUEsS0FBQSxpQkFBQSxJQUFJLENBQUMsT0FBTyxDQUFDLHdCQUF3QixDQUFBLGdCQUFBO29CQUF2RCxJQUFNLFFBQVEsV0FBQTs0QkFBUixRQUFRO2lCQUlsQjs7Ozs7Ozs7O1NBQ0Y7UUFDRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztnQkFDdEIsS0FBZ0IsSUFBQSxZQUFBLGlCQUFBLE9BQU8sQ0FBQSxnQ0FBQSxxREFBRTtvQkFBcEIsSUFBTSxDQUFDLG9CQUFBO29CQUNWLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUNoQzs7Ozs7Ozs7O1NBQ0Y7UUFDRCxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSTs7OztRQUFDLFVBQUMsSUFBWTtZQUNuRCxDQUFDLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3QixDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUM5Qix3QkFBd0I7WUFDeEIsSUFBRyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDckIsS0FBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsZUFBZSxHQUFHLEtBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxNQUFNOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxPQUFPLENBQUMsSUFBSTs7OztnQkFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBZixDQUFlLEVBQUMsRUFBbkMsQ0FBbUMsRUFBQyxDQUFDO2FBQzVJO1FBQ0gsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOztnQkF2VEYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxrQkFBa0I7b0JBQzVCLDg2RkFBNEM7b0JBRTVDLFNBQVMsRUFBRTt3QkFDUixZQUFZO3FCQUNkOztpQkFDRjs7OztnQkFmUSxzQkFBc0I7Z0JBRnRCLGVBQWU7Z0JBUUQsaUJBQWlCO2dCQVpoQixpQkFBaUIsdUJBOEdwQyxRQUFROzZDQUNSLE1BQU0sU0FBQyxTQUFTO2dEQUNoQixNQUFNLFNBQUMsaUJBQWlCO2dCQXpHRCxZQUFZLHVCQTBHbkMsUUFBUTs7OzZCQXpGVixNQUFNOzhCQUNOLE1BQU07OEJBQ04sU0FBUyxTQUFDLGtCQUFrQjt1QkFDNUIsU0FBUyxTQUFDLE1BQU07Z0NBQ2hCLFNBQVMsU0FBQyxlQUFlO2lDQUN6QixTQUFTLFNBQUMsZ0JBQWdCOytCQUUxQixLQUFLO3dCQUNMLEtBQUs7O0lBdVNSLDJCQUFDO0NBQUEsQUF6VEQsSUF5VEM7U0FqVFksb0JBQW9COzs7SUFFL0IsMENBQStDOztJQUMvQywyQ0FBZ0Q7O0lBQ2hELDJDQUE2RDs7SUFDN0Qsb0NBQTJDOztJQUMzQyw2Q0FBNkQ7O0lBQzdELDhDQUE2RDs7SUFFN0QsNENBQWdDOztJQW9CaEMsd0NBQVM7O0lBRVQscUNBQW9COztJQUVwQix5Q0FBc0M7O0lBRXRDLDJDQUtFOztJQUVGLG9DQTZCRTs7SUFFRix3Q0FHQzs7SUFJRCw0REFBd0U7O0lBRXhFLDJDQUFZOzs7OztJQUdWLHVDQUF1Qzs7Ozs7SUFDdkMsdUNBQWdDOzs7OztJQUNoQywyQ0FBc0M7Ozs7O0lBQ3RDLG1DQUEwQzs7Ozs7SUFDMUMsd0NBQTJDOzs7OztJQUMzQyx5Q0FBaUQ7Ozs7O0lBQ2pELDBDQUE0Qzs7QUF3TmhEO0lBRUUsOEJBQ1UsT0FBK0IsRUFDL0IsVUFBd0I7UUFEeEIsWUFBTyxHQUFQLE9BQU8sQ0FBd0I7UUFDL0IsZUFBVSxHQUFWLFVBQVUsQ0FBYztRQUhsQyxZQUFPLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUtwQixJQUFJLENBQUMsT0FBTyxvQkFBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsa0JBQWtCLEtBQUssUUFBUSxFQUFqQyxDQUFpQyxFQUFDLENBQUMsQ0FBQztJQUM5RixDQUFDOzs7OztJQUVELHdDQUFTOzs7O0lBQVQsVUFBVSxJQUFJO1FBQ1osSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1NBQy9EO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLDhCQUE4QixDQUFDLENBQUM7U0FDbEU7SUFFSCxDQUFDO0lBQ0gsMkJBQUM7QUFBRCxDQUFDLEFBakJELElBaUJDOzs7O0lBaEJDLHVDQUFzQjs7Ozs7SUFFcEIsdUNBQXVDOzs7OztJQUN2QywwQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIEluamVjdCwgSW5wdXQsIExPQ0FMRV9JRCwgT25Jbml0LCBPcHRpb25hbCwgT3V0cHV0LCBUZW1wbGF0ZVJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFR5cGVDb252ZXJ0ZXIgfSBmcm9tICdAZmFycmlzL2lkZS1wcm9wZXJ0eS1wYW5lbCc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IFBpY2tlZFJlc3VsdCB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUgfSBmcm9tICcuLi8uLi9hcHAvcHJvY2Vzcy1kZXNpZ25lci51aXN0YXRlJztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcbmltcG9ydCB7IERpc3BsYXlJbmZvciwgT3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvIH0gZnJvbSAnLi9vdGhlci1hc3NpZ24tYWN0aXZpdHktbm9kZS1pbmZvJztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBFZGl0b3JUeXBlcyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCB7IEV4cHJFZGl0TW9kZSwgRXhwcmVzc2lvblNlcnZpY2UsIEluamVjdGVkVHlwZSwgVmFyRW50aXR5IH0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1hc3NpZ24tc2NvcGUnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hc3NpZ24tc2NvcGUuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2Fzc2lnbi1zY29wZS5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBc3NpZ25TY29wZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gIEBPdXRwdXQoKSBjbG9zZU1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQFZpZXdDaGlsZCgnaWNvblNlbGVjdEZvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBWaWV3Q2hpbGQoJ2dyaWQnKSBncmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdhY3Rpb25zVGFibGUxJykgYWN0aW9uc1RhYmxlMTogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnYWN0aW9uc0RpYWxvZzEnKSBhY3Rpb25zRGlhbG9nMTogRGlhbG9nQ29tcG9uZW50O1xyXG5cclxuICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IGFueSA9IHt9O1xyXG4gIEBJbnB1dCgpIHNldCB2YWx1ZShkYXRhKSB7XHJcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gdGhpcy5vdGhlckFzc2lnbkFjdGl2aXRpZXMgPSBbLi4uZGF0YV07XHJcbiAgICAgIGRhdGEuZm9yRWFjaChkYXRhMSA9PntcclxuICAgICAgICBsZXQgb3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvID0gbmV3IE90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mbyhkYXRhMS5hY3Rpdml0eURlZmluaXRpb25JZCwgZGF0YTEuY29uZGl0aW9uID8gZGF0YTEuY29uZGl0aW9uLlZhbHVlIDogZGF0YTEuY29uZGl0aW9uLCBkYXRhMS5yZXF1aXJlZCk7XHJcbiAgICAgICAgdGhpcy5vdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm9zLnB1c2gob3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvKTtcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MuZm9yRWFjaChvdGhlciA9PntcclxuICAgICAgICBsZXQgZGlzcGxheUluZm8gPSBuZXcgRGlzcGxheUluZm9yKG51bGwsb3RoZXIuYWN0aXZpdHlEZWZpbml0aW9uSWQpO1xyXG4gICAgICAgIGRpc3BsYXlJbmZvLnJlcXVpcmVkID0gb3RoZXIucmVxdWlyZWQ7XHJcbiAgICAgICAgaWYob3RoZXIuY29uZGl0aW9uKXtcclxuICAgICAgICAgIGRpc3BsYXlJbmZvLmNvbmRpdGlvbiA9IG90aGVyLmNvbmRpdGlvbi5WYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZGlzcGxheUluZm8ubmFtZSA9IHRoaXMuaXRlbXMuZmluZChpdGVtID0+IGl0ZW0uSWQgPT09IGRpc3BsYXlJbmZvLmFjdGl2aXR5RGVmaW5pdGlvbklkKS5OYW1lO1xyXG4gICAgICAgIHRoaXMubGlzdEl0ZW1zLnB1c2goZGlzcGxheUluZm8pO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsb2NhdGlvbjtcclxuXHJcbiAgaXRlbXMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgbGlzdEl0ZW1zID0gbmV3IEFycmF5PERpc3BsYXlJbmZvcj4oKTtcclxuXHJcbiAgbW9kYWxDb25maWcgPSB7XHJcbiAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmFzc2lnblNjb3BlLmFzc2lnblNjb3BlTGlzdCcpLFxyXG4gICAgd2lkdGg6IDYwMCxcclxuICAgIGhlaWdodDogNTIwLFxyXG4gICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICB9O1xyXG5cclxuICBjb2xzID0gW1xyXG4gICAgeyB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmFzc2lnblNjb3BlLm5hbWUnKSwgZmllbGQ6ICduYW1lJywgd2lkdGg6IDgwfSxcclxuICAgIHsgdGl0bGU6ICdJRCcsIGZpZWxkOiAnYWN0aXZpdHlEZWZpbml0aW9uSWQnLCB3aWR0aDogMTAwfSxcclxuICAgIHsgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hc3NpZ25TY29wZS5yZXF1aXJlZCcpLCBmaWVsZDogJ3JlcXVpcmVkJywgd2lkdGg6IDUwLFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5TV0lUQ0gsXHJcbiAgICAgICAgb3B0aW9uczoge31cclxuICAgICAgfSxcclxuICAgICAgZm9ybWF0dGVyOiB7IHR5cGU6ICdib29sZWFuJywgb3B0aW9uczogeyB0cnVlVGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmFzc2lnblNjb3BlLnllcycpLCBmYWxzZVRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hc3NpZ25TY29wZS5ubycpIH0gfSxcclxuICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgXVxyXG4gICAgfSxcclxuICAgIHsgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hc3NpZ25TY29wZS5jb25kaXRpb24nKSwgZmllbGQ6ICdjb25kaXRpb24nLCB3aWR0aDogNzAsXHJcbiAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgIHR5cGU6ICdpbnB1dC1ncm91cCcsXHJcbiAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgZ3JvdXBUZXh0OiAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nLFxyXG4gICAgICAgICAgZWRpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgY2xpY2tIYW5kbGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoZS5pbnN0YW5jZS52YWx1ZSA/IGUuaW5zdGFuY2UudmFsdWUgOiAnJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZWRpdENvbmRpdG9uKGUpO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNsZWFyOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXInLCBlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICBdO1xyXG5cclxuICBub2RlQ29scyA9IFtcclxuICAgIHsgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hc3NpZ25TY29wZS5uYW1lJyksIGZpZWxkOiAnTmFtZScsIHdpZHRoOiAxMDAsIGZpbHRlcjogdHJ1ZSB9LFxyXG4gICAgeyB0aXRsZTogJ0lEJywgZmllbGQ6ICdJZCcsIHdpZHRoOiAxMDAsIGZpbHRlcjogdHJ1ZSB9LFxyXG4gIF1cclxuXHJcbiAgLy8gb3RoZXJBc3NpZ25BY3Rpdml0aWVzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gIG90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MgPSBuZXcgQXJyYXk8T3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvPigpO1xyXG5cclxuICBjdXJBY3Rpdml0eTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHVpc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgZXhwclNlcnZpY2U6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKCF0aGlzLmxvY2F0aW9uKSB7XHJcbiAgICAgIHRoaXMubG9jYXRpb24gPSB0aGlzLmVkaXRvclBhcmFtcy5sb2NhdGlvbjtcclxuICAgIH1cclxuICAgIGxldCBhY3Rpdml0aWVzID0gbmV3IEFycmF5KCk7XHJcbiAgICBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ3N0YXJ0QWN0aXZpdHknKSB7XHJcbiAgICAgIGFjdGl2aXRpZXMgPSBbLi4udGhpcy51aXN0YXRlLnVzZXJBY3RMaXN0LmZpbHRlcihhID0+IGEuSWQgIT09IHRoaXMudWlzdGF0ZS5wcm9wZXJ0eURhdGEuSWRcclxuICAgICAgICAmJiBhLkFzc2lnbm1lbnRTdHJhdGVneSA9PT0gJ0FTU0lHTidcclxuICAgICAgICAmJiBhLkFzc2lnblBlcmZvcm1lckNvbmZpZ1xyXG4gICAgICAgICYmIGEuQXNzaWduUGVyZm9ybWVyQ29uZmlnLk9wZXJhdG9yID09PSAncHJvY0luc3RDcmVhdG9yJyldO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYWN0aXZpdGllcyA9IFsuLi50aGlzLnVpc3RhdGUudXNlckFjdExpc3QuZmlsdGVyKGEgPT4gYS5JZCAhPT0gdGhpcy51aXN0YXRlLnByb3BlcnR5RGF0YS5JZCAmJiBhLkFzc2lnbm1lbnRTdHJhdGVneSA9PT0gJ0FTU0lHTicpXTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MgJiYgdGhpcy5vdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm9zLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCBvdGhlciBvZiB0aGlzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MpIHtcclxuICAgICAgICBjb25zdCBhY3Rpdml0eSA9IGFjdGl2aXRpZXMuZmluZChhID0+IGEuSWQgPT09IG90aGVyLmFjdGl2aXR5RGVmaW5pdGlvbklkKTtcclxuICAgICAgICBpZiAoYWN0aXZpdHkpIHtcclxuICAgICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLml0ZW1zLmNvbmNhdChbYWN0aXZpdHldKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZm9yIChjb25zdCBhY3Rpdml0eSBvZiBhY3Rpdml0aWVzKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5JZCA9PT0gYWN0aXZpdHkuSWQpID09PSAtMSkge1xyXG4gICAgICAgICAgdGhpcy5pdGVtcyA9IHRoaXMuaXRlbXMuY29uY2F0KFthY3Rpdml0eV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pdGVtcyA9IGFjdGl2aXRpZXM7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5saXN0SXRlbXMuZm9yRWFjaChsaXN0SXRlbSA9PiB7XHJcbiAgICAgIGxpc3RJdGVtLm5hbWUgPSB0aGlzLml0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLklkID09PSBsaXN0SXRlbS5hY3Rpdml0eURlZmluaXRpb25JZCkuTmFtZTtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcyAmJiB0aGlzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IG90aGVyIG9mIHRoaXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcykge1xyXG4gICAgICAgIHRoaXMuZ3JpZC5jaGVja1JvdyhvdGhlci5hY3Rpdml0eURlZmluaXRpb25JZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRlbGV0ZSgpIHtcclxuICAgIHRoaXMuZ3JpZC5lbmRDZWxsRWRpdCgpO1xyXG4gICAgaWYgKHRoaXMuZ3JpZC5zZWxlY3RlZFJvdyAmJiB0aGlzLmdyaWQuc2VsZWN0ZWRSb3cuZGF0YSkge1xyXG4gICAgICBjb25zdCBpID0gdGhpcy5saXN0SXRlbXMuZmluZEluZGV4KGQgPT4gZC5hY3Rpdml0eURlZmluaXRpb25JZCA9PT0gdGhpcy5ncmlkLnNlbGVjdGVkUm93LmRhdGEuYWN0aXZpdHlEZWZpbml0aW9uSWQpO1xyXG4gICAgICB0aGlzLmxpc3RJdGVtcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgIHRoaXMuZ3JpZC5sb2FkRGF0YSh0aGlzLmxpc3RJdGVtcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYXNzaWduU2NvcGUuZGVsZXRlUm93JykpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbW92ZVVwKCkge1xyXG4gICAgaWYgKCF0aGlzLmN1ckFjdGl2aXR5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hc3NpZ25TY29wZS5jdXJBY3Rpdml0eScpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY3VyQ21wSWQ6IHN0cmluZyA9IHRoaXMuY3VyQWN0aXZpdHkuYWN0aXZpdHlEZWZpbml0aW9uSWQ7XHJcbiAgICBjb25zdCBpID0gdGhpcy5saXN0SXRlbXMuZmluZEluZGV4KGMgPT4gYy5hY3Rpdml0eURlZmluaXRpb25JZCA9PT0gY3VyQ21wSWQpO1xyXG4gICAgaWYgKGkgPT09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zd2FwQXJyYXkodGhpcy5saXN0SXRlbXMsIGksIGkgLSAxKTtcclxuXHJcbiAgICB0aGlzLmdyaWQubG9hZERhdGEodGhpcy5saXN0SXRlbXMpO1xyXG4gICAgdGhpcy5ncmlkLnNlbGVjdFJvdyhjdXJDbXBJZCwgdHJ1ZSk7XHJcblxyXG4gICAgLy8gY29uc3Qgc2VsZWN0ZWRSb3cgPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3c7XHJcbiAgICAvLyBkZWJ1Z2dlcjtcclxuICAgIC8vIGlmICghc2VsZWN0ZWRSb3cpIHtcclxuICAgIC8vICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WwmuacqumAieS4reihjCcpO1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICAvLyBpZiAoc2VsZWN0ZWRSb3cuaW5kZXggPT09IDApIHtcclxuICAgIC8vICAgcmV0dXJuO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gdGhpcy5zd2FwQXJyYXkodGhpcy5pdGVtcywgc2VsZWN0ZWRSb3cuaW5kZXgsIHNlbGVjdGVkUm93LmluZGV4IC0gMSk7XHJcblxyXG4gICAgLy8gdGhpcy5ncmlkLmxvYWREYXRhKHRoaXMuaXRlbXMpO1xyXG4gICAgLy8gdGhpcy5ncmlkLnNlbGVjdFJvdyhzZWxlY3RlZFJvdy5pZCwgdHJ1ZSk7XHJcbiAgfVxyXG5cclxuICBtb3ZlRG93bigpIHtcclxuICAgIGlmICghdGhpcy5jdXJBY3Rpdml0eSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYXNzaWduU2NvcGUuY3VyQWN0aXZpdHknKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGN1ckNtcElkOiBzdHJpbmcgPSB0aGlzLmN1ckFjdGl2aXR5LmFjdGl2aXR5RGVmaW5pdGlvbklkO1xyXG4gICAgY29uc3QgaSA9IHRoaXMubGlzdEl0ZW1zLmZpbmRJbmRleChjID0+IGMuYWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGN1ckNtcElkKTtcclxuICAgIGlmIChpID09PSB0aGlzLmxpc3RJdGVtcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuc3dhcEFycmF5KHRoaXMubGlzdEl0ZW1zLCBpLCBpICsgMSk7XHJcblxyXG4gICAgdGhpcy5ncmlkLmxvYWREYXRhKHRoaXMubGlzdEl0ZW1zKTtcclxuICAgIHRoaXMuZ3JpZC5zZWxlY3RSb3coY3VyQ21wSWQsIHRydWUpO1xyXG5cclxuXHJcbiAgICAvLyBjb25zdCBzZWxlY3RlZFJvdyA9IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdztcclxuICAgIC8vIGlmICghc2VsZWN0ZWRSb3cpIHtcclxuICAgIC8vICAgdGhpcy5tZXNzYWdlLmluZm8oJ+WwmuacqumAieS4reihjCcpO1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICAvLyBpZiAoc2VsZWN0ZWRSb3cuaW5kZXggPT09IHRoaXMuaXRlbXMubGVuZ3RoIC0gMSkge1xyXG4gICAgLy8gICByZXR1cm47XHJcbiAgICAvLyB9XHJcbiAgICAvLyB0aGlzLnN3YXBBcnJheSh0aGlzLml0ZW1zLCBzZWxlY3RlZFJvdy5pbmRleCwgc2VsZWN0ZWRSb3cuaW5kZXggKyAxKTtcclxuXHJcbiAgICAvLyB0aGlzLmdyaWQubG9hZERhdGEodGhpcy5pdGVtcyk7XHJcbiAgICAvLyB0aGlzLmdyaWQuc2VsZWN0Um93KHNlbGVjdGVkUm93LmlkLCB0cnVlKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdGlvbkNoYW5nZShkYXRhOiBhbnkpIHtcclxuICAgIHRoaXMuY3VyQWN0aXZpdHkgPSBkYXRhLmRhdGE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN3YXBBcnJheShhcnI6IEFycmF5PGFueT4sIGkxOiBudW1iZXIsIGkyOiBudW1iZXIpOiBBcnJheTxhbnk+IHtcclxuICAgIGFycltpMV0gPSBhcnIuc3BsaWNlKGkyLCAxLCBhcnJbaTFdKVswXTtcclxuICAgIHJldHVybiBhcnI7XHJcbiAgfVxyXG5cclxuICBjbGlja09LKCkge1xyXG4gICAgdGhpcy5vdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm9zID0gbmV3IEFycmF5KCk7XHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5saXN0SXRlbXMpIHtcclxuICAgICAgdGhpcy5vdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm9zLnB1c2gobmV3IE90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mbyhcclxuICAgICAgICBpdGVtLmFjdGl2aXR5RGVmaW5pdGlvbklkLCBpdGVtLmNvbmRpdGlvbiwgaXRlbS5yZXF1aXJlZCkpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgb2JqZWN0ID0geyB2YWx1ZTogdGhpcy5vdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm9zLCBwYXJhbWV0ZXJzOiBudWxsIH07XHJcbiAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIGFjdGlvbnNTZWxlY3QoKSB7XHJcbiAgICBjb25zdCBzZWxlY3Rpb25zOiBhbnlbXSA9IHRoaXMuYWN0aW9uc1RhYmxlMS5jaGVja2VkcztcclxuICAgIGlmIChzZWxlY3Rpb25zICYmIHNlbGVjdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICBzZWxlY3Rpb25zLmZvckVhY2goYWN0aW9uID0+IHtcclxuICAgICAgICBsZXQgaXRlbSA9IG5ldyBEaXNwbGF5SW5mb3IoYWN0aW9uLmRhdGEuTmFtZSwgYWN0aW9uLmRhdGEuSWQpO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5saXN0SXRlbXMuZmluZEluZGV4KGFjdCA9PiBhY3QuYWN0aXZpdHlEZWZpbml0aW9uSWQgPT09IGFjdGlvbi5kYXRhLklkKTtcclxuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgdGhpcy5saXN0SXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5saXN0SXRlbXMucHVzaChpdGVtKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuZ3JpZC5sb2FkRGF0YSh0aGlzLmxpc3RJdGVtcyk7XHJcbiAgICB9XHJcbiAgICAvLyAyMDIzLTYtMTMg5YWz6Zet5YmN5riF56m65bey6YCJ5pWw5o2uXHJcbiAgICB0aGlzLmFjdGlvbnNUYWJsZTEuY2xlYXJDaGVja2Vkcyh0cnVlKTtcclxuICAgIHRoaXMuYWN0aW9uc0RpYWxvZzEuY2xvc2UoKTtcclxuICB9XHJcblxyXG4gIFNlbGVjdENhbmNlbCgpIHtcclxuICAgIC8vIDIwMjMtNi0xMyDlhbPpl63liY3muIXnqbrlt7LpgInmlbDmja5cclxuICAgIHRoaXMuYWN0aW9uc1RhYmxlMS5jbGVhckNoZWNrZWRzKHRydWUpO1xyXG4gICAgdGhpcy5hY3Rpb25zRGlhbG9nMS5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgZWRpdENvbmRpdG9uKGU6IGFueSkge1xyXG4gICAgbGV0IGNvbnRleHQgPSBuZXcgQXJyYXk8VmFyRW50aXR5PigpO1xyXG4gICAgLy8gaWYodGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzLmZpbmQoeCA9PiB4LmtleSA9PT0gJ0N1cnJlbnRMYW5ndWFnZScpKSB7XHJcbiAgICAvLyAgIGNvbnRleHQucHVzaCh0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmluZCh4ID0+IHgua2V5ID09PSAnQ3VycmVudExhbmd1YWdlJykpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gdGhpcy5leHByLmNsZWFyQ29udGV4dCgpO1xyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5zY2hlbWFzLmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCBzY2hlbWEgb2YgdGhpcy51aXN0YXRlLnNjaGVtYXMpIHtcclxuICAgICAgICB0aGlzLmV4cHJTZXJ2aWNlLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy51aXN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMgJiYgdGhpcy51aXN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHJTZXJ2aWNlLmFkZEluamVjdGVkRW50aXR5KGVudGl0eVR5cGUubmFtZSwgJ1NjaGVtYScsXHJcbiAgICAgICAgICBlbnRpdHlUeXBlLm5hbWUsIEluamVjdGVkVHlwZS5FbnRpdHlUeXBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29udGV4dCA9IHRoaXMudWlzdGF0ZS5hZGRDb250ZXh0KGNvbnRleHQpO1xyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMudWlzdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5hY3Rpdml0eUNvbXBvbmVudENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMudWlzdGF0ZS5hY3Rpdml0eUNvbXBvbmVudENvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZXhwclNlcnZpY2UuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfSBcclxuICAgIHRoaXMuZXhwclNlcnZpY2Uuc2V0RWRpdFBhdHRlcm4oRXhwckVkaXRNb2RlLkNvbmRpdGlvbmFsKTsgICBcclxuICAgIHRoaXMuZXhwclNlcnZpY2UuYWRkRXhwcmVzc2lvblRleHQoZS5pbnN0YW5jZS52YWx1ZSk7XHJcbiAgICB0aGlzLmV4cHJTZXJ2aWNlLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGNvbmQ6IHN0cmluZykgPT4ge1xyXG4gICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGNvbmQpO1xyXG4gICAgICBlLmluc3RhbmNlLmNkLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgLy/ngrnlh7vnoa7lrprlkI7vvIzljrvpmaTooajovr7lvI/ph4zpnaLnmoTmlrDlop7nmoTkuIrkuIvmloflj5jph49cclxuICAgICAgaWYoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5leHByU2VydmljZS5leHByRW50aXR5LmNvbnRleHRFbnRpdGllcyA9IHRoaXMuZXhwclNlcnZpY2UuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmlsdGVyKHggPT4gIWNvbnRleHQuc29tZSh5ID0+IHkua2V5ID09PSB4LmtleSkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQXNzaWduU2NvcGVDb252ZXJ0ZXIgaW1wbGVtZW50cyBUeXBlQ29udmVydGVyIHtcclxuICBhY3RMaXN0ID0gbmV3IEFycmF5KCk7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHVpc3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZVxyXG4gICAgKSB7XHJcbiAgICB0aGlzLmFjdExpc3QgPSBbLi4udGhpcy51aXN0YXRlLnVzZXJBY3RMaXN0LmZpbHRlcihhID0+IGEuQXNzaWdubWVudFN0cmF0ZWd5ID09PSAnQVNTSUdOJyldO1xyXG4gIH1cclxuXHJcbiAgY29udmVydFRvKGRhdGEpOiBzdHJpbmcge1xyXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmFzc2lnblNjb3BlLnNldFwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmFzc2lnblNjb3BlLm5vdFNldFwiKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG59XHJcbiJdfQ==
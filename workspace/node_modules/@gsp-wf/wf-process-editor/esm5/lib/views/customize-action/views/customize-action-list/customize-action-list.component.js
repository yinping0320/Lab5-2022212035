/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, TemplateRef, Output, EventEmitter, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { ProcessDesignerUIState } from '../../../../app/process-designer.uistate';
import { DatagridComponent } from '@farris/ui-datagrid';
import { CustomizeAciton } from '../../entities/customize-action.entity';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../../../i18n/pipe/wf-process-editor-locale.pipe';
var CustomizeActionListComponent = /** @class */ (function () {
    function CustomizeActionListComponent(designerUIState, cdr, localeId, resources, localePipe) {
        this.designerUIState = designerUIState;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.submit = new EventEmitter();
        this.cancel = new EventEmitter();
        this.terminalList = [
            { value: 'app', text: this.localePipe.transform('component.customizeAction.app') },
            { value: 'web', text: 'web' },
            { value: 'web,app', text: this.localePipe.transform('component.customizeAction.all') }
        ];
        this.cols = [
            { field: 'code', width: 100, title: this.localePipe.transform('component.customizeAction.code') },
            { field: 'name', width: 100, title: this.localePipe.transform('component.customizeAction.name') },
            {
                field: 'terminal', width: 100, title: this.localePipe.transform('component.customizeAction.terminalType'),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.terminalList }
                },
            },
            {
                field: 'isAll', width: 100, title: this.localePipe.transform('component.customizeAction.isAll'),
                formatter: { type: 'boolean', options: { trueText: this.localePipe.transform('component.customizeAction.yes'), falseText: this.localePipe.transform('component.customizeAction.no') } }
            }
        ];
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
        this.customActionList = this.designerUIState.flowFormInfo.customizeActions || [];
    }
    /**
     * @return {?}
     */
    CustomizeActionListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    CustomizeActionListComponent.prototype.clickOK = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var selections = [];
        /** @type {?} */
        var checkeds = this.grid.checkeds;
        if (checkeds && checkeds.length > 0) {
            checkeds.forEach((/**
             * @param {?} action
             * @return {?}
             */
            function (action) {
                var e_1, _a;
                /** @type {?} */
                var item = new CustomizeAciton(action.data.id, action.data.code, action.data.name);
                item.terminalType = action.data.terminal;
                // item.enable = true;
                item.actualParameters = [];
                if (action.data.actualParameters && action.data.actualParameters.length > 0) {
                    try {
                        for (var _b = tslib_1.__values(action.data.actualParameters), _c = _b.next(); !_c.done; _c = _b.next()) {
                            var p = _c.value;
                            /** @type {?} */
                            var param = (/** @type {?} */ ({
                                Name: p.code,
                                Value: p.value,
                                ValueText: p.name,
                                Tag: 'expression'
                            }));
                            item.actualParameters.push(param);
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                }
                selections.push(item);
            }));
        }
        this.submit.emit(selections);
    };
    /**
     * @return {?}
     */
    CustomizeActionListComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.cancel.emit(true);
    };
    CustomizeActionListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-customize-action-list',
                    template: "<div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2\">\r\n  <farris-datagrid #grid [columns]=\"cols\" [data]=\"customActionList\" [idField]=\"'id'\" [fit]=\"true\"\r\n    [fitColumns]=\"true\" [pagination]='false' [multiSelect]=\"true\" [showCheckbox]=\"true\" [multiSelect]=\"true\"\r\n    [checkOnSelect]=\"true\" [selectOnCheck]=\"true\">\r\n  </farris-datagrid>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3\" (click)=\"clickCancel()\">{{'component.customizeAction.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.customizeAction.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n",
                    providers: [
                        WfLocalePipe,
                    ],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    CustomizeActionListComponent.ctorParameters = function () { return [
        { type: ProcessDesignerUIState },
        { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
        { type: WfLocalePipe, decorators: [{ type: Optional }] }
    ]; };
    CustomizeActionListComponent.propDecorators = {
        grid: [{ type: ViewChild, args: ['grid',] }],
        footer: [{ type: ViewChild, args: ['footer',] }],
        submit: [{ type: Output }],
        cancel: [{ type: Output }]
    };
    return CustomizeActionListComponent;
}());
export { CustomizeActionListComponent };
if (false) {
    /** @type {?} */
    CustomizeActionListComponent.prototype.grid;
    /** @type {?} */
    CustomizeActionListComponent.prototype.footer;
    /** @type {?} */
    CustomizeActionListComponent.prototype.submit;
    /** @type {?} */
    CustomizeActionListComponent.prototype.cancel;
    /** @type {?} */
    CustomizeActionListComponent.prototype.customActionList;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.terminalList;
    /** @type {?} */
    CustomizeActionListComponent.prototype.cols;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9taXplLWFjdGlvbi1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvY3VzdG9taXplLWFjdGlvbi92aWV3cy9jdXN0b21pemUtYWN0aW9uLWxpc3QvY3VzdG9taXplLWFjdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hKLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUV6RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0scURBQXFELENBQUM7QUFHdEc7SUFxQ0Usc0NBQ1UsZUFBdUMsRUFDM0IsR0FBc0IsRUFDZixRQUFnQixFQUNSLFNBQWMsRUFDN0IsVUFBd0I7UUFKcEMsb0JBQWUsR0FBZixlQUFlLENBQXdCO1FBQzNCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ2YsYUFBUSxHQUFSLFFBQVEsQ0FBUTtRQUNSLGNBQVMsR0FBVCxTQUFTLENBQUs7UUFDN0IsZUFBVSxHQUFWLFVBQVUsQ0FBYztRQTdCcEMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFTLENBQUM7UUFDbkMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFJbkMsaUJBQVksR0FBRztZQUNyQixFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsU0FB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b250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBJbmplY3QsIExPQ0FMRV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IEN1c3RvbWl6ZUFjaXRvbiB9IGZyb20gJy4uLy4uL2VudGl0aWVzL2N1c3RvbWl6ZS1hY3Rpb24uZW50aXR5JztcclxuaW1wb3J0IHsgQWN0dWFsUGFyYW1ldGVyIH0gZnJvbSAnLi4vLi4vLi4vZXhlY3V0ZS1mb3Jtcy9lbnRpdGllcy9leGVjdXRlLWZvcm0uZW50aXR5JztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1jdXN0b21pemUtYWN0aW9uLWxpc3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jdXN0b21pemUtYWN0aW9uLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2N1c3RvbWl6ZS1hY3Rpb24tbGlzdC5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDdXN0b21pemVBY3Rpb25MaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZ3JpZCcpIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2Zvb3RlcicpIGZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgQE91dHB1dCgpIHN1Ym1pdCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55W10+KCk7XHJcbiAgQE91dHB1dCgpIGNhbmNlbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjdXN0b21BY3Rpb25MaXN0OiBhbnlbXTtcclxuXHJcbiAgcHJpdmF0ZSB0ZXJtaW5hbExpc3QgPSBbXHJcbiAgICB7IHZhbHVlOiAnYXBwJywgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmN1c3RvbWl6ZUFjdGlvbi5hcHAnKSB9LFxyXG4gICAgeyB2YWx1ZTogJ3dlYicsIHRleHQ6ICd3ZWInIH0sXHJcbiAgICB7IHZhbHVlOiAnd2ViLGFwcCcsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5jdXN0b21pemVBY3Rpb24uYWxsJykgfVxyXG4gIF07XHJcblxyXG4gIGNvbHMgPSBbXHJcbiAgICB7IGZpZWxkOiAnY29kZScsIHdpZHRoOiAxMDAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY3VzdG9taXplQWN0aW9uLmNvZGUnKSB9LFxyXG4gICAgeyBmaWVsZDogJ25hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmN1c3RvbWl6ZUFjdGlvbi5uYW1lJykgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICd0ZXJtaW5hbCcsIHdpZHRoOiAxMDAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY3VzdG9taXplQWN0aW9uLnRlcm1pbmFsVHlwZScpLFxyXG4gICAgICBmb3JtYXR0ZXI6IHtcclxuICAgICAgICB0eXBlOiAnZW51bScsXHJcbiAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy50ZXJtaW5hbExpc3QgfVxyXG4gICAgICB9LCB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ2lzQWxsJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5jdXN0b21pemVBY3Rpb24uaXNBbGwnKSxcclxuICAgICAgZm9ybWF0dGVyOiB7IHR5cGU6ICdib29sZWFuJywgb3B0aW9uczogeyB0cnVlVGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmN1c3RvbWl6ZUFjdGlvbi55ZXMnKSwgZmFsc2VUZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY3VzdG9taXplQWN0aW9uLm5vJykgfSB9ICB9XHJcbiAgXTtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZGVzaWduZXJVSVN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSkge1xyXG4gICAgdGhpcy5sb2NhbGVQaXBlID0gdGhpcy5sb2NhbGVQaXBlIHx8IG5ldyBXZkxvY2FsZVBpcGUobG9jYWxlSWQsIHJlc291cmNlcyk7XHJcbiAgICB0aGlzLmN1c3RvbUFjdGlvbkxpc3QgPSB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5mbG93Rm9ybUluZm8uY3VzdG9taXplQWN0aW9ucyB8fCBbXTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuICBjbGlja09LKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgY29uc3QgY2hlY2tlZHM6IGFueVtdID0gdGhpcy5ncmlkLmNoZWNrZWRzO1xyXG4gICAgaWYgKGNoZWNrZWRzICYmIGNoZWNrZWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY2hlY2tlZHMuZm9yRWFjaChhY3Rpb24gPT4ge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgQ3VzdG9taXplQWNpdG9uKGFjdGlvbi5kYXRhLmlkLCBhY3Rpb24uZGF0YS5jb2RlLCBhY3Rpb24uZGF0YS5uYW1lKTtcclxuICAgICAgICBpdGVtLnRlcm1pbmFsVHlwZSA9IGFjdGlvbi5kYXRhLnRlcm1pbmFsO1xyXG4gICAgICAgIC8vIGl0ZW0uZW5hYmxlID0gdHJ1ZTtcclxuICAgICAgICBpdGVtLmFjdHVhbFBhcmFtZXRlcnMgPSBbXTtcclxuICAgICAgICBpZiAoYWN0aW9uLmRhdGEuYWN0dWFsUGFyYW1ldGVycyAmJiBhY3Rpb24uZGF0YS5hY3R1YWxQYXJhbWV0ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBhY3Rpb24uZGF0YS5hY3R1YWxQYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtID0ge1xyXG4gICAgICAgICAgICAgIE5hbWU6IHAuY29kZSxcclxuICAgICAgICAgICAgICBWYWx1ZTogcC52YWx1ZSxcclxuICAgICAgICAgICAgICBWYWx1ZVRleHQ6IHAubmFtZSxcclxuICAgICAgICAgICAgICBUYWc6ICdleHByZXNzaW9uJ1xyXG4gICAgICAgICAgICB9IGFzIEFjdHVhbFBhcmFtZXRlcjtcclxuICAgICAgICAgICAgaXRlbS5hY3R1YWxQYXJhbWV0ZXJzLnB1c2gocGFyYW0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxlY3Rpb25zLnB1c2goaXRlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJtaXQuZW1pdChzZWxlY3Rpb25zKTtcclxuICB9XHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNhbmNlbC5lbWl0KHRydWUpO1xyXG4gIH1cclxufVxyXG4iXX0=
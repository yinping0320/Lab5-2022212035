/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, EventEmitter, Output, ViewChild } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { NotifyService } from '@farris/ui-notify';
import { BillTypeHelpService } from '../bill-type-help.service';
import { TreeTableComponent } from '@farris/ui-treetable';
import { AifLocalePipe, BIF_LANG_RESOURCES } from '../../aif-ui-common/pipe/aif-ui-common-locale.pipe';
import { BILL_TYPE_HELP_LANG_RESOURCES } from '../i18n/lang.resource';
var ɵ0 = BILL_TYPE_HELP_LANG_RESOURCES;
var BillTypeHelpComponent = /** @class */ (function () {
    function BillTypeHelpComponent(entityService, messager, notify, modal, loading, localePipe, router, activatedRoute) {
        this.entityService = entityService;
        this.messager = messager;
        this.notify = notify;
        this.modal = modal;
        this.loading = loading;
        this.localePipe = localePipe;
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.onselected = new EventEmitter();
        this.ttIdField = 'id';
        this.ttSearchFields = [];
        this.ttAllColumnsTitle = this.localePipe.instant("allColumns");
        this.docuTypeList = [];
    }
    /**
     * @return {?}
     */
    BillTypeHelpComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.configLookupColumns();
        this.loadItems();
    };
    /**
     * @return {?}
     */
    BillTypeHelpComponent.prototype.getSelectedDocuType = /**
     * @return {?}
     */
    function () {
        return this.tt.selectedRow && this.tt.selectedRow.data;
    };
    /**
     * 左侧树表搜索事件
     */
    /**
     * 左侧树表搜索事件
     * @param {?} obj
     * @return {?}
     */
    BillTypeHelpComponent.prototype.ttSearch = /**
     * 左侧树表搜索事件
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        this.ttSearchObj = obj;
        this.ttSearchObj && this.tt.searchHandle.search(this.ttSearchObj.field, this.ttSearchObj.value);
    };
    /**
     * @return {?}
     */
    BillTypeHelpComponent.prototype.loadItems = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var entities$ = null;
        entities$ = this.entityService.findDocumentTypeEntites();
        /** @type {?} */
        var l = this.loading.show({ message: this.localePipe.instant("loading") });
        entities$.subscribe((/**
         * @param {?} entities
         * @return {?}
         */
        function (entities) {
            l.close();
            _this.ttData = tslib_1.__spread(_this.buildTreeData(entities));
            _this.docuTypeList = entities;
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.tt.expandAll();
                if (_this.docuTypeId) {
                    _this.tt.selectNode(_this.docuTypeId);
                }
                else {
                    //默认选中第一条数据
                    _this.docuTypeList && _this.docuTypeList.length > 0 && _this.tt.selectNode(_this.docuTypeList[0].id);
                }
            }), 100);
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            l.close();
            //todo 确定异常结构, 目前采用兼容取值方式
            _this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        }));
    };
    /**
     * @param {?} nsp
     * @return {?}
     */
    BillTypeHelpComponent.prototype.ttNodeSelected = /**
     * @param {?} nsp
     * @return {?}
     */
    function (nsp) {
        /** @type {?} */
        var rows = [];
        if (Array.isArray(nsp.node)) {
            /** @type {?} */
            var arr = nsp.node;
            arr.forEach((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                rows.push(it);
            }));
        }
        else {
            rows.push(nsp.node);
        }
        if (rows.length == 0) {
            return;
        }
        /** @type {?} */
        var row = rows[0];
        this.docuTypeId = row.id;
    };
    /**
     * @param {?} entities
     * @return {?}
     */
    BillTypeHelpComponent.prototype.buildTreeData = /**
     * @param {?} entities
     * @return {?}
     */
    function (entities) {
        /** @type {?} */
        var nodes = [];
        /** @type {?} */
        var map = {};
        entities && entities.forEach((/**
         * @param {?} it
         * @return {?}
         */
        function (it) {
            if (map[it.bizKindName] == null) {
                map[it.bizKindName] = [it];
            }
            else {
                map[it.bizKindName].push(it);
            }
        }));
        Object.keys(map).forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            /** @type {?} */
            var node = {
                id: key,
                data: {
                    id: key,
                    bizKindName: key,
                    treeInfo: {
                        layer: 1,
                    }
                },
                selectable: false,
                leaf: false,
            };
            /** @type {?} */
            var children = map[key].map((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                /** @type {?} */
                var node = {
                    id: it.id,
                    data: tslib_1.__assign({}, it, { treeInfo: {
                            layer: 2,
                            parentId: key,
                        } }),
                    selectable: true,
                    leaf: true
                };
                return node;
            }));
            node.children = children;
            nodes.push(node);
        }));
        return nodes;
    };
    /**
     * @private
     * @return {?}
     */
    BillTypeHelpComponent.prototype.configLookupColumns = /**
     * @private
     * @return {?}
     */
    function () {
        this.ttCols = [
            { field: "bizKindName", title: this.localePipe.instant("busineseCategory"), width: 100 },
            { field: "name", title: this.localePipe.instant("name"), width: 80 },
            { field: "code", title: this.localePipe.instant("code"), width: 80 },
            { field: "moduleName", title: this.localePipe.instant("module"), width: 100 },
            { field: "bizTypeName", title: this.localePipe.instant("busineseType"), width: 100 },
        ];
    };
    BillTypeHelpComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-bill-type-help',
                    template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"h-100 d-flex flex-column\">\r\n    <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n      [fit]=\"true\" [showFilterBar]=\"true\" [searchFields]=\"ttSearchFields\" [showIcon]=\"false\" [resizableColumns]=\"true\"\r\n      [showBorder]=\"true\" [striped]=\"true\" [allColumnsTitle]=\"ttAllColumnsTitle\" [expandLevel]=\"0\" [showHeader]=\"true\"\r\n      [fixedHeader]=\"true\" [singleSelect]=\"true\" [showCheckbox]=\"false\" [showCheckAll]=\"false\" [checkOnSelect]=\"true\"\r\n      [selectOnCheck]=\"true\" (search)=\"ttSearch($event)\" (nodeSelected)=\"ttNodeSelected($event)\">\r\n    </farris-treetable>\r\n  </div>\r\n</div>",
                    providers: [
                        { provide: BIF_LANG_RESOURCES, useValue: ɵ0 },
                        AifLocalePipe,
                    ],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    BillTypeHelpComponent.ctorParameters = function () { return [
        { type: BillTypeHelpService },
        { type: MessagerService },
        { type: NotifyService },
        { type: BsModalService },
        { type: LoadingService },
        { type: AifLocalePipe },
        { type: Router },
        { type: ActivatedRoute }
    ]; };
    BillTypeHelpComponent.propDecorators = {
        onselected: [{ type: Output, args: ["onselected",] }],
        tt: [{ type: ViewChild, args: ['tt',] }]
    };
    return BillTypeHelpComponent;
}());
export { BillTypeHelpComponent };
if (false) {
    /** @type {?} */
    BillTypeHelpComponent.prototype.onselected;
    /** @type {?} */
    BillTypeHelpComponent.prototype.tt;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttData;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttCols;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttIdField;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttSearchFields;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttSearchObj;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttAllColumnsTitle;
    /** @type {?} */
    BillTypeHelpComponent.prototype.docuTypeList;
    /** @type {?} */
    BillTypeHelpComponent.prototype.docuTypeId;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.entityService;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.messager;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.modal;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.localePipe;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.activatedRoute;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10eXBlLWhlbHAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9iaWxsLXR5cGUtaGVscC9iaWxsLXR5cGUtaGVscC9iaWxsLXR5cGUtaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25GLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBR2xELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2hFLE9BQU8sRUFBK0Isa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RixPQUFPLEVBQUUsYUFBYSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFDdkcsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sdUJBQXVCLENBQUM7U0FPekIsNkJBQTZCO0FBTDFFO0lBNkJFLCtCQUNVLGFBQWtDLEVBQ2xDLFFBQXlCLEVBQ3pCLE1BQXFCLEVBQ3JCLEtBQXFCLEVBQ3JCLE9BQXVCLEVBQ3ZCLFVBQXlCLEVBQ3pCLE1BQWMsRUFDZCxjQUE4QjtRQVA5QixrQkFBYSxHQUFiLGFBQWEsQ0FBcUI7UUFDbEMsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixV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QUFzQjs7Ozs7SUFDdEIsK0NBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIE9uSW5pdCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcblxyXG5pbXBvcnQgeyBEb2N1VHlwZUhlbHBlckVudGl0eSB9IGZyb20gJy4uL2VudGl0eS9Eb2N1VHlwZUhlbHBlckVudGl0eSc7XHJcbmltcG9ydCB7IEJpbGxUeXBlSGVscFNlcnZpY2UgfSBmcm9tICcuLi9iaWxsLXR5cGUtaGVscC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTm9kZVNlbGVjdGVkUGFyYW0sIFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IEFpZkxvY2FsZVBpcGUsIEJJRl9MQU5HX1JFU09VUkNFUyB9IGZyb20gJy4uLy4uL2FpZi11aS1jb21tb24vcGlwZS9haWYtdWktY29tbW9uLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgQklMTF9UWVBFX0hFTFBfTEFOR19SRVNPVVJDRVMgfSBmcm9tICcuLi9pMThuL2xhbmcucmVzb3VyY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtYmlsbC10eXBlLWhlbHAnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9iaWxsLXR5cGUtaGVscC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYmlsbC10eXBlLWhlbHAuY29tcG9uZW50LmNzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgeyBwcm92aWRlOiBCSUZfTEFOR19SRVNPVVJDRVMsIHVzZVZhbHVlOiBCSUxMX1RZUEVfSEVMUF9MQU5HX1JFU09VUkNFUyB9LFxyXG4gICAgQWlmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCaWxsVHlwZUhlbHBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBPdXRwdXQoXCJvbnNlbGVjdGVkXCIpXHJcbiAgb25zZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXI8RG9jdVR5cGVIZWxwZXJFbnRpdHk+KCk7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ3R0JylcclxuICB0dDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gIHR0RGF0YTogVHJlZU5vZGVbXTtcclxuICB0dENvbHM6IGFueVtdO1xyXG4gIHR0SWRGaWVsZCA9ICdpZCc7XHJcbiAgdHRTZWFyY2hGaWVsZHM6IHtcclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICB2YWx1ZTogc3RyaW5nO1xyXG4gIH1bXSA9IFtdO1xyXG4gIHR0U2VhcmNoT2JqOiB7IGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfTtcclxuICB0dEFsbENvbHVtbnNUaXRsZTogc3RyaW5nID0gdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJhbGxDb2x1bW5zXCIpO1xyXG5cclxuICBkb2N1VHlwZUxpc3Q6IERvY3VUeXBlSGVscGVyRW50aXR5W10gPSBbXTtcclxuXHJcbiAgZG9jdVR5cGVJZDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZW50aXR5U2VydmljZTogQmlsbFR5cGVIZWxwU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgbm90aWZ5OiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtb2RhbDogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsb2NhbGVQaXBlOiBBaWZMb2NhbGVQaXBlLFxyXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcclxuICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb25maWdMb29rdXBDb2x1bW5zKCk7XHJcbiAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VsZWN0ZWREb2N1VHlwZSgpOiBEb2N1VHlwZUhlbHBlckVudGl0eSB7XHJcbiAgICByZXR1cm4gdGhpcy50dC5zZWxlY3RlZFJvdyAmJiB0aGlzLnR0LnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt6bkvqfmoJHooajmkJzntKLkuovku7ZcclxuICAgKi9cclxuICB0dFNlYXJjaChvYmo6IHsgZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9KSB7XHJcbiAgICB0aGlzLnR0U2VhcmNoT2JqID0gb2JqO1xyXG4gICAgdGhpcy50dFNlYXJjaE9iaiAmJiB0aGlzLnR0LnNlYXJjaEhhbmRsZS5zZWFyY2godGhpcy50dFNlYXJjaE9iai5maWVsZCwgdGhpcy50dFNlYXJjaE9iai52YWx1ZSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgbG9hZEl0ZW1zKCkge1xyXG4gICAgbGV0IGVudGl0aWVzJDogT2JzZXJ2YWJsZTxEb2N1VHlwZUhlbHBlckVudGl0eVtdPiA9IG51bGw7XHJcbiAgICBlbnRpdGllcyQgPSB0aGlzLmVudGl0eVNlcnZpY2UuZmluZERvY3VtZW50VHlwZUVudGl0ZXMoKTtcclxuICAgIGNvbnN0IGwgPSB0aGlzLmxvYWRpbmcuc2hvdyh7IG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwibG9hZGluZ1wiKSB9KTtcclxuICAgIGVudGl0aWVzJC5zdWJzY3JpYmUoXHJcbiAgICAgIChlbnRpdGllczogRG9jdVR5cGVIZWxwZXJFbnRpdHlbXSkgPT4ge1xyXG4gICAgICAgIGwuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLnR0RGF0YSA9IFsuLi50aGlzLmJ1aWxkVHJlZURhdGEoZW50aXRpZXMpXTtcclxuICAgICAgICB0aGlzLmRvY3VUeXBlTGlzdCA9IGVudGl0aWVzO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy50dC5leHBhbmRBbGwoKTtcclxuICAgICAgICAgIGlmICh0aGlzLmRvY3VUeXBlSWQpIHtcclxuICAgICAgICAgICAgdGhpcy50dC5zZWxlY3ROb2RlKHRoaXMuZG9jdVR5cGVJZCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL+m7mOiupOmAieS4reesrOS4gOadoeaVsOaNrlxyXG4gICAgICAgICAgICB0aGlzLmRvY3VUeXBlTGlzdCAmJiB0aGlzLmRvY3VUeXBlTGlzdC5sZW5ndGggPiAwICYmIHRoaXMudHQuc2VsZWN0Tm9kZSh0aGlzLmRvY3VUeXBlTGlzdFswXS5pZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgICAgfSxcclxuICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgIGwuY2xvc2UoKTtcclxuICAgICAgICAvL3RvZG8g56Gu5a6a5byC5bi457uT5p6ELCDnm67liY3ph4fnlKjlhbzlrrnlj5blgLzmlrnlvI9cclxuICAgICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKGVyci5lcnJvciA9PSBudWxsID8gZXJyLm1lc3NhZ2UgOiAoZXJyLmVycm9yLk1lc3NhZ2UgfHwgZXJyLmVycm9yLm1lc3NhZ2UgfHwgZXJyLm1lc3NhZ2UpKTtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICB0dE5vZGVTZWxlY3RlZChuc3A6IE5vZGVTZWxlY3RlZFBhcmFtKSB7XHJcbiAgICBsZXQgcm93czogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobnNwLm5vZGUpKSB7XHJcbiAgICAgIGNvbnN0IGFycjogVHJlZU5vZGVbXSA9IG5zcC5ub2RlO1xyXG4gICAgICBhcnIuZm9yRWFjaChpdCA9PiB7XHJcbiAgICAgICAgcm93cy5wdXNoKGl0KTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByb3dzLnB1c2gobnNwLm5vZGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJvd3MubGVuZ3RoID09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHJvdyA9IHJvd3NbMF07XHJcbiAgICB0aGlzLmRvY3VUeXBlSWQgPSByb3cuaWQ7XHJcbiAgfVxyXG5cclxuICBidWlsZFRyZWVEYXRhKGVudGl0aWVzOiBEb2N1VHlwZUhlbHBlckVudGl0eVtdKTogVHJlZU5vZGVbXSB7XHJcbiAgICBjb25zdCBub2RlczogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgY29uc3QgbWFwOiB7XHJcbiAgICAgIFtrZXk6IHN0cmluZ106IERvY3VUeXBlSGVscGVyRW50aXR5W11cclxuICAgIH0gPSB7fTtcclxuICAgIGVudGl0aWVzICYmIGVudGl0aWVzLmZvckVhY2goaXQgPT4ge1xyXG4gICAgICBpZiAobWFwW2l0LmJpektpbmROYW1lXSA9PSBudWxsKSB7XHJcbiAgICAgICAgbWFwW2l0LmJpektpbmROYW1lXSA9IFtpdF07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbWFwW2l0LmJpektpbmROYW1lXS5wdXNoKGl0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgT2JqZWN0LmtleXMobWFwKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vZGU6IFRyZWVOb2RlID0ge1xyXG4gICAgICAgIGlkOiBrZXksXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IGtleSxcclxuICAgICAgICAgIGJpektpbmROYW1lOiBrZXksXHJcbiAgICAgICAgICB0cmVlSW5mbzoge1xyXG4gICAgICAgICAgICBsYXllcjogMSxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxyXG4gICAgICAgIGxlYWY6IGZhbHNlLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgY2hpbGRyZW4gPSBtYXBba2V5XS5tYXAoaXQgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5vZGU6IFRyZWVOb2RlID0ge1xyXG4gICAgICAgICAgaWQ6IGl0LmlkLFxyXG4gICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAuLi5pdCxcclxuICAgICAgICAgICAgdHJlZUluZm86IHtcclxuICAgICAgICAgICAgICBsYXllcjogMixcclxuICAgICAgICAgICAgICBwYXJlbnRJZDoga2V5LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNlbGVjdGFibGU6IHRydWUsXHJcbiAgICAgICAgICBsZWFmOiB0cnVlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbm9kZS5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG5cclxuICAgICAgbm9kZXMucHVzaChub2RlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBub2RlcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY29uZmlnTG9va3VwQ29sdW1ucygpIHtcclxuICAgIHRoaXMudHRDb2xzID0gW1xyXG4gICAgICB7IGZpZWxkOiBcImJpektpbmROYW1lXCIsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcImJ1c2luZXNlQ2F0ZWdvcnlcIiksIHdpZHRoOiAxMDAgfSxcclxuICAgICAgeyBmaWVsZDogXCJuYW1lXCIsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcIm5hbWVcIiksIHdpZHRoOiA4MCB9LFxyXG4gICAgICB7IGZpZWxkOiBcImNvZGVcIiwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwiY29kZVwiKSwgd2lkdGg6IDgwIH0sXHJcbiAgICAgIHsgZmllbGQ6IFwibW9kdWxlTmFtZVwiLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJtb2R1bGVcIiksIHdpZHRoOiAxMDAgfSxcclxuICAgICAgeyBmaWVsZDogXCJiaXpUeXBlTmFtZVwiLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJidXNpbmVzZVR5cGVcIiksIHdpZHRoOiAxMDAgfSxcclxuICAgIF07XHJcbiAgfVxyXG59XHJcbiJdfQ==
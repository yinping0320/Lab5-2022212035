/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/**
 * @abstract
 */
var /**
 * @abstract
 */
AbstractDatagridComponent = /** @class */ (function () {
    function AbstractDatagridComponent(messager, notify, metadataService, modalService, localePipe, injector, resolver, cdf) {
        this.messager = messager;
        this.notify = notify;
        this.metadataService = metadataService;
        this.modalService = modalService;
        this.localePipe = localePipe;
        this.injector = injector;
        this.resolver = resolver;
        this.cdf = cdf;
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.toolbarData = [
            {
                id: 'btn-add',
                text: this.localePipe.instant("add"),
                class: 'btn btn-secondary',
                disabled: false
            },
            {
                id: 'btn-remove',
                text: this.localePipe.instant("remove"),
                class: 'btn btn-secondary',
                disabled: false
            },
        ];
        this.dgIdField = "id";
        this.editingRowId = null;
    }
    Object.defineProperty(AbstractDatagridComponent.prototype, "dgTotal", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dgData.length || 0;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} args
     * @return {?}
     */
    AbstractDatagridComponent.prototype.toolbarClickHandler = /**
     * @param {?} args
     * @return {?}
     */
    function (args) {
        switch (args.id) {
            case 'btn-add':
                this.add();
                break;
            case 'btn-remove':
                this.remove(null);
                break;
        }
    };
    /**
     * 开始行编辑
     * @param ctx
     */
    /**
     * 开始行编辑
     * @param {?=} ctx
     * @return {?}
     */
    AbstractDatagridComponent.prototype.startRowEdit = /**
     * 开始行编辑
     * @param {?=} ctx
     * @return {?}
     */
    function (ctx) {
        this.dg.editRow(ctx.rowData.id);
        this.editingRowId = ctx.rowData.id;
        this.cdf.detectChanges();
        return false;
    };
    /**
     * 取消行编辑
     * @param ctx
     */
    /**
     * 取消行编辑
     * @param {?=} ctx
     * @return {?}
     */
    AbstractDatagridComponent.prototype.cancelRowEdit = /**
     * 取消行编辑
     * @param {?=} ctx
     * @return {?}
     */
    function (ctx) {
        this.dg.cancelEdit(ctx.rowData.id);
        this.editingRowId = null;
        this.cdf.detectChanges();
        return false;
    };
    /**
     * 结束行编辑
     * @param ctx
     */
    /**
     * 结束行编辑
     * @param {?=} ctx
     * @return {?}
     */
    AbstractDatagridComponent.prototype.endRowEdit = /**
     * 结束行编辑
     * @param {?=} ctx
     * @return {?}
     */
    function (ctx) {
        this.dg.endRowEdit();
        this.editingRowId = null;
        this.cdf.detectChanges();
        return false;
    };
    /**
     * 行删除
     * @param ctx
     */
    /**
     * 行删除
     * @param {?} evt
     * @param {?=} ctx
     * @return {?}
     */
    AbstractDatagridComponent.prototype.remove = /**
     * 行删除
     * @param {?} evt
     * @param {?=} ctx
     * @return {?}
     */
    function (evt, ctx) {
        var e_1, _a;
        /** @type {?} */
        var ids = [];
        if (ctx == null) {
            // 批量删除
            this.dg.checkeds.forEach((/**
             * @param {?} it
             * @return {?}
             */
            function (it) {
                ids.push(it.id);
            }));
        }
        else {
            // 行内删除
            ids.push(ctx.rowData.id);
        }
        if (ids.length == 0) {
            this.notify.warning(this.localePipe.instant("pleaseSelectOneItemAtLeast"));
            if (evt != null) {
                evt.stopPropagation();
            }
            return false;
        }
        try {
            for (var ids_1 = tslib_1.__values(ids), ids_1_1 = ids_1.next(); !ids_1_1.done; ids_1_1 = ids_1.next()) {
                var id = ids_1_1.value;
                this.dg.deleteRow(id);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (ids_1_1 && !ids_1_1.done && (_a = ids_1.return)) _a.call(ids_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.dgData = this.dg.data;
        if (this.editingRowId != null) {
            if (ids.includes(this.editingRowId)) {
                this.editingRowId = null;
            }
            else {
                this.dg.editRow(this.editingRowId);
            }
        }
        this.cdf.detectChanges();
        if (evt != null) {
            evt.stopPropagation();
        }
        return false;
    };
    /**
     * 行移动
     * @param ctx datagrid上下文
     * @param direction -1: 上移， 1：下移
     */
    /**
     * 行移动
     * @param {?} evt
     * @param {?} ctx datagrid上下文
     * @param {?} direction -1: 上移， 1：下移
     * @return {?}
     */
    AbstractDatagridComponent.prototype.rowMove = /**
     * 行移动
     * @param {?} evt
     * @param {?} ctx datagrid上下文
     * @param {?} direction -1: 上移， 1：下移
     * @return {?}
     */
    function (evt, ctx, direction) {
        // const arr = dg.data;
        /** @type {?} */
        var arr = this.dgData;
        /** @type {?} */
        var index = this.findIndex(arr, ctx.rowData.id);
        if (index == -1 || (direction == 1 && index == arr.length - 1) || (direction == -1 && index == 0)) {
            return;
        }
        arr[index] = [arr[index + direction], arr[index + direction] = arr[index]][0];
        this.dgData = tslib_1.__spread(this.dgData);
        this.cdf.detectChanges();
        if (evt != null) {
            evt.stopPropagation();
        }
        return false;
    };
    /**
     * 查找数组中指定id的元素下标
     * @param arr 数组
     * @param id 数组唯一标识
     * @returns 元素下标
     */
    /**
     * 查找数组中指定id的元素下标
     * @protected
     * @param {?} arr 数组
     * @param {?} id 数组唯一标识
     * @return {?} 元素下标
     */
    AbstractDatagridComponent.prototype.findIndex = /**
     * 查找数组中指定id的元素下标
     * @protected
     * @param {?} arr 数组
     * @param {?} id 数组唯一标识
     * @return {?} 元素下标
     */
    function (arr, id) {
        /** @type {?} */
        var index = -1;
        for (var i = 0; i < arr.length; i++) {
            /** @type {?} */
            var elt = arr[i];
            if (elt.id == id) {
                index = i;
                break;
            }
        }
        return index;
    };
    return AbstractDatagridComponent;
}());
/**
 * @abstract
 */
export { AbstractDatagridComponent };
if (false) {
    /** @type {?} */
    AbstractDatagridComponent.prototype.groupIcon;
    /** @type {?} */
    AbstractDatagridComponent.prototype.toolbar;
    /** @type {?} */
    AbstractDatagridComponent.prototype.toolbarData;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dg;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgIdField;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgColumns;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgIsEnabledStateCell;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgOpCell;
    /** @type {?} */
    AbstractDatagridComponent.prototype.editingRowId;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.metadataService;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.localePipe;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.resolver;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.cdf;
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.dgData = function () { };
    /**
     * @abstract
     * @param {?} arr
     * @return {?}
     */
    AbstractDatagridComponent.prototype.dgData = function (arr) { };
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.ngOnInit = function () { };
    /**
     * 新增行
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.add = function () { };
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.load = function () { };
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.configDgColumns = function () { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtZGF0YWdyaWQtY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9zdGFydC1jb25kaXRpb24vYWJzdHJhY3QtZGF0YWdyaWQtY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBVUE7Ozs7SUFnQ0ksbUNBQ2MsUUFBeUIsRUFDekIsTUFBcUIsRUFDckIsZUFBcUMsRUFDckMsWUFBNEIsRUFDNUIsVUFBeUIsRUFDekIsUUFBa0IsRUFDbEIsUUFBa0MsRUFDbEMsR0FBc0I7UUFQdEIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixvQkFBZSxHQUFmLGVBQWUsQ0FBc0I7UUFDckMsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGVBQVUsR0FBVixVQUFVLENBQWU7UUFDekIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUNsQyxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQXZDM0IsY0FBUyxHQUFHLHNDQUFzQyxDQUFDO1FBR25ELGdCQUFXLEdBQUc7WUFDbkI7Z0JBQ0ksRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztnQkFDcEMsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsUUFBUSxFQUFFLEtBQUs7YUFDbEI7WUFDRDtnQkFDSSxFQUFFLEVBQUUsWUFBWTtnQkFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztnQkFDdkMsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsUUFBUSxFQUFFLEtBQUs7YUFDbEI7U0FDSixDQUFDO1FBR0YsY0FBUyxHQUFXLElBQUksQ0FBQztRQVV6QixpQkFBWSxHQUFXLElBQUks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QmlsbFdyaXRlYmFja1Byb2Nlc3NFbnRpdHkgfSBmcm9tICdAZWRwLWJpZi9jb21tb24tYXBpJztcclxuaW1wb3J0IHsgUmVzcG9uc2VUb29sYmFyQ29tcG9uZW50LCBSZXNwb25zZVRvb2xiYXJDbGlja0V2ZW50IH0gZnJvbSAnQGZhcnJpcy91aS1yZXNwb25zZS10b29sYmFyJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQsIERhdGFDb2x1bW4gfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgVGVtcGxhdGVSZWYsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENoYW5nZURldGVjdG9yUmVmLCBPbkluaXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgR1NQTWV0YWRhdGFSVFNlcnZpY2UgfSBmcm9tICdAZ3NwLWxjbS9tZXRhZGF0YXJ0LXNlbGVjdG9yJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgQWlmTG9jYWxlUGlwZSB9IGZyb20gJy4uL2FpZi11aS1jb21tb24vcGlwZS9haWYtdWktY29tbW9uLWxvY2FsZS5waXBlJztcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdERhdGFncmlkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIHJlYWRvbmx5IGdyb3VwSWNvbiA9ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPic7XHJcblxyXG4gICAgdG9vbGJhcjogUmVzcG9uc2VUb29sYmFyQ29tcG9uZW50O1xyXG4gICAgcmVhZG9ubHkgdG9vbGJhckRhdGEgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZDogJ2J0bi1hZGQnLFxyXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcImFkZFwiKSxcclxuICAgICAgICAgICAgY2xhc3M6ICdidG4gYnRuLXNlY29uZGFyeScsXHJcbiAgICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZDogJ2J0bi1yZW1vdmUnLFxyXG4gICAgICAgICAgICB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcInJlbW92ZVwiKSxcclxuICAgICAgICAgICAgY2xhc3M6ICdidG4gYnRuLXNlY29uZGFyeScsXHJcbiAgICAgICAgICAgIGRpc2FibGVkOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICBdO1xyXG5cclxuICAgIGRnOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICAgIGRnSWRGaWVsZDogc3RyaW5nID0gXCJpZFwiO1xyXG4gICAgZGdDb2x1bW5zOiBEYXRhQ29sdW1uW107XHJcbiAgICBhYnN0cmFjdCBnZXQgZGdEYXRhKCk6IEFycmF5PGFueT47XHJcbiAgICBhYnN0cmFjdCBzZXQgZGdEYXRhKGFycjogQXJyYXk8YW55Pik7XHJcbiAgICBnZXQgZGdUb3RhbCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRnRGF0YS5sZW5ndGggfHwgMDtcclxuICAgIH1cclxuXHJcbiAgICBkZ0lzRW5hYmxlZFN0YXRlQ2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICAgIGRnT3BDZWxsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgZWRpdGluZ1Jvd0lkOiBzdHJpbmcgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByb3RlY3RlZCBtZXNzYWdlcjogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgICAgIHByb3RlY3RlZCBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1ldGFkYXRhU2VydmljZTogR1NQTWV0YWRhdGFSVFNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIG1vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIGxvY2FsZVBpcGU6IEFpZkxvY2FsZVBpcGUsXHJcbiAgICAgICAgcHJvdGVjdGVkIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgICAgICBwcm90ZWN0ZWQgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICBwcm90ZWN0ZWQgY2RmOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgICkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBhYnN0cmFjdCBuZ09uSW5pdCgpOiB2b2lkO1xyXG5cclxuICAgIHRvb2xiYXJDbGlja0hhbmRsZXIoYXJnczogUmVzcG9uc2VUb29sYmFyQ2xpY2tFdmVudCkge1xyXG4gICAgICAgIHN3aXRjaCAoYXJncy5pZCkge1xyXG4gICAgICAgICAgICBjYXNlICdidG4tYWRkJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuYWRkKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYnRuLXJlbW92ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShudWxsKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaWsOWinuihjFxyXG4gICAgICovXHJcbiAgICBhYnN0cmFjdCBhZGQoKTogdm9pZDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOW8gOWni+ihjOe8lui+kVxyXG4gICAgICogQHBhcmFtIGN0eCBcclxuICAgICAqL1xyXG4gICAgc3RhcnRSb3dFZGl0KGN0eD86IHsgcm93SW5kZXg6IG51bWJlcjsgcm93RGF0YTogeyBba2V5OiBzdHJpbmddOiBhbnk7IGlkOiBhbnk7IH07IH0pIHtcclxuICAgICAgICB0aGlzLmRnLmVkaXRSb3coY3R4LnJvd0RhdGEuaWQpO1xyXG4gICAgICAgIHRoaXMuZWRpdGluZ1Jvd0lkID0gY3R4LnJvd0RhdGEuaWQ7XHJcbiAgICAgICAgdGhpcy5jZGYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWPlua2iOihjOe8lui+kVxyXG4gICAgICogQHBhcmFtIGN0eCBcclxuICAgICAqL1xyXG4gICAgY2FuY2VsUm93RWRpdChjdHg/OiB7IHJvd0luZGV4OiBudW1iZXI7IHJvd0RhdGE6IHsgW2tleTogc3RyaW5nXTogYW55OyBpZDogYW55OyB9OyB9KSB7XHJcbiAgICAgICAgdGhpcy5kZy5jYW5jZWxFZGl0KGN0eC5yb3dEYXRhLmlkKTtcclxuICAgICAgICB0aGlzLmVkaXRpbmdSb3dJZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jZGYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOe7k+adn+ihjOe8lui+kVxyXG4gICAgICogQHBhcmFtIGN0eCBcclxuICAgICAqL1xyXG4gICAgZW5kUm93RWRpdChjdHg/OiB7IHJvd0luZGV4OiBudW1iZXI7IHJvd0RhdGE6IHsgW2tleTogc3RyaW5nXTogYW55OyBpZDogYW55OyB9OyB9KSB7XHJcbiAgICAgICAgdGhpcy5kZy5lbmRSb3dFZGl0KCk7XHJcbiAgICAgICAgdGhpcy5lZGl0aW5nUm93SWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY2RmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDooYzliKDpmaRcclxuICAgICAqIEBwYXJhbSBjdHggXHJcbiAgICAgKi9cclxuICAgIHJlbW92ZShldnQ6IEV2ZW50LCBjdHg/OiB7IHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IHsgaWQ7W2tleTogc3RyaW5nXTogYW55IH0gfSkge1xyXG4gICAgICAgIGNvbnN0IGlkczogc3RyaW5nW10gPSBbXTtcclxuICAgICAgICBpZiAoY3R4ID09IG51bGwpIHtcclxuICAgICAgICAgICAgLy8g5om56YeP5Yig6ZmkXHJcbiAgICAgICAgICAgIHRoaXMuZGcuY2hlY2tlZHMuZm9yRWFjaChpdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZHMucHVzaChpdC5pZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIOihjOWGheWIoOmZpFxyXG4gICAgICAgICAgICBpZHMucHVzaChjdHgucm93RGF0YS5pZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpZHMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcInBsZWFzZVNlbGVjdE9uZUl0ZW1BdExlYXN0XCIpKTtcclxuICAgICAgICAgICAgaWYgKGV2dCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpZCBvZiBpZHMpIHtcclxuICAgICAgICAgICAgdGhpcy5kZy5kZWxldGVSb3coaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRnRGF0YSA9IHRoaXMuZGcuZGF0YTtcclxuICAgICAgICBpZiAodGhpcy5lZGl0aW5nUm93SWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZiAoaWRzLmluY2x1ZGVzKHRoaXMuZWRpdGluZ1Jvd0lkKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lZGl0aW5nUm93SWQgPSBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZy5lZGl0Um93KHRoaXMuZWRpdGluZ1Jvd0lkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNkZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgaWYgKGV2dCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6KGM56e75YqoXHJcbiAgICAgKiBAcGFyYW0gY3R4IGRhdGFncmlk5LiK5LiL5paHXHJcbiAgICAgKiBAcGFyYW0gZGlyZWN0aW9uIC0xOiDkuIrnp7vvvIwgMe+8muS4i+enu1xyXG4gICAgICovXHJcbiAgICByb3dNb3ZlKGV2dDogRXZlbnQsIGN0eDogeyByb3dJbmRleDogbnVtYmVyLCByb3dEYXRhOiB7IGlkO1trZXk6IHN0cmluZ106IGFueSB9IH0sIGRpcmVjdGlvbjogbnVtYmVyKSB7XHJcbiAgICAgICAgLy8gY29uc3QgYXJyID0gZGcuZGF0YTtcclxuICAgICAgICBjb25zdCBhcnIgPSB0aGlzLmRnRGF0YTtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZmluZEluZGV4KGFyciwgY3R4LnJvd0RhdGEuaWQpO1xyXG5cclxuICAgICAgICBpZiAoaW5kZXggPT0gLTEgfHwgKGRpcmVjdGlvbiA9PSAxICYmIGluZGV4ID09IGFyci5sZW5ndGggLSAxKSB8fCAoZGlyZWN0aW9uID09IC0xICYmIGluZGV4ID09IDApKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXJyW2luZGV4XSA9IFthcnJbaW5kZXggKyBkaXJlY3Rpb25dLCBhcnJbaW5kZXggKyBkaXJlY3Rpb25dID0gYXJyW2luZGV4XV1bMF07XHJcbiAgICAgICAgdGhpcy5kZ0RhdGEgPSBbLi4udGhpcy5kZ0RhdGFdO1xyXG4gICAgICAgIHRoaXMuY2RmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICBpZiAoZXZ0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmn6Xmib7mlbDnu4TkuK3mjIflrpppZOeahOWFg+e0oOS4i+agh1xyXG4gICAgICogQHBhcmFtIGFyciDmlbDnu4RcclxuICAgICAqIEBwYXJhbSBpZCDmlbDnu4TllK/kuIDmoIfor4ZcclxuICAgICAqIEByZXR1cm5zIOWFg+e0oOS4i+agh1xyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgZmluZEluZGV4KGFycjogYW55W10sIGlkKTogbnVtYmVyIHtcclxuICAgICAgICBsZXQgaW5kZXggPSAtMTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBlbHQgPSBhcnJbaV07XHJcbiAgICAgICAgICAgIGlmIChlbHQuaWQgPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBhYnN0cmFjdCBsb2FkKCk6IHZvaWQ7XHJcblxyXG4gICAgYWJzdHJhY3QgY29uZmlnRGdDb2x1bW5zKCk6IHZvaWQ7XHJcbn0iXX0=
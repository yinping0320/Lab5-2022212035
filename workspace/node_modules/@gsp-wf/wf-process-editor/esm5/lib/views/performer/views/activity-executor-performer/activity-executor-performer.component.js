/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, NgZone, ViewChild, ElementRef, HostBinding, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { DialogComponent } from "@farris/ui-dialog";
import { DatagridComponent } from "@farris/ui-datagrid";
import { ExprEditMode, ExpressionService, InjectedType } from "@gsp-svc/expression";
import { ProcessDesignerUIState } from "../../../../app/process-designer.uistate";
import { ActivityExecutorParticipant } from "./entities/activity-executor.participant";
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../../../i18n/pipe/wf-process-editor-locale.pipe';
var ActivityExecutorPerformerComponent = /** @class */ (function () {
    function ActivityExecutorPerformerComponent(ngZone, designerUIState, expr, cdr, localeId, resources, localePipe) {
        this.ngZone = ngZone;
        this.designerUIState = designerUIState;
        this.expr = expr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.cls = 'd-flex flex-fill h-100';
        this.showClearButton = false;
        this.activityExecutors = [];
        this.cols = [
            { title: this.localePipe.transform('component.activityExecutor.name'), field: 'Name', width: 60 },
            { title: 'ID', field: 'Id', width: 90 }
        ];
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.inputGroup.nativeElement.addEventListener('mouseenter', _this.onMouseEnter.bind(_this));
            _this.inputGroup.nativeElement.addEventListener('mouseleave', _this.onMouseLeave.bind(_this));
        }));
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.onMouseEnter = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.showClearButton = true;
        if (this.showClearButton) {
            this.toggleClearIcon(event, true);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.onMouseLeave = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.showClearButton = false;
        this.toggleClearIcon(event, false);
    };
    /**
     * @private
     * @param {?} event
     * @param {?=} isShow
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.toggleClearIcon = /**
     * @private
     * @param {?} event
     * @param {?=} isShow
     * @return {?}
     */
    function (event, isShow) {
        if (isShow === void 0) { isShow = false; }
        /** @type {?} */
        var str = isShow ? '' : 'none';
        /** @type {?} */
        var clearIcon = event.target.querySelector('.input-group-clear');
        if (clearIcon) {
            clearIcon.style.display = str;
        }
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.clear = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        this.activityExecutors = [];
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.selectUsers = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var e_1, _a;
        // 已办用户
        /** @type {?} */
        var selectedUser = [];
        if (this.activityExecutors && this.activityExecutors.length > 0) {
            try {
                for (var _b = tslib_1.__values(this.activityExecutors), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var handler = _c.value;
                    /** @type {?} */
                    var data_1 = {
                        data: {
                            Id: handler.activityDefId,
                            Name: handler.activityDefName
                        },
                        id: handler.activityDefId
                    };
                    selectedUser.push(data_1);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        this.allActivityTable.setCurrentPagerData(selectedUser);
        this.allActivityDialog.show();
    };
    /**
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.editConditon = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var e_2, _a, e_3, _b, e_4, _c, e_5, _d;
        // this.expr.clearContext();
        if (this.designerUIState.schemas.length > 0) {
            try {
                for (var _e = tslib_1.__values(this.designerUIState.schemas), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var schema = _f.value;
                    this.expr.addSchema('Schema', schema);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_f && !_f.done && (_a = _e.return)) _a.call(_e);
                }
                finally { if (e_2) throw e_2.error; }
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                var entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        var context = new Array();
        context = this.designerUIState.addContext(context);
        if (this.designerUIState.subActivityContext.length > 0) {
            var _loop_1 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _g = tslib_1.__values(this.designerUIState.subActivityContext), _h = _g.next(); !_h.done; _h = _g.next()) {
                    var variable = _h.value;
                    _loop_1(variable);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_h && !_h.done && (_b = _g.return)) _b.call(_g);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        if (this.designerUIState.activityComponentContext.length > 0) {
            var _loop_2 = function (variable) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                function (c) { return c.key === variable.key; }))) {
                    context.push(variable);
                }
            };
            try {
                for (var _j = tslib_1.__values(this.designerUIState.activityComponentContext), _k = _j.next(); !_k.done; _k = _j.next()) {
                    var variable = _k.value;
                    _loop_2(variable);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (_k && !_k.done && (_c = _j.return)) _c.call(_j);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        if (context.length > 0) {
            try {
                for (var context_1 = tslib_1.__values(context), context_1_1 = context_1.next(); !context_1_1.done; context_1_1 = context_1.next()) {
                    var v = context_1_1.value;
                    this.expr.addContext(v);
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (context_1_1 && !context_1_1.done && (_d = context_1.return)) _d.call(context_1);
                }
                finally { if (e_5) throw e_5.error; }
            }
        }
        this.expr.setEditPattern(ExprEditMode.Conditional); // 表达式展现模式：默认简易版
        this.expr.addExpressionText(this.condition);
        this.expr.buildExpression().then((/**
         * @param {?} expressioninfo
         * @return {?}
         */
        function (expressioninfo) {
            _this.condition = expressioninfo;
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                _this.expr.exprEntity.contextEntities = _this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                function (y) { return y.key === x.key; })); }));
            }
        }));
    };
    /**
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.activitiesSelect = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var selectedActivities = this.allActivityTable.checkeds;
        this.activityExecutors = selectedActivities.map((/**
         * @param {?} activity
         * @return {?}
         */
        function (activity) {
            /** @type {?} */
            var handler = new ActivityExecutorParticipant(activity.data.Id, activity.data.Name, 'wf.ActivityExecutorParticipantExpression');
            handler.performerName = '<' + activity.data.Name + _this.localePipe.transform('component.activityExecutor.eventHandler');
            handler.activityDefId = activity.data.Id;
            handler.activityDefName = activity.data.Name;
            handler.condition = _this.condition;
            return handler;
        }));
        this.allActivityDialog.close();
    };
    /**
     * @return {?}
     */
    ActivityExecutorPerformerComponent.prototype.getPerformers = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.activityExecutors.map((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return x.condition = _this.condition; }));
        return this.activityExecutors;
    };
    ActivityExecutorPerformerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-activity-handler-performer',
                    template: "<div class=\"d-flex flex-fill farris-overflow-y-auto p-md-2\" style=\"background: #FFF;\">\r\n  <div class=\"d-flex flex-fill farris-overflow-y-auto mx-3 my-2\" style=\"border-radius:16px;border: 1.5px solid #F1F3F7;\">\r\n  <form style=\"width: 100%;\" >\r\n    <div class=\"d-flex m-2 flex-column w-100\">\r\n      <div class=\"d-flex flex-column\">\r\n        <div class=\"farris-form form-inline  farris-form-inline mr-5 my-2\">\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">{{'component.activityExecutor.nodeName'|wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <div #inputGroup class=\"input-group\">\r\n                    <input type=\"text\" class=\"form-control\" [value]=\"activityExecutors | activityExecutor \" name=\"users\" [readOnly]=\"true\" />\r\n                    <div class=\"input-group-append\">\r\n                      <span [style.display]=\"showClearButton ? '' : 'none'\" class=\"input-group-text input-group-clear\"\r\n                            (click)=\"clear($event)\">\r\n                        <i class=\"f-icon modal_close\"></i>\r\n                      </span>\r\n                      <span class=\"input-group-text\" (click)=\"selectUsers($event)\" style=\"background: #FFF;\">\r\n                        <i class=\"f-icon f-icon-lookup\"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex flex-column\">\r\n        <div class=\"farris-form form-inline farris-form-inline mr-5\">\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'component.activityExecutor.enablingConditions'|wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <div class=\"input-group\">\r\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"condition\" name=\"conditon\" [readOnly]=\"true\" />\r\n                    <div class=\"input-group-append\">\r\n                      <span class=\"input-group-text\" (click)=\"editConditon()\" style=\"background: #FFF;\">\r\n                        <i class=\"f-icon f-icon-lookup\"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n</div>\r\n\r\n<farris-dialog #allActivityDialog [buttons]=\"buttonRef\" [width]=\"700\" [height]=\"520\" title=\"{{'component.activityExecutor.activityList'|wfLocale}}\">\r\n  <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2\">\r\n    <farris-datagrid #allActivityTable [columns]=\"cols\" [data]=\"designerUIState.userActList\"  [idField]=\"'Id'\" [fit]=\"true\"\r\n                     [fitColumns]=\"true\" [pagination]='false' [multiSelect]=\"true\" [showCheckbox]=\"true\"\r\n                     [checkOnSelect]=\"true\" [selectOnCheck]=\"true\">\r\n    </farris-datagrid>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-default\" (click)=\"allActivityDialog.close()\">{{'component.activityExecutor.clickCancel'|wfLocale}}</button>\r\n  <button class=\"btn btn-sm btn-primary mx-2\" (click)=\"activitiesSelect()\">{{'component.activityExecutor.clickOK'|wfLocale}}</button>\r\n</ng-template>\r\n",
                    providers: [
                        WfLocalePipe,
                    ],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ActivityExecutorPerformerComponent.ctorParameters = function () { return [
        { type: NgZone },
        { type: ProcessDesignerUIState },
        { type: ExpressionService },
        { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
        { type: WfLocalePipe, decorators: [{ type: Optional }] }
    ]; };
    ActivityExecutorPerformerComponent.propDecorators = {
        cls: [{ type: HostBinding, args: ['class',] }],
        inputGroup: [{ type: ViewChild, args: ['inputGroup',] }],
        allActivityDialog: [{ type: ViewChild, args: ['allActivityDialog',] }],
        allActivityTable: [{ type: ViewChild, args: ['allActivityTable',] }]
    };
    return ActivityExecutorPerformerComponent;
}());
export { ActivityExecutorPerformerComponent };
if (false) {
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.cls;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.showClearButton;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.activityExecutors;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.condition;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.cols;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.inputGroup;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.allActivityDialog;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.allActivityTable;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.ngZone;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aXZpdHktZXhlY3V0b3ItcGVyZm9ybWVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvcGVyZm9ybWVyL3ZpZXdzL2FjdGl2aXR5LWV4ZWN1dG9yLXBlcmZvcm1lci9hY3Rpdml0eS1leGVjdXRvci1wZXJmb3JtZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDNUksT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBQyxZQUFZLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDbEYsT0FBTyxFQUFDLHNCQUFzQixFQUFDLE1BQU0sMENBQTBDLENBQUM7QUFDaEYsT0FBTyxFQUFDLDJCQUEyQixFQUFDLE1BQU0sMENBQTBDLENBQUM7QUFDckYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBR3RHO0lBdUJFLDRDQUNVLE1BQWMsRUFDZixlQUF1QyxFQUN0QyxJQUF1QixFQUNYLEdBQXNCLEVBQ2YsUUFBZ0IsRUFDUixTQUFjLEVBQzdCLFVBQXdCO1FBTnBDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZixvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDdEMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDWCxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUNmLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDUixjQUFTLEdB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a0RBR0U7O0lBRUYsd0RBQWdEOztJQUNoRCwrREFBbUU7O0lBQ25FLDhEQUFtRTs7Ozs7SUFHakUsb0RBQXNCOztJQUN0Qiw2REFBOEM7Ozs7O0lBQzlDLGtEQUErQjs7Ozs7SUFDL0IsaURBQTBDOzs7OztJQUMxQyxzREFBMkM7Ozs7O0lBQzNDLHVEQUFpRDs7Ozs7SUFDakQsd0RBQTRDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdCwgTmdab25lLCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIEhvc3RCaW5kaW5nLCBDaGFuZ2VEZXRlY3RvclJlZiwgT3B0aW9uYWwsIEluamVjdCwgTE9DQUxFX0lEfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtEaWFsb2dDb21wb25lbnR9IGZyb20gXCJAZmFycmlzL3VpLWRpYWxvZ1wiO1xyXG5pbXBvcnQge0RhdGFncmlkQ29tcG9uZW50fSBmcm9tIFwiQGZhcnJpcy91aS1kYXRhZ3JpZFwiO1xyXG5pbXBvcnQge0V4cHJFZGl0TW9kZSwgRXhwcmVzc2lvblNlcnZpY2UsIEluamVjdGVkVHlwZX0gZnJvbSBcIkBnc3Atc3ZjL2V4cHJlc3Npb25cIjtcclxuaW1wb3J0IHtQcm9jZXNzRGVzaWduZXJVSVN0YXRlfSBmcm9tIFwiLi4vLi4vLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZVwiO1xyXG5pbXBvcnQge0FjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudH0gZnJvbSBcIi4vZW50aXRpZXMvYWN0aXZpdHktZXhlY3V0b3IucGFydGljaXBhbnRcIjtcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1hY3Rpdml0eS1oYW5kbGVyLXBlcmZvcm1lcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2FjdGl2aXR5LWV4ZWN1dG9yLXBlcmZvcm1lci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYWN0aXZpdHktZXhlY3V0b3ItcGVyZm9ybWVyLmNvbXBvbmVudC5jc3MnXSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgICBXZkxvY2FsZVBpcGUsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQWN0aXZpdHlFeGVjdXRvclBlcmZvcm1lckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXHJcbiAgY2xzID0gJ2QtZmxleCBmbGV4LWZpbGwgaC0xMDAnO1xyXG4gIHNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gIGFjdGl2aXR5RXhlY3V0b3JzOiBBY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnRbXSA9IFtdO1xyXG4gIGNvbmRpdGlvbjogc3RyaW5nO1xyXG4gIGNvbHMgPSBbXHJcbiAgICB7IHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYWN0aXZpdHlFeGVjdXRvci5uYW1lJyksIGZpZWxkOiAnTmFtZScsIHdpZHRoOiA2MCB9LFxyXG4gICAgeyB0aXRsZTogJ0lEJywgZmllbGQ6ICdJZCcsIHdpZHRoOiA5MCB9XHJcbiAgXTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnaW5wdXRHcm91cCcpIGlucHV0R3JvdXA6IEVsZW1lbnRSZWY7XHJcbiAgQFZpZXdDaGlsZCgnYWxsQWN0aXZpdHlEaWFsb2cnKSBhbGxBY3Rpdml0eURpYWxvZzogRGlhbG9nQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2FsbEFjdGl2aXR5VGFibGUnKSBhbGxBY3Rpdml0eVRhYmxlOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxyXG4gICAgcHVibGljIGRlc2lnbmVyVUlTdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSxcclxuICAgIHByaXZhdGUgZXhwcjogRXhwcmVzc2lvblNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQEluamVjdChXRl9MQU5HX1JFU09VUkNFUykgcHJpdmF0ZSByZXNvdXJjZXM6IGFueSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbG9jYWxlUGlwZTogV2ZMb2NhbGVQaXBlLFxyXG4gICkge1xyXG4gICAgdGhpcy5sb2NhbGVQaXBlID0gdGhpcy5sb2NhbGVQaXBlIHx8IG5ldyBXZkxvY2FsZVBpcGUobG9jYWxlSWQsIHJlc291cmNlcyk7XHJcbiAgIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XHJcbiAgICAgIHRoaXMuaW5wdXRHcm91cC5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgJ21vdXNlZW50ZXInLFxyXG4gICAgICAgIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcylcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5pbnB1dEdyb3VwLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICAnbW91c2VsZWF2ZScsXHJcbiAgICAgICAgdGhpcy5vbk1vdXNlTGVhdmUuYmluZCh0aGlzKVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlRW50ZXIoZXZlbnQpIHtcclxuICAgIHRoaXMuc2hvd0NsZWFyQnV0dG9uID0gdHJ1ZTtcclxuICAgIGlmICh0aGlzLnNob3dDbGVhckJ1dHRvbikge1xyXG4gICAgICB0aGlzLnRvZ2dsZUNsZWFySWNvbihldmVudCwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG9uTW91c2VMZWF2ZShldmVudCkge1xyXG4gICAgdGhpcy5zaG93Q2xlYXJCdXR0b24gPSBmYWxzZTtcclxuICAgIHRoaXMudG9nZ2xlQ2xlYXJJY29uKGV2ZW50LCBmYWxzZSk7XHJcbiAgfVxyXG4gIHByaXZhdGUgdG9nZ2xlQ2xlYXJJY29uKGV2ZW50OiBhbnksIGlzU2hvdyA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBzdHIgPSBpc1Nob3cgPyAnJyA6ICdub25lJztcclxuICAgIGNvbnN0IGNsZWFySWNvbiA9IGV2ZW50LnRhcmdldC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZ3JvdXAtY2xlYXInKTtcclxuICAgIGlmIChjbGVhckljb24pIHtcclxuICAgICAgY2xlYXJJY29uLnN0eWxlLmRpc3BsYXkgPSBzdHI7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGNsZWFyKGRhdGE6IGFueSkge1xyXG4gICAgdGhpcy5hY3Rpdml0eUV4ZWN1dG9ycyA9IFtdO1xyXG4gIH1cclxuICBzZWxlY3RVc2VycyhkYXRhOiBhbnkpIHtcclxuICAgIC8vIOW3suWKnueUqOaIt1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRVc2VyID0gW107XHJcbiAgICBpZih0aGlzLmFjdGl2aXR5RXhlY3V0b3JzICYmIHRoaXMuYWN0aXZpdHlFeGVjdXRvcnMubGVuZ3RoID4gMCl7XHJcbiAgICAgIGZvcihjb25zdCBoYW5kbGVyIG9mIHRoaXMuYWN0aXZpdHlFeGVjdXRvcnMpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICBJZDogaGFuZGxlci5hY3Rpdml0eURlZklkLFxyXG4gICAgICAgICAgICBOYW1lOiBoYW5kbGVyLmFjdGl2aXR5RGVmTmFtZVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGlkOiBoYW5kbGVyLmFjdGl2aXR5RGVmSWRcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZWN0ZWRVc2VyLnB1c2goZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuYWxsQWN0aXZpdHlUYWJsZS5zZXRDdXJyZW50UGFnZXJEYXRhKHNlbGVjdGVkVXNlcik7XHJcbiAgICB0aGlzLmFsbEFjdGl2aXR5RGlhbG9nLnNob3coKTtcclxuICB9XHJcbiAgZWRpdENvbmRpdG9uKCkge1xyXG4gICAgLy8gdGhpcy5leHByLmNsZWFyQ29udGV4dCgpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcyAmJiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBsZXQgY29udGV4dCA9IG5ldyBBcnJheSgpO1xyXG4gICAgY29udGV4dCA9IHRoaXMuZGVzaWduZXJVSVN0YXRlLmFkZENvbnRleHQoY29udGV4dCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc3ViQWN0aXZpdHlDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLmFjdGl2aXR5Q29tcG9uZW50Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2IG9mIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLnNldEVkaXRQYXR0ZXJuKEV4cHJFZGl0TW9kZS5Db25kaXRpb25hbCk7IC8vIOihqOi+vuW8j+WxleeOsOaooeW8j++8mum7mOiupOeugOaYk+eJiFxyXG4gICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KHRoaXMuY29uZGl0aW9uKTtcclxuICAgIHRoaXMuZXhwci5idWlsZEV4cHJlc3Npb24oKS50aGVuKChleHByZXNzaW9uaW5mbzogc3RyaW5nKSA9PiB7XHJcbiAgICAgIHRoaXMuY29uZGl0aW9uID0gZXhwcmVzc2lvbmluZm87XHJcbiAgICAgIC8v54K55Ye756Gu5a6a5ZCO77yM5Y676Zmk6KGo6L6+5byP6YeM6Z2i55qE5paw5aKe55qE5LiK5LiL5paH5Y+Y6YePXHJcbiAgICAgIGlmKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMuZXhwci5leHByRW50aXR5LmNvbnRleHRFbnRpdGllcyA9IHRoaXMuZXhwci5leHByRW50aXR5LmNvbnRleHRFbnRpdGllcy5maWx0ZXIoeCA9PiAhY29udGV4dC5zb21lKHkgPT4geS5rZXkgPT09IHgua2V5KSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWN0aXZpdGllc1NlbGVjdCgpIHtcclxuICAgIGNvbnN0IHNlbGVjdGVkQWN0aXZpdGllcyA9IHRoaXMuYWxsQWN0aXZpdHlUYWJsZS5jaGVja2VkcztcclxuICAgIHRoaXMuYWN0aXZpdHlFeGVjdXRvcnMgPSBzZWxlY3RlZEFjdGl2aXRpZXMubWFwKGFjdGl2aXR5ID0+IHtcclxuICAgICAgY29uc3QgaGFuZGxlciA9IG5ldyBBY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnQoYWN0aXZpdHkuZGF0YS5JZCwgYWN0aXZpdHkuZGF0YS5OYW1lLCAnd2YuQWN0aXZpdHlFeGVjdXRvclBhcnRpY2lwYW50RXhwcmVzc2lvbicpO1xyXG4gICAgICBoYW5kbGVyLnBlcmZvcm1lck5hbWUgPSAnPCcgKyBhY3Rpdml0eS5kYXRhLk5hbWUgKyB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYWN0aXZpdHlFeGVjdXRvci5ldmVudEhhbmRsZXInKTtcclxuICAgICAgaGFuZGxlci5hY3Rpdml0eURlZklkID0gYWN0aXZpdHkuZGF0YS5JZDtcclxuICAgICAgaGFuZGxlci5hY3Rpdml0eURlZk5hbWUgPSBhY3Rpdml0eS5kYXRhLk5hbWU7XHJcbiAgICAgIGhhbmRsZXIuY29uZGl0aW9uID0gdGhpcy5jb25kaXRpb247XHJcbiAgICAgIHJldHVybiBoYW5kbGVyO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmFsbEFjdGl2aXR5RGlhbG9nLmNsb3NlKCk7XHJcbiAgfVxyXG4gIGdldFBlcmZvcm1lcnMoKSB7XHJcbiAgICB0aGlzLmFjdGl2aXR5RXhlY3V0b3JzLm1hcCh4ID0+IHguY29uZGl0aW9uID0gdGhpcy5jb25kaXRpb24pO1xyXG4gICAgcmV0dXJuIHRoaXMuYWN0aXZpdHlFeGVjdXRvcnM7XHJcbiAgfVxyXG59XHJcbiJdfQ==
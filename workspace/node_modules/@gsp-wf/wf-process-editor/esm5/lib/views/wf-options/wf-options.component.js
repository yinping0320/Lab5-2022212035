/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ComponentFactoryResolver, EventEmitter, Inject, Injector, Input, LOCALE_ID, Optional, Output, TemplateRef, ViewChild } from '@angular/core';
import { HttpService } from '@ecp-caf/caf-common';
import { FarrisRadioGroupComponent } from '@farris/ui-forms';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { NotifyService } from '@farris/ui-notify';
import { ExpressionService } from '@gsp-svc/expression';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { ProcessDeUtil } from '../../domain/process-de-util';
import { SubProcessType } from '../call-activity-sub-process/SubProcessType';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
var WfOptionsComponent = /** @class */ (function () {
    function WfOptionsComponent(notify, modalService, message, util, http, designerState, expr, cfr, inj, cdr, localeId, resources, localePipe) {
        this.notify = notify;
        this.modalService = modalService;
        this.message = message;
        this.util = util;
        this.http = http;
        this.designerState = designerState;
        this.expr = expr;
        this.cfr = cfr;
        this.inj = inj;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.editorParams = {};
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.modalConfig = {
            title: this.localePipe.transform("component.optins.wfOptions"),
            width: 500,
            height: 240,
            showButtons: true
        };
        this.subProcessType = SubProcessType;
        this.radioGroupProcessTypeData = [
            { value: "Specified", name: this.localePipe.transform("component.optins.specified") },
            { value: "Dynamic", name: this.localePipe.transform("component.optins.dynamic") },
        ];
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    Object.defineProperty(WfOptionsComponent.prototype, "value", {
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            if (v) {
                this.entity = v;
                // 为子流程类型赋值
                if (this.entity.calledElement == null || this.entity.calledElement == "") {
                    if (this.entity.calledBizDefKey == null || this.entity.calledBizDefKey == "") {
                        this.entity.subProcessType = SubProcessType.Specified;
                    }
                    else {
                        this.entity.subProcessType = SubProcessType.Dynamic;
                    }
                }
                else {
                    this.entity.subProcessType = SubProcessType.Specified;
                }
                this.getProcessDefKey(this.entity.calledElement);
                this.getFlowForm(this.entity.calledBizDefKey);
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    WfOptionsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    WfOptionsComponent.prototype.clickOk = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var obj = { value: this.entity, parameters: null };
        this.submitModal.emit(obj);
    };
    /**
     * @return {?}
     */
    WfOptionsComponent.prototype.clickCancel = /**
     * @return {?}
     */
    function () {
        this.closeModal.emit();
    };
    /**
     * @param {?} val
     * @return {?}
     */
    WfOptionsComponent.prototype.processTypeChange = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        console.log(val);
        if (val == SubProcessType.Specified) {
            this.entity.calledBizDefKey = null;
            this.entity.calledBizDefName = null;
        }
        else if (val == SubProcessType.Dynamic) {
            this.entity.calledElement = null;
            this.entity.calledElementName = null;
        }
    };
    /**
     * @param {?} args
     * @return {?}
     */
    WfOptionsComponent.prototype.processConfirm = /**
     * @param {?} args
     * @return {?}
     */
    function (args) {
        if (args) {
            this.entity.calledElement = args.procDefKey;
            this.entity.calledElementName = args.name;
        }
    };
    /**
     * @param {?} args
     * @return {?}
     */
    WfOptionsComponent.prototype.clearProcessDef = /**
     * @param {?} args
     * @return {?}
     */
    function (args) {
        this.entity.calledElement = '';
        this.entity.calledElementName = '';
    };
    /**
     * @param {?} args
     * @return {?}
     */
    WfOptionsComponent.prototype.flowFormConfirm = /**
     * @param {?} args
     * @return {?}
     */
    function (args) {
        if (args) {
            this.entity.calledBizDefKey = args.id;
            this.entity.calledBizDefName = args.name;
        }
    };
    /**
     * @param {?} args
     * @return {?}
     */
    WfOptionsComponent.prototype.clearFlowForm = /**
     * @param {?} args
     * @return {?}
     */
    function (args) {
        this.entity.calledBizDefKey = '';
        this.entity.calledBizDefName = '';
    };
    /**
     * @param {?} key
     * @return {?}
     */
    WfOptionsComponent.prototype.getProcessDefKey = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        /** @type {?} */
        var url = this.util.getProcessDefinitionWebApi();
        if (key) {
            url += "/procDefKey/" + key;
            this.http.get(url).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                _this.entity.calledElementName = re.name;
            }));
        }
    };
    /**
     * @param {?} id
     * @return {?}
     */
    WfOptionsComponent.prototype.getFlowForm = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var url = this.util.getFlowFormWebApi();
        if (id) {
            url += "/" + id;
            this.http.get(url).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                _this.entity.calledBizDefName = re.name;
            }));
        }
    };
    WfOptionsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-wf-options',
                    template: "<div class=\"f-page f-page-card f-page-is-mainsubcard\" id=\"bif-manager-list\">\r\n  <div class=\"f-page-main\" id=\"page-main\" style=\"overflow-y: auto;\">\r\n    <div class=\"f-form-layout farris-form farris-form-controls-inline\">\r\n      <div class=\"col-12\">\r\n        <div class=\"farris-group-wrap\">\r\n          <div class=\"form-group farris-form-group\">\r\n            <label class=\"col-form-label\" title=\"{{'component.optins.subProcessType' | wfLocale}}\" for=\"processType\">\r\n              <span class=\"farris-label-text\">{{'component.optins.processType' | wfLocale}}</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap\">\r\n              <farris-radiogroup #radioGroupProcessType [(ngModel)]=\"entity&&entity.subProcessType\" [horizontal]=\"false\"\r\n                [data]=\"radioGroupProcessTypeData\" (changeValue)=\"processTypeChange($event)\">\r\n              </farris-radiogroup>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-12\" *ngIf=\"entity&&entity.subProcessType&&entity.subProcessType==subProcessType.Dynamic\">\r\n        <div class=\"farris-group-wrap\">\r\n          <div class=\"form-group farris-form-group\">\r\n            <label class=\"col-form-label\" title=\"{{'component.optins.bizDef' | wfLocale}}\" for=\"calledBizDefKey\">\r\n              <span class=\"farris-label-text\">{{'component.optins.bizDef' | wfLocale}}</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap\">\r\n              <wf-bizprocess-lookup title=\"{{'component.optins.bizDef' | wfLocale}}\" [sourceType]=\"'flowform'\" [displayTxt]=\"entity.calledBizDefName\"\r\n                (afterConfirm)=\"flowFormConfirm($event)\" (clear)=\"clearFlowForm($event)\">\r\n              </wf-bizprocess-lookup>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-12\" *ngIf=\"entity&&entity.subProcessType&&entity.subProcessType==subProcessType.Specified\">\r\n        <div class=\"farris-group-wrap\">\r\n          <div class=\"form-group farris-form-group\">\r\n            <label class=\"col-form-label\" title=\"{{'component.optins.procDef' | wfLocale}}\" for=\"calledElement\">\r\n              <span class=\"farris-label-text\">{{'component.optins.procDef' | wfLocale}}</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap\">\r\n              <wf-bizprocess-lookup title=\"{{'component.optins.procDef' | wfLocale}}\" [displayTxt]=\"entity.calledElementName\"\r\n                (afterConfirm)=\"processConfirm($event)\" (clear)=\"clearProcessDef($event)\">\r\n              </wf-bizprocess-lookup>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3 mx-2\" (click)=\"clickCancel()\">{{'component.optins.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOk()\">{{'component.optins.clickOk' | wfLocale}}</button>\r\n</ng-template>\r\n",
                    providers: [
                        WfLocalePipe,
                    ]
                }] }
    ];
    /** @nocollapse */
    WfOptionsComponent.ctorParameters = function () { return [
        { type: NotifyService },
        { type: BsModalService },
        { type: MessagerService },
        { type: ProcessDeUtil },
        { type: HttpService },
        { type: ProcessDesignerUIState },
        { type: ExpressionService },
        { type: ComponentFactoryResolver },
        { type: Injector },
        { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
        { type: WfLocalePipe, decorators: [{ type: Optional }] }
    ]; };
    WfOptionsComponent.propDecorators = {
        editorParams: [{ type: Input }],
        value: [{ type: Input }],
        closeModal: [{ type: Output }],
        submitModal: [{ type: Output }],
        modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
        radioGroupProcessType: [{ type: ViewChild, args: ["radioGroupProcessType",] }]
    };
    return WfOptionsComponent;
}());
export { WfOptionsComponent };
if (false) {
    /** @type {?} */
    WfOptionsComponent.prototype.editorParams;
    /** @type {?} */
    WfOptionsComponent.prototype.closeModal;
    /** @type {?} */
    WfOptionsComponent.prototype.submitModal;
    /** @type {?} */
    WfOptionsComponent.prototype.modalFooter;
    /** @type {?} */
    WfOptionsComponent.prototype.modalConfig;
    /** @type {?} */
    WfOptionsComponent.prototype.subProcessType;
    /** @type {?} */
    WfOptionsComponent.prototype.entity;
    /** @type {?} */
    WfOptionsComponent.prototype.radioGroupProcessType;
    /** @type {?} */
    WfOptionsComponent.prototype.radioGroupProcessTypeData;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.util;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.designerState;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.inj;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    WfOptionsComponent.prototype.localePipe;
}
var WfOptionsConverter = /** @class */ (function () {
    function WfOptionsConverter(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    WfOptionsConverter.prototype.convertTo = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (data && (data.calledBizDefKey || data.calledElement)) {
            return this.localePipe.transform("component.optins.set");
        }
        return this.localePipe.transform("component.optins.notSet");
    };
    return WfOptionsConverter;
}());
export { WfOptionsConverter };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WfOptionsConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Ytb3B0aW9ucy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL3dmLW9wdGlvbnMvd2Ytb3B0aW9ucy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0wsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRWxELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDN0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBV2hHO0lBcURFLDRCQUNVLE1BQXFCLEVBQ3JCLFlBQTRCLEVBQzVCLE9BQXdCLEVBQ3hCLElBQW1CLEVBQ25CLElBQWlCLEVBQ2pCLGFBQXFDLEVBQ3JDLElBQXVCLEVBQ3ZCLEdBQTZCLEVBQzdCLEdBQWEs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QUMsc0JBQXNCLENBQUMsQ0FBQztTQUMxRDtRQUNELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQ0gseUJBQUM7QUFBRCxDQUFDLEFBWEQsSUFXQzs7Ozs7OztJQVRHLHdDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIEluamVjdG9yLCBJbnB1dCwgTE9DQUxFX0lELCBPbkluaXQsIE9wdGlvbmFsLCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgVHlwZUNvbnZlcnRlciB9IGZyb20gJ0BmYXJyaXMvaWRlLXByb3BlcnR5LXBhbmVsJztcclxuaW1wb3J0IHsgRmFycmlzUmFkaW9Hcm91cENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZm9ybXMnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgRXhwcmVzc2lvblNlcnZpY2UgfSBmcm9tICdAZ3NwLXN2Yy9leHByZXNzaW9uJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVVdGlsIH0gZnJvbSAnLi4vLi4vZG9tYWluL3Byb2Nlc3MtZGUtdXRpbCc7XHJcbmltcG9ydCB7IFN1YlByb2Nlc3NUeXBlIH0gZnJvbSAnLi4vY2FsbC1hY3Rpdml0eS1zdWItcHJvY2Vzcy9TdWJQcm9jZXNzVHlwZSc7XHJcbmltcG9ydCB7IFdGX0xBTkdfUkVTT1VSQ0VTLCBXZkxvY2FsZVBpcGUgfSBmcm9tICcuLi8uLi9pMThuL3BpcGUvd2YtcHJvY2Vzcy1lZGl0b3ItbG9jYWxlLnBpcGUnO1xyXG5pbXBvcnQgeyBXRl9QUk9DRVNTX0VESVRPUl9MQU5HX1JFU09VUkNFUyB9IGZyb20gJy4uLy4uL2kxOG4vYXNzZXRzL2xhbmcucmVzb3VyY2UnO1xyXG5cclxudHlwZSBXZk9wdGlucyA9IHtcclxuICBzdWJQcm9jZXNzVHlwZT86IFN1YlByb2Nlc3NUeXBlO1xyXG4gIGNhbGxlZEVsZW1lbnQ/OiBzdHJpbmc7XHJcbiAgY2FsbGVkQml6RGVmS2V5Pzogc3RyaW5nO1xyXG4gIGNhbGxlZEVsZW1lbnROYW1lPzogc3RyaW5nO1xyXG4gIGNhbGxlZEJpekRlZk5hbWU/OiBzdHJpbmc7XHJcbn07XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi13Zi1vcHRpb25zJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vd2Ytb3B0aW9ucy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbXSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgICBXZkxvY2FsZVBpcGUsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgV2ZPcHRpb25zQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IHtcclxuICAgIGJpelR5cGVJZD86IHN0cmluZ1xyXG4gIH0gPSB7fTtcclxuXHJcbiAgQElucHV0KCkgc2V0IHZhbHVlKHY6IFdmT3B0aW5zKSB7XHJcbiAgICBpZiAodikge1xyXG4gICAgICB0aGlzLmVudGl0eSA9IHY7XHJcbiAgICAgIC8vIOS4uuWtkOa1geeoi+exu+Wei+i1i+WAvFxyXG4gICAgICBpZiAodGhpcy5lbnRpdHkuY2FsbGVkRWxlbWVudCA9PSBudWxsIHx8IHRoaXMuZW50aXR5LmNhbGxlZEVsZW1lbnQgPT0gXCJcIikge1xyXG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5jYWxsZWRCaXpEZWZLZXkgPT0gbnVsbCB8fCB0aGlzLmVudGl0eS5jYWxsZWRCaXpEZWZLZXkgPT0gXCJcIikge1xyXG4gICAgICAgICAgdGhpcy5lbnRpdHkuc3ViUHJvY2Vzc1R5cGUgPSBTdWJQcm9jZXNzVHlwZS5TcGVjaWZpZWQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuZW50aXR5LnN1YlByb2Nlc3NUeXBlID0gU3ViUHJvY2Vzc1R5cGUuRHluYW1pYztcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5lbnRpdHkuc3ViUHJvY2Vzc1R5cGUgPSBTdWJQcm9jZXNzVHlwZS5TcGVjaWZpZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuZ2V0UHJvY2Vzc0RlZktleSh0aGlzLmVudGl0eS5jYWxsZWRFbGVtZW50KTtcclxuICAgICAgdGhpcy5nZXRGbG93Rm9ybSh0aGlzLmVudGl0eS5jYWxsZWRCaXpEZWZLZXkpO1xyXG4gICAgfVxyXG4gIH1cclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgbW9kYWxDb25maWcgPSB7XHJcbiAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5vcHRpbnMud2ZPcHRpb25zXCIpLFxyXG4gICAgd2lkdGg6IDUwMCxcclxuICAgIGhlaWdodDogMjQwLFxyXG4gICAgc2hvd0J1dHRvbnM6IHRydWVcclxuICB9O1xyXG5cclxuICByZWFkb25seSBzdWJQcm9jZXNzVHlwZSA9IFN1YlByb2Nlc3NUeXBlO1xyXG5cclxuICBlbnRpdHk6IFdmT3B0aW5zO1xyXG5cclxuICBAVmlld0NoaWxkKFwicmFkaW9Hcm91cFByb2Nlc3NUeXBlXCIpXHJcbiAgcmFkaW9Hcm91cFByb2Nlc3NUeXBlOiBGYXJyaXNSYWRpb0dyb3VwQ29tcG9uZW50O1xyXG4gIHJhZGlvR3JvdXBQcm9jZXNzVHlwZURhdGEgPSBbXHJcbiAgICB7IHZhbHVlOiBcIlNwZWNpZmllZFwiLCBuYW1lOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50Lm9wdGlucy5zcGVjaWZpZWRcIikgfSxcclxuICAgIHsgdmFsdWU6IFwiRHluYW1pY1wiLCBuYW1lOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50Lm9wdGlucy5keW5hbWljXCIpIH0sXHJcbiAgXTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB1dGlsOiBQcm9jZXNzRGVVdGlsLFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSxcclxuICAgIHByaXZhdGUgZGVzaWduZXJTdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSxcclxuICAgIHByaXZhdGUgZXhwcjogRXhwcmVzc2lvblNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBpbmo6IEluamVjdG9yLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPaygpIHtcclxuICAgIGNvbnN0IG9iaiA9IHsgdmFsdWU6IHRoaXMuZW50aXR5LCBwYXJhbWV0ZXJzOiBudWxsIH07XHJcbiAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqKTtcclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHByb2Nlc3NUeXBlQ2hhbmdlKHZhbCkge1xyXG4gICAgY29uc29sZS5sb2codmFsKTtcclxuICAgIGlmICh2YWwgPT0gU3ViUHJvY2Vzc1R5cGUuU3BlY2lmaWVkKSB7XHJcbiAgICAgIHRoaXMuZW50aXR5LmNhbGxlZEJpekRlZktleSA9IG51bGw7XHJcbiAgICAgIHRoaXMuZW50aXR5LmNhbGxlZEJpekRlZk5hbWUgPSBudWxsO1xyXG4gICAgfSBlbHNlIGlmICh2YWwgPT0gU3ViUHJvY2Vzc1R5cGUuRHluYW1pYykge1xyXG4gICAgICB0aGlzLmVudGl0eS5jYWxsZWRFbGVtZW50ID0gbnVsbDtcclxuICAgICAgdGhpcy5lbnRpdHkuY2FsbGVkRWxlbWVudE5hbWUgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIHByb2Nlc3NDb25maXJtKGFyZ3M6IGFueSkge1xyXG4gICAgaWYgKGFyZ3MpIHtcclxuICAgICAgdGhpcy5lbnRpdHkuY2FsbGVkRWxlbWVudCA9IGFyZ3MucHJvY0RlZktleTtcclxuICAgICAgdGhpcy5lbnRpdHkuY2FsbGVkRWxlbWVudE5hbWUgPSBhcmdzLm5hbWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGVhclByb2Nlc3NEZWYoYXJnczogYW55KSB7XHJcbiAgICB0aGlzLmVudGl0eS5jYWxsZWRFbGVtZW50ID0gJyc7XHJcbiAgICB0aGlzLmVudGl0eS5jYWxsZWRFbGVtZW50TmFtZSA9ICcnO1xyXG4gIH1cclxuXHJcbiAgZmxvd0Zvcm1Db25maXJtKGFyZ3M6IGFueSkge1xyXG4gICAgaWYgKGFyZ3MpIHtcclxuICAgICAgdGhpcy5lbnRpdHkuY2FsbGVkQml6RGVmS2V5ID0gYXJncy5pZDtcclxuICAgICAgdGhpcy5lbnRpdHkuY2FsbGVkQml6RGVmTmFtZSA9IGFyZ3MubmFtZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsZWFyRmxvd0Zvcm0oYXJnczogYW55KSB7XHJcbiAgICB0aGlzLmVudGl0eS5jYWxsZWRCaXpEZWZLZXkgPSAnJztcclxuICAgIHRoaXMuZW50aXR5LmNhbGxlZEJpekRlZk5hbWUgPSAnJztcclxuICB9XHJcblxyXG4gIGdldFByb2Nlc3NEZWZLZXkoa2V5OiBzdHJpbmcpIHtcclxuICAgIGxldCB1cmwgPSB0aGlzLnV0aWwuZ2V0UHJvY2Vzc0RlZmluaXRpb25XZWJBcGkoKTtcclxuICAgIGlmIChrZXkpIHtcclxuICAgICAgdXJsICs9IGAvcHJvY0RlZktleS8ke2tleX1gO1xyXG4gICAgICB0aGlzLmh0dHAuZ2V0KHVybCkuc3Vic2NyaWJlKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgdGhpcy5lbnRpdHkuY2FsbGVkRWxlbWVudE5hbWUgPSByZS5uYW1lO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldEZsb3dGb3JtKGlkOiBzdHJpbmcpIHtcclxuICAgIGxldCB1cmwgPSB0aGlzLnV0aWwuZ2V0Rmxvd0Zvcm1XZWJBcGkoKTtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICB1cmwgKz0gYC8ke2lkfWA7XHJcbiAgICAgIHRoaXMuaHR0cC5nZXQodXJsKS5zdWJzY3JpYmUoKHJlOiBhbnkpID0+IHtcclxuICAgICAgICB0aGlzLmVudGl0eS5jYWxsZWRCaXpEZWZOYW1lID0gcmUubmFtZTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFdmT3B0aW9uc0NvbnZlcnRlciBpbXBsZW1lbnRzIFR5cGVDb252ZXJ0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGVcclxuICApIHsgfVxyXG5cclxuICBjb252ZXJ0VG8oZGF0YTogYW55KTogc3RyaW5nIHtcclxuICAgIGlmIChkYXRhICYmIChkYXRhLmNhbGxlZEJpekRlZktleSB8fCBkYXRhLmNhbGxlZEVsZW1lbnQpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50Lm9wdGlucy5zZXRcIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5vcHRpbnMubm90U2V0XCIpO1xyXG4gIH1cclxufVxyXG4iXX0=
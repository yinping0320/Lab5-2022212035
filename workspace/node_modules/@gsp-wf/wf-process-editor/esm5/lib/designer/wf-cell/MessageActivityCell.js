/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { BpmnModelHelper, FlowNodeState } from "@edp-pmf/bpmn-model";
import { MessageActivity, MessageNotice, Component, ActivityExecutorParticipantExpression, UserParticipantExpression, PositionParticipantExpression, VariableSetting, ActualParameter, SmsMessageTemplate, SmsMessageVariable, } from "@gsp-wf/wf-process-model";
import { PropertyHelper } from "./PropertyHelper";
import { WfConstants } from "../WfConstants";
import { MessageActivityPropertyKeys } from "./property-keys/MessageActivityPropertyKeys";
/**
 * 消息活动节点
 */
var MessageActivityCell = /** @class */ (function (_super) {
    tslib_1.__extends(MessageActivityCell, _super);
    function MessageActivityCell(value, geometry, style) {
        var _a;
        var _this = _super.call(this, value, geometry, style) || this;
        _this.clrTypeId = MessageActivityCell.CLR_TYPE_ID;
        _this.name = "消息";
        _this.nameLanguage = {
            "zh-CHS": "消息",
            "zh-CHT": "消息",
            "en": "Message",
        };
        _this.imgUrls = (_a = {},
            _a[FlowNodeState.Default] = WfConstants.IMAGE_PATH + "/message.png",
            _a[FlowNodeState.Selected] = WfConstants.IMAGE_PATH + "/message_select.svg",
            _a);
        return _this;
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    MessageActivityCell.prototype.createFlowElement = /**
     * @param {?=} flowElt
     * @return {?}
     */
    function (flowElt) {
        /** @type {?} */
        var flowNode = (/** @type {?} */ (_super.prototype.createFlowElement.call(this, flowElt)));
        flowNode.Id = "MessageActivity" + BpmnModelHelper.GenerateElementId();
        return flowNode;
    };
    /**
     * @return {?}
     */
    MessageActivityCell.prototype.getFarrisPropConfig = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var act = this.flowElement;
        /** @type {?} */
        var basicProperty = new ElementPropertyConfig();
        /** @type {?} */
        var activityProperty = new ElementPropertyConfig();
        /** @type {?} */
        var propertyData = {};
        basicProperty.categoryId = 'basicProperty';
        basicProperty.categoryName = mxResources.get('basicInformation');
        basicProperty.tabId = 'basic';
        basicProperty.tabName = mxResources.get('basicAttributes');
        basicProperty.properties = [
            { propertyID: MessageActivityPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: MessageActivityPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: MessageActivityPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        activityProperty.categoryId = 'activityProperty';
        activityProperty.categoryName = mxResources.get('activityProperty');
        activityProperty.tabId = 'basic';
        activityProperty.tabName = mxResources.get('basicAttributes');
        activityProperty.properties = [
            { propertyID: MessageActivityPropertyKeys.messageNotice, propertyName: mxResources.get('messageNotice'), propertyType: 'modal' },
            { propertyID: MessageActivityPropertyKeys.variableSettings, propertyName: mxResources.get('variableSettings'), propertyType: 'modal' }
        ];
        propertyData[MessageActivityPropertyKeys.Id] = act.Id;
        propertyData[MessageActivityPropertyKeys.ClrTypeID] = act.ClrTypeID;
        propertyData[MessageActivityPropertyKeys.Name] = act.Name;
        propertyData[MessageActivityPropertyKeys.NameLanguage] = act.NameLanguage || {
            "zh-CHS": act.Name,
        };
        propertyData[MessageActivityPropertyKeys.messageNotice] = PropertyHelper.getMessageNotices(act.messageNotices);
        propertyData[MessageActivityPropertyKeys.variableSettings] = PropertyHelper.getVariableSettings(act.Model, act.variableSettings);
        return {
            propertyConfig: [basicProperty, activityProperty],
            propertyData: propertyData
        };
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    MessageActivityCell.prototype.updateProps = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var messageActivity = this.flowElement;
        /** @type {?} */
        var propertyId = obj.propertyID;
        switch (propertyId) {
            case MessageActivityPropertyKeys.messageNotice:
                this.updateMessageNotices(messageActivity, obj);
                break;
            case MessageActivityPropertyKeys.variableSettings:
                this.updateVariableSettings(messageActivity, obj);
                break;
            default:
                _super.prototype.updateProps.call(this, obj);
                break;
        }
    };
    /**
     * @param {?} messageActivity
     * @param {?} obj
     * @return {?}
     */
    MessageActivityCell.prototype.updateMessageNotices = /**
     * @param {?} messageActivity
     * @param {?} obj
     * @return {?}
     */
    function (messageActivity, obj) {
        var e_1, _a, e_2, _b, e_3, _c, e_4, _d;
        /** @type {?} */
        var bpmnModel = messageActivity.Model;
        /** @type {?} */
        var notices = (/** @type {?} */ (obj.propertyValue));
        messageActivity.messageNotices = new Array();
        if (notices && notices.length > 0) {
            try {
                for (var notices_1 = tslib_1.__values(notices), notices_1_1 = notices_1.next(); !notices_1_1.done; notices_1_1 = notices_1.next()) {
                    var n = notices_1_1.value;
                    /** @type {?} */
                    var messageNotice = new MessageNotice(bpmnModel);
                    messageNotice.sendType = n.sendType;
                    messageNotice.sendTime = n.sendTime;
                    messageNotice.subject = n.subject;
                    messageNotice.content = n.content;
                    if (n.smsMessageTemplate) {
                        /** @type {?} */
                        var smsMessageTemplate = new SmsMessageTemplate(bpmnModel);
                        smsMessageTemplate.code = n.smsMessageTemplate.code;
                        smsMessageTemplate.content = n.smsMessageTemplate.content;
                        smsMessageTemplate.smsMessageVariables = new Array();
                        if (n.smsMessageTemplate.smsMessageVariables && n.smsMessageTemplate.smsMessageVariables.length > 0) {
                            try {
                                for (var _e = tslib_1.__values(n.smsMessageTemplate.smsMessageVariables), _f = _e.next(); !_f.done; _f = _e.next()) {
                                    var v = _f.value;
                                    /** @type {?} */
                                    var variable = new SmsMessageVariable(bpmnModel);
                                    variable.code = v.code;
                                    variable.value = v.value;
                                    variable.tag = v.tag;
                                    smsMessageTemplate.smsMessageVariables.push(variable);
                                }
                            }
                            catch (e_2_1) { e_2 = { error: e_2_1 }; }
                            finally {
                                try {
                                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                                }
                                finally { if (e_2) throw e_2.error; }
                            }
                        }
                        messageNotice.smsMessageTemplate = smsMessageTemplate;
                    }
                    // messageNotice.receiver = n.receiver;
                    // messageNotice.receiverText = n.receiverText;
                    if (n.receivers && n.receivers.length > 0) {
                        /** @type {?} */
                        var receivers = n.receivers.filter((/**
                         * @param {?} r
                         * @return {?}
                         */
                        function (r) { return r.type === 'userParticipant'
                            || (r.type === 'processParticipant' && r.processParticipant !== 'activityExecutorParticipant'); }));
                        /** @type {?} */
                        var participants = n.receivers.filter((/**
                         * @param {?} r
                         * @return {?}
                         */
                        function (r) { return r.type === 'variableParticipant' || r.type === 'positionParticipant'
                            || (r.type === 'processParticipant' && r.processParticipant === 'activityExecutorParticipant'); }));
                        if (receivers && receivers.length > 0) {
                            /** @type {?} */
                            var receiver = '';
                            /** @type {?} */
                            var receiverName = '';
                            try {
                                for (var receivers_1 = tslib_1.__values(receivers), receivers_1_1 = receivers_1.next(); !receivers_1_1.done; receivers_1_1 = receivers_1.next()) {
                                    var r = receivers_1_1.value;
                                    if (r.type === 'processParticipant') {
                                        receiver += (r.processParticipant + ',');
                                        if (r.processParticipant === 'procInstCreator') {
                                            receiverName += '流程发起人,';
                                        }
                                        else if (r.processParticipant === 'workItemParticipant') {
                                            receiverName += '任务接收人,';
                                        }
                                    }
                                    else if (r.type === 'userParticipant') {
                                        receiver += (r.userIds + ',');
                                        receiverName += (r.userNames + ',');
                                    }
                                }
                            }
                            catch (e_3_1) { e_3 = { error: e_3_1 }; }
                            finally {
                                try {
                                    if (receivers_1_1 && !receivers_1_1.done && (_c = receivers_1.return)) _c.call(receivers_1);
                                }
                                finally { if (e_3) throw e_3.error; }
                            }
                            if (receiver) {
                                receiver = receiver.substring(0, receiver.length - 1);
                            }
                            if (receiverName) {
                                receiverName = receiverName.substring(0, receiverName.length - 1);
                            }
                            messageNotice.receiver = receiver;
                            messageNotice.receiverText = receiverName;
                        }
                        if (participants && participants.length > 0) {
                            /** @type {?} */
                            var receiverExpressions = new Array();
                            try {
                                for (var participants_1 = tslib_1.__values(participants), participants_1_1 = participants_1.next(); !participants_1_1.done; participants_1_1 = participants_1.next()) {
                                    var p = participants_1_1.value;
                                    if (p.type === 'processParticipant') {
                                        /** @type {?} */
                                        var activityExecutor = new ActivityExecutorParticipantExpression(messageActivity.Model);
                                        activityExecutor.id = BpmnModelHelper.GenerateElementId();
                                        activityExecutor.activityDefId = p.activityDefId;
                                        activityExecutor.activityDefName = p.activityDefName;
                                        receiverExpressions.push(activityExecutor);
                                    }
                                    if (p.type === 'variableParticipant') {
                                        /** @type {?} */
                                        var variableParticipant = new UserParticipantExpression(messageActivity.Model, p.variableParticipant, p.variableName, p.orgType);
                                        variableParticipant.id = BpmnModelHelper.GenerateElementId();
                                        variableParticipant.Tag = 'expression';
                                        variableParticipant.OrgType = p.orgType;
                                        receiverExpressions.push(variableParticipant);
                                    }
                                    if (p.type === 'positionParticipant') {
                                        /** @type {?} */
                                        var posiParticipant = new PositionParticipantExpression(messageActivity.Model, p.positionId, p.positionName);
                                        posiParticipant.id = BpmnModelHelper.GenerateElementId();
                                        posiParticipant.PositionType = p.positionType;
                                        if (p.positionType === '1') {
                                            posiParticipant.OrgId = p.orgId;
                                            posiParticipant.OrgType = p.orgType;
                                        }
                                        receiverExpressions.push(posiParticipant);
                                    }
                                }
                            }
                            catch (e_4_1) { e_4 = { error: e_4_1 }; }
                            finally {
                                try {
                                    if (participants_1_1 && !participants_1_1.done && (_d = participants_1.return)) _d.call(participants_1);
                                }
                                finally { if (e_4) throw e_4.error; }
                            }
                            messageNotice.receiverExpressions = receiverExpressions;
                        }
                    }
                    messageActivity.messageNotices.push(messageNotice);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (notices_1_1 && !notices_1_1.done && (_a = notices_1.return)) _a.call(notices_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    /**
     * @param {?} messageActivity
     * @param {?} obj
     * @return {?}
     */
    MessageActivityCell.prototype.updateVariableSettings = /**
     * @param {?} messageActivity
     * @param {?} obj
     * @return {?}
     */
    function (messageActivity, obj) {
        var e_5, _a, e_6, _b, e_7, _c;
        /** @type {?} */
        var bpmnModel = messageActivity.Model;
        /** @type {?} */
        var extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        if (messageActivity.variableSettings && messageActivity.variableSettings.length > 0) {
            var _loop_1 = function (v) {
                if (v.tag === 'component') {
                    /** @type {?} */
                    var i = extendElements.findIndex((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) { return (e instanceof Component && e.Id === v.value); }));
                    extendElements.splice(i, 1);
                }
            };
            try {
                for (var _d = tslib_1.__values(messageActivity.variableSettings), _e = _d.next(); !_e.done; _e = _d.next()) {
                    var v = _e.value;
                    _loop_1(v);
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
                }
                finally { if (e_5) throw e_5.error; }
            }
        }
        messageActivity.variableSettings = new Array();
        /** @type {?} */
        var variables = (/** @type {?} */ (obj.propertyValue));
        if (variables && variables.length > 0) {
            try {
                for (var variables_1 = tslib_1.__values(variables), variables_1_1 = variables_1.next(); !variables_1_1.done; variables_1_1 = variables_1.next()) {
                    var v = variables_1_1.value;
                    /** @type {?} */
                    var variableSetting = new VariableSetting(bpmnModel);
                    // variableSetting.variableId = v.variableId;
                    variableSetting.variableCode = v.variableCode;
                    variableSetting.variableName = v.variableName;
                    variableSetting.tag = v.tag;
                    variableSetting.executionTime = v.executionTime;
                    variableSetting.value = v.value;
                    variableSetting.valueText = v.valueText;
                    messageActivity.variableSettings.push(variableSetting);
                    if (variableSetting.tag === 'component') {
                        /** @type {?} */
                        var c = v.component;
                        if (c) {
                            /** @type {?} */
                            var cpt = new Component(bpmnModel);
                            cpt.MetadataId = c.MetadataId;
                            cpt.MethodCode = c.MethodCode;
                            cpt.Id = c.Id;
                            cpt.Name = c.Name;
                            cpt.ActualParameters = new Array();
                            if (c.ActualParameters && c.ActualParameters.length > 0) {
                                try {
                                    for (var _f = tslib_1.__values(c.ActualParameters), _g = _f.next(); !_g.done; _g = _f.next()) {
                                        var a = _g.value;
                                        /** @type {?} */
                                        var parameter = new ActualParameter(bpmnModel, a.Name, a.Value);
                                        parameter.Tag = a.Tag;
                                        cpt.ActualParameters.push(parameter);
                                    }
                                }
                                catch (e_7_1) { e_7 = { error: e_7_1 }; }
                                finally {
                                    try {
                                        if (_g && !_g.done && (_c = _f.return)) _c.call(_f);
                                    }
                                    finally { if (e_7) throw e_7.error; }
                                }
                            }
                            extendElements.push(cpt);
                        }
                    }
                }
            }
            catch (e_6_1) { e_6 = { error: e_6_1 }; }
            finally {
                try {
                    if (variables_1_1 && !variables_1_1.done && (_b = variables_1.return)) _b.call(variables_1);
                }
                finally { if (e_6) throw e_6.error; }
            }
        }
    };
    MessageActivityCell.CLR_TYPE_ID = MessageActivity.Clr_Type_ID;
    return MessageActivityCell;
}(NodeCell));
export { MessageActivityCell };
if (false) {
    /** @type {?} */
    MessageActivityCell.CLR_TYPE_ID;
    /** @type {?} */
    MessageActivityCell.prototype.clrTypeId;
    /** @type {?} */
    MessageActivityCell.prototype.name;
    /** @type {?} */
    MessageActivityCell.prototype.nameLanguage;
    /** @type {?} */
    MessageActivityCell.prototype.flowElement;
    /** @type {?} */
    MessageActivityCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVzc2FnZUFjdGl2aXR5Q2VsbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvZGVzaWduZXIvd2YtY2VsbC9NZXNzYWdlQWN0aXZpdHlDZWxsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxxQkFBcUIsRUFBNEIsTUFBTSxzQkFBc0IsQ0FBQztBQUNqRyxPQUFPLEVBQWEsV0FBVyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQXlCLHFDQUFxQyxFQUFFLHlCQUF5QixFQUFFLDZCQUE2QixFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsa0JBQWtCLEVBQUUsa0JBQWtCLEdBQUcsTUFBTSwwQkFBMEIsQ0FBQztBQUN4UixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDZDQUE2QyxDQUFDOzs7O0FBSzFGO0lBQXlDLCtDQUFRO0lBZ0I3Qyw2QkFBWSxLQUFXLEVBQUUsUUFBK0IsRUFBRSxLQUFjOztRQUF4RSxZQUNJLGtCQUFNLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLFNBQ2hDO1FBakJELGVBQVMsR0FBVyxtQkFBbUIsQ0FBQyxXQUFXLENBQUM7UUFDcEQsVUFBSSxHQUFXLElBQUksQ0FBQztRQUNwQixrQkFBWSxHQUFnQztZQUMxQyxRQUFRLEVBQUUsSUFBSTtZQUNkLFFBQVEsRUFBRSxJQUFJO1lBQ2QsSUFBSSxFQUFFLFNBQVM7U0FDbEIsQ0FBQztRQUlBLGFBQU87WUFDSCxHQUFDLGFBQWEsQ0FB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QixHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7NEJBQ2QsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDOzRCQUNsQixHQUFHLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQzs0QkFDbkMsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLElBQUksQ0FBQyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7O29DQUNyRCxLQUFjLElBQUEsS0FBQSxpQkFBQSxDQUFDLENBQUMsZ0JBQWdCLENBQUEsZ0JBQUEsNEJBQUU7d0NBQTdCLElBQUksQ0FBQyxXQUFBOzs0Q0FDRixTQUFTLEdBQUcsSUFBSSxlQUFlLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQzt3Q0FDL0QsU0FBUyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO3dDQUN0QixHQUFHLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO3FDQUN4Qzs7Ozs7Ozs7OzZCQUNKOzRCQUVELGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7eUJBQzVCO3FCQUNKO2lCQUNKOzs7Ozs7Ozs7U0FDSjtJQUNMLENBQUM7SUE3Tk0sK0JBQVcsR0FBVyxlQUFlLENBQUMsV0FBVyxDQUFDO0lBOE43RCwwQkFBQztDQUFBLEFBdE9ELENBQXlDLFFBQVEsR0FzT2hEO1NBdE9ZLG1CQUFtQjs7O0lBUTVCLGdDQUF5RDs7SUFQekQsd0NBQW9EOztJQUNwRCxtQ0FBb0I7O0lBQ3BCLDJDQUlBOztJQUVBLDBDQUE2Qjs7SUFFN0Isc0NBR0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOb2RlQ2VsbCwgRWxlbWVudFByb3BlcnR5Q29uZmlnLCBGYXJyaXNQcm9wQ29uZmlnV2l0aERhdGEgfSBmcm9tIFwiQGVkcC1wbWYvZ3JhcGhlZGl0b3JcIjtcclxuaW1wb3J0IHsgTXhHcmFwaE5TLCBteFJlc291cmNlcyB9IGZyb20gXCJAZWRwLXBtZi9teGdyYXBoLXRzXCI7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEhlbHBlciwgRmxvd05vZGVTdGF0ZSB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IE1lc3NhZ2VBY3Rpdml0eSwgTWVzc2FnZU5vdGljZSwgQ29tcG9uZW50LCBQYXJ0aWNpcGFudEV4cHJlc3Npb24sIEFjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudEV4cHJlc3Npb24sIFVzZXJQYXJ0aWNpcGFudEV4cHJlc3Npb24sIFBvc2l0aW9uUGFydGljaXBhbnRFeHByZXNzaW9uLCBWYXJpYWJsZVNldHRpbmcsIEFjdHVhbFBhcmFtZXRlciwgU21zTWVzc2FnZVRlbXBsYXRlLCBTbXNNZXNzYWdlVmFyaWFibGUsIH0gZnJvbSBcIkBnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbFwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUhlbHBlciB9IGZyb20gXCIuL1Byb3BlcnR5SGVscGVyXCI7XHJcbmltcG9ydCB7IFdmQ29uc3RhbnRzIH0gZnJvbSBcIi4uL1dmQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IE1lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cyB9IGZyb20gXCIuL3Byb3BlcnR5LWtleXMvTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzXCI7XHJcblxyXG4vKipcclxuICog5raI5oGv5rS75Yqo6IqC54K5XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTWVzc2FnZUFjdGl2aXR5Q2VsbCBleHRlbmRzIE5vZGVDZWxsIHtcclxuICAgIGNsclR5cGVJZDogc3RyaW5nID0gTWVzc2FnZUFjdGl2aXR5Q2VsbC5DTFJfVFlQRV9JRDtcclxuICAgIG5hbWU6IHN0cmluZyA9IFwi5raI5oGvXCI7XHJcbiAgICBuYW1lTGFuZ3VhZ2U6IHsgW2xhbmc6IHN0cmluZ106IHN0cmluZzsgfSA9IHtcclxuICAgICAgXCJ6aC1DSFNcIjogXCLmtojmga9cIixcclxuICAgICAgXCJ6aC1DSFRcIjogXCLmtojmga9cIixcclxuICAgICAgXCJlblwiOiBcIk1lc3NhZ2VcIixcclxuICB9O1xyXG4gICAgc3RhdGljIENMUl9UWVBFX0lEOiBzdHJpbmcgPSBNZXNzYWdlQWN0aXZpdHkuQ2xyX1R5cGVfSUQ7XHJcbiAgICBmbG93RWxlbWVudDogTWVzc2FnZUFjdGl2aXR5O1xyXG5cclxuICAgIGltZ1VybHMgPSB7XHJcbiAgICAgICAgW0Zsb3dOb2RlU3RhdGUuRGVmYXVsdF06IFdmQ29uc3RhbnRzLklNQUdFX1BBVEggKyBcIi9tZXNzYWdlLnBuZ1wiLFxyXG4gICAgICAgIFtGbG93Tm9kZVN0YXRlLlNlbGVjdGVkXTogV2ZDb25zdGFudHMuSU1BR0VfUEFUSCArIFwiL21lc3NhZ2Vfc2VsZWN0LnN2Z1wiLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZT86IGFueSwgZ2VvbWV0cnk/OiBNeEdyYXBoTlMubXhHZW9tZXRyeSwgc3R5bGU/OiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcih2YWx1ZSwgZ2VvbWV0cnksIHN0eWxlKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVGbG93RWxlbWVudChmbG93RWx0PzogTWVzc2FnZUFjdGl2aXR5KSB7XHJcbiAgICAgICAgY29uc3QgZmxvd05vZGUgPSBzdXBlci5jcmVhdGVGbG93RWxlbWVudChmbG93RWx0KSBhcyBNZXNzYWdlQWN0aXZpdHk7XHJcbiAgICAgICAgZmxvd05vZGUuSWQgPSBcIk1lc3NhZ2VBY3Rpdml0eVwiICsgQnBtbk1vZGVsSGVscGVyLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBmbG93Tm9kZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRGYXJyaXNQcm9wQ29uZmlnKCk6IEZhcnJpc1Byb3BDb25maWdXaXRoRGF0YSB7XHJcbiAgICAgICAgbGV0IGFjdCA9IHRoaXMuZmxvd0VsZW1lbnQ7XHJcblxyXG4gICAgICAgIGxldCBiYXNpY1Byb3BlcnR5OiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IGFjdGl2aXR5UHJvcGVydHk6IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZyA9IG5ldyBFbGVtZW50UHJvcGVydHlDb25maWcoKTtcclxuICAgICAgICBsZXQgcHJvcGVydHlEYXRhOiBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS5jYXRlZ29yeUlkID0gJ2Jhc2ljUHJvcGVydHknO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0luZm9ybWF0aW9uJyk7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS50YWJJZCA9ICdiYXNpYyc7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS50YWJOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0F0dHJpYnV0ZXMnKVxyXG4gICAgICAgIGJhc2ljUHJvcGVydHkucHJvcGVydGllcyA9IFtcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBNZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXMuTmFtZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWUnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgdmlzaWJsZTogIXRoaXMuZWRpdG9yVWkubXVsdGlMYW5nRW5hYmxlZCB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IE1lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5OYW1lTGFuZ3VhZ2UsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCduYW1lTGFuZ3VhZ2UnKSwgcHJvcGVydHlUeXBlOiAnbXVsdGlMYW5ndWFnZScsIHZpc2libGU6IHRoaXMuZWRpdG9yVWkubXVsdGlMYW5nRW5hYmxlZCB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IE1lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5JZCwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ2lkJyksIHByb3BlcnR5VHlwZTogJ3N0cmluZycsIHJlYWRvbmx5OiB0cnVlIH1cclxuICAgICAgICBdO1xyXG5cclxuXHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS5jYXRlZ29yeUlkID0gJ2FjdGl2aXR5UHJvcGVydHknO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdhY3Rpdml0eVByb3BlcnR5Jyk7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS50YWJJZCA9ICdiYXNpYyc7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS50YWJOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0F0dHJpYnV0ZXMnKVxyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkucHJvcGVydGllcyA9IFtcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBNZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXMubWVzc2FnZU5vdGljZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ21lc3NhZ2VOb3RpY2UnKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3MsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCd2YXJpYWJsZVNldHRpbmdzJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgcHJvcGVydHlEYXRhW01lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5JZF0gPSBhY3QuSWQ7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW01lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5DbHJUeXBlSURdID0gYWN0LkNsclR5cGVJRDtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLk5hbWVdID0gYWN0Lk5hbWU7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW01lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5OYW1lTGFuZ3VhZ2VdID0gYWN0Lk5hbWVMYW5ndWFnZSB8fCB7XHJcbiAgICAgICAgICAgIFwiemgtQ0hTXCI6IGFjdC5OYW1lLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW01lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5tZXNzYWdlTm90aWNlXSA9IFByb3BlcnR5SGVscGVyLmdldE1lc3NhZ2VOb3RpY2VzKGFjdC5tZXNzYWdlTm90aWNlcyk7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW01lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy52YXJpYWJsZVNldHRpbmdzXSA9IFByb3BlcnR5SGVscGVyLmdldFZhcmlhYmxlU2V0dGluZ3MoYWN0Lk1vZGVsLCBhY3QudmFyaWFibGVTZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByb3BlcnR5Q29uZmlnOiBbYmFzaWNQcm9wZXJ0eSwgYWN0aXZpdHlQcm9wZXJ0eV0sXHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YTogcHJvcGVydHlEYXRhXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BzKG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZUFjdGl2aXR5ID0gdGhpcy5mbG93RWxlbWVudDtcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eUlkOiBzdHJpbmcgPSBvYmoucHJvcGVydHlJRDtcclxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5SWQpIHtcclxuICAgICAgICAgICAgY2FzZSBNZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXMubWVzc2FnZU5vdGljZTpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTWVzc2FnZU5vdGljZXMobWVzc2FnZUFjdGl2aXR5LCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZhcmlhYmxlU2V0dGluZ3MobWVzc2FnZUFjdGl2aXR5LCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBzdXBlci51cGRhdGVQcm9wcyhvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZU1lc3NhZ2VOb3RpY2VzKG1lc3NhZ2VBY3Rpdml0eTogTWVzc2FnZUFjdGl2aXR5LCBvYmo6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGJwbW5Nb2RlbCA9IG1lc3NhZ2VBY3Rpdml0eS5Nb2RlbDtcclxuICAgICAgICBsZXQgbm90aWNlcyA9IG9iai5wcm9wZXJ0eVZhbHVlIGFzIGFueVtdO1xyXG4gICAgICAgIG1lc3NhZ2VBY3Rpdml0eS5tZXNzYWdlTm90aWNlcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIGlmIChub3RpY2VzICYmIG5vdGljZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBuIG9mIG5vdGljZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VOb3RpY2UgPSBuZXcgTWVzc2FnZU5vdGljZShicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5zZW5kVHlwZSA9IG4uc2VuZFR5cGU7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlTm90aWNlLnNlbmRUaW1lID0gbi5zZW5kVGltZTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VOb3RpY2Uuc3ViamVjdCA9IG4uc3ViamVjdDtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VOb3RpY2UuY29udGVudCA9IG4uY29udGVudDtcclxuICAgICAgICAgICAgICAgIGlmIChuLnNtc01lc3NhZ2VUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNtc01lc3NhZ2VUZW1wbGF0ZSA9IG5ldyBTbXNNZXNzYWdlVGVtcGxhdGUoYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICBzbXNNZXNzYWdlVGVtcGxhdGUuY29kZSA9IG4uc21zTWVzc2FnZVRlbXBsYXRlLmNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgc21zTWVzc2FnZVRlbXBsYXRlLmNvbnRlbnQgPSBuLnNtc01lc3NhZ2VUZW1wbGF0ZS5jb250ZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIHNtc01lc3NhZ2VUZW1wbGF0ZS5zbXNNZXNzYWdlVmFyaWFibGVzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG4uc21zTWVzc2FnZVRlbXBsYXRlLnNtc01lc3NhZ2VWYXJpYWJsZXMgJiYgbi5zbXNNZXNzYWdlVGVtcGxhdGUuc21zTWVzc2FnZVZhcmlhYmxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiBuLnNtc01lc3NhZ2VUZW1wbGF0ZS5zbXNNZXNzYWdlVmFyaWFibGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZSA9IG5ldyBTbXNNZXNzYWdlVmFyaWFibGUoYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLmNvZGUgPSB2LmNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZS52YWx1ZSA9IHYudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZS50YWcgPSB2LnRhZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtc01lc3NhZ2VUZW1wbGF0ZS5zbXNNZXNzYWdlVmFyaWFibGVzLnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VOb3RpY2Uuc21zTWVzc2FnZVRlbXBsYXRlID0gc21zTWVzc2FnZVRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gbWVzc2FnZU5vdGljZS5yZWNlaXZlciA9IG4ucmVjZWl2ZXI7XHJcbiAgICAgICAgICAgICAgICAvLyBtZXNzYWdlTm90aWNlLnJlY2VpdmVyVGV4dCA9IG4ucmVjZWl2ZXJUZXh0O1xyXG4gICAgICAgICAgICAgICAgaWYgKG4ucmVjZWl2ZXJzICYmIG4ucmVjZWl2ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNlaXZlcnMgPSBuLnJlY2VpdmVycy5maWx0ZXIoKHI6IGFueSkgPT4gci50eXBlID09PSAndXNlclBhcnRpY2lwYW50J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCAoci50eXBlID09PSAncHJvY2Vzc1BhcnRpY2lwYW50JyAmJiByLnByb2Nlc3NQYXJ0aWNpcGFudCAhPT0gJ2FjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudCcpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBuLnJlY2VpdmVycy5maWx0ZXIoKHI6IGFueSkgPT4gci50eXBlID09PSAndmFyaWFibGVQYXJ0aWNpcGFudCcgfHwgci50eXBlID09PSAncG9zaXRpb25QYXJ0aWNpcGFudCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHIudHlwZSA9PT0gJ3Byb2Nlc3NQYXJ0aWNpcGFudCcgJiYgci5wcm9jZXNzUGFydGljaXBhbnQgPT09ICdhY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnQnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2VpdmVycyAmJiByZWNlaXZlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVjZWl2ZXIgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlY2VpdmVyTmFtZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHIgb2YgcmVjZWl2ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoci50eXBlID09PSAncHJvY2Vzc1BhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyICs9IChyLnByb2Nlc3NQYXJ0aWNpcGFudCArICcsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIucHJvY2Vzc1BhcnRpY2lwYW50ID09PSAncHJvY0luc3RDcmVhdG9yJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlck5hbWUgKz0gJ+a1geeoi+WPkei1t+S6uiwnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyLnByb2Nlc3NQYXJ0aWNpcGFudCA9PT0gJ3dvcmtJdGVtUGFydGljaXBhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyTmFtZSArPSAn5Lu75Yqh5o6l5pS25Lq6LCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHIudHlwZSA9PT0gJ3VzZXJQYXJ0aWNpcGFudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlciArPSAoci51c2VySWRzICsgJywnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlck5hbWUgKz0gKHIudXNlck5hbWVzICsgJywnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjZWl2ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyID0gcmVjZWl2ZXIuc3Vic3RyaW5nKDAsIHJlY2VpdmVyLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNlaXZlck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyTmFtZSA9IHJlY2VpdmVyTmFtZS5zdWJzdHJpbmcoMCwgcmVjZWl2ZXJOYW1lLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VOb3RpY2UucmVjZWl2ZXIgPSByZWNlaXZlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlclRleHQgPSByZWNlaXZlck5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNpcGFudHMgJiYgcGFydGljaXBhbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjZWl2ZXJFeHByZXNzaW9ucyA9IG5ldyBBcnJheTxQYXJ0aWNpcGFudEV4cHJlc3Npb24+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBwYXJ0aWNpcGFudHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLnR5cGUgPT09ICdwcm9jZXNzUGFydGljaXBhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGl2aXR5RXhlY3V0b3IgPSBuZXcgQWN0aXZpdHlFeGVjdXRvclBhcnRpY2lwYW50RXhwcmVzc2lvbihtZXNzYWdlQWN0aXZpdHkuTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RXhlY3V0b3IuaWQgPSBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUV4ZWN1dG9yLmFjdGl2aXR5RGVmSWQgPSBwLmFjdGl2aXR5RGVmSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFeGVjdXRvci5hY3Rpdml0eURlZk5hbWUgPSBwLmFjdGl2aXR5RGVmTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlckV4cHJlc3Npb25zLnB1c2goYWN0aXZpdHlFeGVjdXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocC50eXBlID09PSAndmFyaWFibGVQYXJ0aWNpcGFudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFyaWFibGVQYXJ0aWNpcGFudCA9IG5ldyBVc2VyUGFydGljaXBhbnRFeHByZXNzaW9uKG1lc3NhZ2VBY3Rpdml0eS5Nb2RlbCwgcC52YXJpYWJsZVBhcnRpY2lwYW50LCBwLnZhcmlhYmxlTmFtZSwgcC5vcmdUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZVBhcnRpY2lwYW50LmlkID0gQnBtbk1vZGVsSGVscGVyLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVQYXJ0aWNpcGFudC5UYWcgPSAnZXhwcmVzc2lvbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVQYXJ0aWNpcGFudC5PcmdUeXBlID0gcC5vcmdUeXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyRXhwcmVzc2lvbnMucHVzaCh2YXJpYWJsZVBhcnRpY2lwYW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLnR5cGUgPT09ICdwb3NpdGlvblBhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwb3NpUGFydGljaXBhbnQgPSBuZXcgUG9zaXRpb25QYXJ0aWNpcGFudEV4cHJlc3Npb24obWVzc2FnZUFjdGl2aXR5Lk1vZGVsLCBwLnBvc2l0aW9uSWQsIHAucG9zaXRpb25OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpUGFydGljaXBhbnQuaWQgPSBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpUGFydGljaXBhbnQuUG9zaXRpb25UeXBlID0gcC5wb3NpdGlvblR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAucG9zaXRpb25UeXBlID09PSAnMScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaVBhcnRpY2lwYW50Lk9yZ0lkID0gcC5vcmdJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaVBhcnRpY2lwYW50Lk9yZ1R5cGUgPSBwLm9yZ1R5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyRXhwcmVzc2lvbnMucHVzaChwb3NpUGFydGljaXBhbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VOb3RpY2UucmVjZWl2ZXJFeHByZXNzaW9ucyA9IHJlY2VpdmVyRXhwcmVzc2lvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VBY3Rpdml0eS5tZXNzYWdlTm90aWNlcy5wdXNoKG1lc3NhZ2VOb3RpY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVZhcmlhYmxlU2V0dGluZ3MobWVzc2FnZUFjdGl2aXR5OiBNZXNzYWdlQWN0aXZpdHksIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYnBtbk1vZGVsID0gbWVzc2FnZUFjdGl2aXR5Lk1vZGVsO1xyXG4gICAgICAgIGNvbnN0IGV4dGVuZEVsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEV4dGVuc2lvbkVsZW1lbnRzKCk7XHJcbiAgICAgICAgaWYgKG1lc3NhZ2VBY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzICYmIG1lc3NhZ2VBY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIG1lc3NhZ2VBY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi50YWcgPT09ICdjb21wb25lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGV4dGVuZEVsZW1lbnRzLmZpbmRJbmRleChlID0+IChlIGluc3RhbmNlb2YgQ29tcG9uZW50ICYmIGUuSWQgPT09IHYudmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbWVzc2FnZUFjdGl2aXR5LnZhcmlhYmxlU2V0dGluZ3MgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAgICAgY29uc3QgdmFyaWFibGVzID0gb2JqLnByb3BlcnR5VmFsdWUgYXMgYW55W107XHJcbiAgICAgICAgaWYgKHZhcmlhYmxlcyAmJiB2YXJpYWJsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdmFyaWFibGVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZVNldHRpbmcgPSBuZXcgVmFyaWFibGVTZXR0aW5nKGJwbW5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAvLyB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVJZCA9IHYudmFyaWFibGVJZDtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy52YXJpYWJsZUNvZGUgPSB2LnZhcmlhYmxlQ29kZTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy52YXJpYWJsZU5hbWUgPSB2LnZhcmlhYmxlTmFtZTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy50YWcgPSB2LnRhZztcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy5leGVjdXRpb25UaW1lID0gdi5leGVjdXRpb25UaW1lO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhbHVlID0gdi52YWx1ZTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy52YWx1ZVRleHQgPSB2LnZhbHVlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlQWN0aXZpdHkudmFyaWFibGVTZXR0aW5ncy5wdXNoKHZhcmlhYmxlU2V0dGluZyk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFyaWFibGVTZXR0aW5nLnRhZyA9PT0gJ2NvbXBvbmVudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gdi5jb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNwdCA9IG5ldyBDb21wb25lbnQoYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0Lk1ldGFkYXRhSWQgPSBjLk1ldGFkYXRhSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5NZXRob2RDb2RlID0gYy5NZXRob2RDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuSWQgPSBjLklkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuTmFtZSA9IGMuTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0LkFjdHVhbFBhcmFtZXRlcnMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuQWN0dWFsUGFyYW1ldGVycyAmJiBjLkFjdHVhbFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYSBvZiBjLkFjdHVhbFBhcmFtZXRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFyYW1ldGVyID0gbmV3IEFjdHVhbFBhcmFtZXRlcihicG1uTW9kZWwsIGEuTmFtZSwgYS5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyLlRhZyA9IGEuVGFnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5BY3R1YWxQYXJhbWV0ZXJzLnB1c2gocGFyYW1ldGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kRWxlbWVudHMucHVzaChjcHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
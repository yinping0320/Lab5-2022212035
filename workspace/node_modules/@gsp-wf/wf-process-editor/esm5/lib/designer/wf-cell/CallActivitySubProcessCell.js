/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { CallActivitySubProcess, Component, BackWardRule, ActualParameter, VariableSetting, SemanticExpression, CounterSignRule, Condition } from "@gsp-wf/wf-process-model";
import { PropertyHelper } from "./PropertyHelper";
import { BpmnModelHelper, Expression, FlowNodeState, MultiInstanceLoopCharacteristics } from "@edp-pmf/bpmn-model";
import { WfConstants } from "../WfConstants";
import { CallActivitySubProcessPropertyKeys } from "./property-keys/CallActivitySubProcessPropertyKeys";
/**
 * 子流程活动节点
 */
var CallActivitySubProcessCell = /** @class */ (function (_super) {
    tslib_1.__extends(CallActivitySubProcessCell, _super);
    function CallActivitySubProcessCell(value, geometry, style) {
        var _a;
        var _this = _super.call(this, value, geometry, style) || this;
        _this.clrTypeId = CallActivitySubProcessCell.CLR_TYPE_ID;
        _this.name = "子流程";
        _this.nameLanguage = {
            "zh-CHS": "子流程",
            "zh-CHT": "子流程",
            "en": "Sub-Process",
        };
        _this.imgUrls = (_a = {},
            _a[FlowNodeState.Default] = WfConstants.IMAGE_PATH + "/sub.png",
            _a[FlowNodeState.Selected] = WfConstants.IMAGE_PATH + "/sub_select.svg",
            _a);
        return _this;
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.createFlowElement = /**
     * @param {?=} flowElt
     * @return {?}
     */
    function (flowElt) {
        /** @type {?} */
        var flowNode = (/** @type {?} */ (_super.prototype.createFlowElement.call(this, flowElt)));
        flowNode.Id = "CallActivitySubProcess" + BpmnModelHelper.GenerateElementId();
        return flowNode;
    };
    /**
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.getFarrisPropConfig = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var act = this.flowElement;
        // 组织属性框
        /** @type {?} */
        var basicProperty = new ElementPropertyConfig();
        /** @type {?} */
        var activityProperty = new ElementPropertyConfig();
        /** @type {?} */
        var propertyData = {};
        // 基本属性（名称）
        basicProperty.categoryId = 'basicProperty';
        basicProperty.categoryName = mxResources.get('basicInformation');
        basicProperty.tabId = 'basic';
        basicProperty.tabName = mxResources.get('basicAttributes');
        basicProperty.properties = [
            { propertyID: CallActivitySubProcessPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: CallActivitySubProcessPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: CallActivitySubProcessPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        // 活动选项（表单定义+活动构件）
        activityProperty.categoryId = 'activityProperty';
        activityProperty.categoryName = mxResources.get('activityProperty');
        activityProperty.tabId = 'basic';
        activityProperty.tabName = mxResources.get('basicAttributes');
        activityProperty.properties = [
            { propertyID: CallActivitySubProcessPropertyKeys.callActivitySubProcess, propertyName: mxResources.get('callActivitySubProcess'), propertyType: 'modal' },
            { propertyID: CallActivitySubProcessPropertyKeys.variableSettings, propertyName: mxResources.get('variableSettings'), propertyType: 'modal' },
            { propertyID: CallActivitySubProcessPropertyKeys.BackWardRule, propertyName: mxResources.get('backWardRule'), propertyType: 'modal' },
            { propertyID: CallActivitySubProcessPropertyKeys.MultiInstanceLoopCharacteristics, propertyName: mxResources.get('multiInstanceLoopCharacteristics'), propertyType: 'modal' }
        ];
        propertyData[CallActivitySubProcessPropertyKeys.Id] = act.Id;
        propertyData[CallActivitySubProcessPropertyKeys.ClrTypeID] = act.ClrTypeID;
        propertyData[CallActivitySubProcessPropertyKeys.Name] = act.Name;
        propertyData[CallActivitySubProcessPropertyKeys.NameLanguage] = act.NameLanguage || {
            "zh-CHS": act.Name,
        };
        propertyData[CallActivitySubProcessPropertyKeys.callActivitySubProcess] = {
            calledBizDefKey: act.calledBizDefKey,
            calledElement: act.CalledElement,
            inheritVariables: act.inheritVariables,
            inheritBizDataId: act.inheritBizDataId,
            bizDataId: act.bizDataId,
            aifProcessCode: act.aifProcessCode,
            useAutoCreationData: act.useAutoCreationData,
        };
        propertyData[CallActivitySubProcessPropertyKeys.BackWardRule] = act.backWardRule;
        propertyData[CallActivitySubProcessPropertyKeys.variableSettings] = PropertyHelper.getVariableSettings(act.Model, act.variableSettings);
        propertyData[CallActivitySubProcessPropertyKeys.MultiInstanceLoopCharacteristics] = act.LoopCharacteristics;
        return {
            propertyConfig: [basicProperty, activityProperty],
            propertyData: propertyData
        };
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.updateProps = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var subProcess = this.flowElement;
        /** @type {?} */
        var propertyId = obj.propertyID;
        switch (propertyId) {
            case CallActivitySubProcessPropertyKeys.callActivitySubProcess:
                this.updateSubProcessConfig(subProcess, obj);
                break;
            case CallActivitySubProcessPropertyKeys.BackWardRule:
                this.updateBackWardRule(subProcess, obj);
                break;
            case CallActivitySubProcessPropertyKeys.variableSettings:
                this.updateVariableSettings(subProcess, obj);
                break;
            case CallActivitySubProcessPropertyKeys.MultiInstanceLoopCharacteristics:
                this.updateMultiInstanceLoopCharacteristic(subProcess, obj);
                break;
            default:
                _super.prototype.updateProps.call(this, obj);
                break;
        }
    };
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.updateSubProcessConfig = /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    function (subProcess, obj) {
        /** @type {?} */
        var config = obj.propertyValue;
        if (subProcess) {
            subProcess.calledBizDefKey = config.calledBizDefKey;
            subProcess.CalledElement = config.calledElement;
            subProcess.inheritBizDataId = config.inheritBizDataId;
            subProcess.inheritVariables = config.inheritVariables;
            subProcess.bizDataId = config.bizDataId;
            subProcess.aifProcessCode = config.aifProcessCode;
            subProcess.useAutoCreationData = config.useAutoCreationData;
        }
    };
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.updateBackWardRule = /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    function (subProcess, obj) {
        /** @type {?} */
        var data = obj.propertyValue;
        /** @type {?} */
        var backWardRule = new BackWardRule(subProcess.Model);
        backWardRule.TargetRef = data.TargetRef;
        backWardRule.SelectTargetAble = data.SelectTargetAble;
        backWardRule.WaitReturn = data.WaitReturn;
        backWardRule.ResubmitEffect = data.ResubmitEffect;
        backWardRule.DynamicBackWardRuleAble = data.DynamicBackWardRuleAble;
        backWardRule.SelectTargetList = data.SelectTargetList;
        subProcess.backWardRule = backWardRule;
    };
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.updateVariableSettings = /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    function (subProcess, obj) {
        var e_1, _a, e_2, _b, e_3, _c;
        /** @type {?} */
        var bpmnModel = this.flowElement.Model;
        /** @type {?} */
        var extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        if (subProcess.variableSettings && subProcess.variableSettings.length > 0) {
            var _loop_1 = function (v) {
                if (v.tag === 'component') {
                    /** @type {?} */
                    var i = extendElements.findIndex((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) { return (e instanceof Component && e.Id === v.value); }));
                    extendElements.splice(i, 1);
                }
            };
            try {
                for (var _d = tslib_1.__values(subProcess.variableSettings), _e = _d.next(); !_e.done; _e = _d.next()) {
                    var v = _e.value;
                    _loop_1(v);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        subProcess.variableSettings = new Array();
        /** @type {?} */
        var variables = (/** @type {?} */ (obj.propertyValue));
        if (variables && variables.length > 0) {
            try {
                for (var variables_1 = tslib_1.__values(variables), variables_1_1 = variables_1.next(); !variables_1_1.done; variables_1_1 = variables_1.next()) {
                    var v = variables_1_1.value;
                    /** @type {?} */
                    var variableSetting = new VariableSetting(bpmnModel);
                    // variableSetting.variableId = v.variableId;
                    variableSetting.variableCode = v.variableCode;
                    variableSetting.variableName = v.variableName;
                    variableSetting.tag = v.tag;
                    variableSetting.executionTime = v.executionTime;
                    variableSetting.value = v.value;
                    variableSetting.valueText = v.valueText;
                    subProcess.variableSettings.push(variableSetting);
                    if (variableSetting.tag === 'component') {
                        /** @type {?} */
                        var c = v.component;
                        if (c) {
                            /** @type {?} */
                            var cpt = new Component(bpmnModel);
                            cpt.MetadataId = c.MetadataId;
                            cpt.MethodCode = c.MethodCode;
                            cpt.Id = c.Id;
                            cpt.Name = c.Name;
                            cpt.ActualParameters = new Array();
                            if (c.ActualParameters && c.ActualParameters.length > 0) {
                                try {
                                    for (var _f = tslib_1.__values(c.ActualParameters), _g = _f.next(); !_g.done; _g = _f.next()) {
                                        var a = _g.value;
                                        /** @type {?} */
                                        var parameter = new ActualParameter(bpmnModel, a.Name, a.Value);
                                        parameter.Tag = a.Tag;
                                        cpt.ActualParameters.push(parameter);
                                    }
                                }
                                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                                finally {
                                    try {
                                        if (_g && !_g.done && (_c = _f.return)) _c.call(_f);
                                    }
                                    finally { if (e_3) throw e_3.error; }
                                }
                            }
                            extendElements.push(cpt);
                        }
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (variables_1_1 && !variables_1_1.done && (_b = variables_1.return)) _b.call(variables_1);
                }
                finally { if (e_2) throw e_2.error; }
            }
        }
    };
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    CallActivitySubProcessCell.prototype.updateMultiInstanceLoopCharacteristic = /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    function (subProcess, obj) {
        var e_4, _a;
        /** @type {?} */
        var data = obj.propertyValue;
        /** @type {?} */
        var loopCharacteristics = new MultiInstanceLoopCharacteristics(subProcess.Model);
        loopCharacteristics.enable = data.enable;
        loopCharacteristics.sequential = data.sequential;
        loopCharacteristics.loopCardinality = data.loopCardinality;
        loopCharacteristics.completionCondition = data.completionCondition;
        loopCharacteristics.completionConditionRules = data.completionConditionRules;
        subProcess.LoopCharacteristics = loopCharacteristics;
        if (obj.propertyValue) {
            /** @type {?} */
            var data_1 = obj.propertyValue;
            /** @type {?} */
            var loopCharacteristics_1 = new MultiInstanceLoopCharacteristics(subProcess.Model);
            loopCharacteristics_1.enable = data_1.enable;
            loopCharacteristics_1.sequential = data_1.sequential;
            loopCharacteristics_1.loopCardinality = new Expression(subProcess.Model);
            if (data_1.loopCardinality) {
                /** @type {?} */
                var variableExpression = new SemanticExpression(subProcess.Model);
                variableExpression.Value = data_1.loopCardinality;
                loopCharacteristics_1.loopCardinality.MexExpression = variableExpression;
            }
            loopCharacteristics_1.completionCondition = data_1.completionCondition;
            /** @type {?} */
            var rules = (/** @type {?} */ (data_1.completionConditionRules));
            loopCharacteristics_1.completionConditionRules = null;
            if (rules && rules.length > 0) {
                loopCharacteristics_1.completionConditionRules = new Array();
                try {
                    for (var rules_1 = tslib_1.__values(rules), rules_1_1 = rules_1.next(); !rules_1_1.done; rules_1_1 = rules_1.next()) {
                        var rule = rules_1_1.value;
                        /** @type {?} */
                        var counterSignRule = new CounterSignRule(subProcess.Model);
                        /** @type {?} */
                        var condition = new Condition(subProcess.Model);
                        condition.Value = rule.CompletionCondition.Value;
                        counterSignRule.ConclusionValue = rule.ConclusionValue;
                        counterSignRule.CalculateType = rule.CalculateType;
                        counterSignRule.ConditionValue = rule.ConditionValue;
                        counterSignRule.WaitAllVotes = rule.WaitAllVotes;
                        counterSignRule.CompletionCondition = condition;
                        loopCharacteristics_1.completionConditionRules.push(counterSignRule);
                    }
                }
                catch (e_4_1) { e_4 = { error: e_4_1 }; }
                finally {
                    try {
                        if (rules_1_1 && !rules_1_1.done && (_a = rules_1.return)) _a.call(rules_1);
                    }
                    finally { if (e_4) throw e_4.error; }
                }
            }
            subProcess.LoopCharacteristics = loopCharacteristics_1;
        }
    };
    CallActivitySubProcessCell.CLR_TYPE_ID = CallActivitySubProcess.Clr_Type_ID;
    return CallActivitySubProcessCell;
}(NodeCell));
export { CallActivitySubProcessCell };
if (false) {
    /** @type {?} */
    CallActivitySubProcessCell.CLR_TYPE_ID;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.clrTypeId;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.name;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.nameLanguage;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.flowElement;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc0NlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2Rlc2lnbmVyL3dmLWNlbGwvQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc0NlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLHFCQUFxQixFQUE0QixNQUFNLHNCQUFzQixDQUFDO0FBQ2pHLE9BQU8sRUFBYSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLGtCQUFrQixFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM3SyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLGdDQUFnQyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkgsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxrQ0FBa0MsRUFBRSxNQUFNLG9EQUFvRCxDQUFDOzs7O0FBS3hHO0lBQWdELHNEQUFRO0lBZ0JwRCxvQ0FBWSxLQUFXLEVBQUUsUUFBK0IsRUFBRSxLQUFjOztRQUF4RSxZQUNJLGtCQUFNLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLFNBQ2hDO1FBakJELGVBQVMsR0FBVywwQkFBMEIsQ0FBQyxXQUFXLENBQUM7UUFDM0QsVUFBSSxHQUFXLEtBQUssQ0FBQztRQUNyQixrQkFBWSxHQUFnQztZQUMxQyxRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxLQUFLO1lBQ2YsSUFBSSxFQUFFLGFBQWE7U0FDdEIsQ0FBQztRQUlBLGFBQU87WUFDSCxHQUFD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QUFnRTs7SUFQaEUsK0NBQTJEOztJQUMzRCwwQ0FBcUI7O0lBQ3JCLGtEQUlBOztJQUVBLGlEQUFvQzs7SUFFcEMsNkNBR0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOb2RlQ2VsbCwgRWxlbWVudFByb3BlcnR5Q29uZmlnLCBGYXJyaXNQcm9wQ29uZmlnV2l0aERhdGEgfSBmcm9tIFwiQGVkcC1wbWYvZ3JhcGhlZGl0b3JcIjtcclxuaW1wb3J0IHsgTXhHcmFwaE5TLCBteFJlc291cmNlcyB9IGZyb20gXCJAZWRwLXBtZi9teGdyYXBoLXRzXCI7XHJcbmltcG9ydCB7IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIENvbXBvbmVudCwgQmFja1dhcmRSdWxlLCBBY3R1YWxQYXJhbWV0ZXIsIFZhcmlhYmxlU2V0dGluZywgU2VtYW50aWNFeHByZXNzaW9uLCBDb3VudGVyU2lnblJ1bGUsIENvbmRpdGlvbiB9IGZyb20gXCJAZ3NwLXdmL3dmLXByb2Nlc3MtbW9kZWxcIjtcclxuaW1wb3J0IHsgUHJvcGVydHlIZWxwZXIgfSBmcm9tIFwiLi9Qcm9wZXJ0eUhlbHBlclwiO1xyXG5pbXBvcnQgeyBCcG1uTW9kZWxIZWxwZXIsIEV4cHJlc3Npb24sIEZsb3dOb2RlU3RhdGUsIE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzIH0gZnJvbSBcIkBlZHAtcG1mL2JwbW4tbW9kZWxcIjtcclxuaW1wb3J0IHsgV2ZDb25zdGFudHMgfSBmcm9tIFwiLi4vV2ZDb25zdGFudHNcIjtcclxuaW1wb3J0IHsgQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cyB9IGZyb20gXCIuL3Byb3BlcnR5LWtleXMvQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5c1wiO1xyXG5cclxuLyoqXHJcbiAqIOWtkOa1geeoi+a0u+WKqOiKgueCuVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENhbGxBY3Rpdml0eVN1YlByb2Nlc3NDZWxsIGV4dGVuZHMgTm9kZUNlbGwge1xyXG4gICAgY2xyVHlwZUlkOiBzdHJpbmcgPSBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzQ2VsbC5DTFJfVFlQRV9JRDtcclxuICAgIG5hbWU6IHN0cmluZyA9IFwi5a2Q5rWB56iLXCI7XHJcbiAgICBuYW1lTGFuZ3VhZ2U6IHsgW2xhbmc6IHN0cmluZ106IHN0cmluZzsgfSA9IHtcclxuICAgICAgXCJ6aC1DSFNcIjogXCLlrZDmtYHnqItcIixcclxuICAgICAgXCJ6aC1DSFRcIjogXCLlrZDmtYHnqItcIixcclxuICAgICAgXCJlblwiOiBcIlN1Yi1Qcm9jZXNzXCIsXHJcbiAgfTtcclxuICAgIHN0YXRpYyBDTFJfVFlQRV9JRDogc3RyaW5nID0gQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzcy5DbHJfVHlwZV9JRDtcclxuICAgIGZsb3dFbGVtZW50OiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzO1xyXG5cclxuICAgIGltZ1VybHMgPSB7XHJcbiAgICAgICAgW0Zsb3dOb2RlU3RhdGUuRGVmYXVsdF06IFdmQ29uc3RhbnRzLklNQUdFX1BBVEggKyBcIi9zdWIucG5nXCIsXHJcbiAgICAgICAgW0Zsb3dOb2RlU3RhdGUuU2VsZWN0ZWRdOiBXZkNvbnN0YW50cy5JTUFHRV9QQVRIICsgXCIvc3ViX3NlbGVjdC5zdmdcIixcclxuICAgIH07XHJcblxyXG4gICAgY29uc3RydWN0b3IodmFsdWU/OiBhbnksIGdlb21ldHJ5PzogTXhHcmFwaE5TLm14R2VvbWV0cnksIHN0eWxlPzogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIodmFsdWUsIGdlb21ldHJ5LCBzdHlsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRmxvd0VsZW1lbnQoZmxvd0VsdD86IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MpIHtcclxuICAgICAgICBjb25zdCBmbG93Tm9kZSA9IHN1cGVyLmNyZWF0ZUZsb3dFbGVtZW50KGZsb3dFbHQpIGFzIENhbGxBY3Rpdml0eVN1YlByb2Nlc3M7XHJcbiAgICAgICAgZmxvd05vZGUuSWQgPSBcIkNhbGxBY3Rpdml0eVN1YlByb2Nlc3NcIiArIEJwbW5Nb2RlbEhlbHBlci5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG5cclxuICAgICAgICByZXR1cm4gZmxvd05vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RmFycmlzUHJvcENvbmZpZygpOiBGYXJyaXNQcm9wQ29uZmlnV2l0aERhdGEge1xyXG4gICAgICAgIGxldCBhY3QgPSB0aGlzLmZsb3dFbGVtZW50O1xyXG4gICAgICAgIC8vIOe7hOe7h+WxnuaAp+ahhlxyXG4gICAgICAgIGxldCBiYXNpY1Byb3BlcnR5OiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IGFjdGl2aXR5UHJvcGVydHk6IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZyA9IG5ldyBFbGVtZW50UHJvcGVydHlDb25maWcoKTtcclxuICAgICAgICBsZXQgcHJvcGVydHlEYXRhOiBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgLy8g5Z+65pys5bGe5oCn77yI5ZCN56ew77yJXHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS5jYXRlZ29yeUlkID0gJ2Jhc2ljUHJvcGVydHknO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0luZm9ybWF0aW9uJyk7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS50YWJJZCA9ICdiYXNpYyc7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS50YWJOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0F0dHJpYnV0ZXMnKVxyXG4gICAgICAgIGJhc2ljUHJvcGVydHkucHJvcGVydGllcyA9IFtcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLk5hbWUsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCduYW1lJyksIHByb3BlcnR5VHlwZTogJ3N0cmluZycsIHZpc2libGU6ICF0aGlzLmVkaXRvclVpLm11bHRpTGFuZ0VuYWJsZWQgfSxcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWVMYW5ndWFnZScpLCBwcm9wZXJ0eVR5cGU6ICdtdWx0aUxhbmd1YWdlJywgdmlzaWJsZTogdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5JZCwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ2lkJyksIHByb3BlcnR5VHlwZTogJ3N0cmluZycsIHJlYWRvbmx5OiB0cnVlIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICAvLyDmtLvliqjpgInpobnvvIjooajljZXlrprkuYkr5rS75Yqo5p6E5Lu277yJXHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS5jYXRlZ29yeUlkID0gJ2FjdGl2aXR5UHJvcGVydHknO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdhY3Rpdml0eVByb3BlcnR5Jyk7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS50YWJJZCA9ICdiYXNpYyc7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS50YWJOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0F0dHJpYnV0ZXMnKVxyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkucHJvcGVydGllcyA9IFtcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLmNhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdjYWxsQWN0aXZpdHlTdWJQcm9jZXNzJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMudmFyaWFibGVTZXR0aW5ncywgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ3ZhcmlhYmxlU2V0dGluZ3MnKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5CYWNrV2FyZFJ1bGUsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdiYWNrV2FyZFJ1bGUnKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5NdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcywgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ211bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0NhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuSWRdID0gYWN0LklkO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLkNsclR5cGVJRF0gPSBhY3QuQ2xyVHlwZUlEO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLk5hbWVdID0gYWN0Lk5hbWU7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0NhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuTmFtZUxhbmd1YWdlXSA9IGFjdC5OYW1lTGFuZ3VhZ2UgfHwge1xyXG4gICAgICAgICAgICBcInpoLUNIU1wiOiBhY3QuTmFtZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLmNhbGxBY3Rpdml0eVN1YlByb2Nlc3NdID0ge1xyXG4gICAgICAgICAgICBjYWxsZWRCaXpEZWZLZXk6IGFjdC5jYWxsZWRCaXpEZWZLZXksXHJcbiAgICAgICAgICAgIGNhbGxlZEVsZW1lbnQ6IGFjdC5DYWxsZWRFbGVtZW50LFxyXG4gICAgICAgICAgICBpbmhlcml0VmFyaWFibGVzOiBhY3QuaW5oZXJpdFZhcmlhYmxlcyxcclxuICAgICAgICAgICAgaW5oZXJpdEJpekRhdGFJZDogYWN0LmluaGVyaXRCaXpEYXRhSWQsXHJcbiAgICAgICAgICAgIGJpekRhdGFJZDogYWN0LmJpekRhdGFJZCxcclxuICAgICAgICAgICAgYWlmUHJvY2Vzc0NvZGU6IGFjdC5haWZQcm9jZXNzQ29kZSxcclxuICAgICAgICAgICAgdXNlQXV0b0NyZWF0aW9uRGF0YTogYWN0LnVzZUF1dG9DcmVhdGlvbkRhdGEsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5CYWNrV2FyZFJ1bGVdID0gYWN0LmJhY2tXYXJkUnVsZTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy52YXJpYWJsZVNldHRpbmdzXSA9IFByb3BlcnR5SGVscGVyLmdldFZhcmlhYmxlU2V0dGluZ3MoYWN0Lk1vZGVsLCBhY3QudmFyaWFibGVTZXR0aW5ncyk7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0NhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuTXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3NdID0gYWN0Lkxvb3BDaGFyYWN0ZXJpc3RpY3M7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtiYXNpY1Byb3BlcnR5LCBhY3Rpdml0eVByb3BlcnR5XSxcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhOiBwcm9wZXJ0eURhdGFcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUHJvcHMob2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBzdWJQcm9jZXNzID0gdGhpcy5mbG93RWxlbWVudDtcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eUlkOiBzdHJpbmcgPSBvYmoucHJvcGVydHlJRDtcclxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5SWQpIHtcclxuICAgICAgICAgICAgY2FzZSBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLmNhbGxBY3Rpdml0eVN1YlByb2Nlc3M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN1YlByb2Nlc3NDb25maWcoc3ViUHJvY2Vzcywgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuQmFja1dhcmRSdWxlOlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCYWNrV2FyZFJ1bGUoc3ViUHJvY2Vzcywgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMudmFyaWFibGVTZXR0aW5nczpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVmFyaWFibGVTZXR0aW5ncyhzdWJQcm9jZXNzLCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5NdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljczpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpYyhzdWJQcm9jZXNzLCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBzdXBlci51cGRhdGVQcm9wcyhvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVN1YlByb2Nlc3NDb25maWcoc3ViUHJvY2VzczogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzcywgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBjb25maWc6IGFueSA9IG9iai5wcm9wZXJ0eVZhbHVlO1xyXG4gICAgICAgIGlmIChzdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgIHN1YlByb2Nlc3MuY2FsbGVkQml6RGVmS2V5ID0gY29uZmlnLmNhbGxlZEJpekRlZktleTtcclxuICAgICAgICAgICAgc3ViUHJvY2Vzcy5DYWxsZWRFbGVtZW50ID0gY29uZmlnLmNhbGxlZEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHN1YlByb2Nlc3MuaW5oZXJpdEJpekRhdGFJZCA9IGNvbmZpZy5pbmhlcml0Qml6RGF0YUlkO1xyXG4gICAgICAgICAgICBzdWJQcm9jZXNzLmluaGVyaXRWYXJpYWJsZXMgPSBjb25maWcuaW5oZXJpdFZhcmlhYmxlcztcclxuICAgICAgICAgICAgc3ViUHJvY2Vzcy5iaXpEYXRhSWQgPSBjb25maWcuYml6RGF0YUlkO1xyXG4gICAgICAgICAgICBzdWJQcm9jZXNzLmFpZlByb2Nlc3NDb2RlID0gY29uZmlnLmFpZlByb2Nlc3NDb2RlO1xyXG4gICAgICAgICAgICBzdWJQcm9jZXNzLnVzZUF1dG9DcmVhdGlvbkRhdGEgPSBjb25maWcudXNlQXV0b0NyZWF0aW9uRGF0YTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlQmFja1dhcmRSdWxlKHN1YlByb2Nlc3M6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IG9iai5wcm9wZXJ0eVZhbHVlO1xyXG4gICAgICAgIGxldCBiYWNrV2FyZFJ1bGUgPSBuZXcgQmFja1dhcmRSdWxlKHN1YlByb2Nlc3MuTW9kZWwpO1xyXG4gICAgICAgIGJhY2tXYXJkUnVsZS5UYXJnZXRSZWYgPSBkYXRhLlRhcmdldFJlZjtcclxuICAgICAgICBiYWNrV2FyZFJ1bGUuU2VsZWN0VGFyZ2V0QWJsZSA9IGRhdGEuU2VsZWN0VGFyZ2V0QWJsZTtcclxuICAgICAgICBiYWNrV2FyZFJ1bGUuV2FpdFJldHVybiA9IGRhdGEuV2FpdFJldHVybjtcclxuICAgICAgICBiYWNrV2FyZFJ1bGUuUmVzdWJtaXRFZmZlY3QgPSBkYXRhLlJlc3VibWl0RWZmZWN0O1xyXG4gICAgICAgIGJhY2tXYXJkUnVsZS5EeW5hbWljQmFja1dhcmRSdWxlQWJsZSA9IGRhdGEuRHluYW1pY0JhY2tXYXJkUnVsZUFibGU7XHJcbiAgICAgICAgYmFja1dhcmRSdWxlLlNlbGVjdFRhcmdldExpc3QgPSBkYXRhLlNlbGVjdFRhcmdldExpc3Q7XHJcblxyXG4gICAgICAgIHN1YlByb2Nlc3MuYmFja1dhcmRSdWxlID0gYmFja1dhcmRSdWxlO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVZhcmlhYmxlU2V0dGluZ3Moc3ViUHJvY2VzczogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzcywgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBicG1uTW9kZWwgPSB0aGlzLmZsb3dFbGVtZW50Lk1vZGVsO1xyXG4gICAgICAgIGNvbnN0IGV4dGVuZEVsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEV4dGVuc2lvbkVsZW1lbnRzKCk7XHJcbiAgICAgICAgaWYgKHN1YlByb2Nlc3MudmFyaWFibGVTZXR0aW5ncyAmJiBzdWJQcm9jZXNzLnZhcmlhYmxlU2V0dGluZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2Ygc3ViUHJvY2Vzcy52YXJpYWJsZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi50YWcgPT09ICdjb21wb25lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGV4dGVuZEVsZW1lbnRzLmZpbmRJbmRleChlID0+IChlIGluc3RhbmNlb2YgQ29tcG9uZW50ICYmIGUuSWQgPT09IHYudmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgc3ViUHJvY2Vzcy52YXJpYWJsZVNldHRpbmdzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHZhcmlhYmxlcyA9IG9iai5wcm9wZXJ0eVZhbHVlIGFzIGFueVtdO1xyXG4gICAgICAgIGlmICh2YXJpYWJsZXMgJiYgdmFyaWFibGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHZhcmlhYmxlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGVTZXR0aW5nID0gbmV3IFZhcmlhYmxlU2V0dGluZyhicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFyaWFibGVTZXR0aW5nLnZhcmlhYmxlSWQgPSB2LnZhcmlhYmxlSWQ7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVDb2RlID0gdi52YXJpYWJsZUNvZGU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVOYW1lID0gdi52YXJpYWJsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudGFnID0gdi50YWc7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcuZXhlY3V0aW9uVGltZSA9IHYuZXhlY3V0aW9uVGltZTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy52YWx1ZSA9IHYudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFsdWVUZXh0ID0gdi52YWx1ZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgc3ViUHJvY2Vzcy52YXJpYWJsZVNldHRpbmdzLnB1c2godmFyaWFibGVTZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZVNldHRpbmcudGFnID09PSAnY29tcG9uZW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB2LmNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3B0ID0gbmV3IENvbXBvbmVudChicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuTWV0YWRhdGFJZCA9IGMuTWV0YWRhdGFJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0Lk1ldGhvZENvZGUgPSBjLk1ldGhvZENvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5JZCA9IGMuSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5OYW1lID0gYy5OYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuQWN0dWFsUGFyYW1ldGVycyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5BY3R1YWxQYXJhbWV0ZXJzICYmIGMuQWN0dWFsUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhIG9mIGMuQWN0dWFsUGFyYW1ldGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXJhbWV0ZXIgPSBuZXcgQWN0dWFsUGFyYW1ldGVyKGJwbW5Nb2RlbCwgYS5OYW1lLCBhLlZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXIuVGFnID0gYS5UYWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B0LkFjdHVhbFBhcmFtZXRlcnMucHVzaChwYXJhbWV0ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5wdXNoKGNwdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZU11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWMoc3ViUHJvY2VzczogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzcywgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gb2JqLnByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgbGV0IGxvb3BDaGFyYWN0ZXJpc3RpY3MgPSBuZXcgTXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3Moc3ViUHJvY2Vzcy5Nb2RlbCk7XHJcbiAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5lbmFibGUgPSBkYXRhLmVuYWJsZTtcclxuICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLnNlcXVlbnRpYWwgPSBkYXRhLnNlcXVlbnRpYWw7XHJcbiAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5sb29wQ2FyZGluYWxpdHkgPSBkYXRhLmxvb3BDYXJkaW5hbGl0eTtcclxuICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb24gPSBkYXRhLmNvbXBsZXRpb25Db25kaXRpb247XHJcbiAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXMgPSBkYXRhLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcztcclxuXHJcbiAgICAgICAgc3ViUHJvY2Vzcy5Mb29wQ2hhcmFjdGVyaXN0aWNzID0gbG9vcENoYXJhY3RlcmlzdGljcztcclxuICAgICAgICBpZihvYmoucHJvcGVydHlWYWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gb2JqLnByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgICAgIGxldCBsb29wQ2hhcmFjdGVyaXN0aWNzID0gbmV3IE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzKHN1YlByb2Nlc3MuTW9kZWwpO1xyXG4gICAgICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLmVuYWJsZSA9IGRhdGEuZW5hYmxlO1xyXG4gICAgICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLnNlcXVlbnRpYWwgPSBkYXRhLnNlcXVlbnRpYWw7XHJcbiAgICAgICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MubG9vcENhcmRpbmFsaXR5ID0gbmV3IEV4cHJlc3Npb24oc3ViUHJvY2Vzcy5Nb2RlbCk7XHJcbiAgICAgICAgICAgIGlmKGRhdGEubG9vcENhcmRpbmFsaXR5KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFyaWFibGVFeHByZXNzaW9uID0gbmV3IFNlbWFudGljRXhwcmVzc2lvbihzdWJQcm9jZXNzLk1vZGVsKTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlRXhwcmVzc2lvbi5WYWx1ZSA9IGRhdGEubG9vcENhcmRpbmFsaXR5O1xyXG4gICAgICAgICAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5sb29wQ2FyZGluYWxpdHkuTWV4RXhwcmVzc2lvbiA9IHZhcmlhYmxlRXhwcmVzc2lvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb24gPSBkYXRhLmNvbXBsZXRpb25Db25kaXRpb247XHJcbiAgICAgICAgICAgIGxldCBydWxlcyA9IGRhdGEuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzIGFzIGFueVtdO1xyXG4gICAgICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcyA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmKHJ1bGVzICYmIHJ1bGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzID0gbmV3IEFycmF5PENvdW50ZXJTaWduUnVsZT4oKTtcclxuICAgICAgICAgICAgICAgIGZvcihsZXQgcnVsZSBvZiBydWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjb3VudGVyU2lnblJ1bGUgPSBuZXcgQ291bnRlclNpZ25SdWxlKHN1YlByb2Nlc3MuTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjb25kaXRpb24gPSBuZXcgQ29uZGl0aW9uKHN1YlByb2Nlc3MuTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbi5WYWx1ZSA9IHJ1bGUuQ29tcGxldGlvbkNvbmRpdGlvbi5WYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudGVyU2lnblJ1bGUuQ29uY2x1c2lvblZhbHVlID0gcnVsZS5Db25jbHVzaW9uVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlclNpZ25SdWxlLkNhbGN1bGF0ZVR5cGUgPSBydWxlLkNhbGN1bGF0ZVR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlclNpZ25SdWxlLkNvbmRpdGlvblZhbHVlID0gcnVsZS5Db25kaXRpb25WYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudGVyU2lnblJ1bGUuV2FpdEFsbFZvdGVzID0gcnVsZS5XYWl0QWxsVm90ZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlclNpZ25SdWxlLkNvbXBsZXRpb25Db25kaXRpb24gPSBjb25kaXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXMucHVzaChjb3VudGVyU2lnblJ1bGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN1YlByb2Nlc3MuTG9vcENoYXJhY3RlcmlzdGljcyA9IGxvb3BDaGFyYWN0ZXJpc3RpY3M7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
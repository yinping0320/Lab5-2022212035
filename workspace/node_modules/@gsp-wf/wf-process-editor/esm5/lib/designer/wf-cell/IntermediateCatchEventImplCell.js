/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { Signal } from "@edp-pmf/bpmn-model";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { IntermediateCatchEventImpl, Component, BackWardRule, ActualParameter, VariableSetting, SignalEventDefinitionImpl } from "@gsp-wf/wf-process-model";
import { PropertyHelper } from "./PropertyHelper";
import { BpmnModelHelper, FlowNodeState } from "@edp-pmf/bpmn-model";
import { WfConstants } from "../WfConstants";
import { IntermediateCatchEventImplPropertyKeys } from "./property-keys/IntermediateCatchEventImplPropertyKeys";
/**
 * 信号捕获活动节点
 */
var IntermediateCatchEventImplCell = /** @class */ (function (_super) {
    tslib_1.__extends(IntermediateCatchEventImplCell, _super);
    function IntermediateCatchEventImplCell(value, geometry, style) {
        var _a;
        var _this = _super.call(this, value, geometry, style) || this;
        _this.clrTypeId = IntermediateCatchEventImplCell.CLR_TYPE_ID;
        _this.name = "信号捕获";
        _this.nameLanguage = {
            "zh-CHS": "信号捕获",
            "zh-CHT": "訊號捕獲",
            "en": "Acquisition",
        };
        _this.imgUrls = (_a = {},
            _a[FlowNodeState.Default] = WfConstants.IMAGE_PATH + "/catchEvent.png",
            _a[FlowNodeState.Selected] = WfConstants.IMAGE_PATH + "/catchEvent_select.svg",
            _a);
        return _this;
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.createFlowElement = /**
     * @param {?=} flowElt
     * @return {?}
     */
    function (flowElt) {
        /** @type {?} */
        var flowNode = (/** @type {?} */ (_super.prototype.createFlowElement.call(this, flowElt)));
        flowNode.Id = "IntermediateCatchEvent" + BpmnModelHelper.GenerateElementId();
        // 创建而非复制时执行
        if (flowElt == null) {
            flowNode.initEventDefinitions();
        }
        return flowNode;
    };
    /**
     * @param {?=} flowElt
     * @param {?=} diagElt
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.bindBpmnModel = /**
     * @param {?=} flowElt
     * @param {?=} diagElt
     * @return {?}
     */
    function (flowElt, diagElt) {
        _super.prototype.bindBpmnModel.call(this, flowElt, diagElt);
        /** @type {?} */
        var bpmnModel = this.editorUi.graph.bpmnModel;
        this.addSignals(this.flowElement);
    };
    /**
     * @param {?} catchEvent
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.addSignals = /**
     * @param {?} catchEvent
     * @return {?}
     */
    function (catchEvent) {
        var e_1, _a;
        /** @type {?} */
        var bpmnModel = catchEvent.Model;
        if (catchEvent.EventDefinitions && catchEvent.EventDefinitions.length > 0) {
            if (!bpmnModel.signals) {
                bpmnModel.signals = [];
            }
            var _loop_1 = function (e) {
                /** @type {?} */
                var event_1 = (/** @type {?} */ (e));
                if (bpmnModel.signals.findIndex((/**
                 * @param {?} s
                 * @return {?}
                 */
                function (s) { return s.Name === event_1.SignalRef; })) === -1) {
                    /** @type {?} */
                    var signal = new Signal(bpmnModel);
                    signal.Name = event_1.SignalRef;
                    bpmnModel.signals.push(signal);
                }
            };
            try {
                for (var _b = tslib_1.__values(catchEvent.EventDefinitions), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var e = _c.value;
                    _loop_1(e);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    /**
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.getFarrisPropConfig = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var act = this.flowElement;
        /** @type {?} */
        var basicProperty = new ElementPropertyConfig();
        /** @type {?} */
        var activityProperty = new ElementPropertyConfig();
        /** @type {?} */
        var propertyData = {};
        basicProperty.categoryId = 'basicProperty';
        basicProperty.categoryName = mxResources.get('basicInformation');
        basicProperty.tabId = 'basic';
        basicProperty.tabName = mxResources.get('basicAttributes');
        basicProperty.properties = [
            { propertyID: IntermediateCatchEventImplPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: IntermediateCatchEventImplPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: IntermediateCatchEventImplPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        activityProperty.categoryId = 'activityProperty';
        activityProperty.categoryName = mxResources.get('activityProperty');
        activityProperty.tabId = 'basic';
        activityProperty.tabName = mxResources.get('basicAttributes');
        activityProperty.properties = [
            { propertyID: IntermediateCatchEventImplPropertyKeys.EventDefinitions, propertyName: mxResources.get('eventDefinitions'), propertyType: 'modal' },
            { propertyID: IntermediateCatchEventImplPropertyKeys.variableSettings, propertyName: mxResources.get('variableSettings'), propertyType: 'modal' }
        ];
        if (act.EventDefinitions && this.isBackEventExist(act.EventDefinitions)) {
            activityProperty.properties.push({ propertyID: IntermediateCatchEventImplPropertyKeys.BackWardRule, propertyName: mxResources.get('backWardRule'), propertyType: 'modal' });
            propertyData[IntermediateCatchEventImplPropertyKeys.BackWardRule] = act.backWardRule;
        }
        propertyData[IntermediateCatchEventImplPropertyKeys.Id] = act.Id;
        propertyData[IntermediateCatchEventImplPropertyKeys.ClrTypeID] = act.ClrTypeID;
        propertyData[IntermediateCatchEventImplPropertyKeys.Name] = act.Name;
        propertyData[IntermediateCatchEventImplPropertyKeys.NameLanguage] = act.NameLanguage || {
            "zh-CHS": act.Name,
        };
        propertyData[IntermediateCatchEventImplPropertyKeys.EventDefinitions] = act.EventDefinitions;
        propertyData[IntermediateCatchEventImplPropertyKeys.variableSettings] = PropertyHelper.getVariableSettings(act.Model, act.variableSettings);
        return {
            propertyConfig: [basicProperty, activityProperty],
            propertyData: propertyData
        };
    };
    /**
     * 判断是否存在反向事件
     * @param
     */
    /**
     * 判断是否存在反向事件
     * @param {?} events
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.isBackEventExist = /**
     * 判断是否存在反向事件
     * @param {?} events
     * @return {?}
     */
    function (events) {
        var e_2, _a;
        try {
            for (var events_1 = tslib_1.__values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {
                var e = events_1_1.value;
                /** @type {?} */
                var event_2 = (/** @type {?} */ (e));
                if (event_2.triggerAction === 'Back') {
                    return true;
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return false;
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.updateProps = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var catchEvent = this.flowElement;
        /** @type {?} */
        var propertyId = obj.propertyID;
        switch (propertyId) {
            case IntermediateCatchEventImplPropertyKeys.EventDefinitions:
                this.updateEventDefinitions(catchEvent, obj);
                break;
            case IntermediateCatchEventImplPropertyKeys.BackWardRule:
                this.updateBackWardRule(catchEvent, obj);
                break;
            case IntermediateCatchEventImplPropertyKeys.variableSettings:
                this.updateVariableSettings(catchEvent, obj);
                break;
            default:
                _super.prototype.updateProps.call(this, obj);
                break;
        }
    };
    /**
     * @param {?} catchEvent
     * @param {?} obj
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.updateEventDefinitions = /**
     * @param {?} catchEvent
     * @param {?} obj
     * @return {?}
     */
    function (catchEvent, obj) {
        var e_3, _a;
        if (catchEvent) {
            this.removeSignals(catchEvent);
            /** @type {?} */
            var events = (/** @type {?} */ (obj.propertyValue));
            catchEvent.EventDefinitions = new Array();
            try {
                for (var events_2 = tslib_1.__values(events), events_2_1 = events_2.next(); !events_2_1.done; events_2_1 = events_2.next()) {
                    var e = events_2_1.value;
                    /** @type {?} */
                    var item = new SignalEventDefinitionImpl(catchEvent.Model);
                    item.name = e.name;
                    item.triggerAction = e.triggerAction;
                    item.Async = false;
                    item.SignalRef = e.SignalRef;
                    catchEvent.EventDefinitions.push(item);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (events_2_1 && !events_2_1.done && (_a = events_2.return)) _a.call(events_2);
                }
                finally { if (e_3) throw e_3.error; }
            }
            this.addSignals(catchEvent);
        }
        // 判断审批项是否包含驳回？不包含时，驳回规则清空
        if (!this.isBackEventExist(catchEvent.EventDefinitions)) {
            catchEvent.backWardRule = null;
        }
        else if (!catchEvent.backWardRule) {
            catchEvent.backWardRule = new BackWardRule(catchEvent.Model);
        }
        // 更新属性框
        // Utils.postMessage(ResourceKeys.wf_showProperty, this.getPropConfig());
    };
    /**
     * @param {?} catchEvent
     * @param {?} obj
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.updateBackWardRule = /**
     * @param {?} catchEvent
     * @param {?} obj
     * @return {?}
     */
    function (catchEvent, obj) {
        /** @type {?} */
        var data = obj.propertyValue;
        /** @type {?} */
        var backWardRule = new BackWardRule(catchEvent.Model);
        backWardRule.TargetRef = data.TargetRef;
        backWardRule.SelectTargetAble = data.SelectTargetAble;
        backWardRule.WaitReturn = data.WaitReturn;
        backWardRule.ResubmitEffect = data.ResubmitEffect;
        backWardRule.DynamicBackWardRuleAble = data.DynamicBackWardRuleAble;
        backWardRule.SelectTargetList = data.SelectTargetList;
        catchEvent.backWardRule = backWardRule;
    };
    /**
     * @param {?} catchEvent
     * @param {?} obj
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.updateVariableSettings = /**
     * @param {?} catchEvent
     * @param {?} obj
     * @return {?}
     */
    function (catchEvent, obj) {
        var e_4, _a, e_5, _b, e_6, _c;
        /** @type {?} */
        var bpmnModel = catchEvent.Model;
        /** @type {?} */
        var extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        if (catchEvent.variableSettings && catchEvent.variableSettings.length > 0) {
            var _loop_2 = function (v) {
                if (v.tag === 'component') {
                    /** @type {?} */
                    var i = extendElements.findIndex((/**
                     * @param {?} e
                     * @return {?}
                     */
                    function (e) { return (e instanceof Component && e.Id === v.value); }));
                    extendElements.splice(i, 1);
                }
            };
            try {
                for (var _d = tslib_1.__values(catchEvent.variableSettings), _e = _d.next(); !_e.done; _e = _d.next()) {
                    var v = _e.value;
                    _loop_2(v);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        catchEvent.variableSettings = new Array();
        /** @type {?} */
        var variables = (/** @type {?} */ (obj.propertyValue));
        if (variables && variables.length > 0) {
            try {
                for (var variables_1 = tslib_1.__values(variables), variables_1_1 = variables_1.next(); !variables_1_1.done; variables_1_1 = variables_1.next()) {
                    var v = variables_1_1.value;
                    /** @type {?} */
                    var variableSetting = new VariableSetting(bpmnModel);
                    // variableSetting.variableId = v.variableId;
                    variableSetting.variableCode = v.variableCode;
                    variableSetting.variableName = v.variableName;
                    variableSetting.tag = v.tag;
                    variableSetting.executionTime = v.executionTime;
                    variableSetting.value = v.value;
                    variableSetting.valueText = v.valueText;
                    catchEvent.variableSettings.push(variableSetting);
                    if (variableSetting.tag === 'component') {
                        /** @type {?} */
                        var c = v.component;
                        if (c) {
                            /** @type {?} */
                            var cpt = new Component(bpmnModel);
                            cpt.MetadataId = c.MetadataId;
                            cpt.MethodCode = c.MethodCode;
                            cpt.Id = c.Id;
                            cpt.Name = c.Name;
                            cpt.ActualParameters = new Array();
                            if (c.ActualParameters && c.ActualParameters.length > 0) {
                                try {
                                    for (var _f = tslib_1.__values(c.ActualParameters), _g = _f.next(); !_g.done; _g = _f.next()) {
                                        var a = _g.value;
                                        /** @type {?} */
                                        var parameter = new ActualParameter(bpmnModel, a.Name, a.Value);
                                        parameter.Tag = a.Tag;
                                        cpt.ActualParameters.push(parameter);
                                    }
                                }
                                catch (e_6_1) { e_6 = { error: e_6_1 }; }
                                finally {
                                    try {
                                        if (_g && !_g.done && (_c = _f.return)) _c.call(_f);
                                    }
                                    finally { if (e_6) throw e_6.error; }
                                }
                            }
                            extendElements.push(cpt);
                        }
                    }
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (variables_1_1 && !variables_1_1.done && (_b = variables_1.return)) _b.call(variables_1);
                }
                finally { if (e_5) throw e_5.error; }
            }
        }
    };
    /**
     * @param {?} catchEvent
     * @return {?}
     */
    IntermediateCatchEventImplCell.prototype.removeSignals = /**
     * @param {?} catchEvent
     * @return {?}
     */
    function (catchEvent) {
        var e_7, _a, e_8, _b;
        /** @type {?} */
        var bpmnModel = catchEvent.Model;
        if (catchEvent.EventDefinitions && catchEvent.EventDefinitions.length > 0) {
            /** @type {?} */
            var flowElements = bpmnModel.DefaultProcess.GetFlowElements();
            /** @type {?} */
            var eventDefs = new Map();
            for (var key in flowElements) {
                if (flowElements[key] instanceof IntermediateCatchEventImpl && flowElements[key].Id !== catchEvent.Id) {
                    /** @type {?} */
                    var catchEvent_1 = (/** @type {?} */ (flowElements[key]));
                    try {
                        for (var _c = tslib_1.__values(catchEvent_1.EventDefinitions), _d = _c.next(); !_d.done; _d = _c.next()) {
                            var e = _d.value;
                            /** @type {?} */
                            var event_3 = (/** @type {?} */ (e));
                            if (!eventDefs.get(event_3.SignalRef)) {
                                eventDefs.set(event_3.SignalRef, event_3);
                            }
                        }
                    }
                    catch (e_7_1) { e_7 = { error: e_7_1 }; }
                    finally {
                        try {
                            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                        }
                        finally { if (e_7) throw e_7.error; }
                    }
                }
            }
            var _loop_3 = function (e) {
                /** @type {?} */
                var eventDef = (/** @type {?} */ (e));
                if (!eventDefs.get(eventDef.SignalRef)) {
                    /** @type {?} */
                    var i = bpmnModel.signals.findIndex((/**
                     * @param {?} s
                     * @return {?}
                     */
                    function (s) { return s.Name === eventDef.SignalRef; }));
                    if (i > -1) {
                        bpmnModel.signals.splice(i, 1);
                    }
                }
            };
            try {
                for (var _e = tslib_1.__values(catchEvent.EventDefinitions), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var e = _f.value;
                    _loop_3(e);
                }
            }
            catch (e_8_1) { e_8 = { error: e_8_1 }; }
            finally {
                try {
                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                }
                finally { if (e_8) throw e_8.error; }
            }
        }
    };
    IntermediateCatchEventImplCell.CLR_TYPE_ID = IntermediateCatchEventImpl.Clr_Type_ID;
    return IntermediateCatchEventImplCell;
}(NodeCell));
export { IntermediateCatchEventImplCell };
if (false) {
    /** @type {?} */
    IntermediateCatchEventImplCell.CLR_TYPE_ID;
    /** @type {?} */
    IntermediateCatchEventImplCell.prototype.clrTypeId;
    /** @type {?} */
    IntermediateCatchEventImplCell.prototype.name;
    /** @type {?} */
    IntermediateCatchEventImplCell.prototype.nameLanguage;
    /** @type {?} */
    IntermediateCatchEventImplCell.prototype.flowElement;
    /** @type {?} */
    IntermediateCatchEventImplCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxDZWxsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9kZXNpZ25lci93Zi1jZWxsL0ludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsQ2VsbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUscUJBQXFCLEVBQTRCLE1BQU0sc0JBQXNCLENBQUM7QUFDakcsT0FBTyxFQUFFLE1BQU0sRUFBOEIsTUFBTSxxQkFBcUIsQ0FBQztBQUN6RSxPQUFPLEVBQWEsV0FBVyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDN0QsT0FBTyxFQUFFLDBCQUEwQixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzVKLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsc0NBQXNDLEVBQUUsTUFBTSx3REFBd0QsQ0FBQzs7OztBQUtoSDtJQUFvRCwwREFBUTtJQWdCeEQsd0NBQVksS0FBVyxFQUFFLFFBQStCLEVBQUUsS0FBYzs7UUFBeEUsWUFDSSxrQkFBTSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxTQUNoQztRQWpCRCxlQUFTLEdBQVcsOEJBQThCLENBQUMsV0FBVyxDQUFDO1FBQy9ELFVBQUksR0FBVyxNQUFNLENBQUM7UUFDdEIsa0JBQVksR0FBZ0M7WUFDMUMsUUFBUSxFQUFFLE1BQU07WUFDaEIsUUFBUSxFQUFFLE1BQU07WUFDaEIsSUFBSSxFQUFFLGFBQWE7U0FDdEIsQ0FBQztRQUlBLGFB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LEdBQUcsQ0FBQyxPQUFLLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0NBQ2pDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBSyxDQUFDLFNBQVMsRUFBRSxPQUFLLENBQUMsQ0FBQzs2QkFDekM7eUJBQ0o7Ozs7Ozs7OztpQkFDSjthQUNKO29DQUNVLENBQUM7O29CQUNGLFFBQVEsR0FBRyxtQkFBQSxDQUFDLEVBQTZCO2dCQUMvQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUU7O3dCQUM5QixDQUFDLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxTQUFTOzs7O29CQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsU0FBUyxFQUE3QixDQUE2QixFQUFDO29CQUN6RSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTt3QkFDUixTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7cUJBQ2xDO2lCQUNKOzs7Z0JBUEwsS0FBZ0IsSUFBQSxLQUFBLGlCQUFBLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQSxnQkFBQTtvQkFBdEMsSUFBTSxDQUFDLFdBQUE7NEJBQUQsQ0FBQztpQkFRWDs7Ozs7Ozs7O1NBQ0o7SUFDTCxDQUFDO0lBblBNLDBDQUFXLEdBQVcsMEJBQTBCLENBQUMsV0FBVyxDQUFDO0lBb1B4RSxxQ0FBQztDQUFBLEFBNVBELENBQW9ELFFBQVEsR0E0UDNEO1NBNVBZLDhCQUE4Qjs7O0lBUXZDLDJDQUFvRTs7SUFQcEUsbURBQStEOztJQUMvRCw4Q0FBc0I7O0lBQ3RCLHNEQUlBOztJQUVBLHFEQUF3Qzs7SUFFeEMsaURBR0UiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOb2RlQ2VsbCwgRWxlbWVudFByb3BlcnR5Q29uZmlnLCBGYXJyaXNQcm9wQ29uZmlnV2l0aERhdGEgfSBmcm9tIFwiQGVkcC1wbWYvZ3JhcGhlZGl0b3JcIjtcclxuaW1wb3J0IHsgU2lnbmFsLCBFdmVudERlZmluaXRpb24sIEJQTU5TaGFwZSB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IE14R3JhcGhOUywgbXhSZXNvdXJjZXMgfSBmcm9tIFwiQGVkcC1wbWYvbXhncmFwaC10c1wiO1xyXG5pbXBvcnQgeyBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCwgQ29tcG9uZW50LCBCYWNrV2FyZFJ1bGUsIEFjdHVhbFBhcmFtZXRlciwgVmFyaWFibGVTZXR0aW5nLCBTaWduYWxFdmVudERlZmluaXRpb25JbXBsIH0gZnJvbSBcIkBnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbFwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUhlbHBlciB9IGZyb20gXCIuL1Byb3BlcnR5SGVscGVyXCI7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEhlbHBlciwgRmxvd05vZGVTdGF0ZSB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IFdmQ29uc3RhbnRzIH0gZnJvbSBcIi4uL1dmQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzIH0gZnJvbSBcIi4vcHJvcGVydHkta2V5cy9JbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbFByb3BlcnR5S2V5c1wiO1xyXG5cclxuLyoqXHJcbiAqIOS/oeWPt+aNleiOt+a0u+WKqOiKgueCuVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsQ2VsbCBleHRlbmRzIE5vZGVDZWxsIHtcclxuICAgIGNsclR5cGVJZDogc3RyaW5nID0gSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxDZWxsLkNMUl9UWVBFX0lEO1xyXG4gICAgbmFtZTogc3RyaW5nID0gXCLkv6Hlj7fmjZXojrdcIjtcclxuICAgIG5hbWVMYW5ndWFnZTogeyBbbGFuZzogc3RyaW5nXTogc3RyaW5nOyB9ID0ge1xyXG4gICAgICBcInpoLUNIU1wiOiBcIuS/oeWPt+aNleiOt1wiLFxyXG4gICAgICBcInpoLUNIVFwiOiBcIuioiuiZn+aNleeNslwiLFxyXG4gICAgICBcImVuXCI6IFwiQWNxdWlzaXRpb25cIixcclxuICB9O1xyXG4gICAgc3RhdGljIENMUl9UWVBFX0lEOiBzdHJpbmcgPSBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbC5DbHJfVHlwZV9JRDtcclxuICAgIGZsb3dFbGVtZW50OiBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbDtcclxuXHJcbiAgICBpbWdVcmxzID0ge1xyXG4gICAgICAgIFtGbG93Tm9kZVN0YXRlLkRlZmF1bHRdOiBXZkNvbnN0YW50cy5JTUFHRV9QQVRIICsgXCIvY2F0Y2hFdmVudC5wbmdcIixcclxuICAgICAgICBbRmxvd05vZGVTdGF0ZS5TZWxlY3RlZF06IFdmQ29uc3RhbnRzLklNQUdFX1BBVEggKyBcIi9jYXRjaEV2ZW50X3NlbGVjdC5zdmdcIixcclxuICAgIH07XHJcblxyXG4gICAgY29uc3RydWN0b3IodmFsdWU/OiBhbnksIGdlb21ldHJ5PzogTXhHcmFwaE5TLm14R2VvbWV0cnksIHN0eWxlPzogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIodmFsdWUsIGdlb21ldHJ5LCBzdHlsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRmxvd0VsZW1lbnQoZmxvd0VsdD86IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsKSB7XHJcbiAgICAgICAgY29uc3QgZmxvd05vZGUgPSBzdXBlci5jcmVhdGVGbG93RWxlbWVudChmbG93RWx0KSBhcyBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbDtcclxuICAgICAgICBmbG93Tm9kZS5JZCA9IFwiSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudFwiICsgQnBtbk1vZGVsSGVscGVyLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcbiAgICAgICAgLy8g5Yib5bu66ICM6Z2e5aSN5Yi25pe25omn6KGMXHJcbiAgICAgICAgaWYgKGZsb3dFbHQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmbG93Tm9kZS5pbml0RXZlbnREZWZpbml0aW9ucygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZsb3dOb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRCcG1uTW9kZWwoZmxvd0VsdD86IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsLCBkaWFnRWx0PzogQlBNTlNoYXBlKTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIuYmluZEJwbW5Nb2RlbChmbG93RWx0LCBkaWFnRWx0KTtcclxuXHJcbiAgICAgICAgY29uc3QgYnBtbk1vZGVsID0gdGhpcy5lZGl0b3JVaS5ncmFwaC5icG1uTW9kZWw7XHJcbiAgICAgICAgdGhpcy5hZGRTaWduYWxzKHRoaXMuZmxvd0VsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFNpZ25hbHMoY2F0Y2hFdmVudDogSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwpIHtcclxuICAgICAgICBjb25zdCBicG1uTW9kZWwgPSBjYXRjaEV2ZW50Lk1vZGVsO1xyXG4gICAgICAgIGlmIChjYXRjaEV2ZW50LkV2ZW50RGVmaW5pdGlvbnMgJiYgY2F0Y2hFdmVudC5FdmVudERlZmluaXRpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgaWYgKCFicG1uTW9kZWwuc2lnbmFscykge1xyXG4gICAgICAgICAgICAgICAgYnBtbk1vZGVsLnNpZ25hbHMgPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgY2F0Y2hFdmVudC5FdmVudERlZmluaXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9IGUgYXMgU2lnbmFsRXZlbnREZWZpbml0aW9uSW1wbDtcclxuICAgICAgICAgICAgICAgIGlmIChicG1uTW9kZWwuc2lnbmFscy5maW5kSW5kZXgocyA9PiBzLk5hbWUgPT09IGV2ZW50LlNpZ25hbFJlZikgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2lnbmFsID0gbmV3IFNpZ25hbChicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNpZ25hbC5OYW1lID0gZXZlbnQuU2lnbmFsUmVmO1xyXG4gICAgICAgICAgICAgICAgICAgIGJwbW5Nb2RlbC5zaWduYWxzLnB1c2goc2lnbmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRGYXJyaXNQcm9wQ29uZmlnKCk6IEZhcnJpc1Byb3BDb25maWdXaXRoRGF0YSB7XHJcbiAgICAgICAgbGV0IGFjdCA9IHRoaXMuZmxvd0VsZW1lbnQ7XHJcblxyXG4gICAgICAgIGxldCBiYXNpY1Byb3BlcnR5OiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IGFjdGl2aXR5UHJvcGVydHk6IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZyA9IG5ldyBFbGVtZW50UHJvcGVydHlDb25maWcoKTtcclxuICAgICAgICBsZXQgcHJvcGVydHlEYXRhOiBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS5jYXRlZ29yeUlkID0gJ2Jhc2ljUHJvcGVydHknO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0luZm9ybWF0aW9uJyk7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS50YWJJZCA9ICdiYXNpYyc7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS50YWJOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0F0dHJpYnV0ZXMnKTtcclxuICAgICAgICBiYXNpY1Byb3BlcnR5LnByb3BlcnRpZXMgPSBbXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxQcm9wZXJ0eUtleXMuTmFtZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWUnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgdmlzaWJsZTogIXRoaXMuZWRpdG9yVWkubXVsdGlMYW5nRW5hYmxlZCB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWVMYW5ndWFnZScpLCBwcm9wZXJ0eVR5cGU6ICdtdWx0aUxhbmd1YWdlJywgdmlzaWJsZTogdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxQcm9wZXJ0eUtleXMuSWQsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdpZCcpLCBwcm9wZXJ0eVR5cGU6ICdzdHJpbmcnLCByZWFkb25seTogdHJ1ZSB9XHJcbiAgICAgICAgXTtcclxuXHJcblxyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkuY2F0ZWdvcnlJZCA9ICdhY3Rpdml0eVByb3BlcnR5JztcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LmNhdGVnb3J5TmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYWN0aXZpdHlQcm9wZXJ0eScpO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkudGFiSWQgPSAnYmFzaWMnO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkudGFiTmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNBdHRyaWJ1dGVzJyk7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLkV2ZW50RGVmaW5pdGlvbnMsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdldmVudERlZmluaXRpb25zJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3MsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCd2YXJpYWJsZVNldHRpbmdzJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICBpZiAoYWN0LkV2ZW50RGVmaW5pdGlvbnMgJiYgdGhpcy5pc0JhY2tFdmVudEV4aXN0KGFjdC5FdmVudERlZmluaXRpb25zKSkge1xyXG4gICAgICAgICAgICBhY3Rpdml0eVByb3BlcnR5LnByb3BlcnRpZXMucHVzaChcclxuICAgICAgICAgICAgICAgIHsgcHJvcGVydHlJRDogSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxQcm9wZXJ0eUtleXMuQmFja1dhcmRSdWxlLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnYmFja1dhcmRSdWxlJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbFByb3BlcnR5S2V5cy5CYWNrV2FyZFJ1bGVdID0gYWN0LmJhY2tXYXJkUnVsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3BlcnR5RGF0YVtJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbFByb3BlcnR5S2V5cy5JZF0gPSBhY3QuSWQ7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0ludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLkNsclR5cGVJRF0gPSBhY3QuQ2xyVHlwZUlEO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbFByb3BlcnR5S2V5cy5OYW1lXSA9IGFjdC5OYW1lO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbFByb3BlcnR5S2V5cy5OYW1lTGFuZ3VhZ2VdID0gYWN0Lk5hbWVMYW5ndWFnZSB8fCB7XHJcbiAgICAgICAgICAgIFwiemgtQ0hTXCI6IGFjdC5OYW1lLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0ludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLkV2ZW50RGVmaW5pdGlvbnNdID0gYWN0LkV2ZW50RGVmaW5pdGlvbnM7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0ludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3NdID0gUHJvcGVydHlIZWxwZXIuZ2V0VmFyaWFibGVTZXR0aW5ncyhhY3QuTW9kZWwsIGFjdC52YXJpYWJsZVNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtiYXNpY1Byb3BlcnR5LCBhY3Rpdml0eVByb3BlcnR5XSxcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhOiBwcm9wZXJ0eURhdGFcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKTmlq3mmK/lkKblrZjlnKjlj43lkJHkuovku7ZcclxuICAgICAqIEBwYXJhbVxyXG4gICAgICovXHJcbiAgICBpc0JhY2tFdmVudEV4aXN0KGV2ZW50czogRXZlbnREZWZpbml0aW9uW10pIHtcclxuICAgICAgICBmb3IgKGxldCBlIG9mIGV2ZW50cykge1xyXG4gICAgICAgICAgICBjb25zdCBldmVudCA9IGUgYXMgU2lnbmFsRXZlbnREZWZpbml0aW9uSW1wbDtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LnRyaWdnZXJBY3Rpb24gPT09ICdCYWNrJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BzKG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgY2F0Y2hFdmVudCA9IHRoaXMuZmxvd0VsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlJZDogc3RyaW5nID0gb2JqLnByb3BlcnR5SUQ7XHJcbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUlkKSB7XHJcbiAgICAgICAgICAgIGNhc2UgSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxQcm9wZXJ0eUtleXMuRXZlbnREZWZpbml0aW9uczpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRXZlbnREZWZpbml0aW9ucyhjYXRjaEV2ZW50LCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGxQcm9wZXJ0eUtleXMuQmFja1dhcmRSdWxlOlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVCYWNrV2FyZFJ1bGUoY2F0Y2hFdmVudCwgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsUHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZhcmlhYmxlU2V0dGluZ3MoY2F0Y2hFdmVudCwgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgc3VwZXIudXBkYXRlUHJvcHMob2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVFdmVudERlZmluaXRpb25zKGNhdGNoRXZlbnQ6IEludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsLCBvYmo6IGFueSkge1xyXG4gICAgICAgIGlmIChjYXRjaEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlU2lnbmFscyhjYXRjaEV2ZW50KTtcclxuICAgICAgICAgICAgbGV0IGV2ZW50cyA9IG9iai5wcm9wZXJ0eVZhbHVlIGFzIGFueVtdO1xyXG4gICAgICAgICAgICBjYXRjaEV2ZW50LkV2ZW50RGVmaW5pdGlvbnMgPSBuZXcgQXJyYXk8RXZlbnREZWZpbml0aW9uPigpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBlIG9mIGV2ZW50cykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBuZXcgU2lnbmFsRXZlbnREZWZpbml0aW9uSW1wbChjYXRjaEV2ZW50Lk1vZGVsKTtcclxuICAgICAgICAgICAgICAgIGl0ZW0ubmFtZSA9IGUubmFtZTtcclxuICAgICAgICAgICAgICAgIGl0ZW0udHJpZ2dlckFjdGlvbiA9IGUudHJpZ2dlckFjdGlvblxyXG4gICAgICAgICAgICAgICAgaXRlbS5Bc3luYyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5TaWduYWxSZWYgPSBlLlNpZ25hbFJlZjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXRjaEV2ZW50LkV2ZW50RGVmaW5pdGlvbnMucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFkZFNpZ25hbHMoY2F0Y2hFdmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOWIpOaWreWuoeaJuemhueaYr+WQpuWMheWQq+mps+Wbnu+8n+S4jeWMheWQq+aXtu+8jOmps+WbnuinhOWImea4heepulxyXG4gICAgICAgIGlmICghdGhpcy5pc0JhY2tFdmVudEV4aXN0KGNhdGNoRXZlbnQuRXZlbnREZWZpbml0aW9ucykpIHtcclxuICAgICAgICAgICAgY2F0Y2hFdmVudC5iYWNrV2FyZFJ1bGUgPSBudWxsO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIWNhdGNoRXZlbnQuYmFja1dhcmRSdWxlKSB7XHJcbiAgICAgICAgICAgIGNhdGNoRXZlbnQuYmFja1dhcmRSdWxlID0gbmV3IEJhY2tXYXJkUnVsZShjYXRjaEV2ZW50Lk1vZGVsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5pu05paw5bGe5oCn5qGGXHJcbiAgICAgICAgLy8gVXRpbHMucG9zdE1lc3NhZ2UoUmVzb3VyY2VLZXlzLndmX3Nob3dQcm9wZXJ0eSwgdGhpcy5nZXRQcm9wQ29uZmlnKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUJhY2tXYXJkUnVsZShjYXRjaEV2ZW50OiBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gb2JqLnByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgbGV0IGJhY2tXYXJkUnVsZSA9IG5ldyBCYWNrV2FyZFJ1bGUoY2F0Y2hFdmVudC5Nb2RlbCk7XHJcbiAgICAgICAgYmFja1dhcmRSdWxlLlRhcmdldFJlZiA9IGRhdGEuVGFyZ2V0UmVmO1xyXG4gICAgICAgIGJhY2tXYXJkUnVsZS5TZWxlY3RUYXJnZXRBYmxlID0gZGF0YS5TZWxlY3RUYXJnZXRBYmxlO1xyXG4gICAgICAgIGJhY2tXYXJkUnVsZS5XYWl0UmV0dXJuID0gZGF0YS5XYWl0UmV0dXJuO1xyXG4gICAgICAgIGJhY2tXYXJkUnVsZS5SZXN1Ym1pdEVmZmVjdCA9IGRhdGEuUmVzdWJtaXRFZmZlY3Q7XHJcbiAgICAgICAgYmFja1dhcmRSdWxlLkR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlID0gZGF0YS5EeW5hbWljQmFja1dhcmRSdWxlQWJsZTtcclxuICAgICAgICBiYWNrV2FyZFJ1bGUuU2VsZWN0VGFyZ2V0TGlzdCA9IGRhdGEuU2VsZWN0VGFyZ2V0TGlzdDtcclxuXHJcbiAgICAgICAgY2F0Y2hFdmVudC5iYWNrV2FyZFJ1bGUgPSBiYWNrV2FyZFJ1bGU7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVmFyaWFibGVTZXR0aW5ncyhjYXRjaEV2ZW50OiBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBicG1uTW9kZWwgPSBjYXRjaEV2ZW50Lk1vZGVsO1xyXG4gICAgICAgIGNvbnN0IGV4dGVuZEVsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEV4dGVuc2lvbkVsZW1lbnRzKCk7XHJcbiAgICAgICAgaWYgKGNhdGNoRXZlbnQudmFyaWFibGVTZXR0aW5ncyAmJiBjYXRjaEV2ZW50LnZhcmlhYmxlU2V0dGluZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgY2F0Y2hFdmVudC52YXJpYWJsZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi50YWcgPT09ICdjb21wb25lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGV4dGVuZEVsZW1lbnRzLmZpbmRJbmRleChlID0+IChlIGluc3RhbmNlb2YgQ29tcG9uZW50ICYmIGUuSWQgPT09IHYudmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2hFdmVudC52YXJpYWJsZVNldHRpbmdzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHZhcmlhYmxlcyA9IG9iai5wcm9wZXJ0eVZhbHVlIGFzIGFueVtdO1xyXG4gICAgICAgIGlmICh2YXJpYWJsZXMgJiYgdmFyaWFibGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHZhcmlhYmxlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFyaWFibGVTZXR0aW5nID0gbmV3IFZhcmlhYmxlU2V0dGluZyhicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFyaWFibGVTZXR0aW5nLnZhcmlhYmxlSWQgPSB2LnZhcmlhYmxlSWQ7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVDb2RlID0gdi52YXJpYWJsZUNvZGU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVOYW1lID0gdi52YXJpYWJsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudGFnID0gdi50YWc7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcuZXhlY3V0aW9uVGltZSA9IHYuZXhlY3V0aW9uVGltZTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy52YWx1ZSA9IHYudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFsdWVUZXh0ID0gdi52YWx1ZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgY2F0Y2hFdmVudC52YXJpYWJsZVNldHRpbmdzLnB1c2godmFyaWFibGVTZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZVNldHRpbmcudGFnID09PSAnY29tcG9uZW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB2LmNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3B0ID0gbmV3IENvbXBvbmVudChicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuTWV0YWRhdGFJZCA9IGMuTWV0YWRhdGFJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0Lk1ldGhvZENvZGUgPSBjLk1ldGhvZENvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5JZCA9IGMuSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5OYW1lID0gYy5OYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuQWN0dWFsUGFyYW1ldGVycyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5BY3R1YWxQYXJhbWV0ZXJzICYmIGMuQWN0dWFsUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhIG9mIGMuQWN0dWFsUGFyYW1ldGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXJhbWV0ZXIgPSBuZXcgQWN0dWFsUGFyYW1ldGVyKGJwbW5Nb2RlbCwgYS5OYW1lLCBhLlZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXIuVGFnID0gYS5UYWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B0LkFjdHVhbFBhcmFtZXRlcnMucHVzaChwYXJhbWV0ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5wdXNoKGNwdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZVNpZ25hbHMoY2F0Y2hFdmVudDogSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwpIHtcclxuICAgICAgICBjb25zdCBicG1uTW9kZWwgPSBjYXRjaEV2ZW50Lk1vZGVsO1xyXG4gICAgICAgIGlmIChjYXRjaEV2ZW50LkV2ZW50RGVmaW5pdGlvbnMgJiYgY2F0Y2hFdmVudC5FdmVudERlZmluaXRpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgZmxvd0VsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEZsb3dFbGVtZW50cygpO1xyXG4gICAgICAgICAgICBjb25zdCBldmVudERlZnMgPSBuZXcgTWFwPHN0cmluZywgU2lnbmFsRXZlbnREZWZpbml0aW9uSW1wbD4oKTtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZmxvd0VsZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmxvd0VsZW1lbnRzW2tleV0gaW5zdGFuY2VvZiBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCAmJiBmbG93RWxlbWVudHNba2V5XS5JZCAhPT0gY2F0Y2hFdmVudC5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhdGNoRXZlbnQgPSBmbG93RWxlbWVudHNba2V5XSBhcyBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgY2F0Y2hFdmVudC5FdmVudERlZmluaXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gZSBhcyBTaWduYWxFdmVudERlZmluaXRpb25JbXBsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV2ZW50RGVmcy5nZXQoZXZlbnQuU2lnbmFsUmVmKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnREZWZzLnNldChldmVudC5TaWduYWxSZWYsIGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgY2F0Y2hFdmVudC5FdmVudERlZmluaXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudERlZiA9IGUgYXMgU2lnbmFsRXZlbnREZWZpbml0aW9uSW1wbDtcclxuICAgICAgICAgICAgICAgIGlmICghZXZlbnREZWZzLmdldChldmVudERlZi5TaWduYWxSZWYpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGJwbW5Nb2RlbC5zaWduYWxzLmZpbmRJbmRleChzID0+IHMuTmFtZSA9PT0gZXZlbnREZWYuU2lnbmFsUmVmKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJwbW5Nb2RlbC5zaWduYWxzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { SequenceFlowState, Expression } from "@edp-pmf/bpmn-model";
import { SequenceFlowEdge, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { UserActivity, Condition } from "@gsp-wf/wf-process-model";
import { SequenceFlowPropertyKeys } from "./property-keys/SequenceFlowPropertyKeys";
import { mxResources } from "@edp-pmf/mxgraph-ts";
/**
 * 事件流连线，增加状态颜色信息
 */
var /**
 * 事件流连线，增加状态颜色信息
 */
WfSequenceFlowEdge = /** @class */ (function (_super) {
    tslib_1.__extends(WfSequenceFlowEdge, _super);
    function WfSequenceFlowEdge() {
        var _a;
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.localePipe = null;
        _this.strokeColors = (_a = {},
            _a[SequenceFlowState.Default] = "#6482b9",
            _a);
        return _this;
    }
    /**
     * @return {?}
     */
    WfSequenceFlowEdge.prototype.getFarrisPropConfig = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var sequenceFlow = this.flowElement;
        /** @type {?} */
        var sourceNode = sequenceFlow.Model.DefaultProcess.GetFlowElement(sequenceFlow.SourceRef);
        /** @type {?} */
        var conditionConfig = new ElementPropertyConfig();
        /** @type {?} */
        var basicConfig = new ElementPropertyConfig();
        /** @type {?} */
        var propertyData = {};
        basicConfig.categoryId = 'basic';
        basicConfig.categoryName = mxResources.get('basicInfo');
        basicConfig.tabId = 'basic';
        basicConfig.tabName = mxResources.get('basic');
        basicConfig.properties = [
            { propertyID: SequenceFlowPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: SequenceFlowPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: SequenceFlowPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        conditionConfig.categoryId = 'condition';
        conditionConfig.categoryName = mxResources.get('basicInfo');
        conditionConfig.tabId = 'basic';
        conditionConfig.tabName = mxResources.get('basic');
        conditionConfig.properties = [
            { propertyID: SequenceFlowPropertyKeys.ConditionExpression, propertyName: mxResources.get('ConditionExpression'), propertyType: 'modal' }
        ];
        // 源节点为排他网关和UserActivity时
        if (sourceNode.ClrTypeID === UserActivity.Clr_Type_ID || sourceNode.ClrTypeID === 'bpmn.ExclusiveGateway' || sourceNode.ClrTypeID === 'bpmn.InclusiveGateway') {
            conditionConfig.properties.push({ propertyID: SequenceFlowPropertyKeys.Default, propertyName: mxResources.get('default'), propertyType: 'select' });
        }
        this.setSequenceFlowValue(sequenceFlow, sourceNode, propertyData);
        return {
            propertyConfig: [basicConfig, conditionConfig],
            propertyData: propertyData
        };
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    WfSequenceFlowEdge.prototype.updateProps = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var sequenceFlow = this.flowElement;
        /** @type {?} */
        var propertyId = obj.propertyID;
        switch (propertyId) {
            case SequenceFlowPropertyKeys.ConditionExpression: // 更新条件
                this.updateConditionExpr(sequenceFlow, obj.propertyValue);
                break;
            case SequenceFlowPropertyKeys.Default:
                this.modifyDefaultSequenceFlow(sequenceFlow, obj.propertyValue);
                break;
            default:
                _super.prototype.updateProps.call(this, obj);
                break;
        }
    };
    /**
     * 设置连接线属性值
     * @param sequence
     * @param propertyData
     */
    /**
     * 设置连接线属性值
     * @param {?} sequenceFlow
     * @param {?} sourceNode
     * @param {?} propertyData
     * @return {?}
     */
    WfSequenceFlowEdge.prototype.setSequenceFlowValue = /**
     * 设置连接线属性值
     * @param {?} sequenceFlow
     * @param {?} sourceNode
     * @param {?} propertyData
     * @return {?}
     */
    function (sequenceFlow, sourceNode, propertyData) {
        propertyData[SequenceFlowPropertyKeys.Id] = sequenceFlow.Id;
        propertyData[SequenceFlowPropertyKeys.ClrTypeID] = sequenceFlow.ClrTypeID;
        propertyData[SequenceFlowPropertyKeys.Name] = sequenceFlow.Name;
        propertyData[SequenceFlowPropertyKeys.NameLanguage] = sequenceFlow.NameLanguage || {
            "zh-CHS": sequenceFlow.Name,
        };
        if (!sequenceFlow.ConditionExpression || !sequenceFlow.ConditionExpression.MexExpression)
            propertyData[SequenceFlowPropertyKeys.ConditionExpression] = '';
        else
            propertyData[SequenceFlowPropertyKeys.ConditionExpression] =
                ((/** @type {?} */ (sequenceFlow.ConditionExpression.MexExpression))).Value;
        if (sourceNode.ClrTypeID === UserActivity.Clr_Type_ID) {
            /** @type {?} */
            var userActivity = (/** @type {?} */ (sourceNode));
            if (userActivity.Default === sequenceFlow.Id) {
                propertyData[SequenceFlowPropertyKeys.Default] = true;
            }
            else {
                propertyData[SequenceFlowPropertyKeys.Default] = false;
            }
        }
        if (sourceNode.ClrTypeID === 'bpmn.ExclusiveGateway') {
            /** @type {?} */
            var gateway = (/** @type {?} */ (sourceNode));
            if (gateway.Default === sequenceFlow.Id) {
                propertyData[SequenceFlowPropertyKeys.Default] = true;
            }
            else {
                propertyData[SequenceFlowPropertyKeys.Default] = false;
            }
        }
        if (sourceNode.ClrTypeID === 'bpmn.InclusiveGateway') {
            /** @type {?} */
            var gateway = (/** @type {?} */ (sourceNode));
            if (gateway.Default === sequenceFlow.Id) {
                propertyData[SequenceFlowPropertyKeys.Default] = true;
            }
            else {
                propertyData[SequenceFlowPropertyKeys.Default] = false;
            }
        }
    };
    /**
     * 更新分支条件
     * @param seqFlow
     * @param val
     */
    /**
     * 更新分支条件
     * @param {?} seqFlow
     * @param {?} val
     * @return {?}
     */
    WfSequenceFlowEdge.prototype.updateConditionExpr = /**
     * 更新分支条件
     * @param {?} seqFlow
     * @param {?} val
     * @return {?}
     */
    function (seqFlow, val) {
        seqFlow.ConditionExpression = null;
        if (val) {
            /** @type {?} */
            var expression = new Expression(seqFlow.Model);
            /** @type {?} */
            var condition = new Condition(seqFlow.Model);
            condition.Value = val;
            expression.MexExpression = condition;
            seqFlow.ConditionExpression = expression;
        }
    };
    /**
     * 更新默认分支(当前适用：排他网关+活动节点)
     * @param seqFlow
     * @param val
     */
    /**
     * 更新默认分支(当前适用：排他网关+活动节点)
     * @param {?} seqFlow
     * @param {?} val
     * @return {?}
     */
    WfSequenceFlowEdge.prototype.modifyDefaultSequenceFlow = /**
     * 更新默认分支(当前适用：排他网关+活动节点)
     * @param {?} seqFlow
     * @param {?} val
     * @return {?}
     */
    function (seqFlow, val) {
        // 获取流转线源节点
        /** @type {?} */
        var node = (/** @type {?} */ (seqFlow.Model.DefaultProcess.GetFlowElement(seqFlow.SourceRef)));
        if (node.ClrTypeID === UserActivity.Clr_Type_ID) {
            // 节点为UserActivity类型
            /** @type {?} */
            var userActivity = (/** @type {?} */ (node));
            if (val === true) {
                userActivity.Default = seqFlow.Id;
            }
            else if (val === false) {
                // 源节点的默认分支===流转分支ID
                if (userActivity.Default === seqFlow.Id) {
                    userActivity.Default = null;
                }
            }
        }
        else if (node.ClrTypeID === 'bpmn.ExclusiveGateway') {
            // 排他网关
            /** @type {?} */
            var gateway = (/** @type {?} */ (node));
            if (val === true) {
                gateway.Default = seqFlow.Id;
            }
            else if (val === false) {
                // 源节点的默认分支===流转分支ID
                if (gateway.Default === seqFlow.Id) {
                    gateway.Default = null;
                }
            }
        }
        else if (node.ClrTypeID === 'bpmn.InclusiveGateway') {
            // 包容网关
            /** @type {?} */
            var gateway = (/** @type {?} */ (node));
            if (val === true) {
                gateway.Default = seqFlow.Id;
            }
            else if (val === false) {
                // 源节点的默认分支===流转分支ID
                if (gateway.Default === seqFlow.Id) {
                    gateway.Default = null;
                }
            }
        }
    };
    return WfSequenceFlowEdge;
}(SequenceFlowEdge));
/**
 * 事件流连线，增加状态颜色信息
 */
export { WfSequenceFlowEdge };
if (false) {
    /** @type {?} */
    WfSequenceFlowEdge.prototype.localePipe;
    /** @type {?} */
    WfSequenceFlowEdge.prototype.strokeColors;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ZTZXF1ZW5jZUZsb3dFZGdlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9kZXNpZ25lci93Zi1jZWxsL1dmU2VxdWVuY2VGbG93RWRnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBK0MsVUFBVSxFQUE4QixNQUFNLHFCQUFxQixDQUFDO0FBQzdJLE9BQU8sRUFBRSxnQkFBZ0IsRUFBNEIscUJBQXFCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RyxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ25FLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBRXBGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7OztBQUtsRDs7OztJQUF3Qyw4Q0FBZ0I7SUFBeEQ7O1FBQUEscUVBa0tDO1FBaktHLGdCQUFVLEdBQWlCLElBQUksQ0FBQztRQUNoQyxrQkFBWTtZQUNSLEdBQUMsaUJBQWlCLENBQUMsT0FBTyxJQUFHLFNBQVM7Z0JBQ3hDOztJQThKTixDQUFDOzs7O0lBNUpHLGdEQUFtQjs7O0lBQW5COztZQUNVLFlBQVksR0FBRyxJQUFJLENBQUMsV0FBVzs7WUFDL0IsVUFBVSxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDOztZQUN2RixlQUFlLEdBQTBCLElBQUkscUJBQXFCLEVBQUU7O1lBQ3BFLFdBQVcsR0FBMEIsSUFBSSxxQkFBcUIsRUFBRTs7WUFDaEUsWUFBWSxHQUFHLEVBQUU7UUFFckIsV0FBVyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUM7UUFDakMsV0FBVyxDQUFDLFlBQVksR0FBSSxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3pELFdB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SSxPQUFPLENBQUMsT0FBTyxLQUFLLE9BQU8sQ0FBQyxFQUFFLEVBQUU7b0JBQ2hDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO2lCQUMxQjthQUNKO1NBQ0o7SUFDTCxDQUFDO0lBQ0wseUJBQUM7QUFBRCxDQUFDLEFBbEtELENBQXdDLGdCQUFnQixHQWtLdkQ7Ozs7Ozs7SUFqS0csd0NBQWdDOztJQUNoQywwQ0FFRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNlcXVlbmNlRmxvd1N0YXRlLCBTZXF1ZW5jZUZsb3csIEZsb3dFbGVtZW50LCBFeGNsdXNpdmVHYXRld2F5LCBFeHByZXNzaW9uLCBGbG93Tm9kZSwgSW5jbHVzaXZlR2F0ZXdheSB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IFNlcXVlbmNlRmxvd0VkZ2UsIEZhcnJpc1Byb3BDb25maWdXaXRoRGF0YSwgRWxlbWVudFByb3BlcnR5Q29uZmlnIH0gZnJvbSBcIkBlZHAtcG1mL2dyYXBoZWRpdG9yXCI7XHJcbmltcG9ydCB7IFVzZXJBY3Rpdml0eSwgQ29uZGl0aW9uIH0gZnJvbSBcIkBnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbFwiO1xyXG5pbXBvcnQgeyBTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMgfSBmcm9tIFwiLi9wcm9wZXJ0eS1rZXlzL1NlcXVlbmNlRmxvd1Byb3BlcnR5S2V5c1wiO1xyXG5pbXBvcnQgeyBXZkxvY2FsZVBpcGUgfSBmcm9tIFwiLi4vLi4vaTE4bi9waXBlL3dmLXByb2Nlc3MtZWRpdG9yLWxvY2FsZS5waXBlXCI7XHJcbmltcG9ydCB7IG14UmVzb3VyY2VzIH0gZnJvbSBcIkBlZHAtcG1mL214Z3JhcGgtdHNcIjtcclxuXHJcbi8qKlxyXG4gKiDkuovku7bmtYHov57nur/vvIzlop7liqDnirbmgIHpopzoibLkv6Hmga9cclxuICovXHJcbmV4cG9ydCBjbGFzcyBXZlNlcXVlbmNlRmxvd0VkZ2UgZXh0ZW5kcyBTZXF1ZW5jZUZsb3dFZGdlIHtcclxuICAgIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSA9IG51bGw7XHJcbiAgICBzdHJva2VDb2xvcnMgPSB7XHJcbiAgICAgICAgW1NlcXVlbmNlRmxvd1N0YXRlLkRlZmF1bHRdOiBcIiM2NDgyYjlcIixcclxuICAgIH07XHJcblxyXG4gICAgZ2V0RmFycmlzUHJvcENvbmZpZygpOiBGYXJyaXNQcm9wQ29uZmlnV2l0aERhdGEge1xyXG4gICAgICAgIGNvbnN0IHNlcXVlbmNlRmxvdyA9IHRoaXMuZmxvd0VsZW1lbnQ7XHJcbiAgICAgICAgY29uc3Qgc291cmNlTm9kZSA9IHNlcXVlbmNlRmxvdy5Nb2RlbC5EZWZhdWx0UHJvY2Vzcy5HZXRGbG93RWxlbWVudChzZXF1ZW5jZUZsb3cuU291cmNlUmVmKTtcclxuICAgICAgICBsZXQgY29uZGl0aW9uQ29uZmlnOiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IGJhc2ljQ29uZmlnOiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IHByb3BlcnR5RGF0YSA9IHt9O1xyXG5cclxuICAgICAgICBiYXNpY0NvbmZpZy5jYXRlZ29yeUlkID0gJ2Jhc2ljJztcclxuICAgICAgICBiYXNpY0NvbmZpZy5jYXRlZ29yeU5hbWUgPSAgbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0luZm8nKTtcclxuICAgICAgICBiYXNpY0NvbmZpZy50YWJJZCA9ICdiYXNpYyc7XHJcbiAgICAgICAgYmFzaWNDb25maWcudGFiTmFtZSA9ICBteFJlc291cmNlcy5nZXQoJ2Jhc2ljJylcclxuICAgICAgICBiYXNpY0NvbmZpZy5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFNlcXVlbmNlRmxvd1Byb3BlcnR5S2V5cy5OYW1lLCBwcm9wZXJ0eU5hbWU6ICBteFJlc291cmNlcy5nZXQoJ25hbWUnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgdmlzaWJsZTogIXRoaXMuZWRpdG9yVWkubXVsdGlMYW5nRW5hYmxlZCB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFNlcXVlbmNlRmxvd1Byb3BlcnR5S2V5cy5OYW1lTGFuZ3VhZ2UsIHByb3BlcnR5TmFtZTogIG14UmVzb3VyY2VzLmdldCgnbmFtZUxhbmd1YWdlJyksIHByb3BlcnR5VHlwZTogJ211bHRpTGFuZ3VhZ2UnLCB2aXNpYmxlOiB0aGlzLmVkaXRvclVpLm11bHRpTGFuZ0VuYWJsZWQgfSxcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuSWQsIHByb3BlcnR5TmFtZTogIG14UmVzb3VyY2VzLmdldCgnaWQnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgcmVhZG9ubHk6IHRydWUgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgY29uZGl0aW9uQ29uZmlnLmNhdGVnb3J5SWQgPSAnY29uZGl0aW9uJztcclxuICAgICAgICBjb25kaXRpb25Db25maWcuY2F0ZWdvcnlOYW1lID0gIG14UmVzb3VyY2VzLmdldCgnYmFzaWNJbmZvJyk7XHJcbiAgICAgICAgY29uZGl0aW9uQ29uZmlnLnRhYklkID0gJ2Jhc2ljJztcclxuICAgICAgICBjb25kaXRpb25Db25maWcudGFiTmFtZSA9ICBteFJlc291cmNlcy5nZXQoJ2Jhc2ljJyk7XHJcbiAgICAgICAgY29uZGl0aW9uQ29uZmlnLnByb3BlcnRpZXMgPSBbXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogU2VxdWVuY2VGbG93UHJvcGVydHlLZXlzLkNvbmRpdGlvbkV4cHJlc3Npb24sIHByb3BlcnR5TmFtZTogIG14UmVzb3VyY2VzLmdldCgnQ29uZGl0aW9uRXhwcmVzc2lvbicpLCBwcm9wZXJ0eVR5cGU6ICdtb2RhbCcgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgLy8g5rqQ6IqC54K55Li65o6S5LuW572R5YWz5ZKMVXNlckFjdGl2aXR55pe2XHJcbiAgICAgICAgaWYgKHNvdXJjZU5vZGUuQ2xyVHlwZUlEID09PSBVc2VyQWN0aXZpdHkuQ2xyX1R5cGVfSUQgfHwgc291cmNlTm9kZS5DbHJUeXBlSUQgPT09ICdicG1uLkV4Y2x1c2l2ZUdhdGV3YXknIHx8IHNvdXJjZU5vZGUuQ2xyVHlwZUlEID09PSAnYnBtbi5JbmNsdXNpdmVHYXRld2F5Jykge1xyXG4gICAgICAgICAgICBjb25kaXRpb25Db25maWcucHJvcGVydGllcy5wdXNoKFxyXG4gICAgICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuRGVmYXVsdCwgcHJvcGVydHlOYW1lOiAgbXhSZXNvdXJjZXMuZ2V0KCdkZWZhdWx0JyksIHByb3BlcnR5VHlwZTogJ3NlbGVjdCcgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zZXRTZXF1ZW5jZUZsb3dWYWx1ZShzZXF1ZW5jZUZsb3csIHNvdXJjZU5vZGUsIHByb3BlcnR5RGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtiYXNpY0NvbmZpZywgY29uZGl0aW9uQ29uZmlnXSxcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhOiBwcm9wZXJ0eURhdGFcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BzKG9iajogYW55KTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qgc2VxdWVuY2VGbG93ID0gdGhpcy5mbG93RWxlbWVudDtcclxuICAgICAgICBsZXQgcHJvcGVydHlJZDogc3RyaW5nID0gb2JqLnByb3BlcnR5SUQ7XHJcbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUlkKSB7XHJcbiAgICAgICAgICAgIGNhc2UgU2VxdWVuY2VGbG93UHJvcGVydHlLZXlzLkNvbmRpdGlvbkV4cHJlc3Npb246ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmm7TmlrDmnaHku7ZcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29uZGl0aW9uRXhwcihzZXF1ZW5jZUZsb3csIG9iai5wcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFNlcXVlbmNlRmxvd1Byb3BlcnR5S2V5cy5EZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhpcy5tb2RpZnlEZWZhdWx0U2VxdWVuY2VGbG93KHNlcXVlbmNlRmxvdywgb2JqLnByb3BlcnR5VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBzdXBlci51cGRhdGVQcm9wcyhvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u6L+e5o6l57q/5bGe5oCn5YC8XHJcbiAgICAgKiBAcGFyYW0gc2VxdWVuY2VcclxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eURhdGFcclxuICAgICAqL1xyXG4gICAgc2V0U2VxdWVuY2VGbG93VmFsdWUoc2VxdWVuY2VGbG93OiBTZXF1ZW5jZUZsb3csIHNvdXJjZU5vZGU6IEZsb3dFbGVtZW50LCBwcm9wZXJ0eURhdGE6IE9iamVjdCkge1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuSWRdID0gc2VxdWVuY2VGbG93LklkO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuQ2xyVHlwZUlEXSA9IHNlcXVlbmNlRmxvdy5DbHJUeXBlSUQ7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW1NlcXVlbmNlRmxvd1Byb3BlcnR5S2V5cy5OYW1lXSA9IHNlcXVlbmNlRmxvdy5OYW1lO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuTmFtZUxhbmd1YWdlXSA9IHNlcXVlbmNlRmxvdy5OYW1lTGFuZ3VhZ2UgfHwge1xyXG4gICAgICAgICAgICBcInpoLUNIU1wiOiBzZXF1ZW5jZUZsb3cuTmFtZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICghc2VxdWVuY2VGbG93LkNvbmRpdGlvbkV4cHJlc3Npb24gfHwgIXNlcXVlbmNlRmxvdy5Db25kaXRpb25FeHByZXNzaW9uLk1leEV4cHJlc3Npb24pXHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuQ29uZGl0aW9uRXhwcmVzc2lvbl0gPSAnJztcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuQ29uZGl0aW9uRXhwcmVzc2lvbl0gPVxyXG4gICAgICAgICAgICAgICAgKHNlcXVlbmNlRmxvdy5Db25kaXRpb25FeHByZXNzaW9uLk1leEV4cHJlc3Npb24gYXMgQ29uZGl0aW9uKS5WYWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKHNvdXJjZU5vZGUuQ2xyVHlwZUlEID09PSBVc2VyQWN0aXZpdHkuQ2xyX1R5cGVfSUQpIHtcclxuICAgICAgICAgICAgY29uc3QgdXNlckFjdGl2aXR5ID0gc291cmNlTm9kZSBhcyBVc2VyQWN0aXZpdHk7XHJcbiAgICAgICAgICAgIGlmICh1c2VyQWN0aXZpdHkuRGVmYXVsdCA9PT0gc2VxdWVuY2VGbG93LklkKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eURhdGFbU2VxdWVuY2VGbG93UHJvcGVydHlLZXlzLkRlZmF1bHRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuRGVmYXVsdF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc291cmNlTm9kZS5DbHJUeXBlSUQgPT09ICdicG1uLkV4Y2x1c2l2ZUdhdGV3YXknKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGdhdGV3YXkgPSBzb3VyY2VOb2RlIGFzIEV4Y2x1c2l2ZUdhdGV3YXk7XHJcbiAgICAgICAgICAgIGlmIChnYXRld2F5LkRlZmF1bHQgPT09IHNlcXVlbmNlRmxvdy5JZCkge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEYXRhW1NlcXVlbmNlRmxvd1Byb3BlcnR5S2V5cy5EZWZhdWx0XSA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eURhdGFbU2VxdWVuY2VGbG93UHJvcGVydHlLZXlzLkRlZmF1bHRdID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNvdXJjZU5vZGUuQ2xyVHlwZUlEID09PSAnYnBtbi5JbmNsdXNpdmVHYXRld2F5Jykge1xyXG4gICAgICAgICAgICBjb25zdCBnYXRld2F5ID0gc291cmNlTm9kZSBhcyBJbmNsdXNpdmVHYXRld2F5O1xyXG4gICAgICAgICAgICBpZiAoZ2F0ZXdheS5EZWZhdWx0ID09PSBzZXF1ZW5jZUZsb3cuSWQpIHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTZXF1ZW5jZUZsb3dQcm9wZXJ0eUtleXMuRGVmYXVsdF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEYXRhW1NlcXVlbmNlRmxvd1Byb3BlcnR5S2V5cy5EZWZhdWx0XSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pu05paw5YiG5pSv5p2h5Lu2XHJcbiAgICAgKiBAcGFyYW0gc2VxRmxvd1xyXG4gICAgICogQHBhcmFtIHZhbFxyXG4gICAgICovXHJcbiAgICB1cGRhdGVDb25kaXRpb25FeHByKHNlcUZsb3c6IFNlcXVlbmNlRmxvdywgdmFsOiBzdHJpbmcpIHtcclxuICAgICAgICBzZXFGbG93LkNvbmRpdGlvbkV4cHJlc3Npb24gPSBudWxsO1xyXG4gICAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICAgICAgbGV0IGV4cHJlc3Npb24gPSBuZXcgRXhwcmVzc2lvbihzZXFGbG93Lk1vZGVsKTtcclxuICAgICAgICAgICAgbGV0IGNvbmRpdGlvbiA9IG5ldyBDb25kaXRpb24oc2VxRmxvdy5Nb2RlbCk7XHJcbiAgICAgICAgICAgIGNvbmRpdGlvbi5WYWx1ZSA9IHZhbDtcclxuICAgICAgICAgICAgZXhwcmVzc2lvbi5NZXhFeHByZXNzaW9uID0gY29uZGl0aW9uO1xyXG4gICAgICAgICAgICBzZXFGbG93LkNvbmRpdGlvbkV4cHJlc3Npb24gPSBleHByZXNzaW9uO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsOm7mOiupOWIhuaUryjlvZPliY3pgILnlKjvvJrmjpLku5bnvZHlhbMr5rS75Yqo6IqC54K5KVxyXG4gICAgICogQHBhcmFtIHNlcUZsb3dcclxuICAgICAqIEBwYXJhbSB2YWxcclxuICAgICAqL1xyXG4gICAgbW9kaWZ5RGVmYXVsdFNlcXVlbmNlRmxvdyhzZXFGbG93OiBTZXF1ZW5jZUZsb3csIHZhbDogYm9vbGVhbikge1xyXG4gICAgICAgIC8vIOiOt+WPlua1gei9rOe6v+a6kOiKgueCuVxyXG4gICAgICAgIGNvbnN0IG5vZGUgPSBzZXFGbG93Lk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEZsb3dFbGVtZW50KHNlcUZsb3cuU291cmNlUmVmKSBhcyBGbG93Tm9kZTtcclxuICAgICAgICBpZiAobm9kZS5DbHJUeXBlSUQgPT09IFVzZXJBY3Rpdml0eS5DbHJfVHlwZV9JRCkge1xyXG4gICAgICAgICAgICAvLyDoioLngrnkuLpVc2VyQWN0aXZpdHnnsbvlnotcclxuICAgICAgICAgICAgY29uc3QgdXNlckFjdGl2aXR5ID0gbm9kZSBhcyBVc2VyQWN0aXZpdHk7XHJcbiAgICAgICAgICAgIGlmICh2YWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHVzZXJBY3Rpdml0eS5EZWZhdWx0ID0gc2VxRmxvdy5JZDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDmupDoioLngrnnmoTpu5jorqTliIbmlK89PT3mtYHovazliIbmlK9JRFxyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJBY3Rpdml0eS5EZWZhdWx0ID09PSBzZXFGbG93LklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlckFjdGl2aXR5LkRlZmF1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChub2RlLkNsclR5cGVJRCA9PT0gJ2JwbW4uRXhjbHVzaXZlR2F0ZXdheScpIHtcclxuICAgICAgICAgICAgLy8g5o6S5LuW572R5YWzXHJcbiAgICAgICAgICAgIGNvbnN0IGdhdGV3YXkgPSBub2RlIGFzIEV4Y2x1c2l2ZUdhdGV3YXk7XHJcbiAgICAgICAgICAgIGlmICh2YWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGdhdGV3YXkuRGVmYXVsdCA9IHNlcUZsb3cuSWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5rqQ6IqC54K555qE6buY6K6k5YiG5pSvPT095rWB6L2s5YiG5pSvSURcclxuICAgICAgICAgICAgICAgIGlmIChnYXRld2F5LkRlZmF1bHQgPT09IHNlcUZsb3cuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnYXRld2F5LkRlZmF1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChub2RlLkNsclR5cGVJRCA9PT0gJ2JwbW4uSW5jbHVzaXZlR2F0ZXdheScpIHtcclxuICAgICAgICAgICAgLy8g5YyF5a65572R5YWzXHJcbiAgICAgICAgICAgIGNvbnN0IGdhdGV3YXkgPSBub2RlIGFzIEluY2x1c2l2ZUdhdGV3YXk7XHJcbiAgICAgICAgICAgIGlmICh2YWwgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGdhdGV3YXkuRGVmYXVsdCA9IHNlcUZsb3cuSWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5rqQ6IqC54K555qE6buY6K6k5YiG5pSvPT095rWB6L2s5YiG5pSvSURcclxuICAgICAgICAgICAgICAgIGlmIChnYXRld2F5LkRlZmF1bHQgPT09IHNlcUZsb3cuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnYXRld2F5LkRlZmF1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ParallelGateway } from "@edp-pmf/bpmn-model";
import { ProcessHeader, Component, StartMode, ToolTime, UserActivity, OperationActivity, AutoActivity, MessageActivity, CallActivitySubProcess, IntermediateCatchEventImpl, NotifyActivity } from "@gsp-wf/wf-process-model";
import { WfDesignerUtils } from "./WfDesignerUtils";
var WfValidatorAdapter = /** @class */ (function () {
    function WfValidatorAdapter() {
    }
    /**
     * @param {?} bpmnModel
     * @param {?} scene
     * @return {?}
     */
    WfValidatorAdapter.validator = /**
     * @param {?} bpmnModel
     * @param {?} scene
     * @return {?}
     */
    function (bpmnModel, scene) {
        // 校验节点标识是否合规
        /** @type {?} */
        var resActList = this.validateActivityList(bpmnModel);
        if (!resActList.valid) {
            return resActList;
        }
        // 校验流程变量
        /** @type {?} */
        var resProcVars = this.validatePrcoessVaris(bpmnModel);
        if (!resProcVars.valid) {
            return resProcVars;
        }
        /** @type {?} */
        var warningList = this.warningValidator(bpmnModel, scene);
        return {
            valid: true,
            warningList: warningList,
        };
    };
    /**
     * @private
     * @param {?} bpmnModel
     * @param {?} scene
     * @return {?}
     */
    WfValidatorAdapter.warningValidator = /**
     * @private
     * @param {?} bpmnModel
     * @param {?} scene
     * @return {?}
     */
    function (bpmnModel, scene) {
        /** @type {?} */
        var warningList = new Array();
        // 校验并行网关是否成对出现
        this.validateParallelGateway(bpmnModel, warningList);
        // 校验流程构件
        this.validateProcCmps(bpmnModel, scene, warningList);
        // 校验审批活动、人工操作参与者
        this.validateApprovalPerformers(bpmnModel, warningList);
        return warningList;
    };
    /**
     * @private
     * @param {?} bpmnModel
     * @param {?} scene
     * @param {?} warningList
     * @return {?}
     */
    WfValidatorAdapter.validateProcCmps = /**
     * @private
     * @param {?} bpmnModel
     * @param {?} scene
     * @param {?} warningList
     * @return {?}
     */
    function (bpmnModel, scene, warningList) {
        var e_1, _a;
        if (scene === 'inSuite') {
            return;
        }
        /** @type {?} */
        var extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        /** @type {?} */
        var processHeader = extendElements.find((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e instanceof ProcessHeader; }));
        if (!processHeader) {
            console.error(this.localePipe.instant('validate.noProcessHeader'));
            return;
        }
        /** @type {?} */
        var procCmps = extendElements.filter((/**
         * @param {?} e
         * @return {?}
         */
        function (e) { return e instanceof Component; }));
        if (!procCmps || procCmps.length === 0) {
            /** @type {?} */
            var tip = {
                id: 'lackCmp',
                title: this.localePipe.instant('validate.cmpsEmpty'),
                msg: this.localePipe.instant('validate.cmpsEmptyMsg'),
                type: 'processWarning'
            };
            warningList.push(tip);
            return;
        }
        // 启用方式为直接方式时
        if (((/** @type {?} */ (processHeader))).startMode === StartMode.DIRECT) {
            // 直接启用方式时不允许存在共享的构件
            /** @type {?} */
            var pfCmps = procCmps.filter((/**
             * @param {?} p
             * @return {?}
             */
            function (p) { return WfDesignerUtils.isPfComponent(p.MetadataId); }));
            if (pfCmps && pfCmps.length > 0) {
                /** @type {?} */
                var pfCmpsName = '';
                try {
                    for (var pfCmps_1 = tslib_1.__values(pfCmps), pfCmps_1_1 = pfCmps_1.next(); !pfCmps_1_1.done; pfCmps_1_1 = pfCmps_1.next()) {
                        var cmp = pfCmps_1_1.value;
                        pfCmpsName = pfCmpsName.concat(((/** @type {?} */ (cmp))).Name + ", ");
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (pfCmps_1_1 && !pfCmps_1_1.done && (_a = pfCmps_1.return)) _a.call(pfCmps_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
                pfCmpsName = pfCmpsName.slice(0, pfCmpsName.length - 1);
                /** @type {?} */
                var tip = {
                    id: 'directProcessWithPFCmp',
                    title: this.localePipe.instant('validate.directNoPf'),
                    msg: this.localePipe.instant('validate.directNoPfMsg') + (pfCmpsName + " "),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.Time === ToolTime.LOADDATA; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackLoadDataCmp',
                    title: this.localePipe.instant('validate.noLoadDataCmp'),
                    msg: this.localePipe.instant('validate.noLoadDataCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.Time === ToolTime.PROCESSINSTANCE_STARTED; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackProcessStartCmp',
                    title: this.localePipe.instant('validate.noStartCmp'),
                    msg: this.localePipe.instant('validate.noStartCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.Time === ToolTime.PROCESSINSTANCE_COMPLETED; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackProcessCompleteCmp',
                    title: this.localePipe.instant('validate.lackProcessCompleteCmp'),
                    msg: this.localePipe.instant('validate.lackProcessCompleteCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return ((/** @type {?} */ (c.Time))) === 'PROCESSINSTANCE_ABORTED'; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackProcessAbortCmp',
                    title: this.localePipe.instant('validate.lackProcessAbortCmp'),
                    msg: this.localePipe.instant('validate.lackProcessAbortCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.Time === 'PROCESSINSTANCE_CANCELED'; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackProcessCancelCmp',
                    title: this.localePipe.instant('validate.lackProcessCancelCmp'),
                    msg: this.localePipe.instant('validate.lackProcessCancelCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.Time === 'PROCESSINSTANCE_ROLLBACK'; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackProcessBackCmp',
                    title: this.localePipe.instant('validate.lackProcessBackCmp'),
                    msg: this.localePipe.instant('validate.lackProcessBackCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
            if (!procCmps.some((/**
             * @param {?} c
             * @return {?}
             */
            function (c) { return c.Time === 'PROCESSINSTANCE_RESUBMIT'; }))) {
                /** @type {?} */
                var tip = {
                    id: 'lackProcessReStartCmp',
                    title: this.localePipe.instant('validate.lackProcessReStartCmp'),
                    msg: this.localePipe.instant('validate.lackProcessReStartCmpMsg'),
                    type: 'processWarning'
                };
                warningList.push(tip);
            }
        }
    };
    /**
     * @private
     * @param {?} bpmnModel
     * @param {?} warningList
     * @return {?}
     */
    WfValidatorAdapter.validateParallelGateway = /**
     * @private
     * @param {?} bpmnModel
     * @param {?} warningList
     * @return {?}
     */
    function (bpmnModel, warningList) {
        /** @type {?} */
        var flowElements = bpmnModel.DefaultProcess.GetFlowElements();
        /** @type {?} */
        var parallelGatewayCount = 0;
        for (var k in flowElements) {
            if (flowElements[k] instanceof ParallelGateway) {
                parallelGatewayCount++;
            }
        }
        if (parallelGatewayCount % 2 !== 0) {
            /** @type {?} */
            var tip = {
                id: 'parallelGatewayCheck',
                title: this.localePipe.instant('validate.parallelGatewayCheck'),
                msg: this.localePipe.instant('validate.parallelGatewayCheckMsg'),
                type: 'processWarning'
            };
            warningList.push(tip);
        }
    };
    /**
     * @private
     * @param {?} bpmnModel
     * @param {?} warningList
     * @return {?}
     */
    WfValidatorAdapter.validateApprovalPerformers = /**
     * @private
     * @param {?} bpmnModel
     * @param {?} warningList
     * @return {?}
     */
    function (bpmnModel, warningList) {
        /** @type {?} */
        var flowElements = bpmnModel.DefaultProcess.GetFlowElements();
        /** @type {?} */
        var count = 0;
        for (var k in flowElements) {
            /** @type {?} */
            var act = flowElements[k];
            if (act instanceof UserActivity || act instanceof OperationActivity) {
                /** @type {?} */
                var roles = act.GetResourceRoles();
                if (roles.length == 0 && (!act.AssignPerformerConfig || !act.AssignPerformerConfig.AllowGlobalAssign)) {
                    /** @type {?} */
                    var tip = {
                        id: 'approvalPerformerCheck' + count,
                        title: "\u3010" + flowElements[k].Name + "\u3011" + this.localePipe.instant('validate.approvalPerformerCheck'),
                        msg: "",
                        type: 'processWarning'
                    };
                    warningList.push(tip);
                    count++;
                }
            }
        }
    };
    /**
     * @private
     * @param {?} bpmnModel
     * @return {?}
     */
    WfValidatorAdapter.validatePrcoessVaris = /**
     * @private
     * @param {?} bpmnModel
     * @return {?}
     */
    function (bpmnModel) {
        var e_2, _a;
        /** @type {?} */
        var objects = bpmnModel.DefaultProcess.GetDataObjects();
        /** @type {?} */
        var procVaris = new Array();
        if (objects && objects.length > 0) {
            procVaris = objects.filter((/**
             * @param {?} o
             * @return {?}
             */
            function (o) { return o.DataType.Category !== 'CustomType'; })).map((/**
             * @param {?} o
             * @return {?}
             */
            function (o) { return o.Name; }));
        }
        /** @type {?} */
        var flowElements = bpmnModel.DefaultProcess.GetFlowElements();
        for (var k in flowElements) {
            if (flowElements[k] instanceof UserActivity ||
                flowElements[k] instanceof OperationActivity ||
                flowElements[k] instanceof AutoActivity ||
                flowElements[k] instanceof MessageActivity ||
                flowElements[k] instanceof CallActivitySubProcess ||
                flowElements[k] instanceof IntermediateCatchEventImpl ||
                flowElements[k] instanceof NotifyActivity) {
                /** @type {?} */
                var variSets = ((/** @type {?} */ (flowElements[k]))).variableSettings;
                if (variSets) {
                    var _loop_1 = function (v) {
                        if (!procVaris.some((/**
                         * @param {?} p
                         * @return {?}
                         */
                        function (p) { return p === v.variableCode; }))) {
                            return { value: {
                                    valid: false,
                                    type: 'message',
                                    level: 'warning',
                                    message: "\u3010" + flowElements[k].Name + "\u3011" + this_1.localePipe.instant('validate.noVariable1')
                                        + ("\u3010" + v.variableName + "\u3011") + this_1.localePipe.instant('validate.noVariable2')
                                } };
                        }
                    };
                    var this_1 = this;
                    try {
                        for (var variSets_1 = tslib_1.__values(variSets), variSets_1_1 = variSets_1.next(); !variSets_1_1.done; variSets_1_1 = variSets_1.next()) {
                            var v = variSets_1_1.value;
                            var state_1 = _loop_1(v);
                            if (typeof state_1 === "object")
                                return state_1.value;
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (variSets_1_1 && !variSets_1_1.done && (_a = variSets_1.return)) _a.call(variSets_1);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                }
            }
        }
        return {
            valid: true,
        };
    };
    /**
     * @private
     * @param {?} bpmnModel
     * @return {?}
     */
    WfValidatorAdapter.validateActivityList = /**
     * @private
     * @param {?} bpmnModel
     * @return {?}
     */
    function (bpmnModel) {
        /** @type {?} */
        var flowElements = bpmnModel.DefaultProcess.GetFlowElements();
        /** @type {?} */
        var resActId = this.validateActivityId(flowElements);
        if (!resActId.valid) {
            return resActId;
        }
        /** @type {?} */
        var resActName = this.validateActivityName(flowElements);
        if (!resActName.valid) {
            return resActName;
        }
        return {
            valid: true,
        };
    };
    /**
     * @private
     * @param {?} flowElements
     * @return {?}
     */
    WfValidatorAdapter.validateActivityId = /**
     * @private
     * @param {?} flowElements
     * @return {?}
     */
    function (flowElements) {
        for (var k in flowElements) {
            switch (flowElements[k].ClrTypeID) {
                case 'wf.StartActivity':
                    /** @type {?} */
                    var startActivity = (/** @type {?} */ (flowElements[k]));
                    if (!startActivity.Id.startsWith('startActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + startActivity.Name) + this.localePipe.instant('validate.noStartActivity')
                        };
                    }
                    break;
                case 'bpmn.ExclusiveGateway':
                    /** @type {?} */
                    var exclusiveGateway = (/** @type {?} */ (flowElements[k]));
                    if (!exclusiveGateway.Id.startsWith('ExclusiveGateway')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + exclusiveGateway.Name) + this.localePipe.instant('validate.noExclusiveGateway')
                        };
                    }
                    break;
                case 'bpmn.ParallelGateway':
                    /** @type {?} */
                    var parallelGateway = (/** @type {?} */ (flowElements[k]));
                    if (!parallelGateway.Id.startsWith('ParallelGateway')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + parallelGateway.Name) + this.localePipe.instant('validate.noParallelGateway')
                        };
                    }
                    break;
                case 'wf.UserActivity':
                    /** @type {?} */
                    var userActivity = (/** @type {?} */ (flowElements[k]));
                    if (!userActivity.Id.startsWith('UserActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + userActivity.Name) + this.localePipe.instant('validate.noUserActivity')
                        };
                    }
                    break;
                case 'wf.OperationActivity':
                    /** @type {?} */
                    var operationActivity = (/** @type {?} */ (flowElements[k]));
                    if (!operationActivity.Id.startsWith('UserActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + operationActivity.Name) + this.localePipe.instant('validate.noOperationActivity')
                        };
                    }
                    break;
                case 'wf.NotifyActivity':
                    /** @type {?} */
                    var notifyActivity = (/** @type {?} */ (flowElements[k]));
                    if (!notifyActivity.Id.startsWith('NotifyActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + notifyActivity.Name) + this.localePipe.instant('validate.noNotifyActivity')
                        };
                    }
                    break;
                case 'wf.CallActivitySubProcess':
                    /** @type {?} */
                    var callActivitySubProcess = (/** @type {?} */ (flowElements[k]));
                    if (!callActivitySubProcess.Id.startsWith('CallActivitySubProcess')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + callActivitySubProcess.Name) + this.localePipe.instant('validate.noCallActivitySubProcess')
                        };
                    }
                    break;
                case 'wf.AutoActivity':
                    /** @type {?} */
                    var autoActivity = (/** @type {?} */ (flowElements[k]));
                    if (!autoActivity.Id.startsWith('autoActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + autoActivity.Name) + this.localePipe.instant('validate.noAutoActivity')
                        };
                    }
                    break;
                case 'wf.IntermediateCatchEventImpl':
                    /** @type {?} */
                    var intermediateCatchEventImpl = (/** @type {?} */ (flowElements[k]));
                    if (!intermediateCatchEventImpl.Id.startsWith('IntermediateCatchEvent')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + intermediateCatchEventImpl.Name) + this.localePipe.instant('validate.noIntermediateCatchEvent')
                        };
                    }
                    break;
                case 'wf.MessageActivity':
                    /** @type {?} */
                    var messageActivity = (/** @type {?} */ (flowElements[k]));
                    if (!messageActivity.Id.startsWith('MessageActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + messageActivity.Name) + this.localePipe.instant('validate.noMessageActivity')
                        };
                    }
                    break;
                case 'wf.AifCreationBillActivity':
                    /** @type {?} */
                    var aifCreationBillActivity = (/** @type {?} */ (flowElements[k]));
                    if (!aifCreationBillActivity.Id.startsWith('AifCreationBillActivity')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + aifCreationBillActivity.Name) + this.localePipe.instant('validate.noAifCreationBillActivity')
                        };
                    }
                    break;
                case 'bpmn.EndEvent':
                    /** @type {?} */
                    var endEvent = (/** @type {?} */ (flowElements[k]));
                    if (!endEvent.Id.startsWith('EndEvent')) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + endEvent.Name) + this.localePipe.instant('validate.noEndEvent')
                        };
                    }
                    break;
            }
        }
        return {
            valid: true,
        };
    };
    /**
     * @private
     * @param {?} flowElements
     * @return {?}
     */
    WfValidatorAdapter.validateActivityName = /**
     * @private
     * @param {?} flowElements
     * @return {?}
     */
    function (flowElements) {
        for (var k in flowElements) {
            /** @type {?} */
            var flowNode = flowElements[k];
            switch (flowNode.ClrTypeID) {
                case "wf.StartActivity":
                case "bpmn.ExclusiveGateway":
                case "bpmn.ParallelGateway":
                case "wf.UserActivity":
                case "wf.OperationActivity":
                case "wf.NotifyActivity":
                case "wf.CallActivitySubProcess":
                case "wf.AutoActivity":
                case "wf.IntermediateCatchEventImpl":
                case "wf.MessageActivity":
                case "wf.AifCreationBillActivity":
                case "bpmn.EndEvent":
                    if (flowNode.Name == null || flowNode.Name == "") {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.mark') +
                                ("" + flowNode.Id) + this.localePipe.instant('validate.noFlowNodeChsName')
                        };
                    }
                    if (new Blob([flowNode.Name]).size > 128) {
                        return {
                            valid: false,
                            type: 'message',
                            level: 'error',
                            message: this.localePipe.instant('validate.activity') +
                                ("" + flowNode.Name) + this.localePipe.instant('validate.nameExceedsLengthLimit')
                        };
                    }
                    break;
            }
            ;
        }
        return {
            valid: true,
        };
    };
    WfValidatorAdapter.localePipe = null;
    return WfValidatorAdapter;
}());
export { WfValidatorAdapter };
if (false) {
    /** @type {?} */
    WfValidatorAdapter.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ZWYWxpZGF0b3JBZGFwdGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi9kZXNpZ25lci9XZlZhbGlkYXRvckFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQStCLGVBQWUsRUFBWSxNQUFNLHFCQUFxQixDQUFDO0FBQzdGLE9BQU8sRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQWlCLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsZUFBZSxFQUFFLHNCQUFzQixFQUFFLDBCQUEwQixFQUFFLGNBQWMsRUFBMkIsTUFBTSwwQkFBMEIsQ0FBQztBQUNyUSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFJcEQ7SUFHRTtJQUVBLENBQUM7Ozs7OztJQUNRLDRCQUFTOzs7OztJQUFoQixVQUFpQixTQUFvQixFQUFFLEtBQWE7OztZQUUxQyxVQUFVLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQztRQUN2RCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRTtZQUNuQixPQUFPLFVBQVUsQ0FBQztTQUNyQjs7O1lBRUssV0FBVyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUM7UUFDeEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUU7WUFDcEIsT0FBTyxXQUFXLENBQUM7U0FDdEI7O1lBQ0ssV0FBVyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDO1FBQzNELE9BQU87WUFDSCxLQUFLLEVBQUUsSUFBSTtZQUNYLFdBQVcsRUFBRSxXQUFXO1NBQzNCLENBQUM7SUFDTixDQUFDOzs7Ozs7O0lBRVksbUNBQWdCOzs7Ozs7SUFBL0IsVUFBZ0MsU0FBb0IsRUFBRSxLQUFhOztZQUM3RCxXQUFXLEdBQUcsSUFB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Q0g7b0JBQ0QsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLEVBQUU7d0JBQ3hDLE9BQU87NEJBQ0wsS0FBSyxFQUFFLEtBQUs7NEJBQ1osSUFBSSxFQUFFLFNBQVM7NEJBQ2YsS0FBSyxFQUFFLE9BQU87NEJBQ2QsT0FBTyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDO2lDQUNyRCxLQUFHLFFBQVEsQ0FBQyxJQUFNLENBQUEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQzt5QkFDaEYsQ0FBQztxQkFDSDtvQkFDRCxNQUFNO2FBQ1Q7WUFBQSxDQUFDO1NBQ0g7UUFDRCxPQUFPO1lBQ0wsS0FBSyxFQUFFLElBQUk7U0FDWixDQUFDO0lBQ0osQ0FBQztJQTFhYSw2QkFBVSxHQUFpQixJQUFJLENBQUM7SUE0YWhELHlCQUFDO0NBQUEsQUE3YUQsSUE2YUM7U0E3YVksa0JBQWtCOzs7SUFDN0IsOEJBQThDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnBtbk1vZGVsLCBFeGNsdXNpdmVHYXRld2F5LCBQYXJhbGxlbEdhdGV3YXksIEVuZEV2ZW50IH0gZnJvbSBcIkBlZHAtcG1mL2JwbW4tbW9kZWxcIjtcclxuaW1wb3J0IHsgUHJvY2Vzc0hlYWRlciwgQ29tcG9uZW50LCBTdGFydE1vZGUsIFRvb2xUaW1lLCBTdGFydEFjdGl2aXR5LCBVc2VyQWN0aXZpdHksIE9wZXJhdGlvbkFjdGl2aXR5LCBBdXRvQWN0aXZpdHksIE1lc3NhZ2VBY3Rpdml0eSwgQ2FsbEFjdGl2aXR5U3ViUHJvY2VzcywgSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwsIE5vdGlmeUFjdGl2aXR5LCBBaWZDcmVhdGlvbkJpbGxBY3Rpdml0eSB9IGZyb20gXCJAZ3NwLXdmL3dmLXByb2Nlc3MtbW9kZWxcIjtcclxuaW1wb3J0IHsgV2ZEZXNpZ25lclV0aWxzIH0gZnJvbSBcIi4vV2ZEZXNpZ25lclV0aWxzXCI7XHJcbmltcG9ydCB7IFdmVmFsaWRhdGlvblJlc3VsdCB9IGZyb20gXCIuL1dmVmFsaWRhdGlvblJlc3VsdFwiO1xyXG5pbXBvcnQgeyBXZkxvY2FsZVBpcGUgfSBmcm9tIFwiLi4vaTE4bi9waXBlL3dmLXByb2Nlc3MtZWRpdG9yLWxvY2FsZS5waXBlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgV2ZWYWxpZGF0b3JBZGFwdGVyIHtcclxuICBwdWJsaWMgc3RhdGljIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSA9IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgXHJcbiAgfVxyXG4gICAgc3RhdGljIHZhbGlkYXRvcihicG1uTW9kZWw6IEJwbW5Nb2RlbCwgc2NlbmU6IHN0cmluZyk6IFdmVmFsaWRhdGlvblJlc3VsdCB7XHJcbiAgICAgICAgLy8g5qCh6aqM6IqC54K55qCH6K+G5piv5ZCm5ZCI6KeEXHJcbiAgICAgICAgY29uc3QgcmVzQWN0TGlzdCA9IHRoaXMudmFsaWRhdGVBY3Rpdml0eUxpc3QoYnBtbk1vZGVsKTtcclxuICAgICAgICBpZiAoIXJlc0FjdExpc3QudmFsaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc0FjdExpc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOagoemqjOa1geeoi+WPmOmHj1xyXG4gICAgICAgIGNvbnN0IHJlc1Byb2NWYXJzID0gdGhpcy52YWxpZGF0ZVByY29lc3NWYXJpcyhicG1uTW9kZWwpO1xyXG4gICAgICAgIGlmICghcmVzUHJvY1ZhcnMudmFsaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc1Byb2NWYXJzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB3YXJuaW5nTGlzdCA9IHRoaXMud2FybmluZ1ZhbGlkYXRvcihicG1uTW9kZWwsIHNjZW5lKVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxyXG4gICAgICAgICAgICB3YXJuaW5nTGlzdDogd2FybmluZ0xpc3QsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgd2FybmluZ1ZhbGlkYXRvcihicG1uTW9kZWw6IEJwbW5Nb2RlbCwgc2NlbmU6IHN0cmluZykge1xyXG4gICAgbGV0IHdhcm5pbmdMaXN0ID0gbmV3IEFycmF5KCk7XHJcbiAgICAvLyDmoKHpqozlubbooYznvZHlhbPmmK/lkKbmiJDlr7nlh7rnjrBcclxuICAgIHRoaXMudmFsaWRhdGVQYXJhbGxlbEdhdGV3YXkoYnBtbk1vZGVsLCB3YXJuaW5nTGlzdCk7XHJcbiAgICAvLyDmoKHpqozmtYHnqIvmnoTku7ZcclxuICAgIHRoaXMudmFsaWRhdGVQcm9jQ21wcyhicG1uTW9kZWwsIHNjZW5lLCB3YXJuaW5nTGlzdCk7XHJcbiAgICAvLyDmoKHpqozlrqHmibnmtLvliqjjgIHkurrlt6Xmk43kvZzlj4LkuI7ogIVcclxuICAgIHRoaXMudmFsaWRhdGVBcHByb3ZhbFBlcmZvcm1lcnMoYnBtbk1vZGVsLCB3YXJuaW5nTGlzdCk7XHJcblxyXG4gICAgcmV0dXJuIHdhcm5pbmdMaXN0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVQcm9jQ21wcyhicG1uTW9kZWw6IEJwbW5Nb2RlbCwgc2NlbmU6IHN0cmluZywgd2FybmluZ0xpc3Q6IEFycmF5PGFueT4pIHtcclxuICAgIGlmIChzY2VuZSA9PT0gJ2luU3VpdGUnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGV4dGVuZEVsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEV4dGVuc2lvbkVsZW1lbnRzKCk7XHJcbiAgICBjb25zdCBwcm9jZXNzSGVhZGVyID0gZXh0ZW5kRWxlbWVudHMuZmluZChlID0+IGUgaW5zdGFuY2VvZiBQcm9jZXNzSGVhZGVyKTtcclxuICAgIGlmICghcHJvY2Vzc0hlYWRlcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub1Byb2Nlc3NIZWFkZXInKSlcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcHJvY0NtcHMgPSBleHRlbmRFbGVtZW50cy5maWx0ZXIoZSA9PiBlIGluc3RhbmNlb2YgQ29tcG9uZW50KTtcclxuICAgIGlmICghcHJvY0NtcHMgfHwgcHJvY0NtcHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICBpZDogJ2xhY2tDbXAnLFxyXG4gICAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUuY21wc0VtcHR5JyksXHJcbiAgICAgICAgbXNnOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUuY21wc0VtcHR5TXNnJyksXHJcbiAgICAgICAgdHlwZTogJ3Byb2Nlc3NXYXJuaW5nJ1xyXG4gICAgICB9O1xyXG4gICAgICB3YXJuaW5nTGlzdC5wdXNoKHRpcCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIOWQr+eUqOaWueW8j+S4uuebtOaOpeaWueW8j+aXtlxyXG4gICAgaWYgKChwcm9jZXNzSGVhZGVyIGFzIFByb2Nlc3NIZWFkZXIpLnN0YXJ0TW9kZSA9PT0gU3RhcnRNb2RlLkRJUkVDVCkge1xyXG4gICAgICAvLyDnm7TmjqXlkK/nlKjmlrnlvI/ml7bkuI3lhYHorrjlrZjlnKjlhbHkuqvnmoTmnoTku7ZcclxuICAgICAgY29uc3QgcGZDbXBzID0gcHJvY0NtcHMuZmlsdGVyKChwOiBDb21wb25lbnQpID0+IFdmRGVzaWduZXJVdGlscy5pc1BmQ29tcG9uZW50KHAuTWV0YWRhdGFJZCkpO1xyXG4gICAgICBpZiAocGZDbXBzICYmIHBmQ21wcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IHBmQ21wc05hbWUgPSAnJztcclxuICAgICAgICBmb3IgKGNvbnN0IGNtcCBvZiBwZkNtcHMpIHtcclxuICAgICAgICAgIHBmQ21wc05hbWUgPSBwZkNtcHNOYW1lLmNvbmNhdChgJHsoY21wIGFzIENvbXBvbmVudCkuTmFtZX0sIGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwZkNtcHNOYW1lID0gcGZDbXBzTmFtZS5zbGljZSgwLCBwZkNtcHNOYW1lLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgIGlkOiAnZGlyZWN0UHJvY2Vzc1dpdGhQRkNtcCcsXHJcbiAgICAgICAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmRpcmVjdE5vUGYnKSxcclxuICAgICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmRpcmVjdE5vUGZNc2cnKStgJHtwZkNtcHNOYW1lfSBgLFxyXG4gICAgICAgICAgdHlwZTogJ3Byb2Nlc3NXYXJuaW5nJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgd2FybmluZ0xpc3QucHVzaCh0aXApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghcHJvY0NtcHMuc29tZSgoYzogQ29tcG9uZW50KSA9PiBjLlRpbWUgPT09IFRvb2xUaW1lLkxPQUREQVRBKSkge1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgIGlkOiAnbGFja0xvYWREYXRhQ21wJyxcclxuICAgICAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9Mb2FkRGF0YUNtcCcpLFxyXG4gICAgICAgICAgbXNnOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9Mb2FkRGF0YUNtcE1zZycpLFxyXG4gICAgICAgICAgdHlwZTogJ3Byb2Nlc3NXYXJuaW5nJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgd2FybmluZ0xpc3QucHVzaCh0aXApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghcHJvY0NtcHMuc29tZSgoYzogQ29tcG9uZW50KSA9PiBjLlRpbWUgPT09IFRvb2xUaW1lLlBST0NFU1NJTlNUQU5DRV9TVEFSVEVEKSkge1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgIGlkOiAnbGFja1Byb2Nlc3NTdGFydENtcCcsXHJcbiAgICAgICAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm5vU3RhcnRDbXAnKSxcclxuICAgICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm5vU3RhcnRDbXBNc2cnKSxcclxuICAgICAgICAgIHR5cGU6ICdwcm9jZXNzV2FybmluZydcclxuICAgICAgICB9O1xyXG4gICAgICAgIHdhcm5pbmdMaXN0LnB1c2godGlwKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIXByb2NDbXBzLnNvbWUoKGM6IENvbXBvbmVudCkgPT4gYy5UaW1lID09PSBUb29sVGltZS5QUk9DRVNTSU5TVEFOQ0VfQ09NUExFVEVEKSkge1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgIGlkOiAnbGFja1Byb2Nlc3NDb21wbGV0ZUNtcCcsXHJcbiAgICAgICAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmxhY2tQcm9jZXNzQ29tcGxldGVDbXAnKSxcclxuICAgICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmxhY2tQcm9jZXNzQ29tcGxldGVDbXBNc2cnKSxcclxuICAgICAgICAgIHR5cGU6ICdwcm9jZXNzV2FybmluZydcclxuICAgICAgICB9O1xyXG4gICAgICAgIHdhcm5pbmdMaXN0LnB1c2godGlwKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIXByb2NDbXBzLnNvbWUoKGM6IENvbXBvbmVudCkgPT4gKGMuVGltZSBhcyBhbnkpID09PSAnUFJPQ0VTU0lOU1RBTkNFX0FCT1JURUQnKSkge1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgIGlkOiAnbGFja1Byb2Nlc3NBYm9ydENtcCcsXHJcbiAgICAgICAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmxhY2tQcm9jZXNzQWJvcnRDbXAnKSxcclxuICAgICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmxhY2tQcm9jZXNzQWJvcnRDbXBNc2cnKSxcclxuICAgICAgICAgIHR5cGU6ICdwcm9jZXNzV2FybmluZydcclxuICAgICAgICB9O1xyXG4gICAgICAgIHdhcm5pbmdMaXN0LnB1c2godGlwKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIXByb2NDbXBzLnNvbWUoKGM6IENvbXBvbmVudCkgPT4gYy5UaW1lID09PSAnUFJPQ0VTU0lOU1RBTkNFX0NBTkNFTEVEJykpIHtcclxuICAgICAgICBjb25zdCB0aXAgPSB7XHJcbiAgICAgICAgICBpZDogJ2xhY2tQcm9jZXNzQ2FuY2VsQ21wJyxcclxuICAgICAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubGFja1Byb2Nlc3NDYW5jZWxDbXAnKSxcclxuICAgICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmxhY2tQcm9jZXNzQ2FuY2VsQ21wTXNnJyksXHJcbiAgICAgICAgICB0eXBlOiAncHJvY2Vzc1dhcm5pbmcnXHJcbiAgICAgICAgfTtcclxuICAgICAgICB3YXJuaW5nTGlzdC5wdXNoKHRpcCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCFwcm9jQ21wcy5zb21lKChjOiBDb21wb25lbnQpID0+IGMuVGltZSA9PT0gJ1BST0NFU1NJTlNUQU5DRV9ST0xMQkFDSycpKSB7XHJcbiAgICAgICAgY29uc3QgdGlwID0ge1xyXG4gICAgICAgICAgaWQ6ICdsYWNrUHJvY2Vzc0JhY2tDbXAnLFxyXG4gICAgICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5sYWNrUHJvY2Vzc0JhY2tDbXAnKSxcclxuICAgICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmxhY2tQcm9jZXNzQmFja0NtcE1zZycpLFxyXG4gICAgICAgICAgdHlwZTogJ3Byb2Nlc3NXYXJuaW5nJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgd2FybmluZ0xpc3QucHVzaCh0aXApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghcHJvY0NtcHMuc29tZSgoYzogQ29tcG9uZW50KSA9PiBjLlRpbWUgPT09ICdQUk9DRVNTSU5TVEFOQ0VfUkVTVUJNSVQnKSkge1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgIGlkOiAnbGFja1Byb2Nlc3NSZVN0YXJ0Q21wJyxcclxuICAgICAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubGFja1Byb2Nlc3NSZVN0YXJ0Q21wJyksXHJcbiAgICAgICAgICBtc2c6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5sYWNrUHJvY2Vzc1JlU3RhcnRDbXBNc2cnKSxcclxuICAgICAgICAgIHR5cGU6ICdwcm9jZXNzV2FybmluZydcclxuICAgICAgICB9O1xyXG4gICAgICAgIHdhcm5pbmdMaXN0LnB1c2godGlwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVQYXJhbGxlbEdhdGV3YXkoYnBtbk1vZGVsOiBCcG1uTW9kZWwsIHdhcm5pbmdMaXN0OiBBcnJheTxhbnk+KSB7XHJcbiAgICBjb25zdCBmbG93RWxlbWVudHMgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0Rmxvd0VsZW1lbnRzKCk7XHJcbiAgICBsZXQgcGFyYWxsZWxHYXRld2F5Q291bnQgPSAwO1xyXG4gICAgZm9yIChjb25zdCBrIGluIGZsb3dFbGVtZW50cykge1xyXG4gICAgICBpZiAoZmxvd0VsZW1lbnRzW2tdIGluc3RhbmNlb2YgUGFyYWxsZWxHYXRld2F5KSB7XHJcbiAgICAgICAgcGFyYWxsZWxHYXRld2F5Q291bnQrKztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHBhcmFsbGVsR2F0ZXdheUNvdW50ICUgMiAhPT0gMCkge1xyXG4gICAgICBjb25zdCB0aXAgPSB7XHJcbiAgICAgICAgaWQ6ICdwYXJhbGxlbEdhdGV3YXlDaGVjaycsXHJcbiAgICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5wYXJhbGxlbEdhdGV3YXlDaGVjaycpLFxyXG4gICAgICAgIG1zZzogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLnBhcmFsbGVsR2F0ZXdheUNoZWNrTXNnJyksXHJcbiAgICAgICAgdHlwZTogJ3Byb2Nlc3NXYXJuaW5nJ1xyXG4gICAgICB9O1xyXG4gICAgICB3YXJuaW5nTGlzdC5wdXNoKHRpcCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUFwcHJvdmFsUGVyZm9ybWVycyhicG1uTW9kZWw6IEJwbW5Nb2RlbCwgd2FybmluZ0xpc3Q6IGFueVtdKSB7XHJcbiAgICBjb25zdCBmbG93RWxlbWVudHMgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0Rmxvd0VsZW1lbnRzKCk7XHJcbiAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgZm9yIChjb25zdCBrIGluIGZsb3dFbGVtZW50cykge1xyXG4gICAgICBjb25zdCBhY3QgPSBmbG93RWxlbWVudHNba107XHJcbiAgICAgIGlmIChhY3QgaW5zdGFuY2VvZiBVc2VyQWN0aXZpdHkgfHwgYWN0IGluc3RhbmNlb2YgT3BlcmF0aW9uQWN0aXZpdHkpIHtcclxuICAgICAgICBjb25zdCByb2xlcyA9IGFjdC5HZXRSZXNvdXJjZVJvbGVzKCk7XHJcbiAgICAgICAgaWYgKHJvbGVzLmxlbmd0aCA9PSAwICYmICghYWN0LkFzc2lnblBlcmZvcm1lckNvbmZpZyB8fCAhYWN0LkFzc2lnblBlcmZvcm1lckNvbmZpZy5BbGxvd0dsb2JhbEFzc2lnbikpIHtcclxuICAgICAgICAgIGNvbnN0IHRpcCA9IHtcclxuICAgICAgICAgICAgaWQ6ICdhcHByb3ZhbFBlcmZvcm1lckNoZWNrJyArIGNvdW50LFxyXG4gICAgICAgICAgICB0aXRsZTogYOOAkCR7Zmxvd0VsZW1lbnRzW2tdLk5hbWV944CRYCArICB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUuYXBwcm92YWxQZXJmb3JtZXJDaGVjaycpLFxyXG4gICAgICAgICAgICBtc2c6IGBgLFxyXG4gICAgICAgICAgICB0eXBlOiAncHJvY2Vzc1dhcm5pbmcnXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgd2FybmluZ0xpc3QucHVzaCh0aXApO1xyXG5cclxuICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZVByY29lc3NWYXJpcyhicG1uTW9kZWw6IEJwbW5Nb2RlbCkge1xyXG4gICAgY29uc3Qgb2JqZWN0cyA9IGJwbW5Nb2RlbC5EZWZhdWx0UHJvY2Vzcy5HZXREYXRhT2JqZWN0cygpO1xyXG4gICAgbGV0IHByb2NWYXJpcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgaWYgKG9iamVjdHMgJiYgb2JqZWN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHByb2NWYXJpcyA9IG9iamVjdHMuZmlsdGVyKG8gPT4gby5EYXRhVHlwZS5DYXRlZ29yeSAhPT0gJ0N1c3RvbVR5cGUnKS5tYXAobyA9PiBvLk5hbWUpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZmxvd0VsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEZsb3dFbGVtZW50cygpO1xyXG4gICAgZm9yIChjb25zdCBrIGluIGZsb3dFbGVtZW50cykge1xyXG4gICAgICBpZiAoZmxvd0VsZW1lbnRzW2tdIGluc3RhbmNlb2YgVXNlckFjdGl2aXR5IHx8XHJcbiAgICAgICAgZmxvd0VsZW1lbnRzW2tdIGluc3RhbmNlb2YgT3BlcmF0aW9uQWN0aXZpdHkgfHxcclxuICAgICAgICBmbG93RWxlbWVudHNba10gaW5zdGFuY2VvZiBBdXRvQWN0aXZpdHkgfHxcclxuICAgICAgICBmbG93RWxlbWVudHNba10gaW5zdGFuY2VvZiBNZXNzYWdlQWN0aXZpdHkgfHxcclxuICAgICAgICBmbG93RWxlbWVudHNba10gaW5zdGFuY2VvZiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzIHx8XHJcbiAgICAgICAgZmxvd0VsZW1lbnRzW2tdIGluc3RhbmNlb2YgSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwgfHxcclxuICAgICAgICBmbG93RWxlbWVudHNba10gaW5zdGFuY2VvZiBOb3RpZnlBY3Rpdml0eSkge1xyXG4gICAgICAgIGNvbnN0IHZhcmlTZXRzID0gKGZsb3dFbGVtZW50c1trXSBhcyBhbnkpLnZhcmlhYmxlU2V0dGluZ3M7XHJcbiAgICAgICAgaWYgKHZhcmlTZXRzKSB7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdmFyaVNldHMpIHtcclxuICAgICAgICAgICAgaWYgKCFwcm9jVmFyaXMuc29tZShwID0+IHAgPT09IHYudmFyaWFibGVDb2RlKSkge1xyXG4gICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgICBsZXZlbDogJ3dhcm5pbmcnLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYOOAkCR7Zmxvd0VsZW1lbnRzW2tdLk5hbWV944CRYCsgIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub1ZhcmlhYmxlMScpXHJcbiAgICAgICAgICAgICAgICArYOOAkCR7di52YXJpYWJsZU5hbWV944CRYCsgdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm5vVmFyaWFibGUyJylcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbGlkOiB0cnVlLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHZhbGlkYXRlQWN0aXZpdHlMaXN0KGJwbW5Nb2RlbDogQnBtbk1vZGVsKSB7XHJcbiAgICBjb25zdCBmbG93RWxlbWVudHMgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0Rmxvd0VsZW1lbnRzKCk7XHJcbiAgICBjb25zdCByZXNBY3RJZCA9IHRoaXMudmFsaWRhdGVBY3Rpdml0eUlkKGZsb3dFbGVtZW50cyk7XHJcbiAgICBpZiAoIXJlc0FjdElkLnZhbGlkKSB7XHJcbiAgICAgIHJldHVybiByZXNBY3RJZDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc0FjdE5hbWUgPSB0aGlzLnZhbGlkYXRlQWN0aXZpdHlOYW1lKGZsb3dFbGVtZW50cyk7XHJcbiAgICBpZiAoIXJlc0FjdE5hbWUudmFsaWQpIHtcclxuICAgICAgcmV0dXJuIHJlc0FjdE5hbWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB2YWxpZDogdHJ1ZSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUFjdGl2aXR5SWQoZmxvd0VsZW1lbnRzOiBhbnkpIHtcclxuICAgIGZvciAoY29uc3QgayBpbiBmbG93RWxlbWVudHMpIHtcclxuICAgICAgc3dpdGNoIChmbG93RWxlbWVudHNba10uQ2xyVHlwZUlEKSB7XHJcbiAgICAgICAgY2FzZSAnd2YuU3RhcnRBY3Rpdml0eSc6XHJcbiAgICAgICAgICBjb25zdCBzdGFydEFjdGl2aXR5ID0gZmxvd0VsZW1lbnRzW2tdIGFzIFN0YXJ0QWN0aXZpdHk7XHJcbiAgICAgICAgICBpZiAoIXN0YXJ0QWN0aXZpdHkuSWQuc3RhcnRzV2l0aCgnc3RhcnRBY3Rpdml0eScpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIHR5cGU6ICdtZXNzYWdlJyxcclxuICAgICAgICAgICAgICBsZXZlbDogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICBtZXNzYWdlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUuYWN0aXZpdHknKSArXHJcbiAgICAgICAgICAgICAgYCR7c3RhcnRBY3Rpdml0eS5OYW1lfWArIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub1N0YXJ0QWN0aXZpdHknKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnYnBtbi5FeGNsdXNpdmVHYXRld2F5JzpcclxuICAgICAgICAgIGNvbnN0IGV4Y2x1c2l2ZUdhdGV3YXkgPSBmbG93RWxlbWVudHNba10gYXMgRXhjbHVzaXZlR2F0ZXdheTtcclxuICAgICAgICAgIGlmICghZXhjbHVzaXZlR2F0ZXdheS5JZC5zdGFydHNXaXRoKCdFeGNsdXNpdmVHYXRld2F5JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5hY3Rpdml0eScpICtcclxuICAgICAgICAgICAgICBgJHtleGNsdXNpdmVHYXRld2F5Lk5hbWV9YCsgdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm5vRXhjbHVzaXZlR2F0ZXdheScpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2JwbW4uUGFyYWxsZWxHYXRld2F5JzpcclxuICAgICAgICAgIGNvbnN0IHBhcmFsbGVsR2F0ZXdheSA9IGZsb3dFbGVtZW50c1trXSBhcyBQYXJhbGxlbEdhdGV3YXk7XHJcbiAgICAgICAgICBpZiAoIXBhcmFsbGVsR2F0ZXdheS5JZC5zdGFydHNXaXRoKCdQYXJhbGxlbEdhdGV3YXknKSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgICB0eXBlOiAnbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgbGV2ZWw6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmFjdGl2aXR5JykgK1xyXG4gICAgICAgICAgICAgIGAke3BhcmFsbGVsR2F0ZXdheS5OYW1lfWArIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub1BhcmFsbGVsR2F0ZXdheScpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd3Zi5Vc2VyQWN0aXZpdHknOlxyXG4gICAgICAgICAgY29uc3QgdXNlckFjdGl2aXR5ID0gZmxvd0VsZW1lbnRzW2tdIGFzIFVzZXJBY3Rpdml0eTtcclxuICAgICAgICAgIGlmICghdXNlckFjdGl2aXR5LklkLnN0YXJ0c1dpdGgoJ1VzZXJBY3Rpdml0eScpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIHR5cGU6ICdtZXNzYWdlJyxcclxuICAgICAgICAgICAgICBsZXZlbDogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICBtZXNzYWdlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUuYWN0aXZpdHknKSArXHJcbiAgICAgICAgICAgICAgYCR7dXNlckFjdGl2aXR5Lk5hbWV9YCsgdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm5vVXNlckFjdGl2aXR5JylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3dmLk9wZXJhdGlvbkFjdGl2aXR5JzpcclxuICAgICAgICAgIGNvbnN0IG9wZXJhdGlvbkFjdGl2aXR5ID0gZmxvd0VsZW1lbnRzW2tdIGFzIE9wZXJhdGlvbkFjdGl2aXR5O1xyXG4gICAgICAgICAgaWYgKCFvcGVyYXRpb25BY3Rpdml0eS5JZC5zdGFydHNXaXRoKCdVc2VyQWN0aXZpdHknKSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgICB0eXBlOiAnbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgbGV2ZWw6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmFjdGl2aXR5JykgK1xyXG4gICAgICAgICAgICAgIGAke29wZXJhdGlvbkFjdGl2aXR5Lk5hbWV9YCsgdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm5vT3BlcmF0aW9uQWN0aXZpdHknKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnd2YuTm90aWZ5QWN0aXZpdHknOlxyXG4gICAgICAgICAgY29uc3Qgbm90aWZ5QWN0aXZpdHkgPSBmbG93RWxlbWVudHNba10gYXMgTm90aWZ5QWN0aXZpdHk7XHJcbiAgICAgICAgICBpZiAoIW5vdGlmeUFjdGl2aXR5LklkLnN0YXJ0c1dpdGgoJ05vdGlmeUFjdGl2aXR5JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5hY3Rpdml0eScpICtcclxuICAgICAgICAgICAgICBgJHtub3RpZnlBY3Rpdml0eS5OYW1lfWArIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub05vdGlmeUFjdGl2aXR5JylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3dmLkNhbGxBY3Rpdml0eVN1YlByb2Nlc3MnOlxyXG4gICAgICAgICAgY29uc3QgY2FsbEFjdGl2aXR5U3ViUHJvY2VzcyA9IGZsb3dFbGVtZW50c1trXSBhcyBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzO1xyXG4gICAgICAgICAgaWYgKCFjYWxsQWN0aXZpdHlTdWJQcm9jZXNzLklkLnN0YXJ0c1dpdGgoJ0NhbGxBY3Rpdml0eVN1YlByb2Nlc3MnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgICB0eXBlOiAnbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgbGV2ZWw6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmFjdGl2aXR5JykgK1xyXG4gICAgICAgICAgICAgIGAke2NhbGxBY3Rpdml0eVN1YlByb2Nlc3MuTmFtZX1gKyB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9DYWxsQWN0aXZpdHlTdWJQcm9jZXNzJylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3dmLkF1dG9BY3Rpdml0eSc6XHJcbiAgICAgICAgICBjb25zdCBhdXRvQWN0aXZpdHkgPSBmbG93RWxlbWVudHNba10gYXMgQXV0b0FjdGl2aXR5O1xyXG4gICAgICAgICAgaWYgKCFhdXRvQWN0aXZpdHkuSWQuc3RhcnRzV2l0aCgnYXV0b0FjdGl2aXR5JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5hY3Rpdml0eScpICtcclxuICAgICAgICAgICAgICBgJHthdXRvQWN0aXZpdHkuTmFtZX1gKyB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9BdXRvQWN0aXZpdHknKVxyXG4gICAgICAgICAgIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICd3Zi5JbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCc6XHJcbiAgICAgICAgICBjb25zdCBpbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbCA9IGZsb3dFbGVtZW50c1trXSBhcyBJbnRlcm1lZGlhdGVDYXRjaEV2ZW50SW1wbDtcclxuICAgICAgICAgIGlmICghaW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwuSWQuc3RhcnRzV2l0aCgnSW50ZXJtZWRpYXRlQ2F0Y2hFdmVudCcpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIHR5cGU6ICdtZXNzYWdlJyxcclxuICAgICAgICAgICAgICBsZXZlbDogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICBtZXNzYWdlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUuYWN0aXZpdHknKSArXHJcbiAgICAgICAgICAgICAgYCR7aW50ZXJtZWRpYXRlQ2F0Y2hFdmVudEltcGwuTmFtZX1gKyB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9JbnRlcm1lZGlhdGVDYXRjaEV2ZW50JylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3dmLk1lc3NhZ2VBY3Rpdml0eSc6XHJcbiAgICAgICAgICBjb25zdCBtZXNzYWdlQWN0aXZpdHkgPSBmbG93RWxlbWVudHNba10gYXMgTWVzc2FnZUFjdGl2aXR5O1xyXG4gICAgICAgICAgaWYgKCFtZXNzYWdlQWN0aXZpdHkuSWQuc3RhcnRzV2l0aCgnTWVzc2FnZUFjdGl2aXR5JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5hY3Rpdml0eScpICtcclxuICAgICAgICAgICAgICBgJHttZXNzYWdlQWN0aXZpdHkuTmFtZX1gKyB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9NZXNzYWdlQWN0aXZpdHknKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnd2YuQWlmQ3JlYXRpb25CaWxsQWN0aXZpdHknOlxyXG4gICAgICAgICAgY29uc3QgYWlmQ3JlYXRpb25CaWxsQWN0aXZpdHkgPSBmbG93RWxlbWVudHNba10gYXMgQWlmQ3JlYXRpb25CaWxsQWN0aXZpdHk7XHJcbiAgICAgICAgICBpZiAoIWFpZkNyZWF0aW9uQmlsbEFjdGl2aXR5LklkLnN0YXJ0c1dpdGgoJ0FpZkNyZWF0aW9uQmlsbEFjdGl2aXR5JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5hY3Rpdml0eScpICtcclxuICAgICAgICAgICAgICBgJHthaWZDcmVhdGlvbkJpbGxBY3Rpdml0eS5OYW1lfWArIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub0FpZkNyZWF0aW9uQmlsbEFjdGl2aXR5JylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2JwbW4uRW5kRXZlbnQnOlxyXG4gICAgICAgICAgY29uc3QgZW5kRXZlbnQgPSBmbG93RWxlbWVudHNba10gYXMgRW5kRXZlbnQ7XHJcbiAgICAgICAgICBpZiAoIWVuZEV2ZW50LklkLnN0YXJ0c1dpdGgoJ0VuZEV2ZW50JykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ21lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgIGxldmVsOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5hY3Rpdml0eScpICtcclxuICAgICAgICAgICAgICBgJHtlbmRFdmVudC5OYW1lfWArIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5ub0VuZEV2ZW50JylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB2YWxpZDogdHJ1ZSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUFjdGl2aXR5TmFtZShmbG93RWxlbWVudHM6IGFueSkge1xyXG4gICAgZm9yIChjb25zdCBrIGluIGZsb3dFbGVtZW50cykge1xyXG4gICAgICBjb25zdCBmbG93Tm9kZSA9IGZsb3dFbGVtZW50c1trXTtcclxuICAgICAgc3dpdGNoIChmbG93Tm9kZS5DbHJUeXBlSUQpIHtcclxuICAgICAgICBjYXNlIFwid2YuU3RhcnRBY3Rpdml0eVwiOlxyXG4gICAgICAgIGNhc2UgXCJicG1uLkV4Y2x1c2l2ZUdhdGV3YXlcIjpcclxuICAgICAgICBjYXNlIFwiYnBtbi5QYXJhbGxlbEdhdGV3YXlcIjpcclxuICAgICAgICBjYXNlIFwid2YuVXNlckFjdGl2aXR5XCI6XHJcbiAgICAgICAgY2FzZSBcIndmLk9wZXJhdGlvbkFjdGl2aXR5XCI6XHJcbiAgICAgICAgY2FzZSBcIndmLk5vdGlmeUFjdGl2aXR5XCI6XHJcbiAgICAgICAgY2FzZSBcIndmLkNhbGxBY3Rpdml0eVN1YlByb2Nlc3NcIjpcclxuICAgICAgICBjYXNlIFwid2YuQXV0b0FjdGl2aXR5XCI6XHJcbiAgICAgICAgY2FzZSBcIndmLkludGVybWVkaWF0ZUNhdGNoRXZlbnRJbXBsXCI6XHJcbiAgICAgICAgY2FzZSBcIndmLk1lc3NhZ2VBY3Rpdml0eVwiOlxyXG4gICAgICAgIGNhc2UgXCJ3Zi5BaWZDcmVhdGlvbkJpbGxBY3Rpdml0eVwiOlxyXG4gICAgICAgIGNhc2UgXCJicG1uLkVuZEV2ZW50XCI6XHJcbiAgICAgICAgICBpZiAoZmxvd05vZGUuTmFtZSA9PSBudWxsIHx8IGZsb3dOb2RlLk5hbWUgPT0gXCJcIikge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgICB0eXBlOiAnbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgbGV2ZWw6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLm1hcmsnKSArXHJcbiAgICAgICAgICAgICAgIGAke2Zsb3dOb2RlLklkfWAgKyB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudCgndmFsaWRhdGUubm9GbG93Tm9kZUNoc05hbWUnKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKG5ldyBCbG9iKFtmbG93Tm9kZS5OYW1lXSkuc2l6ZSA+IDEyOCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgICB0eXBlOiAnbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgbGV2ZWw6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoJ3ZhbGlkYXRlLmFjdGl2aXR5JykgK1xyXG4gICAgICAgICAgICAgIGAke2Zsb3dOb2RlLk5hbWV9YCArIHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KCd2YWxpZGF0ZS5uYW1lRXhjZWVkc0xlbmd0aExpbWl0JylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsaWQ6IHRydWUsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbn1cclxuIl19
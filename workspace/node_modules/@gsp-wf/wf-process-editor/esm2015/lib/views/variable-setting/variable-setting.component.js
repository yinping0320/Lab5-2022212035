/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Output, EventEmitter, Input, ViewChild, TemplateRef, Injector, ComponentFactoryResolver, Optional, ChangeDetectorRef, Inject, LOCALE_ID } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { ProcessVariablesComponent } from '../process-variables/process-variables.component';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { VariableSetting } from './variable-setting';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
import { ComponentEditComponent } from './views/component-edit/component-edit.component';
import { of } from 'rxjs';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class VariableSettingComponent {
    /**
     * @param {?} resolver
     * @param {?} injector
     * @param {?} modalService
     * @param {?} message
     * @param {?} uistate
     * @param {?} expr
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(resolver, injector, modalService, message, uistate, expr, cdr, localeId, resources, localePipe) {
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.message = message;
        this.uistate = uistate;
        this.expr = expr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.cls = 'farris-main-area flex-column';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.value = new Array();
        this.editorParams = {};
        this.columns = [];
        this.tags = [
            { value: 'constant', text: this.localePipe.transform("component.variableSetting.constant") },
            { value: 'expression', text: this.localePipe.transform("component.variableSetting.expression") },
            { value: 'component', text: this.localePipe.transform("component.variableSetting.component") }
        ];
        this.opportunities = [
            { value: 'ACTIVITY_STARTED', text: this.localePipe.transform("component.variableSetting.ACTIVITY_STARTED") },
            { value: 'ACTIVITY_COMPLETED', text: this.localePipe.transform("component.variableSetting.ACTIVITY_COMPLETED") }
        ];
        this.modalConfig = {
            title: this.localePipe.transform("component.variableSetting.varAssign"),
            width: 780,
            height: 460,
            showButtons: true
        };
        this.beforeEdit = (/**
         * @param {?} param
         * @return {?}
         */
        (param) => {
            /** @type {?} */
            const rowData = (/** @type {?} */ (param.rowData));
            /** @type {?} */
            const column = param.column;
            if (column.field === 'valueText') {
                if (((/** @type {?} */ (rowData))).tag === this.tags[0].value) {
                    param.column.editor = { type: EditorTypes.TEXTBOX, options: {} };
                }
                else {
                    param.column.editor = {
                        type: 'input-group',
                        options: {
                            groupText: '<i class="f-icon f-icon-lookup"></i>',
                            editable: false,
                            showClear: false,
                            clickHandle: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                e.formControl.setValue(e.instance.value ? e.instance.value : '');
                                this.valueEdit(e);
                            }),
                            clear: (/**
                             * @param {?} e
                             * @return {?}
                             */
                            (e) => {
                                console.log('clear', e);
                            })
                        }
                    };
                }
            }
            return of(true);
        });
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.columns = [
            {
                field: 'variableCode', width: 90, title: this.localePipe.transform("component.variableSetting.varNumber"), sortable: true,
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'variableName', width: 90, title: this.localePipe.transform("component.variableSetting.varName"), sortable: true,
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'tag', width: 60, title: this.localePipe.transform("component.variableSetting.valueType"), sortable: true,
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.tags }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: {
                        valueField: 'value', textField: 'text', data: this.tags, idField: 'value', panelHeight: 'auto', showClear: false,
                        selectChange: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            this.value = this.value.map((/**
                             * @param {?} v
                             * @return {?}
                             */
                            v => {
                                if (v.variableCode === e.rowId) {
                                    v.value = null;
                                    v.valueText = null;
                                    if (v.component) {
                                        v.component = null;
                                    }
                                    return v;
                                }
                                else {
                                    return v;
                                }
                            }));
                        })
                    }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }, {
                field: 'executionTime', width: 80, title: this.localePipe.transform("component.variableSetting.executionTime"), sortable: true,
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.opportunities }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: {
                        valueField: 'value', textField: 'text', data: this.opportunities, idField: 'value', panelHeight: 'auto', showClear: false,
                    }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ],
            },
            {
                field: 'valueText', width: 150, title: this.localePipe.transform("component.variableSetting.valueText"), showTips: true,
                editor: { type: EditorTypes.TEXTBOX, options: {} },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            }
        ];
    }
    /**
     * @return {?}
     */
    add() {
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ProcessVariablesComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.variableSetting = true;
        compRef.instance.value = this.uistate.ProcessVariables;
        compRef.instance.selectedValue = this.value;
        compRef.instance.variableSetEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            for (const v of re) {
                /** @type {?} */
                const variableSet = new VariableSetting();
                variableSet.variableCode = v.data.name;
                variableSet.variableName = v.data.documentation;
                variableSet.tag = v.data.tag || this.tags[0].value;
                variableSet.executionTime = v.data.executionTime || this.opportunities[0].value;
                if (this.value.findIndex((/**
                 * @param {?} i
                 * @return {?}
                 */
                i => i.variableCode === variableSet.variableCode)) === -1) {
                    this.value = this.value.concat([variableSet]);
                }
            }
            dialog.close();
        }));
        compRef.instance.closeModal.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform("component.variableSetting.processVariables"),
            width: 660,
            height: 460,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
    /**
     * @return {?}
     */
    delete() {
        this.grid.endCellEdit();
        /** @type {?} */
        const selected = this.grid.selectedRow;
        if (!selected) {
            this.message.info(this.localePipe.transform("component.variableSetting.notSelectedVar"));
            return;
        }
        this.value = this.value.filter((/**
         * @param {?} v
         * @return {?}
         */
        v => v.variableCode !== selected.data.variableCode));
    }
    /**
     * @return {?}
     */
    clickOK() {
        // 先结束编辑状态
        this.grid.endCellEdit();
        // 等待编辑状态结束后再进行校验
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (this.validator()) {
                /** @type {?} */
                const object = { value: this.value, parameters: null };
                this.submitModal.emit(object);
            }
        }), 300);
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    validator() {
        for (const item of this.value) {
            if (!item.value) {
                this.message.warning(this.localePipe.transform("component.variableSetting.valueCannotEmpty"));
                return false;
            }
        }
        return true;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    endEdit(data) {
        if (data.column.field === 'valueText' && data.rowData.tag === this.tags[0].value) {
            data.rowData.value = data.rowData.valueText;
        }
    }
    /**
     * @param {?} e
     * @return {?}
     */
    valueEdit(e) {
        /** @type {?} */
        const rowdata = e.rowData;
        switch (rowdata.tag) {
            case this.tags[1].value:
                this.editExpression(e);
                break;
            case this.tags[2].value:
                this.editComponent(e);
                break;
        }
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    editExpression(e) {
        // this.expr.clearContext();
        /** @type {?} */
        const data = e.rowData;
        if (this.uistate.schemas.length > 0) {
            for (const schema of this.uistate.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.uistate.schemas[0].entityTypes && this.uistate.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.uistate.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        let context = new Array();
        context = this.uistate.addContext(context);
        if (this.uistate.subActivityContext.length > 0) {
            for (const variable of this.uistate.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.setEditPattern(ExprEditMode.Advanced); // 表达式展现模式：默认高级版
        this.expr.addExpressionText(data.value);
        this.expr.buildExpression().then((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            e.formControl.setValue(re);
            e.instance.cd.detectChanges();
            data.value = re;
            e.form.bindingData.value = re;
            e.form.value.value = re;
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    editComponent(e) {
        /** @type {?} */
        const data = e.rowData;
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ComponentEditComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.component = data.component;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            e.formControl.setValue(re.Name + '-' + re.MethodCode);
            e.instance.cd.detectChanges();
            data.value = re.Id;
            data.component = re;
            e.form.bindingData.value = re.Id;
            e.form.value.value = re.Id;
            e.form.value.component = re;
            e.form.bindingData.component = re;
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform("component.variableSetting.component"),
            width: 800,
            height: 515,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
}
VariableSettingComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-variable-setting',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base\">\r\n      <div class=\"f-title\">\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-primary mr-2\" (click)=\"add()\">{{'component.variableSetting.add' | wfLocale}}</button>\r\n        <button class=\"btn btn-secondary\" (click)=\"delete()\">{{'component.variableSetting.delete' | wfLocale}}</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class=\"f-page-main f-utils-fill-flex-column h-100\">\r\n    <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\">\r\n      <farris-datagrid #grid [data]=\"value\" [columns]=\"columns\" [idField]=\"'variableCode'\" [fit]=\"true\" [fitColumns]=\"true\"\r\n        [editable]=\"true\" [editMode]=\"'cell'\" [pagination]=\"false\" [showCheckbox]=\"false\" [multiSelect]=\"false\"\r\n        [showLineNumber]=\"true\" lineNumberTitle=\"{{'component.variableSetting.lineNumber' | wfLocale}}\" [lineNumberWidth]=\"50\" [striped]=\"true\"\r\n        (endEdit)=\"endEdit($event)\" [beforeEdit]=\"beforeEdit\">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3 mx-2\" (click)=\"clickCancel()\">{{'component.variableSetting.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.variableSetting.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n\r\n<ng-template #cell let-ctx>\r\n  <span (click)=\"valueEdit(ctx)\" class=\"link\">\r\n    {{ ctx.rowData.value ? ('component.variableSetting.set' | wfLocale) : ('component.variableSetting.notSet' | wfLocale) }}\r\n  </span>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [".link{color:#1206bb;font-size:14px}.link:hover{color:#5d478b;font-size:14px}"]
            }] }
];
/** @nocollapse */
VariableSettingComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BsModalService },
    { type: MessagerService },
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
VariableSettingComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    grid: [{ type: ViewChild, args: ['grid',] }],
    cell: [{ type: ViewChild, args: ['cell',] }]
};
if (false) {
    /** @type {?} */
    VariableSettingComponent.prototype.cls;
    /** @type {?} */
    VariableSettingComponent.prototype.closeModal;
    /** @type {?} */
    VariableSettingComponent.prototype.submitModal;
    /** @type {?} */
    VariableSettingComponent.prototype.value;
    /** @type {?} */
    VariableSettingComponent.prototype.editorParams;
    /** @type {?} */
    VariableSettingComponent.prototype.modalFooter;
    /** @type {?} */
    VariableSettingComponent.prototype.grid;
    /** @type {?} */
    VariableSettingComponent.prototype.cell;
    /** @type {?} */
    VariableSettingComponent.prototype.columns;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.tags;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.opportunities;
    /** @type {?} */
    VariableSettingComponent.prototype.modalConfig;
    /** @type {?} */
    VariableSettingComponent.prototype.beforeEdit;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    VariableSettingComponent.prototype.localePipe;
}
export class VariableSettingConverter {
    /**
     * @param {?} localePipe
     */
    constructor(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && data.length > 0) {
            return this.localePipe.transform("component.variableSetting.set");
        }
        else {
            return this.localePipe.transform("component.variableSetting.notSet");
            ;
        }
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    VariableSettingConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL3ZhcmlhYmxlLXNldHRpbmcvdmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hNLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDN0YsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDNUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3BGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBRXpGLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUIsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBV2hHLE1BQU0sT0FBTyx3QkFBd0I7Ozs7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Q1YsV0FBVyxTQUFDLE9BQU87eUJBRW5CLE1BQU07MEJBQ04sTUFBTTtvQkFFTixLQUFLOzJCQUNMLEtBQUs7MEJBQ0wsU0FBUyxTQUFDLGtCQUFrQjttQkFDNUIsU0FBUyxTQUFDLE1BQU07bUJBQ2hCLFNBQVMsU0FBQyxNQUFNOzs7O0lBVGpCLHVDQUNxQzs7SUFDckMsOENBQStDOztJQUMvQywrQ0FBZ0Q7O0lBRWhELHlDQUFxRDs7SUFDckQsZ0RBQWdDOztJQUNoQywrQ0FBNkQ7O0lBQzdELHdDQUEyQzs7SUFDM0Msd0NBQTBDOztJQUUxQywyQ0FBYTs7Ozs7SUFFYix3Q0FJRTs7Ozs7SUFFRixpREFHRTs7SUFFRiwrQ0FLRTs7SUF5SkYsOENBeUJDOzs7OztJQS9LQyw0Q0FBMEM7Ozs7O0lBQzFDLDRDQUEwQjs7Ozs7SUFDMUIsZ0RBQW9DOzs7OztJQUNwQywyQ0FBZ0M7Ozs7O0lBQ2hDLDJDQUF1Qzs7Ozs7SUFDdkMsd0NBQStCOzs7OztJQUMvQix1Q0FBMEM7Ozs7O0lBQzFDLDRDQUEyQzs7Ozs7SUFDM0MsNkNBQWlEOzs7OztJQUNqRCw4Q0FBNEM7O0FBbVFoRCxNQUFNLE9BQU8sd0JBQXdCOzs7O0lBQ25DLFlBQ1UsVUFBd0I7UUFBeEIsZUFBVSxHQUFWLFVBQVUsQ0FBYztJQUM5QixDQUFDOzs7OztJQUVMLFNBQVMsQ0FBQyxJQUFXO1FBQ25CLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzNCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsK0JBQStCLENBQUMsQ0FBQztTQUNuRTthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1lBQUEsQ0FBQztTQUN2RTtJQUNILENBQUM7Q0FDRjs7Ozs7O0lBVkcsOENBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEhvc3RCaW5kaW5nLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIE9wdGlvbmFsLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0LCBMT0NBTEVfSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFR5cGVDb252ZXJ0ZXIgfSBmcm9tICdAZmFycmlzL2lkZS1wcm9wZXJ0eS1wYW5lbCc7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IFByb2Nlc3NWYXJpYWJsZXNDb21wb25lbnQgfSBmcm9tICcuLi9wcm9jZXNzLXZhcmlhYmxlcy9wcm9jZXNzLXZhcmlhYmxlcy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IFZhcmlhYmxlU2V0dGluZyB9IGZyb20gJy4vdmFyaWFibGUtc2V0dGluZyc7XHJcbmltcG9ydCB7IEVkaXRvclR5cGVzIH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZC1lZGl0b3JzJztcclxuaW1wb3J0IHsgRXhwckVkaXRNb2RlLCBFeHByZXNzaW9uU2VydmljZSwgSW5qZWN0ZWRUeXBlIH0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcbmltcG9ydCB7IENvbXBvbmVudEVkaXRDb21wb25lbnQgfSBmcm9tICcuL3ZpZXdzL2NvbXBvbmVudC1lZGl0L2NvbXBvbmVudC1lZGl0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFJvd0VkaXRQYXJhbSB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQvbGliL3R5cGVzJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi12YXJpYWJsZS1zZXR0aW5nJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdmFyaWFibGUtc2V0dGluZy5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBWYXJpYWJsZVNldHRpbmdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxyXG4gIGNscyA9ICdmYXJyaXMtbWFpbi1hcmVhIGZsZXgtY29sdW1uJztcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBASW5wdXQoKSB2YWx1ZTogQXJyYXk8VmFyaWFibGVTZXR0aW5nPiA9IG5ldyBBcnJheSgpO1xyXG4gIEBJbnB1dCgpIGVkaXRvclBhcmFtczogYW55ID0ge307XHJcbiAgQFZpZXdDaGlsZCgnaWNvblNlbGVjdEZvb3RlcicpIG1vZGFsRm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIEBWaWV3Q2hpbGQoJ2dyaWQnKSBncmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdjZWxsJykgY2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgY29sdW1ucyA9IFtdO1xyXG5cclxuICBwcml2YXRlIHRhZ3MgPSBbXHJcbiAgICB7IHZhbHVlOiAnY29uc3RhbnQnLCB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnZhcmlhYmxlU2V0dGluZy5jb25zdGFudFwiKSB9LFxyXG4gICAgeyB2YWx1ZTogJ2V4cHJlc3Npb24nLCB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnZhcmlhYmxlU2V0dGluZy5leHByZXNzaW9uXCIpIH0sXHJcbiAgICB7IHZhbHVlOiAnY29tcG9uZW50JywgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC52YXJpYWJsZVNldHRpbmcuY29tcG9uZW50XCIpIH1cclxuICBdO1xyXG5cclxuICBwcml2YXRlIG9wcG9ydHVuaXRpZXMgPSBbXHJcbiAgICB7IHZhbHVlOiAnQUNUSVZJVFlfU1RBUlRFRCcsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLkFDVElWSVRZX1NUQVJURURcIikgfSxcclxuICAgIHsgdmFsdWU6ICdBQ1RJVklUWV9DT01QTEVURUQnLCB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnZhcmlhYmxlU2V0dGluZy5BQ1RJVklUWV9DT01QTEVURURcIikgfVxyXG4gIF07XHJcblxyXG4gIG1vZGFsQ29uZmlnID0ge1xyXG4gICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLnZhckFzc2lnblwiKSxcclxuICAgIHdpZHRoOiA3ODAsXHJcbiAgICBoZWlnaHQ6IDQ2MCxcclxuICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB1aXN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBleHByOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBASW5qZWN0KFdGX0xBTkdfUkVTT1VSQ0VTKSBwcml2YXRlIHJlc291cmNlczogYW55LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGUsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSB0aGlzLmxvY2FsZVBpcGUgfHwgbmV3IFdmTG9jYWxlUGlwZShsb2NhbGVJZCwgcmVzb3VyY2VzKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb2x1bW5zID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICd2YXJpYWJsZUNvZGUnLCB3aWR0aDogOTAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnZhcmlhYmxlU2V0dGluZy52YXJOdW1iZXJcIiksIHNvcnRhYmxlOiB0cnVlLFxyXG4gICAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgICBdXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3ZhcmlhYmxlTmFtZScsIHdpZHRoOiA5MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLnZhck5hbWVcIiksIHNvcnRhYmxlOiB0cnVlLFxyXG4gICAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgICBdXHJcbiAgICAgIH0sIHtcclxuICAgICAgICBmaWVsZDogJ3RhZycsIHdpZHRoOiA2MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLnZhbHVlVHlwZVwiKSwgc29ydGFibGU6IHRydWUsXHJcbiAgICAgICAgZm9ybWF0dGVyOiB7XHJcbiAgICAgICAgICB0eXBlOiAnZW51bScsXHJcbiAgICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB0aGlzLnRhZ3MgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZWRpdG9yOiB7XHJcbiAgICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5DT01CT0xJU1QsXHJcbiAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgIHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB0aGlzLnRhZ3MsIGlkRmllbGQ6ICd2YWx1ZScsIHBhbmVsSGVpZ2h0OiAnYXV0bycsIHNob3dDbGVhcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHNlbGVjdENoYW5nZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZS5tYXAodiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi52YXJpYWJsZUNvZGUgPT09IGUucm93SWQpIHtcclxuICAgICAgICAgICAgICAgICAgdi52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgIHYudmFsdWVUZXh0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgaWYgKHYuY29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdi5jb21wb25lbnQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiB2O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHY7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgICBdXHJcbiAgICAgIH0sIHtcclxuICAgICAgICBmaWVsZDogJ2V4ZWN1dGlvblRpbWUnLCB3aWR0aDogODAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnZhcmlhYmxlU2V0dGluZy5leGVjdXRpb25UaW1lXCIpLCBzb3J0YWJsZTogdHJ1ZSxcclxuICAgICAgICBmb3JtYXR0ZXI6IHtcclxuICAgICAgICAgIHR5cGU6ICdlbnVtJyxcclxuICAgICAgICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IHRoaXMub3Bwb3J0dW5pdGllcyB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgIHR5cGU6IEVkaXRvclR5cGVzLkNPTUJPTElTVCxcclxuICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IHRoaXMub3Bwb3J0dW5pdGllcywgaWRGaWVsZDogJ3ZhbHVlJywgcGFuZWxIZWlnaHQ6ICdhdXRvJywgc2hvd0NsZWFyOiBmYWxzZSxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbGlkYXRvcnM6IFtcclxuICAgICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgICBdLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICd2YWx1ZVRleHQnLCB3aWR0aDogMTUwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC52YXJpYWJsZVNldHRpbmcudmFsdWVUZXh0XCIpLCBzaG93VGlwczogdHJ1ZSxcclxuICAgICAgICBlZGl0b3I6IHsgdHlwZTogRWRpdG9yVHlwZXMuVEVYVEJPWCwgb3B0aW9uczoge30gfSxcclxuICAgICAgICB2YWxpZGF0b3JzOiBbXHJcbiAgICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn5b+F5aGrJyB9XHJcbiAgICAgICAgXVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgYWRkKCkge1xyXG4gICAgbGV0IGRpYWxvZzogYW55O1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFByb2Nlc3NWYXJpYWJsZXNDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UudmFyaWFibGVTZXR0aW5nID0gdHJ1ZTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UudmFsdWUgPSB0aGlzLnVpc3RhdGUuUHJvY2Vzc1ZhcmlhYmxlcztcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2VsZWN0ZWRWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhcmlhYmxlU2V0RW1pdHRlci5zdWJzY3JpYmUoKHJlOiBhbnlbXSkgPT4ge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgcmUpIHtcclxuICAgICAgICBjb25zdCB2YXJpYWJsZVNldCA9IG5ldyBWYXJpYWJsZVNldHRpbmcoKTtcclxuICAgICAgICB2YXJpYWJsZVNldC52YXJpYWJsZUNvZGUgPSB2LmRhdGEubmFtZTtcclxuICAgICAgICB2YXJpYWJsZVNldC52YXJpYWJsZU5hbWUgPSB2LmRhdGEuZG9jdW1lbnRhdGlvbjtcclxuICAgICAgICB2YXJpYWJsZVNldC50YWcgPSB2LmRhdGEudGFnIHx8IHRoaXMudGFnc1swXS52YWx1ZTtcclxuICAgICAgICB2YXJpYWJsZVNldC5leGVjdXRpb25UaW1lID0gdi5kYXRhLmV4ZWN1dGlvblRpbWUgfHwgdGhpcy5vcHBvcnR1bml0aWVzWzBdLnZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLnZhbHVlLmZpbmRJbmRleChpID0+IGkudmFyaWFibGVDb2RlID09PSB2YXJpYWJsZVNldC52YXJpYWJsZUNvZGUpID09PSAtMSkge1xyXG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuY29uY2F0KFt2YXJpYWJsZVNldF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLnByb2Nlc3NWYXJpYWJsZXNcIiksXHJcbiAgICAgIHdpZHRoOiA2NjAsXHJcbiAgICAgIGhlaWdodDogNDYwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlclxyXG4gICAgfTtcclxuICAgIGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKCkge1xyXG4gICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICBjb25zdCBzZWxlY3RlZCA9IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdztcclxuICAgIGlmICghc2VsZWN0ZWQpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC52YXJpYWJsZVNldHRpbmcubm90U2VsZWN0ZWRWYXJcIikpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZS5maWx0ZXIodiA9PiB2LnZhcmlhYmxlQ29kZSAhPT0gc2VsZWN0ZWQuZGF0YS52YXJpYWJsZUNvZGUpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPSygpIHtcclxuICAgIC8vIOWFiOe7k+adn+e8lui+keeKtuaAgVxyXG4gICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICAvLyDnrYnlvoXnvJbovpHnirbmgIHnu5PmnZ/lkI7lho3ov5vooYzmoKHpqoxcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy52YWxpZGF0b3IoKSkge1xyXG4gICAgICAgIGNvbnN0IG9iamVjdCA9IHsgdmFsdWU6IHRoaXMudmFsdWUsIHBhcmFtZXRlcnM6IG51bGwgfTtcclxuICAgICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICAgICAgfVxyXG4gICAgfSwgMzAwKTtcclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRvcigpIHtcclxuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnZhbHVlKSB7XHJcbiAgICAgIGlmICghaXRlbS52YWx1ZSkge1xyXG4gICAgICAgIHRoaXMubWVzc2FnZS53YXJuaW5nKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLnZhbHVlQ2Fubm90RW1wdHlcIikpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIGJlZm9yZUVkaXQgPSAocGFyYW06IFJvd0VkaXRQYXJhbSkgPT4ge1xyXG4gICAgY29uc3Qgcm93RGF0YSA9IHBhcmFtLnJvd0RhdGEgYXMgYW55O1xyXG4gICAgY29uc3QgY29sdW1uID0gcGFyYW0uY29sdW1uO1xyXG4gICAgaWYgKGNvbHVtbi5maWVsZCA9PT0gJ3ZhbHVlVGV4dCcpIHtcclxuICAgICAgaWYgKChyb3dEYXRhIGFzIFZhcmlhYmxlU2V0dGluZykudGFnID09PSB0aGlzLnRhZ3NbMF0udmFsdWUpIHtcclxuICAgICAgICBwYXJhbS5jb2x1bW4uZWRpdG9yID0geyB0eXBlOiBFZGl0b3JUeXBlcy5URVhUQk9YLCBvcHRpb25zOiB7fSB9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBhcmFtLmNvbHVtbi5lZGl0b3IgPSB7XHJcbiAgICAgICAgICB0eXBlOiAnaW5wdXQtZ3JvdXAnLFxyXG4gICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICBncm91cFRleHQ6ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPicsXHJcbiAgICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgc2hvd0NsZWFyOiBmYWxzZSxcclxuICAgICAgICAgICAgY2xpY2tIYW5kbGU6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShlLmluc3RhbmNlLnZhbHVlID8gZS5pbnN0YW5jZS52YWx1ZSA6ICcnKTtcclxuICAgICAgICAgICAgICB0aGlzLnZhbHVlRWRpdChlKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2xlYXI6IChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyJywgZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG5cclxuICBlbmRFZGl0KGRhdGE6IGFueSkge1xyXG4gICAgaWYgKGRhdGEuY29sdW1uLmZpZWxkID09PSAndmFsdWVUZXh0JyAmJiBkYXRhLnJvd0RhdGEudGFnID09PSB0aGlzLnRhZ3NbMF0udmFsdWUpIHtcclxuICAgICAgZGF0YS5yb3dEYXRhLnZhbHVlID0gZGF0YS5yb3dEYXRhLnZhbHVlVGV4dDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHZhbHVlRWRpdChlOiBhbnkpIHtcclxuICAgIGNvbnN0IHJvd2RhdGE6IFZhcmlhYmxlU2V0dGluZyA9IGUucm93RGF0YTtcclxuICAgIHN3aXRjaCAocm93ZGF0YS50YWcpIHtcclxuICAgICAgY2FzZSB0aGlzLnRhZ3NbMV0udmFsdWU6XHJcbiAgICAgICAgdGhpcy5lZGl0RXhwcmVzc2lvbihlKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSB0aGlzLnRhZ3NbMl0udmFsdWU6XHJcbiAgICAgICAgdGhpcy5lZGl0Q29tcG9uZW50KGUpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBlZGl0RXhwcmVzc2lvbihlOiBhbnkpIHtcclxuICAgIC8vIHRoaXMuZXhwci5jbGVhckNvbnRleHQoKTtcclxuICAgIGNvbnN0IGRhdGE6IFZhcmlhYmxlU2V0dGluZyA9IGUucm93RGF0YTtcclxuICAgIGlmICh0aGlzLnVpc3RhdGUuc2NoZW1hcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc2NoZW1hIG9mIHRoaXMudWlzdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy51aXN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMgJiYgdGhpcy51aXN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBsZXQgY29udGV4dCA9IG5ldyBBcnJheSgpO1xyXG4gICAgY29udGV4dCA9IHRoaXMudWlzdGF0ZS5hZGRDb250ZXh0KGNvbnRleHQpO1xyXG4gICAgaWYgKHRoaXMudWlzdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMudWlzdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRDb250ZXh0KHYpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmV4cHIuc2V0RWRpdFBhdHRlcm4oRXhwckVkaXRNb2RlLkFkdmFuY2VkKTsgLy8g6KGo6L6+5byP5bGV546w5qih5byP77ya6buY6K6k6auY57qn54mIXHJcbiAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoZGF0YS52YWx1ZSk7XHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigocmU6IHN0cmluZykgPT4ge1xyXG4gICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKHJlKTtcclxuICAgICAgZS5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgIGRhdGEudmFsdWUgPSByZTtcclxuICAgICAgZS5mb3JtLmJpbmRpbmdEYXRhLnZhbHVlID0gcmU7XHJcbiAgICAgIGUuZm9ybS52YWx1ZS52YWx1ZSA9IHJlO1xyXG4gICAgICAvL+eCueWHu+ehruWumuWQju+8jOWOu+mZpOihqOi+vuW8j+mHjOmdoueahOaWsOWinueahOS4iuS4i+aWh+WPmOmHj1xyXG4gICAgICBpZihjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMgPSB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmlsdGVyKHggPT4gIWNvbnRleHQuc29tZSh5ID0+IHkua2V5ID09PSB4LmtleSkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZWRpdENvbXBvbmVudChlOiBhbnkpIHtcclxuICAgIGNvbnN0IGRhdGE6IFZhcmlhYmxlU2V0dGluZyA9IGUucm93RGF0YTtcclxuICAgIGxldCBkaWFsb2c6IGFueTtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShDb21wb25lbnRFZGl0Q29tcG9uZW50KTtcclxuICAgIGNvbnN0IGNvbXBSZWYgPSBjb21wRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNvbXBvbmVudCA9IGRhdGEuY29tcG9uZW50O1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXRFbWl0dGVyLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKHJlLk5hbWUgKyAnLScgKyByZS5NZXRob2RDb2RlKTtcclxuICAgICAgZS5pbnN0YW5jZS5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgIGRhdGEudmFsdWUgPSByZS5JZDtcclxuICAgICAgZGF0YS5jb21wb25lbnQgPSByZTtcclxuICAgICAgZS5mb3JtLmJpbmRpbmdEYXRhLnZhbHVlID0gcmUuSWQ7XHJcbiAgICAgIGUuZm9ybS52YWx1ZS52YWx1ZSA9IHJlLklkO1xyXG4gICAgICBlLmZvcm0udmFsdWUuY29tcG9uZW50ID0gcmU7XHJcbiAgICAgIGUuZm9ybS5iaW5kaW5nRGF0YS5jb21wb25lbnQgPSByZTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VFbWl0dGVyLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudmFyaWFibGVTZXR0aW5nLmNvbXBvbmVudFwiKSxcclxuICAgICAgd2lkdGg6IDgwMCxcclxuICAgICAgaGVpZ2h0OiA1MTUsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmZvb3RlclxyXG4gICAgfTtcclxuICAgIGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFZhcmlhYmxlU2V0dGluZ0NvbnZlcnRlciBpbXBsZW1lbnRzIFR5cGVDb252ZXJ0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGVcclxuICApIHsgfVxyXG5cclxuICBjb252ZXJ0VG8oZGF0YTogYW55W10pOiBzdHJpbmcge1xyXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnZhcmlhYmxlU2V0dGluZy5zZXRcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC52YXJpYWJsZVNldHRpbmcubm90U2V0XCIpOztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
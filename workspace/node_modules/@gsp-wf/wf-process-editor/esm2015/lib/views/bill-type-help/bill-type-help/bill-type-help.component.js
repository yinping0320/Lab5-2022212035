/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Output, ViewChild } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { BsModalService } from '@farris/ui-modal';
import { NotifyService } from '@farris/ui-notify';
import { BillTypeHelpService } from '../bill-type-help.service';
import { TreeTableComponent } from '@farris/ui-treetable';
import { AifLocalePipe, BIF_LANG_RESOURCES } from '../../aif-ui-common/pipe/aif-ui-common-locale.pipe';
import { BILL_TYPE_HELP_LANG_RESOURCES } from '../i18n/lang.resource';
const ɵ0 = BILL_TYPE_HELP_LANG_RESOURCES;
export class BillTypeHelpComponent {
    /**
     * @param {?} entityService
     * @param {?} messager
     * @param {?} notify
     * @param {?} modal
     * @param {?} loading
     * @param {?} localePipe
     * @param {?} router
     * @param {?} activatedRoute
     */
    constructor(entityService, messager, notify, modal, loading, localePipe, router, activatedRoute) {
        this.entityService = entityService;
        this.messager = messager;
        this.notify = notify;
        this.modal = modal;
        this.loading = loading;
        this.localePipe = localePipe;
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.onselected = new EventEmitter();
        this.ttIdField = 'id';
        this.ttSearchFields = [];
        this.ttAllColumnsTitle = this.localePipe.instant("allColumns");
        this.docuTypeList = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.configLookupColumns();
        this.loadItems();
    }
    /**
     * @return {?}
     */
    getSelectedDocuType() {
        return this.tt.selectedRow && this.tt.selectedRow.data;
    }
    /**
     * 左侧树表搜索事件
     * @param {?} obj
     * @return {?}
     */
    ttSearch(obj) {
        this.ttSearchObj = obj;
        this.ttSearchObj && this.tt.searchHandle.search(this.ttSearchObj.field, this.ttSearchObj.value);
    }
    /**
     * @return {?}
     */
    loadItems() {
        /** @type {?} */
        let entities$ = null;
        entities$ = this.entityService.findDocumentTypeEntites();
        /** @type {?} */
        const l = this.loading.show({ message: this.localePipe.instant("loading") });
        entities$.subscribe((/**
         * @param {?} entities
         * @return {?}
         */
        (entities) => {
            l.close();
            this.ttData = [...this.buildTreeData(entities)];
            this.docuTypeList = entities;
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.tt.expandAll();
                if (this.docuTypeId) {
                    this.tt.selectNode(this.docuTypeId);
                }
                else {
                    //默认选中第一条数据
                    this.docuTypeList && this.docuTypeList.length > 0 && this.tt.selectNode(this.docuTypeList[0].id);
                }
            }), 100);
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            l.close();
            //todo 确定异常结构, 目前采用兼容取值方式
            this.messager.error(err.error == null ? err.message : (err.error.Message || err.error.message || err.message));
            throw err;
        }));
    }
    /**
     * @param {?} nsp
     * @return {?}
     */
    ttNodeSelected(nsp) {
        /** @type {?} */
        let rows = [];
        if (Array.isArray(nsp.node)) {
            /** @type {?} */
            const arr = nsp.node;
            arr.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                rows.push(it);
            }));
        }
        else {
            rows.push(nsp.node);
        }
        if (rows.length == 0) {
            return;
        }
        /** @type {?} */
        let row = rows[0];
        this.docuTypeId = row.id;
    }
    /**
     * @param {?} entities
     * @return {?}
     */
    buildTreeData(entities) {
        /** @type {?} */
        const nodes = [];
        /** @type {?} */
        const map = {};
        entities && entities.forEach((/**
         * @param {?} it
         * @return {?}
         */
        it => {
            if (map[it.bizKindName] == null) {
                map[it.bizKindName] = [it];
            }
            else {
                map[it.bizKindName].push(it);
            }
        }));
        Object.keys(map).forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            /** @type {?} */
            const node = {
                id: key,
                data: {
                    id: key,
                    bizKindName: key,
                    treeInfo: {
                        layer: 1,
                    }
                },
                selectable: false,
                leaf: false,
            };
            /** @type {?} */
            const children = map[key].map((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                /** @type {?} */
                const node = {
                    id: it.id,
                    data: Object.assign({}, it, { treeInfo: {
                            layer: 2,
                            parentId: key,
                        } }),
                    selectable: true,
                    leaf: true
                };
                return node;
            }));
            node.children = children;
            nodes.push(node);
        }));
        return nodes;
    }
    /**
     * @private
     * @return {?}
     */
    configLookupColumns() {
        this.ttCols = [
            { field: "bizKindName", title: this.localePipe.instant("busineseCategory"), width: 100 },
            { field: "name", title: this.localePipe.instant("name"), width: 80 },
            { field: "code", title: this.localePipe.instant("code"), width: 80 },
            { field: "moduleName", title: this.localePipe.instant("module"), width: 100 },
            { field: "bizTypeName", title: this.localePipe.instant("busineseType"), width: 100 },
        ];
    }
}
BillTypeHelpComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-bill-type-help',
                template: "<div class=\"g-main\" style=\"padding-left: 24px; padding-right: 24px;\">\r\n  <div class=\"h-100 d-flex flex-column\">\r\n    <farris-treetable #tt class=\"f-utils-fill-flex-column\" [data]=\"ttData\" [columns]=\"ttCols\" [idField]=\"ttIdField\"\r\n      [fit]=\"true\" [showFilterBar]=\"true\" [searchFields]=\"ttSearchFields\" [showIcon]=\"false\" [resizableColumns]=\"true\"\r\n      [showBorder]=\"true\" [striped]=\"true\" [allColumnsTitle]=\"ttAllColumnsTitle\" [expandLevel]=\"0\" [showHeader]=\"true\"\r\n      [fixedHeader]=\"true\" [singleSelect]=\"true\" [showCheckbox]=\"false\" [showCheckAll]=\"false\" [checkOnSelect]=\"true\"\r\n      [selectOnCheck]=\"true\" (search)=\"ttSearch($event)\" (nodeSelected)=\"ttNodeSelected($event)\">\r\n    </farris-treetable>\r\n  </div>\r\n</div>",
                providers: [
                    { provide: BIF_LANG_RESOURCES, useValue: ɵ0 },
                    AifLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
BillTypeHelpComponent.ctorParameters = () => [
    { type: BillTypeHelpService },
    { type: MessagerService },
    { type: NotifyService },
    { type: BsModalService },
    { type: LoadingService },
    { type: AifLocalePipe },
    { type: Router },
    { type: ActivatedRoute }
];
BillTypeHelpComponent.propDecorators = {
    onselected: [{ type: Output, args: ["onselected",] }],
    tt: [{ type: ViewChild, args: ['tt',] }]
};
if (false) {
    /** @type {?} */
    BillTypeHelpComponent.prototype.onselected;
    /** @type {?} */
    BillTypeHelpComponent.prototype.tt;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttData;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttCols;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttIdField;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttSearchFields;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttSearchObj;
    /** @type {?} */
    BillTypeHelpComponent.prototype.ttAllColumnsTitle;
    /** @type {?} */
    BillTypeHelpComponent.prototype.docuTypeList;
    /** @type {?} */
    BillTypeHelpComponent.prototype.docuTypeId;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.entityService;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.messager;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.modal;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.localePipe;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    BillTypeHelpComponent.prototype.activatedRoute;
}
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC10eXBlLWhlbHAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9iaWxsLXR5cGUtaGVscC9iaWxsLXR5cGUtaGVscC9iaWxsLXR5cGUtaGVscC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUd6RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHbEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDaEUsT0FBTyxFQUErQixrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxhQUFhLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUN2RyxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztXQU96Qiw2QkFBNkI7QUFJMUUsTUFBTSxPQUFPLHFCQUFxQjs7Ozs7Ozs7Ozs7SUFvQmhDLFlBQ1UsYUFBa0MsRUFDbEMsUUFBeUIsRUFDekIsTUFBcUIsRUFDckIsS0FBcUIsRUFDckIsT0FBdUIsRUFDdkIsVUFBeUIsRUFDekIsTUFBYyxFQUNkLGNBQThCO1FBUDlCLGtCQUFhLEdBQWIsYUFBYSxDQUFxQjtRQUNsQyxhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQUN6QixX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Q29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIE9uSW5pdCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcblxyXG5pbXBvcnQgeyBEb2N1VHlwZUhlbHBlckVudGl0eSB9IGZyb20gJy4uL2VudGl0eS9Eb2N1VHlwZUhlbHBlckVudGl0eSc7XHJcbmltcG9ydCB7IEJpbGxUeXBlSGVscFNlcnZpY2UgfSBmcm9tICcuLi9iaWxsLXR5cGUtaGVscC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTm9kZVNlbGVjdGVkUGFyYW0sIFRyZWVOb2RlLCBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IEFpZkxvY2FsZVBpcGUsIEJJRl9MQU5HX1JFU09VUkNFUyB9IGZyb20gJy4uLy4uL2FpZi11aS1jb21tb24vcGlwZS9haWYtdWktY29tbW9uLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgQklMTF9UWVBFX0hFTFBfTEFOR19SRVNPVVJDRVMgfSBmcm9tICcuLi9pMThuL2xhbmcucmVzb3VyY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtYmlsbC10eXBlLWhlbHAnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9iaWxsLXR5cGUtaGVscC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYmlsbC10eXBlLWhlbHAuY29tcG9uZW50LmNzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgeyBwcm92aWRlOiBCSUZfTEFOR19SRVNPVVJDRVMsIHVzZVZhbHVlOiBCSUxMX1RZUEVfSEVMUF9MQU5HX1JFU09VUkNFUyB9LFxyXG4gICAgQWlmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBCaWxsVHlwZUhlbHBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBPdXRwdXQoXCJvbnNlbGVjdGVkXCIpXHJcbiAgb25zZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXI8RG9jdVR5cGVIZWxwZXJFbnRpdHk+KCk7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ3R0JylcclxuICB0dDogVHJlZVRhYmxlQ29tcG9uZW50O1xyXG4gIHR0RGF0YTogVHJlZU5vZGVbXTtcclxuICB0dENvbHM6IGFueVtdO1xyXG4gIHR0SWRGaWVsZCA9ICdpZCc7XHJcbiAgdHRTZWFyY2hGaWVsZHM6IHtcclxuICAgIGxhYmVsOiBzdHJpbmc7XHJcbiAgICB2YWx1ZTogc3RyaW5nO1xyXG4gIH1bXSA9IFtdO1xyXG4gIHR0U2VhcmNoT2JqOiB7IGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfTtcclxuICB0dEFsbENvbHVtbnNUaXRsZTogc3RyaW5nID0gdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJhbGxDb2x1bW5zXCIpO1xyXG5cclxuICBkb2N1VHlwZUxpc3Q6IERvY3VUeXBlSGVscGVyRW50aXR5W10gPSBbXTtcclxuXHJcbiAgZG9jdVR5cGVJZDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZW50aXR5U2VydmljZTogQmlsbFR5cGVIZWxwU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZXI6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgbm90aWZ5OiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtb2RhbDogQnNNb2RhbFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGxvYWRpbmc6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBsb2NhbGVQaXBlOiBBaWZMb2NhbGVQaXBlLFxyXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcclxuICAgIHByaXZhdGUgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICkgeyB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5jb25maWdMb29rdXBDb2x1bW5zKCk7XHJcbiAgICB0aGlzLmxvYWRJdGVtcygpO1xyXG4gIH1cclxuXHJcbiAgZ2V0U2VsZWN0ZWREb2N1VHlwZSgpOiBEb2N1VHlwZUhlbHBlckVudGl0eSB7XHJcbiAgICByZXR1cm4gdGhpcy50dC5zZWxlY3RlZFJvdyAmJiB0aGlzLnR0LnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlt6bkvqfmoJHooajmkJzntKLkuovku7ZcclxuICAgKi9cclxuICB0dFNlYXJjaChvYmo6IHsgZmllbGQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9KSB7XHJcbiAgICB0aGlzLnR0U2VhcmNoT2JqID0gb2JqO1xyXG4gICAgdGhpcy50dFNlYXJjaE9iaiAmJiB0aGlzLnR0LnNlYXJjaEhhbmRsZS5zZWFyY2godGhpcy50dFNlYXJjaE9iai5maWVsZCwgdGhpcy50dFNlYXJjaE9iai52YWx1ZSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgbG9hZEl0ZW1zKCkge1xyXG4gICAgbGV0IGVudGl0aWVzJDogT2JzZXJ2YWJsZTxEb2N1VHlwZUhlbHBlckVudGl0eVtdPiA9IG51bGw7XHJcbiAgICBlbnRpdGllcyQgPSB0aGlzLmVudGl0eVNlcnZpY2UuZmluZERvY3VtZW50VHlwZUVudGl0ZXMoKTtcclxuICAgIGNvbnN0IGwgPSB0aGlzLmxvYWRpbmcuc2hvdyh7IG1lc3NhZ2U6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwibG9hZGluZ1wiKSB9KTtcclxuICAgIGVudGl0aWVzJC5zdWJzY3JpYmUoXHJcbiAgICAgIChlbnRpdGllczogRG9jdVR5cGVIZWxwZXJFbnRpdHlbXSkgPT4ge1xyXG4gICAgICAgIGwuY2xvc2UoKTtcclxuICAgICAgICB0aGlzLnR0RGF0YSA9IFsuLi50aGlzLmJ1aWxkVHJlZURhdGEoZW50aXRpZXMpXTtcclxuICAgICAgICB0aGlzLmRvY3VUeXBlTGlzdCA9IGVudGl0aWVzO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy50dC5leHBhbmRBbGwoKTtcclxuICAgICAgICAgIGlmICh0aGlzLmRvY3VUeXBlSWQpIHtcclxuICAgICAgICAgICAgdGhpcy50dC5zZWxlY3ROb2RlKHRoaXMuZG9jdVR5cGVJZCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL+m7mOiupOmAieS4reesrOS4gOadoeaVsOaNrlxyXG4gICAgICAgICAgICB0aGlzLmRvY3VUeXBlTGlzdCAmJiB0aGlzLmRvY3VUeXBlTGlzdC5sZW5ndGggPiAwICYmIHRoaXMudHQuc2VsZWN0Tm9kZSh0aGlzLmRvY3VUeXBlTGlzdFswXS5pZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgICAgfSxcclxuICAgICAgKGVycikgPT4ge1xyXG4gICAgICAgIGwuY2xvc2UoKTtcclxuICAgICAgICAvL3RvZG8g56Gu5a6a5byC5bi457uT5p6ELCDnm67liY3ph4fnlKjlhbzlrrnlj5blgLzmlrnlvI9cclxuICAgICAgICB0aGlzLm1lc3NhZ2VyLmVycm9yKGVyci5lcnJvciA9PSBudWxsID8gZXJyLm1lc3NhZ2UgOiAoZXJyLmVycm9yLk1lc3NhZ2UgfHwgZXJyLmVycm9yLm1lc3NhZ2UgfHwgZXJyLm1lc3NhZ2UpKTtcclxuICAgICAgICB0aHJvdyBlcnI7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICB0dE5vZGVTZWxlY3RlZChuc3A6IE5vZGVTZWxlY3RlZFBhcmFtKSB7XHJcbiAgICBsZXQgcm93czogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobnNwLm5vZGUpKSB7XHJcbiAgICAgIGNvbnN0IGFycjogVHJlZU5vZGVbXSA9IG5zcC5ub2RlO1xyXG4gICAgICBhcnIuZm9yRWFjaChpdCA9PiB7XHJcbiAgICAgICAgcm93cy5wdXNoKGl0KTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByb3dzLnB1c2gobnNwLm5vZGUpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJvd3MubGVuZ3RoID09IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHJvdyA9IHJvd3NbMF07XHJcbiAgICB0aGlzLmRvY3VUeXBlSWQgPSByb3cuaWQ7XHJcbiAgfVxyXG5cclxuICBidWlsZFRyZWVEYXRhKGVudGl0aWVzOiBEb2N1VHlwZUhlbHBlckVudGl0eVtdKTogVHJlZU5vZGVbXSB7XHJcbiAgICBjb25zdCBub2RlczogVHJlZU5vZGVbXSA9IFtdO1xyXG4gICAgY29uc3QgbWFwOiB7XHJcbiAgICAgIFtrZXk6IHN0cmluZ106IERvY3VUeXBlSGVscGVyRW50aXR5W11cclxuICAgIH0gPSB7fTtcclxuICAgIGVudGl0aWVzICYmIGVudGl0aWVzLmZvckVhY2goaXQgPT4ge1xyXG4gICAgICBpZiAobWFwW2l0LmJpektpbmROYW1lXSA9PSBudWxsKSB7XHJcbiAgICAgICAgbWFwW2l0LmJpektpbmROYW1lXSA9IFtpdF07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbWFwW2l0LmJpektpbmROYW1lXS5wdXNoKGl0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgT2JqZWN0LmtleXMobWFwKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vZGU6IFRyZWVOb2RlID0ge1xyXG4gICAgICAgIGlkOiBrZXksXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IGtleSxcclxuICAgICAgICAgIGJpektpbmROYW1lOiBrZXksXHJcbiAgICAgICAgICB0cmVlSW5mbzoge1xyXG4gICAgICAgICAgICBsYXllcjogMSxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxyXG4gICAgICAgIGxlYWY6IGZhbHNlLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgY2hpbGRyZW4gPSBtYXBba2V5XS5tYXAoaXQgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5vZGU6IFRyZWVOb2RlID0ge1xyXG4gICAgICAgICAgaWQ6IGl0LmlkLFxyXG4gICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAuLi5pdCxcclxuICAgICAgICAgICAgdHJlZUluZm86IHtcclxuICAgICAgICAgICAgICBsYXllcjogMixcclxuICAgICAgICAgICAgICBwYXJlbnRJZDoga2V5LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHNlbGVjdGFibGU6IHRydWUsXHJcbiAgICAgICAgICBsZWFmOiB0cnVlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbm9kZS5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG5cclxuICAgICAgbm9kZXMucHVzaChub2RlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBub2RlcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY29uZmlnTG9va3VwQ29sdW1ucygpIHtcclxuICAgIHRoaXMudHRDb2xzID0gW1xyXG4gICAgICB7IGZpZWxkOiBcImJpektpbmROYW1lXCIsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcImJ1c2luZXNlQ2F0ZWdvcnlcIiksIHdpZHRoOiAxMDAgfSxcclxuICAgICAgeyBmaWVsZDogXCJuYW1lXCIsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUuaW5zdGFudChcIm5hbWVcIiksIHdpZHRoOiA4MCB9LFxyXG4gICAgICB7IGZpZWxkOiBcImNvZGVcIiwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwiY29kZVwiKSwgd2lkdGg6IDgwIH0sXHJcbiAgICAgIHsgZmllbGQ6IFwibW9kdWxlTmFtZVwiLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJtb2R1bGVcIiksIHdpZHRoOiAxMDAgfSxcclxuICAgICAgeyBmaWVsZDogXCJiaXpUeXBlTmFtZVwiLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLmluc3RhbnQoXCJidXNpbmVzZVR5cGVcIiksIHdpZHRoOiAxMDAgfSxcclxuICAgIF07XHJcbiAgfVxyXG59XHJcbiJdfQ==
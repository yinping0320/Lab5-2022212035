/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ComponentFactoryResolver, EventEmitter, Inject, Injector, Input, LOCALE_ID, Optional, Output, TemplateRef, ViewChild } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { of } from 'rxjs';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
import { SelectMetadataRTComponent } from '@gsp-lcm/metadatart-selector';
import { SessionService } from '@ecp-caf/caf-common';
import { CommonComponentUiRTService } from '@gsp-cmp/ccmp-ui';
import { BsModalService } from '@farris/ui-modal';
import { BizComponentEntity } from '../../domain/entities/biz-component.entity';
import { ProcessDeUtil } from '../../domain/process-de-util';
import { MessagerService } from '@farris/ui-messager';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class EditComponentParameterComponent {
    /**
     * @param {?} designerState
     * @param {?} expr
     * @param {?} resolver
     * @param {?} injector
     * @param {?} sessionSrc
     * @param {?} componentService
     * @param {?} modalService
     * @param {?} message
     * @param {?} cd
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(designerState, expr, resolver, injector, sessionSrc, componentService, modalService, message, cd, cdr, localeId, resources, localePipe) {
        this.designerState = designerState;
        this.expr = expr;
        this.resolver = resolver;
        this.injector = injector;
        this.sessionSrc = sessionSrc;
        this.componentService = componentService;
        this.modalService = modalService;
        this.message = message;
        this.cd = cd;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.defaultProcessComponentIds = ['5863c8a8-e0a7-4137-a8b2-4c05e42b3b73', 'be781ba1-a88b-4bb8-9c88-2e2a27a9226e'];
        this.closeEmitter = new EventEmitter();
        this.submitEmitter = new EventEmitter();
        this.paramColumns = [];
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.executionTimingList = new Array();
        this.paramAfterEdit = (/**
         * @param {?} rowIndex
         * @param {?} rowData
         * @param {?=} column
         * @return {?}
         */
        (rowIndex, rowData, column) => {
            return of(true);
        });
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    ;
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.paramColumns = [
            { field: 'code', width: 50, title: this.localePipe.transform('component.editComponentParameter.code') },
            { field: 'name', width: 50, title: this.localePipe.transform('component.editComponentParameter.name') },
            {
                field: 'required', width: 50, title: this.localePipe.transform('component.editComponentParameter.required'), formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                (v, d, i) => {
                    if (v) {
                        return this.localePipe.transform('component.editComponentParameter.yes');
                    }
                    else {
                        return this.localePipe.transform('component.editComponentParameter.no');
                    }
                })
            },
            {
                field: 'value', width: 100, title: this.localePipe.transform('component.editComponentParameter.value'),
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            this.showExprHelp(e);
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            console.log('clear', e);
                        })
                    }
                }
            }
        ];
        // setTimeout(() => {
        //   this.cd.detectChanges();
        // },0 )
    }
    /**
     * @param {?} e
     * @return {?}
     */
    showExprHelp(e) {
        /** @type {?} */
        let context = new Array();
        // if(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage')) {
        //   context.push(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage'));
        // }
        // this.expr.clearContext();
        if (this.designerState.schemas.length > 0) {
            for (const schema of this.designerState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerState.schemas[0].entityTypes && this.designerState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        context = this.designerState.addContext(context);
        if (this.designerState.subActivityContext.length > 0) {
            for (const variable of this.designerState.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.location === 'activity') {
            for (const variable of this.designerState.activityComponentContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.setEditPattern(ExprEditMode.Advanced); // 默认打开高级表达式编辑器
        this.expr.addExpressionText(e.instance.value);
        this.expr.buildExpression().then((/**
         * @param {?} expressioninfo
         * @return {?}
         */
        (expressioninfo) => {
            e.formControl.setValue(expressioninfo);
            e.instance.cd.detectChanges();
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
    /**
     * 取数构件帮助new
     * @param {?} metadataId
     * @param {?} sessionId
     * @return {?}
     */
    openComponentSelectorNew(metadataId, sessionId) {
        this.componentService.openSelector(metadataId, sessionId).subscribe((/**
         * @param {?} selectorResult
         * @return {?}
         */
        (selectorResult) => {
            selectorResult.confirmEvent.subscribe((/**
             * @param {?} result
             * @return {?}
             */
            (result) => {
                if (result) {
                    /** @type {?} */
                    const component = new BizComponentEntity(result.name, result.id, result.operations[0].code);
                    component.id = ProcessDeUtil.GenerateElementId();
                    component.actualParameters = this.bindParas(result);
                    if (component.metadataId === '7433df25-9260-4c24-86f0-9da3e89450fb' ||
                        component.metadataId === 'd0783800-ed60-488c-b053-8806a15947fe' ||
                        component.metadataId === 'b89e9b9a-2e2d-4bd0-b354-187219544d34' ||
                        component.metadataId === 'a8b8f7a4-49ae-4b7d-88d2-b3772b9d0ae5') {
                        component.scopeType = 'ExternalProcess';
                    }
                    else {
                        component.scopeType = 'DirectStart';
                    }
                    this.curComponent = component;
                    this.cd.detectChanges();
                }
            }));
        }));
    }
    /**
     * @private
     * @param {?} component
     * @return {?}
     */
    bindParas(component) {
        /** @type {?} */
        let parameters = [];
        if (component.operations[0].parameters && component.operations[0].parameters.length > 0) {
            if (this.defaultProcessComponentIds.indexOf(component.id) > -1) {
                parameters = this.assignParameterValue(component.operations[0].parameters);
            }
            else {
                parameters = component.operations[0].parameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => ({ code: p.code, name: p.name, value: '', required: p.code.toLowerCase() === 'wfcontext' ? false : p.required })));
            }
        }
        return parameters;
    }
    /**
     * @private
     * @param {?} params
     * @return {?}
     */
    assignParameterValue(params) {
        return params.map((/**
         * @param {?} p
         * @return {?}
         */
        p => {
            if (p.code.indexOf('beId') > -1) {
                /** @type {?} */
                const v = this.designerState.formalParameterContext.filter((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key.indexOf('metadataId') > -1))[0].key;
                return { code: p.code, name: p.name, value: `{"expr":"DefaultFunction.GetContextParameter(\\"${v}\\")"}`, required: true };
            }
            else if (p.code.indexOf('nodeId') > -1) {
                /** @type {?} */
                const v = this.designerState.formalParameterContext.filter((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key.indexOf('schemaId') > -1))[0].key;
                return { code: p.code, name: p.name, value: `{"expr":"DefaultFunction.GetContextParameter(\\"${v}\\")"}`, required: true };
            }
            else if (p.code.indexOf('dataId') > -1) {
                return { code: p.code, name: p.name, value: `{"expr":"DefaultFunction.GetContextParameter(\\"dataId\\")"}`, required: true };
            }
            else if (p.code.indexOf('procInstId') > -1) {
                return { code: p.code, name: p.name, value: `{"expr":"DefaultFunction.GetContextParameter(\\"procInstId\\")"}`, required: true };
            }
            else {
                return { code: p.code, name: p.name, value: '', required: true };
            }
        }));
    }
    /**
     * @return {?}
     */
    componentSelect() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(SelectMetadataRTComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.typeList = 'WebServiceComponent'; // 目前只能根据元数据类型过滤，后续添加标签过滤
        compRef.instance.selectedMetadata.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        ($event) => {
            try {
                /** @type {?} */
                const meta = $event.metadata;
                this.openComponentSelectorNew(meta.id, this.sessionSrc.getUserSessionId());
            }
            catch (_a) {
                console.log('$event', $event);
                throw new Error(this.localePipe.transform('component.editComponentParameter.openComponentFail') + $event);
            }
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform('component.editComponentParameter.componentSelection'),
            width: 980,
            height: 548,
            showButtons: false
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.closeModalEmitter.subscribe((/**
         * @param {?} $event
         * @return {?}
         */
        $event => dialog.close()));
    }
    /**
     * @return {?}
     */
    endCellEdit() {
        this.paramlist.endCellEdit();
    }
    /**
     * @return {?}
     */
    editOK() {
        // 结束构件参数编辑状态
        this.endCellEdit();
        if (this.validator()) {
            this.submitEmitter.emit(this.curComponent);
        }
    }
    /**
     * @return {?}
     */
    editCancel() {
        this.closeEmitter.emit();
    }
    /**
     * @return {?}
     */
    validator() {
        if (!this.curComponent || !this.curComponent.metadataId || !this.curComponent.methodCode) {
            this.message.info(this.localePipe.transform('component.editComponentParameter.curComponent'));
            return false;
        }
        else if (this.location !== 'autoActivity' && !this.curComponent.executionTime) {
            this.message.info(this.localePipe.transform('component.editComponentParameter.executionTime'));
            return false;
        }
        else {
            /** @type {?} */
            let codeList = '';
            for (const param of this.curComponent.actualParameters) {
                if (param.required && !param.value) {
                    codeList = codeList + `，${param.code}`;
                }
            }
            if (codeList.length > 0) {
                codeList = codeList.slice(1, codeList.length);
                this.message.info(this.localePipe.transform('component.editComponentParameter.para') + '【' + codeList + this.localePipe.transform('component.editComponentParameter.paraRequired'));
                return false;
            }
        }
        return true;
    }
}
EditComponentParameterComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-edit-component-parameter',
                template: "<div *ngIf=\"curComponent\" class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\">\r\n    <form class=\"farris-form farris-card-content-bg farris-card-section mx-2\">\r\n      <div class=\"d-flex flex-wrap flex-column mb-2 pr-4\">\r\n        <div class=\"farris-form-controls-inline farris-form-auto mb-2\">\r\n          <div class=\"farris-group-wrap mx-3\">\r\n            <div class=\"form-group\">\r\n              <label class=\"col-form-label\">\r\n                <span class=\"farris-label-info text-danger\">*</span>\r\n                <span class=\"farris-label-text\">{{'component.editComponentParameter.componentSelection' | wfLocale}}</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap ml-2\">\r\n                <input-group class=\"form-control\" style=\"width: 100%;padding:0;border:0;\" name=\"method\" [showButtonWhenDisabled]=\"false\"\r\n                [enableClear]=\"false\" [editable]=\"false\" (clickHandle)=\"componentSelect()\" [groupText]=\"groupIcon\" [(ngModel)]=\"curComponent.name\" [disabled]=\"editState==='edit'\"></input-group>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <ng-container *ngIf=\"location!=='autoActivity'\">\r\n          <div class=\"farris-form-controls-inline farris-form-auto\">\r\n            <div class=\"farris-group-wrap mx-3\">\r\n              <div class=\"form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">{{'component.editComponentParameter.execuTime' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap ml-2\">\r\n                  <farris-combo-list name=\"executionTime\" [idField]=\"'value'\" [(ngModel)]=\"curComponent.executionTime\"\r\n                    [textField]=\"'text'\" [valueField]=\"'value'\" [data]=\"executionTimingList\" [panelHeight]=\"'auto'\">\r\n                  </farris-combo-list>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </ng-container>\r\n      </div>\r\n    </form>\r\n    <ng-container>\r\n      <farris-tabs class=\"f-utils-fill pr-2 pl-2\" [value]=\"'parameters'\" [contentFill]=\"true\" [autoTitleWidth]=\"true\">\r\n        <farris-tab title=\"{{'component.editComponentParameter.parameterList'|wfLocale}}\" [id]=\"'parameters'\">\r\n          <ng-template #content>\r\n            <div class=\"f-utils-fill-flex-column h-100\">\r\n              <farris-datagrid #paramlist [data]=\"curComponent.actualParameters\" [columns]=\"paramColumns\"\r\n                [idField]=\"'code'\" [fit]=\"true\" [fitColumns]=\"true\" [editable]=\"true\" [editMode]=\"'cell'\"\r\n                [pagination]=\"false\" [showCheckbox]=\"false\" [multiSelect]=\"false\" [afterEdit]=\"paramAfterEdit\"\r\n                [closeOtherGridEditor]=\"true\">\r\n              </farris-datagrid>\r\n            </div>\r\n          </ng-template>\r\n        </farris-tab>\r\n      </farris-tabs>\r\n    </ng-container>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #editFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3 mx-2\" (click)=\"editCancel()\">{{'component.editComponentParameter.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"editOK()\">{{'component.editComponentParameter.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
EditComponentParameterComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: SessionService },
    { type: CommonComponentUiRTService },
    { type: BsModalService },
    { type: MessagerService },
    { type: ChangeDetectorRef },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
EditComponentParameterComponent.propDecorators = {
    editState: [{ type: Input }],
    closeEmitter: [{ type: Output }],
    submitEmitter: [{ type: Output }],
    paramlist: [{ type: ViewChild, args: ['paramlist',] }],
    editFooter: [{ type: ViewChild, args: ['editFooter',] }],
    curComponent: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.defaultProcessComponentIds;
    /** @type {?} */
    EditComponentParameterComponent.prototype.editState;
    /** @type {?} */
    EditComponentParameterComponent.prototype.closeEmitter;
    /** @type {?} */
    EditComponentParameterComponent.prototype.submitEmitter;
    /** @type {?} */
    EditComponentParameterComponent.prototype.paramlist;
    /** @type {?} */
    EditComponentParameterComponent.prototype.editFooter;
    /** @type {?} */
    EditComponentParameterComponent.prototype.paramColumns;
    /** @type {?} */
    EditComponentParameterComponent.prototype.location;
    /** @type {?} */
    EditComponentParameterComponent.prototype.groupIcon;
    /** @type {?} */
    EditComponentParameterComponent.prototype.executionTimingList;
    /** @type {?} */
    EditComponentParameterComponent.prototype.canEdit;
    /** @type {?} */
    EditComponentParameterComponent.prototype.curComponent;
    /** @type {?} */
    EditComponentParameterComponent.prototype.paramAfterEdit;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.designerState;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.sessionSrc;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.componentService;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.message;
    /** @type {?} */
    EditComponentParameterComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    EditComponentParameterComponent.prototype.localePipe;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdC1jb21wb25lbnQtcGFyYW1ldGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvZWRpdC1jb21wb25lbnQtcGFyYW1ldGVyL2VkaXQtY29tcG9uZW50LXBhcmFtZXRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLHdCQUF3QixFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQVUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFNLE9BQU8sRUFBYyxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUIsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDNUUsT0FBTyxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQWEsTUFBTSxxQkFBcUIsQ0FBQztBQUMvRixPQUFPLEVBQWdDLHlCQUF5QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkcsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSwwQkFBMEIsRUFBa0IsTUFBTSxrQkFBa0IsQ0FBQztBQUU5RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDaEYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsaUJB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REFBa0M7O0lBQ2xDLGtEQUFpQjs7SUFDakIsdURBQ2lDOztJQW9MakMseURBRUM7Ozs7O0lBcExDLHdEQUE2Qzs7Ozs7SUFDN0MsK0NBQStCOzs7OztJQUMvQixtREFBMEM7Ozs7O0lBQzFDLG1EQUEwQjs7Ozs7SUFDMUIscURBQWtDOzs7OztJQUNsQywyREFBb0Q7Ozs7O0lBQ3BELHVEQUFvQzs7Ozs7SUFDcEMsa0RBQWdDOztJQUNoQyw2Q0FBNEI7Ozs7O0lBQzVCLDhDQUEwQzs7Ozs7SUFDMUMsbURBQTJDOzs7OztJQUMzQyxvREFBaUQ7Ozs7O0lBQ2pELHFEQUE0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIEluamVjdG9yLCBJbnB1dCwgTE9DQUxFX0lELCBPbkluaXQsIE9wdGlvbmFsLCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0YUNvbHVtbiwgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSB9IGZyb20gJy4uLy4uL2FwcC9wcm9jZXNzLWRlc2lnbmVyLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBFeHByRWRpdE1vZGUsIEV4cHJlc3Npb25TZXJ2aWNlLCBJbmplY3RlZFR5cGUsIFZhckVudGl0eSB9IGZyb20gJ0Bnc3Atc3ZjL2V4cHJlc3Npb24nO1xyXG5pbXBvcnQgeyBNZXRhZGF0YTRSZWZEdG8sIE1ldGFkYXRhRHRvLCBTZWxlY3RNZXRhZGF0YVJUQ29tcG9uZW50IH0gZnJvbSAnQGdzcC1sY20vbWV0YWRhdGFydC1zZWxlY3Rvcic7XHJcbmltcG9ydCB7IFNlc3Npb25TZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IENvbW1vbkNvbXBvbmVudFVpUlRTZXJ2aWNlLCBTZWxlY3RvclJlc3VsdCB9IGZyb20gJ0Bnc3AtY21wL2NjbXAtdWknO1xyXG5pbXBvcnQgeyBHc3BDb21wb25lbnQgfSBmcm9tICdAZ3NwLWNtcC9jb21tb24tY29tcG9uZW50JztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgQml6Q29tcG9uZW50RW50aXR5IH0gZnJvbSAnLi4vLi4vZG9tYWluL2VudGl0aWVzL2Jpei1jb21wb25lbnQuZW50aXR5JztcclxuaW1wb3J0IHsgUHJvY2Vzc0RlVXRpbCB9IGZyb20gJy4uLy4uL2RvbWFpbi9wcm9jZXNzLWRlLXV0aWwnO1xyXG5pbXBvcnQgeyBBY3R1YWxQYXJhbWV0ZXIgfSBmcm9tICcuLi8uLi9kb21haW4vZW50aXRpZXMvYWN0dWFsLXBhcmFtZXRlcic7XHJcbmltcG9ydCB7IFBhcmFtZXRlciB9IGZyb20gJ0BlY3AtY2FmL2NvbW1vbi1zdHJ1Y3R1cmUnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1lZGl0LWNvbXBvbmVudC1wYXJhbWV0ZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9lZGl0LWNvbXBvbmVudC1wYXJhbWV0ZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2VkaXQtY29tcG9uZW50LXBhcmFtZXRlci5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICAgV2ZMb2NhbGVQaXBlLFxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIEVkaXRDb21wb25lbnRQYXJhbWV0ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG4gIHByaXZhdGUgZGVmYXVsdFByb2Nlc3NDb21wb25lbnRJZHMgPSBbJzU4NjNjOGE4LWUwYTctNDEzNy1hOGIyLTRjMDVlNDJiM2I3MycsICdiZTc4MWJhMS1hODhiLTRiYjgtOWM4OC0yZTJhMjdhOTIyNmUnXTtcclxuICBASW5wdXQoKSBlZGl0U3RhdGU6IHN0cmluZztcclxuICBAT3V0cHV0KCkgY2xvc2VFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHN1Ym1pdEVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAVmlld0NoaWxkKCdwYXJhbWxpc3QnKSBwYXJhbWxpc3Q6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2VkaXRGb290ZXInKSBlZGl0Rm9vdGVyOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gIHBhcmFtQ29sdW1ucyA9IFtdO1xyXG4gIGxvY2F0aW9uOiAnYWN0aXZpdHknIHwgJ3Byb2Nlc3MnIHwgJ2F1dG9BY3Rpdml0eSc7XHJcblxyXG4gIGdyb3VwSWNvbiA9ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPic7XHJcbiAgZXhlY3V0aW9uVGltaW5nTGlzdCA9IG5ldyBBcnJheSgpOztcclxuICBjYW5FZGl0OiBib29sZWFuO1xyXG4gIEBJbnB1dCgpXHJcbiAgY3VyQ29tcG9uZW50OiBCaXpDb21wb25lbnRFbnRpdHk7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGRlc2lnbmVyU3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIHNlc3Npb25TcmM6IFNlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjb21wb25lbnRTZXJ2aWNlOiBDb21tb25Db21wb25lbnRVaVJUU2VydmljZSxcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHVibGljIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBASW5qZWN0KFdGX0xBTkdfUkVTT1VSQ0VTKSBwcml2YXRlIHJlc291cmNlczogYW55LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGVcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICB9XHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gIH1cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMucGFyYW1Db2x1bW5zID0gW1xyXG4gICAgICB7IGZpZWxkOiAnY29kZScsIHdpZHRoOiA1MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5lZGl0Q29tcG9uZW50UGFyYW1ldGVyLmNvZGUnKSB9LFxyXG4gICAgICB7IGZpZWxkOiAnbmFtZScsIHdpZHRoOiA1MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5lZGl0Q29tcG9uZW50UGFyYW1ldGVyLm5hbWUnKSB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdyZXF1aXJlZCcsIHdpZHRoOiA1MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5lZGl0Q29tcG9uZW50UGFyYW1ldGVyLnJlcXVpcmVkJyksIGZvcm1hdHRlcjogKHYsIGQsIGkpID0+IHtcclxuICAgICAgICAgIGlmICh2KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZWRpdENvbXBvbmVudFBhcmFtZXRlci55ZXMnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZWRpdENvbXBvbmVudFBhcmFtZXRlci5ubycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiAndmFsdWUnLCB3aWR0aDogMTAwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmVkaXRDb21wb25lbnRQYXJhbWV0ZXIudmFsdWUnKSxcclxuICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgIHR5cGU6ICdpbnB1dC1ncm91cCcsXHJcbiAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBjbGlja0hhbmRsZTogKGUpID0+IHtcclxuICAgICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICAgIHRoaXMuc2hvd0V4cHJIZWxwKGUpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjbGVhcjogKGUpID0+IHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2xlYXInLCBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgXTtcclxuXHJcbiAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgIC8vICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAvLyB9LDAgKVxyXG4gIH1cclxuICBzaG93RXhwckhlbHAoZTogYW55KSB7XHJcbiAgICBsZXQgY29udGV4dCA9IG5ldyBBcnJheTxWYXJFbnRpdHk+KCk7XHJcbiAgICAvLyBpZih0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmluZCh4ID0+IHgua2V5ID09PSAnQ3VycmVudExhbmd1YWdlJykpIHtcclxuICAgIC8vICAgY29udGV4dC5wdXNoKHRoaXMuZXhwci5leHByRW50aXR5LmNvbnRleHRFbnRpdGllcy5maW5kKHggPT4geC5rZXkgPT09ICdDdXJyZW50TGFuZ3VhZ2UnKSk7XHJcbiAgICAvLyB9XHJcbiAgICAvLyB0aGlzLmV4cHIuY2xlYXJDb250ZXh0KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuc2NoZW1hcykge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRTY2hlbWEoJ1NjaGVtYScsIHNjaGVtYSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzICYmIHRoaXMuZGVzaWduZXJTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXNbMF07XHJcbiAgICAgICAgdGhpcy5leHByLmFkZEluamVjdGVkRW50aXR5KGVudGl0eVR5cGUubmFtZSwgJ1NjaGVtYScsXHJcbiAgICAgICAgICBlbnRpdHlUeXBlLm5hbWUsIEluamVjdGVkVHlwZS5FbnRpdHlUeXBlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29udGV4dCA9IHRoaXMuZGVzaWduZXJTdGF0ZS5hZGRDb250ZXh0KGNvbnRleHQpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICdhY3Rpdml0eScpIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2IG9mIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLnNldEVkaXRQYXR0ZXJuKEV4cHJFZGl0TW9kZS5BZHZhbmNlZCk7IC8vIOm7mOiupOaJk+W8gOmrmOe6p+ihqOi+vuW8j+e8lui+keWZqFxyXG4gICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KGUuaW5zdGFuY2UudmFsdWUpO1xyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGV4cHJlc3Npb25pbmZvOiBzdHJpbmcpID0+IHtcclxuICAgICAgZS5mb3JtQ29udHJvbC5zZXRWYWx1ZShleHByZXNzaW9uaW5mbyk7XHJcbiAgICAgIGUuaW5zdGFuY2UuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAvL+eCueWHu+ehruWumuWQju+8jOWOu+mZpOihqOi+vuW8j+mHjOmdoueahOaWsOWinueahOS4iuS4i+aWh+WPmOmHj1xyXG4gICAgICBpZihjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMgPSB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmlsdGVyKHggPT4gIWNvbnRleHQuc29tZSh5ID0+IHkua2V5ID09PSB4LmtleSkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Y+W5pWw5p6E5Lu25biu5YqpbmV3XHJcbiAgICovXHJcbiAgb3BlbkNvbXBvbmVudFNlbGVjdG9yTmV3KG1ldGFkYXRhSWQ6IHN0cmluZywgc2Vzc2lvbklkOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuY29tcG9uZW50U2VydmljZS5vcGVuU2VsZWN0b3IobWV0YWRhdGFJZCwgc2Vzc2lvbklkKS5zdWJzY3JpYmUoXHJcbiAgICAgIChzZWxlY3RvclJlc3VsdDogU2VsZWN0b3JSZXN1bHQpID0+IHtcclxuICAgICAgICBzZWxlY3RvclJlc3VsdC5jb25maXJtRXZlbnQuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgKHJlc3VsdDogR3NwQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBuZXcgQml6Q29tcG9uZW50RW50aXR5KHJlc3VsdC5uYW1lLCByZXN1bHQuaWQsIHJlc3VsdC5vcGVyYXRpb25zWzBdLmNvZGUpO1xyXG4gICAgICAgICAgICAgIGNvbXBvbmVudC5pZCA9IFByb2Nlc3NEZVV0aWwuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgICAgICAgICBjb21wb25lbnQuYWN0dWFsUGFyYW1ldGVycyA9IHRoaXMuYmluZFBhcmFzKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5tZXRhZGF0YUlkID09PSAnNzQzM2RmMjUtOTI2MC00YzI0LTg2ZjAtOWRhM2U4OTQ1MGZiJyB8fFxyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50Lm1ldGFkYXRhSWQgPT09ICdkMDc4MzgwMC1lZDYwLTQ4OGMtYjA1My04ODA2YTE1OTQ3ZmUnIHx8XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQubWV0YWRhdGFJZCA9PT0gJ2I4OWU5YjlhLTJlMmQtNGJkMC1iMzU0LTE4NzIxOTU0NGQzNCcgfHxcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5tZXRhZGF0YUlkID09PSAnYThiOGY3YTQtNDlhZS00YjdkLTg4ZDItYjM3NzJiOWQwYWU1Jykge1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50LnNjb3BlVHlwZSA9ICdFeHRlcm5hbFByb2Nlc3MnO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuc2NvcGVUeXBlID0gJ0RpcmVjdFN0YXJ0JztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdGhpcy5jdXJDb21wb25lbnQgPSBjb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICB9XHJcbiAgcHJpdmF0ZSBiaW5kUGFyYXMoY29tcG9uZW50OiBHc3BDb21wb25lbnQpOiBBY3R1YWxQYXJhbWV0ZXJbXSB7XHJcbiAgICBsZXQgcGFyYW1ldGVycyA9IFtdO1xyXG5cclxuICAgIGlmIChjb21wb25lbnQub3BlcmF0aW9uc1swXS5wYXJhbWV0ZXJzICYmIGNvbXBvbmVudC5vcGVyYXRpb25zWzBdLnBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICBpZiAodGhpcy5kZWZhdWx0UHJvY2Vzc0NvbXBvbmVudElkcy5pbmRleE9mKGNvbXBvbmVudC5pZCkgPiAtMSkge1xyXG4gICAgICAgIHBhcmFtZXRlcnMgPSB0aGlzLmFzc2lnblBhcmFtZXRlclZhbHVlKGNvbXBvbmVudC5vcGVyYXRpb25zWzBdLnBhcmFtZXRlcnMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBhcmFtZXRlcnMgPSBjb21wb25lbnQub3BlcmF0aW9uc1swXS5wYXJhbWV0ZXJzLm1hcChwID0+ICh7IGNvZGU6IHAuY29kZSwgbmFtZTogcC5uYW1lLCB2YWx1ZTogJycsIHJlcXVpcmVkOiBwLmNvZGUudG9Mb3dlckNhc2UoKSA9PT0nd2Zjb250ZXh0Jz8gZmFsc2UgOiBwLnJlcXVpcmVkIH0pKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBhcmFtZXRlcnM7XHJcbiAgfVxyXG4gIHByaXZhdGUgYXNzaWduUGFyYW1ldGVyVmFsdWUocGFyYW1zOiBQYXJhbWV0ZXJbXSk6IEFjdHVhbFBhcmFtZXRlcltdIHtcclxuICAgIHJldHVybiBwYXJhbXMubWFwKHAgPT4ge1xyXG4gICAgICBpZiAocC5jb2RlLmluZGV4T2YoJ2JlSWQnKSA+IC0xKSB7XHJcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuZGVzaWduZXJTdGF0ZS5mb3JtYWxQYXJhbWV0ZXJDb250ZXh0LmZpbHRlcihjID0+IGMua2V5LmluZGV4T2YoJ21ldGFkYXRhSWQnKSA+IC0xKVswXS5rZXk7XHJcbiAgICAgICAgcmV0dXJuIHsgY29kZTogcC5jb2RlLCBuYW1lOiBwLm5hbWUsIHZhbHVlOiBge1wiZXhwclwiOlwiRGVmYXVsdEZ1bmN0aW9uLkdldENvbnRleHRQYXJhbWV0ZXIoXFxcXFwiJHt2fVxcXFxcIilcIn1gLCByZXF1aXJlZDogdHJ1ZX07XHJcbiAgICAgIH0gZWxzZSBpZiAocC5jb2RlLmluZGV4T2YoJ25vZGVJZCcpID4gLTEpIHtcclxuICAgICAgICBjb25zdCB2ID0gdGhpcy5kZXNpZ25lclN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQuZmlsdGVyKGMgPT4gYy5rZXkuaW5kZXhPZignc2NoZW1hSWQnKSA+IC0xKVswXS5rZXk7XHJcbiAgICAgICAgcmV0dXJuIHsgY29kZTogcC5jb2RlLCBuYW1lOiBwLm5hbWUsIHZhbHVlOiBge1wiZXhwclwiOlwiRGVmYXVsdEZ1bmN0aW9uLkdldENvbnRleHRQYXJhbWV0ZXIoXFxcXFwiJHt2fVxcXFxcIilcIn1gLCByZXF1aXJlZDogdHJ1ZSB9O1xyXG4gICAgICB9IGVsc2UgaWYgKHAuY29kZS5pbmRleE9mKCdkYXRhSWQnKSA+IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgY29kZTogcC5jb2RlLCBuYW1lOiBwLm5hbWUsIHZhbHVlOiBge1wiZXhwclwiOlwiRGVmYXVsdEZ1bmN0aW9uLkdldENvbnRleHRQYXJhbWV0ZXIoXFxcXFwiZGF0YUlkXFxcXFwiKVwifWAsIHJlcXVpcmVkOiB0cnVlIH07XHJcbiAgICAgIH0gZWxzZSBpZiAocC5jb2RlLmluZGV4T2YoJ3Byb2NJbnN0SWQnKSA+IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgY29kZTogcC5jb2RlLCBuYW1lOiBwLm5hbWUsIHZhbHVlOiBge1wiZXhwclwiOlwiRGVmYXVsdEZ1bmN0aW9uLkdldENvbnRleHRQYXJhbWV0ZXIoXFxcXFwicHJvY0luc3RJZFxcXFxcIilcIn1gLCByZXF1aXJlZDogdHJ1ZSB9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB7IGNvZGU6IHAuY29kZSwgbmFtZTogcC5uYW1lLCB2YWx1ZTogJycsIHJlcXVpcmVkOiB0cnVlIH07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICBjb21wb25lbnRTZWxlY3QoKSB7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU2VsZWN0TWV0YWRhdGFSVENvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS50eXBlTGlzdCA9ICdXZWJTZXJ2aWNlQ29tcG9uZW50JzsgLy8g55uu5YmN5Y+q6IO95qC55o2u5YWD5pWw5o2u57G75Z6L6L+H5ruk77yM5ZCO57ut5re75Yqg5qCH562+6L+H5rukXHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnNlbGVjdGVkTWV0YWRhdGEuc3Vic2NyaWJlKCgkZXZlbnQ6IE1ldGFkYXRhNFJlZkR0bykgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IG1ldGE6IE1ldGFkYXRhRHRvID0gJGV2ZW50Lm1ldGFkYXRhO1xyXG4gICAgICAgIHRoaXMub3BlbkNvbXBvbmVudFNlbGVjdG9yTmV3KG1ldGEuaWQsIHRoaXMuc2Vzc2lvblNyYy5nZXRVc2VyU2Vzc2lvbklkKCkpO1xyXG4gICAgICB9IGNhdGNoIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnJGV2ZW50JywgJGV2ZW50KTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmVkaXRDb21wb25lbnRQYXJhbWV0ZXIub3BlbkNvbXBvbmVudEZhaWwnKSArICRldmVudCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZWRpdENvbXBvbmVudFBhcmFtZXRlci5jb21wb25lbnRTZWxlY3Rpb24nKSxcclxuICAgICAgd2lkdGg6IDk4MCxcclxuICAgICAgaGVpZ2h0OiA1NDgsXHJcbiAgICAgIHNob3dCdXR0b25zOiBmYWxzZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsRW1pdHRlci5zdWJzY3JpYmUoJGV2ZW50ID0+IGRpYWxvZy5jbG9zZSgpKTtcclxuICB9XHJcbiAgcGFyYW1BZnRlckVkaXQgPSAocm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogYW55LCBjb2x1bW4/OiBEYXRhQ29sdW1uKSA9PiB7XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG4gIGVuZENlbGxFZGl0KCkge1xyXG4gICAgdGhpcy5wYXJhbWxpc3QuZW5kQ2VsbEVkaXQoKTtcclxuICB9XHJcblxyXG4gIGVkaXRPSygpIHtcclxuICAgIC8vIOe7k+adn+aehOS7tuWPguaVsOe8lui+keeKtuaAgVxyXG4gICAgdGhpcy5lbmRDZWxsRWRpdCgpO1xyXG4gICAgaWYgKHRoaXMudmFsaWRhdG9yKCkpIHtcclxuICAgICAgdGhpcy5zdWJtaXRFbWl0dGVyLmVtaXQodGhpcy5jdXJDb21wb25lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZWRpdENhbmNlbCgpIHtcclxuICAgIHRoaXMuY2xvc2VFbWl0dGVyLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRvcigpOiBib29sZWFuIHtcclxuICAgIGlmICghdGhpcy5jdXJDb21wb25lbnQgfHwgIXRoaXMuY3VyQ29tcG9uZW50Lm1ldGFkYXRhSWQgfHwgIXRoaXMuY3VyQ29tcG9uZW50Lm1ldGhvZENvZGUpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmVkaXRDb21wb25lbnRQYXJhbWV0ZXIuY3VyQ29tcG9uZW50JykpO1xyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH0gZWxzZSBpZiAodGhpcy5sb2NhdGlvbiAhPT0gJ2F1dG9BY3Rpdml0eScgJiYgIXRoaXMuY3VyQ29tcG9uZW50LmV4ZWN1dGlvblRpbWUpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmVkaXRDb21wb25lbnRQYXJhbWV0ZXIuZXhlY3V0aW9uVGltZScpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IGNvZGVMaXN0ID0gJyc7XHJcbiAgICAgIGZvciAoY29uc3QgcGFyYW0gb2YgdGhpcy5jdXJDb21wb25lbnQuYWN0dWFsUGFyYW1ldGVycykge1xyXG4gICAgICAgIGlmIChwYXJhbS5yZXF1aXJlZCAmJiAhcGFyYW0udmFsdWUpIHtcclxuICAgICAgICAgIGNvZGVMaXN0ID0gY29kZUxpc3QgKyBg77yMJHtwYXJhbS5jb2RlfWA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChjb2RlTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29kZUxpc3QgPSBjb2RlTGlzdC5zbGljZSgxLCBjb2RlTGlzdC5sZW5ndGgpXHJcbiAgICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmVkaXRDb21wb25lbnRQYXJhbWV0ZXIucGFyYScpICsgJ+OAkCcgKyBjb2RlTGlzdCArIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5lZGl0Q29tcG9uZW50UGFyYW1ldGVyLnBhcmFSZXF1aXJlZCcpKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxufVxyXG4iXX0=
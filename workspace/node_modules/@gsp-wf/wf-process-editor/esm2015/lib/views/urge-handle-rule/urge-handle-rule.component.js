/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, ViewChild, TemplateRef, Input, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { UrgeHandleRule } from './urge-handle-rule';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { ExpressionService, InjectedType } from '@gsp-svc/expression';
import { MessagerService } from '@farris/ui-messager';
import { SmsMessageTemplate } from '../sms-message-template/sms-message-template';
import { SmsMessageTemplateComponent } from '../sms-message-template/sms-message-template.component';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class UrgeHandleRuleComponent {
    /**
     * @param {?} designerUIState
     * @param {?} expr
     * @param {?} message
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(designerUIState, expr, message, cdr, localeId, resources, localePipe) {
        this.designerUIState = designerUIState;
        this.expr = expr;
        this.message = message;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.groupIcon2 = '<i class="f-icon f-icon-lookup"></i>';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.urgeHandleRule = new UrgeHandleRule();
        this.typeGroup = this.designerUIState.messageChannels.map((/**
         * @param {?} m
         * @return {?}
         */
        m => ({ value: m.code, name: m.name })));
        this.modalConfig = {
            title: this.localePipe.transform("component.urgeHandleRule.urgeHandle"),
            width: 800,
            height: 515,
            showButtons: true
        };
        this.hasSmsTemplate = false;
        this.parser = (/**
         * @param {?} val
         * @return {?}
         */
        (val) => {
            return Number(val);
        });
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set value(data) {
        if (!data) {
            this.urgeHandleRule.urgeHandleAble = true;
            this.urgeHandleRule.earlyTime = 0;
            this.urgeHandleRule.intervalTime = 0;
            this.urgeHandleRule.sendType = 'cloudplus,inmail';
            this.urgeHandleRule.urgeMessageSubject = `{\"expr\":\"'${this.localePipe.transform("component.urgeHandleRule.urgentApproval")}' + DefaultFunction.GetContextParameter(\\\"bizDefName\\\")\",\"sexpr\":\"\"}`;
            this.urgeHandleRule.urgeMessageContent = `{\"expr\":\"'${this.localePipe.transform("component.urgeHandleRule.pleaseApprove")}' + DefaultFunction.GetContextParameter(\\\"procInstCreatorName\\\") + '${this.localePipe.transform("component.urgeHandleRule.soOn")}' + DefaultFunction.GetContextParameter(\\\"bizDefName\\\") + '。'\",\"sexpr\":\"\"}`;
        }
        else {
            this.urgeHandleRule = data;
            if (this.hasSmsMessage(this.urgeHandleRule.sendType)) {
                this.hasSmsTemplate = true;
                if (!this.urgeHandleRule.smsMessageTemplate) {
                    this.urgeHandleRule.smsMessageTemplate = new SmsMessageTemplate();
                }
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    clickOK() {
        if (this.SmsTemplate) {
            this.SmsTemplate.endGridEdit();
        }
        if (this.hasSmsTemplate) {
            this.urgeHandleRule.smsMessageTemplate = this.SmsTemplate.smsMessageTemplate;
            if (this.urgeHandleRule.smsMessageTemplate.smsMessageVariables && this.urgeHandleRule.smsMessageTemplate.smsMessageVariables.length > 0) {
                this.urgeHandleRule.smsMessageTemplate.smsMessageVariables = this.urgeHandleRule.smsMessageTemplate.smsMessageVariables.filter((/**
                 * @param {?} variable
                 * @return {?}
                 */
                variable => variable.code));
            }
        }
        else {
            this.urgeHandleRule.smsMessageTemplate = null;
        }
        if (this.validator()) {
            /** @type {?} */
            const object = { value: this.urgeHandleRule, parameters: null };
            this.submitModal.emit(object);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @private
     * @return {?}
     */
    validator() {
        if (!this.urgeHandleRule.sendType) {
            this.message.info(this.localePipe.transform("component.urgeHandleRule.noSendingMethod"));
            return false;
        }
        //去除消息模板编号校验
        // if (this.hasSmsTemplate) {
        //   if (!this.urgeHandleRule.smsMessageTemplate) {
        //     this.message.info(this.localePipe.transform("component.urgeHandleRule.setMessageTemplate"));
        //     return;
        //   }
        //   if (!this.urgeHandleRule.smsMessageTemplate.code) {
        //     this.message.info(this.localePipe.transform("component.urgeHandleRule.codeEmpty"));
        //     return;
        //   }
        // }
        if (!this.urgeHandleRule.urgeMessageSubject) {
            this.message.info(this.localePipe.transform("component.urgeHandleRule.noMessageSubject"));
            return false;
        }
        if (!this.urgeHandleRule.urgeMessageContent) {
            this.message.info(this.localePipe.transform("component.urgeHandleRule.noMessageContent"));
            return false;
        }
        if (!this.urgeHandleRule.earlyTime && this.urgeHandleRule.earlyTime !== 0) {
            this.message.info(this.localePipe.transform("component.urgeHandleRule.earliestTimeNotEmpty"));
            return false;
        }
        if (!this.urgeHandleRule.intervalTime && this.urgeHandleRule.intervalTime !== 0) {
            this.message.info(this.localePipe.transform("component.urgeHandleRule.minimumTimeNotEmpty"));
            return false;
        }
        return true;
    }
    /**
     * @param {?} sendType
     * @return {?}
     */
    sendTypeChange(sendType) {
        if (this.hasSmsMessage(sendType)) {
            this.hasSmsTemplate = true;
            if (!this.urgeHandleRule.smsMessageTemplate) {
                this.urgeHandleRule.smsMessageTemplate = new SmsMessageTemplate();
            }
        }
        else {
            this.hasSmsTemplate = false;
            this.urgeHandleRule.smsMessageTemplate = null;
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    titleExpr(data) {
        this.showTitleHelp(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    contentExpr(data) {
        this.showContentHelp(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    showTitleHelp(data) {
        /** @type {?} */
        const context = this.showExpr();
        if (this.urgeHandleRule.urgeMessageSubject && this.urgeHandleRule.urgeMessageSubject.length > 0) {
            this.expr.addExpressionText(this.urgeHandleRule.urgeMessageSubject);
        }
        else {
            this.expr.addExpressionText('');
        }
        this.expr.buildExpression().then((/**
         * @param {?} expressionInfo
         * @return {?}
         */
        (expressionInfo) => {
            this.urgeHandleRule.urgeMessageSubject = expressionInfo;
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    showContentHelp(data) {
        /** @type {?} */
        const context = this.showExpr();
        if (this.urgeHandleRule.urgeMessageContent && this.urgeHandleRule.urgeMessageContent.length > 0) {
            this.expr.addExpressionText(this.urgeHandleRule.urgeMessageContent);
        }
        else {
            this.expr.addExpressionText('');
        }
        this.expr.buildExpression().then((/**
         * @param {?} expressionInfo
         * @return {?}
         */
        (expressionInfo) => {
            this.urgeHandleRule.urgeMessageContent = expressionInfo;
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
    /**
     * @return {?}
     */
    showExpr() {
        // this.expr.clearContext();
        if (this.designerUIState.schemas.length > 0) {
            for (const schema of this.designerUIState.schemas) {
                // this.expr.addCommonObject(co);
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.designerUIState.urgeContext.length > 0) {
            for (const variable of this.designerUIState.urgeContext) {
                context.push(variable);
                // this.expr.addContext(variable);
            }
        }
        if (this.designerUIState.processVariableContext.length > 0) {
            for (const variable of this.designerUIState.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (this.designerUIState.subActivityContext.length > 0) {
            for (const variable of this.designerUIState.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        return context;
    }
    /**
     * @private
     * @param {?} sendType
     * @return {?}
     */
    hasSmsMessage(sendType) {
        if (sendType) {
            /** @type {?} */
            const sendTypeList = sendType.split(',');
            /** @type {?} */
            let messageChannel = sendTypeList.find((/**
             * @param {?} val
             * @return {?}
             */
            val => this.designerUIState.messageChannels.find((/**
             * @param {?} channel
             * @return {?}
             */
            channel => channel.code == val && channel.channelType == 'Sms'))));
            if (messageChannel) {
                return true;
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    }
}
UrgeHandleRuleComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-urge-handle-rule',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-split-section m-2 h-100\">\r\n    <perfect-scrollbar [config]=\"{}\">\r\n      <form class=\"h-100\">\r\n        <div class=\"f-form-layout farris-form farris-form-controls-inline farris-form-auto\">\r\n          <fieldset class=\"f-section-formgroup\">\r\n            <div class=\"f-section-formgroup-inputs\">\r\n              <div class=\"col-12 mt-2\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-info text-danger\">*</span>\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.enableUrgeHandle' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap ml-1\">\r\n                      <farris-switch [(ngModel)]=\"urgeHandleRule.urgeHandleAble\" name=\"urgeHandleEnable\"></farris-switch>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"col-10 mt-2\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-info text-danger\">*</span>\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.timeSetting' | wfLocale}}</span>\r\n                    </label>\r\n                    <label class=\"mb-0\">\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.earliestTime' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\" style=\"width: 300px;\">\r\n                      <farris-number-spinner [(ngModel)]=\"urgeHandleRule.earlyTime\" name=\"earlyTime\" [editable]=\"true\" [precision]=\"0\"\r\n                        [parser]=\"parser\" [min]=\"0\"></farris-number-spinner>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"col-10\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-text\"></span>\r\n                    </label>\r\n                    <label class=\"mb-0\">\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.minimumInterval' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\" style=\"width: 300px;\">\r\n                      <farris-number-spinner [(ngModel)]=\"urgeHandleRule.intervalTime\" name=\"intervalTime\" [editable]=\"true\" [precision]=\"0\"\r\n                        [parser]=\"parser\" [min]=\"0\"></farris-number-spinner>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"col-12 mt-2\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-info text-danger\">*</span>\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.sendingMethod' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\">\r\n                      <farris-checkboxgroup #checkboxGroup [(ngModel)]=\"urgeHandleRule.sendType\" name=\"sendType\" [horizontal]=\"true\"\r\n                        [data]=\"typeGroup\" (changeValue)=\"sendTypeChange($event)\">\r\n                      </farris-checkboxgroup>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"col-12 mt-2\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-info text-danger\">*</span>\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.messageSubject' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\" style=\"width: 300px;\">\r\n                      <input-group [editable]=\"false\" [customCls]=\"'custom-cls'\" [groupText]=\"groupIcon2\"\r\n                                    [(value)]=\"urgeHandleRule.urgeMessageSubject\" (clickHandle)=\"titleExpr($event)\">\r\n                      </input-group>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.supportEditing' | wfLocale}}</span>\r\n                    </label>\r\n                    <!-- 2023-6-14 \u5728\u6D4B\u8BD5\u73AF\u5883\u4E2D\u51FA\u73B0\u6309\u94AE\u9760\u6700\u53F3\u7684\u60C5\u51B5\uFF0C\u5220\u9664style=\"text-align: right\"\u540E\u6B63\u5E38 -->\r\n                    <div class=\"farris-input-wrap\">\r\n                      <farris-switch [(ngModel)]=\"urgeHandleRule.subjectEditable\" name=\"enable1\" size=\"small\"></farris-switch>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"col-12 mt-2\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-info text-danger\">*</span>\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.messageContent' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\" style=\"width: 300px;\">\r\n                      <input-group [editable]=\"false\" [customCls]=\"'custom-cls'\" [groupText]=\"groupIcon2\"\r\n                                    [(value)]=\"urgeHandleRule.urgeMessageContent\" (clickHandle)=\"contentExpr($event)\">\r\n                      </input-group>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.supportEditing' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\">\r\n                      <farris-switch [(ngModel)]=\"urgeHandleRule.contentEditable\" name=\"enable2\" size=\"small\"></farris-switch>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"col-12 mt-2\">\r\n                <div class=\"farris-group-wrap\">\r\n                  <div class=\"form-group farris-form-group\">\r\n                    <label class=\"col-form-label\">\r\n                      <span class=\"farris-label-text\">{{'component.urgeHandleRule.displayReminder' | wfLocale}}</span>\r\n                    </label>\r\n                    <div class=\"farris-input-wrap\">\r\n                      <farris-switch [(ngModel)]=\"urgeHandleRule.addReminder\" name=\"enable\" size=\"small\"></farris-switch>\r\n                      <div class=\"farris-feedback valid-feedback\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </fieldset>\r\n        </div>\r\n        <lib-sms-message-template *ngIf=\"hasSmsTemplate\" [smsMessageTemplate]=\"urgeHandleRule.smsMessageTemplate\"></lib-sms-message-template>\r\n      </form>\r\n    </perfect-scrollbar>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3\" (click)=\"clickCancel()\">{{'component.urgeHandleRule.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.urgeHandleRule.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
UrgeHandleRuleComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: MessagerService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
UrgeHandleRuleComponent.propDecorators = {
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    SmsTemplate: [{ type: ViewChild, args: [SmsMessageTemplateComponent,] }],
    value: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.groupIcon2;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.closeModal;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.submitModal;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.modalFooter;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.SmsTemplate;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.urgeHandleRule;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.typeGroup;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.modalConfig;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.hasSmsTemplate;
    /** @type {?} */
    UrgeHandleRuleComponent.prototype.parser;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleComponent.prototype.localePipe;
}
export class UrgeHandleRuleConverter {
    /**
     * @param {?} localePipe
     */
    constructor(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (!data) {
            return this.localePipe.transform("component.urgeHandleRule.set");
        }
        else if (data.urgeHandleAble) {
            return this.localePipe.transform("component.urgeHandleRule.set");
        }
        else {
            return this.localePipe.transform("component.urgeHandleRule.notSet");
        }
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    UrgeHandleRuleConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXJnZS1oYW5kbGUtcnVsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL3VyZ2UtaGFuZGxlLXJ1bGUvdXJnZS1oYW5kbGUtcnVsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBZSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVwSyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDNUUsT0FBTyxFQUFDLGlCQUFpQixFQUFFLFlBQVksRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUNsRixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSx3REFBd0QsQ0FBQztBQUVyRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFVaEcsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7Ozs7OztJQTJDbEMsWUFDVSxlQUF1QyxFQUN2QyxJQUF1QixFQUN2QixPQUF3QixFQUNaLEdBQXNCLEVBQ2YsUUFBZ0IsRUFDUixTQUFjLEVBQzdCLFVBQXdCO1FBTnBDLG9CQUFlLEdBQWYsZUFBZSxDQUF3QjtRQUN2QyxTQUFJLEdBQUosSUFBSSxDQUFtQjtRQUN2QixZQUFPLEdBQVAsT0FBTyxDQUFpQjtRQUNaLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ2YsYUFBUSxHQUFS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QixDQUFDLENBQUM7U0FDbEU7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsaUNBQWlDLENBQUMsQ0FBQztTQUNyRTtJQUNILENBQUM7Q0FDRjs7Ozs7O0lBWkcsNkNBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBJbnB1dCwgSG9zdEJpbmRpbmcsIENoYW5nZURldGVjdG9yUmVmLCBPcHRpb25hbCwgSW5qZWN0LCBMT0NBTEVfSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHlwZUNvbnZlcnRlciB9IGZyb20gJ0BmYXJyaXMvaWRlLXByb3BlcnR5LXBhbmVsJztcclxuaW1wb3J0IHsgVXJnZUhhbmRsZVJ1bGUgfSBmcm9tICcuL3VyZ2UtaGFuZGxlLXJ1bGUnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7RXhwcmVzc2lvblNlcnZpY2UsIEluamVjdGVkVHlwZX0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBTbXNNZXNzYWdlVGVtcGxhdGUgfSBmcm9tICcuLi9zbXMtbWVzc2FnZS10ZW1wbGF0ZS9zbXMtbWVzc2FnZS10ZW1wbGF0ZSc7XHJcbmltcG9ydCB7IFNtc01lc3NhZ2VUZW1wbGF0ZUNvbXBvbmVudCB9IGZyb20gJy4uL3Ntcy1tZXNzYWdlLXRlbXBsYXRlL3Ntcy1tZXNzYWdlLXRlbXBsYXRlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcbmltcG9ydCB7IFdGX0xBTkdfUkVTT1VSQ0VTLCBXZkxvY2FsZVBpcGUgfSBmcm9tICcuLi8uLi9pMThuL3BpcGUvd2YtcHJvY2Vzcy1lZGl0b3ItbG9jYWxlLnBpcGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItdXJnZS1oYW5kbGUtcnVsZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3VyZ2UtaGFuZGxlLXJ1bGUuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3VyZ2UtaGFuZGxlLXJ1bGUuY29tcG9uZW50LnNjc3MnXSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgICBXZkxvY2FsZVBpcGUsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVXJnZUhhbmRsZVJ1bGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBncm91cEljb24yID0gJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JztcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgQFZpZXdDaGlsZChTbXNNZXNzYWdlVGVtcGxhdGVDb21wb25lbnQpIFNtc1RlbXBsYXRlOlNtc01lc3NhZ2VUZW1wbGF0ZUNvbXBvbmVudFxyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCB2YWx1ZShkYXRhOiBhbnkpIHtcclxuICAgIGlmICghZGF0YSkge1xyXG4gICAgICB0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VIYW5kbGVBYmxlID0gdHJ1ZTtcclxuICAgICAgdGhpcy51cmdlSGFuZGxlUnVsZS5lYXJseVRpbWUgPSAwO1xyXG4gICAgICB0aGlzLnVyZ2VIYW5kbGVSdWxlLmludGVydmFsVGltZSA9IDA7XHJcbiAgICAgIHRoaXMudXJnZUhhbmRsZVJ1bGUuc2VuZFR5cGUgPSAnY2xvdWRwbHVzLGlubWFpbCc7XHJcbiAgICAgIHRoaXMudXJnZUhhbmRsZVJ1bGUudXJnZU1lc3NhZ2VTdWJqZWN0ID0gYHtcXFwiZXhwclxcXCI6XFxcIicke3RoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudXJnZUhhbmRsZVJ1bGUudXJnZW50QXBwcm92YWxcIil9JyArIERlZmF1bHRGdW5jdGlvbi5HZXRDb250ZXh0UGFyYW1ldGVyKFxcXFxcXFwiYml6RGVmTmFtZVxcXFxcXFwiKVxcXCIsXFxcInNleHByXFxcIjpcXFwiXFxcIn1gO1xyXG4gICAgICB0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VNZXNzYWdlQ29udGVudCA9IGB7XFxcImV4cHJcXFwiOlxcXCInJHt0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnVyZ2VIYW5kbGVSdWxlLnBsZWFzZUFwcHJvdmVcIil9JyArIERlZmF1bHRGdW5jdGlvbi5HZXRDb250ZXh0UGFyYW1ldGVyKFxcXFxcXFwicHJvY0luc3RDcmVhdG9yTmFtZVxcXFxcXFwiKSArICcke3RoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudXJnZUhhbmRsZVJ1bGUuc29PblwiKX0nICsgRGVmYXVsdEZ1bmN0aW9uLkdldENvbnRleHRQYXJhbWV0ZXIoXFxcXFxcXCJiaXpEZWZOYW1lXFxcXFxcXCIpICsgJ+OAgidcXFwiLFxcXCJzZXhwclxcXCI6XFxcIlxcXCJ9YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudXJnZUhhbmRsZVJ1bGUgPSBkYXRhO1xyXG4gICAgICBpZiAodGhpcy5oYXNTbXNNZXNzYWdlKHRoaXMudXJnZUhhbmRsZVJ1bGUuc2VuZFR5cGUpKSB7XHJcbiAgICAgICAgdGhpcy5oYXNTbXNUZW1wbGF0ZSA9IHRydWU7XHJcbiAgICAgICAgaWYgKCF0aGlzLnVyZ2VIYW5kbGVSdWxlLnNtc01lc3NhZ2VUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgdGhpcy51cmdlSGFuZGxlUnVsZS5zbXNNZXNzYWdlVGVtcGxhdGUgPSBuZXcgU21zTWVzc2FnZVRlbXBsYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cmdlSGFuZGxlUnVsZTogVXJnZUhhbmRsZVJ1bGUgPSBuZXcgVXJnZUhhbmRsZVJ1bGUoKTtcclxuXHJcblxyXG4gIHR5cGVHcm91cCA9IHRoaXMuZGVzaWduZXJVSVN0YXRlLm1lc3NhZ2VDaGFubmVscy5tYXAobSA9PiAoeyB2YWx1ZTogbS5jb2RlLCBuYW1lOiBtLm5hbWUgfSkpO1xyXG5cclxuICBtb2RhbENvbmZpZyA9IHtcclxuICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnVyZ2VIYW5kbGVSdWxlLnVyZ2VIYW5kbGVcIiksXHJcbiAgICB3aWR0aDogODAwLFxyXG4gICAgaGVpZ2h0OiA1MTUsXHJcbiAgICBzaG93QnV0dG9uczogdHJ1ZVxyXG4gIH07XHJcblxyXG4gIGhhc1Ntc1RlbXBsYXRlID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBkZXNpZ25lclVJU3RhdGU6IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUsXHJcbiAgICBwcml2YXRlIGV4cHI6IEV4cHJlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQEluamVjdChXRl9MQU5HX1JFU09VUkNFUykgcHJpdmF0ZSByZXNvdXJjZXM6IGFueSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbG9jYWxlUGlwZTogV2ZMb2NhbGVQaXBlKSB7XHJcbiAgICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICAgfVxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgY2xpY2tPSygpIHtcclxuICAgIGlmICh0aGlzLlNtc1RlbXBsYXRlKSB7XHJcbiAgICAgIHRoaXMuU21zVGVtcGxhdGUuZW5kR3JpZEVkaXQoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmhhc1Ntc1RlbXBsYXRlKSB7XHJcbiAgICAgIHRoaXMudXJnZUhhbmRsZVJ1bGUuc21zTWVzc2FnZVRlbXBsYXRlID0gdGhpcy5TbXNUZW1wbGF0ZS5zbXNNZXNzYWdlVGVtcGxhdGU7XHJcbiAgICAgIGlmICh0aGlzLnVyZ2VIYW5kbGVSdWxlLnNtc01lc3NhZ2VUZW1wbGF0ZS5zbXNNZXNzYWdlVmFyaWFibGVzICYmIHRoaXMudXJnZUhhbmRsZVJ1bGUuc21zTWVzc2FnZVRlbXBsYXRlLnNtc01lc3NhZ2VWYXJpYWJsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHRoaXMudXJnZUhhbmRsZVJ1bGUuc21zTWVzc2FnZVRlbXBsYXRlLnNtc01lc3NhZ2VWYXJpYWJsZXMgPSB0aGlzLnVyZ2VIYW5kbGVSdWxlLnNtc01lc3NhZ2VUZW1wbGF0ZS5zbXNNZXNzYWdlVmFyaWFibGVzLmZpbHRlcih2YXJpYWJsZSA9PiB2YXJpYWJsZS5jb2RlKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy51cmdlSGFuZGxlUnVsZS5zbXNNZXNzYWdlVGVtcGxhdGUgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMudmFsaWRhdG9yKCkpIHtcclxuICAgICAgY29uc3Qgb2JqZWN0ID0geyB2YWx1ZTogdGhpcy51cmdlSGFuZGxlUnVsZSwgcGFyYW1ldGVyczogbnVsbCB9O1xyXG4gICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdG9yKCkge1xyXG4gICAgaWYgKCF0aGlzLnVyZ2VIYW5kbGVSdWxlLnNlbmRUeXBlKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudXJnZUhhbmRsZVJ1bGUubm9TZW5kaW5nTWV0aG9kXCIpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLy/ljrvpmaTmtojmga/mqKHmnb/nvJblj7fmoKHpqoxcclxuICAgIC8vIGlmICh0aGlzLmhhc1Ntc1RlbXBsYXRlKSB7XHJcbiAgICAvLyAgIGlmICghdGhpcy51cmdlSGFuZGxlUnVsZS5zbXNNZXNzYWdlVGVtcGxhdGUpIHtcclxuICAgIC8vICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnVyZ2VIYW5kbGVSdWxlLnNldE1lc3NhZ2VUZW1wbGF0ZVwiKSk7XHJcbiAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyAgIGlmICghdGhpcy51cmdlSGFuZGxlUnVsZS5zbXNNZXNzYWdlVGVtcGxhdGUuY29kZSkge1xyXG4gICAgLy8gICAgIHRoaXMubWVzc2FnZS5pbmZvKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudXJnZUhhbmRsZVJ1bGUuY29kZUVtcHR5XCIpKTtcclxuICAgIC8vICAgICByZXR1cm47XHJcbiAgICAvLyAgIH1cclxuICAgIC8vIH1cclxuICAgIGlmICghdGhpcy51cmdlSGFuZGxlUnVsZS51cmdlTWVzc2FnZVN1YmplY3QpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC51cmdlSGFuZGxlUnVsZS5ub01lc3NhZ2VTdWJqZWN0XCIpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VNZXNzYWdlQ29udGVudCkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnVyZ2VIYW5kbGVSdWxlLm5vTWVzc2FnZUNvbnRlbnRcIikpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIXRoaXMudXJnZUhhbmRsZVJ1bGUuZWFybHlUaW1lICYmIHRoaXMudXJnZUhhbmRsZVJ1bGUuZWFybHlUaW1lIT09MCApIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC51cmdlSGFuZGxlUnVsZS5lYXJsaWVzdFRpbWVOb3RFbXB0eVwiKSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy51cmdlSGFuZGxlUnVsZS5pbnRlcnZhbFRpbWUgJiYgdGhpcy51cmdlSGFuZGxlUnVsZS5pbnRlcnZhbFRpbWUhPT0wICkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LnVyZ2VIYW5kbGVSdWxlLm1pbmltdW1UaW1lTm90RW1wdHlcIikpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHNlbmRUeXBlQ2hhbmdlKHNlbmRUeXBlOiBzdHJpbmcpIHtcclxuICAgIGlmICh0aGlzLmhhc1Ntc01lc3NhZ2Uoc2VuZFR5cGUpKSB7XHJcbiAgICAgIHRoaXMuaGFzU21zVGVtcGxhdGUgPSB0cnVlO1xyXG4gICAgICBpZiAoIXRoaXMudXJnZUhhbmRsZVJ1bGUuc21zTWVzc2FnZVRlbXBsYXRlKSB7XHJcbiAgICAgICAgdGhpcy51cmdlSGFuZGxlUnVsZS5zbXNNZXNzYWdlVGVtcGxhdGUgPSBuZXcgU21zTWVzc2FnZVRlbXBsYXRlKCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaGFzU21zVGVtcGxhdGUgPSBmYWxzZTtcclxuICAgICAgdGhpcy51cmdlSGFuZGxlUnVsZS5zbXNNZXNzYWdlVGVtcGxhdGUgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcGFyc2VyID0gKHZhbDogc3RyaW5nIHwgbnVtYmVyKSA9PiB7XHJcbiAgICByZXR1cm4gTnVtYmVyKHZhbCk7XHJcbiAgfVxyXG5cclxuICB0aXRsZUV4cHIoZGF0YTogYW55KXtcclxuICAgIHRoaXMuc2hvd1RpdGxlSGVscChkYXRhKTtcclxuICB9XHJcblxyXG4gIGNvbnRlbnRFeHByKGRhdGE6IGFueSl7XHJcbiAgICB0aGlzLnNob3dDb250ZW50SGVscChkYXRhKTtcclxuICB9XHJcblxyXG4gIHNob3dUaXRsZUhlbHAoZGF0YTogc3RyaW5nKSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5zaG93RXhwcigpO1xyXG4gICAgaWYgKHRoaXMudXJnZUhhbmRsZVJ1bGUudXJnZU1lc3NhZ2VTdWJqZWN0ICYmIHRoaXMudXJnZUhhbmRsZVJ1bGUudXJnZU1lc3NhZ2VTdWJqZWN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KHRoaXMudXJnZUhhbmRsZVJ1bGUudXJnZU1lc3NhZ2VTdWJqZWN0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZXhwci5hZGRFeHByZXNzaW9uVGV4dCgnJyk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoZXhwcmVzc2lvbkluZm86IHN0cmluZykgPT4ge1xyXG4gICAgICB0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VNZXNzYWdlU3ViamVjdCA9IGV4cHJlc3Npb25JbmZvO1xyXG4gICAgICAvL+eCueWHu+ehruWumuWQju+8jOWOu+mZpOihqOi+vuW8j+mHjOmdoueahOaWsOWinueahOS4iuS4i+aWh+WPmOmHj1xyXG4gICAgICBpZihjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMgPSB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmlsdGVyKHggPT4gIWNvbnRleHQuc29tZSh5ID0+IHkua2V5ID09PSB4LmtleSkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNob3dDb250ZW50SGVscChkYXRhOiBzdHJpbmcpe1xyXG4gICAgY29uc3QgY29udGV4dCA9IHRoaXMuc2hvd0V4cHIoKTtcclxuICAgIGlmICh0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VNZXNzYWdlQ29udGVudCAmJiB0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VNZXNzYWdlQ29udGVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuZXhwci5hZGRFeHByZXNzaW9uVGV4dCh0aGlzLnVyZ2VIYW5kbGVSdWxlLnVyZ2VNZXNzYWdlQ29udGVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoJycpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGV4cHJlc3Npb25JbmZvOiBzdHJpbmcpID0+IHtcclxuICAgICAgdGhpcy51cmdlSGFuZGxlUnVsZS51cmdlTWVzc2FnZUNvbnRlbnQgPSBleHByZXNzaW9uSW5mbztcclxuICAgICAgLy/ngrnlh7vnoa7lrprlkI7vvIzljrvpmaTooajovr7lvI/ph4zpnaLnmoTmlrDlop7nmoTkuIrkuIvmloflj5jph49cclxuICAgICAgaWYoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzID0gdGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzLmZpbHRlcih4ID0+ICFjb250ZXh0LnNvbWUoeSA9PiB5LmtleSA9PT0geC5rZXkpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzaG93RXhwcigpe1xyXG4gICAgLy8gdGhpcy5leHByLmNsZWFyQ29udGV4dCgpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbW1vbk9iamVjdChjbyk7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcyAmJiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250ZXh0ID0gbmV3IEFycmF5KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUudXJnZUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLnVyZ2VDb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29udGV4dCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbnRleHQodmFyaWFibGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc3ViQWN0aXZpdHlDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0aGlzLmV4cHIuYWRkQ29udGV4dCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2IG9mIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkQ29udGV4dCh2KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbnRleHQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhc1Ntc01lc3NhZ2Uoc2VuZFR5cGU6IHN0cmluZykge1xyXG4gICAgaWYgKHNlbmRUeXBlKSB7XHJcbiAgICAgIGNvbnN0IHNlbmRUeXBlTGlzdCA9IHNlbmRUeXBlLnNwbGl0KCcsJyk7XHJcbiAgICAgIGxldCBtZXNzYWdlQ2hhbm5lbCA9IHNlbmRUeXBlTGlzdC5maW5kKHZhbCA9PiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5tZXNzYWdlQ2hhbm5lbHMuZmluZChjaGFubmVsID0+IGNoYW5uZWwuY29kZSA9PSB2YWwgJiYgY2hhbm5lbC5jaGFubmVsVHlwZSA9PSAnU21zJykpO1xyXG4gICAgICBpZiAobWVzc2FnZUNoYW5uZWwpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBVcmdlSGFuZGxlUnVsZUNvbnZlcnRlciBpbXBsZW1lbnRzIFR5cGVDb252ZXJ0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGVcclxuICApIHsgfVxyXG5cclxuICBjb252ZXJ0VG8oZGF0YTogYW55KTogc3RyaW5nIHtcclxuICAgIGlmICghZGF0YSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC51cmdlSGFuZGxlUnVsZS5zZXRcIik7XHJcbiAgICB9IGVsc2UgaWYgKGRhdGEudXJnZUhhbmRsZUFibGUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudXJnZUhhbmRsZVJ1bGUuc2V0XCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQudXJnZUhhbmRsZVJ1bGUubm90U2V0XCIpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
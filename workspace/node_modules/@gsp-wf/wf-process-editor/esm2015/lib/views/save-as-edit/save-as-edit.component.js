/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef, Injector, Optional, ChangeDetectorRef, Inject, LOCALE_ID } from '@angular/core';
import { of } from 'rxjs';
import { LookupGridComponent, ServerSideToken } from '@farris/ui-lookup';
import { HttpService } from '@ecp-caf/caf-common';
import { switchMap } from 'rxjs/operators';
import { LookupDataService } from '@farris/lookup-config';
import { MessagerService } from '@farris/ui-messager';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class SaveAsEditComponent {
    /**
     * @param {?} injector
     * @param {?} http
     * @param {?} message
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(injector, http, message, cdr, localeId, resources, localePipe) {
        this.injector = injector;
        this.http = http;
        this.message = message;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.submit = new EventEmitter();
        this.cancel = new EventEmitter();
        this.accessLevel = 'public';
        this.isAdministratorConfig = false;
        this.enableAdminOrgAut = false;
        this.dataUri = '/api/runtime/sys/v1.0/sysOrgs';
        this.loadType = 'layerload';
        this.disabled = false;
        // private _organizations: any[];
        // set organizations(data: any[]) {
        //   this._organizations = data;
        //   if (this._organizations && this._organizations.length > 0) {
        //     this.items = this.makeTreeByParent(this._organizations, 'parentId', 'id');
        //   } else {
        //     this.items = new Array();
        //   }
        // }
        // get organizations() {
        //   return this._organizations;
        // }
        this.items = new Array();
        this.accessLevelCollection = [
            { value: 'public', text: this.localePipe.transform('component.saveAsEdit.public') },
            { value: 'private', text: this.localePipe.transform('component.saveAsEdit.private') }
        ];
        this.columns = [
            { title: this.localePipe.transform('component.saveAsEdit.code'), field: 'code', width: '100', searchField: 'code' },
            { title: this.localePipe.transform('component.saveAsEdit.name'), field: 'name', width: '100', searchField: 'name' },
        ];
        this.dictPicking = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.lookUp.http = {
                getData: (/**
                 * @param {?} uri
                 * @param {?} params
                 * @return {?}
                 */
                (uri, params) => {
                    console.log(params);
                    /** @type {?} */
                    const searchValue = JSON.parse(params.searchValue);
                    /** @type {?} */
                    const parent = searchValue.parentId;
                    /** @type {?} */
                    let param;
                    if (this.lookUp._searchState && this.lookUp._searchState.field && this.lookUp._searchState.value) {
                        if (this.lookUp._searchState.field === '*') {
                            param = { codeOrName: this.lookUp._searchState.value };
                        }
                        else if (this.lookUp._searchState.field === 'name') {
                            param = { name: this.lookUp._searchState.value };
                        }
                        else {
                            param = { code: this.lookUp._searchState.value };
                        }
                    }
                    /** @type {?} */
                    let filter;
                    if (this.isAdministratorConfig) {
                        filter = this.administrator.administratorAuthorities.map((/**
                         * @param {?} a
                         * @return {?}
                         */
                        a => ({
                            id: a.organization, rule: a.includeSubordinate ? 'SelectedAndChild' : 'Selected'
                        })));
                    }
                    return this.getSysOrgs(parent, param, filter).pipe(switchMap((/**
                     * @param {?} re
                     * @return {?}
                     */
                    (re) => {
                        console.log(re);
                        return of((/** @type {?} */ ({
                            columns: this.columns,
                            displayInfo: { idField: 'id', valueField: 'id', textField: 'name' },
                            displayType: 'TreeList',
                            idField: 'id',
                            valueField: 'id',
                            textField: 'name',
                            searchFields: [
                                { label: 'code', value: 'code' }, { label: 'name', value: 'name' }
                            ],
                            title: this.localePipe.transform('component.saveAsEdit.organization'),
                            total: 0,
                            treeInfo: {
                                dataField: 'treeinfo',
                                isDetailField: 'isDetail',
                                layerField: 'layer',
                                layerType: 'parentId',
                                loadDataType: 'async',
                                onlySelectLeaf: false,
                                parentField: 'parentElement',
                                pathField: 'path',
                                treeDataIsInit: true
                            },
                            items: this.orgTreeData(re, param)
                        })));
                    })));
                })
            };
            return of(true);
        });
        this.dictPicked = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.organizationName = data.name;
            this.organization = data.id;
            return of(true);
        });
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    saveAsOK() {
        this.disabled = true;
        if (this.validator()) {
            this.submit.next({
                procName: this.procName,
                accessLevel: this.accessLevel,
                organization: this.organization,
                organizationName: this.organizationName
            });
        }
    }
    /**
     * @return {?}
     */
    saveAsCancel() {
        this.cancel.emit();
    }
    /**
     * @return {?}
     */
    validator() {
        if (!this.procName) {
            this.message.warning(this.localePipe.transform('component.saveAsEdit.nameNotEmpty'));
            this.disabled = false;
            return false;
        }
        if (!this.organization) {
            this.message.warning(this.localePipe.transform('component.saveAsEdit.organizationNotEmpty'));
            this.disabled = false;
            return false;
        }
        return true;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    search(data) {
        /** @type {?} */
        const tt = (/** @type {?} */ (this.lookUp.componentRef.instance));
        tt.searchHandle.search(data.field, data.value, 'client');
    }
    /**
     * @param {?} data
     * @return {?}
     */
    selectedDataHandler(data) {
        this.organization = data.id;
        this.organizationName = data.name;
    }
    /**
     * @private
     * @param {?} orgs
     * @param {?} searchValue
     * @return {?}
     */
    orgTreeData(orgs, searchValue) {
        /** @type {?} */
        const result = new Array();
        /** @type {?} */
        const treeData = new Array();
        for (const org of orgs) {
            /** @type {?} */
            const entity = {};
            entity.data = org;
            entity.children = [];
            entity.id = org.id;
            entity.leaf = org.isDetail;
            entity.selectable = org.farris_selectable;
            treeData.push(entity);
        }
        /** @type {?} */
        const obj = {};
        // 使用对象重新存储数据
        /** @type {?} */
        const len = treeData.length;
        for (let i = 0; i < len; i++) {
            /** @type {?} */
            const d = treeData[i];
            obj[treeData[i].id] = treeData[i];
        }
        // 遍历数据
        for (let j = 0; j < len; j++) {
            /** @type {?} */
            const data = treeData[j];
            /** @type {?} */
            const parentData = obj[data.data.parentId];
            if (parentData) {
                if (!parentData.children) {
                    parentData.children = new Array();
                }
                parentData.children.push(data);
            }
            else {
                result.push(data);
            }
        }
        // 过滤的情况下，不包含下级的节点设置为叶子节点
        if (searchValue) {
            this.treeIterator(result);
        }
        return result;
    }
    /**
     * @private
     * @param {?} treeData
     * @return {?}
     */
    treeIterator(treeData) {
        if (treeData && treeData.length > 0) {
            for (const d of treeData) {
                if (d.children && d.children.length > 0) {
                    this.treeIterator(d.children);
                }
                else {
                    d.leaf = true;
                }
            }
        }
    }
    /**
     * @private
     * @param {?} item
     * @param {?} orgs
     * @return {?}
     */
    findChild(item, orgs) {
        /** @type {?} */
        const childList = orgs.filter((/**
         * @param {?} childitem
         * @return {?}
         */
        childitem => {
            if (childitem.parentId === item.id) {
                return true;
            }
        }));
        if (childList && childList.length > 0) {
            childList.forEach((/**
             * @param {?} child
             * @return {?}
             */
            child => {
                /** @type {?} */
                const childEntity = {};
                childEntity.data = child;
                childEntity.children = [];
                childEntity.id = child.id;
                childEntity.leaf = child.isDetail;
                childEntity.selectable = child.farris_selectable;
                item.children.push(childEntity);
                this.findChild(childEntity, orgs);
            }));
        }
    }
    /**
     * 按照parent码构造树
     * @private
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    makeTreeByParent(datas, parentField, keyField) {
        // 上級爲空，或者沒有上級的
        /** @type {?} */
        const pathLayerOnes = datas.filter((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            if (!x[parentField]) {
                return true;
            }
            /** @type {?} */
            const p = datas.find((/**
             * @param {?} parent
             * @return {?}
             */
            parent => parent[keyField] === x[parentField]));
            if (!p) {
                return true;
            }
        }));
        /** @type {?} */
        const treedata = [];
        pathLayerOnes.forEach((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            const entity = {};
            entity.data = x;
            entity.children = [];
            treedata.push(entity);
            // this.root = x['id'];
        }));
        treedata.forEach((/**
         * @param {?} item
         * @return {?}
         */
        item => {
            this.findChildrenByParent(item, datas, parentField, keyField);
        }));
        return treedata;
    }
    /**
     * 找到子节点
     * @private
     * @param {?} parent
     * @param {?} datas
     * @param {?} parentField
     * @param {?} keyField
     * @return {?}
     */
    findChildrenByParent(parent, datas, parentField, keyField) {
        /** @type {?} */
        const childList = datas.filter((/**
         * @param {?} childitem
         * @return {?}
         */
        childitem => {
            if (childitem[parentField] === parent.data[keyField]) {
                return true;
            }
        }));
        if (childList && childList.length > 0) {
            childList.forEach((/**
             * @param {?} child
             * @return {?}
             */
            child => {
                /** @type {?} */
                const childEntity = {};
                childEntity.data = child;
                childEntity.children = [];
                parent.children.push(childEntity);
                this.findChildrenByParent(childEntity, datas, parentField, keyField);
            }));
        }
    }
    /**
     * @private
     * @param {?} parent
     * @param {?} searchValue
     * @param {?} filter
     * @return {?}
     */
    getSysOrgs(parent, searchValue, filter) {
        /** @type {?} */
        let url = `/api/runtime/sys/v1.0/sysOrgs`;
        /** @type {?} */
        let param;
        if (searchValue) {
            param = Object.assign(searchValue, {
                IsSearchTree: true,
                withPermission: true,
                ruleFilter: filter
            });
        }
        else {
            if (parent) {
                param = Object.assign({}, {
                    parentId: parent,
                    withPermission: true,
                    ruleFilter: filter
                });
            }
            else {
                param = Object.assign({}, {
                    parentId: '',
                    layer: 1,
                    withPermission: true,
                    ruleFilter: filter
                });
            }
        }
        url += `?param=${JSON.stringify(param)}`;
        return this.http.get(url);
    }
}
SaveAsEditComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-save-as-edit',
                template: "<!-- <div class=\"f-page\">\r\n  <div class=\"f-page-main\">\r\n    <div class=\"d-flex m-2 py-2 farris-row\">\r\n      <div class=\"w-100 px-4\">\r\n        <label class=\"col-form-label\">\r\n          <span class=\"farris-label-text\">\u6D41\u7A0B\u540D\u79F0</span>\r\n        </label>\r\n        <div class=\"farris-input-wrap\">\r\n          <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procName\" name=\"procName\" />\r\n          <div class=\"farris-feedback valid-feedback\"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"d-flex m-2 py-2 farris-row\">\r\n      <div class=\"px-4 w-100\">\r\n        <label class=\"col-form-label\">\r\n          <span class=\"farris-label-text\">\u6D41\u7A0BKey\u503C</span>\r\n        </label>\r\n        <div class=\"farris-input-wrap\">\r\n          <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procKey\" name=\"procKey\" [readonly]=\"true\" />\r\n          <div class=\"farris-feedback valid-feedback\"></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div> -->\r\n\r\n<div class=\"f-page f-page-card f-page-is-mainsubcard\">\r\n  <section class=\"f-page-main\">\r\n    <!--\u4E0D\u786E\u8BA4---------------------------\u5361\u7247\u7EC4\u4EF6\u4E0D\u540C\u7684Section\u662F\u5728\u4E0D\u540C\u7684\u7EC4\u4EF6\u91CC\uFF0C\u8FD8\u662F\u5728\u540C\u4E00\u4E2A\u5361\u7247\u7EC4\u4EF6\u91CC-->\r\n    <!--\u8868\u5355\u533A\u57DF-->\r\n    <!--\u9700\u8981\u5D4C\u5957\u7684\u5C42---------------------------IDE\u8F6C\u5316\u6210\u7EC4\u4EF6----------->\r\n    <div class=\"f-struct-wrapper\">\r\n      <farris-section class=\"f-section-form f-section-in-mainsubcard\" [enableAccordion]=\"''\" mainTitle=\"{{'component.saveAsEdit.basicAttributes'|wfLocale}}\"\r\n        [subTitle]=\"''\" [enableMaximize]=\"false\">\r\n\r\n        <!--\u8F93\u5165\u63A7\u4EF6 \u6CA1\u6709\u5206\u7EC4-->\r\n        <div class=\"f-form-layout farris-form farris-form-controls-inline pr-4 m-2\">\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">{{'component.saveAsEdit.processName' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procName\" name=\"procName\" />\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'component.saveAsEdit.processKeyValue' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <input type=\"text\" class=\"form-control\" [(ngModel)]=\"procKey\" name=\"procKey\" [readonly]=\"true\" />\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">{{'component.saveAsEdit.maintenanceOrg' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-lookup-grid *ngIf=\"!enableAdminOrgAut; else adminOrg\" #lookup [(ngModel)]=\"organizationName\" name=\"orgName\"\r\n                    [singleSelect]=\"true\" [dictPicked]=\"dictPicked\"\r\n                    [enableClear]=\"false\"\r\n                    [editable]=\"false\"\r\n                    [dictPicking]=\"dictPicking\"\r\n                    [uri]=\"dataUri\"\r\n                    [loadTreeDataType]=\"loadType\">\r\n                  </farris-lookup-grid>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 px-0 my-2\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">{{'component.saveAsEdit.accessLevel' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <farris-combo-list [(ngModel)]=\"accessLevel\" name=\"accessLevel\"\r\n                    [ngModelOptions]=\"{standalone: true}\" [idField]=\"'value'\" [textField]=\"'text'\"\r\n                    [valueField]=\"'value'\" [data]=\"accessLevelCollection\" [panelHeight]=\"'auto'\" [enableClear]=\"false\">\r\n                  </farris-combo-list>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </farris-section>\r\n    </div>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #buttonRef>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"saveAsCancel()\">{{'component.saveAsEdit.saveAsCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-sm btn-primary mx-2\" [disabled]=\"disabled\" (click)=\"saveAsOK()\">{{'component.saveAsEdit.saveAsOK' | wfLocale}}</button>\r\n</ng-template>\r\n\r\n\r\n<ng-template #adminOrg>\r\n  <farris-lookup-grid #adminOrgLookup [(ngModel)]=\"organizationName\" name=\"adminOrgName\"\r\n    [helpId]=\"'processdesigneradminorgdataaut'\" [enableClear]=\"false\" [editable]=\"false\"\r\n    [singleSelect]=\"true\" [uri]=\"'assets/data/tree-list-help.json'\" (selectedData)=\"selectedDataHandler($event)\">\r\n  </farris-lookup-grid>\r\n</ng-template>\r\n",
                providers: [
                    { provide: ServerSideToken, useClass: LookupDataService },
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
SaveAsEditComponent.ctorParameters = () => [
    { type: Injector },
    { type: HttpService },
    { type: MessagerService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
SaveAsEditComponent.propDecorators = {
    btnRef: [{ type: ViewChild, args: ['buttonRef',] }],
    procName: [{ type: Input }],
    procKey: [{ type: Input }],
    lookUp: [{ type: ViewChild, args: ['lookup',] }],
    submit: [{ type: Output }],
    cancel: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    SaveAsEditComponent.prototype.btnRef;
    /** @type {?} */
    SaveAsEditComponent.prototype.procName;
    /** @type {?} */
    SaveAsEditComponent.prototype.procKey;
    /** @type {?} */
    SaveAsEditComponent.prototype.lookUp;
    /** @type {?} */
    SaveAsEditComponent.prototype.submit;
    /** @type {?} */
    SaveAsEditComponent.prototype.cancel;
    /** @type {?} */
    SaveAsEditComponent.prototype.accessLevel;
    /** @type {?} */
    SaveAsEditComponent.prototype.organization;
    /** @type {?} */
    SaveAsEditComponent.prototype.organizationName;
    /** @type {?} */
    SaveAsEditComponent.prototype.isAdministratorConfig;
    /** @type {?} */
    SaveAsEditComponent.prototype.enableAdminOrgAut;
    /** @type {?} */
    SaveAsEditComponent.prototype.administrator;
    /** @type {?} */
    SaveAsEditComponent.prototype.dataUri;
    /** @type {?} */
    SaveAsEditComponent.prototype.loadType;
    /** @type {?} */
    SaveAsEditComponent.prototype.disabled;
    /** @type {?} */
    SaveAsEditComponent.prototype.items;
    /** @type {?} */
    SaveAsEditComponent.prototype.accessLevelCollection;
    /** @type {?} */
    SaveAsEditComponent.prototype.columns;
    /** @type {?} */
    SaveAsEditComponent.prototype.dictPicking;
    /** @type {?} */
    SaveAsEditComponent.prototype.dictPicked;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    SaveAsEditComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2F2ZS1hcy1lZGl0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3Mvc2F2ZS1hcy1lZGl0L3NhdmUtYXMtZWRpdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakssT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBV2hHLE1BQU0sT0FBTyxtQkFBbUI7Ozs7Ozs7Ozs7SUFxRDlCLFlBQ1UsUUFBa0IsRUFDbEIsSUFBaUIsRUFDakIsT0FBd0IsRUFDWixHQUFzQixFQUNmLFFBQWdCLEVBQ1IsU0FBYyxFQUM3QixVQUF3QjtRQU5wQyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLFNBQUksR0FBSixJQUFJLENBQWE7UUFDakIsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7UUFDWixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUNmLGFBQVEsR0FBUixRQUFRLENBQVE7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akIsb0NBQW9COztJQUVwQixvREFHRTs7SUFFRixzQ0FHRTs7SUFtREYsMENBd0RDOztJQUVELHlDQUlDOzs7OztJQTdHQyx1Q0FBMEI7Ozs7O0lBQzFCLG1DQUF5Qjs7Ozs7SUFDekIsc0NBQWdDOzs7OztJQUNoQyxrQ0FBMEM7Ozs7O0lBQzFDLHVDQUEyQzs7Ozs7SUFDM0Msd0NBQWlEOzs7OztJQUNqRCx5Q0FBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBJbmplY3RvciwgT3B0aW9uYWwsIENoYW5nZURldGVjdG9yUmVmLCBJbmplY3QsIExPQ0FMRV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IExvb2t1cEdyaWRDb21wb25lbnQsIFNlcnZlclNpZGVUb2tlbiB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb29rdXBEYXRhU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvbG9va3VwLWNvbmZpZyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBXRl9MQU5HX1JFU09VUkNFUywgV2ZMb2NhbGVQaXBlIH0gZnJvbSAnLi4vLi4vaTE4bi9waXBlL3dmLXByb2Nlc3MtZWRpdG9yLWxvY2FsZS5waXBlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXBwLXNhdmUtYXMtZWRpdCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NhdmUtYXMtZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2F2ZS1hcy1lZGl0LmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICB7IHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IExvb2t1cERhdGFTZXJ2aWNlIH0sXHJcbiAgICAgV2ZMb2NhbGVQaXBlLFxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFNhdmVBc0VkaXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBAVmlld0NoaWxkKCdidXR0b25SZWYnKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgcHJvY05hbWU6IHN0cmluZztcclxuICBASW5wdXQoKVxyXG4gIHByb2NLZXk6IHN0cmluZztcclxuXHJcbiAgQFZpZXdDaGlsZCgnbG9va3VwJykgcHVibGljIGxvb2tVcDogTG9va3VwR3JpZENvbXBvbmVudDtcclxuXHJcbiAgQE91dHB1dCgpIHN1Ym1pdCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBjYW5jZWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgYWNjZXNzTGV2ZWwgPSAncHVibGljJztcclxuICBvcmdhbml6YXRpb247XHJcbiAgb3JnYW5pemF0aW9uTmFtZTtcclxuXHJcbiAgaXNBZG1pbmlzdHJhdG9yQ29uZmlnID0gZmFsc2U7XHJcbiAgZW5hYmxlQWRtaW5PcmdBdXQgPSBmYWxzZTtcclxuXHJcbiAgYWRtaW5pc3RyYXRvcjogYW55O1xyXG4gIGRhdGFVcmkgPSAnL2FwaS9ydW50aW1lL3N5cy92MS4wL3N5c09yZ3MnO1xyXG5cclxuICBsb2FkVHlwZSA9ICdsYXllcmxvYWQnO1xyXG5cclxuICBkaXNhYmxlZCA9IGZhbHNlO1xyXG5cclxuICAvLyBwcml2YXRlIF9vcmdhbml6YXRpb25zOiBhbnlbXTtcclxuICAvLyBzZXQgb3JnYW5pemF0aW9ucyhkYXRhOiBhbnlbXSkge1xyXG4gIC8vICAgdGhpcy5fb3JnYW5pemF0aW9ucyA9IGRhdGE7XHJcbiAgLy8gICBpZiAodGhpcy5fb3JnYW5pemF0aW9ucyAmJiB0aGlzLl9vcmdhbml6YXRpb25zLmxlbmd0aCA+IDApIHtcclxuICAvLyAgICAgdGhpcy5pdGVtcyA9IHRoaXMubWFrZVRyZWVCeVBhcmVudCh0aGlzLl9vcmdhbml6YXRpb25zLCAncGFyZW50SWQnLCAnaWQnKTtcclxuICAvLyAgIH0gZWxzZSB7XHJcbiAgLy8gICAgIHRoaXMuaXRlbXMgPSBuZXcgQXJyYXkoKTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcbiAgLy8gZ2V0IG9yZ2FuaXphdGlvbnMoKSB7XHJcbiAgLy8gICByZXR1cm4gdGhpcy5fb3JnYW5pemF0aW9ucztcclxuICAvLyB9XHJcbiAgaXRlbXMgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgYWNjZXNzTGV2ZWxDb2xsZWN0aW9uID0gW1xyXG4gICAgeyB2YWx1ZTogJ3B1YmxpYycsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5zYXZlQXNFZGl0LnB1YmxpYycpIH0sXHJcbiAgICB7IHZhbHVlOiAncHJpdmF0ZScsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5zYXZlQXNFZGl0LnByaXZhdGUnKSB9XHJcbiAgXTtcclxuXHJcbiAgY29sdW1ucyA9IFtcclxuICAgIHsgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5zYXZlQXNFZGl0LmNvZGUnKSwgZmllbGQ6ICdjb2RlJywgd2lkdGg6ICcxMDAnLCBzZWFyY2hGaWVsZDogJ2NvZGUnIH0sXHJcbiAgICB7IHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuc2F2ZUFzRWRpdC5uYW1lJyksIGZpZWxkOiAnbmFtZScsIHdpZHRoOiAnMTAwJywgc2VhcmNoRmllbGQ6ICduYW1lJyB9LFxyXG4gIF07XHJcblxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuICBzYXZlQXNPSygpIHtcclxuICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgaWYgKHRoaXMudmFsaWRhdG9yKCkpIHtcclxuICAgICAgdGhpcy5zdWJtaXQubmV4dCh7XHJcbiAgICAgICAgcHJvY05hbWU6IHRoaXMucHJvY05hbWUsXHJcbiAgICAgICAgYWNjZXNzTGV2ZWw6IHRoaXMuYWNjZXNzTGV2ZWwsXHJcbiAgICAgICAgb3JnYW5pemF0aW9uOiB0aGlzLm9yZ2FuaXphdGlvbixcclxuICAgICAgICBvcmdhbml6YXRpb25OYW1lOiB0aGlzLm9yZ2FuaXphdGlvbk5hbWVcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHNhdmVBc0NhbmNlbCgpIHtcclxuICAgIHRoaXMuY2FuY2VsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRvcigpIHtcclxuICAgIGlmICghdGhpcy5wcm9jTmFtZSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2Uud2FybmluZyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuc2F2ZUFzRWRpdC5uYW1lTm90RW1wdHknKSk7XHJcbiAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKCF0aGlzLm9yZ2FuaXphdGlvbikge1xyXG4gICAgICB0aGlzLm1lc3NhZ2Uud2FybmluZyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuc2F2ZUFzRWRpdC5vcmdhbml6YXRpb25Ob3RFbXB0eScpKTtcclxuICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHNlYXJjaChkYXRhOiBhbnkpIHtcclxuICAgIGNvbnN0IHR0ID0gdGhpcy5sb29rVXAuY29tcG9uZW50UmVmLmluc3RhbmNlIGFzIFRyZWVUYWJsZUNvbXBvbmVudDtcclxuICAgIHR0LnNlYXJjaEhhbmRsZS5zZWFyY2goZGF0YS5maWVsZCwgZGF0YS52YWx1ZSwgJ2NsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgZGljdFBpY2tpbmcgPSAoZGF0YTogYW55KSA9PiB7XHJcbiAgICB0aGlzLmxvb2tVcC5odHRwID0ge1xyXG4gICAgICBnZXREYXRhOiAodXJpLCBwYXJhbXMpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaFZhbHVlID0gSlNPTi5wYXJzZShwYXJhbXMuc2VhcmNoVmFsdWUpO1xyXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHNlYXJjaFZhbHVlLnBhcmVudElkO1xyXG4gICAgICAgIGxldCBwYXJhbTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubG9va1VwLl9zZWFyY2hTdGF0ZSAmJiB0aGlzLmxvb2tVcC5fc2VhcmNoU3RhdGUuZmllbGQgJiYgdGhpcy5sb29rVXAuX3NlYXJjaFN0YXRlLnZhbHVlKSB7XHJcbiAgICAgICAgICBpZiAodGhpcy5sb29rVXAuX3NlYXJjaFN0YXRlLmZpZWxkID09PSAnKicpIHtcclxuICAgICAgICAgICAgcGFyYW0gPSB7IGNvZGVPck5hbWU6IHRoaXMubG9va1VwLl9zZWFyY2hTdGF0ZS52YWx1ZSB9O1xyXG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxvb2tVcC5fc2VhcmNoU3RhdGUuZmllbGQgPT09ICduYW1lJykge1xyXG4gICAgICAgICAgICBwYXJhbSA9IHsgbmFtZTogdGhpcy5sb29rVXAuX3NlYXJjaFN0YXRlLnZhbHVlIH07XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwYXJhbSA9IHsgY29kZTogdGhpcy5sb29rVXAuX3NlYXJjaFN0YXRlLnZhbHVlIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBmaWx0ZXI7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBZG1pbmlzdHJhdG9yQ29uZmlnKSB7XHJcbiAgICAgICAgICBmaWx0ZXIgPSB0aGlzLmFkbWluaXN0cmF0b3IuYWRtaW5pc3RyYXRvckF1dGhvcml0aWVzLm1hcChhID0+ICh7XHJcbiAgICAgICAgICAgIGlkOiBhLm9yZ2FuaXphdGlvbiwgcnVsZTogYS5pbmNsdWRlU3Vib3JkaW5hdGUgPyAnU2VsZWN0ZWRBbmRDaGlsZCcgOiAnU2VsZWN0ZWQnXHJcbiAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFN5c09yZ3MocGFyZW50LCBwYXJhbSwgZmlsdGVyKS5waXBlKFxyXG4gICAgICAgICAgc3dpdGNoTWFwKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHtcclxuICAgICAgICAgICAgICBjb2x1bW5zOiB0aGlzLmNvbHVtbnMsXHJcbiAgICAgICAgICAgICAgZGlzcGxheUluZm86IHsgaWRGaWVsZDogJ2lkJywgdmFsdWVGaWVsZDogJ2lkJywgdGV4dEZpZWxkOiAnbmFtZScgfSxcclxuICAgICAgICAgICAgICBkaXNwbGF5VHlwZTogJ1RyZWVMaXN0JyxcclxuICAgICAgICAgICAgICBpZEZpZWxkOiAnaWQnLFxyXG4gICAgICAgICAgICAgIHZhbHVlRmllbGQ6ICdpZCcsXHJcbiAgICAgICAgICAgICAgdGV4dEZpZWxkOiAnbmFtZScsXHJcbiAgICAgICAgICAgICAgc2VhcmNoRmllbGRzOiBbXHJcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiAnY29kZScsIHZhbHVlOiAnY29kZScgfSwgeyBsYWJlbDogJ25hbWUnLCB2YWx1ZTogJ25hbWUnIH1cclxuICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuc2F2ZUFzRWRpdC5vcmdhbml6YXRpb24nKSxcclxuICAgICAgICAgICAgICB0b3RhbDogMCxcclxuICAgICAgICAgICAgICB0cmVlSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgZGF0YUZpZWxkOiAndHJlZWluZm8nLFxyXG4gICAgICAgICAgICAgICAgaXNEZXRhaWxGaWVsZDogJ2lzRGV0YWlsJyxcclxuICAgICAgICAgICAgICAgIGxheWVyRmllbGQ6ICdsYXllcicsXHJcbiAgICAgICAgICAgICAgICBsYXllclR5cGU6ICdwYXJlbnRJZCcsXHJcbiAgICAgICAgICAgICAgICBsb2FkRGF0YVR5cGU6ICdhc3luYycsXHJcbiAgICAgICAgICAgICAgICBvbmx5U2VsZWN0TGVhZjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRGaWVsZDogJ3BhcmVudEVsZW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgcGF0aEZpZWxkOiAncGF0aCcsXHJcbiAgICAgICAgICAgICAgICB0cmVlRGF0YUlzSW5pdDogdHJ1ZVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgaXRlbXM6IHRoaXMub3JnVHJlZURhdGEocmUsIHBhcmFtKVxyXG4gICAgICAgICAgICB9IGFzIGFueSk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gb2YodHJ1ZSk7XHJcbiAgfVxyXG5cclxuICBkaWN0UGlja2VkID0gKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgdGhpcy5vcmdhbml6YXRpb25OYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5vcmdhbml6YXRpb24gPSBkYXRhLmlkO1xyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgc2VsZWN0ZWREYXRhSGFuZGxlcihkYXRhKSB7XHJcbiAgICB0aGlzLm9yZ2FuaXphdGlvbiA9IGRhdGEuaWQ7XHJcbiAgICB0aGlzLm9yZ2FuaXphdGlvbk5hbWUgPSBkYXRhLm5hbWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9yZ1RyZWVEYXRhKG9yZ3M6IGFueVtdLCBzZWFyY2hWYWx1ZTogYW55KSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgQXJyYXkoKTtcclxuICAgIGNvbnN0IHRyZWVEYXRhID0gbmV3IEFycmF5KCk7XHJcbiAgICBmb3IgKGNvbnN0IG9yZyBvZiBvcmdzKSB7XHJcbiAgICAgIGNvbnN0IGVudGl0eTogYW55ID0ge307XHJcbiAgICAgIGVudGl0eS5kYXRhID0gb3JnO1xyXG4gICAgICBlbnRpdHkuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgZW50aXR5LmlkID0gb3JnLmlkO1xyXG4gICAgICBlbnRpdHkubGVhZiA9IG9yZy5pc0RldGFpbDtcclxuICAgICAgZW50aXR5LnNlbGVjdGFibGUgPSBvcmcuZmFycmlzX3NlbGVjdGFibGU7XHJcblxyXG4gICAgICB0cmVlRGF0YS5wdXNoKGVudGl0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb2JqID0ge307IC8vIOS9v+eUqOWvueixoemHjeaWsOWtmOWCqOaVsOaNrlxyXG4gICAgY29uc3QgbGVuID0gdHJlZURhdGEubGVuZ3RoO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICBjb25zdCBkID0gdHJlZURhdGFbaV07XHJcbiAgICAgIG9ialt0cmVlRGF0YVtpXS5pZF0gPSB0cmVlRGF0YVtpXTtcclxuICAgIH1cclxuICAgIC8vIOmBjeWOhuaVsOaNrlxyXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW47IGorKykge1xyXG4gICAgICBjb25zdCBkYXRhID0gdHJlZURhdGFbal07XHJcblxyXG4gICAgICBjb25zdCBwYXJlbnREYXRhID0gb2JqW2RhdGEuZGF0YS5wYXJlbnRJZF07XHJcblxyXG4gICAgICBpZiAocGFyZW50RGF0YSkge1xyXG4gICAgICAgIGlmICghcGFyZW50RGF0YS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgcGFyZW50RGF0YS5jaGlsZHJlbiA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwYXJlbnREYXRhLmNoaWxkcmVuLnB1c2goZGF0YSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0LnB1c2goZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIOi/h+a7pOeahOaDheWGteS4i++8jOS4jeWMheWQq+S4i+e6p+eahOiKgueCueiuvue9ruS4uuWPtuWtkOiKgueCuVxyXG4gICAgaWYgKHNlYXJjaFZhbHVlKSB7XHJcbiAgICAgIHRoaXMudHJlZUl0ZXJhdG9yKHJlc3VsdCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB0cmVlSXRlcmF0b3IodHJlZURhdGE6IGFueVtdKSB7XHJcbiAgICBpZiAodHJlZURhdGEgJiYgdHJlZURhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IGQgb2YgdHJlZURhdGEpIHtcclxuICAgICAgICBpZiAoZC5jaGlsZHJlbiAmJiBkLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIHRoaXMudHJlZUl0ZXJhdG9yKGQuY2hpbGRyZW4pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkLmxlYWYgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaW5kQ2hpbGQoaXRlbSwgb3Jncykge1xyXG4gICAgY29uc3QgY2hpbGRMaXN0ID0gb3Jncy5maWx0ZXIoY2hpbGRpdGVtID0+IHtcclxuICAgICAgaWYgKGNoaWxkaXRlbS5wYXJlbnRJZCA9PT0gaXRlbS5pZCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmIChjaGlsZExpc3QgJiYgY2hpbGRMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY2hpbGRMaXN0LmZvckVhY2goY2hpbGQgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkRW50aXR5OiBhbnkgPSB7fTtcclxuICAgICAgICBjaGlsZEVudGl0eS5kYXRhID0gY2hpbGQ7XHJcbiAgICAgICAgY2hpbGRFbnRpdHkuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICBjaGlsZEVudGl0eS5pZCA9IGNoaWxkLmlkO1xyXG4gICAgICAgIGNoaWxkRW50aXR5LmxlYWYgPSBjaGlsZC5pc0RldGFpbDtcclxuICAgICAgICBjaGlsZEVudGl0eS5zZWxlY3RhYmxlID0gY2hpbGQuZmFycmlzX3NlbGVjdGFibGU7XHJcbiAgICAgICAgaXRlbS5jaGlsZHJlbi5wdXNoKGNoaWxkRW50aXR5KTtcclxuICAgICAgICB0aGlzLmZpbmRDaGlsZChjaGlsZEVudGl0eSwgb3Jncyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIOaMieeFp3BhcmVudOeggeaehOmAoOagkSAqL1xyXG4gIHByaXZhdGUgbWFrZVRyZWVCeVBhcmVudChkYXRhczogYW55W10sIHBhcmVudEZpZWxkOiBzdHJpbmcsIGtleUZpZWxkOiBzdHJpbmcpOiBhbnlbXSB7XHJcbiAgICAvLyDkuIrntJrniLLnqbrvvIzmiJbogIXmspLmnInkuIrntJrnmoRcclxuICAgIGNvbnN0IHBhdGhMYXllck9uZXMgPSBkYXRhcy5maWx0ZXIoeCA9PiB7XHJcbiAgICAgIGlmICgheFtwYXJlbnRGaWVsZF0pIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBwID0gZGF0YXMuZmluZChwYXJlbnQgPT4gcGFyZW50W2tleUZpZWxkXSA9PT0geFtwYXJlbnRGaWVsZF0pO1xyXG4gICAgICBpZiAoIXApIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCB0cmVlZGF0YSA9IFtdO1xyXG4gICAgcGF0aExheWVyT25lcy5mb3JFYWNoKHggPT4ge1xyXG4gICAgICBjb25zdCBlbnRpdHk6IGFueSA9IHt9O1xyXG4gICAgICBlbnRpdHkuZGF0YSA9IHg7XHJcbiAgICAgIGVudGl0eS5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICB0cmVlZGF0YS5wdXNoKGVudGl0eSk7XHJcbiAgICAgIC8vIHRoaXMucm9vdCA9IHhbJ2lkJ107XHJcbiAgICB9KTtcclxuICAgIHRyZWVkYXRhLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgIHRoaXMuZmluZENoaWxkcmVuQnlQYXJlbnQoaXRlbSwgZGF0YXMsIHBhcmVudEZpZWxkLCBrZXlGaWVsZCk7XHJcbiAgICB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHRyZWVkYXRhO1xyXG4gIH1cclxuXHJcbiAgLyoqIOaJvuWIsOWtkOiKgueCuSAqL1xyXG4gIHByaXZhdGUgZmluZENoaWxkcmVuQnlQYXJlbnQocGFyZW50OiBhbnksIGRhdGFzOiBhbnlbXSwgcGFyZW50RmllbGQ6IHN0cmluZywga2V5RmllbGQ6IHN0cmluZykge1xyXG4gICAgY29uc3QgY2hpbGRMaXN0ID0gZGF0YXMuZmlsdGVyKGNoaWxkaXRlbSA9PiB7XHJcbiAgICAgIGlmIChjaGlsZGl0ZW1bcGFyZW50RmllbGRdID09PSBwYXJlbnQuZGF0YVtrZXlGaWVsZF0pIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZiAoY2hpbGRMaXN0ICYmIGNoaWxkTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNoaWxkTGlzdC5mb3JFYWNoKGNoaWxkID0+IHtcclxuICAgICAgICBjb25zdCBjaGlsZEVudGl0eTogYW55ID0ge307XHJcbiAgICAgICAgY2hpbGRFbnRpdHkuZGF0YSA9IGNoaWxkO1xyXG4gICAgICAgIGNoaWxkRW50aXR5LmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgcGFyZW50LmNoaWxkcmVuLnB1c2goY2hpbGRFbnRpdHkpO1xyXG4gICAgICAgIHRoaXMuZmluZENoaWxkcmVuQnlQYXJlbnQoY2hpbGRFbnRpdHksIGRhdGFzLCBwYXJlbnRGaWVsZCwga2V5RmllbGQpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBwcml2YXRlIGdldFN5c09yZ3MocGFyZW50OiBzdHJpbmcsIHNlYXJjaFZhbHVlOiBhbnksIGZpbHRlcjogYW55W10pOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgbGV0IHVybCA9IGAvYXBpL3J1bnRpbWUvc3lzL3YxLjAvc3lzT3Jnc2A7XHJcbiAgICBsZXQgcGFyYW07XHJcbiAgICBpZiAoc2VhcmNoVmFsdWUpIHtcclxuICAgICAgICBwYXJhbSA9IE9iamVjdC5hc3NpZ24oc2VhcmNoVmFsdWUsIHtcclxuICAgICAgICAgICAgSXNTZWFyY2hUcmVlOiB0cnVlLFxyXG4gICAgICAgICAgICB3aXRoUGVybWlzc2lvbjogdHJ1ZSxcclxuICAgICAgICAgICAgcnVsZUZpbHRlcjogZmlsdGVyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgcGFyYW0gPSBPYmplY3QuYXNzaWduKHt9LCB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRJZDogcGFyZW50LFxyXG4gICAgICAgICAgICAgICAgd2l0aFBlcm1pc3Npb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICBydWxlRmlsdGVyOiBmaWx0ZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGFyYW0gPSBPYmplY3QuYXNzaWduKHt9LCB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRJZDogJycsXHJcbiAgICAgICAgICAgICAgICBsYXllcjogMSxcclxuICAgICAgICAgICAgICAgIHdpdGhQZXJtaXNzaW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgcnVsZUZpbHRlcjogZmlsdGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHVybCArPSBgP3BhcmFtPSR7SlNPTi5zdHJpbmdpZnkocGFyYW0pfWA7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKTtcclxufVxyXG59XHJcbiJdfQ==
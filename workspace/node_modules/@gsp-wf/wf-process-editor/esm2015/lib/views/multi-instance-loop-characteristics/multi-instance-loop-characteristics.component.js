/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Expression } from '@edp-pmf/bpmn-model';
import { Component, HostBinding, Output, EventEmitter, Input, ViewChild, TemplateRef, Injector, ComponentFactoryResolver, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
import { DatagridComponent } from '@farris/ui-datagrid';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { ExpressionService, InjectedType } from '@gsp-svc/expression';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { MultiInstanceLoopCharacteristics } from './multi-instance-loop-characteristics.entity';
// import { ExtensionCompletionConditionRuler } from './extension-completion-condition-ruler/extension-completion-condition-ruler.entity';
import { SignRuleComponent } from '../sign-rule/sign-rule.component';
import { Condition, CounterSignRule } from '@gsp-wf/wf-process-model';
import { HttpService } from '@ecp-caf/caf-common';
import { ProcessTime } from '../../model/process-time';
export class MultiInstanceLoopCharacteristicsComponent {
    /**
     * @param {?} resolver
     * @param {?} injector
     * @param {?} uistate
     * @param {?} expr
     * @param {?} modalService
     * @param {?} message
     * @param {?} http
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(resolver, injector, uistate, expr, modalService, message, http, cdr, localeId, resources, localePipe) {
        this.resolver = resolver;
        this.injector = injector;
        this.uistate = uistate;
        this.expr = expr;
        this.modalService = modalService;
        this.message = message;
        this.http = http;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.cls = 'farris-main-area flex-column';
        this.groupIcon2 = '<i class="f-icon f-icon-lookup"></i>';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.preEnable = false;
        this.preSequential = false;
        this.loopCharacteristics = new MultiInstanceLoopCharacteristics();
        this.loopCharacteristicsTemp = null;
        // peopleList: string;
        this.conditionRulesIsSet = this.localePipe.transform('multiInstanceLoopCharacteristics.conditionRulesSet');
        this.bpmnModel = this.uistate.bpmnModel;
        this.modalConfig = {
            title: this.localePipe.transform('multiInstanceLoopCharacteristics.loopCharacteristics'),
            width: 550,
            height: 450,
            showButtons: true
        };
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @param {?} v
     * @return {?}
     */
    set value(v) {
        this.loopCharacteristics = new MultiInstanceLoopCharacteristics();
        if (v) {
            this.loopCharacteristics.enable = v.enable;
            this.loopCharacteristics.sequential = v.sequential;
            this.preEnable = v.enable;
            this.preSequential = v.sequential;
            if (v.loopCardinality && (v.loopCardinality instanceof Expression) && ((v.loopCardinality).MexExpression)) {
                this.loopCharacteristics.loopCardinality = ((/** @type {?} */ ((v.loopCardinality).MexExpression))).Value;
                // this.loopCharacteristics.loopCardinality = this.peopleList;
            }
            if (v.completionConditionRules && v.completionConditionRules.length > 0) {
                /** @type {?} */
                let signRuleEntityArray = new Array();
                for (let rule of v.completionConditionRules) {
                    /** @type {?} */
                    let signRule = new CounterSignRule(this.bpmnModel);
                    signRule.ConclusionValue = rule.ConclusionValue;
                    signRule.CalculateType = rule.CalculateType;
                    signRule.ConditionValue = rule.ConditionValue;
                    signRule.WaitAllVotes = rule.WaitAllVotes;
                    if (!signRule.CompletionCondition) {
                        signRule.CompletionCondition = new Condition(this.bpmnModel);
                    }
                    signRule.CompletionCondition.Value = rule.CompletionCondition ? rule.CompletionCondition.Value : null;
                    signRuleEntityArray.push(signRule);
                }
                this.loopCharacteristics.completionConditionRules = signRuleEntityArray;
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.editorParams.location && this.editorParams.location == 'activity') {
            this.promptAct = true;
        }
        else {
            this.promptAct = false;
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    loopCardinalityExpr(data) {
        this.showloopCardinalityHelp(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    showloopCardinalityHelp(data) {
        this.showExpr();
        if (this.loopCharacteristics.loopCardinality) {
            this.expr.addExpressionText(this.loopCharacteristics.loopCardinality);
        }
        else {
            this.expr.addExpressionText('');
        }
        this.expr.buildExpression().then((/**
         * @param {?} expressionInfo
         * @return {?}
         */
        (expressionInfo) => {
            // this.peopleList = expressionInfo;
            this.loopCharacteristics.loopCardinality = expressionInfo;
        }));
    }
    /**
     * @return {?}
     */
    showExpr() {
        // this.expr.clearContext();
        if (this.uistate.schemas.length > 0) {
            for (const schema of this.uistate.schemas) {
                // this.expr.addCommonObject(co);
                this.expr.addSchema('Schema', schema);
            }
            if (this.uistate.schemas[0].entityTypes && this.uistate.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.uistate.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        const context = new Array();
        if (this.uistate.procInstContext.length > 0) {
            for (const variable of this.uistate.procInstContext) {
                context.push(variable);
                // this.expr.addContext(variable);
            }
        }
        if (this.uistate.processVariableContext.length > 0) {
            for (const variable of this.uistate.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
                // this.expr.addContext(variable);
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    isEnable(data) {
        if (!data) {
            this.loopCharacteristicsTemp = new MultiInstanceLoopCharacteristics();
            this.loopCharacteristicsTemp.enable = true;
            this.loopCharacteristicsTemp.sequential = this.loopCharacteristics.sequential;
            this.loopCharacteristicsTemp.loopCardinality = this.loopCharacteristics.loopCardinality;
            this.loopCharacteristicsTemp.completionConditionRules = new Array();
            if (this.loopCharacteristics && this.loopCharacteristics.completionConditionRules) {
                this.loopCharacteristics.completionConditionRules.forEach((/**
                 * @param {?} com
                 * @return {?}
                 */
                com => this.loopCharacteristicsTemp.completionConditionRules.push((/** @type {?} */ (com.clone())))));
            }
            this.loopCharacteristics = new MultiInstanceLoopCharacteristics();
        }
        else {
            if (this.loopCharacteristicsTemp) {
                this.loopCharacteristics.enable = true;
                this.loopCharacteristics.sequential = this.loopCharacteristicsTemp.sequential;
                this.loopCharacteristics.loopCardinality = this.loopCharacteristicsTemp.loopCardinality;
                this.loopCharacteristics.completionConditionRules = new Array();
                if (this.loopCharacteristicsTemp.completionConditionRules) {
                    this.loopCharacteristicsTemp.completionConditionRules.forEach((/**
                     * @param {?} com
                     * @return {?}
                     */
                    com => this.loopCharacteristics.completionConditionRules.push((/** @type {?} */ (com.clone())))));
                }
                this.loopCharacteristicsTemp = null;
            }
        }
        this.validate(data);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    validate(data) {
        if (data == true) {
            if (!this.loopCharacteristics.completionConditionRules || this.loopCharacteristics.completionConditionRules.length < 1) {
                this.setCompletionConditionRules(this.loopCharacteristics.completionConditionRules);
            }
        }
    }
    /**
     * @param {?} completionConditionRules
     * @return {?}
     */
    setCompletionConditionRules(completionConditionRules) {
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(SignRuleComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.value1 = completionConditionRules;
        // compRef.instance.data = this.loopCharacteristics.completionConditionRules;
        compRef.instance.submitModal.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            this.loopCharacteristics.completionConditionRules = re;
            dialog.close();
        }));
        compRef.instance.closeModal.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform("multiInstanceLoopCharacteristics.completionConditionRules"),
            width: 800,
            height: 515,
            buttons: compRef.instance.modalFooter1,
            showButtons: true
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
    /**
     * @return {?}
     */
    clickOK() {
        /** @type {?} */
        const object = { value: this.loopCharacteristics, parameters: null };
        if (this.preEnable != this.loopCharacteristics.enable || this.preSequential != this.loopCharacteristics.sequential) {
            /** @type {?} */
            const url = `/api/runtime/wf/v1.0/processInstances/runtimeActivityInstances?procDefId=${this.uistate.procDefId}&activityDefinitionId=${this.uistate.propertyData.Id}`;
            this.http.get(url).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            (re) => {
                if (this.uistate.time === ProcessTime.rt && re && re.length > 0) {
                    this.message.info(this.localePipe.transform('multiInstanceLoopCharacteristics.checkPrompt'));
                }
                else {
                    this.submitModal.emit(object);
                }
            }));
        }
        else {
            this.submitModal.emit(object);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
}
MultiInstanceLoopCharacteristicsComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-multi-instance-loop-characteristics',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-utils-fill-flex-column farris-split-section m-2 h-100\">\r\n    <section class=\"f-utils-fill-flex-column h-100\">\r\n      <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\" style=\"border-radius:16px;border: 1.5px solid #F1F3F7;\">\r\n        <div class=\"farris-form form-inline farris-form-inline\">\r\n          <div class=\"col-12 farris-group-auto my-3 pr-5\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'multiInstanceLoopCharacteristics.isEnable' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap mr-5\">\r\n                  <farris-switch [(ngModel)]=\"loopCharacteristics.enable\" name=\"enable\" (valueChange)=\"isEnable($event)\"></farris-switch>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-3 pr-5\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'multiInstanceLoopCharacteristics.isSequential' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap mr-5\">\r\n                  <farris-switch [(ngModel)]=\"loopCharacteristics.sequential\" name=\"sequential\"></farris-switch>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-3 pr-5\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'multiInstanceLoopCharacteristics.loopCardinality' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap ml-1\">\r\n                  <input-group [editable]=\"false\" [enableClear]=\"false\" [customCls]=\"'custom-cls'\" [groupText]=\"groupIcon2\"\r\n                    [(value)]=\"loopCharacteristics.loopCardinality\" (clickHandle)=\"loopCardinalityExpr($event)\">\r\n                  </input-group>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-3 pr-5\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\"></span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\" style=\"padding-right: 30px;border-radius:15px\">\r\n                  <div class=\"page-friendly-reminder\" style=\"background:#ECF4FF;padding: 0.5rem!important;border-radius:6px\">\r\n                    <div class=\"reminder-message\">\r\n                      <span class=\"reminder-title\">\r\n                        <span class=\"f-icon f-icon-info\">\r\n                        </span>\r\n                        <span class=\"reminder-name\" style=\"padding-left: 0.25rem\">\r\n                        </span>\r\n                      </span>\r\n                      <span class=\"message\" *ngIf=\"promptAct\"><br/>{{'multiInstanceLoopCharacteristics.promptAct1' | wfLocale}}<br/>\r\n                        {{'multiInstanceLoopCharacteristics.promptAct2' | wfLocale}}<br/>\r\n                      </span>\r\n                      <span class=\"message\" *ngIf=\"!promptAct\"><br/>{{'multiInstanceLoopCharacteristics.promptProc1' | wfLocale}}<br/>\r\n                        {{'multiInstanceLoopCharacteristics.promptProc2' | wfLocale}}<br/>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-12 farris-group-auto my-3 pr-5\" *ngIf=\"loopCharacteristics.enable\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'multiInstanceLoopCharacteristics.completionConditionRules' | wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap ml-1\">\r\n                  <input-group [editable]=\"false\" [enableClear]=\"false\" [customCls]=\"'custom-cls'\" [groupText]=\"groupIcon2\" \r\n                    [(value)]=\"conditionRulesIsSet\" (clickHandle)=\"setCompletionConditionRules(loopCharacteristics.completionConditionRules)\">\r\n                  </input-group>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">{{'component.timeLimitControl.clickCancel' | wfLocale }}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">{{'component.timeLimitControl.clickOK' | wfLocale }}</button>\r\n</ng-template>",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
MultiInstanceLoopCharacteristicsComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: BsModalService },
    { type: MessagerService },
    { type: HttpService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
MultiInstanceLoopCharacteristicsComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    cell: [{ type: ViewChild, args: ['cell',] }],
    grid: [{ type: ViewChild, args: ['grid',] }]
};
if (false) {
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.cls;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.groupIcon2;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.closeModal;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.submitModal;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.editorParams;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.modalFooter;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.cell;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.grid;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.preEnable;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.preSequential;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.loopCharacteristics;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.loopCharacteristicsTemp;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.conditionRulesIsSet;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.promptAct;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.bpmnModel;
    /** @type {?} */
    MultiInstanceLoopCharacteristicsComponent.prototype.modalConfig;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsComponent.prototype.localePipe;
}
export class MultiInstanceLoopCharacteristicsConverter {
    /**
     * @param {?} localePipe
     */
    constructor(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && ((/** @type {?} */ (data))).enable) {
            return this.localePipe.transform('multiInstanceLoopCharacteristics.set');
        }
        return this.localePipe.transform('multiInstanceLoopCharacteristics.notSet');
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    MultiInstanceLoopCharacteristicsConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktaW5zdGFuY2UtbG9vcC1jaGFyYWN0ZXJpc3RpY3MuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9tdWx0aS1pbnN0YW5jZS1sb29wLWNoYXJhY3RlcmlzdGljcy9tdWx0aS1pbnN0YW5jZS1sb29wLWNoYXJhY3RlcmlzdGljcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBYSxVQUFVLEVBQW9ELE1BQU0scUJBQXFCLENBQUM7QUFDOUcsT0FBTyxFQUFFLFNBQVMsRUFBVSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeE0sT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQ2hHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRTVFLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLDhDQUE4QyxDQUFDOztBQUVoRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNyRSxPQUFPLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBc0IsTUFBTSwwQkFBMEIsQ0FBQztBQUkxRixP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OztJQUVuQiw4REFBOEM7O0lBRTlDLGdFQUtFOzs7OztJQUdBLDZEQUEwQzs7Ozs7SUFDMUMsNkRBQTBCOzs7OztJQUMxQiw0REFBdUM7Ozs7O0lBQ3ZDLHlEQUErQjs7Ozs7SUFDL0IsaUVBQW9DOzs7OztJQUNwQyw0REFBZ0M7Ozs7O0lBQ2hDLHlEQUF5Qjs7Ozs7SUFDekIsd0RBQTBDOzs7OztJQUMxQyw2REFBMkM7Ozs7O0lBQzNDLDhEQUFpRDs7Ozs7SUFDakQsK0RBQTRDOztBQThJaEQsTUFBTSxPQUFPLHlDQUF5Qzs7OztJQUNwRCxZQUNVLFVBQXdCO1FBQXhCLGVBQVUsR0FBVixVQUFVLENBQWM7SUFDOUIsQ0FBQzs7Ozs7SUFFTCxTQUFTLENBQUMsSUFBUztRQUNqQixJQUFJLElBQUksSUFBSSxDQUFDLG1CQUFBLElBQUksRUFBb0MsQ0FBQyxDQUFDLE1BQU0sRUFBRTtZQUM3RCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7U0FDMUU7UUFDRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7SUFDOUUsQ0FBQztDQUNGOzs7Ozs7SUFURywrREFBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCcG1uTW9kZWwsIEV4cHJlc3Npb24sIEV4dGVuc2lvbkNvbXBsZXRpb25Db25kaXRpb25SdWxlciwgTWV4RXhwcmVzc2lvbiB9IGZyb20gJ0BlZHAtcG1mL2JwbW4tbW9kZWwnO1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBJbmplY3QsIExPQ0FMRV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBXRl9MQU5HX1JFU09VUkNFUywgV2ZMb2NhbGVQaXBlIH0gZnJvbSAnLi4vLi4vaTE4bi9waXBlL3dmLXByb2Nlc3MtZWRpdG9yLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgVHlwZUNvbnZlcnRlciB9IGZyb20gJ0BmYXJyaXMvaWRlLXByb3BlcnR5LXBhbmVsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IEV4cHJlc3Npb25TZXJ2aWNlLCBJbmplY3RlZFR5cGV9IGZyb20gJ0Bnc3Atc3ZjL2V4cHJlc3Npb24nO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcbmltcG9ydCB7IE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzIH0gZnJvbSAnLi9tdWx0aS1pbnN0YW5jZS1sb29wLWNoYXJhY3RlcmlzdGljcy5lbnRpdHknO1xyXG4vLyBpbXBvcnQgeyBFeHRlbnNpb25Db21wbGV0aW9uQ29uZGl0aW9uUnVsZXIgfSBmcm9tICcuL2V4dGVuc2lvbi1jb21wbGV0aW9uLWNvbmRpdGlvbi1ydWxlci9leHRlbnNpb24tY29tcGxldGlvbi1jb25kaXRpb24tcnVsZXIuZW50aXR5JztcclxuaW1wb3J0IHsgU2lnblJ1bGVDb21wb25lbnQgfSBmcm9tICcuLi9zaWduLXJ1bGUvc2lnbi1ydWxlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbmRpdGlvbiwgQ291bnRlclNpZ25SdWxlLCBTZW1hbnRpY0V4cHJlc3Npb24gfSBmcm9tICdAZ3NwLXdmL3dmLXByb2Nlc3MtbW9kZWwnO1xyXG4vLyBpbXBvcnQgeyBTaWduUnVsZUVudGl0eSB9IGZyb20gJy4uL3NpZ24tcnVsZS9lbnRpdGVzL3NpZ24tcnVsZS5lbnRpdHknO1xyXG5pbXBvcnQgeyBSVFByb2Nlc3NJbmZvIH0gZnJvbSAnLi4vLi4vbW9kZWwvcnQtcHJvY2Vzcy1pbmZvJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBIdHRwU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzVGltZSB9IGZyb20gJy4uLy4uL21vZGVsL3Byb2Nlc3MtdGltZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1tdWx0aS1pbnN0YW5jZS1sb29wLWNoYXJhY3RlcmlzdGljcycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL211bHRpLWluc3RhbmNlLWxvb3AtY2hhcmFjdGVyaXN0aWNzLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9tdWx0aS1pbnN0YW5jZS1sb29wLWNoYXJhY3RlcmlzdGljcy5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICBXZkxvY2FsZVBpcGUsXHJcbiBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXHJcbiAgY2xzID0gJ2ZhcnJpcy1tYWluLWFyZWEgZmxleC1jb2x1bW4nO1xyXG4gIGdyb3VwSWNvbjIgPSAnPGkgY2xhc3M9XCJmLWljb24gZi1pY29uLWxvb2t1cFwiPjwvaT4nO1xyXG5cclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuXHJcbiAgQElucHV0KCkgc2V0IHZhbHVlKHYpIHtcclxuICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljcyA9IG5ldyBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcygpO1xyXG4gICAgaWYgKHYpIHtcclxuICAgICAgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmVuYWJsZSA9IHYuZW5hYmxlO1xyXG4gICAgICB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3Muc2VxdWVudGlhbCA9IHYuc2VxdWVudGlhbDtcclxuICAgICAgdGhpcy5wcmVFbmFibGUgPSB2LmVuYWJsZTtcclxuICAgICAgdGhpcy5wcmVTZXF1ZW50aWFsID0gdi5zZXF1ZW50aWFsO1xyXG4gICAgICBpZih2Lmxvb3BDYXJkaW5hbGl0eSAmJiAodi5sb29wQ2FyZGluYWxpdHkgaW5zdGFuY2VvZiBFeHByZXNzaW9uKSAmJiAoKHYubG9vcENhcmRpbmFsaXR5KS5NZXhFeHByZXNzaW9uKSkge1xyXG4gICAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5sb29wQ2FyZGluYWxpdHkgPSAoKHYubG9vcENhcmRpbmFsaXR5KS5NZXhFeHByZXNzaW9uIGFzIFNlbWFudGljRXhwcmVzc2lvbikuVmFsdWU7XHJcbiAgICAgICAgLy8gdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmxvb3BDYXJkaW5hbGl0eSA9IHRoaXMucGVvcGxlTGlzdDtcclxuICAgICAgfVxyXG4gICAgICBpZih2LmNvbXBsZXRpb25Db25kaXRpb25SdWxlcyAmJiB2LmNvbXBsZXRpb25Db25kaXRpb25SdWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IHNpZ25SdWxlRW50aXR5QXJyYXk6RXh0ZW5zaW9uQ29tcGxldGlvbkNvbmRpdGlvblJ1bGVyW10gPSBuZXcgQXJyYXk8Q291bnRlclNpZ25SdWxlPigpO1xyXG4gICAgICAgIGZvcihsZXQgcnVsZSBvZiB2LmNvbXBsZXRpb25Db25kaXRpb25SdWxlcykge1xyXG4gICAgICAgICAgICBsZXQgc2lnblJ1bGUgPSBuZXcgQ291bnRlclNpZ25SdWxlKHRoaXMuYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgc2lnblJ1bGUuQ29uY2x1c2lvblZhbHVlID0gcnVsZS5Db25jbHVzaW9uVmFsdWU7XHJcbiAgICAgICAgICAgIHNpZ25SdWxlLkNhbGN1bGF0ZVR5cGUgPSBydWxlLkNhbGN1bGF0ZVR5cGU7XHJcbiAgICAgICAgICAgIHNpZ25SdWxlLkNvbmRpdGlvblZhbHVlID0gcnVsZS5Db25kaXRpb25WYWx1ZTtcclxuICAgICAgICAgICAgc2lnblJ1bGUuV2FpdEFsbFZvdGVzID0gcnVsZS5XYWl0QWxsVm90ZXM7XHJcbiAgICAgICAgICAgIGlmKCFzaWduUnVsZS5Db21wbGV0aW9uQ29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgICAgc2lnblJ1bGUuQ29tcGxldGlvbkNvbmRpdGlvbiA9IG5ldyBDb25kaXRpb24odGhpcy5icG1uTW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNpZ25SdWxlLkNvbXBsZXRpb25Db25kaXRpb24uVmFsdWUgPSBydWxlLkNvbXBsZXRpb25Db25kaXRpb24gPyBydWxlLkNvbXBsZXRpb25Db25kaXRpb24uVmFsdWUgOiBudWxsO1xyXG4gICAgICAgICAgICBzaWduUnVsZUVudGl0eUFycmF5LnB1c2goc2lnblJ1bGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzID0gc2lnblJ1bGVFbnRpdHlBcnJheTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IGFueSA9IHt9O1xyXG4gIEBWaWV3Q2hpbGQoJ2ljb25TZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAVmlld0NoaWxkKCdjZWxsJykgY2VsbDogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAVmlld0NoaWxkKCdncmlkJykgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gIHByZUVuYWJsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBwcmVTZXF1ZW50aWFsOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIGxvb3BDaGFyYWN0ZXJpc3RpY3M6IE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzID0gbmV3IE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzKCk7XHJcbiAgXHJcbiAgbG9vcENoYXJhY3RlcmlzdGljc1RlbXA6IE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzID0gbnVsbDtcclxuXHJcbiAgLy8gcGVvcGxlTGlzdDogc3RyaW5nO1xyXG5cclxuICBjb25kaXRpb25SdWxlc0lzU2V0OiBzdHJpbmcgPSB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdtdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcy5jb25kaXRpb25SdWxlc1NldCcpO1xyXG5cclxuICBwcm9tcHRBY3Q6IGJvb2xlYW47XHJcbiAgXHJcbiAgYnBtbk1vZGVsOiBCcG1uTW9kZWwgPSB0aGlzLnVpc3RhdGUuYnBtbk1vZGVsO1xyXG5cclxuICBtb2RhbENvbmZpZyA9IHtcclxuICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdtdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcy5sb29wQ2hhcmFjdGVyaXN0aWNzJyksXHJcbiAgICB3aWR0aDogNTUwLFxyXG4gICAgaGVpZ2h0OiA0NTAsXHJcbiAgICBzaG93QnV0dG9uczogdHJ1ZVxyXG4gIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKCAgICBcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSB1aXN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBleHByOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBASW5qZWN0KFdGX0xBTkdfUkVTT1VSQ0VTKSBwcml2YXRlIHJlc291cmNlczogYW55LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGUpIHsgXHJcbiAgICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGlmKHRoaXMuZWRpdG9yUGFyYW1zLmxvY2F0aW9uICYmIHRoaXMuZWRpdG9yUGFyYW1zLmxvY2F0aW9uID09ICdhY3Rpdml0eScpIHtcclxuICAgICAgdGhpcy5wcm9tcHRBY3QgPSB0cnVlO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICB0aGlzLnByb21wdEFjdCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbG9vcENhcmRpbmFsaXR5RXhwcihkYXRhOiBhbnkpe1xyXG4gICAgdGhpcy5zaG93bG9vcENhcmRpbmFsaXR5SGVscChkYXRhKTtcclxuICB9XHJcblxyXG4gIHNob3dsb29wQ2FyZGluYWxpdHlIZWxwKGRhdGE6IHN0cmluZyl7XHJcbiAgICB0aGlzLnNob3dFeHByKCk7XHJcbiAgICBpZiAodGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmxvb3BDYXJkaW5hbGl0eSkge1xyXG4gICAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQodGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmxvb3BDYXJkaW5hbGl0eSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQoJycpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGV4cHJlc3Npb25JbmZvOiBzdHJpbmcpID0+IHtcclxuICAgICAgLy8gdGhpcy5wZW9wbGVMaXN0ID0gZXhwcmVzc2lvbkluZm87XHJcbiAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5sb29wQ2FyZGluYWxpdHkgPSBleHByZXNzaW9uSW5mbztcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2hvd0V4cHIoKXtcclxuICAgIC8vIHRoaXMuZXhwci5jbGVhckNvbnRleHQoKTtcclxuICAgIGlmICh0aGlzLnVpc3RhdGUuc2NoZW1hcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc2NoZW1hIG9mIHRoaXMudWlzdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbW1vbk9iamVjdChjbyk7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy51aXN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMgJiYgdGhpcy51aXN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLnVpc3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250ZXh0ID0gbmV3IEFycmF5KCk7XHJcbiAgICBpZiAodGhpcy51aXN0YXRlLnByb2NJbnN0Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy51aXN0YXRlLnByb2NJbnN0Q29udGV4dCkge1xyXG4gICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbnRleHQodmFyaWFibGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy51aXN0YXRlLnByb2Nlc3NWYXJpYWJsZUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMudWlzdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdGhpcy5leHByLmFkZENvbnRleHQodmFyaWFibGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdiBvZiBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZENvbnRleHQodik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlzRW5hYmxlKGRhdGE6IGFueSkge1xyXG4gICAgaWYoIWRhdGEpIHtcclxuICAgICAgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzVGVtcCA9IG5ldyBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcygpO1xyXG4gICAgICB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3NUZW1wLmVuYWJsZSA9IHRydWU7XHJcbiAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljc1RlbXAuc2VxdWVudGlhbCA9IHRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5zZXF1ZW50aWFsO1xyXG4gICAgICB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3NUZW1wLmxvb3BDYXJkaW5hbGl0eSA9IHRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5sb29wQ2FyZGluYWxpdHk7XHJcbiAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljc1RlbXAuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzID0gbmV3IEFycmF5PENvdW50ZXJTaWduUnVsZT4oKTtcclxuICAgICAgaWYodGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzICYmIHRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXMpIHtcclxuICAgICAgICB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzLmZvckVhY2goY29tID0+IHRoaXMubG9vcENoYXJhY3RlcmlzdGljc1RlbXAuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzLnB1c2goY29tLmNsb25lKCkgYXMgYW55KSk7XHJcbiAgICAgIH0gXHJcbiAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljcyA9IG5ldyBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcygpO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBpZih0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3NUZW1wKSB7XHJcbiAgICAgICAgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmVuYWJsZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLnNlcXVlbnRpYWwgPSB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3NUZW1wLnNlcXVlbnRpYWw7XHJcbiAgICAgICAgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmxvb3BDYXJkaW5hbGl0eSA9IHRoaXMubG9vcENoYXJhY3RlcmlzdGljc1RlbXAubG9vcENhcmRpbmFsaXR5O1xyXG4gICAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXMgPSBuZXcgQXJyYXk8Q291bnRlclNpZ25SdWxlPigpO1xyXG4gICAgICAgIGlmKHRoaXMubG9vcENoYXJhY3RlcmlzdGljc1RlbXAuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzKSB7XHJcbiAgICAgICAgICB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3NUZW1wLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcy5mb3JFYWNoKGNvbSA9PiB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzLnB1c2goY29tLmNsb25lKCkgYXMgYW55KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubG9vcENoYXJhY3RlcmlzdGljc1RlbXAgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnZhbGlkYXRlKGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgdmFsaWRhdGUoZGF0YTogYW55KSB7XHJcbiAgICBpZihkYXRhID09IHRydWUpIHtcclxuICAgICAgaWYoIXRoaXMubG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXMgfHwgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgdGhpcy5zZXRDb21wbGV0aW9uQ29uZGl0aW9uUnVsZXModGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldENvbXBsZXRpb25Db25kaXRpb25SdWxlcyhjb21wbGV0aW9uQ29uZGl0aW9uUnVsZXM6IEV4dGVuc2lvbkNvbXBsZXRpb25Db25kaXRpb25SdWxlcltdKSB7XHJcbiAgICBsZXQgZGlhbG9nOiBhbnk7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoU2lnblJ1bGVDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UudmFsdWUxID0gY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzO1xyXG4gICAgLy8gY29tcFJlZi5pbnN0YW5jZS5kYXRhID0gdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcztcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc3VibWl0TW9kYWwuc3Vic2NyaWJlKChyZTogRXh0ZW5zaW9uQ29tcGxldGlvbkNvbmRpdGlvblJ1bGVyW10pID0+IHtcclxuICAgICAgdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcyA9IHJlO1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5jbG9zZU1vZGFsLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwibXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzXCIpLFxyXG4gICAgICB3aWR0aDogODAwLFxyXG4gICAgICBoZWlnaHQ6IDUxNSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlcjEsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgICB9O1xyXG4gICAgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgfVxyXG5cclxuICBjbGlja09LKCkge1xyXG4gICAgY29uc3Qgb2JqZWN0ID0geyB2YWx1ZTogdGhpcy5sb29wQ2hhcmFjdGVyaXN0aWNzLCBwYXJhbWV0ZXJzOiBudWxsIH07XHJcbiAgICBpZih0aGlzLnByZUVuYWJsZSAhPSB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3MuZW5hYmxlIHx8IHRoaXMucHJlU2VxdWVudGlhbCAhPSB0aGlzLmxvb3BDaGFyYWN0ZXJpc3RpY3Muc2VxdWVudGlhbCkge1xyXG4gICAgICBjb25zdCB1cmwgPSBgL2FwaS9ydW50aW1lL3dmL3YxLjAvcHJvY2Vzc0luc3RhbmNlcy9ydW50aW1lQWN0aXZpdHlJbnN0YW5jZXM/cHJvY0RlZklkPSR7dGhpcy51aXN0YXRlLnByb2NEZWZJZH0mYWN0aXZpdHlEZWZpbml0aW9uSWQ9JHt0aGlzLnVpc3RhdGUucHJvcGVydHlEYXRhLklkfWA7XHJcbiAgICAgIHRoaXMuaHR0cC5nZXQodXJsKS5zdWJzY3JpYmUoKHJlOiBhbnkpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLnVpc3RhdGUudGltZSA9PT0gUHJvY2Vzc1RpbWUucnQgJiYgcmUgJiYgcmUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdtdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcy5jaGVja1Byb21wdCcpKTtcclxuICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXRNb2RhbC5lbWl0KG9iamVjdCk7XHJcbiAgICAgICAgICB9IFxyXG4gICAgICAgIH0pO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICAgIH1cclxuICB9XHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljc0NvbnZlcnRlciBpbXBsZW1lbnRzIFR5cGVDb252ZXJ0ZXIge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGVcclxuICApIHsgfVxyXG5cclxuICBjb252ZXJ0VG8oZGF0YTogYW55KTogc3RyaW5nIHtcclxuICAgIGlmIChkYXRhICYmIChkYXRhIGFzIE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzKS5lbmFibGUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ211bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzLnNldCcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ211bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzLm5vdFNldCcpO1xyXG4gIH1cclxufVxyXG4iXX0=
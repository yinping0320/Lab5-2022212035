/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, TemplateRef, HostBinding, Output, EventEmitter, Input, ChangeDetectorRef, Optional, LOCALE_ID, Inject } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { ApprovalPivotConfig } from './approval-pivot-config';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { ExpressionService, InjectedType, ExprEditMode } from '@gsp-svc/expression';
import { ApprovalPivot } from './approval-pivot';
import { MessagerService } from '@farris/ui-messager';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class ApprovalPivotComponent {
    /**
     * @param {?} designerUIState
     * @param {?} expr
     * @param {?} message
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(designerUIState, expr, message, cdr, localeId, resources, localePipe) {
        this.designerUIState = designerUIState;
        this.expr = expr;
        this.message = message;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.cls = 'farris-main-area flex-column';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.config = new ApprovalPivotConfig();
        this.typeList = [
            { value: 'REMIND', text: this.localePipe.transform('component.approvalPivot.remind') }
        ];
        this.columns = [
            {
                field: 'type', width: 80, title: this.localePipe.transform('component.approvalPivot.type'),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.typeList }
                },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: { valueField: 'value', textField: 'text', data: this.typeList, idField: 'value', panelHeight: 'auto', enableClear: false }
                },
                validators: [
                    { type: 'required', messager: '必填' }
                ]
            },
            {
                field: 'condition', width: 120, title: this.localePipe.transform('component.approvalPivot.condition'), showTips: true,
                editor: {
                    type: 'input-group',
                    options: {
                        groupText: '<i class="f-icon f-icon-lookup"></i>',
                        editable: false,
                        clickHandle: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            e.formControl.setValue(e.instance.value ? e.instance.value : '');
                            this.editConditon(e);
                        }),
                        clear: (/**
                         * @param {?} e
                         * @return {?}
                         */
                        (e) => {
                            console.log('clear', e);
                        })
                    }
                }
            },
            {
                field: 'title', width: 80, title: this.localePipe.transform('component.approvalPivot.title'),
                editor: { type: EditorTypes.TEXTBOX, options: {} }
            }, {
                field: 'description', width: 100, title: this.localePipe.transform('component.approvalPivot.description'), showTips: true,
                editor: { type: EditorTypes.TEXTBOX, options: {} }
            }
        ];
        this.modalConfig = {
            title: this.localePipe.transform('component.approvalPivot.approvalPivot'),
            width: 800,
            height: 480,
            showButtons: true
        };
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set value(data) {
        this.config.localePipe = this.localePipe;
        if (data) {
            this.config.enable = data.enable;
            this.config.title = data.title;
            this.config.expand = data.expand;
            if (data.approvalPivots && data.approvalPivots.length > 0) {
                for (const a of data.approvalPivots) {
                    /** @type {?} */
                    const approvalPivot = new ApprovalPivot();
                    approvalPivot.type = a.type;
                    approvalPivot.title = a.title;
                    approvalPivot.description = a.description;
                    if (a.condition) {
                        if (typeof (a.condition) === 'string') {
                            approvalPivot.condition = a.condition;
                        }
                        else {
                            approvalPivot.condition = a.condition._value;
                        }
                    }
                    this.config.approvalPivots = this.config.approvalPivots.concat([approvalPivot]);
                }
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    add() {
        /** @type {?} */
        const approvalPivot = new ApprovalPivot();
        this.config.approvalPivots = this.config.approvalPivots.concat([approvalPivot]);
    }
    /**
     * @return {?}
     */
    delete() {
        /** @type {?} */
        const selectedRow = this.grid.selectedRow;
        if (!selectedRow) {
            this.message.info(this.localePipe.transform('component.approvalPivot.selectedRow'));
            return;
        }
        this.config.approvalPivots = this.config.approvalPivots.filter((/**
         * @param {?} a
         * @return {?}
         */
        a => a.id !== selectedRow.id));
    }
    /**
     * @return {?}
     */
    clickOK() {
        if (!this.config.title && this.config.enable) {
            this.message.info(this.localePipe.transform('component.approvalPivot.configTitle'));
            return;
        }
        this.grid.endCellEdit();
        if (this.validator()) {
            /** @type {?} */
            const object = { value: this.config, parameters: null };
            this.submitModal.emit(object);
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @private
     * @return {?}
     */
    validator() {
        return true;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    editConditon(e) {
        /** @type {?} */
        let context = new Array();
        // if(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage')) {
        //   context.push(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage'));
        // }
        // this.expr.clearContext();
        if (this.designerUIState.schemas.length > 0) {
            for (const schema of this.designerUIState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        context = this.designerUIState.addContext(context);
        if (this.designerUIState.subActivityContext.length > 0) {
            for (const variable of this.designerUIState.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerUIState.activityComponentContext.length > 0) {
            for (const variable of this.designerUIState.activityComponentContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.addExpressionText(e.instance.value);
        this.expr.setEditPattern(ExprEditMode.Conditional);
        this.expr.buildExpression().then((/**
         * @param {?} cond
         * @return {?}
         */
        (cond) => {
            e.formControl.setValue(cond);
            e.instance.cd.detectChanges();
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
}
ApprovalPivotComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-approval-pivot',
                template: "<div class=\"f-page\">\r\n  <section class=\"f-page-main d-flex flex-column\">\r\n    <farris-section class=\"pt-0 f-section-form f-section-in-mainsubcard\" mainTitle=\"{{'component.approvalPivot.approvalPivot'|wfLocale}}\" [enableAccordion]=\"'default'\"\r\n      [enableMaximize]=\"false\">\r\n      <div class=\"wf-process-pivot\">\r\n        <div class=\"wf-process-pivot-actions\">\r\n          <span class=\"wf-process-pivot-actions-text\">{{'component.approvalPivot.enable'|wfLocale}}</span>\r\n          <farris-switch [(ngModel)]=\"config.enable\" name=\"enable\"></farris-switch>\r\n        </div>\r\n        <div class=\"wf-process-pivot-actions\">\r\n          <span class=\"wf-process-pivot-actions-text\">{{'component.approvalPivot.expand'|wfLocale}}</span>\r\n          <farris-switch [(ngModel)]=\"config.expand\" name=\"expand\" [disabled]=\"!config.enable\"></farris-switch>\r\n        </div>\r\n        <div class=\"wf-process-pivot-actions\">\r\n          <span class=\"farris-label-info text-danger\">*</span>\r\n          <span class=\"wf-process-pivot-actions-text\">{{'component.approvalPivot.showTitle'|wfLocale}}</span>\r\n          <div class=\"farris-input-wrap\">\r\n            <input type=\"text\" class=\"form-control\" [(ngModel)]=\"config.title\" name=\"title\" [readonly]=\"!config.enable\"/>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </farris-section>\r\n    <farris-section class=\"pt-0 f-section-grid f-section-in-managelist\" mainTitle=\"{{'component.approvalPivot.list'|wfLocale}}\" [enableAccordion]=\"''\"\r\n      [enableMaximize]=\"false\" [fill]=\"true\">\r\n      <ng-template farrisSectionToolbar>\r\n        <button class=\"btn btn-link pr-2 mr-2\" (click)=\"add()\" [disabled]=\"!config.enable\">{{'component.approvalPivot.add'|wfLocale}}</button>\r\n        <button class=\"btn btn-link mr-0\" (click)=\"delete()\" [disabled]=\"!config.enable\">{{'component.approvalPivot.delete'|wfLocale}}</button>\r\n      </ng-template>\r\n      <farris-datagrid class=\"f-component-grid\" [columns]=\"columns\" [data]=\"config.approvalPivots\" #grid [idField]=\"'id'\" [showLineNumber]=\"true\"\r\n        [striped]=\"true\" [showCheckbox]=\"false\" [pagination]=\"false\" [fit]=\"true\" [fitColumns]=\"true\" [editable]=\"true\" [editMode]=\"'cell'\"\r\n        [multiSelect]=\"false\" [disabled]=\"!config.enable\">\r\n      </farris-datagrid>\r\n    </farris-section>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3\" (click)=\"clickCancel()\">{{'component.approvalPivot.clickCancel'|wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.approvalPivot.clickOK'|wfLocale}}</button>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [".wf-process-pivot{display:flex;align-items:center;margin-bottom:20px}.wf-process-pivot-actions{display:flex;padding-left:30px;align-items:center}.wf-process-pivot-actions-text{padding-right:10px}"]
            }] }
];
/** @nocollapse */
ApprovalPivotComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: MessagerService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
ApprovalPivotComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    grid: [{ type: ViewChild, args: ['grid',] }],
    value: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ApprovalPivotComponent.prototype.cls;
    /** @type {?} */
    ApprovalPivotComponent.prototype.closeModal;
    /** @type {?} */
    ApprovalPivotComponent.prototype.submitModal;
    /** @type {?} */
    ApprovalPivotComponent.prototype.modalFooter;
    /** @type {?} */
    ApprovalPivotComponent.prototype.grid;
    /** @type {?} */
    ApprovalPivotComponent.prototype.config;
    /** @type {?} */
    ApprovalPivotComponent.prototype.typeList;
    /** @type {?} */
    ApprovalPivotComponent.prototype.columns;
    /** @type {?} */
    ApprovalPivotComponent.prototype.modalConfig;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotComponent.prototype.localePipe;
}
export class ApprovalPivotConverter {
    /**
     * @param {?} localePipe
     */
    constructor(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && data.enable) {
            return this.localePipe.transform('component.approvalPivot.set');
        }
        else {
            return this.localePipe.transform('component.approvalPivot.notSet');
        }
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    ApprovalPivotConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwcm92YWwtcGl2b3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9hcHByb3ZhbC1waXZvdC9hcHByb3ZhbC1waXZvdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFcEssT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFhLE1BQU0scUJBQXFCLENBQUM7QUFDL0YsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFXaEcsTUFBTSxPQUFPLHNCQUFzQjs7Ozs7Ozs7OztJQTRGakMsWUFDVSxlQUF1QyxFQUN2QyxJQUF1QixFQUN2QixPQUF3QixFQUNaLEdBQXNCLEVBQ2YsUUFBZ0IsRUFDUixTQUFjLEVBQzdCLFVBQXdCO1FBTnBDLG9CQUFlLEdBQWYsZUFBZSxDQUF3QjtRQUN2QyxTQUFJLEdBQUosSUFBSSxDQUFtQjtRQUN2QixZQUFP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QjtZQTdHRCxZQUFZLHVCQThHbkMsUUFBUTs7O2tCQWxHVixXQUFXLFNBQUMsT0FBTzt5QkFHbkIsTUFBTTswQkFDTixNQUFNOzBCQUVOLFNBQVMsU0FBQyxrQkFBa0I7bUJBQzVCLFNBQVMsU0FBQyxNQUFNO29CQUVoQixLQUFLOzs7O0lBVE4scUNBQ3FDOztJQUVyQyw0Q0FBK0M7O0lBQy9DLDZDQUFnRDs7SUFFaEQsNkNBQTZEOztJQUM3RCxzQ0FBMkM7O0lBOEIzQyx3Q0FBbUM7O0lBRW5DLDBDQUMwRjs7SUFFMUYseUNBdUNFOztJQUVGLDZDQUtFOzs7OztJQUlBLGlEQUErQzs7Ozs7SUFDL0Msc0NBQStCOzs7OztJQUMvQix5Q0FBZ0M7Ozs7O0lBQ2hDLHFDQUEwQzs7Ozs7SUFDMUMsMENBQTJDOzs7OztJQUMzQywyQ0FBaUQ7Ozs7O0lBQ2pELDRDQUE0Qzs7QUE2RmhELE1BQU0sT0FBTyxzQkFBc0I7Ozs7SUFDakMsWUFDVSxVQUF3QjtRQUF4QixlQUFVLEdBQVYsVUFBVSxDQUFjO0lBQzlCLENBQUM7Ozs7O0lBRUwsU0FBUyxDQUFDLElBQVM7UUFDakIsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUN2QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLDZCQUE2QixDQUFDLENBQUM7U0FDakU7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNwRTtJQUNILENBQUM7Q0FDRjs7Ozs7O0lBVkcsNENBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYsIEhvc3RCaW5kaW5nLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIENoYW5nZURldGVjdG9yUmVmLCBPcHRpb25hbCwgTE9DQUxFX0lELCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHlwZUNvbnZlcnRlciB9IGZyb20gJ0BmYXJyaXMvaWRlLXByb3BlcnR5LXBhbmVsJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgQXBwcm92YWxQaXZvdENvbmZpZyB9IGZyb20gJy4vYXBwcm92YWwtcGl2b3QtY29uZmlnJztcclxuaW1wb3J0IHsgRWRpdG9yVHlwZXMgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkLWVkaXRvcnMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IEV4cHJlc3Npb25TZXJ2aWNlLCBJbmplY3RlZFR5cGUsIEV4cHJFZGl0TW9kZSwgVmFyRW50aXR5IH0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcbmltcG9ydCB7IEFwcHJvdmFsUGl2b3QgfSBmcm9tICcuL2FwcHJvdmFsLXBpdm90JztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFdGX0xBTkdfUkVTT1VSQ0VTLCBXZkxvY2FsZVBpcGUgfSBmcm9tICcuLi8uLi9pMThuL3BpcGUvd2YtcHJvY2Vzcy1lZGl0b3ItbG9jYWxlLnBpcGUnO1xyXG5pbXBvcnQgeyBXRl9QUk9DRVNTX0VESVRPUl9MQU5HX1JFU09VUkNFUyB9IGZyb20gJy4uLy4uL2kxOG4vYXNzZXRzL2xhbmcucmVzb3VyY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItYXBwcm92YWwtcGl2b3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hcHByb3ZhbC1waXZvdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYXBwcm92YWwtcGl2b3QuY29tcG9uZW50LnNjc3MnXSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgICBXZkxvY2FsZVBpcGUsXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXBwcm92YWxQaXZvdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXHJcbiAgY2xzID0gJ2ZhcnJpcy1tYWluLWFyZWEgZmxleC1jb2x1bW4nO1xyXG5cclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgQFZpZXdDaGlsZCgnZ3JpZCcpIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCB2YWx1ZShkYXRhOiBhbnkpIHtcclxuICAgIHRoaXMuY29uZmlnLmxvY2FsZVBpcGUgPSB0aGlzLmxvY2FsZVBpcGU7XHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICB0aGlzLmNvbmZpZy5lbmFibGUgPSBkYXRhLmVuYWJsZTtcclxuICAgICAgdGhpcy5jb25maWcudGl0bGUgPSBkYXRhLnRpdGxlO1xyXG4gICAgICB0aGlzLmNvbmZpZy5leHBhbmQgPSBkYXRhLmV4cGFuZDtcclxuICAgICAgaWYgKGRhdGEuYXBwcm92YWxQaXZvdHMgJiYgZGF0YS5hcHByb3ZhbFBpdm90cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBhIG9mIGRhdGEuYXBwcm92YWxQaXZvdHMpIHtcclxuICAgICAgICAgIGNvbnN0IGFwcHJvdmFsUGl2b3QgPSBuZXcgQXBwcm92YWxQaXZvdCgpO1xyXG4gICAgICAgICAgYXBwcm92YWxQaXZvdC50eXBlID0gYS50eXBlO1xyXG4gICAgICAgICAgYXBwcm92YWxQaXZvdC50aXRsZSA9IGEudGl0bGU7XHJcbiAgICAgICAgICBhcHByb3ZhbFBpdm90LmRlc2NyaXB0aW9uID0gYS5kZXNjcmlwdGlvbjtcclxuICAgICAgICAgIGlmIChhLmNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIChhLmNvbmRpdGlvbikgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgYXBwcm92YWxQaXZvdC5jb25kaXRpb24gPSBhLmNvbmRpdGlvbjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBhcHByb3ZhbFBpdm90LmNvbmRpdGlvbiA9IGEuY29uZGl0aW9uLl92YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICB0aGlzLmNvbmZpZy5hcHByb3ZhbFBpdm90cyA9IHRoaXMuY29uZmlnLmFwcHJvdmFsUGl2b3RzLmNvbmNhdChbYXBwcm92YWxQaXZvdF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uZmlnID0gbmV3IEFwcHJvdmFsUGl2b3RDb25maWcoKTtcclxuXHJcbiAgdHlwZUxpc3QgPSBbXHJcbiAgICB7IHZhbHVlOiAnUkVNSU5EJywgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmFwcHJvdmFsUGl2b3QucmVtaW5kJykgfV07XHJcblxyXG4gIGNvbHVtbnMgPSBbXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAndHlwZScsIHdpZHRoOiA4MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hcHByb3ZhbFBpdm90LnR5cGUnKSxcclxuICAgICAgZm9ybWF0dGVyOiB7XHJcbiAgICAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IHRoaXMudHlwZUxpc3QgfVxyXG4gICAgICB9LFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5DT01CT0xJU1QsXHJcbiAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy50eXBlTGlzdCwgaWRGaWVsZDogJ3ZhbHVlJywgcGFuZWxIZWlnaHQ6ICdhdXRvJywgZW5hYmxlQ2xlYXI6IGZhbHNlIH1cclxuICAgICAgfSxcclxuICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgIHsgdHlwZTogJ3JlcXVpcmVkJywgbWVzc2FnZXI6ICflv4XloasnIH1cclxuICAgICAgXVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICdjb25kaXRpb24nLCB3aWR0aDogMTIwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmFwcHJvdmFsUGl2b3QuY29uZGl0aW9uJyksIHNob3dUaXBzOiB0cnVlLFxyXG4gICAgICBlZGl0b3I6IHtcclxuICAgICAgICB0eXBlOiAnaW5wdXQtZ3JvdXAnLFxyXG4gICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgIGdyb3VwVGV4dDogJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JyxcclxuICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgIGNsaWNrSGFuZGxlOiAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLmZvcm1Db250cm9sLnNldFZhbHVlKGUuaW5zdGFuY2UudmFsdWUgPyBlLmluc3RhbmNlLnZhbHVlIDogJycpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRDb25kaXRvbihlKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjbGVhcjogKGUpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyJywgZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ3RpdGxlJywgd2lkdGg6IDgwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmFwcHJvdmFsUGl2b3QudGl0bGUnKSxcclxuICAgICAgZWRpdG9yOiB7IHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1gsIG9wdGlvbnM6IHt9IH1cclxuICAgIH0sIHtcclxuICAgICAgZmllbGQ6ICdkZXNjcmlwdGlvbicsIHdpZHRoOiAxMDAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYXBwcm92YWxQaXZvdC5kZXNjcmlwdGlvbicpLCBzaG93VGlwczogdHJ1ZSxcclxuICAgICAgZWRpdG9yOiB7IHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1gsIG9wdGlvbnM6IHt9IH1cclxuICAgIH1cclxuICBdO1xyXG5cclxuICBtb2RhbENvbmZpZyA9IHtcclxuICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYXBwcm92YWxQaXZvdC5hcHByb3ZhbFBpdm90JyksXHJcbiAgICB3aWR0aDogODAwLFxyXG4gICAgaGVpZ2h0OiA0ODAsXHJcbiAgICBzaG93QnV0dG9uczogdHJ1ZVxyXG4gIH07XHJcblxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZGVzaWduZXJVSVN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBleHByOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgYWRkKCkge1xyXG4gICAgY29uc3QgYXBwcm92YWxQaXZvdCA9IG5ldyBBcHByb3ZhbFBpdm90KCk7XHJcbiAgICB0aGlzLmNvbmZpZy5hcHByb3ZhbFBpdm90cyA9IHRoaXMuY29uZmlnLmFwcHJvdmFsUGl2b3RzLmNvbmNhdChbYXBwcm92YWxQaXZvdF0pO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRSb3cgPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3c7XHJcbiAgICBpZiAoIXNlbGVjdGVkUm93KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hcHByb3ZhbFBpdm90LnNlbGVjdGVkUm93JykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLmNvbmZpZy5hcHByb3ZhbFBpdm90cyA9IHRoaXMuY29uZmlnLmFwcHJvdmFsUGl2b3RzLmZpbHRlcihhID0+IGEuaWQgIT09IHNlbGVjdGVkUm93LmlkKTtcclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICBpZiAoIXRoaXMuY29uZmlnLnRpdGxlICYmIHRoaXMuY29uZmlnLmVuYWJsZSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuaW5mbyh0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuYXBwcm92YWxQaXZvdC5jb25maWdUaXRsZScpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ncmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICBpZiAodGhpcy52YWxpZGF0b3IoKSkge1xyXG4gICAgICBjb25zdCBvYmplY3QgPSB7IHZhbHVlOiB0aGlzLmNvbmZpZywgcGFyYW1ldGVyczogbnVsbCB9O1xyXG4gICAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdmFsaWRhdG9yKCkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuXHJcbiAgZWRpdENvbmRpdG9uKGU6IGFueSkge1xyXG4gICAgbGV0IGNvbnRleHQgPSBuZXcgQXJyYXk8VmFyRW50aXR5PigpO1xyXG4gICAgLy8gaWYodGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzLmZpbmQoeCA9PiB4LmtleSA9PT0gJ0N1cnJlbnRMYW5ndWFnZScpKSB7XHJcbiAgICAvLyAgIGNvbnRleHQucHVzaCh0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmluZCh4ID0+IHgua2V5ID09PSAnQ3VycmVudExhbmd1YWdlJykpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gdGhpcy5leHByLmNsZWFyQ29udGV4dCgpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZFNjaGVtYSgnU2NoZW1hJywgc2NoZW1hKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlcyAmJiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlUeXBlID0gdGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hc1swXS5lbnRpdHlUeXBlc1swXTtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkSW5qZWN0ZWRFbnRpdHkoZW50aXR5VHlwZS5uYW1lLCAnU2NoZW1hJyxcclxuICAgICAgICAgIGVudGl0eVR5cGUubmFtZSwgSW5qZWN0ZWRUeXBlLkVudGl0eVR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb250ZXh0ID0gdGhpcy5kZXNpZ25lclVJU3RhdGUuYWRkQ29udGV4dChjb250ZXh0KTtcclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLnN1YkFjdGl2aXR5Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5hY3Rpdml0eUNvbXBvbmVudENvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRDb250ZXh0KHYpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5leHByLmFkZEV4cHJlc3Npb25UZXh0KGUuaW5zdGFuY2UudmFsdWUpO1xyXG4gICAgdGhpcy5leHByLnNldEVkaXRQYXR0ZXJuKEV4cHJFZGl0TW9kZS5Db25kaXRpb25hbCk7XHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoY29uZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGUuZm9ybUNvbnRyb2wuc2V0VmFsdWUoY29uZCk7XHJcbiAgICAgIGUuaW5zdGFuY2UuY2QuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAvL+eCueWHu+ehruWumuWQju+8jOWOu+mZpOihqOi+vuW8j+mHjOmdoueahOaWsOWinueahOS4iuS4i+aWh+WPmOmHj1xyXG4gICAgICBpZihjb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMgPSB0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmlsdGVyKHggPT4gIWNvbnRleHQuc29tZSh5ID0+IHkua2V5ID09PSB4LmtleSkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBcHByb3ZhbFBpdm90Q29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZVxyXG4gICkgeyB9XHJcblxyXG4gIGNvbnZlcnRUbyhkYXRhOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5lbmFibGUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hcHByb3ZhbFBpdm90LnNldCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hcHByb3ZhbFBpdm90Lm5vdFNldCcpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
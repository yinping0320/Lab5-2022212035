/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, TemplateRef, Output, EventEmitter, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { ProcessDesignerUIState } from '../../../../app/process-designer.uistate';
import { DatagridComponent } from '@farris/ui-datagrid';
import { CustomizeAciton } from '../../entities/customize-action.entity';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../../../i18n/pipe/wf-process-editor-locale.pipe';
export class CustomizeActionListComponent {
    /**
     * @param {?} designerUIState
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(designerUIState, cdr, localeId, resources, localePipe) {
        this.designerUIState = designerUIState;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.submit = new EventEmitter();
        this.cancel = new EventEmitter();
        this.terminalList = [
            { value: 'app', text: this.localePipe.transform('component.customizeAction.app') },
            { value: 'web', text: 'web' },
            { value: 'web,app', text: this.localePipe.transform('component.customizeAction.all') }
        ];
        this.cols = [
            { field: 'code', width: 100, title: this.localePipe.transform('component.customizeAction.code') },
            { field: 'name', width: 100, title: this.localePipe.transform('component.customizeAction.name') },
            {
                field: 'terminal', width: 100, title: this.localePipe.transform('component.customizeAction.terminalType'),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.terminalList }
                },
            },
            {
                field: 'isAll', width: 100, title: this.localePipe.transform('component.customizeAction.isAll'),
                formatter: { type: 'boolean', options: { trueText: this.localePipe.transform('component.customizeAction.yes'), falseText: this.localePipe.transform('component.customizeAction.no') } }
            }
        ];
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
        this.customActionList = this.designerUIState.flowFormInfo.customizeActions || [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    clickOK() {
        /** @type {?} */
        const selections = [];
        /** @type {?} */
        const checkeds = this.grid.checkeds;
        if (checkeds && checkeds.length > 0) {
            checkeds.forEach((/**
             * @param {?} action
             * @return {?}
             */
            action => {
                /** @type {?} */
                const item = new CustomizeAciton(action.data.id, action.data.code, action.data.name);
                item.terminalType = action.data.terminal;
                // item.enable = true;
                item.actualParameters = [];
                if (action.data.actualParameters && action.data.actualParameters.length > 0) {
                    for (const p of action.data.actualParameters) {
                        /** @type {?} */
                        const param = (/** @type {?} */ ({
                            Name: p.code,
                            Value: p.value,
                            ValueText: p.name,
                            Tag: 'expression'
                        }));
                        item.actualParameters.push(param);
                    }
                }
                selections.push(item);
            }));
        }
        this.submit.emit(selections);
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.cancel.emit(true);
    }
}
CustomizeActionListComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-customize-action-list',
                template: "<div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2\">\r\n  <farris-datagrid #grid [columns]=\"cols\" [data]=\"customActionList\" [idField]=\"'id'\" [fit]=\"true\"\r\n    [fitColumns]=\"true\" [pagination]='false' [multiSelect]=\"true\" [showCheckbox]=\"true\" [multiSelect]=\"true\"\r\n    [checkOnSelect]=\"true\" [selectOnCheck]=\"true\">\r\n  </farris-datagrid>\r\n</div>\r\n\r\n<ng-template #footer>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3\" (click)=\"clickCancel()\">{{'component.customizeAction.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.customizeAction.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
CustomizeActionListComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
CustomizeActionListComponent.propDecorators = {
    grid: [{ type: ViewChild, args: ['grid',] }],
    footer: [{ type: ViewChild, args: ['footer',] }],
    submit: [{ type: Output }],
    cancel: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    CustomizeActionListComponent.prototype.grid;
    /** @type {?} */
    CustomizeActionListComponent.prototype.footer;
    /** @type {?} */
    CustomizeActionListComponent.prototype.submit;
    /** @type {?} */
    CustomizeActionListComponent.prototype.cancel;
    /** @type {?} */
    CustomizeActionListComponent.prototype.customActionList;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.terminalList;
    /** @type {?} */
    CustomizeActionListComponent.prototype.cols;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    CustomizeActionListComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9taXplLWFjdGlvbi1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvY3VzdG9taXplLWFjdGlvbi92aWV3cy9jdXN0b21pemUtYWN0aW9uLWxpc3QvY3VzdG9taXplLWFjdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEosT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBRXpFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQVd0RyxNQUFNLE9BQU8sNEJBQTRCOzs7Ozs7OztJQTZCdkMsWUFDVSxlQUF1QyxFQUMzQixHQUFzQixFQUNmLFFBQWdCLEVBQ1IsU0FBYyxFQUM3QixVQUF3QjtRQUpwQyxvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDM0IsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDZixhQUFRLEdBQVIsUUFBUSxDQUFRO1FBQ1IsY0FBUyxHQUFULFNBQVMsQ0FBSztRQUM3QixlQUFVLEdBQVYsVUFBVSxDQUFjO1FBN0JwQyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQVMsQ0FBQztRQUNuQyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUluQyxpQkFBWSxHQUFHO1lBQ3JCLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUs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Q0FBQyxLQUFLOzRCQUNkLFNBQVMsRUFBRSxDQUFDLENBQUMsSUFBSTs0QkFDakIsR0FBRyxFQUFFLFlBQVk7eUJBQ2xCLEVBQW1CO3dCQUNwQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO3FCQUNuQztpQkFDRjtnQkFDRCxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3hCLENBQUMsRUFBQyxDQUFDO1NBQ0o7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUMvQixDQUFDOzs7O0lBQ0QsV0FBVztRQUNULElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pCLENBQUM7OztZQTVFRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDJCQUEyQjtnQkFDckMsa3dCQUFxRDtnQkFFckQsU0FBUyxFQUFFO29CQUNSLFlBQVk7aUJBQ2Q7O2FBQ0Y7Ozs7WUFkUSxzQkFBc0I7WUFEMkMsaUJBQWlCLHVCQStDdEYsUUFBUTt5Q0FDUixNQUFNLFNBQUMsU0FBUzs0Q0FDaEIsTUFBTSxTQUFDLGlCQUFpQjtZQTVDRCxZQUFZLHVCQTZDbkMsUUFBUTs7O21CQWhDVixTQUFTLFNBQUMsTUFBTTtxQkFDaEIsU0FBUyxTQUFDLFFBQVE7cUJBRWxCLE1BQU07cUJBQ04sTUFBTTs7OztJQUpQLDRDQUEyQzs7SUFDM0MsOENBQThDOztJQUU5Qyw4Q0FBNkM7O0lBQzdDLDhDQUEyQzs7SUFFM0Msd0RBQXdCOzs7OztJQUV4QixvREFJRTs7SUFFRiw0Q0FZRTs7Ozs7SUFFQSx1REFBK0M7Ozs7O0lBQy9DLDJDQUEwQzs7Ozs7SUFDMUMsZ0RBQTJDOzs7OztJQUMzQyxpREFBaUQ7Ozs7O0lBQ2pELGtEQUE0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBJbmplY3QsIExPQ0FMRV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IEN1c3RvbWl6ZUFjaXRvbiB9IGZyb20gJy4uLy4uL2VudGl0aWVzL2N1c3RvbWl6ZS1hY3Rpb24uZW50aXR5JztcclxuaW1wb3J0IHsgQWN0dWFsUGFyYW1ldGVyIH0gZnJvbSAnLi4vLi4vLi4vZXhlY3V0ZS1mb3Jtcy9lbnRpdGllcy9leGVjdXRlLWZvcm0uZW50aXR5JztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1jdXN0b21pemUtYWN0aW9uLWxpc3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jdXN0b21pemUtYWN0aW9uLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2N1c3RvbWl6ZS1hY3Rpb24tbGlzdC5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDdXN0b21pemVBY3Rpb25MaXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZ3JpZCcpIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2Zvb3RlcicpIGZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgQE91dHB1dCgpIHN1Ym1pdCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55W10+KCk7XHJcbiAgQE91dHB1dCgpIGNhbmNlbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjdXN0b21BY3Rpb25MaXN0OiBhbnlbXTtcclxuXHJcbiAgcHJpdmF0ZSB0ZXJtaW5hbExpc3QgPSBbXHJcbiAgICB7IHZhbHVlOiAnYXBwJywgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmN1c3RvbWl6ZUFjdGlvbi5hcHAnKSB9LFxyXG4gICAgeyB2YWx1ZTogJ3dlYicsIHRleHQ6ICd3ZWInIH0sXHJcbiAgICB7IHZhbHVlOiAnd2ViLGFwcCcsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5jdXN0b21pemVBY3Rpb24uYWxsJykgfVxyXG4gIF07XHJcblxyXG4gIGNvbHMgPSBbXHJcbiAgICB7IGZpZWxkOiAnY29kZScsIHdpZHRoOiAxMDAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY3VzdG9taXplQWN0aW9uLmNvZGUnKSB9LFxyXG4gICAgeyBmaWVsZDogJ25hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmN1c3RvbWl6ZUFjdGlvbi5uYW1lJykgfSxcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICd0ZXJtaW5hbCcsIHdpZHRoOiAxMDAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY3VzdG9taXplQWN0aW9uLnRlcm1pbmFsVHlwZScpLFxyXG4gICAgICBmb3JtYXR0ZXI6IHtcclxuICAgICAgICB0eXBlOiAnZW51bScsXHJcbiAgICAgICAgb3B0aW9uczogeyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICd0ZXh0JywgZGF0YTogdGhpcy50ZXJtaW5hbExpc3QgfVxyXG4gICAgICB9LCB9LFxyXG4gICAge1xyXG4gICAgICBmaWVsZDogJ2lzQWxsJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5jdXN0b21pemVBY3Rpb24uaXNBbGwnKSxcclxuICAgICAgZm9ybWF0dGVyOiB7IHR5cGU6ICdib29sZWFuJywgb3B0aW9uczogeyB0cnVlVGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmN1c3RvbWl6ZUFjdGlvbi55ZXMnKSwgZmFsc2VUZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY3VzdG9taXplQWN0aW9uLm5vJykgfSB9ICB9XHJcbiAgXTtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZGVzaWduZXJVSVN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSkge1xyXG4gICAgdGhpcy5sb2NhbGVQaXBlID0gdGhpcy5sb2NhbGVQaXBlIHx8IG5ldyBXZkxvY2FsZVBpcGUobG9jYWxlSWQsIHJlc291cmNlcyk7XHJcbiAgICB0aGlzLmN1c3RvbUFjdGlvbkxpc3QgPSB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5mbG93Rm9ybUluZm8uY3VzdG9taXplQWN0aW9ucyB8fCBbXTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuICBjbGlja09LKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0aW9ucyA9IFtdO1xyXG4gICAgY29uc3QgY2hlY2tlZHM6IGFueVtdID0gdGhpcy5ncmlkLmNoZWNrZWRzO1xyXG4gICAgaWYgKGNoZWNrZWRzICYmIGNoZWNrZWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY2hlY2tlZHMuZm9yRWFjaChhY3Rpb24gPT4ge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgQ3VzdG9taXplQWNpdG9uKGFjdGlvbi5kYXRhLmlkLCBhY3Rpb24uZGF0YS5jb2RlLCBhY3Rpb24uZGF0YS5uYW1lKTtcclxuICAgICAgICBpdGVtLnRlcm1pbmFsVHlwZSA9IGFjdGlvbi5kYXRhLnRlcm1pbmFsO1xyXG4gICAgICAgIC8vIGl0ZW0uZW5hYmxlID0gdHJ1ZTtcclxuICAgICAgICBpdGVtLmFjdHVhbFBhcmFtZXRlcnMgPSBbXTtcclxuICAgICAgICBpZiAoYWN0aW9uLmRhdGEuYWN0dWFsUGFyYW1ldGVycyAmJiBhY3Rpb24uZGF0YS5hY3R1YWxQYXJhbWV0ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGZvciAoY29uc3QgcCBvZiBhY3Rpb24uZGF0YS5hY3R1YWxQYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtID0ge1xyXG4gICAgICAgICAgICAgIE5hbWU6IHAuY29kZSxcclxuICAgICAgICAgICAgICBWYWx1ZTogcC52YWx1ZSxcclxuICAgICAgICAgICAgICBWYWx1ZVRleHQ6IHAubmFtZSxcclxuICAgICAgICAgICAgICBUYWc6ICdleHByZXNzaW9uJ1xyXG4gICAgICAgICAgICB9IGFzIEFjdHVhbFBhcmFtZXRlcjtcclxuICAgICAgICAgICAgaXRlbS5hY3R1YWxQYXJhbWV0ZXJzLnB1c2gocGFyYW0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxlY3Rpb25zLnB1c2goaXRlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJtaXQuZW1pdChzZWxlY3Rpb25zKTtcclxuICB9XHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNhbmNlbC5lbWl0KHRydWUpO1xyXG4gIH1cclxufVxyXG4iXX0=
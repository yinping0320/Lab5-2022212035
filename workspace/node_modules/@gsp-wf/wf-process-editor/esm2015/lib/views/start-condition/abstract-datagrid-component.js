/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @abstract
 */
export class AbstractDatagridComponent {
    /**
     * @param {?} messager
     * @param {?} notify
     * @param {?} metadataService
     * @param {?} modalService
     * @param {?} localePipe
     * @param {?} injector
     * @param {?} resolver
     * @param {?} cdf
     */
    constructor(messager, notify, metadataService, modalService, localePipe, injector, resolver, cdf) {
        this.messager = messager;
        this.notify = notify;
        this.metadataService = metadataService;
        this.modalService = modalService;
        this.localePipe = localePipe;
        this.injector = injector;
        this.resolver = resolver;
        this.cdf = cdf;
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.toolbarData = [
            {
                id: 'btn-add',
                text: this.localePipe.instant("add"),
                class: 'btn btn-secondary',
                disabled: false
            },
            {
                id: 'btn-remove',
                text: this.localePipe.instant("remove"),
                class: 'btn btn-secondary',
                disabled: false
            },
        ];
        this.dgIdField = "id";
        this.editingRowId = null;
    }
    /**
     * @return {?}
     */
    get dgTotal() {
        return this.dgData.length || 0;
    }
    /**
     * @param {?} args
     * @return {?}
     */
    toolbarClickHandler(args) {
        switch (args.id) {
            case 'btn-add':
                this.add();
                break;
            case 'btn-remove':
                this.remove(null);
                break;
        }
    }
    /**
     * 开始行编辑
     * @param {?=} ctx
     * @return {?}
     */
    startRowEdit(ctx) {
        this.dg.editRow(ctx.rowData.id);
        this.editingRowId = ctx.rowData.id;
        this.cdf.detectChanges();
        return false;
    }
    /**
     * 取消行编辑
     * @param {?=} ctx
     * @return {?}
     */
    cancelRowEdit(ctx) {
        this.dg.cancelEdit(ctx.rowData.id);
        this.editingRowId = null;
        this.cdf.detectChanges();
        return false;
    }
    /**
     * 结束行编辑
     * @param {?=} ctx
     * @return {?}
     */
    endRowEdit(ctx) {
        this.dg.endRowEdit();
        this.editingRowId = null;
        this.cdf.detectChanges();
        return false;
    }
    /**
     * 行删除
     * @param {?} evt
     * @param {?=} ctx
     * @return {?}
     */
    remove(evt, ctx) {
        /** @type {?} */
        const ids = [];
        if (ctx == null) {
            // 批量删除
            this.dg.checkeds.forEach((/**
             * @param {?} it
             * @return {?}
             */
            it => {
                ids.push(it.id);
            }));
        }
        else {
            // 行内删除
            ids.push(ctx.rowData.id);
        }
        if (ids.length == 0) {
            this.notify.warning(this.localePipe.instant("pleaseSelectOneItemAtLeast"));
            if (evt != null) {
                evt.stopPropagation();
            }
            return false;
        }
        for (let id of ids) {
            this.dg.deleteRow(id);
        }
        this.dgData = this.dg.data;
        if (this.editingRowId != null) {
            if (ids.includes(this.editingRowId)) {
                this.editingRowId = null;
            }
            else {
                this.dg.editRow(this.editingRowId);
            }
        }
        this.cdf.detectChanges();
        if (evt != null) {
            evt.stopPropagation();
        }
        return false;
    }
    /**
     * 行移动
     * @param {?} evt
     * @param {?} ctx datagrid上下文
     * @param {?} direction -1: 上移， 1：下移
     * @return {?}
     */
    rowMove(evt, ctx, direction) {
        // const arr = dg.data;
        /** @type {?} */
        const arr = this.dgData;
        /** @type {?} */
        const index = this.findIndex(arr, ctx.rowData.id);
        if (index == -1 || (direction == 1 && index == arr.length - 1) || (direction == -1 && index == 0)) {
            return;
        }
        arr[index] = [arr[index + direction], arr[index + direction] = arr[index]][0];
        this.dgData = [...this.dgData];
        this.cdf.detectChanges();
        if (evt != null) {
            evt.stopPropagation();
        }
        return false;
    }
    /**
     * 查找数组中指定id的元素下标
     * @protected
     * @param {?} arr 数组
     * @param {?} id 数组唯一标识
     * @return {?} 元素下标
     */
    findIndex(arr, id) {
        /** @type {?} */
        let index = -1;
        for (let i = 0; i < arr.length; i++) {
            /** @type {?} */
            const elt = arr[i];
            if (elt.id == id) {
                index = i;
                break;
            }
        }
        return index;
    }
}
if (false) {
    /** @type {?} */
    AbstractDatagridComponent.prototype.groupIcon;
    /** @type {?} */
    AbstractDatagridComponent.prototype.toolbar;
    /** @type {?} */
    AbstractDatagridComponent.prototype.toolbarData;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dg;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgIdField;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgColumns;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgIsEnabledStateCell;
    /** @type {?} */
    AbstractDatagridComponent.prototype.dgOpCell;
    /** @type {?} */
    AbstractDatagridComponent.prototype.editingRowId;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.messager;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.notify;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.metadataService;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.modalService;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.localePipe;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.injector;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.resolver;
    /**
     * @type {?}
     * @protected
     */
    AbstractDatagridComponent.prototype.cdf;
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.dgData = function () { };
    /**
     * @abstract
     * @param {?} arr
     * @return {?}
     */
    AbstractDatagridComponent.prototype.dgData = function (arr) { };
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.ngOnInit = function () { };
    /**
     * 新增行
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.add = function () { };
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.load = function () { };
    /**
     * @abstract
     * @return {?}
     */
    AbstractDatagridComponent.prototype.configDgColumns = function () { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtZGF0YWdyaWQtY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9zdGFydC1jb25kaXRpb24vYWJzdHJhY3QtZGF0YWdyaWQtY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFVQSxNQUFNLE9BQWdCLHlCQUF5Qjs7Ozs7Ozs7Ozs7SUFnQzNDLFlBQ2MsUUFBeUIsRUFDekIsTUFBcUIsRUFDckIsZUFBcUMsRUFDckMsWUFBNEIsRUFDNUIsVUFBeUIsRUFDekIsUUFBa0IsRUFDbEIsUUFBa0MsRUFDbEMsR0FBc0I7UUFQdEIsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFDekIsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixvQkFBZSxHQUFmLGVBQWUsQ0FBc0I7UUFDckMsaUJBQVksR0FBWixZQUFZLENBQWdCO1FBQzVCLGVBQVUsR0FBVixVQUFVLENBQWU7UUFDekIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUEwQjtRQUNsQyxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQXZDM0IsY0FBUyxHQUFHLHNDQUFzQyxDQUFDO1FBR25ELGdCQUFXLEdBQUc7WUFDbkI7Z0JBQ0ksRUFBRSxFQUFFLFNBQVM7Z0JBQ2IsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztnQkFDcEMsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsUUFBUSxFQUFFLEtBQUs7YUFDbEI7WUFDRDtnQkFDSSxFQUFFLEVBQUUsWUFBWTtnQkFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztnQkFDdkMsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsUUFBUSxFQUFFLEtBQUs7YUFDbEI7U0FDSixDQUFDO1FBR0YsY0FBUyxHQUFXLElBQUksQ0FB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QzFCLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7a0JBQzNCLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksR0FBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUU7Z0JBQ2QsS0FBSyxHQUFHLENBQUMsQ0FBQztnQkFDVixNQUFNO2FBQ1Q7U0FDSjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7Q0FLSjs7O0lBbExHLDhDQUE0RDs7SUFFNUQsNENBQWtDOztJQUNsQyxnREFhRTs7SUFFRix1Q0FBc0I7O0lBQ3RCLDhDQUF5Qjs7SUFDekIsOENBQXdCOztJQU94Qix5REFBdUM7O0lBQ3ZDLDZDQUEyQjs7SUFDM0IsaURBQTRCOzs7OztJQUd4Qiw2Q0FBbUM7Ozs7O0lBQ25DLDJDQUErQjs7Ozs7SUFDL0Isb0RBQStDOzs7OztJQUMvQyxpREFBc0M7Ozs7O0lBQ3RDLCtDQUFtQzs7Ozs7SUFDbkMsNkNBQTRCOzs7OztJQUM1Qiw2Q0FBNEM7Ozs7O0lBQzVDLHdDQUFnQzs7Ozs7SUFsQnBDLDZEQUFrQzs7Ozs7O0lBQ2xDLGdFQUFxQzs7Ozs7SUFzQnJDLCtEQUEwQjs7Ozs7O0lBZ0IxQiwwREFBcUI7Ozs7O0lBbUhyQiwyREFBc0I7Ozs7O0lBRXRCLHNFQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER0QmlsbENyZWF0aW9uUHJvY2Vzc0VudGl0eSwgRHRCaWxsV3JpdGViYWNrUHJvY2Vzc0VudGl0eSB9IGZyb20gJ0BlZHAtYmlmL2NvbW1vbi1hcGknO1xyXG5pbXBvcnQgeyBSZXNwb25zZVRvb2xiYXJDb21wb25lbnQsIFJlc3BvbnNlVG9vbGJhckNsaWNrRXZlbnQgfSBmcm9tICdAZmFycmlzL3VpLXJlc3BvbnNlLXRvb2xiYXInO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCwgRGF0YUNvbHVtbiB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBUZW1wbGF0ZVJlZiwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9uSW5pdCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBHU1BNZXRhZGF0YVJUU2VydmljZSB9IGZyb20gJ0Bnc3AtbGNtL21ldGFkYXRhcnQtc2VsZWN0b3InO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBBaWZMb2NhbGVQaXBlIH0gZnJvbSAnLi4vYWlmLXVpLWNvbW1vbi9waXBlL2FpZi11aS1jb21tb24tbG9jYWxlLnBpcGUnO1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0RGF0YWdyaWRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgcmVhZG9ubHkgZ3JvdXBJY29uID0gJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JztcclxuXHJcbiAgICB0b29sYmFyOiBSZXNwb25zZVRvb2xiYXJDb21wb25lbnQ7XHJcbiAgICByZWFkb25seSB0b29sYmFyRGF0YSA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlkOiAnYnRuLWFkZCcsXHJcbiAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwiYWRkXCIpLFxyXG4gICAgICAgICAgICBjbGFzczogJ2J0biBidG4tc2Vjb25kYXJ5JyxcclxuICAgICAgICAgICAgZGlzYWJsZWQ6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlkOiAnYnRuLXJlbW92ZScsXHJcbiAgICAgICAgICAgIHRleHQ6IHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwicmVtb3ZlXCIpLFxyXG4gICAgICAgICAgICBjbGFzczogJ2J0biBidG4tc2Vjb25kYXJ5JyxcclxuICAgICAgICAgICAgZGlzYWJsZWQ6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgIF07XHJcblxyXG4gICAgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gICAgZGdJZEZpZWxkOiBzdHJpbmcgPSBcImlkXCI7XHJcbiAgICBkZ0NvbHVtbnM6IERhdGFDb2x1bW5bXTtcclxuICAgIGFic3RyYWN0IGdldCBkZ0RhdGEoKTogQXJyYXk8YW55PjtcclxuICAgIGFic3RyYWN0IHNldCBkZ0RhdGEoYXJyOiBBcnJheTxhbnk+KTtcclxuICAgIGdldCBkZ1RvdGFsKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGdEYXRhLmxlbmd0aCB8fCAwO1xyXG4gICAgfVxyXG5cclxuICAgIGRnSXNFbmFibGVkU3RhdGVDZWxsOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG4gICAgZGdPcENlbGw6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgICBlZGl0aW5nUm93SWQ6IHN0cmluZyA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJvdGVjdGVkIG1lc3NhZ2VyOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICAgICAgcHJvdGVjdGVkIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgbWV0YWRhdGFTZXJ2aWNlOiBHU1BNZXRhZGF0YVJUU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgICAgICBwcm90ZWN0ZWQgbG9jYWxlUGlwZTogQWlmTG9jYWxlUGlwZSxcclxuICAgICAgICBwcm90ZWN0ZWQgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgICAgIHByb3RlY3RlZCByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgIHByb3RlY3RlZCBjZGY6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGFic3RyYWN0IG5nT25Jbml0KCk6IHZvaWQ7XHJcblxyXG4gICAgdG9vbGJhckNsaWNrSGFuZGxlcihhcmdzOiBSZXNwb25zZVRvb2xiYXJDbGlja0V2ZW50KSB7XHJcbiAgICAgICAgc3dpdGNoIChhcmdzLmlkKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2J0bi1hZGQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5hZGQoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdidG4tcmVtb3ZlJzpcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5paw5aKe6KGMXHJcbiAgICAgKi9cclxuICAgIGFic3RyYWN0IGFkZCgpOiB2b2lkO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5byA5aeL6KGM57yW6L6RXHJcbiAgICAgKiBAcGFyYW0gY3R4IFxyXG4gICAgICovXHJcbiAgICBzdGFydFJvd0VkaXQoY3R4PzogeyByb3dJbmRleDogbnVtYmVyOyByb3dEYXRhOiB7IFtrZXk6IHN0cmluZ106IGFueTsgaWQ6IGFueTsgfTsgfSkge1xyXG4gICAgICAgIHRoaXMuZGcuZWRpdFJvdyhjdHgucm93RGF0YS5pZCk7XHJcbiAgICAgICAgdGhpcy5lZGl0aW5nUm93SWQgPSBjdHgucm93RGF0YS5pZDtcclxuICAgICAgICB0aGlzLmNkZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Y+W5raI6KGM57yW6L6RXHJcbiAgICAgKiBAcGFyYW0gY3R4IFxyXG4gICAgICovXHJcbiAgICBjYW5jZWxSb3dFZGl0KGN0eD86IHsgcm93SW5kZXg6IG51bWJlcjsgcm93RGF0YTogeyBba2V5OiBzdHJpbmddOiBhbnk7IGlkOiBhbnk7IH07IH0pIHtcclxuICAgICAgICB0aGlzLmRnLmNhbmNlbEVkaXQoY3R4LnJvd0RhdGEuaWQpO1xyXG4gICAgICAgIHRoaXMuZWRpdGluZ1Jvd0lkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNkZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog57uT5p2f6KGM57yW6L6RXHJcbiAgICAgKiBAcGFyYW0gY3R4IFxyXG4gICAgICovXHJcbiAgICBlbmRSb3dFZGl0KGN0eD86IHsgcm93SW5kZXg6IG51bWJlcjsgcm93RGF0YTogeyBba2V5OiBzdHJpbmddOiBhbnk7IGlkOiBhbnk7IH07IH0pIHtcclxuICAgICAgICB0aGlzLmRnLmVuZFJvd0VkaXQoKTtcclxuICAgICAgICB0aGlzLmVkaXRpbmdSb3dJZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jZGYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOihjOWIoOmZpFxyXG4gICAgICogQHBhcmFtIGN0eCBcclxuICAgICAqL1xyXG4gICAgcmVtb3ZlKGV2dDogRXZlbnQsIGN0eD86IHsgcm93SW5kZXg6IG51bWJlciwgcm93RGF0YTogeyBpZDtba2V5OiBzdHJpbmddOiBhbnkgfSB9KSB7XHJcbiAgICAgICAgY29uc3QgaWRzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgICAgIGlmIChjdHggPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyDmibnph4/liKDpmaRcclxuICAgICAgICAgICAgdGhpcy5kZy5jaGVja2Vkcy5mb3JFYWNoKGl0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlkcy5wdXNoKGl0LmlkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8g6KGM5YaF5Yig6ZmkXHJcbiAgICAgICAgICAgIGlkcy5wdXNoKGN0eC5yb3dEYXRhLmlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlkcy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMubG9jYWxlUGlwZS5pbnN0YW50KFwicGxlYXNlU2VsZWN0T25lSXRlbUF0TGVhc3RcIikpO1xyXG4gICAgICAgICAgICBpZiAoZXZ0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGlkIG9mIGlkcykge1xyXG4gICAgICAgICAgICB0aGlzLmRnLmRlbGV0ZVJvdyhpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGdEYXRhID0gdGhpcy5kZy5kYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLmVkaXRpbmdSb3dJZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChpZHMuaW5jbHVkZXModGhpcy5lZGl0aW5nUm93SWQpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVkaXRpbmdSb3dJZCA9IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRnLmVkaXRSb3codGhpcy5lZGl0aW5nUm93SWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2RmLmRldGVjdENoYW5nZXMoKTtcclxuICAgICAgICBpZiAoZXZ0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDooYznp7vliqhcclxuICAgICAqIEBwYXJhbSBjdHggZGF0YWdyaWTkuIrkuIvmlodcclxuICAgICAqIEBwYXJhbSBkaXJlY3Rpb24gLTE6IOS4iuenu++8jCAx77ya5LiL56e7XHJcbiAgICAgKi9cclxuICAgIHJvd01vdmUoZXZ0OiBFdmVudCwgY3R4OiB7IHJvd0luZGV4OiBudW1iZXIsIHJvd0RhdGE6IHsgaWQ7W2tleTogc3RyaW5nXTogYW55IH0gfSwgZGlyZWN0aW9uOiBudW1iZXIpIHtcclxuICAgICAgICAvLyBjb25zdCBhcnIgPSBkZy5kYXRhO1xyXG4gICAgICAgIGNvbnN0IGFyciA9IHRoaXMuZGdEYXRhO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5maW5kSW5kZXgoYXJyLCBjdHgucm93RGF0YS5pZCk7XHJcblxyXG4gICAgICAgIGlmIChpbmRleCA9PSAtMSB8fCAoZGlyZWN0aW9uID09IDEgJiYgaW5kZXggPT0gYXJyLmxlbmd0aCAtIDEpIHx8IChkaXJlY3Rpb24gPT0gLTEgJiYgaW5kZXggPT0gMCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhcnJbaW5kZXhdID0gW2FycltpbmRleCArIGRpcmVjdGlvbl0sIGFycltpbmRleCArIGRpcmVjdGlvbl0gPSBhcnJbaW5kZXhdXVswXTtcclxuICAgICAgICB0aGlzLmRnRGF0YSA9IFsuLi50aGlzLmRnRGF0YV07XHJcbiAgICAgICAgdGhpcy5jZGYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIGlmIChldnQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOafpeaJvuaVsOe7hOS4reaMh+Wummlk55qE5YWD57Sg5LiL5qCHXHJcbiAgICAgKiBAcGFyYW0gYXJyIOaVsOe7hFxyXG4gICAgICogQHBhcmFtIGlkIOaVsOe7hOWUr+S4gOagh+ivhlxyXG4gICAgICogQHJldHVybnMg5YWD57Sg5LiL5qCHXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBmaW5kSW5kZXgoYXJyOiBhbnlbXSwgaWQpOiBudW1iZXIge1xyXG4gICAgICAgIGxldCBpbmRleCA9IC0xO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsdCA9IGFycltpXTtcclxuICAgICAgICAgICAgaWYgKGVsdC5pZCA9PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgaW5kZXggPSBpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGFic3RyYWN0IGxvYWQoKTogdm9pZDtcclxuXHJcbiAgICBhYnN0cmFjdCBjb25maWdEZ0NvbHVtbnMoKTogdm9pZDtcclxufSJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, EventEmitter, Output, Input, ViewChild, TemplateRef, ComponentFactoryResolver, Injector, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { MessageNotice } from './message-notice';
import { BsModalService } from '@farris/ui-modal';
import { MessagerService } from '@farris/ui-messager';
import { MessageNoticeEditComponent } from './message-notice-edit/message-notice-edit.component';
import { DatagridComponent } from '@farris/ui-datagrid';
import { ProcessDeUtil } from '../../domain/process-de-util';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { MessageNoticeCopyComponent } from './message-notice-copy/message-notice-copy.component';
import { ProcessDesignerViewModel } from '../../app/process-designer.viewmodel';
import { HttpService } from '@ecp-caf/caf-common';
import { MessageReceiver } from './message-receiver';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class MessageNoticeComponent {
    /**
     * @param {?} resolver
     * @param {?} injector
     * @param {?} modalService
     * @param {?} message
     * @param {?} uistate
     * @param {?} viewModel
     * @param {?} http
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(resolver, injector, modalService, message, uistate, viewModel, http, cdr, localeId, resources, localePipe) {
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.message = message;
        this.uistate = uistate;
        this.viewModel = viewModel;
        this.http = http;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.cls = 'farris-main-area flex-column';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.modalConfig = {
            title: this.localePipe.transform('component.MessageNotice.notify'),
            width: 760,
            height: 480,
            showButtons: true
        };
        this.messageNotices = new Array();
        this.columns = [];
        this.location = 'activity';
        this.processSendTime = [
            { value: 'PROCESSINSTANCE_COMPLETED', text: this.localePipe.transform('component.MessageNotice.procComplete') },
            { value: 'PROCESSINSTANCE_ABORTED', text: this.localePipe.transform('component.MessageNotice.procAborted') },
            { value: 'PROCESSINSTANCE_ROLLBACK', text: this.localePipe.transform('component.MessageNotice.procRollBack') }
        ];
        this.activitySendTime = [
            { value: 'WORKITEM_CREATED', text: this.localePipe.transform('component.MessageNotice.workCreated') },
            { value: 'ACTIVITY_COMPLETED', text: this.localePipe.transform('component.MessageNotice.actComplete') },
            { value: 'ACTIVITY_ABORTED', text: this.localePipe.transform('component.MessageNotice.actAborted') },
        ];
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
        this.GetOrganizationType();
    }
    /**
     * @param {?} notices
     * @return {?}
     */
    set value(notices) {
        if (notices && notices.length > 0) {
            this.messageNotices = notices.map((/**
             * @param {?} n
             * @return {?}
             */
            n => ({
                id: ProcessDeUtil.GenerateElementId(),
                content: n.content,
                sendTime: n.sendTime,
                sendType: n.sendType,
                subject: n.subject,
                receiver: n.receiver,
                receiverText: n.receiverText,
                receivers: n.receivers ? n.receivers : new Array(),
                smsMessageTemplate: n.smsMessageTemplate
            })));
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.location = this.editorParams.location;
        this.columns = [
            {
                field: 'subject', width: 100, title: this.localePipe.transform('component.MessageNotice.subject'),
            }, {
                field: 'content', width: 150, title: this.localePipe.transform('component.MessageNotice.content'), showTips: true,
            }, {
                field: 'sendTime', width: 100, title: this.localePipe.transform('component.MessageNotice.sendTime'),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'text', data: this.location === 'process' ? this.processSendTime : this.activitySendTime }
                },
            }, {
                field: 'sendType', width: 100, title: this.localePipe.transform('component.MessageNotice.sendType'),
                formatter: {
                    type: 'enum',
                    options: { valueField: 'value', textField: 'name', data: this.uistate.messageChannels.map((/**
                         * @param {?} m
                         * @return {?}
                         */
                        m => ({ value: m.code, name: m.name }))) }
                },
            }, {
                field: 'receiverText', width: 120, title: this.localePipe.transform('component.MessageNotice.receiverText'), showTips: true, formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                (v, d, i) => {
                    /** @type {?} */
                    let receiverText = '';
                    if (d.receivers && d.receivers.length > 0) {
                        for (const receiver of d.receivers) {
                            if (receiver.type === 'processParticipant') {
                                if (receiver.processParticipant === 'procInstCreator') {
                                    receiverText += this.localePipe.transform('component.MessageNotice.procInstCreator');
                                }
                                else if (receiver.processParticipant === 'workItemParticipant') {
                                    receiverText += this.localePipe.transform('component.MessageNotice.workItemParticipant');
                                }
                                else if (receiver.processParticipant === 'activityExecutorParticipant') {
                                    receiverText += (receiver.activityDefName + '，');
                                }
                            }
                            else if (receiver.type === 'userParticipant') {
                                receiverText += (receiver.userNames + '，');
                            }
                            else if (receiver.type === 'variableParticipant') {
                                receiverText += (receiver.variableName + '，');
                            }
                            else if (receiver.type === 'positionParticipant') {
                                receiverText += (receiver.positionName + '，');
                            }
                        }
                    }
                    if (receiverText) {
                        receiverText = receiverText.substring(0, receiverText.length - 1);
                    }
                    return receiverText;
                }),
            }
        ];
        if (this.location === 'messageActivity') {
            this.columns = this.columns.filter((/**
             * @param {?} c
             * @return {?}
             */
            c => c.field !== 'sendTime'));
        }
    }
    /**
     * @return {?}
     */
    add() {
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(MessageNoticeEditComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.location = this.location;
        /** @type {?} */
        const messageNotice = new MessageNotice();
        if (this.location === 'activity') {
            messageNotice.sendTime = 'WORKITEM_CREATED';
            /** @type {?} */
            const messageReceiver = new MessageReceiver();
            messageReceiver.type = 'processParticipant';
            messageReceiver.processParticipant = 'workItemParticipant';
            messageNotice.receivers = [messageReceiver];
        }
        else if (this.location === 'process') {
            messageNotice.sendTime = 'PROCESSINSTANCE_COMPLETED';
            /** @type {?} */
            const messageReceiver = new MessageReceiver();
            messageReceiver.type = 'processParticipant';
            messageReceiver.processParticipant = 'procInstCreator';
            messageNotice.receivers = [messageReceiver];
        }
        else if (this.location === 'messageActivity') {
            /** @type {?} */
            const messageReceiver = new MessageReceiver();
            messageReceiver.type = 'processParticipant';
            messageReceiver.processParticipant = 'procInstCreator';
            messageNotice.receivers = [messageReceiver];
        }
        compRef.instance.value = messageNotice;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            this.messageNotices = this.messageNotices.concat([re]);
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform('component.MessageNotice.messageSet'),
            width: 760,
            height: 480,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
    /**
     * @return {?}
     */
    edit() {
        if (!this.grid.selectedRow) {
            this.message.info(this.localePipe.transform('component.MessageNotice.selectedRow'));
            return;
        }
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(MessageNoticeEditComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.location = this.location;
        compRef.instance.value = this.grid.selectedRow.data;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            this.messageNotices = this.messageNotices.map((/**
             * @param {?} m
             * @return {?}
             */
            m => {
                if (m.id === re.id) {
                    return re;
                }
                return m;
            }));
            this.grid.unSelectRow(this.grid.selectedRow.data.id, true);
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform('component.MessageNotice.messageSet'),
            width: 760,
            height: 480,
            showButtons: true,
            buttons: compRef.instance.footer
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
    /**
     * @return {?}
     */
    batchCopy() {
        if (!this.messageNotices) {
            this.message.info(this.localePipe.transform('component.MessageNotice.noCopy'));
            return;
        }
        /** @type {?} */
        let dialog;
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(MessageNoticeCopyComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.messageNotices = this.messageNotices;
        compRef.instance.submitEmitter.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            this.viewModel.copy(ResourceKeys.batchCopyProperty, data);
            dialog.close();
        }));
        compRef.instance.closeEmitter.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform('component.MessageNotice.batchCopy'),
            width: 800,
            height: 515,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        dialog = this.modalService.show(compRef, modalConfig);
    }
    /**
     * @return {?}
     */
    delete() {
        /** @type {?} */
        const selected = this.grid.selectedRow;
        if (!selected) {
            this.message.info(this.localePipe.transform('component.MessageNotice.selectedRow'));
            return;
        }
        this.messageNotices = this.messageNotices.filter((/**
         * @param {?} m
         * @return {?}
         */
        m => m.id !== selected.id));
    }
    /**
     * @return {?}
     */
    clickOK() {
        /** @type {?} */
        const object = { value: this.messageNotices, parameters: null };
        this.submitModal.emit(object);
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @private
     * @return {?}
     */
    GetOrganizationType() {
        /** @type {?} */
        const url = '/api/runtime/sys/v1.0/authfields/globalauthfields';
        this.http.get(url)
            .subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => this.uistate.orgTypeCollection = data.map((/**
         * @param {?} d
         * @return {?}
         */
        d => ({ value: d.id, text: d.name })))));
    }
}
MessageNoticeComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-message-notice',
                template: "<div class=\"f-page\">\r\n  <div class=\"f-page-header\">\r\n    <nav class=\"f-page-header-base\">\r\n      <div class=\"f-title\">\r\n      </div>\r\n      <div class=\"btn-toolbar btn-group-lg\">\r\n        <button class=\"btn btn-primary mr-2\" (click)=\"add()\">{{'component.MessageNotice.add' | wfLocale}}</button>\r\n        <button class=\"btn btn-secondary mr-2\" (click)=\"edit()\">{{'component.MessageNotice.edit' | wfLocale}}</button>\r\n        <button class=\"btn btn-secondary mr-2\" [disabled]=\"location!=='activity'\" (click)=\"batchCopy()\">{{'component.MessageNotice.batchCopy' | wfLocale}}</button>\r\n        <button class=\"btn btn-secondary\" (click)=\"delete()\">{{'component.MessageNotice.delete' | wfLocale}}</button>\r\n      </div>\r\n    </nav>\r\n  </div>\r\n  <div class=\"f-page-main f-utils-fill-flex-column h-100\">\r\n    <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100\" style=\"border-radius:16px;border: 1.5px solid #F1F3F7;\">\r\n      <farris-datagrid #grid [data]=\"messageNotices\" [columns]=\"columns\" [idField]=\"'id'\" [fit]=\"true\"\r\n        [fitColumns]=\"true\" [editable]=\"false\" [pagination]=\"false\" [showCheckbox]=\"false\"\r\n        [multiSelect]=\"false\" [showLineNumber]=\"true\" lineNumberTitle=\"{{'component.MessageNotice.lineNumber'|wfLocale}}\" [lineNumberWidth]=\"50\"\r\n        [striped]=\"true\">\r\n      </farris-datagrid>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm px-3 mx-2\" (click)=\"clickCancel()\">{{'component.MessageNotice.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm px-3 mx-2\" (click)=\"clickOK()\">{{'component.MessageNotice.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
MessageNoticeComponent.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BsModalService },
    { type: MessagerService },
    { type: ProcessDesignerUIState },
    { type: ProcessDesignerViewModel },
    { type: HttpService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
MessageNoticeComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    grid: [{ type: ViewChild, args: ['grid',] }]
};
if (false) {
    /** @type {?} */
    MessageNoticeComponent.prototype.cls;
    /** @type {?} */
    MessageNoticeComponent.prototype.closeModal;
    /** @type {?} */
    MessageNoticeComponent.prototype.submitModal;
    /** @type {?} */
    MessageNoticeComponent.prototype.editorParams;
    /** @type {?} */
    MessageNoticeComponent.prototype.modalFooter;
    /** @type {?} */
    MessageNoticeComponent.prototype.grid;
    /** @type {?} */
    MessageNoticeComponent.prototype.modalConfig;
    /** @type {?} */
    MessageNoticeComponent.prototype.messageNotices;
    /** @type {?} */
    MessageNoticeComponent.prototype.columns;
    /** @type {?} */
    MessageNoticeComponent.prototype.location;
    /** @type {?} */
    MessageNoticeComponent.prototype.processSendTime;
    /** @type {?} */
    MessageNoticeComponent.prototype.activitySendTime;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.uistate;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.viewModel;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    MessageNoticeComponent.prototype.localePipe;
}
/** @enum {string} */
const ResourceKeys = {
    batchCopyProperty: 'batchCopyProperty',
};
export { ResourceKeys };
export class MessageNoticeConverter {
    /**
     * @param {?} localePipe
     */
    constructor(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && data.length > 0) {
            return this.localePipe.transform("component.MessageNotice.set");
        }
        else {
            return this.localePipe.transform("component.MessageNotice.notSet");
        }
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    MessageNoticeConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS1ub3RpY2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi1wcm9jZXNzLWVkaXRvci8iLCJzb3VyY2VzIjpbImxpYi92aWV3cy9tZXNzYWdlLW5vdGljZS9tZXNzYWdlLW5vdGljZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFjLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXBOLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUNqRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUNoRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQztBQVdoRyxN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SSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1NBQ2pFO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7U0FDcEU7SUFDSCxDQUFDO0NBQ0Y7Ozs7OztJQVZHLDRDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBIb3N0QmluZGluZywgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIElucHV0LCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEluamVjdG9yLCBFbGVtZW50UmVmLCBDaGFuZ2VEZXRlY3RvclJlZiwgT3B0aW9uYWwsIEluamVjdCwgTE9DQUxFX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFR5cGVDb252ZXJ0ZXIgfSBmcm9tICdAZmFycmlzL2lkZS1wcm9wZXJ0eS1wYW5lbCc7XHJcbmltcG9ydCB7IE1lc3NhZ2VOb3RpY2UgfSBmcm9tICcuL21lc3NhZ2Utbm90aWNlJztcclxuaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IE1lc3NhZ2VOb3RpY2VFZGl0Q29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlLW5vdGljZS1lZGl0L21lc3NhZ2Utbm90aWNlLWVkaXQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkJztcclxuaW1wb3J0IHsgUHJvY2Vzc0RlVXRpbCB9IGZyb20gJy4uLy4uL2RvbWFpbi9wcm9jZXNzLWRlLXV0aWwnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VOb3RpY2VDb3B5Q29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlLW5vdGljZS1jb3B5L21lc3NhZ2Utbm90aWNlLWNvcHkuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUHJvY2Vzc0Rlc2lnbmVyVmlld01vZGVsIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudmlld21vZGVsJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgTWVzc2FnZVJlY2VpdmVyIH0gZnJvbSAnLi9tZXNzYWdlLXJlY2VpdmVyJztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1tZXNzYWdlLW5vdGljZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL21lc3NhZ2Utbm90aWNlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9tZXNzYWdlLW5vdGljZS5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlTm90aWNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZmFycmlzLW1haW4tYXJlYSBmbGV4LWNvbHVtbic7XHJcblxyXG4gIEBPdXRwdXQoKSBjbG9zZU1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHZhbHVlKG5vdGljZXM6IGFueVtdKSB7XHJcbiAgICBpZiAobm90aWNlcyAmJiBub3RpY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5tZXNzYWdlTm90aWNlcyA9IG5vdGljZXMubWFwKG4gPT4gKHtcclxuICAgICAgICBpZDogUHJvY2Vzc0RlVXRpbC5HZW5lcmF0ZUVsZW1lbnRJZCgpLFxyXG4gICAgICAgIGNvbnRlbnQ6IG4uY29udGVudCxcclxuICAgICAgICBzZW5kVGltZTogbi5zZW5kVGltZSxcclxuICAgICAgICBzZW5kVHlwZTogbi5zZW5kVHlwZSxcclxuICAgICAgICBzdWJqZWN0OiBuLnN1YmplY3QsXHJcbiAgICAgICAgcmVjZWl2ZXI6IG4ucmVjZWl2ZXIsXHJcbiAgICAgICAgcmVjZWl2ZXJUZXh0OiBuLnJlY2VpdmVyVGV4dCxcclxuICAgICAgICByZWNlaXZlcnM6IG4ucmVjZWl2ZXJzID8gbi5yZWNlaXZlcnMgOiBuZXcgQXJyYXkoKSxcclxuICAgICAgICBzbXNNZXNzYWdlVGVtcGxhdGU6IG4uc21zTWVzc2FnZVRlbXBsYXRlXHJcbiAgICAgIH0pKTtcclxuICAgIH1cclxuICB9XHJcbiAgQElucHV0KCkgZWRpdG9yUGFyYW1zOiBhbnkgPSB7fTtcclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgQFZpZXdDaGlsZCgnZ3JpZCcpIGdyaWQ6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICBtb2RhbENvbmZpZyA9IHtcclxuICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuTWVzc2FnZU5vdGljZS5ub3RpZnknKSxcclxuICAgIHdpZHRoOiA3NjAsXHJcbiAgICBoZWlnaHQ6IDQ4MCxcclxuICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgfTtcclxuXHJcbiAgbWVzc2FnZU5vdGljZXM6IEFycmF5PE1lc3NhZ2VOb3RpY2U+ID0gbmV3IEFycmF5KCk7XHJcbiAgY29sdW1ucyA9IFtdO1xyXG5cclxuICBsb2NhdGlvbjogJ2FjdGl2aXR5JyB8ICdwcm9jZXNzJyB8ICdtZXNzYWdlQWN0aXZpdHknID0gJ2FjdGl2aXR5JztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB1aXN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSB2aWV3TW9kZWw6IFByb2Nlc3NEZXNpZ25lclZpZXdNb2RlbCxcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cFNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQEluamVjdChXRl9MQU5HX1JFU09VUkNFUykgcHJpdmF0ZSByZXNvdXJjZXM6IGFueSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbG9jYWxlUGlwZTogV2ZMb2NhbGVQaXBlXHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSB0aGlzLmxvY2FsZVBpcGUgfHwgbmV3IFdmTG9jYWxlUGlwZShsb2NhbGVJZCwgcmVzb3VyY2VzKTtcclxuICAgIHRoaXMuR2V0T3JnYW5pemF0aW9uVHlwZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmxvY2F0aW9uID0gdGhpcy5lZGl0b3JQYXJhbXMubG9jYXRpb247XHJcbiAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3N1YmplY3QnLCB3aWR0aDogMTAwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50Lk1lc3NhZ2VOb3RpY2Uuc3ViamVjdCcpLFxyXG4gICAgICB9LCB7XHJcbiAgICAgICAgZmllbGQ6ICdjb250ZW50Jywgd2lkdGg6IDE1MCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLmNvbnRlbnQnKSwgc2hvd1RpcHM6IHRydWUsXHJcbiAgICAgIH0sIHtcclxuICAgICAgICBmaWVsZDogJ3NlbmRUaW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLnNlbmRUaW1lJyksXHJcbiAgICAgICAgZm9ybWF0dGVyOiB7XHJcbiAgICAgICAgICB0eXBlOiAnZW51bScsXHJcbiAgICAgICAgICBvcHRpb25zOiB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ3RleHQnLCBkYXRhOiB0aGlzLmxvY2F0aW9uID09PSAncHJvY2VzcycgPyB0aGlzLnByb2Nlc3NTZW5kVGltZSA6IHRoaXMuYWN0aXZpdHlTZW5kVGltZSB9XHJcbiAgICAgICAgfSxcclxuICAgICAgfSwge1xyXG4gICAgICAgIGZpZWxkOiAnc2VuZFR5cGUnLCB3aWR0aDogMTAwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50Lk1lc3NhZ2VOb3RpY2Uuc2VuZFR5cGUnKSxcclxuICAgICAgICBmb3JtYXR0ZXI6IHtcclxuICAgICAgICAgIHR5cGU6ICdlbnVtJyxcclxuICAgICAgICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAnbmFtZScsIGRhdGE6IHRoaXMudWlzdGF0ZS5tZXNzYWdlQ2hhbm5lbHMubWFwKG0gPT4gKHsgdmFsdWU6IG0uY29kZSwgbmFtZTogbS5uYW1lIH0pKSB9XHJcbiAgICAgICAgfSxcclxuICAgICAgfSwge1xyXG4gICAgICAgIGZpZWxkOiAncmVjZWl2ZXJUZXh0Jywgd2lkdGg6IDEyMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLnJlY2VpdmVyVGV4dCcpLCBzaG93VGlwczogdHJ1ZSwgZm9ybWF0dGVyOiAodiwgZCwgaSkgPT4ge1xyXG4gICAgICAgICAgbGV0IHJlY2VpdmVyVGV4dCA9ICcnO1xyXG4gICAgICAgICAgaWYgKGQucmVjZWl2ZXJzICYmIGQucmVjZWl2ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCByZWNlaXZlciBvZiBkLnJlY2VpdmVycykge1xyXG4gICAgICAgICAgICAgIGlmIChyZWNlaXZlci50eXBlID09PSAncHJvY2Vzc1BhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlY2VpdmVyLnByb2Nlc3NQYXJ0aWNpcGFudCA9PT0gJ3Byb2NJbnN0Q3JlYXRvcicpIHtcclxuICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJUZXh0ICs9IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLnByb2NJbnN0Q3JlYXRvcicpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlci5wcm9jZXNzUGFydGljaXBhbnQgPT09ICd3b3JrSXRlbVBhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgICByZWNlaXZlclRleHQgKz0gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50Lk1lc3NhZ2VOb3RpY2Uud29ya0l0ZW1QYXJ0aWNpcGFudCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlci5wcm9jZXNzUGFydGljaXBhbnQgPT09ICdhY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJlY2VpdmVyVGV4dCArPSAocmVjZWl2ZXIuYWN0aXZpdHlEZWZOYW1lICsgJ++8jCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjZWl2ZXIudHlwZSA9PT0gJ3VzZXJQYXJ0aWNpcGFudCcpIHtcclxuICAgICAgICAgICAgICAgIHJlY2VpdmVyVGV4dCArPSAocmVjZWl2ZXIudXNlck5hbWVzICsgJ++8jCcpO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjZWl2ZXIudHlwZSA9PT0gJ3ZhcmlhYmxlUGFydGljaXBhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICByZWNlaXZlclRleHQgKz0gKHJlY2VpdmVyLnZhcmlhYmxlTmFtZSArICfvvIwnKTtcclxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlY2VpdmVyLnR5cGUgPT09ICdwb3NpdGlvblBhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgcmVjZWl2ZXJUZXh0ICs9IChyZWNlaXZlci5wb3NpdGlvbk5hbWUgKyAn77yMJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAocmVjZWl2ZXJUZXh0KSB7XHJcbiAgICAgICAgICAgIHJlY2VpdmVyVGV4dCA9IHJlY2VpdmVyVGV4dC5zdWJzdHJpbmcoMCwgcmVjZWl2ZXJUZXh0Lmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHJlY2VpdmVyVGV4dDtcclxuICAgICAgICB9LFxyXG4gICAgICB9XTtcclxuICAgIGlmICh0aGlzLmxvY2F0aW9uID09PSAnbWVzc2FnZUFjdGl2aXR5Jykge1xyXG4gICAgICB0aGlzLmNvbHVtbnMgPSB0aGlzLmNvbHVtbnMuZmlsdGVyKGMgPT4gYy5maWVsZCAhPT0gJ3NlbmRUaW1lJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhZGQoKSB7XHJcbiAgICBsZXQgZGlhbG9nOiBhbnk7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTWVzc2FnZU5vdGljZUVkaXRDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UubG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uO1xyXG4gICAgY29uc3QgbWVzc2FnZU5vdGljZSA9IG5ldyBNZXNzYWdlTm90aWNlKCk7XHJcbiAgICBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ2FjdGl2aXR5Jykge1xyXG4gICAgICBtZXNzYWdlTm90aWNlLnNlbmRUaW1lID0gJ1dPUktJVEVNX0NSRUFURUQnO1xyXG4gICAgICBjb25zdCBtZXNzYWdlUmVjZWl2ZXIgPSBuZXcgTWVzc2FnZVJlY2VpdmVyKCk7XHJcbiAgICAgIG1lc3NhZ2VSZWNlaXZlci50eXBlID0gJ3Byb2Nlc3NQYXJ0aWNpcGFudCc7XHJcbiAgICAgIG1lc3NhZ2VSZWNlaXZlci5wcm9jZXNzUGFydGljaXBhbnQgPSAnd29ya0l0ZW1QYXJ0aWNpcGFudCc7XHJcbiAgICAgIG1lc3NhZ2VOb3RpY2UucmVjZWl2ZXJzID0gW21lc3NhZ2VSZWNlaXZlcl07XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMubG9jYXRpb24gPT09ICdwcm9jZXNzJykge1xyXG4gICAgICBtZXNzYWdlTm90aWNlLnNlbmRUaW1lID0gJ1BST0NFU1NJTlNUQU5DRV9DT01QTEVURUQnO1xyXG4gICAgICBjb25zdCBtZXNzYWdlUmVjZWl2ZXIgPSBuZXcgTWVzc2FnZVJlY2VpdmVyKCk7XHJcbiAgICAgIG1lc3NhZ2VSZWNlaXZlci50eXBlID0gJ3Byb2Nlc3NQYXJ0aWNpcGFudCc7XHJcbiAgICAgIG1lc3NhZ2VSZWNlaXZlci5wcm9jZXNzUGFydGljaXBhbnQgPSAncHJvY0luc3RDcmVhdG9yJztcclxuICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlcnMgPSBbbWVzc2FnZVJlY2VpdmVyXTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5sb2NhdGlvbiA9PT0gJ21lc3NhZ2VBY3Rpdml0eScpIHtcclxuICAgICAgY29uc3QgbWVzc2FnZVJlY2VpdmVyID0gbmV3IE1lc3NhZ2VSZWNlaXZlcigpO1xyXG4gICAgICBtZXNzYWdlUmVjZWl2ZXIudHlwZSA9ICdwcm9jZXNzUGFydGljaXBhbnQnO1xyXG4gICAgICBtZXNzYWdlUmVjZWl2ZXIucHJvY2Vzc1BhcnRpY2lwYW50ID0gJ3Byb2NJbnN0Q3JlYXRvcic7XHJcbiAgICAgIG1lc3NhZ2VOb3RpY2UucmVjZWl2ZXJzID0gW21lc3NhZ2VSZWNlaXZlcl07XHJcbiAgICB9XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhbHVlID0gbWVzc2FnZU5vdGljZTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc3VibWl0RW1pdHRlci5zdWJzY3JpYmUoKHJlOiBNZXNzYWdlTm90aWNlKSA9PiB7XHJcbiAgICAgIHRoaXMubWVzc2FnZU5vdGljZXMgPSB0aGlzLm1lc3NhZ2VOb3RpY2VzLmNvbmNhdChbcmVdKTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VFbWl0dGVyLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLm1lc3NhZ2VTZXQnKSxcclxuICAgICAgd2lkdGg6IDc2MCxcclxuICAgICAgaGVpZ2h0OiA0ODAsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmZvb3RlclxyXG4gICAgfTtcclxuICAgIGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gIH1cclxuICBlZGl0KCkge1xyXG4gICAgaWYgKCF0aGlzLmdyaWQuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50Lk1lc3NhZ2VOb3RpY2Uuc2VsZWN0ZWRSb3cnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBkaWFsb2c6IGFueTtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShNZXNzYWdlTm90aWNlRWRpdENvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5sb2NhdGlvbiA9IHRoaXMubG9jYXRpb247XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnZhbHVlID0gdGhpcy5ncmlkLnNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLnN1Ym1pdEVtaXR0ZXIuc3Vic2NyaWJlKChyZTogTWVzc2FnZU5vdGljZSkgPT4ge1xyXG4gICAgICB0aGlzLm1lc3NhZ2VOb3RpY2VzID0gdGhpcy5tZXNzYWdlTm90aWNlcy5tYXAobSA9PiB7XHJcbiAgICAgICAgaWYgKG0uaWQgPT09IHJlLmlkKSB7XHJcbiAgICAgICAgICByZXR1cm4gcmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5ncmlkLnVuU2VsZWN0Um93KHRoaXMuZ3JpZC5zZWxlY3RlZFJvdy5kYXRhLmlkLCB0cnVlKTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VFbWl0dGVyLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLm1lc3NhZ2VTZXQnKSxcclxuICAgICAgd2lkdGg6IDc2MCxcclxuICAgICAgaGVpZ2h0OiA0ODAsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmZvb3RlclxyXG4gICAgfTtcclxuICAgIGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gIH1cclxuICBiYXRjaENvcHkoKSB7XHJcbiAgICBpZiAoIXRoaXMubWVzc2FnZU5vdGljZXMpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50Lk1lc3NhZ2VOb3RpY2Uubm9Db3B5JykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgZGlhbG9nOiBhbnk7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoTWVzc2FnZU5vdGljZUNvcHlDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UubWVzc2FnZU5vdGljZXMgPSB0aGlzLm1lc3NhZ2VOb3RpY2VzO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXRFbWl0dGVyLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgIHRoaXMudmlld01vZGVsLmNvcHkoUmVzb3VyY2VLZXlzLmJhdGNoQ29weVByb3BlcnR5LCBkYXRhKTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2xvc2VFbWl0dGVyLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLmJhdGNoQ29weScpLFxyXG4gICAgICB3aWR0aDogODAwLFxyXG4gICAgICBoZWlnaHQ6IDUxNSxcclxuICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgIGJ1dHRvbnM6IGNvbXBSZWYuaW5zdGFuY2UubW9kYWxGb290ZXJcclxuICAgIH07XHJcbiAgICBkaWFsb2cgPSB0aGlzLm1vZGFsU2VydmljZS5zaG93KGNvbXBSZWYsIG1vZGFsQ29uZmlnKTtcclxuICB9XHJcbiAgZGVsZXRlKCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLmdyaWQuc2VsZWN0ZWRSb3c7XHJcbiAgICBpZiAoIXNlbGVjdGVkKSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5pbmZvKHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLnNlbGVjdGVkUm93JykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLm1lc3NhZ2VOb3RpY2VzID0gdGhpcy5tZXNzYWdlTm90aWNlcy5maWx0ZXIobSA9PiBtLmlkICE9PSBzZWxlY3RlZC5pZCk7XHJcbiAgfVxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICBjb25zdCBvYmplY3QgPSB7IHZhbHVlOiB0aGlzLm1lc3NhZ2VOb3RpY2VzLCBwYXJhbWV0ZXJzOiBudWxsIH07XHJcbiAgICB0aGlzLnN1Ym1pdE1vZGFsLmVtaXQob2JqZWN0KTtcclxuICB9XHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBHZXRPcmdhbml6YXRpb25UeXBlKCkge1xyXG4gICAgY29uc3QgdXJsID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9hdXRoZmllbGRzL2dsb2JhbGF1dGhmaWVsZHMnO1xyXG4gICAgdGhpcy5odHRwLmdldCh1cmwpXHJcbiAgICAgIC5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4gdGhpcy51aXN0YXRlLm9yZ1R5cGVDb2xsZWN0aW9uID0gZGF0YS5tYXAoZCA9PiAoeyB2YWx1ZTogZC5pZCwgdGV4dDogZC5uYW1lIH0pKSk7XHJcbiAgfVxyXG5cclxuICBwcm9jZXNzU2VuZFRpbWUgPSBbXHJcbiAgICB7IHZhbHVlOiAnUFJPQ0VTU0lOU1RBTkNFX0NPTVBMRVRFRCcsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLnByb2NDb21wbGV0ZScpIH0sXHJcbiAgICB7IHZhbHVlOiAnUFJPQ0VTU0lOU1RBTkNFX0FCT1JURUQnLCB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuTWVzc2FnZU5vdGljZS5wcm9jQWJvcnRlZCcpIH0sXHJcbiAgICB7IHZhbHVlOiAnUFJPQ0VTU0lOU1RBTkNFX1JPTExCQUNLJywgdGV4dDogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50Lk1lc3NhZ2VOb3RpY2UucHJvY1JvbGxCYWNrJykgfVxyXG4gIF07XHJcblxyXG4gIGFjdGl2aXR5U2VuZFRpbWUgPSBbXHJcbiAgICB7IHZhbHVlOiAnV09SS0lURU1fQ1JFQVRFRCcsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLndvcmtDcmVhdGVkJykgfSxcclxuICAgIHsgdmFsdWU6ICdBQ1RJVklUWV9DT01QTEVURUQnLCB0ZXh0OiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuTWVzc2FnZU5vdGljZS5hY3RDb21wbGV0ZScpIH0sXHJcbiAgICB7IHZhbHVlOiAnQUNUSVZJVFlfQUJPUlRFRCcsIHRleHQ6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5NZXNzYWdlTm90aWNlLmFjdEFib3J0ZWQnKSB9LFxyXG4gIF07XHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIFJlc291cmNlS2V5cyB7XHJcbiAgYmF0Y2hDb3B5UHJvcGVydHkgPSAnYmF0Y2hDb3B5UHJvcGVydHknXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlTm90aWNlQ29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZVxyXG4gICkgeyB9XHJcblxyXG4gIGNvbnZlcnRUbyhkYXRhOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmV0dXJuIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oXCJjb21wb25lbnQuTWVzc2FnZU5vdGljZS5zZXRcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybShcImNvbXBvbmVudC5NZXNzYWdlTm90aWNlLm5vdFNldFwiKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
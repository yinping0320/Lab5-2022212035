/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, HostBinding, Output, EventEmitter, Input, ViewChild, TemplateRef, ElementRef, ComponentFactoryResolver, Injector, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { of } from 'rxjs/observable/of';
import { FormBuilder } from '@angular/forms';
import { ExecuteFormsUIState } from './execute-forms.uistate';
import { ExecuteFormsViewModel } from './execute-forms.viewmodel';
import { ExecuteFormsRepository } from './execute-forms.repository';
import { ExecuteFormModel, ActualParameter } from './entities/execute-form.entity';
import { BsModalService } from '@farris/ui-modal';
import { AddExecuteFormComponent } from './add-execute-form/add-execute-form.component';
import { FormConfigContainerComponent } from './form-config-container/form-config-container.component';
import { ParameterSettingComponent } from './parameter-setting/parameter-setting.component';
import { switchMap } from 'rxjs/operators';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { MessagerService } from '@farris/ui-messager';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class ExecuteFormsComponent {
    // *******************************************************
    /**
     * @param {?} formBuilder
     * @param {?} uistate
     * @param {?} viewmodel
     * @param {?} resolver
     * @param {?} injector
     * @param {?} modalService
     * @param {?} designerState
     * @param {?} message
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(formBuilder, uistate, viewmodel, resolver, injector, modalService, designerState, message, cdr, localeId, resources, localePipe) {
        this.formBuilder = formBuilder;
        this.uistate = uistate;
        this.viewmodel = viewmodel;
        this.resolver = resolver;
        this.injector = injector;
        this.modalService = modalService;
        this.designerState = designerState;
        this.message = message;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.modalConfig = {
            title: this.localePipe.transform('component.executeForms.executeForms'),
            width: 760,
            height: 532,
            showButtons: true
        };
        this.cls = 'farris-main-area flex-column';
        this.style = '#FFF';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.tab = 'web';
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.cols = [];
        this.showMethodTab = true;
        this.allParameters = new Array();
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
        this.form = new ExecuteFormModel();
        this.allParameters = this.getVariableList();
    }
    /**
     * @param {?} item
     * @return {?}
     */
    set value(item) {
        if (item) {
            /** @type {?} */
            const paramArray = new Array();
            item.ActualParameters.forEach((/**
             * @param {?} a
             * @return {?}
             */
            a => {
                /** @type {?} */
                const para = new ActualParameter();
                para.Name = a.Name;
                para.Tag = a.Tag ? a.Tag : this.initVariableType(a.Value);
                para.Value = a.Value;
                paramArray.push(para);
            }));
            this.form.ActualParameters = paramArray;
            this.form.Id = item.Id;
            this.form.Name = item.Name;
            this.form.ComponentId = item.ComponentId;
            this.form.formFormatId = item.formFormatId;
            this.form.formatConfigId = item.formatConfigId;
            this.form.FormType = item.FormType;
            this.form.TerminalType = item.TerminalType;
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.location = this.editorParams.location;
        this.tab = this.editorParams.tab;
        if (this.location === 'userActivity') {
            this.showMethodTab = true;
        }
        else {
            this.showMethodTab = false;
        }
    }
    /**
     * @return {?}
     */
    clickOK() {
        /** @type {?} */
        let data = new ExecuteFormModel();
        this.getForm().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            if (!re.result) {
                return;
            }
            data = re.form;
            if (this.validator(data)) {
                /** @type {?} */
                let parameters = null;
                // 如果存在变量类型参数在流程变量上不存在，需要同步流程变量
                if (data && data.ActualParameters && data.ActualParameters.length > 0) {
                    /** @type {?} */
                    const formalParameters = this.designerState.flowFormInfo.formalParameters.filter((/**
                     * @param {?} p
                     * @return {?}
                     */
                    p => p.dataType !== 'CDTSchema'));
                    for (const parameter of data.ActualParameters) {
                        if (parameter.Tag === 'variable' && parameter.Value && !this.allParameters.some((/**
                         * @param {?} p
                         * @return {?}
                         */
                        p => p.key === parameter.Value)) && formalParameters.some((/**
                         * @param {?} p
                         * @return {?}
                         */
                        p => p.code === parameter.Value))) {
                            parameters = formalParameters;
                            break;
                        }
                    }
                }
                /** @type {?} */
                const object = { value: data, parameters };
                this.submitModal.emit(object);
            }
        }));
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @param {?} form
     * @return {?}
     */
    validator(form) {
        if (form && form.ActualParameters && form.ActualParameters.length > 0) {
            /** @type {?} */
            const formalParameters = this.designerState.flowFormInfo.formalParameters.filter((/**
             * @param {?} p
             * @return {?}
             */
            p => p.dataType !== 'CDTSchema'));
            for (const parameter of form.ActualParameters) {
                if (parameter.Tag === 'variable' && parameter.Value && !this.allParameters.some((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => p.key === parameter.Value)) && !formalParameters.some((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => p.code === parameter.Value))) {
                    this.message.error(this.localePipe.transform('component.executeForms.parameters') + parameter.Name + this.localePipe.transform('component.executeForms.typeAsvariable'));
                    return false;
                }
            }
        }
        return true;
    }
    // tabChange(data) {
    //   this.tab = data.nextId;
    // }
    // editCSS() {
    //   this.configSection.nativeElement.querySelector('div.f-section-header').classList.add('mb-0');
    // }
    /**
     * @private
     * @return {?}
     */
    getForm() {
        if (this.form.ComponentId) {
            return of({ result: true, form: this.form });
        }
        else if (this.form.formFormatId) {
            return this.configContainer.submit().pipe(switchMap((/**
             * @param {?} re
             * @return {?}
             */
            (re) => {
                if (re.result) {
                    this.form.formatConfigId = re.configId;
                    return of({ result: true, form: this.form });
                }
                else {
                    return of({ result: false, form: this.form });
                }
            })));
        }
        else {
            return of({ result: true, form: null });
        }
    }
    /**
     * 参数设置
     * @return {?}
     */
    parametersSet() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ParameterSettingComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.mode = 'bpmn';
        compRef.instance.allParameters = this.allParameters;
        if (this.tab === 'web') {
            if (this.form.ComponentId) {
                compRef.instance.showFormType = true;
                compRef.instance.formType = this.form.FormType;
            }
            compRef.instance.parameters = [...this.form.ActualParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => Object.assign({}, p)))];
        }
        else {
            compRef.instance.parameters = [...this.form.ActualParameters.map((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => Object.assign({}, p)))];
        }
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform('component.executeForms.parameterSettings'),
            width: 620,
            height: 400,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.submit.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            if (this.tab === 'web') {
                this.form.ActualParameters = re.parameters;
                this.form.FormType = re.formType;
            }
            else {
                this.form.ActualParameters = re.parameters;
            }
            dialog.close();
        }));
        compRef.instance.cancel.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
    }
    /**
     * 选择表单定义
     * @return {?}
     */
    selectExecuteForm() {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(AddExecuteFormComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.tab = this.tab;
        /** @type {?} */
        const modalConfig = {
            title: this.localePipe.transform('component.executeForms.formDefinitionList'),
            width: 650,
            height: 400,
            showButtons: true,
            buttons: compRef.instance.modalFooter
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.submit.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            this.form = re;
            dialog.close();
        }));
        compRef.instance.cancel.subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
        }));
    }
    /**
     * @return {?}
     */
    clear() {
        this.form = new ExecuteFormModel();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    initVariableType(value) {
        if (value) {
            if (value.length >= 8 && value.slice(0, 8) === `{"expr":`) {
                return 'expression';
            }
            else {
                return 'constant';
            }
        }
        else {
            return 'variable';
        }
    }
    /**
     * @private
     * @return {?}
     */
    getVariableList() {
        /** @type {?} */
        const context = new Array();
        if (this.designerState.procInstContext.length > 0) {
            for (const variable of this.designerState.procInstContext) {
                context.push(variable);
            }
        }
        if (this.designerState.subActivityContext.length > 0) {
            for (const variable of this.designerState.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerState.formalParameterContext.length > 0) {
            for (const variable of this.designerState.formalParameterContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerState.participantContext.length > 0) {
            for (const variable of this.designerState.participantContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerState.processVariableContext.length > 0) {
            for (const variable of this.designerState.processVariableContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        return context;
    }
}
ExecuteFormsComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-execute-forms',
                template: "\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">{{'component.executeForms.clickCancel'|wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">{{'component.executeForms.clickOK'|wfLocale}}</button>\r\n</ng-template>\r\n\r\n<ng-template #empty>\r\n  <div class=\"f-utils-fill-flex-column h-100\">\r\n    <div class=\"f-datagrid-norecords\" style=\"height: 100%;\">\r\n      <div class=\"f-datagrid-norecords-content w-100\">{{'component.executeForms.noForm'|wfLocale}}</div>\r\n    </div>\r\n  </div>\r\n</ng-template>\r\n\r\n<div class=\"f-page f-page-is-managelist\">\r\n  <div class=\"f-page-main mx-3\" style=\"border-radius:16px;border: 1.5px solid #F1F3F7;\">\r\n    <div class=\"farris-form farris-form-controls-inline farris-form-auto f-form-lable-auto\">\r\n      <div class=\"f-section-formgroup-inputs\">\r\n        <div class=\"col-12 col-md-5 px-0 my-2\" style=\"margin-left: 50px;\">\r\n          <div class=\"farris-group-wrap\">\r\n            <div class=\"form-group farris-form-group mb-0\">\r\n              <label class=\"col-form-label\">\r\n                <span class=\"farris-label-text\">{{'component.executeForms.form'|wfLocale}}</span>\r\n              </label>\r\n              <input-group class=\"form-control\" style=\"width: 100%;padding:0;border:0;\" [enableClear]=\"true\"\r\n                [showButtonWhenDisabled]=\"false\" [(ngModel)]=\"form.Name\" name=\"form\" placeholder=\"{{'component.executeForms.placeholder'|wfLocale}}\"\r\n                [editable]=\"false\" (clickHandle)=\"selectExecuteForm()\" (clear)=\"clear()\" [groupText]=\"groupIcon\">\r\n              </input-group>\r\n              <div class=\"farris-feedback valid-feedback\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-12 col-md-2 my-2 px-0\">\r\n          <div class=\"farris-group-wrap\" style=\"padding-top: 2px;\">\r\n            <div class=\"form-group farris-form-group mb-0\">\r\n              <div class=\"farris-input-wrap\">\r\n                <farris-button [disabled]=\"!form.ComponentId && !form.formFormatId\" [type]=\"'link'\" (click)=\"parametersSet()\">\r\n                  {{'component.executeForms.parametersSet'|wfLocale}}\r\n                </farris-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"h-100 mx-3\">\r\n    <lib-form-config-container #configContainer\r\n      [formFormatId]=\"form.formFormatId\" [formatConfigId]=\"form.formatConfigId\" [showMethodTab]=\"showMethodTab\"\r\n      class=\"h-100\"></lib-form-config-container>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n\r\n\r\n",
                providers: [
                    ExecuteFormsUIState, ExecuteFormsViewModel, ExecuteFormsRepository,
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
ExecuteFormsComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: ExecuteFormsUIState },
    { type: ExecuteFormsViewModel },
    { type: ComponentFactoryResolver },
    { type: Injector },
    { type: BsModalService },
    { type: ProcessDesignerUIState },
    { type: MessagerService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
ExecuteFormsComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    style: [{ type: HostBinding, args: ['style.background',] }],
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    editorParams: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    configContainer: [{ type: ViewChild, args: ['configContainer',] }],
    configSection: [{ type: ViewChild, args: ['configSection', { read: ElementRef },] }]
};
if (false) {
    /** @type {?} */
    ExecuteFormsComponent.prototype.modalConfig;
    /** @type {?} */
    ExecuteFormsComponent.prototype.cls;
    /** @type {?} */
    ExecuteFormsComponent.prototype.style;
    /** @type {?} */
    ExecuteFormsComponent.prototype.closeModal;
    /** @type {?} */
    ExecuteFormsComponent.prototype.submitModal;
    /** @type {?} */
    ExecuteFormsComponent.prototype.editorParams;
    /** @type {?} */
    ExecuteFormsComponent.prototype.modalFooter;
    /** @type {?} */
    ExecuteFormsComponent.prototype.configContainer;
    /** @type {?} */
    ExecuteFormsComponent.prototype.configSection;
    /** @type {?} */
    ExecuteFormsComponent.prototype.form;
    /** @type {?} */
    ExecuteFormsComponent.prototype.tab;
    /** @type {?} */
    ExecuteFormsComponent.prototype.groupIcon;
    /** @type {?} */
    ExecuteFormsComponent.prototype.cols;
    /** @type {?} */
    ExecuteFormsComponent.prototype.location;
    /** @type {?} */
    ExecuteFormsComponent.prototype.showMethodTab;
    /** @type {?} */
    ExecuteFormsComponent.prototype.allParameters;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.formBuilder;
    /** @type {?} */
    ExecuteFormsComponent.prototype.uistate;
    /** @type {?} */
    ExecuteFormsComponent.prototype.viewmodel;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.designerState;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsComponent.prototype.localePipe;
}
export class ExecuteFormsConverter {
    /**
     * @param {?} params
     * @param {?} localePipe
     */
    constructor(params, localePipe) {
        this.localePipe = localePipe;
        this.params = params;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data) {
            return data.Name;
        }
        else {
            if (this.params.location === 'process') {
                return this.localePipe.transform('component.executeForms.notSet');
            }
            else {
                return this.localePipe.transform('component.executeForms.default');
            }
        }
    }
}
if (false) {
    /** @type {?} */
    ExecuteFormsConverter.prototype.params;
    /**
     * @type {?}
     * @private
     */
    ExecuteFormsConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhlY3V0ZS1mb3Jtcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2V4ZWN1dGUtZm9ybXMvZXhlY3V0ZS1mb3Jtcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLHdCQUF3QixFQUFFLFFBQVEsRUFBbUMsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFclAsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQWdCLGVBQWUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwrQ0FBK0MsQ0FBQztBQUN4RixPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUN2RyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpREFBaUQsQ0FBQztBQUU1RixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0NBQW9D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UUFBeEIsZUFBVSxHQUFWLFVBQVUsQ0FBYztRQUVoQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDOzs7OztJQUNELFNBQVMsQ0FBQyxJQUFJO1FBQ1osSUFBSSxJQUFJLEVBQUU7WUFDUixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDbEI7YUFBTTtZQUNMLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEtBQUssU0FBUyxFQUFFO2dCQUN0QyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLCtCQUErQixDQUFDLENBQUM7YUFDbkU7aUJBQU07Z0JBQ0wsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO2FBQ3BFO1NBQ0Y7SUFDSCxDQUFDO0NBQ0Y7OztJQWxCQyx1Q0FBWTs7Ozs7SUFHViwyQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgRWxlbWVudFJlZiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBJbmplY3RvciwgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE9wdGlvbmFsLCBJbmplY3QsIExPQ0FMRV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUeXBlQ29udmVydGVyIH0gZnJvbSAnQGZhcnJpcy9pZGUtcHJvcGVydHktcGFuZWwnO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMvb2JzZXJ2YWJsZS9vZic7XHJcbmltcG9ydCB7IEZvcm1CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBFeGVjdXRlRm9ybXNVSVN0YXRlIH0gZnJvbSAnLi9leGVjdXRlLWZvcm1zLnVpc3RhdGUnO1xyXG5pbXBvcnQgeyBFeGVjdXRlRm9ybXNWaWV3TW9kZWwgfSBmcm9tICcuL2V4ZWN1dGUtZm9ybXMudmlld21vZGVsJztcclxuaW1wb3J0IHsgRXhlY3V0ZUZvcm1zUmVwb3NpdG9yeSB9IGZyb20gJy4vZXhlY3V0ZS1mb3Jtcy5yZXBvc2l0b3J5JztcclxuaW1wb3J0IHsgRXhlY3V0ZUZvcm1Nb2RlbCwgVGVybWluYWxUeXBlLCBBY3R1YWxQYXJhbWV0ZXIgfSBmcm9tICcuL2VudGl0aWVzL2V4ZWN1dGUtZm9ybS5lbnRpdHknO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBBZGRFeGVjdXRlRm9ybUNvbXBvbmVudCB9IGZyb20gJy4vYWRkLWV4ZWN1dGUtZm9ybS9hZGQtZXhlY3V0ZS1mb3JtLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEZvcm1Db25maWdDb250YWluZXJDb21wb25lbnQgfSBmcm9tICcuL2Zvcm0tY29uZmlnLWNvbnRhaW5lci9mb3JtLWNvbmZpZy1jb250YWluZXIuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUGFyYW1ldGVyU2V0dGluZ0NvbXBvbmVudCB9IGZyb20gJy4vcGFyYW1ldGVyLXNldHRpbmcvcGFyYW1ldGVyLXNldHRpbmcuY29tcG9uZW50JztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgZm9ya0pvaW4gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBXRl9MQU5HX1JFU09VUkNFUywgV2ZMb2NhbGVQaXBlIH0gZnJvbSAnLi4vLi4vaTE4bi9waXBlL3dmLXByb2Nlc3MtZWRpdG9yLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgV0ZfUFJPQ0VTU19FRElUT1JfTEFOR19SRVNPVVJDRVMgfSBmcm9tICcuLi8uLi9pMThuL2Fzc2V0cy9sYW5nLnJlc291cmNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXBwLWV4ZWN1dGUtZm9ybXMnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9leGVjdXRlLWZvcm1zLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9leGVjdXRlLWZvcm1zLmNvbXBvbmVudC5jc3MnXSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgIEV4ZWN1dGVGb3Jtc1VJU3RhdGUsIEV4ZWN1dGVGb3Jtc1ZpZXdNb2RlbCwgRXhlY3V0ZUZvcm1zUmVwb3NpdG9yeSxcclxuICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBFeGVjdXRlRm9ybXNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xyXG4gIG1vZGFsQ29uZmlnID0ge1xyXG4gICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5leGVjdXRlRm9ybXMuZXhlY3V0ZUZvcm1zJyksXHJcbiAgICB3aWR0aDogNzYwLFxyXG4gICAgaGVpZ2h0OiA1MzIsXHJcbiAgICBzaG93QnV0dG9uczogdHJ1ZVxyXG4gIH07XHJcblxyXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxyXG4gIGNscyA9ICdmYXJyaXMtbWFpbi1hcmVhIGZsZXgtY29sdW1uJztcclxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLmJhY2tncm91bmQnKSBzdHlsZSA9ICcjRkZGJztcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHNldCB2YWx1ZShpdGVtOiBFeGVjdXRlRm9ybU1vZGVsKSB7XHJcbiAgICBpZiAoaXRlbSkge1xyXG4gICAgICBjb25zdCBwYXJhbUFycmF5ID0gbmV3IEFycmF5PEFjdHVhbFBhcmFtZXRlcj4oKTtcclxuICAgICAgaXRlbS5BY3R1YWxQYXJhbWV0ZXJzLmZvckVhY2goYSA9PiB7XHJcbiAgICAgICAgY29uc3QgcGFyYSA9IG5ldyBBY3R1YWxQYXJhbWV0ZXIoKTtcclxuICAgICAgICBwYXJhLk5hbWUgPSBhLk5hbWU7XHJcbiAgICAgICAgcGFyYS5UYWcgPSBhLlRhZyA/IGEuVGFnIDogdGhpcy5pbml0VmFyaWFibGVUeXBlKGEuVmFsdWUpO1xyXG4gICAgICAgIHBhcmEuVmFsdWUgPSBhLlZhbHVlO1xyXG4gICAgICAgIHBhcmFtQXJyYXkucHVzaChwYXJhKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuZm9ybS5BY3R1YWxQYXJhbWV0ZXJzID0gcGFyYW1BcnJheTtcclxuICAgICAgdGhpcy5mb3JtLklkID0gaXRlbS5JZDtcclxuICAgICAgdGhpcy5mb3JtLk5hbWUgPSBpdGVtLk5hbWU7XHJcbiAgICAgIHRoaXMuZm9ybS5Db21wb25lbnRJZCA9IGl0ZW0uQ29tcG9uZW50SWQ7XHJcbiAgICAgIHRoaXMuZm9ybS5mb3JtRm9ybWF0SWQgPSBpdGVtLmZvcm1Gb3JtYXRJZDtcclxuICAgICAgdGhpcy5mb3JtLmZvcm1hdENvbmZpZ0lkID0gaXRlbS5mb3JtYXRDb25maWdJZDtcclxuICAgICAgdGhpcy5mb3JtLkZvcm1UeXBlID0gaXRlbS5Gb3JtVHlwZTtcclxuICAgICAgdGhpcy5mb3JtLlRlcm1pbmFsVHlwZSA9IGl0ZW0uVGVybWluYWxUeXBlO1xyXG4gICAgfVxyXG4gIH1cclxuICBASW5wdXQoKSBlZGl0b3JQYXJhbXM6IGFueSA9IHt9O1xyXG4gIEBWaWV3Q2hpbGQoJ2ljb25TZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICBAVmlld0NoaWxkKCdjb25maWdDb250YWluZXInKSBjb25maWdDb250YWluZXI6IEZvcm1Db25maWdDb250YWluZXJDb21wb25lbnQ7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2NvbmZpZ1NlY3Rpb24nLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgY29uZmlnU2VjdGlvbjogRWxlbWVudFJlZjxhbnk+O1xyXG5cclxuICBmb3JtOiBFeGVjdXRlRm9ybU1vZGVsO1xyXG5cclxuICB0YWI6ICd3ZWInIHwgJ21vYmlsZScgPSAnd2ViJztcclxuXHJcbiAgZ3JvdXBJY29uID0gJzxpIGNsYXNzPVwiZi1pY29uIGYtaWNvbi1sb29rdXBcIj48L2k+JztcclxuXHJcbiAgY29scyA9IFtdO1xyXG5cclxuICBsb2NhdGlvbjogJ3VzZXJBY3Rpdml0eScgfCAncHJvY2VzcycgfCAnc3RhcnRBY3Rpdml0eSc7XHJcblxyXG4gIHNob3dNZXRob2RUYWIgPSB0cnVlO1xyXG5cclxuICBhbGxQYXJhbWV0ZXJzID0gbmV3IEFycmF5KCk7XHJcblxyXG4gIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxyXG4gICAgcHVibGljIHVpc3RhdGU6IEV4ZWN1dGVGb3Jtc1VJU3RhdGUsXHJcbiAgICBwdWJsaWMgdmlld21vZGVsOiBFeGVjdXRlRm9ybXNWaWV3TW9kZWwsXHJcbiAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgZGVzaWduZXJTdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSxcclxuICAgIHByaXZhdGUgbWVzc2FnZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxyXG4gICAgQEluamVjdChMT0NBTEVfSUQpIHByaXZhdGUgbG9jYWxlSWQ6IHN0cmluZyxcclxuICAgIEBJbmplY3QoV0ZfTEFOR19SRVNPVVJDRVMpIHByaXZhdGUgcmVzb3VyY2VzOiBhbnksXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZSxcclxuICApIHtcclxuICAgIHRoaXMubG9jYWxlUGlwZSA9IHRoaXMubG9jYWxlUGlwZSB8fCBuZXcgV2ZMb2NhbGVQaXBlKGxvY2FsZUlkLCByZXNvdXJjZXMpO1xyXG4gICAgdGhpcy5mb3JtID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAgIHRoaXMuYWxsUGFyYW1ldGVycyA9IHRoaXMuZ2V0VmFyaWFibGVMaXN0KCk7XHJcbiAgfVxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuXHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMubG9jYXRpb24gPSB0aGlzLmVkaXRvclBhcmFtcy5sb2NhdGlvbjtcclxuICAgIHRoaXMudGFiID0gdGhpcy5lZGl0b3JQYXJhbXMudGFiO1xyXG4gICAgaWYgKHRoaXMubG9jYXRpb24gPT09ICd1c2VyQWN0aXZpdHknKSB7XHJcbiAgICAgIHRoaXMuc2hvd01ldGhvZFRhYiA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNob3dNZXRob2RUYWIgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbiAgY2xpY2tPSygpIHtcclxuICAgIGxldCBkYXRhID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAgIHRoaXMuZ2V0Rm9ybSgpLnN1YnNjcmliZSgocmU6IGFueSkgPT4ge1xyXG4gICAgICBpZiAoIXJlLnJlc3VsdCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBkYXRhID0gcmUuZm9ybTtcclxuICAgICAgaWYgKHRoaXMudmFsaWRhdG9yKGRhdGEpKSB7XHJcbiAgICAgICAgbGV0IHBhcmFtZXRlcnMgPSBudWxsO1xyXG4gICAgICAgIC8vIOWmguaenOWtmOWcqOWPmOmHj+exu+Wei+WPguaVsOWcqOa1geeoi+WPmOmHj+S4iuS4jeWtmOWcqO+8jOmcgOimgeWQjOatpea1geeoi+WPmOmHj1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEuQWN0dWFsUGFyYW1ldGVycyAmJiBkYXRhLkFjdHVhbFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgZm9ybWFsUGFyYW1ldGVycyA9IHRoaXMuZGVzaWduZXJTdGF0ZS5mbG93Rm9ybUluZm8uZm9ybWFsUGFyYW1ldGVycy5maWx0ZXIocCA9PiBwLmRhdGFUeXBlICE9PSAnQ0RUU2NoZW1hJyk7XHJcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhcmFtZXRlciBvZiBkYXRhLkFjdHVhbFBhcmFtZXRlcnMpIHtcclxuICAgICAgICAgICAgaWYgKHBhcmFtZXRlci5UYWcgPT09J3ZhcmlhYmxlJyAmJiBwYXJhbWV0ZXIuVmFsdWUgJiYgIXRoaXMuYWxsUGFyYW1ldGVycy5zb21lKHAgPT4gcC5rZXkgPT09IHBhcmFtZXRlci5WYWx1ZSkgJiYgZm9ybWFsUGFyYW1ldGVycy5zb21lKHAgPT4gcC5jb2RlID09PSBwYXJhbWV0ZXIuVmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgcGFyYW1ldGVycyA9IGZvcm1hbFBhcmFtZXRlcnM7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0geyB2YWx1ZTogZGF0YSwgcGFyYW1ldGVycyB9O1xyXG4gICAgICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdChvYmplY3QpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRvcihmb3JtOiBFeGVjdXRlRm9ybU1vZGVsKSB7XHJcbiAgICBpZiAoZm9ybSAmJiBmb3JtLkFjdHVhbFBhcmFtZXRlcnMgJiYgZm9ybS5BY3R1YWxQYXJhbWV0ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgZm9ybWFsUGFyYW1ldGVycyA9IHRoaXMuZGVzaWduZXJTdGF0ZS5mbG93Rm9ybUluZm8uZm9ybWFsUGFyYW1ldGVycy5maWx0ZXIocCA9PiBwLmRhdGFUeXBlICE9PSAnQ0RUU2NoZW1hJyk7XHJcbiAgICAgIGZvciAoY29uc3QgcGFyYW1ldGVyIG9mIGZvcm0uQWN0dWFsUGFyYW1ldGVycykge1xyXG4gICAgICAgIGlmIChwYXJhbWV0ZXIuVGFnID09PSd2YXJpYWJsZScgJiYgcGFyYW1ldGVyLlZhbHVlICYmICF0aGlzLmFsbFBhcmFtZXRlcnMuc29tZShwID0+IHAua2V5ID09PSBwYXJhbWV0ZXIuVmFsdWUpICYmICFmb3JtYWxQYXJhbWV0ZXJzLnNvbWUocCA9PiBwLmNvZGUgPT09IHBhcmFtZXRlci5WYWx1ZSkpIHtcclxuICAgICAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZXhlY3V0ZUZvcm1zLnBhcmFtZXRlcnMnKSArIHBhcmFtZXRlci5OYW1lICsgdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy50eXBlQXN2YXJpYWJsZScpKTtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICAvLyB0YWJDaGFuZ2UoZGF0YSkge1xyXG4gIC8vICAgdGhpcy50YWIgPSBkYXRhLm5leHRJZDtcclxuICAvLyB9XHJcblxyXG4gIC8vIGVkaXRDU1MoKSB7XHJcbiAgLy8gICB0aGlzLmNvbmZpZ1NlY3Rpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuZi1zZWN0aW9uLWhlYWRlcicpLmNsYXNzTGlzdC5hZGQoJ21iLTAnKTtcclxuICAvLyB9XHJcblxyXG4gIHByaXZhdGUgZ2V0Rm9ybSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKHRoaXMuZm9ybS5Db21wb25lbnRJZCkge1xyXG4gICAgICByZXR1cm4gb2YoeyByZXN1bHQ6IHRydWUsIGZvcm06IHRoaXMuZm9ybSB9KTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5mb3JtLmZvcm1Gb3JtYXRJZCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jb25maWdDb250YWluZXIuc3VibWl0KCkucGlwZShcclxuICAgICAgICBzd2l0Y2hNYXAoKHJlOiBhbnkpID0+IHtcclxuICAgICAgICAgIGlmIChyZS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgdGhpcy5mb3JtLmZvcm1hdENvbmZpZ0lkID0gcmUuY29uZmlnSWQ7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih7IHJlc3VsdDogdHJ1ZSwgZm9ybTogdGhpcy5mb3JtIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHsgcmVzdWx0OiBmYWxzZSwgZm9ybTogdGhpcy5mb3JtIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gb2YoeyByZXN1bHQ6IHRydWUsIGZvcm06IG51bGwgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj4LmlbDorr7nva5cclxuICAgKi9cclxuICBwYXJhbWV0ZXJzU2V0KCkge1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFBhcmFtZXRlclNldHRpbmdDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UubW9kZSA9ICdicG1uJztcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuYWxsUGFyYW1ldGVycyA9IHRoaXMuYWxsUGFyYW1ldGVycztcclxuICAgIGlmICh0aGlzLnRhYiA9PT0gJ3dlYicpIHtcclxuICAgICAgaWYgKHRoaXMuZm9ybS5Db21wb25lbnRJZCkge1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2hvd0Zvcm1UeXBlID0gdHJ1ZTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmZvcm1UeXBlID0gdGhpcy5mb3JtLkZvcm1UeXBlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbXBSZWYuaW5zdGFuY2UucGFyYW1ldGVycyA9IFsuLi50aGlzLmZvcm0uQWN0dWFsUGFyYW1ldGVycy5tYXAocCA9PiBPYmplY3QuYXNzaWduKHt9LCBwKSldO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29tcFJlZi5pbnN0YW5jZS5wYXJhbWV0ZXJzID0gWy4uLnRoaXMuZm9ybS5BY3R1YWxQYXJhbWV0ZXJzLm1hcChwID0+IE9iamVjdC5hc3NpZ24oe30sIHApKV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbW9kYWxDb25maWcgPSB7XHJcbiAgICAgIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZXhlY3V0ZUZvcm1zLnBhcmFtZXRlclNldHRpbmdzJyksXHJcbiAgICAgIHdpZHRoOiA2MjAsXHJcbiAgICAgIGhlaWdodDogNDAwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlclxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG5cclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc3VibWl0LnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnRhYiA9PT0gJ3dlYicpIHtcclxuICAgICAgICB0aGlzLmZvcm0uQWN0dWFsUGFyYW1ldGVycyA9IHJlLnBhcmFtZXRlcnM7XHJcbiAgICAgICAgdGhpcy5mb3JtLkZvcm1UeXBlID0gcmUuZm9ybVR5cGU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5mb3JtLkFjdHVhbFBhcmFtZXRlcnMgPSByZS5wYXJhbWV0ZXJzO1xyXG4gICAgICB9XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmNhbmNlbC5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDpgInmi6nooajljZXlrprkuYlcclxuICAgKi9cclxuICBzZWxlY3RFeGVjdXRlRm9ybSgpIHtcclxuICAgIGNvbnN0IGNvbXBGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShBZGRFeGVjdXRlRm9ybUNvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS50YWIgPSB0aGlzLnRhYjtcclxuXHJcbiAgICBjb25zdCBtb2RhbENvbmZpZyA9IHtcclxuICAgICAgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5leGVjdXRlRm9ybXMuZm9ybURlZmluaXRpb25MaXN0JyksXHJcbiAgICAgIHdpZHRoOiA2NTAsXHJcbiAgICAgIGhlaWdodDogNDAwLFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5tb2RhbEZvb3RlclxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRpYWxvZyA9IHRoaXMubW9kYWxTZXJ2aWNlLnNob3coY29tcFJlZiwgbW9kYWxDb25maWcpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zdWJtaXQuc3Vic2NyaWJlKChyZTogRXhlY3V0ZUZvcm1Nb2RlbCkgPT4ge1xyXG4gICAgICB0aGlzLmZvcm0gPSByZTtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuY2FuY2VsLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNsZWFyKCkge1xyXG4gICAgdGhpcy5mb3JtID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICB9XHJcblxyXG4gIGluaXRWYXJpYWJsZVR5cGUodmFsdWUpOiBzdHJpbmcge1xyXG4gICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+PSA4ICYmIHZhbHVlLnNsaWNlKDAsIDgpID09PSBge1wiZXhwclwiOmApIHtcclxuICAgICAgICAgICAgcmV0dXJuICdleHByZXNzaW9uJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2NvbnN0YW50JztcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAndmFyaWFibGUnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRWYXJpYWJsZUxpc3QoKSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gbmV3IEFycmF5KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclN0YXRlLnByb2NJbnN0Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLnByb2NJbnN0Q29udGV4dCkge1xyXG4gICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuc3ViQWN0aXZpdHlDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUuc3ViQWN0aXZpdHlDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyU3RhdGUuZm9ybWFsUGFyYW1ldGVyQ29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclN0YXRlLmZvcm1hbFBhcmFtZXRlckNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJTdGF0ZS5wYXJ0aWNpcGFudENvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJTdGF0ZS5wcm9jZXNzVmFyaWFibGVDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyU3RhdGUucHJvY2Vzc1ZhcmlhYmxlQ29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29udGV4dDtcclxuICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIEV4ZWN1dGVGb3Jtc0NvbnZlcnRlciBpbXBsZW1lbnRzIFR5cGVDb252ZXJ0ZXIge1xyXG4gIHBhcmFtczogYW55O1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcGFyYW1zOiBhbnksXHJcbiAgICBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZVxyXG4gICkge1xyXG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgfVxyXG4gIGNvbnZlcnRUbyhkYXRhKTogc3RyaW5nIHtcclxuICAgIGlmIChkYXRhKSB7XHJcbiAgICAgIHJldHVybiBkYXRhLk5hbWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAodGhpcy5wYXJhbXMubG9jYXRpb24gPT09ICdwcm9jZXNzJykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZXhlY3V0ZUZvcm1zLm5vdFNldCcpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZXhlY3V0ZUZvcm1zLmRlZmF1bHQnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
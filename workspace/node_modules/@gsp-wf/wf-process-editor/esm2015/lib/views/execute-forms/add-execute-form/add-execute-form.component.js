/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, TemplateRef, Optional, ChangeDetectorRef, Inject, LOCALE_ID } from '@angular/core';
import { ProcessDesignerUIState } from '../../../app/process-designer.uistate';
import { HttpService, SessionService } from '@ecp-caf/caf-common';
import { Subject, from, forkJoin } from 'rxjs';
import { ServerSideToken } from '@farris/ui-lookup';
import { FormFormatService } from './form-format.service';
import { ExecuteFormModel, TerminalType, ActualParameter } from '../entities/execute-form.entity';
import { DatagridComponent } from '@farris/ui-datagrid';
import { MessagerService } from '@farris/ui-messager';
import { ExecuteForm } from '../entities/execute-form';
import { ProcessDeUtil } from '../../../domain/process-de-util';
import { map } from 'rxjs/operators';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../../i18n/pipe/wf-process-editor-locale.pipe';
export class AddExecuteFormComponent {
    /**
     * @param {?} state
     * @param {?} http
     * @param {?} session
     * @param {?} message
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(state, http, session, message, cdr, localeId, resources, localePipe) {
        this.state = state;
        this.http = http;
        this.session = session;
        this.message = message;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.submit = new Subject();
        this.cancel = new Subject();
        this.forms = new Array();
        // private formTypeCollection = [
        //   { text: '流程嵌表单', value: '0' },
        //   { text: '表单嵌流程', value: '1' },
        // ];
        this.columns = [
            { field: 'code', width: 100, title: this.localePipe.transform('component.executeForms.code') },
            {
                field: 'name', width: 100, title: this.localePipe.transform('component.executeForms.name'),
            },
            {
                field: 'tag', width: 80, title: this.localePipe.transform('component.executeForms.apptag'),
                formatter: (/**
                 * @param {?} v
                 * @param {?} d
                 * @param {?} i
                 * @return {?}
                 */
                (v, d, i) => {
                    if (d.appId) {
                        return this.localePipe.transform('component.executeForms.functionMenu');
                    }
                    else if (d.formFormatId) {
                        return this.localePipe.transform('component.executeForms.formFormat');
                    }
                })
            }
            // {
            //   field: 'formType', width: 80, title: '联查类型',
            //   formatter: {
            //     type: 'enum',
            //     options: { valueField: 'value', textField: 'text', data: this.formTypeCollection }
            //   },
            // },
        ];
        // 表单格式显示列
        this.cols = [
            {
                field: 'code', width: 100, title: this.localePipe.transform('component.executeForms.docFormatNumber'), searchField: 'code'
            }, {
                field: 'name', width: 100, title: this.localePipe.transform('component.executeForms.docFormatName'), searchField: 'name'
            }
        ];
        this.dataUri = '/api/runtime/wf/v1.0/formFormat/page';
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getAllExecuteForms();
    }
    /**
     * @return {?}
     */
    clickOK() {
        if (this.grid.selectedRow) {
            /** @type {?} */
            const form = this.grid.selectedRow.data;
            /** @type {?} */
            const model = new ExecuteFormModel();
            model.Id = ProcessDeUtil.GenerateElementId();
            model.Name = form.name;
            model.ComponentId = form.appId;
            model.FormType = form.formType;
            model.formFormatId = form.formFormatId;
            model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
            model.ActualParameters = form.actualParameters.map((/**
             * @param {?} p
             * @return {?}
             */
            p => {
                /** @type {?} */
                const a = new ActualParameter();
                a.Name = p.code;
                a.Tag = p.valueType ? p.valueType : this.initVariableType(p.value);
                a.Value = p.value;
                return a;
            }));
            this.submit.next(model);
        }
        else {
            this.message.info(this.localePipe.transform('component.executeForms.selectedRow'));
        }
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.cancel.next();
    }
    // selectOtherFormFormat() {
    //   this.lookUp.showDialog();
    // }
    // dictPicking = (arg) => {
    //   return of({
    //     showDialog: true, data: {
    //       tab: this.tab
    //     }
    //   });
    // }
    // dictPicked = (data: any): Observable<PickedResult> => {
    //   const model = new ExecuteFormModel();
    //   model.Id = ProcessDeUtil.GenerateElementId();
    //   model.Name = data.name;
    //   model.ComponentId = null;
    //   model.FormType = '0';
    //   model.formFormatId = data.id;
    //   model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
    //   model.ActualParameters = data.urlParameters.map(p => {
    //     const a = new ActualParameter();
    //     a.Name = p.code;
    //     a.Value = p.value;
    //     return a;
    //   });
    //   this.submit.next(model);
    //   return of({ closeDialog: true });
    // }
    // selectOtherFunc() {
    //   this.appHelper.showHelp(this.session.getUserSessionId());
    // }
    // funcSelected(apps: RtfApp[]) {
    //   if (apps && apps.length > 0) {
    //     const model = new ExecuteFormModel();
    //     model.Id = ProcessDeUtil.GenerateElementId();
    //     model.Name = apps[0].Name;
    //     model.ComponentId = apps[0].Id;
    //     model.FormType = '0';
    //     model.formFormatId = null;
    //     model.TerminalType = this.tab === 'web' ? TerminalType.PC : TerminalType.MOBILE;
    //     model.ActualParameters = [];
    //     if (apps[0].InvokingConfig['entityParams']) {
    //       const paras = JSON.parse(apps[0].InvokingConfig['entityParams']);
    //       model.ActualParameters = paras.map(p => ({
    //         Name: p.name,
    //         Value: ''
    //       }));
    //     }
    //     setTimeout(() => {
    //       this.submit.next(model);
    //     }, 0);
    //   }
    // }
    /**
     * @private
     * @return {?}
     */
    getAllExecuteForms() {
        forkJoin(this.getExecuteForms(), this.getFormFormats()).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            if (re[0]) {
                this.forms = re[0];
            }
            if (re[1] && re[1].length > 0) {
                /** @type {?} */
                const formFormats = re[1];
                for (const format of formFormats) {
                    if (this.forms.findIndex((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.formFormatId && f.formFormatId === format.id)) === -1) {
                        /** @type {?} */
                        const executeForm = new ExecuteForm();
                        executeForm.id = ProcessDeUtil.createNM();
                        executeForm.flowFormKey = this.state.flowFormInfo.flowForm.id;
                        executeForm.appId = null;
                        executeForm.code = format.code;
                        executeForm.name = format.name;
                        executeForm.actualParameters = [];
                        executeForm.isDefault = false;
                        executeForm.formType = '0';
                        executeForm.terminal = 'web';
                        executeForm.formFormatId = format.id;
                        executeForm.sysInit = 0;
                        executeForm.remarks = '';
                        if (format.urlParameters && format.urlParameters.length > 0) {
                            /** @type {?} */
                            const actPList = format.urlParameters.map((/**
                             * @param {?} p
                             * @return {?}
                             */
                            p => ({
                                code: p.code,
                                name: p.name,
                                valueType: p.valueType ? p.valueType : this.initVariableType(p.value),
                                value: p.value
                            })));
                            executeForm.actualParameters = actPList;
                        }
                        this.forms.push(executeForm);
                    }
                }
            }
        }));
    }
    /**
     * @param {?} value
     * @return {?}
     */
    initVariableType(value) {
        if (value) {
            if (value.length >= 8 && value.slice(0, 8) === `{"expr":`) {
                return 'expression';
            }
            else {
                return 'constant';
            }
        }
        else {
            return 'variable';
        }
    }
    /**
     * @private
     * @return {?}
     */
    getExecuteForms() {
        if (this.state.flowFormInfo.flowForm.id && this.tab) {
            /** @type {?} */
            const url = `/api/runtime/wf/v1.0/excuteForm?flowFormKey=${this.state.flowFormInfo.flowForm.id}`;
            return this.http.get(url).pipe(map((/**
             * @param {?} re
             * @return {?}
             */
            (re) => {
                if (this.tab === 'web') {
                    return re.filter((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.terminal.indexOf('web') > -1));
                }
                else if (this.tab === 'mobile') {
                    return re.filter((/**
                     * @param {?} f
                     * @return {?}
                     */
                    f => f.terminal.indexOf('app') > -1));
                }
            })));
        }
        else {
            return from(new Array());
        }
    }
    /**
     * @private
     * @return {?}
     */
    getFormFormats() {
        if (this.state.flowFormInfo.flowForm.businessObjectId && this.tab) {
            /** @type {?} */
            const terminal = this.tab === 'web' ? 'PC' : 'Mobile';
            /** @type {?} */
            let url = `/api/runtime/wf/v1.0/formFormat/query?param=`;
            /** @type {?} */
            let param = `{"bizCategory":"${this.state.flowFormInfo.flowForm.businessObjectId}","terminal":"${terminal}"}`;
            param = encodeURIComponent(param);
            url += param;
            return this.http.get(url);
        }
        else {
            return from(new Array());
        }
    }
}
AddExecuteFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-add-execute-form',
                template: "<div class=\"f-page f-page-is-managelist\">\r\n  <div class=\"f-page-main my-0\">\r\n    <div class=\"f-struct-wrapper f-utils-fill-flex-column\">\r\n      <farris-section class=\"f-section-grid f-section-in-managelist p-2\" [showHeader]=\"false\">\r\n        <farris-datagrid class=\"f-component-grid\" [columns]=\"columns\" [data]=\"forms\" #grid\r\n          [idField]=\"'id'\" [showLineNumber]=\"true\" [striped]=\"true\"\r\n          [showCheckbox]=\"false\" [virtualized]=\"true\" [pagination]=\"false\" [fit]=\"true\" [fitColumns]=\"true\">\r\n        </farris-datagrid>\r\n      </farris-section>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"clickCancel()\">{{'component.executeForms.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">{{'component.executeForms.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n<!--\r\n<app-rtf-app-help #appHelper (afterHelpConfirm)=\"funcSelected($event)\" [isLayeredLoad]=\"true\">\r\n</app-rtf-app-help>\r\n\r\n<farris-lookup-grid #lookup style=\"display: none;\" [editable]=\"false\" [columns]=\"cols\" [singleSelect]=\"true\"\r\n  title=\"'\u5355\u636E\u683C\u5F0F'\" [displayType]=\"'List'\" [uri]=\"dataUri\" [idField]=\"'id'\" [pageIndex]=\"1\" [pageSize]=\"20\"\r\n  [pagination]=\"true\" [valueField]=\"'id'\" [textField]=\"'name'\" [dialogWidth]=\"550\" [dictPicked]=\"dictPicked\"\r\n  [dictPicking]=\"dictPicking\">\r\n</farris-lookup-grid> -->\r\n",
                providers: [{
                        provide: ServerSideToken, useClass: FormFormatService
                    },
                    WfLocalePipe
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
AddExecuteFormComponent.ctorParameters = () => [
    { type: ProcessDesignerUIState },
    { type: HttpService },
    { type: SessionService },
    { type: MessagerService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
AddExecuteFormComponent.propDecorators = {
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }],
    grid: [{ type: ViewChild, args: ['grid',] }]
};
if (false) {
    /** @type {?} */
    AddExecuteFormComponent.prototype.modalFooter;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.grid;
    /** @type {?} */
    AddExecuteFormComponent.prototype.submit;
    /** @type {?} */
    AddExecuteFormComponent.prototype.cancel;
    /** @type {?} */
    AddExecuteFormComponent.prototype.tab;
    /** @type {?} */
    AddExecuteFormComponent.prototype.forms;
    /** @type {?} */
    AddExecuteFormComponent.prototype.columns;
    /** @type {?} */
    AddExecuteFormComponent.prototype.cols;
    /** @type {?} */
    AddExecuteFormComponent.prototype.dataUri;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.session;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    AddExecuteFormComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3ZpZXdzL2V4ZWN1dGUtZm9ybXMvYWRkLWV4ZWN1dGUtZm9ybS9hZGQtZXhlY3V0ZS1mb3JtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBOEMsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU5SixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR2xFLE9BQU8sRUFBa0IsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0QsT0FBTyxFQUFnQixlQUFlLEVBQXVCLE1BQU0sbUJBQW1CLENBQUM7QUFDdkYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNsRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNoRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBRSxNQUFNLGtEQUFrRCxDQUFD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d0NBQXFDOzs7OztJQUNyQyx1Q0FBeUI7Ozs7O0lBQ3pCLDBDQUErQjs7Ozs7SUFDL0IsMENBQWdDOzs7OztJQUNoQyxzQ0FBMEM7Ozs7O0lBQzFDLDJDQUEyQzs7Ozs7SUFDM0MsNENBQWlEOzs7OztJQUNqRCw2Q0FBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgVmlld0NoaWxkLCBUZW1wbGF0ZVJlZiwgT3B0aW9uYWwsIENoYW5nZURldGVjdG9yUmVmLCBJbmplY3QsIExPQ0FMRV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbW9kYWwnO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVzaWduZXJVSVN0YXRlIH0gZnJvbSAnLi4vLi4vLi4vYXBwL3Byb2Nlc3MtZGVzaWduZXIudWlzdGF0ZSc7XHJcbmltcG9ydCB7IEh0dHBTZXJ2aWNlLCBTZXNzaW9uU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBSdGZBcHBIZWxwQ29tcG9uZW50IH0gZnJvbSAnQGdzcC1zeXMvcnRmLXVpJztcclxuaW1wb3J0IHsgUnRmQXBwIH0gZnJvbSAnQGdzcC1zeXMvcnRmLXVpL2xpYi9ydGYtYXBwLWhlbHAvZW50aXRpZXMvcnRmLWFwcCc7XHJcbmltcG9ydCB7IG9mLCBPYnNlcnZhYmxlLCBTdWJqZWN0LCBmcm9tLCBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBQaWNrZWRSZXN1bHQsIFNlcnZlclNpZGVUb2tlbiwgTG9va3VwR3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktbG9va3VwJztcclxuaW1wb3J0IHsgRm9ybUZvcm1hdFNlcnZpY2UgfSBmcm9tICcuL2Zvcm0tZm9ybWF0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBFeGVjdXRlRm9ybU1vZGVsLCBUZXJtaW5hbFR5cGUsIEFjdHVhbFBhcmFtZXRlciB9IGZyb20gJy4uL2VudGl0aWVzL2V4ZWN1dGUtZm9ybS5lbnRpdHknO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgRXhlY3V0ZUZvcm0gfSBmcm9tICcuLi9lbnRpdGllcy9leGVjdXRlLWZvcm0nO1xyXG5pbXBvcnQgeyBQcm9jZXNzRGVVdGlsIH0gZnJvbSAnLi4vLi4vLi4vZG9tYWluL3Byb2Nlc3MtZGUtdXRpbCc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgV0ZfTEFOR19SRVNPVVJDRVMsIFdmTG9jYWxlUGlwZSB9IGZyb20gJy4uLy4uLy4uL2kxOG4vcGlwZS93Zi1wcm9jZXNzLWVkaXRvci1sb2NhbGUucGlwZSc7XHJcbmltcG9ydCB7IFdGX1BST0NFU1NfRURJVE9SX0xBTkdfUkVTT1VSQ0VTIH0gZnJvbSAnLi4vLi4vLi4vaTE4bi9hc3NldHMvbGFuZy5yZXNvdXJjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1hZGQtZXhlY3V0ZS1mb3JtJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYWRkLWV4ZWN1dGUtZm9ybS5jb21wb25lbnQuc2NzcyddLFxyXG4gIHByb3ZpZGVyczogW3tcclxuICAgIHByb3ZpZGU6IFNlcnZlclNpZGVUb2tlbiwgdXNlQ2xhc3M6IEZvcm1Gb3JtYXRTZXJ2aWNlIH0sXHJcbiAgICAgV2ZMb2NhbGVQaXBlXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQWRkRXhlY3V0ZUZvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBAVmlld0NoaWxkKCdpY29uU2VsZWN0Rm9vdGVyJykgbW9kYWxGb290ZXI6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgLy8gQFZpZXdDaGlsZChSdGZBcHBIZWxwQ29tcG9uZW50KSBwdWJsaWMgYXBwSGVscGVyOiBSdGZBcHBIZWxwQ29tcG9uZW50O1xyXG4gIC8vIEBWaWV3Q2hpbGQoJ2xvb2t1cCcpIHB1YmxpYyBsb29rVXA6IExvb2t1cEdyaWRDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnZ3JpZCcpIHByaXZhdGUgZ3JpZDogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gIHN1Ym1pdCA9IG5ldyBTdWJqZWN0PEV4ZWN1dGVGb3JtTW9kZWw+KCk7XHJcbiAgY2FuY2VsID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgdGFiOiAnd2ViJyB8ICdtb2JpbGUnO1xyXG5cclxuICBmb3JtcyA9IG5ldyBBcnJheTxFeGVjdXRlRm9ybT4oKTtcclxuXHJcbiAgLy8gcHJpdmF0ZSBmb3JtVHlwZUNvbGxlY3Rpb24gPSBbXHJcbiAgLy8gICB7IHRleHQ6ICfmtYHnqIvltYzooajljZUnLCB2YWx1ZTogJzAnIH0sXHJcbiAgLy8gICB7IHRleHQ6ICfooajljZXltYzmtYHnqIsnLCB2YWx1ZTogJzEnIH0sXHJcbiAgLy8gXTtcclxuXHJcbiAgY29sdW1ucyA9IFtcclxuICAgIHsgZmllbGQ6ICdjb2RlJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5leGVjdXRlRm9ybXMuY29kZScpIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAnbmFtZScsIHdpZHRoOiAxMDAsIHRpdGxlOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuZXhlY3V0ZUZvcm1zLm5hbWUnKSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpZWxkOiAndGFnJywgd2lkdGg6IDgwLCB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5hcHB0YWcnKSxcclxuICAgICAgZm9ybWF0dGVyOiAodiwgZCwgaSkgPT4ge1xyXG4gICAgICAgIGlmIChkLmFwcElkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5mdW5jdGlvbk1lbnUnKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGQuZm9ybUZvcm1hdElkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5mb3JtRm9ybWF0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyB7XHJcbiAgICAvLyAgIGZpZWxkOiAnZm9ybVR5cGUnLCB3aWR0aDogODAsIHRpdGxlOiAn6IGU5p+l57G75Z6LJyxcclxuICAgIC8vICAgZm9ybWF0dGVyOiB7XHJcbiAgICAvLyAgICAgdHlwZTogJ2VudW0nLFxyXG4gICAgLy8gICAgIG9wdGlvbnM6IHsgdmFsdWVGaWVsZDogJ3ZhbHVlJywgdGV4dEZpZWxkOiAndGV4dCcsIGRhdGE6IHRoaXMuZm9ybVR5cGVDb2xsZWN0aW9uIH1cclxuICAgIC8vICAgfSxcclxuICAgIC8vIH0sXHJcbiAgXTtcclxuXHJcbiAgLy8g6KGo5Y2V5qC85byP5pi+56S65YiXXHJcbiAgY29scyA9IFtcclxuICAgIHtcclxuICAgICAgZmllbGQ6ICdjb2RlJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5leGVjdXRlRm9ybXMuZG9jRm9ybWF0TnVtYmVyJyksIHNlYXJjaEZpZWxkOiAnY29kZSdcclxuICAgIH0sIHtcclxuICAgICAgZmllbGQ6ICduYW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5leGVjdXRlRm9ybXMuZG9jRm9ybWF0TmFtZScpLCBzZWFyY2hGaWVsZDogJ25hbWUnXHJcbiAgICB9XHJcbiAgXTtcclxuXHJcbiAgZGF0YVVyaSA9ICcvYXBpL3J1bnRpbWUvd2YvdjEuMC9mb3JtRm9ybWF0L3BhZ2UnO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBzdGF0ZTogUHJvY2Vzc0Rlc2lnbmVyVUlTdGF0ZSxcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHNlc3Npb246IFNlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQEluamVjdChXRl9MQU5HX1JFU09VUkNFUykgcHJpdmF0ZSByZXNvdXJjZXM6IGFueSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbG9jYWxlUGlwZTogV2ZMb2NhbGVQaXBlXHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSB0aGlzLmxvY2FsZVBpcGUgfHwgbmV3IFdmTG9jYWxlUGlwZShsb2NhbGVJZCwgcmVzb3VyY2VzKTtcclxuICAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuZ2V0QWxsRXhlY3V0ZUZvcm1zKCk7XHJcbiAgfVxyXG5cclxuICBjbGlja09LKCkge1xyXG4gICAgaWYgKHRoaXMuZ3JpZC5zZWxlY3RlZFJvdykge1xyXG4gICAgICBjb25zdCBmb3JtOiBFeGVjdXRlRm9ybSA9IHRoaXMuZ3JpZC5zZWxlY3RlZFJvdy5kYXRhO1xyXG4gICAgICBjb25zdCBtb2RlbCA9IG5ldyBFeGVjdXRlRm9ybU1vZGVsKCk7XHJcbiAgICAgIG1vZGVsLklkID0gUHJvY2Vzc0RlVXRpbC5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG4gICAgICBtb2RlbC5OYW1lID0gZm9ybS5uYW1lO1xyXG4gICAgICBtb2RlbC5Db21wb25lbnRJZCA9IGZvcm0uYXBwSWQ7XHJcbiAgICAgIG1vZGVsLkZvcm1UeXBlID0gZm9ybS5mb3JtVHlwZTtcclxuICAgICAgbW9kZWwuZm9ybUZvcm1hdElkID0gZm9ybS5mb3JtRm9ybWF0SWQ7XHJcbiAgICAgIG1vZGVsLlRlcm1pbmFsVHlwZSA9IHRoaXMudGFiID09PSAnd2ViJyA/IFRlcm1pbmFsVHlwZS5QQyA6IFRlcm1pbmFsVHlwZS5NT0JJTEU7XHJcbiAgICAgIG1vZGVsLkFjdHVhbFBhcmFtZXRlcnMgPSBmb3JtLmFjdHVhbFBhcmFtZXRlcnMubWFwKHAgPT4ge1xyXG4gICAgICAgIGNvbnN0IGEgPSBuZXcgQWN0dWFsUGFyYW1ldGVyKCk7XHJcbiAgICAgICAgYS5OYW1lID0gcC5jb2RlO1xyXG4gICAgICAgIGEuVGFnID0gcC52YWx1ZVR5cGUgPyBwLnZhbHVlVHlwZSA6IHRoaXMuaW5pdFZhcmlhYmxlVHlwZShwLnZhbHVlKTtcclxuICAgICAgICBhLlZhbHVlID0gcC52YWx1ZTtcclxuICAgICAgICByZXR1cm4gYTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc3VibWl0Lm5leHQobW9kZWwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmluZm8odGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmV4ZWN1dGVGb3Jtcy5zZWxlY3RlZFJvdycpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrQ2FuY2VsKCkge1xyXG4gICAgdGhpcy5jYW5jZWwubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgLy8gc2VsZWN0T3RoZXJGb3JtRm9ybWF0KCkge1xyXG4gIC8vICAgdGhpcy5sb29rVXAuc2hvd0RpYWxvZygpO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gZGljdFBpY2tpbmcgPSAoYXJnKSA9PiB7XHJcbiAgLy8gICByZXR1cm4gb2Yoe1xyXG4gIC8vICAgICBzaG93RGlhbG9nOiB0cnVlLCBkYXRhOiB7XHJcbiAgLy8gICAgICAgdGFiOiB0aGlzLnRhYlxyXG4gIC8vICAgICB9XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIGRpY3RQaWNrZWQgPSAoZGF0YTogYW55KTogT2JzZXJ2YWJsZTxQaWNrZWRSZXN1bHQ+ID0+IHtcclxuICAvLyAgIGNvbnN0IG1vZGVsID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAvLyAgIG1vZGVsLklkID0gUHJvY2Vzc0RlVXRpbC5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG4gIC8vICAgbW9kZWwuTmFtZSA9IGRhdGEubmFtZTtcclxuICAvLyAgIG1vZGVsLkNvbXBvbmVudElkID0gbnVsbDtcclxuICAvLyAgIG1vZGVsLkZvcm1UeXBlID0gJzAnO1xyXG4gIC8vICAgbW9kZWwuZm9ybUZvcm1hdElkID0gZGF0YS5pZDtcclxuICAvLyAgIG1vZGVsLlRlcm1pbmFsVHlwZSA9IHRoaXMudGFiID09PSAnd2ViJyA/IFRlcm1pbmFsVHlwZS5QQyA6IFRlcm1pbmFsVHlwZS5NT0JJTEU7XHJcbiAgLy8gICBtb2RlbC5BY3R1YWxQYXJhbWV0ZXJzID0gZGF0YS51cmxQYXJhbWV0ZXJzLm1hcChwID0+IHtcclxuICAvLyAgICAgY29uc3QgYSA9IG5ldyBBY3R1YWxQYXJhbWV0ZXIoKTtcclxuICAvLyAgICAgYS5OYW1lID0gcC5jb2RlO1xyXG4gIC8vICAgICBhLlZhbHVlID0gcC52YWx1ZTtcclxuICAvLyAgICAgcmV0dXJuIGE7XHJcbiAgLy8gICB9KTtcclxuICAvLyAgIHRoaXMuc3VibWl0Lm5leHQobW9kZWwpO1xyXG4gIC8vICAgcmV0dXJuIG9mKHsgY2xvc2VEaWFsb2c6IHRydWUgfSk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyBzZWxlY3RPdGhlckZ1bmMoKSB7XHJcbiAgLy8gICB0aGlzLmFwcEhlbHBlci5zaG93SGVscCh0aGlzLnNlc3Npb24uZ2V0VXNlclNlc3Npb25JZCgpKTtcclxuICAvLyB9XHJcblxyXG4gIC8vIGZ1bmNTZWxlY3RlZChhcHBzOiBSdGZBcHBbXSkge1xyXG4gIC8vICAgaWYgKGFwcHMgJiYgYXBwcy5sZW5ndGggPiAwKSB7XHJcbiAgLy8gICAgIGNvbnN0IG1vZGVsID0gbmV3IEV4ZWN1dGVGb3JtTW9kZWwoKTtcclxuICAvLyAgICAgbW9kZWwuSWQgPSBQcm9jZXNzRGVVdGlsLkdlbmVyYXRlRWxlbWVudElkKCk7XHJcbiAgLy8gICAgIG1vZGVsLk5hbWUgPSBhcHBzWzBdLk5hbWU7XHJcbiAgLy8gICAgIG1vZGVsLkNvbXBvbmVudElkID0gYXBwc1swXS5JZDtcclxuICAvLyAgICAgbW9kZWwuRm9ybVR5cGUgPSAnMCc7XHJcbiAgLy8gICAgIG1vZGVsLmZvcm1Gb3JtYXRJZCA9IG51bGw7XHJcbiAgLy8gICAgIG1vZGVsLlRlcm1pbmFsVHlwZSA9IHRoaXMudGFiID09PSAnd2ViJyA/IFRlcm1pbmFsVHlwZS5QQyA6IFRlcm1pbmFsVHlwZS5NT0JJTEU7XHJcbiAgLy8gICAgIG1vZGVsLkFjdHVhbFBhcmFtZXRlcnMgPSBbXTtcclxuICAvLyAgICAgaWYgKGFwcHNbMF0uSW52b2tpbmdDb25maWdbJ2VudGl0eVBhcmFtcyddKSB7XHJcbiAgLy8gICAgICAgY29uc3QgcGFyYXMgPSBKU09OLnBhcnNlKGFwcHNbMF0uSW52b2tpbmdDb25maWdbJ2VudGl0eVBhcmFtcyddKTtcclxuICAvLyAgICAgICBtb2RlbC5BY3R1YWxQYXJhbWV0ZXJzID0gcGFyYXMubWFwKHAgPT4gKHtcclxuICAvLyAgICAgICAgIE5hbWU6IHAubmFtZSxcclxuICAvLyAgICAgICAgIFZhbHVlOiAnJ1xyXG4gIC8vICAgICAgIH0pKTtcclxuICAvLyAgICAgfVxyXG4gIC8vICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAvLyAgICAgICB0aGlzLnN1Ym1pdC5uZXh0KG1vZGVsKTtcclxuICAvLyAgICAgfSwgMCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG5cclxuICBwcml2YXRlIGdldEFsbEV4ZWN1dGVGb3JtcygpIHtcclxuICAgIGZvcmtKb2luKHRoaXMuZ2V0RXhlY3V0ZUZvcm1zKCksIHRoaXMuZ2V0Rm9ybUZvcm1hdHMoKSkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgaWYgKHJlWzBdKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtcyA9IHJlWzBdO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChyZVsxXSAmJiByZVsxXS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgZm9ybUZvcm1hdHMgPSByZVsxXTtcclxuICAgICAgICBmb3IgKGNvbnN0IGZvcm1hdCBvZiBmb3JtRm9ybWF0cykge1xyXG4gICAgICAgICAgaWYgKHRoaXMuZm9ybXMuZmluZEluZGV4KGYgPT4gZi5mb3JtRm9ybWF0SWQgJiYgZi5mb3JtRm9ybWF0SWQgPT09IGZvcm1hdC5pZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGVGb3JtID0gbmV3IEV4ZWN1dGVGb3JtKCk7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmlkID0gUHJvY2Vzc0RlVXRpbC5jcmVhdGVOTSgpO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5mbG93Rm9ybUtleSA9IHRoaXMuc3RhdGUuZmxvd0Zvcm1JbmZvLmZsb3dGb3JtLmlkO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5hcHBJZCA9IG51bGw7XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmNvZGUgPSBmb3JtYXQuY29kZTtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0ubmFtZSA9IGZvcm1hdC5uYW1lO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5hY3R1YWxQYXJhbWV0ZXJzID0gW107XHJcbiAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5mb3JtVHlwZSA9ICcwJztcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0udGVybWluYWwgPSAnd2ViJztcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0uZm9ybUZvcm1hdElkID0gZm9ybWF0LmlkO1xyXG4gICAgICAgICAgICBleGVjdXRlRm9ybS5zeXNJbml0ID0gMDtcclxuICAgICAgICAgICAgZXhlY3V0ZUZvcm0ucmVtYXJrcyA9ICcnO1xyXG4gICAgICAgICAgICBpZiAoZm9ybWF0LnVybFBhcmFtZXRlcnMgJiYgZm9ybWF0LnVybFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGFjdFBMaXN0ID0gZm9ybWF0LnVybFBhcmFtZXRlcnMubWFwKHAgPT4gKHtcclxuICAgICAgICAgICAgICAgIGNvZGU6IHAuY29kZSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHAubmFtZSxcclxuICAgICAgICAgICAgICAgIHZhbHVlVHlwZTogcC52YWx1ZVR5cGUgPyBwLnZhbHVlVHlwZSA6IHRoaXMuaW5pdFZhcmlhYmxlVHlwZShwLnZhbHVlKSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBwLnZhbHVlXHJcbiAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgIGV4ZWN1dGVGb3JtLmFjdHVhbFBhcmFtZXRlcnMgPSBhY3RQTGlzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmZvcm1zLnB1c2goZXhlY3V0ZUZvcm0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpbml0VmFyaWFibGVUeXBlKHZhbHVlKTogc3RyaW5nIHtcclxuICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPj0gOCAmJiB2YWx1ZS5zbGljZSgwLCA4KSA9PT0gYHtcImV4cHJcIjpgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnZXhwcmVzc2lvbic7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICdjb25zdGFudCc7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gJ3ZhcmlhYmxlJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RXhlY3V0ZUZvcm1zKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uaWQgJiYgdGhpcy50YWIpIHtcclxuICAgICAgY29uc3QgdXJsID0gYC9hcGkvcnVudGltZS93Zi92MS4wL2V4Y3V0ZUZvcm0/Zmxvd0Zvcm1LZXk9JHt0aGlzLnN0YXRlLmZsb3dGb3JtSW5mby5mbG93Rm9ybS5pZH1gO1xyXG4gICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnBpcGUoXHJcbiAgICAgICAgbWFwKChyZTogYW55KSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy50YWIgPT09ICd3ZWInKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZS5maWx0ZXIoZiA9PiBmLnRlcm1pbmFsLmluZGV4T2YoJ3dlYicpID4gLTEpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRhYiA9PT0gJ21vYmlsZScpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlLmZpbHRlcihmID0+IGYudGVybWluYWwuaW5kZXhPZignYXBwJykgPiAtMSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBmcm9tKG5ldyBBcnJheSgpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0Rm9ybUZvcm1hdHMoKTogT2JzZXJ2YWJsZTxhbnk+ICB7XHJcbiAgICBpZiAodGhpcy5zdGF0ZS5mbG93Rm9ybUluZm8uZmxvd0Zvcm0uYnVzaW5lc3NPYmplY3RJZCAmJiB0aGlzLnRhYikge1xyXG4gICAgICBjb25zdCB0ZXJtaW5hbCA9IHRoaXMudGFiID09PSAnd2ViJyA/ICdQQycgOiAnTW9iaWxlJztcclxuICAgICAgbGV0IHVybCA9IGAvYXBpL3J1bnRpbWUvd2YvdjEuMC9mb3JtRm9ybWF0L3F1ZXJ5P3BhcmFtPWA7XHJcbiAgICAgIGxldCBwYXJhbSA9IGB7XCJiaXpDYXRlZ29yeVwiOlwiJHt0aGlzLnN0YXRlLmZsb3dGb3JtSW5mby5mbG93Rm9ybS5idXNpbmVzc09iamVjdElkfVwiLFwidGVybWluYWxcIjpcIiR7dGVybWluYWx9XCJ9YDtcclxuICAgICAgcGFyYW0gPSBlbmNvZGVVUklDb21wb25lbnQocGFyYW0pO1xyXG4gICAgICB1cmwgKz0gcGFyYW07XHJcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gZnJvbShuZXcgQXJyYXkoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
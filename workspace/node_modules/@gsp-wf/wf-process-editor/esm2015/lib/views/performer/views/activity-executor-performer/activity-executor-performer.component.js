/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, NgZone, ViewChild, ElementRef, HostBinding, ChangeDetectorRef, Optional, Inject, LOCALE_ID } from '@angular/core';
import { DialogComponent } from "@farris/ui-dialog";
import { DatagridComponent } from "@farris/ui-datagrid";
import { ExprEditMode, ExpressionService, InjectedType } from "@gsp-svc/expression";
import { ProcessDesignerUIState } from "../../../../app/process-designer.uistate";
import { ActivityExecutorParticipant } from "./entities/activity-executor.participant";
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../../../i18n/pipe/wf-process-editor-locale.pipe';
export class ActivityExecutorPerformerComponent {
    /**
     * @param {?} ngZone
     * @param {?} designerUIState
     * @param {?} expr
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(ngZone, designerUIState, expr, cdr, localeId, resources, localePipe) {
        this.ngZone = ngZone;
        this.designerUIState = designerUIState;
        this.expr = expr;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.cls = 'd-flex flex-fill h-100';
        this.showClearButton = false;
        this.activityExecutors = [];
        this.cols = [
            { title: this.localePipe.transform('component.activityExecutor.name'), field: 'Name', width: 60 },
            { title: 'ID', field: 'Id', width: 90 }
        ];
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.ngZone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.inputGroup.nativeElement.addEventListener('mouseenter', this.onMouseEnter.bind(this));
            this.inputGroup.nativeElement.addEventListener('mouseleave', this.onMouseLeave.bind(this));
        }));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseEnter(event) {
        this.showClearButton = true;
        if (this.showClearButton) {
            this.toggleClearIcon(event, true);
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseLeave(event) {
        this.showClearButton = false;
        this.toggleClearIcon(event, false);
    }
    /**
     * @private
     * @param {?} event
     * @param {?=} isShow
     * @return {?}
     */
    toggleClearIcon(event, isShow = false) {
        /** @type {?} */
        const str = isShow ? '' : 'none';
        /** @type {?} */
        const clearIcon = event.target.querySelector('.input-group-clear');
        if (clearIcon) {
            clearIcon.style.display = str;
        }
    }
    /**
     * @param {?} data
     * @return {?}
     */
    clear(data) {
        this.activityExecutors = [];
    }
    /**
     * @param {?} data
     * @return {?}
     */
    selectUsers(data) {
        // 已办用户
        /** @type {?} */
        const selectedUser = [];
        if (this.activityExecutors && this.activityExecutors.length > 0) {
            for (const handler of this.activityExecutors) {
                /** @type {?} */
                const data = {
                    data: {
                        Id: handler.activityDefId,
                        Name: handler.activityDefName
                    },
                    id: handler.activityDefId
                };
                selectedUser.push(data);
            }
        }
        this.allActivityTable.setCurrentPagerData(selectedUser);
        this.allActivityDialog.show();
    }
    /**
     * @return {?}
     */
    editConditon() {
        // this.expr.clearContext();
        if (this.designerUIState.schemas.length > 0) {
            for (const schema of this.designerUIState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        /** @type {?} */
        let context = new Array();
        context = this.designerUIState.addContext(context);
        if (this.designerUIState.subActivityContext.length > 0) {
            for (const variable of this.designerUIState.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerUIState.activityComponentContext.length > 0) {
            for (const variable of this.designerUIState.activityComponentContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        this.expr.setEditPattern(ExprEditMode.Conditional); // 表达式展现模式：默认简易版
        this.expr.addExpressionText(this.condition);
        this.expr.buildExpression().then((/**
         * @param {?} expressioninfo
         * @return {?}
         */
        (expressioninfo) => {
            this.condition = expressioninfo;
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
    /**
     * @return {?}
     */
    activitiesSelect() {
        /** @type {?} */
        const selectedActivities = this.allActivityTable.checkeds;
        this.activityExecutors = selectedActivities.map((/**
         * @param {?} activity
         * @return {?}
         */
        activity => {
            /** @type {?} */
            const handler = new ActivityExecutorParticipant(activity.data.Id, activity.data.Name, 'wf.ActivityExecutorParticipantExpression');
            handler.performerName = '<' + activity.data.Name + this.localePipe.transform('component.activityExecutor.eventHandler');
            handler.activityDefId = activity.data.Id;
            handler.activityDefName = activity.data.Name;
            handler.condition = this.condition;
            return handler;
        }));
        this.allActivityDialog.close();
    }
    /**
     * @return {?}
     */
    getPerformers() {
        this.activityExecutors.map((/**
         * @param {?} x
         * @return {?}
         */
        x => x.condition = this.condition));
        return this.activityExecutors;
    }
}
ActivityExecutorPerformerComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-activity-handler-performer',
                template: "<div class=\"d-flex flex-fill farris-overflow-y-auto p-md-2\" style=\"background: #FFF;\">\r\n  <div class=\"d-flex flex-fill farris-overflow-y-auto mx-3 my-2\" style=\"border-radius:16px;border: 1.5px solid #F1F3F7;\">\r\n  <form style=\"width: 100%;\" >\r\n    <div class=\"d-flex m-2 flex-column w-100\">\r\n      <div class=\"d-flex flex-column\">\r\n        <div class=\"farris-form form-inline  farris-form-inline mr-5 my-2\">\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-info text-danger\">*</span>\r\n                  <span class=\"farris-label-text\">{{'component.activityExecutor.nodeName'|wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <div #inputGroup class=\"input-group\">\r\n                    <input type=\"text\" class=\"form-control\" [value]=\"activityExecutors | activityExecutor \" name=\"users\" [readOnly]=\"true\" />\r\n                    <div class=\"input-group-append\">\r\n                      <span [style.display]=\"showClearButton ? '' : 'none'\" class=\"input-group-text input-group-clear\"\r\n                            (click)=\"clear($event)\">\r\n                        <i class=\"f-icon modal_close\"></i>\r\n                      </span>\r\n                      <span class=\"input-group-text\" (click)=\"selectUsers($event)\" style=\"background: #FFF;\">\r\n                        <i class=\"f-icon f-icon-lookup\"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex flex-column\">\r\n        <div class=\"farris-form form-inline farris-form-inline mr-5\">\r\n          <div class=\"col-12 farris-group-auto my-4\">\r\n            <div class=\"farris-group-wrap\">\r\n              <div class=\"form-group farris-form-group\">\r\n                <label class=\"col-form-label\">\r\n                  <span class=\"farris-label-text\">{{'component.activityExecutor.enablingConditions'|wfLocale}}</span>\r\n                </label>\r\n                <div class=\"farris-input-wrap\">\r\n                  <div class=\"input-group\">\r\n                    <input type=\"text\" class=\"form-control\" [(ngModel)]=\"condition\" name=\"conditon\" [readOnly]=\"true\" />\r\n                    <div class=\"input-group-append\">\r\n                      <span class=\"input-group-text\" (click)=\"editConditon()\" style=\"background: #FFF;\">\r\n                        <i class=\"f-icon f-icon-lookup\"></i>\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"farris-feedback valid-feedback\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n</div>\r\n\r\n<farris-dialog #allActivityDialog [buttons]=\"buttonRef\" [width]=\"700\" [height]=\"520\" title=\"{{'component.activityExecutor.activityList'|wfLocale}}\">\r\n  <div class=\"f-utils-fill-flex-column farris-overflow-y-auto h-100 m-2\">\r\n    <farris-datagrid #allActivityTable [columns]=\"cols\" [data]=\"designerUIState.userActList\"  [idField]=\"'Id'\" [fit]=\"true\"\r\n                     [fitColumns]=\"true\" [pagination]='false' [multiSelect]=\"true\" [showCheckbox]=\"true\"\r\n                     [checkOnSelect]=\"true\" [selectOnCheck]=\"true\">\r\n    </farris-datagrid>\r\n  </div>\r\n</farris-dialog>\r\n<ng-template #buttonRef>\r\n  <button class=\"btn btn-sm btn-default\" (click)=\"allActivityDialog.close()\">{{'component.activityExecutor.clickCancel'|wfLocale}}</button>\r\n  <button class=\"btn btn-sm btn-primary mx-2\" (click)=\"activitiesSelect()\">{{'component.activityExecutor.clickOK'|wfLocale}}</button>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
ActivityExecutorPerformerComponent.ctorParameters = () => [
    { type: NgZone },
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
ActivityExecutorPerformerComponent.propDecorators = {
    cls: [{ type: HostBinding, args: ['class',] }],
    inputGroup: [{ type: ViewChild, args: ['inputGroup',] }],
    allActivityDialog: [{ type: ViewChild, args: ['allActivityDialog',] }],
    allActivityTable: [{ type: ViewChild, args: ['allActivityTable',] }]
};
if (false) {
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.cls;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.showClearButton;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.activityExecutors;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.condition;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.cols;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.inputGroup;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.allActivityDialog;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.allActivityTable;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.ngZone;
    /** @type {?} */
    ActivityExecutorPerformerComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    ActivityExecutorPerformerComponent.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aXZpdHktZXhlY3V0b3ItcGVyZm9ybWVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvcGVyZm9ybWVyL3ZpZXdzL2FjdGl2aXR5LWV4ZWN1dG9yLXBlcmZvcm1lci9hY3Rpdml0eS1leGVjdXRvci1wZXJmb3JtZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM1SSxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFDLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxZQUFZLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUNsRixPQUFPLEVBQUMsc0JBQXNCLEVBQUMsTUFBTSwwQ0FBMEMsQ0FBQztBQUNoRixPQUFPLEVBQUMsMkJBQTJCLEVBQUMsTUFBTSwwQ0FBMEMsQ0FBQztBQUNyRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0scURBQXFELENBQUM7QUFXdEcsTUFBTSxPQUFPLGtDQUFrQzs7Ozs7Ozs7OztJQWU3QyxZQUNVLE1BQWMsRUFDZixlQUF1QyxFQUN0QyxJQUF1QixFQUNYLEdBQXNCLEVBQ2YsUUFBZ0IsRUFDUixTQUFjLEVBQzdCLFVBQXdCO1FBTnBDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZixvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDdEMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDWCxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUNmLGFBQVEsR0FB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TyxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDaEMsQ0FBQzs7O1lBcEpGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsZ0NBQWdDO2dCQUMxQywwb0lBQTJEO2dCQUUzRCxTQUFTLEVBQUU7b0JBQ1IsWUFBWTtpQkFDZDs7YUFDRjs7OztZQWhCMEIsTUFBTTtZQUl6QixzQkFBc0I7WUFEUixpQkFBaUI7WUFIZ0MsaUJBQWlCLHVCQW9DbkYsUUFBUTt5Q0FDUixNQUFNLFNBQUMsU0FBUzs0Q0FDaEIsTUFBTSxTQUFDLGlCQUFpQjtZQWhDRCxZQUFZLHVCQWlDbkMsUUFBUTs7O2tCQXJCVixXQUFXLFNBQUMsT0FBTzt5QkFVbkIsU0FBUyxTQUFDLFlBQVk7Z0NBQ3RCLFNBQVMsU0FBQyxtQkFBbUI7K0JBQzdCLFNBQVMsU0FBQyxrQkFBa0I7Ozs7SUFaN0IsaURBQytCOztJQUMvQiw2REFBd0I7O0lBQ3hCLCtEQUFzRDs7SUFDdEQsdURBQWtCOztJQUNsQixrREFHRTs7SUFFRix3REFBZ0Q7O0lBQ2hELCtEQUFtRTs7SUFDbkUsOERBQW1FOzs7OztJQUdqRSxvREFBc0I7O0lBQ3RCLDZEQUE4Qzs7Ozs7SUFDOUMsa0RBQStCOzs7OztJQUMvQixpREFBMEM7Ozs7O0lBQzFDLHNEQUEyQzs7Ozs7SUFDM0MsdURBQWlEOzs7OztJQUNqRCx3REFBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgT25Jbml0LCBOZ1pvbmUsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSG9zdEJpbmRpbmcsIENoYW5nZURldGVjdG9yUmVmLCBPcHRpb25hbCwgSW5qZWN0LCBMT0NBTEVfSUR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0RpYWxvZ0NvbXBvbmVudH0gZnJvbSBcIkBmYXJyaXMvdWktZGlhbG9nXCI7XHJcbmltcG9ydCB7RGF0YWdyaWRDb21wb25lbnR9IGZyb20gXCJAZmFycmlzL3VpLWRhdGFncmlkXCI7XHJcbmltcG9ydCB7RXhwckVkaXRNb2RlLCBFeHByZXNzaW9uU2VydmljZSwgSW5qZWN0ZWRUeXBlfSBmcm9tIFwiQGdzcC1zdmMvZXhwcmVzc2lvblwiO1xyXG5pbXBvcnQge1Byb2Nlc3NEZXNpZ25lclVJU3RhdGV9IGZyb20gXCIuLi8uLi8uLi8uLi9hcHAvcHJvY2Vzcy1kZXNpZ25lci51aXN0YXRlXCI7XHJcbmltcG9ydCB7QWN0aXZpdHlFeGVjdXRvclBhcnRpY2lwYW50fSBmcm9tIFwiLi9lbnRpdGllcy9hY3Rpdml0eS1leGVjdXRvci5wYXJ0aWNpcGFudFwiO1xyXG5pbXBvcnQgeyBXRl9MQU5HX1JFU09VUkNFUywgV2ZMb2NhbGVQaXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4vaTE4bi9waXBlL3dmLXByb2Nlc3MtZWRpdG9yLWxvY2FsZS5waXBlJztcclxuaW1wb3J0IHsgV0ZfUFJPQ0VTU19FRElUT1JfTEFOR19SRVNPVVJDRVMgfSBmcm9tICcuLi8uLi8uLi8uLi9pMThuL2Fzc2V0cy9sYW5nLnJlc291cmNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXBwLWFjdGl2aXR5LWhhbmRsZXItcGVyZm9ybWVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYWN0aXZpdHktZXhlY3V0b3ItcGVyZm9ybWVyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9hY3Rpdml0eS1leGVjdXRvci1wZXJmb3JtZXIuY29tcG9uZW50LmNzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBY3Rpdml0eUV4ZWN1dG9yUGVyZm9ybWVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzJylcclxuICBjbHMgPSAnZC1mbGV4IGZsZXgtZmlsbCBoLTEwMCc7XHJcbiAgc2hvd0NsZWFyQnV0dG9uID0gZmFsc2U7XHJcbiAgYWN0aXZpdHlFeGVjdXRvcnM6IEFjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudFtdID0gW107XHJcbiAgY29uZGl0aW9uOiBzdHJpbmc7XHJcbiAgY29scyA9IFtcclxuICAgIHsgdGl0bGU6IHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hY3Rpdml0eUV4ZWN1dG9yLm5hbWUnKSwgZmllbGQ6ICdOYW1lJywgd2lkdGg6IDYwIH0sXHJcbiAgICB7IHRpdGxlOiAnSUQnLCBmaWVsZDogJ0lkJywgd2lkdGg6IDkwIH1cclxuICBdO1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dEdyb3VwJykgaW5wdXRHcm91cDogRWxlbWVudFJlZjtcclxuICBAVmlld0NoaWxkKCdhbGxBY3Rpdml0eURpYWxvZycpIGFsbEFjdGl2aXR5RGlhbG9nOiBEaWFsb2dDb21wb25lbnQ7XHJcbiAgQFZpZXdDaGlsZCgnYWxsQWN0aXZpdHlUYWJsZScpIGFsbEFjdGl2aXR5VGFibGU6IERhdGFncmlkQ29tcG9uZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXHJcbiAgICBwdWJsaWMgZGVzaWduZXJVSVN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBleHByOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcclxuICAgIEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZUlkOiBzdHJpbmcsXHJcbiAgICBASW5qZWN0KFdGX0xBTkdfUkVTT1VSQ0VTKSBwcml2YXRlIHJlc291cmNlczogYW55LFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsb2NhbGVQaXBlOiBXZkxvY2FsZVBpcGUsXHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvY2FsZVBpcGUgPSB0aGlzLmxvY2FsZVBpcGUgfHwgbmV3IFdmTG9jYWxlUGlwZShsb2NhbGVJZCwgcmVzb3VyY2VzKTtcclxuICAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgdGhpcy5pbnB1dEdyb3VwLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICAnbW91c2VlbnRlcicsXHJcbiAgICAgICAgdGhpcy5vbk1vdXNlRW50ZXIuYmluZCh0aGlzKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLmlucHV0R3JvdXAubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICAgICdtb3VzZWxlYXZlJyxcclxuICAgICAgICB0aGlzLm9uTW91c2VMZWF2ZS5iaW5kKHRoaXMpXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG9uTW91c2VFbnRlcihldmVudCkge1xyXG4gICAgdGhpcy5zaG93Q2xlYXJCdXR0b24gPSB0cnVlO1xyXG4gICAgaWYgKHRoaXMuc2hvd0NsZWFyQnV0dG9uKSB7XHJcbiAgICAgIHRoaXMudG9nZ2xlQ2xlYXJJY29uKGV2ZW50LCB0cnVlKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25Nb3VzZUxlYXZlKGV2ZW50KSB7XHJcbiAgICB0aGlzLnNob3dDbGVhckJ1dHRvbiA9IGZhbHNlO1xyXG4gICAgdGhpcy50b2dnbGVDbGVhckljb24oZXZlbnQsIGZhbHNlKTtcclxuICB9XHJcbiAgcHJpdmF0ZSB0b2dnbGVDbGVhckljb24oZXZlbnQ6IGFueSwgaXNTaG93ID0gZmFsc2UpIHtcclxuICAgIGNvbnN0IHN0ciA9IGlzU2hvdyA/ICcnIDogJ25vbmUnO1xyXG4gICAgY29uc3QgY2xlYXJJY29uID0gZXZlbnQudGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1ncm91cC1jbGVhcicpO1xyXG4gICAgaWYgKGNsZWFySWNvbikge1xyXG4gICAgICBjbGVhckljb24uc3R5bGUuZGlzcGxheSA9IHN0cjtcclxuICAgIH1cclxuICB9XHJcbiAgY2xlYXIoZGF0YTogYW55KSB7XHJcbiAgICB0aGlzLmFjdGl2aXR5RXhlY3V0b3JzID0gW107XHJcbiAgfVxyXG4gIHNlbGVjdFVzZXJzKGRhdGE6IGFueSkge1xyXG4gICAgLy8g5bey5Yqe55So5oi3XHJcbiAgICBjb25zdCBzZWxlY3RlZFVzZXIgPSBbXTtcclxuICAgIGlmKHRoaXMuYWN0aXZpdHlFeGVjdXRvcnMgJiYgdGhpcy5hY3Rpdml0eUV4ZWN1dG9ycy5sZW5ndGggPiAwKXtcclxuICAgICAgZm9yKGNvbnN0IGhhbmRsZXIgb2YgdGhpcy5hY3Rpdml0eUV4ZWN1dG9ycykge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgIElkOiBoYW5kbGVyLmFjdGl2aXR5RGVmSWQsXHJcbiAgICAgICAgICAgIE5hbWU6IGhhbmRsZXIuYWN0aXZpdHlEZWZOYW1lXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgaWQ6IGhhbmRsZXIuYWN0aXZpdHlEZWZJZFxyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxlY3RlZFVzZXIucHVzaChkYXRhKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5hbGxBY3Rpdml0eVRhYmxlLnNldEN1cnJlbnRQYWdlckRhdGEoc2VsZWN0ZWRVc2VyKTtcclxuICAgIHRoaXMuYWxsQWN0aXZpdHlEaWFsb2cuc2hvdygpO1xyXG4gIH1cclxuICBlZGl0Q29uZGl0b24oKSB7XHJcbiAgICAvLyB0aGlzLmV4cHIuY2xlYXJDb250ZXh0KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc2NoZW1hIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXMpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkU2NoZW1hKCdTY2hlbWEnLCBzY2hlbWEpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzICYmIHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzWzBdO1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRJbmplY3RlZEVudGl0eShlbnRpdHlUeXBlLm5hbWUsICdTY2hlbWEnLFxyXG4gICAgICAgICAgZW50aXR5VHlwZS5uYW1lLCBJbmplY3RlZFR5cGUuRW50aXR5VHlwZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCBjb250ZXh0ID0gbmV3IEFycmF5KCk7XHJcbiAgICBjb250ZXh0ID0gdGhpcy5kZXNpZ25lclVJU3RhdGUuYWRkQ29udGV4dChjb250ZXh0KTtcclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zdWJBY3Rpdml0eUNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLnN1YkFjdGl2aXR5Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuYWN0aXZpdHlDb21wb25lbnRDb250ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgZm9yIChjb25zdCB2YXJpYWJsZSBvZiB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5hY3Rpdml0eUNvbXBvbmVudENvbnRleHQpIHtcclxuICAgICAgICBpZiAoIWNvbnRleHQuc29tZShjID0+IGMua2V5ID09PSB2YXJpYWJsZS5rZXkpKSB7XHJcbiAgICAgICAgICBjb250ZXh0LnB1c2godmFyaWFibGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHYgb2YgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRDb250ZXh0KHYpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmV4cHIuc2V0RWRpdFBhdHRlcm4oRXhwckVkaXRNb2RlLkNvbmRpdGlvbmFsKTsgLy8g6KGo6L6+5byP5bGV546w5qih5byP77ya6buY6K6k566A5piT54mIXHJcbiAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQodGhpcy5jb25kaXRpb24pO1xyXG4gICAgdGhpcy5leHByLmJ1aWxkRXhwcmVzc2lvbigpLnRoZW4oKGV4cHJlc3Npb25pbmZvOiBzdHJpbmcpID0+IHtcclxuICAgICAgdGhpcy5jb25kaXRpb24gPSBleHByZXNzaW9uaW5mbztcclxuICAgICAgLy/ngrnlh7vnoa7lrprlkI7vvIzljrvpmaTooajovr7lvI/ph4zpnaLnmoTmlrDlop7nmoTkuIrkuIvmloflj5jph49cclxuICAgICAgaWYoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzID0gdGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzLmZpbHRlcih4ID0+ICFjb250ZXh0LnNvbWUoeSA9PiB5LmtleSA9PT0geC5rZXkpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhY3Rpdml0aWVzU2VsZWN0KCkge1xyXG4gICAgY29uc3Qgc2VsZWN0ZWRBY3Rpdml0aWVzID0gdGhpcy5hbGxBY3Rpdml0eVRhYmxlLmNoZWNrZWRzO1xyXG4gICAgdGhpcy5hY3Rpdml0eUV4ZWN1dG9ycyA9IHNlbGVjdGVkQWN0aXZpdGllcy5tYXAoYWN0aXZpdHkgPT4ge1xyXG4gICAgICBjb25zdCBoYW5kbGVyID0gbmV3IEFjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudChhY3Rpdml0eS5kYXRhLklkLCBhY3Rpdml0eS5kYXRhLk5hbWUsICd3Zi5BY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnRFeHByZXNzaW9uJyk7XHJcbiAgICAgIGhhbmRsZXIucGVyZm9ybWVyTmFtZSA9ICc8JyArIGFjdGl2aXR5LmRhdGEuTmFtZSArIHRoaXMubG9jYWxlUGlwZS50cmFuc2Zvcm0oJ2NvbXBvbmVudC5hY3Rpdml0eUV4ZWN1dG9yLmV2ZW50SGFuZGxlcicpO1xyXG4gICAgICBoYW5kbGVyLmFjdGl2aXR5RGVmSWQgPSBhY3Rpdml0eS5kYXRhLklkO1xyXG4gICAgICBoYW5kbGVyLmFjdGl2aXR5RGVmTmFtZSA9IGFjdGl2aXR5LmRhdGEuTmFtZTtcclxuICAgICAgaGFuZGxlci5jb25kaXRpb24gPSB0aGlzLmNvbmRpdGlvbjtcclxuICAgICAgcmV0dXJuIGhhbmRsZXI7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuYWxsQWN0aXZpdHlEaWFsb2cuY2xvc2UoKTtcclxuICB9XHJcbiAgZ2V0UGVyZm9ybWVycygpIHtcclxuICAgIHRoaXMuYWN0aXZpdHlFeGVjdXRvcnMubWFwKHggPT4geC5jb25kaXRpb24gPSB0aGlzLmNvbmRpdGlvbik7XHJcbiAgICByZXR1cm4gdGhpcy5hY3Rpdml0eUV4ZWN1dG9ycztcclxuICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, EventEmitter, Inject, Injector, Input, LOCALE_ID, Optional, Output, TemplateRef, ViewChild } from '@angular/core';
import { HttpService } from '@ecp-caf/caf-common';
import { MessagerService } from '@farris/ui-messager';
import { ExprEditMode, ExpressionService, InjectedType } from '@gsp-svc/expression';
import { ProcessDesignerUIState } from '../../app/process-designer.uistate';
import { CheckCondition } from './check-condition';
import { WF_LANG_RESOURCES, WfLocalePipe } from '../../i18n/pipe/wf-process-editor-locale.pipe';
export class CheckConditionComponent {
    /**
     * @param {?} injector
     * @param {?} message
     * @param {?} designerUIState
     * @param {?} expr
     * @param {?} http
     * @param {?} cdr
     * @param {?} localeId
     * @param {?} resources
     * @param {?} localePipe
     */
    constructor(injector, message, designerUIState, expr, http, cdr, localeId, resources, localePipe) {
        this.injector = injector;
        this.message = message;
        this.designerUIState = designerUIState;
        this.expr = expr;
        this.http = http;
        this.cdr = cdr;
        this.localeId = localeId;
        this.resources = resources;
        this.localePipe = localePipe;
        this.groupIcon = '<i class="f-icon f-icon-lookup"></i>';
        this.closeModal = new EventEmitter();
        this.submitModal = new EventEmitter();
        this.languages = [
            { code: 'zh-CHS', name: this.localePipe.transform('component.checkCondition.zhChs') },
            { code: 'zh-CHT', name: this.localePipe.transform('component.checkCondition.zhCht') },
            { code: 'en', name: this.localePipe.transform('component.checkCondition.en') }
        ];
        this.activityBeforeStarted = new CheckCondition('ACTIVITY_BEFORE_STARTED');
        this.activityBeforeCompleted = new CheckCondition('ACTIVITY_BEFORE_COMPLETED');
        this.modalConfig = {
            title: this.localePipe.transform('component.checkCondition.checkCondition'),
            width: 440,
            height: 460,
            showButtons: true
        };
        this.localePipe = this.localePipe || new WfLocalePipe(localeId, resources);
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set value(data) {
        if (data && data.length > 0) {
            console.log(data);
            this.activityBeforeStarted = data.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d.checkTime === 'ACTIVITY_BEFORE_STARTED')) || new CheckCondition('ACTIVITY_BEFORE_STARTED');
            this.activityBeforeCompleted = data.find((/**
             * @param {?} d
             * @return {?}
             */
            d => d.checkTime === 'ACTIVITY_BEFORE_COMPLETED')) || new CheckCondition('ACTIVITY_BEFORE_COMPLETED');
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} checkTime
     * @return {?}
     */
    editCondition(checkTime) {
        /** @type {?} */
        let context = new Array();
        // if(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage')) {
        //   context.push(this.expr.exprEntity.contextEntities.find(x => x.key === 'CurrentLanguage'));
        // }
        // this.expr.clearContext();
        if (this.designerUIState.schemas.length > 0) {
            for (const schema of this.designerUIState.schemas) {
                this.expr.addSchema('Schema', schema);
            }
            if (this.designerUIState.schemas[0].entityTypes && this.designerUIState.schemas[0].entityTypes.length > 0) {
                /** @type {?} */
                const entityType = this.designerUIState.schemas[0].entityTypes[0];
                this.expr.addInjectedEntity(entityType.name, 'Schema', entityType.name, InjectedType.EntityType);
            }
        }
        context = this.designerUIState.addContext(context);
        if (this.designerUIState.subActivityContext.length > 0) {
            for (const variable of this.designerUIState.subActivityContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (this.designerUIState.activityComponentContext.length > 0) {
            for (const variable of this.designerUIState.activityComponentContext) {
                if (!context.some((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => c.key === variable.key))) {
                    context.push(variable);
                }
            }
        }
        if (context.length > 0) {
            for (const v of context) {
                this.expr.addContext(v);
            }
        }
        /** @type {?} */
        const text = checkTime === 'ACTIVITY_BEFORE_STARTED' ? this.activityBeforeStarted.value : this.activityBeforeCompleted.value;
        this.expr.addExpressionText(text);
        this.expr.setEditPattern(ExprEditMode.Conditional); // 默认打开简易表达式编辑器
        this.expr.buildExpression().then((/**
         * @param {?} cond
         * @return {?}
         */
        (cond) => {
            if (checkTime === 'ACTIVITY_BEFORE_STARTED') {
                this.activityBeforeStarted.value = cond;
            }
            else {
                this.activityBeforeCompleted.value = cond;
            }
            //点击确定后，去除表达式里面的新增的上下文变量
            if (context.length > 0) {
                this.expr.exprEntity.contextEntities = this.expr.exprEntity.contextEntities.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                x => !context.some((/**
                 * @param {?} y
                 * @return {?}
                 */
                y => y.key === x.key))));
            }
        }));
    }
    /**
     * @param {?} checkTime
     * @return {?}
     */
    clearCondition(checkTime) {
        if (checkTime === 'ACTIVITY_BEFORE_STARTED') {
            this.activityBeforeStarted.value = null;
        }
        else {
            this.activityBeforeCompleted.value = null;
        }
    }
    /**
     * @return {?}
     */
    clickOK() {
        /** @type {?} */
        const checkConditions = new Array();
        if (this.activityBeforeStarted.value || this.activityBeforeStarted.errorTips) {
            checkConditions.push(this.activityBeforeStarted);
        }
        if (this.activityBeforeCompleted.value || this.activityBeforeCompleted.errorTips) {
            checkConditions.push(this.activityBeforeCompleted);
        }
        /** @type {?} */
        const object = { value: checkConditions, parameters: null };
        this.submitModal.emit(object);
    }
    /**
     * @return {?}
     */
    clickCancel() {
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    validator() {
    }
}
CheckConditionComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-check-condition',
                template: "<div class=\"f-page\">\r\n  <section class=\"f-page-main d-flex flex-column\">\r\n    <farris-section class=\"pt-0 f-section-form f-section-in-mainsubcard\" mainTitle=\"{{'component.checkCondition.nodeEntry'|wfLocale}}\" [enableAccordion]=\"'default'\"\r\n      [enableMaximize]=\"false\">\r\n      <div class=\"f-form-layout farris-form mx-3\">\r\n        <fieldset class=\"f-section-formgroup\">\r\n          <div class=\"f-section-formgroup-inputs\">\r\n            <div class=\"col-12\">\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-text\">{{'component.checkCondition.activityBeforeStarted' | wfLocale}}</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap\">\r\n                    <input-group [editable]=\"false\" [(ngModel)]=\"activityBeforeStarted.value\" name= \"activityBeforeStarted\" (clickHandle)=\"editCondition('ACTIVITY_BEFORE_STARTED')\" [groupText]=\"groupIcon\" (clear)=\"clearCondition('ACTIVITY_BEFORE_STARTED')\"></input-group>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"col-12\">\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\"></span>\r\n                    <span class=\"farris-label-text\">{{'component.checkCondition.enterErrorTips' | wfLocale}}</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap\">\r\n                    <language-textbox [languages]=\"languages\" [(ngModel)]=\"activityBeforeStarted.errorTips\" name=\"activityBeforeStartedErrorTips\"></language-textbox>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </fieldset>\r\n      </div>\r\n    </farris-section>\r\n    <farris-section class=\"pt-0 f-section-form f-section-in-mainsubcard\" mainTitle=\"{{'component.checkCondition.activityBeforeCompleted'|wfLocale}}\" [enableAccordion]=\"'default'\"\r\n      [enableMaximize]=\"false\" [fill]=\"true\">\r\n      <div class=\"f-form-layout farris-form mx-3\">\r\n        <fieldset class=\"f-section-formgroup\">\r\n          <div class=\"f-section-formgroup-inputs\">\r\n            <div class=\"col-12\">\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-text\">{{'component.checkCondition.activityBeforeCompletedValue' | wfLocale}}</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap\">\r\n                    <input-group [editable]=\"false\" [(ngModel)]=\"activityBeforeCompleted.value\" name= \"activityBeforeCompleted\" (clickHandle)=\"editCondition('ACTIVITY_BEFORE_COMPLETED')\" [groupText]=\"groupIcon\" (clear)=\"clearCondition('ACTIVITY_BEFORE_COMPLETED')\"></input-group>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"col-12\">\r\n              <div class=\"farris-group-wrap\">\r\n                <div class=\"form-group farris-form-group\">\r\n                  <label class=\"col-form-label\">\r\n                    <span class=\"farris-label-info text-danger\"></span>\r\n                    <span class=\"farris-label-text\">{{'component.checkCondition.leaveErrorTips' | wfLocale}}</span>\r\n                  </label>\r\n                  <div class=\"farris-input-wrap\">\r\n                    <language-textbox [languages]=\"languages\" [(ngModel)]=\"activityBeforeCompleted.errorTips\" name=\"activityBeforeCompletedErrorTips\"></language-textbox>\r\n                    <div class=\"farris-feedback valid-feedback\"></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </fieldset>\r\n      </div>\r\n    </farris-section>\r\n  </section>\r\n</div>\r\n\r\n<ng-template #iconSelectFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary btn-sm mx-2\" (click)=\"clickCancel()\">{{'component.checkCondition.clickCancel' | wfLocale}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary btn-sm mx-2\" (click)=\"clickOK()\">{{'component.checkCondition.clickOK' | wfLocale}}</button>\r\n</ng-template>\r\n",
                providers: [
                    WfLocalePipe,
                ],
                styles: [""]
            }] }
];
/** @nocollapse */
CheckConditionComponent.ctorParameters = () => [
    { type: Injector },
    { type: MessagerService },
    { type: ProcessDesignerUIState },
    { type: ExpressionService },
    { type: HttpService },
    { type: ChangeDetectorRef, decorators: [{ type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [WF_LANG_RESOURCES,] }] },
    { type: WfLocalePipe, decorators: [{ type: Optional }] }
];
CheckConditionComponent.propDecorators = {
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    value: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['iconSelectFooter',] }]
};
if (false) {
    /** @type {?} */
    CheckConditionComponent.prototype.groupIcon;
    /** @type {?} */
    CheckConditionComponent.prototype.closeModal;
    /** @type {?} */
    CheckConditionComponent.prototype.submitModal;
    /** @type {?} */
    CheckConditionComponent.prototype.languages;
    /** @type {?} */
    CheckConditionComponent.prototype.modalFooter;
    /** @type {?} */
    CheckConditionComponent.prototype.activityBeforeStarted;
    /** @type {?} */
    CheckConditionComponent.prototype.activityBeforeCompleted;
    /** @type {?} */
    CheckConditionComponent.prototype.modalConfig;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.message;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.designerUIState;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.expr;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.localeId;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.resources;
    /**
     * @type {?}
     * @private
     */
    CheckConditionComponent.prototype.localePipe;
}
export class CheckConditionConverter {
    /**
     * @param {?} localePipe
     */
    constructor(localePipe) {
        this.localePipe = localePipe;
    }
    /**
     * @param {?} data
     * @return {?}
     */
    convertTo(data) {
        if (data && data.length > 0) {
            return this.localePipe.transform("component.checkCondition.set");
        }
        return this.localePipe.transform("component.checkCondition.notSet");
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    CheckConditionConverter.prototype.localePipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2stY29uZGl0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvdmlld3MvY2hlY2stY29uZGl0aW9uL2NoZWNrLWNvbmRpdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBVSxRQUFRLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakssT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLFlBQVksRUFBYSxNQUFNLHFCQUFxQixDQUFDO0FBQy9GLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLE1BQU0sK0NBQStDLENBQUM7QUFXaEcsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7Ozs7Ozs7O0lBa0NsQyxZQUNVLFFBQWtCLEVBQ2xCLE9BQXdCLEVBQ3hCLGVBQXVDLEVBQ3ZDLElBQXVCLEVBQ3ZCLElBQWlCLEVBQ0wsR0FBc0IsRUFDZixRQUFnQixFQUNSLFNBQWMsRUFDN0IsVUFBd0I7UUFScEMsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixZQUFPLEdBQVAsT0FBTyxDQUFpQjtRQUN4QixvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFDdkMsU0FBSSxHQUFKLElBQUksQ0FBbUI7UUFDdkIsU0FBSSxHQUFKLElB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QUU1RCw2Q0FBK0M7O0lBQy9DLDhDQUFnRDs7SUFXaEQsNENBSUU7O0lBRUYsOENBQTZEOztJQUU3RCx3REFBc0Y7O0lBQ3RGLDBEQUEwRjs7SUFFMUYsOENBS0U7Ozs7O0lBR0EsMkNBQTBCOzs7OztJQUMxQiwwQ0FBZ0M7Ozs7O0lBQ2hDLGtEQUErQzs7Ozs7SUFDL0MsdUNBQStCOzs7OztJQUMvQix1Q0FBeUI7Ozs7O0lBQ3pCLHNDQUEwQzs7Ozs7SUFDMUMsMkNBQTJDOzs7OztJQUMzQyw0Q0FBaUQ7Ozs7O0lBQ2pELDZDQUE0Qzs7QUF3RmhELE1BQU0sT0FBTyx1QkFBdUI7Ozs7SUFDbEMsWUFDVSxVQUF3QjtRQUF4QixlQUFVLEdBQVYsVUFBVSxDQUFjO0lBQzlCLENBQUM7Ozs7O0lBRUwsU0FBUyxDQUFDLElBQVM7UUFDakIsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1NBQ2xFO1FBQ0QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7Q0FDRjs7Ozs7O0lBVEcsNkNBQWdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIEluamVjdG9yLCBJbnB1dCwgTE9DQUxFX0lELCBPbkluaXQsIE9wdGlvbmFsLCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IFR5cGVDb252ZXJ0ZXIgfSBmcm9tICdAZmFycmlzL2lkZS1wcm9wZXJ0eS1wYW5lbCc7XHJcbmltcG9ydCB7IEV4cHJFZGl0TW9kZSwgRXhwcmVzc2lvblNlcnZpY2UsIEluamVjdGVkVHlwZSwgVmFyRW50aXR5IH0gZnJvbSAnQGdzcC1zdmMvZXhwcmVzc2lvbic7XHJcbmltcG9ydCB7IFByb2Nlc3NEZXNpZ25lclVJU3RhdGUgfSBmcm9tICcuLi8uLi9hcHAvcHJvY2Vzcy1kZXNpZ25lci51aXN0YXRlJztcclxuaW1wb3J0IHsgQ2hlY2tDb25kaXRpb24gfSBmcm9tICcuL2NoZWNrLWNvbmRpdGlvbic7XHJcbmltcG9ydCB7IFdGX0xBTkdfUkVTT1VSQ0VTLCBXZkxvY2FsZVBpcGUgfSBmcm9tICcuLi8uLi9pMThuL3BpcGUvd2YtcHJvY2Vzcy1lZGl0b3ItbG9jYWxlLnBpcGUnO1xyXG5pbXBvcnQgeyBXRl9QUk9DRVNTX0VESVRPUl9MQU5HX1JFU09VUkNFUyB9IGZyb20gJy4uLy4uL2kxOG4vYXNzZXRzL2xhbmcucmVzb3VyY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItY2hlY2stY29uZGl0aW9uJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vY2hlY2stY29uZGl0aW9uLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9jaGVjay1jb25kaXRpb24uY29tcG9uZW50LmNzcyddLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgIFdmTG9jYWxlUGlwZSxcclxuICBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDaGVja0NvbmRpdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIHJlYWRvbmx5IGdyb3VwSWNvbiA9ICc8aSBjbGFzcz1cImYtaWNvbiBmLWljb24tbG9va3VwXCI+PC9pPic7XHJcblxyXG4gIEBPdXRwdXQoKSBjbG9zZU1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgQE91dHB1dCgpIHN1Ym1pdE1vZGFsID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IHZhbHVlKGRhdGE6IENoZWNrQ29uZGl0aW9uW10pIHtcclxuICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgdGhpcy5hY3Rpdml0eUJlZm9yZVN0YXJ0ZWQgPSBkYXRhLmZpbmQoZCA9PiBkLmNoZWNrVGltZSA9PT0gJ0FDVElWSVRZX0JFRk9SRV9TVEFSVEVEJykgfHwgbmV3IENoZWNrQ29uZGl0aW9uKCdBQ1RJVklUWV9CRUZPUkVfU1RBUlRFRCcpO1xyXG4gICAgICB0aGlzLmFjdGl2aXR5QmVmb3JlQ29tcGxldGVkID0gZGF0YS5maW5kKGQgPT4gZC5jaGVja1RpbWUgPT09ICdBQ1RJVklUWV9CRUZPUkVfQ09NUExFVEVEJykgfHwgbmV3IENoZWNrQ29uZGl0aW9uKCdBQ1RJVklUWV9CRUZPUkVfQ09NUExFVEVEJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsYW5ndWFnZXMgPSBbXHJcbiAgICB7IGNvZGU6ICd6aC1DSFMnLCBuYW1lOiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKCdjb21wb25lbnQuY2hlY2tDb25kaXRpb24uemhDaHMnKSB9LFxyXG4gICAgeyBjb2RlOiAnemgtQ0hUJywgbmFtZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmNoZWNrQ29uZGl0aW9uLnpoQ2h0JykgfSxcclxuICAgIHsgY29kZTogJ2VuJywgbmFtZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmNoZWNrQ29uZGl0aW9uLmVuJykgfVxyXG4gIF07XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2ljb25TZWxlY3RGb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgYWN0aXZpdHlCZWZvcmVTdGFydGVkOiBDaGVja0NvbmRpdGlvbiA9IG5ldyBDaGVja0NvbmRpdGlvbignQUNUSVZJVFlfQkVGT1JFX1NUQVJURUQnKTtcclxuICBhY3Rpdml0eUJlZm9yZUNvbXBsZXRlZDogQ2hlY2tDb25kaXRpb24gPSBuZXcgQ2hlY2tDb25kaXRpb24oJ0FDVElWSVRZX0JFRk9SRV9DT01QTEVURUQnKTtcclxuXHJcbiAgbW9kYWxDb25maWcgPSB7XHJcbiAgICB0aXRsZTogdGhpcy5sb2NhbGVQaXBlLnRyYW5zZm9ybSgnY29tcG9uZW50LmNoZWNrQ29uZGl0aW9uLmNoZWNrQ29uZGl0aW9uJyksXHJcbiAgICB3aWR0aDogNDQwLFxyXG4gICAgaGVpZ2h0OiA0NjAsXHJcbiAgICBzaG93QnV0dG9uczogdHJ1ZVxyXG4gIH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgZGVzaWduZXJVSVN0YXRlOiBQcm9jZXNzRGVzaWduZXJVSVN0YXRlLFxyXG4gICAgcHJpdmF0ZSBleHByOiBFeHByZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cFNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBASW5qZWN0KExPQ0FMRV9JRCkgcHJpdmF0ZSBsb2NhbGVJZDogc3RyaW5nLFxyXG4gICAgQEluamVjdChXRl9MQU5HX1JFU09VUkNFUykgcHJpdmF0ZSByZXNvdXJjZXM6IGFueSxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbG9jYWxlUGlwZTogV2ZMb2NhbGVQaXBlLFxyXG4gICkge1xyXG4gICAgdGhpcy5sb2NhbGVQaXBlID0gdGhpcy5sb2NhbGVQaXBlIHx8IG5ldyBXZkxvY2FsZVBpcGUobG9jYWxlSWQsIHJlc291cmNlcyk7XHJcbiAgIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgfVxyXG5cclxuICBlZGl0Q29uZGl0aW9uKGNoZWNrVGltZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgY29udGV4dCA9IG5ldyBBcnJheTxWYXJFbnRpdHk+KCk7XHJcbiAgICAvLyBpZih0aGlzLmV4cHIuZXhwckVudGl0eS5jb250ZXh0RW50aXRpZXMuZmluZCh4ID0+IHgua2V5ID09PSAnQ3VycmVudExhbmd1YWdlJykpIHtcclxuICAgIC8vICAgY29udGV4dC5wdXNoKHRoaXMuZXhwci5leHByRW50aXR5LmNvbnRleHRFbnRpdGllcy5maW5kKHggPT4geC5rZXkgPT09ICdDdXJyZW50TGFuZ3VhZ2UnKSk7XHJcbiAgICAvLyB9XHJcbiAgICAvLyB0aGlzLmV4cHIuY2xlYXJDb250ZXh0KCk7XHJcbiAgICBpZiAodGhpcy5kZXNpZ25lclVJU3RhdGUuc2NoZW1hcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc2NoZW1hIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXMpIHtcclxuICAgICAgICB0aGlzLmV4cHIuYWRkU2NoZW1hKCdTY2hlbWEnLCBzY2hlbWEpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzICYmIHRoaXMuZGVzaWduZXJVSVN0YXRlLnNjaGVtYXNbMF0uZW50aXR5VHlwZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5zY2hlbWFzWzBdLmVudGl0eVR5cGVzWzBdO1xyXG4gICAgICAgIHRoaXMuZXhwci5hZGRJbmplY3RlZEVudGl0eShlbnRpdHlUeXBlLm5hbWUsICdTY2hlbWEnLFxyXG4gICAgICAgICAgZW50aXR5VHlwZS5uYW1lLCBJbmplY3RlZFR5cGUuRW50aXR5VHlwZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnRleHQgPSB0aGlzLmRlc2lnbmVyVUlTdGF0ZS5hZGRDb250ZXh0KGNvbnRleHQpO1xyXG4gICAgaWYgKHRoaXMuZGVzaWduZXJVSVN0YXRlLnN1YkFjdGl2aXR5Q29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdmFyaWFibGUgb2YgdGhpcy5kZXNpZ25lclVJU3RhdGUuc3ViQWN0aXZpdHlDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCFjb250ZXh0LnNvbWUoYyA9PiBjLmtleSA9PT0gdmFyaWFibGUua2V5KSkge1xyXG4gICAgICAgICAgY29udGV4dC5wdXNoKHZhcmlhYmxlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlc2lnbmVyVUlTdGF0ZS5hY3Rpdml0eUNvbXBvbmVudENvbnRleHQubGVuZ3RoID4gMCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlIG9mIHRoaXMuZGVzaWduZXJVSVN0YXRlLmFjdGl2aXR5Q29tcG9uZW50Q29udGV4dCkge1xyXG4gICAgICAgIGlmICghY29udGV4dC5zb21lKGMgPT4gYy5rZXkgPT09IHZhcmlhYmxlLmtleSkpIHtcclxuICAgICAgICAgIGNvbnRleHQucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGZvciAoY29uc3QgdiBvZiBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5leHByLmFkZENvbnRleHQodik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IHRleHQgPSBjaGVja1RpbWUgPT09ICdBQ1RJVklUWV9CRUZPUkVfU1RBUlRFRCcgPyB0aGlzLmFjdGl2aXR5QmVmb3JlU3RhcnRlZC52YWx1ZSA6IHRoaXMuYWN0aXZpdHlCZWZvcmVDb21wbGV0ZWQudmFsdWU7XHJcbiAgICB0aGlzLmV4cHIuYWRkRXhwcmVzc2lvblRleHQodGV4dCk7XHJcbiAgICB0aGlzLmV4cHIuc2V0RWRpdFBhdHRlcm4oRXhwckVkaXRNb2RlLkNvbmRpdGlvbmFsKTsgLy8g6buY6K6k5omT5byA566A5piT6KGo6L6+5byP57yW6L6R5ZmoXHJcbiAgICB0aGlzLmV4cHIuYnVpbGRFeHByZXNzaW9uKCkudGhlbigoY29uZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmIChjaGVja1RpbWUgPT09ICdBQ1RJVklUWV9CRUZPUkVfU1RBUlRFRCcpIHtcclxuICAgICAgICB0aGlzLmFjdGl2aXR5QmVmb3JlU3RhcnRlZC52YWx1ZSA9IGNvbmQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5hY3Rpdml0eUJlZm9yZUNvbXBsZXRlZC52YWx1ZSA9IGNvbmQ7XHJcbiAgICAgIH1cclxuICAgICAgLy/ngrnlh7vnoa7lrprlkI7vvIzljrvpmaTooajovr7lvI/ph4zpnaLnmoTmlrDlop7nmoTkuIrkuIvmloflj5jph49cclxuICAgICAgaWYoY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzID0gdGhpcy5leHByLmV4cHJFbnRpdHkuY29udGV4dEVudGl0aWVzLmZpbHRlcih4ID0+ICFjb250ZXh0LnNvbWUoeSA9PiB5LmtleSA9PT0geC5rZXkpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbGVhckNvbmRpdGlvbihjaGVja1RpbWU6IHN0cmluZykge1xyXG4gICAgaWYgKGNoZWNrVGltZSA9PT0gJ0FDVElWSVRZX0JFRk9SRV9TVEFSVEVEJykge1xyXG4gICAgICB0aGlzLmFjdGl2aXR5QmVmb3JlU3RhcnRlZC52YWx1ZSA9IG51bGw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmFjdGl2aXR5QmVmb3JlQ29tcGxldGVkLnZhbHVlID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsaWNrT0soKSB7XHJcbiAgICBjb25zdCBjaGVja0NvbmRpdGlvbnMgPSBuZXcgQXJyYXkoKTtcclxuICAgIGlmICh0aGlzLmFjdGl2aXR5QmVmb3JlU3RhcnRlZC52YWx1ZSB8fCB0aGlzLmFjdGl2aXR5QmVmb3JlU3RhcnRlZC5lcnJvclRpcHMpIHtcclxuICAgICAgY2hlY2tDb25kaXRpb25zLnB1c2godGhpcy5hY3Rpdml0eUJlZm9yZVN0YXJ0ZWQpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuYWN0aXZpdHlCZWZvcmVDb21wbGV0ZWQudmFsdWUgfHwgdGhpcy5hY3Rpdml0eUJlZm9yZUNvbXBsZXRlZC5lcnJvclRpcHMpIHtcclxuICAgICAgY2hlY2tDb25kaXRpb25zLnB1c2godGhpcy5hY3Rpdml0eUJlZm9yZUNvbXBsZXRlZCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBvYmplY3QgPSB7IHZhbHVlOiBjaGVja0NvbmRpdGlvbnMsIHBhcmFtZXRlcnM6IG51bGwgfTtcclxuICAgIHRoaXMuc3VibWl0TW9kYWwuZW1pdChvYmplY3QpO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICB0aGlzLmNsb3NlTW9kYWwuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgdmFsaWRhdG9yKCkge1xyXG5cclxuICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIENoZWNrQ29uZGl0aW9uQ29udmVydGVyIGltcGxlbWVudHMgVHlwZUNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxvY2FsZVBpcGU6IFdmTG9jYWxlUGlwZVxyXG4gICkgeyB9XHJcblxyXG4gIGNvbnZlcnRUbyhkYXRhOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmNoZWNrQ29uZGl0aW9uLnNldFwiKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmxvY2FsZVBpcGUudHJhbnNmb3JtKFwiY29tcG9uZW50LmNoZWNrQ29uZGl0aW9uLm5vdFNldFwiKTtcclxuICB9XHJcbn1cclxuXHJcbiJdfQ==
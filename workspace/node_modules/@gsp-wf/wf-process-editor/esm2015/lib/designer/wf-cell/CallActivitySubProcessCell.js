/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { CallActivitySubProcess, Component, BackWardRule, ActualParameter, VariableSetting, SemanticExpression, CounterSignRule, Condition } from "@gsp-wf/wf-process-model";
import { PropertyHelper } from "./PropertyHelper";
import { BpmnModelHelper, Expression, FlowNodeState, MultiInstanceLoopCharacteristics } from "@edp-pmf/bpmn-model";
import { WfConstants } from "../WfConstants";
import { CallActivitySubProcessPropertyKeys } from "./property-keys/CallActivitySubProcessPropertyKeys";
/**
 * 子流程活动节点
 */
export class CallActivitySubProcessCell extends NodeCell {
    /**
     * @param {?=} value
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(value, geometry, style) {
        super(value, geometry, style);
        this.clrTypeId = CallActivitySubProcessCell.CLR_TYPE_ID;
        this.name = "子流程";
        this.nameLanguage = {
            "zh-CHS": "子流程",
            "zh-CHT": "子流程",
            "en": "Sub-Process",
        };
        this.imgUrls = {
            [FlowNodeState.Default]: WfConstants.IMAGE_PATH + "/sub.png",
            [FlowNodeState.Selected]: WfConstants.IMAGE_PATH + "/sub_select.svg",
        };
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    createFlowElement(flowElt) {
        /** @type {?} */
        const flowNode = (/** @type {?} */ (super.createFlowElement(flowElt)));
        flowNode.Id = "CallActivitySubProcess" + BpmnModelHelper.GenerateElementId();
        return flowNode;
    }
    /**
     * @return {?}
     */
    getFarrisPropConfig() {
        /** @type {?} */
        let act = this.flowElement;
        // 组织属性框
        /** @type {?} */
        let basicProperty = new ElementPropertyConfig();
        /** @type {?} */
        let activityProperty = new ElementPropertyConfig();
        /** @type {?} */
        let propertyData = {};
        // 基本属性（名称）
        basicProperty.categoryId = 'basicProperty';
        basicProperty.categoryName = mxResources.get('basicInformation');
        basicProperty.tabId = 'basic';
        basicProperty.tabName = mxResources.get('basicAttributes');
        basicProperty.properties = [
            { propertyID: CallActivitySubProcessPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: CallActivitySubProcessPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: CallActivitySubProcessPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        // 活动选项（表单定义+活动构件）
        activityProperty.categoryId = 'activityProperty';
        activityProperty.categoryName = mxResources.get('activityProperty');
        activityProperty.tabId = 'basic';
        activityProperty.tabName = mxResources.get('basicAttributes');
        activityProperty.properties = [
            { propertyID: CallActivitySubProcessPropertyKeys.callActivitySubProcess, propertyName: mxResources.get('callActivitySubProcess'), propertyType: 'modal' },
            { propertyID: CallActivitySubProcessPropertyKeys.variableSettings, propertyName: mxResources.get('variableSettings'), propertyType: 'modal' },
            { propertyID: CallActivitySubProcessPropertyKeys.BackWardRule, propertyName: mxResources.get('backWardRule'), propertyType: 'modal' },
            { propertyID: CallActivitySubProcessPropertyKeys.MultiInstanceLoopCharacteristics, propertyName: mxResources.get('multiInstanceLoopCharacteristics'), propertyType: 'modal' }
        ];
        propertyData[CallActivitySubProcessPropertyKeys.Id] = act.Id;
        propertyData[CallActivitySubProcessPropertyKeys.ClrTypeID] = act.ClrTypeID;
        propertyData[CallActivitySubProcessPropertyKeys.Name] = act.Name;
        propertyData[CallActivitySubProcessPropertyKeys.NameLanguage] = act.NameLanguage || {
            "zh-CHS": act.Name,
        };
        propertyData[CallActivitySubProcessPropertyKeys.callActivitySubProcess] = {
            calledBizDefKey: act.calledBizDefKey,
            calledElement: act.CalledElement,
            inheritVariables: act.inheritVariables,
            inheritBizDataId: act.inheritBizDataId,
            bizDataId: act.bizDataId,
            aifProcessCode: act.aifProcessCode,
            useAutoCreationData: act.useAutoCreationData,
        };
        propertyData[CallActivitySubProcessPropertyKeys.BackWardRule] = act.backWardRule;
        propertyData[CallActivitySubProcessPropertyKeys.variableSettings] = PropertyHelper.getVariableSettings(act.Model, act.variableSettings);
        propertyData[CallActivitySubProcessPropertyKeys.MultiInstanceLoopCharacteristics] = act.LoopCharacteristics;
        return {
            propertyConfig: [basicProperty, activityProperty],
            propertyData: propertyData
        };
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    updateProps(obj) {
        /** @type {?} */
        const subProcess = this.flowElement;
        /** @type {?} */
        const propertyId = obj.propertyID;
        switch (propertyId) {
            case CallActivitySubProcessPropertyKeys.callActivitySubProcess:
                this.updateSubProcessConfig(subProcess, obj);
                break;
            case CallActivitySubProcessPropertyKeys.BackWardRule:
                this.updateBackWardRule(subProcess, obj);
                break;
            case CallActivitySubProcessPropertyKeys.variableSettings:
                this.updateVariableSettings(subProcess, obj);
                break;
            case CallActivitySubProcessPropertyKeys.MultiInstanceLoopCharacteristics:
                this.updateMultiInstanceLoopCharacteristic(subProcess, obj);
                break;
            default:
                super.updateProps(obj);
                break;
        }
    }
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    updateSubProcessConfig(subProcess, obj) {
        /** @type {?} */
        const config = obj.propertyValue;
        if (subProcess) {
            subProcess.calledBizDefKey = config.calledBizDefKey;
            subProcess.CalledElement = config.calledElement;
            subProcess.inheritBizDataId = config.inheritBizDataId;
            subProcess.inheritVariables = config.inheritVariables;
            subProcess.bizDataId = config.bizDataId;
            subProcess.aifProcessCode = config.aifProcessCode;
            subProcess.useAutoCreationData = config.useAutoCreationData;
        }
    }
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    updateBackWardRule(subProcess, obj) {
        /** @type {?} */
        const data = obj.propertyValue;
        /** @type {?} */
        let backWardRule = new BackWardRule(subProcess.Model);
        backWardRule.TargetRef = data.TargetRef;
        backWardRule.SelectTargetAble = data.SelectTargetAble;
        backWardRule.WaitReturn = data.WaitReturn;
        backWardRule.ResubmitEffect = data.ResubmitEffect;
        backWardRule.DynamicBackWardRuleAble = data.DynamicBackWardRuleAble;
        backWardRule.SelectTargetList = data.SelectTargetList;
        subProcess.backWardRule = backWardRule;
    }
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    updateVariableSettings(subProcess, obj) {
        /** @type {?} */
        const bpmnModel = this.flowElement.Model;
        /** @type {?} */
        const extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        if (subProcess.variableSettings && subProcess.variableSettings.length > 0) {
            for (const v of subProcess.variableSettings) {
                if (v.tag === 'component') {
                    /** @type {?} */
                    const i = extendElements.findIndex((/**
                     * @param {?} e
                     * @return {?}
                     */
                    e => (e instanceof Component && e.Id === v.value)));
                    extendElements.splice(i, 1);
                }
            }
        }
        subProcess.variableSettings = new Array();
        /** @type {?} */
        const variables = (/** @type {?} */ (obj.propertyValue));
        if (variables && variables.length > 0) {
            for (const v of variables) {
                /** @type {?} */
                const variableSetting = new VariableSetting(bpmnModel);
                // variableSetting.variableId = v.variableId;
                variableSetting.variableCode = v.variableCode;
                variableSetting.variableName = v.variableName;
                variableSetting.tag = v.tag;
                variableSetting.executionTime = v.executionTime;
                variableSetting.value = v.value;
                variableSetting.valueText = v.valueText;
                subProcess.variableSettings.push(variableSetting);
                if (variableSetting.tag === 'component') {
                    /** @type {?} */
                    const c = v.component;
                    if (c) {
                        /** @type {?} */
                        let cpt = new Component(bpmnModel);
                        cpt.MetadataId = c.MetadataId;
                        cpt.MethodCode = c.MethodCode;
                        cpt.Id = c.Id;
                        cpt.Name = c.Name;
                        cpt.ActualParameters = new Array();
                        if (c.ActualParameters && c.ActualParameters.length > 0) {
                            for (let a of c.ActualParameters) {
                                /** @type {?} */
                                let parameter = new ActualParameter(bpmnModel, a.Name, a.Value);
                                parameter.Tag = a.Tag;
                                cpt.ActualParameters.push(parameter);
                            }
                        }
                        extendElements.push(cpt);
                    }
                }
            }
        }
    }
    /**
     * @param {?} subProcess
     * @param {?} obj
     * @return {?}
     */
    updateMultiInstanceLoopCharacteristic(subProcess, obj) {
        /** @type {?} */
        const data = obj.propertyValue;
        /** @type {?} */
        let loopCharacteristics = new MultiInstanceLoopCharacteristics(subProcess.Model);
        loopCharacteristics.enable = data.enable;
        loopCharacteristics.sequential = data.sequential;
        loopCharacteristics.loopCardinality = data.loopCardinality;
        loopCharacteristics.completionCondition = data.completionCondition;
        loopCharacteristics.completionConditionRules = data.completionConditionRules;
        subProcess.LoopCharacteristics = loopCharacteristics;
        if (obj.propertyValue) {
            /** @type {?} */
            const data = obj.propertyValue;
            /** @type {?} */
            let loopCharacteristics = new MultiInstanceLoopCharacteristics(subProcess.Model);
            loopCharacteristics.enable = data.enable;
            loopCharacteristics.sequential = data.sequential;
            loopCharacteristics.loopCardinality = new Expression(subProcess.Model);
            if (data.loopCardinality) {
                /** @type {?} */
                let variableExpression = new SemanticExpression(subProcess.Model);
                variableExpression.Value = data.loopCardinality;
                loopCharacteristics.loopCardinality.MexExpression = variableExpression;
            }
            loopCharacteristics.completionCondition = data.completionCondition;
            /** @type {?} */
            let rules = (/** @type {?} */ (data.completionConditionRules));
            loopCharacteristics.completionConditionRules = null;
            if (rules && rules.length > 0) {
                loopCharacteristics.completionConditionRules = new Array();
                for (let rule of rules) {
                    /** @type {?} */
                    let counterSignRule = new CounterSignRule(subProcess.Model);
                    /** @type {?} */
                    let condition = new Condition(subProcess.Model);
                    condition.Value = rule.CompletionCondition.Value;
                    counterSignRule.ConclusionValue = rule.ConclusionValue;
                    counterSignRule.CalculateType = rule.CalculateType;
                    counterSignRule.ConditionValue = rule.ConditionValue;
                    counterSignRule.WaitAllVotes = rule.WaitAllVotes;
                    counterSignRule.CompletionCondition = condition;
                    loopCharacteristics.completionConditionRules.push(counterSignRule);
                }
            }
            subProcess.LoopCharacteristics = loopCharacteristics;
        }
    }
}
CallActivitySubProcessCell.CLR_TYPE_ID = CallActivitySubProcess.Clr_Type_ID;
if (false) {
    /** @type {?} */
    CallActivitySubProcessCell.CLR_TYPE_ID;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.clrTypeId;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.name;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.nameLanguage;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.flowElement;
    /** @type {?} */
    CallActivitySubProcessCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc0NlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2Rlc2lnbmVyL3dmLWNlbGwvQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc0NlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUscUJBQXFCLEVBQTRCLE1BQU0sc0JBQXNCLENBQUM7QUFDakcsT0FBTyxFQUFhLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzdELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsa0JBQWtCLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdLLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuSCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGtDQUFrQyxFQUFFLE1BQU0sb0RBQW9ELENBQUM7Ozs7QUFLeEcsTUFBTSxPQUFPLDBCQUEyQixTQUFRLFFBQVE7Ozs7OztJQWdCcEQsWUFBWSxLQUFXLEVBQUUsUUFBK0IsRUFBRSxLQUFjO1FBQ3BFLEtBQUssQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBaEJsQyxjQUFTLEdBQVcsMEJBQTBCLENBQUMsV0FBVyxDQUFDO1FBQzNELFNBQUksR0FBVyxLQUFLLENBQUM7UUFDckIsaUJBQVksR0FBZ0M7WUFDMUMsUUFBUSxFQUFFLEtBQUs7WUFDZixRQUFRLEVBQUUsS0FBSztZQUNmLElBQUksRUFBRSxhQUFhO1NBQ3RCLENBQUM7UUFJ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QUM7Z0JBQzVFLEtBQUksSUFBSSxJQUFJLElBQUksS0FBSyxFQUFFOzt3QkFDZixlQUFlLEdBQUcsSUFBSSxlQUFlLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQzs7d0JBQ3ZELFNBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO29CQUMvQyxTQUFTLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUM7b0JBQ2pELGVBQWUsQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztvQkFDdkQsZUFBZSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO29CQUNuRCxlQUFlLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7b0JBQ3JELGVBQWUsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztvQkFDakQsZUFBZSxDQUFDLG1CQUFtQixHQUFHLFNBQVMsQ0FBQztvQkFDaEQsbUJBQW1CLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO2lCQUN0RTthQUNKO1lBQ0QsVUFBVSxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO1NBQ3hEO0lBQ0wsQ0FBQzs7QUFwTk0sc0NBQVcsR0FBVyxzQkFBc0IsQ0FBQyxXQUFXLENBQUM7OztJQUFoRSx1Q0FBZ0U7O0lBUGhFLCtDQUEyRDs7SUFDM0QsMENBQXFCOztJQUNyQixrREFJQTs7SUFFQSxpREFBb0M7O0lBRXBDLDZDQUdFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTm9kZUNlbGwsIEVsZW1lbnRQcm9wZXJ0eUNvbmZpZywgRmFycmlzUHJvcENvbmZpZ1dpdGhEYXRhIH0gZnJvbSBcIkBlZHAtcG1mL2dyYXBoZWRpdG9yXCI7XHJcbmltcG9ydCB7IE14R3JhcGhOUywgbXhSZXNvdXJjZXMgfSBmcm9tIFwiQGVkcC1wbWYvbXhncmFwaC10c1wiO1xyXG5pbXBvcnQgeyBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzLCBDb21wb25lbnQsIEJhY2tXYXJkUnVsZSwgQWN0dWFsUGFyYW1ldGVyLCBWYXJpYWJsZVNldHRpbmcsIFNlbWFudGljRXhwcmVzc2lvbiwgQ291bnRlclNpZ25SdWxlLCBDb25kaXRpb24gfSBmcm9tIFwiQGdzcC13Zi93Zi1wcm9jZXNzLW1vZGVsXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5SGVscGVyIH0gZnJvbSBcIi4vUHJvcGVydHlIZWxwZXJcIjtcclxuaW1wb3J0IHsgQnBtbk1vZGVsSGVscGVyLCBFeHByZXNzaW9uLCBGbG93Tm9kZVN0YXRlLCBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcyB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IFdmQ29uc3RhbnRzIH0gZnJvbSBcIi4uL1dmQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMgfSBmcm9tIFwiLi9wcm9wZXJ0eS1rZXlzL0NhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXNcIjtcclxuXHJcbi8qKlxyXG4gKiDlrZDmtYHnqIvmtLvliqjoioLngrlcclxuICovXHJcbmV4cG9ydCBjbGFzcyBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzQ2VsbCBleHRlbmRzIE5vZGVDZWxsIHtcclxuICAgIGNsclR5cGVJZDogc3RyaW5nID0gQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc0NlbGwuQ0xSX1RZUEVfSUQ7XHJcbiAgICBuYW1lOiBzdHJpbmcgPSBcIuWtkOa1geeoi1wiO1xyXG4gICAgbmFtZUxhbmd1YWdlOiB7IFtsYW5nOiBzdHJpbmddOiBzdHJpbmc7IH0gPSB7XHJcbiAgICAgIFwiemgtQ0hTXCI6IFwi5a2Q5rWB56iLXCIsXHJcbiAgICAgIFwiemgtQ0hUXCI6IFwi5a2Q5rWB56iLXCIsXHJcbiAgICAgIFwiZW5cIjogXCJTdWItUHJvY2Vzc1wiLFxyXG4gIH07XHJcbiAgICBzdGF0aWMgQ0xSX1RZUEVfSUQ6IHN0cmluZyA9IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MuQ2xyX1R5cGVfSUQ7XHJcbiAgICBmbG93RWxlbWVudDogQ2FsbEFjdGl2aXR5U3ViUHJvY2VzcztcclxuXHJcbiAgICBpbWdVcmxzID0ge1xyXG4gICAgICAgIFtGbG93Tm9kZVN0YXRlLkRlZmF1bHRdOiBXZkNvbnN0YW50cy5JTUFHRV9QQVRIICsgXCIvc3ViLnBuZ1wiLFxyXG4gICAgICAgIFtGbG93Tm9kZVN0YXRlLlNlbGVjdGVkXTogV2ZDb25zdGFudHMuSU1BR0VfUEFUSCArIFwiL3N1Yl9zZWxlY3Quc3ZnXCIsXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZhbHVlPzogYW55LCBnZW9tZXRyeT86IE14R3JhcGhOUy5teEdlb21ldHJ5LCBzdHlsZT86IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKHZhbHVlLCBnZW9tZXRyeSwgc3R5bGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUZsb3dFbGVtZW50KGZsb3dFbHQ/OiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgY29uc3QgZmxvd05vZGUgPSBzdXBlci5jcmVhdGVGbG93RWxlbWVudChmbG93RWx0KSBhcyBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzO1xyXG4gICAgICAgIGZsb3dOb2RlLklkID0gXCJDYWxsQWN0aXZpdHlTdWJQcm9jZXNzXCIgKyBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZsb3dOb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEZhcnJpc1Byb3BDb25maWcoKTogRmFycmlzUHJvcENvbmZpZ1dpdGhEYXRhIHtcclxuICAgICAgICBsZXQgYWN0ID0gdGhpcy5mbG93RWxlbWVudDtcclxuICAgICAgICAvLyDnu4Tnu4flsZ7mgKfmoYZcclxuICAgICAgICBsZXQgYmFzaWNQcm9wZXJ0eTogRWxlbWVudFByb3BlcnR5Q29uZmlnID0gbmV3IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZygpO1xyXG4gICAgICAgIGxldCBhY3Rpdml0eVByb3BlcnR5OiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IHByb3BlcnR5RGF0YTogYW55ID0ge307XHJcblxyXG4gICAgICAgIC8vIOWfuuacrOWxnuaAp++8iOWQjeensO+8iVxyXG4gICAgICAgIGJhc2ljUHJvcGVydHkuY2F0ZWdvcnlJZCA9ICdiYXNpY1Byb3BlcnR5JztcclxuICAgICAgICBiYXNpY1Byb3BlcnR5LmNhdGVnb3J5TmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNJbmZvcm1hdGlvbicpO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkudGFiSWQgPSAnYmFzaWMnO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkudGFiTmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNBdHRyaWJ1dGVzJylcclxuICAgICAgICBiYXNpY1Byb3BlcnR5LnByb3BlcnRpZXMgPSBbXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5OYW1lLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnbmFtZScpLCBwcm9wZXJ0eVR5cGU6ICdzdHJpbmcnLCB2aXNpYmxlOiAhdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5OYW1lTGFuZ3VhZ2UsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCduYW1lTGFuZ3VhZ2UnKSwgcHJvcGVydHlUeXBlOiAnbXVsdGlMYW5ndWFnZScsIHZpc2libGU6IHRoaXMuZWRpdG9yVWkubXVsdGlMYW5nRW5hYmxlZCB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuSWQsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdpZCcpLCBwcm9wZXJ0eVR5cGU6ICdzdHJpbmcnLCByZWFkb25seTogdHJ1ZSB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgLy8g5rS75Yqo6YCJ6aG577yI6KGo5Y2V5a6a5LmJK+a0u+WKqOaehOS7tu+8iVxyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkuY2F0ZWdvcnlJZCA9ICdhY3Rpdml0eVByb3BlcnR5JztcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LmNhdGVnb3J5TmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYWN0aXZpdHlQcm9wZXJ0eScpO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkudGFiSWQgPSAnYmFzaWMnO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkudGFiTmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNBdHRyaWJ1dGVzJylcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LnByb3BlcnRpZXMgPSBbXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5jYWxsQWN0aXZpdHlTdWJQcm9jZXNzLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnY2FsbEFjdGl2aXR5U3ViUHJvY2VzcycpLCBwcm9wZXJ0eVR5cGU6ICdtb2RhbCcgfSxcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3MsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCd2YXJpYWJsZVNldHRpbmdzJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuQmFja1dhcmRSdWxlLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnYmFja1dhcmRSdWxlJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuTXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3MsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdtdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcycpLCBwcm9wZXJ0eVR5cGU6ICdtb2RhbCcgfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIHByb3BlcnR5RGF0YVtDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLklkXSA9IGFjdC5JZDtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5DbHJUeXBlSURdID0gYWN0LkNsclR5cGVJRDtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5OYW1lXSA9IGFjdC5OYW1lO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZV0gPSBhY3QuTmFtZUxhbmd1YWdlIHx8IHtcclxuICAgICAgICAgICAgXCJ6aC1DSFNcIjogYWN0Lk5hbWUsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5jYWxsQWN0aXZpdHlTdWJQcm9jZXNzXSA9IHtcclxuICAgICAgICAgICAgY2FsbGVkQml6RGVmS2V5OiBhY3QuY2FsbGVkQml6RGVmS2V5LFxyXG4gICAgICAgICAgICBjYWxsZWRFbGVtZW50OiBhY3QuQ2FsbGVkRWxlbWVudCxcclxuICAgICAgICAgICAgaW5oZXJpdFZhcmlhYmxlczogYWN0LmluaGVyaXRWYXJpYWJsZXMsXHJcbiAgICAgICAgICAgIGluaGVyaXRCaXpEYXRhSWQ6IGFjdC5pbmhlcml0Qml6RGF0YUlkLFxyXG4gICAgICAgICAgICBiaXpEYXRhSWQ6IGFjdC5iaXpEYXRhSWQsXHJcbiAgICAgICAgICAgIGFpZlByb2Nlc3NDb2RlOiBhY3QuYWlmUHJvY2Vzc0NvZGUsXHJcbiAgICAgICAgICAgIHVzZUF1dG9DcmVhdGlvbkRhdGE6IGFjdC51c2VBdXRvQ3JlYXRpb25EYXRhLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0NhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuQmFja1dhcmRSdWxlXSA9IGFjdC5iYWNrV2FyZFJ1bGU7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0NhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMudmFyaWFibGVTZXR0aW5nc10gPSBQcm9wZXJ0eUhlbHBlci5nZXRWYXJpYWJsZVNldHRpbmdzKGFjdC5Nb2RlbCwgYWN0LnZhcmlhYmxlU2V0dGluZ3MpO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLk11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzXSA9IGFjdC5Mb29wQ2hhcmFjdGVyaXN0aWNzO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByb3BlcnR5Q29uZmlnOiBbYmFzaWNQcm9wZXJ0eSwgYWN0aXZpdHlQcm9wZXJ0eV0sXHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YTogcHJvcGVydHlEYXRhXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BzKG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3Qgc3ViUHJvY2VzcyA9IHRoaXMuZmxvd0VsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydHlJZDogc3RyaW5nID0gb2JqLnByb3BlcnR5SUQ7XHJcbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUlkKSB7XHJcbiAgICAgICAgICAgIGNhc2UgQ2FsbEFjdGl2aXR5U3ViUHJvY2Vzc1Byb3BlcnR5S2V5cy5jYWxsQWN0aXZpdHlTdWJQcm9jZXNzOlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdWJQcm9jZXNzQ29uZmlnKHN1YlByb2Nlc3MsIG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLkJhY2tXYXJkUnVsZTpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQmFja1dhcmRSdWxlKHN1YlByb2Nlc3MsIG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzUHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZhcmlhYmxlU2V0dGluZ3Moc3ViUHJvY2Vzcywgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENhbGxBY3Rpdml0eVN1YlByb2Nlc3NQcm9wZXJ0eUtleXMuTXVsdGlJbnN0YW5jZUxvb3BDaGFyYWN0ZXJpc3RpY3M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWMoc3ViUHJvY2Vzcywgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgc3VwZXIudXBkYXRlUHJvcHMob2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTdWJQcm9jZXNzQ29uZmlnKHN1YlByb2Nlc3M6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnOiBhbnkgPSBvYmoucHJvcGVydHlWYWx1ZTtcclxuICAgICAgICBpZiAoc3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICBzdWJQcm9jZXNzLmNhbGxlZEJpekRlZktleSA9IGNvbmZpZy5jYWxsZWRCaXpEZWZLZXk7XHJcbiAgICAgICAgICAgIHN1YlByb2Nlc3MuQ2FsbGVkRWxlbWVudCA9IGNvbmZpZy5jYWxsZWRFbGVtZW50O1xyXG4gICAgICAgICAgICBzdWJQcm9jZXNzLmluaGVyaXRCaXpEYXRhSWQgPSBjb25maWcuaW5oZXJpdEJpekRhdGFJZDtcclxuICAgICAgICAgICAgc3ViUHJvY2Vzcy5pbmhlcml0VmFyaWFibGVzID0gY29uZmlnLmluaGVyaXRWYXJpYWJsZXM7XHJcbiAgICAgICAgICAgIHN1YlByb2Nlc3MuYml6RGF0YUlkID0gY29uZmlnLmJpekRhdGFJZDtcclxuICAgICAgICAgICAgc3ViUHJvY2Vzcy5haWZQcm9jZXNzQ29kZSA9IGNvbmZpZy5haWZQcm9jZXNzQ29kZTtcclxuICAgICAgICAgICAgc3ViUHJvY2Vzcy51c2VBdXRvQ3JlYXRpb25EYXRhID0gY29uZmlnLnVzZUF1dG9DcmVhdGlvbkRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUJhY2tXYXJkUnVsZShzdWJQcm9jZXNzOiBDYWxsQWN0aXZpdHlTdWJQcm9jZXNzLCBvYmo6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBvYmoucHJvcGVydHlWYWx1ZTtcclxuICAgICAgICBsZXQgYmFja1dhcmRSdWxlID0gbmV3IEJhY2tXYXJkUnVsZShzdWJQcm9jZXNzLk1vZGVsKTtcclxuICAgICAgICBiYWNrV2FyZFJ1bGUuVGFyZ2V0UmVmID0gZGF0YS5UYXJnZXRSZWY7XHJcbiAgICAgICAgYmFja1dhcmRSdWxlLlNlbGVjdFRhcmdldEFibGUgPSBkYXRhLlNlbGVjdFRhcmdldEFibGU7XHJcbiAgICAgICAgYmFja1dhcmRSdWxlLldhaXRSZXR1cm4gPSBkYXRhLldhaXRSZXR1cm47XHJcbiAgICAgICAgYmFja1dhcmRSdWxlLlJlc3VibWl0RWZmZWN0ID0gZGF0YS5SZXN1Ym1pdEVmZmVjdDtcclxuICAgICAgICBiYWNrV2FyZFJ1bGUuRHluYW1pY0JhY2tXYXJkUnVsZUFibGUgPSBkYXRhLkR5bmFtaWNCYWNrV2FyZFJ1bGVBYmxlO1xyXG4gICAgICAgIGJhY2tXYXJkUnVsZS5TZWxlY3RUYXJnZXRMaXN0ID0gZGF0YS5TZWxlY3RUYXJnZXRMaXN0O1xyXG5cclxuICAgICAgICBzdWJQcm9jZXNzLmJhY2tXYXJkUnVsZSA9IGJhY2tXYXJkUnVsZTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVWYXJpYWJsZVNldHRpbmdzKHN1YlByb2Nlc3M6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYnBtbk1vZGVsID0gdGhpcy5mbG93RWxlbWVudC5Nb2RlbDtcclxuICAgICAgICBjb25zdCBleHRlbmRFbGVtZW50cyA9IGJwbW5Nb2RlbC5EZWZhdWx0UHJvY2Vzcy5HZXRFeHRlbnNpb25FbGVtZW50cygpO1xyXG4gICAgICAgIGlmIChzdWJQcm9jZXNzLnZhcmlhYmxlU2V0dGluZ3MgJiYgc3ViUHJvY2Vzcy52YXJpYWJsZVNldHRpbmdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHN1YlByb2Nlc3MudmFyaWFibGVTZXR0aW5ncykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHYudGFnID09PSAnY29tcG9uZW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBleHRlbmRFbGVtZW50cy5maW5kSW5kZXgoZSA9PiAoZSBpbnN0YW5jZW9mIENvbXBvbmVudCAmJiBlLklkID09PSB2LnZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5kRWxlbWVudHMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1YlByb2Nlc3MudmFyaWFibGVTZXR0aW5ncyA9IG5ldyBBcnJheSgpO1xyXG5cclxuICAgICAgICBjb25zdCB2YXJpYWJsZXMgPSBvYmoucHJvcGVydHlWYWx1ZSBhcyBhbnlbXTtcclxuICAgICAgICBpZiAodmFyaWFibGVzICYmIHZhcmlhYmxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiB2YXJpYWJsZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlU2V0dGluZyA9IG5ldyBWYXJpYWJsZVNldHRpbmcoYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgIC8vIHZhcmlhYmxlU2V0dGluZy52YXJpYWJsZUlkID0gdi52YXJpYWJsZUlkO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhcmlhYmxlQ29kZSA9IHYudmFyaWFibGVDb2RlO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhcmlhYmxlTmFtZSA9IHYudmFyaWFibGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnRhZyA9IHYudGFnO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLmV4ZWN1dGlvblRpbWUgPSB2LmV4ZWN1dGlvblRpbWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFsdWUgPSB2LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhbHVlVGV4dCA9IHYudmFsdWVUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgIHN1YlByb2Nlc3MudmFyaWFibGVTZXR0aW5ncy5wdXNoKHZhcmlhYmxlU2V0dGluZyk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFyaWFibGVTZXR0aW5nLnRhZyA9PT0gJ2NvbXBvbmVudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gdi5jb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNwdCA9IG5ldyBDb21wb25lbnQoYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0Lk1ldGFkYXRhSWQgPSBjLk1ldGFkYXRhSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5NZXRob2RDb2RlID0gYy5NZXRob2RDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuSWQgPSBjLklkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuTmFtZSA9IGMuTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0LkFjdHVhbFBhcmFtZXRlcnMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMuQWN0dWFsUGFyYW1ldGVycyAmJiBjLkFjdHVhbFBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYSBvZiBjLkFjdHVhbFBhcmFtZXRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFyYW1ldGVyID0gbmV3IEFjdHVhbFBhcmFtZXRlcihicG1uTW9kZWwsIGEuTmFtZSwgYS5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyLlRhZyA9IGEuVGFnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5BY3R1YWxQYXJhbWV0ZXJzLnB1c2gocGFyYW1ldGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kRWxlbWVudHMucHVzaChjcHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljKHN1YlByb2Nlc3M6IENhbGxBY3Rpdml0eVN1YlByb2Nlc3MsIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IG9iai5wcm9wZXJ0eVZhbHVlO1xyXG4gICAgICAgIGxldCBsb29wQ2hhcmFjdGVyaXN0aWNzID0gbmV3IE11bHRpSW5zdGFuY2VMb29wQ2hhcmFjdGVyaXN0aWNzKHN1YlByb2Nlc3MuTW9kZWwpO1xyXG4gICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MuZW5hYmxlID0gZGF0YS5lbmFibGU7XHJcbiAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5zZXF1ZW50aWFsID0gZGF0YS5zZXF1ZW50aWFsO1xyXG4gICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MubG9vcENhcmRpbmFsaXR5ID0gZGF0YS5sb29wQ2FyZGluYWxpdHk7XHJcbiAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uID0gZGF0YS5jb21wbGV0aW9uQ29uZGl0aW9uO1xyXG4gICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzID0gZGF0YS5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXM7XHJcblxyXG4gICAgICAgIHN1YlByb2Nlc3MuTG9vcENoYXJhY3RlcmlzdGljcyA9IGxvb3BDaGFyYWN0ZXJpc3RpY3M7XHJcbiAgICAgICAgaWYob2JqLnByb3BlcnR5VmFsdWUpIHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IG9iai5wcm9wZXJ0eVZhbHVlO1xyXG4gICAgICAgICAgICBsZXQgbG9vcENoYXJhY3RlcmlzdGljcyA9IG5ldyBNdWx0aUluc3RhbmNlTG9vcENoYXJhY3RlcmlzdGljcyhzdWJQcm9jZXNzLk1vZGVsKTtcclxuICAgICAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5lbmFibGUgPSBkYXRhLmVuYWJsZTtcclxuICAgICAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5zZXF1ZW50aWFsID0gZGF0YS5zZXF1ZW50aWFsO1xyXG4gICAgICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLmxvb3BDYXJkaW5hbGl0eSA9IG5ldyBFeHByZXNzaW9uKHN1YlByb2Nlc3MuTW9kZWwpO1xyXG4gICAgICAgICAgICBpZihkYXRhLmxvb3BDYXJkaW5hbGl0eSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhcmlhYmxlRXhwcmVzc2lvbiA9IG5ldyBTZW1hbnRpY0V4cHJlc3Npb24oc3ViUHJvY2Vzcy5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZUV4cHJlc3Npb24uVmFsdWUgPSBkYXRhLmxvb3BDYXJkaW5hbGl0eTtcclxuICAgICAgICAgICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MubG9vcENhcmRpbmFsaXR5Lk1leEV4cHJlc3Npb24gPSB2YXJpYWJsZUV4cHJlc3Npb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uID0gZGF0YS5jb21wbGV0aW9uQ29uZGl0aW9uO1xyXG4gICAgICAgICAgICBsZXQgcnVsZXMgPSBkYXRhLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcyBhcyBhbnlbXTtcclxuICAgICAgICAgICAgbG9vcENoYXJhY3RlcmlzdGljcy5jb21wbGV0aW9uQ29uZGl0aW9uUnVsZXMgPSBudWxsO1xyXG4gICAgICAgICAgICBpZihydWxlcyAmJiBydWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBsb29wQ2hhcmFjdGVyaXN0aWNzLmNvbXBsZXRpb25Db25kaXRpb25SdWxlcyA9IG5ldyBBcnJheTxDb3VudGVyU2lnblJ1bGU+KCk7XHJcbiAgICAgICAgICAgICAgICBmb3IobGV0IHJ1bGUgb2YgcnVsZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY291bnRlclNpZ25SdWxlID0gbmV3IENvdW50ZXJTaWduUnVsZShzdWJQcm9jZXNzLk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY29uZGl0aW9uID0gbmV3IENvbmRpdGlvbihzdWJQcm9jZXNzLk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb24uVmFsdWUgPSBydWxlLkNvbXBsZXRpb25Db25kaXRpb24uVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlclNpZ25SdWxlLkNvbmNsdXNpb25WYWx1ZSA9IHJ1bGUuQ29uY2x1c2lvblZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ZXJTaWduUnVsZS5DYWxjdWxhdGVUeXBlID0gcnVsZS5DYWxjdWxhdGVUeXBlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ZXJTaWduUnVsZS5Db25kaXRpb25WYWx1ZSA9IHJ1bGUuQ29uZGl0aW9uVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRlclNpZ25SdWxlLldhaXRBbGxWb3RlcyA9IHJ1bGUuV2FpdEFsbFZvdGVzO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50ZXJTaWduUnVsZS5Db21wbGV0aW9uQ29uZGl0aW9uID0gY29uZGl0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3BDaGFyYWN0ZXJpc3RpY3MuY29tcGxldGlvbkNvbmRpdGlvblJ1bGVzLnB1c2goY291bnRlclNpZ25SdWxlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdWJQcm9jZXNzLkxvb3BDaGFyYWN0ZXJpc3RpY3MgPSBsb29wQ2hhcmFjdGVyaXN0aWNzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { BpmnModelHelper, FlowNodeState } from "@edp-pmf/bpmn-model";
import { MessageActivity, MessageNotice, Component, ActivityExecutorParticipantExpression, UserParticipantExpression, PositionParticipantExpression, VariableSetting, ActualParameter, SmsMessageTemplate, SmsMessageVariable, } from "@gsp-wf/wf-process-model";
import { PropertyHelper } from "./PropertyHelper";
import { WfConstants } from "../WfConstants";
import { MessageActivityPropertyKeys } from "./property-keys/MessageActivityPropertyKeys";
/**
 * 消息活动节点
 */
export class MessageActivityCell extends NodeCell {
    /**
     * @param {?=} value
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(value, geometry, style) {
        super(value, geometry, style);
        this.clrTypeId = MessageActivityCell.CLR_TYPE_ID;
        this.name = "消息";
        this.nameLanguage = {
            "zh-CHS": "消息",
            "zh-CHT": "消息",
            "en": "Message",
        };
        this.imgUrls = {
            [FlowNodeState.Default]: WfConstants.IMAGE_PATH + "/message.png",
            [FlowNodeState.Selected]: WfConstants.IMAGE_PATH + "/message_select.svg",
        };
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    createFlowElement(flowElt) {
        /** @type {?} */
        const flowNode = (/** @type {?} */ (super.createFlowElement(flowElt)));
        flowNode.Id = "MessageActivity" + BpmnModelHelper.GenerateElementId();
        return flowNode;
    }
    /**
     * @return {?}
     */
    getFarrisPropConfig() {
        /** @type {?} */
        let act = this.flowElement;
        /** @type {?} */
        let basicProperty = new ElementPropertyConfig();
        /** @type {?} */
        let activityProperty = new ElementPropertyConfig();
        /** @type {?} */
        let propertyData = {};
        basicProperty.categoryId = 'basicProperty';
        basicProperty.categoryName = mxResources.get('basicInformation');
        basicProperty.tabId = 'basic';
        basicProperty.tabName = mxResources.get('basicAttributes');
        basicProperty.properties = [
            { propertyID: MessageActivityPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: MessageActivityPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: MessageActivityPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        activityProperty.categoryId = 'activityProperty';
        activityProperty.categoryName = mxResources.get('activityProperty');
        activityProperty.tabId = 'basic';
        activityProperty.tabName = mxResources.get('basicAttributes');
        activityProperty.properties = [
            { propertyID: MessageActivityPropertyKeys.messageNotice, propertyName: mxResources.get('messageNotice'), propertyType: 'modal' },
            { propertyID: MessageActivityPropertyKeys.variableSettings, propertyName: mxResources.get('variableSettings'), propertyType: 'modal' }
        ];
        propertyData[MessageActivityPropertyKeys.Id] = act.Id;
        propertyData[MessageActivityPropertyKeys.ClrTypeID] = act.ClrTypeID;
        propertyData[MessageActivityPropertyKeys.Name] = act.Name;
        propertyData[MessageActivityPropertyKeys.NameLanguage] = act.NameLanguage || {
            "zh-CHS": act.Name,
        };
        propertyData[MessageActivityPropertyKeys.messageNotice] = PropertyHelper.getMessageNotices(act.messageNotices);
        propertyData[MessageActivityPropertyKeys.variableSettings] = PropertyHelper.getVariableSettings(act.Model, act.variableSettings);
        return {
            propertyConfig: [basicProperty, activityProperty],
            propertyData: propertyData
        };
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    updateProps(obj) {
        /** @type {?} */
        const messageActivity = this.flowElement;
        /** @type {?} */
        const propertyId = obj.propertyID;
        switch (propertyId) {
            case MessageActivityPropertyKeys.messageNotice:
                this.updateMessageNotices(messageActivity, obj);
                break;
            case MessageActivityPropertyKeys.variableSettings:
                this.updateVariableSettings(messageActivity, obj);
                break;
            default:
                super.updateProps(obj);
                break;
        }
    }
    /**
     * @param {?} messageActivity
     * @param {?} obj
     * @return {?}
     */
    updateMessageNotices(messageActivity, obj) {
        /** @type {?} */
        const bpmnModel = messageActivity.Model;
        /** @type {?} */
        let notices = (/** @type {?} */ (obj.propertyValue));
        messageActivity.messageNotices = new Array();
        if (notices && notices.length > 0) {
            for (let n of notices) {
                /** @type {?} */
                const messageNotice = new MessageNotice(bpmnModel);
                messageNotice.sendType = n.sendType;
                messageNotice.sendTime = n.sendTime;
                messageNotice.subject = n.subject;
                messageNotice.content = n.content;
                if (n.smsMessageTemplate) {
                    /** @type {?} */
                    const smsMessageTemplate = new SmsMessageTemplate(bpmnModel);
                    smsMessageTemplate.code = n.smsMessageTemplate.code;
                    smsMessageTemplate.content = n.smsMessageTemplate.content;
                    smsMessageTemplate.smsMessageVariables = new Array();
                    if (n.smsMessageTemplate.smsMessageVariables && n.smsMessageTemplate.smsMessageVariables.length > 0) {
                        for (const v of n.smsMessageTemplate.smsMessageVariables) {
                            /** @type {?} */
                            const variable = new SmsMessageVariable(bpmnModel);
                            variable.code = v.code;
                            variable.value = v.value;
                            variable.tag = v.tag;
                            smsMessageTemplate.smsMessageVariables.push(variable);
                        }
                    }
                    messageNotice.smsMessageTemplate = smsMessageTemplate;
                }
                // messageNotice.receiver = n.receiver;
                // messageNotice.receiverText = n.receiverText;
                if (n.receivers && n.receivers.length > 0) {
                    /** @type {?} */
                    const receivers = n.receivers.filter((/**
                     * @param {?} r
                     * @return {?}
                     */
                    (r) => r.type === 'userParticipant'
                        || (r.type === 'processParticipant' && r.processParticipant !== 'activityExecutorParticipant')));
                    /** @type {?} */
                    const participants = n.receivers.filter((/**
                     * @param {?} r
                     * @return {?}
                     */
                    (r) => r.type === 'variableParticipant' || r.type === 'positionParticipant'
                        || (r.type === 'processParticipant' && r.processParticipant === 'activityExecutorParticipant')));
                    if (receivers && receivers.length > 0) {
                        /** @type {?} */
                        let receiver = '';
                        /** @type {?} */
                        let receiverName = '';
                        for (const r of receivers) {
                            if (r.type === 'processParticipant') {
                                receiver += (r.processParticipant + ',');
                                if (r.processParticipant === 'procInstCreator') {
                                    receiverName += '流程发起人,';
                                }
                                else if (r.processParticipant === 'workItemParticipant') {
                                    receiverName += '任务接收人,';
                                }
                            }
                            else if (r.type === 'userParticipant') {
                                receiver += (r.userIds + ',');
                                receiverName += (r.userNames + ',');
                            }
                        }
                        if (receiver) {
                            receiver = receiver.substring(0, receiver.length - 1);
                        }
                        if (receiverName) {
                            receiverName = receiverName.substring(0, receiverName.length - 1);
                        }
                        messageNotice.receiver = receiver;
                        messageNotice.receiverText = receiverName;
                    }
                    if (participants && participants.length > 0) {
                        /** @type {?} */
                        const receiverExpressions = new Array();
                        for (const p of participants) {
                            if (p.type === 'processParticipant') {
                                /** @type {?} */
                                let activityExecutor = new ActivityExecutorParticipantExpression(messageActivity.Model);
                                activityExecutor.id = BpmnModelHelper.GenerateElementId();
                                activityExecutor.activityDefId = p.activityDefId;
                                activityExecutor.activityDefName = p.activityDefName;
                                receiverExpressions.push(activityExecutor);
                            }
                            if (p.type === 'variableParticipant') {
                                /** @type {?} */
                                let variableParticipant = new UserParticipantExpression(messageActivity.Model, p.variableParticipant, p.variableName, p.orgType);
                                variableParticipant.id = BpmnModelHelper.GenerateElementId();
                                variableParticipant.Tag = 'expression';
                                variableParticipant.OrgType = p.orgType;
                                receiverExpressions.push(variableParticipant);
                            }
                            if (p.type === 'positionParticipant') {
                                /** @type {?} */
                                let posiParticipant = new PositionParticipantExpression(messageActivity.Model, p.positionId, p.positionName);
                                posiParticipant.id = BpmnModelHelper.GenerateElementId();
                                posiParticipant.PositionType = p.positionType;
                                if (p.positionType === '1') {
                                    posiParticipant.OrgId = p.orgId;
                                    posiParticipant.OrgType = p.orgType;
                                }
                                receiverExpressions.push(posiParticipant);
                            }
                        }
                        messageNotice.receiverExpressions = receiverExpressions;
                    }
                }
                messageActivity.messageNotices.push(messageNotice);
            }
        }
    }
    /**
     * @param {?} messageActivity
     * @param {?} obj
     * @return {?}
     */
    updateVariableSettings(messageActivity, obj) {
        /** @type {?} */
        const bpmnModel = messageActivity.Model;
        /** @type {?} */
        const extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        if (messageActivity.variableSettings && messageActivity.variableSettings.length > 0) {
            for (const v of messageActivity.variableSettings) {
                if (v.tag === 'component') {
                    /** @type {?} */
                    const i = extendElements.findIndex((/**
                     * @param {?} e
                     * @return {?}
                     */
                    e => (e instanceof Component && e.Id === v.value)));
                    extendElements.splice(i, 1);
                }
            }
        }
        messageActivity.variableSettings = new Array();
        /** @type {?} */
        const variables = (/** @type {?} */ (obj.propertyValue));
        if (variables && variables.length > 0) {
            for (const v of variables) {
                /** @type {?} */
                const variableSetting = new VariableSetting(bpmnModel);
                // variableSetting.variableId = v.variableId;
                variableSetting.variableCode = v.variableCode;
                variableSetting.variableName = v.variableName;
                variableSetting.tag = v.tag;
                variableSetting.executionTime = v.executionTime;
                variableSetting.value = v.value;
                variableSetting.valueText = v.valueText;
                messageActivity.variableSettings.push(variableSetting);
                if (variableSetting.tag === 'component') {
                    /** @type {?} */
                    const c = v.component;
                    if (c) {
                        /** @type {?} */
                        let cpt = new Component(bpmnModel);
                        cpt.MetadataId = c.MetadataId;
                        cpt.MethodCode = c.MethodCode;
                        cpt.Id = c.Id;
                        cpt.Name = c.Name;
                        cpt.ActualParameters = new Array();
                        if (c.ActualParameters && c.ActualParameters.length > 0) {
                            for (let a of c.ActualParameters) {
                                /** @type {?} */
                                let parameter = new ActualParameter(bpmnModel, a.Name, a.Value);
                                parameter.Tag = a.Tag;
                                cpt.ActualParameters.push(parameter);
                            }
                        }
                        extendElements.push(cpt);
                    }
                }
            }
        }
    }
}
MessageActivityCell.CLR_TYPE_ID = MessageActivity.Clr_Type_ID;
if (false) {
    /** @type {?} */
    MessageActivityCell.CLR_TYPE_ID;
    /** @type {?} */
    MessageActivityCell.prototype.clrTypeId;
    /** @type {?} */
    MessageActivityCell.prototype.name;
    /** @type {?} */
    MessageActivityCell.prototype.nameLanguage;
    /** @type {?} */
    MessageActivityCell.prototype.flowElement;
    /** @type {?} */
    MessageActivityCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVzc2FnZUFjdGl2aXR5Q2VsbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvZGVzaWduZXIvd2YtY2VsbC9NZXNzYWdlQWN0aXZpdHlDZWxsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLHFCQUFxQixFQUE0QixNQUFNLHNCQUFzQixDQUFDO0FBQ2pHLE9BQU8sRUFBYSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsYUFBYSxFQUFFLFNBQVMsRUFBeUIscUNBQXFDLEVBQUUseUJBQXlCLEVBQUUsNkJBQTZCLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxrQkFBa0IsR0FBRyxNQUFNLDBCQUEwQixDQUFDO0FBQ3hSLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sNkNBQTZDLENBQUM7Ozs7QUFLMUYsTUFBTSxPQUFPLG1CQUFvQixTQUFRLFFBQVE7Ozs7OztJQWdCN0MsWUFBWSxLQUFXLEVBQUUsUUFBK0IsRUFBRSxLQUFjO1FBQ3BFLEtBQUssQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBaEJsQyxjQUFTLEdBQVcsbUJBQW1CLENBQUMsV0FBVyxDQUFDO1FBQ3BELFNBQUksR0FBVyxJQUFJLENBQUM7UUFDcEIsaUJBQVksR0FBZ0M7WUFDMUMsUUFBUSxFQUFFLElBQUk7WUFDZCxRQUFRLEVBQUUsSUFBSTtZQUNkLElBQUksRUFBRSxTQUFTO1NBQ2xCLENBQUM7UUFJQSxZQUFPLEdB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SSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUM7Z0NBQy9ELFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztnQ0FDdEIsR0FBRyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQzs2QkFDeEM7eUJBQ0o7d0JBRUQsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDNUI7aUJBQ0o7YUFDSjtTQUNKO0lBQ0wsQ0FBQzs7QUE3Tk0sK0JBQVcsR0FBVyxlQUFlLENBQUMsV0FBVyxDQUFDOzs7SUFBekQsZ0NBQXlEOztJQVB6RCx3Q0FBb0Q7O0lBQ3BELG1DQUFvQjs7SUFDcEIsMkNBSUE7O0lBRUEsMENBQTZCOztJQUU3QixzQ0FHRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vZGVDZWxsLCBFbGVtZW50UHJvcGVydHlDb25maWcsIEZhcnJpc1Byb3BDb25maWdXaXRoRGF0YSB9IGZyb20gXCJAZWRwLXBtZi9ncmFwaGVkaXRvclwiO1xyXG5pbXBvcnQgeyBNeEdyYXBoTlMsIG14UmVzb3VyY2VzIH0gZnJvbSBcIkBlZHAtcG1mL214Z3JhcGgtdHNcIjtcclxuaW1wb3J0IHsgQnBtbk1vZGVsSGVscGVyLCBGbG93Tm9kZVN0YXRlIH0gZnJvbSBcIkBlZHAtcG1mL2JwbW4tbW9kZWxcIjtcclxuaW1wb3J0IHsgTWVzc2FnZUFjdGl2aXR5LCBNZXNzYWdlTm90aWNlLCBDb21wb25lbnQsIFBhcnRpY2lwYW50RXhwcmVzc2lvbiwgQWN0aXZpdHlFeGVjdXRvclBhcnRpY2lwYW50RXhwcmVzc2lvbiwgVXNlclBhcnRpY2lwYW50RXhwcmVzc2lvbiwgUG9zaXRpb25QYXJ0aWNpcGFudEV4cHJlc3Npb24sIFZhcmlhYmxlU2V0dGluZywgQWN0dWFsUGFyYW1ldGVyLCBTbXNNZXNzYWdlVGVtcGxhdGUsIFNtc01lc3NhZ2VWYXJpYWJsZSwgfSBmcm9tIFwiQGdzcC13Zi93Zi1wcm9jZXNzLW1vZGVsXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5SGVscGVyIH0gZnJvbSBcIi4vUHJvcGVydHlIZWxwZXJcIjtcclxuaW1wb3J0IHsgV2ZDb25zdGFudHMgfSBmcm9tIFwiLi4vV2ZDb25zdGFudHNcIjtcclxuaW1wb3J0IHsgTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzIH0gZnJvbSBcIi4vcHJvcGVydHkta2V5cy9NZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXNcIjtcclxuXHJcbi8qKlxyXG4gKiDmtojmga/mtLvliqjoioLngrlcclxuICovXHJcbmV4cG9ydCBjbGFzcyBNZXNzYWdlQWN0aXZpdHlDZWxsIGV4dGVuZHMgTm9kZUNlbGwge1xyXG4gICAgY2xyVHlwZUlkOiBzdHJpbmcgPSBNZXNzYWdlQWN0aXZpdHlDZWxsLkNMUl9UWVBFX0lEO1xyXG4gICAgbmFtZTogc3RyaW5nID0gXCLmtojmga9cIjtcclxuICAgIG5hbWVMYW5ndWFnZTogeyBbbGFuZzogc3RyaW5nXTogc3RyaW5nOyB9ID0ge1xyXG4gICAgICBcInpoLUNIU1wiOiBcIua2iOaBr1wiLFxyXG4gICAgICBcInpoLUNIVFwiOiBcIua2iOaBr1wiLFxyXG4gICAgICBcImVuXCI6IFwiTWVzc2FnZVwiLFxyXG4gIH07XHJcbiAgICBzdGF0aWMgQ0xSX1RZUEVfSUQ6IHN0cmluZyA9IE1lc3NhZ2VBY3Rpdml0eS5DbHJfVHlwZV9JRDtcclxuICAgIGZsb3dFbGVtZW50OiBNZXNzYWdlQWN0aXZpdHk7XHJcblxyXG4gICAgaW1nVXJscyA9IHtcclxuICAgICAgICBbRmxvd05vZGVTdGF0ZS5EZWZhdWx0XTogV2ZDb25zdGFudHMuSU1BR0VfUEFUSCArIFwiL21lc3NhZ2UucG5nXCIsXHJcbiAgICAgICAgW0Zsb3dOb2RlU3RhdGUuU2VsZWN0ZWRdOiBXZkNvbnN0YW50cy5JTUFHRV9QQVRIICsgXCIvbWVzc2FnZV9zZWxlY3Quc3ZnXCIsXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZhbHVlPzogYW55LCBnZW9tZXRyeT86IE14R3JhcGhOUy5teEdlb21ldHJ5LCBzdHlsZT86IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKHZhbHVlLCBnZW9tZXRyeSwgc3R5bGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUZsb3dFbGVtZW50KGZsb3dFbHQ/OiBNZXNzYWdlQWN0aXZpdHkpIHtcclxuICAgICAgICBjb25zdCBmbG93Tm9kZSA9IHN1cGVyLmNyZWF0ZUZsb3dFbGVtZW50KGZsb3dFbHQpIGFzIE1lc3NhZ2VBY3Rpdml0eTtcclxuICAgICAgICBmbG93Tm9kZS5JZCA9IFwiTWVzc2FnZUFjdGl2aXR5XCIgKyBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZsb3dOb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEZhcnJpc1Byb3BDb25maWcoKTogRmFycmlzUHJvcENvbmZpZ1dpdGhEYXRhIHtcclxuICAgICAgICBsZXQgYWN0ID0gdGhpcy5mbG93RWxlbWVudDtcclxuXHJcbiAgICAgICAgbGV0IGJhc2ljUHJvcGVydHk6IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZyA9IG5ldyBFbGVtZW50UHJvcGVydHlDb25maWcoKTtcclxuICAgICAgICBsZXQgYWN0aXZpdHlQcm9wZXJ0eTogRWxlbWVudFByb3BlcnR5Q29uZmlnID0gbmV3IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZygpO1xyXG4gICAgICAgIGxldCBwcm9wZXJ0eURhdGE6IGFueSA9IHt9O1xyXG5cclxuICAgICAgICBiYXNpY1Byb3BlcnR5LmNhdGVnb3J5SWQgPSAnYmFzaWNQcm9wZXJ0eSc7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS5jYXRlZ29yeU5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2Jhc2ljSW5mb3JtYXRpb24nKTtcclxuICAgICAgICBiYXNpY1Byb3BlcnR5LnRhYklkID0gJ2Jhc2ljJztcclxuICAgICAgICBiYXNpY1Byb3BlcnR5LnRhYk5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2Jhc2ljQXR0cmlidXRlcycpXHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IE1lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5OYW1lLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnbmFtZScpLCBwcm9wZXJ0eVR5cGU6ICdzdHJpbmcnLCB2aXNpYmxlOiAhdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWVMYW5ndWFnZScpLCBwcm9wZXJ0eVR5cGU6ICdtdWx0aUxhbmd1YWdlJywgdmlzaWJsZTogdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLklkLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnaWQnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgcmVhZG9ubHk6IHRydWUgfVxyXG4gICAgICAgIF07XHJcblxyXG5cclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LmNhdGVnb3J5SWQgPSAnYWN0aXZpdHlQcm9wZXJ0eSc7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS5jYXRlZ29yeU5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2FjdGl2aXR5UHJvcGVydHknKTtcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LnRhYklkID0gJ2Jhc2ljJztcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LnRhYk5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2Jhc2ljQXR0cmlidXRlcycpXHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IE1lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5tZXNzYWdlTm90aWNlLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnbWVzc2FnZU5vdGljZScpLCBwcm9wZXJ0eVR5cGU6ICdtb2RhbCcgfSxcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBNZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXMudmFyaWFibGVTZXR0aW5ncywgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ3ZhcmlhYmxlU2V0dGluZ3MnKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBwcm9wZXJ0eURhdGFbTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLklkXSA9IGFjdC5JZDtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLkNsclR5cGVJRF0gPSBhY3QuQ2xyVHlwZUlEO1xyXG4gICAgICAgIHByb3BlcnR5RGF0YVtNZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXMuTmFtZV0gPSBhY3QuTmFtZTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZV0gPSBhY3QuTmFtZUxhbmd1YWdlIHx8IHtcclxuICAgICAgICAgICAgXCJ6aC1DSFNcIjogYWN0Lk5hbWUsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLm1lc3NhZ2VOb3RpY2VdID0gUHJvcGVydHlIZWxwZXIuZ2V0TWVzc2FnZU5vdGljZXMoYWN0Lm1lc3NhZ2VOb3RpY2VzKTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbTWVzc2FnZUFjdGl2aXR5UHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3NdID0gUHJvcGVydHlIZWxwZXIuZ2V0VmFyaWFibGVTZXR0aW5ncyhhY3QuTW9kZWwsIGFjdC52YXJpYWJsZVNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtiYXNpY1Byb3BlcnR5LCBhY3Rpdml0eVByb3BlcnR5XSxcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhOiBwcm9wZXJ0eURhdGFcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUHJvcHMob2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlQWN0aXZpdHkgPSB0aGlzLmZsb3dFbGVtZW50O1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5SWQ6IHN0cmluZyA9IG9iai5wcm9wZXJ0eUlEO1xyXG4gICAgICAgIHN3aXRjaCAocHJvcGVydHlJZCkge1xyXG4gICAgICAgICAgICBjYXNlIE1lc3NhZ2VBY3Rpdml0eVByb3BlcnR5S2V5cy5tZXNzYWdlTm90aWNlOlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVNZXNzYWdlTm90aWNlcyhtZXNzYWdlQWN0aXZpdHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBNZXNzYWdlQWN0aXZpdHlQcm9wZXJ0eUtleXMudmFyaWFibGVTZXR0aW5nczpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVmFyaWFibGVTZXR0aW5ncyhtZXNzYWdlQWN0aXZpdHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHN1cGVyLnVwZGF0ZVByb3BzKG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlTWVzc2FnZU5vdGljZXMobWVzc2FnZUFjdGl2aXR5OiBNZXNzYWdlQWN0aXZpdHksIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYnBtbk1vZGVsID0gbWVzc2FnZUFjdGl2aXR5Lk1vZGVsO1xyXG4gICAgICAgIGxldCBub3RpY2VzID0gb2JqLnByb3BlcnR5VmFsdWUgYXMgYW55W107XHJcbiAgICAgICAgbWVzc2FnZUFjdGl2aXR5Lm1lc3NhZ2VOb3RpY2VzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgaWYgKG5vdGljZXMgJiYgbm90aWNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IG4gb2Ygbm90aWNlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZU5vdGljZSA9IG5ldyBNZXNzYWdlTm90aWNlKGJwbW5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlTm90aWNlLnNlbmRUeXBlID0gbi5zZW5kVHlwZTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VOb3RpY2Uuc2VuZFRpbWUgPSBuLnNlbmRUaW1lO1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5zdWJqZWN0ID0gbi5zdWJqZWN0O1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5jb250ZW50ID0gbi5jb250ZW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKG4uc21zTWVzc2FnZVRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc21zTWVzc2FnZVRlbXBsYXRlID0gbmV3IFNtc01lc3NhZ2VUZW1wbGF0ZShicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNtc01lc3NhZ2VUZW1wbGF0ZS5jb2RlID0gbi5zbXNNZXNzYWdlVGVtcGxhdGUuY29kZTtcclxuICAgICAgICAgICAgICAgICAgICBzbXNNZXNzYWdlVGVtcGxhdGUuY29udGVudCA9IG4uc21zTWVzc2FnZVRlbXBsYXRlLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc21zTWVzc2FnZVRlbXBsYXRlLnNtc01lc3NhZ2VWYXJpYWJsZXMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobi5zbXNNZXNzYWdlVGVtcGxhdGUuc21zTWVzc2FnZVZhcmlhYmxlcyAmJiBuLnNtc01lc3NhZ2VUZW1wbGF0ZS5zbXNNZXNzYWdlVmFyaWFibGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIG4uc21zTWVzc2FnZVRlbXBsYXRlLnNtc01lc3NhZ2VWYXJpYWJsZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gbmV3IFNtc01lc3NhZ2VWYXJpYWJsZShicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGUuY29kZSA9IHYuY29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLnZhbHVlID0gdi52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlLnRhZyA9IHYudGFnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc21zTWVzc2FnZVRlbXBsYXRlLnNtc01lc3NhZ2VWYXJpYWJsZXMucHVzaCh2YXJpYWJsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5zbXNNZXNzYWdlVGVtcGxhdGUgPSBzbXNNZXNzYWdlVGVtcGxhdGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBtZXNzYWdlTm90aWNlLnJlY2VpdmVyID0gbi5yZWNlaXZlcjtcclxuICAgICAgICAgICAgICAgIC8vIG1lc3NhZ2VOb3RpY2UucmVjZWl2ZXJUZXh0ID0gbi5yZWNlaXZlclRleHQ7XHJcbiAgICAgICAgICAgICAgICBpZiAobi5yZWNlaXZlcnMgJiYgbi5yZWNlaXZlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY2VpdmVycyA9IG4ucmVjZWl2ZXJzLmZpbHRlcigocjogYW55KSA9PiByLnR5cGUgPT09ICd1c2VyUGFydGljaXBhbnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IChyLnR5cGUgPT09ICdwcm9jZXNzUGFydGljaXBhbnQnICYmIHIucHJvY2Vzc1BhcnRpY2lwYW50ICE9PSAnYWN0aXZpdHlFeGVjdXRvclBhcnRpY2lwYW50JykpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRpY2lwYW50cyA9IG4ucmVjZWl2ZXJzLmZpbHRlcigocjogYW55KSA9PiByLnR5cGUgPT09ICd2YXJpYWJsZVBhcnRpY2lwYW50JyB8fCByLnR5cGUgPT09ICdwb3NpdGlvblBhcnRpY2lwYW50J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCAoci50eXBlID09PSAncHJvY2Vzc1BhcnRpY2lwYW50JyAmJiByLnByb2Nlc3NQYXJ0aWNpcGFudCA9PT0gJ2FjdGl2aXR5RXhlY3V0b3JQYXJ0aWNpcGFudCcpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVjZWl2ZXJzICYmIHJlY2VpdmVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWNlaXZlciA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVjZWl2ZXJOYW1lID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiByZWNlaXZlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyLnR5cGUgPT09ICdwcm9jZXNzUGFydGljaXBhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXIgKz0gKHIucHJvY2Vzc1BhcnRpY2lwYW50ICsgJywnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoci5wcm9jZXNzUGFydGljaXBhbnQgPT09ICdwcm9jSW5zdENyZWF0b3InKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyTmFtZSArPSAn5rWB56iL5Y+R6LW35Lq6LCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHIucHJvY2Vzc1BhcnRpY2lwYW50ID09PSAnd29ya0l0ZW1QYXJ0aWNpcGFudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJOYW1lICs9ICfku7vliqHmjqXmlLbkurosJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoci50eXBlID09PSAndXNlclBhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyICs9IChyLnVzZXJJZHMgKyAnLCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyTmFtZSArPSAoci51c2VyTmFtZXMgKyAnLCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNlaXZlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXIgPSByZWNlaXZlci5zdWJzdHJpbmcoMCwgcmVjZWl2ZXIubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2VpdmVyTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJOYW1lID0gcmVjZWl2ZXJOYW1lLnN1YnN0cmluZygwLCByZWNlaXZlck5hbWUubGVuZ3RoIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlciA9IHJlY2VpdmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlTm90aWNlLnJlY2VpdmVyVGV4dCA9IHJlY2VpdmVyTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRpY2lwYW50cyAmJiBwYXJ0aWNpcGFudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNlaXZlckV4cHJlc3Npb25zID0gbmV3IEFycmF5PFBhcnRpY2lwYW50RXhwcmVzc2lvbj4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHBhcnRpY2lwYW50cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAudHlwZSA9PT0gJ3Byb2Nlc3NQYXJ0aWNpcGFudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZpdHlFeGVjdXRvciA9IG5ldyBBY3Rpdml0eUV4ZWN1dG9yUGFydGljaXBhbnRFeHByZXNzaW9uKG1lc3NhZ2VBY3Rpdml0eS5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFeGVjdXRvci5pZCA9IEJwbW5Nb2RlbEhlbHBlci5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RXhlY3V0b3IuYWN0aXZpdHlEZWZJZCA9IHAuYWN0aXZpdHlEZWZJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUV4ZWN1dG9yLmFjdGl2aXR5RGVmTmFtZSA9IHAuYWN0aXZpdHlEZWZOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyRXhwcmVzc2lvbnMucHVzaChhY3Rpdml0eUV4ZWN1dG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLnR5cGUgPT09ICd2YXJpYWJsZVBhcnRpY2lwYW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YXJpYWJsZVBhcnRpY2lwYW50ID0gbmV3IFVzZXJQYXJ0aWNpcGFudEV4cHJlc3Npb24obWVzc2FnZUFjdGl2aXR5Lk1vZGVsLCBwLnZhcmlhYmxlUGFydGljaXBhbnQsIHAudmFyaWFibGVOYW1lLCBwLm9yZ1R5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlUGFydGljaXBhbnQuaWQgPSBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZVBhcnRpY2lwYW50LlRhZyA9ICdleHByZXNzaW9uJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZVBhcnRpY2lwYW50Lk9yZ1R5cGUgPSBwLm9yZ1R5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJFeHByZXNzaW9ucy5wdXNoKHZhcmlhYmxlUGFydGljaXBhbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAudHlwZSA9PT0gJ3Bvc2l0aW9uUGFydGljaXBhbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBvc2lQYXJ0aWNpcGFudCA9IG5ldyBQb3NpdGlvblBhcnRpY2lwYW50RXhwcmVzc2lvbihtZXNzYWdlQWN0aXZpdHkuTW9kZWwsIHAucG9zaXRpb25JZCwgcC5wb3NpdGlvbk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2lQYXJ0aWNpcGFudC5pZCA9IEJwbW5Nb2RlbEhlbHBlci5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2lQYXJ0aWNpcGFudC5Qb3NpdGlvblR5cGUgPSBwLnBvc2l0aW9uVHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5wb3NpdGlvblR5cGUgPT09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpUGFydGljaXBhbnQuT3JnSWQgPSBwLm9yZ0lkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpUGFydGljaXBhbnQuT3JnVHlwZSA9IHAub3JnVHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJFeHByZXNzaW9ucy5wdXNoKHBvc2lQYXJ0aWNpcGFudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZU5vdGljZS5yZWNlaXZlckV4cHJlc3Npb25zID0gcmVjZWl2ZXJFeHByZXNzaW9ucztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZUFjdGl2aXR5Lm1lc3NhZ2VOb3RpY2VzLnB1c2gobWVzc2FnZU5vdGljZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVmFyaWFibGVTZXR0aW5ncyhtZXNzYWdlQWN0aXZpdHk6IE1lc3NhZ2VBY3Rpdml0eSwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBicG1uTW9kZWwgPSBtZXNzYWdlQWN0aXZpdHkuTW9kZWw7XHJcbiAgICAgICAgY29uc3QgZXh0ZW5kRWxlbWVudHMgPSBicG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MuR2V0RXh0ZW5zaW9uRWxlbWVudHMoKTtcclxuICAgICAgICBpZiAobWVzc2FnZUFjdGl2aXR5LnZhcmlhYmxlU2V0dGluZ3MgJiYgbWVzc2FnZUFjdGl2aXR5LnZhcmlhYmxlU2V0dGluZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgbWVzc2FnZUFjdGl2aXR5LnZhcmlhYmxlU2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2LnRhZyA9PT0gJ2NvbXBvbmVudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gZXh0ZW5kRWxlbWVudHMuZmluZEluZGV4KGUgPT4gKGUgaW5zdGFuY2VvZiBDb21wb25lbnQgJiYgZS5JZCA9PT0gdi52YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGV4dGVuZEVsZW1lbnRzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBtZXNzYWdlQWN0aXZpdHkudmFyaWFibGVTZXR0aW5ncyA9IG5ldyBBcnJheSgpO1xyXG5cclxuICAgICAgICBjb25zdCB2YXJpYWJsZXMgPSBvYmoucHJvcGVydHlWYWx1ZSBhcyBhbnlbXTtcclxuICAgICAgICBpZiAodmFyaWFibGVzICYmIHZhcmlhYmxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiB2YXJpYWJsZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhYmxlU2V0dGluZyA9IG5ldyBWYXJpYWJsZVNldHRpbmcoYnBtbk1vZGVsKTtcclxuICAgICAgICAgICAgICAgIC8vIHZhcmlhYmxlU2V0dGluZy52YXJpYWJsZUlkID0gdi52YXJpYWJsZUlkO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhcmlhYmxlQ29kZSA9IHYudmFyaWFibGVDb2RlO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhcmlhYmxlTmFtZSA9IHYudmFyaWFibGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnRhZyA9IHYudGFnO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLmV4ZWN1dGlvblRpbWUgPSB2LmV4ZWN1dGlvblRpbWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFsdWUgPSB2LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdmFyaWFibGVTZXR0aW5nLnZhbHVlVGV4dCA9IHYudmFsdWVUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VBY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzLnB1c2godmFyaWFibGVTZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZVNldHRpbmcudGFnID09PSAnY29tcG9uZW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB2LmNvbXBvbmVudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3B0ID0gbmV3IENvbXBvbmVudChicG1uTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuTWV0YWRhdGFJZCA9IGMuTWV0YWRhdGFJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0Lk1ldGhvZENvZGUgPSBjLk1ldGhvZENvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5JZCA9IGMuSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5OYW1lID0gYy5OYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuQWN0dWFsUGFyYW1ldGVycyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYy5BY3R1YWxQYXJhbWV0ZXJzICYmIGMuQWN0dWFsUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhIG9mIGMuQWN0dWFsUGFyYW1ldGVycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXJhbWV0ZXIgPSBuZXcgQWN0dWFsUGFyYW1ldGVyKGJwbW5Nb2RlbCwgYS5OYW1lLCBhLlZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXIuVGFnID0gYS5UYWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B0LkFjdHVhbFBhcmFtZXRlcnMucHVzaChwYXJhbWV0ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5wdXNoKGNwdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdfQ==
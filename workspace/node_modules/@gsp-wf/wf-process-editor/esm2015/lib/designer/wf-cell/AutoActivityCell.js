/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { AutoActivity, Component, ActualParameter, VariableSetting } from "@gsp-wf/wf-process-model";
import { PropertyHelper } from "./PropertyHelper";
import { BpmnModelHelper, FlowNodeState } from "@edp-pmf/bpmn-model";
import { WfConstants } from "../WfConstants";
import { AutoActivityPropertyKeys } from "./property-keys/AutoActivityPropertyKeys";
/**
 * 服务活动节点
 */
export class AutoActivityCell extends NodeCell {
    /**
     * @param {?=} value
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(value, geometry, style) {
        super(value, geometry, style);
        this.clrTypeId = AutoActivityCell.CLR_TYPE_ID;
        this.name = "服务";
        this.nameLanguage = {
            "zh-CHS": "服务",
            "zh-CHT": "服務",
            "en": "Service ",
        };
        this.imgUrls = {
            [FlowNodeState.Default]: WfConstants.IMAGE_PATH + "/auto.png",
            [FlowNodeState.Selected]: WfConstants.IMAGE_PATH + "/auto_select.svg",
        };
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    createFlowElement(flowElt) {
        /** @type {?} */
        const flowNode = (/** @type {?} */ (super.createFlowElement(flowElt)));
        flowNode.Id = "autoActivity" + BpmnModelHelper.GenerateElementId();
        return flowNode;
    }
    /**
     * @return {?}
     */
    getFarrisPropConfig() {
        /** @type {?} */
        let act = this.flowElement;
        // 组织属性框
        /** @type {?} */
        let basicProperty = new ElementPropertyConfig();
        /** @type {?} */
        let activityProperty = new ElementPropertyConfig();
        /** @type {?} */
        let propertyData = {};
        basicProperty.categoryId = 'basicProperty';
        basicProperty.categoryName = mxResources.get('basicInformation');
        basicProperty.tabId = 'basic';
        basicProperty.tabName = mxResources.get('basicAttributes');
        basicProperty.properties = [
            { propertyID: AutoActivityPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: AutoActivityPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: AutoActivityPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        activityProperty.categoryId = 'activityProperty';
        activityProperty.categoryName = mxResources.get('activityProperty');
        activityProperty.tabId = 'basic';
        activityProperty.tabName = mxResources.get('basicAttributes');
        activityProperty.properties = [
            { propertyID: AutoActivityPropertyKeys.Tools, propertyName: mxResources.get('tools'), propertyType: 'modal' },
            { propertyID: AutoActivityPropertyKeys.variableSettings, propertyName: mxResources.get('variableSettings'), propertyType: 'modal' },
        ];
        propertyData[AutoActivityPropertyKeys.Id] = act.Id;
        propertyData[AutoActivityPropertyKeys.ClrTypeID] = act.ClrTypeID;
        propertyData[AutoActivityPropertyKeys.Name] = act.Name;
        propertyData[AutoActivityPropertyKeys.NameLanguage] = act.NameLanguage || {
            "zh-CHS": act.Name,
        };
        propertyData[AutoActivityPropertyKeys.Tools] = PropertyHelper.getBizComponentList((/** @type {?} */ (act.tools)));
        propertyData[AutoActivityPropertyKeys.variableSettings] = PropertyHelper.getVariableSettings(act.Model, act.variableSettings);
        return {
            propertyConfig: [basicProperty, activityProperty],
            propertyData: propertyData
        };
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    updateProps(obj) {
        /** @type {?} */
        const autoActivity = this.flowElement;
        /** @type {?} */
        const propertyId = obj.propertyID;
        switch (propertyId) {
            case AutoActivityPropertyKeys.Tools:
                this.updateAutoActivityTools(autoActivity, obj);
                break;
            case AutoActivityPropertyKeys.variableSettings:
                this.updateVariableSettings(autoActivity, obj);
                break;
            default:
                super.updateProps(obj);
                break;
        }
    }
    /**
     * @param {?} autoActivity
     * @param {?} obj
     * @return {?}
     */
    updateAutoActivityTools(autoActivity, obj) {
        /** @type {?} */
        let tools = (/** @type {?} */ (obj.propertyValue));
        autoActivity.tools = new Array();
        if (tools && tools.length > 0) {
            for (const tool of tools) {
                /** @type {?} */
                let component = new Component(autoActivity.Model);
                component.Id = tool.id;
                component.Name = tool.name;
                // component.Time = tool.executionTime;
                // TODO 写死了构件类型
                component.ComponentType = 'WebServiceComponent';
                component.MetadataId = tool.metadataId;
                component.MethodCode = tool.methodCode;
                component.isForCompensation = tool.isForCompensation;
                component.ActualParameters = [];
                if (tool.actualParameters && ((/** @type {?} */ (tool.actualParameters))).length > 0) {
                    for (let a of ((/** @type {?} */ (tool.actualParameters)))) {
                        /** @type {?} */
                        let parameter = new ActualParameter(autoActivity.Model, a.code, a.value);
                        component.ActualParameters.push(parameter);
                    }
                }
                autoActivity.tools.push(component);
            }
        }
    }
    /**
     * @param {?} autoActivity
     * @param {?} obj
     * @return {?}
     */
    updateVariableSettings(autoActivity, obj) {
        /** @type {?} */
        const bpmnModel = autoActivity.Model;
        /** @type {?} */
        const extendElements = bpmnModel.DefaultProcess.GetExtensionElements();
        if (autoActivity.variableSettings && autoActivity.variableSettings.length > 0) {
            for (const v of autoActivity.variableSettings) {
                if (v.tag === 'component') {
                    /** @type {?} */
                    const i = extendElements.findIndex((/**
                     * @param {?} e
                     * @return {?}
                     */
                    e => (e instanceof Component && e.Id === v.value)));
                    extendElements.splice(i, 1);
                }
            }
        }
        autoActivity.variableSettings = new Array();
        /** @type {?} */
        const variables = (/** @type {?} */ (obj.propertyValue));
        if (variables && variables.length > 0) {
            for (const v of variables) {
                /** @type {?} */
                const variableSetting = new VariableSetting(bpmnModel);
                variableSetting.variableCode = v.variableCode;
                variableSetting.variableName = v.variableName;
                variableSetting.tag = v.tag;
                variableSetting.executionTime = v.executionTime;
                variableSetting.value = v.value;
                variableSetting.valueText = v.valueText;
                autoActivity.variableSettings.push(variableSetting);
                if (variableSetting.tag === 'component') {
                    /** @type {?} */
                    const c = v.component;
                    if (c) {
                        /** @type {?} */
                        let cpt = new Component(bpmnModel);
                        cpt.MetadataId = c.MetadataId;
                        cpt.MethodCode = c.MethodCode;
                        cpt.Id = c.Id;
                        cpt.Name = c.Name;
                        cpt.ActualParameters = new Array();
                        if (c.ActualParameters && c.ActualParameters.length > 0) {
                            for (let a of c.ActualParameters) {
                                /** @type {?} */
                                let parameter = new ActualParameter(bpmnModel, a.Name, a.Value);
                                parameter.Tag = a.Tag;
                                cpt.ActualParameters.push(parameter);
                            }
                        }
                        extendElements.push(cpt);
                    }
                }
            }
        }
    }
}
AutoActivityCell.CLR_TYPE_ID = AutoActivity.Clr_Type_ID;
if (false) {
    /** @type {?} */
    AutoActivityCell.CLR_TYPE_ID;
    /** @type {?} */
    AutoActivityCell.prototype.clrTypeId;
    /** @type {?} */
    AutoActivityCell.prototype.name;
    /** @type {?} */
    AutoActivityCell.prototype.nameLanguage;
    /** @type {?} */
    AutoActivityCell.prototype.flowElement;
    /** @type {?} */
    AutoActivityCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0b0FjdGl2aXR5Q2VsbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc3Atd2Yvd2YtcHJvY2Vzcy1lZGl0b3IvIiwic291cmNlcyI6WyJsaWIvZGVzaWduZXIvd2YtY2VsbC9BdXRvQWN0aXZpdHlDZWxsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLHFCQUFxQixFQUE0QixNQUFNLHNCQUFzQixDQUFDO0FBQ2pHLE9BQU8sRUFBYSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBUSxlQUFlLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0csT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsYUFBYSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDOzs7O0FBS3BGLE1BQU0sT0FBTyxnQkFBaUIsU0FBUSxRQUFROzs7Ozs7SUFnQjFDLFlBQVksS0FBVyxFQUFFLFFBQStCLEVBQUUsS0FBYztRQUNwRSxLQUFLLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQWhCbEMsY0FBUyxHQUFXLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztRQUNqRCxTQUFJLEdBQVcsSUFBSSxDQUFDO1FBQ3BCLGlCQUFZLEdBQWdDO1lBQzFDLFFBQVEsRUFBRSxJQUFJO1lBQ2QsUUFBUSxFQUFFLElBQUk7WUFDZCxJQUFJLEVBQUUsVUFBVTtTQUNuQixDQUFDO1FBSUEsWUFBTyxHQUFHO1lBQ04sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEVBQUUsV0FBVyxDQUFDLFVBQVUsR0FBRyxXQUFXO1lBQzdELENBQUMsYUFB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Qjs7SUFDcEIsd0NBSUE7O0lBRUEsdUNBQTBCOztJQUUxQixtQ0FHRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vZGVDZWxsLCBFbGVtZW50UHJvcGVydHlDb25maWcsIEZhcnJpc1Byb3BDb25maWdXaXRoRGF0YSB9IGZyb20gXCJAZWRwLXBtZi9ncmFwaGVkaXRvclwiO1xyXG5pbXBvcnQgeyBNeEdyYXBoTlMsIG14UmVzb3VyY2VzIH0gZnJvbSBcIkBlZHAtcG1mL214Z3JhcGgtdHNcIjtcclxuaW1wb3J0IHsgQXV0b0FjdGl2aXR5LCBDb21wb25lbnQsIFRvb2wsIEFjdHVhbFBhcmFtZXRlciwgVmFyaWFibGVTZXR0aW5nIH0gZnJvbSBcIkBnc3Atd2Yvd2YtcHJvY2Vzcy1tb2RlbFwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eUhlbHBlciB9IGZyb20gXCIuL1Byb3BlcnR5SGVscGVyXCI7XHJcbmltcG9ydCB7IEJwbW5Nb2RlbEhlbHBlciwgRmxvd05vZGVTdGF0ZSB9IGZyb20gXCJAZWRwLXBtZi9icG1uLW1vZGVsXCI7XHJcbmltcG9ydCB7IFdmQ29uc3RhbnRzIH0gZnJvbSBcIi4uL1dmQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IEF1dG9BY3Rpdml0eVByb3BlcnR5S2V5cyB9IGZyb20gXCIuL3Byb3BlcnR5LWtleXMvQXV0b0FjdGl2aXR5UHJvcGVydHlLZXlzXCI7XHJcblxyXG4vKipcclxuICog5pyN5Yqh5rS75Yqo6IqC54K5XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQXV0b0FjdGl2aXR5Q2VsbCBleHRlbmRzIE5vZGVDZWxsIHtcclxuICAgIGNsclR5cGVJZDogc3RyaW5nID0gQXV0b0FjdGl2aXR5Q2VsbC5DTFJfVFlQRV9JRDtcclxuICAgIG5hbWU6IHN0cmluZyA9IFwi5pyN5YqhXCI7XHJcbiAgICBuYW1lTGFuZ3VhZ2U6IHsgW2xhbmc6IHN0cmluZ106IHN0cmluZzsgfSA9IHtcclxuICAgICAgXCJ6aC1DSFNcIjogXCLmnI3liqFcIixcclxuICAgICAgXCJ6aC1DSFRcIjogXCLmnI3li5lcIixcclxuICAgICAgXCJlblwiOiBcIlNlcnZpY2UgXCIsXHJcbiAgfTtcclxuICAgIHN0YXRpYyBDTFJfVFlQRV9JRDogc3RyaW5nID0gQXV0b0FjdGl2aXR5LkNscl9UeXBlX0lEO1xyXG4gICAgZmxvd0VsZW1lbnQ6IEF1dG9BY3Rpdml0eTtcclxuXHJcbiAgICBpbWdVcmxzID0ge1xyXG4gICAgICAgIFtGbG93Tm9kZVN0YXRlLkRlZmF1bHRdOiBXZkNvbnN0YW50cy5JTUFHRV9QQVRIICsgXCIvYXV0by5wbmdcIixcclxuICAgICAgICBbRmxvd05vZGVTdGF0ZS5TZWxlY3RlZF06IFdmQ29uc3RhbnRzLklNQUdFX1BBVEggKyBcIi9hdXRvX3NlbGVjdC5zdmdcIixcclxuICAgIH07XHJcblxyXG4gICAgY29uc3RydWN0b3IodmFsdWU/OiBhbnksIGdlb21ldHJ5PzogTXhHcmFwaE5TLm14R2VvbWV0cnksIHN0eWxlPzogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIodmFsdWUsIGdlb21ldHJ5LCBzdHlsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRmxvd0VsZW1lbnQoZmxvd0VsdD86IEF1dG9BY3Rpdml0eSkge1xyXG4gICAgICAgIGNvbnN0IGZsb3dOb2RlID0gc3VwZXIuY3JlYXRlRmxvd0VsZW1lbnQoZmxvd0VsdCkgYXMgQXV0b0FjdGl2aXR5O1xyXG4gICAgICAgIGZsb3dOb2RlLklkID0gXCJhdXRvQWN0aXZpdHlcIiArIEJwbW5Nb2RlbEhlbHBlci5HZW5lcmF0ZUVsZW1lbnRJZCgpO1xyXG5cclxuICAgICAgICByZXR1cm4gZmxvd05vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RmFycmlzUHJvcENvbmZpZygpOiBGYXJyaXNQcm9wQ29uZmlnV2l0aERhdGEge1xyXG4gICAgICAgIGxldCBhY3QgPSB0aGlzLmZsb3dFbGVtZW50O1xyXG5cclxuICAgICAgICAvLyDnu4Tnu4flsZ7mgKfmoYZcclxuICAgICAgICBsZXQgYmFzaWNQcm9wZXJ0eTogRWxlbWVudFByb3BlcnR5Q29uZmlnID0gbmV3IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZygpO1xyXG4gICAgICAgIGxldCBhY3Rpdml0eVByb3BlcnR5OiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgbGV0IHByb3BlcnR5RGF0YTogYW55ID0ge307XHJcblxyXG4gICAgICAgIGJhc2ljUHJvcGVydHkuY2F0ZWdvcnlJZCA9ICdiYXNpY1Byb3BlcnR5JztcclxuICAgICAgICBiYXNpY1Byb3BlcnR5LmNhdGVnb3J5TmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNJbmZvcm1hdGlvbicpO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkudGFiSWQgPSAnYmFzaWMnO1xyXG4gICAgICAgIGJhc2ljUHJvcGVydHkudGFiTmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNBdHRyaWJ1dGVzJyk7XHJcbiAgICAgICAgYmFzaWNQcm9wZXJ0eS5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IEF1dG9BY3Rpdml0eVByb3BlcnR5S2V5cy5OYW1lLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnbmFtZScpLCBwcm9wZXJ0eVR5cGU6ICdzdHJpbmcnLCB2aXNpYmxlOiAhdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQXV0b0FjdGl2aXR5UHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWVMYW5ndWFnZScpLCBwcm9wZXJ0eVR5cGU6ICdtdWx0aUxhbmd1YWdlJywgdmlzaWJsZTogdGhpcy5lZGl0b3JVaS5tdWx0aUxhbmdFbmFibGVkIH0sXHJcbiAgICAgICAgICAgIHsgcHJvcGVydHlJRDogQXV0b0FjdGl2aXR5UHJvcGVydHlLZXlzLklkLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnaWQnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgcmVhZG9ubHk6IHRydWUgfVxyXG4gICAgICAgIF07XHJcblxyXG5cclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LmNhdGVnb3J5SWQgPSAnYWN0aXZpdHlQcm9wZXJ0eSc7XHJcbiAgICAgICAgYWN0aXZpdHlQcm9wZXJ0eS5jYXRlZ29yeU5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2FjdGl2aXR5UHJvcGVydHknKTtcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LnRhYklkID0gJ2Jhc2ljJztcclxuICAgICAgICBhY3Rpdml0eVByb3BlcnR5LnRhYk5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2Jhc2ljQXR0cmlidXRlcycpO1xyXG4gICAgICAgIGFjdGl2aXR5UHJvcGVydHkucHJvcGVydGllcyA9IFtcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBBdXRvQWN0aXZpdHlQcm9wZXJ0eUtleXMuVG9vbHMsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCd0b29scycpLCBwcm9wZXJ0eVR5cGU6ICdtb2RhbCcgfSxcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBBdXRvQWN0aXZpdHlQcm9wZXJ0eUtleXMudmFyaWFibGVTZXR0aW5ncywgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ3ZhcmlhYmxlU2V0dGluZ3MnKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH0sXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0F1dG9BY3Rpdml0eVByb3BlcnR5S2V5cy5JZF0gPSBhY3QuSWQ7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0F1dG9BY3Rpdml0eVByb3BlcnR5S2V5cy5DbHJUeXBlSURdID0gYWN0LkNsclR5cGVJRDtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQXV0b0FjdGl2aXR5UHJvcGVydHlLZXlzLk5hbWVdID0gYWN0Lk5hbWU7XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0F1dG9BY3Rpdml0eVByb3BlcnR5S2V5cy5OYW1lTGFuZ3VhZ2VdID0gYWN0Lk5hbWVMYW5ndWFnZSB8fCB7XHJcbiAgICAgICAgICAgIFwiemgtQ0hTXCI6IGFjdC5OYW1lLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcHJvcGVydHlEYXRhW0F1dG9BY3Rpdml0eVByb3BlcnR5S2V5cy5Ub29sc10gPSBQcm9wZXJ0eUhlbHBlci5nZXRCaXpDb21wb25lbnRMaXN0KGFjdC50b29scyBhcyBBcnJheTxDb21wb25lbnQ+KTtcclxuICAgICAgICBwcm9wZXJ0eURhdGFbQXV0b0FjdGl2aXR5UHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3NdID0gUHJvcGVydHlIZWxwZXIuZ2V0VmFyaWFibGVTZXR0aW5ncyhhY3QuTW9kZWwsIGFjdC52YXJpYWJsZVNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtiYXNpY1Byb3BlcnR5LCBhY3Rpdml0eVByb3BlcnR5XSxcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhOiBwcm9wZXJ0eURhdGFcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlUHJvcHMob2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBhdXRvQWN0aXZpdHkgPSB0aGlzLmZsb3dFbGVtZW50O1xyXG4gICAgICAgIGNvbnN0IHByb3BlcnR5SWQ6IHN0cmluZyA9IG9iai5wcm9wZXJ0eUlEO1xyXG4gICAgICAgIHN3aXRjaCAocHJvcGVydHlJZCkge1xyXG4gICAgICAgICAgICBjYXNlIEF1dG9BY3Rpdml0eVByb3BlcnR5S2V5cy5Ub29sczpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQXV0b0FjdGl2aXR5VG9vbHMoYXV0b0FjdGl2aXR5LCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQXV0b0FjdGl2aXR5UHJvcGVydHlLZXlzLnZhcmlhYmxlU2V0dGluZ3M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZhcmlhYmxlU2V0dGluZ3MoYXV0b0FjdGl2aXR5LCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBzdXBlci51cGRhdGVQcm9wcyhvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZUF1dG9BY3Rpdml0eVRvb2xzKGF1dG9BY3Rpdml0eTogQXV0b0FjdGl2aXR5LCBvYmo6IGFueSkge1xyXG4gICAgICAgIGxldCB0b29scyA9IG9iai5wcm9wZXJ0eVZhbHVlIGFzIGFueVtdO1xyXG4gICAgICAgIGF1dG9BY3Rpdml0eS50b29scyA9IG5ldyBBcnJheTxUb29sPigpO1xyXG4gICAgICAgIGlmICh0b29scyAmJiB0b29scy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgdG9vbCBvZiB0b29scykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGNvbXBvbmVudCA9IG5ldyBDb21wb25lbnQoYXV0b0FjdGl2aXR5Lk1vZGVsKTtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5JZCA9IHRvb2wuaWQ7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuTmFtZSA9IHRvb2wubmFtZTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbXBvbmVudC5UaW1lID0gdG9vbC5leGVjdXRpb25UaW1lO1xyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyDlhpnmrbvkuobmnoTku7bnsbvlnotcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5Db21wb25lbnRUeXBlID0gJ1dlYlNlcnZpY2VDb21wb25lbnQnO1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50Lk1ldGFkYXRhSWQgPSB0b29sLm1ldGFkYXRhSWQ7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuTWV0aG9kQ29kZSA9IHRvb2wubWV0aG9kQ29kZTtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5pc0ZvckNvbXBlbnNhdGlvbiA9IHRvb2wuaXNGb3JDb21wZW5zYXRpb247XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQuQWN0dWFsUGFyYW1ldGVycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRvb2wuYWN0dWFsUGFyYW1ldGVycyAmJiAodG9vbC5hY3R1YWxQYXJhbWV0ZXJzIGFzIGFueVtdKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYSBvZiAodG9vbC5hY3R1YWxQYXJhbWV0ZXJzIGFzIGFueVtdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFyYW1ldGVyID0gbmV3IEFjdHVhbFBhcmFtZXRlcihhdXRvQWN0aXZpdHkuTW9kZWwsIGEuY29kZSwgYS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5BY3R1YWxQYXJhbWV0ZXJzLnB1c2gocGFyYW1ldGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhdXRvQWN0aXZpdHkudG9vbHMucHVzaChjb21wb25lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVZhcmlhYmxlU2V0dGluZ3MoYXV0b0FjdGl2aXR5OiBBdXRvQWN0aXZpdHksIG9iajogYW55KSB7XHJcbiAgICAgICAgY29uc3QgYnBtbk1vZGVsID0gYXV0b0FjdGl2aXR5Lk1vZGVsO1xyXG4gICAgICAgIGNvbnN0IGV4dGVuZEVsZW1lbnRzID0gYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLkdldEV4dGVuc2lvbkVsZW1lbnRzKCk7XHJcbiAgICAgICAgaWYgKGF1dG9BY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzICYmIGF1dG9BY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIGF1dG9BY3Rpdml0eS52YXJpYWJsZVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodi50YWcgPT09ICdjb21wb25lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGV4dGVuZEVsZW1lbnRzLmZpbmRJbmRleChlID0+IChlIGluc3RhbmNlb2YgQ29tcG9uZW50ICYmIGUuSWQgPT09IHYudmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBleHRlbmRFbGVtZW50cy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgYXV0b0FjdGl2aXR5LnZhcmlhYmxlU2V0dGluZ3MgPSBuZXcgQXJyYXkoKTtcclxuXHJcbiAgICAgICAgY29uc3QgdmFyaWFibGVzID0gb2JqLnByb3BlcnR5VmFsdWUgYXMgYW55W107XHJcbiAgICAgICAgaWYgKHZhcmlhYmxlcyAmJiB2YXJpYWJsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdmFyaWFibGVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YXJpYWJsZVNldHRpbmcgPSBuZXcgVmFyaWFibGVTZXR0aW5nKGJwbW5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVDb2RlID0gdi52YXJpYWJsZUNvZGU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFyaWFibGVOYW1lID0gdi52YXJpYWJsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudGFnID0gdi50YWc7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcuZXhlY3V0aW9uVGltZSA9IHYuZXhlY3V0aW9uVGltZTtcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlU2V0dGluZy52YWx1ZSA9IHYudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVNldHRpbmcudmFsdWVUZXh0ID0gdi52YWx1ZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgYXV0b0FjdGl2aXR5LnZhcmlhYmxlU2V0dGluZ3MucHVzaCh2YXJpYWJsZVNldHRpbmcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlU2V0dGluZy50YWcgPT09ICdjb21wb25lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYyA9IHYuY29tcG9uZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjcHQgPSBuZXcgQ29tcG9uZW50KGJwbW5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5NZXRhZGF0YUlkID0gYy5NZXRhZGF0YUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcHQuTWV0aG9kQ29kZSA9IGMuTWV0aG9kQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0LklkID0gYy5JZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3B0Lk5hbWUgPSBjLk5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNwdC5BY3R1YWxQYXJhbWV0ZXJzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLkFjdHVhbFBhcmFtZXRlcnMgJiYgYy5BY3R1YWxQYXJhbWV0ZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGEgb2YgYy5BY3R1YWxQYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmFtZXRlciA9IG5ldyBBY3R1YWxQYXJhbWV0ZXIoYnBtbk1vZGVsLCBhLk5hbWUsIGEuVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlci5UYWcgPSBhLlRhZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcHQuQWN0dWFsUGFyYW1ldGVycy5wdXNoKHBhcmFtZXRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuZEVsZW1lbnRzLnB1c2goY3B0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
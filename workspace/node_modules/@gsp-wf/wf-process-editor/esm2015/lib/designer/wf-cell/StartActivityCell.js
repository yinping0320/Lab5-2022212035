/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NodeCell, ElementPropertyConfig } from "@edp-pmf/grapheditor";
import { mxResources } from "@edp-pmf/mxgraph-ts";
import { BpmnModelHelper, FlowNodeState } from "@edp-pmf/bpmn-model";
import { StartActivity, ExtendProperty, JumpScope, ExecuteForm, ActualParameter, OtherAssignNodes, OtherAssignActivityNodeInfo, Condition } from "@gsp-wf/wf-process-model";
import { WfConstants } from "../WfConstants";
import { StartActivityPropertyKeys } from "./property-keys/StartActivityPropertyKeys";
import { PropertyHelper } from "./PropertyHelper";
/**
 * 开始活动节点
 */
export class StartActivityCell extends NodeCell {
    /**
     * @param {?=} value
     * @param {?=} geometry
     * @param {?=} style
     */
    constructor(value, geometry, style) {
        super(value, geometry, style);
        this.clrTypeId = StartActivityCell.CLR_TYPE_ID;
        this.name = "开始";
        this.nameLanguage = {
            "zh-CHS": "开始",
            "zh-CHT": "開始",
            "en": "Start",
        };
        this.imgUrls = {
            [FlowNodeState.Default]: WfConstants.IMAGE_PATH + "/start.png",
            [FlowNodeState.Selected]: WfConstants.IMAGE_PATH + "/start_select.svg",
        };
    }
    /**
     * @param {?=} flowElt
     * @return {?}
     */
    createFlowElement(flowElt) {
        /** @type {?} */
        const flowNode = (/** @type {?} */ (super.createFlowElement(flowElt)));
        /** @type {?} */
        const editorUi = this.editorUi;
        flowNode.Id = "startActivity" + BpmnModelHelper.GenerateElementId();
        // 创建而非复制时执行
        if (flowElt == null) {
            // 设置默认表单
            if (editorUi && editorUi.formFormats) {
                /** @type {?} */
                const formFormats = editorUi.formFormats;
                /** @type {?} */
                const startActivityForms = new Array();
                /** @type {?} */
                const pcForm = formFormats.filter((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f.terminal === 'PC' && f.status === 1))[0];
                if (pcForm) {
                    startActivityForms.push(pcForm);
                }
                /** @type {?} */
                const mobileForm = formFormats.filter((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => f.terminal === 'Mobile' && f.status === 1))[0];
                if (mobileForm) {
                    startActivityForms.push(mobileForm);
                }
                if (startActivityForms && startActivityForms.length > 0) {
                    flowNode.setDefaultForms(startActivityForms);
                }
            }
        }
        return flowNode;
    }
    /**
     * @return {?}
     */
    getFarrisPropConfig() {
        /** @type {?} */
        const editorUi = this.editorUi;
        /** @type {?} */
        const act = (/** @type {?} */ (this.flowElement));
        /** @type {?} */
        let extendList = [];
        if (editorUi.procExtProps && editorUi.procExtProps.length > 0) {
            extendList = JSON.parse(JSON.stringify(editorUi.procExtProps)).sort((/**
             * @param {?} a
             * @param {?} b
             * @return {?}
             */
            (a, b) => {
                return a.sortOrder - b.sortOrder;
            }));
        }
        extendList = extendList.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            return a.sortOrder - b.sortOrder;
        }));
        /** @type {?} */
        let PropertyConfig = new ElementPropertyConfig();
        /** @type {?} */
        let propertyData = new Object();
        PropertyConfig.categoryId = 'general';
        PropertyConfig.categoryName = mxResources.get('basicInformation');
        PropertyConfig.tabId = 'basic';
        PropertyConfig.tabName = mxResources.get('basicAttributes');
        PropertyConfig.properties = [
            { propertyID: StartActivityPropertyKeys.Name, propertyName: mxResources.get('name'), propertyType: 'string', visible: !this.editorUi.multiLangEnabled },
            { propertyID: StartActivityPropertyKeys.NameLanguage, propertyName: mxResources.get('nameLanguage'), propertyType: 'multiLanguage', visible: this.editorUi.multiLangEnabled },
            { propertyID: StartActivityPropertyKeys.Id, propertyName: mxResources.get('id'), propertyType: 'string', readonly: true }
        ];
        /** @type {?} */
        let formDef = new ElementPropertyConfig();
        formDef.categoryId = 'formDef';
        formDef.categoryName = mxResources.get('formDef');
        formDef.tabId = 'basic';
        formDef.tabName = mxResources.get('basicAttributes');
        formDef.properties = [
            { propertyID: StartActivityPropertyKeys.wf_ExecuteForms_PC, propertyName: mxResources.get('pcForm'), propertyType: 'modal' },
            { propertyID: StartActivityPropertyKeys.wf_ExecuteForms_Mobile, propertyName: mxResources.get('webForm'), propertyType: 'modal' },
        ];
        /** @type {?} */
        let ActivityConfig = new ElementPropertyConfig();
        ActivityConfig.categoryId = 'activityConfig';
        ActivityConfig.categoryName = mxResources.get('activityProperty');
        ActivityConfig.tabId = 'basic';
        ActivityConfig.tabName = mxResources.get('basicAttributes');
        ActivityConfig.properties = [
            // { propertyID: StartActivityPropertyKeys.ExecuteForms, propertyName: mxResources.get('formDef'), propertyType: 'modal' },
            { propertyID: 'sendBackedTask', propertyName: mxResources.get('sendBackedTask'), propertyType: 'select' }
        ];
        if (act.selectTargetAble) {
            ActivityConfig.properties = ActivityConfig.properties.concat([
                { propertyID: StartActivityPropertyKeys.SelectTargetAble, propertyName: mxResources.get('selectTargetAble'), propertyType: 'select' },
                { propertyID: StartActivityPropertyKeys.JumpScope, propertyName: mxResources.get('jumpScope'), propertyType: 'modal' }
            ]);
            propertyData.SelectTargetAble = act.selectTargetAble || false;
            propertyData.JumpScope = act.jumpScope;
        }
        else {
            ActivityConfig.properties = ActivityConfig.properties.concat([
                { propertyID: StartActivityPropertyKeys.SelectTargetAble, propertyName: mxResources.get('selectTargetAble'), propertyType: 'select' }
            ]);
            propertyData.SelectTargetAble = act.selectTargetAble || false;
        }
        if (act.otherAssignNodes) {
            ActivityConfig.properties = ActivityConfig.properties.concat([
                { propertyID: StartActivityPropertyKeys.otherAssignNodes, propertyName: mxResources.get('otherAssignNodes'), propertyType: 'select' },
                // { propertyID: StartActivityPropertyKeys.otherAssignActivities, propertyName: mxResources.get('otherAssignActivities'), propertyType: 'modal' }
                { propertyID: StartActivityPropertyKeys.otherAssignActivityNodeInfos, propertyName: mxResources.get('otherAssignActivityNodeInfos'), propertyType: 'modal' }
            ]);
            propertyData[StartActivityPropertyKeys.otherAssignNodes] = true;
            // propertyData[StartActivityPropertyKeys.otherAssignActivities] = act.otherAssignNodes.otherAssignActivities;
            propertyData[StartActivityPropertyKeys.otherAssignActivityNodeInfos] = act.otherAssignNodes.otherAssignActivities || act.otherAssignNodes.otherAssignActivityNodeInfos;
            if (act.otherAssignNodes.otherAssignActivities) {
                act.otherAssignNodes.otherAssignActivities = null;
            }
        }
        else {
            ActivityConfig.properties = ActivityConfig.properties.concat([
                { propertyID: StartActivityPropertyKeys.otherAssignNodes, propertyName: mxResources.get('otherAssignNodes'), propertyType: 'select' }
            ]);
            propertyData[StartActivityPropertyKeys.otherAssignNodes] = false;
        }
        /** @type {?} */
        const groupList = new Array();
        for (const extend of extendList) {
            if (!extend.parentId) {
                /** @type {?} */
                const group = { parent: extend, childs: new Array() };
                for (const e of extendList) {
                    if (e.parentId === extend.id) {
                        group.childs.push(e);
                    }
                }
                groupList.push(group);
            }
        }
        // 没有扩展属性值的时候不显示扩展属性一栏
        if (groupList && groupList.length > 0) {
            /** @type {?} */
            let ExtendPropertyConfig = new ElementPropertyConfig();
            ExtendPropertyConfig.categoryId = 'extendPropertyConfig';
            ExtendPropertyConfig.categoryName = mxResources.get('extendPropertyConfig');
            ExtendPropertyConfig.tabId = 'advanced';
            ExtendPropertyConfig.tabName = mxResources.get('advancedAttributes');
            ExtendPropertyConfig.properties = new Array();
            for (const g of groupList) {
                ExtendPropertyConfig.properties.push({ propertyID: g.parent.id, propertyName: g.parent.propertyTitle, propertyType: 'modal' });
                // 取回模型上的value值给到扩展属性组件里
                if (act.extendProperties && act.extendProperties.length > 0) {
                    g.childs.sort((/**
                     * @param {?} a
                     * @param {?} b
                     * @return {?}
                     */
                    (a, b) => {
                        return a.sortOrder - b.sortOrder;
                    })).forEach((/**
                     * @param {?} d
                     * @return {?}
                     */
                    (d) => {
                        act.extendProperties.forEach((/**
                         * @param {?} e
                         * @return {?}
                         */
                        e => {
                            if (e.key == d.code) {
                                d.value = e.value;
                            }
                        }));
                    }));
                }
                propertyData[g.parent.id] = g.childs;
            }
            // todo：与else分支代码重复，可提取至if语句外，本次修改仅针对名称多语，故暂不修改
            propertyData[StartActivityPropertyKeys.Id] = act.Id;
            propertyData[StartActivityPropertyKeys.ClrTypeID] = act.ClrTypeID;
            propertyData[StartActivityPropertyKeys.Name] = act.Name || mxResources.get('start');
            propertyData[StartActivityPropertyKeys.NameLanguage] = act.NameLanguage || {
                "zh-CHS": act.Name,
            };
            propertyData[StartActivityPropertyKeys.sendBackedTask] = act.sendBackedTask;
            propertyData[StartActivityPropertyKeys.wf_ExecuteForms_PC] =
                act.ExecuteForms ? act.ExecuteForms.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.TerminalType === 'PC')) : null;
            propertyData[StartActivityPropertyKeys.wf_ExecuteForms_Mobile] =
                act.ExecuteForms ? act.ExecuteForms.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.TerminalType === 'MOBILE')) : null;
            return {
                propertyConfig: [PropertyConfig, formDef, ActivityConfig, ExtendPropertyConfig],
                propertyData: propertyData
            };
        }
        else {
            propertyData[StartActivityPropertyKeys.Id] = act.Id;
            propertyData[StartActivityPropertyKeys.ClrTypeID] = act.ClrTypeID;
            propertyData[StartActivityPropertyKeys.Name] = act.Name || mxResources.get('start');
            propertyData[StartActivityPropertyKeys.NameLanguage] = act.NameLanguage || {
                "zh-CHS": act.Name,
            };
            propertyData[StartActivityPropertyKeys.sendBackedTask] = act.sendBackedTask;
            propertyData[StartActivityPropertyKeys.wf_ExecuteForms_PC] =
                act.ExecuteForms ? act.ExecuteForms.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.TerminalType === 'PC')) : null;
            propertyData[StartActivityPropertyKeys.wf_ExecuteForms_Mobile] =
                act.ExecuteForms ? act.ExecuteForms.find((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.TerminalType === 'MOBILE')) : null;
            return {
                propertyConfig: [PropertyConfig, formDef, ActivityConfig],
                propertyData: propertyData
            };
        }
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    updateProps(obj) {
        /** @type {?} */
        const editorUi = this.editorUi;
        /** @type {?} */
        const startActivity = this.flowElement;
        /** @type {?} */
        const propertyId = obj.propertyID;
        switch (propertyId) {
            case StartActivityPropertyKeys.wf_ExecuteForms_PC:
                this.updateStartActivityForm(startActivity, obj, 'PC');
                if (obj.parameters && obj.parameters.length > 0) {
                    PropertyHelper.updateFormalParameters(editorUi.graph.bpmnModel.DefaultProcess, obj.parameters);
                }
                break;
            case StartActivityPropertyKeys.wf_ExecuteForms_Mobile:
                this.updateStartActivityForm(startActivity, obj, 'MOBILE');
                if (obj.parameters && obj.parameters.length > 0) {
                    PropertyHelper.updateFormalParameters(editorUi.graph.bpmnModel.DefaultProcess, obj.parameters);
                }
                break;
            case StartActivityPropertyKeys.SelectTargetAble:
                this.resetSelectTargetAble(startActivity, obj);
                break;
            case StartActivityPropertyKeys.JumpScope:
                this.resetJumpScope(startActivity, obj);
                break;
            case StartActivityPropertyKeys.otherAssignNodes:
                this.updateOtherAssignNodes(startActivity, obj);
                break;
            case StartActivityPropertyKeys.otherAssignActivities:
                this.updateOtherAssignActivities(startActivity, obj);
                break;
            case StartActivityPropertyKeys.otherAssignActivityNodeInfos:
                this.updateOtherAssignActivities(startActivity, obj);
                break;
            default:
                // 判断ResourceKeys是不是groupid,是就走resetExtendProperty
                if (editorUi.procExtProps.findIndex((/**
                 * @param {?} p
                 * @return {?}
                 */
                p => p.id === propertyId)) > -1) {
                    this.resetExtendProperty(startActivity, obj);
                }
                else {
                    super.updateProps(obj);
                }
                break;
        }
    }
    /**
     * @param {?} start
     * @param {?} obj
     * @param {?} terminal
     * @return {?}
     */
    updateStartActivityForm(start, obj, terminal) {
        if (start) {
            /** @type {?} */
            let form = (/** @type {?} */ (obj.propertyValue));
            if (!start.ExecuteForms) {
                start.ExecuteForms = new Array();
            }
            start.ExecuteForms = start.ExecuteForms.filter((/**
             * @param {?} e
             * @return {?}
             */
            e => e.TerminalType !== terminal));
            if (form) {
                /** @type {?} */
                let params = (/** @type {?} */ (form.ActualParameters));
                /** @type {?} */
                let actParas = new Array();
                if (params && params.length > 0) {
                    for (let para of params) {
                        /** @type {?} */
                        let actPara = new ActualParameter(start.Model, para.Name, para.Value);
                        if (para.Tag) {
                            actPara.Tag = para.Tag;
                        }
                        else {
                            if (para.Value) {
                                if (para.Value.length >= 8 && para.Value.slice(0, 8) === `{"expr":`) {
                                    actPara.Tag = 'expression';
                                }
                                else {
                                    actPara.Tag = 'constant';
                                }
                            }
                            else {
                                actPara.Tag = 'variable';
                            }
                        }
                        actParas.push(actPara);
                    }
                }
                /** @type {?} */
                const id = BpmnModelHelper.GenerateElementId();
                /** @type {?} */
                let item = new ExecuteForm(start.Model, id, form.Name, actParas);
                item.ComponentId = form.ComponentId;
                item.FormType = form.FormType;
                item.formFormatId = form.formFormatId;
                item.formatConfigId = form.formatConfigId;
                item.TerminalType = form.TerminalType;
                start.ExecuteForms.push(item);
            }
        }
    }
    /**
     * 更新是否允许跳转属性
     * @param {?} startActivity
     * @param {?} obj
     * @return {?}
     */
    resetSelectTargetAble(startActivity, obj) {
        /** @type {?} */
        const selectTargetAble = (/** @type {?} */ (obj.propertyValue));
        startActivity.selectTargetAble = selectTargetAble;
        if (startActivity.selectTargetAble) {
            startActivity.jumpScope = new JumpScope(startActivity.Model);
        }
        else {
            startActivity.jumpScope = null;
        }
    }
    /**
     * @param {?} startActivity
     * @param {?} obj
     * @return {?}
     */
    resetJumpScope(startActivity, obj) {
        /** @type {?} */
        const data = obj.propertyValue;
        if (data) {
            /** @type {?} */
            let jumpScope = new JumpScope(startActivity.Model);
            jumpScope.Category = data.Category;
            jumpScope.DefaultType = data.DefaultType;
            jumpScope.DefaultActivity = data.DefaultActivity;
            jumpScope.DestinationActivities = data.DestinationActivities;
            startActivity.jumpScope = jumpScope;
        }
        else {
            startActivity.jumpScope = null;
        }
    }
    /**
     * @param {?} startActivity
     * @param {?} obj
     * @return {?}
     */
    updateOtherAssignNodes(startActivity, obj) {
        /** @type {?} */
        const data = obj.propertyValue;
        if (data) {
            // const otherAssignNodes = new OtherAssignNodes(startActivity.Model);
            // otherAssignNodes.otherAssignActivities = new Array();
            // startActivity.otherAssignNodes = otherAssignNodes;
            startActivity.otherAssignNodes = new OtherAssignNodes(startActivity.Model);
        }
        else {
            startActivity.otherAssignNodes = null;
        }
    }
    /**
     * @param {?} startActivity
     * @param {?} obj
     * @return {?}
     */
    updateOtherAssignActivities(startActivity, obj) {
        /** @type {?} */
        const data = obj.propertyValue;
        if (data && data.length > 0) {
            if (typeof data[0] === "string") {
                startActivity.otherAssignNodes.otherAssignActivityNodeInfos = new Array();
                data.forEach((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    /** @type {?} */
                    let other = new OtherAssignActivityNodeInfo(startActivity.Model);
                    other.activityDefinitionId = d;
                    other.required = false;
                    other.condition = new Condition(startActivity.Model);
                    startActivity.otherAssignNodes.otherAssignActivityNodeInfos.push(other);
                }));
            }
            else {
                // startActivity.otherAssignNodes.otherAssignActivityNodeInfos = [...data];  
                startActivity.otherAssignNodes.otherAssignActivityNodeInfos = new Array();
                data.forEach((/**
                 * @param {?} d
                 * @return {?}
                 */
                d => {
                    /** @type {?} */
                    let other = new OtherAssignActivityNodeInfo(startActivity.Model);
                    other.activityDefinitionId = d.activityDefinitionId;
                    other.required = d.required;
                    other.condition = new Condition(startActivity.Model);
                    other.condition.Value = d.condition.Value;
                    startActivity.otherAssignNodes.otherAssignActivityNodeInfos.push(other);
                }));
            }
        }
        else {
            startActivity.otherAssignNodes.otherAssignActivityNodeInfos = new Array();
        }
    }
    /**
     * 更新开始节点扩展属性
     * @param {?} startActivity
     * @param {?} obj
     * @return {?}
     */
    resetExtendProperty(startActivity, obj) {
        if (startActivity) {
            /** @type {?} */
            let attributes = (/** @type {?} */ (obj.propertyValue));
            if (!startActivity.extendProperties) {
                startActivity.extendProperties = new Array();
            }
            for (const o of obj.propertyValue) {
                /** @type {?} */
                const index = startActivity.extendProperties.findIndex((/**
                 * @param {?} e
                 * @return {?}
                 */
                e => e.key === o.code));
                if (index > -1) {
                    startActivity.extendProperties.splice(index, 1);
                }
            }
            if (attributes) {
                attributes.forEach((/**
                 * @param {?} a
                 * @return {?}
                 */
                (a) => {
                    /** @type {?} */
                    let item = new ExtendProperty(startActivity.Model);
                    item.key = a.code;
                    item.value = a.value;
                    startActivity.extendProperties.push(item);
                }));
            }
        }
    }
}
StartActivityCell.CLR_TYPE_ID = StartActivity.Clr_Type_ID;
if (false) {
    /** @type {?} */
    StartActivityCell.CLR_TYPE_ID;
    /** @type {?} */
    StartActivityCell.prototype.clrTypeId;
    /** @type {?} */
    StartActivityCell.prototype.name;
    /** @type {?} */
    StartActivityCell.prototype.nameLanguage;
    /** @type {?} */
    StartActivityCell.prototype.flowElement;
    /** @type {?} */
    StartActivityCell.prototype.editorUi;
    /** @type {?} */
    StartActivityCell.prototype.imgUrls;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhcnRBY3Rpdml0eUNlbGwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXByb2Nlc3MtZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL2Rlc2lnbmVyL3dmLWNlbGwvU3RhcnRBY3Rpdml0eUNlbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUscUJBQXFCLEVBQTRCLE1BQU0sc0JBQXNCLENBQUM7QUFDakcsT0FBTyxFQUFhLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsYUFBYSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckUsT0FBTyxFQUFFLGFBQWEsRUFBRSxjQUFjLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsMkJBQTJCLEVBQUUsU0FBUyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFNUssT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQ3RGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7OztBQUtsRCxNQUFNLE9BQU8saUJBQWtCLFNBQVEsUUFBUTs7Ozs7O0lBaUIzQyxZQUFZLEtBQVcsRUFBRSxRQUErQixFQUFFLEtBQWM7UUFDcEUsS0FBSyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFqQmxDLGNBQVMsR0FBVyxpQkFBaUIsQ0FBQyxXQUFXLENBQUM7UUFDbEQsU0FBSSxHQUFXLElBQUksQ0FBQztRQUNwQixpQkFBWSxHQUFnQztZQUMxQyxRQUFRLEVBQUUsSUFBSTtZQUNkLFFBQVEsRUFBRSxJQUFJO1lBQ2QsSUFBSSxFQUFFLE9BQU87U0FDaEIsQ0FBQztRQUtBLFlBQU8sR0FBRztZQUNOLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FB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O2lCQUNuRDthQUNKO1lBQ0QsSUFBSSxVQUFVLEVBQUU7Z0JBQ1osVUFBVSxDQUFDLE9BQU87Ozs7Z0JBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRTs7d0JBQ3RCLElBQUksR0FBRyxJQUFJLGNBQWMsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO29CQUNsRCxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQ2xCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQztvQkFDckIsYUFBYSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUMsQ0FBQyxFQUFDLENBQUM7YUFDTjtTQUNKO0lBQ0wsQ0FBQzs7QUF4WE0sNkJBQVcsR0FBVyxhQUFhLENBQUMsV0FBVyxDQUFDOzs7SUFBdkQsOEJBQXVEOztJQVB2RCxzQ0FBa0Q7O0lBQ2xELGlDQUFvQjs7SUFDcEIseUNBSUE7O0lBRUEsd0NBQTJCOztJQUMzQixxQ0FBcUI7O0lBRXJCLG9DQUdFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTm9kZUNlbGwsIEVsZW1lbnRQcm9wZXJ0eUNvbmZpZywgRmFycmlzUHJvcENvbmZpZ1dpdGhEYXRhIH0gZnJvbSBcIkBlZHAtcG1mL2dyYXBoZWRpdG9yXCI7XHJcbmltcG9ydCB7IE14R3JhcGhOUywgbXhSZXNvdXJjZXMgfSBmcm9tIFwiQGVkcC1wbWYvbXhncmFwaC10c1wiO1xyXG5pbXBvcnQgeyBCcG1uTW9kZWxIZWxwZXIsIEZsb3dOb2RlU3RhdGUgfSBmcm9tIFwiQGVkcC1wbWYvYnBtbi1tb2RlbFwiO1xyXG5pbXBvcnQgeyBTdGFydEFjdGl2aXR5LCBFeHRlbmRQcm9wZXJ0eSwgSnVtcFNjb3BlLCBFeGVjdXRlRm9ybSwgQWN0dWFsUGFyYW1ldGVyLCBPdGhlckFzc2lnbk5vZGVzLCBPdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm8sIENvbmRpdGlvbiB9IGZyb20gXCJAZ3NwLXdmL3dmLXByb2Nlc3MtbW9kZWxcIjtcclxuaW1wb3J0IHsgV2ZFZGl0b3JVaSB9IGZyb20gXCIuLi9XZkVkaXRvclVpXCI7XHJcbmltcG9ydCB7IFdmQ29uc3RhbnRzIH0gZnJvbSBcIi4uL1dmQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMgfSBmcm9tIFwiLi9wcm9wZXJ0eS1rZXlzL1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXNcIjtcclxuaW1wb3J0IHsgUHJvcGVydHlIZWxwZXIgfSBmcm9tIFwiLi9Qcm9wZXJ0eUhlbHBlclwiO1xyXG5cclxuLyoqXHJcbiAqIOW8gOWni+a0u+WKqOiKgueCuVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFN0YXJ0QWN0aXZpdHlDZWxsIGV4dGVuZHMgTm9kZUNlbGwge1xyXG4gICAgY2xyVHlwZUlkOiBzdHJpbmcgPSBTdGFydEFjdGl2aXR5Q2VsbC5DTFJfVFlQRV9JRDtcclxuICAgIG5hbWU6IHN0cmluZyA9IFwi5byA5aeLXCI7XHJcbiAgICBuYW1lTGFuZ3VhZ2U6IHsgW2xhbmc6IHN0cmluZ106IHN0cmluZzsgfSA9IHtcclxuICAgICAgXCJ6aC1DSFNcIjogXCLlvIDlp4tcIixcclxuICAgICAgXCJ6aC1DSFRcIjogXCLplovlp4tcIixcclxuICAgICAgXCJlblwiOiBcIlN0YXJ0XCIsXHJcbiAgfTtcclxuICAgIHN0YXRpYyBDTFJfVFlQRV9JRDogc3RyaW5nID0gU3RhcnRBY3Rpdml0eS5DbHJfVHlwZV9JRDtcclxuICAgIGZsb3dFbGVtZW50OiBTdGFydEFjdGl2aXR5O1xyXG4gICAgZWRpdG9yVWk6IFdmRWRpdG9yVWk7XHJcblxyXG4gICAgaW1nVXJscyA9IHtcclxuICAgICAgICBbRmxvd05vZGVTdGF0ZS5EZWZhdWx0XTogV2ZDb25zdGFudHMuSU1BR0VfUEFUSCArIFwiL3N0YXJ0LnBuZ1wiLFxyXG4gICAgICAgIFtGbG93Tm9kZVN0YXRlLlNlbGVjdGVkXTogV2ZDb25zdGFudHMuSU1BR0VfUEFUSCArIFwiL3N0YXJ0X3NlbGVjdC5zdmdcIixcclxuICAgIH07XHJcblxyXG4gICAgY29uc3RydWN0b3IodmFsdWU/OiBhbnksIGdlb21ldHJ5PzogTXhHcmFwaE5TLm14R2VvbWV0cnksIHN0eWxlPzogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIodmFsdWUsIGdlb21ldHJ5LCBzdHlsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRmxvd0VsZW1lbnQoZmxvd0VsdD86IFN0YXJ0QWN0aXZpdHkpIHtcclxuICAgICAgICBjb25zdCBmbG93Tm9kZSA9IHN1cGVyLmNyZWF0ZUZsb3dFbGVtZW50KGZsb3dFbHQpIGFzIFN0YXJ0QWN0aXZpdHk7XHJcbiAgICAgICAgY29uc3QgZWRpdG9yVWkgPSB0aGlzLmVkaXRvclVpO1xyXG4gICAgICAgIGZsb3dOb2RlLklkID0gXCJzdGFydEFjdGl2aXR5XCIgKyBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgICAvLyDliJvlu7rogIzpnZ7lpI3liLbml7bmiafooYxcclxuICAgICAgICBpZiAoZmxvd0VsdCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vIOiuvue9rum7mOiupOihqOWNlVxyXG4gICAgICAgICAgICBpZiAoZWRpdG9yVWkgJiYgZWRpdG9yVWkuZm9ybUZvcm1hdHMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1Gb3JtYXRzID0gZWRpdG9yVWkuZm9ybUZvcm1hdHM7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEFjdGl2aXR5Rm9ybXMgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBjRm9ybSA9IGZvcm1Gb3JtYXRzLmZpbHRlcihmID0+IGYudGVybWluYWwgPT09ICdQQycgJiYgZi5zdGF0dXMgPT09IDEpWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBjRm9ybSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHlGb3Jtcy5wdXNoKHBjRm9ybSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtb2JpbGVGb3JtID0gZm9ybUZvcm1hdHMuZmlsdGVyKGYgPT4gZi50ZXJtaW5hbCA9PT0gJ01vYmlsZScgJiYgZi5zdGF0dXMgPT09IDEpWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vYmlsZUZvcm0pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydEFjdGl2aXR5Rm9ybXMucHVzaChtb2JpbGVGb3JtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnRBY3Rpdml0eUZvcm1zICYmIHN0YXJ0QWN0aXZpdHlGb3Jtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxvd05vZGUuc2V0RGVmYXVsdEZvcm1zKHN0YXJ0QWN0aXZpdHlGb3Jtcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmbG93Tm9kZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRGYXJyaXNQcm9wQ29uZmlnKCk6IEZhcnJpc1Byb3BDb25maWdXaXRoRGF0YSB7XHJcbiAgICAgICAgY29uc3QgZWRpdG9yVWkgPSB0aGlzLmVkaXRvclVpO1xyXG4gICAgICAgIGNvbnN0IGFjdCA9IHRoaXMuZmxvd0VsZW1lbnQgYXMgU3RhcnRBY3Rpdml0eTtcclxuICAgICAgICBsZXQgZXh0ZW5kTGlzdCA9IFtdO1xyXG4gICAgICAgIGlmIChlZGl0b3JVaS5wcm9jRXh0UHJvcHMgJiYgZWRpdG9yVWkucHJvY0V4dFByb3BzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZXh0ZW5kTGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZWRpdG9yVWkucHJvY0V4dFByb3BzKSkuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuc29ydE9yZGVyIC0gYi5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBleHRlbmRMaXN0ID0gZXh0ZW5kTGlzdC5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLnNvcnRPcmRlciAtIGIuc29ydE9yZGVyO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGxldCBQcm9wZXJ0eUNvbmZpZzogRWxlbWVudFByb3BlcnR5Q29uZmlnID0gbmV3IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZygpO1xyXG4gICAgICAgIGxldCBwcm9wZXJ0eURhdGE6IGFueSA9IG5ldyBPYmplY3QoKTtcclxuICAgICAgICBQcm9wZXJ0eUNvbmZpZy5jYXRlZ29yeUlkID0gJ2dlbmVyYWwnO1xyXG4gICAgICAgIFByb3BlcnR5Q29uZmlnLmNhdGVnb3J5TmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNJbmZvcm1hdGlvbicpO1xyXG4gICAgICAgIFByb3BlcnR5Q29uZmlnLnRhYklkID0gJ2Jhc2ljJztcclxuICAgICAgICBQcm9wZXJ0eUNvbmZpZy50YWJOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdiYXNpY0F0dHJpYnV0ZXMnKTtcclxuICAgICAgICBQcm9wZXJ0eUNvbmZpZy5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuTmFtZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ25hbWUnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgdmlzaWJsZTogIXRoaXMuZWRpdG9yVWkubXVsdGlMYW5nRW5hYmxlZCB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuTmFtZUxhbmd1YWdlLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnbmFtZUxhbmd1YWdlJyksIHByb3BlcnR5VHlwZTogJ211bHRpTGFuZ3VhZ2UnLCB2aXNpYmxlOiB0aGlzLmVkaXRvclVpLm11bHRpTGFuZ0VuYWJsZWQgfSxcclxuICAgICAgICAgICAgeyBwcm9wZXJ0eUlEOiBTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLklkLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnaWQnKSwgcHJvcGVydHlUeXBlOiAnc3RyaW5nJywgcmVhZG9ubHk6IHRydWUgfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGxldCBmb3JtRGVmID0gbmV3IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZygpO1xyXG4gICAgICAgIGZvcm1EZWYuY2F0ZWdvcnlJZCA9ICdmb3JtRGVmJztcclxuICAgICAgICBmb3JtRGVmLmNhdGVnb3J5TmFtZSA9IG14UmVzb3VyY2VzLmdldCgnZm9ybURlZicpO1xyXG4gICAgICAgIGZvcm1EZWYudGFiSWQgPSAnYmFzaWMnO1xyXG4gICAgICAgIGZvcm1EZWYudGFiTmFtZSA9IG14UmVzb3VyY2VzLmdldCgnYmFzaWNBdHRyaWJ1dGVzJyk7XHJcbiAgICAgICAgZm9ybURlZi5wcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMud2ZfRXhlY3V0ZUZvcm1zX1BDLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgncGNGb3JtJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMud2ZfRXhlY3V0ZUZvcm1zX01vYmlsZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ3dlYkZvcm0nKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH0sXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgbGV0IEFjdGl2aXR5Q29uZmlnOiBFbGVtZW50UHJvcGVydHlDb25maWcgPSBuZXcgRWxlbWVudFByb3BlcnR5Q29uZmlnKCk7XHJcbiAgICAgICAgQWN0aXZpdHlDb25maWcuY2F0ZWdvcnlJZCA9ICdhY3Rpdml0eUNvbmZpZyc7XHJcbiAgICAgICAgQWN0aXZpdHlDb25maWcuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdhY3Rpdml0eVByb3BlcnR5Jyk7XHJcbiAgICAgICAgQWN0aXZpdHlDb25maWcudGFiSWQgPSAnYmFzaWMnO1xyXG4gICAgICAgIEFjdGl2aXR5Q29uZmlnLnRhYk5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2Jhc2ljQXR0cmlidXRlcycpO1xyXG4gICAgICAgIEFjdGl2aXR5Q29uZmlnLnByb3BlcnRpZXMgPSBbXHJcbiAgICAgICAgICAgIC8vIHsgcHJvcGVydHlJRDogU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5FeGVjdXRlRm9ybXMsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdmb3JtRGVmJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9LFxyXG4gICAgICAgICAgICB7IHByb3BlcnR5SUQ6ICdzZW5kQmFja2VkVGFzaycsIHByb3BlcnR5TmFtZTogbXhSZXNvdXJjZXMuZ2V0KCdzZW5kQmFja2VkVGFzaycpLCBwcm9wZXJ0eVR5cGU6ICdzZWxlY3QnIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBpZiAoYWN0LnNlbGVjdFRhcmdldEFibGUpIHtcclxuICAgICAgICAgICAgQWN0aXZpdHlDb25maWcucHJvcGVydGllcyA9IEFjdGl2aXR5Q29uZmlnLnByb3BlcnRpZXMuY29uY2F0KFtcclxuICAgICAgICAgICAgICAgIHsgcHJvcGVydHlJRDogU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5TZWxlY3RUYXJnZXRBYmxlLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnc2VsZWN0VGFyZ2V0QWJsZScpLCBwcm9wZXJ0eVR5cGU6ICdzZWxlY3QnIH0sXHJcbiAgICAgICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuSnVtcFNjb3BlLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnanVtcFNjb3BlJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9XSk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YS5TZWxlY3RUYXJnZXRBYmxlID0gYWN0LnNlbGVjdFRhcmdldEFibGUgfHwgZmFsc2U7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YS5KdW1wU2NvcGUgPSBhY3QuanVtcFNjb3BlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIEFjdGl2aXR5Q29uZmlnLnByb3BlcnRpZXMgPSBBY3Rpdml0eUNvbmZpZy5wcm9wZXJ0aWVzLmNvbmNhdChbXHJcbiAgICAgICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuU2VsZWN0VGFyZ2V0QWJsZSwgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ3NlbGVjdFRhcmdldEFibGUnKSwgcHJvcGVydHlUeXBlOiAnc2VsZWN0JyB9XSk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YS5TZWxlY3RUYXJnZXRBYmxlID0gYWN0LnNlbGVjdFRhcmdldEFibGUgfHwgZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoYWN0Lm90aGVyQXNzaWduTm9kZXMpIHtcclxuICAgICAgICAgICAgQWN0aXZpdHlDb25maWcucHJvcGVydGllcyA9IEFjdGl2aXR5Q29uZmlnLnByb3BlcnRpZXMuY29uY2F0KFtcclxuICAgICAgICAgICAgICAgIHsgcHJvcGVydHlJRDogU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5vdGhlckFzc2lnbk5vZGVzLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnb3RoZXJBc3NpZ25Ob2RlcycpLCBwcm9wZXJ0eVR5cGU6ICdzZWxlY3QnIH0sXHJcbiAgICAgICAgICAgICAgICAvLyB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMub3RoZXJBc3NpZ25BY3Rpdml0aWVzLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnb3RoZXJBc3NpZ25BY3Rpdml0aWVzJyksIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9XHJcbiAgICAgICAgICAgICAgICB7IHByb3BlcnR5SUQ6IFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcywgcHJvcGVydHlOYW1lOiBteFJlc291cmNlcy5nZXQoJ290aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MnKSwgcHJvcGVydHlUeXBlOiAnbW9kYWwnIH1cclxuICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLm90aGVyQXNzaWduTm9kZXNdID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMub3RoZXJBc3NpZ25BY3Rpdml0aWVzXSA9IGFjdC5vdGhlckFzc2lnbk5vZGVzLm90aGVyQXNzaWduQWN0aXZpdGllcztcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvc10gPSBhY3Qub3RoZXJBc3NpZ25Ob2Rlcy5vdGhlckFzc2lnbkFjdGl2aXRpZXMgfHwgYWN0Lm90aGVyQXNzaWduTm9kZXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcztcclxuICAgICAgICAgICAgaWYoYWN0Lm90aGVyQXNzaWduTm9kZXMub3RoZXJBc3NpZ25BY3Rpdml0aWVzKXtcclxuICAgICAgICAgICAgICAgIGFjdC5vdGhlckFzc2lnbk5vZGVzLm90aGVyQXNzaWduQWN0aXZpdGllcyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgQWN0aXZpdHlDb25maWcucHJvcGVydGllcyA9IEFjdGl2aXR5Q29uZmlnLnByb3BlcnRpZXMuY29uY2F0KFtcclxuICAgICAgICAgICAgICAgIHsgcHJvcGVydHlJRDogU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5vdGhlckFzc2lnbk5vZGVzLCBwcm9wZXJ0eU5hbWU6IG14UmVzb3VyY2VzLmdldCgnb3RoZXJBc3NpZ25Ob2RlcycpLCBwcm9wZXJ0eVR5cGU6ICdzZWxlY3QnIH1cclxuICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLm90aGVyQXNzaWduTm9kZXNdID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBncm91cExpc3QgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICBmb3IgKGNvbnN0IGV4dGVuZCBvZiBleHRlbmRMaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICghZXh0ZW5kLnBhcmVudElkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cCA9IHsgcGFyZW50OiBleHRlbmQsIGNoaWxkczogbmV3IEFycmF5KCkgfTtcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBleHRlbmRMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucGFyZW50SWQgPT09IGV4dGVuZC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cC5jaGlsZHMucHVzaChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBncm91cExpc3QucHVzaChncm91cClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDmsqHmnInmianlsZXlsZ7mgKflgLznmoTml7blgJnkuI3mmL7npLrmianlsZXlsZ7mgKfkuIDmoI9cclxuICAgICAgICBpZiAoZ3JvdXBMaXN0ICYmIGdyb3VwTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGxldCBFeHRlbmRQcm9wZXJ0eUNvbmZpZzogRWxlbWVudFByb3BlcnR5Q29uZmlnID0gbmV3IEVsZW1lbnRQcm9wZXJ0eUNvbmZpZygpO1xyXG4gICAgICAgICAgICBFeHRlbmRQcm9wZXJ0eUNvbmZpZy5jYXRlZ29yeUlkID0gJ2V4dGVuZFByb3BlcnR5Q29uZmlnJztcclxuICAgICAgICAgICAgRXh0ZW5kUHJvcGVydHlDb25maWcuY2F0ZWdvcnlOYW1lID0gbXhSZXNvdXJjZXMuZ2V0KCdleHRlbmRQcm9wZXJ0eUNvbmZpZycpO1xyXG4gICAgICAgICAgICBFeHRlbmRQcm9wZXJ0eUNvbmZpZy50YWJJZCA9ICdhZHZhbmNlZCc7XHJcbiAgICAgICAgICAgIEV4dGVuZFByb3BlcnR5Q29uZmlnLnRhYk5hbWUgPSBteFJlc291cmNlcy5nZXQoJ2FkdmFuY2VkQXR0cmlidXRlcycpO1xyXG4gICAgICAgICAgICBFeHRlbmRQcm9wZXJ0eUNvbmZpZy5wcm9wZXJ0aWVzID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZyBvZiBncm91cExpc3QpIHtcclxuICAgICAgICAgICAgICAgIEV4dGVuZFByb3BlcnR5Q29uZmlnLnByb3BlcnRpZXMucHVzaChcclxuICAgICAgICAgICAgICAgICAgICB7IHByb3BlcnR5SUQ6IGcucGFyZW50LmlkLCBwcm9wZXJ0eU5hbWU6IGcucGFyZW50LnByb3BlcnR5VGl0bGUsIHByb3BlcnR5VHlwZTogJ21vZGFsJyB9KTtcclxuICAgICAgICAgICAgICAgIC8vIOWPluWbnuaooeWei+S4iueahHZhbHVl5YC857uZ5Yiw5omp5bGV5bGe5oCn57uE5Lu26YeMXHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0LmV4dGVuZFByb3BlcnRpZXMgJiYgYWN0LmV4dGVuZFByb3BlcnRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGcuY2hpbGRzLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc29ydE9yZGVyIC0gYi5zb3J0T3JkZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSkuZm9yRWFjaCgoZDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdC5leHRlbmRQcm9wZXJ0aWVzLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT0gZC5jb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC52YWx1ZSA9IGUudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEYXRhW2cucGFyZW50LmlkXSA9IGcuY2hpbGRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHRvZG/vvJrkuI5lbHNl5YiG5pSv5Luj56CB6YeN5aSN77yM5Y+v5o+Q5Y+W6IezaWbor63lj6XlpJbvvIzmnKzmrKHkv67mlLnku4Xpkojlr7nlkI3np7DlpJror63vvIzmlYXmmoLkuI3kv67mlLlcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuSWRdID0gYWN0LklkO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eURhdGFbU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5DbHJUeXBlSURdID0gYWN0LkNsclR5cGVJRDtcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuTmFtZV0gPSBhY3QuTmFtZSB8fCBteFJlc291cmNlcy5nZXQoJ3N0YXJ0Jyk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLk5hbWVMYW5ndWFnZV0gPSBhY3QuTmFtZUxhbmd1YWdlIHx8IHtcclxuICAgICAgICAgICAgICAgIFwiemgtQ0hTXCI6IGFjdC5OYW1lLFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuc2VuZEJhY2tlZFRhc2tdID0gYWN0LnNlbmRCYWNrZWRUYXNrO1xyXG5cclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMud2ZfRXhlY3V0ZUZvcm1zX1BDXSA9XHJcbiAgICAgICAgICAgICAgICBhY3QuRXhlY3V0ZUZvcm1zID8gYWN0LkV4ZWN1dGVGb3Jtcy5maW5kKGUgPT4gZS5UZXJtaW5hbFR5cGUgPT09ICdQQycpIDogbnVsbDtcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMud2ZfRXhlY3V0ZUZvcm1zX01vYmlsZV0gPVxyXG4gICAgICAgICAgICAgICAgYWN0LkV4ZWN1dGVGb3JtcyA/IGFjdC5FeGVjdXRlRm9ybXMuZmluZChlID0+IGUuVGVybWluYWxUeXBlID09PSAnTU9CSUxFJykgOiBudWxsO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtQcm9wZXJ0eUNvbmZpZywgZm9ybURlZiwgQWN0aXZpdHlDb25maWcsIEV4dGVuZFByb3BlcnR5Q29uZmlnXSxcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGF0YTogcHJvcGVydHlEYXRhXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwcm9wZXJ0eURhdGFbU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5JZF0gPSBhY3QuSWQ7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGF0YVtTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLkNsclR5cGVJRF0gPSBhY3QuQ2xyVHlwZUlEO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eURhdGFbU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5OYW1lXSA9IGFjdC5OYW1lIHx8IG14UmVzb3VyY2VzLmdldCgnc3RhcnQnKTtcclxuICAgICAgICAgICAgcHJvcGVydHlEYXRhW1N0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMuTmFtZUxhbmd1YWdlXSA9IGFjdC5OYW1lTGFuZ3VhZ2UgfHwge1xyXG4gICAgICAgICAgICAgICAgXCJ6aC1DSFNcIjogYWN0Lk5hbWUsXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJ0eURhdGFbU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5zZW5kQmFja2VkVGFza10gPSBhY3Quc2VuZEJhY2tlZFRhc2s7XHJcblxyXG4gICAgICAgICAgICBwcm9wZXJ0eURhdGFbU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy53Zl9FeGVjdXRlRm9ybXNfUENdID1cclxuICAgICAgICAgICAgICAgIGFjdC5FeGVjdXRlRm9ybXMgPyBhY3QuRXhlY3V0ZUZvcm1zLmZpbmQoZSA9PiBlLlRlcm1pbmFsVHlwZSA9PT0gJ1BDJykgOiBudWxsO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eURhdGFbU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy53Zl9FeGVjdXRlRm9ybXNfTW9iaWxlXSA9XHJcbiAgICAgICAgICAgICAgICBhY3QuRXhlY3V0ZUZvcm1zID8gYWN0LkV4ZWN1dGVGb3Jtcy5maW5kKGUgPT4gZS5UZXJtaW5hbFR5cGUgPT09ICdNT0JJTEUnKSA6IG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDb25maWc6IFtQcm9wZXJ0eUNvbmZpZywgZm9ybURlZiwgQWN0aXZpdHlDb25maWddLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlEYXRhOiBwcm9wZXJ0eURhdGFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVQcm9wcyhvYmo6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGVkaXRvclVpID0gdGhpcy5lZGl0b3JVaTtcclxuICAgICAgICBjb25zdCBzdGFydEFjdGl2aXR5ID0gdGhpcy5mbG93RWxlbWVudDtcclxuICAgICAgICBjb25zdCBwcm9wZXJ0eUlkOiBzdHJpbmcgPSBvYmoucHJvcGVydHlJRDtcclxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5SWQpIHtcclxuICAgICAgICAgICAgY2FzZSBTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLndmX0V4ZWN1dGVGb3Jtc19QQzpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhcnRBY3Rpdml0eUZvcm0oc3RhcnRBY3Rpdml0eSwgb2JqLCAnUEMnKTtcclxuICAgICAgICAgICAgICAgIGlmIChvYmoucGFyYW1ldGVycyAmJiBvYmoucGFyYW1ldGVycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgUHJvcGVydHlIZWxwZXIudXBkYXRlRm9ybWFsUGFyYW1ldGVycyhlZGl0b3JVaS5ncmFwaC5icG1uTW9kZWwuRGVmYXVsdFByb2Nlc3MsIG9iai5wYXJhbWV0ZXJzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMud2ZfRXhlY3V0ZUZvcm1zX01vYmlsZTpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhcnRBY3Rpdml0eUZvcm0oc3RhcnRBY3Rpdml0eSwgb2JqLCAnTU9CSUxFJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnBhcmFtZXRlcnMgJiYgb2JqLnBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFByb3BlcnR5SGVscGVyLnVwZGF0ZUZvcm1hbFBhcmFtZXRlcnMoZWRpdG9yVWkuZ3JhcGguYnBtbk1vZGVsLkRlZmF1bHRQcm9jZXNzLCBvYmoucGFyYW1ldGVycyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLlNlbGVjdFRhcmdldEFibGU6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0U2VsZWN0VGFyZ2V0QWJsZShzdGFydEFjdGl2aXR5LCBvYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgU3RhcnRBY3Rpdml0eVByb3BlcnR5S2V5cy5KdW1wU2NvcGU6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0SnVtcFNjb3BlKHN0YXJ0QWN0aXZpdHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBTdGFydEFjdGl2aXR5UHJvcGVydHlLZXlzLm90aGVyQXNzaWduTm9kZXM6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU90aGVyQXNzaWduTm9kZXMoc3RhcnRBY3Rpdml0eSwgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMub3RoZXJBc3NpZ25BY3Rpdml0aWVzOlxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVPdGhlckFzc2lnbkFjdGl2aXRpZXMoc3RhcnRBY3Rpdml0eSwgb2JqKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFN0YXJ0QWN0aXZpdHlQcm9wZXJ0eUtleXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvczpcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3RoZXJBc3NpZ25BY3Rpdml0aWVzKHN0YXJ0QWN0aXZpdHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIC8vIOWIpOaWrVJlc291cmNlS2V5c+aYr+S4jeaYr2dyb3VwaWQs5piv5bCx6LWwcmVzZXRFeHRlbmRQcm9wZXJ0eVxyXG4gICAgICAgICAgICAgICAgaWYgKGVkaXRvclVpLnByb2NFeHRQcm9wcy5maW5kSW5kZXgocCA9PiBwLmlkID09PSBwcm9wZXJ0eUlkKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEV4dGVuZFByb3BlcnR5KHN0YXJ0QWN0aXZpdHksIG9iaik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN1cGVyLnVwZGF0ZVByb3BzKG9iaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlU3RhcnRBY3Rpdml0eUZvcm0oc3RhcnQ6IFN0YXJ0QWN0aXZpdHksIG9iajogYW55LCB0ZXJtaW5hbDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHN0YXJ0KSB7XHJcbiAgICAgICAgICAgIGxldCBmb3JtID0gb2JqLnByb3BlcnR5VmFsdWUgYXMgYW55O1xyXG4gICAgICAgICAgICBpZiAoIXN0YXJ0LkV4ZWN1dGVGb3Jtcykge1xyXG4gICAgICAgICAgICAgICAgc3RhcnQuRXhlY3V0ZUZvcm1zID0gbmV3IEFycmF5PEV4ZWN1dGVGb3JtPigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0YXJ0LkV4ZWN1dGVGb3JtcyA9IHN0YXJ0LkV4ZWN1dGVGb3Jtcy5maWx0ZXIoZSA9PiBlLlRlcm1pbmFsVHlwZSAhPT0gdGVybWluYWwpO1xyXG4gICAgICAgICAgICBpZiAoZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhcmFtcyA9IGZvcm0uQWN0dWFsUGFyYW1ldGVycyBhcyBhbnlbXTtcclxuICAgICAgICAgICAgICAgIGxldCBhY3RQYXJhcyA9IG5ldyBBcnJheTxBY3R1YWxQYXJhbWV0ZXI+KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgcGFyYSBvZiBwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFjdFBhcmEgPSBuZXcgQWN0dWFsUGFyYW1ldGVyKHN0YXJ0Lk1vZGVsLCBwYXJhLk5hbWUsIHBhcmEuVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyYS5UYWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdFBhcmEuVGFnID0gcGFyYS5UYWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyYS5WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhLlZhbHVlLmxlbmd0aCA+PSA4ICYmIHBhcmEuVmFsdWUuc2xpY2UoMCwgOCkgPT09IGB7XCJleHByXCI6YCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RQYXJhLlRhZyA9ICdleHByZXNzaW9uJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RQYXJhLlRhZyA9ICdjb25zdGFudCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RQYXJhLlRhZyA9ICd2YXJpYWJsZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdFBhcmFzLnB1c2goYWN0UGFyYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgaWQgPSBCcG1uTW9kZWxIZWxwZXIuR2VuZXJhdGVFbGVtZW50SWQoKTtcclxuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbmV3IEV4ZWN1dGVGb3JtKHN0YXJ0Lk1vZGVsLCBpZCwgZm9ybS5OYW1lLCBhY3RQYXJhcyk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLkNvbXBvbmVudElkID0gZm9ybS5Db21wb25lbnRJZDtcclxuICAgICAgICAgICAgICAgIGl0ZW0uRm9ybVR5cGUgPSBmb3JtLkZvcm1UeXBlO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5mb3JtRm9ybWF0SWQgPSBmb3JtLmZvcm1Gb3JtYXRJZDtcclxuICAgICAgICAgICAgICAgIGl0ZW0uZm9ybWF0Q29uZmlnSWQgPSBmb3JtLmZvcm1hdENvbmZpZ0lkO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5UZXJtaW5hbFR5cGUgPSBmb3JtLlRlcm1pbmFsVHlwZTtcclxuICAgICAgICAgICAgICAgIHN0YXJ0LkV4ZWN1dGVGb3Jtcy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pu05paw5piv5ZCm5YWB6K646Lez6L2s5bGe5oCnXHJcbiAgICAgKiBAcGFyYW0gc3RhcnRBY3Rpdml0eVxyXG4gICAgICogQHBhcmFtIG9ialxyXG4gICAgICovXHJcbiAgICByZXNldFNlbGVjdFRhcmdldEFibGUoc3RhcnRBY3Rpdml0eTogU3RhcnRBY3Rpdml0eSwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBzZWxlY3RUYXJnZXRBYmxlID0gb2JqLnByb3BlcnR5VmFsdWUgYXMgYm9vbGVhbjtcclxuICAgICAgICBzdGFydEFjdGl2aXR5LnNlbGVjdFRhcmdldEFibGUgPSBzZWxlY3RUYXJnZXRBYmxlO1xyXG4gICAgICAgIGlmIChzdGFydEFjdGl2aXR5LnNlbGVjdFRhcmdldEFibGUpIHtcclxuICAgICAgICAgICAgc3RhcnRBY3Rpdml0eS5qdW1wU2NvcGUgPSBuZXcgSnVtcFNjb3BlKHN0YXJ0QWN0aXZpdHkuTW9kZWwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHkuanVtcFNjb3BlID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRKdW1wU2NvcGUoc3RhcnRBY3Rpdml0eTogU3RhcnRBY3Rpdml0eSwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gb2JqLnByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgbGV0IGp1bXBTY29wZSA9IG5ldyBKdW1wU2NvcGUoc3RhcnRBY3Rpdml0eS5Nb2RlbCk7XHJcbiAgICAgICAgICAgIGp1bXBTY29wZS5DYXRlZ29yeSA9IGRhdGEuQ2F0ZWdvcnk7XHJcbiAgICAgICAgICAgIGp1bXBTY29wZS5EZWZhdWx0VHlwZSA9IGRhdGEuRGVmYXVsdFR5cGU7XHJcbiAgICAgICAgICAgIGp1bXBTY29wZS5EZWZhdWx0QWN0aXZpdHkgPSBkYXRhLkRlZmF1bHRBY3Rpdml0eTtcclxuICAgICAgICAgICAganVtcFNjb3BlLkRlc3RpbmF0aW9uQWN0aXZpdGllcyA9IGRhdGEuRGVzdGluYXRpb25BY3Rpdml0aWVzO1xyXG4gICAgICAgICAgICBzdGFydEFjdGl2aXR5Lmp1bXBTY29wZSA9IGp1bXBTY29wZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdGFydEFjdGl2aXR5Lmp1bXBTY29wZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZU90aGVyQXNzaWduTm9kZXMoc3RhcnRBY3Rpdml0eTogU3RhcnRBY3Rpdml0eSwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBkYXRhOiBib29sZWFuID0gb2JqLnByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gY29uc3Qgb3RoZXJBc3NpZ25Ob2RlcyA9IG5ldyBPdGhlckFzc2lnbk5vZGVzKHN0YXJ0QWN0aXZpdHkuTW9kZWwpO1xyXG4gICAgICAgICAgICAvLyBvdGhlckFzc2lnbk5vZGVzLm90aGVyQXNzaWduQWN0aXZpdGllcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgICAgICAvLyBzdGFydEFjdGl2aXR5Lm90aGVyQXNzaWduTm9kZXMgPSBvdGhlckFzc2lnbk5vZGVzO1xyXG4gICAgICAgICAgICBzdGFydEFjdGl2aXR5Lm90aGVyQXNzaWduTm9kZXMgPSBuZXcgT3RoZXJBc3NpZ25Ob2RlcyhzdGFydEFjdGl2aXR5Lk1vZGVsKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdGFydEFjdGl2aXR5Lm90aGVyQXNzaWduTm9kZXMgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVPdGhlckFzc2lnbkFjdGl2aXRpZXMoc3RhcnRBY3Rpdml0eTogU3RhcnRBY3Rpdml0eSwgb2JqOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBkYXRhOmFueVtdID0gb2JqLnByb3BlcnR5VmFsdWU7XHJcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVswXSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgc3RhcnRBY3Rpdml0eS5vdGhlckFzc2lnbk5vZGVzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MgPSBuZXcgQXJyYXk8T3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvPigpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBvdGhlciA9IG5ldyBPdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm8oc3RhcnRBY3Rpdml0eS5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3RoZXIuYWN0aXZpdHlEZWZpbml0aW9uSWQgPSBkO1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyLnJlcXVpcmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgb3RoZXIuY29uZGl0aW9uID0gbmV3IENvbmRpdGlvbihzdGFydEFjdGl2aXR5Lk1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydEFjdGl2aXR5Lm90aGVyQXNzaWduTm9kZXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcy5wdXNoKG90aGVyKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzdGFydEFjdGl2aXR5Lm90aGVyQXNzaWduTm9kZXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcyA9IFsuLi5kYXRhXTsgIFxyXG4gICAgICAgICAgICAgICAgc3RhcnRBY3Rpdml0eS5vdGhlckFzc2lnbk5vZGVzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MgPSBuZXcgQXJyYXk8T3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvPigpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBvdGhlciA9IG5ldyBPdGhlckFzc2lnbkFjdGl2aXR5Tm9kZUluZm8oc3RhcnRBY3Rpdml0eS5Nb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3RoZXIuYWN0aXZpdHlEZWZpbml0aW9uSWQgPSBkLmFjdGl2aXR5RGVmaW5pdGlvbklkO1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyLnJlcXVpcmVkID0gZC5yZXF1aXJlZDtcclxuICAgICAgICAgICAgICAgICAgICBvdGhlci5jb25kaXRpb24gPSBuZXcgQ29uZGl0aW9uKHN0YXJ0QWN0aXZpdHkuTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyLmNvbmRpdGlvbi5WYWx1ZSA9IGQuY29uZGl0aW9uLlZhbHVlOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRBY3Rpdml0eS5vdGhlckFzc2lnbk5vZGVzLm90aGVyQXNzaWduQWN0aXZpdHlOb2RlSW5mb3MucHVzaChvdGhlcik7XHJcbiAgICAgICAgICAgICAgICB9KTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdGFydEFjdGl2aXR5Lm90aGVyQXNzaWduTm9kZXMub3RoZXJBc3NpZ25BY3Rpdml0eU5vZGVJbmZvcyA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOabtOaWsOW8gOWni+iKgueCueaJqeWxleWxnuaAp1xyXG4gICAgICogQHBhcmFtIHN0YXJ0QWN0aXZpdHlcclxuICAgICAqIEBwYXJhbSBvYmpcclxuICAgICAqL1xyXG4gICAgcmVzZXRFeHRlbmRQcm9wZXJ0eShzdGFydEFjdGl2aXR5OiBTdGFydEFjdGl2aXR5LCBvYmo6IGFueSkge1xyXG4gICAgICAgIGlmIChzdGFydEFjdGl2aXR5KSB7XHJcbiAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVzID0gb2JqLnByb3BlcnR5VmFsdWUgYXMgYW55O1xyXG4gICAgICAgICAgICBpZiAoIXN0YXJ0QWN0aXZpdHkuZXh0ZW5kUHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgc3RhcnRBY3Rpdml0eS5leHRlbmRQcm9wZXJ0aWVzID0gbmV3IEFycmF5PEV4dGVuZFByb3BlcnR5PigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgbyBvZiBvYmoucHJvcGVydHlWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBzdGFydEFjdGl2aXR5LmV4dGVuZFByb3BlcnRpZXMuZmluZEluZGV4KGUgPT4gZS5rZXkgPT09IG8uY29kZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHkuZXh0ZW5kUHJvcGVydGllcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLmZvckVhY2goKGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbmV3IEV4dGVuZFByb3BlcnR5KHN0YXJ0QWN0aXZpdHkuTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ua2V5ID0gYS5jb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBhLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0QWN0aXZpdHkuZXh0ZW5kUHJvcGVydGllcy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, TemplateRef, ViewChild } from '@angular/core';
import { DatagridComponent } from '@farris/ui-datagrid';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { LoadingService } from '@farris/ui-loading';
import { NotifyService } from '@farris/ui-notify';
import { of, Subject } from 'rxjs';
import { CommonComment } from '../../entity/comment';
import { CommonCommentFilter } from '../../entity/commonCommentFilter';
import { I18nService } from '../../service/i18n/i18n.service';
import { TaskService } from '../../service/task.service';
export class CommentManageComponent {
    //取消确认按钮
    /**
     * @param {?} i18nService
     * @param {?} taskService
     * @param {?} notify
     * @param {?} loadingService
     */
    constructor(i18nService, taskService, notify, loadingService) {
        this.i18nService = i18nService;
        this.taskService = taskService;
        this.notify = notify;
        this.loadingService = loadingService;
        this.commentList = [];
        this.originCommentList = [];
        this.commentColumns = [];
        this.confirmSubject = new Subject(); //点击确定
        //点击确定
        this.cancelSubject = new Subject(); //点击取消
        /**
         * 系统预置的不允许编辑删除
         * @param data data.rowData为实体数据
         * @return
         */
        this.beforeEdit = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data.rowData.userId == '*') {
                return of(false);
            }
            return of(true);
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.commentColumns = [{
                field: 'message',
                width: 100,
                title: this.i18nService.getValue('comment.static.content'),
                editor: { type: EditorTypes.TEXTBOX, options: {} },
            }, {
                field: 'userId',
                width: 20,
                title: this.i18nService.getValue('comment.static.type'),
                template: this.commentTypeCell
            }, {
                field: 'operate',
                width: 20,
                title: this.i18nService.getValue('comment.static.operate'),
                template: this.commentOperateCell
            }];
        //加载意见列表
        this.loadComments();
    }
    /**
     * 点击常用意见，获取用户常用意见列表
     * @return {?}
     */
    loadComments() {
        /** @type {?} */
        const load = this.loadingService.show();
        this.taskService.getCommentList(this.filter).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            load.close();
            this.commentList = data;
            this.originCommentList = JSON.parse(JSON.stringify(data));
        }), (/**
         * @return {?}
         */
        () => {
            load.close();
        }));
    }
    /**
     * 新增一条常用意见
     * @return {?}
     */
    addCommonComment() {
        /** @type {?} */
        const newEntity = CommonComment.newEntity();
        newEntity.sortOrder = this.commentList.length + 1;
        if (this.filter && this.filter.type) {
            newEntity.type = this.filter.type;
        }
        this.commentList = this.commentList.concat(newEntity);
        //新增后直接编辑单元格
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.dataGrid.editCell(newEntity.id, 'message');
        }), 100);
    }
    /**
     * 删除一条意见 data.rowData
     * @param {?} data
     * @return {?}
     */
    deleteComment(data) {
        if (data.rowData.userId !== '*') {
            this.commentList = this.commentList.filter((/**
             * @param {?} c
             * @return {?}
             */
            c => c.id != data.rowData.id));
            this.originCommentList = this.originCommentList.filter((/**
             * @param {?} c
             * @return {?}
             */
            c => c.id != data.rowData.id));
            this.dataGrid.loadData(this.commentList);
            this.taskService.deleteComment(data.rowData.id).subscribe((/**
             * @return {?}
             */
            () => { }));
        }
    }
    /**
     * 常用意见点击保存
     * @return {?}
     */
    saveCommonComment() {
        this.dataGrid.endCellEdit();
        this.commentList = this.commentList.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c.message));
        this.commentList.forEach((/**
         * @param {?} comment
         * @return {?}
         */
        comment => {
            if (this.taskService.getBytesLength(comment.message) > 255) {
                this.notify.warning(this.i18nService.getValue('cueWords.commonCommentTooLong'));
                this.dataGrid.editCell(comment.id, 'message');
                throw new Error("");
            }
        }));
        this.commentList.forEach((/**
         * @param {?} comment
         * @return {?}
         */
        comment => {
            /** @type {?} */
            let origin = this.originCommentList.find((/**
             * @param {?} c
             * @return {?}
             */
            c => c.id == comment.id));
            if (!origin || comment.message !== origin.message || comment.sortOrder != origin.sortOrder) {
                this.taskService.addComment(comment).subscribe((/**
                 * @return {?}
                 */
                () => { }));
            }
        }));
        //此处已返回给farris
        this.confirmSubject.next({ action: 'submit', data: this.commentList });
    }
    /**
     * 点击取消（此处已返回给farris）
     * @return {?}
     */
    clickCancel() {
        this.commentList = this.commentList.filter((/**
         * @param {?} c
         * @return {?}
         */
        c => c.message));
        this.cancelSubject.next({ action: 'cancel', data: this.originCommentList });
    }
    /**
     * @return {?}
     */
    getConfirmSUbject() {
        return this.confirmSubject.asObservable();
    }
    /**
     * @return {?}
     */
    getCancelSubject() {
        return this.cancelSubject.asObservable();
    }
}
CommentManageComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-comment-manage',
                template: "<div class=\"task-comment-div\">\r\n  <div class=\"task-comment-datagrid-div\">\r\n    <farris-datagrid\r\n      #dataGrid\r\n      [data]=\"commentList\"\r\n      [columns]=\"commentColumns\"\r\n      [editable]=\"true\"\r\n      [fit]=\"true\"\r\n      [editMode]=\"'cell'\"\r\n      [pagination]=\"false\"\r\n      [fitColumns]=\"true\"\r\n      [clickToEdit]=\"true\"\r\n      [beforeEdit]=\"beforeEdit\"\r\n      [idField]=\"'id'\"\r\n    >\r\n    </farris-datagrid>\r\n  </div>\r\n  <div\r\n    class=\"task-comment-add task-comment-add-common\"\r\n    (click)=\"addCommonComment()\"\r\n  >\r\n    <span class=\"f-icon f-icon-plus mr-1\"></span>\r\n    <span>{{ \"comment.static.clickToAdd\" | translate }}</span>\r\n  </div>\r\n</div>\r\n\r\n<!-- \u5E38\u7528\u610F\u89C1\u7C7B\u522B -->\r\n<ng-template #commentTypeCell let-ctx>\r\n  <div>\r\n    <span\r\n      *ngIf=\"ctx.rowData.userId === '*'\"\r\n      class=\"task-comment-type task-comment-type-blue\"\r\n      >{{ \"comment.static.public\" | translate }}</span\r\n    >\r\n    <span\r\n      *ngIf=\"ctx.rowData.userId !== '*'\"\r\n      class=\"task-comment-type task-comment-type-yellow\"\r\n      >{{ \"comment.static.private\" | translate }}</span\r\n    >\r\n  </div>\r\n</ng-template>\r\n\r\n<!-- \u5E38\u7528\u610F\u89C1\u64CD\u4F5C -->\r\n<ng-template #commentOperateCell let-ctx>\r\n  <div\r\n    *ngIf=\"ctx.rowData.userId !== '*'\"\r\n    class=\"btn-link\"\r\n    style=\"padding: 5px 0\"\r\n    (click)=\"deleteComment(ctx)\"\r\n  >\r\n    {{ \"comment.static.delete\" | translate }}\r\n  </div>\r\n</ng-template>\r\n\r\n<!-- \u5E38\u7528\u610F\u89C1\u7EF4\u62A4\u6309\u94AE -->\r\n<ng-template #formButtonRef>\r\n  <button class=\"btn btn-secondary mr-2\" (click)=\"clickCancel()\">\r\n    {{ \"comment.static.cancel\" | translate }}\r\n  </button>\r\n  <button class=\"btn btn-primary\" (click)=\"saveCommonComment()\">\r\n    {{ \"comment.static.confirm\" | translate }}\r\n  </button>\r\n</ng-template>\r\n",
                styles: [".task-comment-div{display:flex;flex-direction:column;height:100%}.task-comment-datagrid-div{display:flex;flex-grow:0;overflow:hidden;padding:0 24px;height:100%}.task-comment-type{padding:2px 6px;border-radius:4px;font-size:12px}.task-comment-type-blue{background:#eef5ff;border:0 solid #aed1ff;color:#5ea4ff}.task-comment-type-yellow{background:#fef5ec;border:0 solid #fad0a1;color:#f5a144}.task-comment-add{display:flex;justify-content:center;align-items:center;margin:0 24px;cursor:pointer;overflow:hidden;font-size:12px;text-align:center;padding:6px;border-radius:4px}.task-comment-add-common{color:#a8adb8;background:#f4f6fc;border:1px dashed #d2d7e2}.task-comment-add:hover{background:rgba(238,245,255,.8);border:1px solid rgba(82,157,255,.4)}"]
            }] }
];
/** @nocollapse */
CommentManageComponent.ctorParameters = () => [
    { type: I18nService },
    { type: TaskService },
    { type: NotifyService },
    { type: LoadingService }
];
CommentManageComponent.propDecorators = {
    filter: [{ type: Input }],
    dataGrid: [{ type: ViewChild, args: ['dataGrid',] }],
    commentTypeCell: [{ type: ViewChild, args: ['commentTypeCell',] }],
    commentOperateCell: [{ type: ViewChild, args: ['commentOperateCell',] }],
    buttons: [{ type: ViewChild, args: ['formButtonRef',] }]
};
if (false) {
    /** @type {?} */
    CommentManageComponent.prototype.commentList;
    /** @type {?} */
    CommentManageComponent.prototype.originCommentList;
    /** @type {?} */
    CommentManageComponent.prototype.commentColumns;
    /** @type {?} */
    CommentManageComponent.prototype.confirmSubject;
    /** @type {?} */
    CommentManageComponent.prototype.cancelSubject;
    /** @type {?} */
    CommentManageComponent.prototype.filter;
    /** @type {?} */
    CommentManageComponent.prototype.dataGrid;
    /** @type {?} */
    CommentManageComponent.prototype.commentTypeCell;
    /** @type {?} */
    CommentManageComponent.prototype.commentOperateCell;
    /** @type {?} */
    CommentManageComponent.prototype.buttons;
    /**
     * 系统预置的不允许编辑删除
     * \@param data data.rowData为实体数据
     * \@return
     * @type {?}
     */
    CommentManageComponent.prototype.beforeEdit;
    /**
     * @type {?}
     * @private
     */
    CommentManageComponent.prototype.i18nService;
    /**
     * @type {?}
     * @private
     */
    CommentManageComponent.prototype.taskService;
    /**
     * @type {?}
     * @private
     */
    CommentManageComponent.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    CommentManageComponent.prototype.loadingService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWVudC1tYW5hZ2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC13Zi93Zi10YXNrLWhhbmRsZXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9jb21tZW50LW1hbmFnZS9jb21tZW50LW1hbmFnZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakYsT0FBTyxFQUFjLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDcEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUF3QixFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN2RSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDOUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBT3pELE1BQU0sT0FBTyxzQkFBc0I7Ozs7Ozs7O0lBZWpDLFlBQ1UsV0FBd0IsRUFDeEIsV0FBd0IsRUFDeEIsTUFBcUIsRUFDckIsY0FBOEI7UUFIOUIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFqQnhDLGdCQUFXLEdBQW9CLEVBQUUsQ0FBQztRQUNsQyxzQkFBaUIsR0FB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QUMsY0FBYyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzVDLENBQUM7Ozs7SUFFRCxnQkFBZ0I7UUFDZCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDM0MsQ0FBQzs7O1lBNUlGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsb0JBQW9CO2dCQUM5QixpOURBQThDOzthQUUvQzs7OztZQVBRLFdBQVc7WUFDWCxXQUFXO1lBTFgsYUFBYTtZQURiLGNBQWM7OztxQkFxQnBCLEtBQUs7dUJBRUwsU0FBUyxTQUFDLFVBQVU7OEJBQ3BCLFNBQVMsU0FBQyxpQkFBaUI7aUNBQzNCLFNBQVMsU0FBQyxvQkFBb0I7c0JBQzlCLFNBQVMsU0FBQyxlQUFlOzs7O0lBWDFCLDZDQUFrQzs7SUFDbEMsbURBQXdDOztJQUN4QyxnREFBa0M7O0lBQ2xDLGdEQUErQjs7SUFDL0IsK0NBQThCOztJQUU5Qix3Q0FBcUM7O0lBRXJDLDBDQUFtRDs7SUFDbkQsaURBQWdFOztJQUNoRSxvREFBc0U7O0lBQ3RFLHlDQUFzRDs7Ozs7OztJQTZHdEQsNENBS0M7Ozs7O0lBL0dDLDZDQUFnQzs7Ozs7SUFDaEMsNkNBQWdDOzs7OztJQUNoQyx3Q0FBNkI7Ozs7O0lBQzdCLGdEQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEYXRhQ29sdW1uLCBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBFZGl0b3JUeXBlcyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCB7IExvYWRpbmdTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1sb2FkaW5nJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgZm9ya0pvaW4sIE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENvbW1vbkNvbW1lbnQgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29tbWVudCc7XHJcbmltcG9ydCB7IENvbW1vbkNvbW1lbnRGaWx0ZXIgfSBmcm9tICcuLi8uLi9lbnRpdHkvY29tbW9uQ29tbWVudEZpbHRlcic7XHJcbmltcG9ydCB7IEkxOG5TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9pMThuL2kxOG4uc2VydmljZSc7XHJcbmltcG9ydCB7IFRhc2tTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS90YXNrLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItY29tbWVudC1tYW5hZ2UnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jb21tZW50LW1hbmFnZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vY29tbWVudC1tYW5hZ2UuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29tbWVudE1hbmFnZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIGNvbW1lbnRMaXN0OiBDb21tb25Db21tZW50W10gPSBbXTtcclxuICBvcmlnaW5Db21tZW50TGlzdDogQ29tbW9uQ29tbWVudFtdID0gW107XHJcbiAgY29tbWVudENvbHVtbnM6IERhdGFDb2x1bW5bXSA9IFtdO1xyXG4gIGNvbmZpcm1TdWJqZWN0ID0gbmV3IFN1YmplY3QoKTsvL+eCueWHu+ehruWumlxyXG4gIGNhbmNlbFN1YmplY3QgPSBuZXcgU3ViamVjdCgpOy8v54K55Ye75Y+W5raIXHJcblxyXG4gIEBJbnB1dCgpIGZpbHRlcjogQ29tbW9uQ29tbWVudEZpbHRlcjsvL+aEj+ingeexu+Wei1xyXG5cclxuICBAVmlld0NoaWxkKCdkYXRhR3JpZCcpIGRhdGFHcmlkOiBEYXRhZ3JpZENvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKCdjb21tZW50VHlwZUNlbGwnKSBjb21tZW50VHlwZUNlbGw6IFRlbXBsYXRlUmVmPGFueT47Ly/luLjnlKjmhI/op4HnsbvliKvmqKHmnb9cclxuICBAVmlld0NoaWxkKCdjb21tZW50T3BlcmF0ZUNlbGwnKSBjb21tZW50T3BlcmF0ZUNlbGw6IFRlbXBsYXRlUmVmPGFueT47Ly/luLjnlKjmhI/op4HliKDpmaRcclxuICBAVmlld0NoaWxkKCdmb3JtQnV0dG9uUmVmJykgYnV0dG9uczogVGVtcGxhdGVSZWY8YW55PjsvL+WPlua2iOehruiupOaMiemSrlxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaTE4blNlcnZpY2U6IEkxOG5TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSB0YXNrU2VydmljZTogVGFza1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5vdGlmeTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgbG9hZGluZ1NlcnZpY2U6IExvYWRpbmdTZXJ2aWNlLFxyXG4gICkge1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNvbW1lbnRDb2x1bW5zID0gW3tcclxuICAgICAgZmllbGQ6ICdtZXNzYWdlJyxcclxuICAgICAgd2lkdGg6IDEwMCxcclxuICAgICAgdGl0bGU6IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2NvbW1lbnQuc3RhdGljLmNvbnRlbnQnKSxcclxuICAgICAgZWRpdG9yOiB7IHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1gsIG9wdGlvbnM6IHt9IH0sXHJcbiAgICB9LCB7XHJcbiAgICAgIGZpZWxkOiAndXNlcklkJyxcclxuICAgICAgd2lkdGg6IDIwLFxyXG4gICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnY29tbWVudC5zdGF0aWMudHlwZScpLFxyXG4gICAgICB0ZW1wbGF0ZTogdGhpcy5jb21tZW50VHlwZUNlbGxcclxuICAgIH0sIHtcclxuICAgICAgZmllbGQ6ICdvcGVyYXRlJyxcclxuICAgICAgd2lkdGg6IDIwLFxyXG4gICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnY29tbWVudC5zdGF0aWMub3BlcmF0ZScpLFxyXG4gICAgICB0ZW1wbGF0ZTogdGhpcy5jb21tZW50T3BlcmF0ZUNlbGxcclxuICAgIH1dO1xyXG4gICAgLy/liqDovb3mhI/op4HliJfooahcclxuICAgIHRoaXMubG9hZENvbW1lbnRzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICog54K55Ye75bi455So5oSP6KeB77yM6I635Y+W55So5oi35bi455So5oSP6KeB5YiX6KGoXHJcbiAqL1xyXG4gIGxvYWRDb21tZW50cygpIHtcclxuICAgIGNvbnN0IGxvYWQgPSB0aGlzLmxvYWRpbmdTZXJ2aWNlLnNob3coKTtcclxuICAgIHRoaXMudGFza1NlcnZpY2UuZ2V0Q29tbWVudExpc3QodGhpcy5maWx0ZXIpLnN1YnNjcmliZSgoZGF0YTogYW55W10pID0+IHtcclxuICAgICAgbG9hZC5jbG9zZSgpO1xyXG4gICAgICB0aGlzLmNvbW1lbnRMaXN0ID0gZGF0YTtcclxuICAgICAgdGhpcy5vcmlnaW5Db21tZW50TGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgfSwgKCkgPT4ge1xyXG4gICAgICBsb2FkLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaWsOWinuS4gOadoeW4uOeUqOaEj+ingVxyXG4gICAqL1xyXG4gIGFkZENvbW1vbkNvbW1lbnQoKSB7XHJcbiAgICBjb25zdCBuZXdFbnRpdHkgPSBDb21tb25Db21tZW50Lm5ld0VudGl0eSgpO1xyXG4gICAgbmV3RW50aXR5LnNvcnRPcmRlciA9IHRoaXMuY29tbWVudExpc3QubGVuZ3RoICsgMTtcclxuICAgIGlmICh0aGlzLmZpbHRlciAmJiB0aGlzLmZpbHRlci50eXBlKSB7XHJcbiAgICAgIG5ld0VudGl0eS50eXBlID0gdGhpcy5maWx0ZXIudHlwZTtcclxuICAgIH1cclxuICAgIHRoaXMuY29tbWVudExpc3QgPSB0aGlzLmNvbW1lbnRMaXN0LmNvbmNhdChuZXdFbnRpdHkpO1xyXG4gICAgLy/mlrDlop7lkI7nm7TmjqXnvJbovpHljZXlhYPmoLxcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLmRhdGFHcmlkLmVkaXRDZWxsKG5ld0VudGl0eS5pZCwgJ21lc3NhZ2UnKTtcclxuICAgIH0sIDEwMCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTkuIDmnaHmhI/op4EgZGF0YS5yb3dEYXRhXHJcbiAgICovXHJcbiAgZGVsZXRlQ29tbWVudChkYXRhOiBhbnkpIHtcclxuICAgIGlmIChkYXRhLnJvd0RhdGEudXNlcklkICE9PSAnKicpIHtcclxuICAgICAgdGhpcy5jb21tZW50TGlzdCA9IHRoaXMuY29tbWVudExpc3QuZmlsdGVyKGMgPT4gYy5pZCAhPSBkYXRhLnJvd0RhdGEuaWQpO1xyXG4gICAgICB0aGlzLm9yaWdpbkNvbW1lbnRMaXN0ID0gdGhpcy5vcmlnaW5Db21tZW50TGlzdC5maWx0ZXIoYyA9PiBjLmlkICE9IGRhdGEucm93RGF0YS5pZCk7XHJcbiAgICAgIHRoaXMuZGF0YUdyaWQubG9hZERhdGEodGhpcy5jb21tZW50TGlzdCk7XHJcbiAgICAgIHRoaXMudGFza1NlcnZpY2UuZGVsZXRlQ29tbWVudChkYXRhLnJvd0RhdGEuaWQpLnN1YnNjcmliZSgoKSA9PiB7IH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bi455So5oSP6KeB54K55Ye75L+d5a2YXHJcbiAgICovXHJcbiAgc2F2ZUNvbW1vbkNvbW1lbnQoKSB7XHJcbiAgICB0aGlzLmRhdGFHcmlkLmVuZENlbGxFZGl0KCk7XHJcbiAgICB0aGlzLmNvbW1lbnRMaXN0ID0gdGhpcy5jb21tZW50TGlzdC5maWx0ZXIoYyA9PiBjLm1lc3NhZ2UpO1xyXG4gICAgdGhpcy5jb21tZW50TGlzdC5mb3JFYWNoKGNvbW1lbnQgPT4ge1xyXG4gICAgICBpZiAodGhpcy50YXNrU2VydmljZS5nZXRCeXRlc0xlbmd0aChjb21tZW50Lm1lc3NhZ2UpID4gMjU1KSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdjdWVXb3Jkcy5jb21tb25Db21tZW50VG9vTG9uZycpKTtcclxuICAgICAgICB0aGlzLmRhdGFHcmlkLmVkaXRDZWxsKGNvbW1lbnQuaWQsICdtZXNzYWdlJyk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgdGhpcy5jb21tZW50TGlzdC5mb3JFYWNoKGNvbW1lbnQgPT4ge1xyXG4gICAgICBsZXQgb3JpZ2luID0gdGhpcy5vcmlnaW5Db21tZW50TGlzdC5maW5kKGMgPT4gYy5pZCA9PSBjb21tZW50LmlkKTtcclxuICAgICAgaWYgKCFvcmlnaW4gfHwgY29tbWVudC5tZXNzYWdlICE9PSBvcmlnaW4ubWVzc2FnZSB8fCBjb21tZW50LnNvcnRPcmRlciAhPSBvcmlnaW4uc29ydE9yZGVyKSB7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5hZGRDb21tZW50KGNvbW1lbnQpLnN1YnNjcmliZSgoKSA9PiB7IH0pO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgLy/mraTlpITlt7Lov5Tlm57nu5lmYXJyaXNcclxuICAgIHRoaXMuY29uZmlybVN1YmplY3QubmV4dCh7IGFjdGlvbjogJ3N1Ym1pdCcsIGRhdGE6IHRoaXMuY29tbWVudExpc3QgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDngrnlh7vlj5bmtojvvIjmraTlpITlt7Lov5Tlm57nu5lmYXJyaXPvvIlcclxuICAgKi9cclxuICBjbGlja0NhbmNlbCgpIHtcclxuICAgIHRoaXMuY29tbWVudExpc3QgPSB0aGlzLmNvbW1lbnRMaXN0LmZpbHRlcihjID0+IGMubWVzc2FnZSk7XHJcbiAgICB0aGlzLmNhbmNlbFN1YmplY3QubmV4dCh7IGFjdGlvbjogJ2NhbmNlbCcsIGRhdGE6IHRoaXMub3JpZ2luQ29tbWVudExpc3QgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDns7vnu5/pooTnva7nmoTkuI3lhYHorrjnvJbovpHliKDpmaRcclxuICAgKiBAcGFyYW0gZGF0YSBkYXRhLnJvd0RhdGHkuLrlrp7kvZPmlbDmja5cclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIGJlZm9yZUVkaXQgPSAoZGF0YTogYW55KSA9PiB7XHJcbiAgICBpZiAoZGF0YS5yb3dEYXRhLnVzZXJJZCA9PSAnKicpIHtcclxuICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBvZih0cnVlKTtcclxuICB9XHJcblxyXG4gIGdldENvbmZpcm1TVWJqZWN0KCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb25maXJtU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIGdldENhbmNlbFN1YmplY3QoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmNhbmNlbFN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
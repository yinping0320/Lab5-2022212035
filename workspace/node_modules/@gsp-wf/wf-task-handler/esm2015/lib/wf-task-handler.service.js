/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { WfApprovalLogsService } from '@gsp-wf/wf-approval-logs';
import { ForecastProcessPayload, WFFlowchartService } from '@gsp-wf/ui-flowchart';
import { BsModalService } from '@farris/ui-modal';
import { Subject, of } from 'rxjs';
import { TaskService } from './service/task.service';
import { TaskAction } from './entity/task-action';
import { NotifyService } from '@farris/ui-notify';
import { I18nService } from './service/i18n/i18n.service';
import { FrameworkService } from '@gsp-sys/rtf-common';
import { TaskEntity } from './entity/task-entity';
import { TaskExecuteComponent } from './components/task-execute/task-execute.component';
import { switchMap } from 'rxjs/operators';
import { StartProcessPayload, CancelSubmitPayload } from './entity/start-process-payload';
import { ProcessSelectorComponent } from './submit/process-selector/process-selector.component';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { ConfigCode, OwnerType } from './entity/task-center-config';
import { CommentManageComponent } from './components/comment-manage/comment-manage.component';
export class WfTaskHandlerService {
    /**
     * @param {?} logService
     * @param {?} flowchartService
     * @param {?} injector
     * @param {?} resolver
     * @param {?} modalService
     * @param {?} taskService
     * @param {?} notify
     * @param {?} i18nService
     * @param {?} frameworkService
     * @param {?} appRef
     */
    constructor(logService, flowchartService, injector, resolver, modalService, taskService, notify, i18nService, frameworkService, appRef) {
        this.logService = logService;
        this.flowchartService = flowchartService;
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
        this.taskService = taskService;
        this.notify = notify;
        this.i18nService = i18nService;
        this.frameworkService = frameworkService;
        this.appRef = appRef;
        this.subject = new Subject();
        this.curLanguage = localStorage.getItem('languageCode') || 'zh-CHS'; //系统当前语言
        //系统当前语言
        this.batchSubmitNum = {
            //批量提交数量
            successNum: 0,
            failedNum: 0,
            errorNum: 0,
        };
        this.batchCancelNum = {
            //批量取消提交数量
            successNum: 0,
            errorNum: 0
        };
        this.loading = this.injector.get(LoadingService);
        this.message = this.injector.get(MessagerService);
    }
    /**
     * 处理单条任务
     * @param {?} task
     * @param {?} action 任务动作
     * @param {?=} otherParams
     * @return {?}
     */
    execute(task, action, otherParams) {
        switch (action.code) {
            case 'ViewBizLog': //审批日志。如果是inSuite，根据流程实例打开
                this.logService.showByProcInstId(task.processInstanceId);
                break;
            case 'ViewFlowChart': //查看流程
                this.flowchartService.viewFlowchartByProcInstIdAndDataId(task.processInstanceId, task.refBizId);
                break;
            case 'ViewExecuteForm': // 联查单据
                this.openApp(task, action, otherParams);
                break;
            default: //办理类任务
                this.complete(task, action);
        }
        return this.subject.asObservable();
    }
    /**
     * @param {?} assigneeInfo
     * @param {?} openFromIframe
     * @return {?}
     */
    assignByInfo(assigneeInfo, openFromIframe) {
        /** @type {?} */
        const assignSubject = new Subject();
        return assignSubject.asObservable();
    }
    /**
     * @private
     * @param {?} task
     * @param {?} action
     * @return {?}
     */
    complete(task, action) {
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(TaskExecuteComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.setTask(task);
        compRef.instance.setAction(action);
        compRef.instance.addPadding();
        /** @type {?} */
        const modalConfig = {
            title: action.name ? action.name : this.i18nService.getValue('task.title'),
            width: 550,
            height: compRef.instance.dialogHeight,
            showButtons: true,
            buttons: compRef.instance.buttons
        };
        /** @type {?} */
        const dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.getSubject().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            re && re.result && this.subject.next(true);
            re && re.result && dialog.close();
        }));
    }
    /**
     * 打开审批联查界面
     * @param {?} entity 任务实体
     * @param {?} action 动作实体
     * @param {?=} otherParams
     * @return {?}
     */
    openApp(entity, action, otherParams) {
        /** @type {?} */
        const sourceId = entity.sourceId;
        /** @type {?} */
        const formInfoLoading = this.loading.show();
        this.taskService.getTaskFormInfo(sourceId).subscribe((/**
         * @param {?} formInfo
         * @return {?}
         */
        (formInfo) => {
            formInfoLoading.close();
            if (!formInfo) {
                this.notify.info(this.i18nService.getValue('task.notFoundBill'));
                return;
            }
            /** @type {?} */
            const options = {
                appType: 'menu',
                funcId: '',
                appId: '',
                appEntrance: '',
                tabId: sourceId,
                isNewTab: true
            };
            // 传工作流上下文参数
            /** @type {?} */
            const parameters = new Map();
            // 功能菜单情况
            if (formInfo.appId) {
                // 默认联查审批界面
                if (formInfo.formType === '1') { //表单嵌流程
                    parameters.set('workItemId', sourceId);
                    parameters.set('procInstId', action.parameters[0].value);
                    parameters.set('taskState', entity.state);
                    parameters.set('isAssign', entity.actions.some((/**
                     * @param {?} action
                     * @return {?}
                     */
                    action => action.code === 'AssignUser')));
                    formInfo.parameters.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    (item) => parameters.set(item.code, item.value)));
                    options.funcId = formInfo.appId;
                }
                else { //流程嵌表单
                    options.funcId = 'WF0120';
                    parameters.set('task', entity);
                    parameters.set('formInfo', formInfo);
                    otherParams && parameters.set('taskFilter', otherParams.taskFilter);
                }
            }
            else if (formInfo.url) { //表单格式
                options.funcId = 'WF0120';
                parameters.set('task', entity);
                parameters.set('formInfo', formInfo);
                otherParams && parameters.set('taskFilter', otherParams.taskFilter);
            }
            else {
                this.notify.info(this.i18nService.getValue('task.notFoundBill'));
                return;
            }
            options.entityParams = parameters;
            options.queryStringParams = parameters; //兼容IDP表单
            this.openMenu(options, this.i18nService.getValue('static.taskForm'));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            formInfoLoading.close();
            this.taskService.error(error);
        }));
    }
    /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @private
     * @param {?} options 打开参数
     * @param {?} menuTitle 菜单名称
     * @return {?}
     */
    openMenu(options, menuTitle) {
        if (this.taskService.isInSuite()) {
            options.menuTitle = menuTitle;
            /** @type {?} */
            var extObj = ((/** @type {?} */ (window))).gspframeworkService.rtf.extendMethod.getExtObj();
            extObj.iGIXMenuOpen(options);
        }
        else {
            /** @type {?} */
            const openMenuLoading = this.loading.show();
            this.frameworkService.openMenu$(options).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            re => {
                openMenuLoading.close();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                openMenuLoading.close();
                this.taskService.error(error);
            }));
        }
    }
    /**
     * 返回动作列表，表单嵌流程用到
     * @param {?} workItemId
     * @return {?}
     */
    refreshActions(workItemId) {
        return this.taskService.getWorkItemActions(workItemId).pipe(switchMap((/**
         * @param {?} actionList
         * @return {?}
         */
        (actionList) => {
            return of(actionList.filter((/**
             * @param {?} action
             * @return {?}
             */
            action => action.code !== 'ViewBizLog' &&
                action.code !== 'ViewFlowChart' &&
                action.code !== 'ViewExecuteForm')));
        })));
    }
    /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei\@2020.06.22）
     * @param {?} procInstId 流程实例ID
     * @param {?} state 任务状态
     * @param {?} actionCode 动作Code
     * @return {?}
     */
    executeByProcInstId(procInstId, state, actionCode) {
        /** @type {?} */
        var action = new TaskAction();
        action.code = actionCode;
        /** @type {?} */
        const subject = new Subject();
        this.taskService.getTaskByProcInstId(procInstId, state).subscribe((/**
         * @param {?} task
         * @return {?}
         */
        (task) => {
            if (task) {
                this.execute(task, action).subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                re => {
                    subject.next(re);
                }));
            }
            else {
                this.notify.info(this.i18nService.getValue('task.noTask'));
            }
        }));
        return subject.asObservable();
    }
    /**
     * 根据workItemId 办理任务
     * @param {?} workItemId 工作项ID
     * @param {?} action 动作实体
     * @return {?}
     */
    executeByWorkItemId(workItemId, action) {
        /** @type {?} */
        let task = new TaskEntity();
        task.sourceId = workItemId;
        return this.execute(task, action);
    }
    /**
     * 提交审批
     * @param {?} payload 上下文参数
     * @return {?} subject true：提交成功，false：提交失败
     */
    startProcess(payload) {
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const configLoad = this.loading.show();
        this.taskService.getTaskCenterConfigByCode(ConfigCode.If_Show_Submit_Dialog, OwnerType.BizDefKey, payload.bizDefKey).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            configLoad.close();
            if (re && re.currentValue === 'false') { //自定义无需弹框
                //自定义无需弹框
                /** @type {?} */
                const simulateLoad = this.loading.show();
                this.taskService.startProcessSimulate(payload).subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    simulateLoad.close();
                    if (!response || response.needInteraction === false) { //预解析无需交互
                        //预解析无需交互
                        /** @type {?} */
                        const executeLoad = this.loading.show();
                        this.taskService.startProcess(payload).subscribe((/**
                         * @param {?} response
                         * @return {?}
                         */
                        (response) => {
                            executeLoad.close();
                            if (payload.withResponse) {
                                subject.next(response);
                            }
                            else {
                                subject.next(true);
                            }
                            this.handleSubmitMessage(ConfigCode.Info_After_Submit, payload.bizDefKey);
                        }), (/**
                         * @param {?} error
                         * @return {?}
                         */
                        error => {
                            executeLoad.close();
                            if (payload.withResponse) {
                                subject.next(null);
                            }
                            else {
                                subject.next(false);
                            }
                            this.taskService.error(error);
                        }));
                    }
                    else { //预解析需要交互
                        this.showStartProcessDialog(payload).subscribe((/**
                         * @param {?} re
                         * @return {?}
                         */
                        re => {
                            subject.next(re);
                        }));
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    simulateLoad.close();
                    subject.next(null);
                    this.taskService.error(error);
                }));
            }
            else { //无是否弹框配置
                this.showStartProcessDialog(payload).subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                re => {
                    subject.next(re);
                }));
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            configLoad.close();
            this.taskService.error(error);
        }));
        return subject.asObservable();
    }
    /**
     * 提交审批弹框
     * @private
     * @param {?} payload 参数
     * @return {?}
     */
    showStartProcessDialog(payload) {
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(ProcessSelectorComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        compRef.instance.setParam(payload).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            /** @type {?} */
            const modalConfig = {
                title: this.i18nService.getValue('startProcess.title'),
                width: 520,
                height: re && re.dialogHeight,
                showButtons: true,
                buttons: compRef.instance.buttons,
                opened: (/**
                 * @return {?}
                 */
                () => {
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        compRef.changeDetectorRef && compRef.changeDetectorRef.detectChanges();
                    }), 100);
                })
            };
            /** @type {?} */
            const dialog = this.modalService.show(compRef, modalConfig);
            if (payload.withResponse === true) { //内部使用
                compRef.instance.getSubjectWithResponse().subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                re => {
                    subject.next(re);
                    dialog.close();
                }));
                compRef.instance.getSubjectCancel().subscribe((/**
                 * @return {?}
                 */
                () => {
                    dialog.close();
                }));
            }
            else { //已有业务组调用
                compRef.instance.getSubject().subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                re => {
                    subject.next(re);
                    dialog.close();
                }));
                compRef.instance.getSubjectCancel().subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                re => {
                    subject.next(re);
                    dialog.close();
                }));
            }
        }));
        return subject.asObservable();
    }
    /**
     * 取消提交
     * \@payload payload 参数
     * @param {?} payload
     * @return {?}
     */
    cancelSubmit(payload) {
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const load = this.loading.show();
        this.taskService.cancelSubmit(payload).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        (re) => {
            load.close();
            subject.next(true);
            if (re && re.needInteraction) {
                this.notify.info(this.i18nService.getValue('startProcess.cancelSubmitInfo'));
            }
            else {
                this.handleSubmitMessage(ConfigCode.Info_After_Cancel_Submit, payload.bizDefKey);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            load.close();
            subject.error(false);
            this.taskService.error(error);
        }));
        return subject.asObservable();
    }
    /**
     * 提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    submitWithBizDefKey(dataId, bizDefKey) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var payload = new StartProcessPayload();
        payload.dataId = dataId;
        payload.bizDefKey = bizDefKey;
        payload.withResponse = true;
        return this.startProcess(payload);
    }
    /**
     * 取消提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    cancelSubmitWithDataId(dataId, bizDefKey) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var cancelSubmitPayload = new CancelSubmitPayload();
        cancelSubmitPayload.dataId = dataId;
        cancelSubmitPayload.bizDefKey = bizDefKey;
        return this.cancelSubmit(cancelSubmitPayload);
    }
    /**
     * 批量提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    batchSubmitWithBizDefKey(dataIds, bizDefKey) {
        if (!dataIds || !dataIds.length) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        if (dataIds.length === 1) {
            /** @type {?} */
            var startPayload = new StartProcessPayload();
            startPayload.bizDefKey = bizDefKey;
            startPayload.dataId = dataIds[0];
            return this.startProcess(startPayload);
        }
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const load = this.loading.show();
        this.batchSubmitNum.successNum = 0;
        this.batchSubmitNum.failedNum = 0;
        this.batchSubmitNum.errorNum = 0;
        this.batchSubmitHelpFunction([...dataIds], bizDefKey, (/**
         * @return {?}
         */
        () => {
            load.close();
            subject.next(true);
        }));
        return subject.asObservable();
    }
    /**
     * 批量提交审批辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    batchSubmitHelpFunction(dataIds, bizDefKey, handler) {
        if (dataIds && dataIds.length > 0) {
            /** @type {?} */
            const dataId = dataIds.shift();
            //引用类型转换
            /** @type {?} */
            let startPayload = new StartProcessPayload();
            startPayload.bizDefKey = bizDefKey;
            startPayload.dataId = dataId;
            startPayload.variables = { simulate: true };
            this.taskService.startProcess(startPayload).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            (response) => {
                if (response.needInteraction) { //需要交互
                    this.batchSubmitNum.failedNum++;
                    this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                }
                else { //不需要交互
                    startPayload.variables = { simulate: false };
                    this.taskService.startProcess(startPayload).subscribe((/**
                     * @param {?} response
                     * @return {?}
                     */
                    (response) => {
                        this.batchSubmitNum.successNum++;
                        this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                    }), (/**
                     * @return {?}
                     */
                    () => {
                        this.batchSubmitNum.errorNum++;
                        this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                    }));
                }
            }), (/**
             * @return {?}
             */
            () => {
                this.batchSubmitNum.errorNum++;
                this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
            }));
        }
        else { //批量执行完毕
            this.showBatchSubmitInfo(this.batchSubmitNum, bizDefKey);
            handler(); //执行回调函数
        }
    }
    /**
     * 批量取消提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    batchCancelSubmitWithDataId(dataIds, bizDefKey) {
        if (!dataIds || !dataIds.length) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        if (dataIds.length === 1) {
            return this.cancelSubmitWithDataId(dataIds[0], bizDefKey);
        }
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const load = this.loading.show();
        this.batchCancelNum.successNum = 0;
        this.batchCancelNum.errorNum = 0;
        this.batchCancelHelpFunction([...dataIds], bizDefKey, (/**
         * @return {?}
         */
        () => {
            load.close();
            subject.next(true);
        }));
        return subject.asObservable();
    }
    /**
     * 批量取消辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    batchCancelHelpFunction(dataIds, bizDefKey, handler) {
        if (dataIds && dataIds.length) {
            /** @type {?} */
            const dataId = dataIds.shift();
            //引用类型转换
            /** @type {?} */
            let cancelPayload = new CancelSubmitPayload();
            cancelPayload.dataId = dataId;
            cancelPayload.bizDefKey = bizDefKey;
            this.taskService.cancelSubmit(cancelPayload).subscribe((/**
             * @return {?}
             */
            () => {
                this.batchCancelNum.successNum++;
                this.batchCancelHelpFunction(dataIds, bizDefKey, handler);
            }), (/**
             * @return {?}
             */
            () => {
                this.batchCancelNum.errorNum++;
                this.batchCancelHelpFunction(dataIds, bizDefKey, handler);
            }));
        }
        else {
            this.showBatchCancelSubmitInfo(this.batchCancelNum, bizDefKey);
            handler();
        }
    }
    /**
     * 子表提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    childSubmit(parentDataId, childDataId, bizDefKey) {
        if (!parentDataId || !childDataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var startProcessPayload = new StartProcessPayload();
        startProcessPayload.dataId = `${parentDataId},${childDataId}`;
        startProcessPayload.bizDefKey = bizDefKey;
        return this.startProcess(startProcessPayload);
    }
    /**
     * 子表取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    childCancelSubmit(parentDataId, childDataId, bizDefKey) {
        if (!parentDataId || !childDataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var cancelSubmitPayload = new CancelSubmitPayload();
        cancelSubmitPayload.dataId = `${parentDataId},${childDataId}`;
        cancelSubmitPayload.bizDefKey = bizDefKey;
        return this.cancelSubmit(cancelSubmitPayload);
    }
    /**
     * 子表批量提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    childBatchSubmit(parentDataId, childDataIds, bizDefKey) {
        if (!parentDataId || !childDataIds) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        const dataIds = childDataIds.map((/**
         * @param {?} childDataId
         * @return {?}
         */
        childDataId => `${parentDataId},${childDataId}`));
        return this.batchSubmitWithBizDefKey(dataIds, bizDefKey);
    }
    /**
     * 子表批量取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    childBatchCancelSubmit(parentDataId, childDataIds, bizDefKey) {
        if (!parentDataId || !childDataIds) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        const dataIds = childDataIds.map((/**
         * @param {?} childDataId
         * @return {?}
         */
        childDataId => `${parentDataId},${childDataId}`));
        return this.batchCancelSubmitWithDataId(dataIds, bizDefKey);
    }
    /**
     * 批量提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    showBatchSubmitInfo(num, bizDefKey) {
        if (num.successNum && !num.failedNum && !num.errorNum) { //批量全部成功
            this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Submit, OwnerType.BizDefKey, bizDefKey).subscribe((/**
             * @param {?} config
             * @return {?}
             */
            (config) => {
                if (this.curLanguage === 'en') {
                    this.notify.success(JSON.parse(config.currentValue).en);
                }
                if (this.curLanguage === 'zh-CHS') {
                    this.notify.success(JSON.parse(config.currentValue).zh_CHS);
                }
            }));
        }
        else { //非全部成功
            //非全部成功
            /** @type {?} */
            let message = '';
            num.successNum && (message += this.i18nService.getValue('batchStartProcess.success') + `【${num.successNum}】` + this.i18nService.getValue('batchStartProcess.row'));
            num.errorNum && (message += this.i18nService.getValue('batchStartProcess.error') + `【${num.errorNum}】` + this.i18nService.getValue('batchStartProcess.row'));
            num.failedNum && (message += this.i18nService.getValue('batchStartProcess.failed') + `【${num.failedNum}】` + this.i18nService.getValue('batchStartProcess.row'));
            message += this.i18nService.getValue('batchStartProcess.single');
            this.message.show('warning', message, { safeHtml: false });
        }
    }
    /**
     * 批量取消提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    showBatchCancelSubmitInfo(num, bizDefKey) {
        if (num.successNum && !num.errorNum) { //批量全部成功
            this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Cancel_Submit, OwnerType.BizDefKey, bizDefKey).subscribe((/**
             * @param {?} config
             * @return {?}
             */
            (config) => {
                if (this.curLanguage === 'en') {
                    this.notify.success(JSON.parse(config.currentValue).en);
                }
                if (this.curLanguage === 'zh-CHS') {
                    this.notify.success(JSON.parse(config.currentValue).zh_CHS);
                }
            }));
        }
        else {
            /** @type {?} */
            let message = '';
            num.successNum && (message += this.i18nService.getValue('startProcess.success') + `【${num.successNum}】` + this.i18nService.getValue('startProcess.row'));
            num.errorNum && (message += this.i18nService.getValue('startProcess.failed') + `【${num.errorNum}】` + this.i18nService.getValue('startProcess.row'));
            this.message.show('warning', message, { safeHtml: false });
        }
    }
    /**
     * @param {?} code
     * @param {?} ownerId
     * @return {?}
     */
    handleSubmitMessage(code, ownerId) {
        /** @type {?} */
        const load = this.loading.show();
        this.taskService.getTaskCenterConfigByCode(code, OwnerType.BizDefKey, ownerId).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            load.close();
            if (re && re.currentValue) {
                /** @type {?} */
                let message = '';
                /** @type {?} */
                const currentValue = JSON.parse(re.currentValue);
                this.curLanguage === 'zh-CHS' && (message = currentValue.zh_CHS);
                this.curLanguage === 'en' && (message = currentValue.en);
                this.curLanguage === 'zh-CHT' && (message = currentValue.zh_CHT);
                this.notify.success(message);
            }
            else {
                code === ConfigCode.Info_After_Submit && this.notify.success(this.i18nService.getValue('startProcess.submitSuccess'));
                code === ConfigCode.Info_After_Cancel_Submit && this.notify.success(this.i18nService.getValue('startProcess.cancelSubmitSuccess'));
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            load.close();
            this.taskService.error(error);
        }));
    }
    /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     * @return {?}
     */
    processSimulate() {
        /** @type {?} */
        const subject = new Subject();
        /** @type {?} */
        const gspWfEventService = ((/** @type {?} */ (window))).parent.gspWfEventService;
        gspWfEventService.simulate((/**
         * @return {?}
         */
        () => {
            subject.next(true);
        }));
        return subject.asObservable();
    }
    /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     * @param {?} dataId
     * @return {?}
     */
    viewFlowChartByDataId(dataId) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        this.flowchartService.viewFlowChartByDataId(dataId);
    }
    /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param {?} bizDefKey 流程分类id
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    viewFlowChartWithForecast(bizDefKey, dataId) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        let payload = new ForecastProcessPayload();
        payload.bizDefKey = bizDefKey;
        payload.dataId = dataId;
        this.flowchartService.viewProcess(payload);
    }
    /**
     * 查看审批记录（弹框）
     * 已封装为表单命令
     * @param {?} dataId 表单数据id
     * @param {?} style 其他参数
     * @return {?}
     */
    viewApprovalLog(dataId, style) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        /** @type {?} */
        const parameters = {
            dataId: dataId,
            style: style,
        };
        this.logService.showApprovalLog(parameters);
    }
    /**
     * 获取用户的常用意见（已暴露给farris）
     * @param {?} filter
     * @return {?} 用户常用意见list
     */
    getCommonComments(filter) {
        return this.taskService.getCommentList(filter);
    }
    /**
     * 展示常用意见管理dialog（已暴露给farris）
     * @param {?} filter
     * @return {?}
     */
    showCommentManageDialog(filter) {
        /** @type {?} */
        let subject = new Subject();
        /** @type {?} */
        const compFactory = this.resolver.resolveComponentFactory(CommentManageComponent);
        /** @type {?} */
        const compRef = compFactory.create(this.injector);
        /** @type {?} */
        const options = {
            title: this.i18nService.getValue('comment.static.title'),
            width: 740,
            height: 440,
            showButtons: true,
            buttons: compRef.instance.buttons
        };
        compRef.instance.filter = filter;
        /** @type {?} */
        const dialog = this.modalService.show(compRef, options);
        compRef.instance.getConfirmSUbject().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
            subject.next(re);
        }));
        compRef.instance.getCancelSubject().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        re => {
            dialog.close();
            subject.next(re);
        }));
        return subject.asObservable();
    }
}
WfTaskHandlerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
WfTaskHandlerService.ctorParameters = () => [
    { type: WfApprovalLogsService },
    { type: WFFlowchartService },
    { type: Injector },
    { type: ComponentFactoryResolver },
    { type: BsModalService },
    { type: TaskService },
    { type: NotifyService },
    { type: I18nService },
    { type: FrameworkService },
    { type: ApplicationRef }
];
if (false) {
    /** @type {?} */
    WfTaskHandlerService.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.message;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.curLanguage;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.batchSubmitNum;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.batchCancelNum;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.flowchartService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.taskService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.i18nService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.frameworkService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.appRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtdGFzay1oYW5kbGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXRhc2staGFuZGxlci8iLCJzb3VyY2VzIjpbImxpYi93Zi10YXNrLWhhbmRsZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9GLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDBCQUEwQixDQUFBO0FBQ2hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xGLE9BQU8sRUFBRSxjQUFjLEVBQWdCLE1BQU0sa0JBQWtCLENBQUM7QUFDaEUsT0FBTyxFQUFjLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVsRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxnQkFBZ0IsRUFBYyxNQUFNLHFCQUFxQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUN4RixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLG1CQUFtQixFQUFFLG1CQUFtQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDMUYsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFFaEcsT0FBTyxFQUFF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QyxFQUFFO1lBQ2pELE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbkIsQ0FBQyxFQUFDLENBQUM7UUFDSCxPQUFPLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNoQyxDQUFDOzs7WUF2dUJGLFVBQVU7Ozs7WUExQkYscUJBQXFCO1lBQ0csa0JBQWtCO1lBRjlCLFFBQVE7WUFBRSx3QkFBd0I7WUFHOUMsY0FBYztZQUVkLFdBQVc7WUFHWCxhQUFhO1lBQ2IsV0FBVztZQUNYLGdCQUFnQjtZQVZnQyxjQUFjOzs7O0lBOEJyRSx1Q0FBNkI7Ozs7O0lBQzdCLHVDQUFnQzs7Ozs7SUFDaEMsdUNBQWlDOzs7OztJQUNqQywyQ0FBK0U7Ozs7O0lBRS9FLDhDQUlFOzs7OztJQUNGLDhDQUdDOzs7OztJQUdDLDBDQUF5Qzs7Ozs7SUFDekMsZ0RBQTRDOzs7OztJQUM1Qyx3Q0FBMEI7Ozs7O0lBQzFCLHdDQUEwQzs7Ozs7SUFDMUMsNENBQW9DOzs7OztJQUNwQywyQ0FBZ0M7Ozs7O0lBQ2hDLHNDQUE2Qjs7Ozs7SUFDN0IsMkNBQWdDOzs7OztJQUNoQyxnREFBMEM7Ozs7O0lBQzFDLHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEFwcGxpY2F0aW9uUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFdmQXBwcm92YWxMb2dzU2VydmljZSB9IGZyb20gJ0Bnc3Atd2Yvd2YtYXBwcm92YWwtbG9ncydcclxuaW1wb3J0IHsgRm9yZWNhc3RQcm9jZXNzUGF5bG9hZCwgV0ZGbG93Y2hhcnRTZXJ2aWNlIH0gZnJvbSAnQGdzcC13Zi91aS1mbG93Y2hhcnQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFRhc2tTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlL3Rhc2suc2VydmljZSc7XHJcbmltcG9ydCB7IFRhc2tBY3Rpb24gfSBmcm9tICcuL2VudGl0eS90YXNrLWFjdGlvbic7XHJcbmltcG9ydCB7IEFzc2lnbmVlSW5mbyB9IGZyb20gJy4vZW50aXR5L2NvbXBsZXRlLXJlc3BvbnNlJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgSTE4blNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvaTE4bi9pMThuLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtTZXJ2aWNlLCBBcHBPcHRpb25zIH0gZnJvbSAnQGdzcC1zeXMvcnRmLWNvbW1vbic7XHJcbmltcG9ydCB7IEJpekZvcm1SZXN1bHQsIEZvcm1QYXJhbWV0ZXIgfSBmcm9tICcuL2VudGl0eS9iaXpmb3JtJztcclxuaW1wb3J0IHsgVGFza0VudGl0eSB9IGZyb20gJy4vZW50aXR5L3Rhc2stZW50aXR5JztcclxuaW1wb3J0IHsgVGFza0V4ZWN1dGVDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvdGFzay1leGVjdXRlL3Rhc2stZXhlY3V0ZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IFN0YXJ0UHJvY2Vzc1BheWxvYWQsIENhbmNlbFN1Ym1pdFBheWxvYWQgfSBmcm9tICcuL2VudGl0eS9zdGFydC1wcm9jZXNzLXBheWxvYWQnO1xyXG5pbXBvcnQgeyBQcm9jZXNzU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuL3N1Ym1pdC9wcm9jZXNzLXNlbGVjdG9yL3Byb2Nlc3Mtc2VsZWN0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRXhlY3V0aW9uUmVzcG9uc2UgfSBmcm9tICcuL2VudGl0eS9leGVjdXRpb24tcmVzcG9uc2UnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBCYXRjaENhbmNlbE51bWJlciwgQmF0Y2hTdWJtaXROdW1iZXIgfSBmcm9tICcuL2VudGl0eS9iYXRjaE51bWJlcic7XHJcbmltcG9ydCB7IFNpbXVsYXRlUmVzcG9uc2UgfSBmcm9tICcuL2VudGl0eS9zaW11bGF0ZS1yZXNwb25zZSc7XHJcbmltcG9ydCB7IENvbmZpZ0NvZGUsIE93bmVyVHlwZSB9IGZyb20gJy4vZW50aXR5L3Rhc2stY2VudGVyLWNvbmZpZyc7XHJcbmltcG9ydCB7IFRhc2tDb21tZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vcHVibGljLWFwaSc7XHJcbmltcG9ydCB7IENvbW1lbnRNYW5hZ2VDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvY29tbWVudC1tYW5hZ2UvY29tbWVudC1tYW5hZ2UuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29tbW9uQ29tbWVudEZpbHRlciB9IGZyb20gJy4vZW50aXR5L2NvbW1vbkNvbW1lbnRGaWx0ZXInO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgV2ZUYXNrSGFuZGxlclNlcnZpY2Uge1xyXG5cclxuICBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIHByaXZhdGUgbG9hZGluZzogTG9hZGluZ1NlcnZpY2U7XHJcbiAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBjdXJMYW5ndWFnZTogc3RyaW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIHx8ICd6aC1DSFMnOy8v57O757uf5b2T5YmN6K+t6KiAXHJcblxyXG4gIHByaXZhdGUgYmF0Y2hTdWJtaXROdW06IEJhdGNoU3VibWl0TnVtYmVyID0gey8v5om56YeP5o+Q5Lqk5pWw6YePXHJcbiAgICBzdWNjZXNzTnVtOiAwLFxyXG4gICAgZmFpbGVkTnVtOiAwLFxyXG4gICAgZXJyb3JOdW06IDAsXHJcbiAgfTtcclxuICBwcml2YXRlIGJhdGNoQ2FuY2VsTnVtOiBCYXRjaENhbmNlbE51bWJlciA9IHsvL+aJuemHj+WPlua2iOaPkOS6pOaVsOmHj1xyXG4gICAgc3VjY2Vzc051bTogMCxcclxuICAgIGVycm9yTnVtOiAwXHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbG9nU2VydmljZTogV2ZBcHByb3ZhbExvZ3NTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmbG93Y2hhcnRTZXJ2aWNlOiBXRkZsb3djaGFydFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgdGFza1NlcnZpY2U6IFRhc2tTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGkxOG5TZXJ2aWNlOiBJMThuU2VydmljZSxcclxuICAgIHByaXZhdGUgZnJhbWV3b3JrU2VydmljZTogRnJhbWV3b3JrU2VydmljZSxcclxuICAgIHByaXZhdGUgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcclxuICApIHtcclxuICAgIHRoaXMubG9hZGluZyA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvYWRpbmdTZXJ2aWNlKTtcclxuICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1lc3NhZ2VyU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbljZXmnaHku7vliqFcclxuICAgKiBAcGFyYW0gZW50aXR5IOS7u+WKoeWunuS9k1xyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Lu75Yqh5Yqo5L2cXHJcbiAgICovXHJcbiAgZXhlY3V0ZSh0YXNrOiBUYXNrRW50aXR5LCBhY3Rpb246IFRhc2tBY3Rpb24sIG90aGVyUGFyYW1zPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHN3aXRjaCAoYWN0aW9uLmNvZGUpIHtcclxuICAgICAgY2FzZSAnVmlld0JpekxvZyc6Ly/lrqHmibnml6Xlv5fjgILlpoLmnpzmmK9pblN1aXRl77yM5qC55o2u5rWB56iL5a6e5L6L5omT5byAXHJcbiAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLnNob3dCeVByb2NJbnN0SWQodGFzay5wcm9jZXNzSW5zdGFuY2VJZCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1ZpZXdGbG93Q2hhcnQnOi8v5p+l55yL5rWB56iLXHJcbiAgICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlLnZpZXdGbG93Y2hhcnRCeVByb2NJbnN0SWRBbmREYXRhSWQodGFzay5wcm9jZXNzSW5zdGFuY2VJZCwgdGFzay5yZWZCaXpJZCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1ZpZXdFeGVjdXRlRm9ybSc6Ly8g6IGU5p+l5Y2V5o2uXHJcbiAgICAgICAgdGhpcy5vcGVuQXBwKHRhc2ssIGFjdGlvbiwgb3RoZXJQYXJhbXMpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OiAvL+WKnueQhuexu+S7u+WKoVxyXG4gICAgICAgIHRoaXMuY29tcGxldGUodGFzaywgYWN0aW9uKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICBhc3NpZ25CeUluZm8oYXNzaWduZWVJbmZvOiBBc3NpZ25lZUluZm8sIG9wZW5Gcm9tSWZyYW1lOiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGFzc2lnblN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICByZXR1cm4gYXNzaWduU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY29tcGxldGUodGFzazogVGFza0VudGl0eSwgYWN0aW9uOiBUYXNrQWN0aW9uKSB7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVGFza0V4ZWN1dGVDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2V0VGFzayh0YXNrKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2V0QWN0aW9uKGFjdGlvbik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmFkZFBhZGRpbmcoKTtcclxuICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgIHRpdGxlOiBhY3Rpb24ubmFtZSA/IGFjdGlvbi5uYW1lIDogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgndGFzay50aXRsZScpLFxyXG4gICAgICB3aWR0aDogNTUwLFxyXG4gICAgICBoZWlnaHQ6IGNvbXBSZWYuaW5zdGFuY2UuZGlhbG9nSGVpZ2h0LFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5idXR0b25zXHJcbiAgICB9O1xyXG4gICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICByZSAmJiByZS5yZXN1bHQgJiYgdGhpcy5zdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgICAgIHJlICYmIHJlLnJlc3VsdCAmJiBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDlrqHmibnogZTmn6XnlYzpnaJcclxuICAgKiBAcGFyYW0gZW50aXR5IOS7u+WKoeWunuS9k1xyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Yqo5L2c5a6e5L2TXHJcbiAgICovXHJcbiAgb3BlbkFwcChlbnRpdHk6IFRhc2tFbnRpdHksIGFjdGlvbjogVGFza0FjdGlvbiwgb3RoZXJQYXJhbXM/OiBhbnkpIHtcclxuICAgIGNvbnN0IHNvdXJjZUlkID0gZW50aXR5LnNvdXJjZUlkO1xyXG4gICAgY29uc3QgZm9ybUluZm9Mb2FkaW5nID0gdGhpcy5sb2FkaW5nLnNob3coKTtcclxuICAgIHRoaXMudGFza1NlcnZpY2UuZ2V0VGFza0Zvcm1JbmZvKHNvdXJjZUlkKS5zdWJzY3JpYmUoKGZvcm1JbmZvOiBCaXpGb3JtUmVzdWx0KSA9PiB7XHJcbiAgICAgIGZvcm1JbmZvTG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICBpZiAoIWZvcm1JbmZvKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCd0YXNrLm5vdEZvdW5kQmlsbCcpKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICBhcHBUeXBlOiAnbWVudScsXHJcbiAgICAgICAgZnVuY0lkOiAnJyxcclxuICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgYXBwRW50cmFuY2U6ICcnLFxyXG4gICAgICAgIHRhYklkOiBzb3VyY2VJZCxcclxuICAgICAgICBpc05ld1RhYjogdHJ1ZVxyXG4gICAgICB9O1xyXG4gICAgICAvLyDkvKDlt6XkvZzmtYHkuIrkuIvmloflj4LmlbBcclxuICAgICAgY29uc3QgcGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICAgIC8vIOWKn+iDveiPnOWNleaDheWGtVxyXG4gICAgICBpZiAoZm9ybUluZm8uYXBwSWQpIHtcclxuICAgICAgICAvLyDpu5jorqTogZTmn6XlrqHmibnnlYzpnaJcclxuICAgICAgICBpZiAoZm9ybUluZm8uZm9ybVR5cGUgPT09ICcxJykgey8v6KGo5Y2V5bWM5rWB56iLXHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnd29ya0l0ZW1JZCcsIHNvdXJjZUlkKTtcclxuICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KCdwcm9jSW5zdElkJywgYWN0aW9uLnBhcmFtZXRlcnNbMF0udmFsdWUpO1xyXG4gICAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3Rhc2tTdGF0ZScsIGVudGl0eS5zdGF0ZSk7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnaXNBc3NpZ24nLCBlbnRpdHkuYWN0aW9ucy5zb21lKGFjdGlvbiA9PiBhY3Rpb24uY29kZSA9PT0gJ0Fzc2lnblVzZXInKSk7XHJcbiAgICAgICAgICBmb3JtSW5mby5wYXJhbWV0ZXJzLmZvckVhY2goKGl0ZW06IEZvcm1QYXJhbWV0ZXIpID0+XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KGl0ZW0uY29kZSwgaXRlbS52YWx1ZSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBvcHRpb25zLmZ1bmNJZCA9IGZvcm1JbmZvLmFwcElkO1xyXG4gICAgICAgIH0gZWxzZSB7Ly/mtYHnqIvltYzooajljZVcclxuICAgICAgICAgIG9wdGlvbnMuZnVuY0lkID0gJ1dGMDEyMCc7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgndGFzaycsIGVudGl0eSk7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnZm9ybUluZm8nLCBmb3JtSW5mbyk7XHJcbiAgICAgICAgICBvdGhlclBhcmFtcyAmJiBwYXJhbWV0ZXJzLnNldCgndGFza0ZpbHRlcicsIG90aGVyUGFyYW1zLnRhc2tGaWx0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChmb3JtSW5mby51cmwpIHsvL+ihqOWNleagvOW8j1xyXG4gICAgICAgIG9wdGlvbnMuZnVuY0lkID0gJ1dGMDEyMCc7XHJcbiAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3Rhc2snLCBlbnRpdHkpO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCdmb3JtSW5mbycsIGZvcm1JbmZvKTtcclxuICAgICAgICBvdGhlclBhcmFtcyAmJiBwYXJhbWV0ZXJzLnNldCgndGFza0ZpbHRlcicsIG90aGVyUGFyYW1zLnRhc2tGaWx0ZXIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgndGFzay5ub3RGb3VuZEJpbGwnKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIG9wdGlvbnMuZW50aXR5UGFyYW1zID0gcGFyYW1ldGVycztcclxuICAgICAgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyA9IHBhcmFtZXRlcnM7Ly/lhbzlrrlJRFDooajljZVcclxuICAgICAgdGhpcy5vcGVuTWVudShvcHRpb25zLCB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMudGFza0Zvcm0nKSk7XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIGZvcm1JbmZvTG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmVycm9yKGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5byA6I+c5Y2V77yM5Yy65YiG5piv5ZCmaW5TdWl0ZeeOr+Wig++8jOeUqOS4jeWQjOaWueW8j+aJk+W8gOiPnOWNlVxyXG4gICAqIEBwYXJhbSBvcHRpb25zIOaJk+W8gOWPguaVsFxyXG4gICAqIEBwYXJhbSBtZW51VGl0bGUg6I+c5Y2V5ZCN56ewXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvcGVuTWVudShvcHRpb25zOiBhbnksIG1lbnVUaXRsZTogc3RyaW5nKSB7XHJcbiAgICBpZiAodGhpcy50YXNrU2VydmljZS5pc0luU3VpdGUoKSkge1xyXG4gICAgICBvcHRpb25zLm1lbnVUaXRsZSA9IG1lbnVUaXRsZTtcclxuICAgICAgdmFyIGV4dE9iaiA9ICh3aW5kb3cgYXMgYW55KS5nc3BmcmFtZXdvcmtTZXJ2aWNlLnJ0Zi5leHRlbmRNZXRob2QuZ2V0RXh0T2JqKCk7XHJcbiAgICAgIGV4dE9iai5pR0lYTWVudU9wZW4ob3B0aW9ucyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBvcGVuTWVudUxvYWRpbmcgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgICB0aGlzLmZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUkKG9wdGlvbnMpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgb3Blbk1lbnVMb2FkaW5nLmNsb3NlKCk7XHJcblxyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgb3Blbk1lbnVMb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDov5Tlm57liqjkvZzliJfooajvvIzooajljZXltYzmtYHnqIvnlKjliLBcclxuICAgKiBAcGFyYW0gd29ya0l0ZW1JZCBcclxuICAgKi9cclxuICByZWZyZXNoQWN0aW9ucyh3b3JrSXRlbUlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMudGFza1NlcnZpY2UuZ2V0V29ya0l0ZW1BY3Rpb25zKHdvcmtJdGVtSWQpLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoYWN0aW9uTGlzdDogYW55W10pID0+IHtcclxuICAgICAgICByZXR1cm4gb2YoYWN0aW9uTGlzdC5maWx0ZXIoYWN0aW9uID0+XHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdCaXpMb2cnICYmXHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdGbG93Q2hhcnQnICYmXHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdFeGVjdXRlRm9ybSdcclxuICAgICAgICApKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7mtYHnqIvlrp7kvotJROWSjOWKqOS9nENvZGXlip7nkIbku7vliqHvvIjmmoLmnKrnlKjliLAgYnkgZmFuZ3BlbmdmZWlAMjAyMC4wNi4yMu+8iVxyXG4gICAqIEBwYXJhbSBwcm9jSW5zdElkIOa1geeoi+WunuS+i0lEXHJcbiAgICogQHBhcmFtIHN0YXRlIOS7u+WKoeeKtuaAgVxyXG4gICAqIEBwYXJhbSBhY3Rpb25Db2RlIOWKqOS9nENvZGVcclxuICAgKi9cclxuICBleGVjdXRlQnlQcm9jSW5zdElkKHByb2NJbnN0SWQ6IHN0cmluZywgc3RhdGU6IG51bWJlciwgYWN0aW9uQ29kZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHZhciBhY3Rpb24gPSBuZXcgVGFza0FjdGlvbigpO1xyXG4gICAgYWN0aW9uLmNvZGUgPSBhY3Rpb25Db2RlO1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tCeVByb2NJbnN0SWQocHJvY0luc3RJZCwgc3RhdGUpLnN1YnNjcmliZSgodGFzazogVGFza0VudGl0eSkgPT4ge1xyXG4gICAgICBpZiAodGFzaykge1xyXG4gICAgICAgIHRoaXMuZXhlY3V0ZSh0YXNrLCBhY3Rpb24pLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCd0YXNrLm5vVGFzaycpKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2ud29ya0l0ZW1JZCDlip7nkIbku7vliqFcclxuICAgKiBAcGFyYW0gd29ya0l0ZW1JZCDlt6XkvZzpoblJRFxyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Yqo5L2c5a6e5L2TXHJcbiAgICovXHJcbiAgZXhlY3V0ZUJ5V29ya0l0ZW1JZCh3b3JrSXRlbUlkOiBzdHJpbmcsIGFjdGlvbjogVGFza0FjdGlvbik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdGFzayA9IG5ldyBUYXNrRW50aXR5KCk7XHJcbiAgICB0YXNrLnNvdXJjZUlkID0gd29ya0l0ZW1JZDtcclxuICAgIHJldHVybiB0aGlzLmV4ZWN1dGUodGFzaywgYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXlsb2FkIOS4iuS4i+aWh+WPguaVsFxyXG4gICAqIEByZXR1cm5zIHN1YmplY3QgdHJ1Ze+8muaPkOS6pOaIkOWKn++8jGZhbHNl77ya5o+Q5Lqk5aSx6LSlIFxyXG4gICAqL1xyXG4gIHN0YXJ0UHJvY2VzcyhwYXlsb2FkOiBTdGFydFByb2Nlc3NQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgY29uZmlnTG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoQ29uZmlnQ29kZS5JZl9TaG93X1N1Ym1pdF9EaWFsb2csIE93bmVyVHlwZS5CaXpEZWZLZXksIHBheWxvYWQuYml6RGVmS2V5KS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBjb25maWdMb2FkLmNsb3NlKCk7XHJcbiAgICAgIGlmIChyZSAmJiByZS5jdXJyZW50VmFsdWUgPT09ICdmYWxzZScpIHsvL+iHquWumuS5ieaXoOmcgOW8ueahhlxyXG4gICAgICAgIGNvbnN0IHNpbXVsYXRlTG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5zdGFydFByb2Nlc3NTaW11bGF0ZShwYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBTaW11bGF0ZVJlc3BvbnNlKSA9PiB7Ly/pooTop6PmnpBcclxuICAgICAgICAgIHNpbXVsYXRlTG9hZC5jbG9zZSgpO1xyXG4gICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5uZWVkSW50ZXJhY3Rpb24gPT09IGZhbHNlKSB7Ly/pooTop6PmnpDml6DpnIDkuqTkupJcclxuICAgICAgICAgICAgY29uc3QgZXhlY3V0ZUxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnRhc2tTZXJ2aWNlLnN0YXJ0UHJvY2VzcyhwYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBFeGVjdXRpb25SZXNwb25zZSkgPT4gey8v5omn6KGMXHJcbiAgICAgICAgICAgICAgZXhlY3V0ZUxvYWQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBpZiAocGF5bG9hZC53aXRoUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTdWJtaXRNZXNzYWdlKENvbmZpZ0NvZGUuSW5mb19BZnRlcl9TdWJtaXQsIHBheWxvYWQuYml6RGVmS2V5KTtcclxuICAgICAgICAgICAgfSwgZXJyb3IgPT4gey8v5omn6KGM5oql6ZSZXHJcbiAgICAgICAgICAgICAgZXhlY3V0ZUxvYWQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBpZiAocGF5bG9hZC53aXRoUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChudWxsKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHsvL+mihOino+aekOmcgOimgeS6pOS6klxyXG4gICAgICAgICAgICB0aGlzLnNob3dTdGFydFByb2Nlc3NEaWFsb2cocGF5bG9hZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCBlcnJvciA9PiB7Ly/pooTop6PmnpDmiqXplJlcclxuICAgICAgICAgIHNpbXVsYXRlTG9hZC5jbG9zZSgpO1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KG51bGwpO1xyXG4gICAgICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHsvL+aXoOaYr+WQpuW8ueahhumFjee9rlxyXG4gICAgICAgIHRoaXMuc2hvd1N0YXJ0UHJvY2Vzc0RpYWxvZyhwYXlsb2FkKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4gey8v6I635Y+W6YWN572u5Ye66ZSZXHJcbiAgICAgIGNvbmZpZ0xvYWQuY2xvc2UoKTtcclxuICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqTlrqHmibnlvLnmoYZcclxuICAgKiBAcGFyYW0gcGF5bG9hZCDlj4LmlbBcclxuICAgKiBAcGFyYW0gd2l0aFJlc3BvbnNlIOaYr+WQpuW4pui/lOWbnuWAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd1N0YXJ0UHJvY2Vzc0RpYWxvZyhwYXlsb2FkOiBTdGFydFByb2Nlc3NQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZXRQYXJhbShwYXlsb2FkKS5zdWJzY3JpYmUoKHJlKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgdGl0bGU6IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy50aXRsZScpLFxyXG4gICAgICAgIHdpZHRoOiA1MjAsXHJcbiAgICAgICAgaGVpZ2h0OiByZSAmJiByZS5kaWFsb2dIZWlnaHQsXHJcbiAgICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5idXR0b25zLFxyXG4gICAgICAgIG9wZW5lZDogKCkgPT4ge1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbXBSZWYuY2hhbmdlRGV0ZWN0b3JSZWYgJiYgY29tcFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAgIGlmIChwYXlsb2FkLndpdGhSZXNwb25zZSA9PT0gdHJ1ZSkgey8v5YaF6YOo5L2/55SoXHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5nZXRTdWJqZWN0V2l0aFJlc3BvbnNlKCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHN1YmplY3QubmV4dChyZSk7XHJcbiAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3RDYW5jZWwoKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7Ly/lt7LmnInkuJrliqHnu4TosIPnlKhcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZ2V0U3ViamVjdENhbmNlbCgpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojmj5DkuqRcclxuICAgKiBAcGF5bG9hZCBwYXlsb2FkIOWPguaVsFxyXG4gICAqL1xyXG4gIGNhbmNlbFN1Ym1pdChwYXlsb2FkOiBDYW5jZWxTdWJtaXRQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmNhbmNlbFN1Ym1pdChwYXlsb2FkKS5zdWJzY3JpYmUoKHJlKSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgICBpZiAocmUgJiYgcmUubmVlZEludGVyYWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuY2FuY2VsU3VibWl0SW5mbycpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVN1Ym1pdE1lc3NhZ2UoQ29uZmlnQ29kZS5JbmZvX0FmdGVyX0NhbmNlbF9TdWJtaXQsIHBheWxvYWQuYml6RGVmS2V5KTtcclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICBsb2FkLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QuZXJyb3IoZmFsc2UpO1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmVycm9yKGVycm9yKTtcclxuICAgIH0pXHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBkYXRhSWQg6KGo5Y2VaWRcclxuICAgKiBAcGFyYW0gYml6RGVmS2V5IOWFpeWPo+WNleaNrmlkXHJcbiAgICogQHBhcmFtIG9wdGlvbnMg6Ieq5a6a5LmJ6YWN572uXHJcbiAgICovXHJcbiAgc3VibWl0V2l0aEJpekRlZktleShkYXRhSWQ6IHN0cmluZywgYml6RGVmS2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFkYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwYXlsb2FkID0gbmV3IFN0YXJ0UHJvY2Vzc1BheWxvYWQoKTtcclxuICAgIHBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgcGF5bG9hZC5iaXpEZWZLZXkgPSBiaXpEZWZLZXk7XHJcbiAgICBwYXlsb2FkLndpdGhSZXNwb25zZSA9IHRydWU7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9jZXNzKHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+W5raI5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIGRhdGFJZCDooajljZVpZFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKiBAcGFyYW0gb3B0aW9ucyDoh6rlrprkuYnphY3nva5cclxuICAgKi9cclxuICBjYW5jZWxTdWJtaXRXaXRoRGF0YUlkKGRhdGFJZDogc3RyaW5nLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIWRhdGFJZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgY2FuY2VsU3VibWl0UGF5bG9hZCA9IG5ldyBDYW5jZWxTdWJtaXRQYXlsb2FkKCk7XHJcbiAgICBjYW5jZWxTdWJtaXRQYXlsb2FkLmRhdGFJZCA9IGRhdGFJZDtcclxuICAgIGNhbmNlbFN1Ym1pdFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcmV0dXJuIHRoaXMuY2FuY2VsU3VibWl0KGNhbmNlbFN1Ym1pdFBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIGRhdGFJZHMg6KGo5Y2VSUTpm4blkIhcclxuICAgKiBAcGFyYW0gYml6RGVmS2V5IOWFpeWPo+WNleaNrmlkXHJcbiAgICovXHJcbiAgYmF0Y2hTdWJtaXRXaXRoQml6RGVmS2V5KGRhdGFJZHM6IHN0cmluZ1tdLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIWRhdGFJZHMgfHwgIWRhdGFJZHMubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzRW1wdHknKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoZGF0YUlkcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgdmFyIHN0YXJ0UGF5bG9hZCA9IG5ldyBTdGFydFByb2Nlc3NQYXlsb2FkKClcclxuICAgICAgc3RhcnRQYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgICAgc3RhcnRQYXlsb2FkLmRhdGFJZCA9IGRhdGFJZHNbMF07XHJcbiAgICAgIHJldHVybiB0aGlzLnN0YXJ0UHJvY2VzcyhzdGFydFBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLmJhdGNoU3VibWl0TnVtLnN1Y2Nlc3NOdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaFN1Ym1pdE51bS5mYWlsZWROdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaFN1Ym1pdE51bS5lcnJvck51bSA9IDA7XHJcbiAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKFsuLi5kYXRhSWRzXSwgYml6RGVmS2V5LCAoKSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aPkOS6pOWuoeaJuei+heWKqeWHveaVsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmF0Y2hTdWJtaXRIZWxwRnVuY3Rpb24oZGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge1xyXG4gICAgaWYgKGRhdGFJZHMgJiYgZGF0YUlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGRhdGFJZCA9IGRhdGFJZHMuc2hpZnQoKTsvL+W8leeUqOexu+Wei+i9rOaNolxyXG4gICAgICBsZXQgc3RhcnRQYXlsb2FkID0gbmV3IFN0YXJ0UHJvY2Vzc1BheWxvYWQoKVxyXG4gICAgICBzdGFydFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgICBzdGFydFBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgICBzdGFydFBheWxvYWQudmFyaWFibGVzID0geyBzaW11bGF0ZTogdHJ1ZSB9O1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLnN0YXJ0UHJvY2VzcyhzdGFydFBheWxvYWQpLnN1YnNjcmliZSgocmVzcG9uc2U6IEV4ZWN1dGlvblJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLm5lZWRJbnRlcmFjdGlvbikgey8v6ZyA6KaB5Lqk5LqSXHJcbiAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0TnVtLmZhaWxlZE51bSsrO1xyXG4gICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICAgIH0gZWxzZSB7Ly/kuI3pnIDopoHkuqTkupJcclxuICAgICAgICAgIHN0YXJ0UGF5bG9hZC52YXJpYWJsZXMgPSB7IHNpbXVsYXRlOiBmYWxzZSB9O1xyXG4gICAgICAgICAgdGhpcy50YXNrU2VydmljZS5zdGFydFByb2Nlc3Moc3RhcnRQYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBFeGVjdXRpb25SZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0TnVtLnN1Y2Nlc3NOdW0rKztcclxuICAgICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICAgICAgfSwgKCkgPT4gey8v5a6e6ZmF5o+Q5Lqk5oql6ZSZXHJcbiAgICAgICAgICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uZXJyb3JOdW0rKztcclxuICAgICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0sICgpID0+IHsvL+aooeaLn+aPkOS6pOaKpemUmVxyXG4gICAgICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uZXJyb3JOdW0rKztcclxuICAgICAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKGRhdGFJZHMsIGJpekRlZktleSwgaGFuZGxlcik7XHJcbiAgICAgIH0pXHJcbiAgICB9IGVsc2Ugey8v5om56YeP5omn6KGM5a6M5q+VXHJcbiAgICAgIHRoaXMuc2hvd0JhdGNoU3VibWl0SW5mbyh0aGlzLmJhdGNoU3VibWl0TnVtLCBiaXpEZWZLZXkpO1xyXG4gICAgICBoYW5kbGVyKCk7Ly/miafooYzlm57osIPlh73mlbBcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/lj5bmtojmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gZGF0YUlkcyDooajljZVJROmbhuWQiFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBiYXRjaENhbmNlbFN1Ym1pdFdpdGhEYXRhSWQoZGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghZGF0YUlkcyB8fCAhZGF0YUlkcy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNFbXB0eScpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChkYXRhSWRzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jYW5jZWxTdWJtaXRXaXRoRGF0YUlkKGRhdGFJZHNbMF0sIGJpekRlZktleSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGNvbnN0IGxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgdGhpcy5iYXRjaENhbmNlbE51bS5zdWNjZXNzTnVtID0gMDtcclxuICAgIHRoaXMuYmF0Y2hDYW5jZWxOdW0uZXJyb3JOdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaENhbmNlbEhlbHBGdW5jdGlvbihbLi4uZGF0YUlkc10sIGJpekRlZktleSwgKCkgPT4ge1xyXG4gICAgICBsb2FkLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/lj5bmtojovoXliqnlh73mlbBcclxuICAgKi9cclxuICBwcml2YXRlIGJhdGNoQ2FuY2VsSGVscEZ1bmN0aW9uKGRhdGFJZHM6IHN0cmluZ1tdLCBiaXpEZWZLZXk6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pIHtcclxuICAgIGlmIChkYXRhSWRzICYmIGRhdGFJZHMubGVuZ3RoKSB7XHJcbiAgICAgIGNvbnN0IGRhdGFJZCA9IGRhdGFJZHMuc2hpZnQoKTsvL+W8leeUqOexu+Wei+i9rOaNolxyXG4gICAgICBsZXQgY2FuY2VsUGF5bG9hZCA9IG5ldyBDYW5jZWxTdWJtaXRQYXlsb2FkKCk7XHJcbiAgICAgIGNhbmNlbFBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgICBjYW5jZWxQYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgICAgdGhpcy50YXNrU2VydmljZS5jYW5jZWxTdWJtaXQoY2FuY2VsUGF5bG9hZCkuc3Vic2NyaWJlKCgpID0+IHsvL+WPlua2iOaIkOWKn1xyXG4gICAgICAgIHRoaXMuYmF0Y2hDYW5jZWxOdW0uc3VjY2Vzc051bSsrO1xyXG4gICAgICAgIHRoaXMuYmF0Y2hDYW5jZWxIZWxwRnVuY3Rpb24oZGF0YUlkcywgYml6RGVmS2V5LCBoYW5kbGVyKTtcclxuICAgICAgfSwgKCkgPT4gey8v5Y+W5raI5aSx6LSlXHJcbiAgICAgICAgdGhpcy5iYXRjaENhbmNlbE51bS5lcnJvck51bSsrO1xyXG4gICAgICAgIHRoaXMuYmF0Y2hDYW5jZWxIZWxwRnVuY3Rpb24oZGF0YUlkcywgYml6RGVmS2V5LCBoYW5kbGVyKTtcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2hvd0JhdGNoQ2FuY2VsU3VibWl0SW5mbyh0aGlzLmJhdGNoQ2FuY2VsTnVtLCBiaXpEZWZLZXkpO1xyXG4gICAgICBoYW5kbGVyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrZDooajmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gcGFyZW50RGF0YUlkIOS4u+ihqGlkXHJcbiAgICogQHBhcmFtIGNoaWxkRGF0YUlkIOWtkOihqGlkXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGNoaWxkU3VibWl0KHBhcmVudERhdGFJZDogc3RyaW5nLCBjaGlsZERhdGFJZDogc3RyaW5nLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIXBhcmVudERhdGFJZCB8fCAhY2hpbGREYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIHN0YXJ0UHJvY2Vzc1BheWxvYWQgPSBuZXcgU3RhcnRQcm9jZXNzUGF5bG9hZCgpO1xyXG4gICAgc3RhcnRQcm9jZXNzUGF5bG9hZC5kYXRhSWQgPSBgJHtwYXJlbnREYXRhSWR9LCR7Y2hpbGREYXRhSWR9YDtcclxuICAgIHN0YXJ0UHJvY2Vzc1BheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9jZXNzKHN0YXJ0UHJvY2Vzc1BheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a2Q6KGo5Y+W5raI5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIHBhcmVudERhdGFJZCDkuLvooahpZFxyXG4gICAqIEBwYXJhbSBjaGlsZERhdGFJZCDlrZDooahpZFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBjaGlsZENhbmNlbFN1Ym1pdChwYXJlbnREYXRhSWQ6IHN0cmluZywgY2hpbGREYXRhSWQ6IHN0cmluZywgYml6RGVmS2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFwYXJlbnREYXRhSWQgfHwgIWNoaWxkRGF0YUlkKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciBjYW5jZWxTdWJtaXRQYXlsb2FkID0gbmV3IENhbmNlbFN1Ym1pdFBheWxvYWQoKTtcclxuICAgIGNhbmNlbFN1Ym1pdFBheWxvYWQuZGF0YUlkID0gYCR7cGFyZW50RGF0YUlkfSwke2NoaWxkRGF0YUlkfWA7XHJcbiAgICBjYW5jZWxTdWJtaXRQYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgIHJldHVybiB0aGlzLmNhbmNlbFN1Ym1pdChjYW5jZWxTdWJtaXRQYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtkOihqOaJuemHj+aPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXJlbnREYXRhSWQg5Li76KGoaWRcclxuICAgKiBAcGFyYW0gY2hpbGREYXRhSWRzIOWtkOihqGlk6ZuG5ZCIXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGNoaWxkQmF0Y2hTdWJtaXQocGFyZW50RGF0YUlkOiBzdHJpbmcsIGNoaWxkRGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghcGFyZW50RGF0YUlkIHx8ICFjaGlsZERhdGFJZHMpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0YUlkcyA9IGNoaWxkRGF0YUlkcy5tYXAoY2hpbGREYXRhSWQgPT4gYCR7cGFyZW50RGF0YUlkfSwke2NoaWxkRGF0YUlkfWApO1xyXG4gICAgcmV0dXJuIHRoaXMuYmF0Y2hTdWJtaXRXaXRoQml6RGVmS2V5KGRhdGFJZHMsIGJpekRlZktleSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrZDooajmibnph4/lj5bmtojmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gcGFyZW50RGF0YUlkIOS4u+ihqGlkXHJcbiAgICogQHBhcmFtIGNoaWxkRGF0YUlkcyDlrZDooahpZOmbhuWQiFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBjaGlsZEJhdGNoQ2FuY2VsU3VibWl0KHBhcmVudERhdGFJZDogc3RyaW5nLCBjaGlsZERhdGFJZHM6IHN0cmluZ1tdLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIXBhcmVudERhdGFJZCB8fCAhY2hpbGREYXRhSWRzKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGRhdGFJZHMgPSBjaGlsZERhdGFJZHMubWFwKGNoaWxkRGF0YUlkID0+IGAke3BhcmVudERhdGFJZH0sJHtjaGlsZERhdGFJZH1gKTtcclxuICAgIHJldHVybiB0aGlzLmJhdGNoQ2FuY2VsU3VibWl0V2l0aERhdGFJZChkYXRhSWRzLCBiaXpEZWZLZXkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAqIOaJuemHj+aPkOS6pOaPkOekuuS/oeaBr1xyXG4gKiBAcGFyYW0gc3VjY2Vzc051bSDmiJDlip/mnaHmlbBcclxuICogQHBhcmFtIGZhaWxlZE51bSDpnIDopoHkuqTkupLnmoTmnaHmlbBcclxuICogQHBhcmFtIGVycm9yTnVtIOaJp+ihjOaKpemUmeeahOadoeaVsFxyXG4gKi9cclxuICBwcml2YXRlIHNob3dCYXRjaFN1Ym1pdEluZm8obnVtOiBCYXRjaFN1Ym1pdE51bWJlciwgYml6RGVmS2V5OiBzdHJpbmcpIHtcclxuICAgIGlmIChudW0uc3VjY2Vzc051bSAmJiAhbnVtLmZhaWxlZE51bSAmJiAhbnVtLmVycm9yTnVtKSB7Ly/mibnph4/lhajpg6jmiJDlip9cclxuICAgICAgdGhpcy50YXNrU2VydmljZS5nZXRUYXNrQ2VudGVyQ29uZmlnQnlDb2RlKENvbmZpZ0NvZGUuSW5mb19BZnRlcl9TdWJtaXQsIE93bmVyVHlwZS5CaXpEZWZLZXksIGJpekRlZktleSkuc3Vic2NyaWJlKChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmN1ckxhbmd1YWdlID09PSAnZW4nKSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKEpTT04ucGFyc2UoY29uZmlnLmN1cnJlbnRWYWx1ZSkuZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MoSlNPTi5wYXJzZShjb25maWcuY3VycmVudFZhbHVlKS56aF9DSFMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7Ly/pnZ7lhajpg6jmiJDlip9cclxuICAgICAgbGV0IG1lc3NhZ2UgPSAnJztcclxuICAgICAgbnVtLnN1Y2Nlc3NOdW0gJiYgKG1lc3NhZ2UgKz0gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnYmF0Y2hTdGFydFByb2Nlc3Muc3VjY2VzcycpICsgYOOAkCR7bnVtLnN1Y2Nlc3NOdW1944CRYCArIHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbnVtLmVycm9yTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLmVycm9yJykgKyBg44CQJHtudW0uZXJyb3JOdW1944CRYCArIHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbnVtLmZhaWxlZE51bSAmJiAobWVzc2FnZSArPSB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdiYXRjaFN0YXJ0UHJvY2Vzcy5mYWlsZWQnKSArIGDjgJAke251bS5mYWlsZWROdW1944CRYCArIHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbWVzc2FnZSArPSB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdiYXRjaFN0YXJ0UHJvY2Vzcy5zaW5nbGUnKTtcclxuICAgICAgdGhpcy5tZXNzYWdlLnNob3coJ3dhcm5pbmcnLCBtZXNzYWdlLCB7IHNhZmVIdG1sOiBmYWxzZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WPlua2iOaPkOS6pOaPkOekuuS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0JhdGNoQ2FuY2VsU3VibWl0SW5mbyhudW06IEJhdGNoQ2FuY2VsTnVtYmVyLCBiaXpEZWZLZXk6IHN0cmluZykge1xyXG4gICAgaWYgKG51bS5zdWNjZXNzTnVtICYmICFudW0uZXJyb3JOdW0pIHsvL+aJuemHj+WFqOmDqOaIkOWKn1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoQ29uZmlnQ29kZS5JbmZvX0FmdGVyX0NhbmNlbF9TdWJtaXQsIE93bmVyVHlwZS5CaXpEZWZLZXksIGJpekRlZktleSkuc3Vic2NyaWJlKChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmN1ckxhbmd1YWdlID09PSAnZW4nKSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKEpTT04ucGFyc2UoY29uZmlnLmN1cnJlbnRWYWx1ZSkuZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MoSlNPTi5wYXJzZShjb25maWcuY3VycmVudFZhbHVlKS56aF9DSFMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBtZXNzYWdlID0gJyc7XHJcbiAgICAgIG51bS5zdWNjZXNzTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5zdWNjZXNzJykgKyBg44CQJHtudW0uc3VjY2Vzc051bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbnVtLmVycm9yTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5mYWlsZWQnKSArIGDjgJAke251bS5lcnJvck51bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgdGhpcy5tZXNzYWdlLnNob3coJ3dhcm5pbmcnLCBtZXNzYWdlLCB7IHNhZmVIdG1sOiBmYWxzZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZVN1Ym1pdE1lc3NhZ2UoY29kZTogc3RyaW5nLCBvd25lcklkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgdGhpcy50YXNrU2VydmljZS5nZXRUYXNrQ2VudGVyQ29uZmlnQnlDb2RlKGNvZGUsIE93bmVyVHlwZS5CaXpEZWZLZXksIG93bmVySWQpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgaWYgKHJlICYmIHJlLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgIGxldCBtZXNzYWdlID0gJyc7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gSlNPTi5wYXJzZShyZS5jdXJyZW50VmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY3VyTGFuZ3VhZ2UgPT09ICd6aC1DSFMnICYmIChtZXNzYWdlID0gY3VycmVudFZhbHVlLnpoX0NIUyk7XHJcbiAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9PT0gJ2VuJyAmJiAobWVzc2FnZSA9IGN1cnJlbnRWYWx1ZS5lbik7XHJcbiAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIVCcgJiYgKG1lc3NhZ2UgPSBjdXJyZW50VmFsdWUuemhfQ0hUKTtcclxuICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKG1lc3NhZ2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvZGUgPT09IENvbmZpZ0NvZGUuSW5mb19BZnRlcl9TdWJtaXQgJiYgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3Muc3VibWl0U3VjY2VzcycpKTtcclxuICAgICAgICBjb2RlID09PSBDb25maWdDb2RlLkluZm9fQWZ0ZXJfQ2FuY2VsX1N1Ym1pdCAmJiB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5jYW5jZWxTdWJtaXRTdWNjZXNzJykpO1xyXG4gICAgICB9XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6KGo5Y2V5LiK6Kem5Y+R5rWB56iL6aKE6Kej5p6Q5pON5L2cXHJcbiAgICog5bey5bCB6KOF5Li66KGo5Y2V55qE5ZG95Luk5pON5L2cXHJcbiAgICovXHJcbiAgcHJvY2Vzc1NpbXVsYXRlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGNvbnN0IGdzcFdmRXZlbnRTZXJ2aWNlID0gKHdpbmRvdyBhcyBhbnkpLnBhcmVudC5nc3BXZkV2ZW50U2VydmljZTtcclxuICAgIGdzcFdmRXZlbnRTZXJ2aWNlLnNpbXVsYXRlKCgpID0+IHtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruWNleaNrmlk5p+l55yL5rWB56iL5Zu+XHJcbiAgICog5bey5bCB6KOF5Li66KGo5Y2V5ZG95Luk5ZKM5pON5L2cXHJcbiAgICovXHJcbiAgdmlld0Zsb3dDaGFydEJ5RGF0YUlkKGRhdGFJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWRhdGFJZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuZmxvd2NoYXJ0U2VydmljZS52aWV3Rmxvd0NoYXJ0QnlEYXRhSWQoZGF0YUlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeeci+a1geeoi+Wbvu+8iOaWsO+8jOaUr+aMgemihOiniO+8iVxyXG4gICAqIOW3suWwgeijheS4uuihqOWNleWRveS7pOWSjOaTjeS9nFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5rWB56iL5YiG57G7aWRcclxuICAgKiBAcGFyYW0gZGF0YUlkIOihqOWNleaVsOaNrmlkXHJcbiAgICovXHJcbiAgdmlld0Zsb3dDaGFydFdpdGhGb3JlY2FzdChiaXpEZWZLZXk6IHN0cmluZywgZGF0YUlkOiBzdHJpbmcpIHtcclxuICAgIGlmICghZGF0YUlkKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBwYXlsb2FkID0gbmV3IEZvcmVjYXN0UHJvY2Vzc1BheWxvYWQoKTtcclxuICAgIHBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcGF5bG9hZC5kYXRhSWQgPSBkYXRhSWQ7XHJcbiAgICB0aGlzLmZsb3djaGFydFNlcnZpY2Uudmlld1Byb2Nlc3MocGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmn6XnnIvlrqHmibnorrDlvZXvvIjlvLnmoYbvvIlcclxuICAgKiDlt7LlsIHoo4XkuLrooajljZXlkb3ku6RcclxuICAgKiBAcGFyYW0gZGF0YUlkIOihqOWNleaVsOaNrmlkXHJcbiAgICogQHBhcmFtIHN0eWxlIOWFtuS7luWPguaVsFxyXG4gICAqL1xyXG4gIHZpZXdBcHByb3ZhbExvZyhkYXRhSWQ6IHN0cmluZywgc3R5bGU6IHN0cmluZykge1xyXG4gICAgaWYgKCFkYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXJhbWV0ZXJzID0ge1xyXG4gICAgICBkYXRhSWQ6IGRhdGFJZCxcclxuICAgICAgc3R5bGU6IHN0eWxlLFxyXG4gICAgfVxyXG4gICAgdGhpcy5sb2dTZXJ2aWNlLnNob3dBcHByb3ZhbExvZyhwYXJhbWV0ZXJzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlueUqOaIt+eahOW4uOeUqOaEj+inge+8iOW3suaatOmcsue7mWZhcnJpc++8iVxyXG4gICAqIEByZXR1cm5zIOeUqOaIt+W4uOeUqOaEj+ingWxpc3RcclxuICAgKi9cclxuICBnZXRDb21tb25Db21tZW50cyhmaWx0ZXI6IENvbW1vbkNvbW1lbnRGaWx0ZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMudGFza1NlcnZpY2UuZ2V0Q29tbWVudExpc3QoZmlsdGVyKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxleekuuW4uOeUqOaEj+ingeeuoeeQhmRpYWxvZ++8iOW3suaatOmcsue7mWZhcnJpc++8iVxyXG4gICAqL1xyXG4gIHNob3dDb21tZW50TWFuYWdlRGlhbG9nKGZpbHRlcjogQ29tbW9uQ29tbWVudEZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgc3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoQ29tbWVudE1hbmFnZUNvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29uc3Qgb3B0aW9uczogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnY29tbWVudC5zdGF0aWMudGl0bGUnKSxcclxuICAgICAgd2lkdGg6IDc0MCxcclxuICAgICAgaGVpZ2h0OiA0NDAsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmJ1dHRvbnNcclxuICAgIH1cclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuZmlsdGVyID0gZmlsdGVyO1xyXG4gICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBvcHRpb25zKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuZ2V0Q29uZmlybVNVYmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgIH0pO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5nZXRDYW5jZWxTdWJqZWN0KCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QubmV4dChyZSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
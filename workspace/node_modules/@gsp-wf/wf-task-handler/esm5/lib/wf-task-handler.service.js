/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, ComponentFactoryResolver, ApplicationRef } from '@angular/core';
import { WfApprovalLogsService } from '@gsp-wf/wf-approval-logs';
import { ForecastProcessPayload, WFFlowchartService } from '@gsp-wf/ui-flowchart';
import { BsModalService } from '@farris/ui-modal';
import { Subject, of } from 'rxjs';
import { TaskService } from './service/task.service';
import { TaskAction } from './entity/task-action';
import { NotifyService } from '@farris/ui-notify';
import { I18nService } from './service/i18n/i18n.service';
import { FrameworkService } from '@gsp-sys/rtf-common';
import { TaskEntity } from './entity/task-entity';
import { TaskExecuteComponent } from './components/task-execute/task-execute.component';
import { switchMap } from 'rxjs/operators';
import { StartProcessPayload, CancelSubmitPayload } from './entity/start-process-payload';
import { ProcessSelectorComponent } from './submit/process-selector/process-selector.component';
import { LoadingService } from '@farris/ui-loading';
import { MessagerService } from '@farris/ui-messager';
import { ConfigCode, OwnerType } from './entity/task-center-config';
import { CommentManageComponent } from './components/comment-manage/comment-manage.component';
var WfTaskHandlerService = /** @class */ (function () {
    function WfTaskHandlerService(logService, flowchartService, injector, resolver, modalService, taskService, notify, i18nService, frameworkService, appRef) {
        this.logService = logService;
        this.flowchartService = flowchartService;
        this.injector = injector;
        this.resolver = resolver;
        this.modalService = modalService;
        this.taskService = taskService;
        this.notify = notify;
        this.i18nService = i18nService;
        this.frameworkService = frameworkService;
        this.appRef = appRef;
        this.subject = new Subject();
        this.curLanguage = localStorage.getItem('languageCode') || 'zh-CHS'; //系统当前语言
        //系统当前语言
        this.batchSubmitNum = {
            //批量提交数量
            successNum: 0,
            failedNum: 0,
            errorNum: 0,
        };
        this.batchCancelNum = {
            //批量取消提交数量
            successNum: 0,
            errorNum: 0
        };
        this.loading = this.injector.get(LoadingService);
        this.message = this.injector.get(MessagerService);
    }
    /**
     * 处理单条任务
     * @param entity 任务实体
     * @param action 任务动作
     */
    /**
     * 处理单条任务
     * @param {?} task
     * @param {?} action 任务动作
     * @param {?=} otherParams
     * @return {?}
     */
    WfTaskHandlerService.prototype.execute = /**
     * 处理单条任务
     * @param {?} task
     * @param {?} action 任务动作
     * @param {?=} otherParams
     * @return {?}
     */
    function (task, action, otherParams) {
        switch (action.code) {
            case 'ViewBizLog': //审批日志。如果是inSuite，根据流程实例打开
                this.logService.showByProcInstId(task.processInstanceId);
                break;
            case 'ViewFlowChart': //查看流程
                this.flowchartService.viewFlowchartByProcInstIdAndDataId(task.processInstanceId, task.refBizId);
                break;
            case 'ViewExecuteForm': // 联查单据
                this.openApp(task, action, otherParams);
                break;
            default: //办理类任务
                this.complete(task, action);
        }
        return this.subject.asObservable();
    };
    /**
     * @param {?} assigneeInfo
     * @param {?} openFromIframe
     * @return {?}
     */
    WfTaskHandlerService.prototype.assignByInfo = /**
     * @param {?} assigneeInfo
     * @param {?} openFromIframe
     * @return {?}
     */
    function (assigneeInfo, openFromIframe) {
        /** @type {?} */
        var assignSubject = new Subject();
        return assignSubject.asObservable();
    };
    /**
     * @private
     * @param {?} task
     * @param {?} action
     * @return {?}
     */
    WfTaskHandlerService.prototype.complete = /**
     * @private
     * @param {?} task
     * @param {?} action
     * @return {?}
     */
    function (task, action) {
        var _this = this;
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(TaskExecuteComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.setTask(task);
        compRef.instance.setAction(action);
        compRef.instance.addPadding();
        /** @type {?} */
        var modalConfig = {
            title: action.name ? action.name : this.i18nService.getValue('task.title'),
            width: 550,
            height: compRef.instance.dialogHeight,
            showButtons: true,
            buttons: compRef.instance.buttons
        };
        /** @type {?} */
        var dialog = this.modalService.show(compRef, modalConfig);
        compRef.instance.getSubject().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            re && re.result && _this.subject.next(true);
            re && re.result && dialog.close();
        }));
    };
    /**
     * 打开审批联查界面
     * @param entity 任务实体
     * @param action 动作实体
     */
    /**
     * 打开审批联查界面
     * @param {?} entity 任务实体
     * @param {?} action 动作实体
     * @param {?=} otherParams
     * @return {?}
     */
    WfTaskHandlerService.prototype.openApp = /**
     * 打开审批联查界面
     * @param {?} entity 任务实体
     * @param {?} action 动作实体
     * @param {?=} otherParams
     * @return {?}
     */
    function (entity, action, otherParams) {
        var _this = this;
        /** @type {?} */
        var sourceId = entity.sourceId;
        /** @type {?} */
        var formInfoLoading = this.loading.show();
        this.taskService.getTaskFormInfo(sourceId).subscribe((/**
         * @param {?} formInfo
         * @return {?}
         */
        function (formInfo) {
            formInfoLoading.close();
            if (!formInfo) {
                _this.notify.info(_this.i18nService.getValue('task.notFoundBill'));
                return;
            }
            /** @type {?} */
            var options = {
                appType: 'menu',
                funcId: '',
                appId: '',
                appEntrance: '',
                tabId: sourceId,
                isNewTab: true
            };
            // 传工作流上下文参数
            /** @type {?} */
            var parameters = new Map();
            // 功能菜单情况
            if (formInfo.appId) {
                // 默认联查审批界面
                if (formInfo.formType === '1') { //表单嵌流程
                    parameters.set('workItemId', sourceId);
                    parameters.set('procInstId', action.parameters[0].value);
                    parameters.set('taskState', entity.state);
                    parameters.set('isAssign', entity.actions.some((/**
                     * @param {?} action
                     * @return {?}
                     */
                    function (action) { return action.code === 'AssignUser'; })));
                    formInfo.parameters.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        return parameters.set(item.code, item.value);
                    }));
                    options.funcId = formInfo.appId;
                }
                else { //流程嵌表单
                    options.funcId = 'WF0120';
                    parameters.set('task', entity);
                    parameters.set('formInfo', formInfo);
                    otherParams && parameters.set('taskFilter', otherParams.taskFilter);
                }
            }
            else if (formInfo.url) { //表单格式
                options.funcId = 'WF0120';
                parameters.set('task', entity);
                parameters.set('formInfo', formInfo);
                otherParams && parameters.set('taskFilter', otherParams.taskFilter);
            }
            else {
                _this.notify.info(_this.i18nService.getValue('task.notFoundBill'));
                return;
            }
            options.entityParams = parameters;
            options.queryStringParams = parameters; //兼容IDP表单
            _this.openMenu(options, _this.i18nService.getValue('static.taskForm'));
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            formInfoLoading.close();
            _this.taskService.error(error);
        }));
    };
    /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @param options 打开参数
     * @param menuTitle 菜单名称
     */
    /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @private
     * @param {?} options 打开参数
     * @param {?} menuTitle 菜单名称
     * @return {?}
     */
    WfTaskHandlerService.prototype.openMenu = /**
     * 打开菜单，区分是否inSuite环境，用不同方式打开菜单
     * @private
     * @param {?} options 打开参数
     * @param {?} menuTitle 菜单名称
     * @return {?}
     */
    function (options, menuTitle) {
        var _this = this;
        if (this.taskService.isInSuite()) {
            options.menuTitle = menuTitle;
            /** @type {?} */
            var extObj = ((/** @type {?} */ (window))).gspframeworkService.rtf.extendMethod.getExtObj();
            extObj.iGIXMenuOpen(options);
        }
        else {
            /** @type {?} */
            var openMenuLoading_1 = this.loading.show();
            this.frameworkService.openMenu$(options).subscribe((/**
             * @param {?} re
             * @return {?}
             */
            function (re) {
                openMenuLoading_1.close();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                openMenuLoading_1.close();
                _this.taskService.error(error);
            }));
        }
    };
    /**
     * 返回动作列表，表单嵌流程用到
     * @param workItemId
     */
    /**
     * 返回动作列表，表单嵌流程用到
     * @param {?} workItemId
     * @return {?}
     */
    WfTaskHandlerService.prototype.refreshActions = /**
     * 返回动作列表，表单嵌流程用到
     * @param {?} workItemId
     * @return {?}
     */
    function (workItemId) {
        return this.taskService.getWorkItemActions(workItemId).pipe(switchMap((/**
         * @param {?} actionList
         * @return {?}
         */
        function (actionList) {
            return of(actionList.filter((/**
             * @param {?} action
             * @return {?}
             */
            function (action) {
                return action.code !== 'ViewBizLog' &&
                    action.code !== 'ViewFlowChart' &&
                    action.code !== 'ViewExecuteForm';
            })));
        })));
    };
    /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei@2020.06.22）
     * @param procInstId 流程实例ID
     * @param state 任务状态
     * @param actionCode 动作Code
     */
    /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei\@2020.06.22）
     * @param {?} procInstId 流程实例ID
     * @param {?} state 任务状态
     * @param {?} actionCode 动作Code
     * @return {?}
     */
    WfTaskHandlerService.prototype.executeByProcInstId = /**
     * 根据流程实例ID和动作Code办理任务（暂未用到 by fangpengfei\@2020.06.22）
     * @param {?} procInstId 流程实例ID
     * @param {?} state 任务状态
     * @param {?} actionCode 动作Code
     * @return {?}
     */
    function (procInstId, state, actionCode) {
        var _this = this;
        /** @type {?} */
        var action = new TaskAction();
        action.code = actionCode;
        /** @type {?} */
        var subject = new Subject();
        this.taskService.getTaskByProcInstId(procInstId, state).subscribe((/**
         * @param {?} task
         * @return {?}
         */
        function (task) {
            if (task) {
                _this.execute(task, action).subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                function (re) {
                    subject.next(re);
                }));
            }
            else {
                _this.notify.info(_this.i18nService.getValue('task.noTask'));
            }
        }));
        return subject.asObservable();
    };
    /**
     * 根据workItemId 办理任务
     * @param workItemId 工作项ID
     * @param action 动作实体
     */
    /**
     * 根据workItemId 办理任务
     * @param {?} workItemId 工作项ID
     * @param {?} action 动作实体
     * @return {?}
     */
    WfTaskHandlerService.prototype.executeByWorkItemId = /**
     * 根据workItemId 办理任务
     * @param {?} workItemId 工作项ID
     * @param {?} action 动作实体
     * @return {?}
     */
    function (workItemId, action) {
        /** @type {?} */
        var task = new TaskEntity();
        task.sourceId = workItemId;
        return this.execute(task, action);
    };
    /**
     * 提交审批
     * @param payload 上下文参数
     * @returns subject true：提交成功，false：提交失败
     */
    /**
     * 提交审批
     * @param {?} payload 上下文参数
     * @return {?} subject true：提交成功，false：提交失败
     */
    WfTaskHandlerService.prototype.startProcess = /**
     * 提交审批
     * @param {?} payload 上下文参数
     * @return {?} subject true：提交成功，false：提交失败
     */
    function (payload) {
        var _this = this;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var configLoad = this.loading.show();
        this.taskService.getTaskCenterConfigByCode(ConfigCode.If_Show_Submit_Dialog, OwnerType.BizDefKey, payload.bizDefKey).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            configLoad.close();
            if (re && re.currentValue === 'false') { //自定义无需弹框
                //自定义无需弹框
                /** @type {?} */
                var simulateLoad_1 = _this.loading.show();
                _this.taskService.startProcessSimulate(payload).subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                function (response) {
                    simulateLoad_1.close();
                    if (!response || response.needInteraction === false) { //预解析无需交互
                        //预解析无需交互
                        /** @type {?} */
                        var executeLoad_1 = _this.loading.show();
                        _this.taskService.startProcess(payload).subscribe((/**
                         * @param {?} response
                         * @return {?}
                         */
                        function (response) {
                            executeLoad_1.close();
                            if (payload.withResponse) {
                                subject.next(response);
                            }
                            else {
                                subject.next(true);
                            }
                            _this.handleSubmitMessage(ConfigCode.Info_After_Submit, payload.bizDefKey);
                        }), (/**
                         * @param {?} error
                         * @return {?}
                         */
                        function (error) {
                            executeLoad_1.close();
                            if (payload.withResponse) {
                                subject.next(null);
                            }
                            else {
                                subject.next(false);
                            }
                            _this.taskService.error(error);
                        }));
                    }
                    else { //预解析需要交互
                        _this.showStartProcessDialog(payload).subscribe((/**
                         * @param {?} re
                         * @return {?}
                         */
                        function (re) {
                            subject.next(re);
                        }));
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    simulateLoad_1.close();
                    subject.next(null);
                    _this.taskService.error(error);
                }));
            }
            else { //无是否弹框配置
                _this.showStartProcessDialog(payload).subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                function (re) {
                    subject.next(re);
                }));
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            configLoad.close();
            _this.taskService.error(error);
        }));
        return subject.asObservable();
    };
    /**
     * 提交审批弹框
     * @param payload 参数
     * @param withResponse 是否带返回值
     */
    /**
     * 提交审批弹框
     * @private
     * @param {?} payload 参数
     * @return {?}
     */
    WfTaskHandlerService.prototype.showStartProcessDialog = /**
     * 提交审批弹框
     * @private
     * @param {?} payload 参数
     * @return {?}
     */
    function (payload) {
        var _this = this;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(ProcessSelectorComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        compRef.instance.setParam(payload).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            /** @type {?} */
            var modalConfig = {
                title: _this.i18nService.getValue('startProcess.title'),
                width: 520,
                height: re && re.dialogHeight,
                showButtons: true,
                buttons: compRef.instance.buttons,
                opened: (/**
                 * @return {?}
                 */
                function () {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () {
                        compRef.changeDetectorRef && compRef.changeDetectorRef.detectChanges();
                    }), 100);
                })
            };
            /** @type {?} */
            var dialog = _this.modalService.show(compRef, modalConfig);
            if (payload.withResponse === true) { //内部使用
                compRef.instance.getSubjectWithResponse().subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                function (re) {
                    subject.next(re);
                    dialog.close();
                }));
                compRef.instance.getSubjectCancel().subscribe((/**
                 * @return {?}
                 */
                function () {
                    dialog.close();
                }));
            }
            else { //已有业务组调用
                compRef.instance.getSubject().subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                function (re) {
                    subject.next(re);
                    dialog.close();
                }));
                compRef.instance.getSubjectCancel().subscribe((/**
                 * @param {?} re
                 * @return {?}
                 */
                function (re) {
                    subject.next(re);
                    dialog.close();
                }));
            }
        }));
        return subject.asObservable();
    };
    /**
     * 取消提交
     * @payload payload 参数
     */
    /**
     * 取消提交
     * \@payload payload 参数
     * @param {?} payload
     * @return {?}
     */
    WfTaskHandlerService.prototype.cancelSubmit = /**
     * 取消提交
     * \@payload payload 参数
     * @param {?} payload
     * @return {?}
     */
    function (payload) {
        var _this = this;
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var load = this.loading.show();
        this.taskService.cancelSubmit(payload).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            load.close();
            subject.next(true);
            if (re && re.needInteraction) {
                _this.notify.info(_this.i18nService.getValue('startProcess.cancelSubmitInfo'));
            }
            else {
                _this.handleSubmitMessage(ConfigCode.Info_After_Cancel_Submit, payload.bizDefKey);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            load.close();
            subject.error(false);
            _this.taskService.error(error);
        }));
        return subject.asObservable();
    };
    /**
     * 提交审批
     * @param dataId 表单id
     * @param bizDefKey 入口单据id
     * @param options 自定义配置
     */
    /**
     * 提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.submitWithBizDefKey = /**
     * 提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataId, bizDefKey) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var payload = new StartProcessPayload();
        payload.dataId = dataId;
        payload.bizDefKey = bizDefKey;
        payload.withResponse = true;
        return this.startProcess(payload);
    };
    /**
     * 取消提交审批
     * @param dataId 表单id
     * @param bizDefKey 入口单据id
     * @param options 自定义配置
     */
    /**
     * 取消提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.cancelSubmitWithDataId = /**
     * 取消提交审批
     * @param {?} dataId 表单id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataId, bizDefKey) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var cancelSubmitPayload = new CancelSubmitPayload();
        cancelSubmitPayload.dataId = dataId;
        cancelSubmitPayload.bizDefKey = bizDefKey;
        return this.cancelSubmit(cancelSubmitPayload);
    };
    /**
     * 批量提交审批
     * @param dataIds 表单ID集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 批量提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchSubmitWithBizDefKey = /**
     * 批量提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataIds, bizDefKey) {
        if (!dataIds || !dataIds.length) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        if (dataIds.length === 1) {
            /** @type {?} */
            var startPayload = new StartProcessPayload();
            startPayload.bizDefKey = bizDefKey;
            startPayload.dataId = dataIds[0];
            return this.startProcess(startPayload);
        }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var load = this.loading.show();
        this.batchSubmitNum.successNum = 0;
        this.batchSubmitNum.failedNum = 0;
        this.batchSubmitNum.errorNum = 0;
        this.batchSubmitHelpFunction(tslib_1.__spread(dataIds), bizDefKey, (/**
         * @return {?}
         */
        function () {
            load.close();
            subject.next(true);
        }));
        return subject.asObservable();
    };
    /**
     * 批量提交审批辅助函数
     */
    /**
     * 批量提交审批辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchSubmitHelpFunction = /**
     * 批量提交审批辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    function (dataIds, bizDefKey, handler) {
        var _this = this;
        if (dataIds && dataIds.length > 0) {
            /** @type {?} */
            var dataId = dataIds.shift();
            //引用类型转换
            /** @type {?} */
            var startPayload_1 = new StartProcessPayload();
            startPayload_1.bizDefKey = bizDefKey;
            startPayload_1.dataId = dataId;
            startPayload_1.variables = { simulate: true };
            this.taskService.startProcess(startPayload_1).subscribe((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                if (response.needInteraction) { //需要交互
                    _this.batchSubmitNum.failedNum++;
                    _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                }
                else { //不需要交互
                    startPayload_1.variables = { simulate: false };
                    _this.taskService.startProcess(startPayload_1).subscribe((/**
                     * @param {?} response
                     * @return {?}
                     */
                    function (response) {
                        _this.batchSubmitNum.successNum++;
                        _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                    }), (/**
                     * @return {?}
                     */
                    function () {
                        _this.batchSubmitNum.errorNum++;
                        _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
                    }));
                }
            }), (/**
             * @return {?}
             */
            function () {
                _this.batchSubmitNum.errorNum++;
                _this.batchSubmitHelpFunction(dataIds, bizDefKey, handler);
            }));
        }
        else { //批量执行完毕
            this.showBatchSubmitInfo(this.batchSubmitNum, bizDefKey);
            handler(); //执行回调函数
        }
    };
    /**
     * 批量取消提交审批
     * @param dataIds 表单ID集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 批量取消提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchCancelSubmitWithDataId = /**
     * 批量取消提交审批
     * @param {?} dataIds 表单ID集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (dataIds, bizDefKey) {
        if (!dataIds || !dataIds.length) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsEmpty'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        if (dataIds.length === 1) {
            return this.cancelSubmitWithDataId(dataIds[0], bizDefKey);
        }
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var load = this.loading.show();
        this.batchCancelNum.successNum = 0;
        this.batchCancelNum.errorNum = 0;
        this.batchCancelHelpFunction(tslib_1.__spread(dataIds), bizDefKey, (/**
         * @return {?}
         */
        function () {
            load.close();
            subject.next(true);
        }));
        return subject.asObservable();
    };
    /**
     * 批量取消辅助函数
     */
    /**
     * 批量取消辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    WfTaskHandlerService.prototype.batchCancelHelpFunction = /**
     * 批量取消辅助函数
     * @private
     * @param {?} dataIds
     * @param {?} bizDefKey
     * @param {?} handler
     * @return {?}
     */
    function (dataIds, bizDefKey, handler) {
        var _this = this;
        if (dataIds && dataIds.length) {
            /** @type {?} */
            var dataId = dataIds.shift();
            //引用类型转换
            /** @type {?} */
            var cancelPayload = new CancelSubmitPayload();
            cancelPayload.dataId = dataId;
            cancelPayload.bizDefKey = bizDefKey;
            this.taskService.cancelSubmit(cancelPayload).subscribe((/**
             * @return {?}
             */
            function () {
                _this.batchCancelNum.successNum++;
                _this.batchCancelHelpFunction(dataIds, bizDefKey, handler);
            }), (/**
             * @return {?}
             */
            function () {
                _this.batchCancelNum.errorNum++;
                _this.batchCancelHelpFunction(dataIds, bizDefKey, handler);
            }));
        }
        else {
            this.showBatchCancelSubmitInfo(this.batchCancelNum, bizDefKey);
            handler();
        }
    };
    /**
     * 子表提交审批
     * @param parentDataId 主表id
     * @param childDataId 子表id
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childSubmit = /**
     * 子表提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataId, bizDefKey) {
        if (!parentDataId || !childDataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var startProcessPayload = new StartProcessPayload();
        startProcessPayload.dataId = parentDataId + "," + childDataId;
        startProcessPayload.bizDefKey = bizDefKey;
        return this.startProcess(startProcessPayload);
    };
    /**
     * 子表取消提交审批
     * @param parentDataId 主表id
     * @param childDataId 子表id
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childCancelSubmit = /**
     * 子表取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataId 子表id
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataId, bizDefKey) {
        if (!parentDataId || !childDataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var cancelSubmitPayload = new CancelSubmitPayload();
        cancelSubmitPayload.dataId = parentDataId + "," + childDataId;
        cancelSubmitPayload.bizDefKey = bizDefKey;
        return this.cancelSubmit(cancelSubmitPayload);
    };
    /**
     * 子表批量提交审批
     * @param parentDataId 主表id
     * @param childDataIds 子表id集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表批量提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childBatchSubmit = /**
     * 子表批量提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataIds, bizDefKey) {
        if (!parentDataId || !childDataIds) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var dataIds = childDataIds.map((/**
         * @param {?} childDataId
         * @return {?}
         */
        function (childDataId) { return parentDataId + "," + childDataId; }));
        return this.batchSubmitWithBizDefKey(dataIds, bizDefKey);
    };
    /**
     * 子表批量取消提交审批
     * @param parentDataId 主表id
     * @param childDataIds 子表id集合
     * @param bizDefKey 入口单据id
     */
    /**
     * 子表批量取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.childBatchCancelSubmit = /**
     * 子表批量取消提交审批
     * @param {?} parentDataId 主表id
     * @param {?} childDataIds 子表id集合
     * @param {?} bizDefKey 入口单据id
     * @return {?}
     */
    function (parentDataId, childDataIds, bizDefKey) {
        if (!parentDataId || !childDataIds) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var dataIds = childDataIds.map((/**
         * @param {?} childDataId
         * @return {?}
         */
        function (childDataId) { return parentDataId + "," + childDataId; }));
        return this.batchCancelSubmitWithDataId(dataIds, bizDefKey);
    };
    /**
   * 批量提交提示信息
   * @param successNum 成功条数
   * @param failedNum 需要交互的条数
   * @param errorNum 执行报错的条数
   */
    /**
     * 批量提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    WfTaskHandlerService.prototype.showBatchSubmitInfo = /**
     * 批量提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    function (num, bizDefKey) {
        var _this = this;
        if (num.successNum && !num.failedNum && !num.errorNum) { //批量全部成功
            this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Submit, OwnerType.BizDefKey, bizDefKey).subscribe((/**
             * @param {?} config
             * @return {?}
             */
            function (config) {
                if (_this.curLanguage === 'en') {
                    _this.notify.success(JSON.parse(config.currentValue).en);
                }
                if (_this.curLanguage === 'zh-CHS') {
                    _this.notify.success(JSON.parse(config.currentValue).zh_CHS);
                }
            }));
        }
        else { //非全部成功
            //非全部成功
            /** @type {?} */
            var message = '';
            num.successNum && (message += this.i18nService.getValue('batchStartProcess.success') + ("\u3010" + num.successNum + "\u3011") + this.i18nService.getValue('batchStartProcess.row'));
            num.errorNum && (message += this.i18nService.getValue('batchStartProcess.error') + ("\u3010" + num.errorNum + "\u3011") + this.i18nService.getValue('batchStartProcess.row'));
            num.failedNum && (message += this.i18nService.getValue('batchStartProcess.failed') + ("\u3010" + num.failedNum + "\u3011") + this.i18nService.getValue('batchStartProcess.row'));
            message += this.i18nService.getValue('batchStartProcess.single');
            this.message.show('warning', message, { safeHtml: false });
        }
    };
    /**
     * 批量取消提交提示信息
     */
    /**
     * 批量取消提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    WfTaskHandlerService.prototype.showBatchCancelSubmitInfo = /**
     * 批量取消提交提示信息
     * @private
     * @param {?} num
     * @param {?} bizDefKey
     * @return {?}
     */
    function (num, bizDefKey) {
        var _this = this;
        if (num.successNum && !num.errorNum) { //批量全部成功
            this.taskService.getTaskCenterConfigByCode(ConfigCode.Info_After_Cancel_Submit, OwnerType.BizDefKey, bizDefKey).subscribe((/**
             * @param {?} config
             * @return {?}
             */
            function (config) {
                if (_this.curLanguage === 'en') {
                    _this.notify.success(JSON.parse(config.currentValue).en);
                }
                if (_this.curLanguage === 'zh-CHS') {
                    _this.notify.success(JSON.parse(config.currentValue).zh_CHS);
                }
            }));
        }
        else {
            /** @type {?} */
            var message = '';
            num.successNum && (message += this.i18nService.getValue('startProcess.success') + ("\u3010" + num.successNum + "\u3011") + this.i18nService.getValue('startProcess.row'));
            num.errorNum && (message += this.i18nService.getValue('startProcess.failed') + ("\u3010" + num.errorNum + "\u3011") + this.i18nService.getValue('startProcess.row'));
            this.message.show('warning', message, { safeHtml: false });
        }
    };
    /**
     * @param {?} code
     * @param {?} ownerId
     * @return {?}
     */
    WfTaskHandlerService.prototype.handleSubmitMessage = /**
     * @param {?} code
     * @param {?} ownerId
     * @return {?}
     */
    function (code, ownerId) {
        var _this = this;
        /** @type {?} */
        var load = this.loading.show();
        this.taskService.getTaskCenterConfigByCode(code, OwnerType.BizDefKey, ownerId).subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            load.close();
            if (re && re.currentValue) {
                /** @type {?} */
                var message = '';
                /** @type {?} */
                var currentValue = JSON.parse(re.currentValue);
                _this.curLanguage === 'zh-CHS' && (message = currentValue.zh_CHS);
                _this.curLanguage === 'en' && (message = currentValue.en);
                _this.curLanguage === 'zh-CHT' && (message = currentValue.zh_CHT);
                _this.notify.success(message);
            }
            else {
                code === ConfigCode.Info_After_Submit && _this.notify.success(_this.i18nService.getValue('startProcess.submitSuccess'));
                code === ConfigCode.Info_After_Cancel_Submit && _this.notify.success(_this.i18nService.getValue('startProcess.cancelSubmitSuccess'));
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            load.close();
            _this.taskService.error(error);
        }));
    };
    /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     */
    /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     * @return {?}
     */
    WfTaskHandlerService.prototype.processSimulate = /**
     * 表单上触发流程预解析操作
     * 已封装为表单的命令操作
     * @return {?}
     */
    function () {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var gspWfEventService = ((/** @type {?} */ (window))).parent.gspWfEventService;
        gspWfEventService.simulate((/**
         * @return {?}
         */
        function () {
            subject.next(true);
        }));
        return subject.asObservable();
    };
    /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     */
    /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     * @param {?} dataId
     * @return {?}
     */
    WfTaskHandlerService.prototype.viewFlowChartByDataId = /**
     * 根据单据id查看流程图
     * 已封装为表单命令和操作
     * @param {?} dataId
     * @return {?}
     */
    function (dataId) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        this.flowchartService.viewFlowChartByDataId(dataId);
    };
    /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param bizDefKey 流程分类id
     * @param dataId 表单数据id
     */
    /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param {?} bizDefKey 流程分类id
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    WfTaskHandlerService.prototype.viewFlowChartWithForecast = /**
     * 查看流程图（新，支持预览）
     * 已封装为表单命令和操作
     * @param {?} bizDefKey 流程分类id
     * @param {?} dataId 表单数据id
     * @return {?}
     */
    function (bizDefKey, dataId) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        if (!bizDefKey) {
            this.message.error(this.i18nService.getValue('startProcess.bizDefKeyIsNull'));
            return;
        }
        /** @type {?} */
        var payload = new ForecastProcessPayload();
        payload.bizDefKey = bizDefKey;
        payload.dataId = dataId;
        this.flowchartService.viewProcess(payload);
    };
    /**
     * 查看审批记录（弹框）
     * 已封装为表单命令
     * @param dataId 表单数据id
     * @param style 其他参数
     */
    /**
     * 查看审批记录（弹框）
     * 已封装为表单命令
     * @param {?} dataId 表单数据id
     * @param {?} style 其他参数
     * @return {?}
     */
    WfTaskHandlerService.prototype.viewApprovalLog = /**
     * 查看审批记录（弹框）
     * 已封装为表单命令
     * @param {?} dataId 表单数据id
     * @param {?} style 其他参数
     * @return {?}
     */
    function (dataId, style) {
        if (!dataId) {
            this.notify.warning(this.i18nService.getValue('startProcess.dataIdIsNull'));
            return;
        }
        /** @type {?} */
        var parameters = {
            dataId: dataId,
            style: style,
        };
        this.logService.showApprovalLog(parameters);
    };
    /**
     * 获取用户的常用意见（已暴露给farris）
     * @returns 用户常用意见list
     */
    /**
     * 获取用户的常用意见（已暴露给farris）
     * @param {?} filter
     * @return {?} 用户常用意见list
     */
    WfTaskHandlerService.prototype.getCommonComments = /**
     * 获取用户的常用意见（已暴露给farris）
     * @param {?} filter
     * @return {?} 用户常用意见list
     */
    function (filter) {
        return this.taskService.getCommentList(filter);
    };
    /**
     * 展示常用意见管理dialog（已暴露给farris）
     */
    /**
     * 展示常用意见管理dialog（已暴露给farris）
     * @param {?} filter
     * @return {?}
     */
    WfTaskHandlerService.prototype.showCommentManageDialog = /**
     * 展示常用意见管理dialog（已暴露给farris）
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        /** @type {?} */
        var subject = new Subject();
        /** @type {?} */
        var compFactory = this.resolver.resolveComponentFactory(CommentManageComponent);
        /** @type {?} */
        var compRef = compFactory.create(this.injector);
        /** @type {?} */
        var options = {
            title: this.i18nService.getValue('comment.static.title'),
            width: 740,
            height: 440,
            showButtons: true,
            buttons: compRef.instance.buttons
        };
        compRef.instance.filter = filter;
        /** @type {?} */
        var dialog = this.modalService.show(compRef, options);
        compRef.instance.getConfirmSUbject().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            dialog.close();
            subject.next(re);
        }));
        compRef.instance.getCancelSubject().subscribe((/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            dialog.close();
            subject.next(re);
        }));
        return subject.asObservable();
    };
    WfTaskHandlerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    WfTaskHandlerService.ctorParameters = function () { return [
        { type: WfApprovalLogsService },
        { type: WFFlowchartService },
        { type: Injector },
        { type: ComponentFactoryResolver },
        { type: BsModalService },
        { type: TaskService },
        { type: NotifyService },
        { type: I18nService },
        { type: FrameworkService },
        { type: ApplicationRef }
    ]; };
    return WfTaskHandlerService;
}());
export { WfTaskHandlerService };
if (false) {
    /** @type {?} */
    WfTaskHandlerService.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.message;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.curLanguage;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.batchSubmitNum;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.batchCancelNum;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.flowchartService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.modalService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.taskService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.notify;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.i18nService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.frameworkService;
    /**
     * @type {?}
     * @private
     */
    WfTaskHandlerService.prototype.appRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2YtdGFzay1oYW5kbGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLXdmL3dmLXRhc2staGFuZGxlci8iLCJzb3VyY2VzIjpbImxpYi93Zi10YXNrLWhhbmRsZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLHdCQUF3QixFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQTtBQUNoRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRixPQUFPLEVBQUUsY0FBYyxFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBQ2hFLE9BQU8sRUFBYyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQWMsTUFBTSxxQkFBcUIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDeEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQzFGLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBRWhHLE9BQU8sRUFB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QzdCLHVDQUFnQzs7Ozs7SUFDaEMsdUNBQWlDOzs7OztJQUNqQywyQ0FBK0U7Ozs7O0lBRS9FLDhDQUlFOzs7OztJQUNGLDhDQUdDOzs7OztJQUdDLDBDQUF5Qzs7Ozs7SUFDekMsZ0RBQTRDOzs7OztJQUM1Qyx3Q0FBMEI7Ozs7O0lBQzFCLHdDQUEwQzs7Ozs7SUFDMUMsNENBQW9DOzs7OztJQUNwQywyQ0FBZ0M7Ozs7O0lBQ2hDLHNDQUE2Qjs7Ozs7SUFDN0IsMkNBQWdDOzs7OztJQUNoQyxnREFBMEM7Ozs7O0lBQzFDLHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIEFwcGxpY2F0aW9uUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFdmQXBwcm92YWxMb2dzU2VydmljZSB9IGZyb20gJ0Bnc3Atd2Yvd2YtYXBwcm92YWwtbG9ncydcclxuaW1wb3J0IHsgRm9yZWNhc3RQcm9jZXNzUGF5bG9hZCwgV0ZGbG93Y2hhcnRTZXJ2aWNlIH0gZnJvbSAnQGdzcC13Zi91aS1mbG93Y2hhcnQnO1xyXG5pbXBvcnQgeyBCc01vZGFsU2VydmljZSwgTW9kYWxPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1tb2RhbCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFRhc2tTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlL3Rhc2suc2VydmljZSc7XHJcbmltcG9ydCB7IFRhc2tBY3Rpb24gfSBmcm9tICcuL2VudGl0eS90YXNrLWFjdGlvbic7XHJcbmltcG9ydCB7IEFzc2lnbmVlSW5mbyB9IGZyb20gJy4vZW50aXR5L2NvbXBsZXRlLXJlc3BvbnNlJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgSTE4blNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvaTE4bi9pMThuLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGcmFtZXdvcmtTZXJ2aWNlLCBBcHBPcHRpb25zIH0gZnJvbSAnQGdzcC1zeXMvcnRmLWNvbW1vbic7XHJcbmltcG9ydCB7IEJpekZvcm1SZXN1bHQsIEZvcm1QYXJhbWV0ZXIgfSBmcm9tICcuL2VudGl0eS9iaXpmb3JtJztcclxuaW1wb3J0IHsgVGFza0VudGl0eSB9IGZyb20gJy4vZW50aXR5L3Rhc2stZW50aXR5JztcclxuaW1wb3J0IHsgVGFza0V4ZWN1dGVDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvdGFzay1leGVjdXRlL3Rhc2stZXhlY3V0ZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IFN0YXJ0UHJvY2Vzc1BheWxvYWQsIENhbmNlbFN1Ym1pdFBheWxvYWQgfSBmcm9tICcuL2VudGl0eS9zdGFydC1wcm9jZXNzLXBheWxvYWQnO1xyXG5pbXBvcnQgeyBQcm9jZXNzU2VsZWN0b3JDb21wb25lbnQgfSBmcm9tICcuL3N1Ym1pdC9wcm9jZXNzLXNlbGVjdG9yL3Byb2Nlc3Mtc2VsZWN0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgRXhlY3V0aW9uUmVzcG9uc2UgfSBmcm9tICcuL2VudGl0eS9leGVjdXRpb24tcmVzcG9uc2UnO1xyXG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbG9hZGluZyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBCYXRjaENhbmNlbE51bWJlciwgQmF0Y2hTdWJtaXROdW1iZXIgfSBmcm9tICcuL2VudGl0eS9iYXRjaE51bWJlcic7XHJcbmltcG9ydCB7IFNpbXVsYXRlUmVzcG9uc2UgfSBmcm9tICcuL2VudGl0eS9zaW11bGF0ZS1yZXNwb25zZSc7XHJcbmltcG9ydCB7IENvbmZpZ0NvZGUsIE93bmVyVHlwZSB9IGZyb20gJy4vZW50aXR5L3Rhc2stY2VudGVyLWNvbmZpZyc7XHJcbmltcG9ydCB7IFRhc2tDb21tZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vcHVibGljLWFwaSc7XHJcbmltcG9ydCB7IENvbW1lbnRNYW5hZ2VDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvY29tbWVudC1tYW5hZ2UvY29tbWVudC1tYW5hZ2UuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQ29tbW9uQ29tbWVudEZpbHRlciB9IGZyb20gJy4vZW50aXR5L2NvbW1vbkNvbW1lbnRGaWx0ZXInO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgV2ZUYXNrSGFuZGxlclNlcnZpY2Uge1xyXG5cclxuICBzdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIHByaXZhdGUgbG9hZGluZzogTG9hZGluZ1NlcnZpY2U7XHJcbiAgcHJpdmF0ZSBtZXNzYWdlOiBNZXNzYWdlclNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBjdXJMYW5ndWFnZTogc3RyaW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmd1YWdlQ29kZScpIHx8ICd6aC1DSFMnOy8v57O757uf5b2T5YmN6K+t6KiAXHJcblxyXG4gIHByaXZhdGUgYmF0Y2hTdWJtaXROdW06IEJhdGNoU3VibWl0TnVtYmVyID0gey8v5om56YeP5o+Q5Lqk5pWw6YePXHJcbiAgICBzdWNjZXNzTnVtOiAwLFxyXG4gICAgZmFpbGVkTnVtOiAwLFxyXG4gICAgZXJyb3JOdW06IDAsXHJcbiAgfTtcclxuICBwcml2YXRlIGJhdGNoQ2FuY2VsTnVtOiBCYXRjaENhbmNlbE51bWJlciA9IHsvL+aJuemHj+WPlua2iOaPkOS6pOaVsOmHj1xyXG4gICAgc3VjY2Vzc051bTogMCxcclxuICAgIGVycm9yTnVtOiAwXHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgbG9nU2VydmljZTogV2ZBcHByb3ZhbExvZ3NTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmbG93Y2hhcnRTZXJ2aWNlOiBXRkZsb3djaGFydFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgIHByaXZhdGUgbW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcclxuICAgIHByaXZhdGUgdGFza1NlcnZpY2U6IFRhc2tTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnk6IE5vdGlmeVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGkxOG5TZXJ2aWNlOiBJMThuU2VydmljZSxcclxuICAgIHByaXZhdGUgZnJhbWV3b3JrU2VydmljZTogRnJhbWV3b3JrU2VydmljZSxcclxuICAgIHByaXZhdGUgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcclxuICApIHtcclxuICAgIHRoaXMubG9hZGluZyA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvYWRpbmdTZXJ2aWNlKTtcclxuICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1lc3NhZ2VyU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbljZXmnaHku7vliqFcclxuICAgKiBAcGFyYW0gZW50aXR5IOS7u+WKoeWunuS9k1xyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Lu75Yqh5Yqo5L2cXHJcbiAgICovXHJcbiAgZXhlY3V0ZSh0YXNrOiBUYXNrRW50aXR5LCBhY3Rpb246IFRhc2tBY3Rpb24sIG90aGVyUGFyYW1zPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHN3aXRjaCAoYWN0aW9uLmNvZGUpIHtcclxuICAgICAgY2FzZSAnVmlld0JpekxvZyc6Ly/lrqHmibnml6Xlv5fjgILlpoLmnpzmmK9pblN1aXRl77yM5qC55o2u5rWB56iL5a6e5L6L5omT5byAXHJcbiAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLnNob3dCeVByb2NJbnN0SWQodGFzay5wcm9jZXNzSW5zdGFuY2VJZCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1ZpZXdGbG93Q2hhcnQnOi8v5p+l55yL5rWB56iLXHJcbiAgICAgICAgdGhpcy5mbG93Y2hhcnRTZXJ2aWNlLnZpZXdGbG93Y2hhcnRCeVByb2NJbnN0SWRBbmREYXRhSWQodGFzay5wcm9jZXNzSW5zdGFuY2VJZCwgdGFzay5yZWZCaXpJZCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1ZpZXdFeGVjdXRlRm9ybSc6Ly8g6IGU5p+l5Y2V5o2uXHJcbiAgICAgICAgdGhpcy5vcGVuQXBwKHRhc2ssIGFjdGlvbiwgb3RoZXJQYXJhbXMpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OiAvL+WKnueQhuexu+S7u+WKoVxyXG4gICAgICAgIHRoaXMuY29tcGxldGUodGFzaywgYWN0aW9uKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICBhc3NpZ25CeUluZm8oYXNzaWduZWVJbmZvOiBBc3NpZ25lZUluZm8sIG9wZW5Gcm9tSWZyYW1lOiBib29sZWFuKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IGFzc2lnblN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgICByZXR1cm4gYXNzaWduU3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY29tcGxldGUodGFzazogVGFza0VudGl0eSwgYWN0aW9uOiBUYXNrQWN0aW9uKSB7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVGFza0V4ZWN1dGVDb21wb25lbnQpO1xyXG4gICAgY29uc3QgY29tcFJlZiA9IGNvbXBGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2V0VGFzayh0YXNrKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2Uuc2V0QWN0aW9uKGFjdGlvbik7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmFkZFBhZGRpbmcoKTtcclxuICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgIHRpdGxlOiBhY3Rpb24ubmFtZSA/IGFjdGlvbi5uYW1lIDogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgndGFzay50aXRsZScpLFxyXG4gICAgICB3aWR0aDogNTUwLFxyXG4gICAgICBoZWlnaHQ6IGNvbXBSZWYuaW5zdGFuY2UuZGlhbG9nSGVpZ2h0LFxyXG4gICAgICBzaG93QnV0dG9uczogdHJ1ZSxcclxuICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5idXR0b25zXHJcbiAgICB9O1xyXG4gICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICByZSAmJiByZS5yZXN1bHQgJiYgdGhpcy5zdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgICAgIHJlICYmIHJlLnJlc3VsdCAmJiBkaWFsb2cuY2xvc2UoKTtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmiZPlvIDlrqHmibnogZTmn6XnlYzpnaJcclxuICAgKiBAcGFyYW0gZW50aXR5IOS7u+WKoeWunuS9k1xyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Yqo5L2c5a6e5L2TXHJcbiAgICovXHJcbiAgb3BlbkFwcChlbnRpdHk6IFRhc2tFbnRpdHksIGFjdGlvbjogVGFza0FjdGlvbiwgb3RoZXJQYXJhbXM/OiBhbnkpIHtcclxuICAgIGNvbnN0IHNvdXJjZUlkID0gZW50aXR5LnNvdXJjZUlkO1xyXG4gICAgY29uc3QgZm9ybUluZm9Mb2FkaW5nID0gdGhpcy5sb2FkaW5nLnNob3coKTtcclxuICAgIHRoaXMudGFza1NlcnZpY2UuZ2V0VGFza0Zvcm1JbmZvKHNvdXJjZUlkKS5zdWJzY3JpYmUoKGZvcm1JbmZvOiBCaXpGb3JtUmVzdWx0KSA9PiB7XHJcbiAgICAgIGZvcm1JbmZvTG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICBpZiAoIWZvcm1JbmZvKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCd0YXNrLm5vdEZvdW5kQmlsbCcpKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3Qgb3B0aW9uczogQXBwT3B0aW9ucyA9IHtcclxuICAgICAgICBhcHBUeXBlOiAnbWVudScsXHJcbiAgICAgICAgZnVuY0lkOiAnJyxcclxuICAgICAgICBhcHBJZDogJycsXHJcbiAgICAgICAgYXBwRW50cmFuY2U6ICcnLFxyXG4gICAgICAgIHRhYklkOiBzb3VyY2VJZCxcclxuICAgICAgICBpc05ld1RhYjogdHJ1ZVxyXG4gICAgICB9O1xyXG4gICAgICAvLyDkvKDlt6XkvZzmtYHkuIrkuIvmloflj4LmlbBcclxuICAgICAgY29uc3QgcGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgICAgIC8vIOWKn+iDveiPnOWNleaDheWGtVxyXG4gICAgICBpZiAoZm9ybUluZm8uYXBwSWQpIHtcclxuICAgICAgICAvLyDpu5jorqTogZTmn6XlrqHmibnnlYzpnaJcclxuICAgICAgICBpZiAoZm9ybUluZm8uZm9ybVR5cGUgPT09ICcxJykgey8v6KGo5Y2V5bWM5rWB56iLXHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnd29ya0l0ZW1JZCcsIHNvdXJjZUlkKTtcclxuICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KCdwcm9jSW5zdElkJywgYWN0aW9uLnBhcmFtZXRlcnNbMF0udmFsdWUpO1xyXG4gICAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3Rhc2tTdGF0ZScsIGVudGl0eS5zdGF0ZSk7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnaXNBc3NpZ24nLCBlbnRpdHkuYWN0aW9ucy5zb21lKGFjdGlvbiA9PiBhY3Rpb24uY29kZSA9PT0gJ0Fzc2lnblVzZXInKSk7XHJcbiAgICAgICAgICBmb3JtSW5mby5wYXJhbWV0ZXJzLmZvckVhY2goKGl0ZW06IEZvcm1QYXJhbWV0ZXIpID0+XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMuc2V0KGl0ZW0uY29kZSwgaXRlbS52YWx1ZSlcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBvcHRpb25zLmZ1bmNJZCA9IGZvcm1JbmZvLmFwcElkO1xyXG4gICAgICAgIH0gZWxzZSB7Ly/mtYHnqIvltYzooajljZVcclxuICAgICAgICAgIG9wdGlvbnMuZnVuY0lkID0gJ1dGMDEyMCc7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgndGFzaycsIGVudGl0eSk7XHJcbiAgICAgICAgICBwYXJhbWV0ZXJzLnNldCgnZm9ybUluZm8nLCBmb3JtSW5mbyk7XHJcbiAgICAgICAgICBvdGhlclBhcmFtcyAmJiBwYXJhbWV0ZXJzLnNldCgndGFza0ZpbHRlcicsIG90aGVyUGFyYW1zLnRhc2tGaWx0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChmb3JtSW5mby51cmwpIHsvL+ihqOWNleagvOW8j1xyXG4gICAgICAgIG9wdGlvbnMuZnVuY0lkID0gJ1dGMDEyMCc7XHJcbiAgICAgICAgcGFyYW1ldGVycy5zZXQoJ3Rhc2snLCBlbnRpdHkpO1xyXG4gICAgICAgIHBhcmFtZXRlcnMuc2V0KCdmb3JtSW5mbycsIGZvcm1JbmZvKTtcclxuICAgICAgICBvdGhlclBhcmFtcyAmJiBwYXJhbWV0ZXJzLnNldCgndGFza0ZpbHRlcicsIG90aGVyUGFyYW1zLnRhc2tGaWx0ZXIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubm90aWZ5LmluZm8odGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgndGFzay5ub3RGb3VuZEJpbGwnKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIG9wdGlvbnMuZW50aXR5UGFyYW1zID0gcGFyYW1ldGVycztcclxuICAgICAgb3B0aW9ucy5xdWVyeVN0cmluZ1BhcmFtcyA9IHBhcmFtZXRlcnM7Ly/lhbzlrrlJRFDooajljZVcclxuICAgICAgdGhpcy5vcGVuTWVudShvcHRpb25zLCB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGF0aWMudGFza0Zvcm0nKSk7XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIGZvcm1JbmZvTG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmVycm9yKGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5omT5byA6I+c5Y2V77yM5Yy65YiG5piv5ZCmaW5TdWl0ZeeOr+Wig++8jOeUqOS4jeWQjOaWueW8j+aJk+W8gOiPnOWNlVxyXG4gICAqIEBwYXJhbSBvcHRpb25zIOaJk+W8gOWPguaVsFxyXG4gICAqIEBwYXJhbSBtZW51VGl0bGUg6I+c5Y2V5ZCN56ewXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvcGVuTWVudShvcHRpb25zOiBhbnksIG1lbnVUaXRsZTogc3RyaW5nKSB7XHJcbiAgICBpZiAodGhpcy50YXNrU2VydmljZS5pc0luU3VpdGUoKSkge1xyXG4gICAgICBvcHRpb25zLm1lbnVUaXRsZSA9IG1lbnVUaXRsZTtcclxuICAgICAgdmFyIGV4dE9iaiA9ICh3aW5kb3cgYXMgYW55KS5nc3BmcmFtZXdvcmtTZXJ2aWNlLnJ0Zi5leHRlbmRNZXRob2QuZ2V0RXh0T2JqKCk7XHJcbiAgICAgIGV4dE9iai5pR0lYTWVudU9wZW4ob3B0aW9ucyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBvcGVuTWVudUxvYWRpbmcgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgICB0aGlzLmZyYW1ld29ya1NlcnZpY2Uub3Blbk1lbnUkKG9wdGlvbnMpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgb3Blbk1lbnVMb2FkaW5nLmNsb3NlKCk7XHJcblxyXG4gICAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgICAgb3Blbk1lbnVMb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDov5Tlm57liqjkvZzliJfooajvvIzooajljZXltYzmtYHnqIvnlKjliLBcclxuICAgKiBAcGFyYW0gd29ya0l0ZW1JZCBcclxuICAgKi9cclxuICByZWZyZXNoQWN0aW9ucyh3b3JrSXRlbUlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMudGFza1NlcnZpY2UuZ2V0V29ya0l0ZW1BY3Rpb25zKHdvcmtJdGVtSWQpLnBpcGUoXHJcbiAgICAgIHN3aXRjaE1hcCgoYWN0aW9uTGlzdDogYW55W10pID0+IHtcclxuICAgICAgICByZXR1cm4gb2YoYWN0aW9uTGlzdC5maWx0ZXIoYWN0aW9uID0+XHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdCaXpMb2cnICYmXHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdGbG93Q2hhcnQnICYmXHJcbiAgICAgICAgICBhY3Rpb24uY29kZSAhPT0gJ1ZpZXdFeGVjdXRlRm9ybSdcclxuICAgICAgICApKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmoLnmja7mtYHnqIvlrp7kvotJROWSjOWKqOS9nENvZGXlip7nkIbku7vliqHvvIjmmoLmnKrnlKjliLAgYnkgZmFuZ3BlbmdmZWlAMjAyMC4wNi4yMu+8iVxyXG4gICAqIEBwYXJhbSBwcm9jSW5zdElkIOa1geeoi+WunuS+i0lEXHJcbiAgICogQHBhcmFtIHN0YXRlIOS7u+WKoeeKtuaAgVxyXG4gICAqIEBwYXJhbSBhY3Rpb25Db2RlIOWKqOS9nENvZGVcclxuICAgKi9cclxuICBleGVjdXRlQnlQcm9jSW5zdElkKHByb2NJbnN0SWQ6IHN0cmluZywgc3RhdGU6IG51bWJlciwgYWN0aW9uQ29kZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHZhciBhY3Rpb24gPSBuZXcgVGFza0FjdGlvbigpO1xyXG4gICAgYWN0aW9uLmNvZGUgPSBhY3Rpb25Db2RlO1xyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tCeVByb2NJbnN0SWQocHJvY0luc3RJZCwgc3RhdGUpLnN1YnNjcmliZSgodGFzazogVGFza0VudGl0eSkgPT4ge1xyXG4gICAgICBpZiAodGFzaykge1xyXG4gICAgICAgIHRoaXMuZXhlY3V0ZSh0YXNrLCBhY3Rpb24pLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCd0YXNrLm5vVGFzaycpKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5qC55o2ud29ya0l0ZW1JZCDlip7nkIbku7vliqFcclxuICAgKiBAcGFyYW0gd29ya0l0ZW1JZCDlt6XkvZzpoblJRFxyXG4gICAqIEBwYXJhbSBhY3Rpb24g5Yqo5L2c5a6e5L2TXHJcbiAgICovXHJcbiAgZXhlY3V0ZUJ5V29ya0l0ZW1JZCh3b3JrSXRlbUlkOiBzdHJpbmcsIGFjdGlvbjogVGFza0FjdGlvbik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdGFzayA9IG5ldyBUYXNrRW50aXR5KCk7XHJcbiAgICB0YXNrLnNvdXJjZUlkID0gd29ya0l0ZW1JZDtcclxuICAgIHJldHVybiB0aGlzLmV4ZWN1dGUodGFzaywgYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXlsb2FkIOS4iuS4i+aWh+WPguaVsFxyXG4gICAqIEByZXR1cm5zIHN1YmplY3QgdHJ1Ze+8muaPkOS6pOaIkOWKn++8jGZhbHNl77ya5o+Q5Lqk5aSx6LSlIFxyXG4gICAqL1xyXG4gIHN0YXJ0UHJvY2VzcyhwYXlsb2FkOiBTdGFydFByb2Nlc3NQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgY29uZmlnTG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoQ29uZmlnQ29kZS5JZl9TaG93X1N1Ym1pdF9EaWFsb2csIE93bmVyVHlwZS5CaXpEZWZLZXksIHBheWxvYWQuYml6RGVmS2V5KS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBjb25maWdMb2FkLmNsb3NlKCk7XHJcbiAgICAgIGlmIChyZSAmJiByZS5jdXJyZW50VmFsdWUgPT09ICdmYWxzZScpIHsvL+iHquWumuS5ieaXoOmcgOW8ueahhlxyXG4gICAgICAgIGNvbnN0IHNpbXVsYXRlTG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5zdGFydFByb2Nlc3NTaW11bGF0ZShwYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBTaW11bGF0ZVJlc3BvbnNlKSA9PiB7Ly/pooTop6PmnpBcclxuICAgICAgICAgIHNpbXVsYXRlTG9hZC5jbG9zZSgpO1xyXG4gICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS5uZWVkSW50ZXJhY3Rpb24gPT09IGZhbHNlKSB7Ly/pooTop6PmnpDml6DpnIDkuqTkupJcclxuICAgICAgICAgICAgY29uc3QgZXhlY3V0ZUxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgICAgICAgICB0aGlzLnRhc2tTZXJ2aWNlLnN0YXJ0UHJvY2VzcyhwYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBFeGVjdXRpb25SZXNwb25zZSkgPT4gey8v5omn6KGMXHJcbiAgICAgICAgICAgICAgZXhlY3V0ZUxvYWQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBpZiAocGF5bG9hZC53aXRoUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVTdWJtaXRNZXNzYWdlKENvbmZpZ0NvZGUuSW5mb19BZnRlcl9TdWJtaXQsIHBheWxvYWQuYml6RGVmS2V5KTtcclxuICAgICAgICAgICAgfSwgZXJyb3IgPT4gey8v5omn6KGM5oql6ZSZXHJcbiAgICAgICAgICAgICAgZXhlY3V0ZUxvYWQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBpZiAocGF5bG9hZC53aXRoUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dChudWxsKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHsvL+mihOino+aekOmcgOimgeS6pOS6klxyXG4gICAgICAgICAgICB0aGlzLnNob3dTdGFydFByb2Nlc3NEaWFsb2cocGF5bG9hZCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LCBlcnJvciA9PiB7Ly/pooTop6PmnpDmiqXplJlcclxuICAgICAgICAgIHNpbXVsYXRlTG9hZC5jbG9zZSgpO1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KG51bGwpO1xyXG4gICAgICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHsvL+aXoOaYr+WQpuW8ueahhumFjee9rlxyXG4gICAgICAgIHRoaXMuc2hvd1N0YXJ0UHJvY2Vzc0RpYWxvZyhwYXlsb2FkKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4gey8v6I635Y+W6YWN572u5Ye66ZSZXHJcbiAgICAgIGNvbmZpZ0xvYWQuY2xvc2UoKTtcclxuICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmj5DkuqTlrqHmibnlvLnmoYZcclxuICAgKiBAcGFyYW0gcGF5bG9hZCDlj4LmlbBcclxuICAgKiBAcGFyYW0gd2l0aFJlc3BvbnNlIOaYr+WQpuW4pui/lOWbnuWAvFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd1N0YXJ0UHJvY2Vzc0RpYWxvZyhwYXlsb2FkOiBTdGFydFByb2Nlc3NQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgY29tcEZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFByb2Nlc3NTZWxlY3RvckNvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5zZXRQYXJhbShwYXlsb2FkKS5zdWJzY3JpYmUoKHJlKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vZGFsQ29uZmlnOiBNb2RhbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgdGl0bGU6IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy50aXRsZScpLFxyXG4gICAgICAgIHdpZHRoOiA1MjAsXHJcbiAgICAgICAgaGVpZ2h0OiByZSAmJiByZS5kaWFsb2dIZWlnaHQsXHJcbiAgICAgICAgc2hvd0J1dHRvbnM6IHRydWUsXHJcbiAgICAgICAgYnV0dG9uczogY29tcFJlZi5pbnN0YW5jZS5idXR0b25zLFxyXG4gICAgICAgIG9wZW5lZDogKCkgPT4ge1xyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbXBSZWYuY2hhbmdlRGV0ZWN0b3JSZWYgJiYgY29tcFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBtb2RhbENvbmZpZyk7XHJcbiAgICAgIGlmIChwYXlsb2FkLndpdGhSZXNwb25zZSA9PT0gdHJ1ZSkgey8v5YaF6YOo5L2/55SoXHJcbiAgICAgICAgY29tcFJlZi5pbnN0YW5jZS5nZXRTdWJqZWN0V2l0aFJlc3BvbnNlKCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgICAgIHN1YmplY3QubmV4dChyZSk7XHJcbiAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3RDYW5jZWwoKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7Ly/lt7LmnInkuJrliqHnu4TosIPnlKhcclxuICAgICAgICBjb21wUmVmLmluc3RhbmNlLmdldFN1YmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbXBSZWYuaW5zdGFuY2UuZ2V0U3ViamVjdENhbmNlbCgpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0Lm5leHQocmUpO1xyXG4gICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlj5bmtojmj5DkuqRcclxuICAgKiBAcGF5bG9hZCBwYXlsb2FkIOWPguaVsFxyXG4gICAqL1xyXG4gIGNhbmNlbFN1Ym1pdChwYXlsb2FkOiBDYW5jZWxTdWJtaXRQYXlsb2FkKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLnRhc2tTZXJ2aWNlLmNhbmNlbFN1Ym1pdChwYXlsb2FkKS5zdWJzY3JpYmUoKHJlKSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgICBpZiAocmUgJiYgcmUubmVlZEludGVyYWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkuaW5mbyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuY2FuY2VsU3VibWl0SW5mbycpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVN1Ym1pdE1lc3NhZ2UoQ29uZmlnQ29kZS5JbmZvX0FmdGVyX0NhbmNlbF9TdWJtaXQsIHBheWxvYWQuYml6RGVmS2V5KTtcclxuICAgICAgfVxyXG4gICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICBsb2FkLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QuZXJyb3IoZmFsc2UpO1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmVycm9yKGVycm9yKTtcclxuICAgIH0pXHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBkYXRhSWQg6KGo5Y2VaWRcclxuICAgKiBAcGFyYW0gYml6RGVmS2V5IOWFpeWPo+WNleaNrmlkXHJcbiAgICogQHBhcmFtIG9wdGlvbnMg6Ieq5a6a5LmJ6YWN572uXHJcbiAgICovXHJcbiAgc3VibWl0V2l0aEJpekRlZktleShkYXRhSWQ6IHN0cmluZywgYml6RGVmS2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFkYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwYXlsb2FkID0gbmV3IFN0YXJ0UHJvY2Vzc1BheWxvYWQoKTtcclxuICAgIHBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgcGF5bG9hZC5iaXpEZWZLZXkgPSBiaXpEZWZLZXk7XHJcbiAgICBwYXlsb2FkLndpdGhSZXNwb25zZSA9IHRydWU7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9jZXNzKHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Y+W5raI5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIGRhdGFJZCDooajljZVpZFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKiBAcGFyYW0gb3B0aW9ucyDoh6rlrprkuYnphY3nva5cclxuICAgKi9cclxuICBjYW5jZWxTdWJtaXRXaXRoRGF0YUlkKGRhdGFJZDogc3RyaW5nLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIWRhdGFJZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgY2FuY2VsU3VibWl0UGF5bG9hZCA9IG5ldyBDYW5jZWxTdWJtaXRQYXlsb2FkKCk7XHJcbiAgICBjYW5jZWxTdWJtaXRQYXlsb2FkLmRhdGFJZCA9IGRhdGFJZDtcclxuICAgIGNhbmNlbFN1Ym1pdFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcmV0dXJuIHRoaXMuY2FuY2VsU3VibWl0KGNhbmNlbFN1Ym1pdFBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5om56YeP5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIGRhdGFJZHMg6KGo5Y2VSUTpm4blkIhcclxuICAgKiBAcGFyYW0gYml6RGVmS2V5IOWFpeWPo+WNleaNrmlkXHJcbiAgICovXHJcbiAgYmF0Y2hTdWJtaXRXaXRoQml6RGVmS2V5KGRhdGFJZHM6IHN0cmluZ1tdLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIWRhdGFJZHMgfHwgIWRhdGFJZHMubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzRW1wdHknKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghYml6RGVmS2V5KSB7XHJcbiAgICAgIHRoaXMubWVzc2FnZS5lcnJvcih0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuYml6RGVmS2V5SXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoZGF0YUlkcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgdmFyIHN0YXJ0UGF5bG9hZCA9IG5ldyBTdGFydFByb2Nlc3NQYXlsb2FkKClcclxuICAgICAgc3RhcnRQYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgICAgc3RhcnRQYXlsb2FkLmRhdGFJZCA9IGRhdGFJZHNbMF07XHJcbiAgICAgIHJldHVybiB0aGlzLnN0YXJ0UHJvY2VzcyhzdGFydFBheWxvYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xyXG4gICAgY29uc3QgbG9hZCA9IHRoaXMubG9hZGluZy5zaG93KCk7XHJcbiAgICB0aGlzLmJhdGNoU3VibWl0TnVtLnN1Y2Nlc3NOdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaFN1Ym1pdE51bS5mYWlsZWROdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaFN1Ym1pdE51bS5lcnJvck51bSA9IDA7XHJcbiAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKFsuLi5kYXRhSWRzXSwgYml6RGVmS2V5LCAoKSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+aPkOS6pOWuoeaJuei+heWKqeWHveaVsFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYmF0Y2hTdWJtaXRIZWxwRnVuY3Rpb24oZGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge1xyXG4gICAgaWYgKGRhdGFJZHMgJiYgZGF0YUlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGRhdGFJZCA9IGRhdGFJZHMuc2hpZnQoKTsvL+W8leeUqOexu+Wei+i9rOaNolxyXG4gICAgICBsZXQgc3RhcnRQYXlsb2FkID0gbmV3IFN0YXJ0UHJvY2Vzc1BheWxvYWQoKVxyXG4gICAgICBzdGFydFBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgICBzdGFydFBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgICBzdGFydFBheWxvYWQudmFyaWFibGVzID0geyBzaW11bGF0ZTogdHJ1ZSB9O1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLnN0YXJ0UHJvY2VzcyhzdGFydFBheWxvYWQpLnN1YnNjcmliZSgocmVzcG9uc2U6IEV4ZWN1dGlvblJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLm5lZWRJbnRlcmFjdGlvbikgey8v6ZyA6KaB5Lqk5LqSXHJcbiAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0TnVtLmZhaWxlZE51bSsrO1xyXG4gICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICAgIH0gZWxzZSB7Ly/kuI3pnIDopoHkuqTkupJcclxuICAgICAgICAgIHN0YXJ0UGF5bG9hZC52YXJpYWJsZXMgPSB7IHNpbXVsYXRlOiBmYWxzZSB9O1xyXG4gICAgICAgICAgdGhpcy50YXNrU2VydmljZS5zdGFydFByb2Nlc3Moc3RhcnRQYXlsb2FkKS5zdWJzY3JpYmUoKHJlc3BvbnNlOiBFeGVjdXRpb25SZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmJhdGNoU3VibWl0TnVtLnN1Y2Nlc3NOdW0rKztcclxuICAgICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICAgICAgfSwgKCkgPT4gey8v5a6e6ZmF5o+Q5Lqk5oql6ZSZXHJcbiAgICAgICAgICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uZXJyb3JOdW0rKztcclxuICAgICAgICAgICAgdGhpcy5iYXRjaFN1Ym1pdEhlbHBGdW5jdGlvbihkYXRhSWRzLCBiaXpEZWZLZXksIGhhbmRsZXIpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0sICgpID0+IHsvL+aooeaLn+aPkOS6pOaKpemUmVxyXG4gICAgICAgIHRoaXMuYmF0Y2hTdWJtaXROdW0uZXJyb3JOdW0rKztcclxuICAgICAgICB0aGlzLmJhdGNoU3VibWl0SGVscEZ1bmN0aW9uKGRhdGFJZHMsIGJpekRlZktleSwgaGFuZGxlcik7XHJcbiAgICAgIH0pXHJcbiAgICB9IGVsc2Ugey8v5om56YeP5omn6KGM5a6M5q+VXHJcbiAgICAgIHRoaXMuc2hvd0JhdGNoU3VibWl0SW5mbyh0aGlzLmJhdGNoU3VibWl0TnVtLCBiaXpEZWZLZXkpO1xyXG4gICAgICBoYW5kbGVyKCk7Ly/miafooYzlm57osIPlh73mlbBcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/lj5bmtojmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gZGF0YUlkcyDooajljZVJROmbhuWQiFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBiYXRjaENhbmNlbFN1Ym1pdFdpdGhEYXRhSWQoZGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghZGF0YUlkcyB8fCAhZGF0YUlkcy5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNFbXB0eScpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChkYXRhSWRzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jYW5jZWxTdWJtaXRXaXRoRGF0YUlkKGRhdGFJZHNbMF0sIGJpekRlZktleSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGNvbnN0IGxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgdGhpcy5iYXRjaENhbmNlbE51bS5zdWNjZXNzTnVtID0gMDtcclxuICAgIHRoaXMuYmF0Y2hDYW5jZWxOdW0uZXJyb3JOdW0gPSAwO1xyXG4gICAgdGhpcy5iYXRjaENhbmNlbEhlbHBGdW5jdGlvbihbLi4uZGF0YUlkc10sIGJpekRlZktleSwgKCkgPT4ge1xyXG4gICAgICBsb2FkLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QubmV4dCh0cnVlKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHN1YmplY3QuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmibnph4/lj5bmtojovoXliqnlh73mlbBcclxuICAgKi9cclxuICBwcml2YXRlIGJhdGNoQ2FuY2VsSGVscEZ1bmN0aW9uKGRhdGFJZHM6IHN0cmluZ1tdLCBiaXpEZWZLZXk6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pIHtcclxuICAgIGlmIChkYXRhSWRzICYmIGRhdGFJZHMubGVuZ3RoKSB7XHJcbiAgICAgIGNvbnN0IGRhdGFJZCA9IGRhdGFJZHMuc2hpZnQoKTsvL+W8leeUqOexu+Wei+i9rOaNolxyXG4gICAgICBsZXQgY2FuY2VsUGF5bG9hZCA9IG5ldyBDYW5jZWxTdWJtaXRQYXlsb2FkKCk7XHJcbiAgICAgIGNhbmNlbFBheWxvYWQuZGF0YUlkID0gZGF0YUlkO1xyXG4gICAgICBjYW5jZWxQYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgICAgdGhpcy50YXNrU2VydmljZS5jYW5jZWxTdWJtaXQoY2FuY2VsUGF5bG9hZCkuc3Vic2NyaWJlKCgpID0+IHsvL+WPlua2iOaIkOWKn1xyXG4gICAgICAgIHRoaXMuYmF0Y2hDYW5jZWxOdW0uc3VjY2Vzc051bSsrO1xyXG4gICAgICAgIHRoaXMuYmF0Y2hDYW5jZWxIZWxwRnVuY3Rpb24oZGF0YUlkcywgYml6RGVmS2V5LCBoYW5kbGVyKTtcclxuICAgICAgfSwgKCkgPT4gey8v5Y+W5raI5aSx6LSlXHJcbiAgICAgICAgdGhpcy5iYXRjaENhbmNlbE51bS5lcnJvck51bSsrO1xyXG4gICAgICAgIHRoaXMuYmF0Y2hDYW5jZWxIZWxwRnVuY3Rpb24oZGF0YUlkcywgYml6RGVmS2V5LCBoYW5kbGVyKTtcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2hvd0JhdGNoQ2FuY2VsU3VibWl0SW5mbyh0aGlzLmJhdGNoQ2FuY2VsTnVtLCBiaXpEZWZLZXkpO1xyXG4gICAgICBoYW5kbGVyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrZDooajmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gcGFyZW50RGF0YUlkIOS4u+ihqGlkXHJcbiAgICogQHBhcmFtIGNoaWxkRGF0YUlkIOWtkOihqGlkXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGNoaWxkU3VibWl0KHBhcmVudERhdGFJZDogc3RyaW5nLCBjaGlsZERhdGFJZDogc3RyaW5nLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIXBhcmVudERhdGFJZCB8fCAhY2hpbGREYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIHN0YXJ0UHJvY2Vzc1BheWxvYWQgPSBuZXcgU3RhcnRQcm9jZXNzUGF5bG9hZCgpO1xyXG4gICAgc3RhcnRQcm9jZXNzUGF5bG9hZC5kYXRhSWQgPSBgJHtwYXJlbnREYXRhSWR9LCR7Y2hpbGREYXRhSWR9YDtcclxuICAgIHN0YXJ0UHJvY2Vzc1BheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9jZXNzKHN0YXJ0UHJvY2Vzc1BheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5a2Q6KGo5Y+W5raI5o+Q5Lqk5a6h5om5XHJcbiAgICogQHBhcmFtIHBhcmVudERhdGFJZCDkuLvooahpZFxyXG4gICAqIEBwYXJhbSBjaGlsZERhdGFJZCDlrZDooahpZFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBjaGlsZENhbmNlbFN1Ym1pdChwYXJlbnREYXRhSWQ6IHN0cmluZywgY2hpbGREYXRhSWQ6IHN0cmluZywgYml6RGVmS2V5OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKCFwYXJlbnREYXRhSWQgfHwgIWNoaWxkRGF0YUlkKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciBjYW5jZWxTdWJtaXRQYXlsb2FkID0gbmV3IENhbmNlbFN1Ym1pdFBheWxvYWQoKTtcclxuICAgIGNhbmNlbFN1Ym1pdFBheWxvYWQuZGF0YUlkID0gYCR7cGFyZW50RGF0YUlkfSwke2NoaWxkRGF0YUlkfWA7XHJcbiAgICBjYW5jZWxTdWJtaXRQYXlsb2FkLmJpekRlZktleSA9IGJpekRlZktleTtcclxuICAgIHJldHVybiB0aGlzLmNhbmNlbFN1Ym1pdChjYW5jZWxTdWJtaXRQYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWtkOihqOaJuemHj+aPkOS6pOWuoeaJuVxyXG4gICAqIEBwYXJhbSBwYXJlbnREYXRhSWQg5Li76KGoaWRcclxuICAgKiBAcGFyYW0gY2hpbGREYXRhSWRzIOWtkOihqGlk6ZuG5ZCIXHJcbiAgICogQHBhcmFtIGJpekRlZktleSDlhaXlj6PljZXmja5pZFxyXG4gICAqL1xyXG4gIGNoaWxkQmF0Y2hTdWJtaXQocGFyZW50RGF0YUlkOiBzdHJpbmcsIGNoaWxkRGF0YUlkczogc3RyaW5nW10sIGJpekRlZktleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICghcGFyZW50RGF0YUlkIHx8ICFjaGlsZERhdGFJZHMpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWJpekRlZktleSkge1xyXG4gICAgICB0aGlzLm1lc3NhZ2UuZXJyb3IodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmJpekRlZktleUlzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0YUlkcyA9IGNoaWxkRGF0YUlkcy5tYXAoY2hpbGREYXRhSWQgPT4gYCR7cGFyZW50RGF0YUlkfSwke2NoaWxkRGF0YUlkfWApO1xyXG4gICAgcmV0dXJuIHRoaXMuYmF0Y2hTdWJtaXRXaXRoQml6RGVmS2V5KGRhdGFJZHMsIGJpekRlZktleSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlrZDooajmibnph4/lj5bmtojmj5DkuqTlrqHmiblcclxuICAgKiBAcGFyYW0gcGFyZW50RGF0YUlkIOS4u+ihqGlkXHJcbiAgICogQHBhcmFtIGNoaWxkRGF0YUlkcyDlrZDooahpZOmbhuWQiFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5YWl5Y+j5Y2V5o2uaWRcclxuICAgKi9cclxuICBjaGlsZEJhdGNoQ2FuY2VsU3VibWl0KHBhcmVudERhdGFJZDogc3RyaW5nLCBjaGlsZERhdGFJZHM6IHN0cmluZ1tdLCBiaXpEZWZLZXk6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAoIXBhcmVudERhdGFJZCB8fCAhY2hpbGREYXRhSWRzKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGRhdGFJZHMgPSBjaGlsZERhdGFJZHMubWFwKGNoaWxkRGF0YUlkID0+IGAke3BhcmVudERhdGFJZH0sJHtjaGlsZERhdGFJZH1gKTtcclxuICAgIHJldHVybiB0aGlzLmJhdGNoQ2FuY2VsU3VibWl0V2l0aERhdGFJZChkYXRhSWRzLCBiaXpEZWZLZXkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAqIOaJuemHj+aPkOS6pOaPkOekuuS/oeaBr1xyXG4gKiBAcGFyYW0gc3VjY2Vzc051bSDmiJDlip/mnaHmlbBcclxuICogQHBhcmFtIGZhaWxlZE51bSDpnIDopoHkuqTkupLnmoTmnaHmlbBcclxuICogQHBhcmFtIGVycm9yTnVtIOaJp+ihjOaKpemUmeeahOadoeaVsFxyXG4gKi9cclxuICBwcml2YXRlIHNob3dCYXRjaFN1Ym1pdEluZm8obnVtOiBCYXRjaFN1Ym1pdE51bWJlciwgYml6RGVmS2V5OiBzdHJpbmcpIHtcclxuICAgIGlmIChudW0uc3VjY2Vzc051bSAmJiAhbnVtLmZhaWxlZE51bSAmJiAhbnVtLmVycm9yTnVtKSB7Ly/mibnph4/lhajpg6jmiJDlip9cclxuICAgICAgdGhpcy50YXNrU2VydmljZS5nZXRUYXNrQ2VudGVyQ29uZmlnQnlDb2RlKENvbmZpZ0NvZGUuSW5mb19BZnRlcl9TdWJtaXQsIE93bmVyVHlwZS5CaXpEZWZLZXksIGJpekRlZktleSkuc3Vic2NyaWJlKChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmN1ckxhbmd1YWdlID09PSAnZW4nKSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKEpTT04ucGFyc2UoY29uZmlnLmN1cnJlbnRWYWx1ZSkuZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MoSlNPTi5wYXJzZShjb25maWcuY3VycmVudFZhbHVlKS56aF9DSFMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7Ly/pnZ7lhajpg6jmiJDlip9cclxuICAgICAgbGV0IG1lc3NhZ2UgPSAnJztcclxuICAgICAgbnVtLnN1Y2Nlc3NOdW0gJiYgKG1lc3NhZ2UgKz0gdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnYmF0Y2hTdGFydFByb2Nlc3Muc3VjY2VzcycpICsgYOOAkCR7bnVtLnN1Y2Nlc3NOdW1944CRYCArIHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbnVtLmVycm9yTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLmVycm9yJykgKyBg44CQJHtudW0uZXJyb3JOdW1944CRYCArIHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbnVtLmZhaWxlZE51bSAmJiAobWVzc2FnZSArPSB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdiYXRjaFN0YXJ0UHJvY2Vzcy5mYWlsZWQnKSArIGDjgJAke251bS5mYWlsZWROdW1944CRYCArIHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ2JhdGNoU3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbWVzc2FnZSArPSB0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdiYXRjaFN0YXJ0UHJvY2Vzcy5zaW5nbGUnKTtcclxuICAgICAgdGhpcy5tZXNzYWdlLnNob3coJ3dhcm5pbmcnLCBtZXNzYWdlLCB7IHNhZmVIdG1sOiBmYWxzZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaJuemHj+WPlua2iOaPkOS6pOaPkOekuuS/oeaBr1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2hvd0JhdGNoQ2FuY2VsU3VibWl0SW5mbyhudW06IEJhdGNoQ2FuY2VsTnVtYmVyLCBiaXpEZWZLZXk6IHN0cmluZykge1xyXG4gICAgaWYgKG51bS5zdWNjZXNzTnVtICYmICFudW0uZXJyb3JOdW0pIHsvL+aJuemHj+WFqOmDqOaIkOWKn1xyXG4gICAgICB0aGlzLnRhc2tTZXJ2aWNlLmdldFRhc2tDZW50ZXJDb25maWdCeUNvZGUoQ29uZmlnQ29kZS5JbmZvX0FmdGVyX0NhbmNlbF9TdWJtaXQsIE93bmVyVHlwZS5CaXpEZWZLZXksIGJpekRlZktleSkuc3Vic2NyaWJlKChjb25maWc6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmN1ckxhbmd1YWdlID09PSAnZW4nKSB7XHJcbiAgICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKEpTT04ucGFyc2UoY29uZmlnLmN1cnJlbnRWYWx1ZSkuZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIUycpIHtcclxuICAgICAgICAgIHRoaXMubm90aWZ5LnN1Y2Nlc3MoSlNPTi5wYXJzZShjb25maWcuY3VycmVudFZhbHVlKS56aF9DSFMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBtZXNzYWdlID0gJyc7XHJcbiAgICAgIG51bS5zdWNjZXNzTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5zdWNjZXNzJykgKyBg44CQJHtudW0uc3VjY2Vzc051bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgbnVtLmVycm9yTnVtICYmIChtZXNzYWdlICs9IHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5mYWlsZWQnKSArIGDjgJAke251bS5lcnJvck51bX3jgJFgICsgdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLnJvdycpKTtcclxuICAgICAgdGhpcy5tZXNzYWdlLnNob3coJ3dhcm5pbmcnLCBtZXNzYWdlLCB7IHNhZmVIdG1sOiBmYWxzZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZVN1Ym1pdE1lc3NhZ2UoY29kZTogc3RyaW5nLCBvd25lcklkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGxvYWQgPSB0aGlzLmxvYWRpbmcuc2hvdygpO1xyXG4gICAgdGhpcy50YXNrU2VydmljZS5nZXRUYXNrQ2VudGVyQ29uZmlnQnlDb2RlKGNvZGUsIE93bmVyVHlwZS5CaXpEZWZLZXksIG93bmVySWQpLnN1YnNjcmliZShyZSA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgaWYgKHJlICYmIHJlLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgIGxldCBtZXNzYWdlID0gJyc7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gSlNPTi5wYXJzZShyZS5jdXJyZW50VmFsdWUpO1xyXG4gICAgICAgIHRoaXMuY3VyTGFuZ3VhZ2UgPT09ICd6aC1DSFMnICYmIChtZXNzYWdlID0gY3VycmVudFZhbHVlLnpoX0NIUyk7XHJcbiAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9PT0gJ2VuJyAmJiAobWVzc2FnZSA9IGN1cnJlbnRWYWx1ZS5lbik7XHJcbiAgICAgICAgdGhpcy5jdXJMYW5ndWFnZSA9PT0gJ3poLUNIVCcgJiYgKG1lc3NhZ2UgPSBjdXJyZW50VmFsdWUuemhfQ0hUKTtcclxuICAgICAgICB0aGlzLm5vdGlmeS5zdWNjZXNzKG1lc3NhZ2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvZGUgPT09IENvbmZpZ0NvZGUuSW5mb19BZnRlcl9TdWJtaXQgJiYgdGhpcy5ub3RpZnkuc3VjY2Vzcyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3Muc3VibWl0U3VjY2VzcycpKTtcclxuICAgICAgICBjb2RlID09PSBDb25maWdDb2RlLkluZm9fQWZ0ZXJfQ2FuY2VsX1N1Ym1pdCAmJiB0aGlzLm5vdGlmeS5zdWNjZXNzKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5jYW5jZWxTdWJtaXRTdWNjZXNzJykpO1xyXG4gICAgICB9XHJcbiAgICB9LCBlcnJvciA9PiB7XHJcbiAgICAgIGxvYWQuY2xvc2UoKTtcclxuICAgICAgdGhpcy50YXNrU2VydmljZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6KGo5Y2V5LiK6Kem5Y+R5rWB56iL6aKE6Kej5p6Q5pON5L2cXHJcbiAgICog5bey5bCB6KOF5Li66KGo5Y2V55qE5ZG95Luk5pON5L2cXHJcbiAgICovXHJcbiAgcHJvY2Vzc1NpbXVsYXRlKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcclxuICAgIGNvbnN0IGdzcFdmRXZlbnRTZXJ2aWNlID0gKHdpbmRvdyBhcyBhbnkpLnBhcmVudC5nc3BXZkV2ZW50U2VydmljZTtcclxuICAgIGdzcFdmRXZlbnRTZXJ2aWNlLnNpbXVsYXRlKCgpID0+IHtcclxuICAgICAgc3ViamVjdC5uZXh0KHRydWUpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3ViamVjdC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOagueaNruWNleaNrmlk5p+l55yL5rWB56iL5Zu+XHJcbiAgICog5bey5bCB6KOF5Li66KGo5Y2V5ZG95Luk5ZKM5pON5L2cXHJcbiAgICovXHJcbiAgdmlld0Zsb3dDaGFydEJ5RGF0YUlkKGRhdGFJZDogc3RyaW5nKSB7XHJcbiAgICBpZiAoIWRhdGFJZCkge1xyXG4gICAgICB0aGlzLm5vdGlmeS53YXJuaW5nKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5kYXRhSWRJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuZmxvd2NoYXJ0U2VydmljZS52aWV3Rmxvd0NoYXJ0QnlEYXRhSWQoZGF0YUlkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOafpeeci+a1geeoi+Wbvu+8iOaWsO+8jOaUr+aMgemihOiniO+8iVxyXG4gICAqIOW3suWwgeijheS4uuihqOWNleWRveS7pOWSjOaTjeS9nFxyXG4gICAqIEBwYXJhbSBiaXpEZWZLZXkg5rWB56iL5YiG57G7aWRcclxuICAgKiBAcGFyYW0gZGF0YUlkIOihqOWNleaVsOaNrmlkXHJcbiAgICovXHJcbiAgdmlld0Zsb3dDaGFydFdpdGhGb3JlY2FzdChiaXpEZWZLZXk6IHN0cmluZywgZGF0YUlkOiBzdHJpbmcpIHtcclxuICAgIGlmICghZGF0YUlkKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5Lndhcm5pbmcodGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnc3RhcnRQcm9jZXNzLmRhdGFJZElzTnVsbCcpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFiaXpEZWZLZXkpIHtcclxuICAgICAgdGhpcy5tZXNzYWdlLmVycm9yKHRoaXMuaTE4blNlcnZpY2UuZ2V0VmFsdWUoJ3N0YXJ0UHJvY2Vzcy5iaXpEZWZLZXlJc051bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBwYXlsb2FkID0gbmV3IEZvcmVjYXN0UHJvY2Vzc1BheWxvYWQoKTtcclxuICAgIHBheWxvYWQuYml6RGVmS2V5ID0gYml6RGVmS2V5O1xyXG4gICAgcGF5bG9hZC5kYXRhSWQgPSBkYXRhSWQ7XHJcbiAgICB0aGlzLmZsb3djaGFydFNlcnZpY2Uudmlld1Byb2Nlc3MocGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmn6XnnIvlrqHmibnorrDlvZXvvIjlvLnmoYbvvIlcclxuICAgKiDlt7LlsIHoo4XkuLrooajljZXlkb3ku6RcclxuICAgKiBAcGFyYW0gZGF0YUlkIOihqOWNleaVsOaNrmlkXHJcbiAgICogQHBhcmFtIHN0eWxlIOWFtuS7luWPguaVsFxyXG4gICAqL1xyXG4gIHZpZXdBcHByb3ZhbExvZyhkYXRhSWQ6IHN0cmluZywgc3R5bGU6IHN0cmluZykge1xyXG4gICAgaWYgKCFkYXRhSWQpIHtcclxuICAgICAgdGhpcy5ub3RpZnkud2FybmluZyh0aGlzLmkxOG5TZXJ2aWNlLmdldFZhbHVlKCdzdGFydFByb2Nlc3MuZGF0YUlkSXNOdWxsJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXJhbWV0ZXJzID0ge1xyXG4gICAgICBkYXRhSWQ6IGRhdGFJZCxcclxuICAgICAgc3R5bGU6IHN0eWxlLFxyXG4gICAgfVxyXG4gICAgdGhpcy5sb2dTZXJ2aWNlLnNob3dBcHByb3ZhbExvZyhwYXJhbWV0ZXJzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPlueUqOaIt+eahOW4uOeUqOaEj+inge+8iOW3suaatOmcsue7mWZhcnJpc++8iVxyXG4gICAqIEByZXR1cm5zIOeUqOaIt+W4uOeUqOaEj+ingWxpc3RcclxuICAgKi9cclxuICBnZXRDb21tb25Db21tZW50cyhmaWx0ZXI6IENvbW1vbkNvbW1lbnRGaWx0ZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMudGFza1NlcnZpY2UuZ2V0Q29tbWVudExpc3QoZmlsdGVyKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWxleekuuW4uOeUqOaEj+ingeeuoeeQhmRpYWxvZ++8iOW3suaatOmcsue7mWZhcnJpc++8iVxyXG4gICAqL1xyXG4gIHNob3dDb21tZW50TWFuYWdlRGlhbG9nKGZpbHRlcjogQ29tbW9uQ29tbWVudEZpbHRlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgc3ViamVjdCA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgICBjb25zdCBjb21wRmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoQ29tbWVudE1hbmFnZUNvbXBvbmVudCk7XHJcbiAgICBjb25zdCBjb21wUmVmID0gY29tcEZhY3RvcnkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29uc3Qgb3B0aW9uczogTW9kYWxPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogdGhpcy5pMThuU2VydmljZS5nZXRWYWx1ZSgnY29tbWVudC5zdGF0aWMudGl0bGUnKSxcclxuICAgICAgd2lkdGg6IDc0MCxcclxuICAgICAgaGVpZ2h0OiA0NDAsXHJcbiAgICAgIHNob3dCdXR0b25zOiB0cnVlLFxyXG4gICAgICBidXR0b25zOiBjb21wUmVmLmluc3RhbmNlLmJ1dHRvbnNcclxuICAgIH1cclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuZmlsdGVyID0gZmlsdGVyO1xyXG4gICAgY29uc3QgZGlhbG9nID0gdGhpcy5tb2RhbFNlcnZpY2Uuc2hvdyhjb21wUmVmLCBvcHRpb25zKTtcclxuICAgIGNvbXBSZWYuaW5zdGFuY2UuZ2V0Q29uZmlybVNVYmplY3QoKS5zdWJzY3JpYmUocmUgPT4ge1xyXG4gICAgICBkaWFsb2cuY2xvc2UoKTtcclxuICAgICAgc3ViamVjdC5uZXh0KHJlKTtcclxuICAgIH0pO1xyXG4gICAgY29tcFJlZi5pbnN0YW5jZS5nZXRDYW5jZWxTdWJqZWN0KCkuc3Vic2NyaWJlKHJlID0+IHtcclxuICAgICAgZGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgIHN1YmplY3QubmV4dChyZSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBzdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
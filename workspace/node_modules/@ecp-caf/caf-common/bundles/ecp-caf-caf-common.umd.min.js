!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/router"),require("@angular/common"),require("@angular/common/http"),require("rxjs/operators"),require("@angular/core"),require("ngx-cookie-service")):"function"==typeof define&&define.amd?define("@ecp-caf/caf-common",["exports","@angular/router","@angular/common","@angular/common/http","rxjs/operators","@angular/core","ngx-cookie-service"],t):t((e["ecp-caf"]=e["ecp-caf"]||{},e["ecp-caf"]["caf-common"]={}),e.ng.router,e.ng.common,e.ng.common.http,e.rxjs.operators,e.ng.core,e.ngxCookieService)}(this,function(e,t,r,o,n,i,a){"use strict";var s=(c.decorators=[{type:i.NgModule,args:[{imports:[r.CommonModule,t.RouterModule],declarations:[],exports:[],providers:[],entryComponents:[]}]}],c);function c(){}var p=function E(){},u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function g(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var f,h=(g(l,f=p),l.prototype.getItem=function(e){var t=sessionStorage.getItem(e);return t?JSON.parse(t):null},l.prototype.setItem=function(e,t){try{return sessionStorage.setItem(e,JSON.stringify(t)),!0}catch(r){return!1}},l.prototype.removeItem=function(e){sessionStorage.removeItem(e)},l.prototype.clear=function(){sessionStorage.clear()},l.prototype.type=function(){return 1},l.prototype.isEnabled=function(){try{return sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),!0}catch(e){return!1}},l.decorators=[{type:i.Injectable}],l);function l(){return null!==f&&f.apply(this,arguments)||this}var y,d=(g(m,y=p),m.prototype.getItem=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null},m.prototype.setItem=function(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(r){return!1}},m.prototype.removeItem=function(e){localStorage.removeItem(e)},m.prototype.clear=function(){localStorage.clear()},m.prototype.type=function(){return 0},m.prototype.isEnabled=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},m.decorators=[{type:i.Injectable}],m);function m(){return null!==y&&y.apply(this,arguments)||this}var v=(S.prototype.getVariableFromWindow=function(e){for(var t=this.getTopWindow(),r=window;!r[e]&&r!==t;)r=r.parent;return r[e]},S.prototype.getArrayFromWindow=function(e){for(var t=this.getTopWindow(),r=window;(!r[e]||0===r[e].length)&&r!==t;)r=r.parent;return r[e]||[]},S.prototype.getTopWindow=function(){var e=window.self;try{for(;e.location.origin===e.parent.location.origin&&e!==e.parent&&!e.isRTFTopWin;)e=e.parent}catch(t){}return e},S.decorators=[{type:i.Injectable}],S.ctorParameters=function(){return[]},S);function S(){}var _,b=(g(I,_=p),I.prototype.getItem=function(e){var t=this.getGlobleCache(e);return t&&(this._data[e]=t),this._data[e]?this._data[e]:null},I.prototype.setItem=function(e,t){return this.setGlobleCache(e,t),this._data[e]=t,!0},I.prototype.removeItem=function(e){delete this._data[e]},I.prototype.clear=function(){this._data=[]},I.prototype.type=function(){return 2},I.prototype.isEnabled=function(){return!0},I.prototype.setGlobleCache=function(e,t){var r=this.windowSvc.getTopWindow();try{if(r.name){for(var o=!1,n=r.name.split("&|&"),i=0;i<n.length;i++)if(n[i]&&JSON.parse(n[i])[e]){r.name=r.name.replace(n[i],this.serializeData(e,t)),o=!0;break}o||(r.name+="&|&"+this.serializeData(e,t))}else r.name=this.serializeData(e,t)}catch(a){r.name=""}},I.prototype.getGlobleCache=function(e){var t=this.windowSvc.getTopWindow();try{var r=void 0;if(t.name)if(0<=t.name.indexOf("&|&"))for(var o=t.name.split("&|&"),n=0;n<o.length;n++){var i;if(o[n]&&(i=JSON.parse(o[n]))[e]){r=i[e].value,t.name=0===n?t.name.replace(o[n]+"&|&",""):t.name.replace("&|&"+o[n],"");break}}else(i=JSON.parse(t.name))[e]&&(r=i[e].value,t.name="");return r}catch(a){return t.name="",null}},I.prototype.serializeData=function(e,t){var r={};return r[e]={value:t},JSON.stringify(r)},I.decorators=[{type:i.Injectable}],I);function I(){var e=null!==_&&_.apply(this,arguments)||this;return e._data={},e.windowSvc=new v,e}var w=(C.prototype.set=function(e,t,r){var o=this._toStorageKey(e);return r=r||this._defaultOptions,!!this._storage.setItem(o,this._toStorageValue(t,r))&&(!this._isSystemKey(e)&&r.tag&&this._saveTag(r.tag,o),!0)},C.prototype.get=function(e){var t=this._storage.getItem(this._toStorageKey(e)),r=null;return t&&(this._validateStorageValue(t)?r=t.value:this.remove(e)),r},C.prototype.exists=function(e){return!!this.get(e)},C.prototype.remove=function(e){this._storage.removeItem(this._toStorageKey(e)),this._removeFromTag(this._toStorageKey(e))},C.prototype.removeAll=function(){this._storage.clear()},C.prototype.getTagData=function(e){var r=this,t=this.get(this._tagsStorageKey())||{},o={};return t[e]&&t[e].forEach(function(e){var t=r.get(r._fromStorageKey(e));t&&(o[r._fromStorageKey(e)]=t)}),o},C.prototype.useStorage=function(e){var t=new C(this._initStorage(e));return t.setGlobalPrefix(this._getCachePrefix()),t},C.prototype.removeTag=function(e){var t=this,r=this.get(this._tagsStorageKey())||{};r[e]&&(r[e].forEach(function(e){t._storage.removeItem(e)}),delete r[e],this.set(this._tagsStorageKey(),r))},C.prototype.setGlobalPrefix=function(e){this._prefix=e},C.prototype._validateStorage=function(){this._storage||(this._storage=this._initStorage(2)),this._storage.isEnabled()||(this._storage=this._initStorage(1))},C.prototype._removeFromTag=function(e){var t,r=this.get(this._tagsStorageKey())||{};for(var o in r)if(-1!==(t=r[o].indexOf(e))){r[o].splice(t,1),this.set(this._tagsStorageKey(),r);break}},C.prototype._initStorage=function(e){var t;switch(e){case 1:t=new h;break;case 0:t=new d;break;default:t=new b}return t},C.prototype._toStorageKey=function(e){return this._getCachePrefix()+e},C.prototype._fromStorageKey=function(e){return e.replace(this._getCachePrefix(),"")},C.prototype._toStorageValue=function(e,t){return{value:e,options:this._toStorageOptions(t)}},C.prototype._toStorageOptions=function(e){var t={};return t.expires=e.expires?e.expires:e.maxAge?Date.now()+1e3*e.maxAge:this._defaultOptions.expires,t.maxAge=e.maxAge?e.maxAge:this._defaultOptions.maxAge,t},C.prototype._validateStorageValue=function(e){return!!e.options.expires&&e.options.expires>Date.now()},C.prototype._isSystemKey=function(e){return-1!==[this._tagsStorageKey()].indexOf(e)},C.prototype._saveTag=function(e,t){var r=this.get(this._tagsStorageKey())||{};r[e]?r[e].push(t):r[e]=[t],this.set(this._tagsStorageKey(),r)},C.prototype._getCachePrefix=function(){return this._prefix},C.prototype._tagsStorageKey=function(){return"CacheService_tags"},C.decorators=[{type:i.Injectable}],C.ctorParameters=function(){return[{type:p,decorators:[{type:i.Optional}]}]},C);function C(e){this._storage=e,this._defaultOptions={expires:Number.MAX_VALUE,maxAge:Number.MAX_VALUE},this._prefix="CacheService",this._validateStorage()}var x=(K.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(t),o="";return r&&(o=r[2]),o},K.getQueryStringFromHash=function(e){var t=window.location.hash,r=t&&t.split("?");if(r&&1<r.length){var o=r[1].split("&");if(!o)return"";for(var n=void 0,i=0;i<o.length;i++)if(null!=(n=o[i].split("="))&&n[0]===e)return n[1];return""}return""},K.getCookieMapFromDoc=function(){var e=document.cookie&&document.cookie.split(";"),r=new Map;return e&&e.forEach(function(e){var t=e.split("=");r.set(t[0],t[1])}),r},K.getCommonVariables=function(){return K.getQueryStringFromHash("cvft")},K.matchCommonVariableKey=function(e){var t=e.split("=");if(!t||2!==t.length||!t[0])return!1;switch(t[0].toLowerCase()){case"funcid":case"appid":case"appentrance":case"apptype":return!0}return!1},K);function K(){}var T=(A.prototype.getUserSessionId=function(){return localStorage.getItem(this.SessionKey)||""},A.prototype.getCurrentSeesionId=function(t){if(t)return(r=this.getTabArray().find(function(e){return e.id===t}))&&(r.formToken||r.sessionId);var e=x.getQueryStringFromHash("cvft");if(!e){var r,o=x.getQueryStringFromHash("tabId");(r=this.getTabArray().find(function(e){return e.id===o}))&&(e=r.formToken||r.sessionId)}return e||this.getUserSessionId()},A.prototype.getFuncSessionId=function(t){var e=new Map,r=this.getTabArray().filter(function(e){return e.funcId===t});if(!r||0===r.length)return e;for(var o=0;o<r.length;o++)e.set(r[o].tabId,r[o].sessionId);return e},A.prototype.getAppSessionId=function(t,r){var e=new Map,o=this.getTabArray().filter(function(e){return e.appId===t&&e.appEntrance===r});if(!o||0===o.length)return e;for(var n=0;n<o.length;n++)e.set(o[n].tabId,o[n].sessionId);return e},A.prototype.setUserSessionId=function(e){localStorage.setItem(this.SessionKey,e),localStorage.setItem(this.SessionKeyForIde,e)},A.prototype.setFuncSessionId=function(e,t){this.getFuncSessionCache().set(e,t)},A.prototype.setAppSessionId=function(e,t,r){this.setFuncSessionId(e+"#"+t,r)},A.prototype.getFuncSessionCache=function(){return this.windowService.getVariableFromWindow(this.FuncSessionKey)},A.prototype.getTabArray=function(){return this.windowService.getArrayFromWindow("iframeTabarray")},A.decorators=[{type:i.Injectable}],A.ctorParameters=function(){return[]},A);function A(){this.SessionKey="session",this.SessionKeyForIde="sessionId",this.FuncSessionKey="FuncSession",window[this.FuncSessionKey]=window[this.FuncSessionKey]||new Map,this.windowService=new v}var F=(O.prototype.get=function(e){return this.request("Get",e,this.setHeader({}))},O.prototype.post=function(e,t){return this.request("Post",e,this.setHeader({body:t}))},O.prototype.put=function(e,t){return this.request("Put",e,this.setHeader({body:t}))},O.prototype["delete"]=function(e,t){return this.request("Delete",e,this.setHeader({body:t}))},O.prototype.patch=function(e,t){return this.request("Patch",e,this.setHeader({body:t}))},O.prototype.setHeader=function(e,t){e.headers={"Content-Type":"application/json"};var r=x.getCommonVariables();return r&&(e.headers["X-CAF-Runtime-CommonVariable"]=r),t&&(e.headers["X-CAF-Runtime-Context"]=t),e},O.prototype.request=function(e,t,r){return r.body&&"string"!=typeof r.body&&(r.body=JSON.stringify(r.body)),this.http.request(e,t,r).pipe(n.map(function(e){return e}))},O.prototype.request$=function(e,t,r){return this.http.request(e,t,r)},O.decorators=[{type:i.Injectable}],O.ctorParameters=function(){return[{type:o.HttpClient},{type:T}]},O);function O(e,t){this.http=e,this.sessionService=t}var j=(k.prototype.setLanguageCode=function(e){localStorage.setItem(this.languageKey,e)},k.prototype.getLanguageCode=function(){var e=this.cookieService&&this.cookieService.get(this.curLangugaeKey);return e=e||x.getCookieMapFromDoc().get(this.curLangugaeKey)||localStorage.getItem(this.languageKey)||"zh-CHS"},k.decorators=[{type:i.Injectable}],k.ctorParameters=function(){return[{type:a.CookieService}]},k);function k(e){this.cookieService=e,this.languageKey="languageCode",this.curLangugaeKey="caf_web_language"}var M=(P.prototype.setTabs=function(e){if(e&&0!==e.length){var t=this.deepClone(e);this.topWin[this.nameSpace][this.tabarrayKey]=t}},P.prototype.getTabs=function(){var e=this.topWin[this.nameSpace][this.tabarrayKey]||[];return e&&0!==e.length?this.deepClone(e):e},P.prototype.setActiveTab=function(t){var e=this.getTabs(),r=e.find(function(e){return e.active});if(t){if(0<e.length){var o=e.find(function(e){return e.id===t.id});if(o)if(r){if(r===o)return;r.active=!1,o.active=!0}else o.active=!0;else o=t,r&&(r.active=!1),o.active=!0,e.push(o);this.setTabs(e)}}else r&&(r.active=!1)},P.prototype.getActiveTab=function(){var e=this.getTabs(),t=e&&e.find(function(e){return e.active});return t&&{tabId:t.id,appType:t.appType,funcId:t.funcId,appId:t.appId,appEntrance:t.appEntrance,name:t.FuncName}},P.prototype.deepClone=function(e){var t;if("object"==typeof e)if(Array.isArray(e))for(var r in t=[],e)t.push(this.deepClone(e[r]));else if(null===e)t=null;else if(e.constructor===RegExp)t=e;else for(var r in t={},e)t[r]=this.deepClone(e[r]);else t=e;return t},P.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],P.ctorParameters=function(){return[]},P.ngInjectableDef=i.defineInjectable({factory:function(){return new P},token:P,providedIn:"root"}),P);function P(){this.nameSpace="gsp-rtf-tabarr-service",this.tabarrayKey="tab-arry",this.windowService=new v,this.topWin=this.windowService.getTopWindow(),this.topWin[this.nameSpace]=this.topWin[this.nameSpace]||{}}var W=(q.forRoot=function(){return{ngModule:q,providers:[w,{provide:p,useClass:b},F,T,j,v,M,a.CookieService]}},q.decorators=[{type:i.NgModule,args:[{imports:[r.CommonModule],declarations:[],exports:[],providers:[],entryComponents:[]}]}],q);function q(){}e.CommonUtil=x,e.CommonSharedModule=s,e.FrmCommonModule=W,e.CacheService=w,e.CacheStorageAbstract=p,e.CacheLocalStorage=d,e.CacheMemoryStorage=b,e.CacheSessionStorage=h,e.HttpService=F,e.SessionService=T,e.LanguageService=j,e.WindowVariableService=v,e.TabEntityService=M,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ecp-caf-caf-common.umd.min.js.map
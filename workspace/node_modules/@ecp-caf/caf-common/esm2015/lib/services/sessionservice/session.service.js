/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { WindowVariableService } from '../window-service/window-variable.service';
import { CommonUtil } from '../../utilities/common.utilities';
export class SessionService {
    constructor() {
        this.SessionKey = 'session';
        this.SessionKeyForIde = 'sessionId';
        this.FuncSessionKey = 'FuncSession';
        window[this.FuncSessionKey] = window[this.FuncSessionKey] || new Map();
        this.windowService = new WindowVariableService();
    }
    /**
     * 获取用户sessionid
     * @return {?}
     */
    getUserSessionId() {
        return localStorage.getItem(this.SessionKey) || '';
    }
    /**
     * 获取当前session 之前依赖router的方式改掉
     * 从url hash中获取query
     * N 栈为funcSession
     * J 栈为formToken
     * @param {?=} tabId
     * @return {?}
     */
    getCurrentSeesionId(tabId) {
        if (!!tabId) {
            /** @type {?} */
            const tab = this.getTabArray().find((/**
             * @param {?} t
             * @return {?}
             */
            t => t.id === tabId));
            return tab && (tab.formToken || tab.sessionId);
        }
        /** @type {?} */
        let ssid = CommonUtil.getQueryStringFromHash('cvft');
        if (!ssid) {
            /** @type {?} */
            const pageId = CommonUtil.getQueryStringFromHash('tabId');
            /** @type {?} */
            const tab = this.getTabArray().find((/**
             * @param {?} t
             * @return {?}
             */
            t => t.id === pageId));
            if (tab) {
                ssid = (tab.formToken || tab.sessionId);
            }
        }
        return ssid || this.getUserSessionId();
    }
    /**
     *
     * 获取功能的session(功能重复打开，会存在多个)
     * (1912 框架移除funcSession，接口作废)
     * @param {?} funcId
     * @return {?}
     */
    getFuncSessionId(funcId) {
        /** @type {?} */
        const ssMap = new Map();
        /** @type {?} */
        const tabs = this.getTabArray().filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.funcId === funcId));
        if (!tabs || tabs.length === 0) {
            return ssMap;
        }
        // tslint:disable-next-line: prefer-for-of
        for (let i = 0; i < tabs.length; i++) {
            ssMap.set(tabs[i].tabId, tabs[i].sessionId);
        }
        return ssMap;
    }
    /**
     * 获取应用session（应用重复打开会存在多个）
     * (1912 框架移除funcSession，接口作废)
     * @param {?} appId
     * @param {?} appEntrance
     * @return {?}
     */
    getAppSessionId(appId, appEntrance) {
        /** @type {?} */
        const ssMap = new Map();
        /** @type {?} */
        const tabs = this.getTabArray().filter((/**
         * @param {?} t
         * @return {?}
         */
        t => t.appId === appId && t.appEntrance === appEntrance));
        if (!tabs || tabs.length === 0) {
            return ssMap;
        }
        // tslint:disable-next-line: prefer-for-of
        for (let i = 0; i < tabs.length; i++) {
            ssMap.set(tabs[i].tabId, tabs[i].sessionId);
        }
        return ssMap;
    }
    /**
     * 设置用户sessionid
     * 只是用于N版
     * @param {?} ssid
     * @return {?}
     */
    setUserSessionId(ssid) {
        // todo框架修改之后，要和IDE同步
        localStorage.setItem(this.SessionKey, ssid);
        localStorage.setItem(this.SessionKeyForIde, ssid);
    }
    /**
     * 缓存当前功能的sessionid
     * (1912 框架移除funcSession，接口作废)
     * @param {?} key
     * @param {?} ssid
     * @return {?}
     */
    setFuncSessionId(key, ssid) {
        this.getFuncSessionCache().set(key, ssid);
    }
    /**
     * 缓存当前应用的sessionId
     * (1912 框架移除funcSession，接口作废)
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} ssid
     * @return {?}
     */
    setAppSessionId(appId, appEntrance, ssid) {
        this.setFuncSessionId(`${appId}#${appEntrance}`, ssid);
    }
    /**
     * @private
     * @return {?}
     */
    getFuncSessionCache() {
        /** @type {?} */
        const sessionValue = this.windowService.getVariableFromWindow(this.FuncSessionKey);
        return (/** @type {?} */ (sessionValue));
    }
    /**
     * @private
     * @return {?}
     */
    getTabArray() {
        /** @type {?} */
        const iframeTabarray = 'iframeTabarray';
        /** @type {?} */
        const iframArr = this.windowService.getArrayFromWindow(iframeTabarray);
        return iframArr;
    }
}
SessionService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
SessionService.ctorParameters = () => [];
if (false) {
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.SessionKey;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.SessionKeyForIde;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.FuncSessionKey;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.windowService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vzc2lvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVjcC1jYWYvY2FmLWNvbW1vbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9zZXNzaW9uc2VydmljZS9zZXNzaW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDbEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBSTlELE1BQU0sT0FBTyxjQUFjO0lBTXZCO1FBTFEsZUFBVSxHQUFHLFNBQVMsQ0FBQztRQUN2QixxQkFBZ0IsR0FBRyxXQUFXLENBQUM7UUFDL0IsbUJBQWMsR0FBRyxhQUFhLENBQUM7UUFJbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLElBQUksR0FBRyxFQUFrQixDQUFDO1FBQ3ZGLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxxQkFBcUIsRUFBRSxDQUFDO0lBQ3JELENBQUM7Ozs7O0lBS0QsZ0JBQWdCO1FBQ1osT0FBTyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDdkQsQ0FBQzs7Ozs7Ozs7O0lBUUQsbUJBQW1CLENBQUMsS0FBYztRQUM5QixJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUU7O2tCQUNILEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxLQUFLLEVBQUM7WUFDeEQsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUNsRDs7WUFD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QzNELENBQUM7Ozs7O0lBRU8sbUJBQW1COztjQUNqQixZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQ2xGLE9BQU8sbUJBQUEsWUFBWSxFQUF1QixDQUFDO0lBQy9DLENBQUM7Ozs7O0lBRU8sV0FBVzs7Y0FDVCxjQUFjLEdBQUcsZ0JBQWdCOztjQUNqQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUM7UUFDdEUsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQzs7O1lBL0dKLFVBQVU7Ozs7Ozs7OztJQUVQLG9DQUErQjs7Ozs7SUFDL0IsMENBQXVDOzs7OztJQUN2Qyx3Q0FBdUM7Ozs7O0lBQ3ZDLHVDQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgV2luZG93VmFyaWFibGVTZXJ2aWNlIH0gZnJvbSAnLi4vd2luZG93LXNlcnZpY2Uvd2luZG93LXZhcmlhYmxlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDb21tb25VdGlsIH0gZnJvbSAnLi4vLi4vdXRpbGl0aWVzL2NvbW1vbi51dGlsaXRpZXMnO1xyXG5cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFNlc3Npb25TZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgU2Vzc2lvbktleSA9ICdzZXNzaW9uJztcclxuICAgIHByaXZhdGUgU2Vzc2lvbktleUZvcklkZSA9ICdzZXNzaW9uSWQnO1xyXG4gICAgcHJpdmF0ZSBGdW5jU2Vzc2lvbktleSA9ICdGdW5jU2Vzc2lvbic7XHJcbiAgICBwcml2YXRlIHdpbmRvd1NlcnZpY2U6IFdpbmRvd1ZhcmlhYmxlU2VydmljZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB3aW5kb3dbdGhpcy5GdW5jU2Vzc2lvbktleV0gPSB3aW5kb3dbdGhpcy5GdW5jU2Vzc2lvbktleV0gfHwgbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcclxuICAgICAgICB0aGlzLndpbmRvd1NlcnZpY2UgPSBuZXcgV2luZG93VmFyaWFibGVTZXJ2aWNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bnlKjmiLdzZXNzaW9uaWRcclxuICAgICAqL1xyXG4gICAgZ2V0VXNlclNlc3Npb25JZCgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlNlc3Npb25LZXkpIHx8ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5b2T5YmNc2Vzc2lvbiDkuYvliY3kvp3otZZyb3V0ZXLnmoTmlrnlvI/mlLnmjolcclxuICAgICAqIOS7jnVybCBoYXNo5Lit6I635Y+WcXVlcnlcclxuICAgICAqIE4g5qCI5Li6ZnVuY1Nlc3Npb25cclxuICAgICAqIEog5qCI5Li6Zm9ybVRva2VuXHJcbiAgICAgKi9cclxuICAgIGdldEN1cnJlbnRTZWVzaW9uSWQodGFiSWQ/OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghIXRhYklkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhYiA9IHRoaXMuZ2V0VGFiQXJyYXkoKS5maW5kKHQgPT4gdC5pZCA9PT0gdGFiSWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGFiICYmICh0YWIuZm9ybVRva2VuIHx8IHRhYi5zZXNzaW9uSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc3NpZCA9IENvbW1vblV0aWwuZ2V0UXVlcnlTdHJpbmdGcm9tSGFzaCgnY3ZmdCcpO1xyXG4gICAgICAgIGlmICghc3NpZCkge1xyXG4gICAgICAgICAgICBjb25zdCBwYWdlSWQgPSBDb21tb25VdGlsLmdldFF1ZXJ5U3RyaW5nRnJvbUhhc2goJ3RhYklkJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhYiA9IHRoaXMuZ2V0VGFiQXJyYXkoKS5maW5kKHQgPT4gdC5pZCA9PT0gcGFnZUlkKTtcclxuICAgICAgICAgICAgaWYgKHRhYikge1xyXG4gICAgICAgICAgICAgICAgc3NpZCA9ICh0YWIuZm9ybVRva2VuIHx8IHRhYi5zZXNzaW9uSWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzc2lkIHx8IHRoaXMuZ2V0VXNlclNlc3Npb25JZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKipcclxuICAgICAqIOiOt+WPluWKn+iDveeahHNlc3Npb24o5Yqf6IO96YeN5aSN5omT5byA77yM5Lya5a2Y5Zyo5aSa5LiqKVxyXG4gICAgICogKDE5MTIg5qGG5p6256e76ZmkZnVuY1Nlc3Npb27vvIzmjqXlj6PkvZzlup8pXHJcbiAgICAgKi9cclxuICAgIGdldEZ1bmNTZXNzaW9uSWQoZnVuY0lkOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBzc01hcCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgY29uc3QgdGFicyA9IHRoaXMuZ2V0VGFiQXJyYXkoKS5maWx0ZXIodCA9PiB0LmZ1bmNJZCA9PT0gZnVuY0lkKTtcclxuICAgICAgICBpZiAoIXRhYnMgfHwgdGFicy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNzTWFwO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHByZWZlci1mb3Itb2ZcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhYnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgc3NNYXAuc2V0KHRhYnNbaV0udGFiSWQsIHRhYnNbaV0uc2Vzc2lvbklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzc01hcDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluW6lOeUqHNlc3Npb27vvIjlupTnlKjph43lpI3miZPlvIDkvJrlrZjlnKjlpJrkuKrvvIlcclxuICAgICAqICgxOTEyIOahhuaetuenu+mZpGZ1bmNTZXNzaW9u77yM5o6l5Y+j5L2c5bqfKVxyXG4gICAgICovXHJcbiAgICBnZXRBcHBTZXNzaW9uSWQoYXBwSWQ6IHN0cmluZywgYXBwRW50cmFuY2U6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IHNzTWFwID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcclxuICAgICAgICBjb25zdCB0YWJzID0gdGhpcy5nZXRUYWJBcnJheSgpLmZpbHRlcih0ID0+IHQuYXBwSWQgPT09IGFwcElkICYmIHQuYXBwRW50cmFuY2UgPT09IGFwcEVudHJhbmNlKTtcclxuICAgICAgICBpZiAoIXRhYnMgfHwgdGFicy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNzTWFwO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IHByZWZlci1mb3Itb2ZcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhYnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgc3NNYXAuc2V0KHRhYnNbaV0udGFiSWQsIHRhYnNbaV0uc2Vzc2lvbklkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNzTWFwO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u55So5oi3c2Vzc2lvbmlkXHJcbiAgICAgKiDlj6rmmK/nlKjkuo5O54mIXHJcbiAgICAgKi9cclxuICAgIHNldFVzZXJTZXNzaW9uSWQoc3NpZDogc3RyaW5nKSB7XHJcbiAgICAgICAgLy8gdG9kb+ahhuaetuS/ruaUueS5i+WQju+8jOimgeWSjElEReWQjOatpVxyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMuU2Vzc2lvbktleSwgc3NpZCk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5TZXNzaW9uS2V5Rm9ySWRlLCBzc2lkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOe8k+WtmOW9k+WJjeWKn+iDveeahHNlc3Npb25pZFxyXG4gICAgICogKDE5MTIg5qGG5p6256e76ZmkZnVuY1Nlc3Npb27vvIzmjqXlj6PkvZzlup8pXHJcbiAgICAgKi9cclxuICAgIHNldEZ1bmNTZXNzaW9uSWQoa2V5OiBzdHJpbmcsIHNzaWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuZ2V0RnVuY1Nlc3Npb25DYWNoZSgpLnNldChrZXksIHNzaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog57yT5a2Y5b2T5YmN5bqU55So55qEc2Vzc2lvbklkXHJcbiAgICAgKiAoMTkxMiDmoYbmnrbnp7vpmaRmdW5jU2Vzc2lvbu+8jOaOpeWPo+S9nOW6nylcclxuICAgICAqL1xyXG4gICAgc2V0QXBwU2Vzc2lvbklkKGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlOiBzdHJpbmcsIHNzaWQ6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMuc2V0RnVuY1Nlc3Npb25JZChgJHthcHBJZH0jJHthcHBFbnRyYW5jZX1gLCBzc2lkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEZ1bmNTZXNzaW9uQ2FjaGUoKTogTWFwPHN0cmluZywgc3RyaW5nPiB7XHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvblZhbHVlID0gdGhpcy53aW5kb3dTZXJ2aWNlLmdldFZhcmlhYmxlRnJvbVdpbmRvdyh0aGlzLkZ1bmNTZXNzaW9uS2V5KTtcclxuICAgICAgICByZXR1cm4gc2Vzc2lvblZhbHVlIGFzIE1hcDxzdHJpbmcsIHN0cmluZz47XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUYWJBcnJheSgpOiBhbnlbXSB7XHJcbiAgICAgICAgY29uc3QgaWZyYW1lVGFiYXJyYXkgPSAnaWZyYW1lVGFiYXJyYXknO1xyXG4gICAgICAgIGNvbnN0IGlmcmFtQXJyID0gdGhpcy53aW5kb3dTZXJ2aWNlLmdldEFycmF5RnJvbVdpbmRvdyhpZnJhbWVUYWJhcnJheSk7XHJcbiAgICAgICAgcmV0dXJuIGlmcmFtQXJyO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=
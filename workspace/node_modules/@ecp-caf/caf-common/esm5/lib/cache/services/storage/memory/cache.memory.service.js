/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { CacheStorageAbstract } from '../cache.storage.abstract.service';
import { WindowVariableService } from '../../../../services/window-service/window-variable.service';
/**
 * Service for storing data in local storage
 */
var CacheMemoryStorage = /** @class */ (function (_super) {
    tslib_1.__extends(CacheMemoryStorage, _super);
    function CacheMemoryStorage() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._data = {};
        _this.windowSvc = new WindowVariableService();
        return _this;
    }
    /**
     * @param {?} key
     * @return {?}
     */
    CacheMemoryStorage.prototype.getItem = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        /** @type {?} */
        var cache = this.getGlobleCache(key);
        if (cache) {
            this._data[key] = cache;
        }
        return this._data[key] ? this._data[key] : null;
    };
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    CacheMemoryStorage.prototype.setItem = /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        this.setGlobleCache(key, value);
        this._data[key] = value;
        return true;
    };
    /**
     * @param {?} key
     * @return {?}
     */
    CacheMemoryStorage.prototype.removeItem = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        delete this._data[key];
    };
    /**
     * @return {?}
     */
    CacheMemoryStorage.prototype.clear = /**
     * @return {?}
     */
    function () {
        this._data = [];
    };
    /**
     * @return {?}
     */
    CacheMemoryStorage.prototype.type = /**
     * @return {?}
     */
    function () {
        return 2 /* MEMORY */;
    };
    /**
     * @return {?}
     */
    CacheMemoryStorage.prototype.isEnabled = /**
     * @return {?}
     */
    function () {
        return true;
    };
    /**
     * @private
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    CacheMemoryStorage.prototype.setGlobleCache = /**
     * @private
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        /** @type {?} */
        var topWindow = this.windowSvc.getTopWindow();
        try {
            if (topWindow.name) {
                /** @type {?} */
                var exist = false;
                /** @type {?} */
                var ary = topWindow.name.split('&|&');
                // tslint:disable-next-line: prefer-for-of
                for (var i = 0; i < ary.length; i++) {
                    if (ary[i]) {
                        /** @type {?} */
                        var obj = JSON.parse(ary[i]);
                        if (obj[key]) {
                            topWindow.name = topWindow.name.replace(ary[i], this.serializeData(key, value));
                            exist = true;
                            break;
                        }
                    }
                }
                if (!exist) {
                    topWindow.name += '&|&' + this.serializeData(key, value);
                }
            }
            else {
                topWindow.name = this.serializeData(key, value);
            }
        }
        catch (_a) {
            topWindow.name = '';
        }
    };
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    CacheMemoryStorage.prototype.getGlobleCache = /**
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        /** @type {?} */
        var topWindow = this.windowSvc.getTopWindow();
        try {
            /** @type {?} */
            var result = void 0;
            if (topWindow.name) {
                if (topWindow.name.indexOf('&|&') >= 0) {
                    /** @type {?} */
                    var ary = topWindow.name.split('&|&');
                    for (var i = 0; i < ary.length; i++) {
                        if (ary[i]) {
                            /** @type {?} */
                            var obj = JSON.parse(ary[i]);
                            if (obj[key]) {
                                result = obj[key].value;
                                if (i === 0) {
                                    topWindow.name = topWindow.name.replace(ary[i] + '&|&', '');
                                }
                                else {
                                    topWindow.name = topWindow.name.replace('&|&' + ary[i], '');
                                }
                                break;
                            }
                        }
                    }
                }
                else {
                    /** @type {?} */
                    var obj = JSON.parse(topWindow.name);
                    if (obj[key]) {
                        result = obj[key].value;
                        topWindow.name = '';
                    }
                }
            }
            return result;
        }
        catch (_a) {
            topWindow.name = '';
            return null;
        }
    };
    /**
     * @private
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    CacheMemoryStorage.prototype.serializeData = /**
     * @private
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        /** @type {?} */
        var obj = {};
        obj[key] = {
            value: value
        };
        return JSON.stringify(obj);
    };
    CacheMemoryStorage.decorators = [
        { type: Injectable }
    ];
    return CacheMemoryStorage;
}(CacheStorageAbstract));
export { CacheMemoryStorage };
if (false) {
    /**
     * @type {?}
     * @private
     */
    CacheMemoryStorage.prototype._data;
    /**
     * @type {?}
     * @private
     */
    CacheMemoryStorage.prototype.windowSvc;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGUubWVtb3J5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWNwLWNhZi9jYWYtY29tbW9uLyIsInNvdXJjZXMiOlsibGliL2NhY2hlL3NlcnZpY2VzL3N0b3JhZ2UvbWVtb3J5L2NhY2hlLm1lbW9yeS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUd6RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw2REFBNkQsQ0FBQzs7OztBQUtwRztJQUN3Qyw4Q0FBb0I7SUFENUQ7UUFBQSxxRUE4R0M7UUEzR1MsV0FBSyxHQUEyQixFQUFFLENBQUM7UUFDbkMsZUFBUyxHQUFHLElBQUkscUJBQXFCLEVBQUUsQ0FBQzs7SUEwR2xELENBQUM7Ozs7O0lBeEdRLG9DQUFPOzs7O0lBQWQsVUFBZSxHQUFXOztZQUNsQixLQUFLLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7UUFDdEMsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUN6QjtRQUNELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2xELENBQUM7Ozs7OztJQUVNLG9DQUFPOzs7OztJQUFkLFVBQWUsR0FBVyxFQUFFLEtBQTRCO1FBQ3RELElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7SUFF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S0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2lDQUM3RDtxQ0FBTTtvQ0FDTCxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7aUNBQzdEO2dDQUNELE1BQU07NkJBQ1A7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7cUJBQU07O3dCQUNDLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7b0JBQ3RDLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO3dCQUNaLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO3dCQUN4QixTQUFTLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztxQkFDckI7aUJBQ0Y7YUFDRjtZQUVELE9BQU8sTUFBTSxDQUFDO1NBQ2Y7UUFBQyxXQUFNO1lBQ04sU0FBUyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7WUFDcEIsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7Ozs7Ozs7SUFFTywwQ0FBYTs7Ozs7O0lBQXJCLFVBQXNCLEdBQVcsRUFBRSxLQUFVOztZQUNyQyxHQUFHLEdBQUcsRUFBRTtRQUNkLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRztZQUNULEtBQUssT0FBQTtTQUNOLENBQUM7UUFFRixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7Z0JBNUdGLFVBQVU7O0lBOEdYLHlCQUFDO0NBQUEsQUE5R0QsQ0FDd0Msb0JBQW9CLEdBNkczRDtTQTdHWSxrQkFBa0I7Ozs7OztJQUU3QixtQ0FBMkM7Ozs7O0lBQzNDLHVDQUFnRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ2FjaGVTdG9yYWdlQWJzdHJhY3QgfSBmcm9tICcuLi9jYWNoZS5zdG9yYWdlLmFic3RyYWN0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDYWNoZVN0b3JhZ2VzRW51bSB9IGZyb20gJy4uLy4uLy4uL2VudW1zL2NhY2hlLnN0b3JhZ2VzLmVudW0nO1xyXG5pbXBvcnQgeyBTdG9yYWdlVmFsdWVJbnRlcmZhY2UgfSBmcm9tICcuLi8uLi8uLi9pbnRlcmZhY2VzL3N0b3JhZ2UudmFsdWUuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgV2luZG93VmFyaWFibGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2VydmljZXMvd2luZG93LXNlcnZpY2Uvd2luZG93LXZhcmlhYmxlLnNlcnZpY2UnO1xyXG5cclxuLyoqXHJcbiAqIFNlcnZpY2UgZm9yIHN0b3JpbmcgZGF0YSBpbiBsb2NhbCBzdG9yYWdlXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDYWNoZU1lbW9yeVN0b3JhZ2UgZXh0ZW5kcyBDYWNoZVN0b3JhZ2VBYnN0cmFjdCB7XHJcblxyXG4gIHByaXZhdGUgX2RhdGE6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcclxuICBwcml2YXRlIHdpbmRvd1N2YyA9IG5ldyBXaW5kb3dWYXJpYWJsZVNlcnZpY2UoKTtcclxuXHJcbiAgcHVibGljIGdldEl0ZW0oa2V5OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGNhY2hlID0gdGhpcy5nZXRHbG9ibGVDYWNoZShrZXkpO1xyXG4gICAgaWYgKGNhY2hlKSB7XHJcbiAgICAgIHRoaXMuX2RhdGFba2V5XSA9IGNhY2hlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX2RhdGFba2V5XSA/IHRoaXMuX2RhdGFba2V5XSA6IG51bGw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0SXRlbShrZXk6IHN0cmluZywgdmFsdWU6IFN0b3JhZ2VWYWx1ZUludGVyZmFjZSkge1xyXG4gICAgdGhpcy5zZXRHbG9ibGVDYWNoZShrZXksIHZhbHVlKTtcclxuICAgIHRoaXMuX2RhdGFba2V5XSA9IHZhbHVlO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVtb3ZlSXRlbShrZXk6IHN0cmluZykge1xyXG4gICAgZGVsZXRlIHRoaXMuX2RhdGFba2V5XTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbGVhcigpIHtcclxuICAgIHRoaXMuX2RhdGEgPSBbXTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB0eXBlKCkge1xyXG4gICAgcmV0dXJuIENhY2hlU3RvcmFnZXNFbnVtLk1FTU9SWTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0VuYWJsZWQoKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0R2xvYmxlQ2FjaGUoa2V5OiBhbnksIHZhbHVlOiBhbnkpIHtcclxuICAgIGNvbnN0IHRvcFdpbmRvdyA9IHRoaXMud2luZG93U3ZjLmdldFRvcFdpbmRvdygpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHRvcFdpbmRvdy5uYW1lKSB7XHJcbiAgICAgICAgbGV0IGV4aXN0ID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgYXJ5ID0gdG9wV2luZG93Lm5hbWUuc3BsaXQoJyZ8JicpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogcHJlZmVyLWZvci1vZlxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJ5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICBpZiAoYXJ5W2ldKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IEpTT04ucGFyc2UoYXJ5W2ldKTtcclxuICAgICAgICAgICAgaWYgKG9ialtrZXldKSB7XHJcbiAgICAgICAgICAgICAgdG9wV2luZG93Lm5hbWUgPSB0b3BXaW5kb3cubmFtZS5yZXBsYWNlKGFyeVtpXSwgdGhpcy5zZXJpYWxpemVEYXRhKGtleSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgICBleGlzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFleGlzdCkge1xyXG4gICAgICAgICAgdG9wV2luZG93Lm5hbWUgKz0gJyZ8JicgKyB0aGlzLnNlcmlhbGl6ZURhdGEoa2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdG9wV2luZG93Lm5hbWUgPSB0aGlzLnNlcmlhbGl6ZURhdGEoa2V5LCB2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICB0b3BXaW5kb3cubmFtZSA9ICcnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRHbG9ibGVDYWNoZShrZXk6IGFueSkge1xyXG4gICAgY29uc3QgdG9wV2luZG93ID0gdGhpcy53aW5kb3dTdmMuZ2V0VG9wV2luZG93KCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcmVzdWx0OiBhbnk7XHJcbiAgICAgIGlmICh0b3BXaW5kb3cubmFtZSkge1xyXG4gICAgICAgIGlmICh0b3BXaW5kb3cubmFtZS5pbmRleE9mKCcmfCYnKSA+PSAwKSB7XHJcbiAgICAgICAgICBjb25zdCBhcnkgPSB0b3BXaW5kb3cubmFtZS5zcGxpdCgnJnwmJyk7XHJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyeS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoYXJ5W2ldKSB7XHJcbiAgICAgICAgICAgICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZShhcnlbaV0pO1xyXG4gICAgICAgICAgICAgIGlmIChvYmpba2V5XSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gb2JqW2tleV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICB0b3BXaW5kb3cubmFtZSA9IHRvcFdpbmRvdy5uYW1lLnJlcGxhY2UoYXJ5W2ldICsgJyZ8JicsICcnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIHRvcFdpbmRvdy5uYW1lID0gdG9wV2luZG93Lm5hbWUucmVwbGFjZSgnJnwmJyArIGFyeVtpXSwgJycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IG9iaiA9IEpTT04ucGFyc2UodG9wV2luZG93Lm5hbWUpO1xyXG4gICAgICAgICAgaWYgKG9ialtrZXldKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IG9ialtrZXldLnZhbHVlO1xyXG4gICAgICAgICAgICB0b3BXaW5kb3cubmFtZSA9ICcnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICB0b3BXaW5kb3cubmFtZSA9ICcnO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2VyaWFsaXplRGF0YShrZXk6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gICAgY29uc3Qgb2JqID0ge307XHJcbiAgICBvYmpba2V5XSA9IHtcclxuICAgICAgdmFsdWVcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaik7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
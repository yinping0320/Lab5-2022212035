/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { WindowVariableService } from '../window-service/window-variable.service';
import { CommonUtil } from '../../utilities/common.utilities';
var SessionService = /** @class */ (function () {
    function SessionService() {
        this.SessionKey = 'session';
        this.SessionKeyForIde = 'sessionId';
        this.FuncSessionKey = 'FuncSession';
        window[this.FuncSessionKey] = window[this.FuncSessionKey] || new Map();
        this.windowService = new WindowVariableService();
    }
    /**
     * 获取用户sessionid
     */
    /**
     * 获取用户sessionid
     * @return {?}
     */
    SessionService.prototype.getUserSessionId = /**
     * 获取用户sessionid
     * @return {?}
     */
    function () {
        return localStorage.getItem(this.SessionKey) || '';
    };
    /**
     * 获取当前session 之前依赖router的方式改掉
     * 从url hash中获取query
     * N 栈为funcSession
     * J 栈为formToken
     */
    /**
     * 获取当前session 之前依赖router的方式改掉
     * 从url hash中获取query
     * N 栈为funcSession
     * J 栈为formToken
     * @param {?=} tabId
     * @return {?}
     */
    SessionService.prototype.getCurrentSeesionId = /**
     * 获取当前session 之前依赖router的方式改掉
     * 从url hash中获取query
     * N 栈为funcSession
     * J 栈为formToken
     * @param {?=} tabId
     * @return {?}
     */
    function (tabId) {
        if (!!tabId) {
            /** @type {?} */
            var tab = this.getTabArray().find((/**
             * @param {?} t
             * @return {?}
             */
            function (t) { return t.id === tabId; }));
            return tab && (tab.formToken || tab.sessionId);
        }
        /** @type {?} */
        var ssid = CommonUtil.getQueryStringFromHash('cvft');
        if (!ssid) {
            /** @type {?} */
            var pageId_1 = CommonUtil.getQueryStringFromHash('tabId');
            /** @type {?} */
            var tab = this.getTabArray().find((/**
             * @param {?} t
             * @return {?}
             */
            function (t) { return t.id === pageId_1; }));
            if (tab) {
                ssid = (tab.formToken || tab.sessionId);
            }
        }
        return ssid || this.getUserSessionId();
    };
    /***
     * 获取功能的session(功能重复打开，会存在多个)
     * (1912 框架移除funcSession，接口作废)
     */
    /**
     *
     * 获取功能的session(功能重复打开，会存在多个)
     * (1912 框架移除funcSession，接口作废)
     * @param {?} funcId
     * @return {?}
     */
    SessionService.prototype.getFuncSessionId = /**
     *
     * 获取功能的session(功能重复打开，会存在多个)
     * (1912 框架移除funcSession，接口作废)
     * @param {?} funcId
     * @return {?}
     */
    function (funcId) {
        /** @type {?} */
        var ssMap = new Map();
        /** @type {?} */
        var tabs = this.getTabArray().filter((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.funcId === funcId; }));
        if (!tabs || tabs.length === 0) {
            return ssMap;
        }
        // tslint:disable-next-line: prefer-for-of
        for (var i = 0; i < tabs.length; i++) {
            ssMap.set(tabs[i].tabId, tabs[i].sessionId);
        }
        return ssMap;
    };
    /**
     * 获取应用session（应用重复打开会存在多个）
     * (1912 框架移除funcSession，接口作废)
     */
    /**
     * 获取应用session（应用重复打开会存在多个）
     * (1912 框架移除funcSession，接口作废)
     * @param {?} appId
     * @param {?} appEntrance
     * @return {?}
     */
    SessionService.prototype.getAppSessionId = /**
     * 获取应用session（应用重复打开会存在多个）
     * (1912 框架移除funcSession，接口作废)
     * @param {?} appId
     * @param {?} appEntrance
     * @return {?}
     */
    function (appId, appEntrance) {
        /** @type {?} */
        var ssMap = new Map();
        /** @type {?} */
        var tabs = this.getTabArray().filter((/**
         * @param {?} t
         * @return {?}
         */
        function (t) { return t.appId === appId && t.appEntrance === appEntrance; }));
        if (!tabs || tabs.length === 0) {
            return ssMap;
        }
        // tslint:disable-next-line: prefer-for-of
        for (var i = 0; i < tabs.length; i++) {
            ssMap.set(tabs[i].tabId, tabs[i].sessionId);
        }
        return ssMap;
    };
    /**
     * 设置用户sessionid
     * 只是用于N版
     */
    /**
     * 设置用户sessionid
     * 只是用于N版
     * @param {?} ssid
     * @return {?}
     */
    SessionService.prototype.setUserSessionId = /**
     * 设置用户sessionid
     * 只是用于N版
     * @param {?} ssid
     * @return {?}
     */
    function (ssid) {
        // todo框架修改之后，要和IDE同步
        localStorage.setItem(this.SessionKey, ssid);
        localStorage.setItem(this.SessionKeyForIde, ssid);
    };
    /**
     * 缓存当前功能的sessionid
     * (1912 框架移除funcSession，接口作废)
     */
    /**
     * 缓存当前功能的sessionid
     * (1912 框架移除funcSession，接口作废)
     * @param {?} key
     * @param {?} ssid
     * @return {?}
     */
    SessionService.prototype.setFuncSessionId = /**
     * 缓存当前功能的sessionid
     * (1912 框架移除funcSession，接口作废)
     * @param {?} key
     * @param {?} ssid
     * @return {?}
     */
    function (key, ssid) {
        this.getFuncSessionCache().set(key, ssid);
    };
    /**
     * 缓存当前应用的sessionId
     * (1912 框架移除funcSession，接口作废)
     */
    /**
     * 缓存当前应用的sessionId
     * (1912 框架移除funcSession，接口作废)
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} ssid
     * @return {?}
     */
    SessionService.prototype.setAppSessionId = /**
     * 缓存当前应用的sessionId
     * (1912 框架移除funcSession，接口作废)
     * @param {?} appId
     * @param {?} appEntrance
     * @param {?} ssid
     * @return {?}
     */
    function (appId, appEntrance, ssid) {
        this.setFuncSessionId(appId + "#" + appEntrance, ssid);
    };
    /**
     * @private
     * @return {?}
     */
    SessionService.prototype.getFuncSessionCache = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var sessionValue = this.windowService.getVariableFromWindow(this.FuncSessionKey);
        return (/** @type {?} */ (sessionValue));
    };
    /**
     * @private
     * @return {?}
     */
    SessionService.prototype.getTabArray = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var iframeTabarray = 'iframeTabarray';
        /** @type {?} */
        var iframArr = this.windowService.getArrayFromWindow(iframeTabarray);
        return iframArr;
    };
    SessionService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    SessionService.ctorParameters = function () { return []; };
    return SessionService;
}());
export { SessionService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.SessionKey;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.SessionKeyForIde;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.FuncSessionKey;
    /**
     * @type {?}
     * @private
     */
    SessionService.prototype.windowService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vzc2lvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGVjcC1jYWYvY2FmLWNvbW1vbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9zZXNzaW9uc2VydmljZS9zZXNzaW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDbEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRzlEO0lBT0k7UUFMUSxlQUFVLEdBQUcsU0FBUyxDQUFDO1FBQ3ZCLHFCQUFnQixHQUFHLFdBQVcsQ0FBQztRQUMvQixtQkFBYyxHQUFHLGFBQWEsQ0FBQztRQUluQyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksSUFBSSxHQUFHLEVBQWtCLENBQUM7UUFDdkYsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLHFCQUFxQixFQUFFLENBQUM7SUFDckQsQ0FBQztJQUVEOztPQUVHOzs7OztJQUNILHlDQUFnQjs7OztJQUFoQjtRQUNJLE9BQU8sWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZELENBQUM7SUFFRDs7Ozs7T0FLRzs7Ozs7Ozs7O0lBQ0gsNENBQW1COzs7Ozs7OztJQUFuQixVQUFvQixLQUFjO1FBQzlCLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRTs7Z0JBQ0gsR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssRUFBZCxDQUFjLEVBQUM7WUFDeEQsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FB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Q0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRDs7O09BR0c7Ozs7Ozs7OztJQUNILHdDQUFlOzs7Ozs7OztJQUFmLFVBQWdCLEtBQWEsRUFBRSxXQUFtQixFQUFFLElBQVk7UUFDNUQsSUFBSSxDQUFDLGdCQUFnQixDQUFJLEtBQUssU0FBSSxXQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDM0QsQ0FBQzs7Ozs7SUFFTyw0Q0FBbUI7Ozs7SUFBM0I7O1lBQ1UsWUFBWSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUNsRixPQUFPLG1CQUFBLFlBQVksRUFBdUIsQ0FBQztJQUMvQyxDQUFDOzs7OztJQUVPLG9DQUFXOzs7O0lBQW5COztZQUNVLGNBQWMsR0FBRyxnQkFBZ0I7O1lBQ2pDLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQztRQUN0RSxPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDOztnQkEvR0osVUFBVTs7OztJQWlIWCxxQkFBQztDQUFBLEFBakhELElBaUhDO1NBaEhZLGNBQWM7Ozs7OztJQUN2QixvQ0FBK0I7Ozs7O0lBQy9CLDBDQUF1Qzs7Ozs7SUFDdkMsd0NBQXVDOzs7OztJQUN2Qyx1Q0FBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFdpbmRvd1ZhcmlhYmxlU2VydmljZSB9IGZyb20gJy4uL3dpbmRvdy1zZXJ2aWNlL3dpbmRvdy12YXJpYWJsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tbW9uVXRpbCB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9jb21tb24udXRpbGl0aWVzJztcclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBTZXNzaW9uU2VydmljZSB7XHJcbiAgICBwcml2YXRlIFNlc3Npb25LZXkgPSAnc2Vzc2lvbic7XHJcbiAgICBwcml2YXRlIFNlc3Npb25LZXlGb3JJZGUgPSAnc2Vzc2lvbklkJztcclxuICAgIHByaXZhdGUgRnVuY1Nlc3Npb25LZXkgPSAnRnVuY1Nlc3Npb24nO1xyXG4gICAgcHJpdmF0ZSB3aW5kb3dTZXJ2aWNlOiBXaW5kb3dWYXJpYWJsZVNlcnZpY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgd2luZG93W3RoaXMuRnVuY1Nlc3Npb25LZXldID0gd2luZG93W3RoaXMuRnVuY1Nlc3Npb25LZXldIHx8IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgdGhpcy53aW5kb3dTZXJ2aWNlID0gbmV3IFdpbmRvd1ZhcmlhYmxlU2VydmljZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W55So5oi3c2Vzc2lvbmlkXHJcbiAgICAgKi9cclxuICAgIGdldFVzZXJTZXNzaW9uSWQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5TZXNzaW9uS2V5KSB8fCAnJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluW9k+WJjXNlc3Npb24g5LmL5YmN5L6d6LWWcm91dGVy55qE5pa55byP5pS55o6JXHJcbiAgICAgKiDku451cmwgaGFzaOS4reiOt+WPlnF1ZXJ5XHJcbiAgICAgKiBOIOagiOS4umZ1bmNTZXNzaW9uXHJcbiAgICAgKiBKIOagiOS4umZvcm1Ub2tlblxyXG4gICAgICovXHJcbiAgICBnZXRDdXJyZW50U2Vlc2lvbklkKHRhYklkPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICBpZiAoISF0YWJJZCkge1xyXG4gICAgICAgICAgICBjb25zdCB0YWIgPSB0aGlzLmdldFRhYkFycmF5KCkuZmluZCh0ID0+IHQuaWQgPT09IHRhYklkKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhYiAmJiAodGFiLmZvcm1Ub2tlbiB8fCB0YWIuc2Vzc2lvbklkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHNzaWQgPSBDb21tb25VdGlsLmdldFF1ZXJ5U3RyaW5nRnJvbUhhc2goJ2N2ZnQnKTtcclxuICAgICAgICBpZiAoIXNzaWQpIHtcclxuICAgICAgICAgICAgY29uc3QgcGFnZUlkID0gQ29tbW9uVXRpbC5nZXRRdWVyeVN0cmluZ0Zyb21IYXNoKCd0YWJJZCcpO1xyXG4gICAgICAgICAgICBjb25zdCB0YWIgPSB0aGlzLmdldFRhYkFycmF5KCkuZmluZCh0ID0+IHQuaWQgPT09IHBhZ2VJZCk7XHJcbiAgICAgICAgICAgIGlmICh0YWIpIHtcclxuICAgICAgICAgICAgICAgIHNzaWQgPSAodGFiLmZvcm1Ub2tlbiB8fCB0YWIuc2Vzc2lvbklkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3NpZCB8fCB0aGlzLmdldFVzZXJTZXNzaW9uSWQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKioqXHJcbiAgICAgKiDojrflj5blip/og73nmoRzZXNzaW9uKOWKn+iDvemHjeWkjeaJk+W8gO+8jOS8muWtmOWcqOWkmuS4qilcclxuICAgICAqICgxOTEyIOahhuaetuenu+mZpGZ1bmNTZXNzaW9u77yM5o6l5Y+j5L2c5bqfKVxyXG4gICAgICovXHJcbiAgICBnZXRGdW5jU2Vzc2lvbklkKGZ1bmNJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc3NNYXAgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xyXG4gICAgICAgIGNvbnN0IHRhYnMgPSB0aGlzLmdldFRhYkFycmF5KCkuZmlsdGVyKHQgPT4gdC5mdW5jSWQgPT09IGZ1bmNJZCk7XHJcbiAgICAgICAgaWYgKCF0YWJzIHx8IHRhYnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzc01hcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBwcmVmZXItZm9yLW9mXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHNzTWFwLnNldCh0YWJzW2ldLnRhYklkLCB0YWJzW2ldLnNlc3Npb25JZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3NNYXA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blupTnlKhzZXNzaW9u77yI5bqU55So6YeN5aSN5omT5byA5Lya5a2Y5Zyo5aSa5Liq77yJXHJcbiAgICAgKiAoMTkxMiDmoYbmnrbnp7vpmaRmdW5jU2Vzc2lvbu+8jOaOpeWPo+S9nOW6nylcclxuICAgICAqL1xyXG4gICAgZ2V0QXBwU2Vzc2lvbklkKGFwcElkOiBzdHJpbmcsIGFwcEVudHJhbmNlOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBzc01hcCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcbiAgICAgICAgY29uc3QgdGFicyA9IHRoaXMuZ2V0VGFiQXJyYXkoKS5maWx0ZXIodCA9PiB0LmFwcElkID09PSBhcHBJZCAmJiB0LmFwcEVudHJhbmNlID09PSBhcHBFbnRyYW5jZSk7XHJcbiAgICAgICAgaWYgKCF0YWJzIHx8IHRhYnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzc01hcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBwcmVmZXItZm9yLW9mXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHNzTWFwLnNldCh0YWJzW2ldLnRhYklkLCB0YWJzW2ldLnNlc3Npb25JZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzc01hcDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9rueUqOaIt3Nlc3Npb25pZFxyXG4gICAgICog5Y+q5piv55So5LqOTueJiFxyXG4gICAgICovXHJcbiAgICBzZXRVc2VyU2Vzc2lvbklkKHNzaWQ6IHN0cmluZykge1xyXG4gICAgICAgIC8vIHRvZG/moYbmnrbkv67mlLnkuYvlkI7vvIzopoHlkoxJREXlkIzmraVcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLlNlc3Npb25LZXksIHNzaWQpO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMuU2Vzc2lvbktleUZvcklkZSwgc3NpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnvJPlrZjlvZPliY3lip/og73nmoRzZXNzaW9uaWRcclxuICAgICAqICgxOTEyIOahhuaetuenu+mZpGZ1bmNTZXNzaW9u77yM5o6l5Y+j5L2c5bqfKVxyXG4gICAgICovXHJcbiAgICBzZXRGdW5jU2Vzc2lvbklkKGtleTogc3RyaW5nLCBzc2lkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmdldEZ1bmNTZXNzaW9uQ2FjaGUoKS5zZXQoa2V5LCBzc2lkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOe8k+WtmOW9k+WJjeW6lOeUqOeahHNlc3Npb25JZFxyXG4gICAgICogKDE5MTIg5qGG5p6256e76ZmkZnVuY1Nlc3Npb27vvIzmjqXlj6PkvZzlup8pXHJcbiAgICAgKi9cclxuICAgIHNldEFwcFNlc3Npb25JZChhcHBJZDogc3RyaW5nLCBhcHBFbnRyYW5jZTogc3RyaW5nLCBzc2lkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnNldEZ1bmNTZXNzaW9uSWQoYCR7YXBwSWR9IyR7YXBwRW50cmFuY2V9YCwgc3NpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRGdW5jU2Vzc2lvbkNhY2hlKCk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb25WYWx1ZSA9IHRoaXMud2luZG93U2VydmljZS5nZXRWYXJpYWJsZUZyb21XaW5kb3codGhpcy5GdW5jU2Vzc2lvbktleSk7XHJcbiAgICAgICAgcmV0dXJuIHNlc3Npb25WYWx1ZSBhcyBNYXA8c3RyaW5nLCBzdHJpbmc+O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VGFiQXJyYXkoKTogYW55W10ge1xyXG4gICAgICAgIGNvbnN0IGlmcmFtZVRhYmFycmF5ID0gJ2lmcmFtZVRhYmFycmF5JztcclxuICAgICAgICBjb25zdCBpZnJhbUFyciA9IHRoaXMud2luZG93U2VydmljZS5nZXRBcnJheUZyb21XaW5kb3coaWZyYW1lVGFiYXJyYXkpO1xyXG4gICAgICAgIHJldHVybiBpZnJhbUFycjtcclxuICAgIH1cclxuXHJcbn1cclxuIl19
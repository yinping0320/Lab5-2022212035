!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("rxjs/Observable"),require("@farris/ui-modal"),require("@farris/rtf"),require("@angular/platform-browser"),require("@farris/ui-common"),require("rxjs"),require("rxjs/operators"),require("@farris/ui-messager"),require("lodash-es"),require("@angular/forms"),require("@farris/ui-dialog"),require("@farris/ui-lookup"),require("@farris/ui-multi-select"),require("@farris/ui-field-group"),require("@farris/ui-input-group"),require("@farris/ui-dropdown"),require("@farris/ui-notify"),require("@farris/ui-loading"),require("@angular/common/http"),require("@farris/ui-datagrid"),require("@farris/ui-tooltip"),require("@farris/component-querycondition"),require("@farris/ui-common/date"),require("@farris/ui-common/number"),require("@farris/ui-locale"),require("@angular/core"),require("resize-observer-polyfill"),require("@farris/ui-forms"),require("@farris/ui-organization-selector"),require("@farris/ui-language-textbox")):"function"==typeof define&&define.amd?define("@gsp-cmp/querysolution",["exports","@angular/common","rxjs/Observable","@farris/ui-modal","@farris/rtf","@angular/platform-browser","@farris/ui-common","rxjs","rxjs/operators","@farris/ui-messager","lodash-es","@angular/forms","@farris/ui-dialog","@farris/ui-lookup","@farris/ui-multi-select","@farris/ui-field-group","@farris/ui-input-group","@farris/ui-dropdown","@farris/ui-notify","@farris/ui-loading","@angular/common/http","@farris/ui-datagrid","@farris/ui-tooltip","@farris/component-querycondition","@farris/ui-common/date","@farris/ui-common/number","@farris/ui-locale","@angular/core","resize-observer-polyfill","@farris/ui-forms","@farris/ui-organization-selector","@farris/ui-language-textbox"],t):t((e["gsp-cmp"]=e["gsp-cmp"]||{},e["gsp-cmp"].querysolution={}),e.ng.common,e.rxjs.Observable,e.uiModal,e.rtf,e.ng.platformBrowser,e.uiCommon,e.rxjs,e.rxjs.operators,e.uiMessager,e.lodashEs,e.ng.forms,e.uiDialog,e.uiLookup,e.uiMultiSelect,e.uiFieldGroup,e.uiInputGroup,e.uiDropdown,e.uiNotify,e.uiLoading,e.ng.common.http,e.uiDatagrid,e.uiTooltip,e.componentQuerycondition,e.date,e.number,e.uiLocale,e.ng.core,e.ResizeObserver,e.uiForms,e.uiOrganizationSelector,e.uiLanguageTextbox)}(this,function(e,t,s,o,i,c,d,h,n,p,y,r,l,a,u,f,g,m,S,v,C,b,q,w,V,D,I,A,x,F,Q,k){"use strict";function E(i,n){var r,s,l,e,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function o(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(l=2&e[0]?s["return"]:e[0]?s["throw"]||((l=s["return"])&&l.call(s),0):s.next)&&!(l=l.call(s,e[1])).done)return l;switch(s=0,l&&(e=[2&e[0],l.value]),e[0]){case 0:case 1:l=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,s=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(l=0<(l=a.trys).length&&l[l.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!l||e[1]>l[0]&&e[1]<l[3])){a.label=e[1];break}if(6===e[0]&&a.label<l[1]){a.label=l[1],l=e;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(e);break}l[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(i,a)}catch(t){e=[6,t],s=0}finally{r=l=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}function O(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var i,n,r=o.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=r.next()).done;)s.push(i.value)}catch(l){n={error:l}}finally{try{i&&!i.done&&(o=r["return"])&&o.call(r)}finally{if(n)throw n.error}}return s}function T(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(O(arguments[t]));return e}x=x&&x.hasOwnProperty("default")?x["default"]:x;var H=(M.prototype.create=function(e,t){var o={headers:new C.HttpHeaders({"Content-Type":"application/json",sessionid:t}),sessionid:t},i=(new w.QuerySolutionVoConvertor).convertJObject(e);return this.http.post(this.url,i,o)},M.prototype.query=function(e,t){var o={headers:new C.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=e,n=this.url+"/belongId/"+i;return this.http.get(n,o)},M.prototype.update=function(e,t){var o={headers:new C.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=(new w.QuerySolutionVoConvertor).convertJObject(e);return this.http.put(this.url,i,o)},M.prototype.batchUpdate=function(e,t){var o={headers:new C.HttpHeaders({"Content-Type":"application/json",sessionid:t}),sessionid:t},i=this.url+"/batch";return this.http.put(i,e,o)},M.prototype.supportLS=function(){return!!window.hasOwnProperty("localStorage")},M.prototype.setLS=function(e,t){var o="[]";if(t)if("string"==typeof t)o=t;else{var i=new w.QuerySolutionVoConvertor;o=JSON.stringify(i.formatConvertJObject(t))}e&&this.supportLS&&localStorage.setItem(e,o)},M.prototype.getLS=function(e){var t=new Array;if(e&&this.supportLS){var o=localStorage.getItem(e);o==undefined&&null===o||(t=JSON.parse(o))}return 0<t.length?(new w.QuerySolutionVoConvertor).formatFromJobject(t):t},M.prototype.saveHistroy=function(e,t){var o={headers:new C.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=(new w.QuerySolutionVoConvertor).convertJObject(e);return this.http.put(this.histroyUrl,i,o)},M.prototype.getAuth=function(e,t){var o={headers:new C.HttpHeaders({"Content-Type":"application/json",sessionid:t})},i=this.url+"/componentType/"+e;return this.http.get(i,o)},M.decorators=[{type:A.Injectable}],M.ctorParameters=function(){return[{type:C.HttpClient}]},M);function M(e){this.http=e,this.histroyUrl="/api/runtime/sys/v1.0/querysolution/previousQuery",this.url="/api/runtime/sys/v1.0/querysolution",this.histroyUrl=i.BasePathService.convertPath(this.histroyUrl),this.url=i.BasePathService.convertPath(this.url)}var L=(j.decorators=[{type:A.Injectable}],j);function j(){}var R=new A.InjectionToken("gsp-cmp/I_QUERYSOLUTION_HANDLER"),P=(_.clearSolutionCache=function(){_.solutionListCache={}},_.removeSolutionCache=function(e){delete _.solutionListCache[e]},_.setSolutionCache=function(e,t){_.solutionListCache[e]=t},_.getSolutionCache=function(e){return _.solutionListCache[e]},_.getSolutionAllCache=function(){return _.solutionListCache},_.setCurrentSolution=function(e,t){_.currentSolution[e]=t},_.getCurrentSolution=function(e){return _.currentSolution[e]},_.removeCurrentSolution=function(e){delete _.currentSolution[e]},_.clearCurrentSolution=function(){_.currentSolution={}},_.solutionListChanged=new h.Subject,_.solutionListCache={},_.currentSolution={},_);function _(){}var N={"zh-CHS":{extendQuerySolution:{"private":{property:"个人",setAsPrivate:"用户个人方案"},"public":{label:"系统公共",property:"系统公共",setAsPublic:"系统公共方案"},org:{label:"组织公共",property:"组织公共",setAsOrgPublic:"组织公共方案",placeholder:"请选择"},auth:{createError:"您暂无权限设置公共类型方案。",updateError:"您暂无权限修改公共类型方案。",deleteError:"您暂无权限删除公共类型方案。",apiError:"调用获取权限接口失败！",noDataAuthority:"您暂无权限设置组织公共方案。",noSelectedOrg:"请选择组织公共方案所属组织。"}},advancedMode:{text:{sysAdvancedName:"（高级）",standardMode:"标准模式",advancedMode:"高级模式",addCondition:"添加条件",addConditionGroup:"生成条件组",and:"且",or:"或",reset:"重置"},compareType:{Equal:"等于",NotEqual:"不等于",Greater:"大于",GreaterOrEqual:"大于等于",Less:"小于",LessOrEqual:"小于等于",Like:"包含",LikeStartWith:"开头是",LikeEndWith:"结尾是",NotLike:"不包含"},auth:{conditionEmptyError:"高级模式下筛选项值不应为空。"},info:{deleteGroup:"是否确认取消该条件组？",resetInfo:"是否确认重置条件？",deleteGroupTooltip:"取消组",noConditionInfo:"请先选择筛选条件。",existGroupInfo:"选择的条件已存在分组",checkedGroupInfo:"跨组操作时，应勾选该组下全部数据",deleteGroupInfo:"已经是最外层分组了"}}},"zh-CHT":{extendQuerySolution:{"private":{property:"個人",setAsPrivate:"用戶個人方案"},"public":{label:"系統公共",property:"系統公共",setAsPublic:"系統公共方案"},org:{label:"組織公共",property:"組織公共",setAsOrgPublic:"組織公共方案",placeholder:"請選擇"},auth:{createError:"您暫無權限設置公共類型方案。",updateError:"您暫無權限修改公共類型方案。",deleteError:"您暫無權限刪除公共類型方案。",apiError:"調用獲取權限接口失敗！",noDataAuthority:"您暫無權限設置组织公共方案。",noSelectedOrg:"請選擇組織公共方案所屬組織。"}},advancedMode:{text:{sysAdvancedName:"（高級）",standardMode:"標准模式",advancedMode:"高級模式",addCondition:"添加條件",addConditionGroup:"生成條件組",and:"且",or:"或",reset:"重置"},compareType:{Equal:"等于",NotEqual:"不等于",Greater:"大于",GreaterOrEqual:"大于等于",Less:"小于",LessOrEqual:"小于等于",Like:"包含",LikeStartWith:"開頭是",LikeEndWith:"結尾是",NotLike:"不包含"},auth:{conditionEmptyError:"高級模式下篩選項值不應爲空。"},info:{deleteGroup:"是否確認取消該條件組？",resetInfo:"是否確認重置條件？",deleteGroupTooltip:"取消組",noConditionInfo:"請先選擇篩選條件。",existGroupInfo:"選擇的條件已存在分組。",checkedGroupInfo:"跨組操作時，應勾選該組下全部數據。",deleteGroupInfo:"已經是最外層分組了。"}}},en:{extendQuerySolution:{"private":{property:"Private Plan",setAsPrivate:"Private Plan"},"public":{label:"Public",property:"Public Plan",setAsPublic:"Public Plan"},org:{label:"Org",property:"Org Plan",setAsOrgPublic:"Org Plan",placeholder:"Please select"},auth:{createError:"Donnot have authority to set public solution.",updateError:"Donnot have authority to save public solution.",deleteError:"Donnot have authority to delete public solution.",apiError:"Failed to get authority data!",noDataAuthority:"Donnot have authority to set org-public solution.",noSelectedOrg:"Please select organizations for solution."}},advancedMode:{text:{sysAdvancedName:"(Advanced)",standardMode:"Standard Mode",advancedMode:"Advanced Mode",addCondition:"Add Condition",addConditionGroup:"Generate Condition Group",and:"And",or:"Or",reset:"Reset"},compareType:{Equal:"Equal",NotEqual:"NotEqual",Greater:"Greater",GreaterOrEqual:"GreaterOrEqual",Less:"Less",LessOrEqual:"LessOrEqual",Like:"Like",LikeStartWith:"LikeStartWith",LikeEndWith:"LikeEndWith",NotLike:"NotLike"},auth:{conditionEmptyError:"Filter condition value should not be empty in advanced mode."},info:{deleteGroup:"Are you sure to cancel the condition group?",resetInfo:"Are you sure to reset conditions?",deleteGroupTooltip:"Cancel Condition Group.",noConditionInfo:"Please select conditions first.",existGroupInfo:"The selected condition already has a grouping.",checkedGroupInfo:"When operating across groups, all data under that group should be checked.",deleteGroupInfo:"It is already the outermost group."}}}},G=(Object.defineProperty(z.prototype,"fieldConfigs",{get:function(){return this._fieldConfigs},set:function(e){this._fieldConfigs=this.solutionService.convertToQueryConditions(e),this.unformatFieldConfigs=e},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"resetFieldConfigs",{get:function(){return this._resetFieldConfigs},set:function(e){var o=this;if(e&&Array.isArray(e)&&0!=e.length){var t=e.map(function(t){var e=o.fieldConfigs.find(function(e){return e.fieldCode==t.labelCode});if(e)return t.hasOwnProperty("control")||(t.control={}),t.control.controltype=e.control.getControlType(),t});this._resetFieldConfigs=this.solutionService.convertToSimpleQueryConditions(t.filter(function(e){return e})),0<this._resetFieldConfigs.length&&this.updateConditionVisibleState(this._resetFieldConfigs),this.solutionService.updateControl(this._presetFieldConfigs,this._resetFieldConfigs),this.solutionService.updateControl(this._fieldConfigs,this._resetFieldConfigs),this._fieldConfigs=this._fieldConfigs.slice(),this.sysQuerySolutionVo&&this.solutionService.updateControl(this.sysQuerySolutionVo.queryConditions,this._resetFieldConfigs),this.historyRefer.foundSchme&&this.solutionService.updateControl(this.historyRefer.foundSchme.queryConditions,this._resetFieldConfigs),this.selectedSolution&&this.solutionService.updateControl(this.selectedSolution.queryConditions,this._resetFieldConfigs)}},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"presetFieldConfigs",{get:function(){return this._presetFieldConfigs},set:function(e){this._presetFieldConfigs=this.solutionService.convertToQueryConditions(e)},enumerable:!0,configurable:!0}),z.prototype.ngOnDestroy=function(){this._self.nativeElement.removeEventListener("keydown",this.handleKeyDown),this.destroy$.next(),this.destroy$.complete()},z.prototype.ngOnChanges=function(e){e.defaultConfigs&&(this.isSetDefaultValue=!0,e.defaultConfigs.currentValue&&!e.defaultConfigs.firstChange&&(this.setQueryConditionValues(e.defaultConfigs.currentValue,this.selectedSolution),this.initAutoQuery(this.selectedSolution))),e.enableInitQuery&&e.enableInitQuery.firstChange&&e.enableInitQuery.currentValue&&(this.doneInitQuery=!1)},z.prototype.ngOnInit=function(){var t=this;this.initSysQuerySolution(),this.isDisabled?this.loadSysQuerySolution():(this.sessionId=this.solutionHandler.getUserSessionId(),this.initAutoQueryByLS(),this.loadQuerySolutions(),this.listenKeyBoard(),this.getConditionVisibleState().pipe(n.takeUntil(this.destroy$)).subscribe(function(e){0<t.selectedFieldConditions.length?t.updateFieldParams(e):t.templateSimpleConditions=e,t.visibleSelectedConditions=t.selectedFieldConditions.filter(function(e){return!!e.visible}),t.whenFoldSetSummaryConditions(),t.isDisabled||t.solutionHandler.setCurrentQueryConditions(y.cloneDeep(t.visibleSelectedConditions))}))},z.prototype.initSysQuerySolution=function(){this.presetQuerySolutionName&&""!=this.presetQuerySolutionName&&(this.sysQuerySolutionVo=new w.QuerySolutionVo,this.sysQuerySolutionVo.id=this.solutionService.getGuid(),this.sysQuerySolutionVo.code=this.presetQuerySolutionName!=this.localeService.getValue("querySolution.container.sysPresetName")?this.presetQuerySolutionName:this.localeService.getValue("querySolution.container.defaultName"),this.sysQuerySolutionVo.queryConditions=y.cloneDeep(this.presetFieldConfigs),this.sysQuerySolutionVo.belongId=this.formId,this.sysQuerySolutionVo.isSystem=!0,this.sysQuerySolutionVo.mode="1")},z.prototype.loadSysQuerySolution=function(){this.querySolutionVos.push(this.sysQuerySolutionVo),this.selectedSolution=y.cloneDeep(this.sysQuerySolutionVo),this.loadQueryConditions()},z.prototype.formatQuerySolutionVO=function(e,t,o){var i,n,r=this;void 0===o&&(o=!1);var s,l=[];if(i=o?e.initFromJobject(t):t,this.fieldConfigs.forEach(function(e){l.push(e.fieldCode)}),i&&i.queryConditions&&0<i.queryConditions.length&&(s=i.queryConditions.filter(function(e){return-1<l.indexOf(e.fieldCode)}),i.queryConditions=s,i.queryConditions.forEach(function(t){n=r.fieldConfigs.find(function(e){return e.fieldCode==t.fieldCode}),t.fieldName=n.fieldName,t.placeHolder=n.placeHolder,t.beginPlaceHolder=n.hasOwnProperty("beginPlaceHolder")?n.beginPlaceHolder:"",t.endPlaceHolder=n.hasOwnProperty("endPlaceHolder")?n.endPlaceHolder:"",n.control.preEventCmd&&(t.control.preEventCmd=n.control.preEventCmd),n.control.postEventCmd&&(t.control.postEventCmd=n.control.postEventCmd),n.control.clear&&(t.control.clear=n.control.clear),n.control.click&&(t.control.click=n.control.click),n.control.beforeShow&&(t.control.beforeShow=n.control.beforeShow),n.control.beforeHide&&(t.control.beforeHide=n.control.beforeHide),n.control.dateChangedCmd&&(t.control.dateChangedCmd=n.control.dateChangedCmd),n.control.enumValues&&0<n.control.enumValues.length&&(t.control.enumValues=n.control.enumValues,t.control.enumValues=n.control.enumValues),n.control.data&&0<n.control.data.length&&(t.control.data=n.control.data)}),i.queryConditionsAdvanced)){var a=e.complicateTreeData(i.queryConditionsAdvanced,i.queryConditions);i.queryConditionsAdvanced=y.cloneDeep(a)}return i},z.prototype.loadQuerySolutions=function(){return function e(t,s,l,a){return new(l=l||Promise)(function(e,o){function i(e){try{r(a.next(e))}catch(t){o(t)}}function n(e){try{r(a["throw"](e))}catch(t){o(t)}}function r(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(i,n)}r((a=a.apply(t,s||[])).next())})}(this,void 0,void 0,function(){var r=this;return E(this,function(e){return this.httpService.query(this.formId,this.sessionId).subscribe(function(e){var t,o=new w.QuerySolutionVoConvertor;if(e&&0<e.length&&(r.openAdvancedMode||(e=e.filter(function(e){return"2"!==e.mode})),e.forEach(function(e){t=r.formatQuerySolutionVO(o,e,!0),r.enableHistory&&"pre"==t.type&&"2"!==t.mode?(t.code=r.localeService.getValue("querySolution.container.histroyName"),r.historyRefer.schemeKey=t.id,r.historyRefer.foundSchme=y.cloneDeep(t),r.historyRefer.initCondition=!0):"pre"!=t.type&&("2"===t.mode?r.querySolutionAdvancedVos.push(t):r.querySolutionVos.push(t),t.isDefault&&(r.defaultQuerySolution=y.cloneDeep(t)))})),r.enableHistory&&!r.historyRefer.initCondition&&r.formatInitQuerySolution(),r.enableHistory&&r.historyRefer.initCondition)r.selectedSolution=y.cloneDeep(r.historyRefer.foundSchme),r.querySolutionVos.splice(0,0,r.historyRefer.foundSchme),1===r.querySolutionVos.length&&r.querySolutionVos.push(r.sysQuerySolutionVo),0===r.querySolutionAdvancedVos.length&&r.querySolutionAdvancedVos.push(r.initAdvancedSolution()),r.loadQueryConditions();else if(r.defaultQuerySolution||r.querySolutionVos.length||r.querySolutionAdvancedVos.length){if(r.defaultQuerySolution&&""!=r.defaultQuerySolution.id)r.selectedSolution=y.cloneDeep(r.defaultQuerySolution);else{var i=T(r.querySolutionVos,r.querySolutionAdvancedVos).find(function(e){return"public"==e.type});if(i)r.selectedSolution=i;else{var n=T(r.querySolutionVos,r.querySolutionAdvancedVos).find(function(e){return"org"==e.type});r.selectedSolution=n||y.cloneDeep(T(r.querySolutionVos,r.querySolutionAdvancedVos)[0])}}r.querySolutionVos.length<1&&r.querySolutionVos.push(r.sysQuerySolutionVo),r.querySolutionAdvancedVos.length<1&&r.querySolutionAdvancedVos.push(r.initAdvancedSolution()),r.loadQueryConditions()}else r.loadSysQuerySolution(),r.querySolutionAdvancedVos.push(r.initAdvancedSolution());r.isSetDefaultValue&&!r.historyRefer.initCondition&&r.setQueryConditionValues(r.defaultConfigs,r.selectedSolution),r.initAutoQuery(r.selectedSolution)},function(e){e&&e.message&&r.msgSer.show("error",e.message,{showHeader:!1})}),[2]})})},z.prototype.setSolutionCache=function(e){if(!this.isDisabled&&gspframeworkService&&e&&e.length){var t=gspframeworkService.rtf.session.getCommonVariable();P.setSolutionCache(t.tabId,e),P.solutionListChanged.next(!0)}},z.prototype.setCurrentSolutionCache=function(e){if(!this.isDisabled&&gspframeworkService&&e){var t=gspframeworkService.rtf.session.getCommonVariable();t&&t.tabId&&P.setCurrentSolution(t.tabId,e)}},z.prototype.loadQueryConditions=function(){this.selectedFieldConditions=new Array,this.selectedSolution&&this.selectedSolution.queryConditions&&0<this.selectedSolution.queryConditions.length&&(this.selectedFieldConditions=this.selectedSolution.queryConditions,this.templateSimpleConditions&&0<this.templateSimpleConditions.length&&(this.updateFieldParams(this.templateSimpleConditions),this.templateSimpleConditions=new Array)),this.visibleSelectedConditions=this.selectedFieldConditions.filter(function(e){return!!e.visible}),this.whenFoldSetSummaryConditions(),this.showSaveButton=!this.selectedSolution.isSystem,this.isDisabled||this.solutionHandler.setCurrentQueryConditions(y.cloneDeep(this.visibleSelectedConditions))},z.prototype.getConditionVisibleState=function(){return this.conditionVisibleState},z.prototype.updateConditionVisibleState=function(e){this.conditionVisibleState.next(e)},z.prototype.updateFieldParams=function(a){var u=this;if(a&&a.length){var e=y.cloneDeep(this.selectedFieldConditions).map(function(e){var t,o;try{for(var i=function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],o=0;return t?t.call(e):{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}}}(a),n=i.next();!n.done;n=i.next()){var r=n.value;r.hasOwnProperty("visible")&&e.fieldCode==r.fieldCode&&e.visible!==r.visible&&(e.visible=r.visible,e.value.clearValue(),u.markAsChanged(!0,u.selectedSolution.id))}}catch(l){t={error:l}}finally{try{n&&!n.done&&(o=i["return"])&&o.call(i)}finally{if(t)throw t.error}}return e});this.selectedFieldConditions=e.slice()}},z.prototype.saveAs=function(){this.openSaveAsDialog(this.localeService.getValue("querySolution.saveAsDialog.title"))},z.prototype.getDefaultLabel=function(e){return this.defaultQuerySolution?e.id!=this.defaultQuerySolution.id?{visibility:"hidden"}:void 0:{visibility:"hidden"}},z.prototype.select=function(e){this.selectedSolution=Object.assign(new w.QuerySolutionVo,e),e.queryConditions&&0<e.queryConditions.length?this.selectedFieldConditions=this.selectedSolution.queryConditions:this.selectedFieldConditions=new Array,this.showSaveButton=!this.selectedSolution.isSystem,this.visibleSelectedConditions=this.selectedFieldConditions.filter(function(e){return!!e.visible}),this.isDisabled||this.solutionHandler.setCurrentQueryConditions(y.cloneDeep(this.visibleSelectedConditions)),this.whenFoldSetSummaryConditions()},z.prototype.selectAndQuery=function(e){if("2"!==e.mode&&(this.defaultConfigs&&this.defaultConfigs.isCurrent||e.isSystem&&"pre"!==e.type))this.setQueryConditionValues(this.defaultConfigs,e);else{if("2"!==e.mode&&this.enableHistory&&"pre"==e.type){var t=y.cloneDeep(this.historyRefer.foundSchme.queryConditions);0<t.length&&(e.queryConditions=t)}this.select(e)}this.query()},z.prototype.openFieldConfigDialog=function(){this.farrisQueryCondition.openFieldConfigDialog()},z.prototype.fieldConditionsChangeHander=function(e){var t=this,o=e;if("2"===this.selectedSolution.mode){this.selectedSolution.queryConditions=o;var i=this.querySolutionAdvancedVos.find(function(e){return e.id===t.selectedSolution.id});i&&(i.queryConditions=this.selectedSolution.queryConditions,i.queryConditionsAdvanced=this.selectedSolution.queryConditionsAdvanced)}this.selectedFieldConditions=o,this.visibleSelectedConditions=this.selectedFieldConditions.filter(function(e){return!!e.visible}),this.isDisabled||(this.solutionHandler.setCurrentQueryConditions(y.cloneDeep(this.visibleSelectedConditions)),this.solutionHandler.setFilterConditions(this.visibleSelectedConditions)),this.queryAfterValueChange&&this.query(),this.markAsChanged(!0,this.selectedSolution.id)},z.prototype.fieldSolutionChangeHander=function(e){var t=e;this.selectedSolution=t},z.prototype.save=function(){var t=this;this.formId?this.selectedSolution.id?this.httpService.getAuth("QuerySolution",this.sessionId).pipe(n.switchMap(function(e){return e.success||"public"!=t.selectedSolution.type&&"org"!=t.selectedSolution.type?(t.selectedSolution.queryConditions=t.selectedFieldConditions,t.httpService.update(t.selectedSolution,t.sessionId).pipe(n.tap(function(){if("2"===t.selectedSolution.mode){var e=t.querySolutionAdvancedVos.findIndex(function(e){return e.id==t.selectedSolution.id});t.querySolutionAdvancedVos.splice(e,1,t.selectedSolution)}else e=t.querySolutionVos.findIndex(function(e){return e.id==t.selectedSolution.id}),t.querySolutionVos.splice(e,1,t.selectedSolution);t.markAsChanged(!1,t.selectedSolution.id),t.farrisQueryCondition.canClearRelatedFields=!1,t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveSuccess"),"success","",1500)},function(e){throw t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveFail"),"error","",1500),e}))):(t.solutionService.showInfo(t.localeService.getValue("extendQuerySolution.auth.updateError"),"warning","",1500),h.of(!1))}),n.tap(function(){},function(e){console.warn(t.localeService.getValue("extendQuerySolution.auth.apiError"))})).subscribe():this.openSaveAsDialog(this.localeService.getValue("querySolution.container.save")):this.solutionService.showInfo(this.localeService.getValue("querySolution.container.pleaseInput"),"error","",1500)},z.prototype.openSaveAsDialog=function(e){this.formId?(this.saveAsDialog.title=e,this.saveAsDialog.querySolution=this.newSaveAsSolutionVo(),this.saveAsDialog.radioGroupValue="private",this.saveAsDialog.show()):this.solutionService.showInfo(this.localeService.getValue("querySolution.container.pleaseInput"),"error","",1500)},z.prototype.saveAsConfrimHandler=function(e){var t=this,o=e.querySolution;o.queryConditions&&o.queryConditions.length&&o.queryConditions.forEach(function(e){e.readonly&&(e.readonly=!1)}),this.httpService.create(o,this.sessionId).subscribe(function(){if(o.isDefault&&(t.defaultQuerySolution=o,t.querySolutionVos=t.querySolutionVos.map(function(e){return e.isDefault=!1,e}),t.querySolutionAdvancedVos=t.querySolutionAdvancedVos.map(function(e){return e.isDefault=!1,e})),1===t.querySolutionVos.length&&t.querySolutionVos[0].isSystem&&"1"===o.mode)t.querySolutionVos=new Array;else if(2===t.querySolutionVos.length&&t.enableHistory){var e=new Array;e=t.querySolutionVos.filter(function(e){return"pre"==e.type||!e.isSystem}),t.querySolutionVos=e}1===t.querySolutionAdvancedVos.length&&t.querySolutionAdvancedVos[0].isSystem&&"2"===o.mode?t.querySolutionAdvancedVos=new Array:2===t.querySolutionAdvancedVos.length&&t.enableHistory&&(e=new Array,e=t.querySolutionAdvancedVos.filter(function(e){return"pre"==e.type||!e.isSystem}),t.querySolutionAdvancedVos=e),"2"===o.mode?t.querySolutionAdvancedVos.push(o):t.querySolutionVos.push(o),t.selectedSolution=o,t.showSaveButton=!t.selectedSolution.isSystem,t.selectedFieldConditions=t.selectedSolution.queryConditions,t.visibleSelectedConditions=t.selectedFieldConditions.filter(function(e){return!!e.visible}),t.farrisQueryCondition.canClearRelatedFields=!1,t.saveAsDialog.isDefault=!1,t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveSuccess"),"success","",1500)},function(e){throw t.solutionService.showInfo(t.localeService.getValue("querySolution.container.saveFail"),"error","",1500),e})},z.prototype.openManangerDialog=function(){var t=this;this.httpService.getAuth("QuerySolution",this.sessionId).subscribe(function(e){t.manageDialog.authorityError=!e.success,t.manageDialog.show(y.cloneDeep(T(t.querySolutionVos,t.querySolutionAdvancedVos)))})},z.prototype.managerConfirmHandler=function(e){var o=this,i=e;if(1==i.validator){var n=i.newDefaultQuerySolution?i.newDefaultQuerySolution.id:"",t=this.formId,r=i.deletedQuerySolutionIds;this.httpService.batchUpdate({defaultId:n,belongId:t,deletedIds:r},this.sessionId).subscribe(function(){if(o.querySolutionVos=i.updatedQuerySolutionVos.filter(function(e){return"2"!==e.mode}),o.querySolutionAdvancedVos=i.updatedQuerySolutionVos.filter(function(e){return"2"===e.mode}),i.currentDefaultQuerySolutionId||(o.defaultQuerySolution=null),n)o.select(i.newDefaultQuerySolution),o.defaultQuerySolution=i.newDefaultQuerySolution,(0===o.querySolutionVos.length||o.enableHistory&&1===o.querySolutionVos.length&&"pre"==o.querySolutionVos[0].type)&&o.querySolutionVos.push(o.sysQuerySolutionVo),o.querySolutionAdvancedVos.length||o.querySolutionAdvancedVos.push(o.initAdvancedSolution());else if(r.includes(o.selectedSolution.id)){if(0<o.querySolutionVos.length)if(o.enableHistory&&1==o.querySolutionVos.length&&"pre"==o.querySolutionVos[0].type)o.select(o.sysQuerySolutionVo),o.querySolutionVos.push(o.sysQuerySolutionVo);else{var e=o.querySolutionVos.find(function(e){return"public"==e.type});if(e)o.select(e);else{var t=o.querySolutionVos.find(function(e){return"org"==e.type});o.select(t||y.cloneDeep(o.querySolutionVos[0]))}}else o.select(o.sysQuerySolutionVo),o.querySolutionVos.push(o.sysQuerySolutionVo);o.querySolutionAdvancedVos.length||o.querySolutionAdvancedVos.push(o.initAdvancedSolution())}else(0===o.querySolutionVos.length||o.enableHistory&&1===o.querySolutionVos.length&&"pre"==o.querySolutionVos[0].type)&&o.querySolutionVos.push(o.sysQuerySolutionVo),o.querySolutionAdvancedVos.length||o.querySolutionAdvancedVos.push(o.initAdvancedSolution());o.solutionService.showInfo(o.localeService.getValue("querySolution.container.saveSuccess"),"success","",1500)},function(e){return o.solutionService.showInfo(o.localeService.getValue("querySolution.container.saveFail"),"error","",1500),s.Observable["throw"](e)})}},z.prototype.query=function(){if(!this.isDisabled){var e=this.solutionService.isValid(this.visibleSelectedConditions);if(e&&e.length&&"2"!==this.selectedSolution.mode){var t=e.map(function(e){return e.field});this.solutionService.showInfo(this.localeService.getValue("querySolution.container.require").replace("{fields}",t.join(", ")),"warning","",2500)}else{var o=y.cloneDeep(this.visibleSelectedConditions);if("2"===this.selectedSolution.mode&&(o=y.cloneDeep(this.selectedFieldConditions)).find(function(e){return e.value.isEmpty()}))return void this.notify.warning(this.localeService.getValue("advancedMode.auth.conditionEmptyError"));this.solutionHandler.setFilterConditions(o),this.queryEmitter.emit(o),this.changeQueryHistroy()}}},z.prototype.clear=function(){if(this.visibleSelectedConditions.some(function(e){return 0==e.value.isEmpty()})){var e=y.cloneDeep(this.farrisQueryCondition.resetSelectedConditionValues(!0));this.selectedFieldConditions=e,this.selectedSolution.queryConditions=e,this.visibleSelectedConditions=this.selectedFieldConditions.filter(function(e){return!!e.visible}),this.solutionHandler.setCurrentQueryConditions(y.cloneDeep(this.visibleSelectedConditions)),this.solutionHandler.setFilterConditions(this.visibleSelectedConditions),this.markAsChanged(!0,this.selectedSolution.id),this.query()}},z.prototype.foldClearHandler=function(){this.isFold?(this.isFold=!1,0<this.summaryConditions.length&&(this.summaryConditions=[],this.clear())):this.clear()},z.prototype.arrowClick=function(){this.isFold=!this.isFold,this.whenFoldSetSummaryConditions(),this.isFold||(this.summaryConditions=[])},z.prototype.whenFoldSetSummaryConditions=function(){if(this.isFold){var e=this.visibleSelectedConditions.some(function(e){return 0==e.value.isEmpty()});this.summaryConditions=e?this.visibleSelectedConditions.filter(function(e){return 0==e.value.isEmpty()}):[]}},z.prototype.setQueryConditionValues=function(e,t){var o,i;e&&Array.isArray(e.fieldConfigs)&&e.fieldConfigs.length&&"2"!==t.mode?(t.hasOwnProperty("type")&&"pre"==t.type?(o=null,this.select(t)):o=e.isCurrent?t:t.isSystem?t:null,o&&o.queryConditions&&o.queryConditions.length?(i=y.cloneDeep(this.solutionService.setValues(o,e.fieldConfigs,!!e.readonly)),this.doneSetDefaultValue=!0,this.select(i)):(this.doneSetDefaultValue=!0,this.solutionHandler.setCurrentQueryConditions(this.selectedSolution.queryConditions))):this.select(t)},z.prototype.initAutoQuery=function(e){var t=this;if(!(this.enableInitQuery&&this.doneInitQuery&&this.enableHistory&&"2"!==e.mode)){var o=!0;e&&e.queryConditions&&e.queryConditions.length?this.isSetDefaultValue&&!this.doneSetDefaultValue&&(o=!1):o=!1,o&&this.enableInitQuery&&setTimeout(function(){t.query(),t.doneInitQuery=!0})}},z.prototype.markAsChanged=function(t,o){this.querySolutionVos.forEach(function(e){e.id==o&&(e.isChanged=t)}),this.querySolutionAdvancedVos.forEach(function(e){e.id==o&&(e.isChanged=t)}),this.selectedSolution.isChanged=t,this.cdf.detectChanges()},z.prototype.listenKeyBoard=function(){this._self.nativeElement.addEventListener("keydown",this.handleKeyDown)},z.prototype.initAutoQueryByLS=function(){if(this.enableHistory&&!this.isDisabled&&(this.setLSKey(),this.initQuerySolution(),this.enableInitQuery&&(this.formatInitQuerySolution(),0<this.historyRefer.foundSchme.queryConditions.length))){var e=y.cloneDeep(this.historyRefer.foundSchme.queryConditions);this.selectedFieldConditions=e,this.visibleSelectedConditions=this.selectedFieldConditions.filter(function(e){return!!e.visible});var t=y.cloneDeep(this.visibleSelectedConditions);this.solutionHandler.setFilterConditions(t),this.queryEmitter.emit(t),this.doneInitQuery=!0}},z.prototype.initQuerySolution=function(){var e=new w.QuerySolutionVo;e.id=this.solutionService.getGuid(),e.code=this.localeService.getValue("querySolution.container.histroyName"),e.queryConditions=[],e.belongId=this.formId,e.isSystem=!0,e.type="pre",e.mode="1",e.queryConditionsAdvanced={relation:1,items:[],children:[],path:[1],groupid:1},this.historyRefer.foundSchme=e},z.prototype.initAdvancedSolution=function(){var e=new w.QuerySolutionVo;return e.id=this.solutionService.getGuid(),e.code=(this.presetQuerySolutionName!=this.localeService.getValue("querySolution.container.sysPresetName")?this.presetQuerySolutionName:this.localeService.getValue("querySolution.container.defaultName"))+this.localeService.getValue("advancedMode.text.sysAdvancedName"),e.queryConditions=[],e.belongId=this.formId,e.isSystem=!0,e.type="pre",e.mode="2",e.queryConditionsAdvanced={relation:1,items:[],children:[],path:[1],groupid:1},e},z.prototype.formatInitQuerySolution=function(){var e=this.httpService.getLS(this.historyRefer.schemeKeyLS);if(0<e.length){var t=new w.QuerySolutionVoConvertor;this.historyRefer.foundSchme.queryConditions=e,this.historyRefer.foundSchme=this.formatQuerySolutionVO(t,this.historyRefer.foundSchme),this.solutionService.updateControl(this.historyRefer.foundSchme,this.resetFieldConfigs),this.historyRefer.initCondition=!0}},z.prototype.changeQueryHistroy=function(e){if(void 0===e&&(e=!0),this.enableHistory&&"1"===this.selectedSolution.mode){var t=this.querySolutionVos.findIndex(function(e){return"pre"==e.type});-1<t&&(this.querySolutionVos[t].isChanged=!1),"pre"==this.selectedSolution.type&&(this.selectedSolution.isChanged=!1);var o=y.cloneDeep(this.selectedFieldConditions);this.historyRefer.foundSchme.queryConditions=o,this.httpService.setLS(this.historyRefer.schemeKeyLS,this.historyRefer.foundSchme.queryConditions),e&&this.httpService.saveHistroy(this.historyRefer.foundSchme,this.sessionId).subscribe(function(){})}},z.prototype.getTopWindow=function(){var e=window.self;try{for(;e.location.origin===e.parent.location.origin&&e!==e.parent&&!e.isRTFTopWin;)e=e.parent}catch(t){}return e},z.prototype.setLSKey=function(){var e=this.getTopWindow(),t="";e.gspframeworkService&&e.gspframeworkService.hasOwnProperty("common")&&(t=e.gspframeworkService.common.userInfos.get().code),this.historyRefer.schemeKeyLS=t?"Scheme"+this._idSer.encrypt(t+this.formId):""},z.prototype.checkAuthority=function(o){var i=this;"private"!=o?this.httpService.getAuth("QuerySolution",this.sessionId).subscribe(function(e){if(e)if(e.success)if("org"==o){var t=e.authOrganizationData;Array.isArray(t)&&t.length?("*"==(i.saveAsDialog.dataPermissionIds=t).toString()||i.saveAsDialog.selectedOrgIds.length||(i.saveAsDialog.selectedOrgIds=i.saveAsDialog.dataPermissionIds),i.saveAsDialog.noDataAuthority=!1,i.saveAsDialog.pRadioGroupValue=o):(i.solutionService.showInfo(i.localeService.getValue("extendQuerySolution.auth.noDataAuthority"),"warning","",1500),i.saveAsDialog.noDataAuthority=!0,i.saveAsDialog.radioGroupValue=i.saveAsDialog.pRadioGroupValue)}else i.saveAsDialog.pRadioGroupValue=o;else i.solutionService.showInfo(i.localeService.getValue("extendQuerySolution.auth.createError"),"warning","",1500),i.saveAsDialog.authorityError=!0,i.saveAsDialog.radioGroupValue=i.saveAsDialog.pRadioGroupValue;else console.warn(i.localeService.getValue("extendQuerySolution.auth.apiError"))}):(this.saveAsDialog.pRadioGroupValue=o,this.saveAsDialog.authorityError=!1)},z.decorators=[{type:A.Component,args:[{selector:"farris-querysolution",template:'<div #querysolution class="farris-panel position-relative" tabindex="1" style="outline: none;">\r\n    <div class="solution-header">\r\n        <div class="btn-group mr-3" fDropdown>\r\n            <div class="solution-header-title" fDropdownToggle>               \r\n                <span style="max-width: 288px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap"\r\n                    title="{{selectedSolution.code}}">{{selectedSolution.code}}</span>\r\n                <b class="header-title--change" *ngIf="selectedSolution.isChanged">*</b>\r\n                <span class="f-icon f-accordion-expand"></span>\r\n            </div>\r\n            <div class="query-solution dropdown-menu solution-header-title-menu" fDropdownMenu>\r\n                <div class="solution-header-title-menu-inner">\r\n                    <div class="solution-header-title-menu-arrow"></div>\r\n                    <span class="solution-header-managerList-type ml-2 mb-2" *ngIf="openAdvancedMode">{{\'advancedMode.text.standardMode\' | locale}}</span>\r\n                    <li class="dropdown-item solution-header-dropdown-item"\r\n                        [ngClass]="{\'solution-header-dropdown-item-active\': solution.id === selectedSolution.id }"\r\n                        (click)="selectAndQuery(solution)" *ngFor="let solution of querySolutionVos">\r\n                        <b *ngIf="solution.isChanged"  class="menu-item--change" >*</b>\r\n                        <span class="solution-header-dropdown-item-title" [title]="solution.code">{{solution.code}}</span>\r\n                        <span class="solution-header-dropdown-item-tip"\r\n                            [ngStyle]="getDefaultLabel(solution)">{{\'querySolution.container.default\' | locale}}</span>\r\n                        <span class="solution-header-dropdown-item-public" *ngIf="solution.type == \'public\'">\r\n                            {{\'extendQuerySolution.public.label\' | locale}}</span>\r\n                        <span class="solution-header-dropdown-item-public" *ngIf="solution.type == \'org\'">\r\n                            {{\'extendQuerySolution.org.label\' | locale}}</span>\r\n                    </li>\r\n                    \x3c!-- <li class="dropdown-item solution-header-dropdown-item-btns" style="background-color: white!important;cursor: default;">\r\n                        <span class="dropdown-item-btn" *ngIf="showSaveButton"\r\n                            (click)="save()">{{\'queryCondition.container.save\' | locale}}</span>\r\n                        <span class="dropdown-item-btn"\r\n                            (click)="saveAs()">{{\'queryCondition.container.saveAs\' | locale}}</span>\r\n                        <span class="dropdown-item-btn"\r\n                            (click)="openManangerDialog()">{{\'querySolution.container.manage\' | locale}}</span>\r\n                    </li> --\x3e\r\n                    <ng-container *ngIf="openAdvancedMode">\r\n                        <span class="solution-header-managerList-type ml-2 mb-2">{{\'advancedMode.text.advancedMode\' | locale}}</span>\r\n                        <li class="dropdown-item solution-header-dropdown-item"\r\n                            [ngClass]="{\'solution-header-dropdown-item-active\': solution.id === selectedSolution.id }"\r\n                            (click)="selectAndQuery(solution)" *ngFor="let solution of querySolutionAdvancedVos">\r\n                            <b *ngIf="solution.isChanged" class="menu-item--change">*</b>\r\n                            <span class="solution-header-dropdown-item-title" [title]="solution.code">{{solution.code}}</span>\r\n                            <span class="solution-header-dropdown-item-tip"\r\n                                [ngStyle]="getDefaultLabel(solution)">{{\'querySolution.container.default\' | locale}}</span>\r\n                            <span class="solution-header-dropdown-item-public" *ngIf="solution.type == \'public\'">\r\n                                {{\'extendQuerySolution.public.label\' | locale}}</span>\r\n                            <span class="solution-header-dropdown-item-public" *ngIf="solution.type == \'org\'">\r\n                                {{\'extendQuerySolution.org.label\' | locale}}</span>\r\n                        </li>\r\n                    </ng-container>\r\n                    <li class="dropdown-item solution-header-dropdown-item-btns" style="background-color: white!important;cursor: default;">\r\n                        <span class="dropdown-item-btn" *ngIf="showSaveButton"\r\n                            (click)="save()">{{\'queryCondition.container.save\' | locale}}</span>\r\n                        <span class="dropdown-item-btn"\r\n                            (click)="saveAs()">{{\'queryCondition.container.saveAs\' | locale}}</span>\r\n                        <span class="dropdown-item-btn"\r\n                            (click)="openManangerDialog()">{{\'querySolution.container.manage\' | locale}}</span>\r\n                    </li>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="summary-condition" *ngIf="isFold && summaryConditions.length > 0">\r\n            <lib-summary-list [conditions]="summaryConditions"></lib-summary-list>\r\n        </div>\r\n        <div class="solution-action">\r\n            <div class="btn-group" *ngIf="!isFold">\r\n                <button *ngIf="isFold==false" (click)="query()" type="button"\r\n                    class="btn btn-primary ">{{filterText}}</button>\r\n            </div>\r\n            <div class="icon-group">\r\n                \x3c!--清空按钮--\x3e\r\n                <span *ngIf="(!isFold || summaryConditions.length > 0) && selectedSolution.mode !== \'2\'" class="icon-group-remove" (click)="foldClearHandler()"\r\n                    title="{{\'querySolution.container.clear\' | locale}}">\r\n                    <span class="f-icon f-icon-remove"></span>\r\n                </span>                \r\n                <ng-container *ngIf="!isFold">\r\n                    <span class="divide"></span>\r\n                    \x3c!--配置按钮--\x3e\r\n                    <span *ngIf="selectedSolution.mode !== \'2\'" class="icon-group-setup" (click)="openFieldConfigDialog()"\r\n                        title="{{\'queryCondition.container.config\' | locale}}">\r\n                        <span class="f-icon f-icon-home-setup"></span>\r\n                    </span>\r\n                    \x3c!--展开收起--\x3e\r\n                    <span class="icon-group-packup" (click)="arrowClick()"\r\n                        title="{{\'querySolution.container.arrowUp\' | locale}}">\r\n                        <span class="f-icon f-icon-packup"></span>\r\n                    </span>\r\n                </ng-container>\r\n                \x3c!--展开收起--\x3e\r\n                <span *ngIf="isFold" class="icon-group-packup" (click)="arrowClick()"\r\n                    title="{{\'querySolution.container.arrowDown\' | locale}}">\r\n                    <span class="f-icon f-icon-packup" style="transform: rotate(180deg);"></span>\r\n                </span>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div>\r\n        <farris-querycondition [ngClass]="{\'d-none\':isFold}" #farrisQueryCondition\r\n            [(selectedFieldConditions)]="selectedFieldConditions" [fieldConfigs]="fieldConfigs"\r\n            [isControlInline]="isControlInline" [showCompleteLabel]="showCompleteLabel"\r\n            [isDisabled]="isDisabled" [resetFieldConfigs]="resetFieldConfigs"\r\n            [unformatFieldConfigs]="unformatFieldConfigs"\r\n            (fieldConditionsChange)="fieldConditionsChangeHander($event)"\r\n            [selectSolution]="selectedSolution">\r\n        </farris-querycondition>\r\n    </div>\r\n\r\n    <app-solutionmanager #manageDialog (confirmEmitter)="managerConfirmHandler($event)"></app-solutionmanager>\r\n    <app-saveasdialog #saveAsDialog\r\n        (confirmEmitter)="saveAsConfrimHandler($event)"\r\n        (getAuthority)="checkAuthority($event)"\r\n        [hideOrgselector]="hideOrgselector"></app-saveasdialog>\r\n    <div *ngIf="isDisabled" style="position:absolute;top:0;bottom:0;left:0;right:0;z-index: 99;"></div>\r\n</div>',encapsulation:A.ViewEncapsulation.None,providers:[H,w.ConvertorService,L],styles:[".solution-action{float:right}.solution-action span{vertical-align:middle;margin:0 3px}.solution-action .divide{font-size:12px;padding:3px 0}.solution-header{height:30px;margin-bottom:5px;-webkit-box-pack:start;justify-content:flex-start}.solution-action .f-icon{cursor:pointer}.solution-action .icon-group{display:inline-block}.solution-header-title-text{overflow:initial!important}.query-solution .solution-header-dropdown-item .solution-header-dropdown-item-public{flex-shrink:0;height:1.125rem;min-width:2.5rem;padding:0 4px;line-height:1.125rem;font-size:.75rem;background:#2a87ff;color:#fff;border-radius:2px;text-align:center}.solution-header-managerList-type{font-weight:700}"]}]}],z.ctorParameters=function(){return[{type:S.NotifyService},{type:A.ComponentFactoryResolver},{type:A.Injector},{type:o.BsModalService},{type:w.ConvertorService},{type:w.SolutionService},{type:H},{type:L},{type:I.LocaleService}]},z.propDecorators={defaultConfigs:[{type:A.Input}],fieldConfigs:[{type:A.Input}],presetQuerySolutionName:[{type:A.Input}],resetFieldConfigs:[{type:A.Input}],presetFieldConfigs:[{type:A.Input}],isDisabled:[{type:A.Input}],formId:[{type:A.Input}],queryEmitter:[{type:A.Output}],cls:[{type:A.HostBinding,args:["class"]}],isFold:[{type:A.Input}],isControlInline:[{type:A.Input}],showCompleteLabel:[{type:A.Input}],enableInitQuery:[{type:A.Input}],enableHistory:[{type:A.Input}],openAdvancedMode:[{type:A.Input}],filterText:[{type:A.Input}],queryAfterValueChange:[{type:A.Input}],hideOrgselector:[{type:A.Input}],farrisQueryCondition:[{type:A.ViewChild,args:["farrisQueryCondition"]}],manageDialog:[{type:A.ViewChild,args:["manageDialog"]}],saveAsDialog:[{type:A.ViewChild,args:["saveAsDialog"]}]},z);function z(e,t,o,i,n,r,s,l,a){var u=this;this.notify=e,this.resolver=t,this.injector=o,this.modalService=i,this.convertService=n,this.solutionService=r,this.httpService=s,this.fieldConfigService=l,this.localeService=a,this._fieldConfigs=[],this._presetFieldConfigs=[],this._resetFieldConfigs=[],this.unformatFieldConfigs=[],this.isDisabled=!1,this.queryEmitter=new A.EventEmitter,this.cls="query-solution",this.querySolutionVos=new Array,this.querySolutionAdvancedVos=new Array,this.selectedSolution=new w.QuerySolutionVo,this.isFold=!1,this.isControlInline=!0,this.showCompleteLabel=!1,this.enableInitQuery=!1,this.selectedFieldConditions=new Array,this.visibleSelectedConditions=new Array,this.isSetDefaultValue=!1,this.doneSetDefaultValue=!1,this.doneInitQuery=!0,this.conditionVisibleState=new h.BehaviorSubject([]),this.destroy$=new h.Subject,this.summaryConditions=[],this.enableHistory=!1,this.openAdvancedMode=!1,this.filterText=this.localeService.getValue("queryCondition.container.query"),this.queryAfterValueChange=!1,this.hideOrgselector=!1,this.historyRefer={schemeKey:"",foundSchme:null,schemeKeyLS:"",initCondition:!1},this.newSaveAsSolutionVo=function(){var e=y.cloneDeep(u.selectedSolution);return e.code="",e.isSystem=!1,e.belongId=u.formId,e.id=u.solutionService.getGuid(),e.isDefault=!1,e.queryConditions=u.selectedFieldConditions,e.type="private",e.isChanged=!1,e.extendId="query-scheme-1",e.extendInfo=new Array,e},this.handleKeyDown=function(e){if("Enter"==e.key){if("2"===u.selectedSolution.mode){var t=document.activeElement;t.blur(),t.focus()}u.query()}},this._idSer=new d.IdService,this.solutionHandler=this.injector.get(R,null,A.InjectFlags.Optional),this.msgSer=this.injector.get(p.MessagerService),this._self=this.injector.get(A.ElementRef),this.cdf=this.injector.get(A.ChangeDetectorRef),this.eventManager=this.injector.get(c.EventManager),this.localeService.langData.extendQuerySolution||this.localeService.setLocaleData(N)}var B=(U.prototype.update=function(e){var t;this.isNew(e)?(t=this.createdItems.indexOf(e),this.createdItems.splice(t,1,e)):-1!==(t=function(e,t){for(var o=0;o<t.length;o++)if(t[o].id===e.id)return o;return-1}(e,this.updatedItems))?this.updatedItems.splice(t,1,e):this.updatedItems.push(e)},U.prototype.isNew=function(e){return!e.id},U.prototype.assignValues=function(e,t){Object.assign(e,t)},U.decorators=[{type:A.Injectable}],U);function U(){this.createdItems=[],this.updatedItems=[]}var W=($.prototype.ngOnInit=function(){this.columns=[{field:"code",width:272,title:this.localeService.getValue("querySolution.manageDialog.name")},{field:"property",width:110,title:this.localeService.getValue("querySolution.manageDialog.property"),formatter:this.propertyFieldFormatter,halign:"center",align:"center"},{field:"isDefault",width:70,title:this.localeService.getValue("querySolution.manageDialog.default"),template:this.checkCell,halign:"center",align:"center"},{width:70,title:this.localeService.getValue("querySolution.manageDialog.operation"),template:this.optCell,halign:"center",align:"center"}],this.title=this.localeService.getValue("querySolution.container.manage")},$.prototype.show=function(e){e&&(this.listData=this.findSolutionsWithoutSys(e),this.querySolutions=e),this.checkedSolution=this.querySolutions.find(function(e){return e.isDefault}),this.deletedQuerySolutionIds=[],this.dialog.show()},$.prototype.getSolutionProperty=function(e){return e?this.localeService.getValue("querySolution.manageDialog.system"):this.localeService.getValue("querySolution.manageDialog.personal")},$.prototype.findSolutionsWithoutSys=function(e){var t=[];return e.forEach(function(e){e.isSystem||t.push(e)}),t},$.prototype.delelteSolution=function(e){if(this.authorityError&&("public"==e.type||"org"==e.type))return this.notify.config.position="top-center",void this.notify.warning({title:"",msg:this.localeService.getValue("extendQuerySolution.auth.deleteError"),timeout:1500});this.deletedQuerySolutionIds.push(e.id),this.checkedSolution&&e.id==this.checkedSolution.id&&(this.checkedSolution=null);for(var t=0;t<this.querySolutions.length;t++)if(e.id==this.querySolutions[t].id){this.querySolutions.splice(t,1);break}this.listData=this.findSolutionsWithoutSys(this.querySolutions)},$.prototype.setDefault=function(e,t){e?(this.checkedSolution=t,this.querySolutions=this.querySolutions.map(function(e){return e.id==t.id?e.isDefault=!0:e.isDefault=!1,e})):t.id==this.checkedSolution.id&&(this.checkedSolution=null,this.querySolutions=this.querySolutions.map(function(e){return e.id==t.id&&(e.isDefault=!1),e})),this.listData=this.findSolutionsWithoutSys(this.querySolutions),this.list.refresh()},$.prototype.cancel=function(){this.dialog.close()},$.prototype.confirm=function(){var e=new Object;e.deletedQuerySolutionIds=this.deletedQuerySolutionIds,e.newDefaultQuerySolution=y.cloneDeep(this.checkedSolution),e.updatedQuerySolutionVos=y.cloneDeep(this.querySolutions),0<this.deletedQuerySolutionIds.length||this.checkedSolution&&this.checkedSolution.id?e.validator=!0:e.validator=!1,this.confirmEmitter.emit(e),this.dialog.close()},$.decorators=[{type:A.Component,args:[{selector:"app-solutionmanager",template:'<farris-dialog #dialog [buttons]="manangerbuttonRef" [width]="550" [height]="570" [title]="title">\r\n    <div class="solutionmanager-inner">\r\n        <farris-datagrid #list [columns]="columns" [data]="listData" [pagination]="false" [fit]="true"></farris-datagrid>\r\n    </div>\r\n    <ng-template #optCell let-ctx>\r\n        <span class="f-icon f-icon-yxs_delete solutionmanager-grid-delete" (click)="delelteSolution(ctx.rowData)"></span>\r\n     </ng-template>\r\n     <ng-template #checkCell let-ctx>\r\n        <div class="custom-control custom-radio f-checkradio-single" style="padding-top: 3px;">\r\n            <input class="custom-control-input" id="radio-{{ctx.rowData.id}}" type="radio"\r\n                [disabled]="ctx.rowData.type == \'public\' || ctx.rowData.type == \'org\'"\r\n                (click)="setDefault($event.target.checked, ctx.rowData)" [checked]="ctx.rowData.isDefault"/>\r\n            <label class="custom-control-label" for="radio-{{ctx.rowData.id}}"></label>\r\n        </div>\r\n     </ng-template>\r\n</farris-dialog>\r\n<ng-template #manangerbuttonRef>\r\n    <button class="btn btn-primary" (click)="confirm()">{{\'querySolution.manageDialog.confirm\' | locale}}</button>\r\n    <button class="btn btn-secondary" (click)="cancel()">{{\'querySolution.manageDialog.cancel\' | locale}}</button>\r\n</ng-template>',providers:[B],styles:[""]}]}],$.ctorParameters=function(){return[{type:r.FormBuilder},{type:B},{type:S.NotifyService},{type:I.LocaleService}]},$.propDecorators={cancelEmitter:[{type:A.Output}],confirmEmitter:[{type:A.Output}],dialog:[{type:A.ViewChild,args:["dialog"]}],optCell:[{type:A.ViewChild,args:["optCell"]}],checkCell:[{type:A.ViewChild,args:["checkCell"]}],list:[{type:A.ViewChild,args:["list"]}]},$);function $(e,t,o,i){var n=this;this.formBuilder=e,this.editService=t,this.notify=o,this.localeService=i,this.cancelEmitter=new A.EventEmitter,this.confirmEmitter=new A.EventEmitter,this.querySolutions=new Array,this.deletedQuerySolutionIds=new Array,this.authorityError=!1,this.propertyFieldFormatter=function(e,t){return"public"==t.type?n.localeService.getValue("extendQuerySolution.public.property"):"org"==t.type?n.localeService.getValue("extendQuerySolution.org.property"):n.localeService.getValue("extendQuerySolution.private.property")}}var K=(Object.defineProperty(Y.prototype,"hideOrgselector",{set:function(e){e&&(this.solutionType=this.solutionType.filter(function(e){return"org"!==e.value}))},enumerable:!0,configurable:!0}),Y.prototype.ngOnInit=function(){this.pRadioGroupValue=this.radioGroupValue,this.placeholder=this.localeService.getValue("extendQuerySolution.org.placeholder"),this.currentLang=window.gspframeworkService?window.gspframeworkService.rtf.language.getLanguageCode():"zh-cn"},Y.prototype.show=function(){this.dialog.show()},Y.prototype.cancel=function(){this.solutionCodeObj=null,this.dialog.close()},Y.prototype.confirm=function(){var o=this;if(this.solutionCodeObj){if(this.codeChangeHandler(this.solutionCodeObj["zh-cn"]),this.codeChangeHandler(this.solutionCodeObj.en),this.codeChangeHandler(this.solutionCodeObj["zh-CHT"]),this.codeError)return;this.querySolution.code_chs=this.solutionCodeObj["zh-cn"],this.querySolution.code_en=this.solutionCodeObj.en,this.querySolution.code_cht=this.solutionCodeObj["zh-CHT"]}if("zh-CHS"==this.currentLang){if(!this.querySolution.code_chs)return void this.solutionService.showInfo(this.localeService.getValue("querySolution.saveAsDialog.pleaseInput"),"info","",1500);this.querySolution.code=this.querySolution.code_chs}else if("en"==this.currentLang){if(!this.querySolution.code_en)return void this.solutionService.showInfo(this.localeService.getValue("querySolution.saveAsDialog.pleaseInput"),"info","",1500);this.querySolution.code=this.querySolution.code_en}else if("zh-CHT"==this.currentLang){if(!this.querySolution.code_cht)return void this.solutionService.showInfo(this.localeService.getValue("querySolution.saveAsDialog.pleaseInput"),"info","",1500);this.querySolution.code=this.querySolution.code_cht}if(this.authorityError&&"private"!=this.radioGroupValue)this.solutionService.showInfo(this.localeService.getValue("extendQuerySolution.auth.createError"),"warning","",1500);else{if(this.querySolution.type=this.radioGroupValue,this.querySolution.isDefault="private"==this.radioGroupValue&&this.isDefault,"org"==this.radioGroupValue){if(!this.selectedOrgIds.length)return void this.solutionService.showInfo(this.localeService.getValue("extendQuerySolution.auth.noSelectedOrg"),"info","",1500);this.querySolution.extendInfo=this.selectedOrgIds.map(function(e){var t=new w.QuerySolutionExtendVo;return t.id=o.solutionService.getGuid(),t.relatedId=o.querySolution.id,t.orgId=e,t})}var e=new Object;e.querySolution=y.cloneDeep(this.querySolution),this.confirmEmitter.emit(e),this.solutionCodeObj=null,this.dialog.close()}},Y.prototype.setDefault=function(e){this.isDefault=e},Y.prototype.codeChangeHandler=function(e){e&&e.length>this.codeMaxLength?this.codeError=!0:this.codeError=!1},Y.prototype.changeSolutionType=function(e){this.querySolution.type=e,this.querySolution.isDefault="private"==e&&this.isDefault,this.getAuthority.emit(e)},Y.prototype.getSelectedId=function(e){this.selectedOrgIds=e.selections.map(function(e){return e.orgId})},Y.prototype.clearAllOrgs=function(){this.selectedOrgIds=[]},Y.decorators=[{type:A.Component,args:[{selector:"app-saveasdialog",template:'<farris-dialog #dialog [buttons]="saveasbuttonRef" [width]="550" [height]="310" [title]="title">\r\n  <div class="qs-save-as-input">\r\n    <div class="farris-input-wrap">\r\n      \x3c!-- <input class="form-control"  placeholder="{{\'querySolution.saveAsDialog.placeholder\' | locale}}"\r\n        [(ngModel)]="querySolution.code" (ngModelChange)="codeChangeHandler($event)" /> --\x3e\r\n      <language-textbox [editable]="true" [languages]="languages" [panelWidth]="530" [(ngModel)]="solutionCodeObj"></language-textbox>\r\n        <div class="farris-feedback" [class.f-state-invalid]="codeError">\r\n            <span class="f-feedback-message ng-star-inserted">名称长度不应超过100</span>\r\n        </div>\r\n    </div>\r\n    <div class="custom-control custom-checkbox qs-save-as-check">\r\n      <farris-radiogroup [(ngModel)]="radioGroupValue" [data]="solutionType" [horizontal]="true"\r\n        (changeValue)="changeSolutionType($event)">\r\n      </farris-radiogroup>\r\n    </div>\r\n    <div class="custom-control custom-checkbox qs-save-as-check" *ngIf="radioGroupValue == \'private\'">\r\n      <input class="custom-control-input" type="checkbox" id="defaultSolution" (change)="setDefault($event.target.checked)"\r\n        [(ngModel)]="isDefault" />\r\n      <label class="custom-control-label" id="defaultSolution"\r\n        (click)="setDefault(!isDefault)">{{\'querySolution.saveAsDialog.setAsDefault\' | locale}}</label>\r\n    </div>\r\n    <div class="custom-control custom-checkbox qs-save-as-check" *ngIf="radioGroupValue == \'org\' && !noDataAuthority">\r\n      <farris-organization-selector\r\n        [primaryField]="\'orgId\'" [displayField]="\'name\'" [absOrgType]="\'System_organization\'" [placeholder]="placeholder"\r\n        [layer]="1" [multiSelect]="true" [showTabIds]="\'organization\'" [enableHierarchicalLoading]="true"\r\n        [cascadeCheck]="true" [cascadeDown]="true" [cascadeUp]="false" [orgIds]="selectedOrgIds"\r\n        [dataPermission]="true" [dataPermissionIds]="dataPermissionIds" (selectionsChange)="getSelectedId($event)"\r\n        (inputClear)="clearAllOrgs()" (tagRemoved)="getSelectedId($event)"\r\n        ></farris-organization-selector>\r\n    </div>  \r\n  </div>\r\n</farris-dialog>\r\n<ng-template #saveasbuttonRef>\r\n  <div class="qs-save-as-btn">\r\n    <button class="btn btn-primary" [disabled]="codeError"  (click)="confirm()">{{\'querySolution.saveAsDialog.confirm\' | locale}}</button>\r\n    <button class="btn btn-secondary" (click)="cancel()">{{\'querySolution.saveAsDialog.cancel\' | locale}}</button>\r\n  </div>\r\n</ng-template>\r\n',encapsulation:A.ViewEncapsulation.None,styles:[".qs-save-as-btn .btn{float:right;margin-left:10px;font-size:14px;line-height:26px}.qs-save-as-btn .btn-secondary{min-width:70px}.qs-save-as-input{width:100%;line-height:20px;font-size:14px;padding:20px 10px}.qs-save-as-check{margin:10px auto}"]}]}],Y.ctorParameters=function(){return[{type:S.NotifyService},{type:w.SolutionService},{type:I.LocaleService}]},Y.propDecorators={cls:[{type:A.HostBinding,args:["class"]}],cancelEmitter:[{type:A.Output}],confirmEmitter:[{type:A.Output}],getAuthority:[{type:A.Output}],hideOrgselector:[{type:A.Input}],dialog:[{type:A.ViewChild,args:["dialog"]}]},Y);function Y(e,t,o){this.notify=e,this.solutionService=t,this.localeService=o,this.cls="saveasdialog",this.cancelEmitter=new A.EventEmitter,this.confirmEmitter=new A.EventEmitter,this.getAuthority=new A.EventEmitter,this.querySolution=new w.QuerySolutionVo,this.codeError=!1,this.codeMaxLength=100,this.solutionType=[{value:"private",name:this.localeService.getValue("extendQuerySolution.private.setAsPrivate")},{value:"public",name:this.localeService.getValue("extendQuerySolution.public.setAsPublic")},{value:"org",name:this.localeService.getValue("extendQuerySolution.org.setAsOrgPublic")}],this.radioGroupValue="private",this.authorityError=!1,this.noDataAuthority=!1,this.dataPermissionIds=[],this.selectedOrgIds=[],this.isDefault=!1,this.languages=[{code:"zh-cn",name:"中文简体","default":!0},{code:"en",name:"English"},{code:"zh-CHT",name:"中文繁体"}]}var J=(Object.defineProperty(Z.prototype,"condition",{get:function(){return this._condition},set:function(e){this._condition=e,this.formatCondition()},enumerable:!0,configurable:!0}),Z.prototype.ngOnInit=function(){},Z.prototype.formatCondition=function(){var t=this,e=this.condition;if(e){this._conditionType=e.control.getControlType();var o=void 0,i=e.value.getOriginalValue();switch(this._conditionType){case w.ControlType.Text:i=(o=e.value).value&&o.value.trim();break;case w.ControlType.SingleNumber:this.numberOptions={precision:e.control.precision,type:"number"};break;case w.ControlType.NumberRange:this._isRange=!0,this._spliter="~",this.numberOptions={precision:e.control.precision,type:"number"},i=[e.value.startValue?e.value.startValue:"",e.value.endValue?e.value.endValue:""].join(this._spliter);break;case w.ControlType.SingleDate:this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM-dd",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM-dd";break;case w.ControlType.DateRange:this._isRange=!0,this._spliter="~",this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM-dd",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM-dd",i=[e.value.startTime?e.value.startTime:"",e.value.endTime?e.value.endTime:""].join(this._spliter);break;case w.ControlType.SingleYear:this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy",this.format=e.control&&e.control.format?e.control.format:"yyyy";break;case w.ControlType.SingleMonth:this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM";break;case w.ControlType.MonthRange:this._isRange=!0,this._spliter="~",this.returnFormat=e.control&&e.control.returnFormat?e.control.returnFormat:"yyyy-MM",this.format=e.control&&e.control.format?e.control.format:"yyyy-MM",e.value.startTime&&e.value.startTime,e.value.endTime&&e.value.endTime;break;case w.ControlType.SingleDateTime:this.showTime=!0,this.returnFormat=e.control.returnFormat?e.control.returnFormat:this.returnFormat,this.format="yyyy-MM-dd HH:mm:ss",e.control&&(e.control.enableCustomFormat?this.format=e.control.format?e.control.format:this.returnFormat:this.format=e.control&&e.control.format?e.control.format+" HH:mm:ss":this.returnFormat);break;case w.ControlType.DateTimeRange:this.showTime=!0,this._isRange=!0,this._spliter="~",this.returnFormat=e.control.returnFormat?e.control.returnFormat:this.returnFormat,this.format="yyyy-MM-dd HH:mm:ss",e.control&&(e.control.enableCustomFormat?this.format=e.control.format?e.control.format:this.returnFormat:this.format=e.control&&e.control.format?e.control.format+" HH:mm:ss":this.returnFormat),e.value.startTime&&e.value.startTime,e.value.endTime&&e.value.endTime;break;case w.ControlType.BoolCheck:var n=e.value.value;i=0<n.length?n[0]:null;break;case w.ControlType.DropDownList:this._spliter=",",e.control.uri&&!e.control.enumValues&&(i=e.value.value.map(function(e){return e[t.valueField]}).join(this._spliter));break;case w.ControlType.Radio:this._spliter=",";break;case w.ControlType.InputGroup:case w.ControlType.SmartHelp:i=(o=e.value).textValue&&o.textValue.trim();break;default:i=e.value.getOriginalValue()}this.text=this.formatValue(i)}else this.text=""},Z.prototype.formatLang=function(e){return e&&e[this.currentLanguage]?e[this.currentLanguage]:""},Z.prototype.getFormatNumberValue=function(e){if(!this.format&&!this.numberOptions)return e.toString();if(!this.numberOptions||!this.numberOptions.type||"number"!=this.numberOptions.type)return e.toString();if(this.numberOptions.formatter)return this.numberOptions.formatter(e);if(this.numberOptions.useThousands)this.numberOptions.precision!=undefined?this.format="n"+this.numberOptions.precision:this.format="n";else{if(this.numberOptions.precision==undefined)return e.toString();this.format="f"+this.numberOptions.precision}var t,o=this.currencyToUpperCase(this.format.substring(0,1)),i=Number(this.format.substring(1)),n={};if(/C|D|F|N|P/g.test(o)){switch(this.thousand&&Object.assign(n,{thousand:this.thousand}),this.decimal&&Object.assign(n,{decimal:this.decimal}),this.expression&&Object.assign(n,{format:this.expression}),o){case"C":Object.assign(n,{prefix:this.currencySymbol,precision:i}),t=this.numberHelper.formatMoney(e,n);break;case"D":t=this.toDecimal(e,i);break;case"F":Object.assign(n,{prefix:"",thousand:"",precision:i}),t=this.numberHelper.formatMoney(e,n);break;case"N":Object.assign(n,{prefix:"",precision:i}),t=this.numberHelper.formatMoney(e,n);break;case"P":t=this.toPercent(e,i)}return t}console.warn("不支持format为 "+this.format+" 类型的数字格式化")},Z.prototype.toDecimal=function(e,t){if(!(-1<e.toString().indexOf(".")))return(Array(t).join(this.filledSymbol)+e).slice(-t);console.warn("十进制转换仅限整型类型")},Z.prototype.toPercent=function(e,t){return Number(100*e).toFixed(Number(t))+"%"},Z.prototype.currencyToUpperCase=function(e){return e.replace(/[a-z]+/g,function(e){return e.toUpperCase()})},Z.prototype.dateToUpperCase=function(e){var t;return t=!0===/Y/g.test(e)?e.replace(/Y/g,"y"):e,!0===/D/g.test(t)&&(t=t.replace(/D/g,"d")),t},Z.prototype.getFormatEnumValue=function(e){var o=this;if(e==undefined||null===e||""===e)return"";if(this.dataSource&&this.dataSource.length){for(var i=(""+e).split(this._spliter),n=[],t=function(t){var e=r.dataSource.find(function(e){return e[o.valueField]==i[t]});e?n.push(e[r.textField]):n.push(i[t])},r=this,s=0;s<i.length;s++)t(s);return 0<n.length?n.join(this._spliter):""}return e},Z.prototype.getFormatCheckBoxValue=function(e){return!0===e?this.localeService.getValue("text.yes"):!1===e||null==e||void 0===e?this.localeService.getValue("text.no"):e},Z.prototype.dateformat=function(e){return this.format||(this.format="YYYY-MM-dd"),this.returnFormat&&"string"==typeof e&&(e=this.getDateFromFormatedString(e,this.returnFormat)),"hh:mm:ss"===this.format||"HH:mm:ss"===this.format?e:this.dtHelper.formatTo(e,this.dateToUpperCase(this.format))},Z.prototype.getDateFromFormatedString=function(n,e){var r={year:0,month:0,day:0,hour:0,minite:0,second:0};return n&&e.replace(/y{4}|Y{4}|M+|d+|D+|h+|H+|m+|s+/g,function(t,e,o,i){n.substring(e).replace(/\d+/,function(e){e&&(i=parseInt(e.substr(0,t.length),10))}),/y+/i.test(t)&&!r.year&&(r.year=i),/M+/.test(t)&&!r.month&&(r.month=i),/d+/i.test(t)&&!r.day&&(r.day=i),/h+/i.test(t)&&!r.hour&&(r.hour=i),/m+/.test(t)&&!r.minite&&(r.minite=i),/s+/.test(t)&&!r.second&&(r.second=i)}),r.day=r.day?r.day:1,r.month=r.month?r.month:1,new Date(r.year+"/"+r.month+"/"+r.day+" "+r.hour+":"+r.minite+":"+r.second)},Z.prototype["function"]=function(e,t){var o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(t=t||"yyyy-MM-dd hh:mm:ss")&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[i]:("00"+o[i]).substr((""+o[i]).length)));return t},Z.prototype.formatValue=function(e){var t,o=this;if(this.currentLanguage)return this.formatLang(e);if(this._conditionType!==w.ControlType.BoolCheck&&(null==e||void 0===e))return"";switch(this._conditionType){case w.ControlType.Text:t=e;break;case w.ControlType.DateRange:case w.ControlType.MonthRange:case w.ControlType.DateTimeRange:var i=e.split(this._spliter),n=[];i&&i.length&&i.forEach(function(e){var t=o.dateformat(e);n.push(t)}),t=n.join(this._spliter);break;case w.ControlType.SingleDate:t=e&&e.text?e.text:this.dateformat(e);break;case w.ControlType.SingleDateTime:case w.ControlType.SingleMonth:case w.ControlType.SingleYear:t=this.dateformat(e);break;case w.ControlType.SingleNumber:t=this.getFormatNumberValue(e);break;case w.ControlType.NumberRange:var r=e.split(this._spliter),s=[];r&&r.length&&r.forEach(function(e){var t=o.getFormatNumberValue(e);s.push(t)}),t=s.join(this._spliter);break;case w.ControlType.Radio:case w.ControlType.DropDownList:this.dataSource=this.condition.control.enumValues,t=this.getFormatEnumValue(e);break;case w.ControlType.BoolCheck:t=this.getFormatCheckBoxValue(e);break;case w.ControlType.SmartHelp:case w.ControlType.ComboLookUp:t="help-text-value-null"===e?"":e;break;default:t=e}return t},Z.decorators=[{type:A.Component,args:[{selector:"lib-summary-condition",template:'<span class="summary-condition--label">{{condition.fieldName}}</span>:<span class="summary-condition--text">{{text}}</span>',styles:[""]}]}],Z.ctorParameters=function(){return[{type:V.DateTimeHelperService},{type:D.NumberHelperService},{type:A.Injector}]},Z.propDecorators={condition:[{type:A.Input}],filledSymbol:[{type:A.Input}]},Z);function Z(e,t,o){this.dtHelper=e,this.numberHelper=t,this.injector=o,this._spliter="",this._isRange=!1,this.showTime=!1,this.textField="name",this.valueField="value",this.returnFormat="",this.text="",this.thousand=",",this.decimal=".",this.expression="%s%v",this.currencySymbol="￥",this.filledSymbol="0",this.localeService=this.injector.get(I.LocaleService)}var X=(ee.prototype.ngOnDestroy=function(){this.ro&&(this.ro.unobserve(this.wrapperEl.nativeElement),this.ro=null)},ee.prototype.ngOnInit=function(){this.observerElement()},ee.prototype.observerElement=function(){var i=this;this.ngZone.runOutsideAngular(function(){i.ro=new x(function(e,t){var o=e[0].contentRect.width;15<Math.abs(o-i.widthFlag)&&(i.widthFlag=o,i.changeTipsState())}),i.ro.observe(i.wrapperEl.nativeElement)})},ee.prototype.changeTipsState=function(){var e=this.enableTips;(e=this.wrapperEl.nativeElement.clientWidth+2<this.wrapperEl.nativeElement.scrollWidth)!==this.enableTips&&(this.enableTips=e,this.cd.markForCheck(),this.cd.detectChanges())},ee.decorators=[{type:A.Component,args:[{selector:"lib-summary-list",template:'<div class="summary-condition-wrapper" #wrapper [farrisTooltip]="enableTips" [placement]="\'bottom\'" [content]="tpTemplate" [tipCls]="\'summary-list--tips\'" [tipWidth]="widthFlag+\'px\'">\r\n    <ng-container *ngFor="let currentItem of conditions;let i = index;let lastIndex = last;">\r\n        <lib-summary-condition class="summary-condition--item" [condition]="currentItem"></lib-summary-condition>\r\n        <span class="summary-condition--spliter" [ngClass]="{\'last-spliter\': lastIndex}"></span>\r\n    </ng-container>\r\n</div>\r\n<ng-template #tpTemplate>\r\n    <div class="summary-condition--tips" *ngIf="enableTips">\r\n        <ng-container *ngFor="let currentItem of conditions;let i = index;let lastIndex=last;">\r\n            <lib-summary-condition class="summary-condition--item" [condition]="currentItem"></lib-summary-condition>\r\n            <span class="summary-condition--gutter">;</span>\r\n        </ng-container>\r\n    </div>\r\n</ng-template>',styles:[""]}]}],ee.ctorParameters=function(){return[{type:A.NgZone},{type:A.ChangeDetectorRef}]},ee.propDecorators={cls:[{type:A.HostBinding,args:["class.summary-list"]}],wrapperEl:[{type:A.ViewChild,args:["wrapper",{read:A.ElementRef}]}],conditions:[{type:A.Input}],enableTips:[{type:A.Input}]},ee);function ee(e,t){this.ngZone=e,this.cd=t,this.cls=!0,this.conditions=new Array,this.enableTips=!1,this.ro=null,this.widthFlag=0}var te=(oe.decorators=[{type:A.NgModule,args:[{imports:[t.CommonModule,r.FormsModule,l.FarrisDialogModule,a.LookupModule,u.MultiSelectModule,f.FieldGroupModule,g.InputGroupModule,m.FDropdownDirectiveTypeModule,S.NotifyModule.forRoot(),v.LoadingModule.forRoot(),w.QueryConditionModule,C.HttpClientModule,I.LocaleModule,b.DatagridModule,D.NumberHelperModule,V.DateHelperModule,q.FarrisTooltipModule,F.FarrisFormsModule,Q.OrganizationSelectorModule,k.LanguageTextboxModule],declarations:[G,W,K,J,X],entryComponents:[W,K],providers:[w.SolutionService],exports:[G,W,K]}]}],oe);function oe(){}e.QuerySolutionModule=te,e.QuerySolutionComponent=G,e.ɵe=K,e.ɵc=W,e.SummaryConditionComponent=J,e.SummaryListComponent=X,e.QUERYSOLUTION_HANDLER_TOKEN=R,e.SolutionCacheService=P,e.ɵd=B,e.ɵb=L,e.ɵa=H,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-cmp-querysolution.umd.min.js.map